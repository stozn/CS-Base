{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u5c0f\u6797 x \u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840","text":"<p>\ud83d\udc49 \u70b9\u51fb\uff1a\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\u5728\u7ebf\u9605\u8bfb</p> <p>\u672c\u7ad9\u6240\u6709\u6587\u7ae0\u90fd\u662f\u6211\u516c\u4f17\u53f7\uff1a\u5c0f\u6797 coding\u7684\u539f\u521b\u6587\u7ae0\uff0c\u5185\u5bb9\u5305\u542b\u56fe\u89e3\u8ba1\u7b97\u673a\u7f51\u7edc\u3001\u64cd\u4f5c\u7cfb\u7edf\u3001\u8ba1\u7b97\u673a\u7ec4\u6210\u3001\u6570\u636e\u5e93\uff0c\u5171 1000 \u5f20\u56fe + 50 \u4e07\u5b57\uff0c\u7834\u9664\u6666\u6da9\u96be\u61c2\u7684\u8ba1\u7b97\u673a\u57fa\u7840\u77e5\u8bc6\uff0c\u8ba9\u5929\u4e0b\u6ca1\u6709\u96be\u61c2\u7684\u516b\u80a1\u6587\uff08\u53e3\u55e8\u4e00\u4e0b\uff0c\u5927\u5bb6\u4e0d\u8981\u5f53\u771f\u54c8\u54c8\uff09\uff01\ud83d\ude80</p> <p>\u66fe\u7ecf\u6211\u4e5f\u82e6\u607c\u4e8e\u90a3\u4e9b\u6666\u6da9\u96be\u5f04\u7684\u8ba1\u7b97\u673a\u57fa\u7840\u77e5\u8bc6\uff0c\u4f46\u5728\u6211\u5543\u4e86\u4e00\u672c\u53c8\u4e00\u672c\u7684\u4e66\uff0c\u770b\u4e86\u4e00\u4e2a\u53c8\u4e00\u4e2a\u7684\u89c6\u9891\u540e\uff0c\u7ec8\u4e8e\u5bf9\u8fd9\u4e9b\u201c\u5bb6\u4f19\u201d\u6709\u4e86\u8ba4\u8bc6\u3002\u6211\u60f3\u7740\uff0c\u8fd9\u4e16\u754c\u4e0a\u80af\u5b9a\u6709\u4e00\u4e9b\u670b\u53cb\u4e5f\u8ddf\u6211\u6709\u4e00\u6837\u7684\u82e6\u607c\uff0c\u4e3a\u6b64\u4e0b\u51b3\u5fc3\uff0c\u7528\u56fe\u89e3 + \u901a\u719f\u6613\u61c2\u7684\u8bb2\u89e3\u6765\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\uff0c\u5229\u7528\u5de5\u4f5c\u4e4b\u4f59\uff0c\u575a\u6301\u8f93\u51fa\u56fe\u89e3\u6587\u7ae0\u4e24\u5e74\u4e4b\u4e45\uff0c\u8fd9\u624d\u6709\u4e86\u4eca\u5929\u7684\u7f51\u7ad9\uff01</p>"},{"location":"#_1","title":"\u300a\u56fe\u89e3\u7f51\u7edc\u300b","text":"<ul> <li>\u4ecb\u7ecd:point_down:\uff1a</li> <li>\u56fe\u89e3\u7f51\u7edc\u4ecb\u7ecd</li> <li>\u7f51\u7edc\u57fa\u7840\u7bc7 :point_down:</li> <li>TCP/IP \u7f51\u7edc\u6a21\u578b\u6709\u54ea\u51e0\u5c42\uff1f </li> <li>\u952e\u5165\u7f51\u5740\u5230\u7f51\u9875\u663e\u793a\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f </li> <li>Linux \u7cfb\u7edf\u662f\u5982\u4f55\u6536\u53d1\u7f51\u7edc\u5305\u7684\uff1f </li> <li>HTTP \u7bc7 :point_down:</li> <li>HTTP \u5e38\u89c1\u9762\u8bd5\u9898 </li> <li>HTTP/1.1 \u5982\u4f55\u4f18\u5316\uff1f </li> <li>HTTPS RSA \u63e1\u624b\u89e3\u6790 </li> <li>HTTPS ECDHE \u63e1\u624b\u89e3\u6790 </li> <li>HTTPS \u5982\u4f55\u4f18\u5316\uff1f </li> <li>HTTP/2 \u725b\u903c\u5728\u54ea\uff1f </li> <li>HTTP/3 \u5f3a\u52bf\u6765\u88ad </li> <li>\u65e2\u7136\u6709 HTTP \u534f\u8bae\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 RPC\uff1f </li> <li>\u65e2\u7136\u6709 HTTP \u534f\u8bae\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 WebSocket\uff1f </li> <li>TCP \u7bc7 :point_down:</li> <li>TCP \u4e09\u6b21\u63e1\u624b\u4e0e\u56db\u6b21\u6325\u624b\u9762\u8bd5\u9898 </li> <li>TCP \u91cd\u4f20\u3001\u6ed1\u52a8\u7a97\u53e3\u3001\u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236 </li> <li>TCP \u5b9e\u6218\u6293\u5305\u5206\u6790 </li> <li>TCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217 </li> <li>\u5982\u4f55\u4f18\u5316 TCP? </li> <li>\u5982\u4f55\u7406\u89e3\u662f TCP \u9762\u5411\u5b57\u8282\u6d41\u534f\u8bae\uff1f </li> <li>\u4e3a\u4ec0\u4e48 TCP \u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u8981\u4e0d\u4e00\u6837\u5462\uff1f </li> <li>SYN \u62a5\u6587\u4ec0\u4e48\u65f6\u5019\u60c5\u51b5\u4e0b\u4f1a\u88ab\u4e22\u5f03\uff1f </li> <li>\u56db\u6b21\u6325\u624b\u4e2d\u6536\u5230\u4e71\u5e8f\u7684 FIN \u5305\u4f1a\u5982\u4f55\u5904\u7406\uff1f </li> <li>\u5728 TIME_WAIT \u72b6\u6001\u7684 TCP \u8fde\u63a5\uff0c\u6536\u5230 SYN \u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f </li> <li>TCP \u8fde\u63a5\uff0c\u4e00\u7aef\u65ad\u7535\u548c\u8fdb\u7a0b\u5d29\u6e83\u6709\u4ec0\u4e48\u533a\u522b\uff1f </li> <li>\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u539f\u672c\u7684 TCP \u8fde\u63a5\u8fd8\u5b58\u5728\u5417\uff1f </li> <li>tcp_tw_reuse \u4e3a\u4ec0\u4e48\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff1f </li> <li>HTTPS \u4e2d TLS \u548c TCP \u80fd\u540c\u65f6\u63e1\u624b\u5417\uff1f </li> <li>TCP Keepalive \u548c HTTP Keep-Alive \u662f\u4e00\u4e2a\u4e1c\u897f\u5417\uff1f </li> <li>TCP \u534f\u8bae\u6709\u4ec0\u4e48\u7f3a\u9677\uff1f</li> <li>\u5982\u4f55\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\uff1f</li> <li>TCP \u548c UDP \u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f</li> <li>\u670d\u52a1\u7aef\u6ca1\u6709 listen\uff0c\u5ba2\u6237\u7aef\u53d1\u8d77\u8fde\u63a5\u5efa\u7acb\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</li> <li>\u6ca1\u6709 accept\uff0c\u53ef\u4ee5\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f </li> <li>\u7528\u4e86 TCP \u534f\u8bae\uff0c\u6570\u636e\u4e00\u5b9a\u4e0d\u4f1a\u4e22\u5417\uff1f</li> <li>TCP \u56db\u6b21\u6325\u624b\uff0c\u53ef\u4ee5\u53d8\u6210\u4e09\u6b21\u5417\uff1f</li> <li>TCP \u5e8f\u5217\u53f7\u548c\u786e\u8ba4\u53f7\u662f\u5982\u4f55\u53d8\u5316\u7684\uff1f</li> <li>IP \u7bc7 :point_down:</li> <li>IP \u57fa\u7840\u77e5\u8bc6\u5168\u5bb6\u6876  </li> <li>ping \u7684\u5de5\u4f5c\u539f\u7406  </li> <li>\u65ad\u7f51\u4e86\uff0c\u8fd8\u80fd ping \u901a 127.0.0.1 \u5417\uff1f</li> <li>\u5b66\u4e60\u5fc3\u5f97 :point_down:</li> <li>\u8ba1\u7b97\u673a\u7f51\u7edc\u600e\u4e48\u5b66\uff1f   </li> <li>\u753b\u56fe\u7ecf\u9a8c\u5206\u4eab  </li> </ul>"},{"location":"#_2","title":"\u300a\u56fe\u89e3\u7cfb\u7edf\u300b","text":"<ul> <li>\u4ecb\u7ecd:point_down:\uff1a</li> <li>\u56fe\u89e3\u7cfb\u7edf\u4ecb\u7ecd</li> <li>\u786c\u4ef6\u7ed3\u6784 :point_down:</li> <li>CPU \u662f\u5982\u4f55\u6267\u884c\u7a0b\u5e8f\u7684\uff1f </li> <li>\u78c1\u76d8\u6bd4\u5185\u5b58\u6162\u51e0\u4e07\u500d\uff1f </li> <li>\u5982\u4f55\u5199\u51fa\u8ba9 CPU \u8dd1\u5f97\u66f4\u5feb\u7684\u4ee3\u7801\uff1f </li> <li>CPU \u7f13\u5b58\u4e00\u81f4\u6027 </li> <li>CPU \u662f\u5982\u4f55\u6267\u884c\u4efb\u52a1\u7684\uff1f </li> <li>\u4ec0\u4e48\u662f\u8f6f\u4e2d\u65ad\uff1f </li> <li>\u4e3a\u4ec0\u4e48 0.1 + 0.2 \u4e0d\u7b49\u4e8e 0.3\uff1f </li> <li>\u64cd\u4f5c\u7cfb\u7edf\u7ed3\u6784 :point_down:</li> <li>Linux \u5185\u6838 vs Windows \u5185\u6838 </li> <li>\u5185\u5b58\u7ba1\u7406 :point_down:</li> <li>\u4e3a\u4ec0\u4e48\u8981\u6709\u865a\u62df\u5185\u5b58\uff1f </li> <li>malloc \u662f\u5982\u4f55\u5206\u914d\u5185\u5b58\u7684\uff1f</li> <li>\u5185\u5b58\u6ee1\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</li> <li>\u5728 4GB \u7269\u7406\u5185\u5b58\u7684\u673a\u5668\u4e0a\uff0c\u7533\u8bf7 8G \u5185\u5b58\u4f1a\u600e\u4e48\u6837\uff1f</li> <li>\u5982\u4f55\u907f\u514d\u9884\u8bfb\u5931\u6548\u548c\u7f13\u5b58\u6c61\u67d3\u7684\u95ee\u9898\uff1f</li> <li>\u6df1\u5165\u7406\u89e3 Linux \u865a\u62df\u5185\u5b58\u7ba1\u7406</li> <li>\u6df1\u5165\u7406\u89e3 Linux \u7269\u7406\u5185\u5b58\u7ba1\u7406</li> <li>\u8fdb\u7a0b\u7ba1\u7406 :point_down:</li> <li>\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u57fa\u7840\u77e5\u8bc6 </li> <li>\u8fdb\u7a0b\u95f4\u6709\u54ea\u4e9b\u901a\u4fe1\u65b9\u5f0f\uff1f </li> <li>\u591a\u7ebf\u7a0b\u51b2\u7a81\u4e86\u600e\u4e48\u529e\uff1f </li> <li>\u600e\u4e48\u907f\u514d\u6b7b\u9501\uff1f </li> <li>\u4ec0\u4e48\u662f\u60b2\u89c2\u9501\u3001\u4e50\u89c2\u9501\uff1f </li> <li>\u4e00\u4e2a\u8fdb\u7a0b\u6700\u591a\u53ef\u4ee5\u521b\u5efa\u591a\u5c11\u4e2a\u7ebf\u7a0b\uff1f </li> <li>\u7ebf\u7a0b\u5d29\u6e83\u4e86\uff0c\u8fdb\u7a0b\u4e5f\u4f1a\u5d29\u6e83\u5417\uff1f</li> <li>\u8c03\u5ea6\u7b97\u6cd5 :point_down:</li> <li>\u8fdb\u7a0b\u8c03\u5ea6/\u9875\u9762\u7f6e\u6362/\u78c1\u76d8\u8c03\u5ea6\u7b97\u6cd5</li> <li>\u6587\u4ef6\u7cfb\u7edf :point_down:</li> <li>\u6587\u4ef6\u7cfb\u7edf\u5168\u5bb6\u6876     </li> <li>\u8fdb\u7a0b\u5199\u6587\u4ef6\u65f6\uff0c\u8fdb\u7a0b\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u5df2\u5199\u5165\u7684\u6570\u636e\u4f1a\u4e22\u5931\u5417\uff1f</li> <li>\u8bbe\u5907\u7ba1\u7406 :point_down:</li> <li>\u952e\u76d8\u6572\u5165 A \u5b57\u6bcd\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f </li> <li>\u7f51\u7edc\u7cfb\u7edf :point_down:</li> <li>\u4ec0\u4e48\u662f\u96f6\u62f7\u8d1d\uff1f </li> <li>I/O \u591a\u8def\u590d\u7528\uff1aselect/poll/epoll </li> <li>\u9ad8\u6027\u80fd\u7f51\u7edc\u6a21\u5f0f\uff1aReactor \u548c Proactor </li> <li>\u4ec0\u4e48\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\uff1f </li> <li>\u5b66\u4e60\u5fc3\u5f97 :point_down:</li> <li>\u5982\u4f55\u67e5\u770b\u7f51\u7edc\u7684\u6027\u80fd\u6307\u6807\uff1f    </li> <li>\u753b\u56fe\u7ecf\u9a8c\u5206\u4eab  </li> <li>\u5b66\u4e60\u5fc3\u5f97 :point_down:</li> <li>\u8ba1\u7b97\u673a\u7f51\u7edc\u600e\u4e48\u5b66\uff1f   </li> <li>\u753b\u56fe\u7ecf\u9a8c\u5206\u4eab </li> </ul>"},{"location":"#mysql","title":"\u300a\u56fe\u89e3 MySQL\u300b","text":"<ul> <li>\u4ecb\u7ecd:point_down:\uff1a</li> <li>\u56fe\u89e3 MySQL \u4ecb\u7ecd</li> <li>\u57fa\u7840\u7bc7:point_down:\uff1a</li> <li>\u6267\u884c\u4e00\u6761 select \u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</li> <li>MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f</li> <li>\u7d22\u5f15\u7bc7 :point_down:</li> <li>\u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898</li> <li>\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811</li> <li>\u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f</li> <li>MySQL \u5355\u8868\u4e0d\u8981\u8d85\u8fc7 2000W \u884c\uff0c\u9760\u8c31\u5417\uff1f</li> <li>\u7d22\u5f15\u5931\u6548\u6709\u54ea\u4e9b\uff1f</li> <li>MySQL \u4f7f\u7528 like\u201c%x\u201c\uff0c\u7d22\u5f15\u4e00\u5b9a\u4f1a\u5931\u6548\u5417\uff1f</li> <li>count(*) \u548c count(1) \u6709\u4ec0\u4e48\u533a\u522b\uff1f\u54ea\u4e2a\u6027\u80fd\u6700\u597d\uff1f</li> <li>\u4e8b\u52a1\u7bc7 :point_down:</li> <li>\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f</li> <li>MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb\u4e86\u5417\uff1f        </li> <li>\u9501\u7bc7 :point_down:</li> <li>MySQL \u6709\u54ea\u4e9b\u9501\uff1f     </li> <li>MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f   </li> <li>update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868     </li> <li>MySQL \u6b7b\u9501\u4e86\uff0c\u600e\u4e48\u529e\uff1f </li> <li>\u5b57\u8282\u9762\u8bd5\uff1a\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u5bfc\u81f4\u6b7b\u9501\u7684\uff1f</li> <li>\u65e5\u5fd7\u7bc7 :point_down:</li> <li>MySQL \u65e5\u5fd7\uff1aundo log\u3001redo log\u3001binlog \u6709\u4ec0\u4e48\u7528\uff1f</li> <li>\u5185\u5b58\u7bc7 :point_down:</li> <li>\u63ed\u5f00 Buffer Pool \u7684\u9762\u7eb1  </li> </ul>"},{"location":"#redis","title":"\u300a\u56fe\u89e3 Redis\u300b","text":"<ul> <li>\u9762\u8bd5\u7bc7 :point_down:</li> <li>Redis \u5e38\u89c1\u9762\u8bd5\u9898</li> <li>\u6570\u636e\u7c7b\u578b\u7bc7 :point_down:</li> <li>Redis \u6570\u636e\u7c7b\u578b\u548c\u5e94\u7528\u573a\u666f</li> <li>\u56fe\u89e3 Redis \u6570\u636e\u7ed3\u6784</li> <li>\u6301\u4e45\u5316\u7bc7 :point_down:</li> <li>AOF \u6301\u4e45\u5316\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f  </li> <li>RDB \u5feb\u7167\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f </li> <li>\u529f\u80fd\u7bc7:point_down:</li> <li>Redis \u8fc7\u671f\u5220\u9664\u7b56\u7565\u548c\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6709\u4ec0\u4e48\u533a\u522b\uff1f </li> <li>\u9ad8\u53ef\u7528\u7bc7 :point_down:</li> <li>\u4e3b\u4ece\u590d\u5236\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f    </li> <li>\u4e3a\u4ec0\u4e48\u8981\u6709\u54e8\u5175\uff1f</li> <li>\u7f13\u5b58\u7bc7 :point_down:</li> <li>\u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\u3001\u51fb\u7a7f\u3001\u7a7f\u900f\uff1f     </li> <li>\u6570\u636e\u5e93\u548c\u7f13\u5b58\u5982\u4f55\u4fdd\u8bc1\u4e00\u81f4\u6027\uff1f </li> </ul>"},{"location":"#_3","title":"\u5b66\u4e60\u5fc3\u5f97","text":"<ul> <li>\u8ba1\u7b97\u673a\u57fa\u7840\u5b66\u4e60\u8def\u7ebf \uff1a\u8ba1\u7b97\u673a\u57fa\u7840\u5b66\u4e60\u4e66\u7c4d + \u89c6\u9891\u63a8\u8350\uff0c\u5168\u9762\u4e14\u6e05\u6670\u3002</li> <li>\u4e92\u8054\u7f51\u6821\u62db\u5fc3\u5f97 \uff1a\u5c0f\u6797\u795e\u4ed9\u8bfb\u8005\u4eec\u7684\u6821\u62db\u548c\u5b66\u4e60\u5fc3\u5f97\uff0c\u503c\u5f97\u5b66\u4e60\u3002</li> </ul>"},{"location":"mysql/","title":"\u56fe\u89e3 MySQL \u4ecb\u7ecd","text":"<p>\u300a\u56fe\u89e3 MySQL\u300b\u76ee\u524d\u8fd8\u5728\u8fde\u8f7d\u66f4\u65b0\u4e2d\uff0c\u5927\u5bb6\u4e0d\u8981\u50ac\u5566:joy: \uff0c\u66f4\u65b0\u5b8c\u4f1a\u7b2c\u4e00\u65f6\u95f4\u6574\u7406 PDF \u7684\u3002</p> <p>\u76ee\u524d\u5df2\u7ecf\u66f4\u65b0\u597d\u7684\u6587\u7ae0\uff1a</p> <ul> <li> <p>\u57fa\u7840\u7bc7:point_down:</p> </li> <li> <p>\u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</p> </li> <li> <p>MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f</p> </li> <li> <p>\u7d22\u5f15\u7bc7 :point_down:</p> </li> <li> <p>\u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898</p> </li> <li>\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811</li> <li>\u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f</li> <li>MySQL \u5355\u8868\u4e0d\u8981\u8d85\u8fc7 2000W \u884c\uff0c\u9760\u8c31\u5417\uff1f</li> <li>\u7d22\u5f15\u5931\u6548\u6709\u54ea\u4e9b\uff1f</li> <li>MySQL \u4f7f\u7528 like\u201c%x\u201c\uff0c\u7d22\u5f15\u4e00\u5b9a\u4f1a\u5931\u6548\u5417\uff1f</li> <li> <p>count(*) \u548c count(1) \u6709\u4ec0\u4e48\u533a\u522b\uff1f\u54ea\u4e2a\u6027\u80fd\u6700\u597d\uff1f</p> </li> <li> <p>\u4e8b\u52a1\u7bc7 :point_down:</p> <ul> <li>\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f </li> <li>MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb\u4e86\u5417\uff1f </li> </ul> </li> <li> <p>\u9501\u7bc7 :point_down:</p> <ul> <li>MySQL \u6709\u54ea\u4e9b\u9501\uff1f </li> <li>MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f </li> <li>update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868\uff1f </li> <li>MySQL \u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f </li> <li>MySQL \u6b7b\u9501\u4e86\uff0c\u600e\u4e48\u529e\uff1f </li> <li>\u5b57\u8282\u9762\u8bd5\uff1a\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u5bfc\u81f4\u6b7b\u9501\u7684\uff1f</li> </ul> </li> <li> <p>\u65e5\u5fd7\u7bc7 :point_down:</p> <ul> <li>undo log\u3001redo log\u3001binlog \u6709\u4ec0\u4e48\u7528\uff1f </li> </ul> </li> <li> <p>\u5185\u5b58\u7bc7 :point_down:</p> <ul> <li>\u63ed\u5f00 Buffer_Pool \u7684\u9762\u7eb1 </li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p> </li> </ul>"},{"location":"mysql/base/how_select/","title":"\u6267\u884c\u4e00\u6761 select \u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u5b66\u4e60 SQL \u7684\u65f6\u5019\uff0c\u5927\u5bb6\u80af\u5b9a\u7b2c\u4e00\u4e2a\u5148\u5b66\u5230\u7684\u5c31\u662f select \u67e5\u8be2\u8bed\u53e5\u4e86\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u53e5\u67e5\u8be2\u8bed\u53e5\uff1a</p> SQL<pre><code>// \u5728 product \u8868\u4e2d\uff0c\u67e5\u8be2 id = 1 \u7684\u8bb0\u5f55\nselect * from product where id = 1;\n</code></pre> <p>\u4f46\u662f\u6709\u6ca1\u6709\u60f3\u8fc7\uff0cMySQL \u6267\u884c\u4e00\u6761 select \u67e5\u8be2\u8bed\u53e5\uff0c\u5728 MySQL \u4e2d\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</p> <p>\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5f88\u597d\u7684\u4e86\u89e3 MySQL \u5185\u90e8\u7684\u67b6\u6784\uff0c\u6240\u4ee5\u8fd9\u6b21\u5c0f\u6797\u5c31\u5e26\u5927\u5bb6\u62c6\u89e3\u4e00\u4e0b MySQL \u5185\u90e8\u7684\u7ed3\u6784\uff0c\u770b\u770b\u5185\u90e8\u91cc\u7684\u6bcf\u4e00\u4e2a\u201c\u96f6\u4ef6\u201d\u5177\u4f53\u662f\u8d1f\u8d23\u505a\u4ec0\u4e48\u7684\u3002</p>"},{"location":"mysql/base/how_select/#mysql","title":"MySQL \u6267\u884c\u6d41\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>\u5148\u6765\u4e00\u4e2a\u4e0a\u5e1d\u89c6\u89d2\u56fe\uff0c\u4e0b\u9762\u5c31\u662f MySQL \u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6d41\u7a0b\uff0c\u4e5f\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230 MySQL \u5185\u90e8\u67b6\u6784\u91cc\u7684\u5404\u4e2a\u529f\u80fd\u6a21\u5757\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cMySQL \u7684\u67b6\u6784\u5171\u5206\u4e3a\u4e24\u5c42\uff1aServer \u5c42\u548c\u5b58\u50a8\u5f15\u64ce\u5c42\uff0c</p> <ul> <li>Server \u5c42\u8d1f\u8d23\u5efa\u7acb\u8fde\u63a5\u3001\u5206\u6790\u548c\u6267\u884c SQL\u3002MySQL \u5927\u591a\u6570\u7684\u6838\u5fc3\u529f\u80fd\u6a21\u5757\u90fd\u5728\u8fd9\u5b9e\u73b0\uff0c\u4e3b\u8981\u5305\u62ec\u8fde\u63a5\u5668\uff0c\u67e5\u8be2\u7f13\u5b58\u3001\u89e3\u6790\u5668\u3001\u9884\u5904\u7406\u5668\u3001\u4f18\u5316\u5668\u3001\u6267\u884c\u5668\u7b49\u3002\u53e6\u5916\uff0c\u6240\u6709\u7684\u5185\u7f6e\u51fd\u6570\uff08\u5982\u65e5\u671f\u3001\u65f6\u95f4\u3001\u6570\u5b66\u548c\u52a0\u5bc6\u51fd\u6570\u7b49\uff09\u548c\u6240\u6709\u8de8\u5b58\u50a8\u5f15\u64ce\u7684\u529f\u80fd\uff08\u5982\u5b58\u50a8\u8fc7\u7a0b\u3001\u89e6\u53d1\u5668\u3001\u89c6\u56fe\u7b49\u3002\uff09\u90fd\u5728 Server \u5c42\u5b9e\u73b0\u3002</li> <li>\u5b58\u50a8\u5f15\u64ce\u5c42\u8d1f\u8d23\u6570\u636e\u7684\u5b58\u50a8\u548c\u63d0\u53d6\u3002\u652f\u6301 InnoDB\u3001MyISAM\u3001Memory \u7b49\u591a\u4e2a\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u5171\u7528\u4e00\u4e2a Server \u5c42\u3002\u73b0\u5728\u6700\u5e38\u7528\u7684\u5b58\u50a8\u5f15\u64ce\u662f InnoDB\uff0c\u4ece MySQL 5.5 \u7248\u672c\u5f00\u59cb\uff0cInnoDB \u6210\u4e3a\u4e86 MySQL \u7684\u9ed8\u8ba4\u5b58\u50a8\u5f15\u64ce\u3002\u6211\u4eec\u5e38\u8bf4\u7684\u7d22\u5f15\u6570\u636e\u7ed3\u6784\uff0c\u5c31\u662f\u7531\u5b58\u50a8\u5f15\u64ce\u5c42\u5b9e\u73b0\u7684\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u7684\u7d22\u5f15\u7c7b\u578b\u4e5f\u4e0d\u76f8\u540c\uff0c\u6bd4\u5982 InnoDB \u652f\u6301\u7d22\u5f15\u7c7b\u578b\u662f B+\u6811\uff0c\u4e14\u662f\u9ed8\u8ba4\u4f7f\u7528\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u6570\u636e\u8868\u4e2d\u521b\u5efa\u7684\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f B+ \u6811\u7d22\u5f15\u3002</li> </ul> <p>\u597d\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u5bf9 Server \u5c42\u548c\u5b58\u50a8\u5f15\u64ce\u5c42\u6709\u4e86\u4e00\u4e2a\u7b80\u5355\u8ba4\u8bc6\uff0c\u63a5\u4e0b\u6765\uff0c\u5c31\u8be6\u7ec6\u8bf4\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u6d41\u7a0b\uff0c\u4f9d\u6b21\u770b\u770b\u6bcf\u4e00\u4e2a\u529f\u80fd\u6a21\u5757\u7684\u4f5c\u7528\u3002</p>"},{"location":"mysql/base/how_select/#_1","title":"\u7b2c\u4e00\u6b65\uff1a\u8fde\u63a5\u5668","text":"<p>\u5982\u679c\u4f60\u5728 Linux \u64cd\u4f5c\u7cfb\u7edf\u91cc\u8981\u4f7f\u7528 MySQL\uff0c\u90a3\u4f60\u7b2c\u4e00\u6b65\u80af\u5b9a\u662f\u8981\u5148\u8fde\u63a5 MySQL \u670d\u52a1\uff0c\u7136\u540e\u624d\u80fd\u6267\u884c SQL \u8bed\u53e5\uff0c\u666e\u904d\u6211\u4eec\u90fd\u662f\u4f7f\u7528\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\u8fdb\u884c\u8fde\u63a5\uff1a</p> Bash<pre><code># -h \u6307\u5b9a MySQL \u670d\u52a1\u7684 IP \u5730\u5740\uff0c\u5982\u679c\u662f\u8fde\u63a5\u672c\u5730\u7684 MySQL\u670d\u52a1\uff0c\u53ef\u4ee5\u4e0d\u7528\u8fd9\u4e2a\u53c2\u6570\uff1b\n# -u \u6307\u5b9a\u7528\u6237\u540d\uff0c\u7ba1\u7406\u5458\u89d2\u8272\u540d\u4e3a root\uff1b\n# -p \u6307\u5b9a\u5bc6\u7801\uff0c\u5982\u679c\u547d\u4ee4\u884c\u4e2d\u4e0d\u586b\u5199\u5bc6\u7801\uff08\u4e3a\u4e86\u5bc6\u7801\u5b89\u5168\uff0c\u5efa\u8bae\u4e0d\u8981\u5728\u547d\u4ee4\u884c\u5199\u5bc6\u7801\uff09\uff0c\u5c31\u9700\u8981\u5728\u4ea4\u4e92\u5bf9\u8bdd\u91cc\u9762\u8f93\u5165\u5bc6\u7801\nmysql -h$ip -u$user -p\n</code></pre> <p>\u8fde\u63a5\u7684\u8fc7\u7a0b\u9700\u8981\u5148\u7ecf\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\uff0c\u56e0\u4e3a MySQL \u662f\u57fa\u4e8e TCP \u534f\u8bae\u8fdb\u884c\u4f20\u8f93\u7684\uff0c\u5982\u679c MySQL \u670d\u52a1\u5e76\u6ca1\u6709\u542f\u52a8\uff0c\u5219\u4f1a\u6536\u5230\u5982\u4e0b\u7684\u62a5\u9519\uff1a</p> <p></p> <p>\u5982\u679c  MySQL \u670d\u52a1\u6b63\u5e38\u8fd0\u884c\uff0c\u5b8c\u6210 TCP \u8fde\u63a5\u7684\u5efa\u7acb\u540e\uff0c\u8fde\u63a5\u5668\u5c31\u8981\u5f00\u59cb\u9a8c\u8bc1\u4f60\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5982\u679c\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u5bf9\uff0c\u5c31\u6536\u5230\u4e00\u4e2a\"Access denied for user\"\u7684\u9519\u8bef\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u7a0b\u5e8f\u7ed3\u675f\u6267\u884c\u3002</p> <p></p> <p>\u5982\u679c\u7528\u6237\u5bc6\u7801\u90fd\u6ca1\u6709\u95ee\u9898\uff0c\u8fde\u63a5\u5668\u5c31\u4f1a\u83b7\u53d6\u8be5\u7528\u6237\u7684\u6743\u9650\uff0c\u7136\u540e\u4fdd\u5b58\u8d77\u6765\uff0c\u540e\u7eed\u8be5\u7528\u6237\u5728\u6b64\u8fde\u63a5\u91cc\u7684\u4efb\u4f55\u64cd\u4f5c\uff0c\u90fd\u4f1a\u57fa\u4e8e\u8fde\u63a5\u5f00\u59cb\u65f6\u8bfb\u5230\u7684\u6743\u9650\u8fdb\u884c\u6743\u9650\u903b\u8f91\u7684\u5224\u65ad\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u4e00\u4e2a\u7528\u6237\u5df2\u7ecf\u5efa\u7acb\u4e86\u8fde\u63a5\uff0c\u5373\u4f7f\u7ba1\u7406\u5458\u4e2d\u9014\u4fee\u6539\u4e86\u8be5\u7528\u6237\u7684\u6743\u9650\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5df2\u7ecf\u5b58\u5728\u8fde\u63a5\u7684\u6743\u9650\u3002\u4fee\u6539\u5b8c\u6210\u540e\uff0c\u53ea\u6709\u518d\u65b0\u5efa\u7684\u8fde\u63a5\u624d\u4f1a\u4f7f\u7528\u65b0\u7684\u6743\u9650\u8bbe\u7f6e\u3002</p> <p>\u5982\u4f55\u67e5\u770b MySQL \u670d\u52a1\u88ab\u591a\u5c11\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u4e86\uff1f</p> <p>\u5982\u679c\u4f60\u60f3\u77e5\u9053\u5f53\u524d  MySQL \u670d\u52a1\u88ab\u591a\u5c11\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u4e86\uff0c\u4f60\u53ef\u4ee5\u6267\u884c <code>show processlist</code> \u547d\u4ee4\u8fdb\u884c\u67e5\u770b\u3002</p> <p></p> <p>\u6bd4\u5982\u4e0a\u56fe\u7684\u663e\u793a\u7ed3\u679c\uff0c\u5171\u6709\u4e24\u4e2a\u7528\u6237\u540d\u4e3a root \u7684\u7528\u6237\u8fde\u63a5\u4e86 MySQL \u670d\u52a1\uff0c\u5176\u4e2d id \u4e3a 6 \u7684\u7528\u6237\u7684 Command \u5217\u7684\u72b6\u6001\u4e3a <code>Sleep</code> \uff0c\u8fd9\u610f\u5473\u7740\u8be5\u7528\u6237\u8fde\u63a5\u5b8c MySQL \u670d\u52a1\u5c31\u6ca1\u6709\u518d\u6267\u884c\u8fc7\u4efb\u4f55\u547d\u4ee4\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u662f\u4e00\u4e2a\u7a7a\u95f2\u7684\u8fde\u63a5\uff0c\u5e76\u4e14\u7a7a\u95f2\u7684\u65f6\u957f\u662f 736 \u79d2\uff08Time \u5217\uff09\u3002</p> <p>\u7a7a\u95f2\u8fde\u63a5\u4f1a\u4e00\u76f4\u5360\u7528\u7740\u5417\uff1f</p> <p>\u5f53\u7136\u4e0d\u662f\u4e86\uff0cMySQL \u5b9a\u4e49\u4e86\u7a7a\u95f2\u8fde\u63a5\u7684\u6700\u5927\u7a7a\u95f2\u65f6\u957f\uff0c\u7531 <code>wait_timeout</code> \u53c2\u6570\u63a7\u5236\u7684\uff0c\u9ed8\u8ba4\u503c\u662f 8 \u5c0f\u65f6\uff0828800 \u79d2\uff09\uff0c\u5982\u679c\u7a7a\u95f2\u8fde\u63a5\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u65f6\u95f4\uff0c\u8fde\u63a5\u5668\u5c31\u4f1a\u81ea\u52a8\u5c06\u5b83\u65ad\u5f00\u3002</p> SQL<pre><code>mysql&gt; show variables like 'wait_timeout';\n+---------------+-------+\n| Variable_name | Value |\n+---------------+-------+\n| wait_timeout  | 28800 |\n+---------------+-------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u5f53\u7136\uff0c\u6211\u4eec\u81ea\u5df1\u4e5f\u53ef\u4ee5\u624b\u52a8\u65ad\u5f00\u7a7a\u95f2\u7684\u8fde\u63a5\uff0c\u4f7f\u7528\u7684\u662f kill connection + id \u7684\u547d\u4ee4\u3002</p> SQL<pre><code>mysql&gt; kill connection +6;\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre> <p>\u4e00\u4e2a\u5904\u4e8e\u7a7a\u95f2\u72b6\u6001\u7684\u8fde\u63a5\u88ab\u670d\u52a1\u7aef\u4e3b\u52a8\u65ad\u5f00\u540e\uff0c\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u77e5\u9053\uff0c\u7b49\u5230\u5ba2\u6237\u7aef\u5728\u53d1\u8d77\u4e0b\u4e00\u4e2a\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u6536\u5230\u8fd9\u6837\u7684\u62a5\u9519\u201cERROR 2013 (HY000): Lost connection to MySQL server during query\u201d\u3002</p> <p>MySQL \u7684\u8fde\u63a5\u6570\u6709\u9650\u5236\u5417\uff1f</p> <p>MySQL \u670d\u52a1\u652f\u6301\u7684\u6700\u5927\u8fde\u63a5\u6570\u7531 max_connections \u53c2\u6570\u63a7\u5236\uff0c\u6bd4\u5982\u6211\u7684 MySQL \u670d\u52a1\u9ed8\u8ba4\u662f 151 \u4e2a\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u503c\uff0c\u7cfb\u7edf\u5c31\u4f1a\u62d2\u7edd\u63a5\u4e0b\u6765\u7684\u8fde\u63a5\u8bf7\u6c42\uff0c\u5e76\u62a5\u9519\u63d0\u793a\u201cToo many connections\u201d\u3002</p> SQL<pre><code>mysql&gt; show variables like 'max_connections';\n+-----------------+-------+\n| Variable_name   | Value |\n+-----------------+-------+\n| max_connections | 151   |\n+-----------------+-------+\n1 row in set (0.00 sec)\n</code></pre> <p>MySQL \u7684\u8fde\u63a5\u4e5f\u8ddf HTTP \u4e00\u6837\uff0c\u6709\u77ed\u8fde\u63a5\u548c\u957f\u8fde\u63a5\u7684\u6982\u5ff5\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5982\u4e0b\uff1a</p> C<pre><code>// \u77ed\u8fde\u63a5\n\u8fde\u63a5 mysql \u670d\u52a1\uff08TCP \u4e09\u6b21\u63e1\u624b\uff09\n\u6267\u884csql\n\u65ad\u5f00 mysql \u670d\u52a1\uff08TCP \u56db\u6b21\u6325\u624b\uff09\n\n// \u957f\u8fde\u63a5\n\u8fde\u63a5 mysql \u670d\u52a1\uff08TCP \u4e09\u6b21\u63e1\u624b\uff09\n\u6267\u884csql\n\u6267\u884csql\n\u6267\u884csql\n....\n\u65ad\u5f00 mysql \u670d\u52a1\uff08TCP \u56db\u6b21\u6325\u624b\uff09\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528\u957f\u8fde\u63a5\u7684\u597d\u5904\u5c31\u662f\u53ef\u4ee5\u51cf\u5c11\u5efa\u7acb\u8fde\u63a5\u548c\u65ad\u5f00\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u4e00\u822c\u662f\u63a8\u8350\u4f7f\u7528\u957f\u8fde\u63a5\u3002</p> <p>\u4f46\u662f\uff0c\u4f7f\u7528\u957f\u8fde\u63a5\u540e\u53ef\u80fd\u4f1a\u5360\u7528\u5185\u5b58\u589e\u591a\uff0c\u56e0\u4e3a MySQL \u5728\u6267\u884c\u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4e34\u65f6\u4f7f\u7528\u5185\u5b58\u7ba1\u7406\u8fde\u63a5\u5bf9\u8c61\uff0c\u8fd9\u4e9b\u8fde\u63a5\u5bf9\u8c61\u8d44\u6e90\u53ea\u6709\u5728\u8fde\u63a5\u65ad\u5f00\u65f6\u624d\u4f1a\u91ca\u653e\u3002\u5982\u679c\u957f\u8fde\u63a5\u7d2f\u8ba1\u5f88\u591a\uff0c\u5c06\u5bfc\u81f4 MySQL \u670d\u52a1\u5360\u7528\u5185\u5b58\u592a\u5927\uff0c\u6709\u53ef\u80fd\u4f1a\u88ab\u7cfb\u7edf\u5f3a\u5236\u6740\u6389\uff0c\u8fd9\u6837\u4f1a\u53d1\u751f MySQL \u670d\u52a1\u5f02\u5e38\u91cd\u542f\u7684\u73b0\u8c61\u3002</p> <p>\u600e\u4e48\u89e3\u51b3\u957f\u8fde\u63a5\u5360\u7528\u5185\u5b58\u7684\u95ee\u9898\uff1f</p> <p>\u6709\u4e24\u79cd\u89e3\u51b3\u65b9\u5f0f\u3002</p> <p>\u7b2c\u4e00\u79cd\uff0c\u5b9a\u671f\u65ad\u5f00\u957f\u8fde\u63a5\u3002\u65e2\u7136\u65ad\u5f00\u8fde\u63a5\u540e\u5c31\u4f1a\u91ca\u653e\u8fde\u63a5\u5360\u7528\u7684\u5185\u5b58\u8d44\u6e90\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5b9a\u671f\u65ad\u5f00\u957f\u8fde\u63a5\u3002</p> <p>\u7b2c\u4e8c\u79cd\uff0c\u5ba2\u6237\u7aef\u4e3b\u52a8\u91cd\u7f6e\u8fde\u63a5\u3002MySQL 5.7 \u7248\u672c\u5b9e\u73b0\u4e86 <code>mysql_reset_connection()</code> \u51fd\u6570\u7684\u63a5\u53e3\uff0c\u6ce8\u610f\u8fd9\u662f\u63a5\u53e3\u51fd\u6570\u4e0d\u662f\u547d\u4ee4\uff0c\u90a3\u4e48\u5f53\u5ba2\u6237\u7aef\u6267\u884c\u4e86\u4e00\u4e2a\u5f88\u5927\u7684\u64cd\u4f5c\u540e\uff0c\u5728\u4ee3\u7801\u91cc\u8c03\u7528 mysql_reset_connection \u51fd\u6570\u6765\u91cd\u7f6e\u8fde\u63a5\uff0c\u8fbe\u5230\u91ca\u653e\u5185\u5b58\u7684\u6548\u679c\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4e0d\u9700\u8981\u91cd\u8fde\u548c\u91cd\u65b0\u505a\u6743\u9650\u9a8c\u8bc1\uff0c\u4f46\u662f\u4f1a\u5c06\u8fde\u63a5\u6062\u590d\u5230\u521a\u521a\u521b\u5efa\u5b8c\u65f6\u7684\u72b6\u6001\u3002</p> <p>\u81f3\u6b64\uff0c\u8fde\u63a5\u5668\u7684\u5de5\u4f5c\u505a\u5b8c\u4e86\uff0c\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\uff1a</p> <ul> <li>\u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c TCP \u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\uff1b</li> <li>\u6821\u9a8c\u5ba2\u6237\u7aef\u7684\u7528\u6237\u540d\u548c\u5bc6\u7801\uff0c\u5982\u679c\u7528\u6237\u540d\u6216\u5bc6\u7801\u4e0d\u5bf9\uff0c\u5219\u4f1a\u62a5\u9519\uff1b</li> <li>\u5982\u679c\u7528\u6237\u540d\u548c\u5bc6\u7801\u90fd\u5bf9\u4e86\uff0c\u4f1a\u8bfb\u53d6\u8be5\u7528\u6237\u7684\u6743\u9650\uff0c\u7136\u540e\u540e\u9762\u7684\u6743\u9650\u903b\u8f91\u5224\u65ad\u90fd\u57fa\u4e8e\u6b64\u65f6\u8bfb\u53d6\u5230\u7684\u6743\u9650\uff1b</li> </ul>"},{"location":"mysql/base/how_select/#_2","title":"\u7b2c\u4e8c\u6b65\uff1a\u67e5\u8be2\u7f13\u5b58","text":"<p>\u8fde\u63a5\u5668\u7684\u5de5\u4f5c\u5b8c\u6210\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u5411 MySQL \u670d\u52a1\u53d1\u9001 SQL \u8bed\u53e5\u4e86\uff0cMySQL \u670d\u52a1\u6536\u5230 SQL \u8bed\u53e5\u540e\uff0c\u5c31\u4f1a\u89e3\u6790\u51fa SQL \u8bed\u53e5\u7684\u7b2c\u4e00\u4e2a\u5b57\u6bb5\uff0c\u770b\u770b\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u8bed\u53e5\u3002</p> <p>\u5982\u679c SQL \u662f\u67e5\u8be2\u8bed\u53e5\uff08select \u8bed\u53e5\uff09\uff0cMySQL \u5c31\u4f1a\u5148\u53bb\u67e5\u8be2\u7f13\u5b58\uff08Query Cache\uff09\u91cc\u67e5\u627e\u7f13\u5b58\u6570\u636e\uff0c\u770b\u770b\u4e4b\u524d\u6709\u6ca1\u6709\u6267\u884c\u8fc7\u8fd9\u4e00\u6761\u547d\u4ee4\uff0c\u8fd9\u4e2a\u67e5\u8be2\u7f13\u5b58\u662f\u4ee5 key-value \u5f62\u5f0f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\uff0ckey \u4e3a SQL \u67e5\u8be2\u8bed\u53e5\uff0cvalue \u4e3a SQL \u8bed\u53e5\u67e5\u8be2\u7684\u7ed3\u679c\u3002</p> <p>\u5982\u679c\u67e5\u8be2\u7684\u8bed\u53e5\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58\uff0c\u90a3\u4e48\u5c31\u4f1a\u76f4\u63a5\u8fd4\u56de value \u7ed9\u5ba2\u6237\u7aef\u3002\u5982\u679c\u67e5\u8be2\u7684\u8bed\u53e5\u6ca1\u6709\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58\u4e2d\uff0c\u90a3\u4e48\u5c31\u8981\u5f80\u4e0b\u7ee7\u7eed\u6267\u884c\uff0c\u7b49\u6267\u884c\u5b8c\u540e\uff0c\u67e5\u8be2\u7684\u7ed3\u679c\u5c31\u4f1a\u88ab\u5b58\u5165\u67e5\u8be2\u7f13\u5b58\u4e2d\u3002</p> <p>\u8fd9\u4e48\u770b\uff0c\u67e5\u8be2\u7f13\u5b58\u8fd8\u633a\u6709\u7528\uff0c\u4f46\u662f\u5176\u5b9e\u67e5\u8be2\u7f13\u5b58\u633a\u9e21\u808b\u7684\u3002</p> <p>\u5bf9\u4e8e\u66f4\u65b0\u6bd4\u8f83\u9891\u7e41\u7684\u8868\uff0c\u67e5\u8be2\u7f13\u5b58\u7684\u547d\u4e2d\u7387\u5f88\u4f4e\u7684\uff0c\u56e0\u4e3a\u53ea\u8981\u4e00\u4e2a\u8868\u6709\u66f4\u65b0\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8868\u7684\u67e5\u8be2\u7f13\u5b58\u5c31\u4f1a\u88ab\u6e05\u7a7a\u3002\u5982\u679c\u521a\u7f13\u5b58\u4e86\u4e00\u4e2a\u67e5\u8be2\u7ed3\u679c\u5f88\u5927\u7684\u6570\u636e\uff0c\u8fd8\u6ca1\u88ab\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u521a\u597d\u8fd9\u4e2a\u8868\u6709\u66f4\u65b0\u64cd\u4f5c\uff0c\u67e5\u8be2\u7f13\u51b2\u5c31\u88ab\u6e05\u7a7a\u4e86\uff0c\u76f8\u5f53\u4e8e\u7f13\u5b58\u4e86\u4e2a\u5bc2\u5bde\u3002</p> <p>\u6240\u4ee5\uff0cMySQL 8.0 \u7248\u672c\u76f4\u63a5\u5c06\u67e5\u8be2\u7f13\u5b58\u5220\u6389\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4 MySQL 8.0 \u5f00\u59cb\uff0c\u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u4e0d\u4f1a\u518d\u8d70\u5230\u67e5\u8be2\u7f13\u5b58\u8fd9\u4e2a\u9636\u6bb5\u4e86\u3002</p> <p>\u5bf9\u4e8e MySQL 8.0 \u4e4b\u524d\u7684\u7248\u672c\uff0c\u5982\u679c\u60f3\u5173\u95ed\u67e5\u8be2\u7f13\u5b58\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c06\u53c2\u6570 query_cache_type \u8bbe\u7f6e\u6210 DEMAND\u3002</p> <p>::: tip</p> <p>\u8fd9\u91cc\u8bf4\u7684\u67e5\u8be2\u7f13\u5b58\u662f server \u5c42\u7684\uff0c\u4e5f\u5c31\u662f MySQL 8.0 \u7248\u672c\u79fb\u9664\u7684\u662f server \u5c42\u7684\u67e5\u8be2\u7f13\u5b58\uff0c\u5e76\u4e0d\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\u7684 buffer pool\u3002</p> <p>::::</p>"},{"location":"mysql/base/how_select/#sql","title":"\u7b2c\u4e09\u6b65\uff1a\u89e3\u6790 SQL","text":"<p>\u5728\u6b63\u5f0f\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\u4e4b\u524d\uff0cMySQL \u4f1a\u5148\u5bf9 SQL \u8bed\u53e5\u505a\u89e3\u6790\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u4ea4\u7531\u300c\u89e3\u6790\u5668\u300d\u6765\u5b8c\u6210\u3002</p>"},{"location":"mysql/base/how_select/#_3","title":"\u89e3\u6790\u5668","text":"<p>\u89e3\u6790\u5668\u4f1a\u505a\u5982\u4e0b\u4e24\u4ef6\u4e8b\u60c5\u3002</p> <p>\u7b2c\u4e00\u4ef6\u4e8b\u60c5\uff0c\u8bcd\u6cd5\u5206\u6790\u3002MySQL \u4f1a\u6839\u636e\u4f60\u8f93\u5165\u7684\u5b57\u7b26\u4e32\u8bc6\u522b\u51fa\u5173\u952e\u5b57\u51fa\u6765\uff0c\u6784\u5efa\u51fa SQL \u8bed\u6cd5\u6811\uff0c\u8fd9\u6837\u65b9\u4fbf\u540e\u9762\u6a21\u5757\u83b7\u53d6 SQL \u7c7b\u578b\u3001\u8868\u540d\u3001\u5b57\u6bb5\u540d\u3001where \u6761\u4ef6\u7b49\u7b49\u3002</p> <p>\u7b2c\u4e8c\u4ef6\u4e8b\u60c5\uff0c\u8bed\u6cd5\u5206\u6790\u3002\u6839\u636e\u8bcd\u6cd5\u5206\u6790\u7684\u7ed3\u679c\uff0c\u8bed\u6cd5\u89e3\u6790\u5668\u4f1a\u6839\u636e\u8bed\u6cd5\u89c4\u5219\uff0c\u5224\u65ad\u4f60\u8f93\u5165\u7684\u8fd9\u4e2a SQL \u8bed\u53e5\u662f\u5426\u6ee1\u8db3 MySQL \u8bed\u6cd5\u3002</p> <p>\u5982\u679c\u6211\u4eec\u8f93\u5165\u7684 SQL \u8bed\u53e5\u8bed\u6cd5\u4e0d\u5bf9\uff0c\u5c31\u4f1a\u5728\u89e3\u6790\u5668\u8fd9\u4e2a\u9636\u6bb5\u62a5\u9519\u3002\u6bd4\u5982\uff0c\u6211\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u628a from \u5199\u6210\u4e86 form\uff0c\u8fd9\u65f6 MySQL \u89e3\u6790\u5668\u5c31\u4f1a\u7ed9\u62a5\u9519\u3002</p> <p></p> <p>\u4f46\u662f\u6ce8\u610f\uff0c\u8868\u4e0d\u5b58\u5728\u6216\u8005\u5b57\u6bb5\u4e0d\u5b58\u5728\uff0c\u5e76\u4e0d\u662f\u5728\u89e3\u6790\u5668\u91cc\u505a\u7684\uff0c\u300aMySQL 45 \u8bb2\u300b\u8bf4\u662f\u5728\u89e3\u6790\u5668\u505a\u7684\uff0c\u4f46\u662f\u7ecf\u8fc7\u6211\u548c\u670b\u53cb\u770b MySQL \u6e90\u7801\uff085.7 \u548c 8.0\uff09\u5f97\u51fa\u7ed3\u8bba\u662f\u89e3\u6790\u5668\u53ea\u8d1f\u8d23\u6784\u5efa\u8bed\u6cd5\u6811\u548c\u68c0\u67e5\u8bed\u6cd5\uff0c\u4f46\u662f\u4e0d\u4f1a\u53bb\u67e5\u8868\u6216\u8005\u5b57\u6bb5\u5b58\u4e0d\u5b58\u5728\u3002</p> <p>\u90a3\u5230\u5e95\u8c01\u6765\u505a\u68c0\u6d4b\u8868\u548c\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5de5\u4f5c\u5462\uff1f\u522b\u6025\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4e86\u3002</p>"},{"location":"mysql/base/how_select/#sql_1","title":"\u7b2c\u56db\u6b65\uff1a\u6267\u884c SQL","text":"<p>\u7ecf\u8fc7\u89e3\u6790\u5668\u540e\uff0c\u63a5\u7740\u5c31\u8981\u8fdb\u5165\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6d41\u7a0b\u4e86\uff0c\u6bcf\u6761<code>SELECT</code> \u67e5\u8be2\u8bed\u53e5\u6d41\u7a0b\u4e3b\u8981\u53ef\u4ee5\u5206\u4e3a\u4e0b\u9762\u8fd9\u4e09\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li>prepare \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u9884\u5904\u7406\u9636\u6bb5\uff1b</li> <li>optimize \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u4f18\u5316\u9636\u6bb5\uff1b</li> <li>execute \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u6267\u884c\u9636\u6bb5\uff1b</li> </ul>"},{"location":"mysql/base/how_select/#_4","title":"\u9884\u5904\u7406\u5668","text":"<p>\u6211\u4eec\u5148\u6765\u8bf4\u8bf4\u9884\u5904\u7406\u9636\u6bb5\u505a\u4e86\u4ec0\u4e48\u4e8b\u60c5\u3002</p> <ul> <li>\u68c0\u67e5 SQL \u67e5\u8be2\u8bed\u53e5\u4e2d\u7684\u8868\u6216\u8005\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff1b</li> <li>\u5c06 <code>select *</code> \u4e2d\u7684 <code>*</code> \u7b26\u53f7\uff0c\u6269\u5c55\u4e3a\u8868\u4e0a\u7684\u6240\u6709\u5217\uff1b</li> </ul> <p>\u6211\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0ctest \u8fd9\u5f20\u8868\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u8fd9\u65f6 MySQL \u5c31\u4f1a\u5728\u6267\u884c SQL \u67e5\u8be2\u8bed\u53e5\u7684 prepare \u9636\u6bb5\u4e2d\u62a5\u9519\u3002</p> SQL<pre><code>mysql&gt; select * from test;\nERROR 1146 (42S02): Table 'mysql.test' doesn't exist\n</code></pre> <p>\u8fd9\u91cc\u8d34\u4e2a MySQL 8.0 \u6e90\u7801\u6765\u8bc1\u660e\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5224\u65ad\uff0c\u4e0d\u662f\u5728\u89e3\u6790\u5668\u91cc\u505a\u7684\uff0c\u800c\u662f\u5728 prepare \u9636\u6bb5\u3002\uff08PS\uff1a\u4e0b\u56fe\u662f\u516c\u4f17\u53f7\u300c\u4e00\u6811\u4e00\u6eaa\u300d\u8001\u54e5\u5e2e\u6211\u5206\u6790\u7684\uff0c\u8fd9\u4f4d\u8001\u54e5\u4e13\u95e8\u5199 MySQL \u6e90\u7801\u6587\u7ae0\uff0c\u611f\u5174\u8da3\u7684\u670b\u53cb\uff0c\u53ef\u4ee5\u5fae\u4fe1\u641c\u7d22\u5173\u6ce8\uff09</p> <p></p> <p>\u4e0a\u9762\u7684\u4e2d\u95f4\u90e8\u5206\u662f MySQL \u62a5\u9519\u8868\u4e0d\u5b58\u5728\u65f6\u7684\u51fd\u6570\u8c03\u7528\u6808\uff0c\u53ef\u4ee5\u770b\u5230\u8868\u4e0d\u5b58\u5728\u7684\u9519\u8bef\u662f\u5728 get_table_share()  \u51fd\u6570\u91cc\u62a5\u9519\u7684\uff0c\u800c\u8fd9\u4e2a\u51fd\u6570\u662f\u5728 prepare \u9636\u6bb5\u8c03\u7528\u7684\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5bf9\u4e8e  MySQL 5.7 \u5224\u65ad\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5de5\u4f5c\uff0c\u662f\u5728\u8bcd\u6cd5\u5206\u6790&amp;\u8bed\u6cd5\u5206\u6790\u4e4b\u540e\uff0cprepare \u9636\u6bb5\u4e4b\u524d\u505a\u7684\u3002\u7ed3\u8bba\u90fd\u4e00\u6837\uff0c\u4e0d\u662f\u5728\u89e3\u6790\u5668\u91cc\u505a\u7684\u3002\u4ee3\u7801\u6211\u5c31\u4e0d\u653e\u4e86\uff0c\u6b63\u56e0\u4e3a   MySQL 5.7  \u4ee3\u7801\u7ed3\u6784\u4e0d\u597d\uff0c\u6240\u4ee5 MySQL 8.0 \u4ee3\u7801\u7ed3\u6784\u53d8\u5316\u5f88\u5927\uff0c\u540e\u6765\u5224\u65ad\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\u7684\u5de5\u4f5c\u5c31\u88ab\u653e\u5165\u5230 prepare \u9636\u6bb5\u505a\u4e86\u3002</p>"},{"location":"mysql/base/how_select/#_5","title":"\u4f18\u5316\u5668","text":"<p>\u7ecf\u8fc7\u9884\u5904\u7406\u9636\u6bb5\u540e\uff0c\u8fd8\u9700\u8981\u4e3a SQL \u67e5\u8be2\u8bed\u53e5\u5148\u5236\u5b9a\u4e00\u4e2a\u6267\u884c\u8ba1\u5212\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u4ea4\u7531\u300c\u4f18\u5316\u5668\u300d\u6765\u5b8c\u6210\u7684\u3002</p> <p>\u4f18\u5316\u5668\u4e3b\u8981\u8d1f\u8d23\u5c06 SQL \u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u65b9\u6848\u786e\u5b9a\u4e0b\u6765\uff0c\u6bd4\u5982\u5728\u8868\u91cc\u9762\u6709\u591a\u4e2a\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4f18\u5316\u5668\u4f1a\u57fa\u4e8e\u67e5\u8be2\u6210\u672c\u7684\u8003\u8651\uff0c\u6765\u51b3\u5b9a\u9009\u62e9\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\u3002</p> <p>\u5f53\u7136\uff0c\u6211\u4eec\u672c\u6b21\u7684\u67e5\u8be2\u8bed\u53e5\uff08select * from product where id = 1\uff09\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u9009\u62e9\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\u3002</p> <p>\u8981\u60f3\u77e5\u9053\u4f18\u5316\u5668\u9009\u62e9\u4e86\u54ea\u4e2a\u7d22\u5f15\uff0c\u6211\u4eec\u53ef\u4ee5\u5728\u67e5\u8be2\u8bed\u53e5\u6700\u524d\u9762\u52a0\u4e2a <code>explain</code> \u547d\u4ee4\uff0c\u8fd9\u6837\u5c31\u4f1a\u8f93\u51fa\u8fd9\u6761 SQL \u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\uff0c\u7136\u540e\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key \u5c31\u8868\u793a\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u4e86\u54ea\u4e2a\u7d22\u5f15\uff0c\u6bd4\u5982\u4e0b\u56fe\u7684 key \u4e3a <code>PRIMARY</code> \u5c31\u662f\u4f7f\u7528\u4e86\u4e3b\u952e\u7d22\u5f15\u3002</p> <p></p> <p>\u5982\u679c\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u91cc\u7684 key \u4e3a null \u8bf4\u660e\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u90a3\u5c31\u4f1a\u5168\u8868\u626b\u63cf\uff08type = ALL\uff09\uff0c\u8fd9\u79cd\u67e5\u8be2\u626b\u63cf\u7684\u65b9\u5f0f\u662f\u6548\u7387\u6700\u4f4e\u6863\u6b21\u7684\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u5f20 product \u8868\u53ea\u6709\u4e00\u4e2a\u7d22\u5f15\u5c31\u662f\u4e3b\u952e\uff0c\u73b0\u5728\u6211\u5728\u8868\u4e2d\u5c06 name \u8bbe\u7f6e\u4e3a\u666e\u901a\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u3002</p> <p></p> <p>\u8fd9\u65f6 product \u8868\u5c31\u6709\u4e3b\u952e\u7d22\u5f15\uff08id\uff09\u548c\u666e\u901a\u7d22\u5f15\uff08name\uff09\u3002\u5047\u8bbe\u6267\u884c\u4e86\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a</p> SQL<pre><code>select id from product where id &gt; 1  and name like 'i%';\n</code></pre> <p>\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u7ed3\u679c\u65e2\u53ef\u4ee5\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\uff0c\u4e5f\u53ef\u4ee5\u4f7f\u7528\u666e\u901a\u7d22\u5f15\uff0c\u4f46\u662f\u6267\u884c\u7684\u6548\u7387\u4f1a\u4e0d\u540c\u3002\u8fd9\u65f6\uff0c\u5c31\u9700\u8981\u4f18\u5316\u5668\u6765\u51b3\u5b9a\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\u4e86\u3002</p> <p>\u5f88\u663e\u7136\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u662f\u8986\u76d6\u7d22\u5f15\uff0c\u76f4\u63a5\u5728\u4e8c\u7ea7\u7d22\u5f15\u5c31\u80fd\u67e5\u627e\u5230\u7ed3\u679c\uff08\u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u53f6\u5b50\u8282\u70b9\u7684\u6570\u636e\u5b58\u50a8\u7684\u662f\u4e3b\u952e\u503c\uff09\uff0c\u5c31\u6ca1\u5fc5\u8981\u5728\u4e3b\u952e\u7d22\u5f15\u67e5\u627e\u4e86\uff0c\u56e0\u4e3a\u67e5\u8be2\u4e3b\u952e\u7d22\u5f15\u7684 B+ \u6811\u7684\u6210\u672c\u4f1a\u6bd4\u67e5\u8be2\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u7684\u6210\u672c\u5927\uff0c\u4f18\u5316\u5668\u57fa\u4e8e\u67e5\u8be2\u6210\u672c\u7684\u8003\u8651\uff0c\u4f1a\u9009\u62e9\u67e5\u8be2\u4ee3\u4ef7\u5c0f\u7684\u666e\u901a\u7d22\u5f15\u3002</p> <p>\u5728\u4e0b\u56fe\u4e2d\u6267\u884c\u8ba1\u5212\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff0c\u6267\u884c\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u4e86\u666e\u901a\u7d22\u5f15\uff08name\uff09\uff0cExta \u4e3a Using index\uff0c\u8fd9\u5c31\u662f\u8868\u660e\u4f7f\u7528\u4e86\u8986\u76d6\u7d22\u5f15\u4f18\u5316\u3002</p> <p></p>"},{"location":"mysql/base/how_select/#_6","title":"\u6267\u884c\u5668","text":"<p>\u7ecf\u5386\u5b8c\u4f18\u5316\u5668\u540e\uff0c\u5c31\u786e\u5b9a\u4e86\u6267\u884c\u65b9\u6848\uff0c\u63a5\u4e0b\u6765 MySQL \u5c31\u771f\u6b63\u5f00\u59cb\u6267\u884c\u8bed\u53e5\u4e86\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u662f\u7531\u300c\u6267\u884c\u5668\u300d\u5b8c\u6210\u7684\u3002\u5728\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6267\u884c\u5668\u5c31\u4f1a\u548c\u5b58\u50a8\u5f15\u64ce\u4ea4\u4e92\u4e86\uff0c\u4ea4\u4e92\u662f\u4ee5\u6570\u636e\u884c\u4e3a\u5355\u4f4d\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u7528\u4e09\u79cd\u65b9\u5f0f\u6267\u884c\u8fc7\u7a0b\uff0c\u8ddf\u5927\u5bb6\u8bf4\u4e00\u4e0b\u6267\u884c\u5668\u548c\u5b58\u50a8\u5f15\u64ce\u7684\u4ea4\u4e92\u8fc7\u7a0b\uff08PS\uff1a\u4e3a\u4e86\u5199\u597d\u8fd9\u4e00\u90e8\u5206\uff0c\u7279\u5730\u53bb\u770b MySQL \u6e90\u7801\uff0c\u4e5f\u662f\u7b2c\u4e00\u6b21\u770b\u54c8\u54c8\uff09\u3002</p> <ul> <li>\u4e3b\u952e\u7d22\u5f15\u67e5\u8be2</li> <li>\u5168\u8868\u626b\u63cf</li> <li>\u7d22\u5f15\u4e0b\u63a8</li> </ul>"},{"location":"mysql/base/how_select/#_7","title":"\u4e3b\u952e\u7d22\u5f15\u67e5\u8be2","text":"<p>\u4ee5\u672c\u6587\u5f00\u5934\u67e5\u8be2\u8bed\u53e5\u4e3a\u4f8b\uff0c\u770b\u770b\u6267\u884c\u5668\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002</p> SQL<pre><code>select * from product where id = 1;\n</code></pre> <p>\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u67e5\u8be2\u6761\u4ef6\u7528\u5230\u4e86\u4e3b\u952e\u7d22\u5f15\uff0c\u800c\u4e14\u662f\u7b49\u503c\u67e5\u8be2\uff0c\u540c\u65f6\u4e3b\u952e id \u662f\u552f\u4e00\uff0c\u4e0d\u4f1a\u6709 id \u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4f18\u5316\u5668\u51b3\u5b9a\u9009\u7528\u8bbf\u95ee\u7c7b\u578b\u4e3a const \u8fdb\u884c\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u4e3b\u952e\u7d22\u5f15\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u6267\u884c\u5668\u4e0e\u5b58\u50a8\u5f15\u64ce\u7684\u6267\u884c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>\u6267\u884c\u5668\u7b2c\u4e00\u6b21\u67e5\u8be2\uff0c\u4f1a\u8c03\u7528 read_first_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a const\uff0c\u8fd9\u4e2a\u51fd\u6570\u6307\u9488\u88ab\u6307\u5411\u4e3a InnoDB \u5f15\u64ce\u7d22\u5f15\u67e5\u8be2\u7684\u63a5\u53e3\uff0c\u628a\u6761\u4ef6 <code>id = 1</code> \u4ea4\u7ed9\u5b58\u50a8\u5f15\u64ce\uff0c\u8ba9\u5b58\u50a8\u5f15\u64ce\u5b9a\u4f4d\u7b26\u5408\u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\u3002</li> <li>\u5b58\u50a8\u5f15\u64ce\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u7684 B+ \u6811\u7ed3\u6784\u5b9a\u4f4d\u5230 id = 1 \u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c\u8bb0\u5f55\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u5c31\u4f1a\u5411\u6267\u884c\u5668\u4e0a\u62a5\u8bb0\u5f55\u627e\u4e0d\u5230\u7684\u9519\u8bef\uff0c\u7136\u540e\u67e5\u8be2\u7ed3\u675f\u3002\u5982\u679c\u8bb0\u5f55\u662f\u5b58\u5728\u7684\uff0c\u5c31\u4f1a\u5c06\u8bb0\u5f55\u8fd4\u56de\u7ed9\u6267\u884c\u5668\uff1b</li> <li>\u6267\u884c\u5668\u4ece\u5b58\u50a8\u5f15\u64ce\u8bfb\u5230\u8bb0\u5f55\u540e\uff0c\u63a5\u7740\u5224\u65ad\u8bb0\u5f55\u662f\u5426\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\uff0c\u5982\u679c\u7b26\u5408\u5219\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff0c\u5982\u679c\u4e0d\u7b26\u5408\u5219\u8df3\u8fc7\u8be5\u8bb0\u5f55\u3002</li> <li>\u6267\u884c\u5668\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a while \u5faa\u73af\uff0c\u6240\u4ee5\u8fd8\u4f1a\u518d\u67e5\u4e00\u6b21\uff0c\u4f46\u662f\u8fd9\u6b21\u56e0\u4e3a\u4e0d\u662f\u7b2c\u4e00\u6b21\u67e5\u8be2\u4e86\uff0c\u6240\u4ee5\u4f1a\u8c03\u7528 read_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a const\uff0c\u8fd9\u4e2a\u51fd\u6570\u6307\u9488\u88ab\u6307\u5411\u4e3a\u4e00\u4e2a\u6c38\u8fdc\u8fd4\u56de - 1 \u7684\u51fd\u6570\uff0c\u6240\u4ee5\u5f53\u8c03\u7528\u8be5\u51fd\u6570\u7684\u65f6\u5019\uff0c\u6267\u884c\u5668\u5c31\u9000\u51fa\u5faa\u73af\uff0c\u4e5f\u5c31\u662f\u7ed3\u675f\u67e5\u8be2\u4e86\u3002</li> </ul> <p>\u81f3\u6b64\uff0c\u8fd9\u4e2a\u8bed\u53e5\u5c31\u6267\u884c\u5b8c\u6210\u4e86\u3002</p>"},{"location":"mysql/base/how_select/#_8","title":"\u5168\u8868\u626b\u63cf","text":"<p>\u4e3e\u4e2a\u5168\u8868\u626b\u63cf\u7684\u4f8b\u5b50\uff1a</p> Text Only<pre><code>select * from product where name = 'iphone';\n</code></pre> <p>\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u67e5\u8be2\u6761\u4ef6\u6ca1\u6709\u7528\u5230\u7d22\u5f15\uff0c\u6240\u4ee5\u4f18\u5316\u5668\u51b3\u5b9a\u9009\u7528\u8bbf\u95ee\u7c7b\u578b\u4e3a ALL \u8fdb\u884c\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u67e5\u8be2\uff0c\u90a3\u4e48\u8fd9\u65f6\u6267\u884c\u5668\u4e0e\u5b58\u50a8\u5f15\u64ce\u7684\u6267\u884c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>\u6267\u884c\u5668\u7b2c\u4e00\u6b21\u67e5\u8be2\uff0c\u4f1a\u8c03\u7528 read_first_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a all\uff0c\u8fd9\u4e2a\u51fd\u6570\u6307\u9488\u88ab\u6307\u5411\u4e3a InnoDB \u5f15\u64ce\u5168\u626b\u63cf\u7684\u63a5\u53e3\uff0c\u8ba9\u5b58\u50a8\u5f15\u64ce\u8bfb\u53d6\u8868\u4e2d\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1b</li> <li>\u6267\u884c\u5668\u4f1a\u5224\u65ad\u8bfb\u5230\u7684\u8fd9\u6761\u8bb0\u5f55\u7684 name \u662f\u4e0d\u662f iphone\uff0c\u5982\u679c\u4e0d\u662f\u5219\u8df3\u8fc7\uff1b\u5982\u679c\u662f\u5219\u5c06\u8bb0\u5f55\u53d1\u7ed9\u5ba2\u6237\u7aef\uff08\u662f\u7684\u6ca1\u9519\uff0cServer \u5c42\u6bcf\u4ece\u5b58\u50a8\u5f15\u64ce\u8bfb\u5230\u4e00\u6761\u8bb0\u5f55\u5c31\u4f1a\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff0c\u4e4b\u6240\u4ee5\u5ba2\u6237\u7aef\u663e\u793a\u7684\u65f6\u5019\u662f\u76f4\u63a5\u663e\u793a\u6240\u6709\u8bb0\u5f55\u7684\uff0c\u662f\u56e0\u4e3a\u5ba2\u6237\u7aef\u662f\u7b49\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u5b8c\u6210\u540e\uff0c\u624d\u4f1a\u663e\u793a\u51fa\u6240\u6709\u7684\u8bb0\u5f55\uff09\u3002</li> <li>\u6267\u884c\u5668\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a while \u5faa\u73af\uff0c\u6240\u4ee5\u8fd8\u4f1a\u518d\u67e5\u4e00\u6b21\uff0c\u4f1a\u8c03\u7528 read_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u51fd\u6570\uff0c\u56e0\u4e3a\u4f18\u5316\u5668\u9009\u62e9\u7684\u8bbf\u95ee\u7c7b\u578b\u4e3a all\uff0cread_record \u51fd\u6570\u6307\u9488\u6307\u5411\u7684\u8fd8\u662f InnoDB \u5f15\u64ce\u5168\u626b\u63cf\u7684\u63a5\u53e3\uff0c\u6240\u4ee5\u63a5\u7740\u5411\u5b58\u50a8\u5f15\u64ce\u5c42\u8981\u6c42\u7ee7\u7eed\u8bfb\u521a\u624d\u90a3\u6761\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\uff0c\u5b58\u50a8\u5f15\u64ce\u628a\u4e0b\u4e00\u6761\u8bb0\u5f55\u53d6\u51fa\u540e\u5c31\u5c06\u5176\u8fd4\u56de\u7ed9\u6267\u884c\u5668\uff08Server \u5c42\uff09\uff0c\u6267\u884c\u5668\u7ee7\u7eed\u5224\u65ad\u6761\u4ef6\uff0c\u4e0d\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u5373\u8df3\u8fc7\u8be5\u8bb0\u5f55\uff0c\u5426\u5219\u53d1\u9001\u5230\u5ba2\u6237\u7aef\uff1b</li> <li>\u4e00\u76f4\u91cd\u590d\u4e0a\u8ff0\u8fc7\u7a0b\uff0c\u76f4\u5230\u5b58\u50a8\u5f15\u64ce\u628a\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u8bfb\u5b8c\uff0c\u7136\u540e\u5411\u6267\u884c\u5668\uff08Server \u5c42\uff09\u8fd4\u56de\u4e86\u8bfb\u53d6\u5b8c\u6bd5\u7684\u4fe1\u606f\uff1b</li> <li>\u6267\u884c\u5668\u6536\u5230\u5b58\u50a8\u5f15\u64ce\u62a5\u544a\u7684\u67e5\u8be2\u5b8c\u6bd5\u7684\u4fe1\u606f\uff0c\u9000\u51fa\u5faa\u73af\uff0c\u505c\u6b62\u67e5\u8be2\u3002</li> </ul> <p>\u81f3\u6b64\uff0c\u8fd9\u4e2a\u8bed\u53e5\u5c31\u6267\u884c\u5b8c\u6210\u4e86\u3002</p>"},{"location":"mysql/base/how_select/#_9","title":"\u7d22\u5f15\u4e0b\u63a8","text":"<p>\u5728\u8fd9\u90e8\u5206\u975e\u5e38\u9002\u5408\u8bb2\u7d22\u5f15\u4e0b\u63a8\uff08MySQL 5.6 \u63a8\u51fa\u7684\u67e5\u8be2\u4f18\u5316\u7b56\u7565\uff09\uff0c\u8fd9\u6837\u5927\u5bb6\u80fd\u6e05\u695a\u7684\u77e5\u9053\uff0c\u300c\u4e0b\u63a8\u300d\u8fd9\u4e2a\u52a8\u4f5c\uff0c\u4e0b\u63a8\u5230\u4e86\u54ea\u91cc\u3002</p> <p>\u7d22\u5f15\u4e0b\u63a8\u80fd\u591f\u51cf\u5c11\u4e8c\u7ea7\u7d22\u5f15\u5728\u67e5\u8be2\u65f6\u7684\u56de\u8868\u64cd\u4f5c\uff0c\u63d0\u9ad8\u67e5\u8be2\u7684\u6548\u7387\uff0c\u56e0\u4e3a\u5b83\u5c06 Server \u5c42\u90e8\u5206\u8d1f\u8d23\u7684\u4e8b\u60c5\uff0c\u4ea4\u7ed9\u5b58\u50a8\u5f15\u64ce\u5c42\u53bb\u5904\u7406\u4e86\u3002</p> <p>\u4e3e\u4e00\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff0c\u8fd9\u91cc\u4e00\u5f20\u7528\u6237\u8868\u5982\u4e0b\uff0c\u6211\u5bf9 age \u548c reward \u5b57\u6bb5\u5efa\u7acb\u4e86\u8054\u5408\u7d22\u5f15\uff08age\uff0creward\uff09\uff1a</p> <p></p> <p>\u73b0\u5728\u6709\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a</p> SQL<pre><code>select * from t_user  where age &gt; 20 and reward = 100000;\n</code></pre> <p>\u8054\u5408\u7d22\u5f15\u5f53\u9047\u5230\u8303\u56f4\u67e5\u8be2 (&gt;\u3001&lt;) \u5c31\u4f1a\u505c\u6b62\u5339\u914d\uff0c\u4e5f\u5c31\u662f age \u5b57\u6bb5\u80fd\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f reward \u5b57\u6bb5\u5219\u65e0\u6cd5\u5229\u7528\u5230\u7d22\u5f15\u3002\u5177\u4f53\u539f\u56e0\u8fd9\u91cc\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898</p> <p>\u90a3\u4e48\uff0c\u4e0d\u4f7f\u7528\u7d22\u5f15\u4e0b\u63a8\uff08MySQL 5.6 \u4e4b\u524d\u7684\u7248\u672c\uff09\u65f6\uff0c\u6267\u884c\u5668\u4e0e\u5b58\u50a8\u5f15\u64ce\u7684\u6267\u884c\u6d41\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>Server \u5c42\u9996\u5148\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\u5b9a\u4f4d\u5230\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5b9a\u4f4d\u5230 age &gt; 20 \u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1b</li> <li>\u5b58\u50a8\u5f15\u64ce\u6839\u636e\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u5feb\u901f\u5b9a\u4f4d\u5230\u8fd9\u6761\u8bb0\u5f55\u540e\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\uff0c\u7136\u540e\u8fdb\u884c\u56de\u8868\u64cd\u4f5c\uff0c\u5c06\u5b8c\u6574\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server \u5c42\uff1b</li> <li>Server \u5c42\u5728\u5224\u65ad\u8be5\u8bb0\u5f55\u7684 reward \u662f\u5426\u7b49\u4e8e 100000\uff0c\u5982\u679c\u6210\u7acb\u5219\u5c06\u5176\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff1b\u5426\u5219\u8df3\u8fc7\u8be5\u8bb0\u5f55\uff1b</li> <li>\u63a5\u7740\uff0c\u7ee7\u7eed\u5411\u5b58\u50a8\u5f15\u64ce\u7d22\u8981\u4e0b\u4e00\u6761\u8bb0\u5f55\uff0c\u5b58\u50a8\u5f15\u64ce\u5728\u4e8c\u7ea7\u7d22\u5f15\u5b9a\u4f4d\u5230\u8bb0\u5f55\u540e\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\uff0c\u7136\u540e\u56de\u8868\u64cd\u4f5c\uff0c\u5c06\u5b8c\u6574\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server \u5c42\uff1b</li> <li>\u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u5b58\u50a8\u5f15\u64ce\u628a\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u8bfb\u5b8c\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6ca1\u6709\u7d22\u5f15\u4e0b\u63a8\u7684\u65f6\u5019\uff0c\u6bcf\u67e5\u8be2\u5230\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u90fd\u8981\u8fdb\u884c\u56de\u8868\u64cd\u4f5c\uff0c\u7136\u540e\u5c06\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server\uff0c\u63a5\u7740 Server \u518d\u5224\u65ad\u8be5\u8bb0\u5f55\u7684 reward \u662f\u5426\u7b49\u4e8e 100000\u3002</p> <p>\u800c\u4f7f\u7528\u7d22\u5f15\u4e0b\u63a8\u540e\uff0c\u5224\u65ad\u8bb0\u5f55\u7684 reward \u662f\u5426\u7b49\u4e8e 100000 \u7684\u5de5\u4f5c\u4ea4\u7ed9\u4e86\u5b58\u50a8\u5f15\u64ce\u5c42\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>Server \u5c42\u9996\u5148\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\u5b9a\u4f4d\u5230\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5b9a\u4f4d\u5230 age &gt; 20 \u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1b</li> <li>\u5b58\u50a8\u5f15\u64ce\u5b9a\u4f4d\u5230\u4e8c\u7ea7\u7d22\u5f15\u540e\uff0c\u5148\u4e0d\u6267\u884c\u56de\u8868\u64cd\u4f5c\uff0c\u800c\u662f\u5148\u5224\u65ad\u4e00\u4e0b\u8be5\u7d22\u5f15\u4e2d\u5305\u542b\u7684\u5217\uff08reward \u5217\uff09\u7684\u6761\u4ef6\uff08reward \u662f\u5426\u7b49\u4e8e 100000\uff09\u662f\u5426\u6210\u7acb\u3002\u5982\u679c\u6761\u4ef6\u4e0d\u6210\u7acb\uff0c\u5219\u76f4\u63a5\u8df3\u8fc7\u8be5\u4e8c\u7ea7\u7d22\u5f15\u3002\u5982\u679c\u6210\u7acb\uff0c\u5219\u6267\u884c\u56de\u8868\u64cd\u4f5c\uff0c\u5c06\u5b8c\u6210\u8bb0\u5f55\u8fd4\u56de\u7ed9 Server \u5c42\u3002</li> <li>Server \u5c42\u5728\u5224\u65ad\u5176\u4ed6\u7684\u67e5\u8be2\u6761\u4ef6\uff08\u672c\u6b21\u67e5\u8be2\u6ca1\u6709\u5176\u4ed6\u6761\u4ef6\uff09\u662f\u5426\u6210\u7acb\uff0c\u5982\u679c\u6210\u7acb\u5219\u5c06\u5176\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff1b\u5426\u5219\u8df3\u8fc7\u8be5\u8bb0\u5f55\uff0c\u7136\u540e\u5411\u5b58\u50a8\u5f15\u64ce\u7d22\u8981\u4e0b\u4e00\u6761\u8bb0\u5f55\u3002</li> <li>\u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u5b58\u50a8\u5f15\u64ce\u628a\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u8bfb\u5b8c\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u540e\uff0c\u867d\u7136 reward \u5217\u65e0\u6cd5\u4f7f\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f\u56e0\u4e3a\u5b83\u5305\u542b\u5728\u8054\u5408\u7d22\u5f15\uff08age\uff0creward\uff09\u91cc\uff0c\u6240\u4ee5\u76f4\u63a5\u5728\u5b58\u50a8\u5f15\u64ce\u8fc7\u6ee4\u51fa\u6ee1\u8db3  reward = 100000 \u7684\u8bb0\u5f55\u540e\uff0c\u624d\u53bb\u6267\u884c\u56de\u8868\u64cd\u4f5c\u83b7\u53d6\u6574\u4e2a\u8bb0\u5f55\u3002\u76f8\u6bd4\u4e8e\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\u4e0b\u63a8\uff0c\u8282\u7701\u4e86\u5f88\u591a\u56de\u8868\u64cd\u4f5c\u3002</p> <p>\u5f53\u4f60\u53d1\u73b0\u6267\u884c\u8ba1\u5212\u91cc\u7684 Extra \u90e8\u5206\u663e\u793a\u4e86\u201cUsing index condition\u201d\uff0c\u8bf4\u660e\u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u3002</p> <p></p>"},{"location":"mysql/base/how_select/#_10","title":"\u603b\u7ed3","text":"<p>\u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</p> <ul> <li>\u8fde\u63a5\u5668\uff1a\u5efa\u7acb\u8fde\u63a5\uff0c\u7ba1\u7406\u8fde\u63a5\u3001\u6821\u9a8c\u7528\u6237\u8eab\u4efd\uff1b</li> <li>\u67e5\u8be2\u7f13\u5b58\uff1a\u67e5\u8be2\u8bed\u53e5\u5982\u679c\u547d\u4e2d\u67e5\u8be2\u7f13\u5b58\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5426\u5219\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\u3002MySQL 8.0 \u5df2\u5220\u9664\u8be5\u6a21\u5757\uff1b</li> <li>\u89e3\u6790 SQL\uff0c\u901a\u8fc7\u89e3\u6790\u5668\u5bf9 SQL \u67e5\u8be2\u8bed\u53e5\u8fdb\u884c\u8bcd\u6cd5\u5206\u6790\u3001\u8bed\u6cd5\u5206\u6790\uff0c\u7136\u540e\u6784\u5efa\u8bed\u6cd5\u6811\uff0c\u65b9\u4fbf\u540e\u7eed\u6a21\u5757\u8bfb\u53d6\u8868\u540d\u3001\u5b57\u6bb5\u3001\u8bed\u53e5\u7c7b\u578b\uff1b</li> <li>\u6267\u884c SQL\uff1a\u6267\u884c SQL \u5171\u6709\u4e09\u4e2a\u9636\u6bb5\uff1a</li> <li>\u9884\u5904\u7406\u9636\u6bb5\uff1a\u68c0\u67e5\u8868\u6216\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff1b\u5c06 <code>select *</code> \u4e2d\u7684 <code>*</code> \u7b26\u53f7\u6269\u5c55\u4e3a\u8868\u4e0a\u7684\u6240\u6709\u5217\u3002</li> <li>\u4f18\u5316\u9636\u6bb5\uff1a\u57fa\u4e8e\u67e5\u8be2\u6210\u672c\u7684\u8003\u8651\uff0c\u9009\u62e9\u67e5\u8be2\u6210\u672c\u6700\u5c0f\u7684\u6267\u884c\u8ba1\u5212\uff1b</li> <li>\u6267\u884c\u9636\u6bb5\uff1a\u6839\u636e\u6267\u884c\u8ba1\u5212\u6267\u884c  SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u4ece\u5b58\u50a8\u5f15\u64ce\u8bfb\u53d6\u8bb0\u5f55\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff1b</li> </ul> <p>\u600e\u4e48\u6837\uff1f\u73b0\u5728\u518d\u770b\u8fd9\u5f20\u56fe\uff0c\u662f\u4e0d\u662f\u5f88\u6e05\u6670\u4e86\u3002</p> <p></p> <p>\u5b8c\uff01</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u300aMySQL 45 \u8bb2\u300b</li> <li>\u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\uff1a\u4ece\u6839\u513f\u4e0a\u7406\u89e3 MySQL\u300b</li> <li>http://www.iskm.org/mysql56/sql__executor_8cc_source.html</li> <li>https://tangocc.github.io/2018/10/11/mysql-sourcecode/</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/base/row_format/","title":"MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e4b\u524d\u6709\u4f4d\u8bfb\u8005\u5728\u9762\u5b57\u8282\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a</p> <p></p> <p>\u5982\u679c\u4f60\u77e5\u9053 MySQL \u4e00\u884c\u8bb0\u5f55\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u90a3\u4e48\u8fd9\u4e2a\u95ee\u9898\u5bf9\u4f60\u6ca1\u4ec0\u4e48\u96be\u5ea6\u3002</p> <p>\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u4e5f\u6ca1\u5173\u7cfb\uff0c\u8fd9\u6b21\u6211\u8ddf\u5927\u5bb6\u804a\u804a MySQL \u4e00\u884c\u8bb0\u5f55\u662f\u600e\u4e48\u5b58\u50a8\u7684\uff1f</p> <p>\u77e5\u9053\u4e86\u8fd9\u4e2a\u4e4b\u540e\uff0c\u9664\u4e86\u80fd\u5e94\u89e3\u9501\u524d\u9762\u8fd9\u9053\u9762\u8bd5\u9898\uff0c\u4f60\u8fd8\u4f1a\u89e3\u9501\u8fd9\u4e9b\u9762\u8bd5\u9898\uff1a</p> <ul> <li>MySQL \u7684 NULL \u503c\u4f1a\u5360\u7528\u7a7a\u95f4\u5417\uff1f</li> <li>MySQL \u600e\u4e48\u77e5\u9053 varchar(n) \u5b9e\u9645\u5360\u7528\u6570\u636e\u7684\u5927\u5c0f\uff1f</li> <li>varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f</li> <li>\u884c\u6ea2\u51fa\u540e\uff0cMySQL \u662f\u600e\u4e48\u5904\u7406\u7684\uff1f</li> </ul> <p>\u8fd9\u4e9b\u95ee\u9898\u770b\u4f3c\u6beb\u4e0d\u76f8\u5e72\uff0c\u5176\u5b9e\u90fd\u662f\u5728\u56f4\u7ed5\u300cMySQL \u4e00\u884c\u8bb0\u5f55\u7684\u5b58\u50a8\u7ed3\u6784\u300d\u8fd9\u4e00\u4e2a\u77e5\u8bc6\u70b9\uff0c\u6240\u4ee5\u653b\u7834\u4e86\u8fd9\u4e2a\u77e5\u8bc6\u70b9\u540e\uff0c\u8fd9\u4e9b\u95ee\u9898\u5c31\u5f15\u5203\u800c\u89e3\u4e86\u3002</p> <p>\u597d\u4e86\uff0c\u8bdd\u4e0d\u591a\u8bf4\uff0c\u53d1\u8f66\uff01</p>"},{"location":"mysql/base/row_format/#mysql_1","title":"MySQL \u7684\u6570\u636e\u5b58\u653e\u5728\u54ea\u4e2a\u6587\u4ef6\uff1f","text":"<p>\u5927\u5bb6\u90fd\u77e5\u9053 MySQL \u7684\u6570\u636e\u90fd\u662f\u4fdd\u5b58\u5728\u78c1\u76d8\u7684\uff0c\u90a3\u5177\u4f53\u662f\u4fdd\u5b58\u5728\u54ea\u4e2a\u6587\u4ef6\u5462\uff1f</p> <p>MySQL \u5b58\u50a8\u7684\u884c\u4e3a\u662f\u7531\u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684\uff0cMySQL \u652f\u6301\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u4fdd\u5b58\u7684\u6587\u4ef6\u81ea\u7136\u4e5f\u4e0d\u540c\u3002</p> <p>InnoDB \u662f\u6211\u4eec\u5e38\u7528\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u4e5f\u662f MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u3002\u6240\u4ee5\uff0c\u672c\u6587\u4e3b\u8981\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u5c55\u5f00\u8ba8\u8bba\u3002</p> <p>\u5148\u6765\u770b\u770b MySQL \u6570\u636e\u5e93\u7684\u6587\u4ef6\u5b58\u653e\u5728\u54ea\u4e2a\u76ee\u5f55\uff1f</p> SQL<pre><code>mysql&gt; SHOW VARIABLES LIKE 'datadir';\n+---------------+-----------------+\n| Variable_name | Value           |\n+---------------+-----------------+\n| datadir       | /var/lib/mysql/ |\n+---------------+-----------------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u6211\u4eec\u6bcf\u521b\u5efa\u4e00\u4e2a database\uff08\u6570\u636e\u5e93\uff09\u90fd\u4f1a\u5728 /var/lib/mysql/ \u76ee\u5f55\u91cc\u9762\u521b\u5efa\u4e00\u4e2a\u4ee5 database \u4e3a\u540d\u7684\u76ee\u5f55\uff0c\u7136\u540e\u4fdd\u5b58\u8868\u7ed3\u6784\u548c\u8868\u6570\u636e\u7684\u6587\u4ef6\u90fd\u4f1a\u5b58\u653e\u5728\u8fd9\u4e2a\u76ee\u5f55\u91cc\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u8fd9\u91cc\u6709\u4e00\u4e2a\u540d\u4e3a my_test \u7684 database\uff0c\u8be5 database \u91cc\u6709\u4e00\u5f20\u540d\u4e3a t_order \u6570\u636e\u5e93\u8868\u3002</p> <p></p> <p>\u7136\u540e\uff0c\u6211\u4eec\u8fdb\u5165 /var/lib/mysql/my_test \u76ee\u5f55\uff0c\u770b\u770b\u91cc\u9762\u6709\u4ec0\u4e48\u6587\u4ef6\uff1f</p> Bash<pre><code>[root@xiaolin ~]#ls /var/lib/mysql/my_test\ndb.opt  \nt_order.frm  \nt_order.ibd\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u6709\u4e09\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e09\u4e2a\u6587\u4ef6\u5206\u522b\u4ee3\u8868\u7740\uff1a</p> <ul> <li>db.opt\uff0c\u7528\u6765\u5b58\u50a8\u5f53\u524d\u6570\u636e\u5e93\u7684\u9ed8\u8ba4\u5b57\u7b26\u96c6\u548c\u5b57\u7b26\u6821\u9a8c\u89c4\u5219\u3002</li> <li>t_order.frm\uff0ct_order \u7684\u8868\u7ed3\u6784\u4f1a\u4fdd\u5b58\u5728\u8fd9\u4e2a\u6587\u4ef6\u3002\u5728 MySQL \u4e2d\u5efa\u7acb\u4e00\u5f20\u8868\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a.frm \u6587\u4ef6\uff0c\u8be5\u6587\u4ef6\u662f\u7528\u6765\u4fdd\u5b58\u6bcf\u4e2a\u8868\u7684\u5143\u6570\u636e\u4fe1\u606f\u7684\uff0c\u4e3b\u8981\u5305\u542b\u8868\u7ed3\u6784\u5b9a\u4e49\u3002</li> <li>t_order.ibd\uff0ct_order \u7684\u8868\u6570\u636e\u4f1a\u4fdd\u5b58\u5728\u8fd9\u4e2a\u6587\u4ef6\u3002\u8868\u6570\u636e\u65e2\u53ef\u4ee5\u5b58\u5728\u5171\u4eab\u8868\u7a7a\u95f4\u6587\u4ef6\uff08\u6587\u4ef6\u540d\uff1aibdata1\uff09\u91cc\uff0c\u4e5f\u53ef\u4ee5\u5b58\u653e\u5728\u72ec\u5360\u8868\u7a7a\u95f4\u6587\u4ef6\uff08\u6587\u4ef6\u540d\uff1a\u8868\u540d\u5b57.ibd\uff09\u3002\u8fd9\u4e2a\u884c\u4e3a\u662f\u7531\u53c2\u6570 innodb_file_per_table \u63a7\u5236\u7684\uff0c\u82e5\u8bbe\u7f6e\u4e86\u53c2\u6570 innodb_file_per_table \u4e3a 1\uff0c\u5219\u4f1a\u5c06\u5b58\u50a8\u7684\u6570\u636e\u3001\u7d22\u5f15\u7b49\u4fe1\u606f\u5355\u72ec\u5b58\u50a8\u5728\u4e00\u4e2a\u72ec\u5360\u8868\u7a7a\u95f4\uff0c\u4ece MySQL 5.6.6 \u7248\u672c\u5f00\u59cb\uff0c\u5b83\u7684\u9ed8\u8ba4\u503c\u5c31\u662f 1 \u4e86\uff0c\u56e0\u6b64\u4ece\u8fd9\u4e2a\u7248\u672c\u4e4b\u540e\uff0cMySQL \u4e2d\u6bcf\u4e00\u5f20\u8868\u7684\u6570\u636e\u90fd\u5b58\u653e\u5728\u4e00\u4e2a\u72ec\u7acb\u7684 .ibd \u6587\u4ef6\u3002</li> </ul> <p>\u597d\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e86\u4e00\u5f20\u6570\u636e\u5e93\u8868\u7684\u6570\u636e\u662f\u4fdd\u5b58\u5728\u300c\u8868\u540d\u5b57.ibd\u300d\u7684\u6587\u4ef6\u91cc\u7684\uff0c\u8fd9\u4e2a\u6587\u4ef6\u4e5f\u79f0\u4e3a\u72ec\u5360\u8868\u7a7a\u95f4\u6587\u4ef6\u3002</p>"},{"location":"mysql/base/row_format/#_1","title":"\u8868\u7a7a\u95f4\u6587\u4ef6\u7684\u7ed3\u6784\u662f\u600e\u4e48\u6837\u7684\uff1f","text":"<p>\u8868\u7a7a\u95f4\u7531\u6bb5\uff08segment\uff09\u3001\u533a\uff08extent\uff09\u3001\u9875\uff08page\uff09\u3001\u884c\uff08row\uff09\u7ec4\u6210\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u903b\u8f91\u5b58\u50a8\u7ed3\u6784\u5927\u81f4\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0b\u9762\u6211\u4eec\u4ece\u4e0b\u5f80\u4e0a\u4e00\u4e2a\u4e2a\u770b\u770b\u3002</p>"},{"location":"mysql/base/row_format/#1row","title":"1\u3001\u884c\uff08row\uff09","text":"<p>\u6570\u636e\u5e93\u8868\u4e2d\u7684\u8bb0\u5f55\u90fd\u662f\u6309\u884c\uff08row\uff09\u8fdb\u884c\u5b58\u653e\u7684\uff0c\u6bcf\u884c\u8bb0\u5f55\u6839\u636e\u4e0d\u540c\u7684\u884c\u683c\u5f0f\uff0c\u6709\u4e0d\u540c\u7684\u5b58\u50a8\u7ed3\u6784\u3002</p> <p>\u540e\u9762\u6211\u4eec\u8be6\u7ec6\u4ecb\u7ecd InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u884c\u683c\u5f0f\uff0c\u4e5f\u662f\u672c\u6587\u91cd\u70b9\u4ecb\u7ecd\u7684\u5185\u5bb9\u3002</p>"},{"location":"mysql/base/row_format/#2page","title":"2\u3001\u9875\uff08page\uff09","text":"<p>\u8bb0\u5f55\u662f\u6309\u7167\u884c\u6765\u5b58\u50a8\u7684\uff0c\u4f46\u662f\u6570\u636e\u5e93\u7684\u8bfb\u53d6\u5e76\u4e0d\u4ee5\u300c\u884c\u300d\u4e3a\u5355\u4f4d\uff0c\u5426\u5219\u4e00\u6b21\u8bfb\u53d6\uff08\u4e5f\u5c31\u662f\u4e00\u6b21 I/O \u64cd\u4f5c\uff09\u53ea\u80fd\u5904\u7406\u4e00\u884c\u6570\u636e\uff0c\u6548\u7387\u4f1a\u975e\u5e38\u4f4e\u3002</p> <p>\u56e0\u6b64\uff0cInnoDB \u7684\u6570\u636e\u662f\u6309\u300c\u9875\u300d\u4e3a\u5355\u4f4d\u6765\u8bfb\u5199\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u9700\u8981\u8bfb\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u5c06\u8fd9\u4e2a\u884c\u8bb0\u5f55\u4ece\u78c1\u76d8\u8bfb\u51fa\u6765\uff0c\u800c\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\uff0c\u5c06\u5176\u6574\u4f53\u8bfb\u5165\u5185\u5b58\u3002</p> <p>\u9ed8\u8ba4\u6bcf\u4e2a\u9875\u7684\u5927\u5c0f\u4e3a 16KB\uff0c\u4e5f\u5c31\u662f\u6700\u591a\u80fd\u4fdd\u8bc1 16KB \u7684\u8fde\u7eed\u5b58\u50a8\u7a7a\u95f4\u3002</p> <p>\u9875\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\u78c1\u76d8\u7ba1\u7406\u7684\u6700\u5c0f\u5355\u5143\uff0c\u610f\u5473\u7740\u6570\u636e\u5e93\u6bcf\u6b21\u8bfb\u5199\u90fd\u662f\u4ee5 16KB \u4e3a\u5355\u4f4d\u7684\uff0c\u4e00\u6b21\u6700\u5c11\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6 16K \u7684\u5185\u5bb9\u5230\u5185\u5b58\u4e2d\uff0c\u4e00\u6b21\u6700\u5c11\u628a\u5185\u5b58\u4e2d\u7684 16K \u5185\u5bb9\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u3002</p> <p>\u9875\u7684\u7c7b\u578b\u6709\u5f88\u591a\uff0c\u5e38\u89c1\u7684\u6709\u6570\u636e\u9875\u3001undo \u65e5\u5fd7\u9875\u3001\u6ea2\u51fa\u9875\u7b49\u7b49\u3002\u6570\u636e\u8868\u4e2d\u7684\u884c\u8bb0\u5f55\u662f\u7528\u300c\u6570\u636e\u9875\u300d\u6765\u7ba1\u7406\u7684\uff0c\u6570\u636e\u9875\u7684\u7ed3\u6784\u8fd9\u91cc\u6211\u5c31\u4e0d\u8bb2\u7ec6\u8bf4\u4e86\uff0c\u4e4b\u524d\u6587\u7ae0\u6709\u8bf4\u8fc7\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u53bb\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1a\u6362\u4e00\u4e2a\u89d2\u5ea6\u770b B+ \u6811</p> <p>\u603b\u4e4b\u77e5\u9053\u8868\u4e2d\u7684\u8bb0\u5f55\u5b58\u50a8\u5728\u300c\u6570\u636e\u9875\u300d\u91cc\u9762\u5c31\u884c\u3002</p>"},{"location":"mysql/base/row_format/#3extent","title":"3\u3001\u533a\uff08extent\uff09","text":"<p>\u6211\u4eec\u77e5\u9053 InnoDB \u5b58\u50a8\u5f15\u64ce\u662f\u7528 B+ \u6811\u6765\u7ec4\u7ec7\u6570\u636e\u7684\u3002</p> <p>B+ \u6811\u4e2d\u6bcf\u4e00\u5c42\u90fd\u662f\u901a\u8fc7\u53cc\u5411\u94fe\u8868\u8fde\u63a5\u8d77\u6765\u7684\uff0c\u5982\u679c\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\u6765\u5206\u914d\u5b58\u50a8\u7a7a\u95f4\uff0c\u90a3\u4e48\u94fe\u8868\u4e2d\u76f8\u90bb\u7684\u4e24\u4e2a\u9875\u4e4b\u95f4\u7684\u7269\u7406\u4f4d\u7f6e\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u53ef\u80fd\u79bb\u5f97\u975e\u5e38\u8fdc\uff0c\u90a3\u4e48\u78c1\u76d8\u67e5\u8be2\u65f6\u5c31\u4f1a\u6709\u5927\u91cf\u7684\u968f\u673a I/O\uff0c\u968f\u673a I/O \u662f\u975e\u5e38\u6162\u7684\u3002</p> <p>\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e5f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u8ba9\u94fe\u8868\u4e2d\u76f8\u90bb\u7684\u9875\u7684\u7269\u7406\u4f4d\u7f6e\u4e5f\u76f8\u90bb\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u4f7f\u7528\u987a\u5e8f I/O \u4e86\uff0c\u90a3\u4e48\u5728\u8303\u56f4\u67e5\u8be2\uff08\u626b\u63cf\u53f6\u5b50\u8282\u70b9\uff09\u7684\u65f6\u5019\u6027\u80fd\u5c31\u4f1a\u5f88\u9ad8\u3002</p> <p>\u90a3\u5177\u4f53\u600e\u4e48\u89e3\u51b3\u5462\uff1f</p> <p>\u5728\u8868\u4e2d\u6570\u636e\u91cf\u5927\u7684\u65f6\u5019\uff0c\u4e3a\u67d0\u4e2a\u7d22\u5f15\u5206\u914d\u7a7a\u95f4\u7684\u65f6\u5019\u5c31\u4e0d\u518d\u6309\u7167\u9875\u4e3a\u5355\u4f4d\u5206\u914d\u4e86\uff0c\u800c\u662f\u6309\u7167\u533a\uff08extent\uff09\u4e3a\u5355\u4f4d\u5206\u914d\u3002\u6bcf\u4e2a\u533a\u7684\u5927\u5c0f\u4e3a 1MB\uff0c\u5bf9\u4e8e  16KB \u7684\u9875\u6765\u8bf4\uff0c\u8fde\u7eed\u7684 64 \u4e2a\u9875\u4f1a\u88ab\u5212\u4e3a\u4e00\u4e2a\u533a\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97\u94fe\u8868\u4e2d\u76f8\u90bb\u7684\u9875\u7684\u7269\u7406\u4f4d\u7f6e\u4e5f\u76f8\u90bb\uff0c\u5c31\u80fd\u4f7f\u7528\u987a\u5e8f I/O \u4e86\u3002</p>"},{"location":"mysql/base/row_format/#4segment","title":"4\u3001\u6bb5\uff08segment\uff09","text":"<p>\u8868\u7a7a\u95f4\u662f\u7531\u5404\u4e2a\u6bb5\uff08segment\uff09\u7ec4\u6210\u7684\uff0c\u6bb5\u662f\u7531\u591a\u4e2a\u533a\uff08extent\uff09\u7ec4\u6210\u7684\u3002\u6bb5\u4e00\u822c\u5206\u4e3a\u6570\u636e\u6bb5\u3001\u7d22\u5f15\u6bb5\u548c\u56de\u6eda\u6bb5\u7b49\u3002</p> <ul> <li>\u7d22\u5f15\u6bb5\uff1a\u5b58\u653e B + \u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u7684\u533a\u7684\u96c6\u5408\uff1b</li> <li>\u6570\u636e\u6bb5\uff1a\u5b58\u653e B + \u6811\u7684\u53f6\u5b50\u8282\u70b9\u7684\u533a\u7684\u96c6\u5408\uff1b</li> <li>\u56de\u6eda\u6bb5\uff1a\u5b58\u653e\u7684\u662f\u56de\u6eda\u6570\u636e\u7684\u533a\u7684\u96c6\u5408\uff0c\u4e4b\u524d\u8bb2\u4e8b\u52a1\u9694\u79bb\u7684\u65f6\u5019\u5c31\u4ecb\u7ecd\u5230\u4e86 MVCC \u5229\u7528\u4e86\u56de\u6eda\u6bb5\u5b9e\u73b0\u4e86\u591a\u7248\u672c\u67e5\u8be2\u6570\u636e\u3002</li> </ul> <p>\u597d\u4e86\uff0c\u7ec8\u4e8e\u8bf4\u5b8c\u8868\u7a7a\u95f4\u7684\u7ed3\u6784\u4e86\u3002\u63a5\u4e0b\u6765\uff0c\u5c31\u5177\u4f53\u8bb2\u4e00\u4e0b InnoDB \u7684\u884c\u683c\u5f0f\u4e86\u3002</p> <p>\u4e4b\u6240\u4ee5\u8981\u7ed5\u4e00\u5927\u5708\u624d\u8bb2\u884c\u8bb0\u5f55\u7684\u683c\u5f0f\uff0c\u4e3b\u8981\u662f\u60f3\u8ba9\u5927\u5bb6\u77e5\u9053\u884c\u8bb0\u5f55\u662f\u5b58\u50a8\u5728\u54ea\u4e2a\u6587\u4ef6\uff0c\u4ee5\u53ca\u884c\u8bb0\u5f55\u5728\u8fd9\u4e2a\u8868\u7a7a\u95f4\u6587\u4ef6\u4e2d\u7684\u54ea\u4e2a\u533a\u57df\uff0c\u6709\u4e00\u4e2a\u4ece\u4e0a\u5f80\u4e0b\u5207\u5165\u7684\u89c6\u89d2\uff0c\u8fd9\u6837\u7406\u89e3\u8d77\u6765\u4e0d\u4f1a\u89c9\u5f97\u5f88\u62bd\u8c61\u3002</p>"},{"location":"mysql/base/row_format/#innodb","title":"InnoDB \u884c\u683c\u5f0f\u6709\u54ea\u4e9b\uff1f","text":"<p>\u884c\u683c\u5f0f\uff08row_format\uff09\uff0c\u5c31\u662f\u4e00\u6761\u8bb0\u5f55\u7684\u5b58\u50a8\u7ed3\u6784\u3002</p> <p>InnoDB \u63d0\u4f9b\u4e86 4 \u79cd\u884c\u683c\u5f0f\uff0c\u5206\u522b\u662f Redundant\u3001Compact\u3001Dynamic \u548c Compressed \u884c\u683c\u5f0f\u3002</p> <ul> <li>Redundant \u662f\u5f88\u53e4\u8001\u7684\u884c\u683c\u5f0f\u4e86\uff0cMySQL 5.0 \u7248\u672c\u4e4b\u524d\u7528\u7684\u884c\u683c\u5f0f\uff0c\u73b0\u5728\u57fa\u672c\u6ca1\u4eba\u7528\u4e86\u3002</li> <li>\u7531\u4e8e Redundant \u4e0d\u662f\u4e00\u79cd\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u6240\u4ee5 MySQL 5.0 \u4e4b\u540e\u5f15\u5165\u4e86 Compact \u884c\u8bb0\u5f55\u5b58\u50a8\u65b9\u5f0f\uff0cCompact \u662f\u4e00\u79cd\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u8bbe\u8ba1\u7684\u521d\u8877\u5c31\u662f\u4e3a\u4e86\u8ba9\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u884c\u8bb0\u5f55\uff0c\u4ece MySQL 5.1 \u7248\u672c\u4e4b\u540e\uff0c\u884c\u683c\u5f0f\u9ed8\u8ba4\u8bbe\u7f6e\u6210 Compact\u3002</li> <li>Dynamic \u548c Compressed \u4e24\u4e2a\u90fd\u662f\u7d27\u51d1\u7684\u884c\u683c\u5f0f\uff0c\u5b83\u4eec\u7684\u884c\u683c\u5f0f\u90fd\u548c Compact \u5dee\u4e0d\u591a\uff0c\u56e0\u4e3a\u90fd\u662f\u57fa\u4e8e Compact \u6539\u8fdb\u4e00\u70b9\u4e1c\u897f\u3002\u4ece MySQL5.7 \u7248\u672c\u4e4b\u540e\uff0c\u9ed8\u8ba4\u4f7f\u7528 Dynamic \u884c\u683c\u5f0f\u3002</li> </ul> <p>Redundant \u884c\u683c\u5f0f\u6211\u8fd9\u91cc\u5c31\u4e0d\u8bb2\u4e86\uff0c\u56e0\u4e3a\u73b0\u5728\u57fa\u672c\u6ca1\u4eba\u7528\u4e86\uff0c\u8fd9\u6b21\u91cd\u70b9\u4ecb\u7ecd Compact \u884c\u683c\u5f0f\uff0c\u56e0\u4e3a Dynamic \u548c Compressed \u8fd9\u4e24\u4e2a\u884c\u683c\u5f0f\u8ddf Compact \u975e\u5e38\u50cf\u3002</p> <p>\u6240\u4ee5\uff0c\u5f04\u61c2\u4e86 Compact \u884c\u683c\u5f0f\uff0c\u4e4b\u540e\u4f60\u4eec\u5728\u53bb\u4e86\u89e3\u5176\u4ed6\u884c\u683c\u5f0f\uff0c\u5f88\u5feb\u4e5f\u80fd\u770b\u61c2\u3002</p>"},{"location":"mysql/base/row_format/#compact","title":"COMPACT \u884c\u683c\u5f0f\u957f\u4ec0\u4e48\u6837\uff1f","text":"<p>\u5148\u8ddf Compact \u884c\u683c\u5f0f\u6df7\u4e2a\u8138\u719f\uff0c\u5b83\u957f\u8fd9\u6837\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u6761\u5b8c\u6574\u7684\u8bb0\u5f55\u5206\u4e3a\u300c\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f\u300d\u548c\u300c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u300d\u4e24\u4e2a\u90e8\u5206\u3002</p> <p>\u63a5\u4e0b\u91cc\uff0c\u5206\u522b\u8be6\u7ec6\u8bf4\u4e0b\u3002</p>"},{"location":"mysql/base/row_format/#_2","title":"\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f","text":"<p>\u8bb0\u5f55\u7684\u989d\u5916\u4fe1\u606f\u5305\u542b 3 \u4e2a\u90e8\u5206\uff1a\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u3001NULL \u503c\u5217\u8868\u3001\u8bb0\u5f55\u5934\u4fe1\u606f\u3002</p>"},{"location":"mysql/base/row_format/#1","title":"1. \u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868","text":"<p>varchar(n) \u548c char(n) \u7684\u533a\u522b\u662f\u4ec0\u4e48\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u975e\u5e38\u6e05\u695a\uff0cchar \u662f\u5b9a\u957f\u7684\uff0cvarchar \u662f\u53d8\u957f\u7684\uff0c\u53d8\u957f\u5b57\u6bb5\u5b9e\u9645\u5b58\u50a8\u7684\u6570\u636e\u7684\u957f\u5ea6\uff08\u5927\u5c0f\uff09\u4e0d\u56fa\u5b9a\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u5b58\u50a8\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e5f\u8981\u628a\u6570\u636e\u5360\u7528\u7684\u5927\u5c0f\u5b58\u8d77\u6765\uff0c\u5b58\u5230\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u9762\uff0c\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\u624d\u80fd\u6839\u636e\u8fd9\u4e2a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u53bb\u8bfb\u53d6\u5bf9\u5e94\u957f\u5ea6\u7684\u6570\u636e\u3002\u5176\u4ed6 TEXT\u3001BLOB \u7b49\u53d8\u957f\u5b57\u6bb5\u4e5f\u662f\u8fd9\u4e48\u5b9e\u73b0\u7684\u3002</p> <p>\u4e3a\u4e86\u5c55\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u5177\u4f53\u662f\u600e\u4e48\u4fdd\u5b58\u300c\u53d8\u957f\u5b57\u6bb5\u7684\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u300d\uff0c\u6211\u4eec\u5148\u521b\u5efa\u8fd9\u6837\u4e00\u5f20\u8868\uff0c\u5b57\u7b26\u96c6\u662f ascii\uff08\u6240\u4ee5\u6bcf\u4e00\u4e2a\u5b57\u7b26\u5360\u7528\u7684 1 \u5b57\u8282\uff09\uff0c\u884c\u683c\u5f0f\u662f Compact\uff0ct_user \u8868\u4e2d name \u548c phone \u5b57\u6bb5\u90fd\u662f\u53d8\u957f\u5b57\u6bb5\uff1a</p> SQL<pre><code>CREATE TABLE `t_user` (\n  `id` int(11) NOT NULL,\n  `name` VARCHAR(20) DEFAULT NULL,\n  `phone` VARCHAR(20) DEFAULT NULL,\n  `age` int(11) DEFAULT NULL,\n  PRIMARY KEY (`id`) USING BTREE\n) ENGINE = InnoDB DEFAULT CHARACTER SET = ascii ROW_FORMAT = COMPACT;\n</code></pre> <p>\u73b0\u5728 t_user \u8868\u91cc\u6709\u8fd9\u4e09\u6761\u8bb0\u5f55\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u770b\u770b\u770b\u8fd9\u4e09\u6761\u8bb0\u5f55\u7684\u884c\u683c\u5f0f\u4e2d\u7684\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u662f\u600e\u6837\u5b58\u50a8\u7684\u3002</p> <p>\u5148\u6765\u770b\u7b2c\u4e00\u6761\u8bb0\u5f55\uff1a</p> <ul> <li>name \u5217\u7684\u503c\u4e3a a\uff0c\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u662f 1 \u5b57\u8282\uff0c\u5341\u516d\u8fdb\u5236 0x01\uff1b</li> <li>phone \u5217\u7684\u503c\u4e3a 123\uff0c\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u662f 3 \u5b57\u8282\uff0c\u5341\u516d\u8fdb\u5236 0x03\uff1b</li> <li>age \u5217\u548c id \u5217\u4e0d\u662f\u53d8\u957f\u5b57\u6bb5\uff0c\u6240\u4ee5\u8fd9\u91cc\u4e0d\u7528\u7ba1\u3002</li> </ul> <p>\u8fd9\u4e9b\u53d8\u957f\u5b57\u6bb5\u7684\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570\u4f1a\u6309\u7167\u5217\u7684\u987a\u5e8f\u9006\u5e8f\u5b58\u653e\uff08\u7b49\u4e0b\u4f1a\u8bf4\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1\uff09\uff0c\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u7684\u5185\u5bb9\u662f\u300c03 01\u300d\uff0c\u800c\u4e0d\u662f\u300c01 03\u300d\u3002</p> <p></p> <p>\u540c\u6837\u7684\u9053\u7406\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f97\u51fa\u7b2c\u4e8c\u6761\u8bb0\u5f55\u7684\u884c\u683c\u5f0f\u4e2d\uff0c\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u7684\u5185\u5bb9\u662f\u300c04 02\u300d\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u7b2c\u4e09\u6761\u8bb0\u5f55\u4e2d phone \u5217\u7684\u503c\u662f NULL\uff0cNULL \u662f\u4e0d\u4f1a\u5b58\u653e\u5728\u884c\u683c\u5f0f\u4e2d\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u90e8\u5206\u91cc\u7684\uff0c\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u91cc\u4e0d\u9700\u8981\u4fdd\u5b58\u503c\u4e3a  NULL \u7684\u53d8\u957f\u5b57\u6bb5\u7684\u957f\u5ea6\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u7684\u4fe1\u606f\u8981\u6309\u7167\u9006\u5e8f\u5b58\u653e\uff1f</p> <p>\u8fd9\u4e2a\u8bbe\u8ba1\u662f\u6709\u60f3\u6cd5\u7684\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u300c\u8bb0\u5f55\u5934\u4fe1\u606f\u300d\u4e2d\u6307\u5411\u4e0b\u4e00\u4e2a\u8bb0\u5f55\u7684\u6307\u9488\uff0c\u6307\u5411\u7684\u662f\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u300c\u8bb0\u5f55\u5934\u4fe1\u606f\u300d\u548c\u300c\u771f\u5b9e\u6570\u636e\u300d\u4e4b\u95f4\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u5411\u5de6\u8bfb\u5c31\u662f\u8bb0\u5f55\u5934\u4fe1\u606f\uff0c\u5411\u53f3\u8bfb\u5c31\u662f\u771f\u5b9e\u6570\u636e\uff0c\u6bd4\u8f83\u65b9\u4fbf\u3002</p> <p>\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u4e2d\u7684\u4fe1\u606f\u4e4b\u6240\u4ee5\u8981\u9006\u5e8f\u5b58\u653e\uff0c\u662f\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u4f4d\u7f6e\u9760\u524d\u7684\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u548c\u6570\u636e\u5bf9\u5e94\u7684\u5b57\u6bb5\u957f\u5ea6\u4fe1\u606f\u53ef\u4ee5\u540c\u65f6\u5728\u4e00\u4e2a CPU Cache Line \u4e2d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u63d0\u9ad8 CPU Cache \u7684\u547d\u4e2d\u7387\u3002</p> <p>\u540c\u6837\u7684\u9053\u7406\uff0cNULL \u503c\u5217\u8868\u7684\u4fe1\u606f\u4e5f\u9700\u8981\u9006\u5e8f\u5b58\u653e\u3002</p> <p>\u5982\u679c\u4f60\u4e0d\u77e5\u9053\u4ec0\u4e48\u662f CPU Cache\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\u6587\u7ae0\uff0c\u8fd9\u5c5e\u4e8e\u8ba1\u7b97\u673a\u7ec4\u6210\u7684\u77e5\u8bc6\u3002</p> <p>\u6bcf\u4e2a\u6570\u636e\u5e93\u8868\u7684\u884c\u683c\u5f0f\u90fd\u6709\u300c\u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u300d\u5417\uff1f</p> <p>\u5176\u5b9e\u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u4e0d\u662f\u5fc5\u987b\u7684\u3002</p> <p>\u5f53\u6570\u636e\u8868\u6ca1\u6709\u53d8\u957f\u5b57\u6bb5\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u5168\u90e8\u90fd\u662f int \u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u8fd9\u65f6\u5019\u8868\u91cc\u7684\u884c\u683c\u5f0f\u5c31\u4e0d\u4f1a\u6709\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u4e86\uff0c\u56e0\u4e3a\u6ca1\u5fc5\u8981\uff0c\u4e0d\u5982\u53bb\u6389\u4ee5\u8282\u7701\u7a7a\u95f4\u3002</p> <p>\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u53ea\u51fa\u73b0\u5728\u6570\u636e\u8868\u6709\u53d8\u957f\u5b57\u6bb5\u7684\u65f6\u5019\u3002</p>"},{"location":"mysql/base/row_format/#2-null","title":"2. NULL \u503c\u5217\u8868","text":"<p>\u8868\u4e2d\u7684\u67d0\u4e9b\u5217\u53ef\u80fd\u4f1a\u5b58\u50a8 NULL \u503c\uff0c\u5982\u679c\u628a\u8fd9\u4e9b NULL \u503c\u90fd\u653e\u5230\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u4e2d\u4f1a\u6bd4\u8f83\u6d6a\u8d39\u7a7a\u95f4\uff0c\u6240\u4ee5 Compact \u884c\u683c\u5f0f\u628a\u8fd9\u4e9b\u503c\u4e3a NULL \u7684\u5217\u5b58\u50a8\u5230 NULL \u503c\u5217\u8868\u4e2d\u3002</p> <p>\u5982\u679c\u5b58\u5728\u5141\u8bb8 NULL \u503c\u7684\u5217\uff0c\u5219\u6bcf\u4e2a\u5217\u5bf9\u5e94\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4f4d\uff08bit\uff09\uff0c\u4e8c\u8fdb\u5236\u4f4d\u6309\u7167\u5217\u7684\u987a\u5e8f\u9006\u5e8f\u6392\u5217\u3002</p> <ul> <li>\u4e8c\u8fdb\u5236\u4f4d\u7684\u503c\u4e3a<code>1</code>\u65f6\uff0c\u4ee3\u8868\u8be5\u5217\u7684\u503c\u4e3a NULL\u3002</li> <li>\u4e8c\u8fdb\u5236\u4f4d\u7684\u503c\u4e3a<code>0</code>\u65f6\uff0c\u4ee3\u8868\u8be5\u5217\u7684\u503c\u4e0d\u4e3a NULL\u3002</li> </ul> <p>\u53e6\u5916\uff0cNULL \u503c\u5217\u8868\u5fc5\u987b\u7528\u6574\u6570\u4e2a\u5b57\u8282\u7684\u4f4d\u8868\u793a\uff081 \u5b57\u8282 8 \u4f4d\uff09\uff0c\u5982\u679c\u4f7f\u7528\u7684\u4e8c\u8fdb\u5236\u4f4d\u4e2a\u6570\u4e0d\u8db3\u6574\u6570\u4e2a\u5b57\u8282\uff0c\u5219\u5728\u5b57\u8282\u7684\u9ad8\u4f4d\u8865 <code>0</code>\u3002</p> <p>\u8fd8\u662f\u4ee5 t_user \u8868\u7684\u8fd9\u4e09\u6761\u8bb0\u5f55\u4f5c\u4e3a\u4f8b\u5b50\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u770b\u770b\u770b\u8fd9\u4e09\u6761\u8bb0\u5f55\u7684\u884c\u683c\u5f0f\u4e2d\u7684 NULL \u503c\u5217\u8868\u662f\u600e\u6837\u5b58\u50a8\u7684\u3002</p> <p>\u5148\u6765\u770b\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7b2c\u4e00\u6761\u8bb0\u5f55\u6240\u6709\u5217\u90fd\u6709\u503c\uff0c\u4e0d\u5b58\u5728 NULL \u503c\uff0c\u6240\u4ee5\u7528\u4e8c\u8fdb\u5236\u6765\u8868\u793a\u662f\u9171\u7d2b\u7684\uff1a</p> <p></p> <p>\u4f46\u662f InnoDB \u662f\u7528\u6574\u6570\u5b57\u8282\u7684\u4e8c\u8fdb\u5236\u4f4d\u6765\u8868\u793a NULL \u503c\u5217\u8868\u7684\uff0c\u73b0\u5728\u4e0d\u8db3 8 \u4f4d\uff0c\u6240\u4ee5\u8981\u5728\u9ad8\u4f4d\u8865 0\uff0c\u6700\u7ec8\u7528\u4e8c\u8fdb\u5236\u6765\u8868\u793a\u662f\u9171\u7d2b\u7684\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e00\u6761\u6570\u636e\uff0cNULL \u503c\u5217\u8868\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\u662f 0x00\u3002</p> <p>\u63a5\u4e0b\u6765\u770b\u7b2c\u4e8c\u6761\u8bb0\u5f55\uff0c\u7b2c\u4e8c\u6761\u8bb0\u5f55 age \u5217\u662f NULL \u503c\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e8c\u6761\u6570\u636e\uff0cNULL \u503c\u5217\u8868\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\u662f 0x04\u3002</p> <p></p> <p>\u6700\u540e\u7b2c\u4e09\u6761\u8bb0\u5f55\uff0c\u7b2c\u4e09\u6761\u8bb0\u5f55 phone \u5217 \u548c age \u5217\u662f NULL \u503c\uff0c\u6240\u4ee5\uff0c\u5bf9\u4e8e\u7b2c\u4e09\u6761\u6570\u636e\uff0cNULL \u503c\u5217\u8868\u7528\u5341\u516d\u8fdb\u5236\u8868\u793a\u662f 0x06\u3002</p> <p></p> <p>\u6211\u4eec\u628a\u4e09\u6761\u8bb0\u5f55\u7684 NULL \u503c\u5217\u8868\u90fd\u586b\u5145\u5b8c\u6bd5\u540e\uff0c\u5b83\u4eec\u7684\u884c\u683c\u5f0f\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u6bcf\u4e2a\u6570\u636e\u5e93\u8868\u7684\u884c\u683c\u5f0f\u90fd\u6709\u300cNULL \u503c\u5217\u8868\u300d\u5417\uff1f</p> <p>NULL \u503c\u5217\u8868\u4e5f\u4e0d\u662f\u5fc5\u987b\u7684\u3002</p> <p>\u5f53\u6570\u636e\u8868\u7684\u5b57\u6bb5\u90fd\u5b9a\u4e49\u6210 NOT NULL \u7684\u65f6\u5019\uff0c\u8fd9\u65f6\u5019\u8868\u91cc\u7684\u884c\u683c\u5f0f\u5c31\u4e0d\u4f1a\u6709 NULL \u503c\u5217\u8868\u4e86\u3002</p> <p>\u6240\u4ee5\u5728\u8bbe\u8ba1\u6570\u636e\u5e93\u8868\u7684\u65f6\u5019\uff0c\u901a\u5e38\u90fd\u662f\u5efa\u8bae\u5c06\u5b57\u6bb5\u8bbe\u7f6e\u4e3a  NOT NULL\uff0c\u8fd9\u6837\u53ef\u4ee5\u81f3\u5c11\u8282\u7701 1 \u5b57\u8282\u7684\u7a7a\u95f4\uff08NULL \u503c\u5217\u8868\u81f3\u5c11\u5360\u7528 1 \u5b57\u8282\u7a7a\u95f4\uff09\u3002</p> <p>\u300cNULL \u503c\u5217\u8868\u300d\u662f\u56fa\u5b9a 1 \u5b57\u8282\u7a7a\u95f4\u5417\uff1f\u5982\u679c\u8fd9\u6837\u7684\u8bdd\uff0c\u4e00\u6761\u8bb0\u5f55\u6709 9 \u4e2a\u5b57\u6bb5\u503c\u90fd\u662f NULL\uff0c\u8fd9\u65f6\u5019\u600e\u4e48\u8868\u793a\uff1f</p> <p>\u300cNULL \u503c\u5217\u8868\u300d\u7684\u7a7a\u95f4\u4e0d\u662f\u56fa\u5b9a 1 \u5b57\u8282\u7684\u3002</p> <p>\u5f53\u4e00\u6761\u8bb0\u5f55\u6709 9 \u4e2a\u5b57\u6bb5\u503c\u90fd\u662f NULL\uff0c\u90a3\u4e48\u5c31\u4f1a\u521b\u5efa 2 \u5b57\u8282\u7a7a\u95f4\u7684\u300cNULL \u503c\u5217\u8868\u300d\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002</p>"},{"location":"mysql/base/row_format/#3","title":"3. \u8bb0\u5f55\u5934\u4fe1\u606f","text":"<p>\u8bb0\u5f55\u5934\u4fe1\u606f\u4e2d\u5305\u542b\u7684\u5185\u5bb9\u5f88\u591a\uff0c\u6211\u5c31\u4e0d\u4e00\u4e00\u5217\u4e3e\u4e86\uff0c\u8fd9\u91cc\u8bf4\u51e0\u4e2a\u6bd4\u8f83\u91cd\u8981\u7684\uff1a</p> <ul> <li>delete_mask\uff1a\u6807\u8bc6\u6b64\u6761\u6570\u636e\u662f\u5426\u88ab\u5220\u9664\u3002\u4ece\u8fd9\u91cc\u53ef\u4ee5\u77e5\u9053\uff0c\u6211\u4eec\u6267\u884c detele \u5220\u9664\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u771f\u6b63\u7684\u5220\u9664\u8bb0\u5f55\uff0c\u53ea\u662f\u5c06\u8fd9\u4e2a\u8bb0\u5f55\u7684 delete_mask \u6807\u8bb0\u4e3a 1\u3002</li> <li>next_record\uff1a\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u4f4d\u7f6e\u3002\u4ece\u8fd9\u91cc\u53ef\u4ee5\u77e5\u9053\uff0c\u8bb0\u5f55\u4e0e\u8bb0\u5f55\u4e4b\u95f4\u662f\u901a\u8fc7\u94fe\u8868\u7ec4\u7ec7\u7684\u3002\u5728\u524d\u9762\u6211\u4e5f\u63d0\u5230\u4e86\uff0c\u6307\u5411\u7684\u662f\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u300c\u8bb0\u5f55\u5934\u4fe1\u606f\u300d\u548c\u300c\u771f\u5b9e\u6570\u636e\u300d\u4e4b\u95f4\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u5411\u5de6\u8bfb\u5c31\u662f\u8bb0\u5f55\u5934\u4fe1\u606f\uff0c\u5411\u53f3\u8bfb\u5c31\u662f\u771f\u5b9e\u6570\u636e\uff0c\u6bd4\u8f83\u65b9\u4fbf\u3002</li> <li>record_type\uff1a\u8868\u793a\u5f53\u524d\u8bb0\u5f55\u7684\u7c7b\u578b\uff0c0 \u8868\u793a\u666e\u901a\u8bb0\u5f55\uff0c1 \u8868\u793a B+\u6811\u975e\u53f6\u5b50\u8282\u70b9\u8bb0\u5f55\uff0c2 \u8868\u793a\u6700\u5c0f\u8bb0\u5f55\uff0c3 \u8868\u793a\u6700\u5927\u8bb0\u5f55</li> </ul>"},{"location":"mysql/base/row_format/#_3","title":"\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e","text":"<p>\u8bb0\u5f55\u771f\u5b9e\u6570\u636e\u90e8\u5206\u9664\u4e86\u6211\u4eec\u5b9a\u4e49\u7684\u5b57\u6bb5\uff0c\u8fd8\u6709\u4e09\u4e2a\u9690\u85cf\u5b57\u6bb5\uff0c\u5206\u522b\u4e3a\uff1arow_id\u3001trx_id\u3001roll_pointer\uff0c\u6211\u4eec\u6765\u770b\u4e0b\u8fd9\u4e09\u4e2a\u5b57\u6bb5\u662f\u4ec0\u4e48\u3002</p> <p></p> <ul> <li>row_id</li> </ul> <p>\u5982\u679c\u6211\u4eec\u5efa\u8868\u7684\u65f6\u5019\u6307\u5b9a\u4e86\u4e3b\u952e\u6216\u8005\u552f\u4e00\u7ea6\u675f\u5217\uff0c\u90a3\u4e48\u5c31\u6ca1\u6709 row_id \u9690\u85cf\u5b57\u6bb5\u4e86\u3002\u5982\u679c\u65e2\u6ca1\u6709\u6307\u5b9a\u4e3b\u952e\uff0c\u53c8\u6ca1\u6709\u552f\u4e00\u7ea6\u675f\uff0c\u90a3\u4e48 InnoDB \u5c31\u4f1a\u4e3a\u8bb0\u5f55\u6dfb\u52a0 row_id \u9690\u85cf\u5b57\u6bb5\u3002row_id \u4e0d\u662f\u5fc5\u9700\u7684\uff0c\u5360\u7528 6 \u4e2a\u5b57\u8282\u3002</p> <ul> <li>trx_id</li> </ul> <p>\u4e8b\u52a1 id\uff0c\u8868\u793a\u8fd9\u4e2a\u6570\u636e\u662f\u7531\u54ea\u4e2a\u4e8b\u52a1\u751f\u6210\u7684\u3002trx_id \u662f\u5fc5\u9700\u7684\uff0c\u5360\u7528 6 \u4e2a\u5b57\u8282\u3002</p> <ul> <li>roll_pointer</li> </ul> <p>\u8fd9\u6761\u8bb0\u5f55\u4e0a\u4e00\u4e2a\u7248\u672c\u7684\u6307\u9488\u3002roll_pointer \u662f\u5fc5\u9700\u7684\uff0c\u5360\u7528 7 \u4e2a\u5b57\u8282\u3002</p> <p>\u5982\u679c\u4f60\u719f\u6089 MVCC \u673a\u5236\uff0c\u4f60\u5e94\u8be5\u5c31\u6e05\u695a trx_id \u548c roll_pointer \u7684\u4f5c\u7528\u4e86\uff0c\u5982\u679c\u4f60\u8fd8\u4e0d\u77e5\u9053 MVCC \u673a\u5236\uff0c\u53ef\u4ee5\u770b\u5b8c\u8fd9\u7bc7\u6587\u7ae0\uff0c\u4e00\u5b9a\u8981\u638c\u63e1\uff0c\u9762\u8bd5\u4e5f\u5f88\u7ecf\u5e38\u95ee MVCC \u662f\u600e\u4e48\u5b9e\u73b0\u7684\u3002</p>"},{"location":"mysql/base/row_format/#varcharn-n","title":"varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f","text":"<p>\u6211\u4eec\u8981\u6e05\u695a\u4e00\u70b9\uff0cMySQL \u89c4\u5b9a\u9664\u4e86 TEXT\u3001BLOBs \u8fd9\u79cd\u5927\u5bf9\u8c61\u7c7b\u578b\u4e4b\u5916\uff0c\u5176\u4ed6\u6240\u6709\u7684\u5217\uff08\u4e0d\u5305\u62ec\u9690\u85cf\u5217\u548c\u8bb0\u5f55\u5934\u4fe1\u606f\uff09\u5360\u7528\u7684\u5b57\u8282\u957f\u5ea6\u52a0\u8d77\u6765\u4e0d\u80fd\u8d85\u8fc7 65535 \u4e2a\u5b57\u8282\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u884c\u8bb0\u5f55\u9664\u4e86 TEXT\u3001BLOBs \u7c7b\u578b\u7684\u5217\uff0c\u9650\u5236\u6700\u5927\u4e3a 65535 \u5b57\u8282\uff0c\u6ce8\u610f\u662f\u4e00\u884c\u7684\u603b\u957f\u5ea6\uff0c\u4e0d\u662f\u4e00\u5217\u3002</p> <p>\u77e5\u9053\u4e86\u8fd9\u4e2a\u524d\u63d0\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u8fd9\u4e2a\u95ee\u9898\uff1a\u300cvarchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f\u300d</p> <p>varchar(n) \u5b57\u6bb5\u7c7b\u578b\u7684 n \u4ee3\u8868\u7684\u662f\u6700\u591a\u5b58\u50a8\u7684\u5b57\u7b26\u6570\u91cf\uff0c\u5e76\u4e0d\u662f\u5b57\u8282\u5927\u5c0f\u54e6\u3002</p> <p>\u8981\u7b97 varchar(n) \u6700\u5927\u80fd\u5141\u8bb8\u5b58\u50a8\u7684\u5b57\u8282\u6570\uff0c\u8fd8\u8981\u770b\u6570\u636e\u5e93\u8868\u7684\u5b57\u7b26\u96c6\uff0c\u56e0\u4e3a\u5b57\u7b26\u96c6\u4ee3\u8868\u7740\uff0c1 \u4e2a\u5b57\u7b26\u8981\u5360\u7528\u591a\u5c11\u5b57\u8282\uff0c\u6bd4\u5982 ascii \u5b57\u7b26\u96c6\uff0c1 \u4e2a\u5b57\u7b26\u5360\u7528 1 \u5b57\u8282\uff0c\u90a3\u4e48  varchar(100) \u610f\u5473\u7740\u6700\u5927\u80fd\u5141\u8bb8\u5b58\u50a8 100 \u5b57\u8282\u7684\u6570\u636e\u3002</p>"},{"location":"mysql/base/row_format/#_4","title":"\u5355\u5b57\u6bb5\u7684\u60c5\u51b5","text":"<p>\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u4e00\u884c\u8bb0\u5f55\u6700\u5927\u53ea\u80fd\u5b58\u50a8 65535 \u5b57\u8282\u7684\u6570\u636e\u3002</p> <p>\u90a3\u5047\u8bbe\u6570\u636e\u5e93\u8868\u53ea\u6709\u4e00\u4e2a varchar(n) \u7c7b\u578b\u7684\u5217\u4e14\u5b57\u7b26\u96c6\u662f ascii\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cvarchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u662f 65535 \u5417\uff1f</p> <p>\u4e0d\u7740\u6025\u8bf4\u7ed3\u8bba\uff0c\u6211\u4eec\u5148\u6765\u505a\u4e2a\u5b9e\u9a8c\u9a8c\u8bc1\u4e00\u4e0b\u3002</p> <p>\u6211\u4eec\u5b9a\u4e49\u4e00\u4e2a varchar(65535) \u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u5b57\u7b26\u96c6\u4e3a ascii \u7684\u6570\u636e\u5e93\u8868\u3002</p> SQL<pre><code>CREATE TABLE test ( \n`name` VARCHAR(65535)  NULL\n) ENGINE = InnoDB DEFAULT CHARACTER SET = ascii ROW_FORMAT = COMPACT;\n</code></pre> <p>\u770b\u80fd\u4e0d\u80fd\u6210\u529f\u521b\u5efa\u4e00\u5f20\u8868\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u521b\u5efa\u5931\u8d25\u4e86\u3002</p> <p>\u4ece\u62a5\u9519\u4fe1\u606f\u5c31\u53ef\u4ee5\u77e5\u9053\u4e00\u884c\u6570\u636e\u7684\u6700\u5927\u5b57\u8282\u6570\u662f 65535\uff08\u4e0d\u5305\u542b TEXT\u3001BLOBs \u8fd9\u79cd\u5927\u5bf9\u8c61\u7c7b\u578b\uff09\uff0c\u5176\u4e2d\u5305\u542b\u4e86 storage overhead\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u8fd9\u4e2a storage overhead \u662f\u4ec0\u4e48\u5462\uff1f\u5176\u5b9e\u5c31\u662f\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c\u300cNULL \u503c\u5217\u8868\u300d\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u884c\u6570\u636e\u7684\u6700\u5927\u5b57\u8282\u6570 65535\uff0c\u5176\u5b9e\u662f\u5305\u542b\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c\u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u7684\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb storage overhead  \u5360\u7528\u7684\u5b57\u8282\u6570\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u6211\u4eec\u5b58\u50a8\u5b57\u6bb5\u7c7b\u578b\u4e3a varchar(n)  \u7684\u6570\u636e\u65f6\uff0c\u5176\u5b9e\u5206\u6210\u4e86\u4e09\u4e2a\u90e8\u5206\u6765\u5b58\u50a8\uff1a</p> <ul> <li>\u771f\u5b9e\u6570\u636e</li> <li>\u771f\u5b9e\u6570\u636e\u5360\u7528\u7684\u5b57\u8282\u6570</li> <li>NULL \u6807\u8bc6\uff0c\u5982\u679c\u4e0d\u5141\u8bb8\u4e3a NULL\uff0c\u8fd9\u90e8\u5206\u4e0d\u9700\u8981</li> </ul> <p>\u672c\u6b21\u6848\u4f8b\u4e2d\uff0c\u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u591a\u5c11\uff1f</p> <p>\u524d\u9762\u6211\u521b\u5efa\u8868\u7684\u65f6\u5019\uff0c\u5b57\u6bb5\u662f\u5141\u8bb8\u4e3a NULL \u7684\uff0c\u6240\u4ee5\u4f1a\u7528 1 \u5b57\u8282\u6765\u8868\u793a\u300cNULL \u503c\u5217\u8868\u300d\u3002</p> <p>\u672c\u6b21\u6848\u4f8b\u4e2d\uff0c\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u591a\u5c11\uff1f</p> <p>\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 = \u6240\u6709\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u5360\u7528\u7684\u5b57\u8282\u6570\u4e4b\u548c\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u5148\u77e5\u9053\u6bcf\u4e2a\u53d8\u957f\u5b57\u6bb5\u7684\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u9700\u8981\u7528\u591a\u5c11\u5b57\u8282\u8868\u793a\uff1f\u5177\u4f53\u60c5\u51b5\u5206\u4e3a\uff1a</p> <ul> <li>\u6761\u4ef6\u4e00\uff1a\u5982\u679c\u53d8\u957f\u5b57\u6bb5\u5141\u8bb8\u5b58\u50a8\u7684\u6700\u5927\u5b57\u8282\u6570\u5c0f\u4e8e\u7b49\u4e8e 255 \u5b57\u8282\uff0c\u5c31\u4f1a\u7528 1 \u5b57\u8282\u8868\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\uff1b</li> <li>\u6761\u4ef6\u4e8c\uff1a\u5982\u679c\u53d8\u957f\u5b57\u6bb5\u5141\u8bb8\u5b58\u50a8\u7684\u6700\u5927\u5b57\u8282\u6570\u5927\u4e8e 255 \u5b57\u8282\uff0c\u5c31\u4f1a\u7528 2 \u5b57\u8282\u8868\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\uff1b</li> </ul> <p>\u6211\u4eec\u8fd9\u91cc\u5b57\u6bb5\u7c7b\u578b\u662f varchar(65535) \uff0c\u5b57\u7b26\u96c6\u662f ascii\uff0c\u6240\u4ee5\u4ee3\u8868\u7740\u53d8\u957f\u5b57\u6bb5\u5141\u8bb8\u5b58\u50a8\u7684\u6700\u5927\u5b57\u8282\u6570\u662f 65535\uff0c\u7b26\u5408\u6761\u4ef6\u4e8c\uff0c\u6240\u4ee5\u4f1a\u7528 2 \u5b57\u8282\u6765\u8868\u793a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u3002</p> <p>\u56e0\u4e3a\u6211\u4eec\u8fd9\u4e2a\u6848\u4f8b\u662f\u53ea\u6709 1 \u4e2a\u53d8\u957f\u5b57\u6bb5\uff0c\u6240\u4ee5\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d= 1 \u4e2a\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u300d\u5360\u7528\u7684\u5b57\u8282\u6570\uff0c\u4e5f\u5c31\u662f 2 \u5b57\u8282\u3002</p> <p>\u56e0\u4e3a\u6211\u4eec\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c\u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u7684\u3002\u6240\u4ee5\uff0c\u5728\u6570\u636e\u5e93\u8868\u53ea\u6709\u4e00\u4e2a varchar(n)  \u5b57\u6bb5\u4e14\u5b57\u7b26\u96c6\u662f ascii \u7684\u60c5\u51b5\u4e0b\uff0cvarchar(n) \u4e2d n \u6700\u5927\u503c =  65535 - 2 - 1 = 65532\u3002</p> <p>\u6211\u4eec\u5148\u6765\u6d4b\u8bd5\u770b\u770b  varchar(65533)  \u662f\u5426\u53ef\u884c\uff1f</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd8\u662f\u4e0d\u884c\uff0c\u63a5\u4e0b\u6765\u770b\u770b varchar(65532)  \u662f\u5426\u53ef\u884c\uff1f</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u521b\u5efa\u6210\u529f\u4e86\u3002\u8bf4\u660e\u6211\u4eec\u7684\u63a8\u8bba\u662f\u6b63\u786e\u7684\uff0c\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u548c\u300cNULL \u503c\u5217\u8868\u300d\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u7684\u3002</p> <p>\u5f53\u7136\uff0c\u6211\u4e0a\u9762\u8fd9\u4e2a\u4f8b\u5b50\u662f\u9488\u5bf9\u5b57\u7b26\u96c6\u4e3a ascii \u60c5\u51b5\uff0c\u5982\u679c\u91c7\u7528\u7684\u662f UTF-8\uff0cvarchar(n)  \u6700\u591a\u80fd\u5b58\u50a8\u7684\u6570\u636e\u8ba1\u7b97\u65b9\u5f0f\u5c31\u4e0d\u4e00\u6837\u4e86\uff1a</p> <ul> <li>\u5728 UTF-8 \u5b57\u7b26\u96c6\u4e0b\uff0c\u4e00\u4e2a\u5b57\u7b26\u4e32\u6700\u591a\u9700\u8981\u4e09\u4e2a\u5b57\u8282\uff0cvarchar(n) \u7684 n \u6700\u5927\u53d6\u503c\u5c31\u662f 65532/3 = 21844\u3002</li> </ul> <p>\u4e0a\u9762\u6240\u8bf4\u7684\u53ea\u662f\u9488\u5bf9\u4e8e\u4e00\u4e2a\u5b57\u6bb5\u7684\u8ba1\u7b97\u65b9\u5f0f\u3002</p>"},{"location":"mysql/base/row_format/#_5","title":"\u591a\u5b57\u6bb5\u7684\u60c5\u51b5","text":"<p>\u5982\u679c\u6709\u591a\u4e2a\u5b57\u6bb5\u7684\u8bdd\uff0c\u8981\u4fdd\u8bc1\u6240\u6709\u5b57\u6bb5\u7684\u957f\u5ea6 + \u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 + NULL \u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 &lt;= 65535\u3002</p> <p>\u8fd9\u91cc\u4e3e\u4e2a\u591a\u5b57\u6bb5\u7684\u60c5\u51b5\u7684\u4f8b\u5b50\uff08\u611f\u8c22@Emoji \u540c\u5b66\u63d0\u4f9b\u7684\u4f8b\u5b50\uff09</p> <p></p>"},{"location":"mysql/base/row_format/#mysql_2","title":"\u884c\u6ea2\u51fa\u540e\uff0cMySQL \u662f\u600e\u4e48\u5904\u7406\u7684\uff1f","text":"<p>MySQL \u4e2d\u78c1\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\u662f\u9875\uff0c\u4e00\u4e2a\u9875\u7684\u5927\u5c0f\u4e00\u822c\u662f <code>16KB</code>\uff0c\u4e5f\u5c31\u662f <code>16384\u5b57\u8282</code>\uff0c\u800c\u4e00\u4e2a varchar(n)  \u7c7b\u578b\u7684\u5217\u6700\u591a\u53ef\u4ee5\u5b58\u50a8 <code>65532\u5b57\u8282</code>\uff0c\u4e00\u4e9b\u5927\u5bf9\u8c61\u5982 TEXT\u3001BLOB \u53ef\u80fd\u5b58\u50a8\u66f4\u591a\u7684\u6570\u636e\uff0c\u8fd9\u65f6\u4e00\u4e2a\u9875\u53ef\u80fd\u5c31\u5b58\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\u3002\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u53d1\u751f\u884c\u6ea2\u51fa\uff0c\u591a\u7684\u6570\u636e\u5c31\u4f1a\u5b58\u5230\u53e6\u5916\u7684\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002</p> <p>\u5982\u679c\u4e00\u4e2a\u6570\u636e\u9875\u5b58\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u81ea\u52a8\u5c06\u6ea2\u51fa\u7684\u6570\u636e\u5b58\u653e\u5230\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002\u5728\u4e00\u822c\u60c5\u51b5\u4e0b\uff0cInnoDB \u7684\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728\u300c\u6570\u636e\u9875\u300d\u4e2d\u3002\u4f46\u662f\u5f53\u53d1\u751f\u884c\u6ea2\u51fa\u65f6\uff0c\u6ea2\u51fa\u7684\u6570\u636e\u4f1a\u5b58\u653e\u5230\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002</p> <p>\u5f53\u53d1\u751f\u884c\u6ea2\u51fa\u65f6\uff0c\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u53ea\u4f1a\u4fdd\u5b58\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u800c\u628a\u5269\u4f59\u7684\u6570\u636e\u653e\u5728\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\uff0c\u7136\u540e\u771f\u5b9e\u6570\u636e\u5904\u7528 20 \u5b57\u8282\u5b58\u50a8\u6307\u5411\u6ea2\u51fa\u9875\u7684\u5730\u5740\uff0c\u4ece\u800c\u53ef\u4ee5\u627e\u5230\u5269\u4f59\u6570\u636e\u6240\u5728\u7684\u9875\u3002\u5927\u81f4\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u4e0a\u9762\u8fd9\u4e2a\u662f Compact \u884c\u683c\u5f0f\u5728\u53d1\u751f\u884c\u6ea2\u51fa\u540e\u7684\u5904\u7406\u3002</p> <p>Compressed \u548c Dynamic \u8fd9\u4e24\u4e2a\u884c\u683c\u5f0f\u548c Compact \u975e\u5e38\u7c7b\u4f3c\uff0c\u4e3b\u8981\u7684\u533a\u522b\u5728\u4e8e\u5904\u7406\u884c\u6ea2\u51fa\u6570\u636e\u65f6\u6709\u4e9b\u533a\u522b\u3002</p> <p>\u8fd9\u4e24\u79cd\u683c\u5f0f\u91c7\u7528\u5b8c\u5168\u7684\u884c\u6ea2\u51fa\u65b9\u5f0f\uff0c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u4e0d\u4f1a\u5b58\u50a8\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u53ea\u5b58\u50a8 20 \u4e2a\u5b57\u8282\u7684\u6307\u9488\u6765\u6307\u5411\u6ea2\u51fa\u9875\u3002\u800c\u5b9e\u9645\u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u6ea2\u51fa\u9875\u4e2d\uff0c\u770b\u8d77\u6765\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\uff1a</p> <p></p>"},{"location":"mysql/base/row_format/#_6","title":"\u603b\u7ed3","text":"<p>MySQL \u7684 NULL \u503c\u662f\u600e\u4e48\u5b58\u653e\u7684\uff1f</p> <p>MySQL \u7684 Compact \u884c\u683c\u5f0f\u4e2d\u4f1a\u7528\u300cNULL \u503c\u5217\u8868\u300d\u6765\u6807\u8bb0\u503c\u4e3a NULL \u7684\u5217\uff0cNULL \u503c\u5e76\u4e0d\u4f1a\u5b58\u50a8\u5728\u884c\u683c\u5f0f\u4e2d\u7684\u771f\u5b9e\u6570\u636e\u90e8\u5206\u3002</p> <p>NULL \u503c\u5217\u8868\u4f1a\u5360\u7528 1 \u5b57\u8282\u7a7a\u95f4\uff0c\u5f53\u8868\u4e2d\u6240\u6709\u5b57\u6bb5\u90fd\u5b9a\u4e49\u6210 NOT NULL\uff0c\u884c\u683c\u5f0f\u4e2d\u5c31\u4e0d\u4f1a\u6709 NULL \u503c\u5217\u8868\uff0c\u8fd9\u6837\u53ef\u8282\u7701 1 \u5b57\u8282\u7684\u7a7a\u95f4\u3002</p> <p>MySQL \u600e\u4e48\u77e5\u9053 varchar(n) \u5b9e\u9645\u5360\u7528\u6570\u636e\u7684\u5927\u5c0f\uff1f</p> <p>MySQL \u7684 Compact \u884c\u683c\u5f0f\u4e2d\u4f1a\u7528\u300c\u53d8\u957f\u5b57\u6bb5\u957f\u5ea6\u5217\u8868\u300d\u5b58\u50a8\u53d8\u957f\u5b57\u6bb5\u5b9e\u9645\u5360\u7528\u7684\u6570\u636e\u5927\u5c0f\u3002</p> <p>varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a\u591a\u5c11\uff1f</p> <p>\u4e00\u884c\u8bb0\u5f55\u6700\u5927\u80fd\u5b58\u50a8 65535 \u5b57\u8282\u7684\u6570\u636e\uff0c\u4f46\u662f\u8fd9\u4e2a\u662f\u5305\u542b\u300c\u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u300d\u548c\u300cNULL \u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u300d\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u5728\u7b97 varchar(n) \u4e2d n \u6700\u5927\u503c\u65f6\uff0c\u9700\u8981\u51cf\u53bb\u8fd9\u4e24\u4e2a\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570\u3002</p> <p>\u5982\u679c\u4e00\u5f20\u8868\u53ea\u6709\u4e00\u4e2a varchar(n)  \u5b57\u6bb5\uff0c\u4e14\u5141\u8bb8\u4e3a NULL\uff0c\u5b57\u7b26\u96c6\u4e3a ascii\u3002varchar(n) \u4e2d n \u6700\u5927\u53d6\u503c\u4e3a 65532\u3002</p> <p>\u8ba1\u7b97\u516c\u5f0f\uff1a65535 - \u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 - NULL \u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 = 65535 - 2 - 1 = 65532\u3002</p> <p>\u5982\u679c\u6709\u591a\u4e2a\u5b57\u6bb5\u7684\u8bdd\uff0c\u8981\u4fdd\u8bc1\u6240\u6709\u5b57\u6bb5\u7684\u957f\u5ea6 + \u53d8\u957f\u5b57\u6bb5\u5b57\u8282\u6570\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 + NULL \u503c\u5217\u8868\u6240\u5360\u7528\u7684\u5b57\u8282\u6570 &lt;= 65535\u3002</p> <p>\u884c\u6ea2\u51fa\u540e\uff0cMySQL \u662f\u600e\u4e48\u5904\u7406\u7684\uff1f</p> <p>\u5982\u679c\u4e00\u4e2a\u6570\u636e\u9875\u5b58\u4e0d\u4e86\u4e00\u6761\u8bb0\u5f55\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u81ea\u52a8\u5c06\u6ea2\u51fa\u7684\u6570\u636e\u5b58\u653e\u5230\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\u3002</p> <p>Compact \u884c\u683c\u5f0f\u9488\u5bf9\u884c\u6ea2\u51fa\u7684\u5904\u7406\u662f\u8fd9\u6837\u7684\uff1a\u5f53\u53d1\u751f\u884c\u6ea2\u51fa\u65f6\uff0c\u5728\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u53ea\u4f1a\u4fdd\u5b58\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u800c\u628a\u5269\u4f59\u7684\u6570\u636e\u653e\u5728\u300c\u6ea2\u51fa\u9875\u300d\u4e2d\uff0c\u7136\u540e\u771f\u5b9e\u6570\u636e\u5904\u7528 20 \u5b57\u8282\u5b58\u50a8\u6307\u5411\u6ea2\u51fa\u9875\u7684\u5730\u5740\uff0c\u4ece\u800c\u53ef\u4ee5\u627e\u5230\u5269\u4f59\u6570\u636e\u6240\u5728\u7684\u9875\u3002</p> <p>Compressed \u548c Dynamic \u8fd9\u4e24\u79cd\u683c\u5f0f\u91c7\u7528\u5b8c\u5168\u7684\u884c\u6ea2\u51fa\u65b9\u5f0f\uff0c\u8bb0\u5f55\u7684\u771f\u5b9e\u6570\u636e\u5904\u4e0d\u4f1a\u5b58\u50a8\u8be5\u5217\u7684\u4e00\u90e8\u5206\u6570\u636e\uff0c\u53ea\u5b58\u50a8 20 \u4e2a\u5b57\u8282\u7684\u6307\u9488\u6765\u6307\u5411\u6ea2\u51fa\u9875\u3002\u800c\u5b9e\u9645\u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u6ea2\u51fa\u9875\u4e2d\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\u300b</li> <li>\u300aMySQL \u6280\u672f\u5185\u5e55 InnoDB \u5b58\u50a8\u5f15\u64ce\u300b</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/buffer_pool/","title":"Index","text":"<p>buffer poll\u3001Change Buffer\u3001Adaptive Hash Index\u3001Change Buffer\u3001Doublewrite Buffer \u6b63\u5728\u8d76\u7a3f\u7684\u8def\u4e0a\u3002\u3002\u3002\u3002\u3002</p>"},{"location":"mysql/buffer_pool/buffer_pool/","title":"\u63ed\u5f00 Buffer Pool  \u7684\u9762\u7eb1","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4eca\u5929\u5c31\u804a MySQL \u7684 Buffer Pool\uff0c\u53d1\u8f66\uff01</p> <p></p>"},{"location":"mysql/buffer_pool/buffer_pool/#buffer-pool_1","title":"\u4e3a\u4ec0\u4e48\u8981\u6709 Buffer Pool\uff1f","text":"<p>\u867d\u7136\u8bf4 MySQL \u7684\u6570\u636e\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u91cc\u7684\uff0c\u4f46\u662f\u4e5f\u4e0d\u80fd\u6bcf\u6b21\u90fd\u4ece\u78c1\u76d8\u91cc\u9762\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u6837\u6027\u80fd\u662f\u6781\u5dee\u7684\u3002</p> <p>\u8981\u60f3\u63d0\u5347\u67e5\u8be2\u6027\u80fd\uff0c\u52a0\u4e2a\u7f13\u5b58\u5c31\u884c\u4e86\u561b\u3002\u6240\u4ee5\uff0c\u5f53\u6570\u636e\u4ece\u78c1\u76d8\u4e2d\u53d6\u51fa\u540e\uff0c\u7f13\u5b58\u5185\u5b58\u4e2d\uff0c\u4e0b\u6b21\u67e5\u8be2\u540c\u6837\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u3002</p> <p>\u4e3a\u6b64\uff0cInnodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u7f13\u51b2\u6c60\uff08Buffer Pool\uff09\uff0c\u6765\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\u3002</p> <p></p> <p>\u6709\u4e86\u7f13\u51b2\u6c60\u540e\uff1a</p> <ul> <li>\u5f53\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e  Buffer Pool \u4e2d\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u76f4\u63a5\u8bfb\u53d6  Buffer Pool \u4e2d\u7684\u6570\u636e\uff0c\u5426\u5219\u518d\u53bb\u78c1\u76d8\u4e2d\u8bfb\u53d6\u3002</li> <li>\u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u9996\u5148\u662f\u4fee\u6539  Buffer Pool  \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff0c\u6700\u540e\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002</li> </ul>"},{"location":"mysql/buffer_pool/buffer_pool/#buffer-pool_2","title":"Buffer Pool \u6709\u591a\u5927\uff1f","text":"<p>Buffer Pool \u662f\u5728 MySQL \u542f\u52a8\u7684\u65f6\u5019\uff0c\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u7684\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u9ed8\u8ba4\u914d\u7f6e\u4e0b Buffer Pool \u53ea\u6709 <code>128MB</code> \u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 <code>innodb_buffer_pool_size</code> \u53c2\u6570\u6765\u8bbe\u7f6e Buffer Pool \u7684\u5927\u5c0f\uff0c\u4e00\u822c\u5efa\u8bae\u8bbe\u7f6e\u6210\u53ef\u7528\u7269\u7406\u5185\u5b58\u7684 60%~80%\u3002</p>"},{"location":"mysql/buffer_pool/buffer_pool/#buffer-pool_3","title":"Buffer Pool \u7f13\u5b58\u4ec0\u4e48\uff1f","text":"<p>InnoDB \u4f1a\u628a\u5b58\u50a8\u7684\u6570\u636e\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u300c\u9875\u300d\uff0c\u4ee5\u9875\u4f5c\u4e3a\u78c1\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u4e00\u4e2a\u9875\u7684\u9ed8\u8ba4\u5927\u5c0f\u4e3a 16KB\u3002\u56e0\u6b64\uff0cBuffer Pool  \u540c\u6837\u9700\u8981\u6309\u300c\u9875\u300d\u6765\u5212\u5206\u3002</p> <p>\u5728 MySQL \u542f\u52a8\u7684\u65f6\u5019\uff0cInnoDB \u4f1a\u4e3a Buffer Pool \u7533\u8bf7\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u6309\u7167\u9ed8\u8ba4\u7684<code>16KB</code>\u7684\u5927\u5c0f\u5212\u5206\u51fa\u4e00\u4e2a\u4e2a\u7684\u9875\uff0cBuffer Pool \u4e2d\u7684\u9875\u5c31\u53eb\u505a\u7f13\u5b58\u9875\u3002\u6b64\u65f6\u8fd9\u4e9b\u7f13\u5b58\u9875\u90fd\u662f\u7a7a\u95f2\u7684\uff0c\u4e4b\u540e\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u624d\u4f1a\u6709\u78c1\u76d8\u4e0a\u7684\u9875\u88ab\u7f13\u5b58\u5230 Buffer Pool \u4e2d\u3002</p> <p>\u6240\u4ee5\uff0cMySQL \u521a\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u89c2\u5bdf\u5230\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5f88\u5927\uff0c\u800c\u4f7f\u7528\u5230\u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u5374\u5f88\u5c0f\uff0c\u8fd9\u662f\u56e0\u4e3a\u53ea\u6709\u8fd9\u4e9b\u865a\u62df\u5185\u5b58\u88ab\u8bbf\u95ee\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u624d\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u63a5\u7740\u5c06\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\u3002</p> <p>Buffer Pool  \u9664\u4e86\u7f13\u5b58\u300c\u7d22\u5f15\u9875\u300d\u548c\u300c\u6570\u636e\u9875\u300d\uff0c\u8fd8\u5305\u62ec\u4e86 undo \u9875\uff0c\u63d2\u5165\u7f13\u5b58\u3001\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u3001\u9501\u4fe1\u606f\u7b49\u7b49\u3002</p> <p></p> <p>\u4e3a\u4e86\u66f4\u597d\u7684\u7ba1\u7406\u8fd9\u4e9b\u5728 Buffer Pool \u4e2d\u7684\u7f13\u5b58\u9875\uff0cInnoDB \u4e3a\u6bcf\u4e00\u4e2a\u7f13\u5b58\u9875\u90fd\u521b\u5efa\u4e86\u4e00\u4e2a\u63a7\u5236\u5757\uff0c\u63a7\u5236\u5757\u4fe1\u606f\u5305\u62ec\u300c\u7f13\u5b58\u9875\u7684\u8868\u7a7a\u95f4\u3001\u9875\u53f7\u3001\u7f13\u5b58\u9875\u5730\u5740\u3001\u94fe\u8868\u8282\u70b9\u300d\u7b49\u7b49\u3002</p> <p>\u63a7\u5236\u5757\u4e5f\u662f\u5360\u6709\u5185\u5b58\u7a7a\u95f4\u7684\uff0c\u5b83\u662f\u653e\u5728 Buffer Pool \u7684\u6700\u524d\u9762\uff0c\u63a5\u7740\u624d\u662f\u7f13\u5b58\u9875\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u4e4b\u95f4\u7070\u8272\u90e8\u5206\u79f0\u4e3a\u788e\u7247\u7a7a\u95f4\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4f1a\u6709\u788e\u7247\u7a7a\u95f4\u5462\uff1f</p> <p>\u4f60\u60f3\u60f3\u554a\uff0c\u6bcf\u4e00\u4e2a\u63a7\u5236\u5757\u90fd\u5bf9\u5e94\u4e00\u4e2a\u7f13\u5b58\u9875\uff0c\u90a3\u5728\u5206\u914d\u8db3\u591f\u591a\u7684\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u540e\uff0c\u53ef\u80fd\u5269\u4f59\u7684\u90a3\u70b9\u513f\u7a7a\u95f4\u4e0d\u591f\u4e00\u5bf9\u63a7\u5236\u5757\u548c\u7f13\u5b58\u9875\u7684\u5927\u5c0f\uff0c\u81ea\u7136\u5c31\u7528\u4e0d\u5230\u55bd\uff0c\u8fd9\u4e2a\u7528\u4e0d\u5230\u7684\u90a3\u70b9\u513f\u5185\u5b58\u7a7a\u95f4\u5c31\u88ab\u79f0\u4e3a\u788e\u7247\u4e86\u3002</p> <p>\u5f53\u7136\uff0c\u5982\u679c\u4f60\u628a Buffer Pool \u7684\u5927\u5c0f\u8bbe\u7f6e\u7684\u521a\u521a\u597d\u7684\u8bdd\uff0c\u4e5f\u53ef\u80fd\u4e0d\u4f1a\u4ea7\u751f\u788e\u7247\u3002</p> <p>\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u5c31\u53ea\u9700\u8981\u7f13\u51b2\u4e00\u6761\u8bb0\u5f55\u5417\uff1f</p> <p>\u4e0d\u662f\u7684\u3002</p> <p>\u5f53\u6211\u4eec\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\u65f6\uff0cInnoDB \u662f\u4f1a\u628a\u6574\u4e2a\u9875\u7684\u6570\u636e\u52a0\u8f7d\u5230 Buffer Pool \u4e2d\uff0c\u56e0\u4e3a\uff0c\u901a\u8fc7\u7d22\u5f15\u53ea\u80fd\u5b9a\u4f4d\u5230\u78c1\u76d8\u4e2d\u7684\u9875\uff0c\u800c\u4e0d\u80fd\u5b9a\u4f4d\u5230\u9875\u4e2d\u7684\u4e00\u6761\u8bb0\u5f55\u3002\u5c06\u9875\u52a0\u8f7d\u5230 Buffer Pool \u540e\uff0c\u518d\u901a\u8fc7\u9875\u91cc\u7684\u9875\u76ee\u5f55\u53bb\u5b9a\u4f4d\u5230\u67d0\u6761\u5177\u4f53\u7684\u8bb0\u5f55\u3002</p> <p>\u5173\u4e8e\u9875\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\u548c\u7d22\u5f15\u600e\u4e48\u67e5\u8be2\u6570\u636e\u7684\u95ee\u9898\u53ef\u4ee5\u5728\u8fd9\u7bc7\u627e\u5230\u7b54\u6848\uff1a\u6362\u4e00\u4e2a\u89d2\u5ea6\u770b B+ \u6811</p>"},{"location":"mysql/buffer_pool/buffer_pool/#buffer-pool_4","title":"\u5982\u4f55\u7ba1\u7406 Buffer Pool\uff1f","text":""},{"location":"mysql/buffer_pool/buffer_pool/#_1","title":"\u5982\u4f55\u7ba1\u7406\u7a7a\u95f2\u9875\uff1f","text":"<p>Buffer Pool \u662f\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u5f53 MySQL \u8fd0\u884c\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u8fd9\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u4e2d\u7684\u7f13\u5b58\u9875\u65e2\u6709\u7a7a\u95f2\u7684\uff0c\u4e5f\u6709\u88ab\u4f7f\u7528\u7684\u3002</p> <p>\u90a3\u5f53\u6211\u4eec\u4ece\u78c1\u76d8\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u603b\u4e0d\u80fd\u901a\u8fc7\u904d\u5386\u8fd9\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u6765\u627e\u5230\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u5427\uff0c\u8fd9\u6837\u6548\u7387\u592a\u4f4e\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u80fd\u591f\u5feb\u901f\u627e\u5230\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\uff0c\u53ef\u4ee5\u4f7f\u7528\u94fe\u8868\u7ed3\u6784\uff0c\u5c06\u7a7a\u95f2\u7f13\u5b58\u9875\u7684\u300c\u63a7\u5236\u5757\u300d\u4f5c\u4e3a\u94fe\u8868\u7684\u8282\u70b9\uff0c\u8fd9\u4e2a\u94fe\u8868\u79f0\u4e3a Free \u94fe\u8868\uff08\u7a7a\u95f2\u94fe\u8868\uff09\u3002</p> <p></p> <p>Free \u94fe\u8868\u4e0a\u9664\u4e86\u6709\u63a7\u5236\u5757\uff0c\u8fd8\u6709\u4e00\u4e2a\u5934\u8282\u70b9\uff0c\u8be5\u5934\u8282\u70b9\u5305\u542b\u94fe\u8868\u7684\u5934\u8282\u70b9\u5730\u5740\uff0c\u5c3e\u8282\u70b9\u5730\u5740\uff0c\u4ee5\u53ca\u5f53\u524d\u94fe\u8868\u4e2d\u8282\u70b9\u7684\u6570\u91cf\u7b49\u4fe1\u606f\u3002</p> <p>Free \u94fe\u8868\u8282\u70b9\u662f\u4e00\u4e2a\u4e00\u4e2a\u7684\u63a7\u5236\u5757\uff0c\u800c\u6bcf\u4e2a\u63a7\u5236\u5757\u5305\u542b\u7740\u5bf9\u5e94\u7f13\u5b58\u9875\u7684\u5730\u5740\uff0c\u6240\u4ee5\u76f8\u5f53\u4e8e Free \u94fe\u8868\u8282\u70b9\u90fd\u5bf9\u5e94\u4e00\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\u3002</p> <p>\u6709\u4e86 Free \u94fe\u8868\u540e\uff0c\u6bcf\u5f53\u9700\u8981\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d\u4e00\u4e2a\u9875\u5230 Buffer Pool \u4e2d\u65f6\uff0c\u5c31\u4ece Free \u94fe\u8868\u4e2d\u53d6\u4e00\u4e2a\u7a7a\u95f2\u7684\u7f13\u5b58\u9875\uff0c\u5e76\u4e14\u628a\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u7684\u4fe1\u606f\u586b\u4e0a\uff0c\u7136\u540e\u628a\u8be5\u7f13\u5b58\u9875\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4ece Free \u94fe\u8868\u4e2d\u79fb\u9664\u3002</p>"},{"location":"mysql/buffer_pool/buffer_pool/#_2","title":"\u5982\u4f55\u7ba1\u7406\u810f\u9875\uff1f","text":"<p>\u8bbe\u8ba1 Buffer Pool \u9664\u4e86\u80fd\u63d0\u9ad8\u8bfb\u6027\u80fd\uff0c\u8fd8\u80fd\u63d0\u9ad8\u5199\u6027\u80fd\uff0c\u4e5f\u5c31\u662f\u66f4\u65b0\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u8981\u5199\u5165\u78c1\u76d8\uff0c\u800c\u662f\u5c06 Buffer Pool \u5bf9\u5e94\u7684\u7f13\u5b58\u9875\u6807\u8bb0\u4e3a\u810f\u9875\uff0c\u7136\u540e\u518d\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002</p> <p>\u90a3\u4e3a\u4e86\u80fd\u5feb\u901f\u77e5\u9053\u54ea\u4e9b\u7f13\u5b58\u9875\u662f\u810f\u7684\uff0c\u4e8e\u662f\u5c31\u8bbe\u8ba1\u51fa Flush \u94fe\u8868\uff0c\u5b83\u8ddf Free \u94fe\u8868\u7c7b\u4f3c\u7684\uff0c\u94fe\u8868\u7684\u8282\u70b9\u4e5f\u662f\u63a7\u5236\u5757\uff0c\u533a\u522b\u5728\u4e8e Flush \u94fe\u8868\u7684\u5143\u7d20\u90fd\u662f\u810f\u9875\u3002</p> <p></p> <p>\u6709\u4e86 Flush \u94fe\u8868\u540e\uff0c\u540e\u53f0\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u904d\u5386 Flush \u94fe\u8868\uff0c\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002</p>"},{"location":"mysql/buffer_pool/buffer_pool/#_3","title":"\u5982\u4f55\u63d0\u9ad8\u7f13\u5b58\u547d\u4e2d\u7387\uff1f","text":"<p>Buffer Pool  \u7684\u5927\u5c0f\u662f\u6709\u9650\u7684\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u6211\u4eec\u5e0c\u671b\u53ef\u4ee5\u4e00\u76f4\u7559\u5728 Buffer Pool \u4e2d\uff0c\u800c\u4e00\u4e9b\u5f88\u5c11\u8bbf\u95ee\u7684\u6570\u636e\u5e0c\u671b\u53ef\u4ee5\u5728\u67d0\u4e9b\u65f6\u673a\u53ef\u4ee5\u6dd8\u6c70\u6389\uff0c\u4ece\u800c\u4fdd\u8bc1 Buffer Pool  \u4e0d\u4f1a\u56e0\u4e3a\u6ee1\u4e86\u800c\u5bfc\u81f4\u65e0\u6cd5\u518d\u7f13\u5b58\u65b0\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u80fd\u4fdd\u8bc1\u5e38\u7528\u6570\u636e\u7559\u5728 Buffer Pool \u4e2d\u3002</p> <p>\u8981\u5b9e\u73b0\u8fd9\u4e2a\uff0c\u6700\u5bb9\u6613\u60f3\u5230\u7684\u5c31\u662f LRU\uff08Least recently used\uff09\u7b97\u6cd5\u3002</p> <p>\u8be5\u7b97\u6cd5\u7684\u601d\u8def\u662f\uff0c\u94fe\u8868\u5934\u90e8\u7684\u8282\u70b9\u662f\u6700\u8fd1\u4f7f\u7528\u7684\uff0c\u800c\u94fe\u8868\u672b\u5c3e\u7684\u8282\u70b9\u662f\u6700\u4e45\u6ca1\u88ab\u4f7f\u7528\u7684\u3002\u90a3\u4e48\uff0c\u5f53\u7a7a\u95f4\u4e0d\u591f\u4e86\uff0c\u5c31\u6dd8\u6c70\u6700\u4e45\u6ca1\u88ab\u4f7f\u7528\u7684\u8282\u70b9\uff0c\u4ece\u800c\u817e\u51fa\u7a7a\u95f4\u3002</p> <p>\u7b80\u5355\u7684 LRU \u7b97\u6cd5\u7684\u5b9e\u73b0\u601d\u8def\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>\u5f53\u8bbf\u95ee\u7684\u9875\u5728 Buffer Pool  \u91cc\uff0c\u5c31\u76f4\u63a5\u628a\u8be5\u9875\u5bf9\u5e94\u7684 LRU \u94fe\u8868\u8282\u70b9\u79fb\u52a8\u5230\u94fe\u8868\u7684\u5934\u90e8\u3002</li> <li>\u5f53\u8bbf\u95ee\u7684\u9875\u4e0d\u5728 Buffer Pool \u91cc\uff0c\u9664\u4e86\u8981\u628a\u9875\u653e\u5165\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u8fd8\u8981\u6dd8\u6c70  LRU \u94fe\u8868\u672b\u5c3e\u7684\u8282\u70b9\u3002</li> </ul> <p>\u6bd4\u5982\u4e0b\u56fe\uff0c\u5047\u8bbe LRU \u94fe\u8868\u957f\u5ea6\u4e3a 5\uff0cLRU \u94fe\u8868\u4ece\u5de6\u5230\u53f3\u6709 1\uff0c2\uff0c3\uff0c4\uff0c5 \u7684\u9875\u3002</p> <p></p> <p>\u5982\u679c\u8bbf\u95ee\u4e86 3 \u53f7\u7684\u9875\uff0c\u56e0\u4e3a 3 \u53f7\u9875\u5728 Buffer Pool \u91cc\uff0c\u6240\u4ee5\u628a 3 \u53f7\u9875\u79fb\u52a8\u5230\u5934\u90e8\u5373\u53ef\u3002</p> <p></p> <p>\u800c\u5982\u679c\u63a5\u4e0b\u6765\uff0c\u8bbf\u95ee\u4e86 8 \u53f7\u9875\uff0c\u56e0\u4e3a 8 \u53f7\u9875\u4e0d\u5728 Buffer Pool  \u91cc\uff0c\u6240\u4ee5\u9700\u8981\u5148\u6dd8\u6c70\u672b\u5c3e\u7684 5 \u53f7\u9875\uff0c\u7136\u540e\u518d\u5c06 8 \u53f7\u9875\u52a0\u5165\u5230\u5934\u90e8\u3002</p> <p></p> <p>\u5230\u8fd9\u91cc\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0cBuffer Pool \u91cc\u6709\u4e09\u79cd\u9875\u548c\u94fe\u8868\u6765\u7ba1\u7406\u6570\u636e\u3002</p> <p></p> <p>\u56fe\u4e2d\uff1a</p> <ul> <li>Free Page\uff08\u7a7a\u95f2\u9875\uff09\uff0c\u8868\u793a\u6b64\u9875\u672a\u88ab\u4f7f\u7528\uff0c\u4f4d\u4e8e Free \u94fe\u8868\uff1b</li> <li>Clean Page\uff08\u5e72\u51c0\u9875\uff09\uff0c\u8868\u793a\u6b64\u9875\u5df2\u88ab\u4f7f\u7528\uff0c\u4f46\u662f\u9875\u9762\u672a\u53d1\u751f\u4fee\u6539\uff0c\u4f4d\u4e8e LRU \u94fe\u8868\u3002</li> <li>Dirty Page\uff08\u810f\u9875\uff09\uff0c\u8868\u793a\u6b64\u9875\u300c\u5df2\u88ab\u4f7f\u7528\u300d\u4e14\u300c\u5df2\u7ecf\u88ab\u4fee\u6539\u300d\uff0c\u5176\u6570\u636e\u548c\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u5df2\u7ecf\u4e0d\u4e00\u81f4\u3002\u5f53\u810f\u9875\u4e0a\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\u540e\uff0c\u5185\u5b58\u6570\u636e\u548c\u78c1\u76d8\u6570\u636e\u4e00\u81f4\uff0c\u90a3\u4e48\u8be5\u9875\u5c31\u53d8\u6210\u4e86\u5e72\u51c0\u9875\u3002\u810f\u9875\u540c\u65f6\u5b58\u5728\u4e8e LRU \u94fe\u8868\u548c Flush \u94fe\u8868\u3002</li> </ul> <p>\u7b80\u5355\u7684 LRU \u7b97\u6cd5\u5e76\u6ca1\u6709\u88ab  MySQL \u4f7f\u7528\uff0c\u56e0\u4e3a\u7b80\u5355\u7684 LRU \u7b97\u6cd5\u65e0\u6cd5\u907f\u514d\u4e0b\u9762\u8fd9\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u9884\u8bfb\u5931\u6548\uff1b</li> <li>Buffer Pool  \u6c61\u67d3\uff1b</li> </ul> <p>\u4ec0\u4e48\u662f\u9884\u8bfb\u5931\u6548\uff1f</p> <p>\u5148\u6765\u8bf4\u8bf4 MySQL \u7684\u9884\u8bfb\u673a\u5236\u3002\u7a0b\u5e8f\u662f\u6709\u7a7a\u95f4\u5c40\u90e8\u6027\u7684\uff0c\u9760\u8fd1\u5f53\u524d\u88ab\u8bbf\u95ee\u6570\u636e\u7684\u6570\u636e\uff0c\u5728\u672a\u6765\u5f88\u5927\u6982\u7387\u4f1a\u88ab\u8bbf\u95ee\u5230\u3002</p> <p>\u6240\u4ee5\uff0cMySQL \u5728\u52a0\u8f7d\u6570\u636e\u9875\u65f6\uff0c\u4f1a\u63d0\u524d\u628a\u5b83\u76f8\u90bb\u7684\u6570\u636e\u9875\u4e00\u5e76\u52a0\u8f7d\u8fdb\u6765\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8 IO\u3002</p> <p>\u4f46\u662f\u53ef\u80fd\u8fd9\u4e9b\u88ab\u63d0\u524d\u52a0\u8f7d\u8fdb\u6765\u7684\u6570\u636e\u9875\uff0c\u5e76\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u76f8\u5f53\u4e8e\u8fd9\u4e2a\u9884\u8bfb\u662f\u767d\u505a\u4e86\uff0c\u8fd9\u4e2a\u5c31\u662f\u9884\u8bfb\u5931\u6548\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u7b80\u5355\u7684 LRU \u7b97\u6cd5\uff0c\u5c31\u4f1a\u628a\u9884\u8bfb\u9875\u653e\u5230 LRU \u94fe\u8868\u5934\u90e8\uff0c\u800c\u5f53  Buffer Pool \u7a7a\u95f4\u4e0d\u591f\u7684\u65f6\u5019\uff0c\u8fd8\u9700\u8981\u628a\u672b\u5c3e\u7684\u9875\u6dd8\u6c70\u6389\u3002</p> <p>\u5982\u679c\u8fd9\u4e9b\u9884\u8bfb\u9875\u5982\u679c\u4e00\u76f4\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u5230\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u5f88\u5947\u602a\u7684\u95ee\u9898\uff0c\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u7684\u9884\u8bfb\u9875\u5374\u5360\u7528\u4e86 LRU \u94fe\u8868\u524d\u6392\u7684\u4f4d\u7f6e\uff0c\u800c\u672b\u5c3e\u6dd8\u6c70\u7684\u9875\uff0c\u53ef\u80fd\u662f\u9891\u7e41\u8bbf\u95ee\u7684\u9875\uff0c\u8fd9\u6837\u5c31\u5927\u5927\u964d\u4f4e\u4e86\u7f13\u5b58\u547d\u4e2d\u7387\u3002</p> <p>\u600e\u4e48\u89e3\u51b3\u9884\u8bfb\u5931\u6548\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u964d\u4f4e\u7684\u95ee\u9898\uff1f</p> <p>\u6211\u4eec\u4e0d\u80fd\u56e0\u4e3a\u5bb3\u6015\u9884\u8bfb\u5931\u6548\uff0c\u800c\u5c06\u9884\u8bfb\u673a\u5236\u53bb\u6389\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u5c40\u90e8\u6027\u539f\u7406\u8fd8\u662f\u6210\u7acb\u7684\u3002</p> <p>\u8981\u907f\u514d\u9884\u8bfb\u5931\u6548\u5e26\u6765\u5f71\u54cd\uff0c\u6700\u597d\u5c31\u662f\u8ba9\u9884\u8bfb\u7684\u9875\u505c\u7559\u5728 Buffer Pool \u91cc\u7684\u65f6\u95f4\u8981\u5c3d\u53ef\u80fd\u7684\u77ed\uff0c\u8ba9\u771f\u6b63\u88ab\u8bbf\u95ee\u7684\u9875\u624d\u79fb\u52a8\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u4ece\u800c\u4fdd\u8bc1\u771f\u6b63\u88ab\u8bfb\u53d6\u7684\u70ed\u6570\u636e\u7559\u5728 Buffer Pool \u91cc\u7684\u65f6\u95f4\u5c3d\u53ef\u80fd\u957f\u3002</p> <p>\u90a3\u5230\u5e95\u600e\u4e48\u624d\u80fd\u907f\u514d\u5462\uff1f</p> <p>MySQL \u662f\u8fd9\u6837\u505a\u7684\uff0c\u5b83\u6539\u8fdb\u4e86 LRU \u7b97\u6cd5\uff0c\u5c06 LRU \u5212\u5206\u4e86 2 \u4e2a\u533a\u57df\uff1aold \u533a\u57df \u548c young \u533a\u57df\u3002</p> <p>young \u533a\u57df\u5728 LRU \u94fe\u8868\u7684\u524d\u534a\u90e8\u5206\uff0cold \u533a\u57df\u5219\u662f\u5728\u540e\u534a\u90e8\u5206\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>old \u533a\u57df\u5360\u6574\u4e2a LRU \u94fe\u8868\u957f\u5ea6\u7684\u6bd4\u4f8b\u53ef\u4ee5\u901a\u8fc7 <code>innodb_old_blocks_pct</code> \u53c2\u6570\u6765\u8bbe\u7f6e\uff0c\u9ed8\u8ba4\u662f 37\uff0c\u4ee3\u8868\u6574\u4e2a LRU \u94fe\u8868\u4e2d young \u533a\u57df\u4e0e old \u533a\u57df\u6bd4\u4f8b\u662f 63:37\u3002</p> <p>\u5212\u5206\u8fd9\u4e24\u4e2a\u533a\u57df\u540e\uff0c\u9884\u8bfb\u7684\u9875\u5c31\u53ea\u9700\u8981\u52a0\u5165\u5230 old \u533a\u57df\u7684\u5934\u90e8\uff0c\u5f53\u9875\u88ab\u771f\u6b63\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u624d\u5c06\u9875\u63d2\u5165 young \u533a\u57df\u7684\u5934\u90e8\u3002\u5982\u679c\u9884\u8bfb\u7684\u9875\u4e00\u76f4\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u4ece old \u533a\u57df\u79fb\u9664\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u5f71\u54cd young \u533a\u57df\u4e2d\u7684\u70ed\u70b9\u6570\u636e\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u7ed9\u5927\u5bb6\u4e3e\u4e2a\u4f8b\u5b50\u3002</p> <p>\u5047\u8bbe\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a 10 \u7684 LRU \u94fe\u8868\uff0c\u5176\u4e2d young \u533a\u57df\u5360\u6bd4 70 %\uff0cold \u533a\u57df\u5360\u6bd4 30 %\u3002</p> <p></p> <p>\u73b0\u5728\u6709\u4e2a\u7f16\u53f7\u4e3a 20 \u7684\u9875\u88ab\u9884\u8bfb\u4e86\uff0c\u8fd9\u4e2a\u9875\u53ea\u4f1a\u88ab\u63d2\u5165\u5230  old \u533a\u57df\u5934\u90e8\uff0c\u800c old \u533a\u57df\u672b\u5c3e\u7684\u9875\uff0810 \u53f7\uff09\u4f1a\u88ab\u6dd8\u6c70\u6389\u3002</p> <p></p> <p>\u5982\u679c 20 \u53f7\u9875\u4e00\u76f4\u4e0d\u4f1a\u88ab\u8bbf\u95ee\uff0c\u5b83\u4e5f\u6ca1\u6709\u5360\u7528\u5230 young \u533a\u57df\u7684\u4f4d\u7f6e\uff0c\u800c\u4e14\u8fd8\u4f1a\u6bd4 young \u533a\u57df\u7684\u6570\u636e\u66f4\u65e9\u88ab\u6dd8\u6c70\u51fa\u53bb\u3002</p> <p>\u5982\u679c 20 \u53f7\u9875\u88ab\u9884\u8bfb\u540e\uff0c\u7acb\u523b\u88ab\u8bbf\u95ee\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06\u5b83\u63d2\u5165\u5230 young \u533a\u57df\u7684\u5934\u90e8\uff0cyoung \u533a\u57df\u672b\u5c3e\u7684\u9875\uff087 \u53f7\uff09\uff0c\u4f1a\u88ab\u6324\u5230 old \u533a\u57df\uff0c\u4f5c\u4e3a old \u533a\u57df\u7684\u5934\u90e8\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u6709\u9875\u88ab\u6dd8\u6c70\u3002</p> <p></p> <p>\u867d\u7136\u901a\u8fc7\u5212\u5206 old \u533a\u57df \u548c young \u533a\u57df\u907f\u514d\u4e86\u9884\u8bfb\u5931\u6548\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u4f46\u662f\u8fd8\u6709\u4e2a\u95ee\u9898\u65e0\u6cd5\u89e3\u51b3\uff0c\u90a3\u5c31\u662f  Buffer Pool  \u6c61\u67d3\u7684\u95ee\u9898\u3002</p> <p>\u4ec0\u4e48\u662f  Buffer Pool  \u6c61\u67d3\uff1f</p> <p>\u5f53\u67d0\u4e00\u4e2a SQL \u8bed\u53e5\u626b\u63cf\u4e86\u5927\u91cf\u7684\u6570\u636e\u65f6\uff0c\u5728  Buffer Pool \u7a7a\u95f4\u6bd4\u8f83\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u5c06 Buffer Pool \u91cc\u7684\u6240\u6709\u9875\u90fd\u66ff\u6362\u51fa\u53bb\uff0c\u5bfc\u81f4\u5927\u91cf\u70ed\u6570\u636e\u88ab\u6dd8\u6c70\u4e86\uff0c\u7b49\u8fd9\u4e9b\u70ed\u6570\u636e\u53c8\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5c31\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u78c1\u76d8 IO\uff0cMySQL \u6027\u80fd\u5c31\u4f1a\u6025\u5267\u4e0b\u964d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3a Buffer Pool  \u6c61\u67d3\u3002</p> <p>\u6ce8\u610f\uff0cBuffer Pool  \u6c61\u67d3\u5e76\u4e0d\u53ea\u662f\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u51fa\u4e86\u5927\u91cf\u7684\u6570\u636e\u624d\u51fa\u73b0\u7684\u95ee\u9898\uff0c\u5373\u4f7f\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u96c6\u5f88\u5c0f\uff0c\u4e5f\u4f1a\u9020\u6210 Buffer Pool  \u6c61\u67d3\u3002</p> <p>\u6bd4\u5982\uff0c\u5728\u4e00\u4e2a\u6570\u636e\u91cf\u975e\u5e38\u5927\u7684\u8868\uff0c\u6267\u884c\u4e86\u8fd9\u6761\u8bed\u53e5\uff1a</p> SQL<pre><code>select * from t_user where name like \"%xiaolin%\";\n</code></pre> <p>\u53ef\u80fd\u8fd9\u4e2a\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u5c31\u51e0\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u7531\u4e8e\u8fd9\u6761\u8bed\u53e5\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\uff0c\u6240\u4ee5\u8fd9\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u662f\u5168\u8868\u626b\u63cf\u7684\uff0c\u63a5\u7740\u4f1a\u53d1\u751f\u5982\u4e0b\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u4ece\u78c1\u76d8\u8bfb\u5230\u7684\u9875\u52a0\u5165\u5230 LRU \u94fe\u8868\u7684 old \u533a\u57df\u5934\u90e8\uff1b</li> <li>\u5f53\u4ece\u9875\u91cc\u8bfb\u53d6\u884c\u8bb0\u5f55\u65f6\uff0c\u4e5f\u5c31\u662f\u9875\u88ab\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u5c31\u8981\u5c06\u8be5\u9875\u653e\u5230 young \u533a\u57df\u5934\u90e8\uff1b</li> <li>\u63a5\u4e0b\u6765\u62ff\u884c\u8bb0\u5f55\u7684 name \u5b57\u6bb5\u548c\u5b57\u7b26\u4e32 xiaolin \u8fdb\u884c\u6a21\u7cca\u5339\u914d\uff0c\u5982\u679c\u7b26\u5408\u6761\u4ef6\uff0c\u5c31\u52a0\u5165\u5230\u7ed3\u679c\u96c6\u91cc\uff1b</li> <li>\u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u626b\u63cf\u5b8c\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u3002</li> </ul> <p>\u7ecf\u8fc7\u8fd9\u4e00\u756a\u6298\u817e\uff0c\u539f\u672c young \u533a\u57df\u7684\u70ed\u70b9\u6570\u636e\u90fd\u4f1a\u88ab\u66ff\u6362\u6389\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u9700\u8981\u6279\u91cf\u626b\u63cf\uff1a21\uff0c22\uff0c23\uff0c24\uff0c25 \u8fd9\u4e94\u4e2a\u9875\uff0c\u8fd9\u4e9b\u9875\u90fd\u4f1a\u88ab\u9010\u4e00\u8bbf\u95ee\uff08\u8bfb\u53d6\u9875\u91cc\u7684\u8bb0\u5f55\uff09\u3002</p> <p></p> <p>\u5728\u6279\u91cf\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u9010\u4e00\u63d2\u5165\u5230 young \u533a\u57df\u5934\u90e8\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u539f\u672c\u5728 young \u533a\u57df\u7684\u70ed\u70b9\u6570\u636e 6 \u548c 7 \u53f7\u9875\u90fd\u88ab\u6dd8\u6c70\u4e86\uff0c\u8fd9\u5c31\u662f  Buffer Pool  \u6c61\u67d3\u7684\u95ee\u9898\u3002</p> <p>\u600e\u4e48\u89e3\u51b3\u51fa\u73b0   Buffer Pool  \u6c61\u67d3\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\u7684\u95ee\u9898\uff1f</p> <p>\u50cf\u524d\u9762\u8fd9\u79cd\u5168\u8868\u626b\u63cf\u7684\u67e5\u8be2\uff0c\u5f88\u591a\u7f13\u51b2\u9875\u5176\u5b9e\u53ea\u4f1a\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u4f46\u662f\u5b83\u5374\u53ea\u56e0\u4e3a\u88ab\u8bbf\u95ee\u4e86\u4e00\u6b21\u800c\u8fdb\u5165\u5230 young \u533a\u57df\uff0c\u4ece\u800c\u5bfc\u81f4\u70ed\u70b9\u6570\u636e\u88ab\u66ff\u6362\u4e86\u3002</p> <p>LRU \u94fe\u8868\u4e2d young \u533a\u57df\u5c31\u662f\u70ed\u70b9\u6570\u636e\uff0c\u53ea\u8981\u6211\u4eec\u63d0\u9ad8\u8fdb\u5165\u5230 young \u533a\u57df\u7684\u95e8\u69db\uff0c\u5c31\u80fd\u6709\u6548\u5730\u4fdd\u8bc1 young \u533a\u57df\u91cc\u7684\u70ed\u70b9\u6570\u636e\u4e0d\u4f1a\u88ab\u66ff\u6362\u6389\u3002</p> <p>MySQL \u662f\u8fd9\u6837\u505a\u7684\uff0c\u8fdb\u5165\u5230 young \u533a\u57df\u6761\u4ef6\u589e\u52a0\u4e86\u4e00\u4e2a\u505c\u7559\u5728 old \u533a\u57df\u7684\u65f6\u95f4\u5224\u65ad\u3002</p> <p>\u5177\u4f53\u662f\u8fd9\u6837\u505a\u7684\uff0c\u5728\u5bf9\u67d0\u4e2a\u5904\u5728 old \u533a\u57df\u7684\u7f13\u5b58\u9875\u8fdb\u884c\u7b2c\u4e00\u6b21\u8bbf\u95ee\u65f6\uff0c\u5c31\u5728\u5b83\u5bf9\u5e94\u7684\u63a7\u5236\u5757\u4e2d\u8bb0\u5f55\u4e0b\u6765\u8fd9\u4e2a\u8bbf\u95ee\u65f6\u95f4\uff1a</p> <ul> <li>\u5982\u679c\u540e\u7eed\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u5728\u67d0\u4e2a\u65f6\u95f4\u95f4\u9694\u5185\uff0c\u90a3\u4e48\u8be5\u7f13\u5b58\u9875\u5c31\u4e0d\u4f1a\u88ab\u4ece old \u533a\u57df\u79fb\u52a8\u5230 young \u533a\u57df\u7684\u5934\u90e8\uff1b</li> <li>\u5982\u679c\u540e\u7eed\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u4e0d\u5728\u67d0\u4e2a\u65f6\u95f4\u95f4\u9694\u5185\uff0c\u90a3\u4e48\u8be5\u7f13\u5b58\u9875\u79fb\u52a8\u5230 young \u533a\u57df\u7684\u5934\u90e8\uff1b</li> </ul> <p>\u8fd9\u4e2a\u95f4\u9694\u65f6\u95f4\u662f\u7531 <code>innodb_old_blocks_time</code> \u63a7\u5236\u7684\uff0c\u9ed8\u8ba4\u662f 1000 ms\u3002</p> <p>\u4e5f\u5c31\u8bf4\uff0c\u53ea\u6709\u540c\u65f6\u6ee1\u8db3\u300c\u88ab\u8bbf\u95ee\u300d\u4e0e\u300c\u5728 old \u533a\u57df\u505c\u7559\u65f6\u95f4\u8d85\u8fc7 1 \u79d2\u300d\u4e24\u4e2a\u6761\u4ef6\uff0c\u624d\u4f1a\u88ab\u63d2\u5165\u5230 young \u533a\u57df\u5934\u90e8\uff0c\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86 Buffer Pool  \u6c61\u67d3\u7684\u95ee\u9898\u3002</p> <p>\u53e6\u5916\uff0cMySQL \u9488\u5bf9 young \u533a\u57df\u5176\u5b9e\u505a\u4e86\u4e00\u4e2a\u4f18\u5316\uff0c\u4e3a\u4e86\u9632\u6b62 young \u533a\u57df\u8282\u70b9\u9891\u7e41\u79fb\u52a8\u5230\u5934\u90e8\u3002young \u533a\u57df\u524d\u9762 1/4 \u88ab\u8bbf\u95ee\u4e0d\u4f1a\u79fb\u52a8\u5230\u94fe\u8868\u5934\u90e8\uff0c\u53ea\u6709\u540e\u9762\u7684 3/4 \u88ab\u8bbf\u95ee\u4e86\u624d\u4f1a\u3002</p>"},{"location":"mysql/buffer_pool/buffer_pool/#_4","title":"\u810f\u9875\u4ec0\u4e48\u65f6\u5019\u4f1a\u88ab\u5237\u5165\u78c1\u76d8\uff1f","text":"<p>\u5f15\u5165\u4e86 Buffer Pool  \u540e\uff0c\u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u9996\u5148\u662f\u4fee\u6539  Buffer Pool  \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff0c\u4f46\u662f\u78c1\u76d8\u4e2d\u8fd8\u662f\u539f\u6570\u636e\u3002</p> <p>\u56e0\u6b64\uff0c\u810f\u9875\u9700\u8981\u88ab\u5237\u5165\u78c1\u76d8\uff0c\u4fdd\u8bc1\u7f13\u5b58\u548c\u78c1\u76d8\u6570\u636e\u4e00\u81f4\uff0c\u4f46\u662f\u82e5\u6bcf\u6b21\u4fee\u6539\u6570\u636e\u90fd\u5237\u5165\u78c1\u76d8\uff0c\u5219\u6027\u80fd\u4f1a\u5f88\u5dee\uff0c\u56e0\u6b64\u4e00\u822c\u90fd\u4f1a\u5728\u4e00\u5b9a\u65f6\u673a\u8fdb\u884c\u6279\u91cf\u5237\u76d8\u3002</p> <p>\u53ef\u80fd\u5927\u5bb6\u62c5\u5fc3\uff0c\u5982\u679c\u5728\u810f\u9875\u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5237\u5165\u5230\u78c1\u76d8\u65f6\uff0cMySQL \u5b95\u673a\u4e86\uff0c\u4e0d\u5c31\u4e22\u5931\u6570\u636e\u4e86\u5417\uff1f</p> <p>\u8fd9\u4e2a\u4e0d\u7528\u62c5\u5fc3\uff0cInnoDB \u7684\u66f4\u65b0\u64cd\u4f5c\u91c7\u7528\u7684\u662f Write Ahead Log \u7b56\u7565\uff0c\u5373\u5148\u5199\u65e5\u5fd7\uff0c\u518d\u5199\u5165\u78c1\u76d8\uff0c\u901a\u8fc7 redo log \u65e5\u5fd7\u8ba9 MySQL \u62e5\u6709\u4e86\u5d29\u6e83\u6062\u590d\u80fd\u529b\u3002</p> <p>\u4e0b\u9762\u51e0\u79cd\u60c5\u51b5\u4f1a\u89e6\u53d1\u810f\u9875\u7684\u5237\u65b0\uff1a</p> <ul> <li>\u5f53 redo log \u65e5\u5fd7\u6ee1\u4e86\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u4e3b\u52a8\u89e6\u53d1\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\uff1b</li> <li>Buffer Pool \u7a7a\u95f4\u4e0d\u8db3\u65f6\uff0c\u9700\u8981\u5c06\u4e00\u90e8\u5206\u6570\u636e\u9875\u6dd8\u6c70\u6389\uff0c\u5982\u679c\u6dd8\u6c70\u7684\u662f\u810f\u9875\uff0c\u9700\u8981\u5148\u5c06\u810f\u9875\u540c\u6b65\u5230\u78c1\u76d8\uff1b</li> <li>MySQL \u8ba4\u4e3a\u7a7a\u95f2\u65f6\uff0c\u540e\u53f0\u7ebf\u7a0b\u56de\u5b9a\u671f\u5c06\u9002\u91cf\u7684\u810f\u9875\u5237\u5165\u5230\u78c1\u76d8\uff1b</li> <li>MySQL \u6b63\u5e38\u5173\u95ed\u4e4b\u524d\uff0c\u4f1a\u628a\u6240\u6709\u7684\u810f\u9875\u5237\u5165\u5230\u78c1\u76d8\uff1b</li> </ul> <p>\u5728\u6211\u4eec\u5f00\u542f\u4e86\u6162 SQL \u76d1\u63a7\u540e\uff0c\u5982\u679c\u4f60\u53d1\u73b0\u300c\u5076\u5c14\u300d\u4f1a\u51fa\u73b0\u4e00\u4e9b\u7528\u65f6\u7a0d\u957f\u7684 SQL\uff0c\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\u810f\u9875\u5728\u5237\u65b0\u5230\u78c1\u76d8\u65f6\u53ef\u80fd\u4f1a\u7ed9\u6570\u636e\u5e93\u5e26\u6765\u6027\u80fd\u5f00\u9500\uff0c\u5bfc\u81f4\u6570\u636e\u5e93\u64cd\u4f5c\u6296\u52a8\u3002</p> <p>\u5982\u679c\u95f4\u65ad\u51fa\u73b0\u8fd9\u79cd\u73b0\u8c61\uff0c\u5c31\u9700\u8981\u8c03\u5927 Buffer Pool \u7a7a\u95f4\u6216 redo log \u65e5\u5fd7\u7684\u5927\u5c0f\u3002</p>"},{"location":"mysql/buffer_pool/buffer_pool/#_5","title":"\u603b\u7ed3","text":"<p>Innodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u7f13\u51b2\u6c60\uff08Buffer Pool\uff09\uff0c\u6765\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\u3002</p> <p>Buffer Pool \u4ee5\u9875\u4e3a\u5355\u4f4d\u7f13\u51b2\u6570\u636e\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>innodb_buffer_pool_size</code> \u53c2\u6570\u8c03\u6574\u7f13\u51b2\u6c60\u7684\u5927\u5c0f\uff0c\u9ed8\u8ba4\u662f 128 M\u3002</p> <p>Innodb \u901a\u8fc7\u4e09\u79cd\u94fe\u8868\u6765\u7ba1\u7406\u7f13\u9875\uff1a</p> <ul> <li>Free List\uff08\u7a7a\u95f2\u9875\u94fe\u8868\uff09\uff0c\u7ba1\u7406\u7a7a\u95f2\u9875\uff1b</li> <li>Flush List\uff08\u810f\u9875\u94fe\u8868\uff09\uff0c\u7ba1\u7406\u810f\u9875\uff1b</li> <li>LRU List\uff0c\u7ba1\u7406\u810f\u9875 + \u5e72\u51c0\u9875\uff0c\u5c06\u6700\u8fd1\u4e14\u7ecf\u5e38\u67e5\u8be2\u7684\u6570\u636e\u7f13\u5b58\u5728\u5176\u4e2d\uff0c\u800c\u4e0d\u5e38\u67e5\u8be2\u7684\u6570\u636e\u5c31\u6dd8\u6c70\u51fa\u53bb\u3002\uff1b</li> </ul> <p>InnoDB \u5bf9 LRU \u505a\u4e86\u4e00\u4e9b\u4f18\u5316\uff0c\u6211\u4eec\u719f\u6089\u7684 LRU \u7b97\u6cd5\u901a\u5e38\u662f\u5c06\u6700\u8fd1\u67e5\u8be2\u7684\u6570\u636e\u653e\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u800c InnoDB \u505a 2 \u70b9\u4f18\u5316\uff1a</p> <ul> <li>\u5c06 LRU \u94fe\u8868 \u5206\u4e3ayoung \u548c old \u4e24\u4e2a\u533a\u57df\uff0c\u52a0\u5165\u7f13\u51b2\u6c60\u7684\u9875\uff0c\u4f18\u5148\u63d2\u5165 old \u533a\u57df\uff1b\u9875\u88ab\u8bbf\u95ee\u65f6\uff0c\u624d\u8fdb\u5165 young \u533a\u57df\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u9884\u8bfb\u5931\u6548\u7684\u95ee\u9898\u3002</li> <li>\u5f53\u300c\u9875\u88ab\u8bbf\u95ee\u300d\u4e14\u300cold \u533a\u57df\u505c\u7559\u65f6\u95f4\u8d85\u8fc7 <code>innodb_old_blocks_time</code> \u9608\u503c\uff08\u9ed8\u8ba4\u4e3a 1 \u79d2\uff09\u300d\u65f6\uff0c\u624d\u4f1a\u5c06\u9875\u63d2\u5165\u5230 young \u533a\u57df\uff0c\u5426\u5219\u8fd8\u662f\u63d2\u5165\u5230 old \u533a\u57df\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u6279\u91cf\u6570\u636e\u8bbf\u95ee\uff0c\u5927\u91cf\u70ed\u6570\u636e\u6dd8\u6c70\u7684\u95ee\u9898\u3002</li> </ul> <p>\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 <code>innodb_old_blocks_pct</code> \u53c2\u6570\uff0c\u8bbe\u7f6e  young \u533a\u57df\u548c old \u533a\u57df\u6bd4\u4f8b\u3002</p> <p>\u5728\u5f00\u542f\u4e86\u6162 SQL \u76d1\u63a7\u540e\uff0c\u5982\u679c\u4f60\u53d1\u73b0\u300c\u5076\u5c14\u300d\u4f1a\u51fa\u73b0\u4e00\u4e9b\u7528\u65f6\u7a0d\u957f\u7684 SQL\uff0c\u8fd9\u53ef\u56e0\u4e3a\u810f\u9875\u5728\u5237\u65b0\u5230\u78c1\u76d8\u65f6\u5bfc\u81f4\u6570\u636e\u5e93\u6027\u80fd\u6296\u52a8\u3002\u5982\u679c\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u51fa\u73b0\u8fd9\u79cd\u73b0\u8c61\uff0c\u5c31\u9700\u8981\u8c03\u5927 Buffer Pool \u7a7a\u95f4\u6216 redo log \u65e5\u5fd7\u7684\u5927\u5c0f\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/index/2000w/","title":"MySQL \u5355\u8868\u4e0d\u8981\u8d85\u8fc7 2000W \u884c\uff0c\u9760\u8c31\u5417\uff1f","text":"<p>\u4f5c\u4e3a\u5728\u540e\u7aef\u5708\u5f00\u8f66\u7684\u591a\u5e74\u8001\u53f8\u673a\uff0c\u662f\u4e0d\u662f\u7ecf\u5e38\u542c\u5230\u8fc7\uff1a</p> <ul> <li>\u201cMySQL \u5355\u8868\u6700\u597d\u4e0d\u8981\u8d85\u8fc7 2000W\u201d</li> <li>\u201c\u5355\u8868\u8d85\u8fc7 2000W \u5c31\u8981\u8003\u8651\u6570\u636e\u8fc1\u79fb\u4e86\u201d</li> <li>\u201c\u4f60\u8fd9\u4e2a\u8868\u6570\u636e\u90fd\u9a6c\u4e0a\u8981\u5230 2000W \u4e86\uff0c\u96be\u602a\u67e5\u8be2\u901f\u5ea6\u6162\u201d</li> </ul> <p>\u8fd9\u4e9b\u540d\u8a00\u6c11\u8bed\u5c31\u548c\u201c\u7fa4\u91cc\u53ea\u8ba8\u8bba\u6280\u672f\uff0c\u4e0d\u5f00\u8f66\uff0c\u5f00\u8f66\u901f\u5ea6\u4e0d\u8981\u8d85\u8fc7 120 \u7801\uff0c\u5426\u5219\u81ea\u52a8\u8e22\u7fa4\u201d\uff0c\u53ea\u542c\u8fc7\uff0c\u6ca1\u8bd5\u8fc7\uff0c\u54c8\u54c8\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u5c31\u628a\u8f66\u901f\u8e29\u5230\u5e95\uff0c\u5e72\u5230 180 \u7801\u8bd5\u8bd5\u2026\u2026.</p> <p>\u539f\u6587\u94fe\u63a5\uff1ahttps://my.oschina.net/u/4090830/blog/5559454</p>"},{"location":"mysql/index/2000w/#_1","title":"\u5b9e\u9a8c","text":"<p>\u5b9e\u9a8c\u4e00\u628a\u770b\u770b\u2026\u2026 \u5efa\u4e00\u5f20\u8868</p> SQL<pre><code>CREATE TABLE person(\n    id int NOT NULL AUTO_INCREMENT PRIMARY KEY comment '\u4e3b\u952e',\n    person_id tinyint not null comment '\u7528\u6237 id',\n    person_name VARCHAR(200) comment '\u7528\u6237\u540d\u79f0',\n    gmt_create datetime comment '\u521b\u5efa\u65f6\u95f4',\n    gmt_modified datetime comment '\u4fee\u6539\u65f6\u95f4'\n) comment '\u4eba\u5458\u4fe1\u606f\u8868';\n</code></pre> <p>\u63d2\u5165\u4e00\u6761\u6570\u636e</p> SQL<pre><code>insert into person values(1, 1,'user_1', NOW(), now());\n</code></pre> <p>\u5229\u7528 MySQL \u4f2a\u5217 rownum \u8bbe\u7f6e\u4f2a\u5217\u8d77\u59cb\u70b9\u4e3a 1</p> SQL<pre><code>select (@i:=@i+1) as rownum, person_name from person, (select @i:=100) as init; \nset @i=1;\n</code></pre> <p>\u8fd0\u884c\u4e0b\u9762\u7684 sql\uff0c\u8fde\u7eed\u6267\u884c 20 \u6b21\uff0c\u5c31\u662f 2 \u7684 20 \u6b21\u65b9\u7ea6\u7b49\u4e8e 100w \u7684\u6570\u636e\uff1b\u6267\u884c 23 \u6b21\u5c31\u662f 2 \u7684 23 \u6b21\u65b9\u7ea6\u7b49\u4e8e 800w , \u5982\u6b64\u4e0b\u53bb\u5373\u53ef\u5b9e\u73b0\u5343\u4e07\u6d4b\u8bd5\u6570\u636e\u7684\u63d2\u5165\u3002</p> <p>\u5982\u679c\u4e0d\u60f3\u7ffb\u500d\u7ffb\u500d\u7684\u589e\u52a0\u6570\u636e\uff0c\u800c\u662f\u60f3\u5c11\u91cf\uff0c\u5c11\u91cf\u7684\u589e\u52a0\uff0c\u6709\u4e2a\u6280\u5de7\uff0c\u5c31\u662f\u5728 SQL \u7684\u540e\u9762\u589e\u52a0 where \u6761\u4ef6\uff0c\u5982 id &gt; \u67d0\u4e00\u4e2a\u503c\u53bb\u63a7\u5236\u589e\u52a0\u7684\u6570\u636e\u91cf\u5373\u53ef\u3002</p> SQL<pre><code>insert into person(id, person_id, person_name, gmt_create, gmt_modified)\nselect @i:=@i+1,\nleft(rand()*10,10) as person_id,\nconcat('user_',@i%2048),\ndate_add(gmt_create,interval + @i*cast(rand()*100 as signed) SECOND),\ndate_add(date_add(gmt_modified,interval +@i*cast(rand()*100 as signed) SECOND), interval + cast(rand()*1000000 as signed) SECOND)\nfrom person;\n</code></pre> <p>\u6b64\u5904\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e5f\u8bb8\u4f60\u5728\u6267\u884c\u5230\u8fd1 800w \u6216\u8005 1000w \u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u62a5\u9519\uff1aThe total number of locks exceeds the lock table size\u3002</p> <p>\u8fd9\u662f\u7531\u4e8e\u4f60\u7684\u4e34\u65f6\u8868\u5185\u5b58\u8bbe\u7f6e\u7684\u4e0d\u591f\u5927\uff0c\u53ea\u9700\u8981\u6269\u5927\u4e00\u4e0b\u8bbe\u7f6e\u53c2\u6570\u5373\u53ef\u3002</p> SQL<pre><code>SET GLOBAL tmp_table_size =512*1024*1024; \uff08512M\uff09\nSET global innodb_buffer_pool_size= 1*1024*1024*1024 (1G);\n</code></pre> <p>\u5148\u6765\u770b\u4e00\u7ec4\u6d4b\u8bd5\u6570\u636e\uff0c\u8fd9\u7ec4\u6570\u636e\u662f\u5728 MySQL 8.0 \u7684\u7248\u672c\uff0c\u5e76\u4e14\u662f\u5728\u6211\u672c\u673a\u4e0a\uff0c\u7531\u4e8e\u672c\u673a\u8fd8\u8dd1\u7740 idea , \u6d4f\u89c8\u5668\u7b49\u5404\u79cd\u5de5\u5177\uff0c\u6240\u4ee5\u5e76\u4e0d\u662f\u673a\u5668\u914d\u7f6e\u5c31\u662f\u7528\u4e8e\u6570\u636e\u5e93\u914d\u7f6e\uff0c\u6240\u4ee5\u6d4b\u8bd5\u6570\u636e\u53ea\u9650\u4e8e\u53c2\u8003\u3002</p> <p></p> <p></p> <p>\u770b\u5230\u8fd9\u7ec4\u6570\u636e\u4f3c\u4e4e\u597d\u50cf\u771f\u7684\u548c\u6807\u9898\u5bf9\u5e94\uff0c\u5f53\u6570\u636e\u8fbe\u5230 2000W \u4ee5\u540e\uff0c\u67e5\u8be2\u65f6\u957f\u6025\u5267\u4e0a\u5347\uff0c\u96be\u9053\u8fd9\u5c31\u662f\u94c1\u5f8b\u5417\uff1f</p> <p>\u90a3\u4e0b\u9762\u6211\u4eec\u5c31\u6765\u770b\u770b\u8fd9\u4e2a\u5efa\u8bae\u503c 2000W \u662f\u600e\u4e48\u6765\u7684\uff1f</p>"},{"location":"mysql/index/2000w/#_2","title":"\u5355\u8868\u6570\u91cf\u9650\u5236","text":"<p>\u9996\u5148\u6211\u4eec\u5148\u60f3\u60f3\u6570\u636e\u5e93\u5355\u8868\u884c\u6570\u6700\u5927\u591a\u5927\uff1f</p> SQL<pre><code>CREATE TABLE person(\n    id int(10) NOT NULL AUTO_INCREMENT PRIMARY KEY comment '\u4e3b\u952e',\n    person_id tinyint not null comment '\u7528\u6237 id',\n    person_name VARCHAR(200) comment '\u7528\u6237\u540d\u79f0',\n    gmt_create datetime comment '\u521b\u5efa\u65f6\u95f4',\n    gmt_modified datetime comment '\u4fee\u6539\u65f6\u95f4'\n) comment '\u4eba\u5458\u4fe1\u606f\u8868';\n</code></pre> <p>\u770b\u770b\u4e0a\u9762\u7684\u5efa\u8868 sql\u3002id \u662f\u4e3b\u952e\uff0c\u672c\u8eab\u5c31\u662f\u552f\u4e00\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e3b\u952e\u7684\u5927\u5c0f\u53ef\u4ee5\u9650\u5236\u8868\u7684\u4e0a\u9650\uff1a</p> <ul> <li>\u5982\u679c\u4e3b\u952e\u58f0\u660e <code>int</code> \u7c7b\u578b\uff0c\u4e5f\u5c31\u662f 32 \u4f4d\uff0c\u90a3\u4e48\u652f\u6301  2^32-1 ~~21 \u4ebf\uff1b</li> <li>\u5982\u679c\u4e3b\u952e\u58f0\u660e <code>bigint</code> \u7c7b\u578b\uff0c\u90a3\u5c31\u662f 2^62-1\uff0836893488147419103232\uff09\uff0c\u96be\u4ee5\u60f3\u8c61\u8fd9\u4e2a\u7684\u591a\u5927\u4e86\uff0c\u4e00\u822c\u8fd8\u6ca1\u6709\u5230\u8fd9\u4e2a\u9650\u5236\u4e4b\u524d\uff0c\u53ef\u80fd\u6570\u636e\u5e93\u5df2\u7ecf\u7206\u6ee1\u4e86\uff01\uff01</li> </ul> <p>\u6709\u4eba\u7edf\u8ba1\u8fc7\uff0c\u5982\u679c\u5efa\u8868\u7684\u65f6\u5019\uff0c\u81ea\u589e\u5b57\u6bb5\u9009\u62e9\u65e0\u7b26\u53f7\u7684 bigint , \u90a3\u4e48\u81ea\u589e\u957f\u6700\u5927\u503c\u662f 18446744073709551615\uff0c\u6309\u7167\u4e00\u79d2\u65b0\u589e\u4e00\u6761\u8bb0\u5f55\u7684\u901f\u5ea6\uff0c\u5927\u7ea6\u4ec0\u4e48\u65f6\u5019\u80fd\u7528\u5b8c\uff1f</p> <p></p>"},{"location":"mysql/index/2000w/#_3","title":"\u8868\u7a7a\u95f4","text":"<p>\u4e0b\u9762\u6211\u4eec\u518d\u6765\u770b\u770b\u7d22\u5f15\u7684\u7ed3\u6784\uff0c\u6211\u4eec\u4e0b\u9762\u8bb2\u5185\u5bb9\u90fd\u662f\u57fa\u4e8e Innodb \u5f15\u64ce\u7684\uff0c\u5927\u5bb6\u90fd\u77e5\u9053 Innodb \u7684\u7d22\u5f15\u5185\u90e8\u7528\u7684\u662f B+ \u6811\u3002</p> <p></p> <p>\u8fd9\u5f20\u8868\u6570\u636e\uff0c\u5728\u786c\u76d8\u4e0a\u5b58\u50a8\u4e5f\u662f\u7c7b\u4f3c\u5982\u6b64\u7684\uff0c\u5b83\u5b9e\u9645\u662f\u653e\u5728\u4e00\u4e2a\u53eb person.ibd\uff08innodb data\uff09\u7684\u6587\u4ef6\u4e2d\uff0c\u4e5f\u53eb\u505a\u8868\u7a7a\u95f4\uff1b\u867d\u7136\u6570\u636e\u8868\u4e2d\uff0c\u4ed6\u4eec\u770b\u8d77\u6765\u662f\u4e00\u6761\u8fde\u7740\u4e00\u6761\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\u5728\u6587\u4ef6\u4e2d\u5b83\u88ab\u5206\u6210\u5f88\u591a\u5c0f\u4efd\u7684\u6570\u636e\u9875\uff0c\u800c\u4e14\u6bcf\u4e00\u4efd\u90fd\u662f 16K\u3002</p> <p>\u5927\u6982\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\uff0c\u5f53\u7136\u8fd9\u53ea\u662f\u6211\u4eec\u62bd\u8c61\u51fa\u6765\u7684\uff0c\u5728\u8868\u7a7a\u95f4\u4e2d\u8fd8\u6709\u6bb5\u3001\u533a\u3001\u7ec4\u7b49\u5f88\u591a\u6982\u5ff5\uff0c\u4f46\u662f\u6211\u4eec\u9700\u8981\u8df3\u51fa\u6765\u770b\u3002</p> <p></p>"},{"location":"mysql/index/2000w/#_4","title":"\u9875\u7684\u6570\u636e\u7ed3\u6784","text":"<p>\u5b9e\u9645\u9875\u7684\u5185\u90e8\u7ed3\u6784\u50cf\u662f\u4e0b\u9762\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u770b\u51fa\uff0c\u4e00\u4e2a InnoDB \u6570\u636e\u9875\u7684\u5b58\u50a8\u7a7a\u95f4\u5927\u81f4\u88ab\u5212\u5206\u6210\u4e86 7 \u4e2a\u90e8\u5206\uff0c\u6709\u7684\u90e8\u5206\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u786e\u5b9a\u7684\uff0c\u6709\u7684\u90e8\u5206\u5360\u7528\u7684\u5b57\u8282\u6570\u662f\u4e0d\u786e\u5b9a\u7684\u3002</p> <p>\u5728\u9875\u7684 7 \u4e2a\u7ec4\u6210\u90e8\u5206\u4e2d\uff0c\u6211\u4eec\u81ea\u5df1\u5b58\u50a8\u7684\u8bb0\u5f55\u4f1a\u6309\u7167\u6211\u4eec\u6307\u5b9a\u7684\u884c\u683c\u5f0f\u5b58\u50a8\u5230 <code>User Records</code> \u90e8\u5206\u3002</p> <p>\u4f46\u662f\u5728\u4e00\u5f00\u59cb\u751f\u6210\u9875\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u5e76\u6ca1\u6709 User Records \u8fd9\u4e2a\u90e8\u5206\uff0c\u6bcf\u5f53\u6211\u4eec\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u90fd\u4f1a\u4ece Free Space \u90e8\u5206\uff0c\u4e5f\u5c31\u662f\u5c1a\u672a\u4f7f\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u4e2d\u7533\u8bf7\u4e00\u4e2a\u8bb0\u5f55\u5927\u5c0f\u7684\u7a7a\u95f4\u5212\u5206\u5230 User Records \u90e8\u5206\u3002</p> <p>\u5f53 Free Space \u90e8\u5206\u7684\u7a7a\u95f4\u5168\u90e8\u88ab User Records \u90e8\u5206\u66ff\u4ee3\u6389\u4e4b\u540e\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u8fd9\u4e2a\u9875\u4f7f\u7528\u5b8c\u4e86\uff0c\u5982\u679c\u8fd8\u6709\u65b0\u7684\u8bb0\u5f55\u63d2\u5165\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u53bb\u7533\u8bf7\u65b0\u7684\u9875\u4e86\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u56fe\u793a\u5982\u4e0b\uff1a</p> <p></p> <p>\u521a\u521a\u4e0a\u9762\u8bf4\u5230\u4e86\u6570\u636e\u7684\u65b0\u589e\u7684\u8fc7\u7a0b\u3002</p> <p>\u90a3\u4e0b\u9762\u5c31\u6765\u8bf4\u8bf4\uff0c\u6570\u636e\u7684\u67e5\u627e\u8fc7\u7a0b\uff0c\u5047\u5982\u6211\u4eec\u9700\u8981\u67e5\u627e\u4e00\u6761\u8bb0\u5f55\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8868\u7a7a\u95f4\u4e2d\u7684\u6bcf\u4e00\u9875\u90fd\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u7136\u540e\u5bf9\u8bb0\u5f55\u6328\u4e2a\u5224\u65ad\u662f\u4e0d\u662f\u6211\u4eec\u60f3\u8981\u7684\u3002</p> <p>\u5728\u6570\u636e\u91cf\u5c0f\u7684\u65f6\u5019\uff0c\u6ca1\u5565\u95ee\u9898\uff0c\u5185\u5b58\u4e5f\u53ef\u4ee5\u6491\u3002\u4f46\u662f\u73b0\u5b9e\u5c31\u662f\u8fd9\u4e48\u6b8b\u9177\uff0c\u4e0d\u4f1a\u7ed9\u4f60\u8fd9\u4e2a\u5c40\u9762\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u95ee\u9898\uff0cMySQL \u4e2d\u5c31\u6709\u4e86\u7d22\u5f15\u7684\u6982\u5ff5\uff0c\u5927\u5bb6\u90fd\u77e5\u9053\u7d22\u5f15\u80fd\u591f\u52a0\u5feb\u6570\u636e\u7684\u67e5\u8be2\uff0c\u90a3\u5230\u5e95\u662f\u600e\u4e48\u4e2a\u56de\u4e8b\u5462\uff1f\u4e0b\u9762\u6211\u5c31\u6765\u770b\u770b\u3002</p>"},{"location":"mysql/index/2000w/#_5","title":"\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784","text":"<p>\u5728 MySQL \u4e2d\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u548c\u521a\u521a\u63cf\u8ff0\u7684\u9875\u51e0\u4e4e\u662f\u4e00\u6a21\u4e00\u6837\u7684\uff0c\u800c\u4e14\u5927\u5c0f\u4e5f\u662f 16K,\u3002</p> <p>\u4f46\u662f\u5728\u7d22\u5f15\u9875\u4e2d\u8bb0\u5f55\u7684\u662f\u9875 (\u6570\u636e\u9875\uff0c\u7d22\u5f15\u9875) \u7684\u6700\u5c0f\u4e3b\u952e id \u548c\u9875\u53f7\uff0c\u4ee5\u53ca\u5728\u7d22\u5f15\u9875\u4e2d\u589e\u52a0\u4e86\u5c42\u7ea7\u7684\u4fe1\u606f\uff0c\u4ece 0 \u5f00\u59cb\u5f80\u4e0a\u7b97\uff0c\u6240\u4ee5\u9875\u4e0e\u9875\u4e4b\u95f4\u5c31\u6709\u4e86\u4e0a\u4e0b\u5c42\u7ea7\u7684\u6982\u5ff5\u3002</p> <p></p> <p>\u770b\u5230\u8fd9\u4e2a\u56fe\u4e4b\u540e\uff0c\u662f\u4e0d\u662f\u6709\u70b9\u4f3c\u66fe\u76f8\u4f3c\u7684\u611f\u89c9\uff0c\u662f\u4e0d\u662f\u50cf\u4e00\u68f5\u4e8c\u53c9\u6811\u554a\uff0c\u5bf9\uff0c\u6ca1\u9519\uff01\u5b83\u5c31\u662f\u4e00\u68f5\u6811\u3002</p> <p>\u53ea\u4e0d\u8fc7\u6211\u4eec\u5728\u8fd9\u91cc\u53ea\u662f\u7b80\u5355\u753b\u4e86\u4e09\u4e2a\u8282\u70b9\uff0c2 \u5c42\u7ed3\u6784\u7684\u800c\u5df2\uff0c\u5982\u679c\u6570\u636e\u591a\u4e86\uff0c\u53ef\u80fd\u5c31\u4f1a\u6269\u5c55\u5230 3 \u5c42\u7684\u6811\uff0c\u8fd9\u4e2a\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684 B+ \u6811\uff0c\u6700\u4e0b\u9762\u90a3\u4e00\u5c42\u7684 page level =0, \u4e5f\u5c31\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u5176\u4f59\u90fd\u662f\u975e\u53f6\u5b50\u8282\u70b9\u3002</p> <p></p> <p>\u770b\u4e0a\u56fe\u4e2d\uff0c\u6211\u4eec\u662f\u5355\u62ff\u4e00\u4e2a\u8282\u70b9\u6765\u770b\uff0c\u9996\u5148\u5b83\u662f\u4e00\u4e2a\u975e\u53f6\u5b50\u8282\u70b9\uff08\u7d22\u5f15\u9875\uff09\uff0c\u5728\u5b83\u7684\u5185\u5bb9\u533a\u4e2d\u6709 id \u548c \u9875\u53f7\u5730\u5740\u4e24\u90e8\u5206\uff1a</p> <ul> <li>id\uff1a\u5bf9\u5e94\u9875\u4e2d\u8bb0\u5f55\u7684\u6700\u5c0f\u8bb0\u5f55 id \u503c\uff1b</li> <li>\u9875\u53f7\uff1a\u5730\u5740\u662f\u6307\u5411\u5bf9\u5e94\u9875\u7684\u6307\u9488\uff1b</li> </ul> <p>\u800c\u6570\u636e\u9875\u4e0e\u6b64\u51e0\u4e4e\u5927\u540c\u5c0f\u5f02\uff0c\u533a\u522b\u5728\u4e8e\u6570\u636e\u9875\u8bb0\u5f55\u7684\u662f\u771f\u5b9e\u7684\u884c\u6570\u636e\u800c\u4e0d\u662f\u9875\u5730\u5740\uff0c\u800c\u4e14 id \u7684\u4e5f\u662f\u987a\u5e8f\u7684\u3002</p>"},{"location":"mysql/index/2000w/#_6","title":"\u5355\u8868\u5efa\u8bae\u503c","text":"<p>\u4e0b\u9762\u6211\u4eec\u5c31\u4ee5 3 \u5c42\uff0c2 \u5206\u53c9\uff08\u5b9e\u9645\u4e2d\u662f M \u5206\u53c9\uff09\u7684\u56fe\u4f8b\u6765\u8bf4\u660e\u4e00\u4e0b\u67e5\u627e\u4e00\u4e2a\u884c\u6570\u636e\u7684\u8fc7\u7a0b\u3002</p> <p></p> <p>\u6bd4\u5982\u8bf4\u6211\u4eec\u9700\u8981\u67e5\u627e\u4e00\u4e2a id=6 \u7684\u884c\u6570\u636e\uff1a</p> <ul> <li>\u56e0\u4e3a\u5728\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u5b58\u653e\u7684\u662f\u9875\u53f7\u548c\u8be5\u9875\u6700\u5c0f\u7684 id\uff0c\u6240\u4ee5\u6211\u4eec\u4ece\u9876\u5c42\u5f00\u59cb\u5bf9\u6bd4\uff0c\u9996\u5148\u770b\u9875\u53f7 10 \u4e2d\u7684\u76ee\u5f55\uff0c\u6709 [id=1, \u9875\u53f7 = 20],[id=5, \u9875\u53f7 = 30], \u8bf4\u660e\u5de6\u4fa7\u8282\u70b9\u6700\u5c0f id \u4e3a 1\uff0c\u53f3\u4fa7\u8282\u70b9\u6700\u5c0f id \u662f 5\u30026&gt;5, \u90a3\u6309\u7167\u4e8c\u5206\u6cd5\u67e5\u627e\u7684\u89c4\u5219\uff0c\u80af\u5b9a\u5c31\u5f80\u53f3\u4fa7\u8282\u70b9\u7ee7\u7eed\u67e5\u627e\uff1b</li> <li>\u627e\u5230\u9875\u53f7 30 \u7684\u8282\u70b9\u540e\uff0c\u53d1\u73b0\u8fd9\u4e2a\u8282\u70b9\u8fd8\u6709\u5b50\u8282\u70b9\uff08\u975e\u53f6\u5b50\u8282\u70b9\uff09\uff0c\u90a3\u5c31\u7ee7\u7eed\u6bd4\u5bf9\uff0c\u540c\u7406\uff0c6&gt;5 &amp;&amp; 6&lt;7, \u6240\u4ee5\u627e\u5230\u4e86\u9875\u53f7 60\uff1b</li> <li>\u627e\u5230\u9875\u53f7 60 \u4e4b\u540e\uff0c\u53d1\u73b0\u6b64\u8282\u70b9\u4e3a\u53f6\u5b50\u8282\u70b9\uff08\u6570\u636e\u8282\u70b9\uff09\uff0c\u4e8e\u662f\u5c06\u6b64\u9875\u6570\u636e\u52a0\u8f7d\u81f3\u5185\u5b58\u8fdb\u884c\u4e00\u4e00\u5bf9\u6bd4\uff0c\u7ed3\u679c\u627e\u5230\u4e86 id=6 \u7684\u6570\u636e\u884c\u3002</li> </ul> <p>\u4ece\u4e0a\u8ff0\u7684\u8fc7\u7a0b\u4e2d\u53d1\u73b0\uff0c\u6211\u4eec\u4e3a\u4e86\u67e5\u627e id=6 \u7684\u6570\u636e\uff0c\u603b\u5171\u67e5\u8be2\u4e86\u4e09\u4e2a\u9875\uff0c\u5982\u679c\u4e09\u4e2a\u9875\u90fd\u5728\u78c1\u76d8\u4e2d\uff08\u672a\u63d0\u524d\u52a0\u8f7d\u81f3\u5185\u5b58\uff09\uff0c\u90a3\u4e48\u6700\u591a\u9700\u8981\u7ecf\u5386\u4e09\u6b21\u7684\u78c1\u76d8 IO\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56fe\u4e2d\u7684\u9875\u53f7\u53ea\u662f\u4e2a\u793a\u4f8b\uff0c\u5b9e\u9645\u60c5\u51b5\u4e0b\u5e76\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u5728\u78c1\u76d8\u4e2d\u5b58\u50a8\u4e5f\u4e0d\u4e00\u5b9a\u662f\u987a\u5e8f\u7684\u3002</p> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u5927\u6982\u5df2\u7ecf\u4e86\u89e3\u4e86\u8868\u7684\u6570\u636e\u662f\u600e\u4e48\u4e2a\u7ed3\u6784\u4e86\uff0c\u4e5f\u5927\u6982\u77e5\u9053\u67e5\u8be2\u6570\u636e\u662f\u4e2a\u600e\u4e48\u7684\u8fc7\u7a0b\u4e86\uff0c\u8fd9\u6837\u6211\u4eec\u4e5f\u5c31\u80fd\u5927\u6982\u4f30\u7b97\u8fd9\u6837\u7684\u7ed3\u6784\u80fd\u5b58\u653e\u591a\u5c11\u6570\u636e\u4e86\u3002</p> <p>\u4ece\u4e0a\u9762\u7684\u56fe\u89e3\u6211\u4eec\u77e5\u9053 B+ \u6570\u7684\u53f6\u5b50\u8282\u70b9\u624d\u662f\u5b58\u5728\u6570\u636e\u7684\uff0c\u800c\u975e\u53f6\u5b50\u8282\u70b9\u662f\u7528\u6765\u5b58\u653e\u7d22\u5f15\u6570\u636e\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u540c\u6837\u4e00\u4e2a 16K \u7684\u9875\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u91cc\u7684\u6bcf\u6761\u6570\u636e\u90fd\u6307\u5411\u65b0\u7684\u9875\uff0c\u800c\u65b0\u7684\u9875\u6709\u4e24\u79cd\u53ef\u80fd</p> <ul> <li>\u5982\u679c\u662f\u53f6\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u91cc\u9762\u5c31\u662f\u4e00\u884c\u884c\u7684\u6570\u636e</li> <li>\u5982\u679c\u662f\u975e\u53f6\u5b50\u8282\u70b9\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u4f1a\u7ee7\u7eed\u6307\u5411\u65b0\u7684\u9875</li> </ul> <p>\u5047\u8bbe</p> <ul> <li>\u975e\u53f6\u5b50\u8282\u70b9\u5185\u6307\u5411\u5176\u4ed6\u9875\u7684\u6570\u91cf\u4e3a x</li> <li>\u53f6\u5b50\u8282\u70b9\u5185\u80fd\u5bb9\u7eb3\u7684\u6570\u636e\u884c\u6570\u4e3a y</li> <li>B+ \u6570\u7684\u5c42\u6570\u4e3a z</li> </ul> <p>\u5982\u4e0b\u56fe\u4e2d\u6240\u793a\uff0cTotal =x^(z-1) *y \u4e5f\u5c31\u662f\u8bf4\u603b\u6570\u4f1a\u7b49\u4e8e x \u7684 z-1 \u6b21\u65b9 \u4e0e Y \u7684\u4e58\u79ef\u3002</p> <p></p> <p>X =\uff1f</p> <p>\u5728\u6587\u7ae0\u7684\u5f00\u5934\u5df2\u7ecf\u4ecb\u7ecd\u4e86\u9875\u7684\u7ed3\u6784\uff0c\u7d22\u5f15\u4e5f\u4e5f\u4e0d\u4f8b\u5916\uff0c\u90fd\u4f1a\u6709 File Header (38 byte)\u3001Page Header (56 Byte)\u3001Infimum + Supermum\uff0826 byte\uff09\u3001File Trailer\uff088byte\uff09, \u518d\u52a0\u4e0a\u9875\u76ee\u5f55\uff0c\u5927\u6982 1k \u5de6\u53f3\u3002</p> <p>\u6211\u4eec\u5c31\u5f53\u505a\u5b83\u5c31\u662f 1K, \u90a3\u6574\u4e2a\u9875\u7684\u5927\u5c0f\u662f 16K, \u5269\u4e0b 15k \u7528\u4e8e\u5b58\u6570\u636e\uff0c\u5728\u7d22\u5f15\u9875\u4e2d\u4e3b\u8981\u8bb0\u5f55\u7684\u662f\u4e3b\u952e\u4e0e\u9875\u53f7\uff0c\u4e3b\u952e\u6211\u4eec\u5047\u8bbe\u662f Bigint (8 byte), \u800c\u9875\u53f7\u4e5f\u662f\u56fa\u5b9a\u7684\uff084Byte\uff09, \u90a3\u4e48\u7d22\u5f15\u9875\u4e2d\u7684\u4e00\u6761\u6570\u636e\u4e5f\u5c31\u662f 12byte\u3002</p> <p>\u6240\u4ee5 x=15*1024/12\u22481280 \u884c\u3002</p> <p>Y=\uff1f</p> <p>\u53f6\u5b50\u8282\u70b9\u548c\u975e\u53f6\u5b50\u8282\u70b9\u7684\u7ed3\u6784\u662f\u4e00\u6837\u7684\uff0c\u540c\u7406\uff0c\u80fd\u653e\u6570\u636e\u7684\u7a7a\u95f4\u4e5f\u662f 15k\u3002</p> <p>\u4f46\u662f\u53f6\u5b50\u8282\u70b9\u4e2d\u5b58\u653e\u7684\u662f\u771f\u6b63\u7684\u884c\u6570\u636e\uff0c\u8fd9\u4e2a\u5f71\u54cd\u7684\u56e0\u7d20\u5c31\u4f1a\u591a\u5f88\u591a\uff0c\u6bd4\u5982\uff0c\u5b57\u6bb5\u7684\u7c7b\u578b\uff0c\u5b57\u6bb5\u7684\u6570\u91cf\u3002\u6bcf\u884c\u6570\u636e\u5360\u7528\u7a7a\u95f4\u8d8a\u5927\uff0c\u9875\u4e2d\u6240\u653e\u7684\u884c\u6570\u91cf\u5c31\u4f1a\u8d8a\u5c11\u3002</p> <p>\u8fd9\u8fb9\u6211\u4eec\u6682\u65f6\u6309\u4e00\u6761\u884c\u6570\u636e 1k \u6765\u7b97\uff0c\u90a3\u4e00\u9875\u5c31\u80fd\u5b58\u4e0b 15 \u6761\uff0cY = 15*1024/1000  \u224815\u3002</p> <p>\u7b97\u5230\u8fd9\u8fb9\u4e86\uff0c\u662f\u4e0d\u662f\u5fc3\u91cc\u5df2\u7ecf\u6709\u8c31\u4e86\u554a\u3002</p> <p>\u6839\u636e\u4e0a\u8ff0\u7684\u516c\u5f0f\uff0cTotal =x^(z-1) *y\uff0c\u5df2\u77e5 x=1280\uff0cy=15\uff1a</p> <ul> <li>\u5047\u8bbe B+ \u6811\u662f\u4e24\u5c42\uff0c\u90a3\u5c31\u662f z = 2\uff0cTotal = \uff081280 ^1\uff09*15 = 19200</li> <li>\u5047\u8bbe B+ \u6811\u662f\u4e09\u5c42\uff0c\u90a3\u5c31\u662f z = 3\uff0cTotal = \uff081280 ^2\uff09 *15 = 24576000\uff08\u7ea6 2.45kw\uff09</li> </ul> <p>\u54ce\u5440\uff0c\u5988\u5440\uff01\u8fd9\u4e0d\u662f\u6b63\u597d\u5c31\u662f\u6587\u7ae0\u5f00\u5934\u8bf4\u7684\u6700\u5927\u884c\u6570\u5efa\u8bae\u503c 2000W \u561b\uff01\u5bf9\u7684\uff0c\u4e00\u822c B+ \u6570\u7684\u5c42\u7ea7\u6700\u591a\u4e5f\u5c31\u662f 3 \u5c42\u3002</p> <p>\u4f60\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u662f 4 \u5c42\uff0c\u9664\u4e86\u67e5\u8be2\u7684\u65f6\u5019\u78c1\u76d8 IO \u6b21\u6570\u4f1a\u589e\u52a0\uff0c\u800c\u4e14\u8fd9\u4e2a Total \u503c\u4f1a\u662f\u591a\u5c11\uff0c\u5927\u6982\u5e94\u8be5\u662f 3 \u767e\u591a\u4ebf\u5427\uff0c\u4e5f\u4e0d\u592a\u5408\u7406\uff0c\u6240\u4ee5\uff0c3 \u5c42\u5e94\u8be5\u662f\u6bd4\u8f83\u5408\u7406\u7684\u4e00\u4e2a\u503c\u3002</p> <p>\u5230\u8fd9\u91cc\u96be\u9053\u5c31\u5b8c\u4e86\uff1f</p> <p>\u4e0d\u3002</p> <p>\u6211\u4eec\u521a\u521a\u5728\u8bf4 Y \u7684\u503c\u65f6\u5019\u5047\u8bbe\u7684\u662f 1K\uff0c\u90a3\u6bd4\u5982\u6211\u5b9e\u9645\u5f53\u884c\u7684\u6570\u636e\u5360\u7528\u7a7a\u95f4\u4e0d\u662f 1K , \u800c\u662f 5K, \u90a3\u4e48\u5355\u4e2a\u6570\u636e\u9875\u6700\u591a\u53ea\u80fd\u653e\u4e0b 3 \u6761\u6570\u636e\u3002</p> <p>\u540c\u6837\uff0c\u8fd8\u662f\u6309\u7167 z = 3 \u7684\u503c\u6765\u8ba1\u7b97\uff0c\u90a3 Total = \uff081280 ^2\uff09 *3 = 4915200\uff08\u8fd1 500w\uff09</p> <p>\u6240\u4ee5\uff0c\u5728\u4fdd\u6301\u76f8\u540c\u7684\u5c42\u7ea7\uff08\u76f8\u4f3c\u67e5\u8be2\u6027\u80fd\uff09\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u884c\u6570\u636e\u5927\u5c0f\u4e0d\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u5b9e\u8fd9\u4e2a\u6700\u5927\u5efa\u8bae\u503c\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u800c\u4e14\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u7684\u8fd8\u6709\u5f88\u591a\u5176\u4ed6\u56e0\u7d20\uff0c\u6bd4\u5982\uff0c\u6570\u636e\u5e93\u7248\u672c\uff0c\u670d\u52a1\u5668\u914d\u7f6e\uff0csql \u7684\u7f16\u5199\u7b49\u7b49\u3002</p> <p>MySQL \u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0c\u4f1a\u5c06\u8868\u7684\u7d22\u5f15\u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u5728 InnoDB buffer size \u8db3\u591f\u7684\u60c5\u51b5\u4e0b\uff0c\u5176\u80fd\u5b8c\u6210\u5168\u52a0\u8f7d\u8fdb\u5185\u5b58\uff0c\u67e5\u8be2\u4e0d\u4f1a\u6709\u95ee\u9898\u3002</p> <p>\u4f46\u662f\uff0c\u5f53\u5355\u8868\u6570\u636e\u5e93\u5230\u8fbe\u67d0\u4e2a\u91cf\u7ea7\u7684\u4e0a\u9650\u65f6\uff0c\u5bfc\u81f4\u5185\u5b58\u65e0\u6cd5\u5b58\u50a8\u5176\u7d22\u5f15\uff0c\u4f7f\u5f97\u4e4b\u540e\u7684 SQL \u67e5\u8be2\u4f1a\u4ea7\u751f\u78c1\u76d8 IO\uff0c\u4ece\u800c\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\uff0c\u6240\u4ee5\u589e\u52a0\u786c\u4ef6\u914d\u7f6e\uff08\u6bd4\u5982\u628a\u5185\u5b58\u5f53\u78c1\u76d8\u4f7f\uff09\uff0c\u53ef\u80fd\u4f1a\u5e26\u6765\u7acb\u7aff\u89c1\u5f71\u7684\u6027\u80fd\u63d0\u5347\u54c8\u3002</p>"},{"location":"mysql/index/2000w/#_7","title":"\u603b\u7ed3","text":"<ul> <li>MySQL \u7684\u8868\u6570\u636e\u662f\u4ee5\u9875\u7684\u5f62\u5f0f\u5b58\u653e\u7684\uff0c\u9875\u5728\u78c1\u76d8\u4e2d\u4e0d\u4e00\u5b9a\u662f\u8fde\u7eed\u7684\u3002</li> <li>\u9875\u7684\u7a7a\u95f4\u662f 16K, \u5e76\u4e0d\u662f\u6240\u6709\u7684\u7a7a\u95f4\u90fd\u662f\u7528\u6765\u5b58\u653e\u6570\u636e\u7684\uff0c\u4f1a\u6709\u4e00\u4e9b\u56fa\u5b9a\u7684\u4fe1\u606f\uff0c\u5982\uff0c\u9875\u5934\uff0c\u9875\u5c3e\uff0c\u9875\u7801\uff0c\u6821\u9a8c\u7801\u7b49\u7b49\u3002</li> <li>\u5728 B+ \u6811\u4e2d\uff0c\u53f6\u5b50\u8282\u70b9\u548c\u975e\u53f6\u5b50\u8282\u70b9\u7684\u6570\u636e\u7ed3\u6784\u662f\u4e00\u6837\u7684\uff0c\u533a\u522b\u5728\u4e8e\uff0c\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u7684\u884c\u6570\u636e\uff0c\u800c\u975e\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u548c\u9875\u53f7\u3002</li> <li>\u7d22\u5f15\u7ed3\u6784\u4e0d\u4f1a\u5f71\u54cd\u5355\u8868\u6700\u5927\u884c\u6570\uff0c2000W \u4e5f\u53ea\u662f\u63a8\u8350\u503c\uff0c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u503c\u53ef\u80fd\u4f1a\u5bfc\u81f4 B + \u6811\u5c42\u7ea7\u66f4\u9ad8\uff0c\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/index/count/","title":"count(*) \u548c count(1) \u6709\u4ec0\u4e48\u533a\u522b\uff1f\u54ea\u4e2a\u6027\u80fd\u6700\u597d\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u5f53\u6211\u4eec\u5bf9\u4e00\u5f20\u6570\u636e\u8868\u4e2d\u7684\u8bb0\u5f55\u8fdb\u884c\u7edf\u8ba1\u7684\u65f6\u5019\uff0c\u4e60\u60ef\u90fd\u4f1a\u4f7f\u7528 count \u51fd\u6570\u6765\u7edf\u8ba1\uff0c\u4f46\u662f count \u51fd\u6570\u4f20\u5165\u7684\u53c2\u6570\u6709\u5f88\u591a\u79cd\uff0c\u6bd4\u5982 count(1)\u3001count(<code>*</code>)\u3001count(\u5b57\u6bb5) \u7b49\u3002</p> <p>\u5230\u5e95\u54ea\u79cd\u6548\u7387\u662f\u6700\u597d\u7684\u5462\uff1f\u662f\u4e0d\u662f count(<code>*</code>) \u6548\u7387\u6700\u5dee\uff1f</p> <p>\u6211\u66fe\u7ecf\u4ee5\u4e3a count(<code>*</code>) \u662f\u6548\u7387\u6700\u5dee\u7684\uff0c\u56e0\u4e3a\u8ba4\u77e5\u4e0a <code>selete * from t</code> \u4f1a\u8bfb\u53d6\u6240\u6709\u8868\u4e2d\u7684\u5b57\u6bb5\uff0c\u6240\u4ee5\u51e1\u4e8b\u5e26\u6709 <code>*</code> \u5b57\u7b26\u7684\u5c31\u89c9\u5f97\u4f1a\u8bfb\u53d6\u8868\u4e2d\u6240\u6709\u7684\u5b57\u6bb5\uff0c\u5f53\u65f6\u7f51\u4e0a\u6709\u5f88\u591a\u535a\u5ba2\u4e5f\u8fd9\u4e48\u8bf4\u3002</p> <p>\u4f46\u662f\uff0c\u5f53\u6211\u6df1\u5165 count \u51fd\u6570\u7684\u539f\u7406\u540e\uff0c\u88ab\u556a\u556a\u556a\u7684\u6253\u8138\u4e86\uff01</p> <p>\u4e0d\u591a\u8bf4\uff0c\u53d1\u8f66\uff01</p> <p></p>"},{"location":"mysql/index/count/#count","title":"\u54ea\u79cd count \u6027\u80fd\u6700\u597d\uff1f","text":"<p>\u6211\u5148\u76f4\u63a5\u8bf4\u7ed3\u8bba\uff1a</p> <p></p> <p>\u8981\u5f04\u660e\u767d\u8fd9\u4e2a\uff0c\u6211\u4eec\u5f97\u8981\u6df1\u5165 count \u7684\u539f\u7406\uff0c\u4ee5\u4e0b\u5185\u5bb9\u57fa\u4e8e\u5e38\u7528\u7684 innodb \u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\u660e\u3002</p>"},{"location":"mysql/index/count/#count_1","title":"count() \u662f\u4ec0\u4e48\uff1f","text":"<p>count() \u662f\u4e00\u4e2a\u805a\u5408\u51fd\u6570\uff0c\u51fd\u6570\u7684\u53c2\u6570\u4e0d\u4ec5\u53ef\u4ee5\u662f\u5b57\u6bb5\u540d\uff0c\u4e5f\u53ef\u4ee5\u662f\u5176\u4ed6\u4efb\u610f\u8868\u8fbe\u5f0f\uff0c\u8be5\u51fd\u6570\u4f5c\u7528\u662f\u7edf\u8ba1\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u4e2d\uff0c\u51fd\u6570\u6307\u5b9a\u7684\u53c2\u6570\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u6709\u591a\u5c11\u4e2a\u3002</p> <p>\u5047\u8bbe count() \u51fd\u6570\u7684\u53c2\u6570\u662f\u5b57\u6bb5\u540d\uff0c\u5982\u4e0b\uff1a</p> SQL<pre><code>select count(name) from t_order;\n</code></pre> <p>\u8fd9\u6761\u8bed\u53e5\u662f\u7edf\u8ba1\u300ct_order \u8868\u4e2d\uff0cname \u5b57\u6bb5\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u300d\u6709\u591a\u5c11\u4e2a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u67d0\u4e00\u6761\u8bb0\u5f55\u4e2d\u7684 name \u5b57\u6bb5\u7684\u503c\u4e3a NULL\uff0c\u5219\u5c31\u4e0d\u4f1a\u88ab\u7edf\u8ba1\u8fdb\u53bb\u3002</p> <p>\u518d\u6765\u5047\u8bbe count() \u51fd\u6570\u7684\u53c2\u6570\u662f\u6570\u5b57 1 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\uff0c\u5982\u4e0b\uff1a</p> SQL<pre><code>select count(1) from t_order;\n</code></pre> <p>\u8fd9\u6761\u8bed\u53e5\u662f\u7edf\u8ba1\u300ct_order \u8868\u4e2d\uff0c1 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u300d\u6709\u591a\u5c11\u4e2a\u3002</p> <p>1 \u8fd9\u4e2a\u8868\u8fbe\u5f0f\u5c31\u662f\u5355\u7eaf\u6570\u5b57\uff0c\u5b83\u6c38\u8fdc\u90fd\u4e0d\u662f NULL\uff0c\u6240\u4ee5\u4e0a\u9762\u8fd9\u6761\u8bed\u53e5\uff0c\u5176\u5b9e\u662f\u5728\u7edf\u8ba1 t_order \u8868\u4e2d\u6709\u591a\u5c11\u4e2a\u8bb0\u5f55\u3002</p>"},{"location":"mysql/index/count/#count_2","title":"count(\u4e3b\u952e\u5b57\u6bb5) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>\u5728\u901a\u8fc7 count \u51fd\u6570\u7edf\u8ba1\u6709\u591a\u5c11\u4e2a\u8bb0\u5f55\u65f6\uff0cMySQL \u7684 server \u5c42\u4f1a\u7ef4\u62a4\u4e00\u4e2a\u540d\u53eb count \u7684\u53d8\u91cf\u3002</p> <p>server \u5c42\u4f1a\u5faa\u73af\u5411 InnoDB \u8bfb\u53d6\u4e00\u6761\u8bb0\u5f55\uff0c\u5982\u679c count \u51fd\u6570\u6307\u5b9a\u7684\u53c2\u6570\u4e0d\u4e3a NULL\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06\u53d8\u91cf count \u52a0 1\uff0c\u76f4\u5230\u7b26\u5408\u67e5\u8be2\u7684\u5168\u90e8\u8bb0\u5f55\u88ab\u8bfb\u5b8c\uff0c\u5c31\u9000\u51fa\u5faa\u73af\u3002\u6700\u540e\u5c06 count \u53d8\u91cf\u7684\u503c\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>InnoDB \u662f\u901a\u8fc7 B+ \u6811\u6765\u4fdd\u5b58\u8bb0\u5f55\u7684\uff0c\u6839\u636e\u7d22\u5f15\u7684\u7c7b\u578b\u53c8\u5206\u4e3a\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5b83\u4eec\u533a\u522b\u5728\u4e8e\uff0c\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002</p> <p>\u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u4f5c\u4e3a\u4f8b\u5b50\uff1a</p> SQL<pre><code>//id \u4e3a\u4e3b\u952e\u503c\nselect count(id) from t_order;\n</code></pre> <p>\u5982\u679c\u8868\u91cc\u53ea\u6709\u4e3b\u952e\u7d22\u5f15\uff0c\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0c\u90a3\u4e48\uff0cInnoDB \u5faa\u73af\u904d\u5386\u805a\u7c07\u7d22\u5f15\uff0c\u5c06\u8bfb\u53d6\u5230\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 server \u5c42\uff0c\u7136\u540e\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684 id \u503c\uff0c\u5c31\u4f1a id \u503c\u5224\u65ad\u662f\u5426\u4e3a NULL\uff0c\u5982\u679c\u4e0d\u4e3a NULL\uff0c\u5c31\u5c06 count \u53d8\u91cf\u52a0 1\u3002</p> <p></p> <p>\u4f46\u662f\uff0c\u5982\u679c\u8868\u91cc\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0cInnoDB \u5faa\u73af\u904d\u5386\u7684\u5bf9\u8c61\u5c31\u4e0d\u662f\u805a\u7c07\u7d22\u5f15\uff0c\u800c\u662f\u4e8c\u7ea7\u7d22\u5f15\u3002</p> <p></p> <p>\u8fd9\u662f\u56e0\u4e3a\u76f8\u540c\u6570\u91cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u53ef\u4ee5\u6bd4\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u5360\u7528\u66f4\u5c11\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u6240\u4ee5\u4e8c\u7ea7\u7d22\u5f15\u6811\u6bd4\u805a\u7c07\u7d22\u5f15\u6811\u5c0f\uff0c\u8fd9\u6837\u904d\u5386\u4e8c\u7ea7\u7d22\u5f15\u7684 I/O \u6210\u672c\u6bd4\u904d\u5386\u805a\u7c07\u7d22\u5f15\u7684 I/O \u6210\u672c\u5c0f\uff0c\u56e0\u6b64\u300c\u4f18\u5316\u5668\u300d\u4f18\u5148\u9009\u62e9\u7684\u662f\u4e8c\u7ea7\u7d22\u5f15\u3002</p>"},{"location":"mysql/index/count/#count1","title":"count(1) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>\u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u4f5c\u4e3a\u4f8b\u5b50\uff1a</p> Text Only<pre><code>select count(1) from t_order;\n</code></pre> <p>\u5982\u679c\u8868\u91cc\u53ea\u6709\u4e3b\u952e\u7d22\u5f15\uff0c\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\u3002</p> <p></p> <p>\u90a3\u4e48\uff0cInnoDB \u5faa\u73af\u904d\u5386\u805a\u7c07\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\uff0c\u5c06\u8bfb\u53d6\u5230\u7684\u8bb0\u5f55\u8fd4\u56de\u7ed9 server \u5c42\uff0c\u4f46\u662f\u4e0d\u4f1a\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u4efb\u4f55\u5b57\u6bb5\u7684\u503c\uff0c\u56e0\u4e3a count \u51fd\u6570\u7684\u53c2\u6570\u662f 1\uff0c\u4e0d\u662f\u5b57\u6bb5\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u5b57\u6bb5\u503c\u3002\u53c2\u6570 1 \u5f88\u660e\u663e\u5e76\u4e0d\u662f NULL\uff0c\u56e0\u6b64 server \u5c42\u6bcf\u4ece InnoDB \u8bfb\u53d6\u5230\u4e00\u6761\u8bb0\u5f55\uff0c\u5c31\u5c06 count \u53d8\u91cf\u52a0 1\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0ccount(1) \u76f8\u6bd4 count(\u4e3b\u952e\u5b57\u6bb5) \u5c11\u4e00\u4e2a\u6b65\u9aa4\uff0c\u5c31\u662f\u4e0d\u9700\u8981\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u5b57\u6bb5\u503c\uff0c\u6240\u4ee5\u901a\u5e38\u4f1a\u8bf4 count(1) \u6267\u884c\u6548\u7387\u4f1a\u6bd4 count(\u4e3b\u952e\u5b57\u6bb5) \u9ad8\u4e00\u70b9\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u8868\u91cc\u6709\u4e8c\u7ea7\u7d22\u5f15\u65f6\uff0cInnoDB \u5faa\u73af\u904d\u5386\u7684\u5bf9\u8c61\u5c31\u4e8c\u7ea7\u7d22\u5f15\u4e86\u3002</p> <p></p>"},{"location":"mysql/index/count/#count_3","title":"count(*) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>\u770b\u5230 <code>*</code> \u8fd9\u4e2a\u5b57\u7b26\u7684\u65f6\u5019\uff0c\u662f\u4e0d\u662f\u5927\u5bb6\u89c9\u5f97\u662f\u8bfb\u53d6\u8bb0\u5f55\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\u503c\uff1f</p> <p>\u5bf9\u4e8e <code>select *</code> \u8fd9\u6761\u8bed\u53e5\u6765\u8bf4\u662f\u8fd9\u4e2a\u610f\u601d\uff0c\u4f46\u662f\u5728 count(*)  \u4e2d\u5e76\u4e0d\u662f\u8fd9\u4e2a\u610f\u601d\u3002</p> <p>count(<code>*</code>) \u5176\u5b9e\u7b49\u4e8e count(<code>0</code>)\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u4f60\u4f7f\u7528 count(<code>*</code>)  \u65f6\uff0cMySQL \u4f1a\u5c06 <code>*</code> \u53c2\u6570\u8f6c\u5316\u4e3a\u53c2\u6570 0 \u6765\u5904\u7406\u3002</p> <p></p> <p>\u6240\u4ee5\uff0ccount(*) \u6267\u884c\u8fc7\u7a0b\u8ddf count(1) \u6267\u884c\u8fc7\u7a0b\u57fa\u672c\u4e00\u6837\u7684\uff0c\u6027\u80fd\u6ca1\u6709\u4ec0\u4e48\u5dee\u5f02\u3002</p> <p>\u5728 MySQL 5.7 \u7684\u5b98\u65b9\u624b\u518c\u4e2d\u6709\u8fd9\u4e48\u4e00\u53e5\u8bdd\uff1a</p> <p>InnoDB handles SELECT COUNT(<code>*</code>) and SELECT COUNT(<code>1</code>) operations in the same way. There is no performance difference.</p> <p>\u7ffb\u8bd1\uff1aInnoDB \u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u5904\u7406 SELECT COUNT\uff08<code>*</code>\uff09\u548c SELECT COUNT\uff08<code>1</code>\uff09\u64cd\u4f5c\uff0c\u6ca1\u6709\u6027\u80fd\u5dee\u5f02\u3002</p> <p>\u800c\u4e14 MySQL \u4f1a\u5bf9 count(*) \u548c count(1) \u6709\u4e2a\u4f18\u5316\uff0c\u5982\u679c\u6709\u591a\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u4f18\u5316\u5668\u4f1a\u4f7f\u7528 key_len \u6700\u5c0f\u7684\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u626b\u63cf\u3002</p> <p>\u53ea\u6709\u5f53\u6ca1\u6709\u4e8c\u7ea7\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u91c7\u7528\u4e3b\u952e\u7d22\u5f15\u6765\u8fdb\u884c\u7edf\u8ba1\u3002</p>"},{"location":"mysql/index/count/#count_4","title":"count(\u5b57\u6bb5) \u6267\u884c\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>count(\u5b57\u6bb5) \u7684\u6267\u884c\u6548\u7387\u76f8\u6bd4\u524d\u9762\u7684 count(1)\u3001count(*)\u3001count(\u4e3b\u952e\u5b57\u6bb5) \u6267\u884c\u6548\u7387\u662f\u6700\u5dee\u7684\u3002</p> <p>\u7528\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u4f5c\u4e3a\u4f8b\u5b50\uff1a</p> SQL<pre><code>// name\u4e0d\u662f\u7d22\u5f15\uff0c\u666e\u901a\u5b57\u6bb5\nselect count(name) from t_order;\n</code></pre> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u67e5\u8be2\u6765\u8bf4\uff0c\u4f1a\u91c7\u7528\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u8ba1\u6570\uff0c\u6240\u4ee5\u5b83\u7684\u6267\u884c\u6548\u7387\u662f\u6bd4\u8f83\u5dee\u7684\u3002</p> <p></p>"},{"location":"mysql/index/count/#_1","title":"\u5c0f\u7ed3","text":"<p>count(1)\u3001 count(*)\u3001count(\u4e3b\u952e\u5b57\u6bb5) \u5728\u6267\u884c\u7684\u65f6\u5019\uff0c\u5982\u679c\u8868\u91cc\u5b58\u5728\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f18\u5316\u5668\u5c31\u4f1a\u9009\u62e9\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u626b\u63cf\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u8981\u6267\u884c count(1)\u3001count(*)\u3001count(\u4e3b\u952e\u5b57\u6bb5) \u65f6\uff0c\u5c3d\u91cf\u5728\u6570\u636e\u8868\u4e0a\u5efa\u7acb\u4e8c\u7ea7\u7d22\u5f15\uff0c\u8fd9\u6837\u4f18\u5316\u5668\u4f1a\u81ea\u52a8\u91c7\u7528 key_len \u6700\u5c0f\u7684\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u626b\u63cf\uff0c\u76f8\u6bd4\u4e8e\u626b\u63cf\u4e3b\u952e\u7d22\u5f15\u6548\u7387\u4f1a\u9ad8\u4e00\u4e9b\u3002</p> <p>\u518d\u6765\uff0c\u5c31\u662f\u4e0d\u8981\u4f7f\u7528 count(\u5b57\u6bb5)  \u6765\u7edf\u8ba1\u8bb0\u5f55\u4e2a\u6570\uff0c\u56e0\u4e3a\u5b83\u7684\u6548\u7387\u662f\u6700\u5dee\u7684\uff0c\u4f1a\u91c7\u7528\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1\u3002\u5982\u679c\u4f60\u975e\u8981\u7edf\u8ba1\u8868\u4e2d\u8be5\u5b57\u6bb5\u4e0d\u4e3a NULL \u7684\u8bb0\u5f55\u4e2a\u6570\uff0c\u5efa\u8bae\u7ed9\u8fd9\u4e2a\u5b57\u6bb5\u5efa\u7acb\u4e00\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u3002</p>"},{"location":"mysql/index/count/#_2","title":"\u4e3a\u4ec0\u4e48\u8981\u901a\u8fc7\u904d\u5386\u7684\u65b9\u5f0f\u6765\u8ba1\u6570\uff1f","text":"<p>\u4f60\u53ef\u80fd\u4f1a\u597d\u5947\uff0c\u4e3a\u4ec0\u4e48 count \u51fd\u6570\u9700\u8981\u901a\u8fc7\u904d\u5386\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1\u8bb0\u5f55\u4e2a\u6570\uff1f</p> <p>\u6211\u524d\u9762\u5c06\u7684\u6848\u4f8b\u90fd\u662f\u57fa\u4e8e Innodb \u5b58\u50a8\u5f15\u64ce\u6765\u8bf4\u660e\u7684\uff0c\u4f46\u662f\u5728 MyISAM \u5b58\u50a8\u5f15\u64ce\u91cc\uff0c\u6267\u884c count \u51fd\u6570\u7684\u65b9\u5f0f\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u901a\u5e38\u5728\u6ca1\u6709\u4efb\u4f55\u67e5\u8be2\u6761\u4ef6\u4e0b\u7684 count(*)\uff0cMyISAM \u7684\u67e5\u8be2\u901f\u5ea6\u8981\u660e\u663e\u5feb\u4e8e InnoDB\u3002</p> <p>\u4f7f\u7528 MyISAM \u5f15\u64ce\u65f6\uff0c\u6267\u884c count \u51fd\u6570\u53ea\u9700\u8981 O(1 ) \u590d\u6742\u5ea6\uff0c\u8fd9\u662f\u56e0\u4e3a\u6bcf\u5f20 MyISAM \u7684\u6570\u636e\u8868\u90fd\u6709\u4e00\u4e2a meta \u4fe1\u606f\u6709\u5b58\u50a8\u4e86 row_count \u503c\uff0c\u7531\u8868\u7ea7\u9501\u4fdd\u8bc1\u4e00\u81f4\u6027\uff0c\u6240\u4ee5\u76f4\u63a5\u8bfb\u53d6 row_count  \u503c\u5c31\u662f count \u51fd\u6570\u7684\u6267\u884c\u7ed3\u679c\u3002</p> <p>\u800c InnoDB \u5b58\u50a8\u5f15\u64ce\u662f\u652f\u6301\u4e8b\u52a1\u7684\uff0c\u540c\u4e00\u4e2a\u65f6\u523b\u7684\u591a\u4e2a\u67e5\u8be2\uff0c\u7531\u4e8e\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff08MVCC\uff09\u7684\u539f\u56e0\uff0cInnoDB \u8868\u201c\u5e94\u8be5\u8fd4\u56de\u591a\u5c11\u884c\u201d\u4e5f\u662f\u4e0d\u786e\u5b9a\u7684\uff0c\u6240\u4ee5\u65e0\u6cd5\u50cf MyISAM \u4e00\u6837\uff0c\u53ea\u7ef4\u62a4\u4e00\u4e2a row_count \u53d8\u91cf\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u8868 t_order \u6709 100 \u6761\u8bb0\u5f55\uff0c\u73b0\u5728\u6709\u4e24\u4e2a\u4f1a\u8bdd\u5e76\u884c\u4ee5\u4e0b\u8bed\u53e5\uff1a</p> <p></p> <p>\u5728\u4f1a\u8bdd A \u548c\u4f1a\u8bdd B \u7684\u6700\u540e\u4e00\u4e2a\u65f6\u523b\uff0c\u540c\u65f6\u67e5\u8868 t_order \u7684\u8bb0\u5f55\u603b\u4e2a\u6570\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u663e\u793a\u7684\u7ed3\u679c\u662f\u4e0d\u4e00\u6837\u7684\u3002\u6240\u4ee5\uff0c\u5728\u4f7f\u7528 InnoDB \u5b58\u50a8\u5f15\u64ce\u65f6\uff0c\u5c31\u9700\u8981\u626b\u63cf\u8868\u6765\u7edf\u8ba1\u5177\u4f53\u7684\u8bb0\u5f55\u3002</p> <p>\u800c\u5f53\u5e26\u4e0a where \u6761\u4ef6\u8bed\u53e5\u4e4b\u540e\uff0cMyISAM \u8ddf InnoDB \u5c31\u6ca1\u6709\u533a\u522b\u4e86\uff0c\u5b83\u4eec\u90fd\u9700\u8981\u626b\u63cf\u8868\u6765\u8fdb\u884c\u8bb0\u5f55\u4e2a\u6570\u7684\u7edf\u8ba1\u3002</p>"},{"location":"mysql/index/count/#count_5","title":"\u5982\u4f55\u4f18\u5316  count(*)\uff1f","text":"<p>\u5982\u679c\u5bf9\u4e00\u5f20\u5927\u8868\u7ecf\u5e38\u7528 count(*) \u6765\u505a\u7edf\u8ba1\uff0c\u5176\u5b9e\u662f\u5f88\u4e0d\u597d\u7684\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u6211\u8fd9\u4e2a\u6848\u4f8b\uff0c\u8868 t_order \u5171\u6709 1200+ \u4e07\u6761\u8bb0\u5f55\uff0c\u6211\u4e5f\u521b\u5efa\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u6267\u884c\u4e00\u6b21 <code>select count(*) from t_order</code> \u8981\u82b1\u8d39\u5dee\u4e0d\u591a 5 \u79d2\uff01</p> <p></p> <p>\u9762\u5bf9\u5927\u8868\u7684\u8bb0\u5f55\u7edf\u8ba1\uff0c\u6211\u4eec\u6709\u6ca1\u6709\u4ec0\u4e48\u5176\u4ed6\u66f4\u597d\u7684\u529e\u6cd5\u5462\uff1f</p>"},{"location":"mysql/index/count/#_3","title":"\u7b2c\u4e00\u79cd\uff0c\u8fd1\u4f3c\u503c","text":"<p>\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u5bf9\u4e8e\u7edf\u8ba1\u4e2a\u6570\u4e0d\u9700\u8981\u5f88\u7cbe\u786e\uff0c\u6bd4\u5982\u641c\u7d22\u5f15\u64ce\u5728\u641c\u7d22\u5173\u952e\u8bcd\u7684\u65f6\u5019\uff0c\u7ed9\u51fa\u7684\u641c\u7d22\u7ed3\u679c\u6761\u6570\u662f\u4e00\u4e2a\u5927\u6982\u503c\u3002</p> <p></p> <p>\u8fd9\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 show table status \u6216\u8005 explain \u547d\u4ee4\u6765\u8868\u8fdb\u884c\u4f30\u7b97\u3002</p> <p>\u6267\u884c explain \u547d\u4ee4\u6548\u7387\u662f\u5f88\u9ad8\u7684\uff0c\u56e0\u4e3a\u5b83\u5e76\u4e0d\u4f1a\u771f\u6b63\u7684\u53bb\u67e5\u8be2\uff0c\u4e0b\u56fe\u4e2d\u7684 rows \u5b57\u6bb5\u503c\u5c31\u662f  explain \u547d\u4ee4\u5bf9\u8868 t_order \u8bb0\u5f55\u7684\u4f30\u7b97\u503c\u3002</p> <p></p>"},{"location":"mysql/index/count/#_4","title":"\u7b2c\u4e8c\u79cd\uff0c\u989d\u5916\u8868\u4fdd\u5b58\u8ba1\u6570\u503c","text":"<p>\u5982\u679c\u662f\u60f3\u7cbe\u786e\u7684\u83b7\u53d6\u8868\u7684\u8bb0\u5f55\u603b\u6570\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u8ba1\u6570\u503c\u4fdd\u5b58\u5230\u5355\u72ec\u7684\u4e00\u5f20\u8ba1\u6570\u8868\u4e2d\u3002</p> <p>\u5f53\u6211\u4eec\u5728\u6570\u636e\u8868\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u7684\u540c\u65f6\uff0c\u5c06\u8ba1\u6570\u8868\u4e2d\u7684\u8ba1\u6570\u5b57\u6bb5 + 1\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u65b0\u589e\u548c\u5220\u9664\u64cd\u4f5c\u65f6\uff0c\u6211\u4eec\u9700\u8981\u989d\u5916\u7ef4\u62a4\u8fd9\u4e2a\u8ba1\u6570\u8868\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/index/index_interview/","title":"\u7d22\u5f15\u5e38\u89c1\u9762\u8bd5\u9898","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u9762\u8bd5\u4e2d\uff0cMySQL \u7d22\u5f15\u76f8\u5173\u7684\u95ee\u9898\u57fa\u672c\u90fd\u662f\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u90fd\u662f\u5148\u4ece\u7d22\u5f15\u7684\u57fa\u672c\u539f\u7406\uff0c\u518d\u5230\u7d22\u5f15\u7684\u4f7f\u7528\u573a\u666f\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u7d22\u5f15\u5e95\u5c42\u4f7f\u7528\u4e86\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u548c\u7b97\u6cd5\uff1f</li> <li>\u4e3a\u4ec0\u4e48 MySQL InnoDB  \u9009\u62e9 B+tree \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff1f</li> <li>\u4ec0\u4e48\u65f6\u5019\u9002\u7528\u7d22\u5f15\uff1f</li> <li>\u4ec0\u4e48\u65f6\u5019\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1f</li> <li>\u4ec0\u4e48\u60c5\u51b5\u4e0b\u7d22\u5f15\u4f1a\u5931\u6548\uff1f</li> <li>\u6709\u4ec0\u4e48\u4f18\u5316\u7d22\u5f15\u7684\u65b9\u6cd5\uff1f</li> <li>\u2026\u2026</li> </ul> <p>\u4eca\u5929\u5c31\u5e26\u5927\u5bb6\uff0c\u592f\u5b9e MySQL \u7d22\u5f15\u7684\u77e5\u8bc6\u70b9\u3002</p> <p></p>"},{"location":"mysql/index/index_interview/#_2","title":"\u4ec0\u4e48\u662f\u7d22\u5f15\uff1f","text":"<p>\u5f53\u4f60\u60f3\u67e5\u9605\u4e66\u4e2d\u67d0\u4e2a\u77e5\u8bc6\u7684\u5185\u5bb9\uff0c\u4f60\u4f1a\u9009\u62e9\u4e00\u9875\u4e00\u9875\u7684\u627e\u5462\uff1f\u8fd8\u662f\u5728\u4e66\u7684\u76ee\u5f55\u53bb\u627e\u5462\uff1f</p> <p>\u50bb\u74dc\u90fd\u77e5\u9053\u65f6\u95f4\u662f\u5b9d\u8d35\u7684\uff0c\u5f53\u7136\u662f\u9009\u62e9\u5728\u4e66\u7684\u76ee\u5f55\u53bb\u627e\uff0c\u627e\u5230\u540e\u518d\u7ffb\u5230\u5bf9\u5e94\u7684\u9875\u3002\u4e66\u4e2d\u7684\u76ee\u5f55\uff0c\u5c31\u662f\u5145\u5f53\u7d22\u5f15\u7684\u89d2\u8272\uff0c\u65b9\u4fbf\u6211\u4eec\u5feb\u901f\u67e5\u627e\u4e66\u4e2d\u7684\u5185\u5bb9\uff0c\u6240\u4ee5\u7d22\u5f15\u662f\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u8bbe\u8ba1\u601d\u60f3\u3002</p> <p>\u90a3\u6362\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u7d22\u5f15\u7684\u5b9a\u4e49\u5c31\u662f\u5e2e\u52a9\u5b58\u50a8\u5f15\u64ce\u5feb\u901f\u83b7\u53d6\u6570\u636e\u7684\u4e00\u79cd\u6570\u636e\u7ed3\u6784\uff0c\u5f62\u8c61\u7684\u8bf4\u5c31\u662f\u7d22\u5f15\u662f\u6570\u636e\u7684\u76ee\u5f55\u3002</p> <p>\u6240\u8c13\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u3001\u5982\u4f55\u4e3a\u5b58\u50a8\u7684\u6570\u636e\u5efa\u7acb\u7d22\u5f15\u548c\u5982\u4f55\u66f4\u65b0\u3001\u67e5\u8be2\u6570\u636e\u7b49\u6280\u672f\u7684\u5b9e\u73b0\u65b9\u6cd5\u3002MySQL \u5b58\u50a8\u5f15\u64ce\u6709 MyISAM\u3001InnoDB\u3001Memory\uff0c\u5176\u4e2d InnoDB \u662f\u5728 MySQL 5.5 \u4e4b\u540e\u6210\u4e3a\u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u3002</p> <p>\u4e0b\u56fe\u662f MySQL \u7684\u7ed3\u6784\u56fe\uff0c\u7d22\u5f15\u548c\u6570\u636e\u5c31\u662f\u4f4d\u4e8e\u5b58\u50a8\u5f15\u64ce\u4e2d\uff1a</p> <p></p>"},{"location":"mysql/index/index_interview/#_3","title":"\u7d22\u5f15\u7684\u5206\u7c7b","text":"<p>\u4f60\u77e5\u9053\u7d22\u5f15\u6709\u54ea\u4e9b\u5417\uff1f\u5927\u5bb6\u80af\u5b9a\u90fd\u80fd\u9739\u96f3\u556a\u5566\u5730\u8bf4\u51fa\u805a\u7c07\u7d22\u5f15\u3001\u4e3b\u952e\u7d22\u5f15\u3001\u4e8c\u7ea7\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001hash \u7d22\u5f15\u3001B+\u6811\u7d22\u5f15\u7b49\u7b49\u3002</p> <p>\u7136\u540e\u518d\u95ee\u4f60\uff0c\u4f60\u80fd\u5c06\u8fd9\u4e9b\u7d22\u5f15\u5206\u4e00\u4e0b\u7c7b\u5417\uff1f\u53ef\u80fd\u5927\u5bb6\u5c31\u6709\u70b9\u6a21\u7cca\u4e86\u3002\u5176\u5b9e\uff0c\u8981\u5bf9\u8fd9\u4e9b\u7d22\u5f15\u8fdb\u884c\u5206\u7c7b\uff0c\u8981\u6e05\u695a\u8fd9\u4e9b\u7d22\u5f15\u7684\u4f7f\u7528\u548c\u5b9e\u73b0\u65b9\u5f0f\uff0c\u7136\u540e\u518d\u9488\u5bf9\u6709\u76f8\u540c\u7279\u70b9\u7684\u7d22\u5f15\u5f52\u4e3a\u4e00\u7c7b\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6309\u7167\u56db\u4e2a\u89d2\u5ea6\u6765\u5206\u7c7b\u7d22\u5f15\u3002</p> <ul> <li>\u6309\u300c\u6570\u636e\u7ed3\u6784\u300d\u5206\u7c7b\uff1aB+tree \u7d22\u5f15\u3001Hash \u7d22\u5f15\u3001Full-text \u7d22\u5f15\u3002</li> <li>\u6309\u300c\u7269\u7406\u5b58\u50a8\u300d\u5206\u7c7b\uff1a\u805a\u7c07\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\u3001\u4e8c\u7ea7\u7d22\u5f15\uff08\u8f85\u52a9\u7d22\u5f15\uff09\u3002</li> <li>\u6309\u300c\u5b57\u6bb5\u7279\u6027\u300d\u5206\u7c7b\uff1a\u4e3b\u952e\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u3001\u524d\u7f00\u7d22\u5f15\u3002</li> <li>\u6309\u300c\u5b57\u6bb5\u4e2a\u6570\u300d\u5206\u7c7b\uff1a\u5355\u5217\u7d22\u5f15\u3001\u8054\u5408\u7d22\u5f15\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u6309\u7167\u8fd9\u4e9b\u89d2\u5ea6\u6765\u8bf4\u8bf4\u5404\u7c7b\u7d22\u5f15\u7684\u7279\u70b9\u3002</p>"},{"location":"mysql/index/index_interview/#_4","title":"\u6309\u6570\u636e\u7ed3\u6784\u5206\u7c7b","text":"<p>\u4ece\u6570\u636e\u7ed3\u6784\u7684\u89d2\u5ea6\u6765\u770b\uff0cMySQL \u5e38\u89c1\u7d22\u5f15\u6709 B+Tree \u7d22\u5f15\u3001HASH \u7d22\u5f15\u3001Full-Text \u7d22\u5f15\u3002</p> <p>\u6bcf\u4e00\u79cd\u5b58\u50a8\u5f15\u64ce\u652f\u6301\u7684\u7d22\u5f15\u7c7b\u578b\u4e0d\u4e00\u5b9a\u76f8\u540c\uff0c\u6211\u5728\u8868\u4e2d\u603b\u7ed3\u4e86 MySQL \u5e38\u89c1\u7684\u5b58\u50a8\u5f15\u64ce InnoDB\u3001MyISAM \u548c Memory \u5206\u522b\u652f\u6301\u7684\u7d22\u5f15\u7c7b\u578b\u3002</p> <p></p> <p>InnoDB \u662f\u5728 MySQL 5.5 \u4e4b\u540e\u6210\u4e3a\u9ed8\u8ba4\u7684 MySQL \u5b58\u50a8\u5f15\u64ce\uff0cB+Tree \u7d22\u5f15\u7c7b\u578b\u4e5f\u662f MySQL \u5b58\u50a8\u5f15\u64ce\u91c7\u7528\u6700\u591a\u7684\u7d22\u5f15\u7c7b\u578b\u3002</p> <p>\u5728\u521b\u5efa\u8868\u65f6\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u9009\u62e9\u4e0d\u540c\u7684\u5217\u4f5c\u4e3a\u7d22\u5f15\uff1a</p> <ul> <li>\u5982\u679c\u6709\u4e3b\u952e\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u4e3b\u952e\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff08key\uff09\uff1b</li> <li>\u5982\u679c\u6ca1\u6709\u4e3b\u952e\uff0c\u5c31\u9009\u62e9\u7b2c\u4e00\u4e2a\u4e0d\u5305\u542b NULL \u503c\u7684\u552f\u4e00\u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff08key\uff09\uff1b</li> <li>\u5728\u4e0a\u9762\u4e24\u4e2a\u90fd\u6ca1\u6709\u7684\u60c5\u51b5\u4e0b\uff0cInnoDB \u5c06\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9690\u5f0f\u81ea\u589e id \u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff08key\uff09\uff1b</li> </ul> <p>\u5176\u5b83\u7d22\u5f15\u90fd\u5c5e\u4e8e\u8f85\u52a9\u7d22\u5f15\uff08Secondary Index\uff09\uff0c\u4e5f\u88ab\u79f0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u6216\u975e\u805a\u7c07\u7d22\u5f15\u3002\u521b\u5efa\u7684\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f B+Tree \u7d22\u5f15\u3002</p> <p>\u4e3a\u4e86\u8ba9\u5927\u5bb6\u7406\u89e3 B+Tree \u7d22\u5f15\u7684\u5b58\u50a8\u548c\u67e5\u8be2\u7684\u8fc7\u7a0b\uff0c\u63a5\u4e0b\u6765\u6211\u901a\u8fc7\u4e00\u4e2a\u7b80\u5355\u4f8b\u5b50\uff0c\u8bf4\u660e\u4e00\u4e0b B+Tree \u7d22\u5f15\u5728\u5b58\u50a8\u6570\u636e\u4e2d\u7684\u5177\u4f53\u5b9e\u73b0\u3002</p> <p>\u5148\u521b\u5efa\u4e00\u5f20\u5546\u54c1\u8868\uff0cid \u4e3a\u4e3b\u952e\uff0c\u5982\u4e0b\uff1a</p> SQL<pre><code>CREATE TABLE `product`  (\n  `id` int(11) NOT NULL,\n  `product_no` varchar(20)  DEFAULT NULL,\n  `name` varchar(255) DEFAULT NULL,\n  `price` decimal(10, 2) DEFAULT NULL,\n  PRIMARY KEY (`id`) USING BTREE\n) CHARACTER SET = utf8 COLLATE = utf8_general_ci ROW_FORMAT = Dynamic;\n</code></pre> <p>\u5546\u54c1\u8868\u91cc\uff0c\u6709\u8fd9\u4e9b\u884c\u6570\u636e\uff1a</p> <p></p> <p>\u8fd9\u4e9b\u884c\u6570\u636e\uff0c\u5b58\u50a8\u5728 B+Tree \u7d22\u5f15\u65f6\u662f\u957f\u4ec0\u4e48\u6837\u5b50\u7684\uff1f</p> <p>B+Tree \u662f\u4e00\u79cd\u591a\u53c9\u6811\uff0c\u53f6\u5b50\u8282\u70b9\u624d\u5b58\u653e\u6570\u636e\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u53ea\u5b58\u653e\u7d22\u5f15\uff0c\u800c\u4e14\u6bcf\u4e2a\u8282\u70b9\u91cc\u7684\u6570\u636e\u662f\u6309\u4e3b\u952e\u987a\u5e8f\u5b58\u653e\u7684\u3002\u6bcf\u4e00\u5c42\u7236\u8282\u70b9\u7684\u7d22\u5f15\u503c\u90fd\u4f1a\u51fa\u73b0\u5728\u4e0b\u5c42\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u503c\u4e2d\uff0c\u56e0\u6b64\u5728\u53f6\u5b50\u8282\u70b9\u4e2d\uff0c\u5305\u62ec\u4e86\u6240\u6709\u7684\u7d22\u5f15\u503c\u4fe1\u606f\uff0c\u5e76\u4e14\u6bcf\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u90fd\u6307\u5411\u4e0b\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\uff0c\u5f62\u6210\u4e00\u4e2a\u94fe\u8868\u3002</p> <p>\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u5982\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"mysql/index/index_interview/#_5","title":"\u901a\u8fc7\u4e3b\u952e\u67e5\u8be2\u5546\u54c1\u6570\u636e\u7684\u8fc7\u7a0b","text":"<p>\u6bd4\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u8fd9\u6761\u8bed\u53e5\u4f7f\u7528\u4e86\u4e3b\u952e\u7d22\u5f15\u67e5\u8be2 id \u53f7\u4e3a 5 \u7684\u5546\u54c1\u3002\u67e5\u8be2\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff0cB+Tree \u4f1a\u81ea\u9876\u5411\u4e0b\u9010\u5c42\u8fdb\u884c\u67e5\u627e\uff1a</p> <ul> <li>\u5c06 5 \u4e0e\u6839\u8282\u70b9\u7684\u7d22\u5f15\u6570\u636e (1\uff0c10\uff0c20) \u6bd4\u8f83\uff0c5 \u5728 1 \u548c 10 \u4e4b\u95f4\uff0c\u6240\u4ee5\u6839\u636e B+Tree \u7684\u641c\u7d22\u903b\u8f91\uff0c\u627e\u5230\u7b2c\u4e8c\u5c42\u7684\u7d22\u5f15\u6570\u636e (1\uff0c4\uff0c7)\uff1b</li> <li>\u5728\u7b2c\u4e8c\u5c42\u7684\u7d22\u5f15\u6570\u636e  (1\uff0c4\uff0c7) \u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u56e0\u4e3a 5 \u5728 4 \u548c 7 \u4e4b\u95f4\uff0c\u6240\u4ee5\u627e\u5230\u7b2c\u4e09\u5c42\u7684\u7d22\u5f15\u6570\u636e\uff084\uff0c5\uff0c6\uff09\uff1b</li> <li>\u5728\u53f6\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u6570\u636e\uff084\uff0c5\uff0c6\uff09\u4e2d\u8fdb\u884c\u67e5\u627e\uff0c\u7136\u540e\u6211\u4eec\u627e\u5230\u4e86\u7d22\u5f15\u503c\u4e3a 5 \u7684\u884c\u6570\u636e\u3002</li> </ul> <p>\u6570\u636e\u5e93\u7684\u7d22\u5f15\u548c\u6570\u636e\u90fd\u662f\u5b58\u50a8\u5728\u786c\u76d8\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8bfb\u53d6\u4e00\u4e2a\u8282\u70b9\u5f53\u4f5c\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\u3002\u90a3\u4e48\u4e0a\u9762\u7684\u6574\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u4e00\u5171\u7ecf\u5386\u4e86 3 \u4e2a\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u8fdb\u884c\u4e86 3 \u6b21 I/O \u64cd\u4f5c\u3002</p> <p>B+Tree \u5b58\u50a8\u5343\u4e07\u7ea7\u7684\u6570\u636e\u53ea\u9700\u8981 3-4 \u5c42\u9ad8\u5ea6\u5c31\u53ef\u4ee5\u6ee1\u8db3\uff0c\u8fd9\u610f\u5473\u7740\u4ece\u5343\u4e07\u7ea7\u7684\u8868\u67e5\u8be2\u76ee\u6807\u6570\u636e\u6700\u591a\u9700\u8981 3-4 \u6b21\u78c1\u76d8 I/O\uff0c\u6240\u4ee5B+Tree \u76f8\u6bd4\u4e8e B \u6811\u548c\u4e8c\u53c9\u6811\u6765\u8bf4\uff0c\u6700\u5927\u7684\u4f18\u52bf\u5728\u4e8e\u67e5\u8be2\u6548\u7387\u5f88\u9ad8\uff0c\u56e0\u4e3a\u5373\u4f7f\u5728\u6570\u636e\u91cf\u5f88\u5927\u7684\u60c5\u51b5\uff0c\u67e5\u8be2\u4e00\u4e2a\u6570\u636e\u7684\u78c1\u76d8 I/O \u4f9d\u7136\u7ef4\u6301\u5728 3-4 \u6b21\u3002</p>"},{"location":"mysql/index/index_interview/#_6","title":"\u901a\u8fc7\u4e8c\u7ea7\u7d22\u5f15\u67e5\u8be2\u5546\u54c1\u6570\u636e\u7684\u8fc7\u7a0b","text":"<p>\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree  \u548c\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u533a\u522b\u5982\u4e0b\uff1a</p> <ul> <li>\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree  \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff1b</li> <li>\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree  \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002</li> </ul> <p>\u6211\u8fd9\u91cc\u5c06\u524d\u9762\u7684\u5546\u54c1\u8868\u4e2d\u7684 product_no\uff08\u5546\u54c1\u7f16\u7801\uff09\u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u5982\u4e0b\u56fe\uff0c\u5176\u4e2d\u975e\u53f6\u5b50\u7684 key \u503c\u662f product_no\uff08\u56fe\u4e2d\u6a59\u8272\u90e8\u5206\uff09\uff0c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u6570\u636e\u662f\u4e3b\u952e\u503c\uff08\u56fe\u4e2d\u7eff\u8272\u90e8\u5206\uff09\u3002</p> <p></p> <p>\u5982\u679c\u6211\u7528 product_no \u4e8c\u7ea7\u7d22\u5f15\u67e5\u8be2\u5546\u54c1\uff0c\u5982\u4e0b\u67e5\u8be2\u8bed\u53e5\uff1a</p> SQL<pre><code>select * from product where product_no = '0002';\n</code></pre> <p>\u4f1a\u5148\u68c0\u67e5\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u7684 B+Tree \u7684\u7d22\u5f15\u503c\uff08\u5546\u54c1\u7f16\u7801\uff0cproduct_no\uff09\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u83b7\u53d6\u4e3b\u952e\u503c\uff0c\u7136\u540e\u518d\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 B+Tree \u67e5\u8be2\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u83b7\u53d6\u6574\u884c\u6570\u636e\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u300c\u56de\u8868\u300d\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u67e5\u4e24\u4e2a B+Tree \u624d\u80fd\u67e5\u5230\u6570\u636e\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0d\u8fc7\uff0c\u5f53\u67e5\u8be2\u7684\u6570\u636e\u662f\u80fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u91cc\u67e5\u8be2\u5230\uff0c\u8fd9\u65f6\u5c31\u4e0d\u7528\u518d\u53bb\u4e3b\u952e\u7d22\u5f15\u4e2d\u67e5\u5bfb\u4e86\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a</p> SQL<pre><code>select id from product where product_no = '0002';\n</code></pre> <p>\u8fd9\u79cd\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree \u5c31\u80fd\u67e5\u8be2\u5230\u7ed3\u679c\u7684\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u8986\u76d6\u7d22\u5f15\u300d\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u67e5\u4e00\u4e2a B+Tree \u5c31\u80fd\u627e\u5230\u6570\u636e\u3002</p>"},{"location":"mysql/index/index_interview/#mysql-innodb-btree","title":"\u4e3a\u4ec0\u4e48 MySQL InnoDB  \u9009\u62e9 B+tree \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff1f","text":"<p>\u524d\u9762\u5df2\u7ecf\u8bb2\u4e86 B+Tree \u7684\u7d22\u5f15\u539f\u7406\uff0c\u73b0\u5728\u5c31\u6765\u56de\u7b54\u4e00\u4e0b B+Tree \u76f8\u6bd4\u4e8e B \u6811\u3001\u4e8c\u53c9\u6811\u6216 Hash \u7d22\u5f15\u7ed3\u6784\u7684\u4f18\u52bf\u5728\u54ea\u513f\uff1f</p> <p>\u4e4b\u524d\u6211\u4e5f\u4e13\u95e8\u5199\u8fc7\u4e00\u7bc7\u6587\u7ae0\uff0c\u60f3\u8be6\u7ec6\u4e86\u89e3\u7684\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u300c\u5973\u670b\u53cb\u95ee\u6211\uff1a\u4e3a\u4ec0\u4e48 MySQL \u559c\u6b22 B+ \u6811\uff1f\u6211\u7b11\u7740\u753b\u4e86 20 \u5f20\u56fe\u300d\uff0c\u8fd9\u91cc\u5c31\u7b80\u5355\u505a\u4e2a\u6bd4\u5bf9\u3002</p> <p>1\u3001B+Tree vs B Tree</p> <p>B+Tree \u53ea\u5728\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u6570\u636e\uff0c\u800c B \u6811 \u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e5f\u8981\u5b58\u50a8\u6570\u636e\uff0c\u6240\u4ee5 B+Tree \u7684\u5355\u4e2a\u8282\u70b9\u7684\u6570\u636e\u91cf\u66f4\u5c0f\uff0c\u5728\u76f8\u540c\u7684\u78c1\u76d8 I/O \u6b21\u6570\u4e0b\uff0c\u5c31\u80fd\u67e5\u8be2\u66f4\u591a\u7684\u8282\u70b9\u3002</p> <p>\u53e6\u5916\uff0cB+Tree \u53f6\u5b50\u8282\u70b9\u91c7\u7528\u7684\u662f\u53cc\u94fe\u8868\u8fde\u63a5\uff0c\u9002\u5408 MySQL \u4e2d\u5e38\u89c1\u7684\u57fa\u4e8e\u8303\u56f4\u7684\u987a\u5e8f\u67e5\u627e\uff0c\u800c B \u6811\u65e0\u6cd5\u505a\u5230\u8fd9\u4e00\u70b9\u3002</p> <p>2\u3001B+Tree vs \u4e8c\u53c9\u6811</p> <p>\u5bf9\u4e8e\u6709 N \u4e2a\u53f6\u5b50\u8282\u70b9\u7684 B+Tree\uff0c\u5176\u641c\u7d22\u590d\u6742\u5ea6\u4e3a<code>O(logdN)</code>\uff0c\u5176\u4e2d d \u8868\u793a\u8282\u70b9\u5141\u8bb8\u7684\u6700\u5927\u5b50\u8282\u70b9\u4e2a\u6570\u4e3a d \u4e2a\u3002</p> <p>\u5728\u5b9e\u9645\u7684\u5e94\u7528\u5f53\u4e2d\uff0cd \u503c\u662f\u5927\u4e8e 100 \u7684\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\uff0c\u5373\u4f7f\u6570\u636e\u8fbe\u5230\u5343\u4e07\u7ea7\u522b\u65f6\uff0cB+Tree \u7684\u9ad8\u5ea6\u4f9d\u7136\u7ef4\u6301\u5728 3~4 \u5c42\u5de6\u53f3\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u6b21\u6570\u636e\u67e5\u8be2\u64cd\u4f5c\u53ea\u9700\u8981\u505a 3~4 \u6b21\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\u5c31\u80fd\u67e5\u8be2\u5230\u76ee\u6807\u6570\u636e\u3002</p> <p>\u800c\u4e8c\u53c9\u6811\u7684\u6bcf\u4e2a\u7236\u8282\u70b9\u7684\u513f\u5b50\u8282\u70b9\u4e2a\u6570\u53ea\u80fd\u662f 2 \u4e2a\uff0c\u610f\u5473\u7740\u5176\u641c\u7d22\u590d\u6742\u5ea6\u4e3a <code>O(logN)</code>\uff0c\u8fd9\u5df2\u7ecf\u6bd4 B+Tree \u9ad8\u51fa\u4e0d\u5c11\uff0c\u56e0\u6b64\u4e8c\u53c9\u6811\u68c0\u7d22\u5230\u76ee\u6807\u6570\u636e\u6240\u7ecf\u5386\u7684\u78c1\u76d8 I/O \u6b21\u6570\u8981\u66f4\u591a\u3002</p> <p>3, B+Tree vs Hash</p> <p>Hash \u5728\u505a\u7b49\u503c\u67e5\u8be2\u7684\u65f6\u5019\u6548\u7387\u8d3c\u5feb\uff0c\u641c\u7d22\u590d\u6742\u5ea6\u4e3a O(1)\u3002\u4f46\u4e5f\u6709\u5176\u5c40\u9650\u6027\uff1a</p> <ul> <li> <p>\u6570\u636e\u987a\u5e8f\u6027\uff1a\u54c8\u5e0c\u8868\u65e0\u6cd5\u63d0\u4f9b\u6570\u636e\u7684\u987a\u5e8f\u8bbf\u95ee\uff0c\u66f4\u9002\u5408\u505a\u7b49\u503c\u7684\u67e5\u8be2\u3002\u5f88\u591a\u67e5\u8be2\u4e0d\u4ec5\u9700\u8981\u627e\u5230\u7279\u5b9a\u7684\u952e\u503c\uff0c\u8fd8\u9700\u8981\u6839\u636e\u952e\u503c\u6392\u5e8f\u6765\u8fd4\u56de\u7ed3\u679c\uff0c\u6216\u8005\u6267\u884c\u8303\u56f4\u67e5\u8be2\u3002B+Tree \u53ef\u4ee5\u5f88\u597d\u5730\u652f\u6301\uff0cHash \u8868\u5219\u65e0\u6cd5\u505a\u5230\u3002</p> </li> <li> <p>\u7a7a\u95f4\u6548\u7387\uff1a\u53ef\u80fd\u5bfc\u81f4\u7a7a\u95f4\u5229\u7528\u6548\u7387\u4e0d\u9ad8\uff0c\u7279\u522b\u662f\u5728\u5904\u7406\u5927\u91cf\u6570\u636e\u65f6\u3002\u6570\u636e\u91cf\u53d8\u5927\u65f6\u51b2\u7a81\u4e5f\u4f1a\u589e\u52a0\u3002</p> </li> <li> <p>\u9700\u8981\u91cd\u65b0\u6784\u5efa\uff1a\u54c8\u5e0c\u7d22\u5f15\u901a\u5e38\u53ea\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u5f53\u6570\u636e\u5e93\u91cd\u542f\u6216\u53d1\u751f\u5d29\u6e83\u65f6\uff0c\u9700\u8981\u91cd\u65b0\u6784\u5efa\u3002</p> </li> </ul> <p>\u56e0\u6b64\uff0cB+Tree \u7d22\u5f15\u8981\u6bd4 Hash \u8868\u7d22\u5f15\u6709\u7740\u66f4\u5e7f\u6cdb\u7684\u9002\u7528\u573a\u666f\u3002</p>"},{"location":"mysql/index/index_interview/#_7","title":"\u6309\u7269\u7406\u5b58\u50a8\u5206\u7c7b","text":"<p>\u4ece\u7269\u7406\u5b58\u50a8\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7d22\u5f15\u5206\u4e3a\u805a\u7c07\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\u3001\u4e8c\u7ea7\u7d22\u5f15\uff08\u8f85\u52a9\u7d22\u5f15\uff09\u3002</p> <p>\u8fd9\u4e24\u4e2a\u533a\u522b\u5728\u524d\u9762\u4e5f\u63d0\u5230\u4e86\uff1a</p> <ul> <li>\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree  \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u4e3b\u952e\u7d22\u5f15\u7684 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff1b</li> <li>\u4e8c\u7ea7\u7d22\u5f15\u7684 B+Tree  \u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u5728\u67e5\u8be2\u65f6\u4f7f\u7528\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u80fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u91cc\u67e5\u8be2\u7684\u5230\uff0c\u90a3\u4e48\u5c31\u4e0d\u9700\u8981\u56de\u8868\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u662f\u8986\u76d6\u7d22\u5f15\u3002\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u5728\u4e8c\u7ea7\u7d22\u5f15\u91cc\uff0c\u5c31\u4f1a\u5148\u68c0\u7d22\u4e8c\u7ea7\u7d22\u5f15\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u83b7\u53d6\u5230\u4e3b\u952e\u503c\u540e\uff0c\u7136\u540e\u518d\u68c0\u7d22\u4e3b\u952e\u7d22\u5f15\uff0c\u5c31\u80fd\u67e5\u8be2\u5230\u6570\u636e\u4e86\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u662f\u56de\u8868\u3002</p>"},{"location":"mysql/index/index_interview/#_8","title":"\u6309\u5b57\u6bb5\u7279\u6027\u5206\u7c7b","text":"<p>\u4ece\u5b57\u6bb5\u7279\u6027\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7d22\u5f15\u5206\u4e3a\u4e3b\u952e\u7d22\u5f15\u3001\u552f\u4e00\u7d22\u5f15\u3001\u666e\u901a\u7d22\u5f15\u3001\u524d\u7f00\u7d22\u5f15\u3002</p>"},{"location":"mysql/index/index_interview/#_9","title":"\u4e3b\u952e\u7d22\u5f15","text":"<p>\u4e3b\u952e\u7d22\u5f15\u5c31\u662f\u5efa\u7acb\u5728\u4e3b\u952e\u5b57\u6bb5\u4e0a\u7684\u7d22\u5f15\uff0c\u901a\u5e38\u5728\u521b\u5efa\u8868\u7684\u65f6\u5019\u4e00\u8d77\u521b\u5efa\uff0c\u4e00\u5f20\u8868\u6700\u591a\u53ea\u6709\u4e00\u4e2a\u4e3b\u952e\u7d22\u5f15\uff0c\u7d22\u5f15\u5217\u7684\u503c\u4e0d\u5141\u8bb8\u6709\u7a7a\u503c\u3002</p> <p>\u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u4e3b\u952e\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a</p> SQL<pre><code>CREATE TABLE table_name  (\n  ....\n  PRIMARY KEY (index_column_1) USING BTREE\n);\n</code></pre>"},{"location":"mysql/index/index_interview/#_10","title":"\u552f\u4e00\u7d22\u5f15","text":"<p>\u552f\u4e00\u7d22\u5f15\u5efa\u7acb\u5728 UNIQUE \u5b57\u6bb5\u4e0a\u7684\u7d22\u5f15\uff0c\u4e00\u5f20\u8868\u53ef\u4ee5\u6709\u591a\u4e2a\u552f\u4e00\u7d22\u5f15\uff0c\u7d22\u5f15\u5217\u7684\u503c\u5fc5\u987b\u552f\u4e00\uff0c\u4f46\u662f\u5141\u8bb8\u6709\u7a7a\u503c\u3002</p> <p>\u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u552f\u4e00\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a</p> SQL<pre><code>CREATE TABLE table_name  (\n  ....\n  UNIQUE KEY(index_column_1,index_column_2,...) \n);\n</code></pre> <p>\u5efa\u8868\u540e\uff0c\u5982\u679c\u8981\u521b\u5efa\u552f\u4e00\u7d22\u5f15\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u9762\u8fd9\u6761\u547d\u4ee4\uff1a</p> SQL<pre><code>CREATE UNIQUE INDEX index_name\nON table_name(index_column_1,index_column_2,...); \n</code></pre>"},{"location":"mysql/index/index_interview/#_11","title":"\u666e\u901a\u7d22\u5f15","text":"<p>\u666e\u901a\u7d22\u5f15\u5c31\u662f\u5efa\u7acb\u5728\u666e\u901a\u5b57\u6bb5\u4e0a\u7684\u7d22\u5f15\uff0c\u65e2\u4e0d\u8981\u6c42\u5b57\u6bb5\u4e3a\u4e3b\u952e\uff0c\u4e5f\u4e0d\u8981\u6c42\u5b57\u6bb5\u4e3a UNIQUE\u3002</p> <p>\u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u666e\u901a\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a</p> SQL<pre><code>CREATE TABLE table_name  (\n  ....\n  INDEX(index_column_1,index_column_2,...) \n);\n</code></pre> <p>\u5efa\u8868\u540e\uff0c\u5982\u679c\u8981\u521b\u5efa\u666e\u901a\u7d22\u5f15\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u9762\u8fd9\u6761\u547d\u4ee4\uff1a</p> SQL<pre><code>CREATE INDEX index_name\nON table_name(index_column_1,index_column_2,...); \n</code></pre>"},{"location":"mysql/index/index_interview/#_12","title":"\u524d\u7f00\u7d22\u5f15","text":"<p>\u524d\u7f00\u7d22\u5f15\u662f\u6307\u5bf9\u5b57\u7b26\u7c7b\u578b\u5b57\u6bb5\u7684\u524d\u51e0\u4e2a\u5b57\u7b26\u5efa\u7acb\u7684\u7d22\u5f15\uff0c\u800c\u4e0d\u662f\u5728\u6574\u4e2a\u5b57\u6bb5\u4e0a\u5efa\u7acb\u7684\u7d22\u5f15\uff0c\u524d\u7f00\u7d22\u5f15\u53ef\u4ee5\u5efa\u7acb\u5728\u5b57\u6bb5\u7c7b\u578b\u4e3a char\u3001varchar\u3001binary\u3001varbinary \u7684\u5217\u4e0a\u3002</p> <p>\u4f7f\u7528\u524d\u7f00\u7d22\u5f15\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u7d22\u5f15\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\uff0c\u63d0\u5347\u67e5\u8be2\u6548\u7387\u3002</p> <p>\u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u524d\u7f00\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a</p> SQL<pre><code>CREATE TABLE table_name(\n    column_list,\n    INDEX(column_name(length))\n); \n</code></pre> <p>\u5efa\u8868\u540e\uff0c\u5982\u679c\u8981\u521b\u5efa\u524d\u7f00\u7d22\u5f15\uff0c\u53ef\u4ee5\u4f7f\u7528\u8fd9\u9762\u8fd9\u6761\u547d\u4ee4\uff1a</p> SQL<pre><code>CREATE INDEX index_name\nON table_name(column_name(length)); \n</code></pre>"},{"location":"mysql/index/index_interview/#_13","title":"\u6309\u5b57\u6bb5\u4e2a\u6570\u5206\u7c7b","text":"<p>\u4ece\u5b57\u6bb5\u4e2a\u6570\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u7d22\u5f15\u5206\u4e3a\u5355\u5217\u7d22\u5f15\u3001\u8054\u5408\u7d22\u5f15\uff08\u590d\u5408\u7d22\u5f15\uff09\u3002</p> <ul> <li>\u5efa\u7acb\u5728\u5355\u5217\u4e0a\u7684\u7d22\u5f15\u79f0\u4e3a\u5355\u5217\u7d22\u5f15\uff0c\u6bd4\u5982\u4e3b\u952e\u7d22\u5f15\uff1b</li> <li>\u5efa\u7acb\u5728\u591a\u5217\u4e0a\u7684\u7d22\u5f15\u79f0\u4e3a\u8054\u5408\u7d22\u5f15\uff1b</li> </ul>"},{"location":"mysql/index/index_interview/#_14","title":"\u8054\u5408\u7d22\u5f15","text":"<p>\u901a\u8fc7\u5c06\u591a\u4e2a\u5b57\u6bb5\u7ec4\u5408\u6210\u4e00\u4e2a\u7d22\u5f15\uff0c\u8be5\u7d22\u5f15\u5c31\u88ab\u79f0\u4e3a\u8054\u5408\u7d22\u5f15\u3002</p> <p>\u6bd4\u5982\uff0c\u5c06\u5546\u54c1\u8868\u4e2d\u7684 product_no \u548c name \u5b57\u6bb5\u7ec4\u5408\u6210\u8054\u5408\u7d22\u5f15<code>(product_no, name)</code>\uff0c\u521b\u5efa\u8054\u5408\u7d22\u5f15\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a</p> SQL<pre><code>CREATE INDEX index_product_no_name ON product(product_no, name);\n</code></pre> <p>\u8054\u5408\u7d22\u5f15<code>(product_no, name)</code> \u7684 B+Tree \u793a\u610f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8054\u5408\u7d22\u5f15\u7684\u975e\u53f6\u5b50\u8282\u70b9\u7528\u4e24\u4e2a\u5b57\u6bb5\u7684\u503c\u4f5c\u4e3a  B+Tree \u7684 key \u503c\u3002\u5f53\u5728\u8054\u5408\u7d22\u5f15\u67e5\u8be2\u6570\u636e\u65f6\uff0c\u5148\u6309 product_no \u5b57\u6bb5\u6bd4\u8f83\uff0c\u5728 product_no \u76f8\u540c\u7684\u60c5\u51b5\u4e0b\u518d\u6309 name \u5b57\u6bb5\u6bd4\u8f83\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8054\u5408\u7d22\u5f15\u67e5\u8be2\u7684 B+Tree \u662f\u5148\u6309 product_no \u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\u518d product_no \u76f8\u540c\u7684\u60c5\u51b5\u518d\u6309 name \u5b57\u6bb5\u6392\u5e8f\u3002</p> <p>\u56e0\u6b64\uff0c\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u5b58\u5728\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\u3002\u5728\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u4e0d\u9075\u5faa\u300c\u6700\u5de6\u5339\u914d\u539f\u5219\u300d\uff0c\u8054\u5408\u7d22\u5f15\u4f1a\u5931\u6548\uff0c\u8fd9\u6837\u5c31\u65e0\u6cd5\u5229\u7528\u5230\u7d22\u5f15\u5feb\u901f\u67e5\u8be2\u7684\u7279\u6027\u4e86\u3002</p> <p>\u6bd4\u5982\uff0c\u5982\u679c\u521b\u5efa\u4e86\u4e00\u4e2a <code>(a, b, c)</code> \u8054\u5408\u7d22\u5f15\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u5c31\u53ef\u4ee5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff1a</p> <ul> <li>where a=1.</li> <li>where a=1 and b=2 and c=3.</li> <li>where a=1 and b=2.</li> <li>where a=1 and c=3.</li> </ul> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a\u6709\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u6240\u4ee5 a \u5b57\u6bb5\u5728 where \u5b50\u53e5\u7684\u987a\u5e8f\u5e76\u4e0d\u91cd\u8981\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u56e0\u4e3a\u4e0d\u7b26\u5408\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff0c\u8054\u5408\u7d22\u5f15\u5c31\u4f1a\u5931\u6548\uff1a</p> <ul> <li>where b=2.</li> <li>where c=3.</li> <li>where b=2 and c=3.</li> </ul> <p>\u4e0a\u9762\u8fd9\u4e9b\u67e5\u8be2\u6761\u4ef6\u4e4b\u6240\u4ee5\u4f1a\u5931\u6548\uff0c\u662f\u56e0\u4e3a<code>(a, b, c)</code> \u8054\u5408\u7d22\u5f15\uff0c\u662f\u5148\u6309 a \u6392\u5e8f\uff0c\u5728 a \u76f8\u540c\u7684\u60c5\u51b5\u518d\u6309 b \u6392\u5e8f\uff0c\u5728 b \u76f8\u540c\u7684\u60c5\u51b5\u518d\u6309 c \u6392\u5e8f\u3002\u6240\u4ee5\uff0cb \u548c c \u662f\u5168\u5c40\u65e0\u5e8f\uff0c\u5c40\u90e8\u76f8\u5bf9\u6709\u5e8f\u7684\uff0c\u8fd9\u6837\u5728\u6ca1\u6709\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\u7684\u60c5\u51b5\u4e0b\uff0c\u662f\u65e0\u6cd5\u5229\u7528\u5230\u7d22\u5f15\u7684\u3002</p> <p>\u6211\u8fd9\u91cc\u4e3e\u8054\u5408\u7d22\u5f15\uff08a\uff0cb\uff09\u7684\u4f8b\u5b50\uff0c\u8be5\u8054\u5408\u7d22\u5f15\u7684 B+ Tree \u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0ca \u662f\u5168\u5c40\u6709\u5e8f\u7684\uff081, 2, 2, 3, 4, 5, 6, 7 ,8\uff09\uff0c\u800c b \u662f\u5168\u5c40\u662f\u65e0\u5e8f\u7684\uff0812\uff0c7\uff0c8\uff0c2\uff0c3\uff0c8\uff0c10\uff0c5\uff0c2\uff09\u3002\u56e0\u6b64\uff0c\u76f4\u63a5\u6267\u884c<code>where b = 2</code>\u8fd9\u79cd\u67e5\u8be2\u6761\u4ef6\u6ca1\u6709\u529e\u6cd5\u5229\u7528\u8054\u5408\u7d22\u5f15\u7684\uff0c\u5229\u7528\u7d22\u5f15\u7684\u524d\u63d0\u662f\u7d22\u5f15\u91cc\u7684 key \u662f\u6709\u5e8f\u7684\u3002</p> <p>\u53ea\u6709\u5728 a \u76f8\u540c\u7684\u60c5\u51b5\u624d\uff0cb \u624d\u662f\u6709\u5e8f\u7684\uff0c\u6bd4\u5982 a \u7b49\u4e8e 2 \u7684\u65f6\u5019\uff0cb \u7684\u503c\u4e3a\uff087\uff0c8\uff09\uff0c\u8fd9\u65f6\u5c31\u662f\u6709\u5e8f\u7684\uff0c\u8fd9\u4e2a\u6709\u5e8f\u72b6\u6001\u662f\u5c40\u90e8\u7684\uff0c\u56e0\u6b64\uff0c\u6267\u884c<code>where a = 2 and b = 7</code>\u662f a \u548c b \u5b57\u6bb5\u80fd\u7528\u5230\u8054\u5408\u7d22\u5f15\u7684\uff0c\u4e5f\u5c31\u662f\u8054\u5408\u7d22\u5f15\u751f\u6548\u4e86\u3002</p>"},{"location":"mysql/index/index_interview/#_15","title":"\u8054\u5408\u7d22\u5f15\u8303\u56f4\u67e5\u8be2","text":"<p>\u8054\u5408\u7d22\u5f15\u6709\u4e00\u4e9b\u7279\u6b8a\u60c5\u51b5\uff0c\u5e76\u4e0d\u662f\u67e5\u8be2\u8fc7\u7a0b\u4f7f\u7528\u4e86\u8054\u5408\u7d22\u5f15\u67e5\u8be2\uff0c\u5c31\u4ee3\u8868\u8054\u5408\u7d22\u5f15\u4e2d\u7684\u6240\u6709\u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u53ef\u80fd\u5b58\u5728\u90e8\u5206\u5b57\u6bb5\u7528\u5230\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff0c\u90e8\u5206\u5b57\u6bb5\u6ca1\u6709\u7528\u5230\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u7684\u60c5\u51b5\u3002</p> <p>\u8fd9\u79cd\u7279\u6b8a\u60c5\u51b5\u5c31\u53d1\u751f\u5728\u8303\u56f4\u67e5\u8be2\u3002\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u4f1a\u4e00\u76f4\u5411\u53f3\u5339\u914d\u76f4\u5230\u9047\u5230\u300c\u8303\u56f4\u67e5\u8be2\u300d\u5c31\u4f1a\u505c\u6b62\u5339\u914d\u3002\u4e5f\u5c31\u662f\u8303\u56f4\u67e5\u8be2\u7684\u5b57\u6bb5\u53ef\u4ee5\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f\u5728\u8303\u56f4\u67e5\u8be2\u5b57\u6bb5\u7684\u540e\u9762\u7684\u5b57\u6bb5\u65e0\u6cd5\u7528\u5230\u8054\u5408\u7d22\u5f15\u3002</p> <p>\u8303\u56f4\u67e5\u8be2\u6709\u5f88\u591a\u79cd\uff0c\u90a3\u5230\u5e95\u662f\u54ea\u4e9b\u8303\u56f4\u67e5\u8be2\u4f1a\u5bfc\u81f4\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u4f1a\u505c\u6b62\u5339\u914d\u5462\uff1f</p> <p>\u63a5\u4e0b\u6765\uff0c\u4e3e\u4f8b\u51e0\u4e2a\u8303\u56f4\u67e5\u4f8b\u5b50\u3002</p> <p>Q1: <code>select * from t_table where a &gt; 1 and b = 2</code>\uff0c\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f</p> <p>\u7531\u4e8e\u8054\u5408\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u662f\u5148\u6309\u7167 a \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u7b26\u5408 a &gt; 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u80af\u5b9a\u662f\u76f8\u90bb\uff0c\u4e8e\u662f\u5728\u8fdb\u884c\u7d22\u5f15\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b26\u5408 a &gt; 1 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u8bb0\u5f55\u6240\u5728\u7684\u94fe\u8868\u5411\u540e\u626b\u63cf\uff0c\u76f4\u5230\u67d0\u6761\u8bb0\u5f55\u4e0d\u7b26\u5408 a &gt; 1 \u6761\u4ef6\u4f4d\u7f6e\u3002\u6240\u4ee5 a \u5b57\u6bb5\u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u4e2d\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002</p> <p>\u4f46\u662f\u5728\u7b26\u5408 a &gt; 1  \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cb \u5b57\u6bb5\u7684\u503c\u662f\u65e0\u5e8f\u7684\u3002\u6bd4\u5982\u524d\u9762\u56fe\u7684\u8054\u5408\u7d22\u5f15\u7684 B+ Tree \u91cc\uff0c\u4e0b\u9762\u8fd9\u4e09\u6761\u8bb0\u5f55\u7684 a \u5b57\u6bb5\u7684\u503c\u90fd\u7b26\u5408 a &gt; 1  \u67e5\u8be2\u6761\u4ef6\uff0c\u800c b \u5b57\u6bb5\u7684\u503c\u662f\u65e0\u5e8f\u7684\uff1a</p> <ul> <li>a \u5b57\u6bb5\u503c\u4e3a 5 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684 b \u5b57\u6bb5\u503c\u4e3a 8\uff1b</li> <li>a \u5b57\u6bb5\u503c\u4e3a 6 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684 b \u5b57\u6bb5\u503c\u4e3a 10\uff1b</li> <li>a \u5b57\u6bb5\u503c\u4e3a 7 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684 b \u5b57\u6bb5\u503c\u4e3a 5\uff1b</li> </ul> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u4e0d\u80fd\u6839\u636e\u67e5\u8be2\u6761\u4ef6 b = 2 \u6765\u8fdb\u4e00\u6b65\u51cf\u5c11\u9700\u8981\u626b\u63cf\u7684\u8bb0\u5f55\u6570\u91cf\uff08b \u5b57\u6bb5\u65e0\u6cd5\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u7684\u610f\u601d\uff09\u3002</p> <p>\u6240\u4ee5\u5728\u6267\u884c Q1 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u5bf9\u5e94\u7684\u626b\u63cf\u533a\u95f4\u662f (2, + \u221e)\uff0c\u5f62\u6210\u8be5\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\u662f a &gt; 1\uff0c\u4e0e b = 2 \u65e0\u5173\u3002</p> <p>\u56e0\u6b64\uff0cQ1 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u53ea\u6709 a \u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u800c b \u5b57\u6bb5\u5e76\u6ca1\u6709\u4f7f\u7528\u5230\u8054\u5408\u7d22\u5f15\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\uff0c\u5728\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u901a\u8fc7 key_len \u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u4f18\u5316\u5668\u5177\u4f53\u4f7f\u7528\u4e86\u591a\u5c11\u4e2a\u5b57\u6bb5\u7684\u641c\u7d22\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\u3002</p> <p>\u4e3e\u4f8b\u4e2a\u4f8b\u5b50\uff0ca \u548c b \u90fd\u662f int \u7c7b\u578b\u4e14\u4e0d\u4e3a NULL \u7684\u5b57\u6bb5\uff0c\u90a3\u4e48 Q1 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 4 \u5b57\u8282\uff08\u5982\u679c\u5b57\u6bb5\u5141\u8bb8\u4e3a NULL\uff0c\u5c31\u5728\u5b57\u6bb5\u7c7b\u578b\u5360\u7528\u7684\u5b57\u8282\u6570\u4e0a\u52a0 1\uff0c\u4e5f\u5c31\u662f 5 \u5b57\u8282\uff09\uff0c\u8bf4\u660e\u53ea\u6709 a \u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u800c\u4e14\u53ef\u4ee5\u770b\u5230\uff0c\u5373\u4f7f b \u5b57\u6bb5\u6ca1\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0ckey \u4e3a idx_a_b\uff0c\u8bf4\u660e  Q1 \u67e5\u8be2\u8bed\u53e5\u4f7f\u7528\u4e86 idx_a_b \u8054\u5408\u7d22\u5f15\u3002</p> <p></p> <p>\u901a\u8fc7 Q1 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0ca \u5b57\u6bb5\u4f7f\u7528\u4e86 &gt; \u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5728\u9047\u5230 a \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 &gt;\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0c\u56e0\u6b64 b \u5b57\u6bb5\u5e76\u6ca1\u6709\u4f7f\u7528\u5230\u8054\u5408\u7d22\u5f15\u3002</p> <p>Q2: <code>select * from t_table where a &gt;= 1 and b = 2</code>\uff0c\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f</p> <p>Q2 \u548c Q1 \u7684\u67e5\u8be2\u8bed\u53e5\u5f88\u50cf\uff0c\u552f\u4e00\u7684\u533a\u522b\u5c31\u662f a \u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u3002</p> <p>\u7531\u4e8e\u8054\u5408\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u662f\u5148\u6309\u7167 a \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u7b26\u5408 &gt;= 1 \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u80af\u5b9a\u662f\u76f8\u90bb\uff0c\u4e8e\u662f\u5728\u8fdb\u884c\u7d22\u5f15\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b26\u5408 &gt;= 1 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u8bb0\u5f55\u6240\u5728\u7684\u94fe\u8868\u5411\u540e\u626b\u63cf\uff0c\u76f4\u5230\u67d0\u6761\u8bb0\u5f55\u4e0d\u7b26\u5408 a&gt;= 1 \u6761\u4ef6\u4f4d\u7f6e\u3002\u6240\u4ee5 a \u5b57\u6bb5\u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u4e2d\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002</p> <p>\u867d\u7136\u5728\u7b26\u5408 a&gt;= 1  \u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cb \u5b57\u6bb5\u7684\u503c\u662f\u300c\u65e0\u5e8f\u300d\u7684\uff0c\u4f46\u662f\u5bf9\u4e8e\u7b26\u5408 a = 1 \u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cb \u5b57\u6bb5\u7684\u503c\u662f\u300c\u6709\u5e8f\u300d\u7684\uff08\u56e0\u4e3a\u5bf9\u4e8e\u8054\u5408\u7d22\u5f15\uff0c\u662f\u5148\u6309\u7167 a \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\uff0c\u7136\u540e\u5728 a \u5b57\u6bb5\u7684\u503c\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u518d\u6309\u7167 b \u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u6392\u5e8f\uff09\u3002</p> <p>\u4e8e\u662f\uff0c\u5728\u786e\u5b9a\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u7684\u8303\u56f4\u65f6\uff0c\u5f53\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684 a \u5b57\u6bb5\u503c\u4e3a 1 \u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 b = 2 \u6761\u4ef6\u51cf\u5c11\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u8303\u56f4\uff08b \u5b57\u6bb5\u53ef\u4ee5\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u7684\u610f\u601d\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ece\u7b26\u5408 a = 1 and b = 2 \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\u5f00\u59cb\u626b\u63cf\uff0c\u800c\u4e0d\u9700\u8981\u4ece\u7b2c\u4e00\u4e2a a \u5b57\u6bb5\u503c\u4e3a 1 \u7684\u8bb0\u5f55\u5f00\u59cb\u626b\u63cf\u3002</p> <p>\u6240\u4ee5\uff0cQ2 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5 a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\u3002\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 8 \u5b57\u8282\uff0c\u8bf4\u660e\u4f18\u5316\u5668\u4f7f\u7528\u4e86 2 \u4e2a\u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f  a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002</p> <p></p> <p>\u901a\u8fc7 Q2 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u867d\u7136 a \u5b57\u6bb5\u4f7f\u7528\u4e86 &gt;= \u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5e76\u6ca1\u6709\u5728\u9047\u5230 a \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08 &gt;=\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0cb \u5b57\u6bb5\u8fd8\u662f\u53ef\u4ee5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684\u3002</p> <p>Q3: <code>SELECT * FROM t_table WHERE a BETWEEN 2 AND 8 AND b = 2</code>\uff0c\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f</p> <p>Q3 \u67e5\u8be2\u6761\u4ef6\u4e2d <code>a BETWEEN 2 AND 8</code> \u7684\u610f\u601d\u662f\u67e5\u8be2 a \u5b57\u6bb5\u7684\u503c\u5728 2 \u548c 8 \u4e4b\u95f4\u7684\u8bb0\u5f55\u3002\u4e0d\u540c\u7684\u6570\u636e\u5e93\u5bf9 BETWEEN ... AND \u5904\u7406\u65b9\u5f0f\u662f\u6709\u5dee\u5f02\u7684\u3002\u5728 MySQL \u4e2d\uff0cBETWEEN \u5305\u542b\u4e86 value1 \u548c value2 \u8fb9\u754c\u503c\uff0c\u7c7b\u4f3c\u4e8e &gt;= and =&lt;\u3002\u800c\u6709\u7684\u6570\u636e\u5e93\u5219\u4e0d\u5305\u542b value1 \u548c value2 \u8fb9\u754c\u503c\uff08\u7c7b\u4f3c\u4e8e &gt; and &lt;\uff09\u3002</p> <p>\u8fd9\u91cc\u6211\u4eec\u53ea\u8ba8\u8bba MySQL\u3002\u7531\u4e8e MySQL \u7684 BETWEEN \u5305\u542b value1 \u548c value2 \u8fb9\u754c\u503c\uff0c\u6240\u4ee5\u7c7b\u4f3c\u4e8e Q2 \u67e5\u8be2\u8bed\u53e5\uff0c\u56e0\u6b64 Q3 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5 a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\u3002\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 8 \u5b57\u8282\uff0c\u8bf4\u660e\u4f18\u5316\u5668\u4f7f\u7528\u4e86 2 \u4e2a\u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f  a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002</p> <p></p> <p>\u901a\u8fc7 Q3 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u867d\u7136 a \u5b57\u6bb5\u4f7f\u7528\u4e86 BETWEEN \u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5e76\u6ca1\u6709\u5728\u9047\u5230 a \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08BETWEEN\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0cb \u5b57\u6bb5\u8fd8\u662f\u53ef\u4ee5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684\u3002</p> <p>Q4: <code>SELECT * FROM t_user WHERE name like 'j%' and age = 22</code>\uff0c\u8054\u5408\u7d22\u5f15\uff08name, age\uff09\u54ea\u4e00\u4e2a\u5b57\u6bb5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684 B+Tree\uff1f</p> <p>\u7531\u4e8e\u8054\u5408\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\u662f\u5148\u6309\u7167 name \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u524d\u7f00\u4e3a\u2018j\u2019\u7684 name \u5b57\u6bb5\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u90fd\u662f\u76f8\u90bb\u7684\uff0c\u4e8e\u662f\u5728\u8fdb\u884c\u7d22\u5f15\u626b\u63cf\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5b9a\u4f4d\u5230\u7b26\u5408\u524d\u7f00\u4e3a\u2018j\u2019\u7684 name \u5b57\u6bb5\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff0c\u7136\u540e\u6cbf\u7740\u8bb0\u5f55\u6240\u5728\u7684\u94fe\u8868\u5411\u540e\u626b\u63cf\uff0c\u76f4\u5230\u67d0\u6761\u8bb0\u5f55\u7684 name \u524d\u7f00\u4e0d\u4e3a\u2018j\u2019\u4e3a\u6b62\u3002</p> <p>\u6240\u4ee5 a \u5b57\u6bb5\u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u4e2d\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\uff0c\u5f62\u6210\u7684\u626b\u63cf\u533a\u95f4\u662f['j','k')\u3002\u6ce8\u610f\uff0cj \u662f\u95ed\u533a\u95f4\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u867d\u7136\u5728\u7b26\u5408\u524d\u7f00\u4e3a\u2018j\u2019\u7684 name \u5b57\u6bb5\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cage \u5b57\u6bb5\u7684\u503c\u662f\u300c\u65e0\u5e8f\u300d\u7684\uff0c\u4f46\u662f\u5bf9\u4e8e\u7b26\u5408 name = j \u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684\u8303\u56f4\u91cc\uff0cage \u5b57\u6bb5\u7684\u503c\u662f\u300c\u6709\u5e8f\u300d\u7684\uff08\u56e0\u4e3a\u5bf9\u4e8e\u8054\u5408\u7d22\u5f15\uff0c\u662f\u5148\u6309\u7167 name \u5b57\u6bb5\u7684\u503c\u6392\u5e8f\uff0c\u7136\u540e\u5728 name \u5b57\u6bb5\u7684\u503c\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u518d\u6309\u7167 age \u5b57\u6bb5\u7684\u503c\u8fdb\u884c\u6392\u5e8f\uff09\u3002</p> <p>\u4e8e\u662f\uff0c\u5728\u786e\u5b9a\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u7684\u8303\u56f4\u65f6\uff0c\u5f53\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u7684 name \u5b57\u6bb5\u503c\u4e3a\u2018j\u2019\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 age = 22 \u6761\u4ef6\u51cf\u5c11\u9700\u8981\u626b\u63cf\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u8303\u56f4\uff08age \u5b57\u6bb5\u53ef\u4ee5\u5229\u7528\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u7684\u610f\u601d\uff09\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u4ece\u7b26\u5408 <code>name = 'j' and age = 22</code> \u6761\u4ef6\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\u65f6\u5f00\u59cb\u626b\u63cf\uff0c\u800c\u4e0d\u9700\u8981\u4ece\u7b2c\u4e00\u4e2a name \u4e3a j \u7684\u8bb0\u5f55\u5f00\u59cb\u626b\u63cf\u3002\u5982\u4e0b\u56fe\u7684\u53f3\u8fb9\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0cQ4 \u8fd9\u6761\u67e5\u8be2\u8bed\u53e5 a \u548c b \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002</p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u6267\u884c\u8ba1\u5212\u4e2d\u7684 key_len \u77e5\u9053\u8fd9\u4e00\u70b9\u3002\u672c\u6b21\u4f8b\u5b50\u4e2d\uff1a</p> <ul> <li> <p>name \u5b57\u6bb5\u7684\u7c7b\u578b\u662f varchar(30) \u4e14\u4e0d\u4e3a NULL\uff0c\u6570\u636e\u5e93\u8868\u4f7f\u7528\u4e86 utf8mb4 \u5b57\u7b26\u96c6\uff0c\u4e00\u4e2a\u5b57\u7b26\u96c6\u4e3a utf8mb4 \u7684\u5b57\u7b26\u662f 4 \u4e2a\u5b57\u8282\uff0c\u56e0\u6b64 name \u5b57\u6bb5\u7684\u5b9e\u9645\u6570\u636e\u6700\u591a\u5360\u7528\u7684\u5b58\u50a8\u7a7a\u95f4\u957f\u5ea6\u662f 120 \u5b57\u8282\uff0830 x 4\uff09\uff0c\u7136\u540e\u56e0\u4e3a name \u662f\u53d8\u957f\u7c7b\u578b\u7684\u5b57\u6bb5\uff0c\u9700\u8981\u518d\u52a0 2\uff0c\u4e5f\u5c31\u662f name \u7684 key_len \u4e3a 122\u3002</p> </li> <li> <p>age \u5b57\u6bb5\u7684\u7c7b\u578b\u662f int \u4e14\u4e0d\u4e3a NULL\uff0ckey_len \u4e3a 4\u3002</p> </li> </ul> <p>Q4 \u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230 key_len \u4e3a 126 \u5b57\u8282\uff0cname \u7684 key_len \u4e3a 122\uff0cage \u7684 key_len \u4e3a 4\uff0c\u8bf4\u660e\u4f18\u5316\u5668\u4f7f\u7528\u4e86 2 \u4e2a\u5b57\u6bb5\u7684\u67e5\u8be2\u6761\u4ef6\u6765\u5f62\u6210\u626b\u63cf\u533a\u95f4\u7684\u8fb9\u754c\u6761\u4ef6\uff0c\u4e5f\u5c31\u662f  name \u548c age \u5b57\u6bb5\u90fd\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u7d22\u5f15\u67e5\u8be2\u3002</p> <p></p> <p>\u901a\u8fc7 Q4 \u67e5\u8be2\u8bed\u53e5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u867d\u7136 name \u5b57\u6bb5\u4f7f\u7528\u4e86 like \u524d\u7f00\u5339\u914d\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4f46\u662f\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\u5e76\u6ca1\u6709\u5728\u9047\u5230 name \u5b57\u6bb5\u7684\u8303\u56f4\u67e5\u8be2\uff08like 'j%'\uff09\u540e\u5c31\u505c\u6b62\u5339\u914d\u4e86\uff0cage \u5b57\u6bb5\u8fd8\u662f\u53ef\u4ee5\u7528\u5230\u4e86\u8054\u5408\u7d22\u5f15\u7684\u3002</p> <p>\u7efc\u4e0a\u6240\u793a\uff0c\u8054\u5408\u7d22\u5f15\u7684\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u5728\u9047\u5230\u8303\u56f4\u67e5\u8be2\uff08\u5982 &gt;\u3001&lt;\uff09\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u505c\u6b62\u5339\u914d\uff0c\u4e5f\u5c31\u662f\u8303\u56f4\u67e5\u8be2\u7684\u5b57\u6bb5\u53ef\u4ee5\u7528\u5230\u8054\u5408\u7d22\u5f15\uff0c\u4f46\u662f\u5728\u8303\u56f4\u67e5\u8be2\u5b57\u6bb5\u7684\u540e\u9762\u7684\u5b57\u6bb5\u65e0\u6cd5\u7528\u5230\u8054\u5408\u7d22\u5f15\u3002\u6ce8\u610f\uff0c\u5bf9\u4e8e &gt;=\u3001&lt;=\u3001BETWEEN\u3001like \u524d\u7f00\u5339\u914d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u5e76\u4e0d\u4f1a\u505c\u6b62\u5339\u914d\uff0c\u524d\u9762\u6211\u4e5f\u7528\u4e86\u56db\u4e2a\u4f8b\u5b50\u8bf4\u660e\u4e86\u3002</p>"},{"location":"mysql/index/index_interview/#_16","title":"\u7d22\u5f15\u4e0b\u63a8","text":"<p>\u73b0\u5728\u6211\u4eec\u77e5\u9053\uff0c\u5bf9\u4e8e\u8054\u5408\u7d22\u5f15\uff08a, b\uff09\uff0c\u5728\u6267\u884c <code>select * from table where a &gt; 1 and b = 2</code> \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u53ea\u6709 a \u5b57\u6bb5\u80fd\u7528\u5230\u7d22\u5f15\uff0c\u90a3\u5728\u8054\u5408\u7d22\u5f15\u7684 B+Tree \u627e\u5230\u7b2c\u4e00\u4e2a\u6ee1\u8db3\u6761\u4ef6\u7684\u4e3b\u952e\u503c\uff08ID \u4e3a 2\uff09\u540e\uff0c\u8fd8\u9700\u8981\u5224\u65ad\u5176\u4ed6\u6761\u4ef6\u662f\u5426\u6ee1\u8db3\uff08\u770b b \u662f\u5426\u7b49\u4e8e 2\uff09\uff0c\u90a3\u662f\u5728\u8054\u5408\u7d22\u5f15\u91cc\u5224\u65ad\uff1f\u8fd8\u662f\u56de\u4e3b\u952e\u7d22\u5f15\u53bb\u5224\u65ad\u5462\uff1f</p> <ul> <li> <p>\u5728 MySQL 5.6 \u4e4b\u524d\uff0c\u53ea\u80fd\u4ece ID2\uff08\u4e3b\u952e\u503c\uff09\u5f00\u59cb\u4e00\u4e2a\u4e2a\u56de\u8868\uff0c\u5230\u300c\u4e3b\u952e\u7d22\u5f15\u300d\u4e0a\u627e\u51fa\u6570\u636e\u884c\uff0c\u518d\u5bf9\u6bd4 b \u5b57\u6bb5\u503c\u3002</p> </li> <li> <p>\u800c MySQL 5.6 \u5f15\u5165\u7684\u7d22\u5f15\u4e0b\u63a8\u4f18\u5316\uff08index condition pushdown)\uff0c \u53ef\u4ee5\u5728\u8054\u5408\u7d22\u5f15\u904d\u5386\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u8054\u5408\u7d22\u5f15\u4e2d\u5305\u542b\u7684\u5b57\u6bb5\u5148\u505a\u5224\u65ad\uff0c\u76f4\u63a5\u8fc7\u6ee4\u6389\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u51cf\u5c11\u56de\u8868\u6b21\u6570\u3002</p> </li> </ul> <p>\u5f53\u4f60\u7684\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u91cc\uff0c\u51fa\u73b0\u4e86  Extra \u4e3a <code>Using index condition</code>\uff0c\u90a3\u4e48\u8bf4\u660e\u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u7684\u4f18\u5316\u3002</p>"},{"location":"mysql/index/index_interview/#_17","title":"\u7d22\u5f15\u533a\u5206\u5ea6","text":"<p>\u53e6\u5916\uff0c\u5efa\u7acb\u8054\u5408\u7d22\u5f15\u65f6\u7684\u5b57\u6bb5\u987a\u5e8f\uff0c\u5bf9\u7d22\u5f15\u6548\u7387\u4e5f\u6709\u5f88\u5927\u5f71\u54cd\u3002\u8d8a\u9760\u524d\u7684\u5b57\u6bb5\u88ab\u7528\u4e8e\u7d22\u5f15\u8fc7\u6ee4\u7684\u6982\u7387\u8d8a\u9ad8\uff0c\u5b9e\u9645\u5f00\u53d1\u5de5\u4f5c\u4e2d\u5efa\u7acb\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u8981\u628a\u533a\u5206\u5ea6\u5927\u7684\u5b57\u6bb5\u6392\u5728\u524d\u9762\uff0c\u8fd9\u6837\u533a\u5206\u5ea6\u5927\u7684\u5b57\u6bb5\u8d8a\u6709\u53ef\u80fd\u88ab\u66f4\u591a\u7684 SQL \u4f7f\u7528\u5230\u3002</p> <p>\u533a\u5206\u5ea6\u5c31\u662f\u67d0\u4e2a\u5b57\u6bb5 column \u4e0d\u540c\u503c\u7684\u4e2a\u6570\u300c\u9664\u4ee5\u300d\u8868\u7684\u603b\u884c\u6570\uff0c\u8ba1\u7b97\u516c\u5f0f\u5982\u4e0b\uff1a</p> <p></p> <p>\u6bd4\u5982\uff0c\u6027\u522b\u7684\u533a\u5206\u5ea6\u5c31\u5f88\u5c0f\uff0c\u4e0d\u9002\u5408\u5efa\u7acb\u7d22\u5f15\u6216\u4e0d\u9002\u5408\u6392\u5728\u8054\u5408\u7d22\u5f15\u5217\u7684\u9760\u524d\u7684\u4f4d\u7f6e\uff0c\u800c UUID \u8fd9\u7c7b\u5b57\u6bb5\u5c31\u6bd4\u8f83\u9002\u5408\u505a\u7d22\u5f15\u6216\u6392\u5728\u8054\u5408\u7d22\u5f15\u5217\u7684\u9760\u524d\u7684\u4f4d\u7f6e\u3002</p> <p>\u56e0\u4e3a\u5982\u679c\u7d22\u5f15\u7684\u533a\u5206\u5ea6\u5f88\u5c0f\uff0c\u5047\u8bbe\u5b57\u6bb5\u7684\u503c\u5206\u5e03\u5747\u5300\uff0c\u90a3\u4e48\u65e0\u8bba\u641c\u7d22\u54ea\u4e2a\u503c\u90fd\u53ef\u80fd\u5f97\u5230\u4e00\u534a\u7684\u6570\u636e\u3002\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd8\u4e0d\u5982\u4e0d\u8981\u7d22\u5f15\uff0c\u56e0\u4e3a MySQL \u8fd8\u6709\u4e00\u4e2a\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u53d1\u73b0\u67d0\u4e2a\u503c\u51fa\u73b0\u5728\u8868\u7684\u6570\u636e\u884c\u4e2d\u7684\u767e\u5206\u6bd4\uff08\u60ef\u7528\u7684\u767e\u5206\u6bd4\u754c\u7ebf\u662f\"30%\"\uff09\u5f88\u9ad8\u7684\u65f6\u5019\uff0c\u5b83\u4e00\u822c\u4f1a\u5ffd\u7565\u7d22\u5f15\uff0c\u8fdb\u884c\u5168\u8868\u626b\u63cf\u3002</p>"},{"location":"mysql/index/index_interview/#_18","title":"\u8054\u5408\u7d22\u5f15\u8fdb\u884c\u6392\u5e8f","text":"<p>\u8fd9\u91cc\u51fa\u4e00\u4e2a\u9898\u76ee\uff0c\u9488\u5bf9\u9488\u5bf9\u4e0b\u9762\u8fd9\u6761 SQL\uff0c\u4f60\u600e\u4e48\u901a\u8fc7\u7d22\u5f15\u6765\u63d0\u9ad8\u67e5\u8be2\u6548\u7387\u5462\uff1f</p> SQL<pre><code>select * from order where status = 1 order by create_time asc\n</code></pre> <p>\u6709\u7684\u540c\u5b66\u4f1a\u8ba4\u4e3a\uff0c\u5355\u72ec\u7ed9 status \u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u4f46\u662f\u66f4\u597d\u7684\u65b9\u5f0f\u7ed9 status \u548c create_time \u5217\u5efa\u7acb\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\uff0c\u56e0\u4e3a\u8fd9\u6837\u53ef\u4ee5\u907f\u514d MySQL \u6570\u636e\u5e93\u53d1\u751f\u6587\u4ef6\u6392\u5e8f\u3002</p> <p>\u56e0\u4e3a\u5728\u67e5\u8be2\u65f6\uff0c\u5982\u679c\u53ea\u7528\u5230 status \u7684\u7d22\u5f15\uff0c\u4f46\u662f\u8fd9\u6761\u8bed\u53e5\u8fd8\u8981\u5bf9 create_time \u6392\u5e8f\uff0c\u8fd9\u65f6\u5c31\u8981\u7528\u6587\u4ef6\u6392\u5e8f filesort\uff0c\u4e5f\u5c31\u662f\u5728 SQL \u6267\u884c\u8ba1\u5212\u4e2d\uff0cExtra \u5217\u4f1a\u51fa\u73b0 Using filesort\u3002</p> <p>\u6240\u4ee5\uff0c\u8981\u5229\u7528\u7d22\u5f15\u7684\u6709\u5e8f\u6027\uff0c\u5728 status \u548c create_time \u5217\u5efa\u7acb\u8054\u5408\u7d22\u5f15\uff0c\u8fd9\u6837\u6839\u636e status \u7b5b\u9009\u540e\u7684\u6570\u636e\u5c31\u662f\u6309\u7167 create_time \u6392\u597d\u5e8f\u7684\uff0c\u907f\u514d\u5728\u6587\u4ef6\u6392\u5e8f\uff0c\u63d0\u9ad8\u4e86\u67e5\u8be2\u6548\u7387\u3002</p>"},{"location":"mysql/index/index_interview/#_19","title":"\u4ec0\u4e48\u65f6\u5019\u9700\u8981 / \u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1f","text":"<p>\u7d22\u5f15\u6700\u5927\u7684\u597d\u5904\u662f\u63d0\u9ad8\u67e5\u8be2\u901f\u5ea6\uff0c\u4f46\u662f\u7d22\u5f15\u4e5f\u662f\u6709\u7f3a\u70b9\u7684\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u9700\u8981\u5360\u7528\u7269\u7406\u7a7a\u95f4\uff0c\u6570\u91cf\u8d8a\u5927\uff0c\u5360\u7528\u7a7a\u95f4\u8d8a\u5927\uff1b</li> <li>\u521b\u5efa\u7d22\u5f15\u548c\u7ef4\u62a4\u7d22\u5f15\u8981\u8017\u8d39\u65f6\u95f4\uff0c\u8fd9\u79cd\u65f6\u95f4\u968f\u7740\u6570\u636e\u91cf\u7684\u589e\u52a0\u800c\u589e\u5927\uff1b</li> <li>\u4f1a\u964d\u4f4e\u8868\u7684\u589e\u5220\u6539\u7684\u6548\u7387\uff0c\u56e0\u4e3a\u6bcf\u6b21\u589e\u5220\u6539\u7d22\u5f15\uff0cB+ \u6811\u4e3a\u4e86\u7ef4\u62a4\u7d22\u5f15\u6709\u5e8f\u6027\uff0c\u90fd\u9700\u8981\u8fdb\u884c\u52a8\u6001\u7ef4\u62a4\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u7d22\u5f15\u4e0d\u662f\u4e07\u80fd\u94a5\u5319\uff0c\u5b83\u4e5f\u662f\u6839\u636e\u573a\u666f\u6765\u4f7f\u7528\u7684\u3002</p>"},{"location":"mysql/index/index_interview/#_20","title":"\u4ec0\u4e48\u65f6\u5019\u9002\u7528\u7d22\u5f15\uff1f","text":"<ul> <li>\u5b57\u6bb5\u6709\u552f\u4e00\u6027\u9650\u5236\u7684\uff0c\u6bd4\u5982\u5546\u54c1\u7f16\u7801\uff1b</li> <li>\u7ecf\u5e38\u7528\u4e8e <code>WHERE</code> \u67e5\u8be2\u6761\u4ef6\u7684\u5b57\u6bb5\uff0c\u8fd9\u6837\u80fd\u591f\u63d0\u9ad8\u6574\u4e2a\u8868\u7684\u67e5\u8be2\u901f\u5ea6\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e0d\u662f\u4e00\u4e2a\u5b57\u6bb5\uff0c\u53ef\u4ee5\u5efa\u7acb\u8054\u5408\u7d22\u5f15\u3002</li> <li>\u7ecf\u5e38\u7528\u4e8e <code>GROUP BY</code> \u548c <code>ORDER BY</code> \u7684\u5b57\u6bb5\uff0c\u8fd9\u6837\u5728\u67e5\u8be2\u7684\u65f6\u5019\u5c31\u4e0d\u9700\u8981\u518d\u53bb\u505a\u4e00\u6b21\u6392\u5e8f\u4e86\uff0c\u56e0\u4e3a\u6211\u4eec\u90fd\u5df2\u7ecf\u77e5\u9053\u4e86\u5efa\u7acb\u7d22\u5f15\u4e4b\u540e\u5728 B+Tree \u4e2d\u7684\u8bb0\u5f55\u90fd\u662f\u6392\u5e8f\u597d\u7684\u3002</li> </ul>"},{"location":"mysql/index/index_interview/#_21","title":"\u4ec0\u4e48\u65f6\u5019\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1f","text":"<ul> <li><code>WHERE</code> \u6761\u4ef6\uff0c<code>GROUP BY</code>\uff0c<code>ORDER BY</code> \u91cc\u7528\u4e0d\u5230\u7684\u5b57\u6bb5\uff0c\u7d22\u5f15\u7684\u4ef7\u503c\u662f\u5feb\u901f\u5b9a\u4f4d\uff0c\u5982\u679c\u8d77\u4e0d\u5230\u5b9a\u4f4d\u7684\u5b57\u6bb5\u901a\u5e38\u662f\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\u7684\uff0c\u56e0\u4e3a\u7d22\u5f15\u662f\u4f1a\u5360\u7528\u7269\u7406\u7a7a\u95f4\u7684\u3002</li> <li>\u5b57\u6bb5\u4e2d\u5b58\u5728\u5927\u91cf\u91cd\u590d\u6570\u636e\uff0c\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff0c\u6bd4\u5982\u6027\u522b\u5b57\u6bb5\uff0c\u53ea\u6709\u7537\u5973\uff0c\u5982\u679c\u6570\u636e\u5e93\u8868\u4e2d\uff0c\u7537\u5973\u7684\u8bb0\u5f55\u5206\u5e03\u5747\u5300\uff0c\u90a3\u4e48\u65e0\u8bba\u641c\u7d22\u54ea\u4e2a\u503c\u90fd\u53ef\u80fd\u5f97\u5230\u4e00\u534a\u7684\u6570\u636e\u3002\u5728\u8fd9\u4e9b\u60c5\u51b5\u4e0b\uff0c\u8fd8\u4e0d\u5982\u4e0d\u8981\u7d22\u5f15\uff0c\u56e0\u4e3a MySQL \u8fd8\u6709\u4e00\u4e2a\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u67e5\u8be2\u4f18\u5316\u5668\u53d1\u73b0\u67d0\u4e2a\u503c\u51fa\u73b0\u5728\u8868\u7684\u6570\u636e\u884c\u4e2d\u7684\u767e\u5206\u6bd4\u5f88\u9ad8\u7684\u65f6\u5019\uff0c\u5b83\u4e00\u822c\u4f1a\u5ffd\u7565\u7d22\u5f15\uff0c\u8fdb\u884c\u5168\u8868\u626b\u63cf\u3002</li> <li>\u8868\u6570\u636e\u592a\u5c11\u7684\u65f6\u5019\uff0c\u4e0d\u9700\u8981\u521b\u5efa\u7d22\u5f15\uff1b</li> <li>\u7ecf\u5e38\u66f4\u65b0\u7684\u5b57\u6bb5\u4e0d\u7528\u521b\u5efa\u7d22\u5f15\uff0c\u6bd4\u5982\u4e0d\u8981\u5bf9\u7535\u5546\u9879\u76ee\u7684\u7528\u6237\u4f59\u989d\u5efa\u7acb\u7d22\u5f15\uff0c\u56e0\u4e3a\u7d22\u5f15\u5b57\u6bb5\u9891\u7e41\u4fee\u6539\uff0c\u7531\u4e8e\u8981\u7ef4\u62a4 B+Tree \u7684\u6709\u5e8f\u6027\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u9891\u7e41\u7684\u91cd\u5efa\u7d22\u5f15\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u4f1a\u5f71\u54cd\u6570\u636e\u5e93\u6027\u80fd\u7684\u3002</li> </ul>"},{"location":"mysql/index/index_interview/#_22","title":"\u6709\u4ec0\u4e48\u4f18\u5316\u7d22\u5f15\u7684\u65b9\u6cd5\uff1f","text":"<p>\u8fd9\u91cc\u8bf4\u4e00\u4e0b\u51e0\u79cd\u5e38\u89c1\u4f18\u5316\u7d22\u5f15\u7684\u65b9\u6cd5\uff1a</p> <ul> <li>\u524d\u7f00\u7d22\u5f15\u4f18\u5316\uff1b</li> <li>\u8986\u76d6\u7d22\u5f15\u4f18\u5316\uff1b</li> <li>\u4e3b\u952e\u7d22\u5f15\u6700\u597d\u662f\u81ea\u589e\u7684\uff1b</li> <li>\u9632\u6b62\u7d22\u5f15\u5931\u6548\uff1b</li> </ul>"},{"location":"mysql/index/index_interview/#_23","title":"\u524d\u7f00\u7d22\u5f15\u4f18\u5316","text":"<p>\u524d\u7f00\u7d22\u5f15\u987e\u540d\u601d\u4e49\u5c31\u662f\u4f7f\u7528\u67d0\u4e2a\u5b57\u6bb5\u4e2d\u5b57\u7b26\u4e32\u7684\u524d\u51e0\u4e2a\u5b57\u7b26\u5efa\u7acb\u7d22\u5f15\uff0c\u90a3\u6211\u4eec\u4e3a\u4ec0\u4e48\u9700\u8981\u4f7f\u7528\u524d\u7f00\u6765\u5efa\u7acb\u7d22\u5f15\u5462\uff1f</p> <p>\u4f7f\u7528\u524d\u7f00\u7d22\u5f15\u662f\u4e3a\u4e86\u51cf\u5c0f\u7d22\u5f15\u5b57\u6bb5\u5927\u5c0f\uff0c\u53ef\u4ee5\u589e\u52a0\u4e00\u4e2a\u7d22\u5f15\u9875\u4e2d\u5b58\u50a8\u7684\u7d22\u5f15\u503c\uff0c\u6709\u6548\u63d0\u9ad8\u7d22\u5f15\u7684\u67e5\u8be2\u901f\u5ea6\u3002\u5728\u4e00\u4e9b\u5927\u5b57\u7b26\u4e32\u7684\u5b57\u6bb5\u4f5c\u4e3a\u7d22\u5f15\u65f6\uff0c\u4f7f\u7528\u524d\u7f00\u7d22\u5f15\u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u51cf\u5c0f\u7d22\u5f15\u9879\u7684\u5927\u5c0f\u3002</p> <p>\u4e0d\u8fc7\uff0c\u524d\u7f00\u7d22\u5f15\u6709\u4e00\u5b9a\u7684\u5c40\u9650\u6027\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>order by \u5c31\u65e0\u6cd5\u4f7f\u7528\u524d\u7f00\u7d22\u5f15\uff1b</li> <li>\u65e0\u6cd5\u628a\u524d\u7f00\u7d22\u5f15\u7528\u4f5c\u8986\u76d6\u7d22\u5f15\uff1b</li> </ul>"},{"location":"mysql/index/index_interview/#_24","title":"\u8986\u76d6\u7d22\u5f15\u4f18\u5316","text":"<p>\u8986\u76d6\u7d22\u5f15\u662f\u6307 SQL \u4e2d query \u7684\u6240\u6709\u5b57\u6bb5\uff0c\u5728\u7d22\u5f15 B+Tree  \u7684\u53f6\u5b50\u8282\u70b9\u4e0a\u90fd\u80fd\u627e\u5f97\u5230\u7684\u90a3\u4e9b\u7d22\u5f15\uff0c\u4ece\u4e8c\u7ea7\u7d22\u5f15\u4e2d\u67e5\u8be2\u5f97\u5230\u8bb0\u5f55\uff0c\u800c\u4e0d\u9700\u8981\u901a\u8fc7\u805a\u7c07\u7d22\u5f15\u67e5\u8be2\u83b7\u5f97\uff0c\u53ef\u4ee5\u907f\u514d\u56de\u8868\u7684\u64cd\u4f5c\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u53ea\u9700\u8981\u67e5\u8be2\u5546\u54c1\u7684\u540d\u79f0\u3001\u4ef7\u683c\uff0c\u6709\u4ec0\u4e48\u65b9\u5f0f\u53ef\u4ee5\u907f\u514d\u56de\u8868\u5462\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u5efa\u7acb\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\uff0c\u5373\u300c\u5546\u54c1 ID\u3001\u540d\u79f0\u3001\u4ef7\u683c\u300d\u4f5c\u4e3a\u4e00\u4e2a\u8054\u5408\u7d22\u5f15\u3002\u5982\u679c\u7d22\u5f15\u4e2d\u5b58\u5728\u8fd9\u4e9b\u6570\u636e\uff0c\u67e5\u8be2\u5c06\u4e0d\u4f1a\u518d\u6b21\u68c0\u7d22\u4e3b\u952e\u7d22\u5f15\uff0c\u4ece\u800c\u907f\u514d\u56de\u8868\u3002</p> <p>\u6240\u4ee5\uff0c\u4f7f\u7528\u8986\u76d6\u7d22\u5f15\u7684\u597d\u5904\u5c31\u662f\uff0c\u4e0d\u9700\u8981\u67e5\u8be2\u51fa\u5305\u542b\u6574\u884c\u8bb0\u5f55\u7684\u6240\u6709\u4fe1\u606f\uff0c\u4e5f\u5c31\u51cf\u5c11\u4e86\u5927\u91cf\u7684 I/O \u64cd\u4f5c\u3002</p>"},{"location":"mysql/index/index_interview/#_25","title":"\u4e3b\u952e\u7d22\u5f15\u6700\u597d\u662f\u81ea\u589e\u7684","text":"<p>\u6211\u4eec\u5728\u5efa\u8868\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u9ed8\u8ba4\u5c06\u4e3b\u952e\u7d22\u5f15\u8bbe\u7f6e\u4e3a\u81ea\u589e\u7684\uff0c\u5177\u4f53\u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u505a\u5462\uff1f\u53c8\u4ec0\u4e48\u597d\u5904\uff1f</p> <p>InnoDB \u521b\u5efa\u4e3b\u952e\u7d22\u5f15\u9ed8\u8ba4\u4e3a\u805a\u7c07\u7d22\u5f15\uff0c\u6570\u636e\u88ab\u5b58\u653e\u5728\u4e86 B+Tree \u7684\u53f6\u5b50\u8282\u70b9\u4e0a\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u540c\u4e00\u4e2a\u53f6\u5b50\u8282\u70b9\u5185\u7684\u5404\u4e2a\u6570\u636e\u662f\u6309\u4e3b\u952e\u987a\u5e8f\u5b58\u653e\u7684\uff0c\u56e0\u6b64\uff0c\u6bcf\u5f53\u6709\u4e00\u6761\u65b0\u7684\u6570\u636e\u63d2\u5165\u65f6\uff0c\u6570\u636e\u5e93\u4f1a\u6839\u636e\u4e3b\u952e\u5c06\u5176\u63d2\u5165\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\u4e2d\u3002</p> <p>\u5982\u679c\u6211\u4eec\u4f7f\u7528\u81ea\u589e\u4e3b\u952e\uff0c\u90a3\u4e48\u6bcf\u6b21\u63d2\u5165\u7684\u65b0\u6570\u636e\u5c31\u4f1a\u6309\u987a\u5e8f\u6dfb\u52a0\u5230\u5f53\u524d\u7d22\u5f15\u8282\u70b9\u7684\u4f4d\u7f6e\uff0c\u4e0d\u9700\u8981\u79fb\u52a8\u5df2\u6709\u7684\u6570\u636e\uff0c\u5f53\u9875\u9762\u5199\u6ee1\uff0c\u5c31\u4f1a\u81ea\u52a8\u5f00\u8f9f\u4e00\u4e2a\u65b0\u9875\u9762\u3002\u56e0\u4e3a\u6bcf\u6b21\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u662f\u8ffd\u52a0\u64cd\u4f5c\uff0c\u4e0d\u9700\u8981\u91cd\u65b0\u79fb\u52a8\u6570\u636e\uff0c\u56e0\u6b64\u8fd9\u79cd\u63d2\u5165\u6570\u636e\u7684\u65b9\u6cd5\u6548\u7387\u975e\u5e38\u9ad8\u3002</p> <p>\u5982\u679c\u6211\u4eec\u4f7f\u7528\u975e\u81ea\u589e\u4e3b\u952e\uff0c\u7531\u4e8e\u6bcf\u6b21\u63d2\u5165\u4e3b\u952e\u7684\u7d22\u5f15\u503c\u90fd\u662f\u968f\u673a\u7684\uff0c\u56e0\u6b64\u6bcf\u6b21\u63d2\u5165\u65b0\u7684\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u63d2\u5165\u5230\u73b0\u6709\u6570\u636e\u9875\u4e2d\u95f4\u7684\u67d0\u4e2a\u4f4d\u7f6e\uff0c\u8fd9\u5c06\u4e0d\u5f97\u4e0d\u79fb\u52a8\u5176\u5b83\u6570\u636e\u6765\u6ee1\u8db3\u65b0\u6570\u636e\u7684\u63d2\u5165\uff0c\u751a\u81f3\u9700\u8981\u4ece\u4e00\u4e2a\u9875\u9762\u590d\u5236\u6570\u636e\u5230\u53e6\u5916\u4e00\u4e2a\u9875\u9762\uff0c\u6211\u4eec\u901a\u5e38\u5c06\u8fd9\u79cd\u60c5\u51b5\u79f0\u4e3a\u9875\u5206\u88c2\u3002\u9875\u5206\u88c2\u8fd8\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u5927\u91cf\u7684\u5185\u5b58\u788e\u7247\uff0c\u5bfc\u81f4\u7d22\u5f15\u7ed3\u6784\u4e0d\u7d27\u51d1\uff0c\u4ece\u800c\u5f71\u54cd\u67e5\u8be2\u6548\u7387\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u67d0\u4e2a\u6570\u636e\u9875\u4e2d\u7684\u6570\u636e\u662f 1\u30013\u30015\u30019\uff0c\u4e14\u6570\u636e\u9875\u6ee1\u4e86\uff0c\u73b0\u5728\u51c6\u5907\u63d2\u5165\u4e00\u4e2a\u6570\u636e 7\uff0c\u5219\u9700\u8981\u628a\u6570\u636e\u9875\u5206\u5272\u4e3a\u4e24\u4e2a\u6570\u636e\u9875\uff1a</p> <p></p> <p>\u51fa\u73b0\u9875\u5206\u88c2\u65f6\uff0c\u9700\u8981\u5c06\u4e00\u4e2a\u9875\u7684\u8bb0\u5f55\u79fb\u52a8\u5230\u53e6\u5916\u4e00\u4e2a\u9875\uff0c\u6027\u80fd\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u540c\u65f6\u9875\u7a7a\u95f4\u7684\u5229\u7528\u7387\u4e0b\u964d\uff0c\u9020\u6210\u5b58\u50a8\u7a7a\u95f4\u7684\u6d6a\u8d39\u3002</p> <p>\u800c\u5982\u679c\u8bb0\u5f55\u662f\u987a\u5e8f\u63d2\u5165\u7684\uff0c\u4f8b\u5982\u63d2\u5165\u6570\u636e 11\uff0c\u5219\u53ea\u9700\u5f00\u8f9f\u65b0\u7684\u6570\u636e\u9875\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53d1\u751f\u9875\u5206\u88c2\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u5728\u4f7f\u7528 InnoDB \u5b58\u50a8\u5f15\u64ce\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u7279\u522b\u7684\u4e1a\u52a1\u9700\u6c42\uff0c\u5efa\u8bae\u4f7f\u7528\u81ea\u589e\u5b57\u6bb5\u4f5c\u4e3a\u4e3b\u952e\u3002</p> <p>\u53e6\u5916\uff0c\u4e3b\u952e\u5b57\u6bb5\u7684\u957f\u5ea6\u4e0d\u8981\u592a\u5927\uff0c\u56e0\u4e3a\u4e3b\u952e\u5b57\u6bb5\u957f\u5ea6\u8d8a\u5c0f\uff0c\u610f\u5473\u7740\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u8d8a\u5c0f\uff08\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u6570\u636e\u662f\u4e3b\u952e\u503c\uff09\uff0c\u8fd9\u6837\u4e8c\u7ea7\u7d22\u5f15\u5360\u7528\u7684\u7a7a\u95f4\u4e5f\u5c31\u8d8a\u5c0f\u3002</p>"},{"location":"mysql/index/index_interview/#not-null","title":"\u7d22\u5f15\u6700\u597d\u8bbe\u7f6e\u4e3a NOT NULL","text":"<p>\u4e3a\u4e86\u66f4\u597d\u7684\u5229\u7528\u7d22\u5f15\uff0c\u7d22\u5f15\u5217\u8981\u8bbe\u7f6e\u4e3a NOT NULL \u7ea6\u675f\u3002\u6709\u4e24\u4e2a\u539f\u56e0\uff1a</p> <ul> <li> <p>\u7b2c\u4e00\u539f\u56e0\uff1a\u7d22\u5f15\u5217\u5b58\u5728 NULL \u5c31\u4f1a\u5bfc\u81f4\u4f18\u5316\u5668\u5728\u505a\u7d22\u5f15\u9009\u62e9\u7684\u65f6\u5019\u66f4\u52a0\u590d\u6742\uff0c\u66f4\u52a0\u96be\u4ee5\u4f18\u5316\uff0c\u56e0\u4e3a\u53ef\u4e3a NULL \u7684\u5217\u4f1a\u4f7f\u7d22\u5f15\u3001\u7d22\u5f15\u7edf\u8ba1\u548c\u503c\u6bd4\u8f83\u90fd\u66f4\u590d\u6742\uff0c\u6bd4\u5982\u8fdb\u884c\u7d22\u5f15\u7edf\u8ba1\u65f6\uff0ccount \u4f1a\u7701\u7565\u503c\u4e3a NULL \u7684\u884c\u3002</p> </li> <li> <p>\u7b2c\u4e8c\u4e2a\u539f\u56e0\uff1aNULL \u503c\u662f\u4e00\u4e2a\u6ca1\u610f\u4e49\u7684\u503c\uff0c\u4f46\u662f\u5b83\u4f1a\u5360\u7528\u7269\u7406\u7a7a\u95f4\uff0c\u6240\u4ee5\u4f1a\u5e26\u6765\u7684\u5b58\u50a8\u7a7a\u95f4\u7684\u95ee\u9898\uff0c\u4f1a\u5bfc\u81f4\u66f4\u591a\u7684\u5b58\u50a8\u7a7a\u95f4\u5360\u7528\uff0c\u56e0\u4e3a InnoDB \u9ed8\u8ba4\u884c\u5b58\u50a8\u683c\u5f0f<code>COMPACT</code>\uff0c\u4f1a\u7528 1 \u5b57\u8282\u7a7a\u95f4\u5b58\u50a8 NULL \u503c\u5217\u8868\uff0c\u5982\u4e0b\u56fe\u7684\u9ec4\u8272\u90e8\u5206\uff1a</p> </li> </ul> <p></p>"},{"location":"mysql/index/index_interview/#_26","title":"\u9632\u6b62\u7d22\u5f15\u5931\u6548","text":"<p>\u7528\u4e0a\u4e86\u7d22\u5f15\u5e76\u4e0d\u610f\u5473\u7740\u67e5\u8be2\u7684\u65f6\u5019\u4f1a\u4f7f\u7528\u5230\u7d22\u5f15\uff0c\u6240\u4ee5\u6211\u4eec\u5fc3\u91cc\u8981\u6e05\u695a\u6709\u54ea\u4e9b\u60c5\u51b5\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u4ece\u800c\u907f\u514d\u5199\u51fa\u7d22\u5f15\u5931\u6548\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u5426\u5219\u8fd9\u6837\u7684\u67e5\u8be2\u6548\u7387\u662f\u5f88\u4f4e\u7684\u3002</p> <p>\u6211\u4e4b\u524d\u5199\u8fc7\u7d22\u5f15\u5931\u6548\u7684\u6587\u7ae0\uff0c\u60f3\u8be6\u7ec6\u4e86\u89e3\u7684\u53ef\u4ee5\u53bb\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1a\u8c01\u8fd8\u6ca1\u78b0\u8fc7\u7d22\u5f15\u5931\u6548\u5462\uff1f</p> <p>\u8fd9\u91cc\u7b80\u5355\u8bf4\u4e00\u4e0b\uff0c\u53d1\u751f\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff1a</p> <ul> <li>\u5f53\u6211\u4eec\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f <code>like %xx</code> \u6216\u8005 <code>like %xx%</code>\u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\uff1b</li> <li>\u5f53\u6211\u4eec\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5217\u505a\u4e86\u8ba1\u7b97\u3001\u51fd\u6570\u3001\u7c7b\u578b\u8f6c\u6362\u64cd\u4f5c\uff0c\u8fd9\u4e9b\u60c5\u51b5\u4e0b\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\uff1b</li> <li>\u8054\u5408\u7d22\u5f15\u8981\u80fd\u6b63\u786e\u4f7f\u7528\u9700\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\uff0c\u5426\u5219\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002</li> <li>\u5728 WHERE \u5b50\u53e5\u4e2d\uff0c\u5982\u679c\u5728 OR \u524d\u7684\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\uff0c\u800c\u5728 OR \u540e\u7684\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u7d22\u5f15\u4f1a\u5931\u6548\u3002</li> </ul> <p>\u6211\u4e0a\u9762\u8bf4\u7684\u662f\u5e38\u89c1\u7684\u7d22\u5f15\u5931\u6548\u573a\u666f\uff0c\u5b9e\u9645\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u5176\u4ed6\u7684\u7d22\u5f15\u5931\u6548\u573a\u666f\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u67e5\u770b\u6267\u884c\u8ba1\u5212\uff0c\u901a\u8fc7\u6267\u884c\u8ba1\u5212\u663e\u793a\u7684\u6570\u636e\u5224\u65ad\u67e5\u8be2\u8bed\u53e5\u662f\u5426\u4f7f\u7528\u4e86\u7d22\u5f15\u3002</p> <p>\u5982\u4e0b\u56fe\uff0c\u5c31\u662f\u4e00\u4e2a\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u5e76\u4e14\u662f\u4e00\u4e2a\u5168\u8868\u626b\u63cf\u7684\u67e5\u8be2\u8bed\u53e5\u3002</p> <p></p> <p>\u5bf9\u4e8e\u6267\u884c\u8ba1\u5212\uff0c\u53c2\u6570\u6709\uff1a</p> <ul> <li>possible_keys \u5b57\u6bb5\u8868\u793a\u53ef\u80fd\u7528\u5230\u7684\u7d22\u5f15\uff1b</li> <li>key \u5b57\u6bb5\u8868\u793a\u5b9e\u9645\u7528\u7684\u7d22\u5f15\uff0c\u5982\u679c\u8fd9\u4e00\u9879\u4e3a NULL\uff0c\u8bf4\u660e\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff1b</li> <li>key_len \u8868\u793a\u7d22\u5f15\u7684\u957f\u5ea6\uff1b</li> <li>rows \u8868\u793a\u626b\u63cf\u7684\u6570\u636e\u884c\u6570\u3002</li> <li>type \u8868\u793a\u6570\u636e\u626b\u63cf\u7c7b\u578b\uff0c\u6211\u4eec\u9700\u8981\u91cd\u70b9\u770b\u8fd9\u4e2a\u3002</li> </ul> <p>type \u5b57\u6bb5\u5c31\u662f\u63cf\u8ff0\u4e86\u627e\u5230\u6240\u9700\u6570\u636e\u65f6\u4f7f\u7528\u7684\u626b\u63cf\u65b9\u5f0f\u662f\u4ec0\u4e48\uff0c\u5e38\u89c1\u626b\u63cf\u7c7b\u578b\u7684\u6267\u884c\u6548\u7387\u4ece\u4f4e\u5230\u9ad8\u7684\u987a\u5e8f\u4e3a\uff1a</p> <ul> <li>All\uff08\u5168\u8868\u626b\u63cf\uff09\uff1b</li> <li>index\uff08\u5168\u7d22\u5f15\u626b\u63cf\uff09\uff1b</li> <li>range\uff08\u7d22\u5f15\u8303\u56f4\u626b\u63cf\uff09\uff1b</li> <li>ref\uff08\u975e\u552f\u4e00\u7d22\u5f15\u626b\u63cf\uff09\uff1b</li> <li>eq_ref\uff08\u552f\u4e00\u7d22\u5f15\u626b\u63cf\uff09\uff1b</li> <li>const\uff08\u7ed3\u679c\u53ea\u6709\u4e00\u6761\u7684\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\u626b\u63cf\uff09\u3002</li> </ul> <p>\u5728\u8fd9\u4e9b\u60c5\u51b5\u91cc\uff0call \u662f\u6700\u574f\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u91c7\u7528\u4e86\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u3002index \u548c all \u5dee\u4e0d\u591a\uff0c\u53ea\u4e0d\u8fc7 index \u5bf9\u7d22\u5f15\u8868\u8fdb\u884c\u5168\u626b\u63cf\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u662f\u4e0d\u518d\u9700\u8981\u5bf9\u6570\u636e\u8fdb\u884c\u6392\u5e8f\uff0c\u4f46\u662f\u5f00\u9500\u4f9d\u7136\u5f88\u5927\u3002\u6240\u4ee5\uff0c\u8981\u5c3d\u91cf\u907f\u514d\u5168\u8868\u626b\u63cf\u548c\u5168\u7d22\u5f15\u626b\u63cf\u3002</p> <p>range \u8868\u793a\u91c7\u7528\u4e86\u7d22\u5f15\u8303\u56f4\u626b\u63cf\uff0c\u4e00\u822c\u5728 where \u5b50\u53e5\u4e2d\u4f7f\u7528 &lt; \u3001&gt;\u3001in\u3001between \u7b49\u5173\u952e\u8bcd\uff0c\u53ea\u68c0\u7d22\u7ed9\u5b9a\u8303\u56f4\u7684\u884c\uff0c\u5c5e\u4e8e\u8303\u56f4\u67e5\u627e\u3002\u4ece\u8fd9\u4e00\u7ea7\u522b\u5f00\u59cb\uff0c\u7d22\u5f15\u7684\u4f5c\u7528\u4f1a\u8d8a\u6765\u8d8a\u660e\u663e\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5c3d\u91cf\u8ba9 SQL \u67e5\u8be2\u53ef\u4ee5\u4f7f\u7528\u5230 range \u8fd9\u4e00\u7ea7\u522b\u53ca\u4ee5\u4e0a\u7684 type \u8bbf\u95ee\u65b9\u5f0f\u3002</p> <p>ref \u7c7b\u578b\u8868\u793a\u91c7\u7528\u4e86\u975e\u552f\u4e00\u7d22\u5f15\uff0c\u6216\u8005\u662f\u552f\u4e00\u7d22\u5f15\u7684\u975e\u552f\u4e00\u6027\u524d\u7f00\uff0c\u8fd4\u56de\u6570\u636e\u8fd4\u56de\u53ef\u80fd\u662f\u591a\u6761\u3002\u56e0\u4e3a\u867d\u7136\u4f7f\u7528\u4e86\u7d22\u5f15\uff0c\u4f46\u8be5\u7d22\u5f15\u5217\u7684\u503c\u5e76\u4e0d\u552f\u4e00\uff0c\u6709\u91cd\u590d\u3002\u8fd9\u6837\u5373\u4f7f\u4f7f\u7528\u7d22\u5f15\u5feb\u901f\u67e5\u627e\u5230\u4e86\u7b2c\u4e00\u6761\u6570\u636e\uff0c\u4ecd\u7136\u4e0d\u80fd\u505c\u6b62\uff0c\u8981\u8fdb\u884c\u76ee\u6807\u503c\u9644\u8fd1\u7684\u5c0f\u8303\u56f4\u626b\u63cf\u3002\u4f46\u5b83\u7684\u597d\u5904\u662f\u5b83\u5e76\u4e0d\u9700\u8981\u626b\u5168\u8868\uff0c\u56e0\u4e3a\u7d22\u5f15\u662f\u6709\u5e8f\u7684\uff0c\u5373\u4fbf\u6709\u91cd\u590d\u503c\uff0c\u4e5f\u662f\u5728\u4e00\u4e2a\u975e\u5e38\u5c0f\u7684\u8303\u56f4\u5185\u626b\u63cf\u3002</p> <p>eq_ref \u7c7b\u578b\u662f\u4f7f\u7528\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\u65f6\u4ea7\u751f\u7684\u8bbf\u95ee\u65b9\u5f0f\uff0c\u901a\u5e38\u4f7f\u7528\u5728\u591a\u8868\u8054\u67e5\u4e2d\u3002\u6bd4\u5982\uff0c\u5bf9\u4e24\u5f20\u8868\u8fdb\u884c\u8054\u67e5\uff0c\u5173\u8054\u6761\u4ef6\u662f\u4e24\u5f20\u8868\u7684 user_id \u76f8\u7b49\uff0c\u4e14 user_id \u662f\u552f\u4e00\u7d22\u5f15\uff0c\u90a3\u4e48\u4f7f\u7528 EXPLAIN \u8fdb\u884c\u6267\u884c\u8ba1\u5212\u67e5\u770b\u7684\u65f6\u5019\uff0ctype \u5c31\u4f1a\u663e\u793a eq_ref\u3002</p> <p>const \u7c7b\u578b\u8868\u793a\u4f7f\u7528\u4e86\u4e3b\u952e\u6216\u8005\u552f\u4e00\u7d22\u5f15\u4e0e\u5e38\u91cf\u503c\u8fdb\u884c\u6bd4\u8f83\uff0c\u6bd4\u5982 select name  from product where id=1\u3002</p> <p>\u9700\u8981\u8bf4\u660e\u7684\u662f const \u7c7b\u578b\u548c eq_ref \u90fd\u4f7f\u7528\u4e86\u4e3b\u952e\u6216\u552f\u4e00\u7d22\u5f15\uff0c\u4e0d\u8fc7\u8fd9\u4e24\u4e2a\u7c7b\u578b\u6709\u6240\u533a\u522b\uff0cconst \u662f\u4e0e\u5e38\u91cf\u8fdb\u884c\u6bd4\u8f83\uff0c\u67e5\u8be2\u6548\u7387\u4f1a\u66f4\u5feb\uff0c\u800c eq_ref \u901a\u5e38\u7528\u4e8e\u591a\u8868\u8054\u67e5\u4e2d\u3002</p> <p>\u9664\u4e86\u5173\u6ce8 type\uff0c\u6211\u4eec\u4e5f\u8981\u5173\u6ce8 extra \u663e\u793a\u7684\u7ed3\u679c\u3002</p> <p>\u8fd9\u91cc\u8bf4\u51e0\u4e2a\u91cd\u8981\u7684\u53c2\u8003\u6307\u6807\uff1a</p> <ul> <li>Using filesort\uff1a\u5f53\u67e5\u8be2\u8bed\u53e5\u4e2d\u5305\u542b order by \u64cd\u4f5c\uff0c\u800c\u4e14\u65e0\u6cd5\u5229\u7528\u7d22\u5f15\u5b8c\u6210\u6392\u5e8f\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u8fd9\u65f6\u4e0d\u5f97\u4e0d\u9009\u62e9\u76f8\u5e94\u7684\u6392\u5e8f\u7b97\u6cd5\u8fdb\u884c\uff0c\u751a\u81f3\u53ef\u80fd\u4f1a\u901a\u8fc7\u6587\u4ef6\u6392\u5e8f\uff0c\u6548\u7387\u662f\u5f88\u4f4e\u7684\uff0c\u6240\u4ee5\u8981\u907f\u514d\u8fd9\u79cd\u95ee\u9898\u7684\u51fa\u73b0\u3002</li> <li>Using temporary\uff1a\u4f7f\u4e86\u7528\u4e34\u65f6\u8868\u4fdd\u5b58\u4e2d\u95f4\u7ed3\u679c\uff0cMySQL \u5728\u5bf9\u67e5\u8be2\u7ed3\u679c\u6392\u5e8f\u65f6\u4f7f\u7528\u4e34\u65f6\u8868\uff0c\u5e38\u89c1\u4e8e\u6392\u5e8f order by \u548c\u5206\u7ec4\u67e5\u8be2 group by\u3002\u6548\u7387\u4f4e\uff0c\u8981\u907f\u514d\u8fd9\u79cd\u95ee\u9898\u7684\u51fa\u73b0\u3002</li> <li>Using index\uff1a\u6240\u9700\u6570\u636e\u53ea\u9700\u5728\u7d22\u5f15\u5373\u53ef\u5168\u90e8\u83b7\u5f97\uff0c\u4e0d\u987b\u8981\u518d\u5230\u8868\u4e2d\u53d6\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528\u4e86\u8986\u76d6\u7d22\u5f15\uff0c\u907f\u514d\u4e86\u56de\u8868\u64cd\u4f5c\uff0c\u6548\u7387\u4e0d\u9519\u3002</li> </ul>"},{"location":"mysql/index/index_interview/#_27","title":"\u603b\u7ed3","text":"<p>\u8fd9\u6b21\u4e3b\u8981\u4ecb\u7ecd\u4e86\u7d22\u5f15\u7684\u539f\u7406\u3001\u5206\u7c7b\u548c\u4f7f\u7528\u3002\u6211\u628a\u91cd\u70b9\u603b\u7ed3\u5728\u4e86\u4e0b\u9762\u8fd9\u4e2a\u8868\u683c</p> <p></p> <p>\u5b8c\uff01</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/index/index_issue/","title":"MySQL \u4f7f\u7528 like\u201c%x\u201c\uff0c\u7d22\u5f15\u4e00\u5b9a\u4f1a\u5931\u6548\u5417\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6628\u5929\u53d1\u4e86\u4e00\u7bc7\u5173\u4e8e\u7d22\u5f15\u5931\u6548\u7684\u6587\u7ae0\uff1a\u8c01\u8fd8\u6ca1\u78b0\u8fc7\u7d22\u5f15\u5931\u6548\u5462</p> <p>\u6211\u5728\u6587\u672b\u7559\u4e86\u4e00\u4e2a\u6709\u70b9\u610f\u601d\u7684\u601d\u8003\u9898\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u601d\u8003\u9898\u5176\u5b9e\u662f\u51fa\u81ea\u4e8e\uff0c\u6211\u4e4b\u524d\u8fd9\u7bc7\u6587\u7ae0\u300c\u4e00\u6761 SQL \u8bed\u53e5\u5f15\u53d1\u7684\u601d\u8003\u300d\u4e2d\u7559\u8a00\u533a\u4e00\u4f4d\u8bfb\u8005\u670b\u53cb\u51fa\u7684\u95ee\u9898\u3002</p> <p>\u5f88\u591a\u8bfb\u8005\u90fd\u5728\u7559\u8a00\u533a\u8bf4\u4e86\u81ea\u5df1\u7684\u60f3\u6cd5\uff0c\u4e5f\u6709\u4e0d\u5c11\u8bfb\u8005\u79c1\u804a\u6211\u7b54\u6848\u5230\u5e95\u662f\u4ec0\u4e48\uff1f</p> <p>\u6240\u4ee5\uff0c\u6211\u4eca\u665a\u5c31\u8ddf\u5927\u5bb6\u804a\u804a\u8fd9\u4e2a\u601d\u8003\u9898\u3002</p>"},{"location":"mysql/index/index_issue/#_1","title":"\u9898\u76ee\u4e00","text":"<p>\u9898\u76ee\u4e00\u5f88\u7b80\u5355\uff0c\u76f8\u4fe1\u5927\u5bb6\u90fd\u80fd\u5206\u6790\u51fa\u7b54\u6848\uff0c\u6211\u6628\u5929\u5206\u4eab\u7684\u7d22\u5f15\u5931\u6548\u6587\u7ae0\u91cc\u4e5f\u63d0\u53ca\u8fc7\u3002</p> <p>\u9898\u76ee 1 \u7684\u6570\u636e\u5e93\u8868\u5982\u4e0b\uff0cid \u662f\u4e3b\u952e\u7d22\u5f15\uff0cname \u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5176\u4ed6\u5b57\u6bb5\u90fd\u662f\u975e\u7d22\u5f15\u5b57\u6bb5\u3002</p> <p></p> <p>\u8fd9\u56db\u6761\u6a21\u7cca\u5339\u914d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u7b2c\u4e00\u6761\u548c\u7b2c\u4e8c\u6761\u90fd\u4f1a\u8d70\u7d22\u5f15\u626b\u63cf\uff0c\u800c\u4e14\u90fd\u662f\u9009\u62e9\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\uff08index_name\uff09\uff0c\u6211\u8d34\u4e2a\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u7ed3\u679c\u56fe\uff1a</p> <p></p> <p>\u800c\u7b2c\u4e09\u548c\u7b2c\u56db\u6761\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\uff0c\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c type= ALL\uff0c\u4ee3\u8868\u4e86\u5168\u8868\u626b\u63cf\u3002</p> <p></p>"},{"location":"mysql/index/index_issue/#_2","title":"\u9898\u76ee\u4e8c","text":"<p>\u9898\u76ee 2 \u7684\u6570\u636e\u5e93\u8868\u7279\u522b\u4e4b\u5904\u5728\u4e8e\uff0c\u53ea\u6709\u4e24\u4e2a\u5b57\u6bb5\uff0c\u4e00\u4e2a\u662f\u4e3b\u952e\u7d22\u5f15 id\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u4e8c\u7ea7\u7d22\u5f15 name\u3002</p> <p></p> <p>\u9488\u5bf9\u9898\u76ee 2 \u7684\u6570\u636e\u8868\uff0c\u7b2c\u4e00\u6761\u548c\u7b2c\u4e8c\u6761\u6a21\u7cca\u67e5\u8be2\u8bed\u53e5\u4e5f\u662f\u4e00\u6837\u53ef\u4ee5\u8d70\u7d22\u5f15\u626b\u63cf\uff0c\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u5982\u4e0b\uff0cExtra \u91cc\u7684 Using index \u8bf4\u660e\u7528\u4e0a\u4e86\u8986\u76d6\u7d22\u5f15\uff1a</p> <p></p> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u7b2c\u4e09\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\uff08\u7b2c\u56db\u6761\u4e5f\u662f\u4e00\u6837\u7684\u7ed3\u679c\uff09\uff1a</p> <p></p> <p>\u4ece\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230 key=index_name\uff0c\u4e5f\u5c31\u662f\u8bf4\u7528\u4e0a\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u800c\u4e14\u4ece Extra \u91cc\u7684 Using index \u8bf4\u660e\u7528\u4e0a\u4e86\u8986\u76d6\u7d22\u5f15\u3002</p> <p>\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p>\u9996\u5148\uff0c\u8fd9\u5f20\u8868\u7684\u5b57\u6bb5\u6ca1\u6709\u300c\u975e\u7d22\u5f15\u300d\u5b57\u6bb5\uff0c\u6240\u4ee5 <code>select *</code> \u76f8\u5f53\u4e8e <code>select id,name</code>\uff0c\u7136\u540e\u8fd9\u4e2a\u67e5\u8be2\u7684\u6570\u636e\u90fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\uff0c\u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u53f6\u5b50\u8282\u70b9\u5305\u542b\u300c\u7d22\u5f15\u503c + \u4e3b\u952e\u503c\u300d\uff0c\u6240\u4ee5\u67e5\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u5c31\u80fd\u67e5\u5230\u5168\u90e8\u7ed3\u679c\u4e86\uff0c\u8fd9\u4e2a\u5c31\u662f\u8986\u76d6\u7d22\u5f15\u3002</p> <p>\u4f46\u662f\u6267\u884c\u8ba1\u5212\u91cc\u7684 type \u662f <code>index</code>\uff0c\u8fd9\u4ee3\u8868\u7740\u662f\u901a\u8fc7\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u65b9\u5f0f\u67e5\u8be2\u5230\u6570\u636e\u7684\uff0c\u4e5f\u5c31\u662f\u904d\u5386\u4e86\u6574\u9897\u7d22\u5f15\u6811\u3002</p> <p>\u800c\u7b2c\u4e00\u548c\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u7684\u6267\u884c\u8ba1\u5212\u4e2d type \u662f <code>range</code>\uff0c\u8868\u793a\u5bf9\u7d22\u5f15\u5217\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u5229\u7528\u4e86\u7d22\u5f15\u6811\u7684\u6709\u5e8f\u6027\u7684\u7279\u70b9\uff0c\u901a\u8fc7\u67e5\u8be2\u6bd4\u8f83\u7684\u65b9\u5f0f\uff0c\u5feb\u901f\u5b9a\u4f4d\u5230\u4e86\u6570\u636e\u884c\u3002</p> <p>\u6240\u4ee5\uff0ctype=range \u7684\u67e5\u8be2\u6548\u7387\u4f1a\u6bd4 type=index \u7684\u9ad8\u4e00\u4e9b\u3002</p> <p>\u4e3a\u4ec0\u4e48\u9009\u62e9\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811\uff0c\u800c\u4e0d\u626b\u63cf\u805a\u7c07\u7d22\u5f15\u6811\u5462\uff1f</p> <p>\u56e0\u4e3a\u4e8c\u7ea7\u7d22\u5f15\u6811\u7684\u8bb0\u5f55\u4e1c\u897f\u5f88\u5c11\uff0c\u5c31\u53ea\u6709\u300c\u7d22\u5f15\u5217 + \u4e3b\u952e\u503c\u300d\uff0c\u800c\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u7684\u4e1c\u897f\u4f1a\u66f4\u591a\uff0c\u6bd4\u5982\u805a\u7c07\u7d22\u5f15\u4e2d\u7684\u53f6\u5b50\u8282\u70b9\u5219\u8bb0\u5f55\u4e86\u4e3b\u952e\u503c\u3001\u4e8b\u52a1 id\u3001\u7528\u4e8e\u4e8b\u52a1\u548c MVCC \u7684\u56de\u6eda\u6307\u9488\u4ee5\u53ca\u6240\u6709\u7684\u5269\u4f59\u5217\u3002</p> <p>\u518d\u52a0\u4e0a\uff0c\u8fd9\u4e2a select * \u4e0d\u7528\u6267\u884c\u56de\u8868\u64cd\u4f5c\u3002</p> <p>\u6240\u4ee5\uff0cMySQL \u4f18\u5316\u5668\u8ba4\u4e3a\u76f4\u63a5\u904d\u5386\u4e8c\u7ea7\u7d22\u5f15\u6811\u8981\u6bd4\u904d\u5386\u805a\u7c07\u7d22\u5f15\u6811\u7684\u6210\u672c\u8981\u5c0f\u7684\u591a\uff0c\u56e0\u6b64 MySQL \u9009\u62e9\u4e86\u300c\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811\u300d\u7684\u65b9\u5f0f\u67e5\u8be2\u6570\u636e\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u6570\u636e\u8868\u52a0\u4e86\u975e\u7d22\u5f15\u5b57\u6bb5\uff0c\u6267\u884c\u540c\u6837\u7684\u67e5\u8be2\u8bed\u53e5\u540e\uff0c\u600e\u4e48\u53d8\u6210\u8d70\u7684\u662f\u5168\u8868\u626b\u63cf\u5462\uff1f</p> <p>\u52a0\u4e86\u5176\u4ed6\u5b57\u6bb5\u540e\uff0c<code>select * from t_user where name like \"%xx\";</code> \u8981\u67e5\u8be2\u7684\u6570\u636e\u5c31\u4e0d\u80fd\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u91cc\u627e\u4e86\uff0c\u5f97\u9700\u8981\u56de\u8868\u64cd\u4f5c\u624d\u80fd\u5b8c\u6210\u67e5\u8be2\u7684\u5de5\u4f5c\uff0c\u518d\u52a0\u4e0a\u662f\u5de6\u6a21\u7cca\u5339\u914d\uff0c\u65e0\u6cd5\u5229\u7528\u7d22\u5f15\u6811\u7684\u6709\u5e8f\u6027\u6765\u5feb\u901f\u5b9a\u4f4d\u6570\u636e\uff0c\u6240\u4ee5\u5f97\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u9010\u4e00\u904d\u5386\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\u540e\uff0c\u518d\u5230\u805a\u7c07\u7d22\u5f15\u6811\u68c0\u7d22\u5230\u5bf9\u5e94\u7684\u6570\u636e\u884c\uff0c\u8fd9\u6837\u5b9e\u5728\u592a\u7d2f\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u4f18\u5316\u5668\u8ba4\u4e3a\u4e0a\u9762\u8fd9\u6837\u7684\u67e5\u8be2\u8fc7\u7a0b\u7684\u6210\u672c\u5b9e\u5728\u592a\u9ad8\u4e86\uff0c\u6240\u4ee5\u76f4\u63a5\u9009\u62e9\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u67e5\u8be2\u6570\u636e\u3002</p> <p>\u4ece\u8fd9\u4e2a\u601d\u8003\u9898\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u4f7f\u7528\u5de6\u6a21\u7cca\u5339\u914d\uff08like \"%xx\"\uff09\u5e76\u4e0d\u4e00\u5b9a\u4f1a\u8d70\u5168\u8868\u626b\u63cf\uff0c\u5173\u952e\u8fd8\u662f\u770b\u6570\u636e\u8868\u4e2d\u7684\u5b57\u6bb5\u3002</p> <p>\u5982\u679c\u6570\u636e\u5e93\u8868\u4e2d\u7684\u5b57\u6bb5\u53ea\u6709\u4e3b\u952e + \u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u5373\u4f7f\u4f7f\u7528\u4e86\u5de6\u6a21\u7cca\u5339\u914d\uff0c\u4e5f\u4e0d\u4f1a\u8d70\u5168\u8868\u626b\u63cf\uff08type=all\uff09\uff0c\u800c\u662f\u8d70\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811 (type=index)\u3002</p> <p>\u518d\u8bf4\u4e00\u4e2a\u76f8\u4f3c\uff0c\u6211\u4eec\u90fd\u77e5\u9053\u8054\u5408\u7d22\u5f15\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u624d\u80fd\u8d70\u7d22\u5f15\uff0c\u4f46\u662f\u5982\u679c\u6570\u636e\u5e93\u8868\u4e2d\u7684\u5b57\u6bb5\u90fd\u662f\u7d22\u5f15\u7684\u8bdd\uff0c\u5373\u4f7f\u67e5\u8be2\u8fc7\u7a0b\u4e2d\uff0c\u6ca1\u6709\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u662f\u8d70\u5168\u626b\u63cf\u4e8c\u7ea7\u7d22\u5f15\u6811 (type=index)\uff0c\u6bd4\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5c31\u8bf4\u5230\u8fd9\u4e86\uff0c\u4e0b\u6b21\u89c1\u5566</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/index/index_lose/","title":"\u7d22\u5f15\u5931\u6548\u6709\u54ea\u4e9b\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u5728\u5de5\u4f5c\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u60f3\u63d0\u9ad8\u4e00\u6761\u8bed\u53e5\u67e5\u8be2\u901f\u5ea6\uff0c\u901a\u5e38\u90fd\u4f1a\u60f3\u5bf9\u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15\u3002</p> <p>\u4f46\u662f\u7d22\u5f15\u5e76\u4e0d\u662f\u4e07\u80fd\u7684\u3002\u5efa\u7acb\u4e86\u7d22\u5f15\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u4efb\u4f55\u67e5\u8be2\u8bed\u53e5\u90fd\u80fd\u8d70\u7d22\u5f15\u626b\u63cf\u3002</p> <p>\u7a0d\u4e0d\u6ce8\u610f\uff0c\u53ef\u80fd\u4f60\u5199\u7684\u67e5\u8be2\u8bed\u53e5\u662f\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u4ece\u800c\u8d70\u4e86\u5168\u8868\u626b\u63cf\uff0c\u867d\u7136\u67e5\u8be2\u7684\u7ed3\u679c\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u67e5\u8be2\u7684\u6027\u80fd\u5927\u5927\u964d\u4f4e\u3002</p> <p>\u4eca\u5929\u5c31\u6765\u8ddf\u5927\u5bb6\u76d8\u4e00\u76d8\uff0c\u5e38\u89c1\u7684 6 \u79cd\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\u7684\u573a\u666f\u3002</p> <p>\u4e0d\u4ec5\u4f1a\u7528\u5b9e\u9a8c\u6848\u4f8b\u7ed9\u5927\u5bb6\u8bf4\u660e\uff0c\u4e5f\u4f1a\u6e05\u695a\u6bcf\u4e2a\u7d22\u5f15\u5931\u6548\u7684\u539f\u56e0\u3002</p> <p>\u53d1\u8f66\uff01</p> <p></p>"},{"location":"mysql/index/index_lose/#_2","title":"\u7d22\u5f15\u5b58\u50a8\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\uff1f","text":"<p>\u6211\u4eec\u5148\u6765\u770b\u770b\u7d22\u5f15\u5b58\u50a8\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\uff1f\u56e0\u4e3a\u53ea\u6709\u77e5\u9053\u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\uff0c\u624d\u80fd\u66f4\u597d\u7684\u7406\u89e3\u7d22\u5f15\u5931\u6548\u7684\u95ee\u9898\u3002</p> <p>\u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\u8ddf MySQL \u4f7f\u7528\u54ea\u79cd\u5b58\u50a8\u5f15\u64ce\u6709\u5173\uff0c\u56e0\u4e3a\u5b58\u50a8\u5f15\u64ce\u5c31\u662f\u8d1f\u8d23\u5c06\u6570\u636e\u6301\u4e45\u5316\u5728\u78c1\u76d8\u4e2d\uff0c\u800c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\u91c7\u7528\u7684\u7d22\u5f15\u6570\u636e\u7ed3\u6784\u4e5f\u4f1a\u4e0d\u76f8\u540c\u3002</p> <p>MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\u662f InnoDB\uff0c\u5b83\u91c7\u7528 B+Tree \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u9009\u62e9  B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u8be6\u7ec6\u7684\u5206\u6790\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1a\u4e3a\u4ec0\u4e48 MySQL \u559c\u6b22 B+ \u6811\uff1f</p> <p>\u5728\u521b\u5efa\u8868\u65f6\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u9ed8\u8ba4\u4f1a\u521b\u5efa\u4e00\u4e2a\u4e3b\u952e\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u805a\u7c07\u7d22\u5f15\uff0c\u5176\u5b83\u7d22\u5f15\u90fd\u5c5e\u4e8e\u4e8c\u7ea7\u7d22\u5f15\u3002</p> <p>MySQL \u7684 MyISAM \u5b58\u50a8\u5f15\u64ce\u652f\u6301\u591a\u79cd\u7d22\u5f15\u6570\u636e\u7ed3\u6784\uff0c\u6bd4\u5982 B+ \u6811\u7d22\u5f15\u3001R \u6811\u7d22\u5f15\u3001Full-Text \u7d22\u5f15\u3002MyISAM \u5b58\u50a8\u5f15\u64ce\u5728\u521b\u5efa\u8868\u65f6\uff0c\u521b\u5efa\u7684\u4e3b\u952e\u7d22\u5f15\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f B+ \u6811\u7d22\u5f15\u3002</p> <p>\u867d\u7136\uff0cInnoDB \u548c MyISAM \u90fd\u652f\u6301 B+ \u6811\u7d22\u5f15\uff0c\u4f46\u662f\u5b83\u4eec\u6570\u636e\u7684\u5b58\u50a8\u7ed3\u6784\u5b9e\u73b0\u65b9\u5f0f\u4e0d\u540c\u3002\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff1a</p> <ul> <li>InnoDB \u5b58\u50a8\u5f15\u64ce\uff1aB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u672c\u8eab\uff1b</li> <li>MyISAM \u5b58\u50a8\u5f15\u64ce\uff1aB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u7684\u7269\u7406\u5730\u5740\uff1b</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u7ed9\u5927\u5bb6\u5c55\u793a\u4e0b\u8fd9\u4e24\u79cd\u5b58\u50a8\u5f15\u64ce\u7684\u7d22\u5f15\u5b58\u50a8\u7ed3\u6784\u7684\u533a\u522b\u3002</p> <p>\u8fd9\u91cc\u6709\u4e00\u5f20 t_user \u8868\uff0c\u5176\u4e2d id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\uff0c\u5176\u4ed6\u90fd\u662f\u666e\u901a\u5b57\u6bb5\u3002</p> <p></p> <p>\u5982\u679c\u4f7f\u7528\u7684\u662f MyISAM \u5b58\u50a8\u5f15\u64ce\uff0cB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u7684\u7269\u7406\u5730\u5740\uff0c\u5373\u7528\u6237\u6570\u636e\u7684\u6307\u9488\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5982\u679c\u4f7f\u7528\u7684\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\uff0cB+ \u6811\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u4fdd\u5b58\u6570\u636e\u672c\u8eab\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>InnoDB \u5b58\u50a8\u5f15\u64ce\u6839\u636e\u7d22\u5f15\u7c7b\u578b\u4e0d\u540c\uff0c\u5206\u4e3a\u805a\u7c07\u7d22\u5f15\uff08\u4e0a\u56fe\u5c31\u662f\u805a\u7c07\u7d22\u5f15\uff09\u548c\u4e8c\u7ea7\u7d22\u5f15\u3002\u5b83\u4eec\u533a\u522b\u5728\u4e8e\uff0c\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u6570\u636e\u90fd\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002</p> <p>\u5982\u679c\u5c06 name \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u666e\u901a\u7d22\u5f15\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u957f\u4e0b\u56fe\u8fd9\u6837\uff0c\u53f6\u5b50\u8282\u70b9\u4ec5\u5b58\u653e\u4e3b\u952e\u503c\u3002</p> <p></p> <p>\u77e5\u9053\u4e86 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u7684\u5b58\u50a8\u7ed3\u6784\u540e\uff0c\u63a5\u4e0b\u6765\u4e3e\u51e0\u4e2a\u67e5\u8be2\u8bed\u53e5\uff0c\u8bf4\u4e0b\u67e5\u8be2\u8fc7\u7a0b\u662f\u600e\u4e48\u9009\u62e9\u7528\u54ea\u4e2a\u7d22\u5f15\u7c7b\u578b\u7684\u3002</p> <p>\u5728\u6211\u4eec\u4f7f\u7528\u300c\u4e3b\u952e\u7d22\u5f15\u300d\u5b57\u6bb5\u4f5c\u4e3a\u6761\u4ef6\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u6570\u636e\u90fd\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u90a3\u4e48\u5c31\u4f1a\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u4e2d\u7684 B+ \u6811\u68c0\u7d22\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u76f4\u63a5\u8bfb\u53d6\u8981\u67e5\u8be2\u7684\u6570\u636e\u3002\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a</p> Text Only<pre><code>// id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\nselect * from t_user where id=1;\n</code></pre> <p>\u5728\u6211\u4eec\u4f7f\u7528\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u5b57\u6bb5\u4f5c\u4e3a\u6761\u4ef6\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u6570\u636e\u90fd\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u90a3\u4e48\u9700\u8981\u68c0\u7d22\u4e24\u9897 B+\u6811\uff1a</p> <ul> <li>\u5148\u5728\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u7684 B+ \u6811\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u83b7\u53d6\u4e3b\u952e\u503c\uff1b</li> <li>\u7136\u540e\u7528\u4e0a\u4e00\u6b65\u83b7\u53d6\u7684\u4e3b\u952e\u503c\uff0c\u5728\u300c\u805a\u7c07\u7d22\u5f15\u300d\u4e2d\u7684 B+ \u6811\u68c0\u7d22\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u83b7\u53d6\u8981\u67e5\u8be2\u7684\u6570\u636e\u3002</li> </ul> <p>\u4e0a\u9762\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a\u56de\u8868\uff0c\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a</p> Text Only<pre><code>// name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15\nselect * from t_user where name=\"\u6797\u67d0\";\n</code></pre> <p>\u5728\u6211\u4eec\u4f7f\u7528\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u5b57\u6bb5\u4f5c\u4e3a\u6761\u4ef6\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5982\u679c\u8981\u67e5\u8be2\u7684\u6570\u636e\u5728\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u53ea\u9700\u8981\u5728\u300c\u4e8c\u7ea7\u7d22\u5f15\u300d\u7684 B+ \u6811\u627e\u5230\u5bf9\u5e94\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u8bfb\u53d6\u8981\u67e5\u8be2\u7684\u6570\u636e\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a\u8986\u76d6\u7d22\u5f15\u3002\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a</p> Text Only<pre><code>// name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15\nselect id from t_user where name=\"\u6797\u67d0\";\n</code></pre> <p>\u4e0a\u9762\u8fd9\u4e9b\u67e5\u8be2\u8bed\u53e5\u7684\u6761\u4ef6\u90fd\u7528\u5230\u4e86\u7d22\u5f15\u5217\uff0c\u6240\u4ee5\u5728\u67e5\u8be2\u8fc7\u7a0b\u90fd\u7528\u4e0a\u4e86\u7d22\u5f15\u3002</p> <p>\u4f46\u662f\u5e76\u4e0d\u610f\u5473\u7740\uff0c\u67e5\u8be2\u6761\u4ef6\u7528\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u5c31\u67e5\u8be2\u8fc7\u7a0b\u5c31\u4e00\u5b9a\u90fd\u7528\u4e0a\u7d22\u5f15\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u518d\u4e00\u8d77\u770b\u770b\u54ea\u4e9b\u60c5\u51b5\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u800c\u53d1\u751f\u5168\u8868\u626b\u63cf\u3002</p> <p>\u9996\u5148\u8bf4\u660e\u4e0b\uff0c\u4e0b\u9762\u7684\u5b9e\u9a8c\u6848\u4f8b\uff0c\u6211\u4f7f\u7528\u7684 MySQL \u7248\u672c\u4e3a <code>8.0.26</code>\u3002</p>"},{"location":"mysql/index/index_lose/#_3","title":"\u5bf9\u7d22\u5f15\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d","text":"<p>\u5f53\u6211\u4eec\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f <code>like %xx</code> \u6216\u8005 <code>like %xx%</code> \u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u7684 like \u8bed\u53e5\uff0c\u67e5\u8be2 name \u540e\u7f00\u4e3a\u300c\u6797\u300d\u7684\u7528\u6237\uff0c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 type=ALL \u5c31\u4ee3\u8868\u4e86\u5168\u8868\u626b\u63cf\uff0c\u800c\u6ca1\u6709\u8d70\u7d22\u5f15\u3002</p> Text Only<pre><code>// name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15\nselect * from t_user where name like '%\u6797';\n</code></pre> <p></p> <p>\u5982\u679c\u662f\u67e5\u8be2 name \u524d\u7f00\u4e3a\u6797\u7684\u7528\u6237\uff0c\u90a3\u4e48\u5c31\u4f1a\u8d70\u7d22\u5f15\u626b\u63cf\uff0c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 type=range \u8868\u793a\u8d70\u7d22\u5f15\u626b\u63cf\uff0ckey=index_name \u770b\u5230\u5b9e\u9645\u8d70\u4e86 index_name \u7d22\u5f15\uff1a</p> Text Only<pre><code>// name \u5b57\u6bb5\u4e3a\u4e8c\u7ea7\u7d22\u5f15\nselect * from t_user where name like '\u6797%';\n</code></pre> <p></p> <p>\u4e3a\u4ec0\u4e48 like \u5173\u952e\u5b57\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u65e0\u6cd5\u8d70\u7d22\u5f15\u5462\uff1f</p> <p>\u56e0\u4e3a\u7d22\u5f15 B+ \u6811\u662f\u6309\u7167\u300c\u7d22\u5f15\u503c\u300d\u6709\u5e8f\u6392\u5217\u5b58\u50a8\u7684\uff0c\u53ea\u80fd\u6839\u636e\u524d\u7f00\u8fdb\u884c\u6bd4\u8f83\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u8fd9\u5f20\u4e8c\u7ea7\u7d22\u5f15\u56fe\uff0c\u662f\u4ee5 name \u5b57\u6bb5\u6709\u5e8f\u6392\u5217\u5b58\u50a8\u7684\u3002</p> <p></p> <p>\u5047\u8bbe\u6211\u4eec\u8981\u67e5\u8be2 name \u5b57\u6bb5\u524d\u7f00\u4e3a\u300c\u6797\u300d\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f <code>name like '\u6797%'</code>\uff0c\u626b\u63cf\u7d22\u5f15\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u9996\u8282\u70b9\u67e5\u8be2\u6bd4\u8f83\uff1a\u6797\u8fd9\u4e2a\u5b57\u7684\u62fc\u97f3\u5927\u5c0f\u6bd4\u9996\u8282\u70b9\u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u503c\u4e2d\u7684\u9648\u5b57\u5927\uff0c\u4f46\u662f\u6bd4\u9996\u8282\u70b9\u7684\u7b2c\u4e8c\u4e2a\u7d22\u5f15\u503c\u4e2d\u7684\u5468\u5b57\u5c0f\uff0c\u6240\u4ee5\u9009\u62e9\u53bb\u8282\u70b9 2 \u7ee7\u7eed\u67e5\u8be2\uff1b</li> <li>\u8282\u70b9 2 \u67e5\u8be2\u6bd4\u8f83\uff1a\u8282\u70b9 2 \u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u503c\u4e2d\u7684\u9648\u5b57\u7684\u62fc\u97f3\u5927\u5c0f\u6bd4\u6797\u5b57\u5c0f\uff0c\u6240\u4ee5\u7ee7\u7eed\u770b\u4e0b\u4e00\u4e2a\u7d22\u5f15\u503c\uff0c\u53d1\u73b0\u8282\u70b9 2 \u6709\u4e0e\u6797\u5b57\u524d\u7f00\u5339\u914d\u7684\u7d22\u5f15\u503c\uff0c\u4e8e\u662f\u5c31\u5f80\u53f6\u5b50\u8282\u70b9\u67e5\u8be2\uff0c\u5373\u53f6\u5b50\u8282\u70b9 4\uff1b</li> <li>\u8282\u70b9 4 \u67e5\u8be2\u6bd4\u8f83\uff1a\u8282\u70b9 4 \u7684\u7b2c\u4e00\u4e2a\u7d22\u5f15\u503c\u7684\u524d\u7f00\u7b26\u5408\u6797\u5b57\uff0c\u4e8e\u662f\u5c31\u8bfb\u53d6\u8be5\u884c\u6570\u636e\uff0c\u63a5\u7740\u7ee7\u7eed\u5f80\u53f3\u5339\u914d\uff0c\u76f4\u5230\u5339\u914d\u4e0d\u5230\u524d\u7f00\u4e3a\u6797\u7684\u7d22\u5f15\u503c\u3002</li> </ul> <p>\u5982\u679c\u4f7f\u7528 <code>name like '%\u6797'</code> \u65b9\u5f0f\u6765\u67e5\u8be2\uff0c\u56e0\u4e3a\u67e5\u8be2\u7684\u7ed3\u679c\u53ef\u80fd\u662f\u300c\u9648\u6797\u3001\u5f20\u6797\u3001\u5468\u6797\u300d\u7b49\u4e4b\u7c7b\u7684\uff0c\u6240\u4ee5\u4e0d\u77e5\u9053\u4ece\u54ea\u4e2a\u7d22\u5f15\u503c\u5f00\u59cb\u6bd4\u8f83\uff0c\u4e8e\u662f\u5c31\u53ea\u80fd\u901a\u8fc7\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u6765\u67e5\u8be2\u3002</p> <p>\u60f3\u8981\u66f4\u8be6\u7ec6\u4e86\u89e3 InnoDB \u7684 B+ \u6811\u67e5\u8be2\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u770b\u6211\u5199\u7684\u8fd9\u7bc7\uff1aB+ \u6811\u91cc\u7684\u8282\u70b9\u91cc\u5b58\u653e\u7684\u662f\u4ec0\u4e48\u5462\uff1f\u67e5\u8be2\u6570\u636e\u7684\u8fc7\u7a0b\u53c8\u662f\u600e\u6837\u7684\uff1f</p>"},{"location":"mysql/index/index_lose/#_4","title":"\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570","text":"<p>\u6709\u65f6\u5019\u6211\u4eec\u4f1a\u7528\u4e00\u4e9b MySQL \u81ea\u5e26\u7684\u51fd\u6570\u6765\u5f97\u5230\u6211\u4eec\u60f3\u8981\u7684\u7ed3\u679c\uff0c\u8fd9\u65f6\u5019\u8981\u6ce8\u610f\u4e86\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5b57\u6bb5\u4f7f\u7528\u51fd\u6570\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9 name \u5b57\u6bb5\u4f7f\u7528\u4e86 LENGTH \u51fd\u6570\uff0c\u6267\u884c\u8ba1\u5212\u4e2d\u7684 type=ALL\uff0c\u4ee3\u8868\u4e86\u5168\u8868\u626b\u63cf\uff1a</p> Text Only<pre><code>// name \u4e3a\u4e8c\u7ea7\u7d22\u5f15\nselect * from t_user where length(name)=6;\n</code></pre> <p></p> <p>\u4e3a\u4ec0\u4e48\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570\uff0c\u5c31\u65e0\u6cd5\u8d70\u7d22\u5f15\u4e86\u5462\uff1f</p> <p>\u56e0\u4e3a\u7d22\u5f15\u4fdd\u5b58\u7684\u662f\u7d22\u5f15\u5b57\u6bb5\u7684\u539f\u59cb\u503c\uff0c\u800c\u4e0d\u662f\u7ecf\u8fc7\u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\uff0c\u81ea\u7136\u5c31\u6ca1\u529e\u6cd5\u8d70\u7d22\u5f15\u4e86\u3002</p> <p>\u4e0d\u8fc7\uff0c\u4ece MySQL 8.0 \u5f00\u59cb\uff0c\u7d22\u5f15\u7279\u6027\u589e\u52a0\u4e86\u51fd\u6570\u7d22\u5f15\uff0c\u5373\u53ef\u4ee5\u9488\u5bf9\u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\u5efa\u7acb\u4e00\u4e2a\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u8bf4\u8be5\u7d22\u5f15\u7684\u503c\u662f\u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u901a\u8fc7\u626b\u63cf\u7d22\u5f15\u6765\u67e5\u8be2\u6570\u636e\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u901a\u8fc7\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff0c\u5bf9 length(name) \u7684\u8ba1\u7b97\u7ed3\u679c\u5efa\u7acb\u4e00\u4e2a\u540d\u4e3a idx_name_length \u7684\u7d22\u5f15\u3002</p> Text Only<pre><code>alter table t_user add key idx_name_length ((length(name)));\n</code></pre> <p>\u7136\u540e\u6211\u518d\u7528\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u8fd9\u65f6\u5019\u5c31\u4f1a\u8d70\u7d22\u5f15\u4e86\u3002</p> <p></p>"},{"location":"mysql/index/index_lose/#_5","title":"\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97","text":"<p>\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u4e5f\u662f\u65e0\u6cd5\u8d70\u7d22\u5f15\u7684\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u6267\u884c\u8ba1\u5212\u4e2d type = ALL\uff0c\u8bf4\u660e\u662f\u901a\u8fc7\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u67e5\u8be2\u6570\u636e\u7684\uff1a</p> Text Only<pre><code>explain select * from t_user where id + 1 = 10;\n</code></pre> <p></p> <p>\u4f46\u662f\uff0c\u5982\u679c\u628a\u67e5\u8be2\u8bed\u53e5\u7684\u6761\u4ef6\u6539\u6210 where id  = 10 - 1\uff0c\u8fd9\u6837\u5c31\u4e0d\u662f\u5728\u7d22\u5f15\u5b57\u6bb5\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\u4e86\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u8d70\u7d22\u5f15\u67e5\u8be2\u4e86\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u5c31\u65e0\u6cd5\u8d70\u7d22\u5f15\u4e86\u5462\uff1f</p> <p>\u539f\u56e0\u8ddf\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570\u5dee\u4e0d\u591a\u3002</p> <p>\u56e0\u4e3a\u7d22\u5f15\u4fdd\u5b58\u7684\u662f\u7d22\u5f15\u5b57\u6bb5\u7684\u539f\u59cb\u503c\uff0c\u800c\u4e0d\u662f id + 1 \u8868\u8fbe\u5f0f\u8ba1\u7b97\u540e\u7684\u503c\uff0c\u6240\u4ee5\u65e0\u6cd5\u8d70\u7d22\u5f15\uff0c\u53ea\u80fd\u901a\u8fc7\u628a\u7d22\u5f15\u5b57\u6bb5\u7684\u53d6\u503c\u90fd\u53d6\u51fa\u6765\uff0c\u7136\u540e\u4f9d\u6b21\u8fdb\u884c\u8868\u8fbe\u5f0f\u7684\u8ba1\u7b97\u6765\u8fdb\u884c\u6761\u4ef6\u5224\u65ad\uff0c\u56e0\u6b64\u91c7\u7528\u7684\u5c31\u662f\u5168\u8868\u626b\u63cf\u7684\u65b9\u5f0f\u3002</p> <p>\u6709\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u8bf4\uff0c\u8fd9\u79cd\u5bf9\u7d22\u5f15\u8fdb\u884c\u7b80\u5355\u7684\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u5728\u4ee3\u7801\u7279\u6b8a\u5904\u7406\u4e0b\uff0c\u5e94\u8be5\u662f\u53ef\u4ee5\u505a\u5230\u7d22\u5f15\u626b\u63cf\u7684\uff0c\u6bd4\u65b9\u5c06  id + 1 = 10 \u53d8\u6210 id  = 10 - 1\u3002</p> <p>\u662f\u7684\uff0c\u662f\u80fd\u591f\u5b9e\u73b0\uff0c\u4f46\u662f MySQL \u8fd8\u662f\u5077\u4e86\u8fd9\u4e2a\u61d2\uff0c\u6ca1\u6709\u5b9e\u73b0\u3002</p> <p>\u6211\u7684\u60f3\u6cd5\u662f\uff0c\u53ef\u80fd\u4e5f\u662f\u56e0\u4e3a\uff0c\u8868\u8fbe\u5f0f\u8ba1\u7b97\u7684\u60c5\u51b5\u591a\u79cd\u591a\u6837\uff0c\u6bcf\u79cd\u90fd\u8981\u8003\u8651\u7684\u8bdd\uff0c\u4ee3\u7801\u53ef\u80fd\u4f1a\u5f88\u81c3\u80bf\uff0c\u6240\u4ee5\u5e72\u8106\u5c06\u8fd9\u79cd\u7d22\u5f15\u5931\u6548\u7684\u573a\u666f\u544a\u8bc9\u7a0b\u5e8f\u5458\uff0c\u8ba9\u7a0b\u5e8f\u5458\u81ea\u5df1\u4fdd\u8bc1\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u4e0d\u8981\u5bf9\u7d22\u5f15\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\u3002</p>"},{"location":"mysql/index/index_lose/#_6","title":"\u5bf9\u7d22\u5f15\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362","text":"<p>\u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u4f46\u662f\u5728\u6761\u4ef6\u67e5\u8be2\u4e2d\uff0c\u8f93\u5165\u7684\u53c2\u6570\u662f\u6574\u578b\u7684\u8bdd\uff0c\u4f60\u4f1a\u5728\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c\u53d1\u73b0\u8fd9\u6761\u8bed\u53e5\u4f1a\u8d70\u5168\u8868\u626b\u63cf\u3002</p> <p>\u6211\u5728\u539f\u672c\u7684 t_user \u8868\u589e\u52a0\u4e86 phone \u5b57\u6bb5\uff0c\u662f\u4e8c\u7ea7\u7d22\u5f15\u4e14\u7c7b\u578b\u662f varchar\u3002</p> <p></p> <p>\u7136\u540e\u6211\u5728\u6761\u4ef6\u67e5\u8be2\u4e2d\uff0c\u7528\u6574\u578b\u4f5c\u4e3a\u8f93\u5165\u53c2\u6570\uff0c\u6b64\u65f6\u6267\u884c\u8ba1\u5212\u4e2d type = ALL\uff0c\u6240\u4ee5\u662f\u901a\u8fc7\u5168\u8868\u626b\u63cf\u6765\u67e5\u8be2\u6570\u636e\u7684\u3002</p> Text Only<pre><code>select * from t_user where phone = 1300000001;\n</code></pre> <p></p> <p>\u4f46\u662f\u5982\u679c\u7d22\u5f15\u5b57\u6bb5\u662f\u6574\u578b\u7c7b\u578b\uff0c\u67e5\u8be2\u6761\u4ef6\u4e2d\u7684\u8f93\u5165\u53c2\u6570\u5373\u4f7f\u5b57\u7b26\u4e32\uff0c\u662f\u4e0d\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u8fd8\u662f\u53ef\u4ee5\u8d70\u7d22\u5f15\u626b\u63cf\u3002</p> <p>\u6211\u4eec\u518d\u770b\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\uff0cid \u662f\u6574\u578b\uff0c\u4f46\u662f\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u8fd8\u662f\u8d70\u4e86\u7d22\u5f15\u626b\u63cf\u7684\u3002</p> Text Only<pre><code> explain select * from t_user where id = '1';\n</code></pre> <p></p> <p>\u4e3a\u4ec0\u4e48\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\uff0c\u800c\u7b2c\u4e8c\u4f8b\u5b50\u4e0d\u4f1a\u5462\uff1f</p> <p>\u8981\u660e\u767d\u8fd9\u4e2a\u539f\u56e0\uff0c\u9996\u5148\u6211\u4eec\u8981\u77e5\u9053 MySQL \u7684\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u89c4\u5219\u662f\u4ec0\u4e48\uff1f\u5c31\u662f\u770b MySQL \u662f\u4f1a\u5c06\u5b57\u7b26\u4e32\u8f6c\u6210\u6570\u5b57\u5904\u7406\uff0c\u8fd8\u662f\u5c06\u6570\u5b57\u8f6c\u6362\u6210\u5b57\u7b26\u4e32\u5904\u7406\u3002</p> <p>\u6211\u5728\u770b\u300aMySQL45 \u8bb2\u300b\u7684\u65f6\u5019\u770b\u5230\u4e00\u4e2a\u7b80\u5355\u7684\u6d4b\u8bd5\u65b9\u5f0f\uff0c\u5c31\u662f\u901a\u8fc7 select\u201c10\u201d &gt; 9 \u7684\u7ed3\u679c\u6765\u77e5\u9053 MySQL \u7684\u6570\u636e\u7c7b\u578b\u8f6c\u6362\u89c4\u5219\u662f\u4ec0\u4e48\uff1a</p> <ul> <li>\u5982\u679c\u89c4\u5219\u662f MySQL \u4f1a\u5c06\u81ea\u52a8\u300c\u5b57\u7b26\u4e32\u300d\u8f6c\u6362\u6210\u300c\u6570\u5b57\u300d\uff0c\u5c31\u76f8\u5f53\u4e8e select 10 &gt; 9\uff0c\u8fd9\u4e2a\u5c31\u662f\u6570\u5b57\u6bd4\u8f83\uff0c\u6240\u4ee5\u7ed3\u679c\u5e94\u8be5\u662f 1\uff1b</li> <li>\u5982\u679c\u89c4\u5219\u662f MySQL \u4f1a\u5c06\u81ea\u52a8\u300c\u6570\u5b57\u300d\u8f6c\u6362\u6210\u300c\u5b57\u7b26\u4e32\u300d\uff0c\u5c31\u76f8\u5f53\u4e8e select \"10\" &gt; \"9\"\uff0c\u8fd9\u4e2a\u662f\u5b57\u7b26\u4e32\u6bd4\u8f83\uff0c\u5b57\u7b26\u4e32\u6bd4\u8f83\u5927\u5c0f\u662f\u9010\u4f4d\u4ece\u9ad8\u4f4d\u5230\u4f4e\u4f4d\u9010\u4e2a\u6bd4\u8f83\uff08\u6309 ascii \u7801\uff09 \uff0c\u90a3\u4e48\"10\"\u5b57\u7b26\u4e32\u76f8\u5f53\u4e8e\u201c1\u201d\u548c\u201c0\u201d\u5b57\u7b26\u7684\u7ec4\u5408\uff0c\u6240\u4ee5\u5148\u662f\u62ff\u201c1\u201d\u5b57\u7b26\u548c\u201c9\u201d\u5b57\u7b26\u6bd4\u8f83\uff0c\u56e0\u4e3a\u201c1\u201d\u5b57\u7b26\u6bd4\u201c9\u201d\u5b57\u7b26\u5c0f\uff0c\u6240\u4ee5\u7ed3\u679c\u5e94\u8be5\u662f 0\u3002</li> </ul> <p>\u5728 MySQL \u4e2d\uff0c\u6267\u884c\u7684\u7ed3\u679c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0a\u9762\u7684\u7ed3\u679c\u4e3a 1\uff0c\u8bf4\u660e MySQL \u5728\u9047\u5230\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u628a\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u7136\u540e\u518d\u8fdb\u884c\u6bd4\u8f83\u3002</p> <p>\u524d\u9762\u7684\u4f8b\u5b50\u4e00\u4e2d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u6211\u4e5f\u8ddf\u5927\u5bb6\u8bf4\u4e86\u662f\u4f1a\u8d70\u5168\u8868\u626b\u63cf\uff1a</p> Text Only<pre><code>//\u4f8b\u5b50\u4e00\u7684\u67e5\u8be2\u8bed\u53e5\nselect * from t_user where phone = 1300000001;\n</code></pre> <p>\u8fd9\u662f\u56e0\u4e3a phone \u5b57\u6bb5\u4e3a\u5b57\u7b26\u4e32\uff0c\u6240\u4ee5 MySQL \u8981\u4f1a\u81ea\u52a8\u628a\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u6240\u4ee5\u8fd9\u6761\u8bed\u53e5\u76f8\u5f53\u4e8e\uff1a</p> Text Only<pre><code>select * from t_user where CAST(phone AS signed int) = 1300000001;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0cCAST \u51fd\u6570\u662f\u4f5c\u7528\u5728\u4e86 phone \u5b57\u6bb5\uff0c\u800c phone \u5b57\u6bb5\u662f\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u5bf9\u7d22\u5f15\u4f7f\u7528\u4e86\u51fd\u6570\uff01\u800c\u524d\u9762\u6211\u4eec\u4e5f\u8bf4\u4e86\uff0c\u5bf9\u7d22\u5f15\u4f7f\u7528\u51fd\u6570\u662f\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u7684\u3002</p> <p>\u4f8b\u5b50\u4e8c\u4e2d\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u6211\u8ddf\u5927\u5bb6\u8bf4\u4e86\u662f\u4f1a\u8d70\u7d22\u5f15\u626b\u63cf\uff1a</p> Text Only<pre><code>//\u4f8b\u5b50\u4e8c\u7684\u67e5\u8be2\u8bed\u53e5\nselect * from t_user where id = \"1\";\n</code></pre> <p>\u8fd9\u65f6\u56e0\u4e3a\u5b57\u7b26\u4e32\u90e8\u5206\u662f\u8f93\u5165\u53c2\u6570\uff0c\u4e5f\u5c31\u9700\u8981\u5c06\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u6240\u4ee5\u8fd9\u6761\u8bed\u53e5\u76f8\u5f53\u4e8e\uff1a</p> Text Only<pre><code>select * from t_user where id = CAST(\"1\" AS signed int);\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u7d22\u5f15\u5b57\u6bb5\u5e76\u6ca1\u6709\u7528\u4efb\u4f55\u51fd\u6570\uff0cCAST \u51fd\u6570\u662f\u7528\u5728\u4e86\u8f93\u5165\u53c2\u6570\uff0c\u56e0\u6b64\u662f\u53ef\u4ee5\u8d70\u7d22\u5f15\u626b\u63cf\u7684\u3002</p>"},{"location":"mysql/index/index_lose/#_7","title":"\u8054\u5408\u7d22\u5f15\u975e\u6700\u5de6\u5339\u914d","text":"<p>\u5bf9\u4e3b\u952e\u5b57\u6bb5\u5efa\u7acb\u7684\u7d22\u5f15\u53eb\u505a\u805a\u7c07\u7d22\u5f15\uff0c\u5bf9\u666e\u901a\u5b57\u6bb5\u5efa\u7acb\u7684\u7d22\u5f15\u53eb\u505a\u4e8c\u7ea7\u7d22\u5f15\u3002</p> <p>\u90a3\u4e48\u591a\u4e2a\u666e\u901a\u5b57\u6bb5\u7ec4\u5408\u5728\u4e00\u8d77\u521b\u5efa\u7684\u7d22\u5f15\u5c31\u53eb\u505a\u8054\u5408\u7d22\u5f15\uff0c\u4e5f\u53eb\u7ec4\u5408\u7d22\u5f15\u3002</p> <p>\u521b\u5efa\u8054\u5408\u7d22\u5f15\u65f6\uff0c\u6211\u4eec\u9700\u8981\u6ce8\u610f\u521b\u5efa\u65f6\u7684\u987a\u5e8f\u95ee\u9898\uff0c\u56e0\u4e3a\u8054\u5408\u7d22\u5f15 (a, b, c) \u548c (c, b, a) \u5728\u4f7f\u7528\u7684\u65f6\u5019\u4f1a\u5b58\u5728\u5dee\u522b\u3002</p> <p>\u8054\u5408\u7d22\u5f15\u8981\u80fd\u6b63\u786e\u4f7f\u7528\u9700\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\u3002</p> <p>\u6bd4\u5982\uff0c\u5982\u679c\u521b\u5efa\u4e86\u4e00\u4e2a <code>(a, b, c)</code> \u8054\u5408\u7d22\u5f15\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u5c31\u53ef\u4ee5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff1a</p> <ul> <li>where a=1.</li> <li>where a=1 and b=2 and c=3.</li> <li>where a=1 and b=2.</li> </ul> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a\u6709\u67e5\u8be2\u4f18\u5316\u5668\uff0c\u6240\u4ee5 a \u5b57\u6bb5\u5728 where \u5b50\u53e5\u7684\u987a\u5e8f\u5e76\u4e0d\u91cd\u8981\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u662f\u4ee5\u4e0b\u8fd9\u51e0\u79cd\uff0c\u56e0\u4e3a\u4e0d\u7b26\u5408\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u6240\u4ee5\u5c31\u65e0\u6cd5\u5339\u914d\u4e0a\u8054\u5408\u7d22\u5f15\uff0c\u8054\u5408\u7d22\u5f15\u5c31\u4f1a\u5931\u6548\uff1a</p> <ul> <li>where b=2.</li> <li>where c=3.</li> <li>where b=2 and c=3.</li> </ul> <p>\u6709\u4e00\u4e2a\u6bd4\u8f83\u7279\u6b8a\u7684\u67e5\u8be2\u6761\u4ef6\uff1awhere a = 1 and c = 3\uff0c\u7b26\u5408\u6700\u5de6\u5339\u914d\u5417\uff1f</p> <p>\u8fd9\u79cd\u5176\u5b9e\u4e25\u683c\u610f\u4e49\u4e0a\u6765\u8bf4\u662f\u5c5e\u4e8e\u7d22\u5f15\u622a\u65ad\uff0c\u4e0d\u540c\u7248\u672c\u5904\u7406\u65b9\u5f0f\u4e5f\u4e0d\u4e00\u6837\u3002</p> <p>MySQL 5.5 \u7684\u8bdd\uff0c\u524d\u9762 a \u4f1a\u8d70\u7d22\u5f15\uff0c\u5728\u8054\u5408\u7d22\u5f15\u627e\u5230\u4e3b\u952e\u503c\u540e\uff0c\u5f00\u59cb\u56de\u8868\uff0c\u5230\u4e3b\u952e\u7d22\u5f15\u8bfb\u53d6\u6570\u636e\u884c\uff0c\u7136\u540e\u518d\u6bd4\u5bf9 c \u5b57\u6bb5\u7684\u503c\u3002</p> <p>\u4ece MySQL 5.6 \u4e4b\u540e\uff0c\u6709\u4e00\u4e2a\u7d22\u5f15\u4e0b\u63a8\u529f\u80fd\uff0c\u53ef\u4ee5\u5728\u7d22\u5f15\u904d\u5386\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u7d22\u5f15\u4e2d\u5305\u542b\u7684\u5b57\u6bb5\u5148\u505a\u5224\u65ad\uff0c\u76f4\u63a5\u8fc7\u6ee4\u6389\u4e0d\u6ee1\u8db3\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u51cf\u5c11\u56de\u8868\u6b21\u6570\u3002</p> <p>\u5927\u6982\u539f\u7406\u662f\uff1a\u622a\u65ad\u7684\u5b57\u6bb5\u4f1a\u88ab\u4e0b\u63a8\u5230\u5b58\u50a8\u5f15\u64ce\u5c42\u8fdb\u884c\u6761\u4ef6\u5224\u65ad\uff08\u56e0\u4e3a c \u5b57\u6bb5\u7684\u503c\u662f\u5728 <code>(a, b, c)</code> \u8054\u5408\u7d22\u5f15\u91cc\u7684\uff09\uff0c\u7136\u540e\u8fc7\u6ee4\u51fa\u7b26\u5408\u6761\u4ef6\u7684\u6570\u636e\u540e\u518d\u8fd4\u56de\u7ed9 Server \u5c42\u3002\u7531\u4e8e\u5728\u5f15\u64ce\u5c42\u5c31\u8fc7\u6ee4\u6389\u5927\u91cf\u7684\u6570\u636e\uff0c\u65e0\u9700\u518d\u56de\u8868\u8bfb\u53d6\u6570\u636e\u6765\u8fdb\u884c\u5224\u65ad\uff0c\u51cf\u5c11\u56de\u8868\u6b21\u6570\uff0c\u4ece\u800c\u63d0\u5347\u4e86\u6027\u80fd\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u8fd9\u6761 where a = 1 and c = 0 \u8bed\u53e5\uff0c\u6211\u4eec\u53ef\u4ee5\u4ece\u6267\u884c\u8ba1\u5212\u4e2d\u7684 Extra=Using index condition \u4f7f\u7528\u4e86\u7d22\u5f15\u4e0b\u63a8\u529f\u80fd\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u8054\u5408\u7d22\u5f15\u4e0d\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\u5c31\u4f1a\u5931\u6548\uff1f</p> <p>\u539f\u56e0\u662f\uff0c\u5728\u8054\u5408\u7d22\u5f15\u7684\u60c5\u51b5\u4e0b\uff0c\u6570\u636e\u662f\u6309\u7167\u7d22\u5f15\u7b2c\u4e00\u5217\u6392\u5e8f\uff0c\u7b2c\u4e00\u5217\u6570\u636e\u76f8\u540c\u65f6\u624d\u4f1a\u6309\u7167\u7b2c\u4e8c\u5217\u6392\u5e8f\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5982\u679c\u6211\u4eec\u60f3\u4f7f\u7528\u8054\u5408\u7d22\u5f15\u4e2d\u5c3d\u53ef\u80fd\u591a\u7684\u5217\uff0c\u67e5\u8be2\u6761\u4ef6\u4e2d\u7684\u5404\u4e2a\u5217\u5fc5\u987b\u662f\u8054\u5408\u7d22\u5f15\u4e2d\u4ece\u6700\u5de6\u8fb9\u5f00\u59cb\u8fde\u7eed\u7684\u5217\u3002\u5982\u679c\u6211\u4eec\u4ec5\u4ec5\u6309\u7167\u7b2c\u4e8c\u5217\u641c\u7d22\uff0c\u80af\u5b9a\u65e0\u6cd5\u8d70\u7d22\u5f15\u3002</p>"},{"location":"mysql/index/index_lose/#where-or","title":"WHERE \u5b50\u53e5\u4e2d\u7684 OR","text":"<p>\u5728 WHERE \u5b50\u53e5\u4e2d\uff0c\u5982\u679c\u5728 OR \u524d\u7684\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\uff0c\u800c\u5728 OR \u540e\u7684\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u7d22\u5f15\u4f1a\u5931\u6548\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u67e5\u8be2\u8bed\u53e5\uff0cid \u662f\u4e3b\u952e\uff0cage \u662f\u666e\u901a\u5217\uff0c\u4ece\u6267\u884c\u8ba1\u5212\u7684\u7ed3\u679c\u770b\uff0c\u662f\u8d70\u4e86\u5168\u8868\u626b\u63cf\u3002</p> Text Only<pre><code>select * from t_user where id = 1 or age = 18;\n</code></pre> <p></p> <p>\u8fd9\u662f\u56e0\u4e3a OR \u7684\u542b\u4e49\u5c31\u662f\u4e24\u4e2a\u53ea\u8981\u6ee1\u8db3\u4e00\u4e2a\u5373\u53ef\uff0c\u56e0\u6b64\u53ea\u6709\u4e00\u4e2a\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\u662f\u6ca1\u6709\u610f\u4e49\u7684\uff0c\u53ea\u8981\u6709\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u5c31\u4f1a\u8fdb\u884c\u5168\u8868\u626b\u63cf\u3002</p> <p>\u8981\u89e3\u51b3\u529e\u6cd5\u5f88\u7b80\u5355\uff0c\u5c06 age \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u7d22\u5f15\u5373\u53ef\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 type=index merge\uff0cindex merge \u7684\u610f\u601d\u5c31\u662f\u5bf9 id \u548c age \u5206\u522b\u8fdb\u884c\u4e86\u626b\u63cf\uff0c\u7136\u540e\u5c06\u8fd9\u4e24\u4e2a\u7ed3\u679c\u96c6\u8fdb\u884c\u4e86\u5408\u5e76\uff0c\u8fd9\u6837\u505a\u7684\u597d\u5904\u5c31\u662f\u907f\u514d\u4e86\u5168\u8868\u626b\u63cf\u3002</p>"},{"location":"mysql/index/index_lose/#_8","title":"\u603b\u7ed3","text":"<p>\u4eca\u5929\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e86 6 \u79cd\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\u7684\u60c5\u51b5\uff1a</p> <ul> <li>\u5f53\u6211\u4eec\u4f7f\u7528\u5de6\u6216\u8005\u5de6\u53f3\u6a21\u7cca\u5339\u914d\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f <code>like %xx</code> \u6216\u8005 <code>like %xx%</code>\u8fd9\u4e24\u79cd\u65b9\u5f0f\u90fd\u4f1a\u9020\u6210\u7d22\u5f15\u5931\u6548\uff1b</li> <li>\u5f53\u6211\u4eec\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5217\u4f7f\u7528\u51fd\u6570\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002</li> <li>\u5f53\u6211\u4eec\u5728\u67e5\u8be2\u6761\u4ef6\u4e2d\u5bf9\u7d22\u5f15\u5217\u8fdb\u884c\u8868\u8fbe\u5f0f\u8ba1\u7b97\uff0c\u4e5f\u662f\u65e0\u6cd5\u8d70\u7d22\u5f15\u7684\u3002</li> <li>MySQL \u5728\u9047\u5230\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u6bd4\u8f83\u7684\u65f6\u5019\uff0c\u4f1a\u81ea\u52a8\u628a\u5b57\u7b26\u4e32\u8f6c\u4e3a\u6570\u5b57\uff0c\u7136\u540e\u518d\u8fdb\u884c\u6bd4\u8f83\u3002\u5982\u679c\u5b57\u7b26\u4e32\u662f\u7d22\u5f15\u5217\uff0c\u800c\u6761\u4ef6\u8bed\u53e5\u4e2d\u7684\u8f93\u5165\u53c2\u6570\u662f\u6570\u5b57\u7684\u8bdd\uff0c\u90a3\u4e48\u7d22\u5f15\u5217\u4f1a\u53d1\u751f\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\uff0c\u7531\u4e8e\u9690\u5f0f\u7c7b\u578b\u8f6c\u6362\u662f\u901a\u8fc7 CAST \u51fd\u6570\u5b9e\u73b0\u7684\uff0c\u7b49\u540c\u4e8e\u5bf9\u7d22\u5f15\u5217\u4f7f\u7528\u4e86\u51fd\u6570\uff0c\u6240\u4ee5\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002</li> <li>\u8054\u5408\u7d22\u5f15\u8981\u80fd\u6b63\u786e\u4f7f\u7528\u9700\u8981\u9075\u5faa\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u4e5f\u5c31\u662f\u6309\u7167\u6700\u5de6\u4f18\u5148\u7684\u65b9\u5f0f\u8fdb\u884c\u7d22\u5f15\u7684\u5339\u914d\uff0c\u5426\u5219\u5c31\u4f1a\u5bfc\u81f4\u7d22\u5f15\u5931\u6548\u3002</li> <li>\u5728 WHERE \u5b50\u53e5\u4e2d\uff0c\u5982\u679c\u5728 OR \u524d\u7684\u6761\u4ef6\u5217\u662f\u7d22\u5f15\u5217\uff0c\u800c\u5728 OR \u540e\u7684\u6761\u4ef6\u5217\u4e0d\u662f\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u7d22\u5f15\u4f1a\u5931\u6548\u3002</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/index/page/","title":"\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u5927\u5bb6\u80cc\u516b\u80a1\u6587\u7684\u65f6\u5019\uff0c\u90fd\u77e5\u9053 MySQL \u91cc InnoDB \u5b58\u50a8\u5f15\u64ce\u662f\u91c7\u7528 B+ \u6811\u6765\u7ec4\u7ec7\u6570\u636e\u7684\u3002</p> <p>\u8fd9\u70b9\u6ca1\u9519\uff0c\u4f46\u662f\u5927\u5bb6\u77e5\u9053 B+ \u6811\u91cc\u7684\u8282\u70b9\u91cc\u5b58\u653e\u7684\u662f\u4ec0\u4e48\u5462\uff1f\u67e5\u8be2\u6570\u636e\u7684\u8fc7\u7a0b\u53c8\u662f\u600e\u6837\u7684\uff1f</p> <p>\u8fd9\u6b21\uff0c\u6211\u4eec\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811\uff0c\u770b\u770b\u6bcf\u4e2a\u8282\u70b9\u957f\u5565\u6837\u3002</p> <p></p>"},{"location":"mysql/index/page/#innodb","title":"InnoDB \u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u7684\uff1f","text":"<p>MySQL \u652f\u6301\u591a\u79cd\u5b58\u50a8\u5f15\u64ce\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5b58\u50a8\u6570\u636e\u7684\u65b9\u5f0f\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u6211\u4eec\u6700\u5e38\u4f7f\u7528\u7684\u662f InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c\u6240\u4ee5\u5c31\u8ddf\u5927\u5bb6\u56fe\u89e3\u4e0b InnoDB \u662f\u5982\u4f55\u5b58\u50a8\u6570\u636e\u7684\u3002</p> <p>\u8bb0\u5f55\u662f\u6309\u7167\u884c\u6765\u5b58\u50a8\u7684\uff0c\u4f46\u662f\u6570\u636e\u5e93\u7684\u8bfb\u53d6\u5e76\u4e0d\u4ee5\u300c\u884c\u300d\u4e3a\u5355\u4f4d\uff0c\u5426\u5219\u4e00\u6b21\u8bfb\u53d6\uff08\u4e5f\u5c31\u662f\u4e00\u6b21 I/O \u64cd\u4f5c\uff09\u53ea\u80fd\u5904\u7406\u4e00\u884c\u6570\u636e\uff0c\u6548\u7387\u4f1a\u975e\u5e38\u4f4e\u3002</p> <p>\u56e0\u6b64\uff0cInnoDB \u7684\u6570\u636e\u662f\u6309\u300c\u6570\u636e\u9875\u300d\u4e3a\u5355\u4f4d\u6765\u8bfb\u5199\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53\u9700\u8981\u8bfb\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u5c06\u8fd9\u4e2a\u8bb0\u5f55\u672c\u8eab\u4ece\u78c1\u76d8\u8bfb\u51fa\u6765\uff0c\u800c\u662f\u4ee5\u9875\u4e3a\u5355\u4f4d\uff0c\u5c06\u5176\u6574\u4f53\u8bfb\u5165\u5185\u5b58\u3002</p> <p>\u6570\u636e\u5e93\u7684 I/O \u64cd\u4f5c\u7684\u6700\u5c0f\u5355\u4f4d\u662f\u9875\uff0cInnoDB \u6570\u636e\u9875\u7684\u9ed8\u8ba4\u5927\u5c0f\u662f 16KB\uff0c\u610f\u5473\u7740\u6570\u636e\u5e93\u6bcf\u6b21\u8bfb\u5199\u90fd\u662f\u4ee5 16KB \u4e3a\u5355\u4f4d\u7684\uff0c\u4e00\u6b21\u6700\u5c11\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6 16K \u7684\u5185\u5bb9\u5230\u5185\u5b58\u4e2d\uff0c\u4e00\u6b21\u6700\u5c11\u628a\u5185\u5b58\u4e2d\u7684 16K \u5185\u5bb9\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u3002</p> <p>\u6570\u636e\u9875\u5305\u62ec\u4e03\u4e2a\u90e8\u5206\uff0c\u7ed3\u6784\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9 7 \u4e2a\u90e8\u5206\u7684\u4f5c\u7528\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5728 File Header \u4e2d\u6709\u4e24\u4e2a\u6307\u9488\uff0c\u5206\u522b\u6307\u5411\u4e0a\u4e00\u4e2a\u6570\u636e\u9875\u548c\u4e0b\u4e00\u4e2a\u6570\u636e\u9875\uff0c\u8fde\u63a5\u8d77\u6765\u7684\u9875\u76f8\u5f53\u4e8e\u4e00\u4e2a\u53cc\u5411\u7684\u94fe\u8868\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u91c7\u7528\u94fe\u8868\u7684\u7ed3\u6784\u662f\u8ba9\u6570\u636e\u9875\u4e4b\u95f4\u4e0d\u9700\u8981\u662f\u7269\u7406\u4e0a\u7684\u8fde\u7eed\u7684\uff0c\u800c\u662f\u903b\u8f91\u4e0a\u7684\u8fde\u7eed\u3002</p> <p>\u6570\u636e\u9875\u7684\u4e3b\u8981\u4f5c\u7528\u662f\u5b58\u50a8\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u5e93\u7684\u6570\u636e\uff0c\u6240\u4ee5\u91cd\u70b9\u8bf4\u4e00\u4e0b\u6570\u636e\u9875\u4e2d\u7684 User Records \u662f\u600e\u4e48\u7ec4\u7ec7\u6570\u636e\u7684\u3002</p> <p>\u6570\u636e\u9875\u4e2d\u7684\u8bb0\u5f55\u6309\u7167\u300c\u4e3b\u952e\u300d\u987a\u5e8f\u7ec4\u6210\u5355\u5411\u94fe\u8868\uff0c\u5355\u5411\u94fe\u8868\u7684\u7279\u70b9\u5c31\u662f\u63d2\u5165\u3001\u5220\u9664\u975e\u5e38\u65b9\u4fbf\uff0c\u4f46\u662f\u68c0\u7d22\u6548\u7387\u4e0d\u9ad8\uff0c\u6700\u5dee\u7684\u60c5\u51b5\u4e0b\u9700\u8981\u904d\u5386\u94fe\u8868\u4e0a\u7684\u6240\u6709\u8282\u70b9\u624d\u80fd\u5b8c\u6210\u68c0\u7d22\u3002</p> <p>\u56e0\u6b64\uff0c\u6570\u636e\u9875\u4e2d\u6709\u4e00\u4e2a\u9875\u76ee\u5f55\uff0c\u8d77\u5230\u8bb0\u5f55\u7684\u7d22\u5f15\u4f5c\u7528\uff0c\u5c31\u50cf\u6211\u4eec\u4e66\u90a3\u6837\uff0c\u9488\u5bf9\u4e66\u4e2d\u5185\u5bb9\u7684\u6bcf\u4e2a\u7ae0\u8282\u8bbe\u7acb\u4e86\u4e00\u4e2a\u76ee\u5f55\uff0c\u60f3\u770b\u67d0\u4e2a\u7ae0\u8282\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u67e5\u770b\u76ee\u5f55\uff0c\u5feb\u901f\u627e\u5230\u5bf9\u5e94\u7684\u7ae0\u8282\u7684\u9875\u6570\uff0c\u800c\u6570\u636e\u9875\u4e2d\u7684\u9875\u76ee\u5f55\u5c31\u662f\u4e3a\u4e86\u80fd\u5feb\u901f\u627e\u5230\u8bb0\u5f55\u3002</p> <p>\u90a3 InnoDB \u662f\u5982\u4f55\u7ed9\u8bb0\u5f55\u521b\u5efa\u9875\u76ee\u5f55\u7684\u5462\uff1f\u9875\u76ee\u5f55\u4e0e\u8bb0\u5f55\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u9875\u76ee\u5f55\u521b\u5efa\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u5c06\u6240\u6709\u7684\u8bb0\u5f55\u5212\u5206\u6210\u51e0\u4e2a\u7ec4\uff0c\u8fd9\u4e9b\u8bb0\u5f55\u5305\u62ec\u6700\u5c0f\u8bb0\u5f55\u548c\u6700\u5927\u8bb0\u5f55\uff0c\u4f46\u4e0d\u5305\u62ec\u6807\u8bb0\u4e3a\u201c\u5df2\u5220\u9664\u201d\u7684\u8bb0\u5f55\uff1b</li> <li>\u6bcf\u4e2a\u8bb0\u5f55\u7ec4\u7684\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u5c31\u662f\u7ec4\u5185\u6700\u5927\u7684\u90a3\u6761\u8bb0\u5f55\uff0c\u5e76\u4e14\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u7684\u5934\u4fe1\u606f\u4e2d\u4f1a\u5b58\u50a8\u8be5\u7ec4\u4e00\u5171\u6709\u591a\u5c11\u6761\u8bb0\u5f55\uff0c\u4f5c\u4e3a n_owned \u5b57\u6bb5\uff08\u4e0a\u56fe\u4e2d\u7c89\u7ea2\u8272\u5b57\u6bb5\uff09</li> <li>\u9875\u76ee\u5f55\u7528\u6765\u5b58\u50a8\u6bcf\u7ec4\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u7684\u5730\u5740\u504f\u79fb\u91cf\uff0c\u8fd9\u4e9b\u5730\u5740\u504f\u79fb\u91cf\u4f1a\u6309\u7167\u5148\u540e\u987a\u5e8f\u5b58\u50a8\u8d77\u6765\uff0c\u6bcf\u7ec4\u7684\u5730\u5740\u504f\u79fb\u91cf\u4e5f\u88ab\u79f0\u4e4b\u4e3a\u69fd\uff08slot\uff09\uff0c\u6bcf\u4e2a\u69fd\u76f8\u5f53\u4e8e\u6307\u9488\u6307\u5411\u4e86\u4e0d\u540c\u7ec4\u7684\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u3002</li> </ol> <p>\u4ece\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u9875\u76ee\u5f55\u5c31\u662f\u7531\u591a\u4e2a\u69fd\u7ec4\u6210\u7684\uff0c\u69fd\u76f8\u5f53\u4e8e\u5206\u7ec4\u8bb0\u5f55\u7684\u7d22\u5f15\u3002\u7136\u540e\uff0c\u56e0\u4e3a\u8bb0\u5f55\u662f\u6309\u7167\u300c\u4e3b\u952e\u503c\u300d\u4ece\u5c0f\u5230\u5927\u6392\u5e8f\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u901a\u8fc7\u69fd\u67e5\u627e\u8bb0\u5f55\u65f6\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u8981\u67e5\u8be2\u7684\u8bb0\u5f55\u5728\u54ea\u4e2a\u69fd\uff08\u54ea\u4e2a\u8bb0\u5f55\u5206\u7ec4\uff09\uff0c\u5b9a\u4f4d\u5230\u69fd\u540e\uff0c\u518d\u904d\u5386\u69fd\u5185\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u627e\u5230\u5bf9\u5e94\u7684\u8bb0\u5f55\uff0c\u65e0\u9700\u4ece\u6700\u5c0f\u8bb0\u5f55\u5f00\u59cb\u904d\u5386\u6574\u4e2a\u9875\u4e2d\u7684\u8bb0\u5f55\u94fe\u8868\u3002</p> <p>\u4ee5\u4e0a\u9762\u90a3\u5f20\u56fe\u4e3e\u4e2a\u4f8b\u5b50\uff0c5 \u4e2a\u69fd\u7684\u7f16\u53f7\u5206\u522b\u4e3a 0\uff0c1\uff0c2\uff0c3\uff0c4\uff0c\u6211\u60f3\u67e5\u627e\u4e3b\u952e\u4e3a 11 \u7684\u7528\u6237\u8bb0\u5f55\uff1a</p> <ul> <li>\u5148\u4e8c\u5206\u5f97\u51fa\u69fd\u4e2d\u95f4\u4f4d\u662f (0+4)/2=2\uff0c2 \u53f7\u69fd\u91cc\u6700\u5927\u7684\u8bb0\u5f55\u4e3a 8\u3002\u56e0\u4e3a 11 &gt; 8\uff0c\u6240\u4ee5\u9700\u8981\u4ece 2 \u53f7\u69fd\u540e\u7ee7\u7eed\u641c\u7d22\u8bb0\u5f55\uff1b</li> <li>\u518d\u4f7f\u7528\u4e8c\u5206\u641c\u7d22\u51fa 2 \u53f7\u548c 4 \u53f7\u69fd\u7684\u4e2d\u95f4\u4f4d\u662f (2+4)/2= 3\uff0c3 \u53f7\u69fd\u91cc\u6700\u5927\u7684\u8bb0\u5f55\u4e3a 12\u3002\u56e0\u4e3a 11 &lt; 12\uff0c\u6240\u4ee5\u4e3b\u952e\u4e3a 11 \u7684\u8bb0\u5f55\u5728 3 \u53f7\u69fd\u91cc\uff1b</li> <li>\u8fd9\u91cc\u6709\u4e2a\u95ee\u9898\uff0c\u300c\u69fd\u5bf9\u5e94\u7684\u503c\u90fd\u662f\u8fd9\u4e2a\u7ec4\u7684\u4e3b\u952e\u6700\u5927\u7684\u8bb0\u5f55\uff0c\u5982\u4f55\u627e\u5230\u7ec4\u91cc\u6700\u5c0f\u7684\u8bb0\u5f55\u300d\uff1f\u6bd4\u5982\u69fd 3 \u5bf9\u5e94\u6700\u5927\u4e3b\u952e\u662f 12 \u7684\u8bb0\u5f55\uff0c\u90a3\u5982\u4f55\u627e\u5230\u6700\u5c0f\u8bb0\u5f55 9\u3002\u89e3\u51b3\u529e\u6cd5\u662f\uff1a\u901a\u8fc7\u69fd 3 \u627e\u5230 \u69fd 2 \u5bf9\u5e94\u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u4e3b\u952e\u4e3a 8 \u7684\u8bb0\u5f55\u3002\u4e3b\u952e\u4e3a 8 \u7684\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u5c31\u662f\u69fd 3 \u5f53\u4e2d\u4e3b\u952e\u6700\u5c0f\u7684 9 \u8bb0\u5f55\uff0c\u7136\u540e\u5f00\u59cb\u5411\u4e0b\u641c\u7d22 2 \u6b21\uff0c\u5b9a\u4f4d\u5230\u4e3b\u952e\u4e3a 11 \u7684\u8bb0\u5f55\uff0c\u53d6\u51fa\u8be5\u6761\u8bb0\u5f55\u7684\u4fe1\u606f\u5373\u4e3a\u6211\u4eec\u60f3\u8981\u67e5\u627e\u7684\u5185\u5bb9\u3002</li> </ul> <p>\u770b\u5230\u7b2c\u4e09\u6b65\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u6709\u7684\u540c\u5b66\u4f1a\u7591\u95ee\uff0c\u5982\u679c\u67d0\u4e2a\u69fd\u5185\u7684\u8bb0\u5f55\u5f88\u591a\uff0c\u7136\u540e\u56e0\u4e3a\u8bb0\u5f55\u90fd\u662f\u5355\u5411\u94fe\u8868\u4e32\u8d77\u6765\u7684\uff0c\u90a3\u8fd9\u6837\u5728\u69fd\u5185\u67e5\u627e\u67d0\u4e2a\u8bb0\u5f55\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e0d\u5c31\u662f O(n) \u4e86\u5417\uff1f</p> <p>\u8fd9\u70b9\u4e0d\u7528\u62c5\u5fc3\uff0cInnoDB \u5bf9\u6bcf\u4e2a\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u6761\u6570\u90fd\u662f\u6709\u89c4\u5b9a\u7684\uff0c\u69fd\u5185\u7684\u8bb0\u5f55\u5c31\u53ea\u6709\u51e0\u6761\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u53ea\u80fd\u6709 1 \u6761\u8bb0\u5f55\uff1b</li> <li>\u6700\u540e\u4e00\u4e2a\u5206\u7ec4\u4e2d\u7684\u8bb0\u5f55\u6761\u6570\u8303\u56f4\u53ea\u80fd\u5728 1-8 \u6761\u4e4b\u95f4\uff1b</li> <li>\u5269\u4e0b\u7684\u5206\u7ec4\u4e2d\u8bb0\u5f55\u6761\u6570\u8303\u56f4\u53ea\u80fd\u5728 4-8 \u6761\u4e4b\u95f4\u3002</li> </ul>"},{"location":"mysql/index/page/#b_1","title":"B+ \u6811\u662f\u5982\u4f55\u8fdb\u884c\u67e5\u8be2\u7684\uff1f","text":"<p>\u4e0a\u9762\u6211\u4eec\u90fd\u662f\u5728\u8bf4\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u7684\u8bb0\u5f55\u68c0\u7d22\uff0c\u56e0\u4e3a\u4e00\u4e2a\u6570\u636e\u9875\u4e2d\u7684\u8bb0\u5f55\u662f\u6709\u9650\u7684\uff0c\u4e14\u4e3b\u952e\u503c\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\u901a\u8fc7\u5bf9\u6240\u6709\u8bb0\u5f55\u8fdb\u884c\u5206\u7ec4\uff0c\u7136\u540e\u5c06\u7ec4\u53f7\uff08\u69fd\u53f7\uff09\u5b58\u50a8\u5230\u9875\u76ee\u5f55\uff0c\u4f7f\u5176\u8d77\u5230\u7d22\u5f15\u4f5c\u7528\uff0c\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u7684\u65b9\u6cd5\u5feb\u901f\u68c0\u7d22\u5230\u8bb0\u5f55\u5728\u54ea\u4e2a\u5206\u7ec4\uff0c\u6765\u964d\u4f4e\u68c0\u7d22\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u3002</p> <p>\u4f46\u662f\uff0c\u5f53\u6211\u4eec\u9700\u8981\u5b58\u50a8\u5927\u91cf\u7684\u8bb0\u5f55\u65f6\uff0c\u5c31\u9700\u8981\u591a\u4e2a\u6570\u636e\u9875\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u9700\u8981\u8003\u8651\u5982\u4f55\u5efa\u7acb\u5408\u9002\u7684\u7d22\u5f15\uff0c\u624d\u80fd\u65b9\u4fbf\u5b9a\u4f4d\u8bb0\u5f55\u6240\u5728\u7684\u9875\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cInnoDB \u91c7\u7528\u4e86 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\u3002\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u6b21\u6570\u5bf9\u7d22\u5f15\u7684\u4f7f\u7528\u6548\u7387\u81f3\u5173\u91cd\u8981\uff0c\u56e0\u6b64\u5728\u6784\u9020\u7d22\u5f15\u7684\u65f6\u5019\uff0c\u6211\u4eec\u66f4\u503e\u5411\u4e8e\u91c7\u7528\u201c\u77ee\u80d6\u201d\u7684 B+ \u6811\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u6837\u6240\u9700\u8981\u8fdb\u884c\u7684\u78c1\u76d8 I/O \u6b21\u6570\u66f4\u5c11\uff0c\u800c\u4e14 B+ \u6811 \u66f4\u9002\u5408\u8fdb\u884c\u5173\u952e\u5b57\u7684\u8303\u56f4\u67e5\u8be2\u3002</p> <p>InnoDB \u91cc\u7684 B+ \u6811\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u6570\u636e\u9875\uff0c\u7ed3\u6784\u793a\u610f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u901a\u8fc7\u4e0a\u56fe\uff0c\u6211\u4eec\u770b\u51fa  B+ \u6811\u7684\u7279\u70b9\uff1a</p> <ul> <li>\u53ea\u6709\u53f6\u5b50\u8282\u70b9\uff08\u6700\u5e95\u5c42\u7684\u8282\u70b9\uff09\u624d\u5b58\u653e\u4e86\u6570\u636e\uff0c\u975e\u53f6\u5b50\u8282\u70b9\uff08\u5176\u4ed6\u4e0a\u5c42\u8282\uff09\u4ec5\u7528\u6765\u5b58\u653e\u76ee\u5f55\u9879\u4f5c\u4e3a\u7d22\u5f15\u3002</li> <li>\u975e\u53f6\u5b50\u8282\u70b9\u5206\u4e3a\u4e0d\u540c\u5c42\u6b21\uff0c\u901a\u8fc7\u5206\u5c42\u6765\u964d\u4f4e\u6bcf\u4e00\u5c42\u7684\u641c\u7d22\u91cf\uff1b</li> <li>\u6240\u6709\u8282\u70b9\u6309\u7167\u7d22\u5f15\u952e\u5927\u5c0f\u6392\u5e8f\uff0c\u6784\u6210\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u4fbf\u4e8e\u8303\u56f4\u67e5\u8be2\uff1b</li> </ul> <p>\u6211\u4eec\u518d\u770b\u770b B+ \u6811\u5982\u4f55\u5b9e\u73b0\u5feb\u901f\u67e5\u627e\u4e3b\u952e\u4e3a 6 \u7684\u8bb0\u5f55\uff0c\u4ee5\u4e0a\u56fe\u4e3a\u4f8b\u5b50\uff1a</p> <ul> <li>\u4ece\u6839\u8282\u70b9\u5f00\u59cb\uff0c\u901a\u8fc7\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u7b26\u5408\u9875\u5185\u8303\u56f4\u5305\u542b\u67e5\u8be2\u503c\u7684\u9875\uff0c\u56e0\u4e3a\u67e5\u8be2\u7684\u4e3b\u952e\u503c\u4e3a 6\uff0c\u5728[1, 7) \u8303\u56f4\u4e4b\u95f4\uff0c\u6240\u4ee5\u5230\u9875 30 \u4e2d\u67e5\u627e\u66f4\u8be6\u7ec6\u7684\u76ee\u5f55\u9879\uff1b</li> <li>\u5728\u975e\u53f6\u5b50\u8282\u70b9\uff08\u9875 30\uff09\u4e2d\uff0c\u7ee7\u7eed\u901a\u8fc7\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u7b26\u5408\u9875\u5185\u8303\u56f4\u5305\u542b\u67e5\u8be2\u503c\u7684\u9875\uff0c\u4e3b\u952e\u503c\u5927\u4e8e 5\uff0c\u6240\u4ee5\u5c31\u5230\u53f6\u5b50\u8282\u70b9\uff08\u9875 16\uff09\u67e5\u627e\u8bb0\u5f55\uff1b</li> <li>\u63a5\u7740\uff0c\u5728\u53f6\u5b50\u8282\u70b9\uff08\u9875 16\uff09\u4e2d\uff0c\u901a\u8fc7\u69fd\u67e5\u627e\u8bb0\u5f55\u65f6\uff0c\u4f7f\u7528\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u8981\u67e5\u8be2\u7684\u8bb0\u5f55\u5728\u54ea\u4e2a\u69fd\uff08\u54ea\u4e2a\u8bb0\u5f55\u5206\u7ec4\uff09\uff0c\u5b9a\u4f4d\u5230\u69fd\u540e\uff0c\u518d\u904d\u5386\u69fd\u5185\u7684\u6240\u6709\u8bb0\u5f55\uff0c\u627e\u5230\u4e3b\u952e\u4e3a 6 \u7684\u8bb0\u5f55\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u5b9a\u4f4d\u8bb0\u5f55\u6240\u5728\u54ea\u4e00\u4e2a\u9875\u65f6\uff0c\u4e5f\u662f\u901a\u8fc7\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u5230\u5305\u542b\u8be5\u8bb0\u5f55\u7684\u9875\u3002\u5b9a\u4f4d\u5230\u8be5\u9875\u540e\uff0c\u53c8\u4f1a\u5728\u8be5\u9875\u5185\u8fdb\u884c\u4e8c\u5206\u6cd5\u5feb\u901f\u5b9a\u4f4d\u8bb0\u5f55\u6240\u5728\u7684\u5206\u7ec4\uff08\u69fd\u53f7\uff09\uff0c\u6700\u540e\u5728\u5206\u7ec4\u5185\u8fdb\u884c\u904d\u5386\u67e5\u627e\u3002</p>"},{"location":"mysql/index/page/#_1","title":"\u805a\u7c07\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15","text":"<p>\u53e6\u5916\uff0c\u7d22\u5f15\u53c8\u53ef\u4ee5\u5206\u6210\u805a\u7c07\u7d22\u5f15\u548c\u975e\u805a\u7c07\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\uff0c\u5b83\u4eec\u533a\u522b\u5c31\u5728\u4e8e\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4ec0\u4e48\u6570\u636e\uff1a</p> <ul> <li>\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\uff1b</li> <li>\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002</li> </ul> <p>\u56e0\u4e3a\u8868\u7684\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u6240\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e00\u5b9a\u4f1a\u4e3a\u8868\u521b\u5efa\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff0c\u4e14\u7531\u4e8e\u6570\u636e\u5728\u7269\u7406\u4e0a\u53ea\u4f1a\u4fdd\u5b58\u4e00\u4efd\uff0c\u6240\u4ee5\u805a\u7c07\u7d22\u5f15\u53ea\u80fd\u6709\u4e00\u4e2a\u3002</p> <p>InnoDB \u5728\u521b\u5efa\u805a\u7c07\u7d22\u5f15\u65f6\uff0c\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u573a\u666f\u9009\u62e9\u4e0d\u540c\u7684\u5217\u4f5c\u4e3a\u7d22\u5f15\uff1a</p> <ul> <li>\u5982\u679c\u6709\u4e3b\u952e\uff0c\u9ed8\u8ba4\u4f1a\u4f7f\u7528\u4e3b\u952e\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff1b</li> <li>\u5982\u679c\u6ca1\u6709\u4e3b\u952e\uff0c\u5c31\u9009\u62e9\u7b2c\u4e00\u4e2a\u4e0d\u5305\u542b NULL \u503c\u7684\u552f\u4e00\u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff1b</li> <li>\u5728\u4e0a\u9762\u4e24\u4e2a\u90fd\u6ca1\u6709\u7684\u60c5\u51b5\u4e0b\uff0cInnoDB \u5c06\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u9690\u5f0f\u81ea\u589e id \u5217\u4f5c\u4e3a\u805a\u7c07\u7d22\u5f15\u7684\u7d22\u5f15\u952e\uff1b</li> </ul> <p>\u4e00\u5f20\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff0c\u90a3\u4e3a\u4e86\u5b9e\u73b0\u975e\u4e3b\u952e\u5b57\u6bb5\u7684\u5feb\u901f\u641c\u7d22\uff0c\u5c31\u5f15\u51fa\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff08\u975e\u805a\u7c07\u7d22\u5f15/\u8f85\u52a9\u7d22\u5f15\uff09\uff0c\u5b83\u4e5f\u662f\u5229\u7528\u4e86 B+ \u6811\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f46\u662f\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002</p> <p>\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u5982\u4e0b\u56fe\uff0c\u6570\u636e\u90e8\u5206\u4e3a\u4e3b\u952e\u503c\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u67d0\u4e2a\u67e5\u8be2\u8bed\u53e5\u4f7f\u7528\u4e86\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4f46\u662f\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u662f\u4e3b\u952e\u503c\uff0c\u8fd9\u65f6\u5728\u4e8c\u7ea7\u7d22\u5f15\u627e\u5230\u4e3b\u952e\u503c\u540e\uff0c\u9700\u8981\u53bb\u805a\u7c07\u7d22\u5f15\u4e2d\u83b7\u5f97\u6570\u636e\u884c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u56de\u8868\u300d\uff0c\u4e5f\u5c31\u662f\u8bf4\u8981\u67e5\u4e24\u4e2a B+ \u6811\u624d\u80fd\u67e5\u5230\u6570\u636e\u3002\u4e0d\u8fc7\uff0c\u5f53\u67e5\u8be2\u7684\u6570\u636e\u662f\u4e3b\u952e\u503c\u65f6\uff0c\u56e0\u4e3a\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u5c31\u80fd\u67e5\u8be2\u5230\uff0c\u4e0d\u7528\u518d\u53bb\u805a\u7c07\u7d22\u5f15\u67e5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u7d22\u5f15\u8986\u76d6\u300d\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981\u67e5\u4e00\u4e2a B+ \u6811\u5c31\u80fd\u627e\u5230\u6570\u636e\u3002</p>"},{"location":"mysql/index/page/#_2","title":"\u603b\u7ed3","text":"<p>InnoDB \u7684\u6570\u636e\u662f\u6309\u300c\u6570\u636e\u9875\u300d\u4e3a\u5355\u4f4d\u6765\u8bfb\u5199\u7684\uff0c\u9ed8\u8ba4\u6570\u636e\u9875\u5927\u5c0f\u4e3a 16 KB\u3002\u6bcf\u4e2a\u6570\u636e\u9875\u4e4b\u95f4\u901a\u8fc7\u53cc\u5411\u94fe\u8868\u7684\u5f62\u5f0f\u7ec4\u7ec7\u8d77\u6765\uff0c\u7269\u7406\u4e0a\u4e0d\u8fde\u7eed\uff0c\u4f46\u662f\u903b\u8f91\u4e0a\u8fde\u7eed\u3002</p> <p>\u6570\u636e\u9875\u5185\u5305\u542b\u7528\u6237\u8bb0\u5f55\uff0c\u6bcf\u4e2a\u8bb0\u5f55\u4e4b\u95f4\u7528\u5355\u5411\u94fe\u8868\u7684\u65b9\u5f0f\u7ec4\u7ec7\u8d77\u6765\uff0c\u4e3a\u4e86\u52a0\u5feb\u5728\u6570\u636e\u9875\u5185\u9ad8\u6548\u67e5\u8be2\u8bb0\u5f55\uff0c\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u9875\u76ee\u5f55\uff0c\u9875\u76ee\u5f55\u5b58\u50a8\u5404\u4e2a\u69fd\uff08\u5206\u7ec4\uff09\uff0c\u4e14\u4e3b\u952e\u503c\u662f\u6709\u5e8f\u7684\uff0c\u4e8e\u662f\u53ef\u4ee5\u901a\u8fc7\u4e8c\u5206\u67e5\u627e\u6cd5\u7684\u65b9\u5f0f\u8fdb\u884c\u68c0\u7d22\u4ece\u800c\u63d0\u9ad8\u6548\u7387\u3002</p> <p>\u4e3a\u4e86\u9ad8\u6548\u67e5\u8be2\u8bb0\u5f55\u6240\u5728\u7684\u6570\u636e\u9875\uff0cInnoDB \u91c7\u7528 b+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff0c\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u6570\u636e\u9875\u3002</p> <p>\u5982\u679c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u662f\u5b9e\u9645\u6570\u636e\u7684\u5c31\u662f\u805a\u7c07\u7d22\u5f15\uff0c\u4e00\u4e2a\u8868\u53ea\u80fd\u6709\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff1b\u5982\u679c\u53f6\u5b50\u8282\u70b9\u5b58\u50a8\u7684\u4e0d\u662f\u5b9e\u9645\u6570\u636e\uff0c\u800c\u662f\u4e3b\u952e\u503c\u5219\u5c31\u662f\u4e8c\u7ea7\u7d22\u5f15\uff0c\u4e00\u4e2a\u8868\u4e2d\u53ef\u4ee5\u6709\u591a\u4e2a\u4e8c\u7ea7\u7d22\u5f15\u3002</p> <p>\u5728\u4f7f\u7528\u4e8c\u7ea7\u7d22\u5f15\u8fdb\u884c\u67e5\u627e\u6570\u636e\u65f6\uff0c\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u80fd\u5728\u4e8c\u7ea7\u7d22\u5f15\u627e\u5230\uff0c\u90a3\u4e48\u5c31\u662f\u300c\u7d22\u5f15\u8986\u76d6\u300d\u64cd\u4f5c\uff0c\u5982\u679c\u67e5\u8be2\u7684\u6570\u636e\u4e0d\u5728\u4e8c\u7ea7\u7d22\u5f15\u91cc\uff0c\u5c31\u9700\u8981\u5148\u5728\u4e8c\u7ea7\u7d22\u5f15\u627e\u5230\u4e3b\u952e\u503c\uff0c\u9700\u8981\u53bb\u805a\u7c07\u7d22\u5f15\u4e2d\u83b7\u5f97\u6570\u636e\u884c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u53eb\u4f5c\u300c\u56de\u8868\u300d\u3002</p> <p>\u5173\u4e8e\u7d22\u5f15\u7684\u5185\u5bb9\u8fd8\u6709\u5f88\u591a\uff0c\u6bd4\u5982\u7d22\u5f15\u5931\u6548\u3001\u7d22\u5f15\u4f18\u5316\u7b49\u7b49\uff0c\u8fd9\u4e9b\u5185\u5bb9\u6211\u4e0b\u6b21\u5728\u8bb2\u5566\uff01</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/","title":"\u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u300c\u4e3a\u4ec0\u4e48 MySQL \u91c7\u7528 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\uff1f\u300d\u8fd9\u53e5\u8bdd\uff0c\u662f\u4e0d\u662f\u5728\u9762\u8bd5\u65f6\u7ecf\u5e38\u51fa\u73b0\u3002</p> <p>\u8981\u89e3\u91ca\u8fd9\u4e2a\u95ee\u9898\uff0c\u5176\u5b9e\u4e0d\u5355\u5355\u8981\u4ece\u6570\u636e\u7ed3\u6784\u7684\u89d2\u5ea6\u51fa\u53d1\uff0c\u8fd8\u8981\u8003\u8651\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\uff0c\u56e0\u4e3a MySQL \u7684\u6570\u636e\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u7684\u561b\u3002</p> <p>\u8fd9\u6b21\uff0c\u5c31\u8ddf\u5927\u5bb6\u4e00\u5c42\u4e00\u5c42\u7684\u5206\u6790\u8fd9\u4e2a\u95ee\u9898\uff0c\u56fe\u4e2d\u5305\u542b\u5927\u91cf\u7684\u52a8\u56fe\u6765\u5e2e\u52a9\u5927\u5bb6\u7406\u89e3\uff0c\u76f8\u4fe1\u770b\u5b8c\u4f60\u5c31\u62ff\u634f\u8fd9\u9053\u9898\u76ee\u4e86\uff01</p> <p></p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_1","title":"\u600e\u6837\u7684\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u662f\u597d\u7684\uff1f","text":"<p>MySQL \u7684\u6570\u636e\u662f\u6301\u4e45\u5316\u7684\uff0c\u610f\u5473\u7740\u6570\u636e\uff08\u7d22\u5f15 + \u8bb0\u5f55\uff09\u662f\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u5373\u4f7f\u8bbe\u5907\u65ad\u7535\u4e86\uff0c\u6570\u636e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002</p> <p>\u78c1\u76d8\u662f\u4e00\u4e2a\u6162\u7684\u79bb\u8c31\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u6709\u591a\u79bb\u8c31\u5462\uff1f</p> <p>\u4eba\u5bb6\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u662f\u7eb3\u79d2\u7ea7\u522b\u7684\uff0c\u800c\u78c1\u76d8\u8bbf\u95ee\u7684\u901f\u5ea6\u662f\u6beb\u79d2\u7ea7\u522b\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8bfb\u53d6\u540c\u6837\u5927\u5c0f\u7684\u6570\u636e\uff0c\u78c1\u76d8\u4e2d\u8bfb\u53d6\u7684\u901f\u5ea6\u6bd4\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u7684\u901f\u5ea6\u8981\u6162\u4e0a\u4e07\u500d\uff0c\u751a\u81f3\u51e0\u5341\u4e07\u500d\u3002</p> <p>\u78c1\u76d8\u8bfb\u5199\u7684\u6700\u5c0f\u5355\u4f4d\u662f\u6247\u533a\uff0c\u6247\u533a\u7684\u5927\u5c0f\u53ea\u6709 <code>512B</code> \u5927\u5c0f\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e00\u6b21\u4f1a\u8bfb\u5199\u591a\u4e2a\u6247\u533a\uff0c\u6240\u4ee5\u64cd\u4f5c\u7cfb\u7edf\u7684\u6700\u5c0f\u8bfb\u5199\u5355\u4f4d\u662f\u5757\uff08Block\uff09\u3002Linux \u4e2d\u7684\u5757\u5927\u5c0f\u4e3a <code>4KB</code>\uff0c\u4e5f\u5c31\u662f\u4e00\u6b21\u78c1\u76d8  I/O \u64cd\u4f5c\u4f1a\u76f4\u63a5\u8bfb\u5199 8 \u4e2a\u6247\u533a\u3002</p> <p>\u7531\u4e8e\u6570\u636e\u5e93\u7684\u7d22\u5f15\u662f\u4fdd\u5b58\u5230\u78c1\u76d8\u4e0a\u7684\uff0c\u56e0\u6b64\u5f53\u6211\u4eec\u901a\u8fc7\u7d22\u5f15\u67e5\u627e\u67d0\u884c\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5148\u4ece\u78c1\u76d8\u8bfb\u53d6\u7d22\u5f15\u5230\u5185\u5b58\uff0c\u518d\u901a\u8fc7\u7d22\u5f15\u4ece\u78c1\u76d8\u4e2d\u627e\u5230\u67d0\u884c\u6570\u636e\uff0c\u7136\u540e\u8bfb\u5165\u5230\u5185\u5b58\uff0c\u4e5f\u5c31\u662f\u8bf4\u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4f1a\u53d1\u751f\u591a\u6b21\u78c1\u76d8 I/O\uff0c\u800c\u78c1\u76d8 I/O \u6b21\u6570\u8d8a\u591a\uff0c\u6240\u6d88\u8017\u7684\u65f6\u95f4\u4e5f\u5c31\u8d8a\u5927\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u5e0c\u671b\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u80fd\u5728\u5c3d\u53ef\u80fd\u5c11\u7684\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u4e2d\u5b8c\u6210\u67e5\u8be2\u5de5\u4f5c\uff0c\u56e0\u4e3a\u78c1\u76d8  I/O \u64cd\u4f5c\u8d8a\u5c11\uff0c\u6240\u6d88\u8017\u7684\u65f6\u95f4\u4e5f\u5c31\u8d8a\u5c0f\u3002</p> <p>\u53e6\u5916\uff0cMySQL \u662f\u652f\u6301\u8303\u56f4\u67e5\u627e\u7684\uff0c\u6240\u4ee5\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u4e0d\u4ec5\u8981\u80fd\u9ad8\u6548\u5730\u67e5\u8be2\u67d0\u4e00\u4e2a\u8bb0\u5f55\uff0c\u800c\u4e14\u4e5f\u8981\u80fd\u9ad8\u6548\u5730\u6267\u884c\u8303\u56f4\u67e5\u627e\u3002</p> <p>\u6240\u4ee5\uff0c\u8981\u8bbe\u8ba1\u4e00\u4e2a\u9002\u5408 MySQL \u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u81f3\u5c11\u6ee1\u8db3\u4ee5\u4e0b\u8981\u6c42\uff1a</p> <ul> <li>\u80fd\u5728\u5c3d\u53ef\u80fd\u5c11\u7684\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u4e2d\u5b8c\u6210\u67e5\u8be2\u5de5\u4f5c\uff1b</li> <li>\u8981\u80fd\u9ad8\u6548\u5730\u67e5\u8be2\u67d0\u4e00\u4e2a\u8bb0\u5f55\uff0c\u4e5f\u8981\u80fd\u9ad8\u6548\u5730\u6267\u884c\u8303\u56f4\u67e5\u627e\uff1b</li> </ul> <p>\u5206\u6790\u5b8c\u8981\u6c42\u540e\uff0c\u6211\u4eec\u9488\u5bf9\u6bcf\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u5206\u6790\u4e00\u4e0b\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_2","title":"\u4ec0\u4e48\u662f\u4e8c\u5206\u67e5\u627e\uff1f","text":"<p>\u7d22\u5f15\u6570\u636e\u6700\u597d\u80fd\u6309\u987a\u5e8f\u6392\u5217\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u7528\u300c\u4e8c\u5206\u67e5\u627e\u6cd5\u300d\u9ad8\u6548\u5b9a\u4f4d\u6570\u636e\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u73b0\u5728\u7528\u6570\u7ec4\u6765\u5b58\u50a8\u7d22\u5f15\uff0c\u6bd4\u5982\u4e0b\u9762\u6709\u4e00\u4e2a\u6392\u5e8f\u7684\u6570\u7ec4\uff0c\u5982\u679c\u8981\u4ece\u4e2d\u627e\u51fa\u6570\u5b57 3\uff0c\u6700\u7b80\u5355\u529e\u6cd5\u5c31\u662f\u4ece\u5934\u4f9d\u6b21\u904d\u5386\u67e5\u8be2\uff0c\u8fd9\u79cd\u65b9\u6cd5\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\uff0c\u67e5\u8be2\u6548\u7387\u5e76\u4e0d\u9ad8\u3002\u56e0\u4e3a\u8be5\u6570\u7ec4\u662f\u6709\u5e8f\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u4e8c\u5206\u67e5\u627e\u6cd5\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u5f20\u91c7\u7528\u4e8c\u5206\u6cd5\u7684\u67e5\u8be2\u8fc7\u7a0b\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e8c\u5206\u67e5\u627e\u6cd5\u6bcf\u6b21\u90fd\u628a\u67e5\u8be2\u7684\u8303\u56f4\u51cf\u534a\uff0c\u8fd9\u6837\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u964d\u5230\u4e86 O(logn)\uff0c\u4f46\u662f\u6bcf\u6b21\u67e5\u627e\u90fd\u9700\u8981\u4e0d\u65ad\u8ba1\u7b97\u4e2d\u95f4\u4f4d\u7f6e\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_3","title":"\u4ec0\u4e48\u662f\u4e8c\u5206\u67e5\u627e\u6811\uff1f","text":"<p>\u7528\u6570\u7ec4\u6765\u5b9e\u73b0\u7ebf\u6027\u6392\u5e8f\u7684\u6570\u636e\u867d\u7136\u7b80\u5355\u597d\u7528\uff0c\u4f46\u662f\u63d2\u5165\u65b0\u5143\u7d20\u7684\u65f6\u5019\u6027\u80fd\u592a\u4f4e\u3002</p> <p>\u56e0\u4e3a\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u9700\u8981\u5c06\u8fd9\u4e2a\u5143\u7d20\u4e4b\u540e\u7684\u6240\u6709\u5143\u7d20\u540e\u79fb\u4e00\u4f4d\uff0c\u5982\u679c\u8fd9\u4e2a\u64cd\u4f5c\u53d1\u751f\u5728\u78c1\u76d8\u4e2d\u5462\uff1f\u8fd9\u5fc5\u7136\u662f\u707e\u96be\u6027\u7684\u3002\u56e0\u4e3a\u78c1\u76d8\u7684\u901f\u5ea6\u6bd4\u5185\u5b58\u6162\u51e0\u5341\u4e07\u500d\uff0c\u6240\u4ee5\u6211\u4eec\u4e0d\u80fd\u7528\u4e00\u79cd\u7ebf\u6027\u7ed3\u6784\u5c06\u78c1\u76d8\u6392\u5e8f\u3002</p> <p>\u5176\u6b21\uff0c\u6709\u5e8f\u7684\u6570\u7ec4\u5728\u4f7f\u7528\u4e8c\u5206\u67e5\u627e\u7684\u65f6\u5019\uff0c\u6bcf\u6b21\u67e5\u627e\u90fd\u8981\u4e0d\u65ad\u8ba1\u7b97\u4e2d\u95f4\u7684\u4f4d\u7f6e\u3002</p> <p>\u90a3\u6211\u4eec\u80fd\u4e0d\u80fd\u8bbe\u8ba1\u4e00\u4e2a\u975e\u7ebf\u5f62\u4e14\u5929\u7136\u9002\u5408\u4e8c\u5206\u67e5\u627e\u7684\u6570\u636e\u7ed3\u6784\u5462\uff1f</p> <p>\u6709\u7684\uff0c\u8bf7\u770b\u4e0b\u56fe\u8fd9\u4e2a\u795e\u5947\u7684\u64cd\u4f5c\uff0c\u627e\u5230\u6240\u6709\u4e8c\u5206\u67e5\u627e\u4e2d\u7528\u5230\u7684\u6240\u6709\u4e2d\u95f4\u8282\u70b9\uff0c\u628a\u4ed6\u4eec\u7528\u6307\u9488\u8fde\u8d77\u6765\uff0c\u5e76\u5c06\u6700\u4e2d\u95f4\u7684\u8282\u70b9\u4f5c\u4e3a\u6839\u8282\u70b9\u3002</p> <p></p> <p>\u600e\u4e48\u6837\uff1f\u662f\u4e0d\u662f\u53d8\u6210\u4e86\u4e8c\u53c9\u6811\uff0c\u4e0d\u8fc7\u5b83\u4e0d\u662f\u666e\u901a\u7684\u4e8c\u53c9\u6811\uff0c\u5b83\u662f\u4e00\u4e2a\u4e8c\u53c9\u67e5\u627e\u6811\u3002</p> <p>\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u7279\u70b9\u662f\u4e00\u4e2a\u8282\u70b9\u7684\u5de6\u5b50\u6811\u7684\u6240\u6709\u8282\u70b9\u90fd\u5c0f\u4e8e\u8fd9\u4e2a\u8282\u70b9\uff0c\u53f3\u5b50\u6811\u7684\u6240\u6709\u8282\u70b9\u90fd\u5927\u4e8e\u8fd9\u4e2a\u8282\u70b9\uff0c\u8fd9\u6837\u6211\u4eec\u5728\u67e5\u8be2\u6570\u636e\u65f6\uff0c\u4e0d\u9700\u8981\u8ba1\u7b97\u4e2d\u95f4\u8282\u70b9\u7684\u4f4d\u7f6e\u4e86\uff0c\u53ea\u9700\u5c06\u67e5\u627e\u7684\u6570\u636e\u4e0e\u8282\u70b9\u7684\u6570\u636e\u8fdb\u884c\u6bd4\u8f83\u3002</p> <p>\u5047\u8bbe\uff0c\u6211\u4eec\u67e5\u627e\u7d22\u5f15\u503c\u4e3a key \u7684\u8282\u70b9\uff1a</p> <ol> <li>\u5982\u679c key \u5927\u4e8e\u6839\u8282\u70b9\uff0c\u5219\u5728\u53f3\u5b50\u6811\u4e2d\u8fdb\u884c\u67e5\u627e\uff1b</li> <li>\u5982\u679c key \u5c0f\u4e8e\u6839\u8282\u70b9\uff0c\u5219\u5728\u5de6\u5b50\u6811\u4e2d\u8fdb\u884c\u67e5\u627e\uff1b</li> <li>\u5982\u679c key \u7b49\u4e8e\u6839\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u627e\u5230\u4e86\u8fd9\u4e2a\u8282\u70b9\uff0c\u8fd4\u56de\u6839\u8282\u70b9\u5373\u53ef\u3002</li> </ol> <p>\u4e8c\u53c9\u67e5\u627e\u6811\u67e5\u627e\u67d0\u4e2a\u8282\u70b9\u7684\u52a8\u56fe\u6f14\u793a\u5982\u4e0b\uff0c\u6bd4\u5982\u8981\u67e5\u627e\u8282\u70b9 3\uff1a</p> <p></p> <p>\u53e6\u5916\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u89e3\u51b3\u4e86\u63d2\u5165\u65b0\u8282\u70b9\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u4e8c\u53c9\u67e5\u627e\u6811\u662f\u4e00\u4e2a\u8df3\u8dc3\u7ed3\u6784\uff0c\u4e0d\u5fc5\u8fde\u7eed\u6392\u5217\u3002\u8fd9\u6837\u5728\u63d2\u5165\u7684\u65f6\u5019\uff0c\u65b0\u8282\u70b9\u53ef\u4ee5\u653e\u5728\u4efb\u4f55\u4f4d\u7f6e\uff0c\u4e0d\u4f1a\u50cf\u7ebf\u6027\u7ed3\u6784\u90a3\u6837\u63d2\u5165\u4e00\u4e2a\u5143\u7d20\uff0c\u6240\u6709\u5143\u7d20\u90fd\u9700\u8981\u5411\u540e\u6392\u5217\u3002</p> <p>\u4e0b\u9762\u662f\u4e8c\u53c9\u67e5\u627e\u6811\u63d2\u5165\u67d0\u4e2a\u8282\u70b9\u7684\u52a8\u56fe\u6f14\u793a\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u89e3\u51b3\u4e86\u8fde\u7eed\u7ed3\u6784\u63d2\u5165\u65b0\u5143\u7d20\u5f00\u9500\u5f88\u5927\u7684\u95ee\u9898\uff0c\u540c\u65f6\u53c8\u4fdd\u6301\u7740\u5929\u7136\u7684\u4e8c\u5206\u7ed3\u6784\u3002</p> <p>\u90a3\u662f\u4e0d\u662f\u4e8c\u53c9\u67e5\u627e\u6811\u5c31\u53ef\u4ee5\u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u4e86\u5462\uff1f</p> <p>\u4e0d\u884c\u4e0d\u884c\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u5b58\u5728\u4e00\u4e2a\u6781\u7aef\u60c5\u51b5\uff0c\u4f1a\u5bfc\u81f4\u5b83\u53d8\u6210\u4e00\u4e2a\u7638\u5b50\uff01</p> <p>\u5f53\u6bcf\u6b21\u63d2\u5165\u7684\u5143\u7d20\u90fd\u662f\u4e8c\u53c9\u67e5\u627e\u6811\u4e2d\u6700\u5927\u7684\u5143\u7d20\uff0c\u4e8c\u53c9\u67e5\u627e\u6811\u5c31\u4f1a\u9000\u5316\u6210\u4e86\u4e00\u6761\u94fe\u8868\uff0c\u67e5\u627e\u6570\u636e\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u53d8\u6210\u4e86 O(n)\uff0c\u5982\u4e0b\u52a8\u56fe\u6f14\u793a\uff1a</p> <p></p> <p>\u7531\u4e8e\u6811\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u7684\uff0c\u8bbf\u95ee\u6bcf\u4e2a\u8282\u70b9\uff0c\u90fd\u5bf9\u5e94\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\uff08\u5047\u8bbe\u4e00\u4e2a\u8282\u70b9\u7684\u5927\u5c0f\u300c\u5c0f\u4e8e\u300d\u64cd\u4f5c\u7cfb\u7edf\u7684\u6700\u5c0f\u8bfb\u5199\u5355\u4f4d\u5757\u7684\u5927\u5c0f\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\u6811\u7684\u9ad8\u5ea6\u5c31\u7b49\u4e8e\u6bcf\u6b21\u67e5\u8be2\u6570\u636e\u65f6\u78c1\u76d8 IO \u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u6240\u4ee5\u6811\u7684\u9ad8\u5ea6\u8d8a\u9ad8\uff0c\u5c31\u4f1a\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002</p> <p>\u4e8c\u53c9\u67e5\u627e\u6811\u7531\u4e8e\u5b58\u5728\u9000\u5316\u6210\u94fe\u8868\u7684\u53ef\u80fd\u6027\uff0c\u4f1a\u4f7f\u5f97\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4ece O(logn) \u5347\u4e3a O(n)\u3002</p> <p>\u800c\u4e14\u4f1a\u968f\u7740\u63d2\u5165\u7684\u5143\u7d20\u8d8a\u591a\uff0c\u6811\u7684\u9ad8\u5ea6\u4e5f\u53d8\u9ad8\uff0c\u610f\u5473\u7740\u9700\u8981\u78c1\u76d8 IO \u64cd\u4f5c\u7684\u6b21\u6570\u5c31\u8d8a\u591a\uff0c\u8fd9\u6837\u5bfc\u81f4\u67e5\u8be2\u6027\u80fd\u4e25\u91cd\u4e0b\u964d\uff0c\u518d\u52a0\u4e0a\u4e0d\u80fd\u8303\u56f4\u67e5\u8be2\uff0c\u6240\u4ee5\u4e0d\u9002\u5408\u4f5c\u4e3a\u6570\u636e\u5e93\u7684\u7d22\u5f15\u7ed3\u6784\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_4","title":"\u4ec0\u4e48\u662f\u81ea\u5e73\u8861\u4e8c\u53c9\u6811\uff1f","text":"<p>\u4e3a\u4e86\u89e3\u51b3\u4e8c\u53c9\u67e5\u627e\u6811\u4f1a\u5728\u6781\u7aef\u60c5\u51b5\u4e0b\u9000\u5316\u6210\u94fe\u8868\u7684\u95ee\u9898\uff0c\u540e\u9762\u5c31\u6709\u4eba\u63d0\u51fa\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\uff08AVL \u6811\uff09\u3002</p> <p>\u4e3b\u8981\u662f\u5728\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u57fa\u7840\u4e0a\u589e\u52a0\u4e86\u4e00\u4e9b\u6761\u4ef6\u7ea6\u675f\uff1a\u6bcf\u4e2a\u8282\u70b9\u7684\u5de6\u5b50\u6811\u548c\u53f3\u5b50\u6811\u7684\u9ad8\u5ea6\u5dee\u4e0d\u80fd\u8d85\u8fc7 1\u3002\u4e5f\u5c31\u662f\u8bf4\u8282\u70b9\u7684\u5de6\u5b50\u6811\u548c\u53f3\u5b50\u6811\u4ecd\u7136\u4e3a\u5e73\u8861\u4e8c\u53c9\u6811\uff0c\u8fd9\u6837\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u4e00\u76f4\u7ef4\u6301\u5728 O(logn) \u3002</p> <p>\u4e0b\u56fe\u662f\u6bcf\u6b21\u63d2\u5165\u7684\u5143\u7d20\u90fd\u662f\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u4e2d\u6700\u5927\u7684\u5143\u7d20\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u5b83\u4f1a\u7ef4\u6301\u81ea\u5e73\u8861\uff1a</p> <p></p> <p>\u9664\u4e86\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\uff0c\u8fd8\u6709\u5f88\u591a\u81ea\u5e73\u8861\u7684\u4e8c\u53c9\u6811\uff0c\u6bd4\u5982\u7ea2\u9ed1\u6811\uff0c\u5b83\u4e5f\u662f\u901a\u8fc7\u4e00\u4e9b\u7ea6\u675f\u6761\u4ef6\u6765\u8fbe\u5230\u81ea\u5e73\u8861\uff0c\u4e0d\u8fc7\u7ea2\u9ed1\u6811\u7684\u7ea6\u675f\u6761\u4ef6\u6bd4\u8f83\u590d\u6742\uff0c\u4e0d\u662f\u672c\u7bc7\u7684\u91cd\u70b9\u91cd\u70b9\uff0c\u5927\u5bb6\u53ef\u4ee5\u770b\u300a\u6570\u636e\u7ed3\u6784\u300b\u76f8\u5173\u7684\u4e66\u7c4d\u6765\u4e86\u89e3\u7ea2\u9ed1\u6811\u7684\u7ea6\u675f\u6761\u4ef6\u3002</p> <p>\u4e0b\u9762\u662f\u7ea2\u9ed1\u6811\u63d2\u5165\u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u8fd9\u5de6\u65cb\u53f3\u65cb\u7684\u64cd\u4f5c\uff0c\u5c31\u662f\u4e3a\u4e86\u81ea\u5e73\u8861\u3002</p> <p></p> <p>\u4e0d\u7ba1\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u8fd8\u662f\u7ea2\u9ed1\u6811\uff0c\u90fd\u4f1a\u968f\u7740\u63d2\u5165\u7684\u5143\u7d20\u589e\u591a\uff0c\u800c\u5bfc\u81f4\u6811\u7684\u9ad8\u5ea6\u53d8\u9ad8\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\u591a\uff0c\u4f1a\u5f71\u54cd\u6574\u4f53\u6570\u636e\u67e5\u8be2\u7684\u6548\u7387\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u5e73\u8861\u4e8c\u53c9\u67e5\u627e\u6811\u7684\u9ad8\u5ea6\u4e3a 5\uff0c\u90a3\u4e48\u5728\u8bbf\u95ee\u6700\u5e95\u90e8\u7684\u8282\u70b9\u65f6\uff0c\u5c31\u9700\u8981\u78c1\u76d8 5 \u6b21 I/O \u64cd\u4f5c\u3002</p> <p></p> <p>\u6839\u672c\u539f\u56e0\u662f\u56e0\u4e3a\u5b83\u4eec\u90fd\u662f\u4e8c\u53c9\u6811\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u4fdd\u5b58 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u5982\u679c\u6211\u4eec\u628a\u4e8c\u53c9\u6811\u6539\u6210 M \u53c9\u6811\uff08M&gt;2\uff09\u5462\uff1f</p> <p>\u6bd4\u5982\uff0c\u5f53 M=3 \u65f6\uff0c\u5728\u540c\u6837\u7684\u8282\u70b9\u4e2a\u6570\u60c5\u51b5\u4e0b\uff0c\u4e09\u53c9\u6811\u6bd4\u4e8c\u53c9\u6811\u7684\u6811\u9ad8\u8981\u77ee\u3002</p> <p></p> <p>\u56e0\u6b64\uff0c\u5f53\u6811\u7684\u8282\u70b9\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u5e76\u4e14\u6811\u7684\u5206\u53c9\u6570 M \u8d8a\u5927\u7684\u65f6\u5019\uff0cM \u53c9\u6811\u7684\u9ad8\u5ea6\u4f1a\u8fdc\u5c0f\u4e8e\u4e8c\u53c9\u6811\u7684\u9ad8\u5ea6\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#b","title":"\u4ec0\u4e48\u662f B \u6811","text":"<p>\u81ea\u5e73\u8861\u4e8c\u53c9\u6811\u867d\u7136\u80fd\u4fdd\u6301\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5728 O(logn)\uff0c\u4f46\u662f\u56e0\u4e3a\u5b83\u672c\u8d28\u4e0a\u662f\u4e00\u4e2a\u4e8c\u53c9\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u6709 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u90a3\u4e48\u5f53\u8282\u70b9\u4e2a\u6570\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u6811\u7684\u9ad8\u5ea6\u4e5f\u4f1a\u76f8\u5e94\u53d8\u9ad8\uff0c\u8fd9\u6837\u5c31\u4f1a\u589e\u52a0\u78c1\u76d8\u7684 I/O \u6b21\u6570\uff0c\u4ece\u800c\u5f71\u54cd\u6570\u636e\u67e5\u8be2\u7684\u6548\u7387\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u964d\u4f4e\u6811\u7684\u9ad8\u5ea6\u7684\u95ee\u9898\uff0c\u540e\u9762\u5c31\u51fa\u6765\u4e86 B \u6811\uff0c\u5b83\u4e0d\u518d\u9650\u5236\u4e00\u4e2a\u8282\u70b9\u5c31\u53ea\u80fd\u6709 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u800c\u662f\u5141\u8bb8 M \u4e2a\u5b50\u8282\u70b9 (M&gt;2)\uff0c\u4ece\u800c\u964d\u4f4e\u6811\u7684\u9ad8\u5ea6\u3002</p> <p>B \u6811\u7684\u6bcf\u4e00\u4e2a\u8282\u70b9\u6700\u591a\u53ef\u4ee5\u5305\u62ec M \u4e2a\u5b50\u8282\u70b9\uff0cM \u79f0\u4e3a B \u6811\u7684\u9636\uff0c\u6240\u4ee5 B \u6811\u5c31\u662f\u4e00\u4e2a\u591a\u53c9\u6811\u3002</p> <p>\u5047\u8bbe M = 3\uff0c\u90a3\u4e48\u5c31\u662f\u4e00\u68f5 3 \u9636\u7684 B \u6811\uff0c\u7279\u70b9\u5c31\u662f\u6bcf\u4e2a\u8282\u70b9\u6700\u591a\u6709 2 \u4e2a\uff08M-1 \u4e2a\uff09\u6570\u636e\u548c\u6700\u591a\u6709 3 \u4e2a\uff08M \u4e2a\uff09\u5b50\u8282\u70b9\uff0c\u8d85\u8fc7\u8fd9\u4e9b\u8981\u6c42\u7684\u8bdd\uff0c\u5c31\u4f1a\u5206\u88c2\u8282\u70b9\uff0c\u6bd4\u5982\u4e0b\u9762\u7684\u7684\u52a8\u56fe\uff1a</p> <p></p> <p>\u6211\u4eec\u6765\u770b\u770b\u4e00\u68f5 3 \u9636\u7684 B \u6811\u7684\u67e5\u8be2\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f</p> <p></p> <p>\u5047\u8bbe\u6211\u4eec\u5728\u4e0a\u56fe\u4e00\u68f5 3 \u9636\u7684 B \u6811\u4e2d\u8981\u67e5\u627e\u7684\u7d22\u5f15\u503c\u662f 9 \u7684\u8bb0\u5f55\u90a3\u4e48\u6b65\u9aa4\u53ef\u4ee5\u5206\u4e3a\u4ee5\u4e0b\u51e0\u6b65\uff1a</p> <ol> <li>\u4e0e\u6839\u8282\u70b9\u7684\u7d22\u5f15 (4\uff0c8\uff09\u8fdb\u884c\u6bd4\u8f83\uff0c9 \u5927\u4e8e 8\uff0c\u90a3\u4e48\u5f80\u53f3\u8fb9\u7684\u5b50\u8282\u70b9\u8d70\uff1b</li> <li>\u7136\u540e\u8be5\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u4e3a\uff0810\uff0c12\uff09\uff0c\u56e0\u4e3a 9 \u5c0f\u4e8e 10\uff0c\u6240\u4ee5\u4f1a\u5f80\u8be5\u8282\u70b9\u7684\u5de6\u8fb9\u5b50\u8282\u70b9\u8d70\uff1b</li> <li>\u8d70\u5230\u7d22\u5f15\u4e3a 9 \u7684\u8282\u70b9\uff0c\u7136\u540e\u6211\u4eec\u627e\u5230\u4e86\u7d22\u5f15\u503c 9 \u7684\u8282\u70b9\u3002</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u68f5 3 \u9636\u7684 B \u6811\u5728\u67e5\u8be2\u53f6\u5b50\u8282\u70b9\u4e2d\u7684\u6570\u636e\u65f6\uff0c\u7531\u4e8e\u6811\u7684\u9ad8\u5ea6\u662f 3\uff0c\u6240\u4ee5\u5728\u67e5\u8be2\u8fc7\u7a0b\u4e2d\u4f1a\u53d1\u751f 3 \u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\u3002</p> <p>\u800c\u5982\u679c\u540c\u6837\u7684\u8282\u70b9\u6570\u91cf\u5728\u5e73\u8861\u4e8c\u53c9\u6811\u7684\u573a\u666f\u4e0b\uff0c\u6811\u7684\u9ad8\u5ea6\u5c31\u4f1a\u5f88\u9ad8\uff0c\u610f\u5473\u7740\u78c1\u76d8 I/O \u64cd\u4f5c\u4f1a\u66f4\u591a\u3002\u6240\u4ee5\uff0cB \u6811\u5728\u6570\u636e\u67e5\u8be2\u4e2d\u6bd4\u5e73\u8861\u4e8c\u53c9\u6811\u6548\u7387\u8981\u9ad8\u3002</p> <p>\u4f46\u662f B \u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u5305\u542b\u6570\u636e\uff08\u7d22\u5f15 + \u8bb0\u5f55\uff09\uff0c\u800c\u7528\u6237\u7684\u8bb0\u5f55\u6570\u636e\u7684\u5927\u5c0f\u5f88\u6709\u53ef\u80fd\u8fdc\u8fdc\u8d85\u8fc7\u4e86\u7d22\u5f15\u6570\u636e\uff0c\u8fd9\u5c31\u9700\u8981\u82b1\u8d39\u66f4\u591a\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\u6765\u8bfb\u5230\u300c\u6709\u7528\u7684\u7d22\u5f15\u6570\u636e\u300d\u3002</p> <p>\u800c\u4e14\uff0c\u5728\u6211\u4eec\u67e5\u8be2\u4f4d\u4e8e\u5e95\u5c42\u7684\u67d0\u4e2a\u8282\u70b9\uff08\u6bd4\u5982 A \u8bb0\u5f55\uff09\u8fc7\u7a0b\u4e2d\uff0c\u300c\u975e A \u8bb0\u5f55\u8282\u70b9\u300d\u91cc\u7684\u8bb0\u5f55\u6570\u636e\u4f1a\u4ece\u78c1\u76d8\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u4f46\u662f\u8fd9\u4e9b\u8bb0\u5f55\u6570\u636e\u662f\u6ca1\u7528\u7684\uff0c\u6211\u4eec\u53ea\u662f\u60f3\u8bfb\u53d6\u8fd9\u4e9b\u8282\u70b9\u7684\u7d22\u5f15\u6570\u636e\u6765\u505a\u6bd4\u8f83\u67e5\u8be2\uff0c\u800c\u300c\u975e A \u8bb0\u5f55\u8282\u70b9\u300d\u91cc\u7684\u8bb0\u5f55\u6570\u636e\u5bf9\u6211\u4eec\u662f\u6ca1\u7528\u7684\uff0c\u8fd9\u6837\u4e0d\u4ec5\u589e\u591a\u78c1\u76d8 I/O \u64cd\u4f5c\u6b21\u6570\uff0c\u4e5f\u5360\u7528\u5185\u5b58\u8d44\u6e90\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c\u4f7f\u7528 B \u6811\u6765\u505a\u8303\u56f4\u67e5\u8be2\u7684\u8bdd\uff0c\u9700\u8981\u4f7f\u7528\u4e2d\u5e8f\u904d\u5386\uff0c\u8fd9\u4f1a\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\u7684\u78c1\u76d8 I/O  \u95ee\u9898\uff0c\u4ece\u800c\u5bfc\u81f4\u6574\u4f53\u901f\u5ea6\u4e0b\u964d\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#b_1","title":"\u4ec0\u4e48\u662f B+ \u6811\uff1f","text":"<p>B+ \u6811\u5c31\u662f\u5bf9 B \u6811\u505a\u4e86\u4e00\u4e2a\u5347\u7ea7\uff0cMySQL \u4e2d\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u5c31\u662f\u91c7\u7528\u4e86 B+ \u6811\uff0cB+ \u6811\u7ed3\u6784\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>B+ \u6811\u4e0e B \u6811\u5dee\u5f02\u7684\u70b9\uff0c\u4e3b\u8981\u662f\u4ee5\u4e0b\u8fd9\u51e0\u70b9\uff1a</p> <ul> <li>\u53f6\u5b50\u8282\u70b9\uff08\u6700\u5e95\u90e8\u7684\u8282\u70b9\uff09\u624d\u4f1a\u5b58\u653e\u5b9e\u9645\u6570\u636e\uff08\u7d22\u5f15 + \u8bb0\u5f55\uff09\uff0c\u975e\u53f6\u5b50\u8282\u70b9\u53ea\u4f1a\u5b58\u653e\u7d22\u5f15\uff1b</li> <li>\u6240\u6709\u7d22\u5f15\u90fd\u4f1a\u5728\u53f6\u5b50\u8282\u70b9\u51fa\u73b0\uff0c\u53f6\u5b50\u8282\u70b9\u4e4b\u95f4\u6784\u6210\u4e00\u4e2a\u6709\u5e8f\u94fe\u8868\uff1b</li> <li>\u975e\u53f6\u5b50\u8282\u70b9\u7684\u7d22\u5f15\u4e5f\u4f1a\u540c\u65f6\u5b58\u5728\u5728\u5b50\u8282\u70b9\u4e2d\uff0c\u5e76\u4e14\u662f\u5728\u5b50\u8282\u70b9\u4e2d\u6240\u6709\u7d22\u5f15\u7684\u6700\u5927\uff08\u6216\u6700\u5c0f\uff09\u3002</li> <li>\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u6709\u591a\u5c11\u4e2a\u5b50\u8282\u70b9\uff0c\u5c31\u6709\u591a\u5c11\u4e2a\u7d22\u5f15\uff1b</li> </ul> <p>\u4e0b\u9762\u901a\u8fc7\u4e09\u4e2a\u65b9\u9762\uff0c\u6bd4\u8f83\u4e0b B+ \u548c B \u6811\u7684\u6027\u80fd\u533a\u522b\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#1","title":"1\u3001\u5355\u70b9\u67e5\u8be2","text":"<p>B \u6811\u8fdb\u884c\u5355\u4e2a\u7d22\u5f15\u67e5\u8be2\u65f6\uff0c\u6700\u5feb\u53ef\u4ee5\u5728 O(1) \u7684\u65f6\u95f4\u4ee3\u4ef7\u5185\u5c31\u67e5\u5230\uff0c\u800c\u4ece\u5e73\u5747\u65f6\u95f4\u4ee3\u4ef7\u6765\u770b\uff0c\u4f1a\u6bd4 B+ \u6811\u7a0d\u5feb\u4e00\u4e9b\u3002</p> <p>\u4f46\u662f B \u6811\u7684\u67e5\u8be2\u6ce2\u52a8\u4f1a\u6bd4\u8f83\u5927\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u8282\u70b9\u65e2\u5b58\u7d22\u5f15\u53c8\u5b58\u8bb0\u5f55\uff0c\u6240\u4ee5\u6709\u65f6\u5019\u8bbf\u95ee\u5230\u4e86\u975e\u53f6\u5b50\u8282\u70b9\u5c31\u53ef\u4ee5\u627e\u5230\u7d22\u5f15\uff0c\u800c\u6709\u65f6\u9700\u8981\u8bbf\u95ee\u5230\u53f6\u5b50\u8282\u70b9\u624d\u80fd\u627e\u5230\u7d22\u5f15\u3002</p> <p>B+ \u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e0d\u5b58\u653e\u5b9e\u9645\u7684\u8bb0\u5f55\u6570\u636e\uff0c\u4ec5\u5b58\u653e\u7d22\u5f15\uff0c\u56e0\u6b64\u6570\u636e\u91cf\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u76f8\u6bd4\u65e2\u5b58\u7d22\u5f15\u53c8\u5b58\u8bb0\u5f55\u7684 B \u6811\uff0cB+\u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u7d22\u5f15\uff0c\u56e0\u6b64 B+ \u6811\u53ef\u4ee5\u6bd4 B \u6811\u66f4\u300c\u77ee\u80d6\u300d\uff0c\u67e5\u8be2\u5e95\u5c42\u8282\u70b9\u7684\u78c1\u76d8 I/O \u6b21\u6570\u4f1a\u66f4\u5c11\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#2","title":"2\u3001\u63d2\u5165\u548c\u5220\u9664\u6548\u7387","text":"<p>B+ \u6811\u6709\u5927\u91cf\u7684\u5197\u4f59\u8282\u70b9\uff0c\u8fd9\u6837\u4f7f\u5f97\u5220\u9664\u4e00\u4e2a\u8282\u70b9\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u76f4\u63a5\u4ece\u53f6\u5b50\u8282\u70b9\u4e2d\u5220\u9664\uff0c\u751a\u81f3\u53ef\u4ee5\u4e0d\u52a8\u975e\u53f6\u5b50\u8282\u70b9\uff0c\u8fd9\u6837\u5220\u9664\u975e\u5e38\u5feb\uff0c</p> <p>\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B+ \u6811 0004 \u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u56e0\u4e3a\u975e\u53f6\u5b50\u8282\u70b9\u6709 0004 \u7684\u5197\u4f59\u8282\u70b9\uff0c\u6240\u4ee5\u5728\u5220\u9664\u7684\u65f6\u5019\uff0c\u6811\u5f62\u7ed3\u6784\u53d8\u5316\u5f88\u5c0f\uff1a</p> <p></p> <p>\u6ce8\u610f\uff0c\uff1aB+ \u6811\u5bf9\u4e8e\u975e\u53f6\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9\u548c\u7d22\u5f15\u7684\u4e2a\u6570\uff0c\u5b9a\u4e49\u65b9\u5f0f\u53ef\u80fd\u4f1a\u6709\u4e0d\u540c\uff0c\u6709\u7684\u662f\u8bf4\u975e\u53f6\u5b50\u8282\u70b9\u7684\u5b50\u8282\u70b9\u7684\u4e2a\u6570\u4e3a M \u9636\uff0c\u800c\u7d22\u5f15\u7684\u4e2a\u6570\u4e3a M-1\uff08\u8fd9\u4e2a\u662f\u7ef4\u57fa\u767e\u79d1\u91cc\u7684\u5b9a\u4e49\uff09\uff0c\u56e0\u6b64\u6211\u672c\u6587\u5173\u4e8e B+ \u6811\u7684\u52a8\u56fe\u90fd\u662f\u57fa\u4e8e\u8fd9\u4e2a\u3002\u4f46\u662f\u6211\u5728\u524d\u9762\u4ecb\u7ecd B+ \u6811\u4e0e B+ \u6811\u7684\u5dee\u5f02\u65f6\uff0c\u8bf4\u7684\u662f\u300c\u975e\u53f6\u5b50\u8282\u70b9\u4e2d\u6709\u591a\u5c11\u4e2a\u5b50\u8282\u70b9\uff0c\u5c31\u6709\u591a\u5c11\u4e2a\u7d22\u5f15\u300d\uff0c\u4e3b\u8981\u662f MySQL \u7528\u5230\u7684 B+ \u6811\u5c31\u662f\u8fd9\u4e2a\u7279\u6027\u3002</p> <p>\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B \u6811 0008 \u8282\u70b9\u7684\u8fc7\u7a0b\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6811\u7684\u590d\u6742\u53d8\u5316\uff1a</p> <p></p> <p>\u751a\u81f3\uff0cB+ \u6811\u5728\u5220\u9664\u6839\u8282\u70b9\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u5b58\u5728\u5197\u4f59\u7684\u8282\u70b9\uff0c\u6240\u4ee5\u4e0d\u4f1a\u53d1\u751f\u590d\u6742\u7684\u6811\u7684\u53d8\u5f62\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B+ \u6811\u6839\u8282\u70b9\u7684\u8fc7\u7a0b\uff1a</p> <p></p> <p>B \u6811\u5219\u4e0d\u540c\uff0cB \u6811\u6ca1\u6709\u5197\u4f59\u8282\u70b9\uff0c\u5220\u9664\u8282\u70b9\u7684\u65f6\u5019\u975e\u5e38\u590d\u6742\uff0c\u6bd4\u5982\u5220\u9664\u6839\u8282\u70b9\u4e2d\u7684\u6570\u636e\uff0c\u53ef\u80fd\u6d89\u53ca\u590d\u6742\u7684\u6811\u7684\u53d8\u5f62\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\u662f\u5220\u9664 B \u6811\u6839\u8282\u70b9\u7684\u8fc7\u7a0b\uff1a</p> <p></p> <p>B+ \u6811\u7684\u63d2\u5165\u4e5f\u662f\u4e00\u6837\uff0c\u6709\u5197\u4f59\u8282\u70b9\uff0c\u63d2\u5165\u53ef\u80fd\u5b58\u5728\u8282\u70b9\u7684\u5206\u88c2\uff08\u5982\u679c\u8282\u70b9\u9971\u548c\uff09\uff0c\u4f46\u662f\u6700\u591a\u53ea\u6d89\u53ca\u6811\u7684\u4e00\u6761\u8def\u5f84\u3002\u800c\u4e14 B+ \u6811\u4f1a\u81ea\u52a8\u5e73\u8861\uff0c\u4e0d\u9700\u8981\u50cf\u66f4\u591a\u590d\u6742\u7684\u7b97\u6cd5\uff0c\u7c7b\u4f3c\u7ea2\u9ed1\u6811\u7684\u65cb\u8f6c\u64cd\u4f5c\u7b49\u3002</p> <p>\u56e0\u6b64\uff0cB+ \u6811\u7684\u63d2\u5165\u548c\u5220\u9664\u6548\u7387\u66f4\u9ad8\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#3","title":"3\u3001\u8303\u56f4\u67e5\u8be2","text":"<p>B \u6811\u548c B+ \u6811\u7b49\u503c\u67e5\u8be2\u539f\u7406\u57fa\u672c\u4e00\u81f4\uff0c\u5148\u4ece\u6839\u8282\u70b9\u67e5\u627e\uff0c\u7136\u540e\u5bf9\u6bd4\u76ee\u6807\u6570\u636e\u7684\u8303\u56f4\uff0c\u6700\u540e\u9012\u5f52\u7684\u8fdb\u5165\u5b50\u8282\u70b9\u67e5\u627e\u3002</p> <p>\u56e0\u4e3a B+ \u6811\u6240\u6709\u53f6\u5b50\u8282\u70b9\u95f4\u8fd8\u6709\u4e00\u4e2a\u94fe\u8868\u8fdb\u884c\u8fde\u63a5\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5bf9\u8303\u56f4\u67e5\u627e\u975e\u5e38\u6709\u5e2e\u52a9\uff0c\u6bd4\u5982\u8bf4\u6211\u4eec\u60f3\u77e5\u9053 12 \u6708 1 \u65e5\u548c 12 \u6708 12 \u65e5\u4e4b\u95f4\u7684\u8ba2\u5355\uff0c\u8fd9\u4e2a\u65f6\u5019\u53ef\u4ee5\u5148\u67e5\u627e\u5230 12 \u6708 1 \u65e5\u6240\u5728\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u7136\u540e\u5229\u7528\u94fe\u8868\u5411\u53f3\u904d\u5386\uff0c\u76f4\u5230\u627e\u5230 12 \u6708 12 \u65e5\u7684\u8282\u70b9\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u4ece\u6839\u8282\u70b9\u67e5\u8be2\u4e86\uff0c\u8fdb\u4e00\u6b65\u8282\u7701\u67e5\u8be2\u9700\u8981\u7684\u65f6\u95f4\u3002</p> <p>\u800c B \u6811\u6ca1\u6709\u5c06\u6240\u6709\u53f6\u5b50\u8282\u70b9\u7528\u94fe\u8868\u4e32\u8054\u8d77\u6765\u7684\u7ed3\u6784\uff0c\u56e0\u6b64\u53ea\u80fd\u901a\u8fc7\u6811\u7684\u904d\u5386\u6765\u5b8c\u6210\u8303\u56f4\u67e5\u8be2\uff0c\u8fd9\u4f1a\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u8303\u56f4\u67e5\u8be2\u6548\u7387\u4e0d\u5982 B+ \u6811\u3002</p> <p>\u56e0\u6b64\uff0c\u5b58\u5728\u5927\u91cf\u8303\u56f4\u68c0\u7d22\u7684\u573a\u666f\uff0c\u9002\u5408\u4f7f\u7528 B+\u6811\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u3002\u800c\u5bf9\u4e8e\u5927\u91cf\u7684\u5355\u4e2a\u7d22\u5f15\u67e5\u8be2\u7684\u573a\u666f\uff0c\u53ef\u4ee5\u8003\u8651 B \u6811\uff0c\u6bd4\u5982 nosql \u7684 MongoDB\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#mysql-b_1","title":"MySQL \u4e2d\u7684 B+ \u6811","text":"<p>MySQL \u7684\u5b58\u50a8\u65b9\u5f0f\u6839\u636e\u5b58\u50a8\u5f15\u64ce\u7684\u4e0d\u540c\u800c\u4e0d\u540c\uff0c\u6211\u4eec\u6700\u5e38\u7528\u7684\u5c31\u662f Innodb \u5b58\u50a8\u5f15\u64ce\uff0c\u5b83\u5c31\u662f\u91c7\u7528\u4e86 B+ \u6811\u4f5c\u4e3a\u4e86\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u4e0b\u56fe\u5c31\u662f Innodb \u91cc\u7684 B+ \u6811\uff1a</p> <p></p> <p>\u4f46\u662f Innodb \u4f7f\u7528\u7684  B+ \u6811\u6709\u4e00\u4e9b\u7279\u522b\u7684\u70b9\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>B+ \u6811\u7684\u53f6\u5b50\u8282\u70b9\u4e4b\u95f4\u662f\u7528\u300c\u53cc\u5411\u94fe\u8868\u300d\u8fdb\u884c\u8fde\u63a5\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u65e2\u80fd\u5411\u53f3\u904d\u5386\uff0c\u4e5f\u80fd\u5411\u5de6\u904d\u5386\u3002</li> <li>B+ \u6811\u70b9\u8282\u70b9\u5185\u5bb9\u662f\u6570\u636e\u9875\uff0c\u6570\u636e\u9875\u91cc\u5b58\u653e\u4e86\u7528\u6237\u7684\u8bb0\u5f55\u4ee5\u53ca\u5404\u79cd\u4fe1\u606f\uff0c\u6bcf\u4e2a\u6570\u636e\u9875\u9ed8\u8ba4\u5927\u5c0f\u662f 16 KB\u3002</li> </ul> <p>Innodb \u6839\u636e\u7d22\u5f15\u7c7b\u578b\u4e0d\u540c\uff0c\u5206\u4e3a\u805a\u7c07\u548c\u4e8c\u7ea7\u7d22\u5f15\u3002\u4ed6\u4eec\u533a\u522b\u5728\u4e8e\uff0c\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u6240\u6709\u5b8c\u6574\u7684\u7528\u6237\u8bb0\u5f55\u90fd\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u5b58\u653e\u7684\u662f\u4e3b\u952e\u503c\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u6570\u636e\u3002</p> <p>\u56e0\u4e3a\u8868\u7684\u6570\u636e\u90fd\u662f\u5b58\u653e\u5728\u805a\u7c07\u7d22\u5f15\u7684\u53f6\u5b50\u8282\u70b9\u91cc\uff0c\u6240\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e00\u5b9a\u4f1a\u4e3a\u8868\u521b\u5efa\u4e00\u4e2a\u805a\u7c07\u7d22\u5f15\uff0c\u4e14\u7531\u4e8e\u6570\u636e\u5728\u7269\u7406\u4e0a\u53ea\u4f1a\u4fdd\u5b58\u4e00\u4efd\uff0c\u6240\u4ee5\u805a\u7c07\u7d22\u5f15\u53ea\u80fd\u6709\u4e00\u4e2a\uff0c\u800c\u4e8c\u7ea7\u7d22\u5f15\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u3002</p> <p>\u66f4\u591a\u5173\u4e8e Innodb \u7684 B+ \u6811\uff0c\u53ef\u4ee5\u770b\u6211\u4e4b\u524d\u5199\u7684\u8fd9\u7bc7\uff1a\u4ece\u6570\u636e\u9875\u7684\u89d2\u5ea6\u770b B+ \u6811\u3002</p>"},{"location":"mysql/index/why_index_chose_bpuls_tree/#_5","title":"\u603b\u7ed3","text":"<p>MySQL \u662f\u4f1a\u5c06\u6570\u636e\u6301\u4e45\u5316\u5728\u786c\u76d8\uff0c\u800c\u5b58\u50a8\u529f\u80fd\u662f\u7531 MySQL \u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u8ba8\u8bba MySQL \u4f7f\u7528\u54ea\u79cd\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a\u7d22\u5f15\uff0c\u5b9e\u9645\u4e0a\u662f\u5728\u8ba8\u8bba\u5b58\u50a8\u5f15\u64ce\u4f7f\u7528\u54ea\u79cd\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a\u7d22\u5f15\uff0cInnoDB \u662f MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce\uff0c\u5b83\u5c31\u662f\u91c7\u7528\u4e86 B+ \u6811\u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u8981\u8bbe\u8ba1\u4e00\u4e2a MySQL \u7684\u7d22\u5f15\u6570\u636e\u7ed3\u6784\uff0c\u4e0d\u4ec5\u4ec5\u8003\u8651\u6570\u636e\u7ed3\u6784\u589e\u5220\u6539\u7684\u65f6\u95f4\u590d\u6742\u5ea6\uff0c\u66f4\u91cd\u8981\u7684\u662f\u8981\u8003\u8651\u78c1\u76d8 I/0 \u7684\u64cd\u4f5c\u6b21\u6570\u3002\u56e0\u4e3a\u7d22\u5f15\u548c\u8bb0\u5f55\u90fd\u662f\u5b58\u653e\u5728\u786c\u76d8\uff0c\u786c\u76d8\u662f\u4e00\u4e2a\u975e\u5e38\u6162\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u6211\u4eec\u5728\u67e5\u8be2\u6570\u636e\u7684\u65f6\u5019\uff0c\u6700\u597d\u80fd\u5728\u5c3d\u53ef\u80fd\u5c11\u7684\u78c1\u76d8 I/0 \u7684\u64cd\u4f5c\u6b21\u6570\u5185\u5b8c\u6210\u3002</p> <p>\u4e8c\u5206\u67e5\u627e\u6811\u867d\u7136\u662f\u4e00\u4e2a\u5929\u7136\u7684\u4e8c\u5206\u7ed3\u6784\uff0c\u80fd\u5f88\u597d\u7684\u5229\u7528\u4e8c\u5206\u67e5\u627e\u5feb\u901f\u5b9a\u4f4d\u6570\u636e\uff0c\u4f46\u662f\u5b83\u5b58\u5728\u4e00\u79cd\u6781\u7aef\u7684\u60c5\u51b5\uff0c\u6bcf\u5f53\u63d2\u5165\u7684\u5143\u7d20\u90fd\u662f\u6811\u5185\u6700\u5927\u7684\u5143\u7d20\uff0c\u5c31\u4f1a\u5bfc\u81f4\u4e8c\u5206\u67e5\u627e\u6811\u9000\u5316\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u6b64\u65f6\u67e5\u8be2\u590d\u6742\u5ea6\u5c31\u4f1a\u4ece O(logn) \u964d\u4f4e\u4e3a O(n)\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4e8c\u5206\u67e5\u627e\u6811\u9000\u5316\u6210\u94fe\u8868\u7684\u95ee\u9898\uff0c\u5c31\u51fa\u73b0\u4e86\u81ea\u5e73\u8861\u4e8c\u53c9\u6811\uff0c\u4fdd\u8bc1\u4e86\u67e5\u8be2\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u5c31\u4f1a\u4e00\u76f4\u7ef4\u6301\u5728 O(logn) \u3002\u4f46\u662f\u5b83\u672c\u8d28\u4e0a\u8fd8\u662f\u4e00\u4e2a\u4e8c\u53c9\u6811\uff0c\u6bcf\u4e2a\u8282\u70b9\u53ea\u80fd\u6709 2 \u4e2a\u5b50\u8282\u70b9\uff0c\u968f\u7740\u5143\u7d20\u7684\u589e\u591a\uff0c\u6811\u7684\u9ad8\u5ea6\u4f1a\u8d8a\u6765\u8d8a\u9ad8\u3002</p> <p>\u800c\u6811\u7684\u9ad8\u5ea6\u51b3\u5b9a\u4e8e\u78c1\u76d8  I/O \u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u56e0\u4e3a\u6811\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\u7684\uff0c\u8bbf\u95ee\u6bcf\u4e2a\u8282\u70b9\uff0c\u90fd\u5bf9\u5e94\u4e00\u6b21\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4\u6811\u7684\u9ad8\u5ea6\u5c31\u7b49\u4e8e\u6bcf\u6b21\u67e5\u8be2\u6570\u636e\u65f6\u78c1\u76d8 IO \u64cd\u4f5c\u7684\u6b21\u6570\uff0c\u6240\u4ee5\u6811\u7684\u9ad8\u5ea6\u8d8a\u9ad8\uff0c\u5c31\u4f1a\u5f71\u54cd\u67e5\u8be2\u6027\u80fd\u3002</p> <p>B \u6811\u548c B+ \u90fd\u662f\u901a\u8fc7\u591a\u53c9\u6811\u7684\u65b9\u5f0f\uff0c\u4f1a\u5c06\u6811\u7684\u9ad8\u5ea6\u53d8\u77ee\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u6570\u636e\u7ed3\u6784\u975e\u5e38\u9002\u5408\u68c0\u7d22\u5b58\u4e8e\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u3002</p> <p>\u4f46\u662f MySQL \u9ed8\u8ba4\u7684\u5b58\u50a8\u5f15\u64ce InnoDB \u91c7\u7528\u7684\u662f B+ \u4f5c\u4e3a\u7d22\u5f15\u7684\u6570\u636e\u7ed3\u6784\uff0c\u539f\u56e0\u6709\uff1a</p> <ul> <li>B+ \u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u4e0d\u5b58\u653e\u5b9e\u9645\u7684\u8bb0\u5f55\u6570\u636e\uff0c\u4ec5\u5b58\u653e\u7d22\u5f15\uff0c\u56e0\u6b64\u6570\u636e\u91cf\u76f8\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u76f8\u6bd4\u65e2\u5b58\u7d22\u5f15\u53c8\u5b58\u8bb0\u5f55\u7684 B \u6811\uff0cB+\u6811\u7684\u975e\u53f6\u5b50\u8282\u70b9\u53ef\u4ee5\u5b58\u653e\u66f4\u591a\u7684\u7d22\u5f15\uff0c\u56e0\u6b64 B+ \u6811\u53ef\u4ee5\u6bd4 B \u6811\u66f4\u300c\u77ee\u80d6\u300d\uff0c\u67e5\u8be2\u5e95\u5c42\u8282\u70b9\u7684\u78c1\u76d8 I/O \u6b21\u6570\u4f1a\u66f4\u5c11\u3002</li> <li>B+ \u6811\u6709\u5927\u91cf\u7684\u5197\u4f59\u8282\u70b9\uff08\u6240\u6709\u975e\u53f6\u5b50\u8282\u70b9\u90fd\u662f\u5197\u4f59\u7d22\u5f15\uff09\uff0c\u8fd9\u4e9b\u5197\u4f59\u7d22\u5f15\u8ba9 B+ \u6811\u5728\u63d2\u5165\u3001\u5220\u9664\u7684\u6548\u7387\u90fd\u66f4\u9ad8\uff0c\u6bd4\u5982\u5220\u9664\u6839\u8282\u70b9\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u50cf B \u6811\u90a3\u6837\u4f1a\u53d1\u751f\u590d\u6742\u7684\u6811\u7684\u53d8\u5316\uff1b</li> <li>B+ \u6811\u53f6\u5b50\u8282\u70b9\u4e4b\u95f4\u7528\u94fe\u8868\u8fde\u63a5\u4e86\u8d77\u6765\uff0c\u6709\u5229\u4e8e\u8303\u56f4\u67e5\u8be2\uff0c\u800c B \u6811\u8981\u5b9e\u73b0\u8303\u56f4\u67e5\u8be2\uff0c\u56e0\u6b64\u53ea\u80fd\u901a\u8fc7\u6811\u7684\u904d\u5386\u6765\u5b8c\u6210\u8303\u56f4\u67e5\u8be2\uff0c\u8fd9\u4f1a\u6d89\u53ca\u591a\u4e2a\u8282\u70b9\u7684\u78c1\u76d8 I/O \u64cd\u4f5c\uff0c\u8303\u56f4\u67e5\u8be2\u6548\u7387\u4e0d\u5982 B+ \u6811\u3002</li> </ul> <p>\u5b8c\uff01</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/lock/deadlock/","title":"MySQL \u6b7b\u9501\u4e86\uff0c\u600e\u4e48\u529e\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u8bf4\u4e2a\u5f88\u65e9\u4e4b\u524d\u81ea\u5df1\u9047\u5230\u8fc7\u6570\u636e\u5e93\u6b7b\u9501\u95ee\u9898\u3002</p> <p>\u6709\u4e2a\u4e1a\u52a1\u4e3b\u8981\u903b\u8f91\u5c31\u662f\u65b0\u589e\u8ba2\u5355\u3001\u4fee\u6539\u8ba2\u5355\u3001\u67e5\u8be2\u8ba2\u5355\u7b49\u64cd\u4f5c\u3002\u7136\u540e\u56e0\u4e3a\u8ba2\u5355\u662f\u4e0d\u80fd\u91cd\u590d\u7684\uff0c\u6240\u4ee5\u5f53\u65f6\u5728\u65b0\u589e\u8ba2\u5355\u7684\u65f6\u5019\u505a\u4e86\u5e42\u7b49\u6027\u6821\u9a8c\uff0c\u505a\u6cd5\u5c31\u662f\u5728\u65b0\u589e\u8ba2\u5355\u8bb0\u5f55\u4e4b\u524d\uff0c\u5148\u901a\u8fc7 <code>select ... for update</code> \u8bed\u53e5\u67e5\u8be2\u8ba2\u5355\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u624d\u63d2\u5165\u8ba2\u5355\u8bb0\u5f55\u3002</p> <p>\u800c\u6b63\u662f\u56e0\u4e3a\u8fd9\u6837\u7684\u64cd\u4f5c\uff0c\u5f53\u4e1a\u52a1\u91cf\u5f88\u5927\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u73b0\u6b7b\u9501\u3002</p> <p>\u63a5\u4e0b\u6765\u8ddf\u5927\u5bb6\u804a\u4e0b\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u6b7b\u9501\uff0c\u4ee5\u53ca\u600e\u4e48\u907f\u514d\u6b7b\u9501\u3002</p>"},{"location":"mysql/lock/deadlock/#_1","title":"\u6b7b\u9501\u7684\u53d1\u751f","text":"<p>\u672c\u6b21\u6848\u4f8b\u4f7f\u7528\u5b58\u50a8\u5f15\u64ce Innodb\uff0c\u9694\u79bb\u7ea7\u522b\u4e3a\u53ef\u91cd\u590d\u8bfb\uff08RR\uff09\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u7528\u5b9e\u6218\u7684\u65b9\u5f0f\u6765\u5e26\u5927\u5bb6\u770b\u770b\u6b7b\u9501\u662f\u600e\u4e48\u53d1\u751f\u7684\u3002</p> <p>\u6211\u5efa\u4e86\u4e00\u5f20\u8ba2\u5355\u8868\uff0c\u5176\u4e2d id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\uff0corder_no \u5b57\u6bb5\u666e\u901a\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u975e\u552f\u4e00\u7d22\u5f15\uff1a</p> SQL<pre><code>CREATE TABLE `t_order` (\n  `id` int NOT NULL AUTO_INCREMENT,\n  `order_no` int DEFAULT NULL,\n  `create_date` datetime DEFAULT NULL,\n  PRIMARY KEY (`id`),\n  KEY `index_order` (`order_no`) USING BTREE\n) ENGINE=InnoDB ;\n</code></pre> <p>\u7136\u540e\uff0c\u5148 <code>t_order</code> \u8868\u91cc\u73b0\u5728\u5df2\u7ecf\u6709\u4e86 6 \u6761\u8bb0\u5f55\uff1a</p> <p></p> <p>\u5047\u8bbe\u8fd9\u65f6\u6709\u4e24\u4e8b\u52a1\uff0c\u4e00\u4e2a\u4e8b\u52a1\u8981\u63d2\u5165\u8ba2\u5355 1007\uff0c\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u8981\u63d2\u5165\u8ba2\u5355 1008\uff0c\u56e0\u4e3a\u9700\u8981\u5bf9\u8ba2\u5355\u505a\u5e42\u7b49\u6027\u6821\u9a8c\uff0c\u6240\u4ee5\u4e24\u4e2a\u4e8b\u52a1\u5148\u8981\u67e5\u8be2\u8be5\u8ba2\u5355\u662f\u5426\u5b58\u5728\uff0c\u4e0d\u5b58\u5728\u624d\u63d2\u5165\u8bb0\u5f55\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e24\u4e2a\u4e8b\u52a1\u90fd\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\uff08\u524d\u63d0\u6ca1\u6709\u6253\u5f00\u6b7b\u9501\u68c0\u6d4b\uff09\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u4e86\u6b7b\u9501\uff0c\u56e0\u4e3a\u90fd\u5728\u76f8\u4e92\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\u3002</p> <p>\u8fd9\u91cc\u5728\u67e5\u8be2\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u4e86 <code>select ... for update</code> \u8bed\u53e5\uff0c\u76ee\u7684\u4e3a\u4e86\u9632\u6b62\u4e8b\u52a1\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u8bb0\u5f55\uff0c\u800c\u51fa\u73b0\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u4f7f\u7528 <code>select ... for update</code> \u8bed\u53e5\uff0c\u800c\u4f7f\u7528\u4e86\u5355\u7eaf\u7684 select \u8bed\u53e5\uff0c\u5982\u679c\u662f\u4e24\u4e2a\u8ba2\u5355\u53f7\u4e00\u6837\u7684\u8bf7\u6c42\u540c\u65f6\u8fdb\u6765\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e24\u4e2a\u91cd\u590d\u7684\u8ba2\u5355\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u5e7b\u8bfb\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"mysql/lock/deadlock/#_2","title":"\u4e3a\u4ec0\u4e48\u4f1a\u4ea7\u751f\u6b7b\u9501\uff1f","text":"<p>\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u662f\u5b58\u5728\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</p> <p>Innodb \u5f15\u64ce\u4e3a\u4e86\u89e3\u51b3\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\u7684\u5e7b\u8bfb\u95ee\u9898\uff0c\u5c31\u5f15\u51fa\u4e86 next-key \u9501\uff0c\u5b83\u662f\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7684\u7ec4\u5408\u3002</p> <ul> <li>Record Lock\uff0c\u8bb0\u5f55\u9501\uff0c\u9501\u7684\u662f\u8bb0\u5f55\u672c\u8eab\uff1b</li> <li>Gap Lock\uff0c\u95f4\u9699\u9501\uff0c\u9501\u7684\u5c31\u662f\u4e24\u4e2a\u503c\u4e4b\u95f4\u7684\u7a7a\u9699\uff0c\u4ee5\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u7a7a\u9699\u95f4\u63d2\u5165\u65b0\u7684\u6570\u636e\uff0c\u4ece\u800c\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u3002</li> </ul> <p>\u666e\u901a\u7684 select \u8bed\u53e5\u662f\u4e0d\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u9501\u7684\uff0c\u56e0\u4e3a\u5b83\u662f\u901a\u8fc7 MVCC \u7684\u673a\u5236\u5b9e\u73b0\u7684\u5feb\u7167\u8bfb\uff0c\u5982\u679c\u8981\u5728\u67e5\u8be2\u65f6\u5bf9\u8bb0\u5f55\u52a0\u884c\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u5f0f\uff1a</p> SQL<pre><code>begin;\n//\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501\nselect ... lock in share mode;\ncommit; //\u9501\u91ca\u653e\n\nbegin;\n//\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u6392\u4ed6\u9501\nselect ... for update;\ncommit; //\u9501\u91ca\u653e\n</code></pre> <p>\u884c\u9501\u7684\u91ca\u653e\u65f6\u673a\u662f\u5728\u4e8b\u52a1\u63d0\u4ea4\uff08commit\uff09\u540e\uff0c\u9501\u5c31\u4f1a\u88ab\u91ca\u653e\uff0c\u5e76\u4e0d\u662f\u4e00\u6761\u8bed\u53e5\u6267\u884c\u5b8c\u5c31\u91ca\u653e\u884c\u9501\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u4e8b\u52a1 A \u67e5\u8be2\u8bed\u53e5\u4f1a\u9501\u4f4f <code>(2, +\u221e]</code> \u8303\u56f4\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u671f\u95f4\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u9501\u4f4f\u7684\u8303\u56f4\u63d2\u5165\u6570\u636e\u5c31\u4f1a\u88ab\u963b\u585e\u3002</p> <p></p> <p>next-key \u9501\u7684\u52a0\u9501\u89c4\u5219\u5176\u5b9e\u633a\u590d\u6742\u7684\uff0c\u5728\u4e00\u4e9b\u573a\u666f\u4e0b\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u95f4\u9699\u9501\uff0c\u6211\u4e4b\u524d\u4e5f\u5199\u4e00\u7bc7\u52a0\u9501\u89c4\u5219\uff0c\u8be6\u7ec6\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1aMySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c update \u8bed\u53e5\u7684 where \u6761\u4ef6\u6ca1\u6709\u7528\u5230\u7d22\u5f15\u5217\uff0c\u90a3\u4e48\u5c31\u4f1a\u5168\u8868\u626b\u63cf\uff0c\u5728\u4e00\u884c\u884c\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4ec5\u7ed9\u884c\u8bb0\u5f55\u52a0\u4e0a\u4e86\u884c\u9501\uff0c\u8fd8\u7ed9\u884c\u8bb0\u5f55\u4e24\u8fb9\u7684\u7a7a\u9699\u4e5f\u52a0\u4e0a\u4e86\u95f4\u9699\u9501\uff0c\u76f8\u5f53\u4e8e\u9501\u4f4f\u6574\u4e2a\u8868\uff0c\u7136\u540e\u76f4\u5230\u4e8b\u52a1\u7ed3\u675f\u624d\u4f1a\u91ca\u653e\u9501\u3002</p> <p>\u6240\u4ee5\u5728\u7ebf\u4e0a\u5343\u4e07\u4e0d\u8981\u6267\u884c\u6ca1\u6709\u5e26\u7d22\u5f15\u6761\u4ef6\u7684 update \u8bed\u53e5\uff0c\u4e0d\u7136\u4f1a\u9020\u6210\u4e1a\u52a1\u505c\u6ede\uff0c\u6211\u6709\u4e2a\u8bfb\u8005\u5c31\u56e0\u4e3a\u5e72\u4e86\u8fd9\u4e2a\u4e8b\u60c5\uff0c\u7136\u540e\u88ab\u8001\u677f\u6559\u80b2\u4e86\u4e00\u6ce2\uff0c\u8be6\u7ec6\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1aupdate \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868\uff1f</p> <p>\u56de\u5230\u524d\u9762\u6b7b\u9501\u7684\u4f8b\u5b50\u3002</p> <p></p> <p>\u4e8b\u52a1 A \u5728\u6267\u884c\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff1a</p> SQL<pre><code>select id from t_order where order_no = 1007 for update;\n</code></pre> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b</li> <li>\u884c\u9501\uff1aX \u7c7b\u578b\u7684 next-key \u9501\uff1b</li> </ul> <p>\u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u884c\u9501\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\uff0c\u901a\u8fc7 LOCK_MODE \u53ef\u4ee5\u786e\u8ba4\u662f next-key \u9501\uff0c\u8fd8\u662f\u95f4\u9699\u9501\uff0c\u8fd8\u662f\u8bb0\u5f55\u9501\uff1a</p> <ul> <li>\u5982\u679c LOCK_MODE \u4e3a <code>X</code>\uff0c\u8bf4\u660e\u662f X \u578b\u7684 next-key \u9501\uff1b</li> <li>\u5982\u679c LOCK_MODE \u4e3a <code>X, REC_NOT_GAP</code>\uff0c\u8bf4\u660e\u662f X \u578b\u7684\u8bb0\u5f55\u9501\uff1b</li> <li>\u5982\u679c LOCK_MODE \u4e3a <code>X, GAP</code>\uff0c\u8bf4\u660e\u662f X \u578b\u7684\u95f4\u9699\u9501\uff1b</li> </ul> <p>\u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e8c\u7ea7\u7d22\u5f15\uff08INDEX_NAME : index_order\uff09\u4e0a\u52a0\u7684\u662f X \u578b\u7684 next-key \u9501\uff0c\u9501\u8303\u56f4\u662f<code>(1006, +\u221e]</code>\u3002</p> <p>next-key \u9501\u7684\u8303\u56f4 (1006, +\u221e]\uff0c\u662f\u600e\u4e48\u786e\u5b9a\u7684\uff1f</p> <p>\u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u6700\u53f3\u503c\uff0c\u6b64\u6b21\u7684\u4e8b\u52a1 A \u7684 LOCK_DATA \u662f supremum pseudo-record\uff0c\u8868\u793a\u7684\u662f +\u221e\u3002\u7136\u540e\u9501\u8303\u56f4\u7684\u6700\u5de6\u503c\u662f t_order \u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684 index_order \u7684\u503c\uff0c\u4e5f\u5c31\u662f 1006\u3002\u56e0\u6b64\uff0cnext-key \u9501\u7684\u8303\u56f4 (1006, +\u221e]\u3002</p> <p>::: tip</p> <p>\u6709\u7684\u8bfb\u8005\u95ee\uff0cMySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f\u8fd9\u7bc7\u6587\u7ae0\u8bb2\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u8bf4\u300c\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u65f6\uff0c\u52a0 next-key lock\uff0c\u7136\u540e\u4f1a\u9000\u5316\u4e3a\u95f4\u9699\u9501\u300d\u3002\u4e3a\u4ec0\u4e48\u4e0a\u9762\u4e8b\u52a1 A \u7684 next-key lock \u5e76\u6ca1\u6709\u9000\u5316\u4e3a\u95f4\u9699\u9501\uff1f</p> <p>\u5982\u679c\u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684 order_no \u4e3a 1005\uff0c\u90a3\u4e48\u7b49\u503c\u67e5\u8be2 order_no =  1006\uff08\u4e0d\u5b58\u5728\uff09\uff0c\u5c31\u662f next key lock\uff0c\u5982\u4e0a\u9762\u4e8b\u52a1 A \u7684\u60c5\u51b5\u3002</p> <p>\u5982\u679c\u8868\u4e2d\u6700\u540e\u4e00\u4e2a\u8bb0\u5f55\u7684 order_no \u4e3a 1010\uff0c\u90a3\u4e48\u7b49\u503c\u67e5\u8be2  order_no = 1006\uff08\u4e0d\u5b58\u5728\uff09\uff0c\u5c31\u662f\u95f4\u9699\u9501\uff0c\u6bd4\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>:::</p> <p>\u5f53\u4e8b\u52a1 B \u5f80\u4e8b\u52a1 A  next-key \u9501\u7684\u8303\u56f4 (1006, +\u221e] \u91cc\u63d2\u5165 id = 1008 \u7684\u8bb0\u5f55\u5c31\u4f1a\u88ab\u9501\u4f4f\uff1a</p> SQL<pre><code>Insert into t_order (order_no, create_date) values (1008, now());\n</code></pre> <p>\u56e0\u4e3a\u5f53\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u63d2\u5165\u8bed\u53e5\u65f6\uff0c\u4f1a\u5728\u63d2\u5165\u95f4\u9699\u4e0a\u83b7\u53d6\u63d2\u5165\u610f\u5411\u9501\uff0c\u800c\u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5f53\u5176\u5b83\u4e8b\u52a1\u6301\u6709\u8be5\u95f4\u9699\u7684\u95f4\u9699\u9501\u65f6\uff0c\u9700\u8981\u7b49\u5f85\u5176\u5b83\u4e8b\u52a1\u91ca\u653e\u95f4\u9699\u9501\u4e4b\u540e\uff0c\u624d\u80fd\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\u3002\u800c\u95f4\u9699\u9501\u4e0e\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u6240\u4ee5\u6240\u4ee5\u4e24\u4e2a\u4e8b\u52a1\u4e2d <code>select ... for update</code> \u8bed\u53e5\u5e76\u4e0d\u4f1a\u76f8\u4e92\u5f71\u54cd\u3002</p> <p>\u6848\u4f8b\u4e2d\u7684\u4e8b\u52a1 A \u548c\u4e8b\u52a1 B \u5728\u6267\u884c\u5b8c\u540e <code>select ... for update</code> \u8bed\u53e5\u540e\u90fd\u6301\u6709\u8303\u56f4\u4e3a<code>(1006,+\u221e]</code>\u7684 next-key \u9501\uff0c\u800c\u63a5\u4e0b\u6765\u7684\u63d2\u5165\u64cd\u4f5c\u4e3a\u4e86\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u91ca\u653e\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u5faa\u73af\u7b49\u5f85\uff0c\u5bfc\u81f4\u6b7b\u9501\u3002</p> <p>\u4e3a\u4ec0\u4e48\u95f4\u9699\u9501\u4e0e\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff1f</p> <p>\u5728 MySQL \u5b98\u7f51\u4e0a\u8fd8\u6709\u4e00\u6bb5\u975e\u5e38\u5173\u952e\u7684\u63cf\u8ff0\uff1a</p> <p>Gap locks in InnoDB are \u201cpurely inhibitive\u201d, which means that their only purpose is to prevent other transactions from Inserting to the gap. Gap locks can co-exist. A gap lock taken by one transaction does not prevent another transaction from taking a gap lock on the same gap. There is no difference between shared and exclusive gap locks. They do not conflict with each other, and they perform the same function.</p> <p>\u95f4\u9699\u9501\u7684\u610f\u4e49\u53ea\u5728\u4e8e\u963b\u6b62\u533a\u95f4\u88ab\u63d2\u5165\uff0c\u56e0\u6b64\u662f\u53ef\u4ee5\u5171\u5b58\u7684\u3002\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u7684\u95f4\u9699\u9501\u4e0d\u4f1a\u963b\u6b62\u53e6\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u540c\u4e00\u4e2a\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501\uff0c\u5171\u4eab\u548c\u6392\u4ed6\u7684\u95f4\u9699\u9501\u662f\u6ca1\u6709\u533a\u522b\u7684\uff0c\u4ed6\u4eec\u76f8\u4e92\u4e0d\u51b2\u7a81\uff0c\u4e14\u529f\u80fd\u76f8\u540c\uff0c\u5373\u4e24\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5305\u542b\u5171\u540c\u95f4\u9699\u7684\u95f4\u9699\u9501\u3002</p> <p>\u8fd9\u91cc\u7684\u5171\u540c\u95f4\u9699\u5305\u62ec\u4e24\u79cd\u573a\u666f\uff1a</p> <ul> <li>\u5176\u4e00\u662f\u4e24\u4e2a\u95f4\u9699\u9501\u7684\u95f4\u9699\u533a\u95f4\u5b8c\u5168\u4e00\u6837\uff1b</li> <li>\u5176\u4e8c\u662f\u4e00\u4e2a\u95f4\u9699\u9501\u5305\u542b\u7684\u95f4\u9699\u533a\u95f4\u662f\u53e6\u4e00\u4e2a\u95f4\u9699\u9501\u5305\u542b\u95f4\u9699\u533a\u95f4\u7684\u5b50\u96c6\u3002</li> </ul> <p>\u4f46\u662f\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff0cnext-key lock \u662f\u5305\u542b\u95f4\u9699\u9501 + \u8bb0\u5f55\u9501\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684\u3002</p> <p>\u6bd4\u5982\uff0c\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e86\u8303\u56f4\u4e3a (1, 10] \u7684 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u867d\u7136\u76f8\u540c\u8303\u56f4\u7684\u95f4\u9699\u9501\u662f\u591a\u4e2a\u4e8b\u52a1\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4f46\u5bf9\u4e8e\u8bb0\u5f55\u9501\uff0c\u6211\u4eec\u662f\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\u3002X \u578b\u7684\u8bb0\u5f55\u9501\u4e0e X \u578b\u7684\u8bb0\u5f55\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6bd4\u5982\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e86 select ... where id = 1 for update\uff0c\u540e\u4e00\u4e2a\u4e8b\u52a1\u5728\u6267\u884c\u8fd9\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u7684\u3002</p> <p>\u4f46\u662f\u8fd8\u8981\u6ce8\u610f\uff01\u5bf9\u4e8e\u8fd9\u79cd\u8303\u56f4\u4e3a (1006, +\u221e] \u7684 next-key lock\uff0c\u4e24\u4e2a\u4e8b\u52a1\u662f\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u7684\uff0c\u4e0d\u4f1a\u51b2\u7a81\u3002\u56e0\u4e3a +\u221e \u5e76\u4e0d\u662f\u4e00\u4e2a\u771f\u5b9e\u7684\u8bb0\u5f55\uff0c\u81ea\u7136\u5c31\u4e0d\u9700\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\u3002</p> <p>\u63d2\u5165\u610f\u5411\u9501\u662f\u4ec0\u4e48\uff1f</p> <p>\u6ce8\u610f\uff01\u63d2\u5165\u610f\u5411\u9501\u540d\u5b57\u867d\u7136\u6709\u610f\u5411\u9501\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u662f\u610f\u5411\u9501\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002</p> <p>\u5728 MySQL \u7684\u5b98\u65b9\u6587\u6863\u4e2d\u6709\u4ee5\u4e0b\u91cd\u8981\u63cf\u8ff0\uff1a</p> <p>An Insert intention lock is a type of gap lock set by Insert operations prior to row Insertion. This lock signals the intent to Insert in such a way that multiple transactions Inserting into the same index gap need not wait for each other if they are not Inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to Insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with Insert intention locks prior to obtaining the exclusive lock on the Inserted row, but do not block each other because the rows are nonconflicting.</p> <p>\u8fd9\u6bb5\u8bdd\u8868\u660e\u5c3d\u7ba1\u63d2\u5165\u610f\u5411\u9501\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u4f46\u4e0d\u540c\u4e8e\u95f4\u9699\u9501\u7684\u662f\uff0c\u8be5\u9501\u53ea\u7528\u4e8e\u5e76\u53d1\u63d2\u5165\u64cd\u4f5c\u3002</p> <p>\u5982\u679c\u8bf4\u95f4\u9699\u9501\u9501\u4f4f\u7684\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u9501\u4f4f\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u3002\u56e0\u800c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0c\u63d2\u5165\u610f\u5411\u9501\u786e\u5b9e\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002</p> <p>\u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u7684\u53e6\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5dee\u522b\u662f\uff1a\u5c3d\u7ba1\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u4e5f\u5c5e\u4e8e\u95f4\u9699\u9501\uff0c\u4f46\u4e24\u4e2a\u4e8b\u52a1\u5374\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u4e00\u4e2a\u62e5\u6709\u95f4\u9699\u9501\uff0c\u53e6\u4e00\u4e2a\u62e5\u6709\u8be5\u95f4\u9699\u533a\u95f4\u5185\u7684\u63d2\u5165\u610f\u5411\u9501\uff08\u5f53\u7136\uff0c\u63d2\u5165\u610f\u5411\u9501\u5982\u679c\u4e0d\u5728\u95f4\u9699\u9501\u533a\u95f4\u5185\u5219\u662f\u53ef\u4ee5\u7684\uff09\u3002</p> <p>\u53e6\u5916\uff0c\u6211\u8865\u5145\u4e00\u70b9\uff0c\u63d2\u5165\u610f\u5411\u9501\u7684\u751f\u6210\u65f6\u673a\uff1a</p> <ul> <li>\u6bcf\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u9700\u8981\u770b\u4e00\u4e0b\u5f85\u63d2\u5165\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0a\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u4e86\u95f4\u9699\u9501\uff0c\u5982\u679c\u5df2\u52a0\u95f4\u9699\u9501\uff0c\u6b64\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff09\uff0c\u73b0\u8c61\u5c31\u662f Insert \u8bed\u53e5\u4f1a\u88ab\u963b\u585e\u3002</li> </ul>"},{"location":"mysql/lock/deadlock/#insert","title":"Insert \u8bed\u53e5\u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff1f","text":"<p>Insert \u8bed\u53e5\u5728\u6b63\u5e38\u6267\u884c\u65f6\u662f\u4e0d\u4f1a\u751f\u6210\u9501\u7ed3\u6784\u7684\uff0c\u5b83\u662f\u9760\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u81ea\u5e26\u7684 trx_id \u9690\u85cf\u5217\u6765\u4f5c\u4e3a\u9690\u5f0f\u9501\u6765\u4fdd\u62a4\u8bb0\u5f55\u7684\u3002</p> <p>\u4ec0\u4e48\u662f\u9690\u5f0f\u9501\uff1f</p> <p>\u5f53\u4e8b\u52a1\u9700\u8981\u52a0\u9501\u7684\u65f6\uff0c\u5982\u679c\u8fd9\u4e2a\u9501\u4e0d\u53ef\u80fd\u53d1\u751f\u51b2\u7a81\uff0cInnoDB \u4f1a\u8df3\u8fc7\u52a0\u9501\u73af\u8282\uff0c\u8fd9\u79cd\u673a\u5236\u79f0\u4e3a\u9690\u5f0f\u9501\u3002\u9690\u5f0f\u9501\u662f InnoDB \u5b9e\u73b0\u7684\u4e00\u79cd\u5ef6\u8fdf\u52a0\u9501\u673a\u5236\uff0c\u5176\u7279\u70b9\u662f\u53ea\u6709\u5728\u53ef\u80fd\u53d1\u751f\u51b2\u7a81\u65f6\u624d\u52a0\u9501\uff0c\u4ece\u800c\u51cf\u5c11\u4e86\u9501\u7684\u6570\u91cf\uff0c\u63d0\u9ad8\u4e86\u7cfb\u7edf\u6574\u4f53\u6027\u80fd\u3002</p> <p>\u9690\u5f0f\u9501\u5c31\u662f\u5728 Insert \u8fc7\u7a0b\u4e2d\u4e0d\u52a0\u9501\uff0c\u53ea\u6709\u5728\u7279\u6b8a\u60c5\u51b5\u4e0b\uff0c\u624d\u4f1a\u5c06\u9690\u5f0f\u9501\u8f6c\u6362\u4e3a\u663e\u5f0f\u9501\uff0c\u8fd9\u91cc\u6211\u4eec\u5217\u4e3e\u4e24\u4e2a\u573a\u666f\u3002</p> <ul> <li>\u5982\u679c\u8bb0\u5f55\u4e4b\u95f4\u52a0\u6709\u95f4\u9699\u9501\uff0c\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\uff0c\u6b64\u65f6\u662f\u4e0d\u80fd\u63d2\u5165\u8bb0\u5f55\u7684\uff1b</li> <li>\u5982\u679c Insert \u7684\u8bb0\u5f55\u548c\u5df2\u6709\u8bb0\u5f55\u5b58\u5728\u552f\u4e00\u952e\u51b2\u7a81\uff0c\u6b64\u65f6\u4e5f\u4e0d\u80fd\u63d2\u5165\u8bb0\u5f55\uff1b</li> </ul>"},{"location":"mysql/lock/deadlock/#1","title":"1\u3001\u8bb0\u5f55\u4e4b\u95f4\u52a0\u6709\u95f4\u9699\u9501","text":"<p>\u6bcf\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u9700\u8981\u770b\u4e00\u4e0b\u5f85\u63d2\u5165\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0a\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u4e86\u95f4\u9699\u9501\uff0c\u5982\u679c\u5df2\u52a0\u95f4\u9699\u9501\uff0c\u6b64\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff09\uff0c\u73b0\u8c61\u5c31\u662f Insert \u8bed\u53e5\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u73b0\u5728 t_order \u8868\u4e2d\uff0c\u53ea\u6709\u8fd9\u4e9b\u6570\u636e\uff0corder_no \u662f\u4e8c\u7ea7\u7d22\u5f15\u3002</p> <p></p> <p>\u73b0\u5728\uff0c\u4e8b\u52a1 A \u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\u3002</p> SQL<pre><code># \u4e8b\u52a1 A\nmysql&gt; begin;\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql&gt; select * from t_order where order_no = 1006 for update;\nEmpty set (0.01 sec)\n</code></pre> <p>\u63a5\u7740\uff0c\u6211\u4eec\u6267\u884c <code>select * from performance_schema.data_locks\\G;</code> \u8bed\u53e5\uff0c\u786e\u5b9a\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002</p> <p></p> <p>\u672c\u6b21\u7684\u4f8b\u5b50\u52a0\u7684\u662f next-key \u9501\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\uff0c\u9501\u8303\u56f4\u662f<code>\uff081005, +\u221e]</code>\u3002</p> <p>\u7136\u540e\uff0c\u6709\u4e2a\u4e8b\u52a1 B \u5728\u8fd9\u4e2a\u95f4\u9699\u9501\u4e2d\uff0c\u63d2\u5165\u4e86\u4e00\u4e2a\u8bb0\u5f55\uff0c\u90a3\u4e48\u6b64\u65f6\u8be5\u4e8b\u52a1 B \u5c31\u4f1a\u88ab\u963b\u585e\uff1a</p> SQL<pre><code># \u4e8b\u52a1 B \u63d2\u5165\u4e00\u6761\u8bb0\u5f55\nmysql&gt; begin;\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql&gt; insert into t_order(order_no, create_date) values(1010,now());\n### \u963b\u585e\u72b6\u6001\u3002\u3002\u3002\u3002\n</code></pre> <p>\u63a5\u7740\uff0c\u6211\u4eec\u6267\u884c <code>select * from performance_schema.data_locks\\G;</code> \u8bed\u53e5\uff0c\u786e\u5b9a\u4e8b\u52a1 B \u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 B \u7684\u72b6\u6001\u4e3a\u7b49\u5f85\u72b6\u6001\uff08LOCK_STATUS: WAITING\uff09\uff0c\u56e0\u4e3a\u5411\u4e8b\u52a1 A \u751f\u6210\u7684 next-key \u9501\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\u8303\u56f4<code>\uff081005, +\u221e]</code> \u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u7684\u63d2\u5165\u64cd\u4f5c\u751f\u6210\u4e86\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff08<code>LOCK_MODE: X,INSERT_INTENTION</code>\uff09\uff0c\u9501\u7684\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u610f\u5473\u7740\u4e8b\u52a1 B \u5e76\u6ca1\u6709\u6210\u529f\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u56e0\u6b64\u4e8b\u52a1 B \u53d1\u751f\u963b\u585e\u3002</p>"},{"location":"mysql/lock/deadlock/#2","title":"2\u3001\u9047\u5230\u552f\u4e00\u952e\u51b2\u7a81","text":"<p>\u5982\u679c\u5728\u63d2\u5165\u65b0\u8bb0\u5f55\u65f6\uff0c\u63d2\u5165\u4e86\u4e00\u4e2a\u4e0e\u300c\u5df2\u6709\u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u6216\u8005\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u503c\u76f8\u540c\u300d\u7684\u8bb0\u5f55\uff08\u4e0d\u8fc7\u53ef\u4ee5\u6709\u591a\u6761\u8bb0\u5f55\u7684\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u7684\u503c\u540c\u65f6\u4e3a NULL\uff0c\u8fd9\u91cc\u4e0d\u8003\u8651\u8fd9\u79cd\u60c5\u51b5\uff09\uff0c\u6b64\u65f6\u63d2\u5165\u5c31\u4f1a\u5931\u8d25\uff0c\u7136\u540e\u5bf9\u4e8e\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a\u4e86 S \u578b\u7684\u9501\u3002</p> <p>\u81f3\u4e8e\u662f\u884c\u7ea7\u9501\u7684\u7c7b\u578b\u662f\u8bb0\u5f55\u9501\uff0c\u8fd8\u662f next-key \u9501\uff0c\u8ddf\u662f\u300c\u4e3b\u952e\u51b2\u7a81\u300d\u8fd8\u662f\u300c\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u51b2\u7a81\u300d\u6709\u5173\u7cfb\u3002</p> <p>\u5982\u679c\u4e3b\u952e\u7d22\u5f15\u91cd\u590d\uff1a</p> <ul> <li>\u5f53\u9694\u79bb\u7ea7\u522b\u4e3a\u8bfb\u5df2\u63d0\u4ea4\u65f6\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e3b\u952e\u503c\u91cd\u590d\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u6dfb\u52a0 S \u578b\u8bb0\u5f55\u9501\u3002</li> <li>\u5f53\u9694\u79bb\u7ea7\u522b\u662f\u53ef\u91cd\u590d\u8bfb\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e3b\u952e\u503c\u91cd\u590d\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u6dfb\u52a0 S \u578b\u8bb0\u5f55\u9501\u3002</li> </ul> <p>\u5982\u679c\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u91cd\u590d\uff1a</p> <ul> <li>\u4e0d\u8bba\u662f\u54ea\u4e2a\u9694\u79bb\u7ea7\u522b\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u90fd\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e8c\u7ea7\u7d22\u5f15\u5217\u503c\u91cd\u590d\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u6dfb\u52a0 S \u578b next-key \u9501\u3002\u5bf9\u7684\uff0c\u6ca1\u9519\uff0c\u5373\u4f7f\u662f\u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e5f\u662f\u52a0 next-key \u9501\uff0c\u8fd9\u662f\u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e2d\u4e3a\u6570\u4e0d\u591a\u7684\u7ed9\u8bb0\u5f55\u6dfb\u52a0\u95f4\u9699\u9501\u7684\u573a\u666f\u3002\u81f3\u4e8e\u4e3a\u4ec0\u4e48\u8981\u52a0 next-key \u9501\uff0c\u6211\u4e5f\u6ca1\u627e\u5230\u5408\u7406\u7684\u89e3\u91ca\u3002</li> </ul>"},{"location":"mysql/lock/deadlock/#_3","title":"\u4e3b\u952e\u7d22\u5f15\u51b2\u7a81","text":"<p>\u4e0b\u9762\u4e3e\u4e2a\u300c\u4e3b\u952e\u51b2\u7a81\u300d\u7684\u4f8b\u5b50\uff0cMySQL 8.0 \u7248\u672c\uff0c\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3a\u53ef\u91cd\u590d\u8bfb\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\u3002</p> <p>t_order \u8868\u4e2d\u7684 id \u5b57\u6bb5\u4e3a\u4e3b\u952e\u7d22\u5f15\uff0c\u5e76\u4e14\u5df2\u7ecf\u5b58\u5728 id \u503c\u4e3a 5 \u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u6709\u4e2a\u4e8b\u52a1\uff0c\u63d2\u5165\u4e86\u4e00\u6761 id \u4e3a 5 \u7684\u8bb0\u5f55\uff0c\u5c31\u4f1a\u62a5\u4e3b\u952e\u7d22\u5f15\u51b2\u7a81\u7684\u9519\u8bef\u3002</p> <p></p> <p>\u4f46\u662f\u9664\u4e86\u62a5\u9519\u4e4b\u5916\uff0c\u8fd8\u505a\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u5c31\u662f\u5bf9 id \u4e3a 5 \u7684\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a\u4e86 S \u578b\u7684\u8bb0\u5f55\u9501\u3002</p> <p>\u53ef\u4ee5\u6267\u884c <code>select * from performance_schema.data_locks\\G;</code> \u8bed\u53e5\uff0c\u786e\u5b9a\u4e8b\u52a1\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e3b\u952e\u7d22\u5f15\u4e3a 5\uff08LOCK_DATA\uff09\u7684\u8fd9\u6761\u8bb0\u5f55\u4e2d\u52a0\u4e86\u9501\u7c7b\u578b\u4e3a S \u578b\u7684\u8bb0\u5f55\u9501\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\u3002\u5982\u679c\u662f S \u578b\u8bb0\u5f55\u9501\u7684\u8bdd\uff0cLOCK_MODE \u4f1a\u663e\u793a <code>S, REC_NOT_GAP</code>\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u9694\u79bb\u7ea7\u522b\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5728\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u53d1\u751f\u4e86\u4e3b\u952e\u7d22\u5f15\u51b2\u7a81\uff0c\u63d2\u5165\u65b0\u8bb0\u5f55\u7684\u4e8b\u52a1\u4f1a\u7ed9\u5df2\u5b58\u5728\u7684\u4e3b\u952e\u503c\u91cd\u590d\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u6dfb\u52a0 S \u578b\u8bb0\u5f55\u9501\u3002</p>"},{"location":"mysql/lock/deadlock/#_4","title":"\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u51b2\u7a81","text":"<p>\u4e0b\u9762\u4e3e\u4e2a\u300c\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u51b2\u7a81\u300d\u7684\u4f8b\u5b50\uff0cMySQL 8.0 \u7248\u672c\uff0c\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u4e3a\u53ef\u91cd\u590d\u8bfb\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff09\u3002</p> <p>t_order \u8868\u4e2d\u7684 order_no \u5b57\u6bb5\u4e3a\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\uff0c\u5e76\u4e14\u5df2\u7ecf\u5b58\u5728 order_no \u503c\u4e3a 1001 \u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u4e8b\u52a1 A\uff0c\u63d2\u5165\u4e86 order_no \u4e3a 1001 \u7684\u8bb0\u5f55\uff0c\u5c31\u51fa\u73b0\u4e86\u62a5\u9519\u3002</p> <p></p> <p>\u4f46\u662f\u9664\u4e86\u62a5\u9519\u4e4b\u5916\uff0c\u8fd8\u505a\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u5c31\u662f\u5bf9 order_no \u503c\u4e3a 1001 \u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a\u4e86 S \u578b\u7684 next-key \u9501\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6267\u884c <code>select * from performance_schema.data_locks\\G;</code> \u8bed\u53e5\uff0c\u786e\u5b9a\u4e8b\u52a1\u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cindex_order \u4e8c\u7ea7\u7d22\u5f15\u52a0\u4e86 S \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\u662f (-\u221e, 1001]\u3002\u6ce8\u610f\uff0c\u8fd9\u91cc LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\u3002\u5982\u679c\u662f\u8bb0\u5f55\u9501\u7684\u8bdd\uff0cLOCK_MODE \u4f1a\u663e\u793a <code>S, REC_NOT_GAP</code>\u3002</p> <p>\u6b64\u65f6\uff0c\u4e8b\u52a1 B \u6267\u884c\u4e86 select * from t_order where order_no = 1001 for update;  \u5c31\u4f1a\u963b\u585e\uff0c\u56e0\u4e3a\u8fd9\u6761\u8bed\u53e5\u60f3\u52a0 X \u578b\u7684\u9501\uff0c\u662f\u4e0e S \u578b\u7684\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5c31\u4f1a\u88ab\u963b\u585e\u3002</p> <p></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u4ece performance_schema.data_locks \u8fd9\u4e2a\u8868\u4e2d\u770b\u5230\uff0c\u4e8b\u52a1 B \u7684\u72b6\u6001\uff08LOCK_STATUS\uff09\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u52a0\u9501\u7684\u7c7b\u578b X \u578b\u7684\u8bb0\u5f55\u9501\uff08LOCK_MODE: X,REC_NOT_GAP\uff09\u3002</p> <p></p> <p>\u4e0a\u9762\u7684\u6848\u4f8b\u662f\u9488\u5bf9\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u91cd\u590d\u800c\u63d2\u5165\u5931\u8d25\u7684\u573a\u666f\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u6790\u4e24\u4e2a\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6267\u884c\u4e86\u76f8\u540c\u7684 insert \u8bed\u53e5\u7684\u573a\u666f\u3002</p> <p>\u73b0\u5728 t_order \u8868\u4e2d\uff0c\u53ea\u6709\u8fd9\u4e9b\u6570\u636e\uff0corder_no \u4e3a\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u3002</p> <p></p> <p>\u5728\u9694\u79bb\u7ea7\u522b\u53ef\u91cd\u590d\u8bfb\u7684\u60c5\u51b5\u4e0b\uff0c\u5f00\u542f\u4e24\u4e2a\u4e8b\u52a1\uff0c\u524d\u540e\u6267\u884c\u76f8\u540c\u7684  Insert \u8bed\u53e5\uff0c\u6b64\u65f6\u4e8b\u52a1 B \u7684  Insert \u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\u3002</p> <p></p> <p>\u4e24\u4e2a\u4e8b\u52a1\u7684\u52a0\u9501\u8fc7\u7a0b\uff1a</p> <ul> <li>\u4e8b\u52a1 A \u5148\u63d2\u5165 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\uff0c\u53ef\u4ee5\u63d2\u5165\u6210\u529f\uff0c\u6b64\u65f6\u5bf9\u5e94\u7684\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u88ab\u300c\u9690\u5f0f\u9501\u300d\u4fdd\u62a4\uff0c\u6b64\u65f6\u8fd8\u6ca1\u6709\u5b9e\u9645\u7684\u9501\u7ed3\u6784\uff08\u6267\u884c\u5b8c\u8fd9\u91cc\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u4ee5\u770b\u67e5 performance_schema.data_locks \u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u6761\u8bb0\u5f55\u662f\u6ca1\u6709\u52a0\u4efb\u4f55\u9501\u7684\uff09\uff1b</li> <li>\u63a5\u7740\uff0c\u4e8b\u52a1 B \u4e5f\u63d2\u5165 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\uff0c\u7531\u4e8e\u4e8b\u52a1 A \u5df2\u7ecf\u63d2\u5165 order_no \u503c\u4e3a 1006 \u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u63d2\u5165\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u65f6\u4f1a\u9047\u5230\u91cd\u590d\u7684\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u5217\u503c\uff0c\u6b64\u65f6\u4e8b\u52a1 B \u60f3\u83b7\u53d6\u4e00\u4e2a S \u578b next-key \u9501\uff0c\u4f46\u662f\u4e8b\u52a1 A \u5e76\u672a\u63d0\u4ea4\uff0c\u4e8b\u52a1 A \u63d2\u5165\u7684 order_no \u503c\u4e3a 1006 \u7684\u8bb0\u5f55\u4e0a\u7684\u300c\u9690\u5f0f\u9501\u300d\u4f1a\u53d8\u300c\u663e\u793a\u9501\u300d\u4e14\u9501\u7c7b\u578b\u4e3a  X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5411\u83b7\u53d6 S \u578b next-key \u9501\u65f6\u4f1a\u9047\u5230\u9501\u51b2\u7a81\uff0c\u4e8b\u52a1 B \u8fdb\u5165\u963b\u585e\u72b6\u6001\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u6267\u884c <code>select * from performance_schema.data_locks\\G;</code> \u8bed\u53e5\uff0c\u786e\u5b9a\u4e8b\u52a1\u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u9501\uff0c\u8fd9\u91cc\u53ea\u5173\u6ce8\u5728\u8bb0\u5f55\u4e0a\u52a0\u9501\u7684\u7c7b\u578b\u3002</p> <p>\u5148\u770b\u4e8b\u52a1 A \u5bf9 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\u52a0\u4e86\u4ec0\u4e48\u9501\uff1f</p> <p>\u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A  \u5bf9 order_no \u4e3a 1006 \u8bb0\u5f55\u52a0\u4e0a\u4e86\u7c7b\u578b\u4e3a  X \u578b\u7684\u8bb0\u5f55\u9501\uff08\u6ce8\u610f\uff0c\u8fd9\u4e2a\u662f\u5728\u6267\u884c\u4e8b\u52a1 B \u4e4b\u540e\u624d\u4ea7\u751f\u7684\u9501\uff0c\u6ca1\u6267\u884c\u4e8b\u52a1 B \u4e4b\u524d\uff0c\u8be5\u8bb0\u5f55\u8fd8\u662f\u9690\u5f0f\u9501\uff09\u3002</p> <p></p> <p>\u7136\u540e\u770b\u4e8b\u52a1 B \u60f3\u5bf9 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\u52a0\u4ec0\u4e48\u9501\uff1f</p> <p>\u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 B \u60f3\u5bf9 order_no \u4e3a 1006 \u7684\u8bb0\u5f55\u52a0 S \u578b\u7684 next-key \u9501\uff0c\u4f46\u662f\u7531\u4e8e\u4e8b\u52a1 A \u5728\u8be5\u8bb0\u5f55\u4e0a\u6301\u6709\u4e86 X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u8fd9\u4e24\u4e2a\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e8b\u52a1 B \u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002</p> <p></p> <p>\u4ece\u8fd9\u4e2a\u5b9e\u9a8c\u53ef\u4ee5\u5f97\u77e5\uff0c\u5e76\u53d1\u591a\u4e2a\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u5e76\u4e0d\u4f1a\u52a0\u9501\uff0c\u800c\u662f\u4f1a\u7528\u9690\u5f0f\u9501\u4fdd\u62a4\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\u7684\u8bb0\u5f55\u3002</p> <p>\u4f46\u662f\u5f53\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u8fd8\u672a\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e0e\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u7b2c\u4e8c\u4e2a\u4e8b\u52a1\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u6b64\u65f6\u7b2c\u4e00\u4e8b\u52a1\u63d2\u5165\u7684\u8bb0\u5f55\u4e2d\u7684\u9690\u5f0f\u9501\u4f1a\u53d8\u4e3a\u663e\u793a\u9501\u4e14\u7c7b\u578b\u662f X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u800c\u7b2c\u4e8c\u4e2a\u4e8b\u52a1\u662f\u60f3\u5bf9\u8be5\u8bb0\u5f55\u52a0\u4e0a S \u578b\u7684 next-key \u9501\uff0cX \u578b\u4e0e S \u578b\u7684\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u5bfc\u81f4\u7b2c\u4e8c\u4e2a\u4e8b\u52a1\u4f1a\u7b49\u5f85\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0c\u91ca\u653e\u4e86\u9501\u3002</p> <p>\u5982\u679c order_no \u4e0d\u662f\u552f\u4e00\u4e8c\u7ea7\u7d22\u5f15\uff0c\u90a3\u4e48\u4e24\u4e2a\u4e8b\u52a1\uff0c\u524d\u540e\u6267\u884c\u76f8\u540c\u7684  Insert \u8bed\u53e5\uff0c\u662f\u4e0d\u4f1a\u53d1\u751f\u963b\u585e\u7684\uff0c\u5c31\u5982\u524d\u9762\u7684\u8fd9\u4e2a\u4f8b\u5b50\u3002</p> <p></p>"},{"location":"mysql/lock/deadlock/#_5","title":"\u5982\u4f55\u907f\u514d\u6b7b\u9501\uff1f","text":"<p>\u6b7b\u9501\u7684\u56db\u4e2a\u5fc5\u8981\u6761\u4ef6\uff1a\u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5f3a\u5360\u7528\u3001\u5faa\u73af\u7b49\u5f85\u3002\u53ea\u8981\u7cfb\u7edf\u53d1\u751f\u6b7b\u9501\uff0c\u8fd9\u4e9b\u6761\u4ef6\u5fc5\u7136\u6210\u7acb\uff0c\u4f46\u662f\u53ea\u8981\u7834\u574f\u4efb\u610f\u4e00\u4e2a\u6761\u4ef6\u5c31\u6b7b\u9501\u5c31\u4e0d\u4f1a\u6210\u7acb\u3002</p> <p>\u5728\u6570\u636e\u5e93\u5c42\u9762\uff0c\u6709\u4e24\u79cd\u7b56\u7565\u901a\u8fc7\u300c\u6253\u7834\u5faa\u73af\u7b49\u5f85\u6761\u4ef6\u300d\u6765\u89e3\u9664\u6b7b\u9501\u72b6\u6001\uff1a</p> <ul> <li>\u8bbe\u7f6e\u4e8b\u52a1\u7b49\u5f85\u9501\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u5f53\u4e00\u4e2a\u4e8b\u52a1\u7684\u7b49\u5f85\u65f6\u95f4\u8d85\u8fc7\u8be5\u503c\u540e\uff0c\u5c31\u5bf9\u8fd9\u4e2a\u4e8b\u52a1\u8fdb\u884c\u56de\u6eda\uff0c\u4e8e\u662f\u9501\u5c31\u91ca\u653e\u4e86\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u4e86\u3002\u5728 InnoDB \u4e2d\uff0c\u53c2\u6570 <code>innodb_lock_wait_timeout</code> \u662f\u7528\u6765\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u7684\uff0c\u9ed8\u8ba4\u503c\u65f6 50 \u79d2\u3002</li> </ul> <p>\u5f53\u53d1\u751f\u8d85\u65f6\u540e\uff0c\u5c31\u51fa\u73b0\u4e0b\u9762\u8fd9\u4e2a\u63d0\u793a\uff1a</p> <p></p> <ul> <li>\u5f00\u542f\u4e3b\u52a8\u6b7b\u9501\u68c0\u6d4b\u3002\u4e3b\u52a8\u6b7b\u9501\u68c0\u6d4b\u5728\u53d1\u73b0\u6b7b\u9501\u540e\uff0c\u4e3b\u52a8\u56de\u6eda\u6b7b\u9501\u94fe\u6761\u4e2d\u7684\u67d0\u4e00\u4e2a\u4e8b\u52a1\uff0c\u8ba9\u5176\u4ed6\u4e8b\u52a1\u5f97\u4ee5\u7ee7\u7eed\u6267\u884c\u3002\u5c06\u53c2\u6570 <code>innodb_deadlock_detect</code> \u8bbe\u7f6e\u4e3a on\uff0c\u8868\u793a\u5f00\u542f\u8fd9\u4e2a\u903b\u8f91\uff0c\u9ed8\u8ba4\u5c31\u5f00\u542f\u3002</li> </ul> <p>\u5f53\u68c0\u6d4b\u5230\u6b7b\u9501\u540e\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e0b\u9762\u8fd9\u4e2a\u63d0\u793a\uff1a</p> <p></p> <p>\u4e0a\u9762\u8fd9\u4e2a\u4e24\u79cd\u7b56\u7565\u662f\u300c\u5f53\u6709\u6b7b\u9501\u53d1\u751f\u65f6\u300d\u7684\u907f\u514d\u65b9\u5f0f\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u56de\u5f52\u4e1a\u52a1\u7684\u89d2\u5ea6\u6765\u9884\u9632\u6b7b\u9501\uff0c\u5bf9\u8ba2\u5355\u505a\u5e42\u7b49\u6027\u6821\u9a8c\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u4fdd\u8bc1\u4e0d\u4f1a\u51fa\u73b0\u91cd\u590d\u7684\u8ba2\u5355\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u5c06 order_no \u5b57\u6bb5\u8bbe\u7f6e\u4e3a\u552f\u4e00\u7d22\u5f15\u5217\uff0c\u5229\u7528\u5b83\u7684\u552f\u4e00\u6027\u6765\u4fdd\u8bc1\u8ba2\u5355\u8868\u4e0d\u4f1a\u51fa\u73b0\u91cd\u590d\u7684\u8ba2\u5355\uff0c\u4e0d\u8fc7\u6709\u4e00\u70b9\u4e0d\u597d\u7684\u5730\u65b9\u5c31\u662f\u5728\u6211\u4eec\u63d2\u5165\u4e00\u4e2a\u5df2\u7ecf\u5b58\u5728\u7684\u8ba2\u5355\u8bb0\u5f55\u65f6\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\u3002</p> <p>\u6700\u540e\u8bf4\u4e2a\u6bb5\u5b50\uff1a</p> <p>\u9762\u8bd5\u5b98\uff1a\u89e3\u91ca\u4e0b\u4ec0\u4e48\u662f\u6b7b\u9501\uff1f</p> <p>\u5e94\u8058\u8005\uff1a\u4f60\u5f55\u7528\u6211\uff0c\u6211\u5c31\u544a\u8bc9\u4f60</p> <p>\u9762\u8bd5\u5b98\uff1a\u4f60\u544a\u8bc9\u6211\uff0c\u6211\u5c31\u5f55\u7528\u4f60</p> <p>\u5e94\u8058\u8005\uff1a\u4f60\u5f55\u7528\u6211\uff0c\u6211\u5c31\u544a\u8bc9\u4f60</p> <p>\u9762\u8bd5\u5b98\uff1a\u5367\u69fd\u6eda\uff01</p> <p>\u2026\u2026</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\uff1f\u300b</li> <li>http://mysql.taobao.org/monthly/2020/09/06/</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/lock/how_to_lock/","title":"MySQL \u662f\u600e\u4e48\u52a0\u9501\u7684\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u662f\u4e0d\u662f\u5f88\u591a\u4eba\u90fd\u5bf9 MySQL \u52a0\u884c\u7ea7\u9501\u7684\u89c4\u5219\u641e\u7684\u8ff7\u8ff7\u7cca\u7cca\uff0c\u5bf9\u8bb0\u5f55\u4e00\u4f1a\u52a0\u7684\u662f next-key \u9501\uff0c\u4e00\u4f1a\u52a0\u662f\u95f4\u9699\u9501\uff0c\u4e00\u4f1a\u53c8\u662f\u8bb0\u5f55\u9501\u3002</p> <p>\u5766\u767d\u8bf4\uff0c\u786e\u5b9e\u8fd8\u633a\u590d\u6742\u7684\uff0c\u4f46\u662f\u597d\u5728\u6211\u627e\u70b9\u4e86\u70b9\u89c4\u5f8b\uff0c\u4e5f\u77e5\u9053\u5982\u4f55\u7528\u547d\u4ee4\u5206\u6790\u52a0\u4e86\u4ec0\u4e48\u7c7b\u578b\u7684\u884c\u7ea7\u9501\u3002</p> <p>\u4e4b\u524d\u6211\u5199\u8fc7\u4e00\u7bc7\u5173\u4e8e\u300cMySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff1f\u300d\u7684\u6587\u7ae0\uff0c\u968f\u7740\u6211\u5199 MySQL \u9501\u76f8\u5173\u7684\u6587\u7ae0\u8d8a\u6765\u8d8a\u591a\u65f6\uff0c\u540e\u6765\u53d1\u73b0\u5f53\u65f6\u7684\u6587\u7ae0\u5199\u7684\u4e0d\u591f\u8be6\u7ec6\u3002</p> <p>\u4e3a\u4e86\u8ba9\u5927\u5bb6\u5f88\u6e05\u695a\u7684\u77e5\u9053 MySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff0c\u4ee5\u53ca\u5982\u4f55\u7528\u547d\u4ee4\u5206\u6790\u52a0\u4e86\u4ec0\u4e48\u884c\u7ea7\u9501\uff0c\u518d\u52a0\u4e0a\u4e3a\u4e86\u89e3\u91ca\u6e05\u695a\u4e3a\u4ec0\u4e48 MySQL \u8981\u8fd9\u4e48\u52a0\u884c\u7ea7\u9501\uff0c\u6240\u4ee5\u6211\u91cd\u5199\u4e86\u8fd9\u7bc7\u6587\u7ae0\u3002</p> <p>\u8fd9\u4e00\u91cd\u5199\uff0c\u5c31\u591a\u589e\u52a0\u4e86 1W \u591a\u5b57 + 30 \u5f20\u56fe\uff0c\u6240\u4ee5\u5b8c\u5168\u7b97\u662f\u65b0\u7684\u6587\u7ae0\u4e86\u3002</p> <p>\u6587\u7ae0\u5185\u5bb9\u6bd4\u8f83\u957f\uff0c\u5927\u5bb6\u53ef\u4ee5\u8010\u5fc3\u770b\u4e0b\u53bb\uff0c\u770b\u5b8c\u4e4b\u540e\u4f60\u4f1a\u6709\u4e00\u79cd\u7a81\u7136\u88ab\u987f\u609f\u7684\u611f\u89c9\uff0c\u56e0\u4e3a\u6211\u81ea\u5df1\u5199\u5b8c\u8fd9\u7bc7\u6587\u7ae0\u540e\uff0c\u81ea\u5df1\u4e5f\u88ab\u81ea\u5df1\u987f\u609f\u4e86\u3002</p>"},{"location":"mysql/lock/how_to_lock/#sql","title":"\u4ec0\u4e48 SQL \u8bed\u53e5\u4f1a\u52a0\u884c\u7ea7\u9501\uff1f","text":"<p>InnoDB \u5f15\u64ce\u662f\u652f\u6301\u884c\u7ea7\u9501\u7684\uff0c\u800c MyISAM \u5f15\u64ce\u5e76\u4e0d\u652f\u6301\u884c\u7ea7\u9501\uff0c\u6240\u4ee5\u540e\u9762\u7684\u5185\u5bb9\u90fd\u662f\u57fa\u4e8e InnoDB \u5f15\u64ce \u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u8bf4 MySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u662f\u5728\u8bf4 InnoDB \u5f15\u64ce\u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\u3002</p> <p>\u666e\u901a\u7684 select \u8bed\u53e5\u662f\u4e0d\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u9501\u7684\uff0c\u56e0\u4e3a\u5b83\u5c5e\u4e8e\u5feb\u7167\u8bfb\uff0c\u662f\u901a\u8fc7  MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u5b9e\u73b0\u7684\u3002</p> <p>\u5982\u679c\u8981\u5728\u67e5\u8be2\u65f6\u5bf9\u8bb0\u5f55\u52a0\u884c\u7ea7\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u5f0f\uff0c\u8fd9\u4e24\u79cd\u67e5\u8be2\u4f1a\u52a0\u9501\u7684\u8bed\u53e5\u79f0\u4e3a\u9501\u5b9a\u8bfb\u3002</p> SQL<pre><code>//\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501(S\u578b\u9501)\nselect ... lock in share mode;\n\n//\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501(X\u578b\u9501)\nselect ... for update;\n</code></pre> <p>\u4e0a\u9762\u8fd9\u4e24\u6761\u8bed\u53e5\u5fc5\u987b\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c\u56e0\u4e3a\u5f53\u4e8b\u52a1\u63d0\u4ea4\u4e86\uff0c\u9501\u5c31\u4f1a\u88ab\u91ca\u653e\uff0c\u6240\u4ee5\u5728\u4f7f\u7528\u8fd9\u4e24\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u8981\u52a0\u4e0a begin \u6216\u8005 start transaction \u5f00\u542f\u4e8b\u52a1\u7684\u8bed\u53e5\u3002</p> <p>\u9664\u4e86\u4e0a\u9762\u8fd9\u4e24\u6761\u9501\u5b9a\u8bfb\u8bed\u53e5\u4f1a\u52a0\u884c\u7ea7\u9501\u4e4b\u5916\uff0cupdate \u548c delete \u64cd\u4f5c\u90fd\u4f1a\u52a0\u884c\u7ea7\u9501\uff0c\u4e14\u9501\u7684\u7c7b\u578b\u90fd\u662f\u72ec\u5360\u9501 (X \u578b\u9501)\u3002</p> SQL<pre><code>//\u5bf9\u64cd\u4f5c\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501(X\u578b\u9501)\nupdate table .... where id = 1;\n\n//\u5bf9\u64cd\u4f5c\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501(X\u578b\u9501)\ndelete from table where id = 1;\n</code></pre> <p>\u5171\u4eab\u9501\uff08S \u9501\uff09\u6ee1\u8db3\u8bfb\u8bfb\u5171\u4eab\uff0c\u8bfb\u5199\u4e92\u65a5\u3002\u72ec\u5360\u9501\uff08X \u9501\uff09\u6ee1\u8db3\u5199\u5199\u4e92\u65a5\u3001\u8bfb\u5199\u4e92\u65a5\u3002</p> <p></p>"},{"location":"mysql/lock/how_to_lock/#_1","title":"\u884c\u7ea7\u9501\u6709\u54ea\u4e9b\u79cd\u7c7b\uff1f","text":"<p>\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u5728\u8bfb\u5df2\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u53ea\u6709\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u4ec5\u628a\u4e00\u6761\u8bb0\u5f55\u9501\u4e0a\u3002</p> <p>\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u9664\u4e86\u6709\u8bb0\u5f55\u9501\uff0c\u8fd8\u6709\u95f4\u9699\u9501\uff08\u76ee\u7684\u662f\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\uff09\uff0c\u6240\u4ee5\u884c\u7ea7\u9501\u7684\u79cd\u7c7b\u4e3b\u8981\u6709\u4e09\u7c7b\uff1a</p> <ul> <li>Record Lock\uff0c\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u4ec5\u628a\u4e00\u6761\u8bb0\u5f55\u9501\u4e0a\uff1b</li> <li>Gap Lock\uff0c\u95f4\u9699\u9501\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u4f46\u662f\u4e0d\u5305\u542b\u8bb0\u5f55\u672c\u8eab\uff1b</li> <li>Next-Key Lock\uff1aRecord Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u522b\u4ecb\u7ecd\u8fd9\u4e09\u79cd\u884c\u7ea7\u9501\u3002</p>"},{"location":"mysql/lock/how_to_lock/#record-lock","title":"Record Lock","text":"<p>Record Lock \u79f0\u4e3a\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f\u7684\u662f\u4e00\u6761\u8bb0\u5f55\u3002\u800c\u4e14\u8bb0\u5f55\u9501\u662f\u6709 S \u9501\u548c X \u9501\u4e4b\u5206\u7684\uff1a</p> <ul> <li>\u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 S \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e S \u9501\u517c\u5bb9\uff09\uff0c\u4f46\u662f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09;</li> <li>\u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 X \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u65e2\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\uff0c\u4e5f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08X \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a</p> SQL<pre><code>mysql &gt; begin;\nmysql &gt; select * from t_test where id = 1 for update;\n</code></pre> <p>\u4e8b\u52a1\u4f1a\u5bf9\u8868\u4e2d\u4e3b\u952e id = 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u5982\u679c\u8fd9\u65f6\u5019\u5176\u4ed6\u4e8b\u52a1\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u5220\u9664\u6216\u8005\u66f4\u65b0\u64cd\u4f5c\uff0c\u90a3\u4e48\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u88ab\u963b\u585e\u3002\u6ce8\u610f\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 id = 1 \u7684\u65b0\u8bb0\u5f55\u5e76\u4e0d\u4f1a\u88ab\u963b\u585e\uff0c\u800c\u662f\u4f1a\u62a5\u4e3b\u952e\u51b2\u7a81\u7684\u9519\u8bef\uff0c\u8fd9\u662f\u56e0\u4e3a\u4e3b\u952e\u6709\u552f\u4e00\u6027\u7684\u7ea6\u675f\u3002</p> <p></p> <p>\u5f53\u4e8b\u52a1\u6267\u884c commit \u540e\uff0c\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u751f\u6210\u7684\u9501\u90fd\u4f1a\u88ab\u91ca\u653e\u3002</p>"},{"location":"mysql/lock/how_to_lock/#gap-lock","title":"Gap Lock","text":"<p>Gap Lock \u79f0\u4e3a\u95f4\u9699\u9501\uff0c\u53ea\u5b58\u5728\u4e8e\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002</p> <p>\u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u63d2\u5165 id = 4 \u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u7684\u9632\u6b62\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002</p> <p></p> <p>\u95f4\u9699\u9501\u867d\u7136\u5b58\u5728 X \u578b\u95f4\u9699\u9501\u548c S \u578b\u95f4\u9699\u9501\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u5373\u4e24\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5305\u542b\u5171\u540c\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501\uff0c\u5e76\u4e0d\u5b58\u5728\u4e92\u65a5\u5173\u7cfb\uff0c\u56e0\u4e3a\u95f4\u9699\u9501\u7684\u76ee\u7684\u662f\u9632\u6b62\u63d2\u5165\u5e7b\u5f71\u8bb0\u5f55\u800c\u63d0\u51fa\u7684\u3002</p>"},{"location":"mysql/lock/how_to_lock/#next-key-lock","title":"Next-Key Lock","text":"<p>Next-Key Lock \u79f0\u4e3a\u4e34\u952e\u9501\uff0c\u662f Record Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002</p> <p>\u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5] \u7684 next-key lock\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5373\u4e0d\u80fd\u63d2\u5165 id = 4 \u8bb0\u5f55\uff0c\u4e5f\u4e0d\u80fd\u4fee\u6539\u548c\u5220\u9664 id = 5 \u8fd9\u6761\u8bb0\u5f55\u3002</p> <p></p> <p>\u6240\u4ee5\uff0cnext-key lock \u5373\u80fd\u4fdd\u62a4\u8be5\u8bb0\u5f55\uff0c\u53c8\u80fd\u963b\u6b62\u5176\u4ed6\u4e8b\u52a1\u5c06\u65b0\u8bb0\u5f55\u63d2\u5165\u5230\u88ab\u4fdd\u62a4\u8bb0\u5f55\u524d\u9762\u7684\u95f4\u9699\u4e2d\u3002</p> <p>next-key lock \u662f\u5305\u542b\u95f4\u9699\u9501 + \u8bb0\u5f55\u9501\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684\u3002</p> <p>\u6bd4\u5982\uff0c\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e86\u8303\u56f4\u4e3a (1, 10] \u7684 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u867d\u7136\u76f8\u540c\u8303\u56f4\u7684\u95f4\u9699\u9501\u662f\u591a\u4e2a\u4e8b\u52a1\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4f46\u5bf9\u4e8e\u8bb0\u5f55\u9501\uff0c\u6211\u4eec\u662f\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\uff0cX \u578b\u7684\u8bb0\u5f55\u9501\u4e0e X \u578b\u7684\u8bb0\u5f55\u9501\u662f\u51b2\u7a81\u7684\u3002</p>"},{"location":"mysql/lock/how_to_lock/#mysql_1","title":"MySQL \u662f\u600e\u4e48\u52a0\u884c\u7ea7\u9501\u7684\uff1f","text":"<p>\u884c\u7ea7\u9501\u52a0\u9501\u89c4\u5219\u6bd4\u8f83\u590d\u6742\uff0c\u4e0d\u540c\u7684\u573a\u666f\uff0c\u52a0\u9501\u7684\u5f62\u5f0f\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u52a0\u9501\u7684\u5bf9\u8c61\u662f\u7d22\u5f15\uff0c\u52a0\u9501\u7684\u57fa\u672c\u5355\u4f4d\u662f next-key lock\uff0c\u5b83\u662f\u7531\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7ec4\u5408\u800c\u6210\u7684\uff0cnext-key lock \u662f\u524d\u5f00\u540e\u95ed\u533a\u95f4\uff0c\u800c\u95f4\u9699\u9501\u662f\u524d\u5f00\u540e\u5f00\u533a\u95f4\u3002</p> <p>\u4f46\u662f\uff0cnext-key lock \u5728\u4e00\u4e9b\u573a\u666f\u4e0b\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u95f4\u9699\u9501\u3002</p> <p>\u90a3\u5230\u5e95\u662f\u4ec0\u4e48\u573a\u666f\u5462\uff1f\u603b\u7ed3\u4e00\u53e5\uff0c\u5728\u80fd\u4f7f\u7528\u8bb0\u5f55\u9501\u6216\u8005\u95f4\u9699\u9501\u5c31\u80fd\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f\u4e0b\uff0cnext-key lock  \u5c31\u4f1a\u9000\u5316\u6210\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u95f4\u9699\u9501\u3002</p> <p>\u8fd9\u6b21\u4f1a\u4ee5\u4e0b\u9762\u8fd9\u4e2a\u8868\u7ed3\u6784\u6765\u8fdb\u884c\u5b9e\u9a8c\u8bf4\u660e\uff1a</p> SQL<pre><code>CREATE TABLE `user` (\n  `id` bigint NOT NULL AUTO_INCREMENT,\n  `name` varchar(30) COLLATE utf8mb4_unicode_ci NOT NULL,\n  `age` int NOT NULL,\n  PRIMARY KEY (`id`),\n  KEY `index_age` (`age`) USING BTREE\n) ENGINE=InnoDB  DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;\n</code></pre> <p>\u5176\u4e2d\uff0cid \u662f\u4e3b\u952e\u7d22\u5f15\uff08\u552f\u4e00\u7d22\u5f15\uff09\uff0cage \u662f\u666e\u901a\u7d22\u5f15\uff08\u975e\u552f\u4e00\u7d22\u5f15\uff09\uff0cname \u662f\u666e\u901a\u7684\u5217\u3002</p> <p>\u8868\u4e2d\u7684\u6709\u8fd9\u4e9b\u884c\u8bb0\u5f55\uff1a</p> <p></p> <p>\u8fd9\u6b21\u5b9e\u9a8c\u73af\u5883\u7684 MySQL \u7248\u672c\u662f 8.0.26\uff0c\u9694\u79bb\u7ea7\u522b\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u3002</p> <p>\u4e0d\u540c\u7248\u672c\u7684\u52a0\u9501\u89c4\u5219\u53ef\u80fd\u662f\u4e0d\u540c\u7684\uff0c\u4f46\u662f\u5927\u4f53\u4e0a\u662f\u76f8\u540c\u7684\u3002</p>"},{"location":"mysql/lock/how_to_lock/#_2","title":"\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2","text":"<p>\u5f53\u6211\u4eec\u7528\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u5b58\u4e0d\u5b58\u5728\uff0c\u52a0\u9501\u7684\u89c4\u5219\u4e5f\u4f1a\u4e0d\u540c\uff1a</p> <ul> <li>\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u8fd9\u4e00\u6761\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u300c\u8bb0\u5f55\u9501\u300d\u3002</li> <li>\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u4e0d\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u627e\u5230\u7b2c\u4e00\u6761\u5927\u4e8e\u8be5\u67e5\u8be2\u8bb0\u5f55\u7684\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u300c\u95f4\u9699\u9501\u300d\u3002</li> </ul> <p>\u63a5\u4e0b\u91cc\u7528\u4e24\u4e2a\u6848\u4f8b\u6765\u8bf4\u660e\u3002</p>"},{"location":"mysql/lock/how_to_lock/#1","title":"1\u3001\u8bb0\u5f55\u5b58\u5728\u7684\u60c5\u51b5","text":"<p>\u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u7b49\u503c\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u5b58\u5728\u300d\u4e8e\u8868\u4e2d\u7684\u3002</p> SQL<pre><code>mysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from user where id = 1 for update;\n+----+--------+-----+\n| id | name   | age |\n+----+--------+-----+\n|  1 | \u8def\u98de   |  19 |\n+----+--------+-----+\n1 row in set (0.02 sec)\n</code></pre> <p>\u90a3\u4e48\uff0c\u4e8b\u52a1 A \u4f1a\u4e3a id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u5c31\u4f1a\u52a0\u4e0a X \u578b\u7684\u8bb0\u5f55\u9501\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\uff0c\u5bf9 id \u4e3a 1 \u7684\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u6216\u8005\u5220\u9664\u64cd\u4f5c\u7684\u8bdd\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u66f4\u65b0\u6216\u8005\u5220\u9664\u64cd\u4f5c\u4e5f\u4f1a\u5bf9\u8bb0\u5f55\u52a0 X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u800c X \u9501\u548c X \u9501\u4e4b\u95f4\u662f\u4e92\u65a5\u5173\u7cfb\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> <p></p> <p>\u56e0\u4e3a\u4e8b\u52a1 A \u5bf9 id = 1 \u7684\u8bb0\u5f55\u52a0\u4e86 X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u4fee\u6539 id=1 \u7684\u8bb0\u5f55\u65f6\u4f1a\u88ab\u963b\u585e\uff0c\u4e8b\u52a1 C \u5728\u5220\u9664 id=1 \u7684\u8bb0\u5f55\u65f6\u4e5f\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u6709\u4ec0\u4e48\u547d\u4ee4\u53ef\u4ee5\u5206\u6790\u52a0\u4e86\u4ec0\u4e48\u9501\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u6211\u4eec\u4ee5\u524d\u9762\u7684\u4e8b\u52a1 A \u4f5c\u4e3a\u4f8b\u5b50\uff0c\u5206\u6790\u4e0b\u4e0b\u5b83\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b</li> <li>\u884c\u9501\uff1aX \u7c7b\u578b\u7684\u8bb0\u5f55\u9501\uff1b</li> </ul> <p>\u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u884c\u7ea7\u9501\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\u3002</p> <p>\u901a\u8fc7 LOCK_MODE \u53ef\u4ee5\u786e\u8ba4\u662f next-key \u9501\uff0c\u8fd8\u662f\u95f4\u9699\u9501\uff0c\u8fd8\u662f\u8bb0\u5f55\u9501\uff1a</p> <ul> <li>\u5982\u679c LOCK_MODE \u4e3a <code>X</code>\uff0c\u8bf4\u660e\u662f next-key \u9501\uff1b</li> <li>\u5982\u679c LOCK_MODE \u4e3a <code>X, REC_NOT_GAP</code>\uff0c\u8bf4\u660e\u662f\u8bb0\u5f55\u9501\uff1b</li> <li>\u5982\u679c LOCK_MODE \u4e3a <code>X, GAP</code>\uff0c\u8bf4\u660e\u662f\u95f4\u9699\u9501\uff1b</li> </ul> <p>\u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728 id = 1 \u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u7684\u662f\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f\u7684\u8303\u56f4\u662f id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u3002\u8fd9\u6837\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u5bf9 id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u4e86\u3002</p> <p>\u4ece\u8fd9\u91cc\u6211\u4eec\u4e5f\u53ef\u4ee5\u5f97\u77e5\uff0c\u52a0\u9501\u7684\u5bf9\u8c61\u662f\u9488\u5bf9\u7d22\u5f15\uff0c\u56e0\u4e3a\u8fd9\u91cc\u67e5\u8be2\u8bed\u53e5\u626b\u63cf\u7684 B+ \u6811\u662f\u805a\u7c07\u7d22\u5f15\u6811\uff0c\u5373\u4e3b\u952e\u7d22\u5f15\u6811\uff0c\u6240\u4ee5\u662f\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501\u3002\u5c06\u5bf9\u5e94\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0 \u8bb0\u5f55\u9501\u540e\uff0c\u5c31\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u5bf9\u8be5\u8bb0\u5f55\u8fdb\u884c\u66f4\u65b0\u548c\u5220\u9664\u64cd\u4f5c\u4e86\u3002</p> <p>\u4e3a\u4ec0\u4e48\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u5b58\u5728\u7684\u573a\u666f\u4e0b\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\uff1f</p> <p>\u539f\u56e0\u5c31\u662f\u5728\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u5b58\u5728\u7684\u573a\u666f\u4e0b\uff0c\u4ec5\u9760\u8bb0\u5f55\u9501\u4e5f\u80fd\u907f\u514d\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</p> <p>\u5e7b\u8bfb\u7684\u5b9a\u4e49\u5c31\u662f\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\uff0c\u4e0d\u76f8\u540c\u65f6\uff0c\u5c31\u8ba4\u4e3a\u53d1\u751f\u5e7b\u8bfb\u3002\u6240\u4ee5\uff0c\u8981\u907f\u514d\u5e7b\u8bfb\u5c31\u662f\u907f\u514d\u7ed3\u679c\u96c6\u67d0\u4e00\u6761\u8bb0\u5f55\u88ab\u5176\u4ed6\u4e8b\u52a1\u5220\u9664\uff0c\u6216\u8005\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u8fd9\u6837\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u5c31\u4e0d\u4f1a\u51fa\u73b0\u4e0d\u76f8\u540c\u7684\u60c5\u51b5\u3002</p> <ul> <li> <p>\u7531\u4e8e\u4e3b\u952e\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 id = 1 \u7684\u65f6\u5019\uff0c\u4f1a\u56e0\u4e3a\u4e3b\u952e\u51b2\u7a81\uff0c\u5bfc\u81f4\u65e0\u6cd5\u63d2\u5165 id = 1 \u7684\u65b0\u8bb0\u5f55\u3002\u8fd9\u6837\u4e8b\u52a1 A \u5728\u591a\u6b21\u67e5\u8be2  id = 1 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u4e0d\u540c\uff0c\u4e5f\u5c31\u907f\u514d\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</p> </li> <li> <p>\u7531\u4e8e\u5bf9 id = 1 \u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u5220\u9664\u8be5\u8bb0\u5f55\uff0c\u8fd9\u6837\u4e8b\u52a1 A \u5728\u591a\u6b21\u67e5\u8be2  id = 1 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u4e0d\u540c\uff0c\u4e5f\u5c31\u907f\u514d\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</p> </li> </ul>"},{"location":"mysql/lock/how_to_lock/#2","title":"2\u3001\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5","text":"<p>\u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u7b49\u503c\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u4e0d\u5b58\u5728\u300d\u4e8e\u8868\u4e2d\u7684\u3002</p> SQL<pre><code>mysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from user where id = 2 for update;\nEmpty set (0.03 sec)\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b</li> <li>\u884c\u9501\uff1aX \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff1b</li> </ul> <p>\u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728 id = 5 \u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u7684\u662f\u95f4\u9699\u9501\uff0c\u9501\u4f4f\u7684\u8303\u56f4\u662f (1, 5)\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u8fd9\u4e00\u4e9b\u8bb0\u5f55\u7684\u8bdd\uff0c\u8fd9\u4e9b\u63d2\u5165\u8bed\u53e5\u90fd\u4f1a\u53d1\u751f\u963b\u585e\u3002</p> <p>\u6ce8\u610f\uff0c\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u7684 id = 1 \u6216\u8005 id = 5 \u7684\u8bb0\u5f55\u8bdd\uff0c\u5e76\u4e0d\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u800c\u662f\u62a5\u4e3b\u952e\u51b2\u7a81\u7684\u9519\u8bef\uff0c\u56e0\u4e3a\u8868\u4e2d\u5df2\u7ecf\u5b58\u5728 id = 1 \u548c id = 5 \u7684\u8bb0\u5f55\u4e86\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> <p></p> <p>\u56e0\u4e3a\u4e8b\u52a1 A \u5728 id = 5 \u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u8303\u56f4\u4e3a (1, 5) \u7684 X \u578b\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u63d2\u5165\u4e00\u6761 id \u4e3a 3 \u7684\u8bb0\u5f55\u65f6\u4f1a\u88ab\u963b\u585e\u4f4f\uff0c\u5373\u65e0\u6cd5\u63d2\u5165 id = 3 \u7684\u8bb0\u5f55\u3002</p> <p>\u95f4\u9699\u9501\u7684\u8303\u56f4<code>(1, 5)</code> \uff0c\u662f\u600e\u4e48\u786e\u5b9a\u7684\uff1f</p> <p>\u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u300c\u53f3\u8fb9\u754c\u300d\uff0c\u6b64\u6b21\u7684\u4e8b\u52a1 A \u7684 LOCK_DATA \u662f 5\u3002</p> <p>\u7136\u540e\u9501\u8303\u56f4\u7684\u300c\u5de6\u8fb9\u754c\u300d\u662f\u8868\u4e2d id \u4e3a 5 \u7684\u4e0a\u4e00\u6761\u8bb0\u5f55\u7684 id \u503c\uff0c\u5373 1\u3002</p> <p>\u56e0\u6b64\uff0c\u95f4\u9699\u9501\u7684\u8303\u56f4<code>(1, 5)</code>\u3002</p> <p>\u4e3a\u4ec0\u4e48\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u7684\u573a\u666f\u4e0b\uff0c\u5728\u7d22\u5f15\u6811\u627e\u5230\u7b2c\u4e00\u6761\u5927\u4e8e\u8be5\u67e5\u8be2\u8bb0\u5f55\u7684\u8bb0\u5f55\u540e\uff0c\u8981\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u300c\u95f4\u9699\u9501\u300d\uff1f</p> <p>\u539f\u56e0\u5c31\u662f\u5728\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u5e76\u4e14\u67e5\u8be2\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u573a\u666f\u4e0b\uff0c\u4ec5\u9760\u95f4\u9699\u9501\u5c31\u80fd\u907f\u514d\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</p> <ul> <li>\u4e3a\u4ec0\u4e48 id = 5 \u8bb0\u5f55\u4e0a\u7684\u4e3b\u952e\u7d22\u5f15\u7684\u9501\u4e0d\u53ef\u4ee5\u662f next-key lock\uff1f\u5982\u679c\u662f next-key lock\uff0c\u5c31\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u5220\u9664 id = 5 \u8fd9\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u8fd9\u6b21\u7684\u6848\u4f8b\u662f\u67e5\u8be2 id = 2 \u7684\u8bb0\u5f55\uff0c\u53ea\u8981\u4fdd\u8bc1\u524d\u540e\u4e24\u6b21\u67e5\u8be2 id = 2 \u7684\u7ed3\u679c\u96c6\u76f8\u540c\uff0c\u5c31\u80fd\u907f\u514d\u5e7b\u8bfb\u7684\u95ee\u9898\u4e86\uff0c\u6240\u4ee5\u5373\u4f7f id =5 \u88ab\u5220\u9664\uff0c\u4e5f\u4e0d\u4f1a\u6709\u4ec0\u4e48\u5f71\u54cd\uff0c\u90a3\u5c31\u6ca1\u5fc5\u987b\u52a0 next-key lock\uff0c\u56e0\u6b64\u53ea\u9700\u8981\u5728 id = 5 \u52a0\u95f4\u9699\u9501\uff0c\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 id = 2 \u7684\u65b0\u8bb0\u5f55\u5c31\u884c\u4e86\u3002</li> <li>\u4e3a\u4ec0\u4e48\u4e0d\u53ef\u4ee5\u9488\u5bf9\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u52a0\u8bb0\u5f55\u9501\uff1f\u9501\u662f\u52a0\u5728\u7d22\u5f15\u4e0a\u7684\uff0c\u800c\u8fd9\u4e2a\u573a\u666f\u4e0b\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u81ea\u7136\u5c31\u6ca1\u529e\u6cd5\u9501\u4f4f\u8fd9\u6761\u4e0d\u5b58\u5728\u7684\u8bb0\u5f55\u3002</li> </ul>"},{"location":"mysql/lock/how_to_lock/#_3","title":"\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2","text":"<p>\u8303\u56f4\u67e5\u8be2\u548c\u7b49\u503c\u67e5\u8be2\u7684\u52a0\u9501\u89c4\u5219\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u5f53\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u626b\u63cf\u5230\u7684\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u7136\u540e\u5982\u679c\u9047\u5230\u4e0b\u9762\u8fd9\u4e9b\u60c5\u51b5\uff0c\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u6216\u8005\u95f4\u9699\u9501\uff1a</p> <ul> <li>\u60c5\u51b5\u4e00\uff1a\u9488\u5bf9\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u56e0\u4e3a\u5b58\u5728\u7b49\u503c\u67e5\u8be2\u7684\u6761\u4ef6\uff0c\u90a3\u4e48\u5982\u679c\u7b49\u503c\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u5b58\u5728\u4e8e\u8868\u4e2d\uff0c\u90a3\u4e48\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u3002</li> <li>\u60c5\u51b5\u4e8c\uff1a\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u8981\u770b\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u4e8e\u8868\u4e2d\uff1a</li> <li>\u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u4e0d\u5728\u8868\u4e2d\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u300c\u5c0f\u4e8e\u300d\u8fd8\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002</li> <li>\u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u5728\u8868\u4e2d\uff0c\u5982\u679c\u662f\u300c\u5c0f\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\uff1b\u5982\u679c\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15 next-key \u9501\u4e0d\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u51e0\u4e2a\u5b9e\u9a8c\uff0c\u624d\u9a8c\u8bc1\u6211\u4e0a\u9762\u8bf4\u7684\u7ed3\u8bba\u3002</p>"},{"location":"mysql/lock/how_to_lock/#1_1","title":"1\u3001\u9488\u5bf9\u300c\u5927\u4e8e\u6216\u8005\u5927\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2","text":"<p>\u5b9e\u9a8c\u4e00\uff1a\u9488\u5bf9\u300c\u5927\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u7684\u60c5\u51b5\u3002</p> <p>\u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff1a</p> SQL<pre><code>mysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from user where id &gt; 15 for update;\n+----+-----------+-----+\n| id | name      | age |\n+----+-----------+-----+\n| 20 | \u9999\u514b\u65af    |  39 |\n+----+-----------+-----+\n1 row in set (0.01 sec)\n</code></pre> <p>\u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 20\uff0c\u7531\u4e8e\u67e5\u8be2\u8be5\u8bb0\u5f55\u4e0d\u662f\u4e00\u4e2a\u7b49\u503c\u67e5\u8be2\uff08\u4e0d\u662f\u5927\u4e8e\u7b49\u4e8e\u6761\u4ef6\u67e5\u8be2\uff09\uff0c\u6240\u4ee5\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (15, 20] \u7684 next-key \u9501\uff1b</li> <li>\u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u867d\u7136\u6211\u4eec\u770b\u89c1\u8868\u4e2d\u6700\u540e\u4e00\u6761\u8bb0\u5f55\u662f id = 20 \u7684\u8bb0\u5f55\uff0c\u4f46\u662f\u5b9e\u9645\u5728 Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u4f1a\u7528\u4e00\u4e2a\u7279\u6b8a\u7684\u8bb0\u5f55\u6765\u6807\u8bc6\u6700\u540e\u4e00\u6761\u8bb0\u5f55\uff0c\u8be5\u7279\u6b8a\u7684\u8bb0\u5f55\u7684\u540d\u5b57\u53eb supremum pseudo-record\uff0c\u6240\u4ee5\u626b\u63cf\u7b2c\u4e8c\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u626b\u63cf\u5230\u4e86\u8fd9\u4e2a\u7279\u6b8a\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4f1a\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (20, +\u221e] \u7684 next-key \u9501\u3002</li> <li>\u505c\u6b62\u626b\u63cf\u3002</li> </ol> <p>\u53ef\u4ee5\u5f97\u77e5\uff0c\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u4e2a X \u578b \u7684 next-key \u9501\uff1a</p> <p></p> <ul> <li>\u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8bb0\u5f55\uff0c\u540c\u65f6\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 16\u300117\u300118\u300119 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</li> <li>\u5728\u7279\u6b8a\u8bb0\u5f55\uff08supremum pseudo-record\uff09\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u5927\u4e8e 20 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 </li> </ul> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5f97\u5230\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u4e2a X \u578b \u7684 next-key \u9501\uff1a</p> <ul> <li>\u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (15, 20] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8bb0\u5f55\uff0c\u540c\u65f6\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 16\u300117\u300118\u300119 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</li> <li>\u5728\u7279\u6b8a\u8bb0\u5f55\uff08supremum pseudo-record\uff09\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (20, +\u221e] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u5927\u4e8e 20 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 </li> </ul> <p>\u5b9e\u9a8c\u4e8c\uff1a\u9488\u5bf9\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u7684\u60c5\u51b5\u3002</p> <p>\u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff1a</p> SQL<pre><code>mysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from user where id &gt;= 15 for update;\n+----+-----------+-----+\n| id | name      | age |\n+----+-----------+-----+\n| 15 | \u4e4c\u7d22\u666e    |  20 |\n| 20 | \u9999\u514b\u65af    |  39 |\n+----+-----------+-----+\n2 rows in set (0.00 sec)\n</code></pre> <p>\u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 15\uff0c\u7531\u4e8e\u67e5\u8be2\u8be5\u8bb0\u5f55\u662f\u4e00\u4e2a\u7b49\u503c\u67e5\u8be2\uff08\u7b49\u4e8e 15\uff09\uff0c\u6240\u4ee5\u8be5\u4e3b\u952e\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u9501\u4f4f id = 15 \u8fd9\u4e00\u884c\u8bb0\u5f55\u3002</li> <li>\u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 20\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (15, 20] \u7684 next-key \u9501\uff1b</li> <li>\u63a5\u7740\u626b\u63cf\u5230\u7b2c\u4e09\u884c\u7684\u65f6\u5019\uff0c\u626b\u63cf\u5230\u4e86\u7279\u6b8a\u8bb0\u5f55\uff08supremum pseudo-record\uff09\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (20, +\u221e] \u7684 next-key \u9501\u3002</li> <li>\u505c\u6b62\u626b\u63cf\u3002</li> </ol> <p>\u53ef\u4ee5\u5f97\u77e5\uff0c\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e09\u4e2a X \u578b \u7684\u9501\uff0c\u5206\u522b\u662f\uff1a</p> <p></p> <ul> <li>\u5728 id = 15 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u8303\u56f4\u662f id = 15 \u8fd9\u4e00\u884c\u8bb0\u5f55\uff1b\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 15 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff1b</li> <li>\u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 next-key \u9501\uff0c\u8303\u56f4\u662f  (15, 20] \u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8bb0\u5f55\uff0c\u540c\u65f6\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 16\u300117\u300118\u300119 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</li> <li>\u5728\u7279\u6b8a\u8bb0\u5f55\uff08supremum pseudo-record\uff09\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 next-key \u9501\uff0c\u8303\u56f4\u662f  (20, +\u221e] \u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u5927\u4e8e 20 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002 </li> </ul> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002</p> <p></p> <p>\u901a\u8fc7\u524d\u9762\u8fd9\u4e2a\u5b9e\u9a8c\uff0c\u6211\u4eec\u8bc1\u660e\u4e86\uff1a</p> <ul> <li>\u9488\u5bf9\u300c\u5927\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u5b58\u5728\u4e8e\u8868\u4e2d\uff0c\u90a3\u4e48\u7531\u4e8e\u67e5\u8be2\u8be5\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u662f\u5305\u542b\u4e00\u4e2a\u7b49\u503c\u67e5\u8be2\u7684\u64cd\u4f5c\uff0c\u6240\u4ee5\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\u3002</li> </ul>"},{"location":"mysql/lock/how_to_lock/#2_1","title":"2\u3001\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2","text":"<p>\u5b9e\u9a8c\u4e00\uff1a\u9488\u5bf9\u300c\u5c0f\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u8868\u4e2d\u7684\u60c5\u51b5\u3002</p> <p>\u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff0c\u6ce8\u610f\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\uff08id \u4e3a 6\uff09\u5e76\u4e0d\u5b58\u5728\u4e8e\u8868\u4e2d\u3002</p> SQL<pre><code>mysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from user where id &lt; 6 for update;\n+----+--------+-----+\n| id | name   | age |\n+----+--------+-----+\n|  1 | \u8def\u98de   |  19 |\n|  5 | \u7d22\u9686   |  21 |\n+----+--------+-----+\n3 rows in set (0.00 sec)\n</code></pre> <p>\u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 1\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (-\u221e, 1] \u7684 next-key \u9501\uff1b</li> <li>\u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 5\uff0c\u6240\u4ee5\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (1, 5] \u7684 next-key \u9501\uff1b</li> <li>\u7531\u4e8e\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u8bb0\u5f55\uff08id = 5\uff09\uff0c\u6ee1\u8db3 id &lt; 6 \u6761\u4ef6\uff0c\u800c\u4e14\u4e5f\u6ca1\u6709\u8fbe\u5230\u7ec8\u6b62\u626b\u63cf\u7684\u6761\u4ef6\uff0c\u63a5\u7740\u4f1a\u7ee7\u7eed\u626b\u63cf\u3002</li> <li>\u626b\u63cf\u5230\u7684\u7b2c\u4e09\u884c\u662f id = 10\uff0c\u8be5\u8bb0\u5f55\u4e0d\u6ee1\u8db3 id &lt; 6 \u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5 id = 10 \u8fd9\u4e00\u884c\u8bb0\u5f55\u7684\u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (5, 10) \u7684\u95f4\u9699\u9501\u3002</li> <li>\u7531\u4e8e\u626b\u63cf\u5230\u7684\u7b2c\u4e09\u884c\u8bb0\u5f55\uff08id = 10\uff09\uff0c\u4e0d\u6ee1\u8db3 id &lt; 6 \u6761\u4ef6\uff0c\u8fbe\u5230\u4e86\u7ec8\u6b62\u626b\u63cf\u7684\u6761\u4ef6\uff0c\u4e8e\u662f\u505c\u6b62\u626b\u63cf\u3002</li> </ol> <p>\u4ece\u4e0a\u9762\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u77e5\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e09\u4e2a X \u578b\u7684\u9501\uff1a</p> <p></p> <ul> <li>\u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a  (-\u221e, 1] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 1 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u5c0f\u4e8e 1 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</li> <li>\u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a  (1, 5] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 5 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</li> <li>\u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (5, 10) \u7684\u95f4\u9699\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 6\u30017\u30018\u30019 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</li> </ul> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u4e5f\u53ef\u4ee5\u5f97\u77e5\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u52a0\u7684\u4e09\u4e2a\u9501\uff0c\u5c31\u662f\u6211\u4eec\u524d\u9762\u5206\u6790\u51fa\u90a3\u4e09\u4e2a\u9501\u3002</p> <p>\u867d\u7136\u8fd9\u6b21\u8303\u56f4\u67e5\u8be2\u7684\u6761\u4ef6\u662f\u300c\u5c0f\u4e8e\u300d\uff0c\u4f46\u662f\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u4e8e\u8868\u4e2d\uff08id \u4e3a 6 \u7684\u8bb0\u5f55\u4e0d\u5728\u8868\u4e2d\uff09\uff0c\u6240\u4ee5\u5982\u679c\u4e8b\u52a1 A \u7684\u8303\u56f4\u67e5\u8be2\u7684\u6761\u4ef6\u6539\u6210 &lt;= 6 \u7684\u8bdd\uff0c\u52a0\u7684\u9501\u8fd8\u662f\u548c\u8303\u56f4\u67e5\u8be2\u6761\u4ef6\u4e3a &lt; 6 \u662f\u4e00\u6837\u7684\u3002\u5927\u5bb6\u81ea\u5df1\u4e5f\u9a8c\u8bc1\u4e0b\u8fd9\u4e2a\u7ed3\u8bba\u3002</p> <p>\u56e0\u6b64\uff0c\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u5982\u679c\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u4e0d\u5728\u8868\u4e2d\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u300c\u5c0f\u4e8e\u300d\u8fd8\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u4e2d\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u7684\u8bb0\u5f55\uff0c\u5219\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002</p> <p>\u5b9e\u9a8c\u4e8c\uff1a\u9488\u5bf9\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u8868\u4e2d\u7684\u60c5\u51b5\u3002</p> <p>\u5047\u8bbe\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff0c\u6ce8\u610f\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\uff08id \u4e3a 5\uff09\u5b58\u5728\u4e8e\u8868\u4e2d\u3002</p> SQL<pre><code>mysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from user where id &lt;= 5 for update;\n+----+--------+-----+\n| id | name   | age |\n+----+--------+-----+\n|  1 | \u8def\u98de   |  19 |\n|  5 | \u7d22\u9686   |  21 |\n+----+--------+-----+\n2 rows in set (0.00 sec)\n</code></pre> <p>\u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 1\uff0c\u4e8e\u662f\u5bf9\u8be5\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (-\u221e, 1] \u7684 next-key \u9501\uff1b</li> <li>\u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 5\uff0c\u4e8e\u662f\u5bf9\u8be5\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (1, 5] \u7684 next-key \u9501\u3002</li> <li>\u7531\u4e8e\u4e3b\u952e\u7d22\u5f15\u5177\u6709\u552f\u4e00\u6027\uff0c\u4e0d\u4f1a\u5b58\u5728\u4e24\u4e2a id = 5 \u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u4f1a\u518d\u7ee7\u7eed\u626b\u63cf\uff0c\u4e8e\u662f\u505c\u6b62\u626b\u63cf\u3002</li> </ol> <p>\u4ece\u4e0a\u9762\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86 2 \u4e2a X \u578b\u7684\u9501\uff1a</p> <p></p> <ul> <li>\u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a  (-\u221e, 1] \u7684 next-key \u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 1 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u5c0f\u4e8e 1 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</li> <li>\u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a  (1, 5] \u7684 next-key \u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 5 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</li> </ul> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u4e2a X \u578b next-key \u9501\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a  (-\u221e, 1] \u7684 next-key \u9501\uff1b</li> <li>\u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (1, 5 ] \u7684 next-key \u9501\u3002</li> </ul> <p>\u5b9e\u9a8c\u4e09\uff1a\u518d\u6765\u770b\u9488\u5bf9\u300c\u5c0f\u4e8e\u300d\u7684\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u8868\u4e2d\u7684\u60c5\u51b5\u3002</p> <p>\u5982\u679c\u4e8b\u52a1 A \u7684\u67e5\u8be2\u8bed\u53e5\u662f\u5c0f\u4e8e\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u4e14\u67e5\u8be2\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\uff08id \u4e3a 5\uff09\u5b58\u5728\u4e8e\u8868\u4e2d\u3002</p> SQL<pre><code>select * from user where id &lt; 5 for update;\n</code></pre> <p>\u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f id = 1\uff0c\u4e8e\u662f\u5bf9\u8be5\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (-\u221e, 1] \u7684 next-key \u9501\uff1b</li> <li>\u7531\u4e8e\u662f\u8303\u56f4\u67e5\u627e\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5f80\u540e\u627e\u5b58\u5728\u7684\u8bb0\u5f55\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f id = 5\uff0c\u8be5\u8bb0\u5f55\u662f\u7b2c\u4e00\u6761\u4e0d\u6ee1\u8db3 id &lt; 5 \u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u8be5\u8bb0\u5f55\u7684\u9501\u4f1a\u9000\u5316\u4e3a\u95f4\u9699\u9501\uff0c\u9501\u8303\u56f4\u662f (1,5)\u3002</li> <li>\u7531\u4e8e\u627e\u5230\u4e86\u7b2c\u4e00\u6761\u4e0d\u6ee1\u8db3 id &lt; 5 \u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u505c\u6b62\u626b\u63cf\u3002</li> </ol> <p>\u53ef\u4ee5\u5f97\u77e5\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86\u4e24\u79cd X \u578b\u9501\uff1a</p> <p></p> <ul> <li> <p>\u5728 id = 1 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a  (-\u221e, 1] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u5373\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 1 \u7684\u8fd9\u4e00\u6761\u8bb0\u5f55\uff0c\u540c\u65f6\u4e5f\u65e0\u6cd5\u63d2\u5165 id \u5c0f\u4e8e 1 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</p> </li> <li> <p>\u5728 id = 5 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (1,5) \u7684\u95f4\u9699\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 id \u503c\u4e3a 2\u30013\u30014 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002</p> </li> </ul> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u4e2d\u7684\u5206\u6790\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u4e86 X \u578b\u7684\u8303\u56f4\u4e3a  (-\u221e, 1] \u7684 next-key \u9501\uff0c\u548c X \u578b\u7684\u8303\u56f4\u4e3a (1, 5) \u7684\u95f4\u9699\u9501\u3002</p> <p>\u56e0\u6b64\uff0c\u901a\u8fc7\u524d\u9762\u8fd9\u4e09\u4e2a\u5b9e\u9a8c\uff0c\u53ef\u4ee5\u5f97\u77e5\u3002</p> <p>\u5728\u9488\u5bf9\u300c\u5c0f\u4e8e\u6216\u8005\u5c0f\u4e8e\u7b49\u4e8e\u300d\u7684\u552f\u4e00\u7d22\u5f15\uff08\u4e3b\u952e\u7d22\u5f15\uff09\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u5b58\u5728\u8fd9\u4e24\u79cd\u60c5\u51b5\u4f1a\u5c06\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u7684\uff1a</p> <ul> <li>\u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u4e0d\u5728\u300d\u8868\u4e2d\u65f6\uff0c\u90a3\u4e48\u4e0d\u7ba1\u662f\u300c\u5c0f\u4e8e\u300d\u8fd8\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002</li> <li>\u5f53\u6761\u4ef6\u503c\u7684\u8bb0\u5f55\u300c\u5728\u300d\u8868\u4e2d\u65f6\uff1a</li> <li>\u5982\u679c\u662f\u300c\u5c0f\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0 next-key \u9501\u3002</li> <li>\u5982\u679c\u662f\u300c\u5c0f\u4e8e\u7b49\u4e8e\u300d\u6761\u4ef6\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u626b\u63cf\u5230\u7ec8\u6b62\u8303\u56f4\u67e5\u8be2\u7684\u8bb0\u5f55\u65f6\uff0c\u8be5\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e2d\u7684 next-key \u9501\u300c\u4e0d\u4f1a\u300d\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u5176\u4ed6\u626b\u63cf\u5230\u7684\u8bb0\u5f55\uff0c\u90fd\u662f\u5728\u8fd9\u4e9b\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0 next-key \u9501\u3002</li> </ul>"},{"location":"mysql/lock/how_to_lock/#_4","title":"\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2","text":"<p>\u5f53\u6211\u4eec\u7528\u975e\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u7b49\u503c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u5b58\u5728\u4e24\u4e2a\u7d22\u5f15\uff0c\u4e00\u4e2a\u662f\u4e3b\u952e\u7d22\u5f15\uff0c\u4e00\u4e2a\u662f\u975e\u552f\u4e00\u7d22\u5f15\uff08\u4e8c\u7ea7\u7d22\u5f15\uff09\uff0c\u6240\u4ee5\u5728\u52a0\u9501\u65f6\uff0c\u540c\u65f6\u4f1a\u5bf9\u8fd9\u4e24\u4e2a\u7d22\u5f15\u90fd\u52a0\u9501\uff0c\u4f46\u662f\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501\u7684\u65f6\u5019\uff0c\u53ea\u6709\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u624d\u4f1a\u5bf9\u5b83\u4eec\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u9501\u3002</p> <p>\u9488\u5bf9\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u5b58\u4e0d\u5b58\u5728\uff0c\u52a0\u9501\u7684\u89c4\u5219\u4e5f\u4f1a\u4e0d\u540c\uff1a</p> <ul> <li>\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u65f6\uff0c\u7531\u4e8e\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u80af\u5b9a\u5b58\u5728\u7d22\u5f15\u503c\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u626b\u63cf\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u626b\u63cf\u5230\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u5c31\u505c\u6b62\u626b\u63cf\uff0c\u7136\u540e\u5728\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u626b\u63cf\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f next-key \u9501\uff0c\u800c\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684  next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u540c\u65f6\uff0c\u5728\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u8bb0\u5f55\u9501\u3002</li> <li>\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u65f6\uff0c\u626b\u63cf\u5230\u7b2c\u4e00\u6761\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684  next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u56e0\u4e3a\u4e0d\u5b58\u5728\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501\u3002</li> </ul> <p>\u63a5\u4e0b\u91cc\u7528\u4e24\u4e2a\u5b9e\u9a8c\u6765\u8bf4\u660e\u3002</p>"},{"location":"mysql/lock/how_to_lock/#1_2","title":"1\u3001\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5","text":"<p>\u5b9e\u9a8c\u4e00\uff1a\u9488\u5bf9\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u503c\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\u3002</p> <p>\u5148\u6765\u8bf4\u8bf4\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u6bd4\u8f83\u7b80\u5355\u3002</p> <p>\u5047\u8bbe\u4e8b\u52a1 A \u5bf9\u975e\u552f\u4e00\u7d22\u5f15\uff08age\uff09\u8fdb\u884c\u4e86\u7b49\u503c\u67e5\u8be2\uff0c\u4e14\u8868\u4e2d\u4e0d\u5b58\u5728 age = 25 \u7684\u8bb0\u5f55\u3002</p> SQL<pre><code>mysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from user where age = 25 for update;\nEmpty set (0.00 sec)\n</code></pre> <p>\u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5b9a\u4f4d\u5230\u7b2c\u4e00\u6761\u4e0d\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u5373\u626b\u63cf\u5230 age = 39\uff0c\u4e8e\u662f\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684  next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f (22, 39)\u3002</li> <li>\u505c\u6b62\u67e5\u8be2</li> </ul> <p>\u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 X \u578b\u7684\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f  (22, 39)\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u300125\u300126\u3001\u2026\u2026\u300138 \u8fd9\u4e9b\u65b0\u8bb0\u5f55\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 22 \u548c age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u4f1a\u5728\u540e\u9762\u8bf4\u3002</p> <p></p> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff08INDEX_NAME: index_age\uff09\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39) \u7684 X \u578b\u95f4\u9699\u9501\u3002</p> <p>\u6b64\u65f6\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86 age \u503c\u4e3a 23\u300124\u300125\u300126\u3001\u2026\u2026\u300138 \u8fd9\u4e9b\u65b0\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e9b\u63d2\u5165\u8bed\u53e5\u90fd\u4f1a\u53d1\u751f\u963b\u585e\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u8bf4\uff01</p> <p>\u5f53\u6709\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e8c\u7ea7\u7d22\u5f15\u7684\u95f4\u9699\u9501 (22, 39) \u65f6\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u8ba9\u5176\u4ed6\u4e8b\u52a1\u7684\u63d2\u5165 age = 22 \u6216\u8005 age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\u6210\u529f\uff1f\u53c8\u662f\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u63d2\u5165  age = 22 \u6216\u8005 age = 39 \u8bb0\u5f55\u65f6\u7684\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff1f</p> <p>\u6211\u4eec\u5148\u8981\u6e05\u695a\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\u3002</p> <p>\u63d2\u5165\u8bed\u53e5\u5728\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5b9a\u4f4d\u5230\u8be5\u8bb0\u5f55\u5728 B+\u6811 \u7684\u4f4d\u7f6e\uff0c\u5982\u679c\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u624d\u4f1a\u53d1\u751f\u963b\u585e\u3002</p> <p>\u5728\u5206\u6790\u4e8c\u7ea7\u7d22\u5f15\u7684\u95f4\u9699\u9501\u662f\u5426\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u8bb0\u5f55\u65f6\uff0c\u6211\u4eec\u8981\u5148\u8981\u77e5\u9053\u4e8c\u7ea7\u7d22\u5f15\u6811\u662f\u5982\u4f55\u5b58\u653e\u8bb0\u5f55\u7684\uff1f</p> <p>\u4e8c\u7ea7\u7d22\u5f15\u6811\u662f\u6309\u7167\u4e8c\u7ea7\u7d22\u5f15\u503c\uff08age \u5217\uff09\u6309\u987a\u5e8f\u5b58\u653e\u7684\uff0c\u5728\u76f8\u540c\u7684\u4e8c\u7ea7\u7d22\u5f15\u503c\u60c5\u51b5\u4e0b\uff0c\u518d\u6309\u4e3b\u952e id \u7684\u987a\u5e8f\u5b58\u653e\u3002\u77e5\u9053\u4e86\u8fd9\u4e2a\u524d\u63d0\uff0c\u6211\u4eec\u624d\u80fd\u77e5\u9053\u6267\u884c\u63d2\u5165\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u8c01\u3002</p> <p>\u57fa\u4e8e\u524d\u9762\u7684\u5b9e\u9a8c\uff0c\u4e8b\u52a1 A \u662f\u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86 X \u578b\u7684\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f  (22, 39)\u3002</p> <p>\u63d2\u5165 age = 22 \u8bb0\u5f55\u7684\u6210\u529f\u548c\u5931\u8d25\u7684\u60c5\u51b5\u5206\u522b\u5982\u4e0b\uff1a</p> <ul> <li>\u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22\uff0cid = 3 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 10\u3001age = 22 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6ca1\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u53ef\u4ee5\u6267\u884c\u6210\u529f\u3002</li> <li>\u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22\uff0cid = 12 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 20\u3001age = 39 \u7684\u8bb0\u5f55\uff0c\u6b63\u597d\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\u6210\u529f\u3002</li> </ul> <p>\u63d2\u5165 age = 39 \u8bb0\u5f55\u7684\u6210\u529f\u548c\u5931\u8d25\u7684\u60c5\u51b5\u5206\u522b\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 39\uff0cid = 3 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 20\u3001age = 39 \u7684\u8bb0\u5f55\uff0c\u6b63\u597d\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\u6210\u529f\u3002</p> </li> <li> <p>\u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 39\uff0cid = 21 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0d\u5b58\u5728\uff0c\u4e5f\u5c31\u6ca1\u6709\u95f4\u9699\u9501\u4e86\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u3002</p> </li> </ul> <p>\u6240\u4ee5\uff0c\u5f53\u6709\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e8c\u7ea7\u7d22\u5f15\u7684\u95f4\u9699\u9501 (22, 39) \u65f6\uff0c\u63d2\u5165 age = 22 \u6216\u8005 age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\u662f\u5426\u53ef\u4ee5\u6267\u884c\u6210\u529f\uff0c\u5173\u952e\u8fd8\u8981\u8003\u8651\u63d2\u5165\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\uff0c\u56e0\u4e3a\u300c\u4e8c\u7ea7\u7d22\u5f15\u503c\uff08age \u5217\uff09+ \u4e3b\u952e\u503c\uff08id \u5217\uff09\u300d\u624d\u53ef\u4ee5\u786e\u5b9a\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u786e\u5b9a\u4e86\u63d2\u5165\u4f4d\u7f6e\u540e\uff0c\u5c31\u8981\u770b\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u6709\u95f4\u9699\u9501\uff0c\u5982\u679c\u6709\u95f4\u9699\u9501\uff0c\u5c31\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u5982\u679c\u6ca1\u6709\u95f4\u9699\u9501\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u3002</p> <p>\u77e5\u9053\u4e86\u8fd9\u4e2a\u7ed3\u8bba\u4e4b\u540e\uff0c\u6211\u4eec\u518d\u56de\u8fc7\u5934\u770b\uff0c\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u8bb0\u5f55\u4e0d\u5b58\u5728\u65f6\uff0c\u6267\u884c<code>select * from performance_schema.data_locks\\G;</code> \u8f93\u51fa\u7684\u7ed3\u679c\u3002</p> <p></p> <p>\u5728\u524d\u9762\u5206\u6790\u8f93\u51fa\u7ed3\u679c\u7684\u65f6\u5019\uff0c\u6211\u8bf4\u7684\u7ed3\u8bba\u662f\uff1a\u300c\u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff08INDEX_NAME: index_age\uff09\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39) \u7684 X \u578b\u95f4\u9699\u9501\u300d\u3002\u8fd9\u4e2a\u7ed3\u8bba\u5176\u5b9e\u8fd8\u4e0d\u591f\u51c6\u786e\uff0c\u56e0\u4e3a\u53ea\u8003\u8651\u4e86 LOCK_DATA \u7b2c\u4e00\u4e2a\u6570\u503c\uff0839\uff09\uff0c\u6ca1\u6709\u8003\u8651 LOCK_DATA \u7b2c\u4e8c\u4e2a\u6570\u503c\uff0820\uff09\u3002</p> <p>\u90a3 <code>LOCK_DATA\uff1a39\uff0c20</code> \u662f\u4ec0\u4e48\u610f\u601d\uff1f</p> <ul> <li>LOCK_DATA \u7b2c\u4e00\u4e2a\u6570\u503c\uff0c\u4e5f\u5c31\u662f 39\uff0c\u5b83\u4ee3\u8868\u7684\u662f age \u503c\u3002\u4ece\u524d\u9762\u6211\u4eec\u4e5f\u77e5\u9053\u4e86\uff0cLOCK_DATA \u7b2c\u4e00\u4e2a\u6570\u503c\u662f next-key \u9501\u548c\u95f4\u9699\u9501\u9501\u4f4f\u7684\u8303\u56f4\u7684\u53f3\u8fb9\u754c\u503c\u3002</li> <li>LOCK_DATA \u7b2c\u4e8c\u4e2a\u6570\u503c\uff0c\u4e5f\u5c31\u662f 20\uff0c\u5b83\u4ee3\u8868\u7684\u662f id \u503c\u3002</li> </ul> <p>\u4e4b\u6240\u4ee5 LOCK_DATA \u8981\u591a\u663e\u793a\u4e00\u4e2a\u6570\u503c\uff08ID \u503c\uff09\uff0c\u662f\u56e0\u4e3a\u9488\u5bf9\u300c\u5f53\u67d0\u4e2a\u4e8b\u52a1\u6301\u6709\u975e\u552f\u4e00\u7d22\u5f15\u7684 (22, 39) \u95f4\u9699\u9501\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u4e8b\u52a1\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 39 \u65b0\u8bb0\u5f55\u300d\u7684\u95ee\u9898\uff0c\u8fd8\u9700\u8981\u8003\u8651\u63d2\u5165\u8bb0\u5f55\u7684 id \u503c\u3002\u800c LOCK_DATA \u7684\u7b2c\u4e8c\u4e2a\u6570\u503c\uff0c\u5c31\u662f\u8bf4\u660e\u5728\u63d2\u5165 age = 39 \u65b0\u8bb0\u5f55\u65f6\uff0c\u54ea\u4e9b\u8303\u56f4\u7684 id \u503c\u662f\u4e0d\u53ef\u4ee5\u63d2\u5165\u7684\u3002</p> <p>\u56e0\u6b64\uff0c <code>LOCK_DATA\uff1a39\uff0c20</code> + <code>LOCK_MODE : X, GAP</code> \u7684\u610f\u601d\u662f\uff0c\u4e8b\u52a1 A \u5728 age = 39 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff08INDEX_NAME: index_age\uff09\uff0c\u52a0\u4e86 age \u503c\u8303\u56f4\u4e3a (22, 39) \u7684 X \u578b\u95f4\u9699\u9501\uff0c\u540c\u65f6\u9488\u5bf9\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 39 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c\u4e0d\u5141\u8bb8\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 20 \u3002\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 20\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u65e0\u6cd5\u4ece<code>select * from performance_schema.data_locks\\G;</code> \u8f93\u51fa\u7684\u7ed3\u679c\u5206\u6790\u51fa\u300c\u5728\u63d2\u5165 age =22 \u65b0\u8bb0\u5f55\u65f6\uff0c\u54ea\u4e9b\u8303\u56f4\u7684 id \u503c\u662f\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u7684\u300d\uff0c\u8fd9\u65f6\u5019\u5c31\u5f97\u81ea\u5df1\u753b\u51fa\u4e8c\u7ea7\u7d22\u5f15\u7684 B+ \u6811\u7684\u7ed3\u6784\uff0c\u7136\u540e\u786e\u5b9a\u63d2\u5165\u4f4d\u7f6e\u540e\uff0c\u770b\u4e0b\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u5b58\u5728\u95f4\u9699\u9501\uff0c\u5982\u679c\u5b58\u5728\u95f4\u9699\u9501\uff0c\u5219\u65e0\u6cd5\u63d2\u5165\u6210\u529f\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u95f4\u9699\u9501\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u3002</p>"},{"location":"mysql/lock/how_to_lock/#2_2","title":"2\u3001\u8bb0\u5f55\u5b58\u5728\u7684\u60c5\u51b5","text":"<p>\u5b9e\u9a8c\u4e8c\uff1a\u9488\u5bf9\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u65f6\uff0c\u67e5\u8be2\u7684\u503c\u5b58\u5728\u7684\u60c5\u51b5\u3002</p> <p>\u5047\u8bbe\u4e8b\u52a1 A \u5bf9\u975e\u552f\u4e00\u7d22\u5f15\uff08age\uff09\u8fdb\u884c\u4e86\u7b49\u503c\u67e5\u8be2\uff0c\u4e14\u8868\u4e2d\u5b58\u5728 age = 22 \u7684\u8bb0\u5f55\u3002</p> SQL<pre><code>mysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from user where age = 22 for update;\n+----+--------+-----+\n| id | name   | age |\n+----+--------+-----+\n| 10 | \u5c71\u6cbb   |  22 |\n+----+--------+-----+\n1 row in set (0.00 sec)\n</code></pre> <p>\u4e8b\u52a1 A \u52a0\u9501\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u7531\u4e8e\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u80af\u5b9a\u5b58\u5728\u503c\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u626b\u63cf\u7684\u8fc7\u7a0b\uff0c\u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f age = 22\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u4e0a\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\u3002\u540c\u65f6\uff0c\u56e0\u4e3a age = 22 \u7b26\u5408\u67e5\u8be2\u6761\u4ef6\uff0c\u4e8e\u662f\u5bf9 age = 22 \u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u4e0a\u8bb0\u5f55\u9501\uff0c\u5373\u5bf9 id = 10 \u8fd9\u4e00\u884c\u52a0\u8bb0\u5f55\u9501\u3002</li> <li>\u63a5\u7740\u7ee7\u7eed\u626b\u63cf\uff0c\u626b\u63cf\u5230\u7684\u7b2c\u4e8c\u884c\u662f age = 39\uff0c\u8be5\u8bb0\u5f55\u662f\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u6240\u4ee5\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684  next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u8303\u56f4\u662f (22, 39)\u3002</li> <li>\u505c\u6b62\u67e5\u8be2\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5bf9\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u90fd\u52a0\u4e86 X \u578b\u7684\u9501\uff1a</p> <p></p> <ul> <li>\u4e3b\u952e\u7d22\u5f15\uff1a</li> <li>\u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 10 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002</li> <li>\u4e8c\u7ea7\u7d22\u5f15\uff08\u975e\u552f\u4e00\u7d22\u5f15\uff09\uff1a</li> <li>\u5728 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 22 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 20 \u548c age = 21 \u65b0\u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u4f1a\u5728\u540e\u9762\u8bf4\u3002</li> <li>\u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u3001\u2026\u2026 \u300138 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u63d2\u5165 age = 22 \u548c age = 39 \u8bb0\u5f55\u7684\u8bed\u53e5\uff0c\u5728\u4e00\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u4f1a\u5728\u540e\u9762\u8bf4\u3002</li> </ul> <p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\u6765\u770b\u770b\u4e8b\u52a1 A \u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u8f93\u51fa\u7ed3\u679c\u5982\u4e0b\uff0c\u6211\u8fd9\u91cc\u53ea\u622a\u53d6\u4e86\u884c\u7ea7\u9501\u7684\u5185\u5bb9\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5bf9\u4e8c\u7ea7\u7d22\u5f15\uff08INDEX_NAME: index_age\uff09\u52a0\u4e86\u4e24\u4e2a X \u578b\u9501\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u5728 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 22 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u9488\u5bf9\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 21 \u548c age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u5206\u6790\u5982\u4e0b\uff1a </li> <li>\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 21 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u5982\u679c\u63d2\u5165 age = 21 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 5\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u63d2\u5165\u6210\u529f\uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 5\uff0cage = 21 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6ca1\u6709\u95f4\u9699\u9501\u3002\u5982\u679c\u63d2\u5165 age = 21 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 5\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u63d2\u5165\u6210\u529f\uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 20\uff0cage = 39 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\u3002</li> <li>\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u4ece <code>LOCK_DATA : 22, 10</code> \u53ef\u4ee5\u5f97\u77e5\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 22 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 10\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\uff1b\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u5927\u4e8e 10\uff0c\u8fd8\u8981\u770b\u8be5\u65b0\u8bb0\u5f55\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f\u5426\u6709\u95f4\u9699\u9501\uff0c\u5982\u679c\u6ca1\u6709\u95f4\u9699\u9501\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\uff0c\u5982\u679c\u6709\u95f4\u9699\u9501\uff0c\u5219\u65e0\u6cd5\u63d2\u5165\u6210\u529f\u3002</li> <li>\u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\u3002\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u3001\u2026\u2026 \u300138 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u9488\u5bf9\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u548c age = 39 \u7684\u65b0\u8bb0\u5f55\uff0c\u5206\u6790\u5982\u4e0b\uff1a </li> <li>\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u5982\u679c\u63d2\u5165 age = 22 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 10\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 10\uff0cage = 22 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff08age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709 next-key \u9501\uff09\u3002\u5982\u679c\u63d2\u5165 age = 21 \u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 10\uff0c\u4e5f\u65e0\u6cd5\u63d2\u5165\uff0c\u56e0\u4e3a\u6b64\u65f6\u63d2\u5165\u7684\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u662f id = 20\uff0cage = 39 \u7684\u8bb0\u5f55\uff0c\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\u3002</li> <li>\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 39 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u4ece <code>LOCK_DATA : 39, 20</code> \u53ef\u4ee5\u5f97\u77e5\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 39 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 20\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u5927\u4e8e 20\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u3002</li> </ul> <p>\u540c\u65f6\uff0c\u4e8b\u52a1 A  \u8fd8\u5bf9\u4e3b\u952e\u7d22\u5f15\uff08INDEX_NAME: PRIMARY\uff09\u52a0\u4e86 X \u578b\u7684\u8bb0\u5f55\u9501\uff1a</p> <ul> <li>\u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 10 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002</li> </ul> <p>\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u5b9e\u9a8c\u6848\u4f8b\u4e2d\uff0c\u9700\u8981\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\uff1f</p> <p>\u8981\u627e\u5230\u8fd9\u4e2a\u95ee\u9898\u7684\u7b54\u6848\uff0c\u6211\u4eec\u8981\u660e\u767d MySQL \u5728\u53ef\u91cd\u590d\u8bfb\u7684\u9694\u79bb\u7ea7\u522b\u573a\u666f\u4e0b\uff0c\u4e3a\u4ec0\u4e48\u8981\u5f15\u5165\u95f4\u9699\u9501\uff1f\u5176\u5b9e\u662f\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002</p> <p>\u5982\u679c\u8fd9\u4e2a\u5b9e\u9a8c\u6848\u4f8b\u4e2d\uff1a</p> SQL<pre><code>select * from user where age = 22 for update;\n</code></pre> <p>\u5982\u679c\u4e8b\u52a1 A \u4e0d\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\uff0c\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u4f1a\u6709\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</p> <p>\u524d\u9762\u6211\u4e5f\u8bf4\u8fc7\uff0c\u5728\u975e\u552f\u4e00\u7d22\u5f15\u4e0a\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u662f\u65e0\u6cd5\u5b8c\u5168\u9501\u4f4f age  = 22 \u65b0\u8bb0\u5f55\u7684\u63d2\u5165\uff0c\u56e0\u4e3a\u5bf9\u4e8e\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u8981\u770b\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u4ece <code>LOCK_DATA : 22, 10</code> \u53ef\u4ee5\u5f97\u77e5\uff0c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165 age \u503c\u4e3a 22 \u7684\u65b0\u8bb0\u5f55\u65f6\uff0c\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5c0f\u4e8e 10\uff0c\u90a3\u4e48\u63d2\u5165\u8bed\u53e5\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u5982\u679c\u63d2\u5165\u7684\u65b0\u8bb0\u5f55\u7684 id \u503c\u5927\u4e8e 10\uff0c\u5219\u53ef\u4ee5\u63d2\u5165\u6210\u529f\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\uff08\u975e\u552f\u4e00\u7d22\u5f15\uff09\u4e0a\u52a0\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u5176\u4ed6\u4e8b\u52a1\u662f\u6709\u53ef\u80fd\u63d2\u5165 age \u503c\u4e3a 22 \u7684\u65b0\u8bb0\u5f55\u7684\uff08\u6bd4\u5982\u63d2\u5165\u4e00\u4e2a age = 22\uff0cid = 12 \u7684\u65b0\u8bb0\u5f55\uff09\uff0c\u90a3\u4e48\u5982\u679c\u4e8b\u52a1 A \u518d\u4e00\u6b21\u67e5\u8be2 age = 22 \u7684\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u524d\u540e\u4e24\u6b21\u67e5\u8be2 age = 22 \u7684\u7ed3\u679c\u96c6\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u8fd9\u65f6\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002</p> <p>\u90a3\u4e48\u5f53\u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39) \u7684\u95f4\u9699\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u662f\u65e0\u6cd5\u63d2\u5165\u4e00\u4e2a age = 22\uff0cid = 12 \u7684\u65b0\u8bb0\u5f55\uff0c\u56e0\u4e3a\u5f53\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22\uff0cid = 12 \u7684\u65b0\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5728\u4e8c\u7ea7\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\uff0c\u800c\u8be5\u4f4d\u7f6e\u7684\u4e0b\u4e00\u6761\u662f id = 20\u3001age = 39 \u7684\u8bb0\u5f55\uff0c\u6b63\u597d\u8be5\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u6709\u95f4\u9699\u9501\uff0c\u6240\u4ee5\u8fd9\u6761\u63d2\u5165\u8bed\u53e5\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u63d2\u5165\u6210\u529f\uff0c\u8fd9\u6837\u5c31\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002</p> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\uff0c\u5c31\u9700\u8981\u5728\u4e8c\u7ea7\u7d22\u5f15\u7d22\u5f15\u4e0a\u52a0\u8303\u56f4 (22, 39) \u7684\u95f4\u9699\u9501\u3002</p>"},{"location":"mysql/lock/how_to_lock/#_5","title":"\u975e\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2","text":"<p>\u975e\u552f\u4e00\u7d22\u5f15\u548c\u4e3b\u952e\u7d22\u5f15\u7684\u8303\u56f4\u67e5\u8be2\u7684\u52a0\u9501\u4e5f\u6709\u6240\u4e0d\u540c\uff0c\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\u975e\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u7d22\u5f15\u7684 next-key lock \u4e0d\u4f1a\u6709\u9000\u5316\u4e3a\u95f4\u9699\u9501\u548c\u8bb0\u5f55\u9501\u7684\u60c5\u51b5\uff0c\u4e5f\u5c31\u662f\u975e\u552f\u4e00\u7d22\u5f15\u8fdb\u884c\u8303\u56f4\u67e5\u8be2\u65f6\uff0c\u5bf9\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u9501\u90fd\u662f\u52a0 next-key \u9501\u3002</p> <p>\u5c31\u5e26\u5927\u5bb6\u7b80\u5355\u5206\u6790\u4e00\u4e0b\uff0c\u4e8b\u52a1 A \u7684\u8fd9\u6761\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\uff1a</p> SQL<pre><code>mysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from user where age &gt;= 22  for update;\n+----+-----------+-----+\n| id | name      | age |\n+----+-----------+-----+\n| 10 | \u5c71\u6cbb      |  22 |\n| 20 | \u9999\u514b\u65af    |  39 |\n+----+-----------+-----+\n2 rows in set (0.01 sec)\n</code></pre> <p>\u4e8b\u52a1 A \u7684\u52a0\u9501\u53d8\u5316\uff1a</p> <ul> <li>\u6700\u5f00\u59cb\u8981\u627e\u7684\u7b2c\u4e00\u884c\u662f age = 22\uff0c\u867d\u7136\u8303\u56f4\u67e5\u8be2\u8bed\u53e5\u5305\u542b\u7b49\u503c\u67e5\u8be2\uff0c\u4f46\u662f\u8fd9\u91cc\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u6240\u4ee5\u662f\u4e0d\u4f1a\u53d1\u751f\u9000\u5316\u9501\u7684\u73b0\u8c61\uff0c\u56e0\u6b64\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0 next-key \u9501\uff0c\u8303\u56f4\u662f (21, 22]\u3002\u540c\u65f6\uff0c\u5bf9 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\uff0c\u5373\u5bf9 id = 10 \u8fd9\u4e00\u884c\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\u3002</li> <li>\u7531\u4e8e\u662f\u8303\u56f4\u67e5\u8be2\uff0c\u63a5\u7740\u7ee7\u7eed\u626b\u63cf\u5df2\u7ecf\u5b58\u5728\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u3002\u626b\u9762\u7684\u7b2c\u4e8c\u884c\u662f age = 39 \u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u4e8e\u662f\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0 next-key \u9501\uff0c\u8303\u56f4\u662f (22, 39]\uff0c\u540c\u65f6\uff0c\u5bf9 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\uff0c\u5373\u5bf9 id = 20 \u8fd9\u4e00\u884c\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501\u3002</li> <li>\u867d\u7136\u6211\u4eec\u770b\u89c1\u8868\u4e2d\u6700\u540e\u4e00\u6761\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u662f age = 39 \u7684\u8bb0\u5f55\uff0c\u4f46\u662f\u5b9e\u9645\u5728 Innodb \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u4f1a\u7528\u4e00\u4e2a\u7279\u6b8a\u7684\u8bb0\u5f55\u6765\u6807\u8bc6\u6700\u540e\u4e00\u6761\u8bb0\u5f55\uff0c\u8be5\u7279\u6b8a\u7684\u8bb0\u5f55\u7684\u540d\u5b57\u53eb supremum pseudo-record\uff0c\u6240\u4ee5\u626b\u63cf\u7b2c\u4e8c\u884c\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u626b\u63cf\u5230\u4e86\u8fd9\u4e2a\u7279\u6b8a\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u4f1a\u5bf9\u8be5\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f\u8303\u56f4\u4e3a  (39, +\u221e] \u7684 next-key \u9501\u3002</li> <li>\u505c\u6b62\u67e5\u8be2</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u5bf9\u4e3b\u952e\u7d22\u5f15\u548c\u4e8c\u7ea7\u7d22\u5f15\u90fd\u52a0\u4e86 X \u578b\u7684\u9501\uff1a</p> <p></p> <ul> <li>\u4e3b\u952e\u7d22\u5f15\uff08id \u5217\uff09\uff1a</li> <li>\u5728 id = 10 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 10 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002</li> <li>\u5728 id = 20 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8bb0\u5f55\u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 id = 20 \u7684\u8fd9\u4e00\u884c\u8bb0\u5f55\u3002</li> <li>\u4e8c\u7ea7\u7d22\u5f15\uff08age \u5217\uff09\uff1a</li> <li>\u5728 age = 22 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (21, 22] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 22 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\uff0c\u4e0d\u8fc7\u5bf9\u4e8e\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 21 \u548c age = 22 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u9700\u8981\u770b\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u6709\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u6211\u4eec\u524d\u9762\u4e5f\u8bb2\u4e86\u3002</li> <li>\u5728 age = 39 \u8fd9\u6761\u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (22, 39] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u66f4\u65b0\u6216\u8005\u5220\u9664 age = 39 \u7684\u8fd9\u4e00\u4e9b\u8bb0\u5f55\uff0c\u4e5f\u65e0\u6cd5\u63d2\u5165 age \u503c\u4e3a 23\u300124\u300125\u3001...\u300138 \u7684\u8fd9\u4e00\u4e9b\u65b0\u8bb0\u5f55\u3002\u4e0d\u8fc7\u5bf9\u4e8e\u662f\u5426\u53ef\u4ee5\u63d2\u5165 age = 22 \u548c age = 39 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd8\u9700\u8981\u770b\u65b0\u8bb0\u5f55\u7684 id \u503c\uff0c\u6709\u4e9b\u60c5\u51b5\u662f\u53ef\u4ee5\u6210\u529f\u63d2\u5165\u7684\uff0c\u800c\u4e00\u4e9b\u60c5\u51b5\u5219\u65e0\u6cd5\u63d2\u5165\uff0c\u5177\u4f53\u54ea\u4e9b\u60c5\u51b5\uff0c\u6211\u4eec\u524d\u9762\u4e5f\u8bb2\u4e86\u3002</li> <li>\u5728\u7279\u6b8a\u7684\u8bb0\u5f55\uff08supremum pseudo-record\uff09\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\uff0c\u52a0\u4e86\u8303\u56f4\u4e3a (39, +\u221e] \u7684 next-key \u9501\uff0c\u610f\u5473\u7740\u5176\u4ed6\u4e8b\u52a1\u65e0\u6cd5\u63d2\u5165 age \u503c\u5927\u4e8e 39 \u7684\u8fd9\u4e9b\u65b0\u8bb0\u5f55\u3002</li> </ul> <p>\u5728 age &gt;= 22  \u7684\u8303\u56f4\u67e5\u8be2\u4e2d\uff0c\u660e\u660e\u67e5\u8be2 age = 22 \u7684\u8bb0\u5f55\u5b58\u5728\u5e76\u4e14\u5c5e\u4e8e\u7b49\u503c\u67e5\u8be2\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u50cf\u552f\u4e00\u7d22\u5f15\u90a3\u6837\uff0c\u5c06 age = 22 \u8bb0\u5f55\u7684\u4e8c\u7ea7\u7d22\u5f15\u4e0a\u7684 next-key \u9501\u9000\u5316\u4e3a\u8bb0\u5f55\u9501\uff1f</p> <p>\u56e0\u4e3a age \u5b57\u6bb5\u662f\u975e\u552f\u4e00\u7d22\u5f15\uff0c\u4e0d\u5177\u6709\u552f\u4e00\u6027\uff0c\u6240\u4ee5\u5982\u679c\u53ea\u52a0\u8bb0\u5f55\u9501\uff08\u8bb0\u5f55\u9501\u65e0\u6cd5\u9632\u6b62\u63d2\u5165\uff0c\u53ea\u80fd\u9632\u6b62\u5220\u9664\u6216\u8005\u4fee\u6539\uff09\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761 age = 22 \u7684\u8bb0\u5f55\uff0c\u8fd9\u6837\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u5c31\u4e0d\u76f8\u540c\u4e86\uff0c\u51fa\u73b0\u4e86\u5e7b\u8bfb\u73b0\u8c61\u3002</p>"},{"location":"mysql/lock/how_to_lock/#_6","title":"\u6ca1\u6709\u52a0\u7d22\u5f15\u7684\u67e5\u8be2","text":"<p>\u524d\u9762\u7684\u6848\u4f8b\uff0c\u6211\u4eec\u7684\u67e5\u8be2\u8bed\u53e5\u90fd\u6709\u4f7f\u7528\u7d22\u5f15\u67e5\u8be2\uff0c\u4e5f\u5c31\u662f\u67e5\u8be2\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u662f\u901a\u8fc7\u7d22\u5f15\u626b\u63cf\u7684\u65b9\u5f0f\u67e5\u8be2\u7684\uff0c\u7136\u540e\u5bf9\u626b\u63cf\u51fa\u6765\u7684\u8bb0\u5f55\u8fdb\u884c\u52a0\u9501\u3002</p> <p>\u5982\u679c\u9501\u5b9a\u8bfb\u67e5\u8be2\u8bed\u53e5\uff0c\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\u5217\u4f5c\u4e3a\u67e5\u8be2\u6761\u4ef6\uff0c\u6216\u8005\u67e5\u8be2\u8bed\u53e5\u6ca1\u6709\u8d70\u7d22\u5f15\u67e5\u8be2\uff0c\u5bfc\u81f4\u626b\u63cf\u662f\u5168\u8868\u626b\u63cf\u3002\u90a3\u4e48\uff0c\u6bcf\u4e00\u6761\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u90fd\u4f1a\u52a0 next-key \u9501\uff0c\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u9501\u4f4f\u7684\u5168\u8868\uff0c\u8fd9\u65f6\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u5bf9\u8be5\u8868\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u4e0d\u53ea\u662f\u9501\u5b9a\u8bfb\u67e5\u8be2\u8bed\u53e5\u4e0d\u52a0\u7d22\u5f15\u624d\u4f1a\u5bfc\u81f4\u8fd9\u79cd\u60c5\u51b5\uff0cupdate \u548c delete \u8bed\u53e5\u5982\u679c\u67e5\u8be2\u6761\u4ef6\u4e0d\u52a0\u7d22\u5f15\uff0c\u90a3\u4e48\u7531\u4e8e\u626b\u63cf\u7684\u65b9\u5f0f\u662f\u5168\u8868\u626b\u63cf\uff0c\u4e8e\u662f\u5c31\u4f1a\u5bf9\u6bcf\u4e00\u6761\u8bb0\u5f55\u7684\u7d22\u5f15\u4e0a\u90fd\u4f1a\u52a0 next-key \u9501\uff0c\u8fd9\u6837\u5c31\u76f8\u5f53\u4e8e\u9501\u4f4f\u7684\u5168\u8868\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u7ebf\u4e0a\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86\uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002</p>"},{"location":"mysql/lock/how_to_lock/#_7","title":"\u603b\u7ed3","text":"<p>\u8fd9\u6b21\u6211\u4ee5 MySQL 8.0.26 \u7248\u672c\uff0c\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e4b\u4e0b\uff0c\u505a\u4e86\u51e0\u4e2a\u5b9e\u9a8c\uff0c\u8ba9\u5927\u5bb6\u4e86\u89e3\u4e86\u552f\u4e00\u7d22\u5f15\u548c\u975e\u552f\u4e00\u7d22\u5f15\u7684\u884c\u7ea7\u9501\u7684\u52a0\u9501\u89c4\u5219\u3002</p> <p>\u6211\u8fd9\u91cc\u603b\u7ed3\u4e0b\uff0cMySQL \u884c\u7ea7\u9501\u7684\u52a0\u9501\u89c4\u5219\u3002</p> <p>\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\uff1a</p> <ul> <li>\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u4e0a\u5b9a\u4f4d\u5230\u8fd9\u4e00\u6761\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u300c\u8bb0\u5f55\u9501\u300d\u3002</li> <li>\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u662f\u300c\u4e0d\u5b58\u5728\u300d\u7684\uff0c\u5728\u7d22\u5f15\u6811\u627e\u5230\u7b2c\u4e00\u6761\u5927\u4e8e\u8be5\u67e5\u8be2\u8bb0\u5f55\u7684\u8bb0\u5f55\u540e\uff0c\u5c06\u8be5\u8bb0\u5f55\u7684\u7d22\u5f15\u4e2d\u7684 next-key lock \u4f1a\u9000\u5316\u6210\u300c\u95f4\u9699\u9501\u300d\u3002</li> </ul> <p>\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\uff1a</p> <ul> <li>\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u5b58\u5728\u300d\u65f6\uff0c\u7531\u4e8e\u4e0d\u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u80af\u5b9a\u5b58\u5728\u7d22\u5f15\u503c\u76f8\u540c\u7684\u8bb0\u5f55\uff0c\u4e8e\u662f\u975e\u552f\u4e00\u7d22\u5f15\u7b49\u503c\u67e5\u8be2\u7684\u8fc7\u7a0b\u662f\u4e00\u4e2a\u626b\u63cf\u7684\u8fc7\u7a0b\uff0c\u76f4\u5230\u626b\u63cf\u5230\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u5c31\u505c\u6b62\u626b\u63cf\uff0c\u7136\u540e\u5728\u626b\u63cf\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5bf9\u626b\u63cf\u5230\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\u52a0\u7684\u662f next-key \u9501\uff0c\u800c\u5bf9\u4e8e\u7b2c\u4e00\u4e2a\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684 next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u540c\u65f6\uff0c\u5728\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\u7684\u4e3b\u952e\u7d22\u5f15\u4e0a\u52a0\u8bb0\u5f55\u9501\u3002</li> <li>\u5f53\u67e5\u8be2\u7684\u8bb0\u5f55\u300c\u4e0d\u5b58\u5728\u300d\u65f6\uff0c\u626b\u63cf\u5230\u7b2c\u4e00\u6761\u4e0d\u7b26\u5408\u6761\u4ef6\u7684\u4e8c\u7ea7\u7d22\u5f15\u8bb0\u5f55\uff0c\u8be5\u4e8c\u7ea7\u7d22\u5f15\u7684  next-key \u9501\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\u3002\u56e0\u4e3a\u4e0d\u5b58\u5728\u6ee1\u8db3\u67e5\u8be2\u6761\u4ef6\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bf9\u4e3b\u952e\u7d22\u5f15\u52a0\u9501\u3002</li> </ul> <p>\u975e\u552f\u4e00\u7d22\u5f15\u548c\u4e3b\u952e\u7d22\u5f15\u7684\u8303\u56f4\u67e5\u8be2\u7684\u52a0\u9501\u89c4\u5219\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e\uff1a</p> <ul> <li>\u552f\u4e00\u7d22\u5f15\u5728\u6ee1\u8db3\u4e00\u4e9b\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u7d22\u5f15\u7684 next-key lock \u9000\u5316\u4e3a\u95f4\u9699\u9501\u6216\u8005\u8bb0\u5f55\u9501\u3002</li> <li>\u975e\u552f\u4e00\u7d22\u5f15\u8303\u56f4\u67e5\u8be2\uff0c\u7d22\u5f15\u7684 next-key lock \u4e0d\u4f1a\u9000\u5316\u4e3a\u95f4\u9699\u9501\u548c\u8bb0\u5f55\u9501\u3002</li> </ul> <p>\u5176\u5b9e\u7406\u89e3 MySQL \u4e3a\u4ec0\u4e48\u8981\u8fd9\u6837\u52a0\u9501\uff0c\u4e3b\u8981\u8981\u4ee5\u907f\u514d\u5e7b\u8bfb\u89d2\u5ea6\u53bb\u5206\u6790\uff0c\u8fd9\u6837\u5c31\u5f88\u5bb9\u6613\u7406\u89e3\u8fd9\u4e9b\u52a0\u9501\u7684\u89c4\u5219\u4e86\u3002</p> <p>\u8fd8\u6709\u4e00\u4ef6\u5f88\u91cd\u8981\u7684\u4e8b\u60c5\uff0c\u5728\u7ebf\u4e0a\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86\uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002</p> <p>\u6700\u540e\u9644\u4e0a\u300c@\u4e00\u53ea\u5c0f\u94ed\u300d\u540c\u5b66\u603b\u7ed3\u7684\u6d41\u7a0b\u56fe\u3002</p> <p>\u552f\u4e00\u7d22\u5f15\u52a0\u9501\u7684\u6d41\u7a0b\u56fe\uff1a</p> <p></p> <p>\u975e\u552f\u4e00\u7d22\u5f15\u52a0\u9501\u7684\u6d41\u7a0b\u56fe\uff1a</p> <p></p> <p>\u5c31\u8bf4\u5230\u8fd9\u5566\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\u5566\uff01</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/lock/lock_phantom/","title":"MySQL \u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6628\u5929\u6709\u4f4d\u8bfb\u8005\u5728\u7f8e\u56e2\u4e8c\u9762\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\u5173\u4e8e\u5e7b\u8bfb\u7684\u95ee\u9898\uff1a</p> <p></p> <p>\u9762\u8bd5\u5b98\u53cd\u95ee\u7684\u5927\u6982\u610f\u601d\u662f\uff0cMySQL \u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u5417\uff1f</p> <p>\u7b54\u6848\u662f\u53ef\u4ee5\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u51e0\u4e2a\u5c0f\u5b9e\u9a8c\u6765\u8bc1\u660e\u8fd9\u4e2a\u7ed3\u8bba\u5427\uff0c\u987a\u4fbf\u518d\u5e2e\u5927\u5bb6\u590d\u4e60\u4e00\u4e0b\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\u3002</p>"},{"location":"mysql/lock/lock_phantom/#_1","title":"\u4ec0\u4e48\u662f\u5e7b\u8bfb\uff1f","text":"<p>\u9996\u5148\u6765\u770b\u770b MySQL \u6587\u6863\u662f\u600e\u4e48\u5b9a\u4e49\u5e7b\u8bfb\uff08Phantom Read\uff09\u7684\uff1a</p> <p>The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. For example, if a SELECT is executed twice, but returns a row the second time that was not returned the first time, the row is a \u201cphantom\u201d row.</p> <p>\u7ffb\u8bd1\uff1a\u5f53\u540c\u4e00\u4e2a\u67e5\u8be2\u5728\u4e0d\u540c\u7684\u65f6\u95f4\u4ea7\u751f\u4e0d\u540c\u7684\u7ed3\u679c\u96c6\u65f6\uff0c\u4e8b\u52a1\u4e2d\u5c31\u4f1a\u51fa\u73b0\u6240\u8c13\u7684\u5e7b\u8c61\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5982\u679c SELECT \u6267\u884c\u4e86\u4e24\u6b21\uff0c\u4f46\u7b2c\u4e8c\u6b21\u8fd4\u56de\u4e86\u7b2c\u4e00\u6b21\u6ca1\u6709\u8fd4\u56de\u7684\u884c\uff0c\u5219\u8be5\u884c\u662f\u201c\u5e7b\u50cf\u201d\u884c\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e00\u4e2a\u4e8b\u52a1\u5728 T1 \u65f6\u523b\u548c T2 \u65f6\u523b\u5206\u522b\u6267\u884c\u4e86\u4e0b\u9762\u67e5\u8be2\u8bed\u53e5\uff0c\u9014\u4e2d\u6ca1\u6709\u6267\u884c\u5176\u4ed6\u4efb\u4f55\u8bed\u53e5\uff1a</p> SQL<pre><code>SELECT * FROM t_test WHERE id &gt; 100;\n</code></pre> <p>\u53ea\u8981 T1 \u548c T2 \u65f6\u523b\u6267\u884c\u4ea7\u751f\u7684\u7ed3\u679c\u96c6\u662f\u4e0d\u76f8\u540c\u7684\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\uff0c\u6bd4\u5982\uff1a -   T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 6 \u6761\u884c\u8bb0\u5f55\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002 -   T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 4 \u6761\u884c\u8bb0\u5f55\uff0c\u4e5f\u662f\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</p> <p>MySQL  \u662f\u600e\u4e48\u89e3\u51b3\u5e7b\u8bfb\u7684\uff1f</p> <p>MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u8be6\u89c1\u8fd9\u7bc7\u6587\u7ae0\uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a -   \u9488\u5bf9\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002 -   \u9488\u5bf9\u5f53\u524d\u8bfb\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002</p>"},{"location":"mysql/lock/lock_phantom/#_2","title":"\u5b9e\u9a8c\u9a8c\u8bc1","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6765\u9a8c\u8bc1\u300cMySQL \u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u95ee\u9898\u300d\u7684\u7ed3\u8bba\u3002</p> <p>\u5b9e\u9a8c\u73af\u5883\uff1aMySQL 8.0 \u7248\u672c\uff0c\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u3002</p> <p>\u73b0\u5728\u6709\u4e00\u5f20\u7528\u6237\u8868\uff08t_user\uff09\uff0c\u8868\u91cc\u53ea\u6709\u4e00\u4e2a\u4e3b\u952e\u7d22\u5f15\uff0c\u8868\u91cc\u6709\u4ee5\u4e0b\u884c\u6570\u636e\uff1a</p> <p></p> <p>\u73b0\u5728\u6709\u4e00\u4e2a A \u4e8b\u52a1\u6267\u884c\u4e86\u4e00\u6761\u67e5\u8be2\u8bed\u53e5\uff0c\u67e5\u8be2\u5230\u5e74\u9f84\u5927\u4e8e 20 \u5c81\u7684\u7528\u6237\u5171\u6709 6 \u6761\u884c\u8bb0\u5f55\u3002</p> <p></p> <p>\u7136\u540e\uff0cB \u4e8b\u52a1\u6267\u884c\u4e86\u4e00\u6761\u5220\u9664 id = 2 \u7684\u8bed\u53e5\uff1a</p> <p></p> <p>\u6b64\u65f6\uff0cB \u4e8b\u52a1\u7684\u5220\u9664\u8bed\u53e5\u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\uff0c\u8bf4\u660e\u662f\u65e0\u6cd5\u8fdb\u884c\u5220\u9664\u7684\u3002</p> <p>\u56e0\u6b64\uff0cMySQL \u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\u53ef\u4ee5\u9632\u6b62\u5220\u9664\u64cd\u4f5c\u800c\u5bfc\u81f4\u7684\u5e7b\u8bfb\u95ee\u9898\u3002</p>"},{"location":"mysql/lock/lock_phantom/#_3","title":"\u52a0\u9501\u5206\u6790","text":"<p>\u95ee\u9898\u6765\u4e86\uff0cA \u4e8b\u52a1\u5728\u6267\u884c select ... for update \u8bed\u53e5\u65f6\uff0c\u5177\u4f53\u52a0\u4e86\u4ec0\u4e48\u9501\u5462\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u8f93\u51fa\u7684\u5185\u5bb9\u5f88\u591a\uff0c\u5171\u6709 11 \u884c\u4fe1\u606f\uff0c\u6211\u5220\u51cf\u4e86\u4e00\u4e9b\u4e0d\u91cd\u8981\u7684\u4fe1\u606f\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u8f93\u51fa\u7684\u4fe1\u606f\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u79cd\u4e0d\u540c\u7c92\u5ea6\u7684\u9501\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u8868\u9501\uff08<code>LOCK_TYPE: TABLE</code>\uff09\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b</li> <li>\u884c\u9501\uff08<code>LOCK_TYPE: RECORD</code>\uff09\uff1aX \u7c7b\u578b\u7684 next-key \u9501\uff1b</li> </ul> <p>\u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u300c\u884c\u9501\u300d\uff0c\u56fe\u4e2d <code>LOCK_TYPE</code> \u4e2d\u7684 <code>RECORD</code> \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\uff1a - \u5982\u679c LOCK_MODE \u4e3a <code>X</code>\uff0c\u8bf4\u660e\u662f next-key \u9501\uff1b - \u5982\u679c LOCK_MODE \u4e3a <code>X, REC_NOT_GAP</code>\uff0c\u8bf4\u660e\u662f\u8bb0\u5f55\u9501\uff1b - \u5982\u679c LOCK_MODE \u4e3a <code>X, GAP</code>\uff0c\u8bf4\u660e\u662f\u95f4\u9699\u9501\uff1b</p> <p>\u7136\u540e\u901a\u8fc7 <code>LOCK_DATA</code> \u4fe1\u606f\uff0c\u53ef\u4ee5\u786e\u8ba4 next-key \u9501\u7684\u8303\u56f4\uff0c\u5177\u4f53\u600e\u4e48\u786e\u5b9a\u5462\uff1f</p> <ul> <li>\u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u6700\u53f3\u503c\uff0c\u800c\u9501\u8303\u56f4\u7684\u6700\u5de6\u503c\u4e3a LOCK_DATA \u7684\u4e0a\u4e00\u6761\u8bb0\u5f55\u7684\u503c\u3002</li> </ul> <p>\u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\uff08<code>INDEX_NAME : PRIMARY</code>\uff09\u4e0a\u52a0\u4e86 10 \u4e2a next-key \u9501\uff0c\u5982\u4e0b\uff1a -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(-\u221e, 1] -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(1, 2] -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(2, 3] -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(3, 4] -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(4, 5] -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(5, 6] -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(6, 7] -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(7, 8] -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(8, 9] -   X \u578b\u7684 next-key \u9501\uff0c\u8303\u56f4\uff1a(9, +\u221e]</p> <p>\u8fd9\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u7ed9\u9501\u4f4f\u4e86\uff0c\u5176\u4ed6\u4e8b\u52a1\u5728\u5bf9\u8be5\u8868\u8fdb\u884c\u589e\u3001\u5220\u3001\u6539\u64cd\u4f5c\u7684\u65f6\u5019\u90fd\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u53ea\u6709\u5728\u4e8b\u52a1 A \u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u4e8b\u52a1 A \u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u9501\u624d\u4f1a\u88ab\u91ca\u653e\u3002</p> <p>\u4e3a\u4ec0\u4e48\u53ea\u662f\u67e5\u8be2\u5e74\u9f84 20 \u5c81\u4ee5\u4e0a\u884c\u8bb0\u5f55\uff0c\u800c\u628a\u6574\u4e2a\u8868\u7ed9\u9501\u4f4f\u4e86\u5462\uff1f</p> <p>\u8fd9\u662f\u56e0\u4e3a\u4e8b\u52a1 A \u7684\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u662f\u5168\u8868\u626b\u63cf\uff0c\u9501\u662f\u5728\u904d\u5386\u7d22\u5f15\u7684\u65f6\u5019\u52a0\u4e0a\u7684\uff0c\u5e76\u4e0d\u662f\u9488\u5bf9\u8f93\u51fa\u7684\u7ed3\u679c\u52a0\u9501\u3002</p> <p></p> <p>\u56e0\u6b64\uff0c\u5728\u7ebf\u4e0a\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86\uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002</p> <p>\u5982\u679c\u5bf9 age \u5efa\u7acb\u7d22\u5f15\uff0c\u4e8b\u52a1 A \u8fd9\u6761\u67e5\u8be2\u4f1a\u52a0\u4ec0\u4e48\u9501\u5462\uff1f</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u5bf9 age \u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15\uff0c\u7136\u540e\u518d\u6267\u884c\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u7ee7\u7eed\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u5177\u4f53\u7684\u4fe1\u606f\uff0c\u6211\u5c31\u4e0d\u6253\u5370\u4e86\uff0c\u6211\u76f4\u63a5\u8bf4\u7ed3\u8bba\u5427\u3002</p> <p>\u56e0\u4e3a\u8868\u4e2d\u6709\u4e24\u4e2a\u7d22\u5f15\uff0c\u5206\u522b\u662f\u4e3b\u952e\u7d22\u5f15\u548c age \u7d22\u5f15\uff0c\u6240\u4ee5\u4f1a\u5206\u522b\u5bf9\u8fd9\u4e24\u4e2a\u7d22\u5f15\u52a0\u9501\u3002</p> <p>\u4e3b\u952e\u7d22\u5f15\u4f1a\u52a0\u5982\u4e0b\u7684\u9501\uff1a -  X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 2 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 3 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 5 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 6 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 7 \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f id = 8 \u7684\u8bb0\u5f55\uff1b</p> <p>\u5206\u6790 age \u7d22\u5f15\u52a0\u9501\u7684\u8303\u56f4\u65f6\uff0c\u8981\u5148\u5bf9 age \u5b57\u6bb5\u8fdb\u884c\u6392\u5e8f\u3002 </p> <p>age \u7d22\u5f15\u52a0\u7684\u9501\uff1a - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (19, 21] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (21, 21] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (21, 23] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (23, 23] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (23, 39] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (39, 43] \u7684\u8bb0\u5f55\uff1b - X \u578b\u7684 next-key lock\uff0c\u9501\u4f4f age \u8303\u56f4 (43, +\u221e] \u7684\u8bb0\u5f55\uff1b</p> <p>\u5316\u7b80\u4e00\u4e0b\uff0cage \u7d22\u5f15  next-key \u9501\u7684\u8303\u56f4\u662f (19, +\u221e]\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5bf9 age \u5b57\u6bb5\u5efa\u7acb\u4e86\u7d22\u5f15\u540e\uff0c\u67e5\u8be2\u8bed\u53e5\u662f\u7d22\u5f15\u67e5\u8be2\uff0c\u5e76\u4e0d\u4f1a\u5168\u8868\u626b\u63cf\uff0c\u56e0\u6b64\u4e0d\u4f1a\u628a\u6574\u5f20\u8868\u7ed9\u9501\u4f4f\u3002</p> <p></p> <p>\u603b\u7ed3\u4e00\u4e0b\uff0c\u5728\u5bf9 age \u5b57\u6bb5\u5efa\u7acb\u7d22\u5f15\u540e\uff0c\u4e8b\u52a1 A \u5728\u6267\u884c\u4e0b\u9762\u8fd9\u6761\u67e5\u8be2\u8bed\u53e5\u540e\uff0c\u4e3b\u952e\u7d22\u5f15\u548c age \u7d22\u5f15\u4f1a\u52a0\u4e0b\u56fe\u4e2d\u7684\u9501\u3002</p> <p></p> <p>\u4e8b\u52a1 A \u52a0\u4e0a\u9501\u540e\uff0c\u4e8b\u52a1 B\u3001C\u3001D\u3001E \u5728\u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\u90fd\u4f1a\u88ab\u963b\u585e\u3002</p> <p></p>"},{"location":"mysql/lock/lock_phantom/#_4","title":"\u603b\u7ed3","text":"<p>\u5728 MySQL \u7684\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u9488\u5bf9\u5f53\u524d\u8bfb\u7684\u8bed\u53e5\u4f1a\u5bf9\u7d22\u5f15\u52a0\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u6267\u884c\u589e\u3001\u5220\u3001\u6539\u65f6\u5bfc\u81f4\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</p> <p>\u6709\u4e00\u70b9\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u6267\u884c update\u3001delete\u3001select ... for update \u7b49\u5177\u6709\u52a0\u9501\u6027\u8d28\u7684\u8bed\u53e5\uff0c\u4e00\u5b9a\u8981\u68c0\u67e5\u8bed\u53e5\u662f\u5426\u8d70\u4e86\u7d22\u5f15\uff0c\u5982\u679c\u662f\u5168\u8868\u626b\u63cf\u7684\u8bdd\uff0c\u4f1a\u5bf9\u6bcf\u4e00\u4e2a\u7d22\u5f15\u52a0 next-key \u9501\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86\uff0c\u8fd9\u662f\u633a\u4e25\u91cd\u7684\u95ee\u9898\u3002</p> <p>\u5b8c\uff01</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/lock/mysql_lock/","title":"MySQL \u6709\u54ea\u4e9b\u9501\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u8fd9\u6b21\uff0c\u6765\u8bf4\u8bf4 MySQL \u7684\u9501\uff0c\u4e3b\u8981\u662f Q&amp;A \u7684\u5f62\u5f0f\uff0c\u770b\u8d77\u6765\u4f1a\u6bd4\u8f83\u8f7b\u677e\u3002</p> <p>\u4e0d\u591a BB \u4e86\uff0c\u53d1\u8f66\uff01</p> <p>\u5728 MySQL \u91cc\uff0c\u6839\u636e\u52a0\u9501\u7684\u8303\u56f4\uff0c\u53ef\u4ee5\u5206\u4e3a\u5168\u5c40\u9501\u3001\u8868\u7ea7\u9501\u548c\u884c\u9501\u4e09\u7c7b\u3002</p> <p></p>"},{"location":"mysql/lock/mysql_lock/#_1","title":"\u5168\u5c40\u9501","text":"<p>\u5168\u5c40\u9501\u662f\u600e\u4e48\u7528\u7684\uff1f</p> <p>\u8981\u4f7f\u7528\u5168\u5c40\u9501\uff0c\u5219\u8981\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff1a</p> SQL<pre><code>flush tables with read lock\n</code></pre> <p>\u6267\u884c\u540e\uff0c\u6574\u4e2a\u6570\u636e\u5e93\u5c31\u5904\u4e8e\u53ea\u8bfb\u72b6\u6001\u4e86\uff0c\u8fd9\u65f6\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u4ee5\u4e0b\u64cd\u4f5c\uff0c\u90fd\u4f1a\u88ab\u963b\u585e\uff1a</p> <ul> <li>\u5bf9\u6570\u636e\u7684\u589e\u5220\u6539\u64cd\u4f5c\uff0c\u6bd4\u5982 insert\u3001delete\u3001update \u7b49\u8bed\u53e5\uff1b</li> <li>\u5bf9\u8868\u7ed3\u6784\u7684\u66f4\u6539\u64cd\u4f5c\uff0c\u6bd4\u5982 alter table\u3001drop table \u7b49\u8bed\u53e5\u3002</li> </ul> <p>\u5982\u679c\u8981\u91ca\u653e\u5168\u5c40\u9501\uff0c\u5219\u8981\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff1a</p> SQL<pre><code>unlock tables\n</code></pre> <p>\u5f53\u7136\uff0c\u5f53\u4f1a\u8bdd\u65ad\u5f00\u4e86\uff0c\u5168\u5c40\u9501\u4f1a\u88ab\u81ea\u52a8\u91ca\u653e\u3002</p> <p>\u5168\u5c40\u9501\u5e94\u7528\u573a\u666f\u662f\u4ec0\u4e48\uff1f</p> <p>\u5168\u5c40\u9501\u4e3b\u8981\u5e94\u7528\u4e8e\u505a\u5168\u5e93\u903b\u8f91\u5907\u4efd\uff0c\u8fd9\u6837\u5728\u5907\u4efd\u6570\u636e\u5e93\u671f\u95f4\uff0c\u4e0d\u4f1a\u56e0\u4e3a\u6570\u636e\u6216\u8868\u7ed3\u6784\u7684\u66f4\u65b0\uff0c\u800c\u51fa\u73b0\u5907\u4efd\u6587\u4ef6\u7684\u6570\u636e\u4e0e\u9884\u671f\u7684\u4e0d\u4e00\u6837\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\u5927\u5bb6\u5c31\u77e5\u9053\u4e86\u3002</p> <p>\u5728\u5168\u5e93\u903b\u8f91\u5907\u4efd\u671f\u95f4\uff0c\u5047\u8bbe\u4e0d\u52a0\u5168\u5c40\u9501\u7684\u573a\u666f\uff0c\u770b\u770b\u4f1a\u51fa\u73b0\u4ec0\u4e48\u610f\u5916\u7684\u60c5\u51b5\u3002</p> <p>\u5982\u679c\u5728\u5168\u5e93\u903b\u8f91\u5907\u4efd\u671f\u95f4\uff0c\u6709\u7528\u6237\u8d2d\u4e70\u4e86\u4e00\u4ef6\u5546\u54c1\uff0c\u4e00\u822c\u8d2d\u4e70\u5546\u54c1\u7684\u4e1a\u52a1\u903b\u8f91\u662f\u4f1a\u6d89\u53ca\u5230\u591a\u5f20\u6570\u636e\u5e93\u8868\u7684\u66f4\u65b0\uff0c\u6bd4\u5982\u5728\u7528\u6237\u8868\u66f4\u65b0\u8be5\u7528\u6237\u7684\u4f59\u989d\uff0c\u7136\u540e\u5728\u5546\u54c1\u8868\u66f4\u65b0\u88ab\u8d2d\u4e70\u7684\u5546\u54c1\u7684\u5e93\u5b58\u3002</p> <p>\u90a3\u4e48\uff0c\u6709\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u987a\u5e8f\uff1a</p> <ol> <li>\u5148\u5907\u4efd\u4e86\u7528\u6237\u8868\u7684\u6570\u636e\uff1b</li> <li>\u7136\u540e\u6709\u7528\u6237\u53d1\u8d77\u4e86\u8d2d\u4e70\u5546\u54c1\u7684\u64cd\u4f5c\uff1b</li> <li>\u63a5\u7740\u518d\u5907\u4efd\u5546\u54c1\u8868\u7684\u6570\u636e\u3002</li> </ol> <p>\u4e5f\u5c31\u662f\u5728\u5907\u4efd\u7528\u6237\u8868\u548c\u5546\u54c1\u8868\u4e4b\u95f4\uff0c\u6709\u7528\u6237\u8d2d\u4e70\u4e86\u5546\u54c1\u3002</p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u5907\u4efd\u7684\u7ed3\u679c\u662f\u7528\u6237\u8868\u4e2d\u8be5\u7528\u6237\u7684\u4f59\u989d\u5e76\u6ca1\u6709\u6263\u9664\uff0c\u53cd\u800c\u5546\u54c1\u8868\u4e2d\u8be5\u5546\u54c1\u7684\u5e93\u5b58\u88ab\u51cf\u5c11\u4e86\uff0c\u5982\u679c\u540e\u9762\u7528\u8fd9\u4e2a\u5907\u4efd\u6587\u4ef6\u6062\u590d\u6570\u636e\u5e93\u6570\u636e\u7684\u8bdd\uff0c\u7528\u6237\u94b1\u6ca1\u5c11\uff0c\u800c\u5e93\u5b58\u5c11\u4e86\uff0c\u7b49\u4e8e\u7528\u6237\u767d\u5ad6\u4e86\u4e00\u4ef6\u5546\u54c1\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u5168\u5e93\u903b\u8f91\u5907\u4efd\u671f\u95f4\uff0c\u52a0\u4e0a\u5168\u5c40\u9501\uff0c\u5c31\u4e0d\u4f1a\u51fa\u73b0\u4e0a\u9762\u8fd9\u79cd\u60c5\u51b5\u4e86\u3002</p> <p>\u52a0\u5168\u5c40\u9501\u53c8\u4f1a\u5e26\u6765\u4ec0\u4e48\u7f3a\u70b9\u5462\uff1f</p> <p>\u52a0\u4e0a\u5168\u5c40\u9501\uff0c\u610f\u5473\u7740\u6574\u4e2a\u6570\u636e\u5e93\u90fd\u662f\u53ea\u8bfb\u72b6\u6001\u3002</p> <p>\u90a3\u4e48\u5982\u679c\u6570\u636e\u5e93\u91cc\u6709\u5f88\u591a\u6570\u636e\uff0c\u5907\u4efd\u5c31\u4f1a\u82b1\u8d39\u5f88\u591a\u7684\u65f6\u95f4\uff0c\u5173\u952e\u662f\u5907\u4efd\u671f\u95f4\uff0c\u4e1a\u52a1\u53ea\u80fd\u8bfb\u6570\u636e\uff0c\u800c\u4e0d\u80fd\u66f4\u65b0\u6570\u636e\uff0c\u8fd9\u6837\u4f1a\u9020\u6210\u4e1a\u52a1\u505c\u6ede\u3002</p> <p>\u65e2\u7136\u5907\u4efd\u6570\u636e\u5e93\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u5168\u5c40\u9501\u4f1a\u5f71\u54cd\u4e1a\u52a1\uff0c\u90a3\u6709\u4ec0\u4e48\u5176\u4ed6\u65b9\u5f0f\u53ef\u4ee5\u907f\u514d\uff1f</p> <p>\u6709\u7684\uff0c\u5982\u679c\u6570\u636e\u5e93\u7684\u5f15\u64ce\u652f\u6301\u7684\u4e8b\u52a1\u652f\u6301\u53ef\u91cd\u590d\u8bfb\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u90a3\u4e48\u5728\u5907\u4efd\u6570\u636e\u5e93\u4e4b\u524d\u5148\u5f00\u542f\u4e8b\u52a1\uff0c\u4f1a\u5148\u521b\u5efa Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u6267\u884c\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a  Read View\uff0c\u800c\u4e14\u7531\u4e8e MVCC \u7684\u652f\u6301\uff0c\u5907\u4efd\u671f\u95f4\u4e1a\u52a1\u4f9d\u7136\u53ef\u4ee5\u5bf9\u6570\u636e\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u3002</p> <p>\u56e0\u4e3a\u5728\u53ef\u91cd\u590d\u8bfb\u7684\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u5373\u4f7f\u5176\u4ed6\u4e8b\u52a1\u66f4\u65b0\u4e86\u8868\u7684\u6570\u636e\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u5907\u4efd\u6570\u636e\u5e93\u65f6\u7684 Read View\uff0c\u8fd9\u5c31\u662f\u4e8b\u52a1\u56db\u5927\u7279\u6027\u4e2d\u7684\u9694\u79bb\u6027\uff0c\u8fd9\u6837\u5907\u4efd\u671f\u95f4\u5907\u4efd\u7684\u6570\u636e\u4e00\u76f4\u662f\u5728\u5f00\u542f\u4e8b\u52a1\u65f6\u7684\u6570\u636e\u3002</p> <p>\u5907\u4efd\u6570\u636e\u5e93\u7684\u5de5\u5177\u662f mysqldump\uff0c\u5728\u4f7f\u7528 mysqldump \u65f6\u52a0\u4e0a <code>\u2013single-transaction</code> \u53c2\u6570\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5728\u5907\u4efd\u6570\u636e\u5e93\u4e4b\u524d\u5148\u5f00\u542f\u4e8b\u52a1\u3002\u8fd9\u79cd\u65b9\u6cd5\u53ea\u9002\u7528\u4e8e\u652f\u6301\u300c\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u300d\u7684\u5b58\u50a8\u5f15\u64ce\u3002</p> <p>InnoDB \u5b58\u50a8\u5f15\u64ce\u9ed8\u8ba4\u7684\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u6b63\u662f\u53ef\u91cd\u590d\u8bfb\uff0c\u56e0\u6b64\u53ef\u4ee5\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u6765\u5907\u4efd\u6570\u636e\u5e93\u3002</p> <p>\u4f46\u662f\uff0c\u5bf9\u4e8e MyISAM \u8fd9\u79cd\u4e0d\u652f\u6301\u4e8b\u52a1\u7684\u5f15\u64ce\uff0c\u5728\u5907\u4efd\u6570\u636e\u5e93\u65f6\u5c31\u8981\u4f7f\u7528\u5168\u5c40\u9501\u7684\u65b9\u6cd5\u3002</p>"},{"location":"mysql/lock/mysql_lock/#_2","title":"\u8868\u7ea7\u9501","text":"<p>MySQL \u8868\u7ea7\u9501\u6709\u54ea\u4e9b\uff1f\u5177\u4f53\u600e\u4e48\u7528\u7684\u3002</p> <p>MySQL \u91cc\u9762\u8868\u7ea7\u522b\u7684\u9501\u6709\u8fd9\u51e0\u79cd\uff1a</p> <ul> <li>\u8868\u9501\uff1b</li> <li>\u5143\u6570\u636e\u9501\uff08MDL\uff09;</li> <li>\u610f\u5411\u9501\uff1b</li> <li>AUTO-INC \u9501\uff1b</li> </ul>"},{"location":"mysql/lock/mysql_lock/#_3","title":"\u8868\u9501","text":"<p>\u5148\u6765\u8bf4\u8bf4\u8868\u9501\u3002</p> <p>\u5982\u679c\u6211\u4eec\u60f3\u5bf9\u5b66\u751f\u8868\uff08t_student\uff09\u52a0\u8868\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff1a</p> SQL<pre><code>//\u8868\u7ea7\u522b\u7684\u5171\u4eab\u9501\uff0c\u4e5f\u5c31\u662f\u8bfb\u9501\uff1b\nlock tables t_student read;\n\n//\u8868\u7ea7\u522b\u7684\u72ec\u5360\u9501\uff0c\u4e5f\u5c31\u662f\u5199\u9501\uff1b\nlock tables t_student write;\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8868\u9501\u9664\u4e86\u4f1a\u9650\u5236\u522b\u7684\u7ebf\u7a0b\u7684\u8bfb\u5199\u5916\uff0c\u4e5f\u4f1a\u9650\u5236\u672c\u7ebf\u7a0b\u63a5\u4e0b\u6765\u7684\u8bfb\u5199\u64cd\u4f5c\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u5982\u679c\u672c\u7ebf\u7a0b\u5bf9\u5b66\u751f\u8868\u52a0\u4e86\u300c\u5171\u4eab\u8868\u9501\u300d\uff0c\u90a3\u4e48\u672c\u7ebf\u7a0b\u63a5\u4e0b\u6765\u5982\u679c\u8981\u5bf9\u5b66\u751f\u8868\u6267\u884c\u5199\u64cd\u4f5c\u7684\u8bed\u53e5\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684\uff0c\u5f53\u7136\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u5b66\u751f\u8868\u8fdb\u884c\u5199\u64cd\u4f5c\u65f6\u4e5f\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u9501\u88ab\u91ca\u653e\u3002</p> <p>\u8981\u91ca\u653e\u8868\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\uff0c\u4f1a\u91ca\u653e\u5f53\u524d\u4f1a\u8bdd\u7684\u6240\u6709\u8868\u9501\uff1a</p> SQL<pre><code>unlock tables\n</code></pre> <p>\u53e6\u5916\uff0c\u5f53\u4f1a\u8bdd\u9000\u51fa\u540e\uff0c\u4e5f\u4f1a\u91ca\u653e\u6240\u6709\u8868\u9501\u3002</p> <p>\u4e0d\u8fc7\u5c3d\u91cf\u907f\u514d\u5728\u4f7f\u7528 InnoDB \u5f15\u64ce\u7684\u8868\u4f7f\u7528\u8868\u9501\uff0c\u56e0\u4e3a\u8868\u9501\u7684\u9897\u7c92\u5ea6\u592a\u5927\uff0c\u4f1a\u5f71\u54cd\u5e76\u53d1\u6027\u80fd\uff0cInnoDB \u725b\u903c\u7684\u5730\u65b9\u5728\u4e8e\u5b9e\u73b0\u4e86\u9897\u7c92\u5ea6\u66f4\u7ec6\u7684\u884c\u7ea7\u9501\u3002</p>"},{"location":"mysql/lock/mysql_lock/#_4","title":"\u5143\u6570\u636e\u9501","text":"<p>\u518d\u6765\u8bf4\u8bf4\u5143\u6570\u636e\u9501\uff08MDL\uff09\u3002</p> <p>\u6211\u4eec\u4e0d\u9700\u8981\u663e\u5f0f\u7684\u4f7f\u7528 MDL\uff0c\u56e0\u4e3a\u5f53\u6211\u4eec\u5bf9\u6570\u636e\u5e93\u8868\u8fdb\u884c\u64cd\u4f5c\u65f6\uff0c\u4f1a\u81ea\u52a8\u7ed9\u8fd9\u4e2a\u8868\u52a0\u4e0a MDL\uff1a</p> <ul> <li>\u5bf9\u4e00\u5f20\u8868\u8fdb\u884c CRUD \u64cd\u4f5c\u65f6\uff0c\u52a0\u7684\u662f MDL \u8bfb\u9501\uff1b</li> <li>\u5bf9\u4e00\u5f20\u8868\u505a\u7ed3\u6784\u53d8\u66f4\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u52a0\u7684\u662f MDL \u5199\u9501\uff1b</li> </ul> <p>MDL \u662f\u4e3a\u4e86\u4fdd\u8bc1\u5f53\u7528\u6237\u5bf9\u8868\u6267\u884c CRUD \u64cd\u4f5c\u65f6\uff0c\u9632\u6b62\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u8fd9\u4e2a\u8868\u7ed3\u6784\u505a\u4e86\u53d8\u66f4\u3002</p> <p>\u5f53\u6709\u7ebf\u7a0b\u5728\u6267\u884c select \u8bed\u53e5\uff08\u52a0 MDL \u8bfb\u9501\uff09\u7684\u671f\u95f4\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7ebf\u7a0b\u8981\u66f4\u6539\u8be5\u8868\u7684\u7ed3\u6784\uff08\u7533\u8bf7 MDL \u5199\u9501\uff09\uff0c\u90a3\u4e48\u5c06\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u6267\u884c\u5b8c select \u8bed\u53e5\uff08\u91ca\u653e MDL \u8bfb\u9501\uff09\u3002</p> <p>\u53cd\u4e4b\uff0c\u5f53\u6709\u7ebf\u7a0b\u5bf9\u8868\u7ed3\u6784\u8fdb\u884c\u53d8\u66f4\uff08\u52a0 MDL \u5199\u9501\uff09\u7684\u671f\u95f4\uff0c\u5982\u679c\u6709\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u4e86 CRUD \u64cd\u4f5c\uff08\u7533\u8bf7 MDL \u8bfb\u9501\uff09\uff0c\u90a3\u4e48\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u76f4\u5230\u8868\u7ed3\u6784\u53d8\u66f4\u5b8c\u6210\uff08\u91ca\u653e MDL \u5199\u9501\uff09\u3002</p> <p>MDL \u4e0d\u9700\u8981\u663e\u793a\u8c03\u7528\uff0c\u90a3\u5b83\u662f\u5728\u4ec0\u4e48\u65f6\u5019\u91ca\u653e\u7684\uff1f</p> <p>MDL \u662f\u5728\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u4f1a\u91ca\u653e\uff0c\u8fd9\u610f\u5473\u7740\u4e8b\u52a1\u6267\u884c\u671f\u95f4\uff0cMDL \u662f\u4e00\u76f4\u6301\u6709\u7684\u3002</p> <p>\u90a3\u5982\u679c\u6570\u636e\u5e93\u6709\u4e00\u4e2a\u957f\u4e8b\u52a1\uff08\u6240\u8c13\u7684\u957f\u4e8b\u52a1\uff0c\u5c31\u662f\u5f00\u542f\u4e86\u4e8b\u52a1\uff0c\u4f46\u662f\u4e00\u76f4\u8fd8\u6ca1\u63d0\u4ea4\uff09\uff0c\u90a3\u5728\u5bf9\u8868\u7ed3\u6784\u505a\u53d8\u66f4\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u53d1\u751f\u610f\u60f3\u4e0d\u5230\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u987a\u5e8f\u7684\u573a\u666f\uff1a</p> <ol> <li>\u9996\u5148\uff0c\u7ebf\u7a0b A \u5148\u542f\u7528\u4e86\u4e8b\u52a1\uff08\u4f46\u662f\u4e00\u76f4\u4e0d\u63d0\u4ea4\uff09\uff0c\u7136\u540e\u6267\u884c\u4e00\u6761 select \u8bed\u53e5\uff0c\u6b64\u65f6\u5c31\u5148\u5bf9\u8be5\u8868\u52a0\u4e0a MDL \u8bfb\u9501\uff1b</li> <li>\u7136\u540e\uff0c\u7ebf\u7a0b B \u4e5f\u6267\u884c\u4e86\u540c\u6837\u7684 select  \u8bed\u53e5\uff0c\u6b64\u65f6\u5e76\u4e0d\u4f1a\u963b\u585e\uff0c\u56e0\u4e3a\u300c\u8bfb\u8bfb\u300d\u5e76\u4e0d\u51b2\u7a81\uff1b</li> <li>\u63a5\u7740\uff0c\u7ebf\u7a0b C \u4fee\u6539\u4e86\u8868\u5b57\u6bb5\uff0c\u6b64\u65f6\u7531\u4e8e\u7ebf\u7a0b A \u7684\u4e8b\u52a1\u5e76\u6ca1\u6709\u63d0\u4ea4\uff0c\u4e5f\u5c31\u662f MDL \u8bfb\u9501\u8fd8\u5728\u5360\u7528\u7740\uff0c\u8fd9\u65f6\u7ebf\u7a0b C \u5c31\u65e0\u6cd5\u7533\u8bf7\u5230 MDL \u5199\u9501\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\uff0c</li> </ol> <p>\u90a3\u4e48\u5728\u7ebf\u7a0b C \u963b\u585e\u540e\uff0c\u540e\u7eed\u6709\u5176\u4ed6\u7ebf\u7a0b\u5bf9\u8be5\u8868\u7684 select \u8bed\u53e5\uff0c\u5c31\u90fd\u4f1a\u88ab\u963b\u585e\u3002\u5982\u679c\u6b64\u65f6\u6709\u5927\u91cf\u8be5\u5bf9\u8868\u7684 select \u8bed\u53e5\u7684\u8bf7\u6c42\u5230\u6765\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u7684\u7ebf\u7a0b\u88ab\u963b\u585e\u4f4f\uff0c\u8fd9\u65f6\u6570\u636e\u5e93\u7684\u7ebf\u7a0b\u5f88\u5feb\u5c31\u4f1a\u7206\u6ee1\u4e86\u3002</p> <p>\u4e3a\u4ec0\u4e48\u56e0\u4e3a\u7ebf\u7a0b C  \u7533\u8bf7\u4e0d\u5230  MDL \u5199\u9501\uff0c\u4f1a\u5bfc\u81f4\u540e\u7eed\u7ebf\u7a0b\u7533\u8bf7\u8bfb\u9501\u7684\u67e5\u8be2\u64cd\u4f5c\u4e5f\u4f1a\u88ab\u963b\u585e\uff1f</p> <p>\u8fd9\u662f\u56e0\u4e3a\u7533\u8bf7 MDL \u9501\u7684\u64cd\u4f5c\u4f1a\u5f62\u6210\u4e00\u4e2a\u961f\u5217\uff0c\u961f\u5217\u4e2d\u5199\u9501\u83b7\u53d6\u4f18\u5148\u7ea7\u9ad8\u4e8e\u8bfb\u9501\uff0c\u4e00\u65e6\u51fa\u73b0 MDL \u5199\u9501\u7b49\u5f85\uff0c\u4f1a\u963b\u585e\u540e\u7eed\u8be5\u8868\u7684\u6240\u6709 CRUD \u64cd\u4f5c\u3002</p> <p>\u6240\u4ee5\u4e3a\u4e86\u80fd\u5b89\u5168\u7684\u5bf9\u8868\u7ed3\u6784\u8fdb\u884c\u53d8\u66f4\uff0c\u5728\u5bf9\u8868\u7ed3\u6784\u53d8\u66f4\u524d\uff0c\u5148\u8981\u770b\u770b\u6570\u636e\u5e93\u4e2d\u7684\u957f\u4e8b\u52a1\uff0c\u662f\u5426\u6709\u4e8b\u52a1\u5df2\u7ecf\u5bf9\u8868\u52a0\u4e0a\u4e86 MDL \u8bfb\u9501\uff0c\u5982\u679c\u53ef\u4ee5\uff0c\u8003\u8651 kill \u6389\u8fd9\u4e2a\u957f\u4e8b\u52a1\uff0c\u7136\u540e\u518d\u505a\u8868\u7ed3\u6784\u7684\u53d8\u66f4\u3002</p>"},{"location":"mysql/lock/mysql_lock/#_5","title":"\u610f\u5411\u9501","text":"<p>\u63a5\u7740\uff0c\u8bf4\u8bf4\u610f\u5411\u9501\u3002</p> <ul> <li>\u5728\u4f7f\u7528 InnoDB \u5f15\u64ce\u7684\u8868\u91cc\u5bf9\u67d0\u4e9b\u8bb0\u5f55\u52a0\u4e0a\u300c\u5171\u4eab\u9501\u300d\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0\u4e0a\u4e00\u4e2a\u300c\u610f\u5411\u5171\u4eab\u9501\u300d\uff1b</li> <li>\u5728\u4f7f\u7528 InnoDB \u5f15\u64ce\u7684\u8868\u91cc\u5bf9\u67d0\u4e9b\u8bb0\u5f55\u52a0\u4e0a\u300c\u72ec\u5360\u9501\u300d\u4e4b\u524d\uff0c\u9700\u8981\u5148\u5728\u8868\u7ea7\u522b\u52a0\u4e0a\u4e00\u4e2a\u300c\u610f\u5411\u72ec\u5360\u9501\u300d\uff1b</li> </ul> <p>\u4e5f\u5c31\u662f\uff0c\u5f53\u6267\u884c\u63d2\u5165\u3001\u66f4\u65b0\u3001\u5220\u9664\u64cd\u4f5c\uff0c\u9700\u8981\u5148\u5bf9\u8868\u52a0\u4e0a\u300c\u610f\u5411\u72ec\u5360\u9501\u300d\uff0c\u7136\u540e\u5bf9\u8be5\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\u3002</p> <p>\u800c\u666e\u901a\u7684 select \u662f\u4e0d\u4f1a\u52a0\u884c\u7ea7\u9501\u7684\uff0c\u666e\u901a\u7684 select \u8bed\u53e5\u662f\u5229\u7528 MVCC \u5b9e\u73b0\u4e00\u81f4\u6027\u8bfb\uff0c\u662f\u65e0\u9501\u7684\u3002</p> <p>\u4e0d\u8fc7\uff0cselect \u4e5f\u662f\u53ef\u4ee5\u5bf9\u8bb0\u5f55\u52a0\u5171\u4eab\u9501\u548c\u72ec\u5360\u9501\u7684\uff0c\u5177\u4f53\u65b9\u5f0f\u5982\u4e0b\uff1a</p> SQL<pre><code>//\u5148\u5728\u8868\u4e0a\u52a0\u4e0a\u610f\u5411\u5171\u4eab\u9501\uff0c\u7136\u540e\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501\nselect ... lock in share mode;\n\n//\u5148\u5728\u8868\u4e0a\u52a0\u4e0a\u610f\u5411\u72ec\u5360\u9501\uff0c\u7136\u540e\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\nselect ... for update;\n</code></pre> <p>\u610f\u5411\u5171\u4eab\u9501\u548c\u610f\u5411\u72ec\u5360\u9501\u662f\u8868\u7ea7\u9501\uff0c\u4e0d\u4f1a\u548c\u884c\u7ea7\u7684\u5171\u4eab\u9501\u548c\u72ec\u5360\u9501\u53d1\u751f\u51b2\u7a81\uff0c\u800c\u4e14\u610f\u5411\u9501\u4e4b\u95f4\u4e5f\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81\uff0c\u53ea\u4f1a\u548c\u5171\u4eab\u8868\u9501\uff08lock tables ... read\uff09\u548c\u72ec\u5360\u8868\u9501\uff08lock tables ... write\uff09\u53d1\u751f\u51b2\u7a81\u3002</p> <p>\u8868\u9501\u548c\u884c\u9501\u662f\u6ee1\u8db3\u8bfb\u8bfb\u5171\u4eab\u3001\u8bfb\u5199\u4e92\u65a5\u3001\u5199\u5199\u4e92\u65a5\u7684\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u300c\u610f\u5411\u9501\u300d\uff0c\u90a3\u4e48\u52a0\u300c\u72ec\u5360\u8868\u9501\u300d\u65f6\uff0c\u5c31\u9700\u8981\u904d\u5386\u8868\u91cc\u6240\u6709\u8bb0\u5f55\uff0c\u67e5\u770b\u662f\u5426\u6709\u8bb0\u5f55\u5b58\u5728\u72ec\u5360\u9501\uff0c\u8fd9\u6837\u6548\u7387\u4f1a\u5f88\u6162\u3002</p> <p>\u90a3\u4e48\u6709\u4e86\u300c\u610f\u5411\u9501\u300d\uff0c\u7531\u4e8e\u5728\u5bf9\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\u524d\uff0c\u5148\u4f1a\u52a0\u4e0a\u8868\u7ea7\u522b\u7684\u610f\u5411\u72ec\u5360\u9501\uff0c\u90a3\u4e48\u5728\u52a0\u300c\u72ec\u5360\u8868\u9501\u300d\u65f6\uff0c\u76f4\u63a5\u67e5\u8be5\u8868\u662f\u5426\u6709\u610f\u5411\u72ec\u5360\u9501\uff0c\u5982\u679c\u6709\u5c31\u610f\u5473\u7740\u8868\u91cc\u5df2\u7ecf\u6709\u8bb0\u5f55\u88ab\u52a0\u4e86\u72ec\u5360\u9501\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u53bb\u904d\u5386\u8868\u91cc\u7684\u8bb0\u5f55\u3002</p> <p>\u6240\u4ee5\uff0c\u610f\u5411\u9501\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u5feb\u901f\u5224\u65ad\u8868\u91cc\u662f\u5426\u6709\u8bb0\u5f55\u88ab\u52a0\u9501\u3002</p>"},{"location":"mysql/lock/mysql_lock/#auto-inc","title":"AUTO-INC \u9501","text":"<p>\u8868\u91cc\u7684\u4e3b\u952e\u901a\u5e38\u90fd\u4f1a\u8bbe\u7f6e\u6210\u81ea\u589e\u7684\uff0c\u8fd9\u662f\u901a\u8fc7\u5bf9\u4e3b\u952e\u5b57\u6bb5\u58f0\u660e <code>AUTO_INCREMENT</code> \u5c5e\u6027\u5b9e\u73b0\u7684\u3002</p> <p>\u4e4b\u540e\u53ef\u4ee5\u5728\u63d2\u5165\u6570\u636e\u65f6\uff0c\u53ef\u4ee5\u4e0d\u6307\u5b9a\u4e3b\u952e\u7684\u503c\uff0c\u6570\u636e\u5e93\u4f1a\u81ea\u52a8\u7ed9\u4e3b\u952e\u8d4b\u503c\u9012\u589e\u7684\u503c\uff0c\u8fd9\u4e3b\u8981\u662f\u901a\u8fc7 AUTO-INC \u9501\u5b9e\u73b0\u7684\u3002</p> <p>AUTO-INC \u9501\u662f\u7279\u6b8a\u7684\u8868\u9501\u673a\u5236\uff0c\u9501\u4e0d\u662f\u5728\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u540e\u624d\u91ca\u653e\uff0c\u800c\u662f\u5728\u6267\u884c\u5b8c\u63d2\u5165\u8bed\u53e5\u540e\u5c31\u4f1a\u7acb\u5373\u91ca\u653e\u3002</p> <p>\u5728\u63d2\u5165\u6570\u636e\u65f6\uff0cMySQL \u4f1a\u52a0\u4e00\u4e2a\u8868\u7ea7\u522b\u7684 AUTO-INC \u9501\uff0c\u7136\u540e\u4f1a\u4e3a\u88ab <code>AUTO_INCREMENT</code> \u4fee\u9970\u7684\u5b57\u6bb5\u8d4b\u9012\u589e\u7684\u503c\uff0c\u7b49\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u4f1a\u628a  AUTO-INC \u9501\u91ca\u653e\u6389\u3002</p> <p>\u90a3\u4e48\uff0c\u4e00\u4e2a\u4e8b\u52a1\u5728\u6301\u6709 AUTO-INC \u9501\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5176\u4ed6\u7684\u4e8b\u52a1\u5982\u679c\u8981\u5411\u8be5\u8868\u63d2\u5165\u8bed\u53e5\u90fd\u4f1a\u88ab\u963b\u585e\uff0c\u4ece\u800c\u4fdd\u8bc1\u63d2\u5165\u6570\u636e\u65f6\uff0c\u88ab <code>AUTO_INCREMENT</code> \u4fee\u9970\u7684\u5b57\u6bb5\u7684\u503c\u662f\u8fde\u7eed\u9012\u589e\u7684\u3002</p> <p>\u4f46\u662f\uff0cAUTO-INC \u9501\u5728\u5bf9\u5927\u91cf\u6570\u636e\u8fdb\u884c\u63d2\u5165\u7684\u65f6\u5019\uff0c\u4f1a\u5f71\u54cd\u63d2\u5165\u6027\u80fd\uff0c\u56e0\u4e3a\u53e6\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u63d2\u5165\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u56e0\u6b64\uff0c\u5728 MySQL 5.1.22 \u7248\u672c\u5f00\u59cb\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u4e00\u79cd\u8f7b\u91cf\u7ea7\u7684\u9501\u6765\u5b9e\u73b0\u81ea\u589e\u3002</p> <p>\u4e00\u6837\u4e5f\u662f\u5728\u63d2\u5165\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u4e3a\u88ab <code>AUTO_INCREMENT</code> \u4fee\u9970\u7684\u5b57\u6bb5\u52a0\u4e0a\u8f7b\u91cf\u7ea7\u9501\uff0c\u7136\u540e\u7ed9\u8be5\u5b57\u6bb5\u8d4b\u503c\u4e00\u4e2a\u81ea\u589e\u7684\u503c\uff0c\u5c31\u628a\u8fd9\u4e2a\u8f7b\u91cf\u7ea7\u9501\u91ca\u653e\u4e86\uff0c\u800c\u4e0d\u9700\u8981\u7b49\u5f85\u6574\u4e2a\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u540e\u624d\u91ca\u653e\u9501\u3002</p> <p>InnoDB \u5b58\u50a8\u5f15\u64ce\u63d0\u4f9b\u4e86\u4e2a innodb_autoinc_lock_mode \u7684\u7cfb\u7edf\u53d8\u91cf\uff0c\u662f\u7528\u6765\u63a7\u5236\u9009\u62e9\u7528 AUTO-INC \u9501\uff0c\u8fd8\u662f\u8f7b\u91cf\u7ea7\u7684\u9501\u3002 - \u5f53 innodb_autoinc_lock_mode = 0\uff0c\u5c31\u91c7\u7528 AUTO-INC \u9501\uff0c\u8bed\u53e5\u6267\u884c\u7ed3\u675f\u540e\u624d\u91ca\u653e\u9501\uff1b - \u5f53 innodb_autoinc_lock_mode = 2\uff0c\u5c31\u91c7\u7528\u8f7b\u91cf\u7ea7\u9501\uff0c\u7533\u8bf7\u81ea\u589e\u4e3b\u952e\u540e\u5c31\u91ca\u653e\u9501\uff0c\u5e76\u4e0d\u9700\u8981\u7b49\u8bed\u53e5\u6267\u884c\u540e\u624d\u91ca\u653e\u3002 - \u5f53 innodb_autoinc_lock_mode = 1\uff1a   -  \u666e\u901a insert \u8bed\u53e5\uff0c\u81ea\u589e\u9501\u5728\u7533\u8bf7\u4e4b\u540e\u5c31\u9a6c\u4e0a\u91ca\u653e\uff1b   - \u7c7b\u4f3c insert \u2026\u2026 select \u8fd9\u6837\u7684\u6279\u91cf\u63d2\u5165\u6570\u636e\u7684\u8bed\u53e5\uff0c\u81ea\u589e\u9501\u8fd8\u662f\u8981\u7b49\u8bed\u53e5\u7ed3\u675f\u540e\u624d\u88ab\u91ca\u653e\uff1b</p> <p>\u5f53 innodb_autoinc_lock_mode = 2 \u662f\u6027\u80fd\u6700\u9ad8\u7684\u65b9\u5f0f\uff0c\u4f46\u662f\u5f53\u642d\u914d  binlog \u7684\u65e5\u5fd7\u683c\u5f0f\u662f statement \u4e00\u8d77\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u5728\u300c\u4e3b\u4ece\u590d\u5236\u7684\u573a\u666f\u300d\u4e2d\u4f1a\u53d1\u751f\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u8003\u8651\u4e0b\u9762\u573a\u666f\uff1a</p> <p></p> <p>session A \u5f80\u8868 t \u4e2d\u63d2\u5165\u4e86 4 \u884c\u6570\u636e\uff0c\u7136\u540e\u521b\u5efa\u4e86\u4e00\u4e2a\u76f8\u540c\u7ed3\u6784\u7684\u8868 t2\uff0c\u7136\u540e\u4e24\u4e2a session \u540c\u65f6\u6267\u884c\u5411\u8868 t2 \u4e2d\u63d2\u5165\u6570\u636e\u3002</p> <p>\u5982\u679c innodb_autoinc_lock_mode = 2\uff0c\u610f\u5473\u7740\u300c\u7533\u8bf7\u81ea\u589e\u4e3b\u952e\u540e\u5c31\u91ca\u653e\u9501\uff0c\u4e0d\u5fc5\u7b49\u63d2\u5165\u8bed\u53e5\u6267\u884c\u5b8c\u300d\u3002\u90a3\u4e48\u5c31\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u60c5\u51b5\uff1a</p> <ul> <li>session B \u5148\u63d2\u5165\u4e86\u4e24\u4e2a\u8bb0\u5f55\uff0c(1,1,1)\u3001(2,2,2)\uff1b</li> <li>\u7136\u540e\uff0csession A \u6765\u7533\u8bf7\u81ea\u589e id \u5f97\u5230 id=3\uff0c\u63d2\u5165\u4e86\uff083,5,5)\uff1b</li> <li>\u4e4b\u540e\uff0csession B \u7ee7\u7eed\u6267\u884c\uff0c\u63d2\u5165\u4e24\u6761\u8bb0\u5f55 (4,3,3)\u3001 (5,4,4)\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0csession B \u7684 insert \u8bed\u53e5\uff0c\u751f\u6210\u7684 id \u4e0d\u8fde\u7eed\u3002</p> <p>\u5f53\u300c\u4e3b\u5e93\u300d\u53d1\u751f\u4e86\u8fd9\u79cd\u60c5\u51b5\uff0cbinlog \u9762\u5bf9 t2 \u8868\u7684\u66f4\u65b0\u53ea\u4f1a\u8bb0\u5f55\u8fd9\u4e24\u4e2a session \u7684 insert \u8bed\u53e5\uff0c\u5982\u679c binlog_format=statement\uff0c\u8bb0\u5f55\u7684\u8bed\u53e5\u5c31\u662f\u539f\u59cb\u8bed\u53e5\u3002\u8bb0\u5f55\u7684\u987a\u5e8f\u8981\u4e48\u5148\u8bb0 session A \u7684 insert \u8bed\u53e5\uff0c\u8981\u4e48\u5148\u8bb0 session B \u7684 insert \u8bed\u53e5\u3002</p> <p>\u4f46\u4e0d\u8bba\u662f\u54ea\u4e00\u79cd\uff0c\u8fd9\u4e2a binlog \u62ff\u53bb\u300c\u4ece\u5e93\u300d\u6267\u884c\uff0c\u8fd9\u65f6\u4ece\u5e93\u662f\u6309\u300c\u987a\u5e8f\u300d\u6267\u884c\u8bed\u53e5\u7684\uff0c\u53ea\u6709\u5f53\u6267\u884c\u5b8c\u4e00\u6761 SQL \u8bed\u53e5\u540e\uff0c\u624d\u4f1a\u6267\u884c\u4e0b\u4e00\u6761 SQL\u3002\u56e0\u6b64\uff0c\u5728\u4ece\u5e93\u4e0a\u300c\u4e0d\u4f1a\u300d\u53d1\u751f\u50cf\u4e3b\u5e93\u90a3\u6837\u4e24\u4e2a session\u300c\u540c\u65f6\u300d\u6267\u884c\u5411\u8868 t2 \u4e2d\u63d2\u5165\u6570\u636e\u7684\u573a\u666f\u3002\u6240\u4ee5\uff0c\u5728\u5907\u5e93\u4e0a\u6267\u884c\u4e86 session B \u7684 insert \u8bed\u53e5\uff0c\u751f\u6210\u7684\u7ed3\u679c\u91cc\u9762\uff0cid \u90fd\u662f\u8fde\u7eed\u7684\u3002\u8fd9\u65f6\uff0c\u4e3b\u4ece\u5e93\u5c31\u53d1\u751f\u4e86\u6570\u636e\u4e0d\u4e00\u81f4\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u95ee\u9898\uff0cbinlog \u65e5\u5fd7\u683c\u5f0f\u8981\u8bbe\u7f6e\u4e3a row\uff0c\u8fd9\u6837\u5728 binlog \u91cc\u9762\u8bb0\u5f55\u7684\u662f\u4e3b\u5e93\u5206\u914d\u7684\u81ea\u589e\u503c\uff0c\u5230\u5907\u5e93\u6267\u884c\u7684\u65f6\u5019\uff0c\u4e3b\u5e93\u7684\u81ea\u589e\u503c\u662f\u4ec0\u4e48\uff0c\u4ece\u5e93\u7684\u81ea\u589e\u503c\u5c31\u662f\u4ec0\u4e48\u3002</p> <p>\u6240\u4ee5\uff0c\u5f53 innodb_autoinc_lock_mode = 2 \u65f6\uff0c\u5e76\u4e14 binlog_format = row\uff0c\u65e2\u80fd\u63d0\u5347\u5e76\u53d1\u6027\uff0c\u53c8\u4e0d\u4f1a\u51fa\u73b0\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898\u3002</p>"},{"location":"mysql/lock/mysql_lock/#_6","title":"\u884c\u7ea7\u9501","text":"<p>InnoDB \u5f15\u64ce\u662f\u652f\u6301\u884c\u7ea7\u9501\u7684\uff0c\u800c MyISAM \u5f15\u64ce\u5e76\u4e0d\u652f\u6301\u884c\u7ea7\u9501\u3002</p> <p>\u524d\u9762\u4e5f\u63d0\u5230\uff0c\u666e\u901a\u7684 select \u8bed\u53e5\u662f\u4e0d\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u9501\u7684\uff0c\u56e0\u4e3a\u5b83\u5c5e\u4e8e\u5feb\u7167\u8bfb\u3002\u5982\u679c\u8981\u5728\u67e5\u8be2\u65f6\u5bf9\u8bb0\u5f55\u52a0\u884c\u9501\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u5f0f\uff0c\u8fd9\u79cd\u67e5\u8be2\u4f1a\u52a0\u9501\u7684\u8bed\u53e5\u79f0\u4e3a\u9501\u5b9a\u8bfb\u3002</p> SQL<pre><code>//\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u5171\u4eab\u9501\nselect ... lock in share mode;\n\n//\u5bf9\u8bfb\u53d6\u7684\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\nselect ... for update;\n</code></pre> <p>\u4e0a\u9762\u8fd9\u4e24\u6761\u8bed\u53e5\u5fc5\u987b\u5728\u4e00\u4e2a\u4e8b\u52a1\u4e2d\uff0c\u56e0\u4e3a\u5f53\u4e8b\u52a1\u63d0\u4ea4\u4e86\uff0c\u9501\u5c31\u4f1a\u88ab\u91ca\u653e\uff0c\u6240\u4ee5\u5728\u4f7f\u7528\u8fd9\u4e24\u6761\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u8981\u52a0\u4e0a begin\u3001start transaction \u6216\u8005 set autocommit = 0\u3002</p> <p>\u5171\u4eab\u9501\uff08S \u9501\uff09\u6ee1\u8db3\u8bfb\u8bfb\u5171\u4eab\uff0c\u8bfb\u5199\u4e92\u65a5\u3002\u72ec\u5360\u9501\uff08X \u9501\uff09\u6ee1\u8db3\u5199\u5199\u4e92\u65a5\u3001\u8bfb\u5199\u4e92\u65a5\u3002</p> <p></p> <p>\u884c\u7ea7\u9501\u7684\u7c7b\u578b\u4e3b\u8981\u6709\u4e09\u7c7b\uff1a</p> <ul> <li>Record Lock\uff0c\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u4ec5\u4ec5\u628a\u4e00\u6761\u8bb0\u5f55\u9501\u4e0a\uff1b</li> <li>Gap Lock\uff0c\u95f4\u9699\u9501\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u4f46\u662f\u4e0d\u5305\u542b\u8bb0\u5f55\u672c\u8eab\uff1b</li> <li>Next-Key Lock\uff1aRecord Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002</li> </ul>"},{"location":"mysql/lock/mysql_lock/#record-lock","title":"Record Lock","text":"<p>Record Lock \u79f0\u4e3a\u8bb0\u5f55\u9501\uff0c\u9501\u4f4f\u7684\u662f\u4e00\u6761\u8bb0\u5f55\u3002\u800c\u4e14\u8bb0\u5f55\u9501\u662f\u6709 S \u9501\u548c X \u9501\u4e4b\u5206\u7684\uff1a</p> <ul> <li>\u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 S \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u4e5f\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e S \u9501\u517c\u5bb9\uff09\uff0c\u4f46\u662f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09;</li> <li>\u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u4e00\u6761\u8bb0\u5f55\u52a0\u4e86 X \u578b\u8bb0\u5f55\u9501\u540e\uff0c\u5176\u4ed6\u4e8b\u52a1\u65e2\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 S \u578b\u8bb0\u5f55\u9501\uff08S \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\uff0c\u4e5f\u4e0d\u53ef\u4ee5\u5bf9\u8be5\u8bb0\u5f55\u52a0 X \u578b\u8bb0\u5f55\u9501\uff08X \u578b\u4e0e X \u9501\u4e0d\u517c\u5bb9\uff09\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u4e86\u4e0b\u9762\u8fd9\u6761\u8bed\u53e5\uff1a</p> SQL<pre><code>mysql &gt; begin;\nmysql &gt; select * from t_test where id = 1 for update;\n</code></pre> <p>\u5c31\u662f\u5bf9  t_test \u8868\u4e2d\u4e3b\u952e id \u4e3a 1 \u7684\u8fd9\u6761\u8bb0\u5f55\u52a0\u4e0a X \u578b\u7684\u8bb0\u5f55\u9501\uff0c\u8fd9\u6837\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u4fee\u6539\u4e86\u3002</p> <p></p> <p>\u5f53\u4e8b\u52a1\u6267\u884c commit \u540e\uff0c\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u751f\u6210\u7684\u9501\u90fd\u4f1a\u88ab\u91ca\u653e\u3002</p>"},{"location":"mysql/lock/mysql_lock/#gap-lock","title":"Gap Lock","text":"<p>Gap Lock \u79f0\u4e3a\u95f4\u9699\u9501\uff0c\u53ea\u5b58\u5728\u4e8e\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u89e3\u51b3\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002</p> <p>\u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u63d2\u5165 id = 4 \u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u7684\u9632\u6b62\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002</p> <p></p> <p>\u95f4\u9699\u9501\u867d\u7136\u5b58\u5728  X \u578b\u95f4\u9699\u9501\u548c S \u578b\u95f4\u9699\u9501\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u517c\u5bb9\u7684\uff0c\u5373\u4e24\u4e2a\u4e8b\u52a1\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u5305\u542b\u5171\u540c\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501\uff0c\u5e76\u4e0d\u5b58\u5728\u4e92\u65a5\u5173\u7cfb\uff0c\u56e0\u4e3a\u95f4\u9699\u9501\u7684\u76ee\u7684\u662f\u9632\u6b62\u63d2\u5165\u5e7b\u5f71\u8bb0\u5f55\u800c\u63d0\u51fa\u7684\u3002</p>"},{"location":"mysql/lock/mysql_lock/#next-key-lock","title":"Next-Key Lock","text":"<p>Next-Key Lock \u79f0\u4e3a\u4e34\u952e\u9501\uff0c\u662f Record Lock + Gap Lock \u7684\u7ec4\u5408\uff0c\u9501\u5b9a\u4e00\u4e2a\u8303\u56f4\uff0c\u5e76\u4e14\u9501\u5b9a\u8bb0\u5f55\u672c\u8eab\u3002</p> <p>\u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5] \u7684 next-key lock\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5373\u4e0d\u80fd\u63d2\u5165 id = 4 \u8bb0\u5f55\uff0c\u4e5f\u4e0d\u80fd\u4fee\u6539 id = 5 \u8fd9\u6761\u8bb0\u5f55\u3002</p> <p></p> <p>\u6240\u4ee5\uff0cnext-key lock \u5373\u80fd\u4fdd\u62a4\u8be5\u8bb0\u5f55\uff0c\u53c8\u80fd\u963b\u6b62\u5176\u4ed6\u4e8b\u52a1\u5c06\u65b0\u7eaa\u5f55\u63d2\u5165\u5230\u88ab\u4fdd\u62a4\u8bb0\u5f55\u524d\u9762\u7684\u95f4\u9699\u4e2d\u3002</p> <p>next-key lock \u662f\u5305\u542b\u95f4\u9699\u9501 + \u8bb0\u5f55\u9501\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u4e86 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u662f\u4f1a\u88ab\u963b\u585e\u7684\u3002</p> <p>\u6bd4\u5982\uff0c\u4e00\u4e2a\u4e8b\u52a1\u6301\u6709\u4e86\u8303\u56f4\u4e3a (1, 10] \u7684 X \u578b\u7684 next-key lock\uff0c\u90a3\u4e48\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u5728\u83b7\u53d6\u76f8\u540c\u8303\u56f4\u7684 X \u578b\u7684 next-key lock \u65f6\uff0c\u5c31\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u867d\u7136\u76f8\u540c\u8303\u56f4\u7684\u95f4\u9699\u9501\u662f\u591a\u4e2a\u4e8b\u52a1\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4f46\u5bf9\u4e8e\u8bb0\u5f55\u9501\uff0c\u6211\u4eec\u662f\u8981\u8003\u8651 X \u578b\u4e0e S \u578b\u5173\u7cfb\uff0cX \u578b\u7684\u8bb0\u5f55\u9501\u4e0e X \u578b\u7684\u8bb0\u5f55\u9501\u662f\u51b2\u7a81\u7684\u3002</p>"},{"location":"mysql/lock/mysql_lock/#_7","title":"\u63d2\u5165\u610f\u5411\u9501","text":"<p>\u4e00\u4e2a\u4e8b\u52a1\u5728\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u9700\u8981\u5224\u65ad\u63d2\u5165\u4f4d\u7f6e\u662f\u5426\u5df2\u88ab\u5176\u4ed6\u4e8b\u52a1\u52a0\u4e86\u95f4\u9699\u9501\uff08next-key lock \u4e5f\u5305\u542b\u95f4\u9699\u9501\uff09\u3002</p> <p>\u5982\u679c\u6709\u7684\u8bdd\uff0c\u63d2\u5165\u64cd\u4f5c\u5c31\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u76f4\u5230\u62e5\u6709\u95f4\u9699\u9501\u7684\u90a3\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u4e3a\u6b62\uff08\u91ca\u653e\u95f4\u9699\u9501\u7684\u65f6\u523b\uff09\uff0c\u5728\u6b64\u671f\u95f4\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u8868\u660e\u6709\u4e8b\u52a1\u60f3\u5728\u67d0\u4e2a\u533a\u95f4\u63d2\u5165\u65b0\u8bb0\u5f55\uff0c\u4f46\u662f\u73b0\u5728\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e8b\u52a1 A \u5df2\u7ecf\u5bf9\u8868\u52a0\u4e86\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\u3002</p> <p></p> <p>\u5f53\u4e8b\u52a1 A \u8fd8\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4e8b\u52a1 B \u5411\u8be5\u8868\u63d2\u5165\u4e00\u6761 id = 4 \u7684\u65b0\u8bb0\u5f55\uff0c\u8fd9\u65f6\u4f1a\u5224\u65ad\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\u5df2\u7ecf\u88ab\u4e8b\u52a1 A \u52a0\u4e86\u95f4\u9699\u9501\uff0c\u4e8e\u662f\u4e8b\u7269 B \u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u5c06\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff09\uff0c\u6b64\u65f6\u4e8b\u52a1 B \u5c31\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u76f4\u5230\u4e8b\u52a1 A \u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002</p> <p>\u63d2\u5165\u610f\u5411\u9501\u540d\u5b57\u867d\u7136\u6709\u610f\u5411\u9501\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u662f\u610f\u5411\u9501\uff0c\u5b83\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u5c5e\u4e8e\u884c\u7ea7\u522b\u9501\u3002</p> <p>\u5982\u679c\u8bf4\u95f4\u9699\u9501\u9501\u4f4f\u7684\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u9501\u4f4f\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u3002\u56e0\u800c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0c\u63d2\u5165\u610f\u5411\u9501\u786e\u5b9e\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002</p> <p>\u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u7684\u53e6\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5dee\u522b\u662f\uff1a\u5c3d\u7ba1\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u4e5f\u5c5e\u4e8e\u95f4\u9699\u9501\uff0c\u4f46\u4e24\u4e2a\u4e8b\u52a1\u5374\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u4e00\u4e2a\u62e5\u6709\u95f4\u9699\u9501\uff0c\u53e6\u4e00\u4e2a\u62e5\u6709\u8be5\u95f4\u9699\u533a\u95f4\u5185\u7684\u63d2\u5165\u610f\u5411\u9501\uff08\u5f53\u7136\uff0c\u63d2\u5165\u610f\u5411\u9501\u5982\u679c\u4e0d\u5728\u95f4\u9699\u9501\u533a\u95f4\u5185\u5219\u662f\u53ef\u4ee5\u7684\uff09\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u300aMySQL \u6280\u672f\u5185\u5e55\uff1ainnodb\u300b</li> <li>\u300aMySQL \u5b9e\u6218 45 \u8bb2\u300b</li> <li>\u300a\u4ece\u6839\u513f\u4e0a\u7406\u89e3 MySQL\u300b</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/lock/show_lock/","title":"\u5b57\u8282\u9762\u8bd5\uff1a\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u5bfc\u81f4\u6b7b\u9501\u7684\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e4b\u524d\u6536\u5230\u8bfb\u8005\u9762\u8bd5\u5b57\u8282\u65f6\uff0c\u88ab\u95ee\u5230\u4e00\u4e2a\u5173\u4e8e MySQL \u7684\u95ee\u9898\u3002</p> <p></p> <p></p> <p>\u5982\u679c\u5bf9 MySQL \u52a0\u9501\u673a\u5236\u6bd4\u8f83\u719f\u6089\u7684\u540c\u5b66\uff0c\u5e94\u8be5\u4e00\u773c\u5c31\u80fd\u770b\u51fa\u4f1a\u53d1\u751f\u6b7b\u9501\uff0c\u4f46\u662f\u5177\u4f53\u52a0\u4e86\u4ec0\u4e48\u9501\u800c\u5bfc\u81f4\u6b7b\u9501\uff0c\u662f\u9700\u8981\u6211\u4eec\u5177\u4f53\u5206\u6790\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u8ddf\u804a\u804a\u4e0a\u9762\u4e24\u4e2a\u4e8b\u52a1\u6267\u884c SQL \u8bed\u53e5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u52a0\u4e86\u4ec0\u4e48\u9501\uff0c\u4ece\u800c\u5bfc\u81f4\u6b7b\u9501\u7684\u3002</p>"},{"location":"mysql/lock/show_lock/#_2","title":"\u51c6\u5907\u5de5\u4f5c","text":"<p>\u5148\u521b\u5efa\u4e00\u5f20 t_student \u8868\uff0c\u5047\u8bbe\u9664\u4e86 id \u5b57\u6bb5\uff0c\u5176\u4ed6\u5b57\u6bb5\u90fd\u662f\u666e\u901a\u5b57\u6bb5\u3002</p> SQL<pre><code>CREATE TABLE `t_student` (\n  `id` int NOT NULL,\n  `no` varchar(255) DEFAULT NULL,\n  `name` varchar(255) DEFAULT NULL,\n  `age` int DEFAULT NULL,\n  `score` int DEFAULT NULL,\n  PRIMARY KEY (`id`)\n) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;\n</code></pre> <p>\u7136\u540e\uff0c\u63d2\u5165\u76f8\u5173\u7684\u6570\u636e\u540e\uff0ct_student \u8868\u4e2d\u7684\u8bb0\u5f55\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"mysql/lock/show_lock/#_3","title":"\u5f00\u59cb\u5b9e\u9a8c","text":"<p>\u5728\u5b9e\u9a8c\u5f00\u59cb\u524d\uff0c\u5148\u8bf4\u660e\u4e0b\u5b9e\u9a8c\u73af\u5883\uff1a</p> <ul> <li>MySQL \u7248\u672c\uff1a8.0.26</li> <li>\u9694\u79bb\u7ea7\u522b\uff1a\u53ef\u91cd\u590d\u8bfb\uff08RR\uff09</li> </ul> <p>\u542f\u52a8\u4e24\u4e2a\u4e8b\u52a1\uff0c\u6309\u7167\u9898\u76ee\u7684 SQL \u6267\u884c\u987a\u5e8f\uff0c\u8fc7\u7a0b\u5982\u4e0b\u8868\u683c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u548c \u4e8b\u52a1 B \u90fd\u5728\u6267\u884c  insert \u8bed\u53e5\u540e\uff0c\u90fd\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\uff08\u524d\u63d0\u6ca1\u6709\u6253\u5f00\u6b7b\u9501\u68c0\u6d4b\uff09\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u4e86\u6b7b\u9501\uff0c\u56e0\u4e3a\u90fd\u5728\u76f8\u4e92\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\u3002</p>"},{"location":"mysql/lock/show_lock/#_4","title":"\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u6b7b\u9501\uff1f","text":"<p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1\u6267\u884c SQL \u8fc7\u7a0b\u4e2d\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u9488\u5bf9\u6bcf\u4e00\u6761 SQL \u8bed\u53e5\u5206\u6790\u5177\u4f53\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p>"},{"location":"mysql/lock/show_lock/#time-1","title":"Time 1 \u9636\u6bb5\u52a0\u9501\u5206\u6790","text":"<p>Time 1 \u9636\u6bb5\uff0c\u4e8b\u52a1 A \u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\uff1a</p> SQL<pre><code># \u4e8b\u52a1 A\nmysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; update t_student set score = 100 where id = 25;\nQuery OK, 0 rows affected (0.01 sec)\nRows matched: 0  Changed: 0  Warnings: 0\n</code></pre> <p>\u7136\u540e\u6267\u884c <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 A \u6b64\u65f6\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5171\u52a0\u4e86\u4e24\u4e2a\u9501\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u8868\u9501\uff1aX \u7c7b\u578b\u7684\u610f\u5411\u9501\uff1b</li> <li>\u884c\u9501\uff1aX \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff1b</li> </ul> <p>\u8fd9\u91cc\u6211\u4eec\u91cd\u70b9\u5173\u6ce8\u884c\u9501\uff0c\u56fe\u4e2d LOCK_TYPE \u4e2d\u7684 RECORD \u8868\u793a\u884c\u7ea7\u9501\uff0c\u800c\u4e0d\u662f\u8bb0\u5f55\u9501\u7684\u610f\u601d\uff0c\u901a\u8fc7 LOCK_MODE \u53ef\u4ee5\u786e\u8ba4\u662f next-key \u9501\uff0c\u8fd8\u662f\u95f4\u9699\u9501\uff0c\u8fd8\u662f\u8bb0\u5f55\u9501\uff1a</p> <ul> <li>\u5982\u679c LOCK_MODE \u4e3a <code>X</code>\uff0c\u8bf4\u660e\u662f next-key \u9501\uff1b</li> <li>\u5982\u679c LOCK_MODE \u4e3a <code>X, REC_NOT_GAP</code>\uff0c\u8bf4\u660e\u662f\u8bb0\u5f55\u9501\uff1b</li> <li>\u5982\u679c LOCK_MODE \u4e3a <code>X, GAP</code>\uff0c\u8bf4\u660e\u662f\u95f4\u9699\u9501\uff1b</li> </ul> <p>\u56e0\u6b64\uff0c\u6b64\u65f6\u4e8b\u52a1 A \u5728\u4e3b\u952e\u7d22\u5f15\uff08INDEX_NAME : PRIMARY\uff09\u4e0a\u52a0\u7684\u662f\u95f4\u9699\u9501\uff0c\u9501\u8303\u56f4\u662f<code>(20, 30)</code>\u3002</p> <p>\u95f4\u9699\u9501\u7684\u8303\u56f4<code>(20, 30)</code> \uff0c\u662f\u600e\u4e48\u786e\u5b9a\u7684\uff1f</p> <p>\u6839\u636e\u6211\u7684\u7ecf\u9a8c\uff0c\u5982\u679c LOCK_MODE \u662f next-key \u9501\u6216\u8005\u95f4\u9699\u9501\uff0c\u90a3\u4e48 LOCK_DATA \u5c31\u8868\u793a\u9501\u7684\u8303\u56f4\u6700\u53f3\u503c\uff0c\u6b64\u6b21\u7684\u4e8b\u52a1 A \u7684 LOCK_DATA \u662f 30\u3002</p> <p>\u7136\u540e\u9501\u8303\u56f4\u7684\u6700\u5de6\u503c\u662f t_student \u8868\u4e2d id \u4e3a 30 \u7684\u4e0a\u4e00\u6761\u8bb0\u5f55\u7684 id \u503c\uff0c\u5373 20\u3002</p> <p></p> <p>\u56e0\u6b64\uff0c\u95f4\u9699\u9501\u7684\u8303\u56f4<code>(20, 30)</code>\u3002</p>"},{"location":"mysql/lock/show_lock/#time-2","title":"Time 2 \u9636\u6bb5\u52a0\u9501\u5206\u6790","text":"<p>Time 2 \u9636\u6bb5\uff0c\u4e8b\u52a1 B \u6267\u884c\u4ee5\u4e0b\u8bed\u53e5\uff1a</p> SQL<pre><code># \u4e8b\u52a1 B\nmysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; update t_student set score = 100 where id = 26;\nQuery OK, 0 rows affected (0.01 sec)\nRows matched: 0  Changed: 0  Warnings: 0\n</code></pre> <p>\u7136\u540e\u6267\u884c <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 B \u6b64\u65f6\u52a0\u4e86\u4ec0\u4e48\u9501\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u884c\u9501\u662f X \u7c7b\u578b\u7684\u95f4\u9699\u9501\uff0c\u95f4\u9699\u9501\u7684\u8303\u56f4\u662f<code>(20, 30)</code>\u3002</p> <p>\u4e8b\u52a1 A \u548c \u4e8b\u52a1 B \u7684\u95f4\u9699\u9501\u8303\u56f4\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u51b2\u7a81\uff1f</p> <p>\u4e24\u4e2a\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u76f8\u4e92\u517c\u5bb9\u7684\uff0c\u4e0d\u4f1a\u4ea7\u751f\u51b2\u7a81\u3002</p> <p>\u5728 MySQL \u5b98\u7f51\u4e0a\u8fd8\u6709\u4e00\u6bb5\u975e\u5e38\u5173\u952e\u7684\u63cf\u8ff0\uff1a</p> <p>Gap locks in InnoDB are \u201cpurely inhibitive\u201d, which means that their only purpose is to prevent other transactions from Inserting to the gap. Gap locks can co-exist. A gap lock taken by one transaction does not prevent another transaction from taking a gap lock on the same gap. There is no difference between shared and exclusive gap locks. They do not conflict with each other, and they perform the same function.</p> <p>\u95f4\u9699\u9501\u7684\u610f\u4e49\u53ea\u5728\u4e8e\u963b\u6b62\u533a\u95f4\u88ab\u63d2\u5165\uff0c\u56e0\u6b64\u662f\u53ef\u4ee5\u5171\u5b58\u7684\u3002\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u7684\u95f4\u9699\u9501\u4e0d\u4f1a\u963b\u6b62\u53e6\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u540c\u4e00\u4e2a\u95f4\u9699\u8303\u56f4\u7684\u95f4\u9699\u9501\uff0c\u5171\u4eab\uff08S \u578b\uff09\u548c\u6392\u4ed6\uff08X \u578b\uff09\u7684\u95f4\u9699\u9501\u662f\u6ca1\u6709\u533a\u522b\u7684\uff0c\u4ed6\u4eec\u76f8\u4e92\u4e0d\u51b2\u7a81\uff0c\u4e14\u529f\u80fd\u76f8\u540c\u3002</p>"},{"location":"mysql/lock/show_lock/#time-3","title":"Time 3 \u9636\u6bb5\u52a0\u9501\u5206\u6790","text":"<p>Time 3\uff0c\u4e8b\u52a1 A \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff1a</p> SQL<pre><code># Time 3 \u9636\u6bb5\uff0c\u4e8b\u52a1 A \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\nmysql&gt; insert into t_student(id, no, name, age,score) value (25, 'S0025', 'sony', 28, 90);\n    /// \u963b\u585e\u7b49\u5f85......\n</code></pre> <p>\u6b64\u65f6\uff0c\u4e8b\u52a1 A \u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\u3002</p> <p>\u7136\u540e\u6267\u884c <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 A \u5728\u83b7\u53d6\u4ec0\u4e48\u9501\u800c\u5bfc\u81f4\u88ab\u963b\u585e\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u7684\u72b6\u6001\u4e3a\u7b49\u5f85\u72b6\u6001\uff08LOCK_STATUS: WAITING\uff09\uff0c\u56e0\u4e3a\u5411\u4e8b\u52a1 B \u751f\u6210\u7684\u95f4\u9699\u9501\uff08\u8303\u56f4 <code>(20, 30)</code>\uff09\u4e2d\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u6240\u4ee5\u4e8b\u52a1 A \u7684\u63d2\u5165\u64cd\u4f5c\u751f\u6210\u4e86\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff08<code>LOCK_MODE:INSERT_INTENTION</code>\uff09\u3002</p> <p>\u63d2\u5165\u610f\u5411\u9501\u662f\u4ec0\u4e48\uff1f</p> <p>\u6ce8\u610f\uff01\u63d2\u5165\u610f\u5411\u9501\u540d\u5b57\u91cc\u867d\u7136\u6709\u610f\u5411\u9501\u8fd9\u4e09\u4e2a\u5b57\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u662f\u610f\u5411\u9501\uff0c\u5b83\u5c5e\u4e8e\u884c\u7ea7\u9501\uff0c\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002</p> <p>\u5728 MySQL \u7684\u5b98\u65b9\u6587\u6863\u4e2d\u6709\u4ee5\u4e0b\u91cd\u8981\u63cf\u8ff0\uff1a</p> <p>An Insert intention lock is a type of gap lock set by Insert operations prior to row Insertion. This lock signals the intent to Insert in such a way that multiple transactions Inserting into the same index gap need not wait for each other if they are not Inserting at the same position within the gap. Suppose that there are index records with values of 4 and 7. Separate transactions that attempt to Insert values of 5 and 6, respectively, each lock the gap between 4 and 7 with Insert intention locks prior to obtaining the exclusive lock on the Inserted row, but do not block each other because the rows are nonconflicting.</p> <p>\u8fd9\u6bb5\u8bdd\u8868\u660e\u5c3d\u7ba1\u63d2\u5165\u610f\u5411\u9501\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\uff0c\u4f46\u4e0d\u540c\u4e8e\u95f4\u9699\u9501\u7684\u662f\uff0c\u8be5\u9501\u53ea\u7528\u4e8e\u5e76\u53d1\u63d2\u5165\u64cd\u4f5c\u3002</p> <p>\u5982\u679c\u8bf4\u95f4\u9699\u9501\u9501\u4f4f\u7684\u662f\u4e00\u4e2a\u533a\u95f4\uff0c\u90a3\u4e48\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u9501\u4f4f\u7684\u5c31\u662f\u4e00\u4e2a\u70b9\u3002\u56e0\u800c\u4ece\u8fd9\u4e2a\u89d2\u5ea6\u6765\u8bf4\uff0c\u63d2\u5165\u610f\u5411\u9501\u786e\u5b9e\u662f\u4e00\u79cd\u7279\u6b8a\u7684\u95f4\u9699\u9501\u3002</p> <p>\u63d2\u5165\u610f\u5411\u9501\u4e0e\u95f4\u9699\u9501\u7684\u53e6\u4e00\u4e2a\u975e\u5e38\u91cd\u8981\u7684\u5dee\u522b\u662f\uff1a\u5c3d\u7ba1\u300c\u63d2\u5165\u610f\u5411\u9501\u300d\u4e5f\u5c5e\u4e8e\u95f4\u9699\u9501\uff0c\u4f46\u4e24\u4e2a\u4e8b\u52a1\u5374\u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u95f4\u5185\uff0c\u4e00\u4e2a\u62e5\u6709\u95f4\u9699\u9501\uff0c\u53e6\u4e00\u4e2a\u62e5\u6709\u8be5\u95f4\u9699\u533a\u95f4\u5185\u7684\u63d2\u5165\u610f\u5411\u9501\uff08\u5f53\u7136\uff0c\u63d2\u5165\u610f\u5411\u9501\u5982\u679c\u4e0d\u5728\u95f4\u9699\u9501\u533a\u95f4\u5185\u5219\u662f\u53ef\u4ee5\u7684\uff09\u3002\u6240\u4ee5\uff0c\u63d2\u5165\u610f\u5411\u9501\u548c\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u51b2\u7a81\u7684\u3002</p> <p>\u53e6\u5916\uff0c\u6211\u8865\u5145\u4e00\u70b9\uff0c\u63d2\u5165\u610f\u5411\u9501\u7684\u751f\u6210\u65f6\u673a\uff1a</p> <ul> <li>\u6bcf\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\uff0c\u90fd\u9700\u8981\u770b\u4e00\u4e0b\u5f85\u63d2\u5165\u8bb0\u5f55\u7684\u4e0b\u4e00\u6761\u8bb0\u5f55\u4e0a\u662f\u5426\u5df2\u7ecf\u88ab\u52a0\u4e86\u95f4\u9699\u9501\uff0c\u5982\u679c\u5df2\u52a0\u95f4\u9699\u9501\uff0c\u6b64\u65f6\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u9501\u7684\u72b6\u6001\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\uff08PS\uff1aMySQL \u52a0\u9501\u65f6\uff0c\u662f\u5148\u751f\u6210\u9501\u7ed3\u6784\uff0c\u7136\u540e\u8bbe\u7f6e\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u72b6\u6001\u662f\u7b49\u5f85\u72b6\u6001\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u53ea\u6709\u5f53\u9501\u72b6\u6001\u4e3a\u6b63\u5e38\u72b6\u6001\u65f6\uff0c\u624d\u4ee3\u8868\u4e8b\u52a1\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff09\uff0c\u73b0\u8c61\u5c31\u662f Insert \u8bed\u53e5\u4f1a\u88ab\u963b\u585e\u3002</li> </ul>"},{"location":"mysql/lock/show_lock/#time-4","title":"Time 4 \u9636\u6bb5\u52a0\u9501\u5206\u6790","text":"<p>Time 4\uff0c\u4e8b\u52a1 B \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff1a</p> SQL<pre><code># Time 4 \u9636\u6bb5\uff0c\u4e8b\u52a1 B \u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\nmysql&gt; insert into t_student(id, no, name, age,score) value (26, 'S0026', 'ace', 28, 90);\n    /// \u963b\u585e\u7b49\u5f85......\n</code></pre> <p>\u6b64\u65f6\uff0c\u4e8b\u52a1 B \u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\u3002</p> <p>\u7136\u540e\u6267\u884c <code>select * from performance_schema.data_locks\\G;</code> \u8fd9\u6761\u8bed\u53e5\uff0c\u67e5\u770b\u4e8b\u52a1 B \u5728\u83b7\u53d6\u4ec0\u4e48\u9501\u800c\u5bfc\u81f4\u88ab\u963b\u585e\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 B \u5728\u751f\u6210\u63d2\u5165\u610f\u5411\u9501\u65f6\u800c\u5bfc\u81f4\u88ab\u963b\u585e\uff0c\u8fd9\u662f\u56e0\u4e3a\u4e8b\u52a1 B \u5411\u4e8b\u52a1 A \u751f\u6210\u7684\u8303\u56f4\u4e3a (20, 30) \u7684\u95f4\u9699\u9501\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u800c\u63d2\u5165\u610f\u5411\u9501\u548c\u95f4\u9699\u9501\u662f\u51b2\u7a81\u7684\uff0c\u6240\u4ee5\u4e8b\u52a1  B \u5728\u83b7\u53d6\u63d2\u5165\u610f\u5411\u9501\u65f6\u5c31\u9677\u5165\u4e86\u7b49\u5f85\u72b6\u6001\u3002</p> <p>\u6700\u540e\u56de\u7b54\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u6b7b\u9501\uff1f</p> <p>\u672c\u6b21\u6848\u4f8b\u4e2d\uff0c\u4e8b\u52a1 A \u548c\u4e8b\u52a1 B \u5728\u6267\u884c\u5b8c\u540e update \u8bed\u53e5\u540e\u90fd\u6301\u6709\u8303\u56f4\u4e3a<code>(20, 30\uff09</code>\u7684\u95f4\u9699\u9501\uff0c\u800c\u63a5\u4e0b\u6765\u7684\u63d2\u5165\u64cd\u4f5c\u4e3a\u4e86\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u91ca\u653e\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u5faa\u73af\u7b49\u5f85\uff0c\u6ee1\u8db3\u4e86\u6b7b\u9501\u7684\u56db\u4e2a\u6761\u4ef6\uff1a\u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5f3a\u5360\u7528\u3001\u5faa\u73af\u7b49\u5f85\uff0c\u56e0\u6b64\u53d1\u751f\u4e86\u6b7b\u9501\u3002</p>"},{"location":"mysql/lock/show_lock/#_5","title":"\u603b\u7ed3","text":"<p>\u4e24\u4e2a\u4e8b\u52a1\u5373\u4f7f\u751f\u6210\u7684\u95f4\u9699\u9501\u7684\u8303\u56f4\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81\uff0c\u56e0\u4e3a\u95f4\u9699\u9501\u76ee\u7684\u662f\u4e3a\u4e86\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u6570\u636e\uff0c\u56e0\u6b64\u95f4\u9699\u9501\u4e0e\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u76f8\u4e92\u517c\u5bb9\u7684\u3002</p> <p>\u5728\u6267\u884c\u63d2\u5165\u8bed\u53e5\u65f6\uff0c\u5982\u679c\u63d2\u5165\u7684\u8bb0\u5f55\u5728\u5176\u4ed6\u4e8b\u52a1\u6301\u6709\u95f4\u9699\u9501\u8303\u56f4\u5185\uff0c\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u63d2\u5165\u8bed\u53e5\u5728\u78b0\u5230\u95f4\u9699\u9501\u65f6\uff0c\u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u7136\u540e\u63d2\u5165\u610f\u5411\u9501\u548c\u95f4\u9699\u9501\u4e4b\u95f4\u662f\u4e92\u65a5\u7684\u5173\u7cfb\u3002</p> <p>\u5982\u679c\u4e24\u4e2a\u4e8b\u52a1\u5206\u522b\u5411\u5bf9\u65b9\u6301\u6709\u7684\u95f4\u9699\u9501\u8303\u56f4\u5185\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\uff0c\u800c\u63d2\u5165\u64cd\u4f5c\u4e3a\u4e86\u83b7\u53d6\u5230\u63d2\u5165\u610f\u5411\u9501\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u4e8b\u52a1\u7684\u95f4\u9699\u9501\u91ca\u653e\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u5faa\u73af\u7b49\u5f85\uff0c\u6ee1\u8db3\u4e86\u6b7b\u9501\u7684\u56db\u4e2a\u6761\u4ef6\uff1a\u4e92\u65a5\u3001\u5360\u6709\u4e14\u7b49\u5f85\u3001\u4e0d\u53ef\u5f3a\u5360\u7528\u3001\u5faa\u73af\u7b49\u5f85\uff0c\u56e0\u6b64\u53d1\u751f\u4e86\u6b7b\u9501\u3002</p>"},{"location":"mysql/lock/show_lock/#_6","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/lock/update_index/","title":"update \u6ca1\u52a0\u7d22\u5f15\u4f1a\u9501\u5168\u8868\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6628\u665a\u5728\u7fa4\u5212\u6c34\u7684\u65f6\u5019\uff0c\u770b\u5230\u6709\u4f4d\u8bfb\u8005\u8bf4\u4e86\u8fd9\u4e48\u4e00\u4ef6\u4e8b\u3002</p> <p></p> <p>\u5927\u6982\u5c31\u662f\uff0c\u5728\u7ebf\u4e0a\u6267\u884c\u4e00\u6761 update \u8bed\u53e5\u4fee\u6539\u6570\u636e\u5e93\u6570\u636e\u7684\u65f6\u5019\uff0cwhere \u6761\u4ef6\u6ca1\u6709\u5e26\u4e0a\u7d22\u5f15\uff0c\u5bfc\u81f4\u4e1a\u52a1\u76f4\u63a5\u5d29\u4e86\uff0c\u88ab\u8001\u677f\u6559\u8bad\u4e86\u4e00\u6ce2</p> <p>\u8fd9\u6b21\u6211\u4eec\u5c31\u6765\u770b\u770b\uff1a - \u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8fd9\u79cd\u7684\u4e8b\u6545\uff1f - \u53c8\u8be5\u5982\u4f55\u907f\u514d\u8fd9\u79cd\u4e8b\u6545\u7684\u53d1\u751f\uff1f</p> <p>\u8bf4\u4e2a\u524d\u63d0\uff0c\u63a5\u4e0b\u6765\u8bf4\u7684\u6848\u4f8b\u90fd\u662f\u57fa\u4e8e InnoDB \u5b58\u50a8\u5f15\u64ce\uff0c\u4e14\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u662f\u53ef\u91cd\u590d\u8bfb\u3002</p>"},{"location":"mysql/lock/update_index/#_1","title":"\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8fd9\u79cd\u7684\u4e8b\u6545\uff1f","text":"<p>InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u9ed8\u8ba4\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5728\u8fd9\u4e2a\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u5728\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u7684\u65f6\u5019\uff0c\u4f1a\u51fa\u73b0\u5e7b\u8bfb\u7684\u95ee\u9898\uff0c\u6240\u8c13\u7684\u5e7b\u8bfb\u662f\u6307\u5728\u540c\u4e00\u4e8b\u52a1\u4e0b\uff0c\u8fde\u7eed\u6267\u884c\u4e24\u6b21\u540c\u6837\u7684\u67e5\u8be2\u8bed\u53e5\uff0c\u7b2c\u4e8c\u6b21\u7684\u67e5\u8be2\u8bed\u53e5\u53ef\u80fd\u4f1a\u8fd4\u56de\u4e4b\u524d\u4e0d\u5b58\u5728\u7684\u884c\u3002</p> <p>\u56e0\u6b64 InnoDB \u5b58\u50a8\u5f15\u64ce\u81ea\u5df1\u5b9e\u73b0\u4e86\u884c\u9501\uff0c\u901a\u8fc7 next-key  \u9501\uff08\u8bb0\u5f55\u9501\u548c\u95f4\u9699\u9501\u7684\u7ec4\u5408\uff09\u6765\u9501\u4f4f\u8bb0\u5f55\u672c\u8eab\u548c\u8bb0\u5f55\u4e4b\u95f4\u7684\u201c\u95f4\u9699\u201d\uff0c\u9632\u6b62\u5176\u4ed6\u4e8b\u52a1\u5728\u8fd9\u4e2a\u8bb0\u5f55\u4e4b\u95f4\u63d2\u5165\u65b0\u7684\u8bb0\u5f55\uff0c\u4ece\u800c\u907f\u514d\u4e86\u5e7b\u8bfb\u73b0\u8c61\u3002</p> <p>\u5f53\u6211\u4eec\u6267\u884c update \u8bed\u53e5\u65f6\uff0c\u5b9e\u9645\u4e0a\u662f\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u72ec\u5360\u9501\uff08X \u9501\uff09\u7684\uff0c\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u5bf9\u6301\u6709\u72ec\u5360\u9501\u7684\u8bb0\u5f55\u8fdb\u884c\u4fee\u6539\u65f6\u662f\u4f1a\u88ab\u963b\u585e\u7684\u3002\u53e6\u5916\uff0c\u8fd9\u4e2a\u9501\u5e76\u4e0d\u662f\u6267\u884c\u5b8c update \u8bed\u53e5\u5c31\u4f1a\u91ca\u653e\u7684\uff0c\u800c\u662f\u4f1a\u7b49\u4e8b\u52a1\u7ed3\u675f\u65f6\u624d\u4f1a\u91ca\u653e\u3002</p> <p>\u5728 InnoDB \u4e8b\u52a1\u4e2d\uff0c\u5bf9\u8bb0\u5f55\u52a0\u9501\u5e26\u57fa\u672c\u5355\u4f4d\u662f next-key \u9501\uff0c\u4f46\u662f\u4f1a\u56e0\u4e3a\u4e00\u4e9b\u6761\u4ef6\u4f1a\u9000\u5316\u6210\u95f4\u9699\u9501\uff0c\u6216\u8005\u8bb0\u5f55\u9501\u3002\u52a0\u9501\u7684\u4f4d\u7f6e\u51c6\u786e\u7684\u8bf4\uff0c\u9501\u662f\u52a0\u5728\u7d22\u5f15\u4e0a\u7684\u800c\u975e\u884c\u4e0a\u3002</p> <p>\u6bd4\u5982\uff0c\u5728 update \u8bed\u53e5\u7684 where \u6761\u4ef6\u4f7f\u7528\u4e86\u552f\u4e00\u7d22\u5f15\uff0c\u90a3\u4e48 next-key \u9501\u4f1a\u9000\u5316\u6210\u8bb0\u5f55\u9501\uff0c\u4e5f\u5c31\u662f\u53ea\u4f1a\u7ed9\u4e00\u884c\u8bb0\u5f55\u52a0\u9501\u3002</p> <p>\u8fd9\u91cc\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u8fd9\u91cc\u6709\u4e00\u5f20\u6570\u636e\u5e93\u8868\uff0c\u5176\u4e2d id \u4e3a\u4e3b\u952e\u7d22\u5f15\u3002</p> <p></p> <p>\u5047\u8bbe\u6709\u4e24\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e8b\u52a1 A \u7684 update \u8bed\u53e5\u4e2d where \u662f\u7b49\u503c\u67e5\u8be2\uff0c\u5e76\u4e14 id \u662f\u552f\u4e00\u7d22\u5f15\uff0c\u6240\u4ee5\u53ea\u4f1a\u5bf9 id = 1 \u8fd9\u6761\u8bb0\u5f55\u52a0\u9501\uff0c\u56e0\u6b64\uff0c\u4e8b\u52a1 B \u7684\u66f4\u65b0\u64cd\u4f5c\u5e76\u4e0d\u4f1a\u963b\u585e\u3002</p> <p>\u4f46\u662f\uff0c\u5728 update \u8bed\u53e5\u7684 where \u6761\u4ef6\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u5c31\u4f1a\u5168\u8868\u626b\u63cf\uff0c\u4e8e\u662f\u5c31\u4f1a\u5bf9\u6240\u6709\u8bb0\u5f55\u52a0\u4e0a next-key \u9501\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\uff0c\u76f8\u5f53\u4e8e\u628a\u6574\u4e2a\u8868\u9501\u4f4f\u4e86\u3002</p> <p>\u5047\u8bbe\u6709\u4e24\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u6b21\u4e8b\u52a1 B \u7684 update \u8bed\u53e5\u88ab\u963b\u585e\u4e86\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a\u4e8b\u52a1 A \u7684 update \u8bed\u53e5\u4e2d where \u6761\u4ef6\u6ca1\u6709\u7d22\u5f15\u5217\uff0c\u89e6\u53d1\u4e86\u5168\u8868\u626b\u63cf\uff0c\u5728\u626b\u63cf\u8fc7\u7a0b\u4e2d\u4f1a\u5bf9\u7d22\u5f15\u52a0\u9501\uff0c\u6240\u4ee5\u5168\u8868\u626b\u63cf\u7684\u573a\u666f\u4e0b\uff0c\u6240\u6709\u8bb0\u5f55\u90fd\u4f1a\u88ab\u52a0\u9501\uff0c\u4e5f\u5c31\u662f\u8fd9\u6761 update \u8bed\u53e5\u4ea7\u751f\u4e86 4 \u4e2a\u8bb0\u5f55\u9501\u548c 5 \u4e2a\u95f4\u9699\u9501\uff0c\u76f8\u5f53\u4e8e\u9501\u4f4f\u4e86\u5168\u8868\u3002</p> <p></p> <p>\u56e0\u6b64\uff0c\u5f53\u5728\u6570\u636e\u91cf\u975e\u5e38\u5927\u7684\u6570\u636e\u5e93\u8868\u6267\u884c update \u8bed\u53e5\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u4f7f\u7528\u7d22\u5f15\uff0c\u5c31\u4f1a\u7ed9\u5168\u8868\u7684\u52a0\u4e0a next-key \u9501\uff0c\u90a3\u4e48\u9501\u5c31\u4f1a\u6301\u7eed\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff0c\u76f4\u5230\u4e8b\u52a1\u7ed3\u675f\uff0c\u800c\u8fd9\u671f\u95f4\u9664\u4e86 <code>select ... from</code>\u8bed\u53e5\uff0c\u5176\u4ed6\u8bed\u53e5\u90fd\u4f1a\u88ab\u9501\u4f4f\u4e0d\u80fd\u6267\u884c\uff0c\u4e1a\u52a1\u4f1a\u56e0\u6b64\u505c\u6ede\uff0c\u63a5\u4e0b\u6765\u7b49\u7740\u4f60\u7684\uff0c\u5c31\u662f\u8001\u677f\u7684\u6328\u9a82\u3002</p> <p>\u90a3 update \u8bed\u53e5\u7684 where \u5e26\u4e0a\u7d22\u5f15\u5c31\u80fd\u907f\u514d\u5168\u8868\u8bb0\u5f55\u52a0\u9501\u4e86\u5417\uff1f</p> <p>\u5e76\u4e0d\u662f\u3002</p> <p>\u5173\u952e\u8fd8\u5f97\u770b\u8fd9\u6761\u8bed\u53e5\u5728\u6267\u884c\u8fc7\u7a0b\u79cd\uff0c\u4f18\u5316\u5668\u6700\u7ec8\u9009\u62e9\u7684\u662f\u7d22\u5f15\u626b\u63cf\uff0c\u8fd8\u662f\u5168\u8868\u626b\u63cf\uff0c\u5982\u679c\u8d70\u4e86\u5168\u8868\u626b\u63cf\uff0c\u5c31\u4f1a\u5bf9\u5168\u8868\u7684\u8bb0\u5f55\u52a0\u9501\u4e86\u3002</p> <p>:::tip</p> <p>\u7f51\u4e0a\u5f88\u591a\u8d44\u6599\u8bf4\uff0cupdate \u6ca1\u52a0\u9501\u7d22\u5f15\u4f1a\u52a0\u8868\u9501\uff0c\u8fd9\u662f\u4e0d\u5bf9\u7684\u3002</p> <p>Innodb \u6e90\u7801\u91cc\u9762\u5728\u626b\u63cf\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u90fd\u662f\u9488\u5bf9\u7d22\u5f15\u9879\u8fd9\u4e2a\u5355\u4f4d\u53bb\u52a0\u9501\u7684\uff0cupdate \u4e0d\u5e26\u7d22\u5f15\u5c31\u662f\u5168\u8868\u626b\u626b\u63cf\uff0c\u4e5f\u5c31\u662f\u8868\u91cc\u7684\u7d22\u5f15\u9879\u90fd\u52a0\u9501\uff0c\u76f8\u5f53\u4e8e\u9501\u4e86\u6574\u5f20\u8868\uff0c\u6240\u4ee5\u5927\u5bb6\u8bef\u4ee5\u4e3a\u52a0\u4e86\u8868\u9501\u3002</p> <p>:::</p>"},{"location":"mysql/lock/update_index/#_2","title":"\u5982\u4f55\u907f\u514d\u8fd9\u79cd\u4e8b\u6545\u7684\u53d1\u751f\uff1f","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5c06 MySQL \u91cc\u7684 <code>sql_safe_updates</code> \u53c2\u6570\u8bbe\u7f6e\u4e3a 1\uff0c\u5f00\u542f\u5b89\u5168\u66f4\u65b0\u6a21\u5f0f\u3002</p> <p>\u5b98\u65b9\u7684\u89e3\u91ca\uff1a If set to 1, MySQL aborts UPDATE or DELETE statements that do not use a key in the WHERE clause or a LIMIT clause. (Specifically, UPDATE statements must have a WHERE clause that uses a key or a LIMIT clause, or both. DELETE statements must have both.) This makes it possible to catch UPDATE or DELETE statements where keys are not used properly and that would probably change or delete a large number of rows. The default value is 0.</p> <p>\u5927\u81f4\u7684\u610f\u601d\u662f\uff0c\u5f53 sql_safe_updates \u8bbe\u7f6e\u4e3a 1 \u65f6\u3002</p> <p>update \u8bed\u53e5\u5fc5\u987b\u6ee1\u8db3\u5982\u4e0b\u6761\u4ef6\u4e4b\u4e00\u624d\u80fd\u6267\u884c\u6210\u529f\uff1a - \u4f7f\u7528 where\uff0c\u5e76\u4e14 where \u6761\u4ef6\u4e2d\u5fc5\u987b\u6709\u7d22\u5f15\u5217\uff1b - \u4f7f\u7528 limit\uff1b - \u540c\u65f6\u4f7f\u7528 where \u548c limit\uff0c\u6b64\u65f6 where \u6761\u4ef6\u4e2d\u53ef\u4ee5\u6ca1\u6709\u7d22\u5f15\u5217\uff1b</p> <p>delete \u8bed\u53e5\u5fc5\u987b\u6ee1\u8db3\u4ee5\u4e0b\u6761\u4ef6\u80fd\u6267\u884c\u6210\u529f\uff1a - \u540c\u65f6\u4f7f\u7528 where \u548c limit\uff0c\u6b64\u65f6 where \u6761\u4ef6\u4e2d\u53ef\u4ee5\u6ca1\u6709\u7d22\u5f15\u5217\uff1b</p> <p>\u5982\u679c where \u6761\u4ef6\u5e26\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u4f46\u662f\u4f18\u5316\u5668\u6700\u7ec8\u626b\u63cf\u9009\u62e9\u7684\u662f\u5168\u8868\uff0c\u800c\u4e0d\u662f\u7d22\u5f15\u7684\u8bdd\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>force index([index_name])</code> \u53ef\u4ee5\u544a\u8bc9\u4f18\u5316\u5668\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\uff0c\u4ee5\u6b64\u907f\u514d\u6709\u51e0\u7387\u9501\u5168\u8868\u5e26\u6765\u7684\u9690\u60a3\u3002</p>"},{"location":"mysql/lock/update_index/#_3","title":"\u603b\u7ed3","text":"<p>\u4e0d\u8981\u5c0f\u770b\u4e00\u6761 update \u8bed\u53e5\uff0c\u5728\u751f\u4ea7\u673a\u4e0a\u4f7f\u7528\u4e0d\u5f53\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e1a\u52a1\u505c\u6ede\uff0c\u751a\u81f3\u5d29\u6e83\u3002</p> <p>\u5f53\u6211\u4eec\u8981\u6267\u884c update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u786e\u4fdd where \u6761\u4ef6\u4e2d\u5e26\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u5e76\u4e14\u5728\u6d4b\u8bd5\u673a\u786e\u8ba4\u8be5\u8bed\u53e5\u662f\u5426\u8d70\u7684\u662f\u7d22\u5f15\u626b\u63cf\uff0c\u9632\u6b62\u56e0\u4e3a\u626b\u63cf\u5168\u8868\uff0c\u800c\u5bf9\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u52a0\u4e0a\u9501\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6253\u5f00 MySQL sql_safe_updates \u53c2\u6570\uff0c\u8fd9\u6837\u53ef\u4ee5\u9884\u9632 update \u64cd\u4f5c\u65f6 where \u6761\u4ef6\u6ca1\u6709\u5e26\u4e0a\u7d22\u5f15\u5217\u3002</p> <p>\u5982\u679c\u53d1\u73b0\u5373\u4f7f\u5728 where \u6761\u4ef6\u4e2d\u5e26\u4e0a\u4e86\u7d22\u5f15\u5217\uff0c\u4f18\u5316\u5668\u8d70\u7684\u8fd8\u662f\u5168\u8868\u626b\u63cf\uff0c\u8fd9\u65f6\u6211\u4eec\u5c31\u8981\u4f7f\u7528 <code>force index([index_name])</code> \u53ef\u4ee5\u544a\u8bc9\u4f18\u5316\u5668\u4f7f\u7528\u54ea\u4e2a\u7d22\u5f15\u3002</p> <p>\u8fd9\u6b21\u5c31\u8bf4\u5230\u8fd9\u5566\uff0c\u4e0b\u6b21\u8981\u5c0f\u5fc3\u70b9\uff0c\u522b\u518d\u88ab\u8001\u677f\u6328\u9a82\u5566\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/log/","title":"Index","text":"<p>redo log\u3001binlog\u3001undolog \u6b63\u5728\u8d76\u7a3f\u7684\u8def\u4e0a\u3002\u3002\u3002\u3002\u3002</p>"},{"location":"mysql/log/how_update/","title":"MySQL \u65e5\u5fd7\uff1aundo log\u3001redo log\u3001binlog \u6709\u4ec0\u4e48\u7528\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4ece\u8fd9\u7bc7\u300c\u6267\u884c\u4e00\u6761 SQL \u67e5\u8be2\u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f\u300d\u4e2d\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u4e00\u6761\u67e5\u8be2\u8bed\u53e5\u7ecf\u5386\u7684\u8fc7\u7a0b\uff0c\u8fd9\u5c5e\u4e8e\u300c\u8bfb\u300d\u4e00\u6761\u8bb0\u5f55\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u90a3\u4e48\uff0c\u6267\u884c\u4e00\u6761 update \u8bed\u53e5\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f\uff0c\u6bd4\u5982\u8fd9\u4e00\u6761 update \u8bed\u53e5\uff1a</p> SQL<pre><code>UPDATE t_user SET name = 'xiaolin' WHERE id = 1;\n</code></pre> <p>\u67e5\u8be2\u8bed\u53e5\u7684\u90a3\u4e00\u5957\u6d41\u7a0b\uff0c\u66f4\u65b0\u8bed\u53e5\u4e5f\u662f\u540c\u6837\u4f1a\u8d70\u4e00\u904d\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u5148\u901a\u8fc7\u8fde\u63a5\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u8fde\u63a5\u5668\u81ea\u4f1a\u5224\u65ad\u7528\u6237\u8eab\u4efd\uff1b</li> <li>\u56e0\u4e3a\u8fd9\u662f\u4e00\u6761 update \u8bed\u53e5\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u7ecf\u8fc7\u67e5\u8be2\u7f13\u5b58\uff0c\u4f46\u662f\u8868\u4e0a\u6709\u66f4\u65b0\u8bed\u53e5\uff0c\u662f\u4f1a\u628a\u6574\u4e2a\u8868\u7684\u67e5\u8be2\u7f13\u5b58\u6e05\u7a7a\u7684\uff0c\u6240\u4ee5\u8bf4\u67e5\u8be2\u7f13\u5b58\u5f88\u9e21\u808b\uff0c\u5728 MySQL 8.0 \u5c31\u88ab\u79fb\u9664\u8fd9\u4e2a\u529f\u80fd\u4e86\uff1b</li> <li>\u89e3\u6790\u5668\u4f1a\u901a\u8fc7\u8bcd\u6cd5\u5206\u6790\u8bc6\u522b\u51fa\u5173\u952e\u5b57 update\uff0c\u8868\u540d\u7b49\u7b49\uff0c\u6784\u5efa\u51fa\u8bed\u6cd5\u6811\uff0c\u63a5\u7740\u8fd8\u4f1a\u505a\u8bed\u6cd5\u5206\u6790\uff0c\u5224\u65ad\u8f93\u5165\u7684\u8bed\u53e5\u662f\u5426\u7b26\u5408 MySQL \u8bed\u6cd5\uff1b</li> <li>\u9884\u5904\u7406\u5668\u4f1a\u5224\u65ad\u8868\u548c\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff1b</li> <li>\u4f18\u5316\u5668\u786e\u5b9a\u6267\u884c\u8ba1\u5212\uff0c\u56e0\u4e3a where \u6761\u4ef6\u4e2d\u7684 id \u662f\u4e3b\u952e\u7d22\u5f15\uff0c\u6240\u4ee5\u51b3\u5b9a\u8981\u4f7f\u7528 id \u8fd9\u4e2a\u7d22\u5f15\uff1b</li> <li>\u6267\u884c\u5668\u8d1f\u8d23\u5177\u4f53\u6267\u884c\uff0c\u627e\u5230\u8fd9\u4e00\u884c\uff0c\u7136\u540e\u66f4\u65b0\u3002</li> </ul> <p>\u4e0d\u8fc7\uff0c\u66f4\u65b0\u8bed\u53e5\u7684\u6d41\u7a0b\u4f1a\u6d89\u53ca\u5230  undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09\u3001redo log\uff08\u91cd\u505a\u65e5\u5fd7\uff09 \u3001binlog\uff08\u5f52\u6863\u65e5\u5fd7\uff09\u8fd9\u4e09\u79cd\u65e5\u5fd7\uff1a</p> <ul> <li>undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09\uff1a\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u5c42\u751f\u6210\u7684\u65e5\u5fd7\uff0c\u5b9e\u73b0\u4e86\u4e8b\u52a1\u4e2d\u7684\u539f\u5b50\u6027\uff0c\u4e3b\u8981\u7528\u4e8e\u4e8b\u52a1\u56de\u6eda\u548c MVCC\u3002</li> <li>redo log\uff08\u91cd\u505a\u65e5\u5fd7\uff09\uff1a\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u5c42\u751f\u6210\u7684\u65e5\u5fd7\uff0c\u5b9e\u73b0\u4e86\u4e8b\u52a1\u4e2d\u7684\u6301\u4e45\u6027\uff0c\u4e3b\u8981\u7528\u4e8e\u6389\u7535\u7b49\u6545\u969c\u6062\u590d\uff1b</li> <li>binlog\uff08\u5f52\u6863\u65e5\u5fd7\uff09\uff1a\u662f Server \u5c42\u751f\u6210\u7684\u65e5\u5fd7\uff0c\u4e3b\u8981\u7528\u4e8e\u6570\u636e\u5907\u4efd\u548c\u4e3b\u4ece\u590d\u5236\uff1b</li> </ul> <p>\u6240\u4ee5\u8fd9\u6b21\u5c31\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\uff0c\u770b\u770b\u8fd9\u4e09\u79cd\u65e5\u5fd7\u662f\u600e\u4e48\u5de5\u4f5c\u7684\u3002</p> <p></p>"},{"location":"mysql/log/how_update/#undo-log","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 undo log\uff1f","text":"<p>\u6211\u4eec\u5728\u6267\u884c\u6267\u884c\u4e00\u6761\u201c\u589e\u5220\u6539\u201d\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u867d\u7136\u6ca1\u6709\u8f93\u5165 begin \u5f00\u542f\u4e8b\u52a1\u548c commit \u63d0\u4ea4\u4e8b\u52a1\uff0c\u4f46\u662f MySQL \u4f1a\u9690\u5f0f\u5f00\u542f\u4e8b\u52a1\u6765\u6267\u884c\u201c\u589e\u5220\u6539\u201d\u8bed\u53e5\u7684\uff0c\u6267\u884c\u5b8c\u5c31\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1\u7684\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u6267\u884c\u5b8c\u201c\u589e\u5220\u6539\u201d\u8bed\u53e5\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u53ca\u65f6\u5728\u6570\u636e\u5e93\u8868\u770b\u5230\u201c\u589e\u5220\u6539\u201d\u7684\u7ed3\u679c\u4e86\u3002</p> <p>\u6267\u884c\u4e00\u6761\u8bed\u53e5\u662f\u5426\u81ea\u52a8\u63d0\u4ea4\u4e8b\u52a1\uff0c\u662f\u7531 <code>autocommit</code> \u53c2\u6570\u51b3\u5b9a\u7684\uff0c\u9ed8\u8ba4\u662f\u5f00\u542f\u3002\u6240\u4ee5\uff0c\u6267\u884c\u4e00\u6761 update \u8bed\u53e5\u4e5f\u662f\u4f1a\u4f7f\u7528\u4e8b\u52a1\u7684\u3002</p> <p>\u90a3\u4e48\uff0c\u8003\u8651\u4e00\u4e2a\u95ee\u9898\u3002\u4e00\u4e2a\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5728\u8fd8\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\u4e4b\u524d\uff0c\u5982\u679c MySQL \u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u8981\u600e\u4e48\u56de\u6eda\u5230\u4e8b\u52a1\u4e4b\u524d\u7684\u6570\u636e\u5462\uff1f</p> <p>\u5982\u679c\u6211\u4eec\u6bcf\u6b21\u5728\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u90fd\u8bb0\u5f55\u4e0b\u56de\u6eda\u65f6\u9700\u8981\u7684\u4fe1\u606f\u5230\u4e00\u4e2a\u65e5\u5fd7\u91cc\uff0c\u90a3\u4e48\u5728\u4e8b\u52a1\u6267\u884c\u4e2d\u9014\u53d1\u751f\u4e86 MySQL \u5d29\u6e83\u540e\uff0c\u5c31\u4e0d\u7528\u62c5\u5fc3\u65e0\u6cd5\u56de\u6eda\u5230\u4e8b\u52a1\u4e4b\u524d\u7684\u6570\u636e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u65e5\u5fd7\u56de\u6eda\u5230\u4e8b\u52a1\u4e4b\u524d\u7684\u6570\u636e\u3002</p> <p>\u5b9e\u73b0\u8fd9\u4e00\u673a\u5236\u5c31\u662f  undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09\uff0c\u5b83\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u7684 ACID \u7279\u6027\u4e2d\u7684\u539f\u5b50\u6027\uff08Atomicity\uff09\u3002</p> <p>undo log \u662f\u4e00\u79cd\u7528\u4e8e\u64a4\u9500\u56de\u9000\u7684\u65e5\u5fd7\u3002\u5728\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u4e4b\u524d\uff0cMySQL \u4f1a\u5148\u8bb0\u5f55\u66f4\u65b0\u524d\u7684\u6570\u636e\u5230 undo log \u65e5\u5fd7\u6587\u4ef6\u91cc\u9762\uff0c\u5f53\u4e8b\u52a1\u56de\u6eda\u65f6\uff0c\u53ef\u4ee5\u5229\u7528 undo log \u6765\u8fdb\u884c\u56de\u6eda\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6bcf\u5f53 InnoDB \u5f15\u64ce\u5bf9\u4e00\u6761\u8bb0\u5f55\u8fdb\u884c\u64cd\u4f5c\uff08\u4fee\u6539\u3001\u5220\u9664\u3001\u65b0\u589e\uff09\u65f6\uff0c\u8981\u628a\u56de\u6eda\u65f6\u9700\u8981\u7684\u4fe1\u606f\u90fd\u8bb0\u5f55\u5230 undo log \u91cc\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5728\u63d2\u5165\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u8981\u628a\u8fd9\u6761\u8bb0\u5f55\u7684\u4e3b\u952e\u503c\u8bb0\u4e0b\u6765\uff0c\u8fd9\u6837\u4e4b\u540e\u56de\u6eda\u65f6\u53ea\u9700\u8981\u628a\u8fd9\u4e2a\u4e3b\u952e\u503c\u5bf9\u5e94\u7684\u8bb0\u5f55\u5220\u6389\u5c31\u597d\u4e86\uff1b</li> <li>\u5728\u5220\u9664\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u8981\u628a\u8fd9\u6761\u8bb0\u5f55\u4e2d\u7684\u5185\u5bb9\u90fd\u8bb0\u4e0b\u6765\uff0c\u8fd9\u6837\u4e4b\u540e\u56de\u6eda\u65f6\u518d\u628a\u7531\u8fd9\u4e9b\u5185\u5bb9\u7ec4\u6210\u7684\u8bb0\u5f55\u63d2\u5165\u5230\u8868\u4e2d\u5c31\u597d\u4e86\uff1b</li> <li>\u5728\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55\u65f6\uff0c\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u8fd9\u6837\u4e4b\u540e\u56de\u6eda\u65f6\u518d\u628a\u8fd9\u4e9b\u5217\u66f4\u65b0\u4e3a\u65e7\u503c\u5c31\u597d\u4e86\u3002</li> </ul> <p>\u5728\u53d1\u751f\u56de\u6eda\u65f6\uff0c\u5c31\u8bfb\u53d6 undo log \u91cc\u7684\u6570\u636e\uff0c\u7136\u540e\u505a\u539f\u5148\u76f8\u53cd\u64cd\u4f5c\u3002\u6bd4\u5982\u5f53 delete \u4e00\u6761\u8bb0\u5f55\u65f6\uff0cundo log \u4e2d\u4f1a\u628a\u8bb0\u5f55\u4e2d\u7684\u5185\u5bb9\u90fd\u8bb0\u4e0b\u6765\uff0c\u7136\u540e\u6267\u884c\u56de\u6eda\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5c31\u8bfb\u53d6 undo log \u91cc\u7684\u6570\u636e\uff0c\u7136\u540e\u8fdb\u884c insert \u64cd\u4f5c\u3002</p> <p>\u4e0d\u540c\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u8bb0\u5f55\u7684\u5185\u5bb9\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u6240\u4ee5\u4e0d\u540c\u7c7b\u578b\u7684\u64cd\u4f5c\uff08\u4fee\u6539\u3001\u5220\u9664\u3001\u65b0\u589e\uff09\u4ea7\u751f\u7684 undo log \u7684\u683c\u5f0f\u4e5f\u662f\u4e0d\u540c\u7684\uff0c\u5177\u4f53\u7684\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u7684 undo log \u7684\u683c\u5f0f\u6211\u5c31\u4e0d\u8be6\u7ec6\u4ecb\u7ecd\u4e86\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u81ea\u5df1\u53bb\u67e5\u67e5\u3002</p> <p>\u4e00\u6761\u8bb0\u5f55\u7684\u6bcf\u4e00\u6b21\u66f4\u65b0\u64cd\u4f5c\u4ea7\u751f\u7684 undo log \u683c\u5f0f\u90fd\u6709\u4e00\u4e2a roll_pointer \u6307\u9488\u548c\u4e00\u4e2a trx_id \u4e8b\u52a1 id\uff1a</p> <ul> <li>\u901a\u8fc7 trx_id \u53ef\u4ee5\u77e5\u9053\u8be5\u8bb0\u5f55\u662f\u88ab\u54ea\u4e2a\u4e8b\u52a1\u4fee\u6539\u7684\uff1b</li> <li>\u901a\u8fc7 roll_pointer \u6307\u9488\u53ef\u4ee5\u5c06\u8fd9\u4e9b undo log \u4e32\u6210\u4e00\u4e2a\u94fe\u8868\uff0c\u8fd9\u4e2a\u94fe\u8868\u5c31\u88ab\u79f0\u4e3a\u7248\u672c\u94fe\uff1b</li> </ul> <p>\u7248\u672c\u94fe\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u53e6\u5916\uff0cundo log \u8fd8\u6709\u4e00\u4e2a\u4f5c\u7528\uff0c\u901a\u8fc7 ReadView + undo log \u5b9e\u73b0 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002</p> <p>\u5bf9\u4e8e\u300c\u8bfb\u63d0\u4ea4\u300d\u548c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u5b83\u4eec\u7684\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\u662f\u901a\u8fc7 Read View  + undo log \u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\u521b\u5efa Read View \u7684\u65f6\u673a\u4e0d\u540c\uff1a</p> <ul> <li>\u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u662f\u5728\u6bcf\u4e2a select \u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 Read View\uff0c\u4e5f\u610f\u5473\u7740\uff0c\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002</li> <li>\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u662f\u542f\u52a8\u4e8b\u52a1\u65f6\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u5728\u4e8b\u52a1\u671f\u95f4\u8bfb\u5230\u7684\u6570\u636e\u90fd\u662f\u4e8b\u52a1\u542f\u52a8\u524d\u7684\u8bb0\u5f55\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u9694\u79bb\u7ea7\u522b\u5b9e\u73b0\u662f\u901a\u8fc7\u300c\u4e8b\u52a1\u7684 Read View \u91cc\u7684\u5b57\u6bb5\u300d\u548c\u300c\u8bb0\u5f55\u4e2d\u7684\u4e24\u4e2a\u9690\u85cf\u5217\uff08trx_id \u548c roll_pointer\uff09\u300d\u7684\u6bd4\u5bf9\uff0c\u5982\u679c\u4e0d\u6ee1\u8db3\u53ef\u89c1\u884c\uff0c\u5c31\u4f1a\u987a\u7740 undo log \u7248\u672c\u94fe\u91cc\u627e\u5230\u6ee1\u8db3\u5176\u53ef\u89c1\u6027\u7684\u8bb0\u5f55\uff0c\u4ece\u800c\u63a7\u5236\u5e76\u53d1\u4e8b\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8bb0\u5f55\u65f6\u7684\u884c\u4e3a\uff0c\u8fd9\u5c31\u53eb MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002\u5177\u4f53\u7684\u5b9e\u73b0\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1a\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f</p> <p>\u56e0\u6b64\uff0cundo log \u4e24\u5927\u4f5c\u7528\uff1a</p> <ul> <li>\u5b9e\u73b0\u4e8b\u52a1\u56de\u6eda\uff0c\u4fdd\u969c\u4e8b\u52a1\u7684\u539f\u5b50\u6027\u3002\u4e8b\u52a1\u5904\u7406\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u51fa\u73b0\u4e86\u9519\u8bef\u6216\u8005\u7528\u6237\u6267   \u884c\u4e86 ROLLBACK \u8bed\u53e5\uff0cMySQL \u53ef\u4ee5\u5229\u7528 undo log \u4e2d\u7684\u5386\u53f2\u6570\u636e\u5c06\u6570\u636e\u6062\u590d\u5230\u4e8b\u52a1\u5f00\u59cb\u4e4b\u524d\u7684\u72b6\u6001\u3002</li> <li>\u5b9e\u73b0 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u5173\u952e\u56e0\u7d20\u4e4b\u4e00\u3002MVCC \u662f\u901a\u8fc7 ReadView + undo log \u5b9e\u73b0\u7684\u3002undo log \u4e3a\u6bcf\u6761\u8bb0\u5f55\u4fdd\u5b58\u591a\u4efd\u5386\u53f2\u6570\u636e\uff0cMySQL \u5728\u6267\u884c\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\u7684\u65f6\u5019\uff0c\u4f1a\u6839\u636e\u4e8b\u52a1\u7684 Read View \u91cc\u7684\u4fe1\u606f\uff0c\u987a\u7740 undo log \u7684\u7248\u672c\u94fe\u627e\u5230\u6ee1\u8db3\u5176\u53ef\u89c1\u6027\u7684\u8bb0\u5f55\u3002</li> </ul>"},{"location":"mysql/log/how_update/#buffer-pool","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 Buffer Pool\uff1f","text":"<p>MySQL \u7684\u6570\u636e\u90fd\u662f\u5b58\u5728\u78c1\u76d8\u4e2d\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u8981\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u5f97\u5148\u8981\u4ece\u78c1\u76d8\u8bfb\u53d6\u8be5\u8bb0\u5f55\uff0c\u7136\u540e\u5728\u5185\u5b58\u4e2d\u4fee\u6539\u8fd9\u6761\u8bb0\u5f55\u3002\u90a3\u4fee\u6539\u5b8c\u8fd9\u6761\u8bb0\u5f55\u662f\u9009\u62e9\u76f4\u63a5\u5199\u56de\u5230\u78c1\u76d8\uff0c\u8fd8\u662f\u9009\u62e9\u7f13\u5b58\u8d77\u6765\u5462\uff1f</p> <p>\u5f53\u7136\u662f\u7f13\u5b58\u8d77\u6765\u597d\uff0c\u8fd9\u6837\u4e0b\u6b21\u6709\u67e5\u8be2\u8bed\u53e5\u547d\u4e2d\u4e86\u8fd9\u6761\u8bb0\u5f55\uff0c\u76f4\u63a5\u8bfb\u53d6\u7f13\u5b58\u4e2d\u7684\u8bb0\u5f55\uff0c\u5c31\u4e0d\u9700\u8981\u4ece\u78c1\u76d8\u83b7\u53d6\u6570\u636e\u4e86\u3002</p> <p>\u4e3a\u6b64\uff0cInnodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u7f13\u51b2\u6c60\uff08Buffer Pool\uff09\uff0c\u6765\u63d0\u9ad8\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\u3002</p> <p></p> <p>\u6709\u4e86 Buffer Pool \u540e\uff1a</p> <ul> <li>\u5f53\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e Buffer Pool \u4e2d\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u76f4\u63a5\u8bfb\u53d6 Buffer Pool \u4e2d\u7684\u6570\u636e\uff0c\u5426\u5219\u518d\u53bb\u78c1\u76d8\u4e2d\u8bfb\u53d6\u3002</li> <li>\u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e  Buffer Pool  \u4e2d\uff0c\u90a3\u76f4\u63a5\u4fee\u6539 Buffer Pool \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff08\u8be5\u9875\u7684\u5185\u5b58\u6570\u636e\u548c\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u5df2\u7ecf\u4e0d\u4e00\u81f4\uff09\uff0c\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8 I/O\uff0c\u4e0d\u4f1a\u7acb\u5373\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff0c\u540e\u7eed\u7531\u540e\u53f0\u7ebf\u7a0b\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002</li> </ul>"},{"location":"mysql/log/how_update/#buffer-pool_1","title":"Buffer Pool \u7f13\u5b58\u4ec0\u4e48\uff1f","text":"<p>InnoDB \u4f1a\u628a\u5b58\u50a8\u7684\u6570\u636e\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u300c\u9875\u300d\uff0c\u4ee5\u9875\u4f5c\u4e3a\u78c1\u76d8\u548c\u5185\u5b58\u4ea4\u4e92\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u4e00\u4e2a\u9875\u7684\u9ed8\u8ba4\u5927\u5c0f\u4e3a 16KB\u3002\u56e0\u6b64\uff0cBuffer Pool \u540c\u6837\u9700\u8981\u6309\u300c\u9875\u300d\u6765\u5212\u5206\u3002</p> <p>\u5728 MySQL \u542f\u52a8\u7684\u65f6\u5019\uff0cInnoDB \u4f1a\u4e3a Buffer Pool \u7533\u8bf7\u4e00\u7247\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u6309\u7167\u9ed8\u8ba4\u7684<code>16KB</code>\u7684\u5927\u5c0f\u5212\u5206\u51fa\u4e00\u4e2a\u4e2a\u7684\u9875\uff0cBuffer Pool \u4e2d\u7684\u9875\u5c31\u53eb\u505a\u7f13\u5b58\u9875\u3002\u6b64\u65f6\u8fd9\u4e9b\u7f13\u5b58\u9875\u90fd\u662f\u7a7a\u95f2\u7684\uff0c\u4e4b\u540e\u968f\u7740\u7a0b\u5e8f\u7684\u8fd0\u884c\uff0c\u624d\u4f1a\u6709\u78c1\u76d8\u4e0a\u7684\u9875\u88ab\u7f13\u5b58\u5230 Buffer Pool \u4e2d\u3002</p> <p>\u6240\u4ee5\uff0cMySQL \u521a\u542f\u52a8\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u89c2\u5bdf\u5230\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5f88\u5927\uff0c\u800c\u4f7f\u7528\u5230\u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u5374\u5f88\u5c0f\uff0c\u8fd9\u662f\u56e0\u4e3a\u53ea\u6709\u8fd9\u4e9b\u865a\u62df\u5185\u5b58\u88ab\u8bbf\u95ee\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u624d\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u7533\u8bf7\u7269\u7406\u5185\u5b58\uff0c\u63a5\u7740\u5c06\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u5efa\u7acb\u6620\u5c04\u5173\u7cfb\u3002</p> <p>Buffer Pool \u9664\u4e86\u7f13\u5b58\u300c\u7d22\u5f15\u9875\u300d\u548c\u300c\u6570\u636e\u9875\u300d\uff0c\u8fd8\u5305\u62ec\u4e86 Undo \u9875\uff0c\u63d2\u5165\u7f13\u5b58\u3001\u81ea\u9002\u5e94\u54c8\u5e0c\u7d22\u5f15\u3001\u9501\u4fe1\u606f\u7b49\u7b49\u3002</p> <p></p> <p>Undo \u9875\u662f\u8bb0\u5f55\u4ec0\u4e48\uff1f</p> <p>\u5f00\u542f\u4e8b\u52a1\u540e\uff0cInnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u5982\u679c\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\u3002</p> <p>\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\uff0c\u5c31\u53ea\u9700\u8981\u7f13\u51b2\u4e00\u6761\u8bb0\u5f55\u5417\uff1f</p> <p>\u4e0d\u662f\u7684\u3002</p> <p>\u5f53\u6211\u4eec\u67e5\u8be2\u4e00\u6761\u8bb0\u5f55\u65f6\uff0cInnoDB \u662f\u4f1a\u628a\u6574\u4e2a\u9875\u7684\u6570\u636e\u52a0\u8f7d\u5230 Buffer Pool \u4e2d\uff0c\u5c06\u9875\u52a0\u8f7d\u5230 Buffer Pool \u540e\uff0c\u518d\u901a\u8fc7\u9875\u91cc\u7684\u300c\u9875\u76ee\u5f55\u300d\u53bb\u5b9a\u4f4d\u5230\u67d0\u6761\u5177\u4f53\u7684\u8bb0\u5f55\u3002</p> <p>\u5173\u4e8e\u9875\u7ed3\u6784\u957f\u4ec0\u4e48\u6837\u548c\u7d22\u5f15\u600e\u4e48\u67e5\u8be2\u6570\u636e\u7684\u95ee\u9898\u53ef\u4ee5\u5728\u8fd9\u7bc7\u627e\u5230\u7b54\u6848\uff1a\u6362\u4e00\u4e2a\u89d2\u5ea6\u770b B+ \u6811</p>"},{"location":"mysql/log/how_update/#redo-log","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 redo log\uff1f","text":"<p>Buffer Pool \u662f\u63d0\u9ad8\u4e86\u8bfb\u5199\u6548\u7387\u6ca1\u9519\uff0c\u4f46\u662f\u95ee\u9898\u6765\u4e86\uff0cBuffer Pool \u662f\u57fa\u4e8e\u5185\u5b58\u7684\uff0c\u800c\u5185\u5b58\u603b\u662f\u4e0d\u53ef\u9760\uff0c\u4e07\u4e00\u65ad\u7535\u91cd\u542f\uff0c\u8fd8\u6ca1\u6765\u5f97\u53ca\u843d\u76d8\u7684\u810f\u9875\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u65ad\u7535\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\uff0c\u5f53\u6709\u4e00\u6761\u8bb0\u5f55\u9700\u8981\u66f4\u65b0\u7684\u65f6\u5019\uff0cInnoDB \u5f15\u64ce\u5c31\u4f1a\u5148\u66f4\u65b0\u5185\u5b58\uff08\u540c\u65f6\u6807\u8bb0\u4e3a\u810f\u9875\uff09\uff0c\u7136\u540e\u5c06\u672c\u6b21\u5bf9\u8fd9\u4e2a\u9875\u7684\u4fee\u6539\u4ee5 redo log \u7684\u5f62\u5f0f\u8bb0\u5f55\u4e0b\u6765\uff0c\u8fd9\u4e2a\u65f6\u5019\u66f4\u65b0\u5c31\u7b97\u5b8c\u6210\u4e86\u3002</p> <p>\u540e\u7eed\uff0cInnoDB \u5f15\u64ce\u4f1a\u5728\u9002\u5f53\u7684\u65f6\u5019\uff0c\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u7f13\u5b58\u5728 Buffer Pool  \u7684\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u91cc\uff0c\u8fd9\u5c31\u662f  WAL\uff08Write-Ahead Logging\uff09\u6280\u672f\u3002</p> <p>WAL \u6280\u672f\u6307\u7684\u662f\uff0cMySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5199\u65e5\u5fd7\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u5199\u5230\u78c1\u76d8\u4e0a\u3002</p> <p>\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4ec0\u4e48\u662f  redo log\uff1f</p> <p>redo log \u662f\u7269\u7406\u65e5\u5fd7\uff0c\u8bb0\u5f55\u4e86\u67d0\u4e2a\u6570\u636e\u9875\u505a\u4e86\u4ec0\u4e48\u4fee\u6539\uff0c\u6bd4\u5982\u5bf9 XXX \u8868\u7a7a\u95f4\u4e2d\u7684 YYY \u6570\u636e\u9875 ZZZ \u504f\u79fb\u91cf\u7684\u5730\u65b9\u505a\u4e86 AAA \u66f4\u65b0\uff0c\u6bcf\u5f53\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u5c31\u4f1a\u4ea7\u751f\u8fd9\u6837\u7684\u4e00\u6761\u6216\u8005\u591a\u6761\u7269\u7406\u65e5\u5fd7\u3002</p> <p>\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u53ea\u8981\u5148\u5c06 redo log \u6301\u4e45\u5316\u5230\u78c1\u76d8\u5373\u53ef\uff0c\u53ef\u4ee5\u4e0d\u9700\u8981\u7b49\u5230\u5c06\u7f13\u5b58\u5728  Buffer Pool  \u91cc\u7684\u810f\u9875\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002</p> <p>\u5f53\u7cfb\u7edf\u5d29\u6e83\u65f6\uff0c\u867d\u7136\u810f\u9875\u6570\u636e\u6ca1\u6709\u6301\u4e45\u5316\uff0c\u4f46\u662f redo log \u5df2\u7ecf\u6301\u4e45\u5316\uff0c\u63a5\u7740 MySQL \u91cd\u542f\u540e\uff0c\u53ef\u4ee5\u6839\u636e redo log \u7684\u5185\u5bb9\uff0c\u5c06\u6240\u6709\u6570\u636e\u6062\u590d\u5230\u6700\u65b0\u7684\u72b6\u6001\u3002</p> <p>\u88ab\u4fee\u6539 Undo \u9875\u9762\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94 redo log \u5417\uff1f</p> <p>\u9700\u8981\u7684\u3002</p> <p>\u5f00\u542f\u4e8b\u52a1\u540e\uff0cInnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u5982\u679c\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5728\u5185\u5b58\u4fee\u6539\u8be5 Undo \u9875\u9762\u540e\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94\u7684 redo log\u3002</p> <p>redo log \u548c undo log \u533a\u522b\u5728\u54ea\uff1f</p> <p>\u8fd9\u4e24\u79cd\u65e5\u5fd7\u662f\u5c5e\u4e8e InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u65e5\u5fd7\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\uff1a</p> <ul> <li>redo log \u8bb0\u5f55\u4e86\u6b64\u6b21\u4e8b\u52a1\u300c\u5b8c\u6210\u540e\u300d\u7684\u6570\u636e\u72b6\u6001\uff0c\u8bb0\u5f55\u7684\u662f\u66f4\u65b0\u4e4b\u540e\u7684\u503c\uff1b</li> <li>undo log \u8bb0\u5f55\u4e86\u6b64\u6b21\u4e8b\u52a1\u300c\u5f00\u59cb\u524d\u300d\u7684\u6570\u636e\u72b6\u6001\uff0c\u8bb0\u5f55\u7684\u662f\u66f4\u65b0\u4e4b\u524d\u7684\u503c\uff1b</li> </ul> <p>\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u524d\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u91cd\u542f\u540e\u4f1a\u901a\u8fc7 undo log \u56de\u6eda\u4e8b\u52a1\uff0c\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u91cd\u542f\u540e\u4f1a\u901a\u8fc7 redo log \u6062\u590d\u4e8b\u52a1\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6240\u4ee5\u6709\u4e86 redo log\uff0c\u518d\u901a\u8fc7 WAL \u6280\u672f\uff0cInnoDB \u5c31\u53ef\u4ee5\u4fdd\u8bc1\u5373\u4f7f\u6570\u636e\u5e93\u53d1\u751f\u5f02\u5e38\u91cd\u542f\uff0c\u4e4b\u524d\u5df2\u63d0\u4ea4\u7684\u8bb0\u5f55\u90fd\u4e0d\u4f1a\u4e22\u5931\uff0c\u8fd9\u4e2a\u80fd\u529b\u79f0\u4e3a crash-safe\uff08\u5d29\u6e83\u6062\u590d\uff09\u3002\u53ef\u4ee5\u770b\u51fa\u6765\uff0c redo log \u4fdd\u8bc1\u4e86\u4e8b\u52a1\u56db\u5927\u7279\u6027\u4e2d\u7684\u6301\u4e45\u6027\u3002</p> <p>redo log \u8981\u5199\u5230\u78c1\u76d8\uff0c\u6570\u636e\u4e5f\u8981\u5199\u78c1\u76d8\uff0c\u4e3a\u4ec0\u4e48\u8981\u591a\u6b64\u4e00\u4e3e\uff1f</p> <p>\u5199\u5165 redo log  \u7684\u65b9\u5f0f\u4f7f\u7528\u4e86\u8ffd\u52a0\u64cd\u4f5c\uff0c\u6240\u4ee5\u78c1\u76d8\u64cd\u4f5c\u662f\u987a\u5e8f\u5199\uff0c\u800c\u5199\u5165\u6570\u636e\u9700\u8981\u5148\u627e\u5230\u5199\u5165\u4f4d\u7f6e\uff0c\u7136\u540e\u624d\u5199\u5230\u78c1\u76d8\uff0c\u6240\u4ee5\u78c1\u76d8\u64cd\u4f5c\u662f\u968f\u673a\u5199\u3002</p> <p>\u78c1\u76d8\u7684\u300c\u987a\u5e8f\u5199\u300d\u6bd4\u300c\u968f\u673a\u5199\u300d\u9ad8\u6548\u7684\u591a\uff0c\u56e0\u6b64  redo log \u5199\u5165\u78c1\u76d8\u7684\u5f00\u9500\u66f4\u5c0f\u3002</p> <p>\u9488\u5bf9\u300c\u987a\u5e8f\u5199\u300d\u4e3a\u4ec0\u4e48\u6bd4\u300c\u968f\u673a\u5199\u300d\u66f4\u5feb\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u6bd4\u55bb\u4e3a\u4f60\u6709\u4e00\u4e2a\u672c\u5b50\uff0c\u6309\u7167\u987a\u5e8f\u4e00\u9875\u4e00\u9875\u5199\u80af\u5b9a\u6bd4\u5199\u4e00\u4e2a\u5b57\u90fd\u8981\u627e\u5230\u5bf9\u5e94\u9875\u5199\u5feb\u5f97\u591a\u3002</p> <p>\u53ef\u4ee5\u8bf4\u8fd9\u662f WAL \u6280\u672f\u7684\u53e6\u5916\u4e00\u4e2a\u4f18\u70b9\uff1aMySQL \u7684\u5199\u64cd\u4f5c\u4ece\u78c1\u76d8\u7684\u300c\u968f\u673a\u5199\u300d\u53d8\u6210\u4e86\u300c\u987a\u5e8f\u5199\u300d\uff0c\u63d0\u5347\u8bed\u53e5\u7684\u6267\u884c\u6027\u80fd\u3002\u8fd9\u662f\u56e0\u4e3a MySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u66f4\u65b0\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u8bb0\u5f55\u5728\u65e5\u5fd7\u4e0a\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u66f4\u65b0\u5230\u78c1\u76d8\u4e0a\u3002</p> <p>\u81f3\u6b64\uff0c\u9488\u5bf9\u4e3a\u4ec0\u4e48\u9700\u8981 redo log \u8fd9\u4e2a\u95ee\u9898\u6211\u4eec\u6709\u4e24\u4e2a\u7b54\u6848\uff1a</p> <ul> <li>\u5b9e\u73b0\u4e8b\u52a1\u7684\u6301\u4e45\u6027\uff0c\u8ba9 MySQL \u6709 crash-safe \u7684\u80fd\u529b\uff0c\u80fd\u591f\u4fdd\u8bc1 MySQL \u5728\u4efb\u4f55\u65f6\u95f4\u6bb5\u7a81\u7136\u5d29\u6e83\uff0c\u91cd\u542f\u540e\u4e4b\u524d\u5df2\u63d0\u4ea4\u7684\u8bb0\u5f55\u90fd\u4e0d\u4f1a\u4e22\u5931\uff1b</li> <li>\u5c06\u5199\u64cd\u4f5c\u4ece\u300c\u968f\u673a\u5199\u300d\u53d8\u6210\u4e86\u300c\u987a\u5e8f\u5199\u300d\uff0c\u63d0\u5347 MySQL \u5199\u5165\u78c1\u76d8\u7684\u6027\u80fd\u3002</li> </ul> <p>\u4ea7\u751f\u7684 redo log \u662f\u76f4\u63a5\u5199\u5165\u78c1\u76d8\u7684\u5417\uff1f</p> <p>\u4e0d\u662f\u7684\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6267\u884c\u4e00\u4e2a\u4e8b\u52a1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4ea7\u751f\u7684 redo log \u4e5f\u4e0d\u662f\u76f4\u63a5\u5199\u5165\u78c1\u76d8\u7684\uff0c\u56e0\u4e3a\u8fd9\u6837\u4f1a\u4ea7\u751f\u5927\u91cf\u7684 I/O \u64cd\u4f5c\uff0c\u800c\u4e14\u78c1\u76d8\u7684\u8fd0\u884c\u901f\u5ea6\u8fdc\u6162\u4e8e\u5185\u5b58\u3002</p> <p>\u6240\u4ee5\uff0credo log \u4e5f\u6709\u81ea\u5df1\u7684\u7f13\u5b58\u2014\u2014 redo log buffer\uff0c\u6bcf\u5f53\u4ea7\u751f\u4e00\u6761 redo log \u65f6\uff0c\u4f1a\u5148\u5199\u5165\u5230 redo log buffer\uff0c\u540e\u7eed\u5728\u6301\u4e45\u5316\u5230\u78c1\u76d8\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>redo log buffer \u9ed8\u8ba4\u5927\u5c0f 16 MB\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>innodb_log_Buffer_size</code> \u53c2\u6570\u52a8\u6001\u7684\u8c03\u6574\u5927\u5c0f\uff0c\u589e\u5927\u5b83\u7684\u5927\u5c0f\u53ef\u4ee5\u8ba9 MySQL \u5904\u7406\u300c\u5927\u4e8b\u52a1\u300d\u662f\u4e0d\u5fc5\u5199\u5165\u78c1\u76d8\uff0c\u8fdb\u800c\u63d0\u5347\u5199 IO \u6027\u80fd\u3002</p>"},{"location":"mysql/log/how_update/#redo-log_1","title":"redo log \u4ec0\u4e48\u65f6\u5019\u5237\u76d8\uff1f","text":"<p>\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u8fd8\u662f\u5728\u5185\u5b58\u4e2d\uff0c\u5b83\u4ec0\u4e48\u65f6\u5019\u5237\u65b0\u5230\u78c1\u76d8\uff1f</p> <p>\u4e3b\u8981\u6709\u4e0b\u9762\u51e0\u4e2a\u65f6\u673a\uff1a</p> <ul> <li>MySQL \u6b63\u5e38\u5173\u95ed\u65f6\uff1b</li> <li>\u5f53 redo log buffer \u4e2d\u8bb0\u5f55\u7684\u5199\u5165\u91cf\u5927\u4e8e redo log buffer \u5185\u5b58\u7a7a\u95f4\u7684\u4e00\u534a\u65f6\uff0c\u4f1a\u89e6\u53d1\u843d\u76d8\uff1b</li> <li>InnoDB \u7684\u540e\u53f0\u7ebf\u7a0b\u6bcf\u9694 1 \u79d2\uff0c\u5c06 redo log buffer \u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002</li> <li>\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\u90fd\u5c06\u7f13\u5b58\u5728 redo log buffer \u91cc\u7684 redo log \u76f4\u63a5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff08\u8fd9\u4e2a\u7b56\u7565\u53ef\u7531 innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236\uff0c\u4e0b\u9762\u4f1a\u8bf4\uff09\u3002</li> </ul> <p>innodb_flush_log_at_trx_commit \u53c2\u6570\u63a7\u5236\u7684\u662f\u4ec0\u4e48\uff1f</p> <p>\u5355\u72ec\u6267\u884c\u4e00\u4e2a\u66f4\u65b0\u8bed\u53e5\u7684\u65f6\u5019\uff0cInnoDB \u5f15\u64ce\u4f1a\u81ea\u5df1\u542f\u52a8\u4e00\u4e2a\u4e8b\u52a1\uff0c\u5728\u6267\u884c\u66f4\u65b0\u8bed\u53e5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u751f\u6210\u7684 redo log \u5148\u5199\u5165\u5230  redo log buffer \u4e2d\uff0c\u7136\u540e\u7b49\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u518d\u5c06\u7f13\u5b58\u5728 redo log buffer \u4e2d\u7684 redo log \u6309\u7ec4\u7684\u65b9\u5f0f\u300c\u987a\u5e8f\u5199\u300d\u5230\u78c1\u76d8\u3002</p> <p>\u4e0a\u9762\u8fd9\u79cd redo log \u5237\u76d8\u65f6\u673a\u662f\u5728\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a\u9ed8\u8ba4\u7684\u884c\u4e3a\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0cInnoDB \u8fd8\u63d0\u4f9b\u4e86\u53e6\u5916\u4e24\u79cd\u7b56\u7565\uff0c\u7531\u53c2\u6570 <code>innodb_flush_log_at_trx_commit</code> \u53c2\u6570\u63a7\u5236\uff0c\u53ef\u53d6\u7684\u503c\u6709\uff1a0\u30011\u30012\uff0c\u9ed8\u8ba4\u503c\u4e3a 1\uff0c\u8fd9\u4e09\u4e2a\u503c\u5206\u522b\u4ee3\u8868\u7684\u7b56\u7565\u5982\u4e0b\uff1a</p> <ul> <li>\u5f53\u8bbe\u7f6e\u8be5\u53c2\u6570\u4e3a 0 \u65f6\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u8fd8\u662f\u5c06 redo log \u7559\u5728  redo log buffer \u4e2d \uff0c\u8be5\u6a21\u5f0f\u4e0b\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\u4e0d\u4f1a\u4e3b\u52a8\u89e6\u53d1\u5199\u5165\u78c1\u76d8\u7684\u64cd\u4f5c\u3002</li> <li>\u5f53\u8bbe\u7f6e\u8be5\u53c2\u6570\u4e3a 1 \u65f6\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u5c06\u7f13\u5b58\u5728  redo log buffer \u91cc\u7684  redo log \u76f4\u63a5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1 MySQL \u5f02\u5e38\u91cd\u542f\u4e4b\u540e\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\u3002</li> <li>\u5f53\u8bbe\u7f6e\u8be5\u53c2\u6570\u4e3a 2 \u65f6\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u53ea\u662f\u7f13\u5b58\u5728  redo log buffer \u91cc\u7684  redo log \u5199\u5230 redo log \u6587\u4ef6\uff0c\u6ce8\u610f\u5199\u5165\u5230\u300credo log \u6587\u4ef6\u300d\u5e76\u4e0d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u78c1\u76d8\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u4e2a Page Cache\uff08\u5982\u679c\u4f60\u60f3\u4e86\u89e3  Page Cache\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7 \uff09\uff0cPage Cache \u662f\u4e13\u95e8\u7528\u6765\u7f13\u5b58\u6587\u4ef6\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5199\u5165\u300credo log \u6587\u4ef6\u300d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7f13\u5b58\u3002</li> </ul> <p>\u6211\u753b\u4e86\u4e00\u4e2a\u56fe\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff1a</p> <p></p> <p>innodb_flush_log_at_trx_commit \u4e3a 0 \u548c 2 \u7684\u65f6\u5019\uff0c\u4ec0\u4e48\u65f6\u5019\u624d\u5c06 redo log \u5199\u5165\u78c1\u76d8\uff1f</p> <p>InnoDB \u7684\u540e\u53f0\u7ebf\u7a0b\u6bcf\u9694 1 \u79d2\uff1a</p> <ul> <li>\u9488\u5bf9\u53c2\u6570 0\uff1a\u4f1a\u628a\u7f13\u5b58\u5728 redo log buffer \u4e2d\u7684 redo log\uff0c\u901a\u8fc7\u8c03\u7528 <code>write()</code> \u5199\u5230\u64cd\u4f5c\u7cfb\u7edf\u7684 Page Cache\uff0c\u7136\u540e\u8c03\u7528 <code>fsync()</code> \u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002\u6240\u4ee5\u53c2\u6570\u4e3a 0 \u7684\u7b56\u7565\uff0cMySQL \u8fdb\u7a0b\u7684\u5d29\u6e83\u4f1a\u5bfc\u81f4\u4e0a\u4e00\u79d2\u949f\u6240\u6709\u4e8b\u52a1\u6570\u636e\u7684\u4e22\u5931;</li> <li>\u9488\u5bf9\u53c2\u6570 2\uff1a\u8c03\u7528 fsync\uff0c\u5c06\u7f13\u5b58\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d Page Cache \u91cc\u7684 redo log \u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002\u6240\u4ee5\u53c2\u6570\u4e3a 2 \u7684\u7b56\u7565\uff0c\u8f83\u53d6\u503c\u4e3a 0 \u60c5\u51b5\u4e0b\u66f4\u5b89\u5168\uff0c\u56e0\u4e3a MySQL \u8fdb\u7a0b\u7684\u5d29\u6e83\u5e76\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u53ea\u6709\u5728\u64cd\u4f5c\u7cfb\u7edf\u5d29\u6e83\u6216\u8005\u7cfb\u7edf\u65ad\u7535\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0a\u4e00\u79d2\u949f\u6240\u6709\u4e8b\u52a1\u6570\u636e\u624d\u53ef\u80fd\u4e22\u5931\u3002</li> </ul> <p>\u52a0\u5165\u4e86\u540e\u53f0\u73b0\u7ebf\u7a0b\u540e\uff0cinnodb_flush_log_at_trx_commit \u7684\u5237\u76d8\u65f6\u673a\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u4e09\u4e2a\u53c2\u6570\u7684\u5e94\u7528\u573a\u666f\u662f\u4ec0\u4e48\uff1f</p> <p>\u8fd9\u4e09\u4e2a\u53c2\u6570\u7684\u6570\u636e\u5b89\u5168\u6027\u548c\u5199\u5165\u6027\u80fd\u7684\u6bd4\u8f83\u5982\u4e0b\uff1a</p> <ul> <li>\u6570\u636e\u5b89\u5168\u6027\uff1a\u53c2\u6570 1 &gt; \u53c2\u6570 2 &gt; \u53c2\u6570 0</li> <li>\u5199\u5165\u6027\u80fd\uff1a\u53c2\u6570 0 &gt; \u53c2\u6570 2&gt; \u53c2\u6570 1</li> </ul> <p>\u6240\u4ee5\uff0c\u6570\u636e\u5b89\u5168\u6027\u548c\u5199\u5165\u6027\u80fd\u662f\u718a\u638c\u4e0d\u53ef\u5f97\u517c\u7684\uff0c\u8981\u4e0d\u8ffd\u6c42\u6570\u636e\u5b89\u5168\u6027\uff0c\u727a\u7272\u6027\u80fd\uff1b\u8981\u4e0d\u8ffd\u6c42\u6027\u80fd\uff0c\u727a\u7272\u6570\u636e\u5b89\u5168\u6027\u3002</p> <ul> <li>\u5728\u4e00\u4e9b\u5bf9\u6570\u636e\u5b89\u5168\u6027\u8981\u6c42\u6bd4\u8f83\u9ad8\u7684\u573a\u666f\u4e2d\uff0c\u663e\u7136 <code>innodb_flush_log_at_trx_commit</code>  \u53c2\u6570\u9700\u8981\u8bbe\u7f6e\u4e3a 1\u3002</li> <li>\u5728\u4e00\u4e9b\u53ef\u4ee5\u5bb9\u5fcd\u6570\u636e\u5e93\u5d29\u6e83\u65f6\u4e22\u5931 1s \u6570\u636e\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8be5\u503c\u8bbe\u7f6e\u4e3a 0\uff0c\u8fd9\u6837\u53ef\u4ee5\u660e\u663e\u5730\u51cf\u5c11\u65e5\u5fd7\u540c\u6b65\u5230\u78c1\u76d8\u7684 I/O \u64cd\u4f5c\u3002</li> <li>\u5b89\u5168\u6027\u548c\u6027\u80fd\u6298\u4e2d\u7684\u65b9\u6848\u5c31\u662f\u53c2\u6570 2\uff0c\u867d\u7136\u53c2\u6570 2 \u6ca1\u6709\u53c2\u6570 0 \u7684\u6027\u80fd\u9ad8\uff0c\u4f46\u662f\u6570\u636e\u5b89\u5168\u6027\u65b9\u9762\u6bd4\u53c2\u6570 0 \u5f3a\uff0c\u56e0\u4e3a\u53c2\u6570 2 \u53ea\u8981\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u5b95\u673a\uff0c\u5373\u4f7f\u6570\u636e\u5e93\u5d29\u6e83\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff0c\u540c\u65f6\u6027\u80fd\u65b9\u9762\u6bd4\u53c2\u6570 1 \u9ad8\u3002</li> </ul>"},{"location":"mysql/log/how_update/#redo-log_2","title":"redo log \u6587\u4ef6\u5199\u6ee1\u4e86\u600e\u4e48\u529e\uff1f","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0cInnoDB \u5b58\u50a8\u5f15\u64ce\u6709 1 \u4e2a\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7ec4 ( redo log Group\uff09\uff0c\u300c\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7ec4\u300d\u7531\u6709 2 \u4e2a redo log \u6587\u4ef6\u7ec4\u6210\uff0c\u8fd9\u4e24\u4e2a  redo  \u65e5\u5fd7\u7684\u6587\u4ef6\u540d\u53eb\uff1a<code>ib_logfile0</code> \u548c <code>ib_logfile1</code> \u3002</p> <p></p> <p>\u5728\u91cd\u505a\u65e5\u5fd7\u7ec4\u4e2d\uff0c\u6bcf\u4e2a redo log File \u7684\u5927\u5c0f\u662f\u56fa\u5b9a\u4e14\u4e00\u81f4\u7684\uff0c\u5047\u8bbe\u6bcf\u4e2a redo log File \u8bbe\u7f6e\u7684\u4e0a\u9650\u662f 1 GB\uff0c\u90a3\u4e48\u603b\u5171\u5c31\u53ef\u4ee5\u8bb0\u5f55 2GB \u7684\u64cd\u4f5c\u3002</p> <p>\u91cd\u505a\u65e5\u5fd7\u6587\u4ef6\u7ec4\u662f\u4ee5\u5faa\u73af\u5199\u7684\u65b9\u5f0f\u5de5\u4f5c\u7684\uff0c\u4ece\u5934\u5f00\u59cb\u5199\uff0c\u5199\u5230\u672b\u5c3e\u5c31\u53c8\u56de\u5230\u5f00\u5934\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u73af\u5f62\u3002</p> <p>\u6240\u4ee5 InnoDB \u5b58\u50a8\u5f15\u64ce\u4f1a\u5148\u5199 ib_logfile0 \u6587\u4ef6\uff0c\u5f53 ib_logfile0 \u6587\u4ef6\u88ab\u5199\u6ee1\u7684\u65f6\u5019\uff0c\u4f1a\u5207\u6362\u81f3  ib_logfile1 \u6587\u4ef6\uff0c\u5f53 ib_logfile1 \u6587\u4ef6\u4e5f\u88ab\u5199\u6ee1\u65f6\uff0c\u4f1a\u5207\u6362\u56de ib_logfile0 \u6587\u4ef6\u3002</p> <p></p> <p>\u6211\u4eec\u77e5\u9053 redo log \u662f\u4e3a\u4e86\u9632\u6b62 Buffer Pool \u4e2d\u7684\u810f\u9875\u4e22\u5931\u800c\u8bbe\u8ba1\u7684\uff0c\u90a3\u4e48\u5982\u679c\u968f\u7740\u7cfb\u7edf\u8fd0\u884c\uff0cBuffer Pool \u7684\u810f\u9875\u5237\u65b0\u5230\u4e86\u78c1\u76d8\u4e2d\uff0c\u90a3\u4e48 redo log \u5bf9\u5e94\u7684\u8bb0\u5f55\u4e5f\u5c31\u6ca1\u7528\u4e86\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u64e6\u9664\u8fd9\u4e9b\u65e7\u8bb0\u5f55\uff0c\u4ee5\u817e\u51fa\u7a7a\u95f4\u8bb0\u5f55\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\u3002</p> <p>redo log \u662f\u5faa\u73af\u5199\u7684\u65b9\u5f0f\uff0c\u76f8\u5f53\u4e8e\u4e00\u4e2a\u73af\u5f62\uff0cInnoDB \u7528 write pos \u8868\u793a redo log \u5f53\u524d\u8bb0\u5f55\u5199\u5230\u7684\u4f4d\u7f6e\uff0c\u7528 check point \u8868\u793a\u5f53\u524d\u8981\u64e6\u9664\u7684\u4f4d\u7f6e\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u56fe\u4e2d\u7684\uff1a</p> <ul> <li>write pos \u548c check point \u7684\u79fb\u52a8\u90fd\u662f\u987a\u65f6\u9488\u65b9\u5411\uff1b</li> <li>write pos \uff5e check point \u4e4b\u95f4\u7684\u90e8\u5206\uff08\u56fe\u4e2d\u7684\u7ea2\u8272\u90e8\u5206\uff09\uff0c\u7528\u6765\u8bb0\u5f55\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\uff1b</li> <li>check point \uff5e write pos \u4e4b\u95f4\u7684\u90e8\u5206\uff08\u56fe\u4e2d\u84dd\u8272\u90e8\u5206\uff09\uff1a\u5f85\u843d\u76d8\u7684\u810f\u6570\u636e\u9875\u8bb0\u5f55\uff1b</li> </ul> <p>\u5982\u679c write pos  \u8ffd\u4e0a\u4e86  check point\uff0c\u5c31\u610f\u5473\u7740 redo log \u6587\u4ef6\u6ee1\u4e86\uff0c\u8fd9\u65f6 MySQL \u4e0d\u80fd\u518d\u6267\u884c\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u8bf4 MySQL \u4f1a\u88ab\u963b\u585e\uff08\u56e0\u6b64\u6240\u4ee5\u9488\u5bf9\u5e76\u53d1\u91cf\u5927\u7684\u7cfb\u7edf\uff0c\u9002\u5f53\u8bbe\u7f6e  redo log \u7684\u6587\u4ef6\u5927\u5c0f\u975e\u5e38\u91cd\u8981\uff09\uff0c\u6b64\u65f6\u4f1a\u505c\u4e0b\u6765\u5c06 Buffer Pool \u4e2d\u7684\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\uff0c\u7136\u540e\u6807\u8bb0 redo log \u54ea\u4e9b\u8bb0\u5f55\u53ef\u4ee5\u88ab\u64e6\u9664\uff0c\u63a5\u7740\u5bf9\u65e7\u7684 redo log \u8bb0\u5f55\u8fdb\u884c\u64e6\u9664\uff0c\u7b49\u64e6\u9664\u5b8c\u65e7\u8bb0\u5f55\u817e\u51fa\u4e86\u7a7a\u95f4\uff0ccheck point \u5c31\u4f1a\u5f80\u540e\u79fb\u52a8\uff08\u56fe\u4e2d\u987a\u65f6\u9488\uff09\uff0c\u7136\u540e MySQL \u6062\u590d\u6b63\u5e38\u8fd0\u884c\uff0c\u7ee7\u7eed\u6267\u884c\u65b0\u7684\u66f4\u65b0\u64cd\u4f5c\u3002</p> <p>\u6240\u4ee5\uff0c\u4e00\u6b21 check point \u7684\u8fc7\u7a0b\u5c31\u662f\u810f\u9875\u5237\u65b0\u5230\u78c1\u76d8\u4e2d\u53d8\u6210\u5e72\u51c0\u9875\uff0c\u7136\u540e\u6807\u8bb0 redo log  \u54ea\u4e9b\u8bb0\u5f55\u53ef\u4ee5\u88ab\u8986\u76d6\u7684\u8fc7\u7a0b\u3002</p>"},{"location":"mysql/log/how_update/#binlog","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 binlog\uff1f","text":"<p>\u524d\u9762\u4ecb\u7ecd\u7684 undo log \u548c redo log \u8fd9\u4e24\u4e2a\u65e5\u5fd7\u90fd\u662f Innodb \u5b58\u50a8\u5f15\u64ce\u751f\u6210\u7684\u3002</p> <p>MySQL \u5728\u5b8c\u6210\u4e00\u6761\u66f4\u65b0\u64cd\u4f5c\u540e\uff0cServer \u5c42\u8fd8\u4f1a\u751f\u6210\u4e00\u6761 binlog\uff0c\u7b49\u4e4b\u540e\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u8be5\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u6240\u6709 binlog \u7edf\u4e00\u5199 \u5165 binlog \u6587\u4ef6\u3002</p> <p>binlog \u6587\u4ef6\u662f\u8bb0\u5f55\u4e86\u6240\u6709\u6570\u636e\u5e93\u8868\u7ed3\u6784\u53d8\u66f4\u548c\u8868\u6570\u636e\u4fee\u6539\u7684\u65e5\u5fd7\uff0c\u4e0d\u4f1a\u8bb0\u5f55\u67e5\u8be2\u7c7b\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982 SELECT \u548c SHOW \u64cd\u4f5c\u3002</p> <p>\u4e3a\u4ec0\u4e48\u6709\u4e86 binlog\uff0c\u8fd8\u8981\u6709 redo log\uff1f</p> <p>\u8fd9\u4e2a\u95ee\u9898\u8ddf MySQL \u7684\u65f6\u95f4\u7ebf\u6709\u5173\u7cfb\u3002</p> <p>\u6700\u5f00\u59cb MySQL \u91cc\u5e76\u6ca1\u6709 InnoDB \u5f15\u64ce\uff0cMySQL \u81ea\u5e26\u7684\u5f15\u64ce\u662f MyISAM\uff0c\u4f46\u662f MyISAM \u6ca1\u6709 crash-safe \u7684\u80fd\u529b\uff0cbinlog \u65e5\u5fd7\u53ea\u80fd\u7528\u4e8e\u5f52\u6863\u3002</p> <p>\u800c InnoDB \u662f\u53e6\u4e00\u4e2a\u516c\u53f8\u4ee5\u63d2\u4ef6\u5f62\u5f0f\u5f15\u5165 MySQL \u7684\uff0c\u65e2\u7136\u53ea\u4f9d\u9760 binlog \u662f\u6ca1\u6709 crash-safe \u80fd\u529b\u7684\uff0c\u6240\u4ee5 InnoDB \u4f7f\u7528  redo log \u6765\u5b9e\u73b0 crash-safe \u80fd\u529b\u3002</p>"},{"location":"mysql/log/how_update/#redo-log-binlog","title":"redo log \u548c binlog \u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u8fd9\u4e24\u4e2a\u65e5\u5fd7\u6709\u56db\u4e2a\u533a\u522b\u3002</p> <p>1\u3001\u9002\u7528\u5bf9\u8c61\u4e0d\u540c\uff1a</p> <ul> <li>binlog \u662f MySQL \u7684 Server \u5c42\u5b9e\u73b0\u7684\u65e5\u5fd7\uff0c\u6240\u6709\u5b58\u50a8\u5f15\u64ce\u90fd\u53ef\u4ee5\u4f7f\u7528\uff1b</li> <li>redo log \u662f Innodb \u5b58\u50a8\u5f15\u64ce\u5b9e\u73b0\u7684\u65e5\u5fd7\uff1b</li> </ul> <p>2\u3001\u6587\u4ef6\u683c\u5f0f\u4e0d\u540c\uff1a</p> <ul> <li>binlog \u6709 3 \u79cd\u683c\u5f0f\u7c7b\u578b\uff0c\u5206\u522b\u662f STATEMENT\u3001ROW\u3001MIXED\uff0c\u533a\u522b\u5982\u4e0b\uff1a</li> </ul> <p>\u5728 MySQL 5.7.7 \u4e4b\u524d\uff0c<code>binlog_format</code>\u7684\u9ed8\u8ba4\u503c\u662f<code>STATEMENT</code>\uff0c\u800c\u5728 5.7.7 \u53ca\u4e4b\u540e\u7684\u7248\u672c\uff0c\u9ed8\u8ba4\u503c\u4e3a<code>ROW</code>\u3002</p> <ul> <li>STATEMENT\uff1a\u6bcf\u4e00\u6761\u4fee\u6539\u6570\u636e\u7684 SQL \u90fd\u4f1a\u88ab\u8bb0\u5f55\u5230 binlog \u4e2d\uff08\u76f8\u5f53\u4e8e\u8bb0\u5f55\u4e86\u903b\u8f91\u64cd\u4f5c\uff0c\u6240\u4ee5\u9488\u5bf9\u8fd9\u79cd\u683c\u5f0f\uff0cbinlog \u53ef\u4ee5\u79f0\u4e3a\u903b\u8f91\u65e5\u5fd7\uff09\uff0c\u4e3b\u4ece\u590d\u5236\u4e2d slave \u7aef\u518d\u6839\u636e SQL \u8bed\u53e5\u91cd\u73b0\u3002\u4f46 STATEMENT \u6709\u52a8\u6001\u51fd\u6570\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u4f60\u7528\u4e86 uuid \u6216\u8005 now \u8fd9\u4e9b\u51fd\u6570\uff0c\u4f60\u5728\u4e3b\u5e93\u4e0a\u6267\u884c\u7684\u7ed3\u679c\u5e76\u4e0d\u662f\u4f60\u5728\u4ece\u5e93\u6267\u884c\u7684\u7ed3\u679c\uff0c\u8fd9\u79cd\u968f\u65f6\u5728\u53d8\u7684\u51fd\u6570\u4f1a\u5bfc\u81f4\u590d\u5236\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff1b</li> <li>ROW\uff1a\u8bb0\u5f55\u884c\u6570\u636e\u6700\u7ec8\u88ab\u4fee\u6539\u6210\u4ec0\u4e48\u6837\u4e86\uff08\u8fd9\u79cd\u683c\u5f0f\u7684\u65e5\u5fd7\uff0c\u5c31\u4e0d\u80fd\u79f0\u4e3a\u903b\u8f91\u65e5\u5fd7\u4e86\uff09\uff0c\u4e0d\u4f1a\u51fa\u73b0 STATEMENT \u4e0b\u52a8\u6001\u51fd\u6570\u7684\u95ee\u9898\u3002\u4f46 ROW \u7684\u7f3a\u70b9\u662f\u6bcf\u884c\u6570\u636e\u7684\u53d8\u5316\u7ed3\u679c\u90fd\u4f1a\u88ab\u8bb0\u5f55\uff0c\u6bd4\u5982\u6267\u884c\u6279\u91cf update \u8bed\u53e5\uff0c\u66f4\u65b0\u591a\u5c11\u884c\u6570\u636e\u5c31\u4f1a\u4ea7\u751f\u591a\u5c11\u6761\u8bb0\u5f55\uff0c\u4f7f binlog \u6587\u4ef6\u8fc7\u5927\uff0c\u800c\u5728 STATEMENT \u683c\u5f0f\u4e0b\u53ea\u4f1a\u8bb0\u5f55\u4e00\u4e2a update \u8bed\u53e5\u800c\u5df2\uff1b</li> <li>MIXED\uff1a\u5305\u542b\u4e86 STATEMENT \u548c ROW \u6a21\u5f0f\uff0c\u5b83\u4f1a\u6839\u636e\u4e0d\u540c\u7684\u60c5\u51b5\u81ea\u52a8\u4f7f\u7528 ROW \u6a21\u5f0f\u548c STATEMENT \u6a21\u5f0f\uff1b</li> <li>redo log \u662f\u7269\u7406\u65e5\u5fd7\uff0c\u8bb0\u5f55\u7684\u662f\u5728\u67d0\u4e2a\u6570\u636e\u9875\u505a\u4e86\u4ec0\u4e48\u4fee\u6539\uff0c\u6bd4\u5982\u5bf9 XXX \u8868\u7a7a\u95f4\u4e2d\u7684 YYY \u6570\u636e\u9875 ZZZ \u504f\u79fb\u91cf\u7684\u5730\u65b9\u505a\u4e86 AAA \u66f4\u65b0\uff1b</li> </ul> <p>3\u3001\u5199\u5165\u65b9\u5f0f\u4e0d\u540c\uff1a</p> <ul> <li>binlog \u662f\u8ffd\u52a0\u5199\uff0c\u5199\u6ee1\u4e00\u4e2a\u6587\u4ef6\uff0c\u5c31\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u6587\u4ef6\u7ee7\u7eed\u5199\uff0c\u4e0d\u4f1a\u8986\u76d6\u4ee5\u524d\u7684\u65e5\u5fd7\uff0c\u4fdd\u5b58\u7684\u662f\u5168\u91cf\u7684\u65e5\u5fd7\u3002</li> <li>redo log \u662f\u5faa\u73af\u5199\uff0c\u65e5\u5fd7\u7a7a\u95f4\u5927\u5c0f\u662f\u56fa\u5b9a\uff0c\u5168\u90e8\u5199\u6ee1\u5c31\u4ece\u5934\u5f00\u59cb\uff0c\u4fdd\u5b58\u672a\u88ab\u5237\u5165\u78c1\u76d8\u7684\u810f\u9875\u65e5\u5fd7\u3002</li> </ul> <p>4\u3001\u7528\u9014\u4e0d\u540c\uff1a</p> <ul> <li>binlog \u7528\u4e8e\u5907\u4efd\u6062\u590d\u3001\u4e3b\u4ece\u590d\u5236\uff1b</li> <li>redo log \u7528\u4e8e\u6389\u7535\u7b49\u6545\u969c\u6062\u590d\u3002</li> </ul> <p>\u5982\u679c\u4e0d\u5c0f\u5fc3\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6570\u636e\u88ab\u5220\u9664\u4e86\uff0c\u80fd\u4f7f\u7528 redo log \u6587\u4ef6\u6062\u590d\u6570\u636e\u5417\uff1f</p> <p>\u4e0d\u53ef\u4ee5\u4f7f\u7528 redo log \u6587\u4ef6\u6062\u590d\uff0c\u53ea\u80fd\u4f7f\u7528 binlog \u6587\u4ef6\u6062\u590d\u3002</p> <p>\u56e0\u4e3a redo log  \u6587\u4ef6\u662f\u5faa\u73af\u5199\uff0c\u662f\u4f1a\u8fb9\u5199\u8fb9\u64e6\u9664\u65e5\u5fd7\u7684\uff0c\u53ea\u8bb0\u5f55\u672a\u88ab\u5237\u5165\u78c1\u76d8\u7684\u6570\u636e\u7684\u7269\u7406\u65e5\u5fd7\uff0c\u5df2\u7ecf\u5237\u5165\u78c1\u76d8\u7684\u6570\u636e\u90fd\u4f1a\u4ece redo log \u6587\u4ef6\u91cc\u64e6\u9664\u3002</p> <p>binlog \u6587\u4ef6\u4fdd\u5b58\u7684\u662f\u5168\u91cf\u7684\u65e5\u5fd7\uff0c\u4e5f\u5c31\u662f\u4fdd\u5b58\u4e86\u6240\u6709\u6570\u636e\u53d8\u66f4\u7684\u60c5\u51b5\uff0c\u7406\u8bba\u4e0a\u53ea\u8981\u8bb0\u5f55\u5728 binlog \u4e0a\u7684\u6570\u636e\uff0c\u90fd\u53ef\u4ee5\u6062\u590d\uff0c\u6240\u4ee5\u5982\u679c\u4e0d\u5c0f\u5fc3\u6574\u4e2a\u6570\u636e\u5e93\u7684\u6570\u636e\u88ab\u5220\u9664\u4e86\uff0c\u5f97\u7528 binlog \u6587\u4ef6\u6062\u590d\u6570\u636e\u3002</p>"},{"location":"mysql/log/how_update/#_1","title":"\u4e3b\u4ece\u590d\u5236\u662f\u600e\u4e48\u5b9e\u73b0\uff1f","text":"<p>MySQL \u7684\u4e3b\u4ece\u590d\u5236\u4f9d\u8d56\u4e8e binlog\uff0c\u4e5f\u5c31\u662f\u8bb0\u5f55 MySQL \u4e0a\u7684\u6240\u6709\u53d8\u5316\u5e76\u4ee5\u4e8c\u8fdb\u5236\u5f62\u5f0f\u4fdd\u5b58\u5728\u78c1\u76d8\u4e0a\u3002\u590d\u5236\u7684\u8fc7\u7a0b\u5c31\u662f\u5c06 binlog \u4e2d\u7684\u6570\u636e\u4ece\u4e3b\u5e93\u4f20\u8f93\u5230\u4ece\u5e93\u4e0a\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u4e00\u822c\u662f\u5f02\u6b65\u7684\uff0c\u4e5f\u5c31\u662f\u4e3b\u5e93\u4e0a\u6267\u884c\u4e8b\u52a1\u64cd\u4f5c\u7684\u7ebf\u7a0b\u4e0d\u4f1a\u7b49\u5f85\u590d\u5236 binlog \u7684\u7ebf\u7a0b\u540c\u6b65\u5b8c\u6210\u3002</p> <p></p> <p>MySQL \u96c6\u7fa4\u7684\u4e3b\u4ece\u590d\u5236\u8fc7\u7a0b\u68b3\u7406\u6210 3 \u4e2a\u9636\u6bb5\uff1a</p> <ul> <li>\u5199\u5165 Binlog\uff1a\u4e3b\u5e93\u5199 binlog \u65e5\u5fd7\uff0c\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5e76\u66f4\u65b0\u672c\u5730\u5b58\u50a8\u6570\u636e\u3002</li> <li>\u540c\u6b65 Binlog\uff1a\u628a binlog \u590d\u5236\u5230\u6240\u6709\u4ece\u5e93\u4e0a\uff0c\u6bcf\u4e2a\u4ece\u5e93\u628a binlog \u5199\u5230\u6682\u5b58\u65e5\u5fd7\u4e2d\u3002</li> <li>\u56de\u653e Binlog\uff1a\u56de\u653e binlog\uff0c\u5e76\u66f4\u65b0\u5b58\u50a8\u5f15\u64ce\u4e2d\u7684\u6570\u636e\u3002</li> </ul> <p>\u5177\u4f53\u8be6\u7ec6\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>MySQL \u4e3b\u5e93\u5728\u6536\u5230\u5ba2\u6237\u7aef\u63d0\u4ea4\u4e8b\u52a1\u7684\u8bf7\u6c42\u4e4b\u540e\uff0c\u4f1a\u5148\u5199\u5165 binlog\uff0c\u518d\u63d0\u4ea4\u4e8b\u52a1\uff0c\u66f4\u65b0\u5b58\u50a8\u5f15\u64ce\u4e2d\u7684\u6570\u636e\uff0c\u4e8b\u52a1\u63d0\u4ea4\u5b8c\u6210\u540e\uff0c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u201c\u64cd\u4f5c\u6210\u529f\u201d\u7684\u54cd\u5e94\u3002</li> <li>\u4ece\u5e93\u4f1a\u521b\u5efa\u4e00\u4e2a\u4e13\u95e8\u7684 I/O \u7ebf\u7a0b\uff0c\u8fde\u63a5\u4e3b\u5e93\u7684 log dump \u7ebf\u7a0b\uff0c\u6765\u63a5\u6536\u4e3b\u5e93\u7684 binlog \u65e5\u5fd7\uff0c\u518d\u628a binlog \u4fe1\u606f\u5199\u5165 relay log \u7684\u4e2d\u7ee7\u65e5\u5fd7\u91cc\uff0c\u518d\u8fd4\u56de\u7ed9\u4e3b\u5e93\u201c\u590d\u5236\u6210\u529f\u201d\u7684\u54cd\u5e94\u3002</li> <li>\u4ece\u5e93\u4f1a\u521b\u5efa\u4e00\u4e2a\u7528\u4e8e\u56de\u653e binlog \u7684\u7ebf\u7a0b\uff0c\u53bb\u8bfb relay log \u4e2d\u7ee7\u65e5\u5fd7\uff0c\u7136\u540e\u56de\u653e binlog \u66f4\u65b0\u5b58\u50a8\u5f15\u64ce\u4e2d\u7684\u6570\u636e\uff0c\u6700\u7ec8\u5b9e\u73b0\u4e3b\u4ece\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002</li> </ul> <p>\u5728\u5b8c\u6210\u4e3b\u4ece\u590d\u5236\u4e4b\u540e\uff0c\u4f60\u5c31\u53ef\u4ee5\u5728\u5199\u6570\u636e\u65f6\u53ea\u5199\u4e3b\u5e93\uff0c\u5728\u8bfb\u6570\u636e\u65f6\u53ea\u8bfb\u4ece\u5e93\uff0c\u8fd9\u6837\u5373\u4f7f\u5199\u8bf7\u6c42\u4f1a\u9501\u8868\u6216\u8005\u9501\u8bb0\u5f55\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd\u8bfb\u8bf7\u6c42\u7684\u6267\u884c\u3002</p> <p></p> <p>\u4ece\u5e93\u662f\u4e0d\u662f\u8d8a\u591a\u8d8a\u597d\uff1f</p> <p>\u4e0d\u662f\u7684\u3002</p> <p>\u56e0\u4e3a\u4ece\u5e93\u6570\u91cf\u589e\u52a0\uff0c\u4ece\u5e93\u8fde\u63a5\u4e0a\u6765\u7684 I/O \u7ebf\u7a0b\u4e5f\u6bd4\u8f83\u591a\uff0c\u4e3b\u5e93\u4e5f\u8981\u521b\u5efa\u540c\u6837\u591a\u7684 log dump \u7ebf\u7a0b\u6765\u5904\u7406\u590d\u5236\u7684\u8bf7\u6c42\uff0c\u5bf9\u4e3b\u5e93\u8d44\u6e90\u6d88\u8017\u6bd4\u8f83\u9ad8\uff0c\u540c\u65f6\u8fd8\u53d7\u9650\u4e8e\u4e3b\u5e93\u7684\u7f51\u7edc\u5e26\u5bbd\u3002</p> <p>\u6240\u4ee5\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\uff0c\u4e00\u4e2a\u4e3b\u5e93\u4e00\u822c\u8ddf 2\uff5e3 \u4e2a\u4ece\u5e93\uff081 \u5957\u6570\u636e\u5e93\uff0c1 \u4e3b 2 \u4ece 1 \u5907\u4e3b\uff09\uff0c\u8fd9\u5c31\u662f\u4e00\u4e3b\u591a\u4ece\u7684 MySQL \u96c6\u7fa4\u7ed3\u6784\u3002</p> <p>MySQL \u4e3b\u4ece\u590d\u5236\u8fd8\u6709\u54ea\u4e9b\u6a21\u578b\uff1f</p> <p>\u4e3b\u8981\u6709\u4e09\u79cd\uff1a</p> <ul> <li>\u540c\u6b65\u590d\u5236\uff1aMySQL \u4e3b\u5e93\u63d0\u4ea4\u4e8b\u52a1\u7684\u7ebf\u7a0b\u8981\u7b49\u5f85\u6240\u6709\u4ece\u5e93\u7684\u590d\u5236\u6210\u529f\u54cd\u5e94\uff0c\u624d\u8fd4\u56de\u5ba2\u6237\u7aef\u7ed3\u679c\u3002\u8fd9\u79cd\u65b9\u5f0f\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\uff0c\u57fa\u672c\u4e0a\u6ca1\u6cd5\u7528\uff0c\u539f\u56e0\u6709\u4e24\u4e2a\uff1a\u4e00\u662f\u6027\u80fd\u5f88\u5dee\uff0c\u56e0\u4e3a\u8981\u590d\u5236\u5230\u6240\u6709\u8282\u70b9\u624d\u8fd4\u56de\u54cd\u5e94\uff1b\u4e8c\u662f\u53ef\u7528\u6027\u4e5f\u5f88\u5dee\uff0c\u4e3b\u5e93\u548c\u6240\u6709\u4ece\u5e93\u4efb\u4f55\u4e00\u4e2a\u6570\u636e\u5e93\u51fa\u95ee\u9898\uff0c\u90fd\u4f1a\u5f71\u54cd\u4e1a\u52a1\u3002</li> <li>\u5f02\u6b65\u590d\u5236\uff08\u9ed8\u8ba4\u6a21\u578b\uff09\uff1aMySQL \u4e3b\u5e93\u63d0\u4ea4\u4e8b\u52a1\u7684\u7ebf\u7a0b\u5e76\u4e0d\u4f1a\u7b49\u5f85 binlog \u540c\u6b65\u5230\u5404\u4ece\u5e93\uff0c\u5c31\u8fd4\u56de\u5ba2\u6237\u7aef\u7ed3\u679c\u3002\u8fd9\u79cd\u6a21\u5f0f\u4e00\u65e6\u4e3b\u5e93\u5b95\u673a\uff0c\u6570\u636e\u5c31\u4f1a\u53d1\u751f\u4e22\u5931\u3002</li> <li>\u534a\u540c\u6b65\u590d\u5236\uff1aMySQL 5.7 \u7248\u672c\u4e4b\u540e\u589e\u52a0\u7684\u4e00\u79cd\u590d\u5236\u65b9\u5f0f\uff0c\u4ecb\u4e8e\u4e24\u8005\u4e4b\u95f4\uff0c\u4e8b\u52a1\u7ebf\u7a0b\u4e0d\u7528\u7b49\u5f85\u6240\u6709\u7684\u4ece\u5e93\u590d\u5236\u6210\u529f\u54cd\u5e94\uff0c\u53ea\u8981\u4e00\u90e8\u5206\u590d\u5236\u6210\u529f\u54cd\u5e94\u56de\u6765\u5c31\u884c\uff0c\u6bd4\u5982\u4e00\u4e3b\u4e8c\u4ece\u7684\u96c6\u7fa4\uff0c\u53ea\u8981\u6570\u636e\u6210\u529f\u590d\u5236\u5230\u4efb\u610f\u4e00\u4e2a\u4ece\u5e93\u4e0a\uff0c\u4e3b\u5e93\u7684\u4e8b\u52a1\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002\u8fd9\u79cd\u534a\u540c\u6b65\u590d\u5236\u7684\u65b9\u5f0f\uff0c\u517c\u987e\u4e86\u5f02\u6b65\u590d\u5236\u548c\u540c\u6b65\u590d\u5236\u7684\u4f18\u70b9\uff0c\u5373\u4f7f\u51fa\u73b0\u4e3b\u5e93\u5b95\u673a\uff0c\u81f3\u5c11\u8fd8\u6709\u4e00\u4e2a\u4ece\u5e93\u6709\u6700\u65b0\u7684\u6570\u636e\uff0c\u4e0d\u5b58\u5728\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669\u3002</li> </ul>"},{"location":"mysql/log/how_update/#binlog_1","title":"binlog \u4ec0\u4e48\u65f6\u5019\u5237\u76d8\uff1f","text":"<p>\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5148\u628a\u65e5\u5fd7\u5199\u5230 binlog cache\uff08Server \u5c42\u7684 cache\uff09\uff0c\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u518d\u628a binlog cache \u5199\u5230 binlog \u6587\u4ef6\u4e2d\u3002</p> <p>MySQL \u7ed9 binlog cache \u5206\u914d\u4e86\u4e00\u7247\u5185\u5b58\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u4e00\u4e2a\uff0c\u53c2\u6570 binlog_cache_size \u7528\u4e8e\u63a7\u5236\u5355\u4e2a\u7ebf\u7a0b\u5185 binlog cache \u6240\u5360\u5185\u5b58\u7684\u5927\u5c0f\u3002\u5982\u679c\u8d85\u8fc7\u4e86\u8fd9\u4e2a\u53c2\u6570\u89c4\u5b9a\u7684\u5927\u5c0f\uff0c\u5c31\u8981\u6682\u5b58\u5230\u78c1\u76d8\u3002</p> <p>\u4ec0\u4e48\u65f6\u5019 binlog cache \u4f1a\u5199\u5230 binlog \u6587\u4ef6\uff1f</p> <p>\u5728\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u6267\u884c\u5668\u628a binlog cache \u91cc\u7684\u5b8c\u6574\u4e8b\u52a1\u5199\u5165\u5230 binlog \u6587\u4ef6\u4e2d\uff0c\u5e76\u6e05\u7a7a binlog cache\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u867d\u7136\u6bcf\u4e2a\u7ebf\u7a0b\u6709\u81ea\u5df1 binlog cache\uff0c\u4f46\u662f\u6700\u7ec8\u90fd\u5199\u5230\u540c\u4e00\u4e2a binlog \u6587\u4ef6\uff1a</p> <ul> <li>\u56fe\u4e2d\u7684 write\uff0c\u6307\u7684\u5c31\u662f\u6307\u628a\u65e5\u5fd7\u5199\u5165\u5230 binlog \u6587\u4ef6\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u628a\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u56e0\u4e3a\u6570\u636e\u8fd8\u7f13\u5b58\u5728\u6587\u4ef6\u7cfb\u7edf\u7684 page cache \u91cc\uff0cwrite \u7684\u5199\u5165\u901f\u5ea6\u8fd8\u662f\u6bd4\u8f83\u5feb\u7684\uff0c\u56e0\u4e3a\u4e0d\u6d89\u53ca\u78c1\u76d8 I/O\u3002</li> <li>\u56fe\u4e2d\u7684 fsync\uff0c\u624d\u662f\u5c06\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u64cd\u4f5c\uff0c\u8fd9\u91cc\u5c31\u4f1a\u6d89\u53ca\u78c1\u76d8 I/O\uff0c\u6240\u4ee5\u9891\u7e41\u7684 fsync \u4f1a\u5bfc\u81f4\u78c1\u76d8\u7684 I/O \u5347\u9ad8\u3002</li> </ul> <p>MySQL \u63d0\u4f9b\u4e00\u4e2a sync_binlog \u53c2\u6570\u6765\u63a7\u5236\u6570\u636e\u5e93\u7684 binlog \u5237\u5230\u78c1\u76d8\u4e0a\u7684\u9891\u7387\uff1a</p> <ul> <li>sync_binlog = 0 \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u53ea write\uff0c\u4e0d fsync\uff0c\u540e\u7eed\u4ea4\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f55\u65f6\u5c06\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff1b</li> <li>sync_binlog = 1 \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u4f1a write\uff0c\u7136\u540e\u9a6c\u4e0a\u6267\u884c fsync\uff1b</li> <li>sync_binlog = N(N&gt;1) \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd write\uff0c\u4f46\u7d2f\u79ef N \u4e2a\u4e8b\u52a1\u540e\u624d fsync\u3002</li> </ul> <p>\u5728 MySQL \u4e2d\u7cfb\u7edf\u9ed8\u8ba4\u7684\u8bbe\u7f6e\u662f sync_binlog = 1\uff0c\u662f\u6700\u5b89\u5168\u4f46\u662f\u6027\u80fd\u635f\u8017\u6700\u5927\u7684\u8bbe\u7f6e\u3002\u56e0\u4e3a\u5f53\u8bbe\u7f6e\u4e3a 1 \u7684\u65f6\u5019\uff0c\u5373\u4f7f\u4e3b\u673a\u53d1\u751f\u5f02\u5e38\u91cd\u542f\uff0c\u6700\u591a\u4e22\u5931\u4e00\u4e2a\u4e8b\u52a1\u7684 binlog\uff0c\u800c\u5df2\u7ecf\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u6570\u636e\u5c31\u4e0d\u4f1a\u6709\u5f71\u54cd\uff0c\u4e0d\u8fc7\u5c31\u662f\u5bf9\u5199\u5165\u6027\u80fd\u5f71\u54cd\u592a\u5927\u3002</p> <p>\u800c\u5f53 sync_binlog \u8bbe\u7f6e\u4e3a 0 \u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u662f\u4e0d\u505a\u4efb\u4f55\u5f3a\u5236\u6027\u7684\u78c1\u76d8\u5237\u65b0\u6307\u4ee4\uff0c\u8fd9\u65f6\u5019\u7684\u6027\u80fd\u662f\u6700\u597d\u7684\uff0c\u4f46\u662f\u98ce\u9669\u4e5f\u662f\u6700\u5927\u7684\u3002\u56e0\u4e3a\u4e00\u65e6\u4e3b\u673a\u53d1\u751f\u5f02\u5e38\u91cd\u542f\uff0c\u8fd8\u6ca1\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u3002</p> <p>\u5982\u679c\u80fd\u5bb9\u5fcd\u5c11\u91cf\u4e8b\u52a1\u7684 binlog \u65e5\u5fd7\u5b58\u5728\u4e22\u5931\u98ce\u9669\u7684\u60c5\u51b5\u4e0b\uff0c\u540c\u65f6\u4e3a\u4e86\u63d0\u9ad8\u5199\u5165\u7684\u6027\u80fd\uff0c\u4e00\u822c\u53ef\u4ee5\u5c06 sync_binlog \u8bbe\u7f6e\u4e3a 100~1000 \u4e2d\u7684\u67d0\u4e2a\u6570\u503c\u3002</p> <p>\u4e09\u4e2a\u65e5\u5fd7\u8bb2\u5b8c\u4e86\uff0c\u81f3\u6b64\u6211\u4eec\u53ef\u4ee5\u5148\u5c0f\u7ed3\u4e0b\uff0cupdate \u8bed\u53e5\u7684\u6267\u884c\u8fc7\u7a0b\u3002</p> <p>\u5f53\u4f18\u5316\u5668\u5206\u6790\u51fa\u6210\u672c\u6700\u5c0f\u7684\u6267\u884c\u8ba1\u5212\u540e\uff0c\u6267\u884c\u5668\u5c31\u6309\u7167\u6267\u884c\u8ba1\u5212\u5f00\u59cb\u8fdb\u884c\u66f4\u65b0\u64cd\u4f5c\u3002</p> <p>\u5177\u4f53\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55 <code>UPDATE t_user SET name = 'xiaolin' WHERE id = 1;</code> \u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u6267\u884c\u5668\u8d1f\u8d23\u5177\u4f53\u6267\u884c\uff0c\u4f1a\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\uff0c\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u6811\u641c\u7d22\u83b7\u53d6 id = 1 \u8fd9\u4e00\u884c\u8bb0\u5f55\uff1a</li> <li>\u5982\u679c id=1 \u8fd9\u4e00\u884c\u6240\u5728\u7684\u6570\u636e\u9875\u672c\u6765\u5c31\u5728 buffer pool \u4e2d\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u7ed9\u6267\u884c\u5668\u66f4\u65b0\uff1b</li> <li>\u5982\u679c\u8bb0\u5f55\u4e0d\u5728 buffer pool\uff0c\u5c06\u6570\u636e\u9875\u4ece\u78c1\u76d8\u8bfb\u5165\u5230 buffer pool\uff0c\u8fd4\u56de\u8bb0\u5f55\u7ed9\u6267\u884c\u5668\u3002</li> <li>\u6267\u884c\u5668\u5f97\u5230\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u540e\uff0c\u4f1a\u770b\u4e00\u4e0b\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u662f\u5426\u4e00\u6837\uff1a</li> <li>\u5982\u679c\u4e00\u6837\u7684\u8bdd\u5c31\u4e0d\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u6d41\u7a0b\uff1b</li> <li>\u5982\u679c\u4e0d\u4e00\u6837\u7684\u8bdd\u5c31\u628a\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u90fd\u5f53\u4f5c\u53c2\u6570\u4f20\u7ed9 InnoDB \u5c42\uff0c\u8ba9 InnoDB \u771f\u6b63\u7684\u6267\u884c\u66f4\u65b0\u8bb0\u5f55\u7684\u64cd\u4f5c\uff1b</li> <li>\u5f00\u542f\u4e8b\u52a1\uff0cInnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u56e0\u4e3a\u8fd9\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\uff0c\u4e0d\u8fc7\u5728\u5185\u5b58\u4fee\u6539\u8be5 Undo \u9875\u9762\u540e\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94\u7684 redo log\u3002</li> <li>InnoDB \u5c42\u5f00\u59cb\u66f4\u65b0\u8bb0\u5f55\uff0c\u4f1a\u5148\u66f4\u65b0\u5185\u5b58\uff08\u540c\u65f6\u6807\u8bb0\u4e3a\u810f\u9875\uff09\uff0c\u7136\u540e\u5c06\u8bb0\u5f55\u5199\u5230 redo log \u91cc\u9762\uff0c\u8fd9\u4e2a\u65f6\u5019\u66f4\u65b0\u5c31\u7b97\u5b8c\u6210\u4e86\u3002\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8 I/O\uff0c\u4e0d\u4f1a\u7acb\u5373\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff0c\u540e\u7eed\u7531\u540e\u53f0\u7ebf\u7a0b\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002\u8fd9\u5c31\u662f WAL \u6280\u672f\uff0cMySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5199 redo \u65e5\u5fd7\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u5c06\u4fee\u6539\u7684\u884c\u6570\u636e\u5199\u5230\u78c1\u76d8\u4e0a\u3002</li> <li>\u81f3\u6b64\uff0c\u4e00\u6761\u8bb0\u5f55\u66f4\u65b0\u5b8c\u4e86\u3002</li> <li>\u5728\u4e00\u6761\u66f4\u65b0\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u7136\u540e\u5f00\u59cb\u8bb0\u5f55\u8be5\u8bed\u53e5\u5bf9\u5e94\u7684 binlog\uff0c\u6b64\u65f6\u8bb0\u5f55\u7684 binlog \u4f1a\u88ab\u4fdd\u5b58\u5230 binlog cache\uff0c\u5e76\u6ca1\u6709\u5237\u65b0\u5230\u786c\u76d8\u4e0a\u7684 binlog \u6587\u4ef6\uff0c\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\u624d\u4f1a\u7edf\u4e00\u5c06\u8be5\u4e8b\u52a1\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709 binlog \u5237\u65b0\u5230\u786c\u76d8\u3002</li> <li>\u4e8b\u52a1\u63d0\u4ea4\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u300c\u4e24\u9636\u6bb5\u63d0\u4ea4\u300d\u7684\u4e8b\u60c5\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u8bb2\u8fd9\u4e2a\u3002</li> </ol>"},{"location":"mysql/log/how_update/#_2","title":"\u4e3a\u4ec0\u4e48\u9700\u8981\u4e24\u9636\u6bb5\u63d0\u4ea4\uff1f","text":"<p>\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0credo log \u548c binlog \u90fd\u8981\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u4f46\u662f\u8fd9\u4e24\u4e2a\u662f\u72ec\u7acb\u7684\u903b\u8f91\uff0c\u53ef\u80fd\u51fa\u73b0\u534a\u6210\u529f\u7684\u72b6\u6001\uff0c\u8fd9\u6837\u5c31\u9020\u6210\u4e24\u4efd\u65e5\u5fd7\u4e4b\u95f4\u7684\u903b\u8f91\u4e0d\u4e00\u81f4\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe id = 1 \u8fd9\u884c\u6570\u636e\u7684\u5b57\u6bb5 name \u7684\u503c\u539f\u672c\u662f 'jay'\uff0c\u7136\u540e\u6267\u884c <code>UPDATE t_user SET name = 'xiaolin' WHERE id = 1;</code> \u5982\u679c\u5728\u6301\u4e45\u5316 redo log \u548c binlog \u4e24\u4e2a\u65e5\u5fd7\u7684\u8fc7\u7a0b\u4e2d\uff0c\u51fa\u73b0\u4e86\u534a\u6210\u529f\u72b6\u6001\uff0c\u90a3\u4e48\u5c31\u6709\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u5982\u679c\u5728\u5c06 redo log \u5237\u5165\u5230\u78c1\u76d8\u4e4b\u540e\uff0cMySQL \u7a81\u7136\u5b95\u673a\u4e86\uff0c\u800c binlog \u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5199\u5165\u3002MySQL \u91cd\u542f\u540e\uff0c\u901a\u8fc7 redo log \u80fd\u5c06 Buffer Pool \u4e2d id = 1 \u8fd9\u884c\u6570\u636e\u7684 name \u5b57\u6bb5\u6062\u590d\u5230\u65b0\u503c xiaolin\uff0c\u4f46\u662f binlog \u91cc\u9762\u6ca1\u6709\u8bb0\u5f55\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u5728\u4e3b\u4ece\u67b6\u6784\u4e2d\uff0cbinlog \u4f1a\u88ab\u590d\u5236\u5230\u4ece\u5e93\uff0c\u7531\u4e8e binlog \u4e22\u5931\u4e86\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u4ece\u5e93\u7684\u8fd9\u4e00\u884c name \u5b57\u6bb5\u662f\u65e7\u503c jay\uff0c\u4e0e\u4e3b\u5e93\u7684\u503c\u4e0d\u4e00\u81f4\u6027\uff1b</li> <li>\u5982\u679c\u5728\u5c06 binlog \u5237\u5165\u5230\u78c1\u76d8\u4e4b\u540e\uff0cMySQL \u7a81\u7136\u5b95\u673a\u4e86\uff0c\u800c redo log \u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5199\u5165\u3002\u7531\u4e8e redo log \u8fd8\u6ca1\u5199\uff0c\u5d29\u6e83\u6062\u590d\u4ee5\u540e\u8fd9\u4e2a\u4e8b\u52a1\u65e0\u6548\uff0c\u6240\u4ee5 id = 1 \u8fd9\u884c\u6570\u636e\u7684 name \u5b57\u6bb5\u8fd8\u662f\u65e7\u503c jay\uff0c\u800c binlog \u91cc\u9762\u8bb0\u5f55\u4e86\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u5728\u4e3b\u4ece\u67b6\u6784\u4e2d\uff0cbinlog \u4f1a\u88ab\u590d\u5236\u5230\u4ece\u5e93\uff0c\u4ece\u5e93\u6267\u884c\u4e86\u8fd9\u6761\u66f4\u65b0\u8bed\u53e5\uff0c\u90a3\u4e48\u8fd9\u4e00\u884c name \u5b57\u6bb5\u662f\u65b0\u503c xiaolin\uff0c\u4e0e\u4e3b\u5e93\u7684\u503c\u4e0d\u4e00\u81f4\u6027\uff1b</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u6301\u4e45\u5316 redo log \u548c binlog \u8fd9\u4e24\u4efd\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u5982\u679c\u51fa\u73b0\u534a\u6210\u529f\u7684\u72b6\u6001\uff0c\u5c31\u4f1a\u9020\u6210\u4e3b\u4ece\u73af\u5883\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u6027\u3002\u8fd9\u662f\u56e0\u4e3a redo log \u5f71\u54cd\u4e3b\u5e93\u7684\u6570\u636e\uff0cbinlog \u5f71\u54cd\u4ece\u5e93\u7684\u6570\u636e\uff0c\u6240\u4ee5 redo log \u548c binlog \u5fc5\u987b\u4fdd\u6301\u4e00\u81f4\u624d\u80fd\u4fdd\u8bc1\u4e3b\u4ece\u6570\u636e\u4e00\u81f4\u3002</p> <p>MySQL \u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u4e24\u4efd\u65e5\u5fd7\u4e4b\u95f4\u7684\u903b\u8f91\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u4f7f\u7528\u4e86\u300c\u4e24\u9636\u6bb5\u63d0\u4ea4\u300d\u6765\u89e3\u51b3\uff0c\u4e24\u9636\u6bb5\u63d0\u4ea4\u5176\u5b9e\u662f\u5206\u5e03\u5f0f\u4e8b\u52a1\u4e00\u81f4\u6027\u534f\u8bae\uff0c\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u591a\u4e2a\u903b\u8f91\u64cd\u4f5c\u8981\u4e0d\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e0d\u5168\u90e8\u5931\u8d25\uff0c\u4e0d\u4f1a\u51fa\u73b0\u534a\u6210\u529f\u7684\u72b6\u6001\u3002</p> <p>\u4e24\u9636\u6bb5\u63d0\u4ea4\u628a\u5355\u4e2a\u4e8b\u52a1\u7684\u63d0\u4ea4\u62c6\u5206\u6210\u4e86 2 \u4e2a\u9636\u6bb5\uff0c\u5206\u522b\u662f\u300c\u51c6\u5907\uff08Prepare\uff09\u9636\u6bb5\u300d\u548c\u300c\u63d0\u4ea4\uff08Commit\uff09\u9636\u6bb5\u300d\uff0c\u6bcf\u4e2a\u9636\u6bb5\u90fd\u7531\u534f\u8c03\u8005\uff08Coordinator\uff09\u548c\u53c2\u4e0e\u8005\uff08Participant\uff09\u5171\u540c\u5b8c\u6210\u3002\u6ce8\u610f\uff0c\u4e0d\u8981\u628a\u63d0\u4ea4\uff08Commit\uff09\u9636\u6bb5\u548c commit \u8bed\u53e5\u6df7\u6dc6\u4e86\uff0ccommit \u8bed\u53e5\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u5305\u542b\u63d0\u4ea4\uff08Commit\uff09\u9636\u6bb5\u3002</p> <p>\u4e3e\u4e2a\u62f3\u51fb\u6bd4\u8d5b\u7684\u4f8b\u5b50\uff0c\u4e24\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u5f00\u59cb\u6bd4\u8d5b\u4e4b\u524d\uff0c\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u4f1a\u5728\u4e2d\u95f4\u786e\u8ba4\u4e24\u4f4d\u62f3\u51fb\u624b\u7684\u72b6\u6001\uff0c\u7c7b\u4f3c\u4e8e\u95ee\u4f60\u51c6\u5907\u597d\u4e86\u5417\uff1f</p> <ul> <li>\u51c6\u5907\u9636\u6bb5\uff1a\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u4f1a\u4f9d\u6b21\u8be2\u95ee\u4e24\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u662f\u5426\u51c6\u5907\u597d\u4e86\uff0c\u7136\u540e\u62f3\u51fb\u624b\u542c\u5230\u540e\u505a\u51fa\u5e94\u7b54\uff0c\u5982\u679c\u89c9\u5f97\u81ea\u5df1\u51c6\u5907\u597d\u4e86\uff0c\u5c31\u4f1a\u8ddf\u88c1\u5224\u8bf4\u51c6\u5907\u597d\u4e86\uff1b\u5982\u679c\u6ca1\u6709\u81ea\u5df1\u8fd8\u6ca1\u6709\u51c6\u5907\u597d\uff08\u6bd4\u5982\u62f3\u5957\u8fd8\u6ca1\u6709\u5e26\u597d\uff09\uff0c\u5c31\u4f1a\u8ddf\u88c1\u5224\u8bf4\u8fd8\u6ca1\u51c6\u5907\u597d\u3002</li> <li>\u63d0\u4ea4\u9636\u6bb5\uff1a\u5982\u679c\u4e24\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u90fd\u56de\u7b54\u51c6\u5907\u597d\u4e86\uff0c\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u5ba3\u5e03\u6bd4\u8d5b\u6b63\u5f0f\u5f00\u59cb\uff0c\u4e24\u4f4d\u62f3\u51fb\u624b\u5c31\u53ef\u4ee5\u76f4\u63a5\u5f00\u6253\uff1b\u5982\u679c\u4efb\u4f55\u4e00\u4f4d\u62f3\u51fb\u624b\uff08\u53c2\u4e0e\u8005\uff09\u56de\u7b54\u6ca1\u6709\u51c6\u5907\u597d\uff0c\u88c1\u5224\uff08\u534f\u8c03\u8005\uff09\u4f1a\u5ba3\u5e03\u6bd4\u8d5b\u6682\u505c\uff0c\u5bf9\u5e94\u4e8b\u52a1\u4e2d\u7684\u56de\u6eda\u64cd\u4f5c\u3002</li> </ul>"},{"location":"mysql/log/how_update/#_3","title":"\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>\u5728 MySQL \u7684 InnoDB \u5b58\u50a8\u5f15\u64ce\u4e2d\uff0c\u5f00\u542f binlog \u7684\u60c5\u51b5\u4e0b\uff0cMySQL \u4f1a\u540c\u65f6\u7ef4\u62a4 binlog \u65e5\u5fd7\u4e0e InnoDB \u7684 redo log\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u8fd9\u4e24\u4e2a\u65e5\u5fd7\u7684\u4e00\u81f4\u6027\uff0cMySQL \u4f7f\u7528\u4e86\u5185\u90e8 XA \u4e8b\u52a1\uff08\u662f\u7684\uff0c\u4e5f\u6709\u5916\u90e8  XA \u4e8b\u52a1\uff0c\u8ddf\u672c\u6587\u4e0d\u592a\u76f8\u5173\uff0c\u6211\u5c31\u4e0d\u4ecb\u7ecd\u4e86\uff09\uff0c\u5185\u90e8 XA \u4e8b\u52a1\u7531 binlog \u4f5c\u4e3a\u534f\u8c03\u8005\uff0c\u5b58\u50a8\u5f15\u64ce\u662f\u53c2\u4e0e\u8005\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef\u6267\u884c commit \u8bed\u53e5\u6216\u8005\u5728\u81ea\u52a8\u63d0\u4ea4\u7684\u60c5\u51b5\u4e0b\uff0cMySQL \u5185\u90e8\u5f00\u542f\u4e00\u4e2a XA \u4e8b\u52a1\uff0c\u5206\u4e24\u9636\u6bb5\u6765\u5b8c\u6210 XA \u4e8b\u52a1\u7684\u63d0\u4ea4\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4ece\u56fe\u4e2d\u53ef\u770b\u51fa\uff0c\u4e8b\u52a1\u7684\u63d0\u4ea4\u8fc7\u7a0b\u6709\u4e24\u4e2a\u9636\u6bb5\uff0c\u5c31\u662f\u5c06 redo log \u7684\u5199\u5165\u62c6\u6210\u4e86\u4e24\u4e2a\u6b65\u9aa4\uff1aprepare \u548c commit\uff0c\u4e2d\u95f4\u518d\u7a7f\u63d2\u5199\u5165 binlog\uff0c\u5177\u4f53\u5982\u4e0b\uff1a</p> <ul> <li> <p>prepare \u9636\u6bb5\uff1a\u5c06 XID\uff08\u5185\u90e8 XA \u4e8b\u52a1\u7684 ID\uff09\u5199\u5165\u5230 redo log\uff0c\u540c\u65f6\u5c06 redo log \u5bf9\u5e94\u7684\u4e8b\u52a1\u72b6\u6001\u8bbe\u7f6e\u4e3a prepare\uff0c\u7136\u540e\u5c06 redo log \u5237\u65b0\u5230\u786c\u76d8\uff1b</p> </li> <li> <p>commit \u9636\u6bb5\uff1a\u628a XID  \u5199\u5165\u5230 binlog\uff0c\u7136\u540e\u5c06 binlog \u5237\u65b0\u5230\u78c1\u76d8\uff0c\u63a5\u7740\u8c03\u7528\u5f15\u64ce\u7684\u63d0\u4ea4\u4e8b\u52a1\u63a5\u53e3\uff0c\u5c06 redo log \u72b6\u6001\u8bbe\u7f6e\u4e3a commit\uff08\u5c06\u4e8b\u52a1\u8bbe\u7f6e\u4e3a commit \u72b6\u6001\u540e\uff0c\u5237\u5165\u5230\u78c1\u76d8 redo log \u6587\u4ef6\uff0c\u6240\u4ee5 commit \u72b6\u6001\u4e5f\u662f\u4f1a\u5237\u76d8\u7684\uff09\uff1b</p> </li> </ul>"},{"location":"mysql/log/how_update/#_4","title":"\u5f02\u5e38\u91cd\u542f\u4f1a\u51fa\u73b0\u4ec0\u4e48\u73b0\u8c61\uff1f","text":"<p>\u6211\u4eec\u6765\u770b\u770b\u5728\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u4e0d\u540c\u65f6\u523b\uff0cMySQL \u5f02\u5e38\u91cd\u542f\u4f1a\u51fa\u73b0\u4ec0\u4e48\u73b0\u8c61\uff1f\u4e0b\u56fe\u4e2d\u6709\u65f6\u523b A \u548c\u65f6\u523b B \u90fd\u6709\u53ef\u80fd\u53d1\u751f\u5d29\u6e83\uff1a</p> <p></p> <p>\u4e0d\u7ba1\u662f\u65f6\u523b A\uff08\u5df2\u7ecf redo log\uff0c\u8fd8\u6ca1\u5199\u5165 binlog\uff09\uff0c\u8fd8\u662f\u65f6\u523b B\uff08\u5df2\u7ecf\u5199\u5165 redo log \u548c binlog\uff0c\u8fd8\u6ca1\u5199\u5165 commit \u6807\u8bc6\uff09\u5d29\u6e83\uff0c\u6b64\u65f6\u7684 redo log \u90fd\u5904\u4e8e prepare \u72b6\u6001\u3002</p> <p>\u5728 MySQL \u91cd\u542f\u540e\u4f1a\u6309\u987a\u5e8f\u626b\u63cf redo log \u6587\u4ef6\uff0c\u78b0\u5230\u5904\u4e8e prepare \u72b6\u6001\u7684 redo log\uff0c\u5c31\u62ff\u7740 redo log \u4e2d\u7684 XID \u53bb binlog \u67e5\u770b\u662f\u5426\u5b58\u5728\u6b64 XID\uff1a</p> <ul> <li>\u5982\u679c binlog \u4e2d\u6ca1\u6709\u5f53\u524d\u5185\u90e8 XA \u4e8b\u52a1\u7684 XID\uff0c\u8bf4\u660e redolog \u5b8c\u6210\u5237\u76d8\uff0c\u4f46\u662f binlog \u8fd8\u6ca1\u6709\u5237\u76d8\uff0c\u5219\u56de\u6eda\u4e8b\u52a1\u3002\u5bf9\u5e94\u65f6\u523b A \u5d29\u6e83\u6062\u590d\u7684\u60c5\u51b5\u3002</li> <li>\u5982\u679c binlog \u4e2d\u6709\u5f53\u524d\u5185\u90e8 XA \u4e8b\u52a1\u7684 XID\uff0c\u8bf4\u660e redolog \u548c binlog \u90fd\u5df2\u7ecf\u5b8c\u6210\u4e86\u5237\u76d8\uff0c\u5219\u63d0\u4ea4\u4e8b\u52a1\u3002\u5bf9\u5e94\u65f6\u523b B \u5d29\u6e83\u6062\u590d\u7684\u60c5\u51b5\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5bf9\u4e8e\u5904\u4e8e prepare \u9636\u6bb5\u7684 redo log\uff0c\u5373\u53ef\u4ee5\u63d0\u4ea4\u4e8b\u52a1\uff0c\u4e5f\u53ef\u4ee5\u56de\u6eda\u4e8b\u52a1\uff0c\u8fd9\u53d6\u51b3\u4e8e\u662f\u5426\u80fd\u5728 binlog \u4e2d\u67e5\u627e\u5230\u4e0e redo log \u76f8\u540c\u7684  XID\uff0c\u5982\u679c\u6709\u5c31\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u56de\u6eda\u4e8b\u52a1\u3002\u8fd9\u6837\u5c31\u53ef\u4ee5\u4fdd\u8bc1 redo log \u548c binlog \u8fd9\u4e24\u4efd\u65e5\u5fd7\u7684\u4e00\u81f4\u6027\u4e86\u3002</p> <p>\u6240\u4ee5\u8bf4\uff0c\u4e24\u9636\u6bb5\u63d0\u4ea4\u662f\u4ee5 binlog \u5199\u6210\u529f\u4e3a\u4e8b\u52a1\u63d0\u4ea4\u6210\u529f\u7684\u6807\u8bc6\uff0c\u56e0\u4e3a binlog \u5199\u6210\u529f\u4e86\uff0c\u5c31\u610f\u5473\u7740\u80fd\u5728 binlog \u4e2d\u67e5\u627e\u5230\u4e0e redo log \u76f8\u540c\u7684  XID\u3002</p> <p>\u5904\u4e8e prepare \u9636\u6bb5\u7684 redo log \u52a0\u4e0a\u5b8c\u6574 binlog\uff0c\u91cd\u542f\u5c31\u63d0\u4ea4\u4e8b\u52a1\uff0cMySQL \u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1\uff1f</p> <p>binlog \u5df2\u7ecf\u5199\u5165\u4e86\uff0c\u4e4b\u540e\u5c31\u4f1a\u88ab\u4ece\u5e93\uff08\u6216\u8005\u7528\u8fd9\u4e2a binlog \u6062\u590d\u51fa\u6765\u7684\u5e93\uff09\u4f7f\u7528\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u4e3b\u5e93\u4e0a\u4e5f\u8981\u63d0\u4ea4\u8fd9\u4e2a\u4e8b\u52a1\u3002\u91c7\u7528\u8fd9\u4e2a\u7b56\u7565\uff0c\u4e3b\u5e93\u548c\u5907\u5e93\u7684\u6570\u636e\u5c31\u4fdd\u8bc1\u4e86\u4e00\u81f4\u6027\u3002</p> <p>\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0credo log \u4f1a\u88ab\u6301\u4e45\u5316\u5230\u78c1\u76d8\u5417\uff1f</p> <p>\u4f1a\u7684\u3002</p> <p>\u4e8b\u52a1\u6267\u884c\u4e2d\u95f4\u8fc7\u7a0b\u7684 redo log \u4e5f\u662f\u76f4\u63a5\u5199\u5728 redo log buffer \u4e2d\u7684\uff0c\u8fd9\u4e9b\u7f13\u5b58\u5728  redo log buffer  \u91cc\u7684 redo log \u4e5f\u4f1a\u88ab\u300c\u540e\u53f0\u7ebf\u7a0b\u300d\u6bcf\u9694\u4e00\u79d2\u4e00\u8d77\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0credo log \u4e5f\u662f\u53ef\u80fd\u88ab\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u3002</p> <p>\u6709\u7684\u540c\u5b66\u53ef\u80fd\u4f1a\u95ee\uff0c\u5982\u679c mysql \u5d29\u6e83\u4e86\uff0c\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\u7684 redo log \u5df2\u7ecf\u88ab\u6301\u4e45\u5316\u78c1\u76d8\u4e86\uff0cmysql \u91cd\u542f\u540e\uff0c\u6570\u636e\u4e0d\u5c31\u4e0d\u4e00\u81f4\u4e86\uff1f</p> <p>\u653e\u5fc3\uff0c\u8fd9\u79cd\u60c5\u51b5 mysql \u91cd\u542f\u4f1a\u8fdb\u884c\u56de\u6eda\u64cd\u4f5c\uff0c\u56e0\u4e3a\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u7684\u65f6\u5019\uff0cbinlog \u662f\u8fd8\u6ca1\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u3002</p> <p>\u6240\u4ee5\uff0credo log \u53ef\u4ee5\u5728\u4e8b\u52a1\u6ca1\u63d0\u4ea4\u4e4b\u524d\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u4f46\u662f binlog \u5fc5\u987b\u5728\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0c\u624d\u53ef\u4ee5\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002</p>"},{"location":"mysql/log/how_update/#_5","title":"\u4e24\u9636\u6bb5\u63d0\u4ea4\u6709\u4ec0\u4e48\u95ee\u9898\uff1f","text":"<p>\u4e24\u9636\u6bb5\u63d0\u4ea4\u867d\u7136\u4fdd\u8bc1\u4e86\u4e24\u4e2a\u65e5\u5fd7\u6587\u4ef6\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f46\u662f\u6027\u80fd\u5f88\u5dee\uff0c\u4e3b\u8981\u6709\u4e24\u4e2a\u65b9\u9762\u7684\u5f71\u54cd\uff1a</p> <ul> <li>\u78c1\u76d8 I/O \u6b21\u6570\u9ad8\uff1a\u5bf9\u4e8e\u201c\u53cc 1\u201d\u914d\u7f6e\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u90fd\u4f1a\u8fdb\u884c\u4e24\u6b21 fsync\uff08\u5237\u76d8\uff09\uff0c\u4e00\u6b21\u662f redo log \u5237\u76d8\uff0c\u53e6\u4e00\u6b21\u662f binlog \u5237\u76d8\u3002</li> <li>\u9501\u7ade\u4e89\u6fc0\u70c8\uff1a\u4e24\u9636\u6bb5\u63d0\u4ea4\u867d\u7136\u80fd\u591f\u4fdd\u8bc1\u300c\u5355\u4e8b\u52a1\u300d\u4e24\u4e2a\u65e5\u5fd7\u7684\u5185\u5bb9\u4e00\u81f4\uff0c\u4f46\u5728\u300c\u591a\u4e8b\u52a1\u300d\u7684\u60c5\u51b5\u4e0b\uff0c\u5374\u4e0d\u80fd\u4fdd\u8bc1\u4e24\u8005\u7684\u63d0\u4ea4\u987a\u5e8f\u4e00\u81f4\uff0c\u56e0\u6b64\uff0c\u5728\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u6d41\u7a0b\u57fa\u7840\u4e0a\uff0c\u8fd8\u9700\u8981\u52a0\u4e00\u4e2a\u9501\u6765\u4fdd\u8bc1\u63d0\u4ea4\u7684\u539f\u5b50\u6027\uff0c\u4ece\u800c\u4fdd\u8bc1\u591a\u4e8b\u52a1\u7684\u60c5\u51b5\u4e0b\uff0c\u4e24\u4e2a\u65e5\u5fd7\u7684\u63d0\u4ea4\u987a\u5e8f\u4e00\u81f4\u3002</li> </ul> <p>\u4e3a\u4ec0\u4e48\u4e24\u9636\u6bb5\u63d0\u4ea4\u7684\u78c1\u76d8 I/O \u6b21\u6570\u4f1a\u5f88\u9ad8\uff1f</p> <p>binlog \u548c redo log \u5728\u5185\u5b58\u4e2d\u90fd\u5bf9\u5e94\u7684\u7f13\u5b58\u7a7a\u95f4\uff0cbinlog \u4f1a\u7f13\u5b58\u5728 binlog cache\uff0credo log \u4f1a\u7f13\u5b58\u5728 redo log buffer\uff0c\u5b83\u4eec\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u65f6\u673a\u5206\u522b\u7531\u4e0b\u9762\u8fd9\u4e24\u4e2a\u53c2\u6570\u63a7\u5236\u3002\u4e00\u822c\u6211\u4eec\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u4e22\u5931\u7684\u98ce\u9669\uff0c\u4f1a\u5c06\u8fd9\u4e24\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a 1\uff1a</p> <ul> <li>\u5f53 sync_binlog = 1 \u7684\u65f6\u5019\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd\u4f1a\u5c06  binlog cache \u91cc\u7684 binlog \u76f4\u63a5\u6301\u4e45\u5230\u78c1\u76d8\uff1b</li> <li>\u5f53 innodb_flush_log_at_trx_commit = 1 \u65f6\uff0c\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u5c06\u7f13\u5b58\u5728  redo log buffer \u91cc\u7684  redo log \u76f4\u63a5\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff1b</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c sync_binlog \u548c \u5f53 innodb_flush_log_at_trx_commit \u90fd\u8bbe\u7f6e\u4e3a 1\uff0c\u90a3\u4e48\u5728\u6bcf\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u8fc7\u7a0b\u4e2d\uff0c\u90fd\u4f1a\u81f3\u5c11\u8c03\u7528 2 \u6b21\u5237\u76d8\u64cd\u4f5c\uff0c\u4e00\u6b21\u662f redo log \u5237\u76d8\uff0c\u4e00\u6b21\u662f binlog \u843d\u76d8\uff0c\u6240\u4ee5\u8fd9\u4f1a\u6210\u4e3a\u6027\u80fd\u74f6\u9888\u3002</p> <p>\u4e3a\u4ec0\u4e48\u9501\u7ade\u4e89\u6fc0\u70c8\uff1f</p> <p>\u5728\u65e9\u671f\u7684 MySQL \u7248\u672c\u4e2d\uff0c\u901a\u8fc7\u4f7f\u7528 prepare_commit_mutex \u9501\u6765\u4fdd\u8bc1\u4e8b\u52a1\u63d0\u4ea4\u7684\u987a\u5e8f\uff0c\u5728\u4e00\u4e2a\u4e8b\u52a1\u83b7\u53d6\u5230\u9501\u65f6\u624d\u80fd\u8fdb\u5165 prepare \u9636\u6bb5\uff0c\u4e00\u76f4\u5230 commit \u9636\u6bb5\u7ed3\u675f\u624d\u80fd\u91ca\u653e\u9501\uff0c\u4e0b\u4e2a\u4e8b\u52a1\u624d\u53ef\u4ee5\u7ee7\u7eed\u8fdb\u884c prepare \u64cd\u4f5c\u3002</p> <p>\u901a\u8fc7\u52a0\u9501\u867d\u7136\u5b8c\u7f8e\u5730\u89e3\u51b3\u4e86\u987a\u5e8f\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u4f46\u5728\u5e76\u53d1\u91cf\u8f83\u5927\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5bf9\u9501\u7684\u4e89\u7528\uff0c\u6027\u80fd\u4e0d\u4f73\u3002</p>"},{"location":"mysql/log/how_update/#_6","title":"\u7ec4\u63d0\u4ea4","text":"<p>MySQL  \u5f15\u5165\u4e86 binlog \u7ec4\u63d0\u4ea4\uff08group commit\uff09\u673a\u5236\uff0c\u5f53\u6709\u591a\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u4f1a\u5c06\u591a\u4e2a binlog \u5237\u76d8\u64cd\u4f5c\u5408\u5e76\u6210\u4e00\u4e2a\uff0c\u4ece\u800c\u51cf\u5c11\u78c1\u76d8 I/O \u7684\u6b21\u6570\uff0c\u5982\u679c\u8bf4 10 \u4e2a\u4e8b\u52a1\u4f9d\u6b21\u6392\u961f\u5237\u76d8\u7684\u65f6\u95f4\u6210\u672c\u662f 10\uff0c\u90a3\u4e48\u5c06\u8fd9 10 \u4e2a\u4e8b\u52a1\u4e00\u6b21\u6027\u4e00\u8d77\u5237\u76d8\u7684\u65f6\u95f4\u6210\u672c\u5219\u8fd1\u4f3c\u4e8e 1\u3002</p> <p>\u5f15\u5165\u4e86\u7ec4\u63d0\u4ea4\u673a\u5236\u540e\uff0cprepare \u9636\u6bb5\u4e0d\u53d8\uff0c\u53ea\u9488\u5bf9 commit \u9636\u6bb5\uff0c\u5c06 commit \u9636\u6bb5\u62c6\u5206\u4e3a\u4e09\u4e2a\u8fc7\u7a0b\uff1a</p> <ul> <li>flush \u9636\u6bb5\uff1a\u591a\u4e2a\u4e8b\u52a1\u6309\u8fdb\u5165\u7684\u987a\u5e8f\u5c06 binlog \u4ece cache \u5199\u5165\u6587\u4ef6\uff08\u4e0d\u5237\u76d8\uff09\uff1b</li> <li>sync \u9636\u6bb5\uff1a\u5bf9 binlog \u6587\u4ef6\u505a fsync \u64cd\u4f5c\uff08\u591a\u4e2a\u4e8b\u52a1\u7684 binlog \u5408\u5e76\u4e00\u6b21\u5237\u76d8\uff09\uff1b</li> <li>commit \u9636\u6bb5\uff1a\u5404\u4e2a\u4e8b\u52a1\u6309\u987a\u5e8f\u505a InnoDB commit \u64cd\u4f5c\uff1b</li> </ul> <p>\u4e0a\u9762\u7684\u6bcf\u4e2a\u9636\u6bb5\u90fd\u6709\u4e00\u4e2a\u961f\u5217\uff0c\u6bcf\u4e2a\u9636\u6bb5\u6709\u9501\u8fdb\u884c\u4fdd\u62a4\uff0c\u56e0\u6b64\u4fdd\u8bc1\u4e86\u4e8b\u52a1\u5199\u5165\u7684\u987a\u5e8f\uff0c\u7b2c\u4e00\u4e2a\u8fdb\u5165\u961f\u5217\u7684\u4e8b\u52a1\u4f1a\u6210\u4e3a leader\uff0cleader \u9886\u5bfc\u6240\u5728\u961f\u5217\u7684\u6240\u6709\u4e8b\u52a1\uff0c\u5168\u6743\u8d1f\u8d23\u6574\u961f\u7684\u64cd\u4f5c\uff0c\u5b8c\u6210\u540e\u901a\u77e5\u961f\u5185\u5176\u4ed6\u4e8b\u52a1\u64cd\u4f5c\u7ed3\u675f\u3002</p> <p></p> <p>\u5bf9\u6bcf\u4e2a\u9636\u6bb5\u5f15\u5165\u4e86\u961f\u5217\u540e\uff0c\u9501\u5c31\u53ea\u9488\u5bf9\u6bcf\u4e2a\u961f\u5217\u8fdb\u884c\u4fdd\u62a4\uff0c\u4e0d\u518d\u9501\u4f4f\u63d0\u4ea4\u4e8b\u52a1\u7684\u6574\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u770b\u7684\u51fa\u6765\uff0c\u9501\u7c92\u5ea6\u51cf\u5c0f\u4e86\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97\u591a\u4e2a\u9636\u6bb5\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\uff0c\u4ece\u800c\u63d0\u5347\u6548\u7387\u3002</p> <p>\u6709  binlog \u7ec4\u63d0\u4ea4\uff0c\u90a3\u6709  redo log \u7ec4\u63d0\u4ea4\u5417\uff1f</p> <p>\u8fd9\u4e2a\u8981\u770b MySQL \u7248\u672c\uff0cMySQL 5.6 \u6ca1\u6709 redo log \u7ec4\u63d0\u4ea4\uff0cMySQL 5.7 \u6709 redo log \u7ec4\u63d0\u4ea4\u3002</p> <p>\u5728 MySQL 5.6 \u7684\u7ec4\u63d0\u4ea4\u903b\u8f91\u4e2d\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u5404\u81ea\u6267\u884c prepare \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u5404\u81ea\u5c06  redo log \u5237\u76d8\uff0c\u8fd9\u6837\u5c31\u6ca1\u529e\u6cd5\u5bf9 redo log \u8fdb\u884c\u7ec4\u63d0\u4ea4\u3002</p> <p>\u6240\u4ee5\u5728 MySQL 5.7 \u7248\u672c\u4e2d\uff0c\u505a\u4e86\u4e2a\u6539\u8fdb\uff0c\u5728 prepare \u9636\u6bb5\u4e0d\u518d\u8ba9\u4e8b\u52a1\u5404\u81ea\u6267\u884c redo log \u5237\u76d8\u64cd\u4f5c\uff0c\u800c\u662f\u63a8\u8fdf\u5230\u7ec4\u63d0\u4ea4\u7684 flush \u9636\u6bb5\uff0c\u4e5f\u5c31\u662f\u8bf4 prepare \u9636\u6bb5\u878d\u5408\u5728\u4e86  flush \u9636\u6bb5\u3002</p> <p>\u8fd9\u4e2a\u4f18\u5316\u662f\u5c06 redo log \u7684\u5237\u76d8\u5ef6\u8fdf\u5230\u4e86 flush \u9636\u6bb5\u4e4b\u4e2d\uff0csync \u9636\u6bb5\u4e4b\u524d\u3002\u901a\u8fc7\u5ef6\u8fdf\u5199 redo log \u7684\u65b9\u5f0f\uff0c\u4e3a redolog \u505a\u4e86\u4e00\u6b21\u7ec4\u5199\u5165\uff0c\u8fd9\u6837 binlog \u548c redo log \u90fd\u8fdb\u884c\u4e86\u4f18\u5316\u3002</p> <p>\u63a5\u4e0b\u6765\u4ecb\u7ecd\u6bcf\u4e2a\u9636\u6bb5\u7684\u8fc7\u7a0b\uff0c\u6ce8\u610f\u4e0b\u9762\u7684\u8fc7\u7a0b\u9488\u5bf9\u7684\u662f\u201c\u53cc 1\u201d\u914d\u7f6e\uff08sync_binlog \u548c innodb_flush_log_at_trx_commit \u90fd\u914d\u7f6e\u4e3a 1\uff09\u3002</p> <p>flush \u9636\u6bb5</p> <p>\u7b2c\u4e00\u4e2a\u4e8b\u52a1\u4f1a\u6210\u4e3a flush \u9636\u6bb5\u7684 Leader\uff0c\u6b64\u65f6\u540e\u9762\u5230\u6765\u7684\u4e8b\u52a1\u90fd\u662f Follower\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u83b7\u53d6\u961f\u5217\u4e2d\u7684\u4e8b\u52a1\u7ec4\uff0c\u7531\u7eff\u8272\u4e8b\u52a1\u7ec4\u7684 Leader \u5bf9 rodo log \u505a\u4e00\u6b21  write + fsync\uff0c\u5373\u4e00\u6b21\u5c06\u540c\u7ec4\u4e8b\u52a1\u7684 redolog \u5237\u76d8\uff1a</p> <p></p> <p>\u5b8c\u6210\u4e86 prepare \u9636\u6bb5\u540e\uff0c\u5c06\u7eff\u8272\u8fd9\u4e00\u7ec4\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684 binlog \u5199\u5165 binlog \u6587\u4ef6\uff08\u8c03\u7528 write\uff0c\u4e0d\u4f1a\u8c03\u7528 fsync\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5237\u76d8\uff0cbinlog \u7f13\u5b58\u5728\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff09\u3002</p> <p></p> <p>\u4ece\u4e0a\u9762\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u77e5\u9053 flush \u9636\u6bb5\u961f\u5217\u7684\u4f5c\u7528\u662f\u7528\u4e8e\u652f\u6491 redo log \u7684\u7ec4\u63d0\u4ea4\u3002</p> <p>\u5982\u679c\u5728\u8fd9\u4e00\u6b65\u5b8c\u6210\u540e\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u7531\u4e8e binlog \u4e2d\u6ca1\u6709\u8be5\u7ec4\u4e8b\u52a1\u7684\u8bb0\u5f55\uff0c\u6240\u4ee5 MySQL \u4f1a\u5728\u91cd\u542f\u540e\u56de\u6eda\u8be5\u7ec4\u4e8b\u52a1\u3002</p> <p>sync \u9636\u6bb5</p> <p>\u7eff\u8272\u8fd9\u4e00\u7ec4\u4e8b\u52a1\u7684 binlog \u5199\u5165\u5230 binlog \u6587\u4ef6\u540e\uff0c\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u6267\u884c\u5237\u76d8\u7684\u64cd\u4f5c\uff0c\u800c\u662f\u4f1a\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff0c\u8fd9\u4e2a\u7b49\u5f85\u7684\u65f6\u957f\u7531 <code>Binlog_group_commit_sync_delay</code> \u53c2\u6570\u63a7\u5236\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u7ec4\u5408\u66f4\u591a\u4e8b\u52a1\u7684 binlog\uff0c\u7136\u540e\u518d\u4e00\u8d77\u5237\u76d8\uff0c\u5982\u4e0b\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u4e0d\u8fc7\uff0c\u5728\u7b49\u5f85\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4e8b\u52a1\u7684\u6570\u91cf\u63d0\u524d\u8fbe\u5230\u4e86 <code>Binlog_group_commit_sync_no_delay_count</code> \u53c2\u6570\u8bbe\u7f6e\u7684\u503c\uff0c\u5c31\u4e0d\u7528\u7ee7\u7eed\u7b49\u5f85\u4e86\uff0c\u5c31\u9a6c\u4e0a\u5c06 binlog \u5237\u76d8\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u77e5\u9053 sync \u9636\u6bb5\u961f\u5217\u7684\u4f5c\u7528\u662f\u7528\u4e8e\u652f\u6301 binlog \u7684\u7ec4\u63d0\u4ea4\u3002</p> <p>\u5982\u679c\u60f3\u63d0\u5347 binlog \u7ec4\u63d0\u4ea4\u7684\u6548\u679c\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e\u4e0b\u9762\u8fd9\u4e24\u4e2a\u53c2\u6570\u6765\u5b9e\u73b0\uff1a</p> <ul> <li><code>binlog_group_commit_sync_delay= N</code>\uff0c\u8868\u793a\u5728\u7b49\u5f85 N \u5fae\u5999\u540e\uff0c\u76f4\u63a5\u8c03\u7528 fsync\uff0c\u5c06\u5904\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d page cache \u4e2d\u7684 binlog \u5237\u76d8\uff0c\u4e5f\u5c31\u662f\u5c06\u300cbinlog \u6587\u4ef6\u300d\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002</li> <li><code>binlog_group_commit_sync_no_delay_count = N</code>\uff0c\u8868\u793a\u5982\u679c\u961f\u5217\u4e2d\u7684\u4e8b\u52a1\u6570\u8fbe\u5230 N \u4e2a\uff0c\u5c31\u5ffd\u89c6 binlog_group_commit_sync_delay \u7684\u8bbe\u7f6e\uff0c\u76f4\u63a5\u8c03\u7528 fsync\uff0c\u5c06\u5904\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d page cache \u4e2d\u7684 binlog \u5237\u76d8\u3002</li> </ul> <p>\u5982\u679c\u5728\u8fd9\u4e00\u6b65\u5b8c\u6210\u540e\u6570\u636e\u5e93\u5d29\u6e83\uff0c\u7531\u4e8e binlog \u4e2d\u5df2\u7ecf\u6709\u4e86\u4e8b\u52a1\u8bb0\u5f55\uff0cMySQL \u4f1a\u5728\u91cd\u542f\u540e\u901a\u8fc7 redo log \u5237\u76d8\u7684\u6570\u636e\u7ee7\u7eed\u8fdb\u884c\u4e8b\u52a1\u7684\u63d0\u4ea4\u3002</p> <p>commit \u9636\u6bb5</p> <p>\u6700\u540e\u8fdb\u5165 commit \u9636\u6bb5\uff0c\u8c03\u7528\u5f15\u64ce\u7684\u63d0\u4ea4\u4e8b\u52a1\u63a5\u53e3\uff0c\u5c06 redo log \u72b6\u6001\u8bbe\u7f6e\u4e3a commit\u3002</p> <p></p> <p>commit \u9636\u6bb5\u961f\u5217\u7684\u4f5c\u7528\u662f\u627f\u63a5 sync \u9636\u6bb5\u7684\u4e8b\u52a1\uff0c\u5b8c\u6210\u6700\u540e\u7684\u5f15\u64ce\u63d0\u4ea4\uff0c\u4f7f\u5f97 sync \u53ef\u4ee5\u5c3d\u65e9\u7684\u5904\u7406\u4e0b\u4e00\u7ec4\u4e8b\u52a1\uff0c\u6700\u5927\u5316\u7ec4\u63d0\u4ea4\u7684\u6548\u7387\u3002</p>"},{"location":"mysql/log/how_update/#mysql-io","title":"MySQL \u78c1\u76d8 I/O \u5f88\u9ad8\uff0c\u6709\u4ec0\u4e48\u4f18\u5316\u7684\u65b9\u6cd5\uff1f","text":"<p>\u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e8b\u52a1\u5728\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u9700\u8981\u5c06 binlog \u548c redo log \u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u90a3\u4e48\u5982\u679c\u51fa\u73b0 MySQL \u78c1\u76d8 I/O \u5f88\u9ad8\u7684\u73b0\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u63a7\u5236\u4ee5\u4e0b\u53c2\u6570\uff0c\u6765\u201c\u5ef6\u8fdf\u201dbinlog \u548c redo log \u5237\u76d8\u7684\u65f6\u673a\uff0c\u4ece\u800c\u964d\u4f4e\u78c1\u76d8 I/O \u7684\u9891\u7387\uff1a</p> <ul> <li>\u8bbe\u7f6e\u7ec4\u63d0\u4ea4\u7684\u4e24\u4e2a\u53c2\u6570\uff1abinlog_group_commit_sync_delay \u548c binlog_group_commit_sync_no_delay_count \u53c2\u6570\uff0c\u5ef6\u8fdf binlog \u5237\u76d8\u7684\u65f6\u673a\uff0c\u4ece\u800c\u51cf\u5c11 binlog \u7684\u5237\u76d8\u6b21\u6570\u3002\u8fd9\u4e2a\u65b9\u6cd5\u662f\u57fa\u4e8e\u201c\u989d\u5916\u7684\u6545\u610f\u7b49\u5f85\u201d\u6765\u5b9e\u73b0\u7684\uff0c\u56e0\u6b64\u53ef\u80fd\u4f1a\u589e\u52a0\u8bed\u53e5\u7684\u54cd\u5e94\u65f6\u95f4\uff0c\u4f46\u5373\u4f7f MySQL \u8fdb\u7a0b\u4e2d\u9014\u6302\u4e86\uff0c\u4e5f\u6ca1\u6709\u4e22\u5931\u6570\u636e\u7684\u98ce\u9669\uff0c\u56e0\u4e3a binlog \u65e9\u88ab\u5199\u5165\u5230 page cache \u4e86\uff0c\u53ea\u8981\u7cfb\u7edf\u6ca1\u6709\u5b95\u673a\uff0c\u7f13\u5b58\u5728 page cache \u91cc\u7684 binlog \u5c31\u4f1a\u88ab\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002</li> <li>\u5c06 sync_binlog \u8bbe\u7f6e\u4e3a\u5927\u4e8e 1 \u7684\u503c\uff08\u6bd4\u8f83\u5e38\u89c1\u662f 100~1000\uff09\uff0c\u8868\u793a\u6bcf\u6b21\u63d0\u4ea4\u4e8b\u52a1\u90fd write\uff0c\u4f46\u7d2f\u79ef N \u4e2a\u4e8b\u52a1\u540e\u624d fsync\uff0c\u76f8\u5f53\u4e8e\u5ef6\u8fdf\u4e86 binlog \u5237\u76d8\u7684\u65f6\u673a\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u98ce\u9669\u662f\uff0c\u4e3b\u673a\u6389\u7535\u65f6\u4f1a\u4e22 N \u4e2a\u4e8b\u52a1\u7684 binlog \u65e5\u5fd7\u3002</li> <li>\u5c06 innodb_flush_log_at_trx_commit \u8bbe\u7f6e\u4e3a 2\u3002\u8868\u793a\u6bcf\u6b21\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u90fd\u53ea\u662f\u7f13\u5b58\u5728  redo log buffer \u91cc\u7684  redo log \u5199\u5230 redo log \u6587\u4ef6\uff0c\u6ce8\u610f\u5199\u5165\u5230\u300credo log \u6587\u4ef6\u300d\u5e76\u4e0d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u78c1\u76d8\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6709\u4e2a Page Cache\uff0c\u4e13\u95e8\u7528\u6765\u7f13\u5b58\u6587\u4ef6\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5199\u5165\u300credo log \u6587\u4ef6\u300d\u610f\u5473\u7740\u5199\u5165\u5230\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u6587\u4ef6\u7f13\u5b58\uff0c\u7136\u540e\u4ea4\u7531\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u6301\u4e45\u5316\u5230\u78c1\u76d8\u7684\u65f6\u673a\u3002\u4f46\u662f\u8fd9\u6837\u505a\u7684\u98ce\u9669\u662f\uff0c\u4e3b\u673a\u6389\u7535\u7684\u65f6\u5019\u4f1a\u4e22\u6570\u636e\u3002</li> </ul>"},{"location":"mysql/log/how_update/#_7","title":"\u603b\u7ed3","text":"<p>\u5177\u4f53\u66f4\u65b0\u4e00\u6761\u8bb0\u5f55 <code>UPDATE t_user SET name = 'xiaolin' WHERE id = 1;</code> \u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u6267\u884c\u5668\u8d1f\u8d23\u5177\u4f53\u6267\u884c\uff0c\u4f1a\u8c03\u7528\u5b58\u50a8\u5f15\u64ce\u7684\u63a5\u53e3\uff0c\u901a\u8fc7\u4e3b\u952e\u7d22\u5f15\u6811\u641c\u7d22\u83b7\u53d6 id = 1 \u8fd9\u4e00\u884c\u8bb0\u5f55\uff1a</li> <li>\u5982\u679c id=1 \u8fd9\u4e00\u884c\u6240\u5728\u7684\u6570\u636e\u9875\u672c\u6765\u5c31\u5728 buffer pool \u4e2d\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u7ed9\u6267\u884c\u5668\u66f4\u65b0\uff1b</li> <li>\u5982\u679c\u8bb0\u5f55\u4e0d\u5728 buffer pool\uff0c\u5c06\u6570\u636e\u9875\u4ece\u78c1\u76d8\u8bfb\u5165\u5230 buffer pool\uff0c\u8fd4\u56de\u8bb0\u5f55\u7ed9\u6267\u884c\u5668\u3002</li> <li>\u6267\u884c\u5668\u5f97\u5230\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u540e\uff0c\u4f1a\u770b\u4e00\u4e0b\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u662f\u5426\u4e00\u6837\uff1a</li> <li>\u5982\u679c\u4e00\u6837\u7684\u8bdd\u5c31\u4e0d\u8fdb\u884c\u540e\u7eed\u66f4\u65b0\u6d41\u7a0b\uff1b</li> <li>\u5982\u679c\u4e0d\u4e00\u6837\u7684\u8bdd\u5c31\u628a\u66f4\u65b0\u524d\u7684\u8bb0\u5f55\u548c\u66f4\u65b0\u540e\u7684\u8bb0\u5f55\u90fd\u5f53\u4f5c\u53c2\u6570\u4f20\u7ed9 InnoDB \u5c42\uff0c\u8ba9 InnoDB \u771f\u6b63\u7684\u6267\u884c\u66f4\u65b0\u8bb0\u5f55\u7684\u64cd\u4f5c\uff1b</li> <li>\u5f00\u542f\u4e8b\u52a1\uff0cInnoDB \u5c42\u66f4\u65b0\u8bb0\u5f55\u524d\uff0c\u9996\u5148\u8981\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u56e0\u4e3a\u8fd9\u662f\u66f4\u65b0\u64cd\u4f5c\uff0c\u9700\u8981\u628a\u88ab\u66f4\u65b0\u7684\u5217\u7684\u65e7\u503c\u8bb0\u4e0b\u6765\uff0c\u4e5f\u5c31\u662f\u8981\u751f\u6210\u4e00\u6761 undo log\uff0cundo log \u4f1a\u5199\u5165 Buffer Pool \u4e2d\u7684 Undo \u9875\u9762\uff0c\u4e0d\u8fc7\u5728\u5185\u5b58\u4fee\u6539\u8be5 Undo \u9875\u9762\u540e\uff0c\u9700\u8981\u8bb0\u5f55\u5bf9\u5e94\u7684 redo log\u3002</li> <li>InnoDB \u5c42\u5f00\u59cb\u66f4\u65b0\u8bb0\u5f55\uff0c\u5148\u751f\u6210\u5bf9\u5e94redo log\uff0c\u5e76\u5b58\u5165redo log buffer\u91cc\u9762\uff0c\u5f53\u4e8b\u52a1\u63d0\u4ea4\u65f6\uff0c\u5c06redo log\u5199\u5165redo log file\uff0c\u5e76\u66f4\u65b0buffer pool\u4e2d\u7684\u6570\u636e\u9875\uff0c\u5c06\u5176\u653e\u5165flush \u94fe\u8868\u5e76\u6807\u8bb0\u810f\u9875\u548c\u8bb0\u5f55redo log\u5bf9\u5e94\u7684lsn\u5230\u8be5\u9875\u7684oldest_modification\uff0c\u8fd9\u4e2a\u65f6\u5019\u66f4\u65b0\u5c31\u7b97\u5b8c\u6210\u4e86\u3002\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8 I/O\uff0c\u4e0d\u4f1a\u7acb\u5373\u5c06\u810f\u9875\u5199\u5165\u78c1\u76d8\uff0c\u540e\u7eed\u7531\u540e\u53f0\u7ebf\u7a0b\u9009\u62e9\u4e00\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002\u8fd9\u5c31\u662f WAL \u6280\u672f\uff0cMySQL \u7684\u5199\u64cd\u4f5c\u5e76\u4e0d\u662f\u7acb\u523b\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u800c\u662f\u5148\u5199 redo \u65e5\u5fd7\uff0c\u7136\u540e\u5728\u5408\u9002\u7684\u65f6\u95f4\u518d\u5c06\u4fee\u6539\u7684\u884c\u6570\u636e\u5199\u5230\u78c1\u76d8\u4e0a\u3002</li> <li>\u81f3\u6b64\uff0c\u4e00\u6761\u8bb0\u5f55\u66f4\u65b0\u5b8c\u4e86\u3002</li> <li>\u5728\u4e00\u6761\u66f4\u65b0\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u540e\uff0c\u7136\u540e\u5f00\u59cb\u8bb0\u5f55\u8be5\u8bed\u53e5\u5bf9\u5e94\u7684 binlog\uff0c\u6b64\u65f6\u8bb0\u5f55\u7684 binlog \u4f1a\u88ab\u4fdd\u5b58\u5230 binlog cache\uff0c\u5e76\u6ca1\u6709\u5237\u65b0\u5230\u786c\u76d8\u4e0a\u7684 binlog \u6587\u4ef6\uff0c\u5728\u4e8b\u52a1\u63d0\u4ea4\u65f6\u624d\u4f1a\u7edf\u4e00\u5c06\u8be5\u4e8b\u52a1\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u6240\u6709 binlog \u5237\u65b0\u5230\u786c\u76d8\u3002</li> <li>\u4e8b\u52a1\u63d0\u4ea4\uff08\u4e3a\u4e86\u65b9\u4fbf\u8bf4\u660e\uff0c\u8fd9\u91cc\u4e0d\u8bf4\u7ec4\u63d0\u4ea4\u7684\u8fc7\u7a0b\uff0c\u53ea\u8bf4\u4e24\u9636\u6bb5\u63d0\u4ea4\uff09\uff1a</li> <li>prepare \u9636\u6bb5\uff1a\u5c06 redo log \u5bf9\u5e94\u7684\u4e8b\u52a1\u72b6\u6001\u8bbe\u7f6e\u4e3a prepare\uff0c\u7136\u540e\u5c06 redo log \u5237\u65b0\u5230\u786c\u76d8\uff1b</li> <li>commit \u9636\u6bb5\uff1a\u5c06 binlog \u5237\u65b0\u5230\u78c1\u76d8\uff0c\u63a5\u7740\u8c03\u7528\u5f15\u64ce\u7684\u63d0\u4ea4\u4e8b\u52a1\u63a5\u53e3\uff0c\u5c06 redo log \u72b6\u6001\u8bbe\u7f6e\u4e3a commit\uff08\u5c06\u4e8b\u52a1\u8bbe\u7f6e\u4e3a commit \u72b6\u6001\u540e\uff0c\u5237\u5165\u5230\u78c1\u76d8 redo log \u6587\u4ef6\uff09\uff1b</li> <li>\u81f3\u6b64\uff0c\u4e00\u6761\u66f4\u65b0\u8bed\u53e5\u6267\u884c\u5b8c\u6210\u3002</li> </ol> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u300aMySQL 45 \u8bb2\u300b</li> <li>\u300aMySQL \u662f\u600e\u6837\u8fd0\u884c\u7684\uff1f\u300b</li> <li>https://developer.aliyun.com/article/617776</li> <li>http://mysql.taobao.org/monthly/2021/10/01/</li> <li>https://www.cnblogs.com/Neeo/articles/13883976.html</li> <li>https://www.cnblogs.com/mengxinJ/p/14211427.html</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/transaction/mvcc/","title":"\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f","text":"<p>\u8fd9\u662f\u6211\u7684\u94b1\u5305\uff0c\u5171\u6709 100 \u4e07\u5143\u3002</p> <p></p> <p>\u4eca\u5929\u6211\u5fc3\u60c5\u597d\uff0c\u6211\u51b3\u5b9a\u7ed9\u4f60\u7684\u8f6c\u8d26 100 \u4e07\uff0c\u6700\u540e\u7684\u7ed3\u679c\u80af\u5b9a\u662f\u6211\u7684\u4f59\u989d\u53d8\u4e3a 0 \u5143\uff0c\u4f60\u7684\u4f59\u989d\u591a\u4e86 100 \u4e07\u5143\uff0c\u662f\u4e0d\u662f\u60f3\u5230\u5c31\u5f88\u5f00\u5fc3\uff1f</p> <p>\u8f6c\u8d26\u8fd9\u4e00\u52a8\u4f5c\u5728\u7a0b\u5e8f\u91cc\u4f1a\u6d89\u53ca\u5230\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\uff0c\u5047\u8bbe\u6211\u5411\u4f60\u8f6c\u8d26 100 \u4e07\u7684\u8fc7\u7a0b\u662f\u6709\u4e0b\u9762\u8fd9\u51e0\u4e2a\u6b65\u9aa4\u7ec4\u6210\u7684\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u8f6c\u8d26\u7684\u8fc7\u7a0b\u6d89\u53ca\u5230\u4e86\u4e24\u6b21\u4fee\u6539\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u3002</p> <p>\u5047\u8bbe\u5728\u6267\u884c\u7b2c\u4e09\u6b65\u9aa4\u4e4b\u540e\uff0c\u670d\u52a1\u5668\u5ffd\u7136\u6389\u7535\u4e86\uff0c\u5c31\u4f1a\u53d1\u751f\u4e00\u4e2a\u86cb\u75bc\u7684\u4e8b\u60c5\uff0c\u6211\u7684\u8d26\u6237\u6263\u4e86 100 \u4e07\uff0c\u4f46\u662f\u94b1\u5e76\u6ca1\u6709\u5230\u4f60\u7684\u8d26\u6237\u4e0a\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9 100 \u4e07\u6d88\u5931\u4e86\uff01</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u8981\u4fdd\u8bc1\u8f6c\u8d26\u4e1a\u52a1\u91cc\u7684\u6240\u6709\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u662f\u4e0d\u53ef\u5206\u5272\u7684\uff0c\u8981\u4e48\u5168\u90e8\u6267\u884c\u6210\u529f\uff0c\u8981\u4e48\u5168\u90e8\u5931\u8d25\uff0c\u4e0d\u5141\u8bb8\u51fa\u73b0\u4e2d\u95f4\u72b6\u6001\u7684\u6570\u636e\u3002</p> <p>\u6570\u636e\u5e93\u4e2d\u7684\u300c\u4e8b\u52a1\uff08Transaction\uff09\u300d\u5c31\u80fd\u8fbe\u5230\u8fd9\u6837\u7684\u6548\u679c\u3002</p> <p>\u6211\u4eec\u5728\u8f6c\u8d26\u64cd\u4f5c\u524d\u5148\u5f00\u542f\u4e8b\u52a1\uff0c\u7b49\u6240\u6709\u6570\u636e\u5e93\u64cd\u4f5c\u6267\u884c\u5b8c\u6210\u540e\uff0c\u624d\u63d0\u4ea4\u4e8b\u52a1\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u8be5\u4e8b\u52a1\u5bf9\u6570\u636e\u5e93\u6240\u505a\u7684\u4fee\u6539\u5c06\u6c38\u4e45\u751f\u6548\uff0c\u5982\u679c\u4e2d\u9014\u53d1\u751f\u53d1\u751f\u4e2d\u65ad\u6216\u9519\u8bef\uff0c\u90a3\u4e48\u8be5\u4e8b\u52a1\u671f\u95f4\u5bf9\u6570\u636e\u5e93\u6240\u505a\u7684\u4fee\u6539\u5c06\u4f1a\u88ab\u56de\u6eda\u5230\u6ca1\u6267\u884c\u8be5\u4e8b\u52a1\u4e4b\u524d\u7684\u72b6\u6001\u3002</p> <p>\u6ca1\u9519\uff0c\u4eca\u5929\u5c31\u6765\u56fe\u89e3 MySQL \u4e8b\u52a1\u5566\uff0c\u5f00\u8f66\uff01</p> <p></p>"},{"location":"mysql/transaction/mvcc/#_2","title":"\u4e8b\u52a1\u6709\u54ea\u4e9b\u7279\u6027\uff1f","text":"<p>\u4e8b\u52a1\u662f\u7531 MySQL \u7684\u5f15\u64ce\u6765\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u5e38\u89c1\u7684 InnoDB \u5f15\u64ce\u5b83\u662f\u652f\u6301\u4e8b\u52a1\u7684\u3002</p> <p>\u4e0d\u8fc7\u5e76\u4e0d\u662f\u6240\u6709\u7684\u5f15\u64ce\u90fd\u80fd\u652f\u6301\u4e8b\u52a1\uff0c\u6bd4\u5982 MySQL \u539f\u751f\u7684 MyISAM \u5f15\u64ce\u5c31\u4e0d\u652f\u6301\u4e8b\u52a1\uff0c\u4e5f\u6b63\u662f\u8fd9\u6837\uff0c\u6240\u4ee5\u5927\u591a\u6570 MySQL \u7684\u5f15\u64ce\u90fd\u662f\u7528 InnoDB\u3002</p> <p>\u4e8b\u52a1\u770b\u8d77\u6765\u611f\u89c9\u7b80\u5355\uff0c\u4f46\u662f\u8981\u5b9e\u73b0\u4e8b\u52a1\u5fc5\u987b\u8981\u9075\u5b88 4 \u4e2a\u7279\u6027\uff0c\u5206\u522b\u5982\u4e0b\uff1a</p> <ul> <li>\u539f\u5b50\u6027\uff08Atomicity\uff09\uff1a\u4e00\u4e2a\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\uff0c\u8981\u4e48\u5168\u90e8\u5b8c\u6210\uff0c\u8981\u4e48\u5168\u90e8\u4e0d\u5b8c\u6210\uff0c\u4e0d\u4f1a\u7ed3\u675f\u5728\u4e2d\u95f4\u67d0\u4e2a\u73af\u8282\uff0c\u800c\u4e14\u4e8b\u52a1\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u9519\u8bef\uff0c\u4f1a\u88ab\u56de\u6eda\u5230\u4e8b\u52a1\u5f00\u59cb\u524d\u7684\u72b6\u6001\uff0c\u5c31\u50cf\u8fd9\u4e2a\u4e8b\u52a1\u4ece\u6765\u6ca1\u6709\u6267\u884c\u8fc7\u4e00\u6837\uff0c\u5c31\u597d\u6bd4\u4e70\u4e00\u4ef6\u5546\u54c1\uff0c\u8d2d\u4e70\u6210\u529f\u65f6\uff0c\u5219\u7ed9\u5546\u5bb6\u4ed8\u4e86\u94b1\uff0c\u5546\u54c1\u5230\u624b\uff1b\u8d2d\u4e70\u5931\u8d25\u65f6\uff0c\u5219\u5546\u54c1\u5728\u5546\u5bb6\u624b\u4e2d\uff0c\u6d88\u8d39\u8005\u7684\u94b1\u4e5f\u6ca1\u82b1\u51fa\u53bb\u3002</li> <li>\u4e00\u81f4\u6027\uff08Consistency\uff09\uff1a\u662f\u6307\u4e8b\u52a1\u64cd\u4f5c\u524d\u548c\u64cd\u4f5c\u540e\uff0c\u6570\u636e\u6ee1\u8db3\u5b8c\u6574\u6027\u7ea6\u675f\uff0c\u6570\u636e\u5e93\u4fdd\u6301\u4e00\u81f4\u6027\u72b6\u6001\u3002\u6bd4\u5982\uff0c\u7528\u6237 A \u548c\u7528\u6237 B \u5728\u94f6\u884c\u5206\u522b\u6709 800 \u5143\u548c 600 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u7528\u6237 A \u7ed9\u7528\u6237 B \u8f6c\u8d26 200 \u5143\uff0c\u5206\u4e3a\u4e24\u4e2a\u6b65\u9aa4\uff0c\u4ece A \u7684\u8d26\u6237\u6263\u9664 200 \u5143\u548c\u5bf9 B \u7684\u8d26\u6237\u589e\u52a0 200 \u5143\u3002\u4e00\u81f4\u6027\u5c31\u662f\u8981\u6c42\u4e0a\u8ff0\u6b65\u9aa4\u64cd\u4f5c\u540e\uff0c\u6700\u540e\u7684\u7ed3\u679c\u662f\u7528\u6237 A \u8fd8\u6709 600 \u5143\uff0c\u7528\u6237 B \u6709 800 \u5143\uff0c\u603b\u5171 1400 \u5143\uff0c\u800c\u4e0d\u4f1a\u51fa\u73b0\u7528\u6237 A \u6263\u9664\u4e86 200 \u5143\uff0c\u4f46\u7528\u6237 B \u672a\u589e\u52a0\u7684\u60c5\u51b5\uff08\u8be5\u60c5\u51b5\uff0c\u7528\u6237 A \u548c B \u5747\u4e3a 600 \u5143\uff0c\u603b\u5171 1200 \u5143\uff09\u3002</li> <li>\u9694\u79bb\u6027\uff08Isolation\uff09\uff1a\u6570\u636e\u5e93\u5141\u8bb8\u591a\u4e2a\u5e76\u53d1\u4e8b\u52a1\u540c\u65f6\u5bf9\u5176\u6570\u636e\u8fdb\u884c\u8bfb\u5199\u548c\u4fee\u6539\u7684\u80fd\u529b\uff0c\u9694\u79bb\u6027\u53ef\u4ee5\u9632\u6b62\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u7531\u4e8e\u4ea4\u53c9\u6267\u884c\u800c\u5bfc\u81f4\u6570\u636e\u7684\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u591a\u4e2a\u4e8b\u52a1\u540c\u65f6\u4f7f\u7528\u76f8\u540c\u7684\u6570\u636e\u65f6\uff0c\u4e0d\u4f1a\u76f8\u4e92\u5e72\u6270\uff0c\u6bcf\u4e2a\u4e8b\u52a1\u90fd\u6709\u4e00\u4e2a\u5b8c\u6574\u7684\u6570\u636e\u7a7a\u95f4\uff0c\u5bf9\u5176\u4ed6\u5e76\u53d1\u4e8b\u52a1\u662f\u9694\u79bb\u7684\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6d88\u8d39\u8005\u8d2d\u4e70\u5546\u54c1\u8fd9\u4e2a\u4e8b\u52a1\uff0c\u662f\u4e0d\u5f71\u54cd\u5176\u4ed6\u6d88\u8d39\u8005\u8d2d\u4e70\u7684\u3002</li> <li>\u6301\u4e45\u6027\uff08Durability\uff09\uff1a\u4e8b\u52a1\u5904\u7406\u7ed3\u675f\u540e\uff0c\u5bf9\u6570\u636e\u7684\u4fee\u6539\u5c31\u662f\u6c38\u4e45\u7684\uff0c\u5373\u4fbf\u7cfb\u7edf\u6545\u969c\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002</li> </ul> <p>InnoDB \u5f15\u64ce\u901a\u8fc7\u4ec0\u4e48\u6280\u672f\u6765\u4fdd\u8bc1\u4e8b\u52a1\u7684\u8fd9\u56db\u4e2a\u7279\u6027\u7684\u5462\uff1f</p> <ul> <li>\u6301\u4e45\u6027\u662f\u901a\u8fc7 redo log\uff08\u91cd\u505a\u65e5\u5fd7\uff09\u6765\u4fdd\u8bc1\u7684\uff1b</li> <li>\u539f\u5b50\u6027\u662f\u901a\u8fc7 undo log\uff08\u56de\u6eda\u65e5\u5fd7\uff09\u6765\u4fdd\u8bc1\u7684\uff1b</li> <li>\u9694\u79bb\u6027\u662f\u901a\u8fc7 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u6216\u9501\u673a\u5236\u6765\u4fdd\u8bc1\u7684\uff1b </li> <li>\u4e00\u81f4\u6027\u5219\u662f\u901a\u8fc7\u6301\u4e45\u6027 + \u539f\u5b50\u6027 + \u9694\u79bb\u6027\u6765\u4fdd\u8bc1\uff1b</li> </ul> <p>\u8fd9\u6b21\u5c06\u91cd\u70b9\u4ecb\u7ecd\u4e8b\u52a1\u7684\u9694\u79bb\u6027\uff0c\u8fd9\u4e5f\u662f\u9762\u8bd5\u65f6\u6700\u5e38\u95ee\u7684\u77e5\u8bc6\u7684\u70b9\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e8b\u52a1\u8981\u6709\u9694\u79bb\u6027\uff0c\u6211\u4eec\u5c31\u8981\u77e5\u9053\u5e76\u53d1\u4e8b\u52a1\u65f6\u4f1a\u5f15\u53d1\u4ec0\u4e48\u95ee\u9898\u3002</p>"},{"location":"mysql/transaction/mvcc/#_3","title":"\u5e76\u884c\u4e8b\u52a1\u4f1a\u5f15\u53d1\u4ec0\u4e48\u95ee\u9898\uff1f","text":"<p>MySQL \u670d\u52a1\u7aef\u662f\u5141\u8bb8\u591a\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\uff0c\u8fd9\u610f\u5473\u7740 MySQL \u4f1a\u51fa\u73b0\u540c\u65f6\u5904\u7406\u591a\u4e2a\u4e8b\u52a1\u7684\u60c5\u51b5\u3002</p> <p>\u90a3\u4e48\u5728\u540c\u65f6\u5904\u7406\u591a\u4e2a\u4e8b\u52a1\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u80fd\u51fa\u73b0\u810f\u8bfb\uff08dirty read\uff09\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\uff08non-repeatable read\uff09\u3001\u5e7b\u8bfb\uff08phantom read\uff09\u7684\u95ee\u9898\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u4e3e\u4f8b\u5b50\u7ed9\u5927\u5bb6\u8bf4\u660e\uff0c\u8fd9\u4e9b\u95ee\u9898\u662f\u5982\u4f55\u53d1\u751f\u7684\u3002</p>"},{"location":"mysql/transaction/mvcc/#_4","title":"\u810f\u8bfb","text":"<p>\u5982\u679c\u4e00\u4e2a\u4e8b\u52a1\u300c\u8bfb\u5230\u300d\u4e86\u53e6\u4e00\u4e2a\u300c\u672a\u63d0\u4ea4\u4e8b\u52a1\u4fee\u6539\u8fc7\u7684\u6570\u636e\u300d\uff0c\u5c31\u610f\u5473\u7740\u53d1\u751f\u4e86\u300c\u810f\u8bfb\u300d\u73b0\u8c61\u3002</p> <p>\u4e3e\u4e2a\u6817\u5b50\u3002</p> <p>\u5047\u8bbe\u6709 A \u548c B \u8fd9\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u5904\u7406\uff0c\u4e8b\u52a1 A \u5148\u5f00\u59cb\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5c0f\u6797\u7684\u4f59\u989d\u6570\u636e\uff0c\u7136\u540e\u518d\u6267\u884c\u66f4\u65b0\u64cd\u4f5c\uff0c\u5982\u679c\u6b64\u65f6\u4e8b\u52a1 A \u8fd8\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff0c\u800c\u6b64\u65f6\u6b63\u597d\u4e8b\u52a1 B \u4e5f\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5c0f\u6797\u7684\u4f59\u989d\u6570\u636e\uff0c\u90a3\u4e48\u4e8b\u52a1 B \u8bfb\u53d6\u5230\u7684\u4f59\u989d\u6570\u636e\u662f\u521a\u624d\u4e8b\u52a1 A \u66f4\u65b0\u540e\u7684\u6570\u636e\uff0c\u5373\u4f7f\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\u3002</p> <p></p> <p>\u56e0\u4e3a\u4e8b\u52a1 A \u662f\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\u7684\uff0c\u4e5f\u5c31\u662f\u5b83\u968f\u65f6\u53ef\u80fd\u53d1\u751f\u56de\u6eda\u64cd\u4f5c\uff0c\u5982\u679c\u5728\u4e0a\u9762\u8fd9\u79cd\u60c5\u51b5\u4e8b\u52a1 A \u53d1\u751f\u4e86\u56de\u6eda\uff0c\u90a3\u4e48\u4e8b\u52a1 B \u521a\u624d\u5f97\u5230\u7684\u6570\u636e\u5c31\u662f\u8fc7\u671f\u7684\u6570\u636e\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u88ab\u79f0\u4e3a\u810f\u8bfb\u3002</p>"},{"location":"mysql/transaction/mvcc/#_5","title":"\u4e0d\u53ef\u91cd\u590d\u8bfb","text":"<p>\u5728\u4e00\u4e2a\u4e8b\u52a1\u5185\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u4e2a\u6570\u636e\uff0c\u5982\u679c\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u8bfb\u5230\u7684\u6570\u636e\u4e0d\u4e00\u6837\u7684\u60c5\u51b5\uff0c\u5c31\u610f\u5473\u7740\u53d1\u751f\u4e86\u300c\u4e0d\u53ef\u91cd\u590d\u8bfb\u300d\u73b0\u8c61\u3002</p> <p>\u4e3e\u4e2a\u6817\u5b50\u3002</p> <p>\u5047\u8bbe\u6709 A \u548c B \u8fd9\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u5904\u7406\uff0c\u4e8b\u52a1 A \u5148\u5f00\u59cb\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5c0f\u6797\u7684\u4f59\u989d\u6570\u636e\uff0c\u7136\u540e\u7ee7\u7eed\u6267\u884c\u4ee3\u7801\u903b\u8f91\u5904\u7406\uff0c\u5728\u8fd9\u8fc7\u7a0b\u4e2d\u5982\u679c\u4e8b\u52a1 B \u66f4\u65b0\u4e86\u8fd9\u6761\u6570\u636e\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u90a3\u4e48\u5f53\u4e8b\u52a1 A \u518d\u6b21\u8bfb\u53d6\u8be5\u6570\u636e\u65f6\uff0c\u5c31\u4f1a\u53d1\u73b0\u524d\u540e\u4e24\u6b21\u8bfb\u5230\u7684\u6570\u636e\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u88ab\u79f0\u4e3a\u4e0d\u53ef\u91cd\u590d\u8bfb\u3002</p> <p></p>"},{"location":"mysql/transaction/mvcc/#_6","title":"\u5e7b\u8bfb","text":"<p>\u5728\u4e00\u4e2a\u4e8b\u52a1\u5185\u591a\u6b21\u67e5\u8be2\u67d0\u4e2a\u7b26\u5408\u67e5\u8be2\u6761\u4ef6\u7684\u300c\u8bb0\u5f55\u6570\u91cf\u300d\uff0c\u5982\u679c\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u5230\u7684\u8bb0\u5f55\u6570\u91cf\u4e0d\u4e00\u6837\u7684\u60c5\u51b5\uff0c\u5c31\u610f\u5473\u7740\u53d1\u751f\u4e86\u300c\u5e7b\u8bfb\u300d\u73b0\u8c61\u3002</p> <p>\u4e3e\u4e2a\u6817\u5b50\u3002</p> <p>\u5047\u8bbe\u6709 A \u548c B \u8fd9\u4e24\u4e2a\u4e8b\u52a1\u540c\u65f6\u5728\u5904\u7406\uff0c\u4e8b\u52a1 A \u5148\u5f00\u59cb\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u8d26\u6237\u4f59\u989d\u5927\u4e8e 100 \u4e07\u7684\u8bb0\u5f55\uff0c\u53d1\u73b0\u5171\u6709 5 \u6761\uff0c\u7136\u540e\u4e8b\u52a1 B \u4e5f\u6309\u76f8\u540c\u7684\u641c\u7d22\u6761\u4ef6\u4e5f\u662f\u67e5\u8be2\u51fa\u4e86 5 \u6761\u8bb0\u5f55\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u4e8b\u52a1 A \u63d2\u5165\u4e86\u4e00\u6761\u4f59\u989d\u8d85\u8fc7 100 \u4e07\u7684\u8d26\u53f7\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u6b64\u65f6\u6570\u636e\u5e93\u8d85\u8fc7 100 \u4e07\u4f59\u989d\u7684\u8d26\u53f7\u4e2a\u6570\u5c31\u53d8\u4e3a 6\u3002</p> <p>\u7136\u540e\u4e8b\u52a1 B \u518d\u6b21\u67e5\u8be2\u8d26\u6237\u4f59\u989d\u5927\u4e8e 100 \u4e07\u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u67e5\u8be2\u5230\u7684\u8bb0\u5f55\u6570\u91cf\u6709 6 \u6761\uff0c\u53d1\u73b0\u548c\u524d\u4e00\u6b21\u8bfb\u5230\u7684\u8bb0\u5f55\u6570\u91cf\u4e0d\u4e00\u6837\u4e86\uff0c\u5c31\u611f\u89c9\u53d1\u751f\u4e86\u5e7b\u89c9\u4e00\u6837\uff0c\u8fd9\u79cd\u73b0\u8c61\u5c31\u88ab\u79f0\u4e3a\u5e7b\u8bfb\u3002</p>"},{"location":"mysql/transaction/mvcc/#_7","title":"\u4e8b\u52a1\u7684\u9694\u79bb\u7ea7\u522b\u6709\u54ea\u4e9b\uff1f","text":"<p>\u524d\u9762\u6211\u4eec\u63d0\u5230\uff0c\u5f53\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u65f6\u53ef\u80fd\u4f1a\u9047\u5230\u300c\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u300d\u7684\u73b0\u8c61\uff0c\u8fd9\u4e9b\u73b0\u8c61\u4f1a\u5bf9\u4e8b\u52a1\u7684\u4e00\u81f4\u6027\u4ea7\u751f\u4e0d\u540c\u7a0b\u5ea6\u7684\u5f71\u54cd\u3002</p> <ul> <li>\u810f\u8bfb\uff1a\u8bfb\u5230\u5176\u4ed6\u4e8b\u52a1\u672a\u63d0\u4ea4\u7684\u6570\u636e\uff1b</li> <li>\u4e0d\u53ef\u91cd\u590d\u8bfb\uff1a\u524d\u540e\u8bfb\u53d6\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff1b </li> <li>\u5e7b\u8bfb\uff1a\u524d\u540e\u8bfb\u53d6\u7684\u8bb0\u5f55\u6570\u91cf\u4e0d\u4e00\u81f4\u3002</li> </ul> <p>\u8fd9\u4e09\u4e2a\u73b0\u8c61\u7684\u4e25\u91cd\u6027\u6392\u5e8f\u5982\u4e0b\uff1a</p> <p></p> <p>SQL \u6807\u51c6\u63d0\u51fa\u4e86\u56db\u79cd\u9694\u79bb\u7ea7\u522b\u6765\u89c4\u907f\u8fd9\u4e9b\u73b0\u8c61\uff0c\u9694\u79bb\u7ea7\u522b\u8d8a\u9ad8\uff0c\u6027\u80fd\u6548\u7387\u5c31\u8d8a\u4f4e\uff0c\u8fd9\u56db\u4e2a\u9694\u79bb\u7ea7\u522b\u5982\u4e0b\uff1a</p> <ul> <li>\u8bfb\u672a\u63d0\u4ea4\uff08read uncommitted\uff09\uff0c\u6307\u4e00\u4e2a\u4e8b\u52a1\u8fd8\u6ca1\u63d0\u4ea4\u65f6\uff0c\u5b83\u505a\u7684\u53d8\u66f4\u5c31\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u770b\u5230\uff1b</li> <li>\u8bfb\u63d0\u4ea4\uff08read committed\uff09\uff0c\u6307\u4e00\u4e2a\u4e8b\u52a1\u63d0\u4ea4\u4e4b\u540e\uff0c\u5b83\u505a\u7684\u53d8\u66f4\u624d\u80fd\u88ab\u5176\u4ed6\u4e8b\u52a1\u770b\u5230\uff1b</li> <li>\u53ef\u91cd\u590d\u8bfb\uff08repeatable read\uff09\uff0c\u6307\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0cMySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\uff1b</li> <li>\u4e32\u884c\u5316\uff08serializable \uff09\uff1b\u4f1a\u5bf9\u8bb0\u5f55\u52a0\u4e0a\u8bfb\u5199\u9501\uff0c\u5728\u591a\u4e2a\u4e8b\u52a1\u5bf9\u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u65f6\uff0c\u5982\u679c\u53d1\u751f\u4e86\u8bfb\u5199\u51b2\u7a81\u7684\u65f6\u5019\uff0c\u540e\u8bbf\u95ee\u7684\u4e8b\u52a1\u5fc5\u987b\u7b49\u524d\u4e00\u4e2a\u4e8b\u52a1\u6267\u884c\u5b8c\u6210\uff0c\u624d\u80fd\u7ee7\u7eed\u6267\u884c\uff1b</li> </ul> <p>\u6309\u9694\u79bb\u6c34\u5e73\u9ad8\u4f4e\u6392\u5e8f\u5982\u4e0b\uff1a</p> <p></p> <p>\u9488\u5bf9\u4e0d\u540c\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u5e76\u53d1\u4e8b\u52a1\u65f6\u53ef\u80fd\u53d1\u751f\u7684\u73b0\u8c61\u4e5f\u4f1a\u4e0d\u540c\u3002</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff1a</p> <ul> <li>\u5728\u300c\u8bfb\u672a\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u80fd\u53d1\u751f\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u73b0\u8c61\uff1b</li> <li>\u5728\u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u80fd\u53d1\u751f\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4f46\u662f\u4e0d\u53ef\u80fd\u53d1\u751f\u810f\u8bfb\u73b0\u8c61\uff1b</li> <li>\u5728\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u80fd\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4f46\u662f\u4e0d\u53ef\u80fd\u53d1\u751f\u810f\u8bfb\u548c\u4e0d\u53ef\u91cd\u590d\u8bfb\u73b0\u8c61\uff1b</li> <li>\u5728\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u548c\u5e7b\u8bfb\u73b0\u8c61\u90fd\u4e0d\u53ef\u80fd\u4f1a\u53d1\u751f\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u8981\u89e3\u51b3\u810f\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5347\u7ea7\u5230\u300c\u8bfb\u63d0\u4ea4\u300d\u4ee5\u4e0a\u7684\u9694\u79bb\u7ea7\u522b\uff1b\u8981\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5347\u7ea7\u5230\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u8981\u89e3\u51b3\u5e7b\u8bfb\u73b0\u8c61\u4e0d\u5efa\u8bae\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u5230\u300c\u4e32\u884c\u5316\u300d\u3002</p> <p>\u4e0d\u540c\u7684\u6570\u636e\u5e93\u5382\u5546\u5bf9 SQL \u6807\u51c6\u4e2d\u89c4\u5b9a\u7684 4 \u79cd\u9694\u79bb\u7ea7\u522b\u7684\u652f\u6301\u4e0d\u4e00\u6837\uff0c\u6709\u7684\u6570\u636e\u5e93\u53ea\u5b9e\u73b0\u4e86\u5176\u4e2d\u51e0\u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u6211\u4eec\u8ba8\u8bba\u7684 MySQL \u867d\u7136\u652f\u6301 4 \u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u4f46\u662f\u4e0e SQL \u6807\u51c6\u4e2d\u89c4\u5b9a\u7684\u5404\u7ea7\u9694\u79bb\u7ea7\u522b\u5141\u8bb8\u53d1\u751f\u7684\u73b0\u8c61\u5374\u6709\u4e9b\u51fa\u5165\u3002</p> <p>MySQL \u5728\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u53ef\u4ee5\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\uff08\u6ce8\u610f\u662f\u5f88\u5927\u7a0b\u5ea6\u907f\u514d\uff0c\u5e76\u4e0d\u662f\u5f7b\u5e95\u907f\u514d\uff09\uff0c\u6240\u4ee5 MySQL \u5e76\u4e0d\u4f1a\u4f7f\u7528\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u6765\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\uff0c\u56e0\u4e3a\u4f7f\u7528\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u4f1a\u5f71\u54cd\u6027\u80fd\u3002</p> <p>MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u8be6\u89c1\u8fd9\u7bc7\u6587\u7ae0\uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u9488\u5bf9\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002</li> <li>\u9488\u5bf9\u5f53\u524d\u8bfb\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u4e3e\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\u6765\u8bf4\u660e\u8fd9\u56db\u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u6709\u4e00\u5f20\u8d26\u6237\u4f59\u989d\u8868\uff0c\u91cc\u9762\u6709\u4e00\u6761\u8d26\u6237\u4f59\u989d\u4e3a 100 \u4e07\u7684\u8bb0\u5f55\u3002\u7136\u540e\u6709\u4e24\u4e2a\u5e76\u53d1\u7684\u4e8b\u52a1\uff0c\u4e8b\u52a1 A \u53ea\u8d1f\u8d23\u67e5\u8be2\u4f59\u989d\uff0c\u4e8b\u52a1 B \u5219\u4f1a\u5c06\u6211\u7684\u4f59\u989d\u6539\u6210 200 \u4e07\uff0c\u4e0b\u9762\u662f\u6309\u7167\u65f6\u95f4\u987a\u5e8f\u6267\u884c\u4e24\u4e2a\u4e8b\u52a1\u7684\u884c\u4e3a\uff1a</p> <p></p> <p>\u5728\u4e0d\u540c\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u6267\u884c\u8fc7\u7a0b\u4e2d\u67e5\u8be2\u5230\u7684\u4f59\u989d\u53ef\u80fd\u4f1a\u4e0d\u540c\uff1a</p> <ul> <li>\u5728\u300c\u8bfb\u672a\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 B \u4fee\u6539\u4f59\u989d\u540e\uff0c\u867d\u7136\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff0c\u4f46\u662f\u6b64\u65f6\u7684\u4f59\u989d\u5df2\u7ecf\u53ef\u4ee5\u88ab\u4e8b\u52a1 A \u770b\u89c1\u4e86\uff0c\u4e8e\u662f\u4e8b\u52a1 A \u4e2d\u4f59\u989d V1 \u67e5\u8be2\u7684\u503c\u662f 200 \u4e07\uff0c\u4f59\u989d V2\u3001V3 \u81ea\u7136\u4e5f\u662f 200 \u4e07\u4e86\uff1b</li> <li>\u5728\u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 B \u4fee\u6539\u4f59\u989d\u540e\uff0c\u56e0\u4e3a\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff0c\u6240\u4ee5\u4e8b\u52a1 A \u4e2d\u4f59\u989d V1 \u7684\u503c\u8fd8\u662f 100 \u4e07\uff0c\u7b49\u4e8b\u52a1 B \u63d0\u4ea4\u5b8c\u540e\uff0c\u6700\u65b0\u7684\u4f59\u989d\u6570\u636e\u624d\u80fd\u88ab\u4e8b\u52a1 A \u770b\u89c1\uff0c\u56e0\u6b64\u989d V2\u3001V3 \u90fd\u662f 200 \u4e07\uff1b</li> <li>\u5728\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u53ea\u80fd\u770b\u89c1\u542f\u52a8\u4e8b\u52a1\u65f6\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4f59\u989d V1\u3001\u4f59\u989d V2 \u7684\u503c\u90fd\u662f 100 \u4e07\uff0c\u5f53\u4e8b\u52a1 A \u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u5c31\u80fd\u770b\u89c1\u6700\u65b0\u7684\u4f59\u989d\u6570\u636e\u4e86\uff0c\u6240\u4ee5\u4f59\u989d V3 \u7684\u503c\u662f 200 \u4e07\uff1b</li> <li>\u5728\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 B \u5728\u6267\u884c\u5c06\u4f59\u989d 100 \u4e07\u4fee\u6539\u4e3a 200 \u4e07\u65f6\uff0c\u7531\u4e8e\u6b64\u524d\u4e8b\u52a1 A \u6267\u884c\u4e86\u8bfb\u64cd\u4f5c\uff0c\u8fd9\u6837\u5c31\u53d1\u751f\u4e86\u8bfb\u5199\u51b2\u7a81\uff0c\u4e8e\u662f\u5c31\u4f1a\u88ab\u9501\u4f4f\uff0c\u76f4\u5230\u4e8b\u52a1 A \u63d0\u4ea4\u540e\uff0c\u4e8b\u52a1 B \u624d\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\uff0c\u6240\u4ee5\u4ece A \u7684\u89d2\u5ea6\u770b\uff0c\u4f59\u989d V1\u3001V2 \u7684\u503c\u662f 100 \u4e07\uff0c\u4f59\u989d V3 \u7684\u503c\u662f 200 \u4e07\u3002</li> </ul> <p>\u8fd9\u56db\u79cd\u9694\u79bb\u7ea7\u522b\u5177\u4f53\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5462\uff1f</p> <ul> <li>\u5bf9\u4e8e\u300c\u8bfb\u672a\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u56e0\u4e3a\u53ef\u4ee5\u8bfb\u5230\u672a\u63d0\u4ea4\u4e8b\u52a1\u4fee\u6539\u7684\u6570\u636e\uff0c\u6240\u4ee5\u76f4\u63a5\u8bfb\u53d6\u6700\u65b0\u7684\u6570\u636e\u5c31\u597d\u4e86\uff1b</li> <li>\u5bf9\u4e8e\u300c\u4e32\u884c\u5316\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u901a\u8fc7\u52a0\u8bfb\u5199\u9501\u7684\u65b9\u5f0f\u6765\u907f\u514d\u5e76\u884c\u8bbf\u95ee\uff1b</li> <li>\u5bf9\u4e8e\u300c\u8bfb\u63d0\u4ea4\u300d\u548c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u5b83\u4eec\u662f\u901a\u8fc7 Read View \u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\u521b\u5efa Read View \u7684\u65f6\u673a\u4e0d\u540c\uff0c\u5927\u5bb6\u53ef\u4ee5\u628a Read View \u7406\u89e3\u6210\u4e00\u4e2a\u6570\u636e\u5feb\u7167\uff0c\u5c31\u50cf\u76f8\u673a\u62cd\u7167\u90a3\u6837\uff0c\u5b9a\u683c\u67d0\u4e00\u65f6\u523b\u7684\u98ce\u666f\u3002\u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u662f\u5728\u300c\u6bcf\u4e2a\u8bed\u53e5\u6267\u884c\u524d\u300d\u90fd\u4f1a\u91cd\u65b0\u751f\u6210\u4e00\u4e2a Read View\uff0c\u800c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u662f\u300c\u542f\u52a8\u4e8b\u52a1\u65f6\u300d\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\u3002</li> </ul> <p>\u6ce8\u610f\uff0c\u6267\u884c\u300c\u5f00\u59cb\u4e8b\u52a1\u300d\u547d\u4ee4\uff0c\u5e76\u4e0d\u610f\u5473\u7740\u542f\u52a8\u4e86\u4e8b\u52a1\u3002\u5728 MySQL \u6709\u4e24\u79cd\u5f00\u542f\u4e8b\u52a1\u7684\u547d\u4ee4\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u7b2c\u4e00\u79cd\uff1abegin/start transaction \u547d\u4ee4\uff1b</li> <li>\u7b2c\u4e8c\u79cd\uff1astart transaction with consistent snapshot \u547d\u4ee4\uff1b</li> </ul> <p>\u8fd9\u4e24\u79cd\u5f00\u542f\u4e8b\u52a1\u7684\u547d\u4ee4\uff0c\u4e8b\u52a1\u7684\u542f\u52a8\u65f6\u673a\u662f\u4e0d\u540c\u7684\uff1a</p> <ul> <li>\u6267\u884c\u4e86 begin/start transaction \u547d\u4ee4\u540e\uff0c\u5e76\u4e0d\u4ee3\u8868\u4e8b\u52a1\u542f\u52a8\u4e86\u3002\u53ea\u6709\u5728\u6267\u884c\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c\u6267\u884c\u4e86\u589e\u5220\u67e5\u6539\u64cd\u4f5c\u7684 SQL \u8bed\u53e5\uff0c\u624d\u662f\u4e8b\u52a1\u771f\u6b63\u542f\u52a8\u7684\u65f6\u673a\uff1b</li> <li>\u6267\u884c\u4e86 start transaction with consistent snapshot  \u547d\u4ee4\uff0c\u5c31\u4f1a\u9a6c\u4e0a\u542f\u52a8\u4e8b\u52a1\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\u8be6\u7ec6\u8bf4\u4e0b\uff0cRead View \u5728 MVCC \u91cc\u5982\u4f55\u5de5\u4f5c\u7684\uff1f</p>"},{"location":"mysql/transaction/mvcc/#read-view-mvcc","title":"Read View \u5728 MVCC \u91cc\u5982\u4f55\u5de5\u4f5c\u7684\uff1f","text":"<p>\u6211\u4eec\u9700\u8981\u4e86\u89e3\u4e24\u4e2a\u77e5\u8bc6\uff1a</p> <ul> <li>Read View \u4e2d\u56db\u4e2a\u5b57\u6bb5\u4f5c\u7528\uff1b</li> <li>\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u4e2d\u4e24\u4e2a\u8ddf\u4e8b\u52a1\u6709\u5173\u7684\u9690\u85cf\u5217\uff1b</li> </ul> <p>\u90a3 Read View \u5230\u5e95\u662f\u4e2a\u4ec0\u4e48\u4e1c\u897f\uff1f</p> <p></p> <p>Read View \u6709\u56db\u4e2a\u91cd\u8981\u7684\u5b57\u6bb5\uff1a</p> <ul> <li>m_ids\uff1a\u6307\u7684\u662f\u5728\u521b\u5efa Read View \u65f6\uff0c\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u300c\u6d3b\u8dc3\u4e8b\u52a1\u300d\u7684\u4e8b\u52a1 id \u5217\u8868\uff0c\u6ce8\u610f\u662f\u4e00\u4e2a\u5217\u8868\uff0c\u201c\u6d3b\u8dc3\u4e8b\u52a1\u201d\u6307\u7684\u5c31\u662f\uff0c\u542f\u52a8\u4e86\u4f46\u8fd8\u6ca1\u63d0\u4ea4\u7684\u4e8b\u52a1\u3002</li> <li>min_trx_id\uff1a\u6307\u7684\u662f\u5728\u521b\u5efa Read View \u65f6\uff0c\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u300c\u6d3b\u8dc3\u4e8b\u52a1\u300d\u4e2d\u4e8b\u52a1 id \u6700\u5c0f\u7684\u4e8b\u52a1\uff0c\u4e5f\u5c31\u662f m_ids \u7684\u6700\u5c0f\u503c\u3002</li> <li>max_trx_id\uff1a\u8fd9\u4e2a\u5e76\u4e0d\u662f m_ids \u7684\u6700\u5927\u503c\uff0c\u800c\u662f\u521b\u5efa Read View \u65f6\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u5e94\u8be5\u7ed9\u4e0b\u4e00\u4e2a\u4e8b\u52a1\u7684 id \u503c\uff0c\u4e5f\u5c31\u662f\u5168\u5c40\u4e8b\u52a1\u4e2d\u6700\u5927\u7684\u4e8b\u52a1 id \u503c + 1\uff1b</li> <li>creator_trx_id\uff1a\u6307\u7684\u662f\u521b\u5efa\u8be5 Read View \u7684\u4e8b\u52a1\u7684\u4e8b\u52a1 id\u3002</li> </ul> <p>\u77e5\u9053\u4e86 Read View \u7684\u5b57\u6bb5\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u4e86\u89e3\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u4e2d\u7684\u4e24\u4e2a\u9690\u85cf\u5217\u3002</p> <p>\u5047\u8bbe\u5728\u8d26\u6237\u4f59\u989d\u8868\u63d2\u5165\u4e00\u6761\u5c0f\u6797\u4f59\u989d\u4e3a 100 \u4e07\u7684\u8bb0\u5f55\uff0c\u7136\u540e\u6211\u628a\u8fd9\u4e24\u4e2a\u9690\u85cf\u5217\u4e5f\u753b\u51fa\u6765\uff0c\u8be5\u8bb0\u5f55\u7684\u6574\u4e2a\u793a\u610f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u5bf9\u4e8e\u4f7f\u7528 InnoDB \u5b58\u50a8\u5f15\u64ce\u7684\u6570\u636e\u5e93\u8868\uff0c\u5b83\u7684\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u4e2d\u90fd\u5305\u542b\u4e0b\u9762\u4e24\u4e2a\u9690\u85cf\u5217\uff1a</p> <ul> <li>trx_id\uff0c\u5f53\u4e00\u4e2a\u4e8b\u52a1\u5bf9\u67d0\u6761\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u8fdb\u884c\u6539\u52a8\u65f6\uff0c\u5c31\u4f1a\u628a\u8be5\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u8bb0\u5f55\u5728 trx_id \u9690\u85cf\u5217\u91cc\uff1b</li> <li>roll_pointer\uff0c\u6bcf\u6b21\u5bf9\u67d0\u6761\u805a\u7c07\u7d22\u5f15\u8bb0\u5f55\u8fdb\u884c\u6539\u52a8\u65f6\uff0c\u90fd\u4f1a\u628a\u65e7\u7248\u672c\u7684\u8bb0\u5f55\u5199\u5165\u5230 undo \u65e5\u5fd7\u4e2d\uff0c\u7136\u540e\u8fd9\u4e2a\u9690\u85cf\u5217\u662f\u4e2a\u6307\u9488\uff0c\u6307\u5411\u6bcf\u4e00\u4e2a\u65e7\u7248\u672c\u8bb0\u5f55\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u901a\u8fc7\u5b83\u627e\u5230\u4fee\u6539\u524d\u7684\u8bb0\u5f55\u3002</li> </ul> <p>\u5728\u521b\u5efa  Read View \u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8bb0\u5f55\u4e2d\u7684 trx_id \u5212\u5206\u8fd9\u4e09\u79cd\u60c5\u51b5\uff1a</p> <p></p> <p>\u4e00\u4e2a\u4e8b\u52a1\u53bb\u8bbf\u95ee\u8bb0\u5f55\u7684\u65f6\u5019\uff0c\u9664\u4e86\u81ea\u5df1\u7684\u66f4\u65b0\u8bb0\u5f55\u603b\u662f\u53ef\u89c1\u4e4b\u5916\uff0c\u8fd8\u6709\u8fd9\u51e0\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u5982\u679c\u8bb0\u5f55\u7684 trx_id \u503c\u5c0f\u4e8e Read View \u4e2d\u7684 <code>min_trx_id</code> \u503c\uff0c\u8868\u793a\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u662f\u5728\u521b\u5efa Read View \u524d\u5df2\u7ecf\u63d0\u4ea4\u7684\u4e8b\u52a1\u751f\u6210\u7684\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1\u53ef\u89c1\u3002</li> <li>\u5982\u679c\u8bb0\u5f55\u7684 trx_id \u503c\u5927\u4e8e\u7b49\u4e8e Read View \u4e2d\u7684 <code>max_trx_id</code> \u503c\uff0c\u8868\u793a\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u662f\u5728\u521b\u5efa Read View \u540e\u624d\u542f\u52a8\u7684\u4e8b\u52a1\u751f\u6210\u7684\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1\u4e0d\u53ef\u89c1\u3002</li> <li>\u5982\u679c\u8bb0\u5f55\u7684 trx_id \u503c\u5728 Read View \u7684 <code>min_trx_id</code> \u548c <code>max_trx_id</code> \u4e4b\u95f4\uff0c\u9700\u8981\u5224\u65ad trx_id \u662f\u5426\u5728 m_ids \u5217\u8868\u4e2d\uff1a</li> <li>\u5982\u679c\u8bb0\u5f55\u7684 trx_id \u5728 <code>m_ids</code> \u5217\u8868\u4e2d\uff0c\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u8bb0\u5f55\u7684\u6d3b\u8dc3\u4e8b\u52a1\u4f9d\u7136\u6d3b\u8dc3\u7740\uff08\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\uff09\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1\u4e0d\u53ef\u89c1\u3002</li> <li>\u5982\u679c\u8bb0\u5f55\u7684 trx_id \u4e0d\u5728 <code>m_ids</code>\u5217\u8868\u4e2d\uff0c\u8868\u793a\u751f\u6210\u8be5\u7248\u672c\u8bb0\u5f55\u7684\u6d3b\u8dc3\u4e8b\u52a1\u5df2\u7ecf\u88ab\u63d0\u4ea4\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u5f53\u524d\u4e8b\u52a1\u53ef\u89c1\u3002</li> </ul> <p>\u8fd9\u79cd\u901a\u8fc7\u300c\u7248\u672c\u94fe\u300d\u6765\u63a7\u5236\u5e76\u53d1\u4e8b\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8bb0\u5f55\u65f6\u7684\u884c\u4e3a\u5c31\u53eb MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002</p>"},{"location":"mysql/transaction/mvcc/#_8","title":"\u53ef\u91cd\u590d\u8bfb\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f","text":"<p>\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u662f\u542f\u52a8\u4e8b\u52a1\u65f6\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\u3002</p> <p>\u5047\u8bbe\u4e8b\u52a1 A\uff08\u4e8b\u52a1 id \u4e3a 51\uff09\u542f\u52a8\u540e\uff0c\u7d27\u63a5\u7740\u4e8b\u52a1 B\uff08\u4e8b\u52a1 id \u4e3a 52\uff09\u4e5f\u542f\u52a8\u4e86\uff0c\u90a3\u8fd9\u4e24\u4e2a\u4e8b\u52a1\u521b\u5efa\u7684 Read View \u5982\u4e0b\uff1a</p> <p></p> <p>\u4e8b\u52a1 A \u548c \u4e8b\u52a1 B \u7684 Read View \u5177\u4f53\u5185\u5bb9\u5982\u4e0b\uff1a</p> <ul> <li>\u5728\u4e8b\u52a1 A \u7684 Read View \u4e2d\uff0c\u5b83\u7684\u4e8b\u52a1 id \u662f 51\uff0c\u7531\u4e8e\u5b83\u662f\u7b2c\u4e00\u4e2a\u542f\u52a8\u7684\u4e8b\u52a1\uff0c\u6240\u4ee5\u6b64\u65f6\u6d3b\u8dc3\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u5217\u8868\u5c31\u53ea\u6709 51\uff0c\u6d3b\u8dc3\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u5217\u8868\u4e2d\u6700\u5c0f\u7684\u4e8b\u52a1 id \u662f\u4e8b\u52a1 A \u672c\u8eab\uff0c\u4e0b\u4e00\u4e2a\u4e8b\u52a1 id \u5219\u662f 52\u3002</li> <li>\u5728\u4e8b\u52a1 B \u7684 Read View \u4e2d\uff0c\u5b83\u7684\u4e8b\u52a1 id \u662f 52\uff0c\u7531\u4e8e\u4e8b\u52a1 A \u662f\u6d3b\u8dc3\u7684\uff0c\u6240\u4ee5\u6b64\u65f6\u6d3b\u8dc3\u4e8b\u52a1\u7684\u4e8b\u52a1 id \u5217\u8868\u662f 51 \u548c 52\uff0c\u6d3b\u8dc3\u7684\u4e8b\u52a1 id \u4e2d\u6700\u5c0f\u7684\u4e8b\u52a1 id \u662f\u4e8b\u52a1 A\uff0c\u4e0b\u4e00\u4e2a\u4e8b\u52a1 id \u5e94\u8be5\u662f 53\u3002</li> </ul> <p>\u63a5\u7740\uff0c\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u548c\u4e8b\u52a1 B \u6309\u987a\u5e8f\u6267\u884c\u4e86\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ul> <li>\u4e8b\u52a1 B \u8bfb\u53d6\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u8bfb\u5230\u4f59\u989d\u662f 100 \u4e07\uff1b</li> <li>\u4e8b\u52a1 A \u5c06\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\u4fee\u6539\u6210 200 \u4e07\uff0c\u5e76\u6ca1\u6709\u63d0\u4ea4\u4e8b\u52a1\uff1b</li> <li>\u4e8b\u52a1 B \u8bfb\u53d6\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u8bfb\u5230\u4f59\u989d\u8fd8\u662f 100 \u4e07\uff1b</li> <li>\u4e8b\u52a1 A \u63d0\u4ea4\u4e8b\u52a1\uff1b</li> <li>\u4e8b\u52a1 B \u8bfb\u53d6\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u8bfb\u5230\u4f59\u989d\u4f9d\u7136\u8fd8\u662f 100 \u4e07\uff1b</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u8ddf\u5927\u5bb6\u5177\u4f53\u5206\u6790\u4e0b\u3002</p> <p>\u4e8b\u52a1 B \u7b2c\u4e00\u6b21\u8bfb\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u8bb0\u5f55\uff0c\u5728\u627e\u5230\u8bb0\u5f55\u540e\uff0c\u5b83\u4f1a\u5148\u770b\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id\uff0c\u6b64\u65f6\u53d1\u73b0 trx_id \u4e3a 50\uff0c\u6bd4\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\uff0851\uff09\u8fd8\u5c0f\uff0c\u8fd9\u610f\u5473\u7740\u4fee\u6539\u8fd9\u6761\u8bb0\u5f55\u7684\u4e8b\u52a1\u65e9\u5c31\u5728\u4e8b\u52a1 B \u542f\u52a8\u524d\u63d0\u4ea4\u8fc7\u4e86\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u4e8b\u52a1 B \u53ef\u89c1\u7684\uff0c\u4e5f\u5c31\u662f\u4e8b\u52a1 B \u53ef\u4ee5\u83b7\u53d6\u5230\u8fd9\u6761\u8bb0\u5f55\u3002</p> <p>\u63a5\u7740\uff0c\u4e8b\u52a1 A \u901a\u8fc7 update \u8bed\u53e5\u5c06\u8fd9\u6761\u8bb0\u5f55\u4fee\u6539\u4e86\uff08\u8fd8\u672a\u63d0\u4ea4\u4e8b\u52a1\uff09\uff0c\u5c06\u5c0f\u6797\u7684\u4f59\u989d\u6539\u6210 200 \u4e07\uff0c\u8fd9\u65f6 MySQL \u4f1a\u8bb0\u5f55\u76f8\u5e94\u7684 undo log\uff0c\u5e76\u4ee5\u94fe\u8868\u7684\u65b9\u5f0f\u4e32\u8054\u8d77\u6765\uff0c\u5f62\u6210\u7248\u672c\u94fe\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4f60\u53ef\u4ee5\u5728\u4e0a\u56fe\u7684\u300c\u8bb0\u5f55\u7684\u5b57\u6bb5\u300d\u770b\u5230\uff0c\u7531\u4e8e\u4e8b\u52a1 A \u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u4ee5\u524d\u7684\u8bb0\u5f55\u5c31\u53d8\u6210\u65e7\u7248\u672c\u8bb0\u5f55\u4e86\uff0c\u4e8e\u662f\u6700\u65b0\u8bb0\u5f55\u548c\u65e7\u7248\u672c\u8bb0\u5f55\u901a\u8fc7\u94fe\u8868\u7684\u65b9\u5f0f\u4e32\u8d77\u6765\uff0c\u800c\u4e14\u6700\u65b0\u8bb0\u5f55\u7684 trx_id \u662f\u4e8b\u52a1 A \u7684\u4e8b\u52a1 id\uff08trx_id = 51\uff09\u3002</p> <p>\u7136\u540e\u4e8b\u52a1 B \u7b2c\u4e8c\u6b21\u53bb\u8bfb\u53d6\u8be5\u8bb0\u5f55\uff0c\u53d1\u73b0\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id \u503c\u4e3a 51\uff0c\u5728\u4e8b\u52a1 B \u7684 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u5219\u9700\u8981\u5224\u65ad trx_id \u503c\u662f\u5426\u5728  m_ids \u8303\u56f4\u5185\uff0c\u5224\u65ad\u7684\u7ed3\u679c\u662f\u5728\u7684\uff0c\u90a3\u4e48\u8bf4\u660e\u8fd9\u6761\u8bb0\u5f55\u662f\u88ab\u8fd8\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u4fee\u6539\u7684\uff0c\u8fd9\u65f6\u4e8b\u52a1 B \u5e76\u4e0d\u4f1a\u8bfb\u53d6\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u3002\u800c\u662f\u6cbf\u7740 undo log \u94fe\u6761\u5f80\u4e0b\u627e\u65e7\u7248\u672c\u7684\u8bb0\u5f55\uff0c\u76f4\u5230\u627e\u5230 trx_id \u53ef\u89c1\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff08trx_id\u300c\u5c0f\u4e8e\u300d\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\uff0c\u6216\u8005 trx_id \u5728\u4e8b\u52a1 B \u7684 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u4f46\u662f\u4e0d\u5728 m_ids \u8303\u56f4\u5185\uff09\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u80fd\u8bfb\u53d6\u5230\u7684\u662f trx_id \u4e3a 50 \u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5c0f\u6797\u4f59\u989d\u662f 100 \u4e07\u7684\u8fd9\u6761\u8bb0\u5f55\u3002</p> <p>\u6700\u540e\uff0c\u5f53\u4e8b\u7269 A \u63d0\u4ea4\u4e8b\u52a1\u540e\uff0c\u7531\u4e8e\u9694\u79bb\u7ea7\u522b\u65f6\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u518d\u6b21\u8bfb\u53d6\u8bb0\u5f55\u65f6\uff0c\u8fd8\u662f\u57fa\u4e8e\u542f\u52a8\u4e8b\u52a1\u65f6\u521b\u5efa\u7684 Read View \u6765\u5224\u65ad\u5f53\u524d\u7248\u672c\u7684\u8bb0\u5f55\u662f\u5426\u53ef\u89c1\u3002\u6240\u4ee5\uff0c\u5373\u4f7f\u4e8b\u7269 A \u5c06\u5c0f\u6797\u4f59\u989d\u4fee\u6539\u4e3a 200 \u4e07\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\uff0c\u4e8b\u52a1 B \u7b2c\u4e09\u6b21\u8bfb\u53d6\u8bb0\u5f55\u65f6\uff0c\u8bfb\u5230\u7684\u8bb0\u5f55\u90fd\u662f\u5c0f\u6797\u4f59\u989d\u662f 100 \u4e07\u7684\u8fd9\u6761\u8bb0\u5f55\u3002</p> <p>\u5c31\u662f\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e86\uff0c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4e0b\u5728\u4e8b\u52a1\u671f\u95f4\u8bfb\u5230\u7684\u8bb0\u5f55\u90fd\u662f\u4e8b\u52a1\u542f\u52a8\u524d\u7684\u8bb0\u5f55\u3002</p>"},{"location":"mysql/transaction/mvcc/#_9","title":"\u8bfb\u63d0\u4ea4\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f","text":"<p>\u8bfb\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u662f\u5728\u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 Read View\u3002</p> <p>\u4e5f\u610f\u5473\u7740\uff0c\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002</p> <p>\u90a3\u8bfb\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u662f\u600e\u4e48\u5de5\u4f5c\u5462\uff1f\u6211\u4eec\u8fd8\u662f\u4ee5\u524d\u9762\u7684\u4f8b\u5b50\u6765\u804a\u804a\u3002</p> <p>\u5047\u8bbe\u4e8b\u52a1 A\uff08\u4e8b\u52a1 id \u4e3a 51\uff09\u542f\u52a8\u540e\uff0c\u7d27\u63a5\u7740\u4e8b\u52a1 B\uff08\u4e8b\u52a1 id \u4e3a 52\uff09\u4e5f\u542f\u52a8\u4e86\uff0c\u63a5\u7740\u6309\u987a\u5e8f\u6267\u884c\u4e86\u4ee5\u4e0b\u64cd\u4f5c\uff1a</p> <ul> <li>\u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\uff08\u521b\u5efa Read View\uff09\uff0c\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4e3a 100 \u4e07\uff1b</li> <li>\u4e8b\u52a1 A \u4fee\u6539\u6570\u636e\uff08\u8fd8\u6ca1\u63d0\u4ea4\u4e8b\u52a1\uff09\uff0c\u5c06\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4ece 100 \u4e07\u4fee\u6539\u6210\u4e86 200 \u4e07\uff1b</li> <li>\u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\uff08\u521b\u5efa Read View\uff09\uff0c\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4e3a 100 \u4e07\uff1b</li> <li>\u4e8b\u52a1 A \u63d0\u4ea4\u4e8b\u52a1\uff1b</li> <li>\u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\uff08\u521b\u5efa Read View\uff09\uff0c\u5c0f\u6797\u7684\u8d26\u6237\u4f59\u989d\u4e3a 200 \u4e07\uff1b</li> </ul> <p>\u90a3\u5177\u4f53\u600e\u4e48\u505a\u5230\u7684\u5462\uff1f\u6211\u4eec\u91cd\u70b9\u770b\u4e8b\u52a1 B \u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u7684  Read View\u3002\u524d\u4e24\u6b21 \u4e8b\u52a1 B \u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u7684  Read View \u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6211\u4eec\u6765\u5206\u6790\u4e0b\u4e3a\u4ec0\u4e48\u4e8b\u52a1 B \u7b2c\u4e8c\u6b21\u8bfb\u6570\u636e\u65f6\uff0c\u8bfb\u4e0d\u5230\u4e8b\u52a1 A\uff08\u8fd8\u672a\u63d0\u4ea4\u4e8b\u52a1\uff09\u4fee\u6539\u7684\u6570\u636e\uff1f</p> <p>\u4e8b\u52a1 B \u5728\u627e\u5230\u5c0f\u6797\u8fd9\u6761\u8bb0\u5f55\u65f6\uff0c\u4f1a\u770b\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id \u662f 51\uff0c\u5728\u4e8b\u52a1 B \u7684 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u5224\u65ad trx_id \u503c\u662f\u5426\u5728  m_ids \u8303\u56f4\u5185\uff0c\u5224\u65ad\u7684\u7ed3\u679c\u662f\u5728\u7684\uff0c\u90a3\u4e48\u8bf4\u660e\u8fd9\u6761\u8bb0\u5f55\u662f\u88ab\u8fd8\u672a\u63d0\u4ea4\u7684\u4e8b\u52a1\u4fee\u6539\u7684\uff0c\u8fd9\u65f6\u4e8b\u52a1 B \u5e76\u4e0d\u4f1a\u8bfb\u53d6\u8fd9\u4e2a\u7248\u672c\u7684\u8bb0\u5f55\u3002\u800c\u662f\uff0c\u6cbf\u7740 undo log \u94fe\u6761\u5f80\u4e0b\u627e\u65e7\u7248\u672c\u7684\u8bb0\u5f55\uff0c\u76f4\u5230\u627e\u5230 trx_id \u53ef\u89c1\u7684\u7b2c\u4e00\u6761\u8bb0\u5f55\uff08trx_id\u300c\u5c0f\u4e8e\u300d\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\uff0c\u6216\u8005 trx_id \u5728\u4e8b\u52a1 B \u7684 Read View \u7684 min_trx_id \u548c max_trx_id \u4e4b\u95f4\uff0c\u4f46\u662f\u4e0d\u5728 m_ids \u8303\u56f4\u5185\uff09\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u80fd\u8bfb\u53d6\u5230\u7684\u662f trx_id \u4e3a 50 \u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u662f\u5c0f\u6797\u4f59\u989d\u662f 100 \u4e07\u7684\u8fd9\u6761\u8bb0\u5f55\u3002</p> <p>\u6211\u4eec\u6765\u5206\u6790\u4e0b\u4e3a\u4ec0\u4e48\u4e8b\u52a1 A \u63d0\u4ea4\u540e\uff0c\u4e8b\u52a1 B \u5c31\u53ef\u4ee5\u8bfb\u5230\u4e8b\u52a1 A \u4fee\u6539\u7684\u6570\u636e\uff1f</p> <p>\u5728\u4e8b\u52a1 A \u63d0\u4ea4\u540e\uff0c\u7531\u4e8e\u9694\u79bb\u7ea7\u522b\u662f\u300c\u8bfb\u63d0\u4ea4\u300d\uff0c\u6240\u4ee5\u4e8b\u52a1 B \u5728\u6bcf\u6b21\u8bfb\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f1a\u91cd\u65b0\u521b\u5efa  Read View\uff0c\u6b64\u65f6\u4e8b\u52a1 B \u7b2c\u4e09\u6b21\u8bfb\u53d6\u6570\u636e\u65f6\u521b\u5efa\u7684  Read View \u5982\u4e0b\uff1a</p> <p></p> <p>\u4e8b\u52a1 B \u5728\u627e\u5230\u5c0f\u6797\u8fd9\u6761\u8bb0\u5f55\u65f6\uff0c\u4f1a\u53d1\u73b0\u8fd9\u6761\u8bb0\u5f55\u7684 trx_id \u662f 51\uff0c\u6bd4\u4e8b\u52a1 B \u7684 Read View \u4e2d\u7684 min_trx_id \u503c\uff0852\uff09\u8fd8\u5c0f\uff0c\u8fd9\u610f\u5473\u7740\u4fee\u6539\u8fd9\u6761\u8bb0\u5f55\u7684\u4e8b\u52a1\u65e9\u5c31\u5728\u521b\u5efa  Read View \u524d\u63d0\u4ea4\u8fc7\u4e86\uff0c\u6240\u4ee5\u8be5\u7248\u672c\u7684\u8bb0\u5f55\u5bf9\u4e8b\u52a1 B \u662f\u53ef\u89c1\u7684\u3002</p> <p>\u6b63\u662f\u56e0\u4e3a\u5728\u8bfb\u63d0\u4ea4\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6bcf\u6b21\u8bfb\u6570\u636e\u65f6\u90fd\u91cd\u65b0\u521b\u5efa Read View\uff0c\u90a3\u4e48\u5728\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002</p>"},{"location":"mysql/transaction/mvcc/#_10","title":"\u603b\u7ed3","text":"<p>\u4e8b\u52a1\u662f\u5728 MySQL \u5f15\u64ce\u5c42\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u5e38\u89c1\u7684 InnoDB \u5f15\u64ce\u662f\u652f\u6301\u4e8b\u52a1\u7684\uff0c\u4e8b\u52a1\u7684\u56db\u5927\u7279\u6027\u662f\u539f\u5b50\u6027\u3001\u4e00\u81f4\u6027\u3001\u9694\u79bb\u6027\u3001\u6301\u4e45\u6027\uff0c\u6211\u4eec\u8fd9\u6b21\u4e3b\u8981\u8bb2\u7684\u662f\u9694\u79bb\u6027\u3002</p> <p>\u5f53\u591a\u4e2a\u4e8b\u52a1\u5e76\u53d1\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u5f15\u53d1\u810f\u8bfb\u3001\u4e0d\u53ef\u91cd\u590d\u8bfb\u3001\u5e7b\u8bfb\u8fd9\u4e9b\u95ee\u9898\uff0c\u90a3\u4e3a\u4e86\u907f\u514d\u8fd9\u4e9b\u95ee\u9898\uff0cSQL \u63d0\u51fa\u4e86\u56db\u79cd\u9694\u79bb\u7ea7\u522b\uff0c\u5206\u522b\u662f\u8bfb\u672a\u63d0\u4ea4\u3001\u8bfb\u5df2\u63d0\u4ea4\u3001\u53ef\u91cd\u590d\u8bfb\u3001\u4e32\u884c\u5316\uff0c\u4ece\u5de6\u5f80\u53f3\u9694\u79bb\u7ea7\u522b\u987a\u5e8f\u9012\u589e\uff0c\u9694\u79bb\u7ea7\u522b\u8d8a\u9ad8\uff0c\u610f\u5473\u7740\u6027\u80fd\u8d8a\u5dee\uff0cInnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u662f\u53ef\u91cd\u590d\u8bfb\u3002</p> <p>\u8981\u89e3\u51b3\u810f\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u5230\u8bfb\u5df2\u63d0\u4ea4\u4ee5\u4e0a\u7684\u9694\u79bb\u7ea7\u522b\uff0c\u8981\u89e3\u51b3\u4e0d\u53ef\u91cd\u590d\u8bfb\u73b0\u8c61\uff0c\u5c31\u8981\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u5230\u53ef\u91cd\u590d\u8bfb\u4ee5\u4e0a\u7684\u9694\u79bb\u7ea7\u522b\u3002</p> <p>\u800c\u5bf9\u4e8e\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4e0d\u5efa\u8bae\u5c06\u9694\u79bb\u7ea7\u522b\u5347\u7ea7\u4e3a\u4e32\u884c\u5316\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u5e76\u53d1\u65f6\u6027\u80fd\u5f88\u5dee\u3002MySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff0c\u8be6\u89c1\u8fd9\u7bc7\u6587\u7ae0\uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u9488\u5bf9\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002</li> <li>\u9488\u5bf9\u5f53\u524d\u8bfb\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002</li> </ul> <p>\u5bf9\u4e8e\u300c\u8bfb\u63d0\u4ea4\u300d\u548c\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u7684\u4e8b\u52a1\u6765\u8bf4\uff0c\u5b83\u4eec\u662f\u901a\u8fc7 Read View \u6765\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u7684\u533a\u522b\u5728\u4e8e\u521b\u5efa Read View \u7684\u65f6\u673a\u4e0d\u540c\uff1a</p> <ul> <li>\u300c\u8bfb\u63d0\u4ea4\u300d\u9694\u79bb\u7ea7\u522b\u662f\u5728\u6bcf\u4e2a select \u90fd\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684 Read View\uff0c\u4e5f\u610f\u5473\u7740\uff0c\u4e8b\u52a1\u671f\u95f4\u7684\u591a\u6b21\u8bfb\u53d6\u540c\u4e00\u6761\u6570\u636e\uff0c\u524d\u540e\u4e24\u6b21\u8bfb\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u51fa\u73b0\u4e0d\u4e00\u81f4\uff0c\u56e0\u4e3a\u53ef\u80fd\u8fd9\u671f\u95f4\u53e6\u5916\u4e00\u4e2a\u4e8b\u52a1\u4fee\u6539\u4e86\u8be5\u8bb0\u5f55\uff0c\u5e76\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002</li> <li>\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u662f\u542f\u52a8\u4e8b\u52a1\u65f6\u751f\u6210\u4e00\u4e2a Read View\uff0c\u7136\u540e\u6574\u4e2a\u4e8b\u52a1\u671f\u95f4\u90fd\u5728\u7528\u8fd9\u4e2a Read View\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u5728\u4e8b\u52a1\u671f\u95f4\u8bfb\u5230\u7684\u6570\u636e\u90fd\u662f\u4e8b\u52a1\u542f\u52a8\u524d\u7684\u8bb0\u5f55\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u9694\u79bb\u7ea7\u522b\u5b9e\u73b0\u662f\u901a\u8fc7\u300c\u4e8b\u52a1\u7684 Read View \u91cc\u7684\u5b57\u6bb5\u300d\u548c\u300c\u8bb0\u5f55\u4e2d\u7684\u4e24\u4e2a\u9690\u85cf\u5217\u300d\u7684\u6bd4\u5bf9\uff0c\u6765\u63a7\u5236\u5e76\u53d1\u4e8b\u52a1\u8bbf\u95ee\u540c\u4e00\u4e2a\u8bb0\u5f55\u65f6\u7684\u884c\u4e3a\uff0c\u8fd9\u5c31\u53eb MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u3002</p> <p>\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e2d\uff0c\u666e\u901a\u7684 select \u8bed\u53e5\u5c31\u662f\u57fa\u4e8e MVCC \u5b9e\u73b0\u7684\u5feb\u7167\u8bfb\uff0c\u4e5f\u5c31\u662f\u4e0d\u4f1a\u52a0\u9501\u7684\u3002\u800c select .. for update \u8bed\u53e5\u5c31\u4e0d\u662f\u5feb\u7167\u8bfb\u4e86\uff0c\u800c\u662f\u5f53\u524d\u8bfb\u4e86\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u8bfb\u90fd\u662f\u62ff\u5230\u6700\u65b0\u7248\u672c\u7684\u6570\u636e\uff0c\u4f46\u662f\u5b83\u4f1a\u5bf9\u8bfb\u5230\u7684\u8bb0\u5f55\u52a0\u4e0a next-key lock \u9501\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"mysql/transaction/phantom/","title":"MySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff0c\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb\u4e86\u5417\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6211\u5728\u4e0a\u4e00\u7bc7\u6587\u7ae0\u63d0\u5230\uff0cMySQL InnoDB \u5f15\u64ce\u7684\u9ed8\u8ba4\u9694\u79bb\u7ea7\u522b\u867d\u7136\u662f\u300c\u53ef\u91cd\u590d\u8bfb\u300d\uff0c\u4f46\u662f\u5b83\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\uff08\u5e76\u4e0d\u662f\u5b8c\u5168\u89e3\u51b3\u4e86\uff09\uff0c\u89e3\u51b3\u7684\u65b9\u6848\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u9488\u5bf9\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\uff0c\u56e0\u4e3a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\u770b\u5230\u7684\u6570\u636e\uff0c\u4e00\u76f4\u8ddf\u8fd9\u4e2a\u4e8b\u52a1\u542f\u52a8\u65f6\u770b\u5230\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u6570\u636e\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002</li> <li>\u9488\u5bf9\u5f53\u524d\u8bfb\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\uff0c\u56e0\u4e3a\u5f53\u6267\u884c select ... for update \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4f1a\u52a0\u4e0a next-key lock\uff0c\u5982\u679c\u6709\u5176\u4ed6\u4e8b\u52a1\u5728 next-key lock \u9501\u8303\u56f4\u5185\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u8fd9\u4e2a\u63d2\u5165\u8bed\u53e5\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u65e0\u6cd5\u6210\u529f\u63d2\u5165\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u89e3\u51b3\u65b9\u6848\u662f\u5f88\u5927\u7a0b\u5ea6\u4e0a\u89e3\u51b3\u4e86\u5e7b\u8bfb\u73b0\u8c61\uff0c\u4f46\u662f\u8fd8\u662f\u6709\u4e2a\u522b\u7684\u60c5\u51b5\u9020\u6210\u7684\u5e7b\u8bfb\u73b0\u8c61\u662f\u65e0\u6cd5\u89e3\u51b3\u7684\u3002</p> <p>\u8fd9\u6b21\uff0c\u5c31\u8ddf\u5927\u5bb6\u597d\u597d\u804a\u8fd9\u4e2a\u95ee\u9898\u3002</p>"},{"location":"mysql/transaction/phantom/#_1","title":"\u4ec0\u4e48\u662f\u5e7b\u8bfb\uff1f","text":"<p>\u9996\u5148\u6765\u770b\u770b MySQL \u6587\u6863\u662f\u600e\u4e48\u5b9a\u4e49\u5e7b\u8bfb\uff08Phantom Read\uff09\u7684\uff1a</p> <p>The so-called phantom problem occurs within a transaction when the same query produces different sets of rows at different times. For example, if a SELECT is executed twice, but returns a row the second time that was not returned the first time, the row is a \u201cphantom\u201d row.</p> <p>\u7ffb\u8bd1\uff1a\u5f53\u540c\u4e00\u4e2a\u67e5\u8be2\u5728\u4e0d\u540c\u7684\u65f6\u95f4\u4ea7\u751f\u4e0d\u540c\u7684\u7ed3\u679c\u96c6\u65f6\uff0c\u4e8b\u52a1\u4e2d\u5c31\u4f1a\u51fa\u73b0\u6240\u8c13\u7684\u5e7b\u8c61\u95ee\u9898\u3002\u4f8b\u5982\uff0c\u5982\u679c SELECT \u6267\u884c\u4e86\u4e24\u6b21\uff0c\u4f46\u7b2c\u4e8c\u6b21\u8fd4\u56de\u4e86\u7b2c\u4e00\u6b21\u6ca1\u6709\u8fd4\u56de\u7684\u884c\uff0c\u5219\u8be5\u884c\u662f\u201c\u5e7b\u50cf\u201d\u884c\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e00\u4e2a\u4e8b\u52a1\u5728 T1 \u65f6\u523b\u548c T2 \u65f6\u523b\u5206\u522b\u6267\u884c\u4e86\u4e0b\u9762\u67e5\u8be2\u8bed\u53e5\uff0c\u9014\u4e2d\u6ca1\u6709\u6267\u884c\u5176\u4ed6\u4efb\u4f55\u8bed\u53e5\uff1a</p> SQL<pre><code>SELECT * FROM t_test WHERE id &gt; 100;\n</code></pre> <p>\u53ea\u8981 T1 \u548c T2 \u65f6\u523b\u6267\u884c\u4ea7\u751f\u7684\u7ed3\u679c\u96c6\u662f\u4e0d\u76f8\u540c\u7684\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 6 \u6761\u884c\u8bb0\u5f55\uff0c\u90a3\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</li> <li>T1 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 5 \u6761\u884c\u8bb0\u5f55\uff0c\u800c T2 \u65f6\u95f4\u6267\u884c\u7684\u7ed3\u679c\u662f\u6709 4 \u6761\u884c\u8bb0\u5f55\uff0c\u4e5f\u662f\u53d1\u751f\u4e86\u5e7b\u8bfb\u7684\u95ee\u9898\u3002</li> </ul>"},{"location":"mysql/transaction/phantom/#_2","title":"\u5feb\u7167\u8bfb\u662f\u5982\u4f55\u907f\u514d\u5e7b\u8bfb\u7684\uff1f","text":"<p>\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u662f\u7531 MVCC\uff08\u591a\u7248\u672c\u5e76\u53d1\u63a7\u5236\uff09\u5b9e\u73b0\u7684\uff0c\u5b9e\u73b0\u7684\u65b9\u5f0f\u662f\u542f\u52a8\u4e8b\u52a1\u540e\uff0c\u5728\u6267\u884c\u7b2c\u4e00\u4e2a\u67e5\u8be2\u8bed\u53e5\u540e\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a Read View\uff0c\u540e\u7eed\u7684\u67e5\u8be2\u8bed\u53e5\u5229\u7528\u8fd9\u4e2a Read View\uff0c\u901a\u8fc7\u8fd9\u4e2a  Read View \u5c31\u53ef\u4ee5\u5728 undo log \u7248\u672c\u94fe\u627e\u5230\u4e8b\u52a1\u5f00\u59cb\u65f6\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4e8b\u52a1\u8fc7\u7a0b\u4e2d\u6bcf\u6b21\u67e5\u8be2\u7684\u6570\u636e\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5373\u4f7f\u4e2d\u9014\u6709\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u65b0\u7eaa\u5f55\uff0c\u662f\u67e5\u8be2\u4e0d\u51fa\u6765\u8fd9\u6761\u6570\u636e\u7684\uff0c\u6240\u4ee5\u5c31\u5f88\u597d\u4e86\u907f\u514d\u5e7b\u8bfb\u95ee\u9898\u3002</p> <p>\u505a\u4e2a\u5b9e\u9a8c\uff0c\u6570\u636e\u5e93\u8868 t_stu \u5982\u4e0b\uff0c\u5176\u4e2d id \u4e3a\u4e3b\u952e\u3002</p> <p></p> <p>\u7136\u540e\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u6709\u4e24\u4e2a\u4e8b\u52a1\u7684\u6267\u884c\u987a\u5e8f\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece\u8fd9\u4e2a\u5b9e\u9a8c\u7ed3\u679c\u53ef\u4ee5\u770b\u5230\uff0c\u5373\u4f7f\u4e8b\u52a1 B \u4e2d\u9014\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u4e8b\u52a1 A \u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u90fd\u662f\u4e00\u6837\u7684\uff0c\u5e76\u6ca1\u6709\u51fa\u73b0\u6240\u8c13\u7684\u5e7b\u8bfb\u73b0\u8c61\u3002</p>"},{"location":"mysql/transaction/phantom/#_3","title":"\u5f53\u524d\u8bfb\u662f\u5982\u4f55\u907f\u514d\u5e7b\u8bfb\u7684\uff1f","text":"<p>MySQL \u91cc\u9664\u4e86\u666e\u901a\u67e5\u8be2\u662f\u5feb\u7167\u8bfb\uff0c\u5176\u4ed6\u90fd\u662f\u5f53\u524d\u8bfb\uff0c\u6bd4\u5982 update\u3001insert\u3001delete\uff0c\u8fd9\u4e9b\u8bed\u53e5\u6267\u884c\u524d\u90fd\u4f1a\u67e5\u8be2\u6700\u65b0\u7248\u672c\u7684\u6570\u636e\uff0c\u7136\u540e\u518d\u505a\u8fdb\u4e00\u6b65\u7684\u64cd\u4f5c\u3002</p> <p>\u8fd9\u5f88\u597d\u7406\u89e3\uff0c\u5047\u8bbe\u4f60\u8981 update \u4e00\u4e2a\u8bb0\u5f55\uff0c\u53e6\u4e00\u4e2a\u4e8b\u52a1\u5df2\u7ecf delete \u8fd9\u6761\u8bb0\u5f55\u5e76\u4e14\u63d0\u4ea4\u4e8b\u52a1\u4e86\uff0c\u8fd9\u6837\u4e0d\u662f\u4f1a\u4ea7\u751f\u51b2\u7a81\u5417\uff0c\u6240\u4ee5 update \u7684\u65f6\u5019\u80af\u5b9a\u8981\u77e5\u9053\u6700\u65b0\u7684\u6570\u636e\u3002</p> <p>\u53e6\u5916\uff0c<code>select ... for update</code> \u8fd9\u79cd\u67e5\u8be2\u8bed\u53e5\u662f\u5f53\u524d\u8bfb\uff0c\u6bcf\u6b21\u6267\u884c\u7684\u65f6\u5019\u90fd\u662f\u8bfb\u53d6\u6700\u65b0\u7684\u6570\u636e\u3002 </p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5047\u8bbe<code>select ... for update</code>\u5f53\u524d\u8bfb\u662f\u4e0d\u4f1a\u52a0\u9501\u7684\uff08\u5b9e\u9645\u4e0a\u662f\u4f1a\u52a0\u9501\u7684\uff09\uff0c\u5728\u505a\u4e00\u904d\u5b9e\u9a8c\u3002</p> <p></p> <p>\u8fd9\u65f6\u5019\uff0c\u4e8b\u52a1 B \u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u5c31\u4f1a\u88ab\u4e8b\u52a1 A \u7684\u7b2c\u4e8c\u6761\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u5230\uff08\u56e0\u4e3a\u662f\u5f53\u524d\u8bfb\uff09\uff0c\u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0\u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u7ed3\u679c\u96c6\u5408\u4e0d\u4e00\u6837\uff0c\u8fd9\u5c31\u51fa\u73b0\u4e86\u5e7b\u8bfb\u3002</p> <p>\u6240\u4ee5\uff0cInnodb \u5f15\u64ce\u4e3a\u4e86\u89e3\u51b3\u300c\u53ef\u91cd\u590d\u8bfb\u300d\u9694\u79bb\u7ea7\u522b\u4f7f\u7528\u300c\u5f53\u524d\u8bfb\u300d\u800c\u9020\u6210\u7684\u5e7b\u8bfb\u95ee\u9898\uff0c\u5c31\u5f15\u51fa\u4e86\u95f4\u9699\u9501\u3002</p> <p>\u5047\u8bbe\uff0c\u8868\u4e2d\u6709\u4e00\u4e2a\u8303\u56f4 id \u4e3a\uff083\uff0c5\uff09\u95f4\u9699\u9501\uff0c\u90a3\u4e48\u5176\u4ed6\u4e8b\u52a1\u5c31\u65e0\u6cd5\u63d2\u5165 id = 4 \u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u7684\u9632\u6b62\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002</p> <p></p> <p>\u4e3e\u4e2a\u5177\u4f53\u4f8b\u5b50\uff0c\u573a\u666f\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e8b\u52a1 A \u6267\u884c\u4e86\u8fd9\u9762\u8fd9\u6761\u9501\u5b9a\u8bfb\u8bed\u53e5\u540e\uff0c\u5c31\u5728\u5bf9\u8868\u4e2d\u7684\u8bb0\u5f55\u52a0\u4e0a id \u8303\u56f4\u4e3a (2, +\u221e] \u7684 next-key lock\uff08next-key lock \u662f\u95f4\u9699\u9501 + \u8bb0\u5f55\u9501\u7684\u7ec4\u5408\uff09\u3002</p> <p>\u7136\u540e\uff0c\u4e8b\u52a1 B \u5728\u6267\u884c\u63d2\u5165\u8bed\u53e5\u7684\u65f6\u5019\uff0c\u5224\u65ad\u5230\u63d2\u5165\u7684\u4f4d\u7f6e\u88ab\u4e8b\u52a1 A \u52a0\u4e86  next-key lock\uff0c\u4e8e\u662f\u4e8b\u7269 B \u4f1a\u751f\u6210\u4e00\u4e2a\u63d2\u5165\u610f\u5411\u9501\uff0c\u540c\u65f6\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\uff0c\u76f4\u5230\u4e8b\u52a1 A \u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002\u8fd9\u5c31\u907f\u514d\u4e86\u7531\u4e8e\u4e8b\u52a1 B \u63d2\u5165\u65b0\u8bb0\u5f55\u800c\u5bfc\u81f4\u4e8b\u52a1 A \u53d1\u751f\u5e7b\u8bfb\u7684\u73b0\u8c61\u3002</p>"},{"location":"mysql/transaction/phantom/#_4","title":"\u5e7b\u8bfb\u88ab\u5b8c\u5168\u89e3\u51b3\u4e86\u5417\uff1f","text":"<p>\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\u867d\u7136\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u4e86\u5e7b\u8bfb\uff0c\u4f46\u662f\u8fd8\u662f\u6ca1\u6709\u80fd\u5b8c\u5168\u89e3\u51b3\u5e7b\u8bfb\u3002</p> <p>\u6211\u4e3e\u4f8b\u4e00\u4e2a\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f\u3002</p>"},{"location":"mysql/transaction/phantom/#_5","title":"\u7b2c\u4e00\u4e2a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f","text":"<p>\u8fd8\u662f\u4ee5\u8fd9\u5f20\u8868\u4f5c\u4e3a\u4f8b\u5b50\uff1a</p> <p></p> <p>\u4e8b\u52a1 A \u6267\u884c\u67e5\u8be2 id = 5 \u7684\u8bb0\u5f55\uff0c\u6b64\u65f6\u8868\u4e2d\u662f\u6ca1\u6709\u8be5\u8bb0\u5f55\u7684\uff0c\u6240\u4ee5\u67e5\u8be2\u4e0d\u51fa\u6765\u3002</p> SQL<pre><code># \u4e8b\u52a1 A\nmysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; select * from t_stu where id = 5;\nEmpty set (0.01 sec)\n</code></pre> <p>\u7136\u540e\u4e8b\u52a1 B \u63d2\u5165\u4e00\u6761 id = 5 \u7684\u8bb0\u5f55\uff0c\u5e76\u4e14\u63d0\u4ea4\u4e86\u4e8b\u52a1\u3002</p> SQL<pre><code># \u4e8b\u52a1 B\nmysql&gt; begin;\nQuery OK, 0 rows affected (0.00 sec)\n\nmysql&gt; insert into t_stu values(5, '\u5c0f\u7f8e', 18);\nQuery OK, 1 row affected (0.00 sec)\n\nmysql&gt; commit;\nQuery OK, 0 rows affected (0.00 sec)\n</code></pre> <p>\u6b64\u65f6\uff0c\u4e8b\u52a1 A  \u66f4\u65b0 id = 5 \u8fd9\u6761\u8bb0\u5f55\uff0c\u5bf9\u6ca1\u9519\uff0c\u4e8b\u52a1 A \u770b\u4e0d\u5230 id = 5 \u8fd9\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u4ed6\u53bb\u66f4\u65b0\u4e86\u8fd9\u6761\u8bb0\u5f55\uff0c\u8fd9\u573a\u666f\u786e\u5b9e\u5f88\u8fdd\u548c\uff0c\u7136\u540e\u518d\u6b21\u67e5\u8be2 id = 5 \u7684\u8bb0\u5f55\uff0c\u4e8b\u52a1 A \u5c31\u80fd\u770b\u5230\u4e8b\u52a1 B \u63d2\u5165\u7684\u7eaa\u5f55\u4e86\uff0c\u5e7b\u8bfb\u5c31\u662f\u53d1\u751f\u5728\u8fd9\u79cd\u8fdd\u548c\u7684\u573a\u666f\u3002</p> SQL<pre><code># \u4e8b\u52a1 A\nmysql&gt; update t_stu set name = '\u5c0f\u6797 coding' where id = 5;\nQuery OK, 1 row affected (0.01 sec)\nRows matched: 1  Changed: 1  Warnings: 0\n\nmysql&gt; select * from t_stu where id = 5;\n+----+--------------+------+\n| id | name         | age  |\n+----+--------------+------+\n|  5 | \u5c0f\u6797coding   |   18 |\n+----+--------------+------+\n1 row in set (0.00 sec)\n</code></pre> <p>\u6574\u4e2a\u53d1\u751f\u5e7b\u8bfb\u7684\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u5728\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u4e0b\uff0c\u4e8b\u52a1 A \u7b2c\u4e00\u6b21\u6267\u884c\u666e\u901a\u7684 select \u8bed\u53e5\u65f6\u751f\u6210\u4e86\u4e00\u4e2a ReadView\uff0c\u4e4b\u540e\u4e8b\u52a1 B \u5411\u8868\u4e2d\u65b0\u63d2\u5165\u4e86\u4e00\u6761 id = 5 \u7684\u8bb0\u5f55\u5e76\u63d0\u4ea4\u3002\u63a5\u7740\uff0c\u4e8b\u52a1 A \u5bf9 id = 5 \u8fd9\u6761\u8bb0\u5f55\u8fdb\u884c\u4e86\u66f4\u65b0\u64cd\u4f5c\uff0c\u5728\u8fd9\u4e2a\u65f6\u523b\uff0c\u8fd9\u6761\u65b0\u8bb0\u5f55\u7684 trx_id \u9690\u85cf\u5217\u7684\u503c\u5c31\u53d8\u6210\u4e86\u4e8b\u52a1 A \u7684\u4e8b\u52a1 id\uff0c\u4e4b\u540e\u4e8b\u52a1 A  \u518d\u4f7f\u7528\u666e\u901a select \u8bed\u53e5\u53bb\u67e5\u8be2\u8fd9\u6761\u8bb0\u5f55\u65f6\u5c31\u53ef\u4ee5\u770b\u5230\u8fd9\u6761\u8bb0\u5f55\u4e86\uff0c\u4e8e\u662f\u5c31\u53d1\u751f\u4e86\u5e7b\u8bfb\u3002</p> <p>\u56e0\u4e3a\u8fd9\u79cd\u7279\u6b8a\u73b0\u8c61\u7684\u5b58\u5728\uff0c\u6240\u4ee5\u6211\u4eec\u8ba4\u4e3a MySQL Innodb \u4e2d\u7684 MVCC \u5e76\u4e0d\u80fd\u5b8c\u5168\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u3002</p>"},{"location":"mysql/transaction/phantom/#_6","title":"\u7b2c\u4e8c\u4e2a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u7684\u573a\u666f","text":"<p>\u9664\u4e86\u4e0a\u9762\u8fd9\u4e00\u79cd\u573a\u666f\u4f1a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u4e4b\u5916\uff0c\u8fd8\u6709\u4e0b\u9762\u8fd9\u4e2a\u573a\u666f\u4e5f\u4f1a\u53d1\u751f\u5e7b\u8bfb\u73b0\u8c61\u3002</p> <ul> <li>T1 \u65f6\u523b\uff1a\u4e8b\u52a1 A \u5148\u6267\u884c\u300c\u5feb\u7167\u8bfb\u8bed\u53e5\u300d\uff1aselect * from t_test where id &gt; 100 \u5f97\u5230\u4e86 3 \u6761\u8bb0\u5f55\u3002</li> <li>T2 \u65f6\u523b\uff1a\u4e8b\u52a1 B \u5f80<code>t_test</code>\u8868\u4e2d\u63d2\u5165\u4e00\u4e2a id= 200 \u7684\u8bb0\u5f55\u5e76\u63d0\u4ea4\uff1b</li> <li>T3 \u65f6\u523b\uff1a\u4e8b\u52a1 A \u518d\u6267\u884c\u300c\u5f53\u524d\u8bfb\u8bed\u53e5\u300dselect * from t_test where id &gt; 100 for update \u5c31\u4f1a\u5f97\u5230 4 \u6761\u8bb0\u5f55\uff0c\u6b64\u65f6\u4e5f\u53d1\u751f\u4e86\u5e7b\u8bfb\u73b0\u8c61\u3002</li> </ul> <p>\u8981\u907f\u514d\u8fd9\u7c7b\u7279\u6b8a\u573a\u666f\u4e0b\u53d1\u751f\u5e7b\u8bfb\u7684\u73b0\u8c61\u7684\u8bdd\uff0c\u5c31\u662f\u5c3d\u91cf\u5728\u5f00\u542f\u4e8b\u52a1\u4e4b\u540e\uff0c\u9a6c\u4e0a\u6267\u884c select ... for update \u8fd9\u7c7b\u5f53\u524d\u8bfb\u7684\u8bed\u53e5\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5bf9\u8bb0\u5f55\u52a0 next-key lock\uff0c\u4ece\u800c\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\u3002</p>"},{"location":"mysql/transaction/phantom/#_7","title":"\u603b\u7ed3","text":"<p>MySQL InnoDB \u5f15\u64ce\u7684\u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\uff08\u9ed8\u8ba4\u9694\u79bb\u7ea7\uff09\uff0c\u6839\u636e\u4e0d\u540c\u7684\u67e5\u8be2\u65b9\u5f0f\uff0c\u5206\u522b\u63d0\u51fa\u4e86\u907f\u514d\u5e7b\u8bfb\u7684\u65b9\u6848\uff1a</p> <ul> <li>\u9488\u5bf9\u5feb\u7167\u8bfb\uff08\u666e\u901a select \u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 MVCC \u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\u3002</li> <li>\u9488\u5bf9\u5f53\u524d\u8bfb\uff08select ... for update \u7b49\u8bed\u53e5\uff09\uff0c\u662f\u901a\u8fc7 next-key lock\uff08\u8bb0\u5f55\u9501 + \u95f4\u9699\u9501\uff09\u65b9\u5f0f\u89e3\u51b3\u4e86\u5e7b\u8bfb\u3002</li> </ul> <p>\u6211\u4e3e\u4f8b\u4e86\u4e24\u4e2a\u53d1\u751f\u5e7b\u8bfb\u573a\u666f\u7684\u4f8b\u5b50\u3002</p> <p>\u7b2c\u4e00\u4e2a\u4f8b\u5b50\uff1a\u5bf9\u4e8e\u5feb\u7167\u8bfb\uff0cMVCC \u5e76\u4e0d\u80fd\u5b8c\u5168\u907f\u514d\u5e7b\u8bfb\u73b0\u8c61\u3002\u56e0\u4e3a\u5f53\u4e8b\u52a1 A \u66f4\u65b0\u4e86\u4e00\u6761\u4e8b\u52a1 B \u63d2\u5165\u7684\u8bb0\u5f55\uff0c\u90a3\u4e48\u4e8b\u52a1 A \u524d\u540e\u4e24\u6b21\u67e5\u8be2\u7684\u8bb0\u5f55\u6761\u76ee\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u6240\u4ee5\u5c31\u53d1\u751f\u5e7b\u8bfb\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\uff1a\u5bf9\u4e8e\u5f53\u524d\u8bfb\uff0c\u5982\u679c\u4e8b\u52a1\u5f00\u542f\u540e\uff0c\u5e76\u6ca1\u6709\u6267\u884c\u5f53\u524d\u8bfb\uff0c\u800c\u662f\u5148\u5feb\u7167\u8bfb\uff0c\u7136\u540e\u8fd9\u671f\u95f4\u5982\u679c\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e86\u4e00\u6761\u8bb0\u5f55\uff0c\u90a3\u4e48\u4e8b\u52a1\u540e\u7eed\u4f7f\u7528\u5f53\u524d\u8bfb\u8fdb\u884c\u67e5\u8be2\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u53d1\u73b0\u4e24\u6b21\u67e5\u8be2\u7684\u8bb0\u5f55\u6761\u76ee\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u6240\u4ee5\u5c31\u53d1\u751f\u5e7b\u8bfb\u3002</p> <p>\u6240\u4ee5\uff0cMySQL \u53ef\u91cd\u590d\u8bfb\u9694\u79bb\u7ea7\u522b\u5e76\u6ca1\u6709\u5f7b\u5e95\u89e3\u51b3\u5e7b\u8bfb\uff0c\u53ea\u662f\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u4e86\u5e7b\u8bfb\u73b0\u8c61\u7684\u53d1\u751f\u3002</p> <p>\u8981\u907f\u514d\u8fd9\u7c7b\u7279\u6b8a\u573a\u666f\u4e0b\u53d1\u751f\u5e7b\u8bfb\u7684\u73b0\u8c61\u7684\u8bdd\uff0c\u5c31\u662f\u5c3d\u91cf\u5728\u5f00\u542f\u4e8b\u52a1\u4e4b\u540e\uff0c\u9a6c\u4e0a\u6267\u884c select ... for update \u8fd9\u7c7b\u5f53\u524d\u8bfb\u7684\u8bed\u53e5\uff0c\u56e0\u4e3a\u5b83\u4f1a\u5bf9\u8bb0\u5f55\u52a0 next-key lock\uff0c\u4ece\u800c\u907f\u514d\u5176\u4ed6\u4e8b\u52a1\u63d2\u5165\u4e00\u6761\u65b0\u8bb0\u5f55\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/","title":"\u56fe\u89e3 Redis \u4ecb\u7ecd","text":"<p>\u300a\u56fe\u89e3 Redis\u300b\u76ee\u524d\u8fd8\u5728\u8fde\u8f7d\u66f4\u65b0\u4e2d\uff0c\u5927\u5bb6\u4e0d\u8981\u50ac\u5566:joy: \uff0c\u66f4\u65b0\u5b8c\u4f1a\u7b2c\u4e00\u65f6\u95f4\u6574\u7406 PDF \u7684\u3002</p> <p>\u76ee\u524d\u5df2\u7ecf\u66f4\u65b0\u597d\u7684\u6587\u7ae0\uff1a - \u9762\u8bd5\u7bc7 :point_down:    - Redis \u5e38\u89c1\u9762\u8bd5\u9898 - \u6570\u636e\u7c7b\u578b\u7bc7 :point_down:    - Redis \u6570\u636e\u7c7b\u578b\u548c\u5e94\u7528\u573a\u666f    - \u56fe\u89e3 Redis \u6570\u636e\u7ed3\u6784 - \u6301\u4e45\u5316\u7bc7 :point_down:     - AOF \u6301\u4e45\u5316\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f      - RDB \u5feb\u7167\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f      - Redis \u5927 Key \u5bf9\u6301\u4e45\u5316\u6709\u4ec0\u4e48\u5f71\u54cd\uff1f  - \u529f\u80fd\u7bc7:point_down:    - Redis \u8fc7\u671f\u5220\u9664\u7b56\u7565\u548c\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6709\u4ec0\u4e48\u533a\u522b\uff1f  - \u9ad8\u53ef\u7528\u7bc7 :point_down:    - \u4e3b\u4ece\u590d\u5236\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f    - \u4e3a\u4ec0\u4e48\u8981\u6709\u54e8\u5175\uff1f    - :joy:  \u6b63\u5728\u8d76\u7a3f\u7684\u8def\u4e0a\u3002\u3002\u3002\u3002\u3002 - \u7f13\u5b58\u7bc7 :point_down:    - \u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\u3001\u51fb\u7a7f\u3001\u7a7f\u900f\uff1f    - \u6570\u636e\u5e93\u548c\u7f13\u5b58\u5982\u4f55\u4fdd\u8bc1\u4e00\u81f4\u6027\uff1f </p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/architecture/mysql_redis_consistency/","title":"\u6570\u636e\u5e93\u548c\u7f13\u5b58\u5982\u4f55\u4fdd\u8bc1\u4e00\u81f4\u6027\uff1f","text":"<p>\u4e00\u5929\uff0c\u8001\u677f\u8bf4\u300c\u6700\u8fd1\u516c\u53f8\u7684\u7528\u6237\u8d8a\u6765\u8d8a\u591a\u4e86\uff0c\u4f46\u662f\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u901f\u5ea6\u8d8a\u6765\u8d8a\u5dee\u7684\uff0c\u963f\u65fa\u5e2e\u6211\u4f18\u5316\u4e0b\uff0c\u505a\u597d\u4e86\u7ed9\u4f60\u753b\u4e2a\u997c\uff01\u300d\u3002</p> <p></p> <p>\u7a0b\u5e8f\u5458\u963f\u65fa\u542c\u5230\u8001\u677f\u53e3\u4e2d\u7684\u300c\u753b\u997c\u300d\u540e\u5c31\u975e\u5e38\u671f\u5f85\uff0c\u6ca1\u6709\u4efb\u4f55\u72b9\u8c6b\u5c31\u63a5\u4e0b\u4e86\u8001\u677f\u7ed9\u7684\u8fd9\u4e2a\u4efb\u52a1\u3002</p> <p>\u963f\u65fa\u767b\u9646\u5230\u4e86\u670d\u52a1\u5668\uff0c\u7ecf\u8fc7\u4e00\u756a\u6392\u67e5\u540e\uff0c\u786e\u8ba4\u670d\u52a1\u5668\u7684\u6027\u80fd\u74f6\u9888\u662f\u5728\u6570\u636e\u5e93\u3002</p> <p>\u8fd9\u597d\u529e\uff0c\u7ed9\u670d\u52a1\u5668\u52a0\u4e0a Redis\uff0c\u8ba9\u5176\u4f5c\u4e3a\u6570\u636e\u5e93\u7684\u7f13\u5b58\u3002</p> <p>\u8fd9\u6837\uff0c\u5728\u5ba2\u6237\u7aef\u8bf7\u6c42\u6570\u636e\u65f6\uff0c\u5982\u679c\u80fd\u5728\u7f13\u5b58\u4e2d\u547d\u4e2d\u6570\u636e\uff0c\u90a3\u5c31\u67e5\u8be2\u7f13\u5b58\uff0c\u4e0d\u7528\u5728\u53bb\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u4ece\u800c\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u538b\u529b\uff0c\u63d0\u9ad8\u670d\u52a1\u5668\u7684\u6027\u80fd\u3002</p>"},{"location":"redis/architecture/mysql_redis_consistency/#_2","title":"\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u8fd8\u662f\u5148\u66f4\u65b0\u7f13\u5b58\uff1f","text":"<p>\u963f\u65fa\u6709\u4e86\u8fd9\u4e2a\u60f3\u6cd5\u540e\uff0c\u5c31\u51c6\u5907\u5f00\u59cb\u7740\u624b\u4f18\u5316\u670d\u52a1\u5668\uff0c\u4f46\u662f\u6321\u5728\u5728\u4ed6\u524d\u9762\u7684\u662f\u8fd9\u6837\u7684\u4e00\u4e2a\u95ee\u9898\u3002</p> <p></p> <p>\u7531\u4e8e\u5f15\u5165\u4e86\u7f13\u5b58\uff0c\u90a3\u4e48\u5728\u6570\u636e\u66f4\u65b0\u65f6\uff0c\u4e0d\u4ec5\u8981\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u800c\u4e14\u8981\u66f4\u65b0\u7f13\u5b58\uff0c\u8fd9\u4e24\u4e2a\u66f4\u65b0\u64cd\u4f5c\u5b58\u5728\u524d\u540e\u7684\u95ee\u9898\uff1a</p> <ul> <li>\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u66f4\u65b0\u7f13\u5b58\uff1b</li> <li>\u5148\u66f4\u65b0\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff1b</li> </ul> <p>\u963f\u65fa\u6ca1\u60f3\u5230\u592a\u591a\uff0c\u4ed6\u89c9\u5f97\u6700\u65b0\u7684\u6570\u636e\u80af\u5b9a\u8981\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u8fd9\u6837\u624d\u53ef\u4ee5\u786e\u4fdd\u6570\u636e\u5e93\u91cc\u7684\u6570\u636e\u662f\u6700\u65b0\u7684\uff0c\u4e8e\u662f\u4ed6\u5c31\u91c7\u7528\u4e86\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u66f4\u65b0\u7f13\u5b58\u300d\u7684\u65b9\u6848\u3002</p> <p>\u963f\u65fa\u7ecf\u8fc7\u51e0\u4e2a\u591c\u665a\u7684\u6298\u817e\uff0c\u7ec8\u4e8e\u300c\u4f18\u5316\u597d\u4e86\u670d\u52a1\u5668\u300d\uff0c\u7136\u540e\u5c31\u76f4\u63a5\u4e0a\u7ebf\u4e86\uff0c\u81ea\u4fe1\u5fc3\u6ee1\u6ee1\u8dd1\u53bb\u8ddf\u8001\u677f\u6c47\u62a5\u3002</p> <p>\u8001\u677f\u4e0d\u61c2\u6280\u672f\uff0c\u81ea\u7136\u4e5f\u6ca1\u591a\u8651\uff0c\u5c31\u8ba9\u540e\u7eed\u963f\u65fa\u89c2\u5bdf\u4e0b\u670d\u52a1\u5668\u7684\u60c5\u51b5\uff0c\u5982\u679c\u6548\u679c\u4e0d\u9519\uff0c\u5c31\u8ddf\u963f\u65fa\u8c08\u753b\u997c\u7684\u4e8b\u60c5\u3002</p> <p>\u963f\u65fa\u89c2\u5bdf\u4e86\u597d\u51e0\u5929\uff0c\u53d1\u73b0\u6570\u636e\u5e93\u7684\u538b\u529b\u5927\u5927\u51cf\u5c11\u4e86\uff0c\u8bbf\u95ee\u901f\u5ea6\u4e5f\u63d0\u9ad8\u4e86\u4e0d\u5c11\uff0c\u5fc3\u60f3\u8fd9\u4e8b\u80af\u5b9a\u6210\u7684\u4e86\u3002</p> <p>\u597d\u666f\u4e0d\u957f\uff0c\u7a81\u7136\u8001\u677f\u6536\u5230\u4e00\u4e2a\u5ba2\u6237\u7684\u6295\u8bc9\uff0c\u5ba2\u6237\u8bf4\u4ed6\u521a\u53d1\u8d77\u4e86\u4e24\u6b21\u66f4\u65b0\u5e74\u9f84\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u663e\u793a\u7684\u5e74\u9f84\u786e\u8fd8\u662f\u7b2c\u4e00\u6b21\u66f4\u65b0\u65f6\u7684\u5e74\u9f84\uff0c\u800c\u7b2c\u4e8c\u6b21\u66f4\u65b0\u5e74\u9f84\u5e76\u6ca1\u6709\u751f\u6548\u3002</p> <p>\u8001\u677f\u7acb\u9a6c\u5c31\u627e\u4e86\u963f\u65fa\uff0c\u8bad\u65a5\u7740\u963f\u65fa\u8bf4\uff1a\u300c\u8fd9\u4e48\u7b80\u5355\u7684\u66f4\u65b0\u64cd\u4f5c\uff0c\u90fd\u6709 bug\uff1f\u6211\u8138\u5f80\u54ea\u513f\u653e\uff1f\u4f60\u7684\u997c\u8fd8\u8981\u4e0d\u8981\u4e86\uff1f\u300d</p> <p>\u542c\u5230\u81ea\u5df1\u51c6\u5907\u5230\u624b\u7684\u997c\u8981\u6ca1\u4e86\u7684\u963f\u65fa\u77ac\u95f4\u5c31\u614c\u4e86\uff0c\u7acb\u9a6c\u767b\u9646\u670d\u52a1\u5668\u6392\u67e5\u95ee\u9898\uff0c\u963f\u65fa\u67e5\u8be2\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u540e\u53d1\u73b0\u4e86\u95ee\u9898\u3002</p> <p>\u6570\u636e\u5e93\u7684\u6570\u636e\u662f\u5ba2\u6237\u7b2c\u4e8c\u6b21\u66f4\u65b0\u64cd\u4f5c\u7684\u6570\u636e\uff0c\u800c\u7f13\u5b58\u786e\u8fd8\u662f\u7b2c\u4e00\u6b21\u66f4\u65b0\u64cd\u4f5c\u7684\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u51fa\u73b0\u4e86\u6570\u636e\u5e93\u548c\u7f13\u5b58\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u53ef\u5927\u4e86\uff0c\u963f\u65fa\u7ecf\u8fc7\u4e00\u8f6e\u7684\u5206\u6790\uff0c\u9020\u6210\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u73b0\u8c61\uff0c\u662f\u56e0\u4e3a\u5e76\u53d1\u95ee\u9898\uff01</p>"},{"location":"redis/architecture/mysql_redis_consistency/#_3","title":"\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u66f4\u65b0\u7f13\u5b58","text":"<p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u300c\u8bf7\u6c42 A\u300d\u548c\u300c\u8bf7\u6c42 B\u300d\u4e24\u4e2a\u8bf7\u6c42\uff0c\u540c\u65f6\u66f4\u65b0\u300c\u540c\u4e00\u6761\u300d\u6570\u636e\uff0c\u5219\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u987a\u5e8f\uff1a</p> <p></p> <p>A \u8bf7\u6c42\u5148\u5c06\u6570\u636e\u5e93\u7684\u6570\u636e\u66f4\u65b0\u4e3a 1\uff0c\u7136\u540e\u5728\u66f4\u65b0\u7f13\u5b58\u524d\uff0c\u8bf7\u6c42 B \u5c06\u6570\u636e\u5e93\u7684\u6570\u636e\u66f4\u65b0\u4e3a 2\uff0c\u7d27\u63a5\u7740\u4e5f\u628a\u7f13\u5b58\u66f4\u65b0\u4e3a 2\uff0c\u7136\u540e A \u8bf7\u6c42\u66f4\u65b0\u7f13\u5b58\u4e3a 1\u3002</p> <p>\u6b64\u65f6\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u662f 2\uff0c\u800c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u5374\u662f 1\uff0c\u51fa\u73b0\u4e86\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u73b0\u8c61\u3002</p>"},{"location":"redis/architecture/mysql_redis_consistency/#_4","title":"\u5148\u66f4\u65b0\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93","text":"<p>\u90a3\u6362\u6210\u300c\u5148\u66f4\u65b0\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\u300d\u8fd9\u4e2a\u65b9\u6848\uff0c\u8fd8\u4f1a\u6709\u95ee\u9898\u5417\uff1f</p> <p>\u4f9d\u7136\u8fd8\u662f\u5b58\u5728\u5e76\u53d1\u7684\u95ee\u9898\uff0c\u5206\u6790\u601d\u8def\u4e5f\u662f\u4e00\u6837\u3002</p> <p>\u5047\u8bbe\u300c\u8bf7\u6c42 A\u300d\u548c\u300c\u8bf7\u6c42 B\u300d\u4e24\u4e2a\u8bf7\u6c42\uff0c\u540c\u65f6\u66f4\u65b0\u300c\u540c\u4e00\u6761\u300d\u6570\u636e\uff0c\u5219\u53ef\u80fd\u51fa\u73b0\u8fd9\u6837\u7684\u987a\u5e8f\uff1a</p> <p></p> <p>A \u8bf7\u6c42\u5148\u5c06\u7f13\u5b58\u7684\u6570\u636e\u66f4\u65b0\u4e3a 1\uff0c\u7136\u540e\u5728\u66f4\u65b0\u6570\u636e\u5e93\u524d\uff0cB \u8bf7\u6c42\u6765\u4e86\uff0c\u5c06\u7f13\u5b58\u7684\u6570\u636e\u66f4\u65b0\u4e3a 2\uff0c\u7d27\u63a5\u7740\u628a\u6570\u636e\u5e93\u66f4\u65b0\u4e3a 2\uff0c\u7136\u540e A \u8bf7\u6c42\u5c06\u6570\u636e\u5e93\u7684\u6570\u636e\u66f4\u65b0\u4e3a 1\u3002</p> <p>\u6b64\u65f6\uff0c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u662f 1\uff0c\u800c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u5374\u662f 2\uff0c\u51fa\u73b0\u4e86\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u73b0\u8c61\u3002</p> <p>\u6240\u4ee5\uff0c\u65e0\u8bba\u662f\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u66f4\u65b0\u7f13\u5b58\u300d\uff0c\u8fd8\u662f\u300c\u5148\u66f4\u65b0\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\u300d\uff0c\u8fd9\u4e24\u4e2a\u65b9\u6848\u90fd\u5b58\u5728\u5e76\u53d1\u95ee\u9898\uff0c\u5f53\u4e24\u4e2a\u8bf7\u6c42\u5e76\u53d1\u66f4\u65b0\u540c\u4e00\u6761\u6570\u636e\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u51fa\u73b0\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u73b0\u8c61\u3002</p>"},{"location":"redis/architecture/mysql_redis_consistency/#_5","title":"\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u8fd8\u662f\u5148\u5220\u9664\u7f13\u5b58\uff1f","text":"<p>\u963f\u65fa\u5b9a\u4f4d\u51fa\u95ee\u9898\u540e\uff0c\u601d\u8003\u4e86\u4e00\u756a\u540e\uff0c\u51b3\u5b9a\u5728\u66f4\u65b0\u6570\u636e\u65f6\uff0c\u4e0d\u66f4\u65b0\u7f13\u5b58\uff0c\u800c\u662f\u5220\u9664\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u3002\u7136\u540e\uff0c\u5230\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u53d1\u73b0\u7f13\u5b58\u4e2d\u6ca1\u4e86\u6570\u636e\u4e4b\u540e\uff0c\u518d\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u66f4\u65b0\u5230\u7f13\u5b58\u4e2d\u3002</p> <p>\u963f\u65fa\u60f3\u7684\u8fd9\u4e2a\u7b56\u7565\u662f\u6709\u540d\u5b57\u7684\uff0c\u662f\u53eb Cache Aside \u7b56\u7565\uff0c\u4e2d\u6587\u662f\u53eb\u65c1\u8def\u7f13\u5b58\u7b56\u7565\u3002</p> <p>\u8be5\u7b56\u7565\u53c8\u53ef\u4ee5\u7ec6\u5206\u4e3a\u300c\u8bfb\u7b56\u7565\u300d\u548c\u300c\u5199\u7b56\u7565\u300d\u3002</p> <p></p> <p>\u5199\u7b56\u7565\u7684\u6b65\u9aa4\uff1a</p> <ul> <li>\u66f4\u65b0\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\uff1b</li> <li>\u5220\u9664\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u3002</li> </ul> <p>\u8bfb\u7b56\u7565\u7684\u6b65\u9aa4\uff1a</p> <ul> <li>\u5982\u679c\u8bfb\u53d6\u7684\u6570\u636e\u547d\u4e2d\u4e86\u7f13\u5b58\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u6570\u636e\uff1b</li> <li>\u5982\u679c\u8bfb\u53d6\u7684\u6570\u636e\u6ca1\u6709\u547d\u4e2d\u7f13\u5b58\uff0c\u5219\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u5c06\u6570\u636e\u5199\u5165\u5230\u7f13\u5b58\uff0c\u5e76\u4e14\u8fd4\u56de\u7ed9\u7528\u6237\u3002</li> </ul> <p>\u963f\u65fa\u5728\u60f3\u5230\u300c\u5199\u7b56\u7565\u300d\u7684\u65f6\u5019\uff0c\u53c8\u9677\u5165\u66f4\u6df1\u5c42\u6b21\u7684\u601d\u8003\uff0c\u5230\u5e95\u8be5\u9009\u62e9\u54ea\u79cd\u987a\u5e8f\u5462\uff1f</p> <ul> <li>\u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff1b</li> <li>\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u3002</li> </ul> <p>\u963f\u65fa\u8fd9\u6b21\u7ecf\u8fc7\u4e0a\u6b21\u6559\u8bad\uff0c\u4e0d\u518d\u300c\u60f3\u5f53\u7136\u300d\u7684\u4e71\u9009\u65b9\u6848\uff0c\u56e0\u4e3a\u8001\u677f\u8fd9\u6b21\u7ed9\u7684\u997c\u5f88\u5927\u554a\uff0c\u5fc5\u987b\u628a\u63e1\u4f4f\u3002</p> <p>\u4e8e\u662f\u963f\u65fa\u7528\u5e76\u53d1\u7684\u89d2\u5ea6\u6765\u5206\u6790\uff0c\u770b\u770b\u8fd9\u4e24\u79cd\u65b9\u6848\u54ea\u4e2a\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u5e93\u4e0e\u7f13\u5b58\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002</p>"},{"location":"redis/architecture/mysql_redis_consistency/#_6","title":"\u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93","text":"<p>\u963f\u65fa\u8fd8\u662f\u4ee5\u7528\u6237\u8868\u7684\u573a\u666f\u6765\u5206\u6790\u3002</p> <p>\u5047\u8bbe\u67d0\u4e2a\u7528\u6237\u7684\u5e74\u9f84\u662f 20\uff0c\u8bf7\u6c42 A \u8981\u66f4\u65b0\u7528\u6237\u5e74\u9f84\u4e3a 21\uff0c\u6240\u4ee5\u5b83\u4f1a\u5220\u9664\u7f13\u5b58\u4e2d\u7684\u5185\u5bb9\u3002\u8fd9\u65f6\uff0c\u53e6\u4e00\u4e2a\u8bf7\u6c42 B \u8981\u8bfb\u53d6\u8fd9\u4e2a\u7528\u6237\u7684\u5e74\u9f84\uff0c\u5b83\u67e5\u8be2\u7f13\u5b58\u53d1\u73b0\u672a\u547d\u4e2d\u540e\uff0c\u4f1a\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5230\u5e74\u9f84\u4e3a 20\uff0c\u5e76\u4e14\u5199\u5165\u5230\u7f13\u5b58\u4e2d\uff0c\u7136\u540e\u8bf7\u6c42 A \u7ee7\u7eed\u66f4\u6539\u6570\u636e\u5e93\uff0c\u5c06\u7528\u6237\u7684\u5e74\u9f84\u66f4\u65b0\u4e3a 21\u3002</p> <p></p> <p>\u6700\u7ec8\uff0c\u8be5\u7528\u6237\u5e74\u9f84\u5728\u7f13\u5b58\u4e2d\u662f 20\uff08\u65e7\u503c\uff09\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u662f 21\uff08\u65b0\u503c\uff09\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u5728\u300c\u8bfb + \u5199\u300d\u5e76\u53d1\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u4f1a\u51fa\u73b0\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002</p>"},{"location":"redis/architecture/mysql_redis_consistency/#_7","title":"\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58","text":"<p>\u7ee7\u7eed\u7528\u300c\u8bfb + \u5199\u300d\u8bf7\u6c42\u7684\u5e76\u53d1\u7684\u573a\u666f\u6765\u5206\u6790\u3002</p> <p>\u5047\u5982\u67d0\u4e2a\u7528\u6237\u6570\u636e\u5728\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\uff0c\u8bf7\u6c42 A \u8bfb\u53d6\u6570\u636e\u65f6\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u5230\u5e74\u9f84\u4e3a 20\uff0c\u5728\u672a\u5199\u5165\u7f13\u5b58\u4e2d\u65f6\u53e6\u4e00\u4e2a\u8bf7\u6c42 B \u66f4\u65b0\u6570\u636e\u3002\u5b83\u66f4\u65b0\u6570\u636e\u5e93\u4e2d\u7684\u5e74\u9f84\u4e3a 21\uff0c\u5e76\u4e14\u6e05\u7a7a\u7f13\u5b58\u3002\u8fd9\u65f6\u8bf7\u6c42 A \u628a\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u5230\u7684\u5e74\u9f84\u4e3a 20 \u7684\u6570\u636e\u5199\u5165\u5230\u7f13\u5b58\u4e2d\u3002</p> <p></p> <p>\u6700\u7ec8\uff0c\u8be5\u7528\u6237\u5e74\u9f84\u5728\u7f13\u5b58\u4e2d\u662f 20\uff08\u65e7\u503c\uff09\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u662f 21\uff08\u65b0\u503c\uff09\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u3002</p> <p>\u4ece\u4e0a\u9762\u7684\u7406\u8bba\u4e0a\u5206\u6790\uff0c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u4e5f\u662f\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4e2d\uff0c\u8fd9\u4e2a\u95ee\u9898\u51fa\u73b0\u7684\u6982\u7387\u5e76\u4e0d\u9ad8\u3002</p> <p>\u56e0\u4e3a\u7f13\u5b58\u7684\u5199\u5165\u901a\u5e38\u8981\u8fdc\u8fdc\u5feb\u4e8e\u6570\u636e\u5e93\u7684\u5199\u5165\uff0c\u6240\u4ee5\u5728\u5b9e\u9645\u4e2d\u5f88\u96be\u51fa\u73b0\u8bf7\u6c42 B \u5df2\u7ecf\u66f4\u65b0\u4e86\u6570\u636e\u5e93\u5e76\u4e14\u5220\u9664\u4e86\u7f13\u5b58\uff0c\u8bf7\u6c42 A \u624d\u66f4\u65b0\u5b8c\u7f13\u5b58\u7684\u60c5\u51b5\u3002</p> <p>\u800c\u4e00\u65e6\u8bf7\u6c42 A \u65e9\u4e8e\u8bf7\u6c42 B \u5220\u9664\u7f13\u5b58\u4e4b\u524d\u66f4\u65b0\u4e86\u7f13\u5b58\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u7684\u8bf7\u6c42\u5c31\u4f1a\u56e0\u4e3a\u7f13\u5b58\u4e0d\u547d\u4e2d\u800c\u4ece\u6570\u636e\u5e93\u4e2d\u91cd\u65b0\u8bfb\u53d6\u6570\u636e\uff0c\u6240\u4ee5\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u3002</p> <p>\u6240\u4ee5\uff0c\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93 + \u518d\u5220\u9664\u7f13\u5b58\u300d\u7684\u65b9\u6848\uff0c\u662f\u53ef\u4ee5\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u7684\u3002</p> <p>\u800c\u4e14\u963f\u65fa\u4e3a\u4e86\u786e\u4fdd\u4e07\u65e0\u4e00\u5931\uff0c\u8fd8\u7ed9\u7f13\u5b58\u6570\u636e\u52a0\u4e0a\u4e86\u300c\u8fc7\u671f\u65f6\u95f4\u300d\uff0c\u5c31\u7b97\u5728\u8fd9\u671f\u95f4\u5b58\u5728\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u6709\u8fc7\u671f\u65f6\u95f4\u6765\u515c\u5e95\uff0c\u8fd9\u6837\u4e5f\u80fd\u8fbe\u5230\u6700\u7ec8\u4e00\u81f4\u3002</p> <p>\u963f\u65fa\u601d\u8003\u5230\u8fd9\u4e00\u6b65\u540e\uff0c\u89c9\u5f97\u81ea\u5df1\u771f\u7684\u662f\u4e2a\u5c0f\u5929\u624d\uff0c\u56e0\u4e3a\u4ed6\u7adf\u7136\u60f3\u5230\u4e86\u4e2a\u300c\u5929\u8863\u65e0\u7f1d\u300d\u7684\u65b9\u6848\uff0c\u4ed6\u4e8c\u8bdd\u4e0d\u8bf4\u5c31\u91c7\u7528\u4e86\u8fd9\u4e2a\u65b9\u6848\uff0c\u53c8\u7ecf\u8fc7\u51e0\u5929\u7684\u6298\u817e\uff0c\u7ec8\u4e8e\u5b8c\u6210\u4e86\u3002</p> <p>\u4ed6\u81ea\u4fe1\u6ee1\u6ee1\u7684\u5411\u8001\u677f\u6c47\u62a5\uff0c\u5df2\u7ecf\u89e3\u51b3\u4e86\u4e0a\u6b21\u5ba2\u6237\u7684\u6295\u8bc9\u7684\u95ee\u9898\u4e86\u3002\u8001\u677f\u89c9\u5f97\u963f\u65fa\u8fd9\u5c0f\u4f19\u5b50\u4e0d\u9519\uff0c\u8fd9\u4e48\u5feb\u5c31\u89e3\u51b3\u95ee\u9898\u4e86\uff0c\u7136\u540e\u8ba9\u963f\u65fa\u5728\u89c2\u5bdf\u51e0\u5929\u3002</p> <p>\u4e8b\u60c5\u54ea\u6709\u8fd9\u4e48\u987a\u5229\u5462\uff1f\u7ed3\u679c\u53c8\u6ca1\u8fc7\u591a\u4e45\uff0c\u8001\u677f\u53c8\u6536\u5230\u5ba2\u6237\u7684\u6295\u8bc9\u4e86\uff0c\u8bf4\u81ea\u5df1\u660e\u660e\u66f4\u65b0\u4e86\u6570\u636e\uff0c\u4f46\u662f\u6570\u636e\u8981\u8fc7\u4e00\u6bb5\u65f6\u95f4\u624d\u751f\u6548\uff0c\u5ba2\u6237\u63a5\u53d7\u4e0d\u4e86\u3002</p> <p>\u8001\u677f\u9762\u65e0\u8868\u60c5\u7684\u627e\u4e0a\u963f\u65fa\uff0c\u8ba9\u963f\u65fa\u5c3d\u5feb\u67e5\u51fa\u95ee\u9898\u3002</p> <p>\u963f\u65fa\u5f97\u77e5\u53c8\u6709 Bug \u5c31\u66f4\u614c\u4e86\uff0c\u7acb\u9a6c\u5c31\u767b\u5f55\u670d\u52a1\u5668\u53bb\u6392\u67e5\u95ee\u9898\uff0c\u67e5\u770b\u65e5\u5fd7\u540e\u5f97\u77e5\u4e86\u539f\u56e0\u3002</p> <p>\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u300d\u5176\u5b9e\u662f\u4e24\u4e2a\u64cd\u4f5c\uff0c\u524d\u9762\u7684\u6240\u6709\u5206\u6790\u90fd\u662f\u5efa\u7acb\u5728\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u90fd\u80fd\u540c\u65f6\u6267\u884c\u6210\u529f\uff0c\u800c\u8fd9\u6b21\u5ba2\u6237\u6295\u8bc9\u7684\u95ee\u9898\u5c31\u5728\u4e8e\uff0c\u5728\u5220\u9664\u7f13\u5b58\uff08\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff09\u7684\u65f6\u5019\u5931\u8d25\u4e86\uff0c\u5bfc\u81f4\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u662f\u65e7\u503c\u3002</p> <p>\u597d\u5728\u4e4b\u524d\u7ed9\u7f13\u5b58\u52a0\u4e0a\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u6240\u4ee5\u624d\u4f1a\u51fa\u73b0\u5ba2\u6237\u8bf4\u7684\u8fc7\u4e00\u6bb5\u65f6\u95f4\u624d\u66f4\u65b0\u751f\u6548\u7684\u73b0\u8c61\uff0c\u5047\u8bbe\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u7684\u515c\u5e95\uff0c\u90a3\u540e\u7eed\u7684\u8bf7\u6c42\u8bfb\u5230\u7684\u5c31\u4f1a\u4e00\u76f4\u662f\u7f13\u5b58\u4e2d\u7684\u65e7\u6570\u636e\uff0c\u8fd9\u6837\u95ee\u9898\u5c31\u66f4\u5927\u4e86\u3002</p> <p>\u6240\u4ee5\u65b0\u7684\u95ee\u9898\u6765\u4e86\uff0c\u5982\u4f55\u4fdd\u8bc1\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u300d\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u80fd\u6267\u884c\u6210\u529f\uff1f</p> <p>\u963f\u65fa\u5206\u6790\u51fa\u95ee\u9898\u540e\uff0c\u614c\u614c\u5f20\u5f20\u7684\u5411\u8001\u677f\u6c47\u62a5\u4e86\u95ee\u9898\u3002</p> <p>\u8001\u677f\u77e5\u9053\u4e8b\u60c5\u540e\uff0c\u53c8\u7ed9\u4e86\u963f\u65fa\u51e0\u5929\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u753b\u997c\u7684\u4e8b\u60c5\u8fd9\u6b21\u6ca1\u6709\u518d\u63d0\u4e86\u3002</p> <p>\u963f\u65fa\u4f1a\u7528\u4ec0\u4e48\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f</p> <p>\u8001\u677f\u753b\u7684\u997c\u4e8b\u60c5\uff0c\u80fd\u5426\u5151\u73b0\u7ed9\u963f\u65fa\u5462\uff1f</p> <p>\u9884\u77e5\u540e\u4e8b\uff0c\u4e14\u542c\u4e0b\u56de\u963f\u65fa\u7684\u6545\u4e8b\u3002</p> <p></p>"},{"location":"redis/architecture/mysql_redis_consistency/#_8","title":"\u5c0f\u7ed3","text":"<p>\u963f\u65fa\u7684\u4e8b\u60c5\u5c31\u804a\u5230\u8fd9\uff0c\u6211\u4eec\u7ee7\u7eed\u8bf4\u70b9\u5176\u4ed6\u3002</p> <p>\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u300d\u7684\u65b9\u6848\u867d\u7136\u4fdd\u8bc1\u4e86\u6570\u636e\u5e93\u4e0e\u7f13\u5b58\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f46\u662f\u6bcf\u6b21\u66f4\u65b0\u6570\u636e\u7684\u65f6\u5019\uff0c\u7f13\u5b58\u7684\u6570\u636e\u90fd\u4f1a\u88ab\u5220\u9664\uff0c\u8fd9\u6837\u4f1a\u5bf9\u7f13\u5b58\u7684\u547d\u4e2d\u7387\u5e26\u6765\u5f71\u54cd\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u6211\u4eec\u7684\u4e1a\u52a1\u5bf9\u7f13\u5b58\u547d\u4e2d\u7387\u6709\u5f88\u9ad8\u7684\u8981\u6c42\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u300c\u66f4\u65b0\u6570\u636e\u5e93 + \u66f4\u65b0\u7f13\u5b58\u300d\u7684\u65b9\u6848\uff0c\u56e0\u4e3a\u66f4\u65b0\u7f13\u5b58\u5e76\u4e0d\u4f1a\u51fa\u73b0\u7f13\u5b58\u672a\u547d\u4e2d\u7684\u60c5\u51b5\u3002</p> <p>\u4f46\u662f\u8fd9\u4e2a\u65b9\u6848\u524d\u9762\u6211\u4eec\u4e5f\u5206\u6790\u8fc7\uff0c\u5728\u4e24\u4e2a\u66f4\u65b0\u8bf7\u6c42\u5e76\u53d1\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u66f4\u65b0\u6570\u636e\u5e93\u548c\u66f4\u65b0\u7f13\u5b58\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u662f\u72ec\u7acb\u7684\uff0c\u800c\u6211\u4eec\u53c8\u6ca1\u6709\u5bf9\u64cd\u4f5c\u505a\u4efb\u4f55\u5e76\u53d1\u63a7\u5236\uff0c\u90a3\u4e48\u5f53\u4e24\u4e2a\u7ebf\u7a0b\u5e76\u53d1\u66f4\u65b0\u5b83\u4eec\u7684\u8bdd\uff0c\u5c31\u4f1a\u56e0\u4e3a\u5199\u5165\u987a\u5e8f\u7684\u4e0d\u540c\u9020\u6210\u6570\u636e\u7684\u4e0d\u4e00\u81f4\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u5f97\u589e\u52a0\u4e00\u4e9b\u624b\u6bb5\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u8fd9\u91cc\u63d0\u4f9b\u4e24\u79cd\u505a\u6cd5\uff1a</p> <ul> <li>\u5728\u66f4\u65b0\u7f13\u5b58\u524d\u5148\u52a0\u4e2a\u5206\u5e03\u5f0f\u9501\uff0c\u4fdd\u8bc1\u540c\u4e00\u65f6\u95f4\u53ea\u8fd0\u884c\u4e00\u4e2a\u8bf7\u6c42\u66f4\u65b0\u7f13\u5b58\uff0c\u5c31\u4e0d\u4f1a\u4ea7\u751f\u5e76\u53d1\u95ee\u9898\u4e86\uff0c\u5f53\u7136\uff0c\u5728\u5f15\u5165\u9501\u4e4b\u540e\uff0c\u4f1a\u5bf9\u5199\u5165\u6027\u80fd\u4ea7\u751f\u5f71\u54cd\u3002</li> <li>\u5728\u66f4\u65b0\u5b8c\u7f13\u5b58\u65f6\uff0c\u7ed9\u7f13\u5b58\u52a0\u4e0a\u8f83\u77ed\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u6837\u5373\u4f7f\u51fa\u73b0\u7f13\u5b58\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u7f13\u5b58\u7684\u6570\u636e\u4e5f\u4f1a\u5f88\u5feb\u8fc7\u671f\uff0c\u5bf9\u4e1a\u52a1\u8fd8\u662f\u80fd\u63a5\u53d7\u7684\u3002</li> </ul> <p>\u5bf9\u4e86\uff0c\u9488\u5bf9\u300c\u5148\u5220\u9664\u7f13\u5b58\uff0c\u518d\u66f4\u65b0\u6570\u636e\u5e93\u300d\u65b9\u6848\u5728\u300c\u8bfb + \u5199\u300d\u5e76\u53d1\u8bf7\u6c42\u800c\u9020\u6210\u7f13\u5b58\u4e0d\u4e00\u81f4\u7684\u89e3\u51b3\u529e\u6cd5\u662f\u300c\u5ef6\u8fdf\u53cc\u5220\u300d\u3002</p> <p>\u5ef6\u8fdf\u53cc\u5220\u5b9e\u73b0\u7684\u4f2a\u4ee3\u7801\u5982\u4e0b\uff1a</p> Text Only<pre><code>#\u5220\u9664\u7f13\u5b58\nredis.delKey(X)\n#\u66f4\u65b0\u6570\u636e\u5e93\ndb.update(X)\n#\u7761\u7720\nThread.sleep(N)\n#\u518d\u5220\u9664\u7f13\u5b58\nredis.delKey(X)\n</code></pre> <p>\u52a0\u4e86\u4e2a\u7761\u7720\u65f6\u95f4\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u786e\u4fdd\u8bf7\u6c42 A \u5728\u7761\u7720\u7684\u65f6\u5019\uff0c\u8bf7\u6c42 B \u80fd\u591f\u5728\u8fd9\u8fd9\u4e00\u6bb5\u65f6\u95f4\u5b8c\u6210\u300c\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\uff0c\u518d\u628a\u7f3a\u5931\u7684\u7f13\u5b58\u5199\u5165\u7f13\u5b58\u300d\u7684\u64cd\u4f5c\uff0c\u7136\u540e\u8bf7\u6c42 A \u7761\u7720\u5b8c\uff0c\u518d\u5220\u9664\u7f13\u5b58\u3002</p> <p>\u6240\u4ee5\uff0c\u8bf7\u6c42 A \u7684\u7761\u7720\u65f6\u95f4\u5c31\u9700\u8981\u5927\u4e8e\u8bf7\u6c42 B\u300c\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e + \u5199\u5165\u7f13\u5b58\u300d\u7684\u65f6\u95f4\u3002</p> <p>\u4f46\u662f\u5177\u4f53\u7761\u7720\u591a\u4e45\u5176\u5b9e\u662f\u4e2a\u7384\u5b66\uff0c\u5f88\u96be\u8bc4\u4f30\u51fa\u6765\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65b9\u6848\u4e5f\u53ea\u662f\u5c3d\u53ef\u80fd\u4fdd\u8bc1\u4e00\u81f4\u6027\u800c\u5df2\uff0c\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u4f9d\u7136\u4e5f\u4f1a\u51fa\u73b0\u7f13\u5b58\u4e0d\u4e00\u81f4\u7684\u73b0\u8c61\u3002</p> <p>\u56e0\u6b64\uff0c\u8fd8\u662f\u6bd4\u8f83\u5efa\u8bae\u7528\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u300d\u7684\u65b9\u6848\u3002</p>"},{"location":"redis/architecture/mysql_redis_consistency/#_9","title":"\u524d\u60c5\u56de\u987e","text":"<p>\u4e0a\u56de\u7a0b\u5e8f\u5458\u963f\u65fa\u4e3a\u4e86\u63d0\u5347\u6570\u636e\u8bbf\u95ee\u7684\u6027\u80fd\uff0c\u5f15\u5165 Redis \u4f5c\u4e3a MySQL \u7f13\u5b58\u5c42\uff0c\u4f46\u662f\u8fd9\u4ef6\u4e8b\u60c5\u5e76\u4e0d\u662f\u90a3\u4e48\u7b80\u5355\uff0c\u56e0\u4e3a\u8fd8\u8981\u8003\u8651 Redis \u548c MySQL \u53cc\u5199\u4e00\u81f4\u6027\u7684\u95ee\u9898\u3002</p> <p>\u963f\u65fa\u7ecf\u8fc7\u4e00\u756a\u5468\u6298\uff0c\u6700\u7ec8\u9009\u7528\u4e86\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u7f13\u5b58\u300d\u7684\u7b56\u7565\uff0c\u539f\u56e0\u662f\u8fd9\u4e2a\u7b56\u7565\u5373\u4f7f\u5728\u5e76\u53d1\u8bfb\u5199\u65f6\uff0c\u4e5f\u80fd\u6700\u5927\u7a0b\u5ea6\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\u3002</p> <p>\u806a\u660e\u7684\u963f\u65fa\u8fd8\u641e\u4e86\u4e2a\u515c\u5e95\u7684\u65b9\u6848\uff0c\u5c31\u662f\u7ed9\u7f13\u5b58\u52a0\u4e0a\u4e86\u8fc7\u671f\u65f6\u95f4\u3002</p> <p>\u672c\u4ee5\u4e3a\u5c31\u8fd9\u6837\u4e0d\u4f1a\u5728\u51fa\u73b0\u6570\u636e\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u7ed3\u679c\u5c06\u529f\u80fd\u4e0a\u7ebf\u540e\uff0c\u8001\u677f\u8fd8\u662f\u6536\u5230\u7528\u6237\u7684\u6295\u8bc9\u300c\u8bf4\u81ea\u5df1\u660e\u660e\u66f4\u65b0\u4e86\u6570\u636e\uff0c\u4f46\u662f\u6570\u636e\u8981\u8fc7\u4e00\u6bb5\u65f6\u95f4\u624d\u751f\u6548\u300d\uff0c\u5ba2\u6237\u63a5\u53d7\u4e0d\u4e86\u3002</p> <p>\u8001\u677f\u8f6c\u544a\u7ed9\u4e86\u963f\u65fa\uff0c\u963f\u65fa\u5f97\u77e5\u53c8\u6709 Bug \u5c31\u66f4\u614c\u4e86\uff0c\u7acb\u9a6c\u5c31\u767b\u5f55\u670d\u52a1\u5668\u53bb\u6392\u67e5\u95ee\u9898\uff0c\u67e5\u770b\u65e5\u5fd7\u540e\u5f97\u77e5\u4e86\u539f\u56e0\u3002</p> <p>\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u300d\u5176\u5b9e\u662f\u4e24\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u6b21\u5ba2\u6237\u6295\u8bc9\u7684\u95ee\u9898\u5c31\u5728\u4e8e\uff0c\u5728\u5220\u9664\u7f13\u5b58\uff08\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff09\u7684\u65f6\u5019\u5931\u8d25\u4e86\uff0c\u5bfc\u81f4\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u662f\u65e7\u503c\uff0c\u800c\u6570\u636e\u5e93\u662f\u6700\u65b0\u503c\u3002</p> <p>\u597d\u5728\u4e4b\u524d\u7ed9\u7f13\u5b58\u52a0\u4e0a\u4e86\u8fc7\u671f\u65f6\u95f4\uff0c\u6240\u4ee5\u624d\u4f1a\u51fa\u73b0\u5ba2\u6237\u8bf4\u7684\u8fc7\u4e00\u6bb5\u65f6\u95f4\u624d\u66f4\u65b0\u751f\u6548\u7684\u73b0\u8c61\uff0c\u5047\u8bbe\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a\u8fc7\u671f\u65f6\u95f4\u7684\u515c\u5e95\uff0c\u90a3\u540e\u7eed\u7684\u8bf7\u6c42\u8bfb\u5230\u7684\u5c31\u4f1a\u4e00\u76f4\u662f\u7f13\u5b58\u4e2d\u7684\u65e7\u6570\u636e\uff0c\u8fd9\u6837\u95ee\u9898\u5c31\u66f4\u5927\u4e86\u3002</p> <p>\u6240\u4ee5\u65b0\u7684\u95ee\u9898\u6765\u4e86\uff0c\u5982\u4f55\u4fdd\u8bc1\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u300d\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u80fd\u6267\u884c\u6210\u529f\uff1f</p> <p>\u963f\u65fa\u5206\u6790\u51fa\u95ee\u9898\u540e\uff0c\u614c\u614c\u5f20\u5f20\u7684\u5411\u8001\u677f\u6c47\u62a5\u4e86\u95ee\u9898\u3002</p> <p>\u8001\u677f\u77e5\u9053\u4e8b\u60c5\u540e\uff0c\u53c8\u7ed9\u4e86\u963f\u65fa\u51e0\u5929\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u753b\u997c\u7684\u4e8b\u60c5\u8fd9\u6b21\u6ca1\u6709\u518d\u63d0\u4e86\u3002</p> <ul> <li>\u963f\u65fa\u4f1a\u7528\u4ec0\u4e48\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f</li> <li>\u8001\u677f\u753b\u7684\u997c\u4e8b\u60c5\uff0c\u80fd\u5426\u5151\u73b0\u7ed9\u963f\u65fa\u5462\uff1f</li> </ul>"},{"location":"redis/architecture/mysql_redis_consistency/#_10","title":"\u5982\u4f55\u4fdd\u8bc1\u4e24\u4e2a\u64cd\u4f5c\u90fd\u80fd\u6267\u884c\u6210\u529f\uff1f","text":"<p>\u8fd9\u6b21\u7528\u6237\u7684\u6295\u8bc9\u662f\u56e0\u4e3a\u5728\u5220\u9664\u7f13\u5b58\uff08\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff09\u7684\u65f6\u5019\u5931\u8d25\u4e86\uff0c\u5bfc\u81f4\u7f13\u5b58\u8fd8\u662f\u65e7\u503c\uff0c\u800c\u6570\u636e\u5e93\u662f\u6700\u65b0\u503c\uff0c\u9020\u6210\u6570\u636e\u5e93\u548c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff0c\u4f1a\u5bf9\u654f\u611f\u4e1a\u52a1\u9020\u6210\u5f71\u54cd\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6765\u8bf4\u660e\u4e0b\u3002</p> <p>\u5e94\u7528\u8981\u628a\u6570\u636e X \u7684\u503c\u4ece 1 \u66f4\u65b0\u4e3a 2\uff0c\u5148\u6210\u529f\u66f4\u65b0\u4e86\u6570\u636e\u5e93\uff0c\u7136\u540e\u5728 Redis \u7f13\u5b58\u4e2d\u5220\u9664 X \u7684\u7f13\u5b58\uff0c\u4f46\u662f\u8fd9\u4e2a\u64cd\u4f5c\u5374\u5931\u8d25\u4e86\uff0c\u8fd9\u4e2a\u65f6\u5019\u6570\u636e\u5e93\u4e2d X \u7684\u65b0\u503c\u4e3a 2\uff0cRedis \u4e2d\u7684 X \u7684\u7f13\u5b58\u503c\u4e3a 1\uff0c\u51fa\u73b0\u4e86\u6570\u636e\u5e93\u548c\u7f13\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u90a3\u4e48\uff0c\u540e\u7eed\u6709\u8bbf\u95ee\u6570\u636e X \u7684\u8bf7\u6c42\uff0c\u4f1a\u5148\u5728 Redis \u4e2d\u67e5\u8be2\uff0c\u56e0\u4e3a\u7f13\u5b58\u5e76\u6ca1\u6709 \u8bf6\u5220\u9664\uff0c\u6240\u4ee5\u4f1a\u7f13\u5b58\u547d\u4e2d\uff0c\u4f46\u662f\u8bfb\u5230\u7684\u5374\u662f\u65e7\u503c 1\u3002</p> <p>\u5176\u5b9e\u4e0d\u7ba1\u662f\u5148\u64cd\u4f5c\u6570\u636e\u5e93\uff0c\u8fd8\u662f\u5148\u64cd\u4f5c\u7f13\u5b58\uff0c\u53ea\u8981\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u5931\u8d25\u90fd\u4f1a\u51fa\u73b0\u6570\u636e\u4e00\u81f4\u7684\u95ee\u9898\u3002</p> <p>\u95ee\u9898\u539f\u56e0\u77e5\u9053\u4e86\uff0c\u8be5\u600e\u4e48\u89e3\u51b3\u5462\uff1f\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <ul> <li>\u91cd\u8bd5\u673a\u5236\u3002</li> <li>\u8ba2\u9605 MySQL binlog\uff0c\u518d\u64cd\u4f5c\u7f13\u5b58\u3002</li> </ul> <p>\u5148\u6765\u8bf4\u7b2c\u4e00\u79cd\u3002</p>"},{"location":"redis/architecture/mysql_redis_consistency/#_11","title":"\u91cd\u8bd5\u673a\u5236","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5f15\u5165\u6d88\u606f\u961f\u5217\uff0c\u5c06\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff08\u5220\u9664\u7f13\u5b58\uff09\u8981\u64cd\u4f5c\u7684\u6570\u636e\u52a0\u5165\u5230\u6d88\u606f\u961f\u5217\uff0c\u7531\u6d88\u8d39\u8005\u6765\u64cd\u4f5c\u6570\u636e\u3002</p> <ul> <li>\u5982\u679c\u5e94\u7528\u5220\u9664\u7f13\u5b58\u5931\u8d25\uff0c\u53ef\u4ee5\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u91cd\u65b0\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u518d\u6b21\u5220\u9664\u7f13\u5b58\uff0c\u8fd9\u4e2a\u5c31\u662f\u91cd\u8bd5\u673a\u5236\u3002\u5f53\u7136\uff0c\u5982\u679c\u91cd\u8bd5\u8d85\u8fc7\u7684\u4e00\u5b9a\u6b21\u6570\uff0c\u8fd8\u662f\u6ca1\u6709\u6210\u529f\uff0c\u6211\u4eec\u5c31\u9700\u8981\u5411\u4e1a\u52a1\u5c42\u53d1\u9001\u62a5\u9519\u4fe1\u606f\u4e86\u3002</li> <li>\u5982\u679c\u5220\u9664\u7f13\u5b58\u6210\u529f\uff0c\u5c31\u8981\u628a\u6570\u636e\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u79fb\u9664\uff0c\u907f\u514d\u91cd\u590d\u64cd\u4f5c\uff0c\u5426\u5219\u5c31\u7ee7\u7eed\u91cd\u8bd5\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6765\u8bf4\u660e\u91cd\u8bd5\u673a\u5236\u7684\u8fc7\u7a0b\u3002</p> <p></p>"},{"location":"redis/architecture/mysql_redis_consistency/#mysql-binlog","title":"\u8ba2\u9605 MySQL binlog\uff0c\u518d\u64cd\u4f5c\u7f13\u5b58","text":"<p>\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u7f13\u5b58\u300d\u7684\u7b56\u7565\u7684\u7b2c\u4e00\u6b65\u662f\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u90a3\u4e48\u66f4\u65b0\u6570\u636e\u5e93\u6210\u529f\uff0c\u5c31\u4f1a\u4ea7\u751f\u4e00\u6761\u53d8\u66f4\u65e5\u5fd7\uff0c\u8bb0\u5f55\u5728 binlog \u91cc\u3002</p> <p>\u4e8e\u662f\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u8ba2\u9605 binlog \u65e5\u5fd7\uff0c\u62ff\u5230\u5177\u4f53\u8981\u64cd\u4f5c\u7684\u6570\u636e\uff0c\u7136\u540e\u518d\u6267\u884c\u7f13\u5b58\u5220\u9664\uff0c\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684 Canal \u4e2d\u95f4\u4ef6\u5c31\u662f\u57fa\u4e8e\u8fd9\u4e2a\u5b9e\u73b0\u7684\u3002</p> <p>Canal \u6a21\u62df MySQL \u4e3b\u4ece\u590d\u5236\u7684\u4ea4\u4e92\u534f\u8bae\uff0c\u628a\u81ea\u5df1\u4f2a\u88c5\u6210\u4e00\u4e2a MySQL \u7684\u4ece\u8282\u70b9\uff0c\u5411 MySQL \u4e3b\u8282\u70b9\u53d1\u9001 dump \u8bf7\u6c42\uff0cMySQL \u6536\u5230\u8bf7\u6c42\u540e\uff0c\u5c31\u4f1a\u5f00\u59cb\u63a8\u9001 Binlog \u7ed9 Canal\uff0cCanal \u89e3\u6790 Binlog \u5b57\u8282\u6d41\u4e4b\u540e\uff0c\u8f6c\u6362\u4e3a\u4fbf\u4e8e\u8bfb\u53d6\u7684\u7ed3\u6784\u5316\u6570\u636e\uff0c\u4f9b\u4e0b\u6e38\u7a0b\u5e8f\u8ba2\u9605\u4f7f\u7528\u3002</p> <p>\u4e0b\u56fe\u662f Canal \u7684\u5de5\u4f5c\u539f\u7406\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u8981\u60f3\u4fdd\u8bc1\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u7f13\u5b58\u300d\u7b56\u7565\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\u80fd\u6267\u884c\u6210\u529f\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u300c\u6d88\u606f\u961f\u5217\u6765\u91cd\u8bd5\u7f13\u5b58\u7684\u5220\u9664\u300d\uff0c\u6216\u8005\u300c\u8ba2\u9605 MySQL binlog \u518d\u64cd\u4f5c\u7f13\u5b58\u300d\uff0c\u8fd9\u4e24\u79cd\u65b9\u6cd5\u6709\u4e00\u4e2a\u5171\u540c\u7684\u7279\u70b9\uff0c\u90fd\u662f\u91c7\u7528\u5f02\u6b65\u64cd\u4f5c\u7f13\u5b58\u3002</p>"},{"location":"redis/architecture/mysql_redis_consistency/#_12","title":"\u8001\u677f\u53d1\u997c\u5566","text":"<p>\u963f\u65fa\u7531\u4e8e\u5bf9\u6d88\u606f\u961f\u5217\u6bd4\u8f83\u719f\u6089\uff0c\u6240\u4ee5\u4ed6\u51b3\u5b9a\u91c7\u7528\u300c\u6d88\u606f\u961f\u5217\u6765\u91cd\u8bd5\u7f13\u5b58\u7684\u5220\u9664\u300d\u7684\u65b9\u6848\uff0c\u6765\u89e3\u51b3\u8fd9\u6b21\u7684\u7528\u6237\u95ee\u9898\u3002</p> <p>\u7ecf\u8fc7\u51e0\u5929\u51e0\u591c\u7684\u64cd\u4f5c\uff0c\u670d\u52a1\u5668\u641e\u5b9a\u5566\uff0c\u7acb\u9a6c\u5411\u8001\u677f\u6c47\u62a5\u5de5\u4f5c\u3002</p> <p>\u8001\u677f\u8ba9\u963f\u65fa\u518d\u89c2\u5bdf\u4e9b\u65f6\u95f4\uff0c\u5982\u679c\u6ca1\u95ee\u9898\uff0c\u5230\u4e2d\u79cb\u8282\u5c31\u5546\u91cf\u201c\u997c\u201d\u7684\u4e8b\u60c5\u3002</p> <p>\u65f6\u95f4\u8fc7\u7684\u5f88\u5feb\uff0c\u4e2d\u79cb\u4f73\u8282\u5230\u4e86\uff0c\u8fd9\u671f\u95f4\u4e00\u76f4\u90fd\u6ca1\u6709\u7528\u6237\u53cd\u9988\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\u3002</p> <p>\u8001\u677f\u89c1\u8fd9\u6b21\u963f\u65fa\u8868\u73b0\u5f88\u597d\uff0c\u6ca1\u6709\u518d\u51fa\u73b0\u4efb\u4f55\u5dee\u9519\uff0c\u670d\u52a1\u5668\u7684\u8bbf\u95ee\u6027\u80fd\u4e5f\u4e0a\u6765\u4e86\uff0c\u4e8e\u662f\u7ed9\u963f\u65fa\u53d1\u4e86\u8fd9\u4e2a\u8d85\u7ea7\u5927\u7684\u6708\u997c\uff0c\u4f60\u770b\u8fd9\u4e2a\u997c\u53c8\u5927\u53c8\u5706\uff0c\u5c31\u50cf\u4f60\u7684\u4ee3\u7801\u53c8\u957f\u53c8\u591a\u3002</p> <p></p> <p>\u963f\u65fa\u770b\u5230\u8fd9\u4e2a\u6708\u997c\uff0c\u54ed\u7b11\u4e0d\u5f97\uff0c\u6ca1\u60f3\u5230\u8fd9\u5c31\u662f\u8001\u677f\u753b\u7684\u997c\uff0c\u662f\u771f\u7684\u5f88\u5927\u997c\u3002\u3002\u3002\u3002</p> <p>\u4ee5\u4e0a\u6545\u4e8b\u7eaf\u5c5e\u865a\u62df\uff0c\u5982\u6709\u5de7\u5408\uff0c\u4ee5\u4f60\u4e3a\u51c6\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/base/redis_interview/","title":"Redis \u5e38\u89c1\u9762\u8bd5\u9898","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e0d\u77e5\u4e0d\u89c9\u300a\u56fe\u89e3 Redis\u300b\u7cfb\u5217\u6587\u7ae0\u5199\u4e86\u5f88\u591a\u4e86\uff0c\u8003\u8651\u5230\u4e00\u4e9b\u540c\u5b66\u9762\u8bd5\u7a81\u51fb Redis\uff0c\u6240\u4ee5\u6211\u6574\u7406\u4e86 3 \u4e07\u5b57 + 40 \u5f20\u56fe\u7684 Redis \u516b\u80a1\u6587\uff0c\u5171\u6536\u96c6\u4e86 40 \u591a\u4e2a\u9762\u8bd5\u9898\u3002</p> <p></p> <p>\u53d1\u8f66\uff01</p> <p></p>"},{"location":"redis/base/redis_interview/#redis_1","title":"\u8ba4\u8bc6 Redis","text":""},{"location":"redis/base/redis_interview/#redis_2","title":"\u4ec0\u4e48\u662f Redis\uff1f","text":"<p>\u6211\u4eec\u76f4\u63a5\u770b Redis \u5b98\u65b9\u662f\u600e\u4e48\u4ecb\u7ecd\u81ea\u5df1\u7684\u3002</p> <p></p> <p>Redis \u5b98\u65b9\u7684\u4ecb\u7ecd\u539f\u7248\u662f\u82f1\u6587\u7684\uff0c\u6211\u7ffb\u8bd1\u6210\u4e86\u4e2d\u6587\u540e\u622a\u56fe\u7684\uff0c\u6240\u4ee5\u6709\u4e9b\u6587\u5b57\u8bfb\u8d77\u6765\u4f1a\u6bd4\u8f83\u62d7\u53e3\uff0c\u6ca1\u5173\u7cfb\uff0c\u6211\u4f1a\u628a\u91cc\u9762\u6bd4\u8f83\u91cd\u8981\u7684\u7279\u6027\u62bd\u51fa\u6765\u8bb2\u4e00\u4e0b\u3002</p> <p>Redis \u662f\u4e00\u79cd\u57fa\u4e8e\u5185\u5b58\u7684\u6570\u636e\u5e93\uff0c\u5bf9\u6570\u636e\u7684\u8bfb\u5199\u64cd\u4f5c\u90fd\u662f\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\uff0c\u56e0\u6b64\u8bfb\u5199\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u5e38\u7528\u4e8e\u7f13\u5b58\uff0c\u6d88\u606f\u961f\u5217\u3001\u5206\u5e03\u5f0f\u9501\u7b49\u573a\u666f\u3002</p> <p>Redis \u63d0\u4f9b\u4e86\u591a\u79cd\u6570\u636e\u7c7b\u578b\u6765\u652f\u6301\u4e0d\u540c\u7684\u4e1a\u52a1\u573a\u666f\uff0c\u6bd4\u5982 String(\u5b57\u7b26\u4e32)\u3001Hash(\u54c8\u5e0c)\u3001List (\u5217\u8868)\u3001Set(\u96c6\u5408)\u3001Zset(\u6709\u5e8f\u96c6\u5408)\u3001Bitmaps\uff08\u4f4d\u56fe\uff09\u3001HyperLogLog\uff08\u57fa\u6570\u7edf\u8ba1\uff09\u3001GEO\uff08\u5730\u7406\u4fe1\u606f\uff09\u3001Stream\uff08\u6d41\uff09\uff0c\u5e76\u4e14\u5bf9\u6570\u636e\u7c7b\u578b\u7684\u64cd\u4f5c\u90fd\u662f\u539f\u5b50\u6027\u7684\uff0c\u56e0\u4e3a\u6267\u884c\u547d\u4ee4\u7531\u5355\u7ebf\u7a0b\u8d1f\u8d23\u7684\uff0c\u4e0d\u5b58\u5728\u5e76\u53d1\u7ade\u4e89\u7684\u95ee\u9898\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0cRedis \u8fd8\u652f\u6301\u4e8b\u52a1\u3001\u6301\u4e45\u5316\u3001Lua \u811a\u672c\u3001\u591a\u79cd\u96c6\u7fa4\u65b9\u6848\uff08\u4e3b\u4ece\u590d\u5236\u6a21\u5f0f\u3001\u54e8\u5175\u6a21\u5f0f\u3001\u5207\u7247\u96c6\u7fa4\u6a21\u5f0f\uff09\u3001\u53d1\u5e03/\u8ba2\u9605\u6a21\u5f0f\uff0c\u5185\u5b58\u6dd8\u6c70\u673a\u5236\u3001\u8fc7\u671f\u5220\u9664\u673a\u5236\u7b49\u7b49\u3002</p>"},{"location":"redis/base/redis_interview/#redis-memcached","title":"Redis \u548c Memcached \u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u5f88\u591a\u4eba\u90fd\u8bf4\u7528 Redis \u4f5c\u4e3a\u7f13\u5b58\uff0c\u4f46\u662f Memcached \u4e5f\u662f\u57fa\u4e8e\u5185\u5b58\u7684\u6570\u636e\u5e93\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u9009\u62e9\u5b83\u4f5c\u4e3a\u7f13\u5b58\u5462\uff1f\u8981\u89e3\u7b54\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5c31\u8981\u5f04\u6e05\u695a Redis \u548c Memcached \u7684\u533a\u522b\u3002 Redis \u4e0e Memcached \u5171\u540c\u70b9\uff1a</p> <ol> <li>\u90fd\u662f\u57fa\u4e8e\u5185\u5b58\u7684\u6570\u636e\u5e93\uff0c\u4e00\u822c\u90fd\u7528\u6765\u5f53\u505a\u7f13\u5b58\u4f7f\u7528\u3002</li> <li>\u90fd\u6709\u8fc7\u671f\u7b56\u7565\u3002</li> <li>\u4e24\u8005\u7684\u6027\u80fd\u90fd\u975e\u5e38\u9ad8\u3002</li> </ol> <p>Redis \u4e0e Memcached \u533a\u522b\uff1a</p> <ul> <li>Redis \u652f\u6301\u7684\u6570\u636e\u7c7b\u578b\u66f4\u4e30\u5bcc\uff08String\u3001Hash\u3001List\u3001Set\u3001ZSet\uff09\uff0c\u800c Memcached \u53ea\u652f\u6301\u6700\u7b80\u5355\u7684 key-value \u6570\u636e\u7c7b\u578b\uff1b</li> <li>Redis \u652f\u6301\u6570\u636e\u7684\u6301\u4e45\u5316\uff0c\u53ef\u4ee5\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4fdd\u6301\u5728\u78c1\u76d8\u4e2d\uff0c\u91cd\u542f\u7684\u65f6\u5019\u53ef\u4ee5\u518d\u6b21\u52a0\u8f7d\u8fdb\u884c\u4f7f\u7528\uff0c\u800c Memcached \u6ca1\u6709\u6301\u4e45\u5316\u529f\u80fd\uff0c\u6570\u636e\u5168\u90e8\u5b58\u5728\u5185\u5b58\u4e4b\u4e2d\uff0cMemcached \u91cd\u542f\u6216\u8005\u6302\u6389\u540e\uff0c\u6570\u636e\u5c31\u6ca1\u4e86\uff1b</li> <li>Redis \u539f\u751f\u652f\u6301\u96c6\u7fa4\u6a21\u5f0f\uff0cMemcached \u6ca1\u6709\u539f\u751f\u7684\u96c6\u7fa4\u6a21\u5f0f\uff0c\u9700\u8981\u4f9d\u9760\u5ba2\u6237\u7aef\u6765\u5b9e\u73b0\u5f80\u96c6\u7fa4\u4e2d\u5206\u7247\u5199\u5165\u6570\u636e\uff1b</li> <li>Redis \u652f\u6301\u53d1\u5e03\u8ba2\u9605\u6a21\u578b\u3001Lua \u811a\u672c\u3001\u4e8b\u52a1\u7b49\u529f\u80fd\uff0c\u800c Memcached \u4e0d\u652f\u6301\uff1b</li> </ul>"},{"location":"redis/base/redis_interview/#redis-mysql","title":"\u4e3a\u4ec0\u4e48\u7528 Redis \u4f5c\u4e3a MySQL \u7684\u7f13\u5b58\uff1f","text":"<p>\u4e3b\u8981\u662f\u56e0\u4e3a Redis \u5177\u5907\u300c\u9ad8\u6027\u80fd\u300d\u548c\u300c\u9ad8\u5e76\u53d1\u300d\u4e24\u79cd\u7279\u6027\u3002</p> <p>1\u3001Redis \u5177\u5907\u9ad8\u6027\u80fd</p> <p>\u5047\u5982\u7528\u6237\u7b2c\u4e00\u6b21\u8bbf\u95ee MySQL \u4e2d\u7684\u67d0\u4e9b\u6570\u636e\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u6bd4\u8f83\u6162\uff0c\u56e0\u4e3a\u662f\u4ece\u786c\u76d8\u4e0a\u8bfb\u53d6\u7684\u3002\u5c06\u8be5\u7528\u6237\u8bbf\u95ee\u7684\u6570\u636e\u7f13\u5b58\u5728 Redis \u4e2d\uff0c\u8fd9\u6837\u4e0b\u4e00\u6b21\u518d\u8bbf\u95ee\u8fd9\u4e9b\u6570\u636e\u7684\u65f6\u5019\u5c31\u53ef\u4ee5\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u83b7\u53d6\u4e86\uff0c\u64cd\u4f5c Redis \u7f13\u5b58\u5c31\u662f\u76f4\u63a5\u64cd\u4f5c\u5185\u5b58\uff0c\u6240\u4ee5\u901f\u5ea6\u76f8\u5f53\u5feb\u3002</p> <p></p> <p>\u5982\u679c MySQL \u4e2d\u7684\u5bf9\u5e94\u6570\u636e\u6539\u53d8\u4e86\u4e4b\u540e\uff0c\u540c\u6b65\u6539\u53d8 Redis \u7f13\u5b58\u4e2d\u76f8\u5e94\u7684\u6570\u636e\u5373\u53ef\uff0c\u4e0d\u8fc7\u8fd9\u91cc\u4f1a\u6709 Redis \u548c MySQL \u53cc\u5199\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u540e\u9762\u6211\u4eec\u4f1a\u63d0\u5230\u3002</p> <p>2\u3001Redis \u5177\u5907\u9ad8\u5e76\u53d1</p> <p>\u5355\u53f0\u8bbe\u5907\u7684 Redis \u7684 QPS\uff08Query Per Second\uff0c\u6bcf\u79d2\u949f\u5904\u7406\u5b8c\u8bf7\u6c42\u7684\u6b21\u6570\uff09\u662f MySQL \u7684 10 \u500d\uff0cRedis \u5355\u673a\u7684 QPS \u80fd\u8f7b\u677e\u7834 10w\uff0c\u800c MySQL \u5355\u673a\u7684 QPS \u5f88\u96be\u7834  1w\u3002</p> <p>\u6240\u4ee5\uff0c\u76f4\u63a5\u8bbf\u95ee Redis \u80fd\u591f\u627f\u53d7\u7684\u8bf7\u6c42\u662f\u8fdc\u8fdc\u5927\u4e8e\u76f4\u63a5\u8bbf\u95ee MySQL \u7684\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u628a\u6570\u636e\u5e93\u4e2d\u7684\u90e8\u5206\u6570\u636e\u8f6c\u79fb\u5230\u7f13\u5b58\u4e2d\u53bb\uff0c\u8fd9\u6837\u7528\u6237\u7684\u4e00\u90e8\u5206\u8bf7\u6c42\u4f1a\u76f4\u63a5\u5230\u7f13\u5b58\u8fd9\u91cc\u800c\u4e0d\u7528\u7ecf\u8fc7\u6570\u636e\u5e93\u3002</p>"},{"location":"redis/base/redis_interview/#redis_3","title":"Redis \u6570\u636e\u7ed3\u6784","text":""},{"location":"redis/base/redis_interview/#redis_4","title":"Redis \u6570\u636e\u7c7b\u578b\u4ee5\u53ca\u4f7f\u7528\u573a\u666f\u5206\u522b\u662f\u4ec0\u4e48\uff1f","text":"<p>Redis \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5e38\u89c1\u7684\u6709\u4e94\u79cd\u6570\u636e\u7c7b\u578b\uff1aString\uff08\u5b57\u7b26\u4e32\uff09\uff0cHash\uff08\u54c8\u5e0c\uff09\uff0cList\uff08\u5217\u8868\uff09\uff0cSet\uff08\u96c6\u5408\uff09\u3001Zset\uff08\u6709\u5e8f\u96c6\u5408\uff09\u3002</p> <p></p> <p></p> <p>\u968f\u7740 Redis \u7248\u672c\u7684\u66f4\u65b0\uff0c\u540e\u9762\u53c8\u652f\u6301\u4e86\u56db\u79cd\u6570\u636e\u7c7b\u578b\uff1a BitMap\uff082.2 \u7248\u65b0\u589e\uff09\u3001HyperLogLog\uff082.8 \u7248\u65b0\u589e\uff09\u3001GEO\uff083.2 \u7248\u65b0\u589e\uff09\u3001Stream\uff085.0 \u7248\u65b0\u589e\uff09\u3002 Redis \u4e94\u79cd\u6570\u636e\u7c7b\u578b\u7684\u5e94\u7528\u573a\u666f\uff1a</p> <ul> <li>String \u7c7b\u578b\u7684\u5e94\u7528\u573a\u666f\uff1a\u7f13\u5b58\u5bf9\u8c61\u3001\u5e38\u89c4\u8ba1\u6570\u3001\u5206\u5e03\u5f0f\u9501\u3001\u5171\u4eab session \u4fe1\u606f\u7b49\u3002</li> <li>List \u7c7b\u578b\u7684\u5e94\u7528\u573a\u666f\uff1a\u6d88\u606f\u961f\u5217\uff08\u4f46\u662f\u6709\u4e24\u4e2a\u95ee\u9898\uff1a1. \u751f\u4ea7\u8005\u9700\u8981\u81ea\u884c\u5b9e\u73b0\u5168\u5c40\u552f\u4e00 ID\uff1b2. \u4e0d\u80fd\u4ee5\u6d88\u8d39\u7ec4\u5f62\u5f0f\u6d88\u8d39\u6570\u636e\uff09\u7b49\u3002</li> <li>Hash \u7c7b\u578b\uff1a\u7f13\u5b58\u5bf9\u8c61\u3001\u8d2d\u7269\u8f66\u7b49\u3002</li> <li>Set \u7c7b\u578b\uff1a\u805a\u5408\u8ba1\u7b97\uff08\u5e76\u96c6\u3001\u4ea4\u96c6\u3001\u5dee\u96c6\uff09\u573a\u666f\uff0c\u6bd4\u5982\u70b9\u8d5e\u3001\u5171\u540c\u5173\u6ce8\u3001\u62bd\u5956\u6d3b\u52a8\u7b49\u3002</li> <li>Zset \u7c7b\u578b\uff1a\u6392\u5e8f\u573a\u666f\uff0c\u6bd4\u5982\u6392\u884c\u699c\u3001\u7535\u8bdd\u548c\u59d3\u540d\u6392\u5e8f\u7b49\u3002</li> </ul> <p>Redis \u540e\u7eed\u7248\u672c\u53c8\u652f\u6301\u56db\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u5b83\u4eec\u7684\u5e94\u7528\u573a\u666f\u5982\u4e0b\uff1a</p> <ul> <li>BitMap\uff082.2 \u7248\u65b0\u589e\uff09\uff1a\u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\u7684\u573a\u666f\uff0c\u6bd4\u5982\u7b7e\u5230\u3001\u5224\u65ad\u7528\u6237\u767b\u9646\u72b6\u6001\u3001\u8fde\u7eed\u7b7e\u5230\u7528\u6237\u603b\u6570\u7b49\uff1b</li> <li>HyperLogLog\uff082.8 \u7248\u65b0\u589e\uff09\uff1a\u6d77\u91cf\u6570\u636e\u57fa\u6570\u7edf\u8ba1\u7684\u573a\u666f\uff0c\u6bd4\u5982\u767e\u4e07\u7ea7\u7f51\u9875 UV \u8ba1\u6570\u7b49\uff1b</li> <li>GEO\uff083.2 \u7248\u65b0\u589e\uff09\uff1a\u5b58\u50a8\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u7684\u573a\u666f\uff0c\u6bd4\u5982\u6ef4\u6ef4\u53eb\u8f66\uff1b</li> <li>Stream\uff085.0 \u7248\u65b0\u589e\uff09\uff1a\u6d88\u606f\u961f\u5217\uff0c\u76f8\u6bd4\u4e8e\u57fa\u4e8e List \u7c7b\u578b\u5b9e\u73b0\u7684\u6d88\u606f\u961f\u5217\uff0c\u6709\u8fd9\u4e24\u4e2a\u7279\u6709\u7684\u7279\u6027\uff1a\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00\u6d88\u606f ID\uff0c\u652f\u6301\u4ee5\u6d88\u8d39\u7ec4\u5f62\u5f0f\u6d88\u8d39\u6570\u636e\u3002</li> </ul> <p>::: tip</p> <p>\u60f3\u6df1\u5165\u4e86\u89e3\u8fd9 9 \u79cd\u6570\u636e\u7c7b\u578b\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a2 \u4e07\u5b57 + 20 \u5f20\u56fe \uff5c \u7ec6\u8bf4 Redis \u5e38\u89c1\u6570\u636e\u7c7b\u578b\u548c\u5e94\u7528\u573a\u666f</p> <p>:::</p>"},{"location":"redis/base/redis_interview/#redis_5","title":"\u4e94\u79cd\u5e38\u89c1\u7684 Redis \u6570\u636e\u7c7b\u578b\u662f\u600e\u4e48\u5b9e\u73b0\uff1f","text":"<p>\u6211\u753b\u4e86\u4e00\u5f20 Redis \u6570\u636e\u7c7b\u578b\u548c\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7684\u5bf9\u5e94\u5173\u56fe\uff0c\u5de6\u8fb9\u662f Redis 3.0 \u7248\u672c\u7684\uff0c\u4e5f\u5c31\u662f\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b\u8fd9\u672c\u4e66\u8bb2\u89e3\u7684\u7248\u672c\uff0c\u73b0\u5728\u770b\u8fd8\u662f\u6709\u70b9\u8fc7\u65f6\u4e86\uff0c\u53f3\u8fb9\u662f\u73b0\u5728 Redis 7.0 \u7248\u672c\u7684\u3002</p> <p></p> <p>String \u7c7b\u578b\u5185\u90e8\u5b9e\u73b0</p> <p>String \u7c7b\u578b\u7684\u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u4e3b\u8981\u662f SDS\uff08\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff09\u3002 SDS \u548c\u6211\u4eec\u8ba4\u8bc6\u7684 C \u5b57\u7b26\u4e32\u4e0d\u592a\u4e00\u6837\uff0c\u4e4b\u6240\u4ee5\u6ca1\u6709\u4f7f\u7528 C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u56e0\u4e3a SDS \u76f8\u6bd4\u4e8e C \u7684\u539f\u751f\u5b57\u7b26\u4e32\uff1a</p> <ul> <li>SDS \u4e0d\u4ec5\u53ef\u4ee5\u4fdd\u5b58\u6587\u672c\u6570\u636e\uff0c\u8fd8\u53ef\u4ee5\u4fdd\u5b58\u4e8c\u8fdb\u5236\u6570\u636e\u3002\u56e0\u4e3a SDS \u4f7f\u7528 len \u5c5e\u6027\u7684\u503c\u800c\u4e0d\u662f\u7a7a\u5b57\u7b26\u6765\u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u7ed3\u675f\uff0c\u5e76\u4e14 SDS \u7684\u6240\u6709 API \u90fd\u4f1a\u4ee5\u5904\u7406\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u6765\u5904\u7406 SDS \u5b58\u653e\u5728 buf[] \u6570\u7ec4\u91cc\u7684\u6570\u636e\u3002\u6240\u4ee5 SDS \u4e0d\u5149\u80fd\u5b58\u653e\u6587\u672c\u6570\u636e\uff0c\u800c\u4e14\u80fd\u4fdd\u5b58\u56fe\u7247\u3001\u97f3\u9891\u3001\u89c6\u9891\u3001\u538b\u7f29\u6587\u4ef6\u8fd9\u6837\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u3002</li> <li>SDS \u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\u3002\u56e0\u4e3a C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u5e76\u4e0d\u8bb0\u5f55\u81ea\u8eab\u957f\u5ea6\uff0c\u6240\u4ee5\u83b7\u53d6\u957f\u5ea6\u7684\u590d\u6742\u5ea6\u4e3a O(n)\uff1b\u800c SDS \u7ed3\u6784\u91cc\u7528 len \u5c5e\u6027\u8bb0\u5f55\u4e86\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a O(1)\u3002</li> <li>Redis \u7684 SDS API \u662f\u5b89\u5168\u7684\uff0c\u62fc\u63a5\u5b57\u7b26\u4e32\u4e0d\u4f1a\u9020\u6210\u7f13\u51b2\u533a\u6ea2\u51fa\u3002\u56e0\u4e3a SDS \u5728\u62fc\u63a5\u5b57\u7b26\u4e32\u4e4b\u524d\u4f1a\u68c0\u67e5 SDS \u7a7a\u95f4\u662f\u5426\u6ee1\u8db3\u8981\u6c42\uff0c\u5982\u679c\u7a7a\u95f4\u4e0d\u591f\u4f1a\u81ea\u52a8\u6269\u5bb9\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bfc\u81f4\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\u3002 <p>List \u7c7b\u578b\u5185\u90e8\u5b9e\u73b0</p> </li> </ul> <p>List \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531\u53cc\u5411\u94fe\u8868\u6216\u538b\u7f29\u5217\u8868\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u5982\u679c\u5217\u8868\u7684\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e 512 \u4e2a\uff08\u9ed8\u8ba4\u503c\uff0c\u53ef\u7531 list-max-ziplist-entries \u914d\u7f6e\uff09\uff0c\u5217\u8868\u6bcf\u4e2a\u5143\u7d20\u7684\u503c\u90fd\u5c0f\u4e8e 64 \u5b57\u8282\uff08\u9ed8\u8ba4\u503c\uff0c\u53ef\u7531 list-max-ziplist-value \u914d\u7f6e\uff09\uff0cRedis \u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u4f5c\u4e3a List \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> <li>\u5982\u679c\u5217\u8868\u7684\u5143\u7d20\u4e0d\u6ee1\u8db3\u4e0a\u9762\u7684\u6761\u4ef6\uff0cRedis \u4f1a\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u4f5c\u4e3a List \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> </ul> <p>\u4f46\u662f\u5728 Redis 3.2 \u7248\u672c\u4e4b\u540e\uff0cList \u6570\u636e\u7c7b\u578b\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5c31\u53ea\u7531 quicklist \u5b9e\u73b0\u4e86\uff0c\u66ff\u4ee3\u4e86\u53cc\u5411\u94fe\u8868\u548c\u538b\u7f29\u5217\u8868\u3002</p> <p>Hash \u7c7b\u578b\u5185\u90e8\u5b9e\u73b0</p> <p>Hash \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531\u538b\u7f29\u5217\u8868\u6216\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u5982\u679c\u54c8\u5e0c\u7c7b\u578b\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e 512 \u4e2a\uff08\u9ed8\u8ba4\u503c\uff0c\u53ef\u7531 hash-max-ziplist-entries \u914d\u7f6e\uff09\uff0c\u6240\u6709\u503c\u5c0f\u4e8e 64 \u5b57\u8282\uff08\u9ed8\u8ba4\u503c\uff0c\u53ef\u7531 hash-max-ziplist-value \u914d\u7f6e\uff09\u7684\u8bdd\uff0cRedis \u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u4f5c\u4e3a Hash \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> <li>\u5982\u679c\u54c8\u5e0c\u7c7b\u578b\u5143\u7d20\u4e0d\u6ee1\u8db3\u4e0a\u9762\u6761\u4ef6\uff0cRedis \u4f1a\u4f7f\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a Hash \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u3002</li> </ul> <p>\u5728 Redis 7.0 \u4e2d\uff0c\u538b\u7f29\u5217\u8868\u6570\u636e\u7ed3\u6784\u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u4ea4\u7531 listpack \u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u4e86\u3002</p> <p>Set \u7c7b\u578b\u5185\u90e8\u5b9e\u73b0</p> <p>Set \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531\u54c8\u5e0c\u8868\u6216\u6574\u6570\u96c6\u5408\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u5982\u679c\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u90fd\u662f\u6574\u6570\u4e14\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e 512\uff08\u9ed8\u8ba4\u503c\uff0cset-maxintset-entries \u914d\u7f6e\uff09\u4e2a\uff0cRedis \u4f1a\u4f7f\u7528\u6574\u6570\u96c6\u5408\u4f5c\u4e3a Set \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> <li>\u5982\u679c\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e0d\u6ee1\u8db3\u4e0a\u9762\u6761\u4ef6\uff0c\u5219 Redis \u4f7f\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a Set \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u3002 <p>ZSet \u7c7b\u578b\u5185\u90e8\u5b9e\u73b0</p> </li> </ul> <p>Zset \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531\u538b\u7f29\u5217\u8868\u6216\u8df3\u8868\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u5982\u679c\u6709\u5e8f\u96c6\u5408\u7684\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e 128 \u4e2a\uff0c\u5e76\u4e14\u6bcf\u4e2a\u5143\u7d20\u7684\u503c\u5c0f\u4e8e 64 \u5b57\u8282\u65f6\uff0cRedis \u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u4f5c\u4e3a Zset \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> <li>\u5982\u679c\u6709\u5e8f\u96c6\u5408\u7684\u5143\u7d20\u4e0d\u6ee1\u8db3\u4e0a\u9762\u7684\u6761\u4ef6\uff0cRedis \u4f1a\u4f7f\u7528\u8df3\u8868\u4f5c\u4e3a Zset \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> </ul> <p>\u5728 Redis 7.0 \u4e2d\uff0c\u538b\u7f29\u5217\u8868\u6570\u636e\u7ed3\u6784\u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u4ea4\u7531 listpack \u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u4e86\u3002</p> <p>::: tip</p> <p>\u60f3\u6df1\u5165\u4e86\u89e3\u8fd9 9 \u79cd\u6570\u636e\u7ed3\u6784\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a2 \u4e07\u5b57 + 40 \u5f20\u56fe \uff5c \u7ec6\u8bf4 Redis \u6570\u636e\u7ed3\u6784</p> <p>:::</p>"},{"location":"redis/base/redis_interview/#redis_6","title":"Redis \u7ebf\u7a0b\u6a21\u578b","text":""},{"location":"redis/base/redis_interview/#redis_7","title":"Redis \u662f\u5355\u7ebf\u7a0b\u5417\uff1f","text":"<p>Redis \u5355\u7ebf\u7a0b\u6307\u7684\u662f\u300c\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42-&gt;\u89e3\u6790\u8bf7\u6c42 -&gt;\u8fdb\u884c\u6570\u636e\u8bfb\u5199\u7b49\u64cd\u4f5c-&gt;\u53d1\u9001\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\u300d\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u7531\u4e00\u4e2a\u7ebf\u7a0b\uff08\u4e3b\u7ebf\u7a0b\uff09\u6765\u5b8c\u6210\u7684\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u5e38\u8bf4 Redis \u662f\u5355\u7ebf\u7a0b\u7684\u539f\u56e0\u3002</p> <p>\u4f46\u662f\uff0cRedis \u7a0b\u5e8f\u5e76\u4e0d\u662f\u5355\u7ebf\u7a0b\u7684\uff0cRedis \u5728\u542f\u52a8\u7684\u65f6\u5019\uff0c\u662f\u4f1a\u542f\u52a8\u540e\u53f0\u7ebf\u7a0b\uff08BIO\uff09\u7684\uff1a</p> <ul> <li>Redis \u5728 2.6 \u7248\u672c\uff0c\u4f1a\u542f\u52a8 2 \u4e2a\u540e\u53f0\u7ebf\u7a0b\uff0c\u5206\u522b\u5904\u7406\u5173\u95ed\u6587\u4ef6\u3001AOF \u5237\u76d8\u8fd9\u4e24\u4e2a\u4efb\u52a1\uff1b</li> <li>Redis \u5728 4.0 \u7248\u672c\u4e4b\u540e\uff0c\u65b0\u589e\u4e86\u4e00\u4e2a\u65b0\u7684\u540e\u53f0\u7ebf\u7a0b\uff0c\u7528\u6765\u5f02\u6b65\u91ca\u653e Redis \u5185\u5b58\uff0c\u4e5f\u5c31\u662f lazyfree \u7ebf\u7a0b\u3002\u4f8b\u5982\u6267\u884c unlink key / flushdb async / flushall async \u7b49\u547d\u4ee4\uff0c\u4f1a\u628a\u8fd9\u4e9b\u5220\u9664\u64cd\u4f5c\u4ea4\u7ed9\u540e\u53f0\u7ebf\u7a0b\u6765\u6267\u884c\uff0c\u597d\u5904\u662f\u4e0d\u4f1a\u5bfc\u81f4 Redis \u4e3b\u7ebf\u7a0b\u5361\u987f\u3002\u56e0\u6b64\uff0c\u5f53\u6211\u4eec\u8981\u5220\u9664\u4e00\u4e2a\u5927 key \u7684\u65f6\u5019\uff0c\u4e0d\u8981\u4f7f\u7528 del \u547d\u4ee4\u5220\u9664\uff0c\u56e0\u4e3a del \u662f\u5728\u4e3b\u7ebf\u7a0b\u5904\u7406\u7684\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4 Redis \u4e3b\u7ebf\u7a0b\u5361\u987f\uff0c\u56e0\u6b64\u6211\u4eec\u5e94\u8be5\u4f7f\u7528 unlink \u547d\u4ee4\u6765\u5f02\u6b65\u5220\u9664\u5927 key\u3002</li> </ul> <p>\u4e4b\u6240\u4ee5 Redis \u4e3a\u300c\u5173\u95ed\u6587\u4ef6\u3001AOF \u5237\u76d8\u3001\u91ca\u653e\u5185\u5b58\u300d\u8fd9\u4e9b\u4efb\u52a1\u521b\u5efa\u5355\u72ec\u7684\u7ebf\u7a0b\u6765\u5904\u7406\uff0c\u662f\u56e0\u4e3a\u8fd9\u4e9b\u4efb\u52a1\u7684\u64cd\u4f5c\u90fd\u662f\u5f88\u8017\u65f6\u7684\uff0c\u5982\u679c\u628a\u8fd9\u4e9b\u4efb\u52a1\u90fd\u653e\u5728\u4e3b\u7ebf\u7a0b\u6765\u5904\u7406\uff0c\u90a3\u4e48 Redis \u4e3b\u7ebf\u7a0b\u5c31\u5f88\u5bb9\u6613\u53d1\u751f\u963b\u585e\uff0c\u8fd9\u6837\u5c31\u65e0\u6cd5\u5904\u7406\u540e\u7eed\u7684\u8bf7\u6c42\u4e86\u3002</p> <p>\u540e\u53f0\u7ebf\u7a0b\u76f8\u5f53\u4e8e\u4e00\u4e2a\u6d88\u8d39\u8005\uff0c\u751f\u4ea7\u8005\u628a\u8017\u65f6\u4efb\u52a1\u4e22\u5230\u4efb\u52a1\u961f\u5217\u4e2d\uff0c\u6d88\u8d39\u8005\uff08BIO\uff09\u4e0d\u505c\u8f6e\u8be2\u8fd9\u4e2a\u961f\u5217\uff0c\u62ff\u51fa\u4efb\u52a1\u5c31\u53bb\u6267\u884c\u5bf9\u5e94\u7684\u65b9\u6cd5\u5373\u53ef\u3002</p> <p></p> <p>\u5173\u95ed\u6587\u4ef6\u3001AOF \u5237\u76d8\u3001\u91ca\u653e\u5185\u5b58\u8fd9\u4e09\u4e2a\u4efb\u52a1\u90fd\u6709\u5404\u81ea\u7684\u4efb\u52a1\u961f\u5217\uff1a</p> <ul> <li>BIO_CLOSE_FILE\uff0c\u5173\u95ed\u6587\u4ef6\u4efb\u52a1\u961f\u5217\uff1a\u5f53\u961f\u5217\u6709\u4efb\u52a1\u540e\uff0c\u540e\u53f0\u7ebf\u7a0b\u4f1a\u8c03\u7528 close(fd) \uff0c\u5c06\u6587\u4ef6\u5173\u95ed\uff1b</li> <li>BIO_AOF_FSYNC\uff0cAOF \u5237\u76d8\u4efb\u52a1\u961f\u5217\uff1a\u5f53 AOF \u65e5\u5fd7\u914d\u7f6e\u6210 everysec \u9009\u9879\u540e\uff0c\u4e3b\u7ebf\u7a0b\u4f1a\u628a AOF \u5199\u65e5\u5fd7\u64cd\u4f5c\u5c01\u88c5\u6210\u4e00\u4e2a\u4efb\u52a1\uff0c\u4e5f\u653e\u5230\u961f\u5217\u4e2d\u3002\u5f53\u53d1\u73b0\u961f\u5217\u6709\u4efb\u52a1\u540e\uff0c\u540e\u53f0\u7ebf\u7a0b\u4f1a\u8c03\u7528 fsync(fd)\uff0c\u5c06 AOF \u6587\u4ef6\u5237\u76d8\uff0c</li> <li>BIO_LAZY_FREE\uff0clazy free \u4efb\u52a1\u961f\u5217\uff1a\u5f53\u961f\u5217\u6709\u4efb\u52a1\u540e\uff0c\u540e\u53f0\u7ebf\u7a0b\u4f1a free(obj) \u91ca\u653e\u5bf9\u8c61 / free(dict) \u5220\u9664\u6570\u636e\u5e93\u6240\u6709\u5bf9\u8c61 / free(skiplist) \u91ca\u653e\u8df3\u8868\u5bf9\u8c61\uff1b</li> </ul>"},{"location":"redis/base/redis_interview/#redis_8","title":"Redis \u5355\u7ebf\u7a0b\u6a21\u5f0f\u662f\u600e\u6837\u7684\uff1f","text":"<p>Redis 6.0 \u7248\u672c\u4e4b\u524d\u7684\u5355\u7ebf\u6a21\u5f0f\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u56fe\u4e2d\u7684\u84dd\u8272\u90e8\u5206\u662f\u4e00\u4e2a\u4e8b\u4ef6\u5faa\u73af\uff0c\u662f\u7531\u4e3b\u7ebf\u7a0b\u8d1f\u8d23\u7684\uff0c\u53ef\u4ee5\u770b\u5230\u7f51\u7edc I/O \u548c\u547d\u4ee4\u5904\u7406\u90fd\u662f\u5355\u7ebf\u7a0b\u3002 Redis \u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u4f1a\u505a\u4e0b\u9762\u8fd9\u51e0\u4ef6\u4e8b\u60c5\uff1a</p> <ul> <li>\u9996\u5148\uff0c\u8c03\u7528 epoll_create() \u521b\u5efa\u4e00\u4e2a epoll \u5bf9\u8c61\u548c\u8c03\u7528 socket() \u4e00\u4e2a\u670d\u52a1\u7aef socket</li> <li>\u7136\u540e\uff0c\u8c03\u7528 bind() \u7ed1\u5b9a\u7aef\u53e3\u548c\u8c03\u7528 listen() \u76d1\u542c\u8be5 socket\uff1b</li> <li>\u7136\u540e\uff0c\u5c06\u8c03\u7528 epoll_ctl() \u5c06 listen socket \u52a0\u5165\u5230 epoll\uff0c\u540c\u65f6\u6ce8\u518c\u300c\u8fde\u63a5\u4e8b\u4ef6\u300d\u5904\u7406\u51fd\u6570\u3002</li> </ul> <p>\u521d\u59cb\u5316\u5b8c\u540e\uff0c\u4e3b\u7ebf\u7a0b\u5c31\u8fdb\u5165\u5230\u4e00\u4e2a\u4e8b\u4ef6\u5faa\u73af\u51fd\u6570\uff0c\u4e3b\u8981\u4f1a\u505a\u4ee5\u4e0b\u4e8b\u60c5\uff1a</p> <ul> <li>\u9996\u5148\uff0c\u5148\u8c03\u7528\u5904\u7406\u53d1\u9001\u961f\u5217\u51fd\u6570\uff0c\u770b\u662f\u53d1\u9001\u961f\u5217\u91cc\u662f\u5426\u6709\u4efb\u52a1\uff0c\u5982\u679c\u6709\u53d1\u9001\u4efb\u52a1\uff0c\u5219\u901a\u8fc7 write \u51fd\u6570\u5c06\u5ba2\u6237\u7aef\u53d1\u9001\u7f13\u5b58\u533a\u91cc\u7684\u6570\u636e\u53d1\u9001\u51fa\u53bb\uff0c\u5982\u679c\u8fd9\u4e00\u8f6e\u6570\u636e\u6ca1\u6709\u53d1\u9001\u5b8c\uff0c\u5c31\u4f1a\u6ce8\u518c\u5199\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\uff0c\u7b49\u5f85 epoll_wait \u53d1\u73b0\u53ef\u5199\u540e\u518d\u5904\u7406\u3002</li> <li>\u63a5\u7740\uff0c\u8c03\u7528 epoll_wait \u51fd\u6570\u7b49\u5f85\u4e8b\u4ef6\u7684\u5230\u6765\uff1a</li> <li>\u5982\u679c\u662f\u8fde\u63a5\u4e8b\u4ef6\u5230\u6765\uff0c\u5219\u4f1a\u8c03\u7528\u8fde\u63a5\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4f1a\u505a\u8fd9\u4e9b\u4e8b\u60c5\uff1a\u8c03\u7528 accpet \u83b7\u53d6\u5df2\u8fde\u63a5\u7684 socket -&gt;  \u8c03\u7528 epoll_ctl \u5c06\u5df2\u8fde\u63a5\u7684 socket \u52a0\u5165\u5230 epoll -&gt; \u6ce8\u518c\u300c\u8bfb\u4e8b\u4ef6\u300d\u5904\u7406\u51fd\u6570\uff1b</li> <li>\u5982\u679c\u662f\u8bfb\u4e8b\u4ef6\u5230\u6765\uff0c\u5219\u4f1a\u8c03\u7528\u8bfb\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4f1a\u505a\u8fd9\u4e9b\u4e8b\u60c5\uff1a\u8c03\u7528 read \u83b7\u53d6\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6570\u636e -&gt; \u89e3\u6790\u547d\u4ee4 -&gt; \u5904\u7406\u547d\u4ee4 -&gt; \u5c06\u5ba2\u6237\u7aef\u5bf9\u8c61\u6dfb\u52a0\u5230\u53d1\u9001\u961f\u5217 -&gt; \u5c06\u6267\u884c\u7ed3\u679c\u5199\u5230\u53d1\u9001\u7f13\u5b58\u533a\u7b49\u5f85\u53d1\u9001\uff1b</li> <li>\u5982\u679c\u662f\u5199\u4e8b\u4ef6\u5230\u6765\uff0c\u5219\u4f1a\u8c03\u7528\u5199\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4f1a\u505a\u8fd9\u4e9b\u4e8b\u60c5\uff1a\u901a\u8fc7 write \u51fd\u6570\u5c06\u5ba2\u6237\u7aef\u53d1\u9001\u7f13\u5b58\u533a\u91cc\u7684\u6570\u636e\u53d1\u9001\u51fa\u53bb\uff0c\u5982\u679c\u8fd9\u4e00\u8f6e\u6570\u636e\u6ca1\u6709\u53d1\u9001\u5b8c\uff0c\u5c31\u4f1a\u7ee7\u7eed\u6ce8\u518c\u5199\u4e8b\u4ef6\u5904\u7406\u51fd\u6570\uff0c\u7b49\u5f85 epoll_wait \u53d1\u73b0\u53ef\u5199\u540e\u518d\u5904\u7406\u3002</li> </ul> <p>\u4ee5\u4e0a\u5c31\u662f Redis \u5355\u7ebf\u6a21\u5f0f\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u5982\u679c\u4f60\u60f3\u770b\u6e90\u7801\u89e3\u6790\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u4e00\u7bc7\uff1a\u4e3a\u4ec0\u4e48\u5355\u7ebf\u7a0b\u7684 Redis \u5982\u4f55\u505a\u5230\u6bcf\u79d2\u6570\u4e07 QPS\uff1f</p>"},{"location":"redis/base/redis_interview/#redis_9","title":"Redis \u91c7\u7528\u5355\u7ebf\u7a0b\u4e3a\u4ec0\u4e48\u8fd8\u8fd9\u4e48\u5feb\uff1f","text":"<p>\u5b98\u65b9\u4f7f\u7528\u57fa\u51c6\u6d4b\u8bd5\u7684\u7ed3\u679c\u662f\uff0c\u5355\u7ebf\u7a0b\u7684 Redis \u541e\u5410\u91cf\u53ef\u4ee5\u8fbe\u5230 10W/\u6bcf\u79d2\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4e4b\u6240\u4ee5 Redis \u91c7\u7528\u5355\u7ebf\u7a0b\uff08\u7f51\u7edc I/O \u548c\u6267\u884c\u547d\u4ee4\uff09\u90a3\u4e48\u5feb\uff0c\u6709\u5982\u4e0b\u51e0\u4e2a\u539f\u56e0\uff1a</p> <ul> <li>Redis \u7684\u5927\u90e8\u5206\u64cd\u4f5c\u90fd\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\uff0c\u5e76\u4e14\u91c7\u7528\u4e86\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784\uff0c\u56e0\u6b64 Redis \u74f6\u9888\u53ef\u80fd\u662f\u673a\u5668\u7684\u5185\u5b58\u6216\u8005\u7f51\u7edc\u5e26\u5bbd\uff0c\u800c\u5e76\u975e CPU\uff0c\u65e2\u7136 CPU \u4e0d\u662f\u74f6\u9888\uff0c\u90a3\u4e48\u81ea\u7136\u5c31\u91c7\u7528\u5355\u7ebf\u7a0b\u7684\u89e3\u51b3\u65b9\u6848\u4e86\uff1b</li> <li>Redis \u91c7\u7528\u5355\u7ebf\u7a0b\u6a21\u578b\u53ef\u4ee5\u907f\u514d\u4e86\u591a\u7ebf\u7a0b\u4e4b\u95f4\u7684\u7ade\u4e89\uff0c\u7701\u53bb\u4e86\u591a\u7ebf\u7a0b\u5207\u6362\u5e26\u6765\u7684\u65f6\u95f4\u548c\u6027\u80fd\u4e0a\u7684\u5f00\u9500\uff0c\u800c\u4e14\u4e5f\u4e0d\u4f1a\u5bfc\u81f4\u6b7b\u9501\u95ee\u9898\u3002</li> <li>Redis \u91c7\u7528\u4e86 I/O \u591a\u8def\u590d\u7528\u673a\u5236\u5904\u7406\u5927\u91cf\u7684\u5ba2\u6237\u7aef Socket \u8bf7\u6c42\uff0cIO \u591a\u8def\u590d\u7528\u673a\u5236\u662f\u6307\u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u591a\u4e2a IO \u6d41\uff0c\u5c31\u662f\u6211\u4eec\u7ecf\u5e38\u542c\u5230\u7684 select/epoll \u673a\u5236\u3002\u7b80\u5355\u6765\u8bf4\uff0c\u5728 Redis \u53ea\u8fd0\u884c\u5355\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u8be5\u673a\u5236\u5141\u8bb8\u5185\u6838\u4e2d\uff0c\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u76d1\u542c Socket \u548c\u5df2\u8fde\u63a5 Socket\u3002\u5185\u6838\u4f1a\u4e00\u76f4\u76d1\u542c\u8fd9\u4e9b Socket \u4e0a\u7684\u8fde\u63a5\u8bf7\u6c42\u6216\u6570\u636e\u8bf7\u6c42\u3002\u4e00\u65e6\u6709\u8bf7\u6c42\u5230\u8fbe\uff0c\u5c31\u4f1a\u4ea4\u7ed9 Redis \u7ebf\u7a0b\u5904\u7406\uff0c\u8fd9\u5c31\u5b9e\u73b0\u4e86\u4e00\u4e2a Redis \u7ebf\u7a0b\u5904\u7406\u591a\u4e2a IO \u6d41\u7684\u6548\u679c\u3002</li> </ul>"},{"location":"redis/base/redis_interview/#redis-60","title":"Redis 6.0 \u4e4b\u524d\u4e3a\u4ec0\u4e48\u4f7f\u7528\u5355\u7ebf\u7a0b\uff1f","text":"<p>\u6211\u4eec\u90fd\u77e5\u9053\u5355\u7ebf\u7a0b\u7684\u7a0b\u5e8f\u662f\u65e0\u6cd5\u5229\u7528\u670d\u52a1\u5668\u7684\u591a\u6838 CPU \u7684\uff0c\u90a3\u4e48\u65e9\u671f Redis \u7248\u672c\u7684\u4e3b\u8981\u5de5\u4f5c\uff08\u7f51\u7edc I/O \u548c\u6267\u884c\u547d\u4ee4\uff09\u4e3a\u4ec0\u4e48\u8fd8\u8981\u4f7f\u7528\u5355\u7ebf\u7a0b\u5462\uff1f\u6211\u4eec\u4e0d\u59a8\u5148\u770b\u4e00\u4e0b Redis \u5b98\u65b9\u7ed9\u51fa\u7684FAQ\u3002</p> <p></p> <p>\u6838\u5fc3\u610f\u601d\u662f\uff1aCPU \u5e76\u4e0d\u662f\u5236\u7ea6 Redis \u6027\u80fd\u8868\u73b0\u7684\u74f6\u9888\u6240\u5728\uff0c\u66f4\u591a\u60c5\u51b5\u4e0b\u662f\u53d7\u5230\u5185\u5b58\u5927\u5c0f\u548c\u7f51\u7edc I/O \u7684\u9650\u5236\uff0c\u6240\u4ee5 Redis \u6838\u5fc3\u7f51\u7edc\u6a21\u578b\u4f7f\u7528\u5355\u7ebf\u7a0b\u5e76\u6ca1\u6709\u4ec0\u4e48\u95ee\u9898\uff0c\u5982\u679c\u4f60\u60f3\u8981\u4f7f\u7528\u670d\u52a1\u7684\u591a\u6838 CPU\uff0c\u53ef\u4ee5\u5728\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u542f\u52a8\u591a\u4e2a\u8282\u70b9\u6216\u8005\u91c7\u7528\u5206\u7247\u96c6\u7fa4\u7684\u65b9\u5f0f\u3002</p> <p>\u9664\u4e86\u4e0a\u9762\u7684\u5b98\u65b9\u56de\u7b54\uff0c\u9009\u62e9\u5355\u7ebf\u7a0b\u7684\u539f\u56e0\u4e5f\u6709\u4e0b\u9762\u7684\u8003\u8651\u3002</p> <p>\u4f7f\u7528\u4e86\u5355\u7ebf\u7a0b\u540e\uff0c\u53ef\u7ef4\u62a4\u6027\u9ad8\uff0c\u591a\u7ebf\u7a0b\u6a21\u578b\u867d\u7136\u5728\u67d0\u4e9b\u65b9\u9762\u8868\u73b0\u4f18\u5f02\uff0c\u4f46\u662f\u5b83\u5374\u5f15\u5165\u4e86\u7a0b\u5e8f\u6267\u884c\u987a\u5e8f\u7684\u4e0d\u786e\u5b9a\u6027\uff0c\u5e26\u6765\u4e86\u5e76\u53d1\u8bfb\u5199\u7684\u4e00\u7cfb\u5217\u95ee\u9898\uff0c\u589e\u52a0\u4e86\u7cfb\u7edf\u590d\u6742\u5ea6\u3001\u540c\u65f6\u53ef\u80fd\u5b58\u5728\u7ebf\u7a0b\u5207\u6362\u3001\u751a\u81f3\u52a0\u9501\u89e3\u9501\u3001\u6b7b\u9501\u9020\u6210\u7684\u6027\u80fd\u635f\u8017\u3002</p>"},{"location":"redis/base/redis_interview/#redis-60_1","title":"Redis 6.0 \u4e4b\u540e\u4e3a\u4ec0\u4e48\u5f15\u5165\u4e86\u591a\u7ebf\u7a0b\uff1f","text":"<p>\u867d\u7136 Redis \u7684\u4e3b\u8981\u5de5\u4f5c\uff08\u7f51\u7edc I/O \u548c\u6267\u884c\u547d\u4ee4\uff09\u4e00\u76f4\u662f\u5355\u7ebf\u7a0b\u6a21\u578b\uff0c\u4f46\u662f\u5728 Redis 6.0 \u7248\u672c\u4e4b\u540e\uff0c\u4e5f\u91c7\u7528\u4e86\u591a\u4e2a I/O \u7ebf\u7a0b\u6765\u5904\u7406\u7f51\u7edc\u8bf7\u6c42\uff0c\u8fd9\u662f\u56e0\u4e3a\u968f\u7740\u7f51\u7edc\u786c\u4ef6\u7684\u6027\u80fd\u63d0\u5347\uff0cRedis \u7684\u6027\u80fd\u74f6\u9888\u6709\u65f6\u4f1a\u51fa\u73b0\u5728\u7f51\u7edc I/O \u7684\u5904\u7406\u4e0a\u3002</p> <p>\u6240\u4ee5\u4e3a\u4e86\u63d0\u9ad8\u7f51\u7edc I/O \u7684\u5e76\u884c\u5ea6\uff0cRedis 6.0 \u5bf9\u4e8e\u7f51\u7edc I/O \u91c7\u7528\u591a\u7ebf\u7a0b\u6765\u5904\u7406\u3002\u4f46\u662f\u5bf9\u4e8e\u547d\u4ee4\u7684\u6267\u884c\uff0cRedis \u4ecd\u7136\u4f7f\u7528\u5355\u7ebf\u7a0b\u6765\u5904\u7406\uff0c\u6240\u4ee5\u5927\u5bb6\u4e0d\u8981\u8bef\u89e3 Redis \u6709\u591a\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u547d\u4ee4\u3002</p> <p>Redis \u5b98\u65b9\u8868\u793a\uff0cRedis 6.0 \u7248\u672c\u5f15\u5165\u7684\u591a\u7ebf\u7a0b I/O \u7279\u6027\u5bf9\u6027\u80fd\u63d0\u5347\u81f3\u5c11\u662f\u4e00\u500d\u4ee5\u4e0a\u3002</p> <p>Redis 6.0 \u7248\u672c\u652f\u6301\u7684 I/O  \u591a\u7ebf\u7a0b\u7279\u6027\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b I/O \u591a\u7ebf\u7a0b\u53ea\u9488\u5bf9\u53d1\u9001\u54cd\u5e94\u6570\u636e\uff08write client socket\uff09\uff0c\u5e76\u4e0d\u4f1a\u4ee5\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u5904\u7406\u8bfb\u8bf7\u6c42\uff08read client socket\uff09\u3002\u8981\u60f3\u5f00\u542f\u591a\u7ebf\u7a0b\u5904\u7406\u5ba2\u6237\u7aef\u8bfb\u8bf7\u6c42\uff0c\u5c31\u9700\u8981\u628a  Redis.conf  \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 io-threads-do-reads \u914d\u7f6e\u9879\u8bbe\u4e3a yes\u3002</p> <p>C<pre><code>//\u8bfb\u8bf7\u6c42\u4e5f\u4f7f\u7528 io \u591a\u7ebf\u7a0b\nio-threads-do-reads yes \n</code></pre> \u540c\u65f6\uff0cRedis.conf  \u914d\u7f6e\u6587\u4ef6\u4e2d\u63d0\u4f9b\u4e86  IO \u591a\u7ebf\u7a0b\u4e2a\u6570\u7684\u914d\u7f6e\u9879\u3002 C<pre><code>// io-threads N\uff0c\u8868\u793a\u542f\u7528 N-1 \u4e2a I/O \u591a\u7ebf\u7a0b\uff08\u4e3b\u7ebf\u7a0b\u4e5f\u7b97\u4e00\u4e2a I/O \u7ebf\u7a0b\uff09\nio-threads 4 \n</code></pre> \u5173\u4e8e\u7ebf\u7a0b\u6570\u7684\u8bbe\u7f6e\uff0c\u5b98\u65b9\u7684\u5efa\u8bae\u662f\u5982\u679c\u4e3a 4 \u6838\u7684 CPU\uff0c\u5efa\u8bae\u7ebf\u7a0b\u6570\u8bbe\u7f6e\u4e3a 2 \u6216 3\uff0c\u5982\u679c\u4e3a 8 \u6838 CPU \u5efa\u8bae\u7ebf\u7a0b\u6570\u8bbe\u7f6e\u4e3a 6\uff0c\u7ebf\u7a0b\u6570\u4e00\u5b9a\u8981\u5c0f\u4e8e\u673a\u5668\u6838\u6570\uff0c\u7ebf\u7a0b\u6570\u5e76\u4e0d\u662f\u8d8a\u5927\u8d8a\u597d\u3002</p> <p>\u56e0\u6b64\uff0cRedis 6.0 \u7248\u672c\u4e4b\u540e\uff0cRedis \u5728\u542f\u52a8\u7684\u65f6\u5019\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4f1a\u521b\u5efa 6 \u4e2a\u7ebf\u7a0b\uff1a</p> <ul> <li>Redis-server\uff1aRedis \u7684\u4e3b\u7ebf\u7a0b\uff0c\u4e3b\u8981\u8d1f\u8d23\u6267\u884c\u547d\u4ee4\uff1b</li> <li>bio_close_file\u3001bio_aof_fsync\u3001bio_lazy_free\uff1a\u4e09\u4e2a\u540e\u53f0\u7ebf\u7a0b\uff0c\u5206\u522b\u5f02\u6b65\u5904\u7406\u5173\u95ed\u6587\u4ef6\u4efb\u52a1\u3001AOF \u5237\u76d8\u4efb\u52a1\u3001\u91ca\u653e\u5185\u5b58\u4efb\u52a1\uff1b</li> <li>io_thd_1\u3001io_thd_2\u3001io_thd_3\uff1a\u4e09\u4e2a I/O \u7ebf\u7a0b\uff0cio-threads \u9ed8\u8ba4\u662f 4\uff0c\u6240\u4ee5\u4f1a\u542f\u52a8 3\uff084-1\uff09\u4e2a I/O \u591a\u7ebf\u7a0b\uff0c\u7528\u6765\u5206\u62c5 Redis \u7f51\u7edc I/O \u7684\u538b\u529b\u3002</li> </ul>"},{"location":"redis/base/redis_interview/#redis_10","title":"Redis \u6301\u4e45\u5316","text":""},{"location":"redis/base/redis_interview/#redis_11","title":"Redis \u5982\u4f55\u5b9e\u73b0\u6570\u636e\u4e0d\u4e22\u5931\uff1f","text":"<p>Redis \u7684\u8bfb\u5199\u64cd\u4f5c\u90fd\u662f\u5728\u5185\u5b58\u4e2d\uff0c\u6240\u4ee5 Redis \u6027\u80fd\u624d\u4f1a\u9ad8\uff0c\u4f46\u662f\u5f53 Redis \u91cd\u542f\u540e\uff0c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\uff0c\u90a3\u4e3a\u4e86\u4fdd\u8bc1\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4e0d\u4f1a\u4e22\u5931\uff0cRedis \u5b9e\u73b0\u4e86\u6570\u636e\u6301\u4e45\u5316\u7684\u673a\u5236\uff0c\u8fd9\u4e2a\u673a\u5236\u4f1a\u628a\u6570\u636e\u5b58\u50a8\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u5728  Redis \u91cd\u542f\u5c31\u80fd\u591f\u4ece\u78c1\u76d8\u4e2d\u6062\u590d\u539f\u6709\u7684\u6570\u636e\u3002</p> <p>Redis \u5171\u6709\u4e09\u79cd\u6570\u636e\u6301\u4e45\u5316\u7684\u65b9\u5f0f\uff1a</p> <ul> <li>AOF \u65e5\u5fd7\uff1a\u6bcf\u6267\u884c\u4e00\u6761\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u5c31\u628a\u8be5\u547d\u4ee4\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u5199\u5165\u5230\u4e00\u4e2a\u6587\u4ef6\u91cc\uff1b</li> <li>RDB \u5feb\u7167\uff1a\u5c06\u67d0\u4e00\u65f6\u523b\u7684\u5185\u5b58\u6570\u636e\uff0c\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u5199\u5165\u78c1\u76d8\uff1b</li> <li>\u6df7\u5408\u6301\u4e45\u5316\u65b9\u5f0f\uff1aRedis  4.0 \u65b0\u589e\u7684\u65b9\u5f0f\uff0c\u96c6\u6210\u4e86 AOF \u548c RBD \u7684\u4f18\u70b9\uff1b</li> </ul>"},{"location":"redis/base/redis_interview/#aof","title":"AOF \u65e5\u5fd7\u662f\u5982\u4f55\u5b9e\u73b0\u7684\uff1f","text":"<p>Redis \u5728\u6267\u884c\u5b8c\u4e00\u6761\u5199\u64cd\u4f5c\u547d\u4ee4\u540e\uff0c\u5c31\u4f1a\u628a\u8be5\u547d\u4ee4\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u5199\u5165\u5230\u4e00\u4e2a\u6587\u4ef6\u91cc\uff0c\u7136\u540e Redis \u91cd\u542f\u65f6\uff0c\u4f1a\u8bfb\u53d6\u8be5\u6587\u4ef6\u8bb0\u5f55\u7684\u547d\u4ee4\uff0c\u7136\u540e\u9010\u4e00\u6267\u884c\u547d\u4ee4\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u6570\u636e\u6062\u590d\u3002</p> <p></p> <p>\u6211\u8fd9\u91cc\u4ee5\u300cset name xiaolin\u300d\u547d\u4ee4\u4f5c\u4e3a\u4f8b\u5b50\uff0cRedis \u6267\u884c\u4e86\u8fd9\u6761\u547d\u4ee4\u540e\uff0c\u8bb0\u5f55\u5728 AOF \u65e5\u5fd7\u91cc\u7684\u5185\u5bb9\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6211\u8fd9\u91cc\u7ed9\u5927\u5bb6\u89e3\u91ca\u4e0b\u3002</p> <p>\u300c*3\u300d\u8868\u793a\u5f53\u524d\u547d\u4ee4\u6709\u4e09\u4e2a\u90e8\u5206\uff0c\u6bcf\u90e8\u5206\u90fd\u662f\u4ee5\u300c$+\u6570\u5b57\u300d\u5f00\u5934\uff0c\u540e\u9762\u7d27\u8ddf\u7740\u5177\u4f53\u7684\u547d\u4ee4\u3001\u952e\u6216\u503c\u3002\u7136\u540e\uff0c\u8fd9\u91cc\u7684\u300c\u6570\u5b57\u300d\u8868\u793a\u8fd9\u90e8\u5206\u4e2d\u7684\u547d\u4ee4\u3001\u952e\u6216\u503c\u4e00\u5171\u6709\u591a\u5c11\u5b57\u8282\u3002\u4f8b\u5982\uff0c\u300c$3 set\u300d\u8868\u793a\u8fd9\u90e8\u5206\u6709 3 \u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u662f\u300cset\u300d\u547d\u4ee4\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002</p> <p>\u4e3a\u4ec0\u4e48\u5148\u6267\u884c\u547d\u4ee4\uff0c\u518d\u628a\u6570\u636e\u5199\u5165\u65e5\u5fd7\u5462\uff1f</p> <p>Reids \u662f\u5148\u6267\u884c\u5199\u64cd\u4f5c\u547d\u4ee4\u540e\uff0c\u624d\u5c06\u8be5\u547d\u4ee4\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u91cc\u7684\uff0c\u8fd9\u4e48\u505a\u5176\u5b9e\u6709\u4e24\u4e2a\u597d\u5904\u3002</p> <ul> <li>\u907f\u514d\u989d\u5916\u7684\u68c0\u67e5\u5f00\u9500\uff1a\u56e0\u4e3a\u5982\u679c\u5148\u5c06\u5199\u64cd\u4f5c\u547d\u4ee4\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u91cc\uff0c\u518d\u6267\u884c\u8be5\u547d\u4ee4\u7684\u8bdd\uff0c\u5982\u679c\u5f53\u524d\u7684\u547d\u4ee4\u8bed\u6cd5\u6709\u95ee\u9898\uff0c\u90a3\u4e48\u5982\u679c\u4e0d\u8fdb\u884c\u547d\u4ee4\u8bed\u6cd5\u68c0\u67e5\uff0c\u8be5\u9519\u8bef\u7684\u547d\u4ee4\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u91cc\u540e\uff0cRedis \u5728\u4f7f\u7528\u65e5\u5fd7\u6062\u590d\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u9519\u3002</li> <li>\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u5199\u64cd\u4f5c\u547d\u4ee4\u7684\u6267\u884c\uff1a\u56e0\u4e3a\u5f53\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\uff0c\u624d\u4f1a\u5c06\u547d\u4ee4\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u3002</li> </ul> <p>\u5f53\u7136\uff0c\u8fd9\u6837\u505a\u4e5f\u4f1a\u5e26\u6765\u98ce\u9669\uff1a</p> <ul> <li>\u6570\u636e\u53ef\u80fd\u4f1a\u4e22\u5931\uff1a \u6267\u884c\u5199\u64cd\u4f5c\u547d\u4ee4\u548c\u8bb0\u5f55\u65e5\u5fd7\u662f\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u90a3\u5f53 Redis \u5728\u8fd8\u6ca1\u6765\u5f97\u53ca\u5c06\u547d\u4ee4\u5199\u5165\u5230\u786c\u76d8\u65f6\uff0c\u670d\u52a1\u5668\u53d1\u751f\u5b95\u673a\u4e86\uff0c\u8fd9\u4e2a\u6570\u636e\u5c31\u4f1a\u6709\u4e22\u5931\u7684\u98ce\u9669\u3002</li> <li>\u53ef\u80fd\u963b\u585e\u5176\u4ed6\u64cd\u4f5c\uff1a \u7531\u4e8e\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\u624d\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\uff0c\u6240\u4ee5\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u547d\u4ee4\u7684\u6267\u884c\uff0c\u4f46\u56e0\u4e3a AOF \u65e5\u5fd7\u4e5f\u662f\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u6267\u884c\uff0c\u6240\u4ee5\u5f53 Redis \u628a\u65e5\u5fd7\u6587\u4ef6\u5199\u5165\u78c1\u76d8\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u4f1a\u963b\u585e\u540e\u7eed\u7684\u64cd\u4f5c\u65e0\u6cd5\u6267\u884c\u3002 <p>AOF \u5199\u56de\u7b56\u7565\u6709\u51e0\u79cd\uff1f</p> </li> </ul> <p>\u5148\u6765\u770b\u770b\uff0cRedis \u5199\u5165 AOF \u65e5\u5fd7\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5177\u4f53\u8bf4\u8bf4\uff1a</p> <ol> <li>Redis \u6267\u884c\u5b8c\u5199\u64cd\u4f5c\u547d\u4ee4\u540e\uff0c\u4f1a\u5c06\u547d\u4ee4\u8ffd\u52a0\u5230 server.aof_buf \u7f13\u51b2\u533a\uff1b</li> <li>\u7136\u540e\u901a\u8fc7 write() \u7cfb\u7edf\u8c03\u7528\uff0c\u5c06 aof_buf \u7f13\u51b2\u533a\u7684\u6570\u636e\u5199\u5165\u5230 AOF \u6587\u4ef6\uff0c\u6b64\u65f6\u6570\u636e\u5e76\u6ca1\u6709\u5199\u5165\u5230\u786c\u76d8\uff0c\u800c\u662f\u62f7\u8d1d\u5230\u4e86\u5185\u6838\u7f13\u51b2\u533a page cache\uff0c\u7b49\u5f85\u5185\u6838\u5c06\u6570\u636e\u5199\u5165\u786c\u76d8\uff1b</li> <li>\u5177\u4f53\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u4ec0\u4e48\u65f6\u5019\u5199\u5165\u5230\u786c\u76d8\uff0c\u7531\u5185\u6838\u51b3\u5b9a\u3002</li> </ol> <p>Redis \u63d0\u4f9b\u4e86 3 \u79cd\u5199\u56de\u786c\u76d8\u7684\u7b56\u7565\uff0c\u63a7\u5236\u7684\u5c31\u662f\u4e0a\u9762\u8bf4\u7684\u7b2c\u4e09\u6b65\u7684\u8fc7\u7a0b\u3002 \u5728 Redis.conf \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 appendfsync \u914d\u7f6e\u9879\u53ef\u4ee5\u6709\u4ee5\u4e0b 3 \u79cd\u53c2\u6570\u53ef\u586b\uff1a</p> <ul> <li>Always\uff0c\u8fd9\u4e2a\u5355\u8bcd\u7684\u610f\u601d\u662f\u300c\u603b\u662f\u300d\uff0c\u6240\u4ee5\u5b83\u7684\u610f\u601d\u662f\u6bcf\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u540c\u6b65\u5c06 AOF \u65e5\u5fd7\u6570\u636e\u5199\u56de\u786c\u76d8\uff1b</li> <li>Everysec\uff0c\u8fd9\u4e2a\u5355\u8bcd\u7684\u610f\u601d\u662f\u300c\u6bcf\u79d2\u300d\uff0c\u6240\u4ee5\u5b83\u7684\u610f\u601d\u662f\u6bcf\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u5148\u5c06\u547d\u4ee4\u5199\u5165\u5230 AOF \u6587\u4ef6\u7684\u5185\u6838\u7f13\u51b2\u533a\uff0c\u7136\u540e\u6bcf\u9694\u4e00\u79d2\u5c06\u7f13\u51b2\u533a\u91cc\u7684\u5185\u5bb9\u5199\u56de\u5230\u786c\u76d8\uff1b</li> <li>No\uff0c\u610f\u5473\u7740\u4e0d\u7531 Redis \u63a7\u5236\u5199\u56de\u786c\u76d8\u7684\u65f6\u673a\uff0c\u8f6c\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u5199\u56de\u7684\u65f6\u673a\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u5148\u5c06\u547d\u4ee4\u5199\u5165\u5230 AOF \u6587\u4ef6\u7684\u5185\u6838\u7f13\u51b2\u533a\uff0c\u518d\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f55\u65f6\u5c06\u7f13\u51b2\u533a\u5185\u5bb9\u5199\u56de\u786c\u76d8\u3002</li> </ul> <p>\u6211\u4e5f\u628a\u8fd9 3 \u4e2a\u5199\u56de\u7b56\u7565\u7684\u4f18\u7f3a\u70b9\u603b\u7ed3\u6210\u4e86\u4e00\u5f20\u8868\u683c\uff1a</p> <p></p> <p>AOF \u65e5\u5fd7\u8fc7\u5927\uff0c\u4f1a\u89e6\u53d1\u4ec0\u4e48\u673a\u5236\uff1f</p> <p>AOF \u65e5\u5fd7\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u968f\u7740\u6267\u884c\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\u8d8a\u6765\u8d8a\u591a\uff0c\u6587\u4ef6\u7684\u5927\u5c0f\u4f1a\u8d8a\u6765\u8d8a\u5927\u3002 \u5982\u679c\u5f53 AOF \u65e5\u5fd7\u6587\u4ef6\u8fc7\u5927\u5c31\u4f1a\u5e26\u6765\u6027\u80fd\u95ee\u9898\uff0c\u6bd4\u5982\u91cd\u542f Redis \u540e\uff0c\u9700\u8981\u8bfb AOF \u6587\u4ef6\u7684\u5185\u5bb9\u4ee5\u6062\u590d\u6570\u636e\uff0c\u5982\u679c\u6587\u4ef6\u8fc7\u5927\uff0c\u6574\u4e2a\u6062\u590d\u7684\u8fc7\u7a0b\u5c31\u4f1a\u5f88\u6162\u3002</p> <p>\u6240\u4ee5\uff0cRedis \u4e3a\u4e86\u907f\u514d AOF \u6587\u4ef6\u8d8a\u5199\u8d8a\u5927\uff0c\u63d0\u4f9b\u4e86 AOF \u91cd\u5199\u673a\u5236\uff0c\u5f53 AOF \u6587\u4ef6\u7684\u5927\u5c0f\u8d85\u8fc7\u6240\u8bbe\u5b9a\u7684\u9608\u503c\u540e\uff0cRedis \u5c31\u4f1a\u542f\u7528 AOF \u91cd\u5199\u673a\u5236\uff0c\u6765\u538b\u7f29 AOF \u6587\u4ef6\u3002</p> <p>AOF \u91cd\u5199\u673a\u5236\u662f\u5728\u91cd\u5199\u65f6\uff0c\u8bfb\u53d6\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e\u503c\u5bf9\uff0c\u7136\u540e\u5c06\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\u7528\u4e00\u6761\u547d\u4ee4\u8bb0\u5f55\u5230\u300c\u65b0\u7684 AOF \u6587\u4ef6\u300d\uff0c\u7b49\u5230\u5168\u90e8\u8bb0\u5f55\u5b8c\u540e\uff0c\u5c31\u5c06\u65b0\u7684 AOF \u6587\u4ef6\u66ff\u6362\u6389\u73b0\u6709\u7684 AOF \u6587\u4ef6\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728\u6ca1\u6709\u4f7f\u7528\u91cd\u5199\u673a\u5236\u524d\uff0c\u5047\u8bbe\u524d\u540e\u6267\u884c\u4e86\u300cset name xiaolin\u300d\u548c\u300cset name xiaolincoding\u300d\u8fd9\u4e24\u4e2a\u547d\u4ee4\u7684\u8bdd\uff0c\u5c31\u4f1a\u5c06\u8fd9\u4e24\u4e2a\u547d\u4ee4\u8bb0\u5f55\u5230 AOF \u6587\u4ef6\u3002</p> <p></p> <p>\u4f46\u662f\u5728\u4f7f\u7528\u91cd\u5199\u673a\u5236\u540e\uff0c\u5c31\u4f1a\u8bfb\u53d6 name \u6700\u65b0\u7684 value\uff08\u952e\u503c\u5bf9\uff09 \uff0c\u7136\u540e\u7528\u4e00\u6761\u300cset name xiaolincoding\u300d\u547d\u4ee4\u8bb0\u5f55\u5230\u65b0\u7684 AOF \u6587\u4ef6\uff0c\u4e4b\u524d\u7684\u7b2c\u4e00\u4e2a\u547d\u4ee4\u5c31\u6ca1\u6709\u5fc5\u8981\u8bb0\u5f55\u4e86\uff0c\u56e0\u4e3a\u5b83\u5c5e\u4e8e\u300c\u5386\u53f2\u300d\u547d\u4ee4\uff0c\u6ca1\u6709\u4f5c\u7528\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e00\u4e2a\u952e\u503c\u5bf9\u5728\u91cd\u5199\u65e5\u5fd7\u4e2d\u53ea\u7528\u4e00\u6761\u547d\u4ee4\u5c31\u884c\u4e86\u3002</p> <p>\u91cd\u5199\u5de5\u4f5c\u5b8c\u6210\u540e\uff0c\u5c31\u4f1a\u5c06\u65b0\u7684 AOF \u6587\u4ef6\u8986\u76d6\u73b0\u6709\u7684 AOF \u6587\u4ef6\uff0c\u8fd9\u5c31\u76f8\u5f53\u4e8e\u538b\u7f29\u4e86 AOF \u6587\u4ef6\uff0c\u4f7f\u5f97 AOF \u6587\u4ef6\u4f53\u79ef\u53d8\u5c0f\u4e86\u3002</p> <p>\u91cd\u5199 AOF \u65e5\u5fd7\u7684\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f</p> <p>Redis \u7684\u91cd\u5199 AOF \u8fc7\u7a0b\u662f\u7531\u540e\u53f0\u5b50\u8fdb\u7a0b bgrewriteaof \u6765\u5b8c\u6210\u7684\uff0c\u8fd9\u4e48\u505a\u53ef\u4ee5\u8fbe\u5230\u4e24\u4e2a\u597d\u5904\uff1a</p> <ul> <li>\u5b50\u8fdb\u7a0b\u8fdb\u884c AOF \u91cd\u5199\u671f\u95f4\uff0c\u4e3b\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u5904\u7406\u547d\u4ee4\u8bf7\u6c42\uff0c\u4ece\u800c\u907f\u514d\u963b\u585e\u4e3b\u8fdb\u7a0b\uff1b</li> <li>\u5b50\u8fdb\u7a0b\u5e26\u6709\u4e3b\u8fdb\u7a0b\u7684\u6570\u636e\u526f\u672c\uff0c\u8fd9\u91cc\u4f7f\u7528\u5b50\u8fdb\u7a0b\u800c\u4e0d\u662f\u7ebf\u7a0b\uff0c\u56e0\u4e3a\u5982\u679c\u662f\u4f7f\u7528\u7ebf\u7a0b\uff0c\u591a\u7ebf\u7a0b\u4e4b\u95f4\u4f1a\u5171\u4eab\u5185\u5b58\uff0c\u90a3\u4e48\u5728\u4fee\u6539\u5171\u4eab\u5185\u5b58\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u8fc7\u52a0\u9501\u6765\u4fdd\u8bc1\u6570\u636e\u7684\u5b89\u5168\uff0c\u800c\u8fd9\u6837\u5c31\u4f1a\u964d\u4f4e\u6027\u80fd\u3002\u800c\u4f7f\u7528\u5b50\u8fdb\u7a0b\uff0c\u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u7236\u5b50\u8fdb\u7a0b\u662f\u5171\u4eab\u5185\u5b58\u6570\u636e\u7684\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u5171\u4eab\u7684\u5185\u5b58\u53ea\u80fd\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\uff0c\u800c\u5f53\u7236\u5b50\u8fdb\u7a0b\u4efb\u610f\u4e00\u65b9\u4fee\u6539\u4e86\u8be5\u5171\u4eab\u5185\u5b58\uff0c\u5c31\u4f1a\u53d1\u751f\u300c\u5199\u65f6\u590d\u5236\u300d\uff0c\u4e8e\u662f\u7236\u5b50\u8fdb\u7a0b\u5c31\u6709\u4e86\u72ec\u7acb\u7684\u6570\u636e\u526f\u672c\uff0c\u5c31\u4e0d\u7528\u52a0\u9501\u6765\u4fdd\u8bc1\u6570\u636e\u5b89\u5168\u3002</li> </ul> <p>\u89e6\u53d1\u91cd\u5199\u673a\u5236\u540e\uff0c\u4e3b\u8fdb\u7a0b\u5c31\u4f1a\u521b\u5efa\u91cd\u5199 AOF \u7684\u5b50\u8fdb\u7a0b\uff0c\u6b64\u65f6\u7236\u5b50\u8fdb\u7a0b\u5171\u4eab\u7269\u7406\u5185\u5b58\uff0c\u91cd\u5199\u5b50\u8fdb\u7a0b\u53ea\u4f1a\u5bf9\u8fd9\u4e2a\u5185\u5b58\u8fdb\u884c\u53ea\u8bfb\uff0c\u91cd\u5199 AOF \u5b50\u8fdb\u7a0b\u4f1a\u8bfb\u53d6\u6570\u636e\u5e93\u91cc\u7684\u6240\u6709\u6570\u636e\uff0c\u5e76\u9010\u4e00\u628a\u5185\u5b58\u6570\u636e\u7684\u952e\u503c\u5bf9\u8f6c\u6362\u6210\u4e00\u6761\u547d\u4ee4\uff0c\u518d\u5c06\u547d\u4ee4\u8bb0\u5f55\u5230\u91cd\u5199\u65e5\u5fd7\uff08\u65b0\u7684 AOF \u6587\u4ef6\uff09\u3002</p> <p>\u4f46\u662f\u91cd\u5199\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8fdb\u7a0b\u4f9d\u7136\u53ef\u4ee5\u6b63\u5e38\u5904\u7406\u547d\u4ee4\uff0c\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u91cd\u5199 AOF \u65e5\u5fd7\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4e3b\u8fdb\u7a0b\u4fee\u6539\u4e86\u5df2\u7ecf\u5b58\u5728 key-value\uff0c\u90a3\u4e48\u4f1a\u53d1\u751f\u5199\u65f6\u590d\u5236\uff0c\u6b64\u65f6\u8fd9\u4e2a key-value \u6570\u636e\u5728\u5b50\u8fdb\u7a0b\u7684\u5185\u5b58\u6570\u636e\u5c31\u8ddf\u4e3b\u8fdb\u7a0b\u7684\u5185\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u4e86\uff0c\u8fd9\u65f6\u8981\u600e\u4e48\u529e\u5462\uff1f</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u79cd\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0cRedis \u8bbe\u7f6e\u4e86\u4e00\u4e2a AOF \u91cd\u5199\u7f13\u51b2\u533a\uff0c\u8fd9\u4e2a\u7f13\u51b2\u533a\u5728\u521b\u5efa bgrewriteaof \u5b50\u8fdb\u7a0b\u4e4b\u540e\u5f00\u59cb\u4f7f\u7528\u3002</p> <p>\u5728\u91cd\u5199 AOF \u671f\u95f4\uff0c\u5f53 Redis \u6267\u884c\u5b8c\u4e00\u4e2a\u5199\u547d\u4ee4\u4e4b\u540e\uff0c\u5b83\u4f1a\u540c\u65f6\u5c06\u8fd9\u4e2a\u5199\u547d\u4ee4\u5199\u5165\u5230\u300cAOF \u7f13\u51b2\u533a\u300d\u548c\u300cAOF \u91cd\u5199\u7f13\u51b2\u533a\u300d\u3002</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728 bgrewriteaof \u5b50\u8fdb\u7a0b\u6267\u884c AOF \u91cd\u5199\u671f\u95f4\uff0c\u4e3b\u8fdb\u7a0b\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u4e09\u4e2a\u5de5\u4f5c\uff1a</p> <ul> <li>\u6267\u884c\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u547d\u4ee4\uff1b</li> <li>\u5c06\u6267\u884c\u540e\u7684\u5199\u547d\u4ee4\u8ffd\u52a0\u5230\u300cAOF \u7f13\u51b2\u533a\u300d\uff1b</li> <li>\u5c06\u6267\u884c\u540e\u7684\u5199\u547d\u4ee4\u8ffd\u52a0\u5230\u300cAOF \u91cd\u5199\u7f13\u51b2\u533a\u300d\uff1b</li> </ul> <p>\u5f53\u5b50\u8fdb\u7a0b\u5b8c\u6210 AOF \u91cd\u5199\u5de5\u4f5c\uff08\u626b\u63cf\u6570\u636e\u5e93\u4e2d\u6240\u6709\u6570\u636e\uff0c\u9010\u4e00\u628a\u5185\u5b58\u6570\u636e\u7684\u952e\u503c\u5bf9\u8f6c\u6362\u6210\u4e00\u6761\u547d\u4ee4\uff0c\u518d\u5c06\u547d\u4ee4\u8bb0\u5f55\u5230\u91cd\u5199\u65e5\u5fd7\uff09\u540e\uff0c\u4f1a\u5411\u4e3b\u8fdb\u7a0b\u53d1\u9001\u4e00\u6761\u4fe1\u53f7\uff0c\u4fe1\u53f7\u662f\u8fdb\u7a0b\u95f4\u901a\u8baf\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u4e14\u662f\u5f02\u6b65\u7684\u3002</p> <p>\u4e3b\u8fdb\u7a0b\u6536\u5230\u8be5\u4fe1\u53f7\u540e\uff0c\u4f1a\u8c03\u7528\u4e00\u4e2a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4e3b\u8981\u505a\u4ee5\u4e0b\u5de5\u4f5c\uff1a</p> <ul> <li>\u5c06 AOF \u91cd\u5199\u7f13\u51b2\u533a\u4e2d\u7684\u6240\u6709\u5185\u5bb9\u8ffd\u52a0\u5230\u65b0\u7684 AOF \u7684\u6587\u4ef6\u4e2d\uff0c\u4f7f\u5f97\u65b0\u65e7\u4e24\u4e2a AOF \u6587\u4ef6\u6240\u4fdd\u5b58\u7684\u6570\u636e\u5e93\u72b6\u6001\u4e00\u81f4\uff1b</li> <li>\u65b0\u7684 AOF \u7684\u6587\u4ef6\u8fdb\u884c\u6539\u540d\uff0c\u8986\u76d6\u73b0\u6709\u7684 AOF \u6587\u4ef6\u3002</li> </ul> <p>\u4fe1\u53f7\u51fd\u6570\u6267\u884c\u5b8c\u540e\uff0c\u4e3b\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u7ee7\u7eed\u50cf\u5f80\u5e38\u4e00\u6837\u5904\u7406\u547d\u4ee4\u4e86\u3002</p> <p>::: tip</p> <p>AOF \u65e5\u5fd7\u7684\u5185\u5bb9\u5c31\u6682\u65f6\u63d0\u8fd9\u4e9b\uff0c\u60f3\u66f4\u8be6\u7ec6\u4e86\u89e3 AOF \u65e5\u5fd7\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u53ef\u4ee5\u8be6\u7ec6\u770b\u8fd9\u7bc7\uff1aAOF \u6301\u4e45\u5316\u662f\u600e\u4e48\u5b9e\u73b0\u7684</p> <p>:::</p>"},{"location":"redis/base/redis_interview/#rdb","title":"RDB \u5feb\u7167\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u5462\uff1f","text":"<p>\u56e0\u4e3a AOF \u65e5\u5fd7\u8bb0\u5f55\u7684\u662f\u64cd\u4f5c\u547d\u4ee4\uff0c\u4e0d\u662f\u5b9e\u9645\u7684\u6570\u636e\uff0c\u6240\u4ee5\u7528 AOF \u65b9\u6cd5\u505a\u6545\u969c\u6062\u590d\u65f6\uff0c\u9700\u8981\u5168\u91cf\u628a\u65e5\u5fd7\u90fd\u6267\u884c\u4e00\u904d\uff0c\u4e00\u65e6 AOF \u65e5\u5fd7\u975e\u5e38\u591a\uff0c\u52bf\u5fc5\u4f1a\u9020\u6210 Redis \u7684\u6062\u590d\u64cd\u4f5c\u7f13\u6162\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u589e\u52a0\u4e86 RDB \u5feb\u7167\u3002\u6240\u8c13\u7684\u5feb\u7167\uff0c\u5c31\u662f\u8bb0\u5f55\u67d0\u4e00\u4e2a\u77ac\u95f4\u4e1c\u897f\uff0c\u6bd4\u5982\u5f53\u6211\u4eec\u7ed9\u98ce\u666f\u62cd\u7167\u65f6\uff0c\u90a3\u4e00\u4e2a\u77ac\u95f4\u7684\u753b\u9762\u548c\u4fe1\u606f\u5c31\u8bb0\u5f55\u5230\u4e86\u4e00\u5f20\u7167\u7247\u3002</p> <p>\u6240\u4ee5\uff0cRDB \u5feb\u7167\u5c31\u662f\u8bb0\u5f55\u67d0\u4e00\u4e2a\u77ac\u95f4\u7684\u5185\u5b58\u6570\u636e\uff0c\u8bb0\u5f55\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u800c AOF \u6587\u4ef6\u8bb0\u5f55\u7684\u662f\u547d\u4ee4\u64cd\u4f5c\u7684\u65e5\u5fd7\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u7684\u6570\u636e\u3002</p> <p>\u56e0\u6b64\u5728 Redis \u6062\u590d\u6570\u636e\u65f6\uff0cRDB \u6062\u590d\u6570\u636e\u7684\u6548\u7387\u4f1a\u6bd4 AOF \u9ad8\u4e9b\uff0c\u56e0\u4e3a\u76f4\u63a5\u5c06 RDB \u6587\u4ef6\u8bfb\u5165\u5185\u5b58\u5c31\u53ef\u4ee5\uff0c\u4e0d\u9700\u8981\u50cf AOF \u90a3\u6837\u8fd8\u9700\u8981\u989d\u5916\u6267\u884c\u64cd\u4f5c\u547d\u4ee4\u7684\u6b65\u9aa4\u624d\u80fd\u6062\u590d\u6570\u636e\u3002</p> <p>RDB \u505a\u5feb\u7167\u65f6\u4f1a\u963b\u585e\u7ebf\u7a0b\u5417\uff1f</p> <p>Redis \u63d0\u4f9b\u4e86\u4e24\u4e2a\u547d\u4ee4\u6765\u751f\u6210 RDB \u6587\u4ef6\uff0c\u5206\u522b\u662f save \u548c bgsave\uff0c\u4ed6\u4eec\u7684\u533a\u522b\u5c31\u5728\u4e8e\u662f\u5426\u5728\u300c\u4e3b\u7ebf\u7a0b\u300d\u91cc\u6267\u884c\uff1a</p> <ul> <li>\u6267\u884c\u4e86 save \u547d\u4ee4\uff0c\u5c31\u4f1a\u5728\u4e3b\u7ebf\u7a0b\u751f\u6210 RDB \u6587\u4ef6\uff0c\u7531\u4e8e\u548c\u6267\u884c\u64cd\u4f5c\u547d\u4ee4\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u4ee5\u5982\u679c\u5199\u5165 RDB \u6587\u4ef6\u7684\u65f6\u95f4\u592a\u957f\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff1b</li> <li>\u6267\u884c\u4e86 bgsave \u547d\u4ee4\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u751f\u6210 RDB \u6587\u4ef6\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\uff1b</li> </ul> <p>Redis \u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u7684\u9009\u9879\u6765\u5b9e\u73b0\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u81ea\u52a8\u6267\u884c\u4e00\u6b21 bgsave \u547d\u4ee4\uff0c\u9ed8\u8ba4\u4f1a\u63d0\u4f9b\u4ee5\u4e0b\u914d\u7f6e\uff1a C<pre><code>save 900 1\nsave 300 10\nsave 60 10000\n</code></pre> \u522b\u770b\u9009\u9879\u540d\u53eb save\uff0c\u5b9e\u9645\u4e0a\u6267\u884c\u7684\u662f bgsave \u547d\u4ee4\uff0c\u4e5f\u5c31\u662f\u4f1a\u521b\u5efa\u5b50\u8fdb\u7a0b\u6765\u751f\u6210 RDB \u5feb\u7167\u6587\u4ef6\u3002 \u53ea\u8981\u6ee1\u8db3\u4e0a\u9762\u6761\u4ef6\u7684\u4efb\u610f\u4e00\u4e2a\uff0c\u5c31\u4f1a\u6267\u884c bgsave\uff0c\u5b83\u4eec\u7684\u610f\u601d\u5206\u522b\u662f\uff1a</p> <ul> <li>900 \u79d2\u4e4b\u5185\uff0c\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e86\u81f3\u5c11 1 \u6b21\u4fee\u6539\uff1b</li> <li>300 \u79d2\u4e4b\u5185\uff0c\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e86\u81f3\u5c11 10 \u6b21\u4fee\u6539\uff1b</li> <li>60 \u79d2\u4e4b\u5185\uff0c\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e86\u81f3\u5c11 10000 \u6b21\u4fee\u6539\u3002</li> </ul> <p>\u8fd9\u91cc\u63d0\u4e00\u70b9\uff0cRedis \u7684\u5feb\u7167\u662f\u5168\u91cf\u5feb\u7167\uff0c\u4e5f\u5c31\u662f\u8bf4\u6bcf\u6b21\u6267\u884c\u5feb\u7167\uff0c\u90fd\u662f\u628a\u5185\u5b58\u4e2d\u7684\u300c\u6240\u6709\u6570\u636e\u300d\u90fd\u8bb0\u5f55\u5230\u78c1\u76d8\u4e2d\u3002\u6240\u4ee5\u6267\u884c\u5feb\u7167\u662f\u4e00\u4e2a\u6bd4\u8f83\u91cd\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u9891\u7387\u592a\u9891\u7e41\uff0c\u53ef\u80fd\u4f1a\u5bf9 Redis \u6027\u80fd\u4ea7\u751f\u5f71\u54cd\u3002\u5982\u679c\u9891\u7387\u592a\u4f4e\uff0c\u670d\u52a1\u5668\u6545\u969c\u65f6\uff0c\u4e22\u5931\u7684\u6570\u636e\u4f1a\u66f4\u591a\u3002</p> <p>RDB \u5728\u6267\u884c\u5feb\u7167\u7684\u65f6\u5019\uff0c\u6570\u636e\u80fd\u4fee\u6539\u5417\uff1f</p> <p>\u53ef\u4ee5\u7684\uff0c\u6267\u884c bgsave \u8fc7\u7a0b\u4e2d\uff0cRedis \u4f9d\u7136\u53ef\u4ee5\u7ee7\u7eed\u5904\u7406\u64cd\u4f5c\u547d\u4ee4\u7684\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u662f\u80fd\u88ab\u4fee\u6539\u7684\uff0c\u5173\u952e\u7684\u6280\u672f\u5c31\u5728\u4e8e\u5199\u65f6\u590d\u5236\u6280\u672f\uff08Copy-On-Write, COW\uff09\u3002</p> <p>\u6267\u884c bgsave \u547d\u4ee4\u7684\u65f6\u5019\uff0c\u4f1a\u901a\u8fc7 fork() \u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u6b64\u65f6\u5b50\u8fdb\u7a0b\u548c\u7236\u8fdb\u7a0b\u662f\u5171\u4eab\u540c\u4e00\u7247\u5185\u5b58\u6570\u636e\u7684\uff0c\u56e0\u4e3a\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u4f1a\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u9875\u8868\uff0c\u4f46\u662f\u9875\u8868\u6307\u5411\u7684\u7269\u7406\u5185\u5b58\u8fd8\u662f\u4e00\u4e2a\uff0c\u6b64\u65f6\u5982\u679c\u4e3b\u7ebf\u7a0b\u6267\u884c\u8bfb\u64cd\u4f5c\uff0c\u5219\u4e3b\u7ebf\u7a0b\u548c bgsave \u5b50\u8fdb\u7a0b\u4e92\u76f8\u4e0d\u5f71\u54cd\u3002</p> <p></p> <p>\u5982\u679c\u4e3b\u7ebf\u7a0b\u6267\u884c\u5199\u64cd\u4f5c\uff0c\u5219\u88ab\u4fee\u6539\u7684\u6570\u636e\u4f1a\u590d\u5236\u4e00\u4efd\u526f\u672c\uff0c\u7136\u540e bgsave \u5b50\u8fdb\u7a0b\u4f1a\u628a\u8be5\u526f\u672c\u6570\u636e\u5199\u5165 RDB \u6587\u4ef6\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u7ebf\u7a0b\u4ecd\u7136\u53ef\u4ee5\u76f4\u63a5\u4fee\u6539\u539f\u6765\u7684\u6570\u636e\u3002</p> <p></p> <p>::: tip</p> <p>RDB \u5feb\u7167\u7684\u5185\u5bb9\u5c31\u6682\u65f6\u63d0\u8fd9\u4e9b\uff0c\u60f3\u66f4\u8be6\u7ec6\u4e86\u89e3 RDB \u5feb\u7167\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u53ef\u4ee5\u8be6\u7ec6\u770b\u8fd9\u7bc7\uff1aRDB \u5feb\u7167\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f</p> <p>:::</p>"},{"location":"redis/base/redis_interview/#_1","title":"\u4e3a\u4ec0\u4e48\u4f1a\u6709\u6df7\u5408\u6301\u4e45\u5316\uff1f","text":"<p>RDB \u4f18\u70b9\u662f\u6570\u636e\u6062\u590d\u901f\u5ea6\u5feb\uff0c\u4f46\u662f\u5feb\u7167\u7684\u9891\u7387\u4e0d\u597d\u628a\u63e1\u3002\u9891\u7387\u592a\u4f4e\uff0c\u4e22\u5931\u7684\u6570\u636e\u5c31\u4f1a\u6bd4\u8f83\u591a\uff0c\u9891\u7387\u592a\u9ad8\uff0c\u5c31\u4f1a\u5f71\u54cd\u6027\u80fd\u3002</p> <p>AOF \u4f18\u70b9\u662f\u4e22\u5931\u6570\u636e\u5c11\uff0c\u4f46\u662f\u6570\u636e\u6062\u590d\u4e0d\u5feb\u3002</p> <p>\u4e3a\u4e86\u96c6\u6210\u4e86\u4e24\u8005\u7684\u4f18\u70b9\uff0cRedis 4.0 \u63d0\u51fa\u4e86\u6df7\u5408\u4f7f\u7528 AOF \u65e5\u5fd7\u548c\u5185\u5b58\u5feb\u7167\uff0c\u4e5f\u53eb\u6df7\u5408\u6301\u4e45\u5316\uff0c\u65e2\u4fdd\u8bc1\u4e86 Redis \u91cd\u542f\u901f\u5ea6\uff0c\u53c8\u964d\u4f4e\u6570\u636e\u4e22\u5931\u98ce\u9669\u3002</p> <p>\u6df7\u5408\u6301\u4e45\u5316\u5de5\u4f5c\u5728 AOF \u65e5\u5fd7\u91cd\u5199\u8fc7\u7a0b\uff0c\u5f53\u5f00\u542f\u4e86\u6df7\u5408\u6301\u4e45\u5316\u65f6\uff0c\u5728 AOF \u91cd\u5199\u65e5\u5fd7\u65f6\uff0cfork \u51fa\u6765\u7684\u91cd\u5199\u5b50\u8fdb\u7a0b\u4f1a\u5148\u5c06\u4e0e\u4e3b\u7ebf\u7a0b\u5171\u4eab\u7684\u5185\u5b58\u6570\u636e\u4ee5 RDB \u65b9\u5f0f\u5199\u5165\u5230 AOF \u6587\u4ef6\uff0c\u7136\u540e\u4e3b\u7ebf\u7a0b\u5904\u7406\u7684\u64cd\u4f5c\u547d\u4ee4\u4f1a\u88ab\u8bb0\u5f55\u5728\u91cd\u5199\u7f13\u51b2\u533a\u91cc\uff0c\u91cd\u5199\u7f13\u51b2\u533a\u91cc\u7684\u589e\u91cf\u547d\u4ee4\u4f1a\u4ee5 AOF \u65b9\u5f0f\u5199\u5165\u5230 AOF \u6587\u4ef6\uff0c\u5199\u5165\u5b8c\u6210\u540e\u901a\u77e5\u4e3b\u8fdb\u7a0b\u5c06\u65b0\u7684\u542b\u6709 RDB \u683c\u5f0f\u548c AOF \u683c\u5f0f\u7684 AOF \u6587\u4ef6\u66ff\u6362\u65e7\u7684\u7684 AOF \u6587\u4ef6\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f7f\u7528\u4e86\u6df7\u5408\u6301\u4e45\u5316\uff0cAOF \u6587\u4ef6\u7684\u524d\u534a\u90e8\u5206\u662f RDB \u683c\u5f0f\u7684\u5168\u91cf\u6570\u636e\uff0c\u540e\u534a\u90e8\u5206\u662f AOF \u683c\u5f0f\u7684\u589e\u91cf\u6570\u636e\u3002</p> <p></p> <p>\u8fd9\u6837\u7684\u597d\u5904\u5728\u4e8e\uff0c\u91cd\u542f Redis \u52a0\u8f7d\u6570\u636e\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u524d\u534a\u90e8\u5206\u662f RDB \u5185\u5bb9\uff0c\u8fd9\u6837\u52a0\u8f7d\u7684\u65f6\u5019\u901f\u5ea6\u4f1a\u5f88\u5feb\u3002</p> <p>\u52a0\u8f7d\u5b8c RDB \u7684\u5185\u5bb9\u540e\uff0c\u624d\u4f1a\u52a0\u8f7d\u540e\u534a\u90e8\u5206\u7684 AOF \u5185\u5bb9\uff0c\u8fd9\u91cc\u7684\u5185\u5bb9\u662f Redis \u540e\u53f0\u5b50\u8fdb\u7a0b\u91cd\u5199 AOF \u671f\u95f4\uff0c\u4e3b\u7ebf\u7a0b\u5904\u7406\u7684\u64cd\u4f5c\u547d\u4ee4\uff0c\u53ef\u4ee5\u4f7f\u5f97\u6570\u636e\u66f4\u5c11\u7684\u4e22\u5931\u3002</p> <p>\u6df7\u5408\u6301\u4e45\u5316\u4f18\u70b9\uff1a</p> <ul> <li>\u6df7\u5408\u6301\u4e45\u5316\u7ed3\u5408\u4e86 RDB \u548c AOF \u6301\u4e45\u5316\u7684\u4f18\u70b9\uff0c\u5f00\u5934\u4e3a RDB \u7684\u683c\u5f0f\uff0c\u4f7f\u5f97 Redis \u53ef\u4ee5\u66f4\u5feb\u7684\u542f\u52a8\uff0c\u540c\u65f6\u7ed3\u5408 AOF \u7684\u4f18\u70b9\uff0c\u6709\u51cf\u4f4e\u4e86\u5927\u91cf\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669\u3002</li> </ul> <p>\u6df7\u5408\u6301\u4e45\u5316\u7f3a\u70b9\uff1a</p> <ul> <li>AOF \u6587\u4ef6\u4e2d\u6dfb\u52a0\u4e86 RDB \u683c\u5f0f\u7684\u5185\u5bb9\uff0c\u4f7f\u5f97 AOF \u6587\u4ef6\u7684\u53ef\u8bfb\u6027\u53d8\u5f97\u5f88\u5dee\uff1b</li> <li>\u517c\u5bb9\u6027\u5dee\uff0c\u5982\u679c\u5f00\u542f\u6df7\u5408\u6301\u4e45\u5316\uff0c\u90a3\u4e48\u6b64\u6df7\u5408\u6301\u4e45\u5316 AOF \u6587\u4ef6\uff0c\u5c31\u4e0d\u80fd\u7528\u5728 Redis 4.0 \u4e4b\u524d\u7248\u672c\u4e86\u3002</li> </ul>"},{"location":"redis/base/redis_interview/#redis_12","title":"Redis \u96c6\u7fa4","text":""},{"location":"redis/base/redis_interview/#redis_13","title":"Redis \u5982\u4f55\u5b9e\u73b0\u670d\u52a1\u9ad8\u53ef\u7528\uff1f","text":"<p>\u8981\u60f3\u8bbe\u8ba1\u4e00\u4e2a\u9ad8\u53ef\u7528\u7684 Redis \u670d\u52a1\uff0c\u4e00\u5b9a\u8981\u4ece Redis \u7684\u591a\u670d\u52a1\u8282\u70b9\u6765\u8003\u8651\uff0c\u6bd4\u5982 Redis \u7684\u4e3b\u4ece\u590d\u5236\u3001\u54e8\u5175\u6a21\u5f0f\u3001\u5207\u7247\u96c6\u7fa4\u3002</p> <p>\u4e3b\u4ece\u590d\u5236</p> <p>\u4e3b\u4ece\u590d\u5236\u662f Redis \u9ad8\u53ef\u7528\u670d\u52a1\u7684\u6700\u57fa\u7840\u7684\u4fdd\u8bc1\uff0c\u5b9e\u73b0\u65b9\u6848\u5c31\u662f\u5c06\u4ece\u524d\u7684\u4e00\u53f0 Redis \u670d\u52a1\u5668\uff0c\u540c\u6b65\u6570\u636e\u5230\u591a\u53f0\u4ece Redis \u670d\u52a1\u5668\u4e0a\uff0c\u5373\u4e00\u4e3b\u591a\u4ece\u7684\u6a21\u5f0f\uff0c\u4e14\u4e3b\u4ece\u670d\u52a1\u5668\u4e4b\u95f4\u91c7\u7528\u7684\u662f\u300c\u8bfb\u5199\u5206\u79bb\u300d\u7684\u65b9\u5f0f\u3002</p> <p>\u4e3b\u670d\u52a1\u5668\u53ef\u4ee5\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u5f53\u53d1\u751f\u5199\u64cd\u4f5c\u65f6\u81ea\u52a8\u5c06\u5199\u64cd\u4f5c\u540c\u6b65\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u800c\u4ece\u670d\u52a1\u5668\u4e00\u822c\u662f\u53ea\u8bfb\uff0c\u5e76\u63a5\u53d7\u4e3b\u670d\u52a1\u5668\u540c\u6b65\u8fc7\u6765\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u7136\u540e\u6267\u884c\u8fd9\u6761\u547d\u4ee4\u3002</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6240\u6709\u7684\u6570\u636e\u4fee\u6539\u53ea\u5728\u4e3b\u670d\u52a1\u5668\u4e0a\u8fdb\u884c\uff0c\u7136\u540e\u5c06\u6700\u65b0\u7684\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u6ce8\u610f\uff0c\u4e3b\u4ece\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u547d\u4ee4\u590d\u5236\u662f\u5f02\u6b65\u8fdb\u884c\u7684\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff0c\u5728\u4e3b\u4ece\u670d\u52a1\u5668\u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\uff0c\u4e3b\u670d\u52a1\u5668\u6536\u5230\u65b0\u7684\u5199\u547d\u4ee4\u540e\uff0c\u4f1a\u53d1\u9001\u7ed9\u4ece\u670d\u52a1\u5668\u3002\u4f46\u662f\uff0c\u4e3b\u670d\u52a1\u5668\u5e76\u4e0d\u4f1a\u7b49\u5230\u4ece\u670d\u52a1\u5668\u5b9e\u9645\u6267\u884c\u5b8c\u547d\u4ee4\u540e\uff0c\u518d\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u800c\u662f\u4e3b\u670d\u52a1\u5668\u81ea\u5df1\u5728\u672c\u5730\u6267\u884c\u5b8c\u547d\u4ee4\u540e\uff0c\u5c31\u4f1a\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u7ed3\u679c\u4e86\u3002\u5982\u679c\u4ece\u670d\u52a1\u5668\u8fd8\u6ca1\u6709\u6267\u884c\u4e3b\u670d\u52a1\u5668\u540c\u6b65\u8fc7\u6765\u7684\u547d\u4ee4\uff0c\u4e3b\u4ece\u670d\u52a1\u5668\u95f4\u7684\u6570\u636e\u5c31\u4e0d\u4e00\u81f4\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u65e0\u6cd5\u5b9e\u73b0\u5f3a\u4e00\u81f4\u6027\u4fdd\u8bc1\uff08\u4e3b\u4ece\u6570\u636e\u65f6\u65f6\u523b\u523b\u4fdd\u6301\u4e00\u81f4\uff09\uff0c\u6570\u636e\u4e0d\u4e00\u81f4\u662f\u96be\u4ee5\u907f\u514d\u7684\u3002</p> <p>::: tip</p> <p>\u60f3\u66f4\u8be6\u7ec6\u4e86\u89e3  Redis \u4e3b\u4ece\u590d\u5236\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u53ef\u4ee5\u8be6\u7ec6\u770b\u8fd9\u7bc7\uff1a\u4e3b\u4ece\u590d\u5236\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f</p> <p>:::</p> <p>\u54e8\u5175\u6a21\u5f0f</p> <p>\u5728\u4f7f\u7528 Redis \u4e3b\u4ece\u670d\u52a1\u7684\u65f6\u5019\uff0c\u4f1a\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5f53 Redis \u7684\u4e3b\u4ece\u670d\u52a1\u5668\u51fa\u73b0\u6545\u969c\u5b95\u673a\u65f6\uff0c\u9700\u8981\u624b\u52a8\u8fdb\u884c\u6062\u590d\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u589e\u52a0\u4e86\u54e8\u5175\u6a21\u5f0f\uff08Redis Sentinel\uff09\uff0c\u56e0\u4e3a\u54e8\u5175\u6a21\u5f0f\u505a\u5230\u4e86\u53ef\u4ee5\u76d1\u63a7\u4e3b\u4ece\u670d\u52a1\u5668\uff0c\u5e76\u4e14\u63d0\u4f9b\u4e3b\u4ece\u8282\u70b9\u6545\u969c\u8f6c\u79fb\u7684\u529f\u80fd\u3002</p> <p></p> <p>::: tip</p> <p>\u60f3\u66f4\u8be6\u7ec6\u4e86\u89e3  Redis \u54e8\u5175\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u53ef\u4ee5\u8be6\u7ec6\u770b\u8fd9\u7bc7\uff1a\u54e8\u5175\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f</p> <p>:::</p> <p>\u5207\u7247\u96c6\u7fa4\u6a21\u5f0f</p> <p>\u5f53 Redis \u7f13\u5b58\u6570\u636e\u91cf\u5927\u5230\u4e00\u53f0\u670d\u52a1\u5668\u65e0\u6cd5\u7f13\u5b58\u65f6\uff0c\u5c31\u9700\u8981\u4f7f\u7528 Redis \u5207\u7247\u96c6\u7fa4\uff08Redis Cluster\uff09\u65b9\u6848\uff0c\u5b83\u5c06\u6570\u636e\u5206\u5e03\u5728\u4e0d\u540c\u7684\u670d\u52a1\u5668\u4e0a\uff0c\u4ee5\u6b64\u6765\u964d\u4f4e\u7cfb\u7edf\u5bf9\u5355\u4e3b\u8282\u70b9\u7684\u4f9d\u8d56\uff0c\u4ece\u800c\u63d0\u9ad8 Redis \u670d\u52a1\u7684\u8bfb\u5199\u6027\u80fd\u3002</p> <p>Redis Cluster \u65b9\u6848\u91c7\u7528\u54c8\u5e0c\u69fd\uff08Hash Slot\uff09\uff0c\u6765\u5904\u7406\u6570\u636e\u548c\u8282\u70b9\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002\u5728 Redis Cluster \u65b9\u6848\u4e2d\uff0c\u4e00\u4e2a\u5207\u7247\u96c6\u7fa4\u5171\u6709 16384 \u4e2a\u54c8\u5e0c\u69fd\uff0c\u8fd9\u4e9b\u54c8\u5e0c\u69fd\u7c7b\u4f3c\u4e8e\u6570\u636e\u5206\u533a\uff0c\u6bcf\u4e2a\u952e\u503c\u5bf9\u90fd\u4f1a\u6839\u636e\u5b83\u7684 key\uff0c\u88ab\u6620\u5c04\u5230\u4e00\u4e2a\u54c8\u5e0c\u69fd\u4e2d\uff0c\u5177\u4f53\u6267\u884c\u8fc7\u7a0b\u5206\u4e3a\u4e24\u5927\u6b65\uff1a</p> <ul> <li>\u6839\u636e\u952e\u503c\u5bf9\u7684 key\uff0c\u6309\u7167 CRC16 \u7b97\u6cd5\u8ba1\u7b97\u4e00\u4e2a 16 bit \u7684\u503c\u3002</li> <li>\u518d\u7528 16bit \u503c\u5bf9 16384 \u53d6\u6a21\uff0c\u5f97\u5230 0~16383 \u8303\u56f4\u5185\u7684\u6a21\u6570\uff0c\u6bcf\u4e2a\u6a21\u6570\u4ee3\u8868\u4e00\u4e2a\u76f8\u5e94\u7f16\u53f7\u7684\u54c8\u5e0c\u69fd\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u5c31\u662f\uff0c\u8fd9\u4e9b\u54c8\u5e0c\u69fd\u600e\u4e48\u88ab\u6620\u5c04\u5230\u5177\u4f53\u7684 Redis \u8282\u70b9\u4e0a\u7684\u5462\uff1f\u6709\u4e24\u79cd\u65b9\u6848\uff1a</p> <ul> <li>\u5e73\u5747\u5206\u914d\uff1a \u5728\u4f7f\u7528 cluster create \u547d\u4ee4\u521b\u5efa Redis \u96c6\u7fa4\u65f6\uff0cRedis \u4f1a\u81ea\u52a8\u628a\u6240\u6709\u54c8\u5e0c\u69fd\u5e73\u5747\u5206\u5e03\u5230\u96c6\u7fa4\u8282\u70b9\u4e0a\u3002\u6bd4\u5982\u96c6\u7fa4\u4e2d\u6709 9 \u4e2a\u8282\u70b9\uff0c\u5219\u6bcf\u4e2a\u8282\u70b9\u4e0a\u69fd\u7684\u4e2a\u6570\u4e3a 16384/9 \u4e2a\u3002</li> <li>\u624b\u52a8\u5206\u914d\uff1a \u53ef\u4ee5\u4f7f\u7528 cluster meet \u547d\u4ee4\u624b\u52a8\u5efa\u7acb\u8282\u70b9\u95f4\u7684\u8fde\u63a5\uff0c\u7ec4\u6210\u96c6\u7fa4\uff0c\u518d\u4f7f\u7528 cluster addslots \u547d\u4ee4\uff0c\u6307\u5b9a\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7684\u54c8\u5e0c\u69fd\u4e2a\u6570\u3002</li> </ul> <p>\u4e3a\u4e86\u65b9\u4fbf\u4f60\u7684\u7406\u89e3\uff0c\u6211\u901a\u8fc7\u4e00\u5f20\u56fe\u6765\u89e3\u91ca\u6570\u636e\u3001\u54c8\u5e0c\u69fd\uff0c\u4ee5\u53ca\u8282\u70b9\u4e09\u8005\u7684\u6620\u5c04\u5206\u5e03\u5173\u7cfb\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u7684\u5207\u7247\u96c6\u7fa4\u4e00\u5171\u6709 3 \u4e2a\u8282\u70b9\uff0c\u5047\u8bbe\u6709 4 \u4e2a\u54c8\u5e0c\u69fd\uff08Slot 0\uff5eSlot 3\uff09\u65f6\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u547d\u4ee4\u624b\u52a8\u5206\u914d\u54c8\u5e0c\u69fd\uff0c\u6bd4\u5982\u8282\u70b9 1 \u4fdd\u5b58\u54c8\u5e0c\u69fd 0 \u548c 1\uff0c\u8282\u70b9 2 \u4fdd\u5b58\u54c8\u5e0c\u69fd 2 \u548c 3\u3002</p> <p>C<pre><code>redis-cli -h 192.168.1.10 \u2013p 6379 cluster addslots 0,1\nredis-cli -h 192.168.1.11 \u2013p 6379 cluster addslots 2,3\n</code></pre> \u7136\u540e\u5728\u96c6\u7fa4\u8fd0\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0ckey1 \u548c key2 \u8ba1\u7b97\u5b8c CRC16 \u503c\u540e\uff0c\u5bf9\u54c8\u5e0c\u69fd\u603b\u4e2a\u6570 5 \u8fdb\u884c\u53d6\u6a21\uff0c\u518d\u6839\u636e\u5404\u81ea\u7684\u6a21\u6570\u7ed3\u679c\uff0c\u5c31\u53ef\u4ee5\u88ab\u6620\u5c04\u5230\u5bf9\u5e94\u7684\u8282\u70b9 1 \u548c\u8282\u70b9 3 \u4e0a\u4e86\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u624b\u52a8\u5206\u914d\u54c8\u5e0c\u69fd\u65f6\uff0c\u9700\u8981\u628a 16384 \u4e2a\u69fd\u90fd\u5206\u914d\u5b8c\uff0c\u5426\u5219 Redis \u96c6\u7fa4\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c\u3002</p>"},{"location":"redis/base/redis_interview/#_2","title":"\u96c6\u7fa4\u8111\u88c2\u5bfc\u81f4\u6570\u636e\u4e22\u5931\u600e\u4e48\u529e\uff1f","text":"<p>\u4ec0\u4e48\u662f\u8111\u88c2\uff1f</p> <p>\u5148\u6765\u7406\u89e3\u96c6\u7fa4\u7684\u8111\u88c2\u73b0\u8c61\uff0c\u8fd9\u5c31\u597d\u6bd4\u4e00\u4e2a\u4eba\u6709\u4e24\u4e2a\u5927\u8111\uff0c\u90a3\u4e48\u5230\u5e95\u53d7\u8c01\u63a7\u5236\u5462\uff1f</p> <p>\u90a3\u4e48\u5728 Redis \u4e2d\uff0c\u96c6\u7fa4\u8111\u88c2\u4ea7\u751f\u6570\u636e\u4e22\u5931\u7684\u73b0\u8c61\u662f\u600e\u6837\u7684\u5462\uff1f</p> <p>\u5728 Redis \u4e3b\u4ece\u67b6\u6784\u4e2d\uff0c\u90e8\u7f72\u65b9\u5f0f\u4e00\u822c\u662f\u300c\u4e00\u4e3b\u591a\u4ece\u300d\uff0c\u4e3b\u8282\u70b9\u63d0\u4f9b\u5199\u64cd\u4f5c\uff0c\u4ece\u8282\u70b9\u63d0\u4f9b\u8bfb\u64cd\u4f5c\u3002 \u5982\u679c\u4e3b\u8282\u70b9\u7684\u7f51\u7edc\u7a81\u7136\u53d1\u751f\u4e86\u95ee\u9898\uff0c\u5b83\u4e0e\u6240\u6709\u7684\u4ece\u8282\u70b9\u90fd\u5931\u8054\u4e86\uff0c\u4f46\u662f\u6b64\u65f6\u7684\u4e3b\u8282\u70b9\u548c\u5ba2\u6237\u7aef\u7684\u7f51\u7edc\u662f\u6b63\u5e38\u7684\uff0c\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5e76\u4e0d\u77e5\u9053 Redis \u5185\u90e8\u5df2\u7ecf\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u8fd8\u5728\u7167\u6837\u7684\u5411\u8fd9\u4e2a\u5931\u8054\u7684\u4e3b\u8282\u70b9\u5199\u6570\u636e\uff08\u8fc7\u7a0b A\uff09\uff0c\u6b64\u65f6\u8fd9\u4e9b\u6570\u636e\u88ab\u65e7\u4e3b\u8282\u70b9\u7f13\u5b58\u5230\u4e86\u7f13\u51b2\u533a\u91cc\uff0c\u56e0\u4e3a\u4e3b\u4ece\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\u95ee\u9898\uff0c\u8fd9\u4e9b\u6570\u636e\u90fd\u662f\u65e0\u6cd5\u540c\u6b65\u7ed9\u4ece\u8282\u70b9\u7684\u3002</p> <p>\u8fd9\u65f6\uff0c\u54e8\u5175\u4e5f\u53d1\u73b0\u4e3b\u8282\u70b9\u5931\u8054\u4e86\uff0c\u5b83\u5c31\u8ba4\u4e3a\u4e3b\u8282\u70b9\u6302\u4e86\uff08\u4f46\u5b9e\u9645\u4e0a\u4e3b\u8282\u70b9\u6b63\u5e38\u8fd0\u884c\uff0c\u53ea\u662f\u7f51\u7edc\u51fa\u95ee\u9898\u4e86\uff09\uff0c\u4e8e\u662f\u54e8\u5175\u5c31\u4f1a\u5728\u300c\u4ece\u8282\u70b9\u300d\u4e2d\u9009\u4e3e\u51fa\u4e00\u4e2a leeder \u4f5c\u4e3a\u4e3b\u8282\u70b9\uff0c\u8fd9\u65f6\u96c6\u7fa4\u5c31\u6709\u4e24\u4e2a\u4e3b\u8282\u70b9\u4e86 \u2014\u2014 \u8111\u88c2\u51fa\u73b0\u4e86\u3002</p> <p>\u7136\u540e\uff0c\u7f51\u7edc\u7a81\u7136\u597d\u4e86\uff0c\u54e8\u5175\u56e0\u4e3a\u4e4b\u524d\u5df2\u7ecf\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u4e3b\u8282\u70b9\u4e86\uff0c\u5b83\u5c31\u4f1a\u628a\u65e7\u4e3b\u8282\u70b9\u964d\u7ea7\u4e3a\u4ece\u8282\u70b9\uff08A\uff09\uff0c\u7136\u540e\u4ece\u8282\u70b9\uff08A\uff09\u4f1a\u5411\u65b0\u4e3b\u8282\u70b9\u8bf7\u6c42\u6570\u636e\u540c\u6b65\uff0c\u56e0\u4e3a\u7b2c\u4e00\u6b21\u540c\u6b65\u662f\u5168\u91cf\u540c\u6b65\u7684\u65b9\u5f0f\uff0c\u6b64\u65f6\u7684\u4ece\u8282\u70b9\uff08A\uff09\u4f1a\u6e05\u7a7a\u6389\u81ea\u5df1\u672c\u5730\u7684\u6570\u636e\uff0c\u7136\u540e\u518d\u505a\u5168\u91cf\u540c\u6b65\u3002\u6240\u4ee5\uff0c\u4e4b\u524d\u5ba2\u6237\u7aef\u5728\u8fc7\u7a0b A \u5199\u5165\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u4e86\uff0c\u4e5f\u5c31\u662f\u96c6\u7fa4\u4ea7\u751f\u8111\u88c2\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u3002</p> <p>\u603b\u7ed3\u4e00\u53e5\u8bdd\u5c31\u662f\uff1a\u7531\u4e8e\u7f51\u7edc\u95ee\u9898\uff0c\u96c6\u7fa4\u8282\u70b9\u4e4b\u95f4\u5931\u53bb\u8054\u7cfb\u3002\u4e3b\u4ece\u6570\u636e\u4e0d\u540c\u6b65\uff1b\u91cd\u65b0\u5e73\u8861\u9009\u4e3e\uff0c\u4ea7\u751f\u4e24\u4e2a\u4e3b\u670d\u52a1\u3002\u7b49\u7f51\u7edc\u6062\u590d\uff0c\u65e7\u4e3b\u8282\u70b9\u4f1a\u964d\u7ea7\u4e3a\u4ece\u8282\u70b9\uff0c\u518d\u4e0e\u65b0\u4e3b\u8282\u70b9\u8fdb\u884c\u540c\u6b65\u590d\u5236\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u4f1a\u4ece\u8282\u70b9\u4f1a\u6e05\u7a7a\u81ea\u5df1\u7684\u7f13\u51b2\u533a\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e4b\u524d\u5ba2\u6237\u7aef\u5199\u5165\u7684\u6570\u636e\u4e22\u5931\u4e86\u3002</p> <p>\u89e3\u51b3\u65b9\u6848</p> <p>\u5f53\u4e3b\u8282\u70b9\u53d1\u73b0\u4ece\u8282\u70b9\u4e0b\u7ebf\u6216\u8005\u901a\u4fe1\u8d85\u65f6\u7684\u603b\u6570\u91cf\u5c0f\u4e8e\u9608\u503c\u65f6\uff0c\u90a3\u4e48\u7981\u6b62\u4e3b\u8282\u70b9\u8fdb\u884c\u5199\u6570\u636e\uff0c\u76f4\u63a5\u628a\u9519\u8bef\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u5728 Redis \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u4e24\u4e2a\u53c2\u6570\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\uff1a</p> <ul> <li>min-slaves-to-write x\uff0c\u4e3b\u8282\u70b9\u5fc5\u987b\u8981\u6709\u81f3\u5c11 x \u4e2a\u4ece\u8282\u70b9\u8fde\u63a5\uff0c\u5982\u679c\u5c0f\u4e8e\u8fd9\u4e2a\u6570\uff0c\u4e3b\u8282\u70b9\u4f1a\u7981\u6b62\u5199\u6570\u636e\u3002</li> <li>min-slaves-max-lag x\uff0c\u4e3b\u4ece\u6570\u636e\u590d\u5236\u548c\u540c\u6b65\u7684\u5ef6\u8fdf\u4e0d\u80fd\u8d85\u8fc7 x \u79d2\uff0c\u5982\u679c\u8d85\u8fc7\uff0c\u4e3b\u8282\u70b9\u4f1a\u7981\u6b62\u5199\u6570\u636e\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u628a min-slaves-to-write \u548c min-slaves-max-lag \u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u642d\u914d\u8d77\u6765\u4f7f\u7528\uff0c\u5206\u522b\u7ed9\u5b83\u4eec\u8bbe\u7f6e\u4e00\u5b9a\u7684\u9608\u503c\uff0c\u5047\u8bbe\u4e3a N \u548c T\u3002</p> <p>\u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u7ec4\u5408\u540e\u7684\u8981\u6c42\u662f\uff0c\u4e3b\u5e93\u8fde\u63a5\u7684\u4ece\u5e93\u4e2d\u81f3\u5c11\u6709 N \u4e2a\u4ece\u5e93\uff0c\u548c\u4e3b\u5e93\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\u7684 ACK \u6d88\u606f\u5ef6\u8fdf\u4e0d\u80fd\u8d85\u8fc7 T \u79d2\uff0c\u5426\u5219\uff0c\u4e3b\u5e93\u5c31\u4e0d\u4f1a\u518d\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u5199\u8bf7\u6c42\u4e86\u3002</p> <p>\u5373\u4f7f\u539f\u4e3b\u5e93\u662f\u5047\u6545\u969c\uff0c\u5b83\u5728\u5047\u6545\u969c\u671f\u95f4\u4e5f\u65e0\u6cd5\u54cd\u5e94\u54e8\u5175\u5fc3\u8df3\uff0c\u4e5f\u4e0d\u80fd\u548c\u4ece\u5e93\u8fdb\u884c\u540c\u6b65\uff0c\u81ea\u7136\u4e5f\u5c31\u65e0\u6cd5\u548c\u4ece\u5e93\u8fdb\u884c ACK \u786e\u8ba4\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0cmin-slaves-to-write \u548c min-slaves-max-lag \u7684\u7ec4\u5408\u8981\u6c42\u5c31\u65e0\u6cd5\u5f97\u5230\u6ee1\u8db3\uff0c\u539f\u4e3b\u5e93\u5c31\u4f1a\u88ab\u9650\u5236\u63a5\u6536\u5ba2\u6237\u7aef\u5199\u8bf7\u6c42\uff0c\u5ba2\u6237\u7aef\u4e5f\u5c31\u4e0d\u80fd\u5728\u539f\u4e3b\u5e93\u4e2d\u5199\u5165\u65b0\u6570\u636e\u4e86\u3002</p> <p>\u7b49\u5230\u65b0\u4e3b\u5e93\u4e0a\u7ebf\u65f6\uff0c\u5c31\u53ea\u6709\u65b0\u4e3b\u5e93\u80fd\u63a5\u6536\u548c\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0c\u65b0\u5199\u7684\u6570\u636e\u4f1a\u88ab\u76f4\u63a5\u5199\u5230\u65b0\u4e3b\u5e93\u4e2d\u3002\u800c\u539f\u4e3b\u5e93\u4f1a\u88ab\u54e8\u5175\u964d\u4e3a\u4ece\u5e93\uff0c\u5373\u4f7f\u5b83\u7684\u6570\u636e\u88ab\u6e05\u7a7a\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u6709\u65b0\u6570\u636e\u4e22\u5931\u3002</p> <p>\u518d\u6765\u4e3e\u4e2a\u4f8b\u5b50\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a 1\uff0c\u628a min-slaves-max-lag \u8bbe\u7f6e\u4e3a 12s\uff0c\u628a\u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 10s\uff0c\u4e3b\u5e93\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5361\u4f4f\u4e86 15s\uff0c\u5bfc\u81f4\u54e8\u5175\u5224\u65ad\u4e3b\u5e93\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u5f00\u59cb\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u3002</p> <p>\u540c\u65f6\uff0c\u56e0\u4e3a\u539f\u4e3b\u5e93\u5361\u4f4f\u4e86 15s\uff0c\u6ca1\u6709\u4e00\u4e2a\u4ece\u5e93\u80fd\u548c\u539f\u4e3b\u5e93\u5728 12s \u5185\u8fdb\u884c\u6570\u636e\u590d\u5236\uff0c\u539f\u4e3b\u5e93\u4e5f\u65e0\u6cd5\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e86\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u4e3b\u4ece\u5207\u6362\u5b8c\u6210\u540e\uff0c\u4e5f\u53ea\u6709\u65b0\u4e3b\u5e93\u80fd\u63a5\u6536\u8bf7\u6c42\uff0c\u4e0d\u4f1a\u53d1\u751f\u8111\u88c2\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53d1\u751f\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u4e86\u3002</p>"},{"location":"redis/base/redis_interview/#redis_14","title":"Redis \u8fc7\u671f\u5220\u9664\u4e0e\u5185\u5b58\u6dd8\u6c70","text":""},{"location":"redis/base/redis_interview/#redis_15","title":"Redis \u4f7f\u7528\u7684\u8fc7\u671f\u5220\u9664\u7b56\u7565\u662f\u4ec0\u4e48\uff1f","text":"<p>Redis \u662f\u53ef\u4ee5\u5bf9 key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\uff0c\u56e0\u6b64\u9700\u8981\u6709\u76f8\u5e94\u7684\u673a\u5236\u5c06\u5df2\u8fc7\u671f\u7684\u952e\u503c\u5bf9\u5220\u9664\uff0c\u800c\u505a\u8fd9\u4e2a\u5de5\u4f5c\u7684\u5c31\u662f\u8fc7\u671f\u952e\u503c\u5220\u9664\u7b56\u7565\u3002</p> <p>\u6bcf\u5f53\u6211\u4eec\u5bf9\u4e00\u4e2a key \u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u65f6\uff0cRedis \u4f1a\u628a\u8be5 key \u5e26\u4e0a\u8fc7\u671f\u65f6\u95f4\u5b58\u50a8\u5230\u4e00\u4e2a\u8fc7\u671f\u5b57\u5178\uff08expires dict\uff09\u4e2d\uff0c\u4e5f\u5c31\u662f\u8bf4\u300c\u8fc7\u671f\u5b57\u5178\u300d\u4fdd\u5b58\u4e86\u6570\u636e\u5e93\u4e2d\u6240\u6709 key \u7684\u8fc7\u671f\u65f6\u95f4\u3002</p> <p>\u5f53\u6211\u4eec\u67e5\u8be2\u4e00\u4e2a key \u65f6\uff0cRedis \u9996\u5148\u68c0\u67e5\u8be5 key \u662f\u5426\u5b58\u5728\u4e8e\u8fc7\u671f\u5b57\u5178\u4e2d\uff1a</p> <ul> <li>\u5982\u679c\u4e0d\u5728\uff0c\u5219\u6b63\u5e38\u8bfb\u53d6\u952e\u503c\uff1b</li> <li>\u5982\u679c\u5b58\u5728\uff0c\u5219\u4f1a\u83b7\u53d6\u8be5 key \u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u7136\u540e\u4e0e\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5982\u679c\u6bd4\u7cfb\u7edf\u65f6\u95f4\u5927\uff0c\u90a3\u5c31\u6ca1\u6709\u8fc7\u671f\uff0c\u5426\u5219\u5224\u5b9a\u8be5 key \u5df2\u8fc7\u671f\u3002</li> </ul> <p>Redis \u4f7f\u7528\u7684\u8fc7\u671f\u5220\u9664\u7b56\u7565\u662f\u300c\u60f0\u6027\u5220\u9664 + \u5b9a\u671f\u5220\u9664\u300d\u8fd9\u4e24\u79cd\u7b56\u7565\u914d\u548c\u4f7f\u7528\u3002</p> <p>\u4ec0\u4e48\u662f\u60f0\u6027\u5220\u9664\u7b56\u7565\uff1f</p> <p>\u60f0\u6027\u5220\u9664\u7b56\u7565\u7684\u505a\u6cd5\u662f\uff0c\u4e0d\u4e3b\u52a8\u5220\u9664\u8fc7\u671f\u952e\uff0c\u6bcf\u6b21\u4ece\u6570\u636e\u5e93\u8bbf\u95ee key \u65f6\uff0c\u90fd\u68c0\u6d4b key \u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u8fc7\u671f\u5219\u5220\u9664\u8be5 key\u3002</p> <p>\u60f0\u6027\u5220\u9664\u7684\u6d41\u7a0b\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u60f0\u6027\u5220\u9664\u7b56\u7565\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u56e0\u4e3a\u6bcf\u6b21\u8bbf\u95ee\u65f6\uff0c\u624d\u4f1a\u68c0\u67e5 key \u662f\u5426\u8fc7\u671f\uff0c\u6240\u4ee5\u6b64\u7b56\u7565\u53ea\u4f1a\u4f7f\u7528\u5f88\u5c11\u7684\u7cfb\u7edf\u8d44\u6e90\uff0c\u56e0\u6b64\uff0c\u60f0\u6027\u5220\u9664\u7b56\u7565\u5bf9 CPU \u65f6\u95f4\u6700\u53cb\u597d\u3002</li> </ul> <p>\u60f0\u6027\u5220\u9664\u7b56\u7565\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u5982\u679c\u4e00\u4e2a key \u5df2\u7ecf\u8fc7\u671f\uff0c\u800c\u8fd9\u4e2a key \u53c8\u4ecd\u7136\u4fdd\u7559\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u90a3\u4e48\u53ea\u8981\u8fd9\u4e2a\u8fc7\u671f key \u4e00\u76f4\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u5b83\u6240\u5360\u7528\u7684\u5185\u5b58\u5c31\u4e0d\u4f1a\u91ca\u653e\uff0c\u9020\u6210\u4e86\u4e00\u5b9a\u7684\u5185\u5b58\u7a7a\u95f4\u6d6a\u8d39\u3002\u6240\u4ee5\uff0c\u60f0\u6027\u5220\u9664\u7b56\u7565\u5bf9\u5185\u5b58\u4e0d\u53cb\u597d\u3002 <p>\u4ec0\u4e48\u662f\u5b9a\u671f\u5220\u9664\u7b56\u7565\uff1f</p> </li> </ul> <p>\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7684\u505a\u6cd5\u662f\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u300c\u968f\u673a\u300d\u4ece\u6570\u636e\u5e93\u4e2d\u53d6\u51fa\u4e00\u5b9a\u6570\u91cf\u7684 key \u8fdb\u884c\u68c0\u67e5\uff0c\u5e76\u5220\u9664\u5176\u4e2d\u7684\u8fc7\u671f key\u3002</p> <p>Redis \u7684\u5b9a\u671f\u5220\u9664\u7684\u6d41\u7a0b\uff1a</p> <ol> <li>\u4ece\u8fc7\u671f\u5b57\u5178\u4e2d\u968f\u673a\u62bd\u53d6 20 \u4e2a key\uff1b</li> <li>\u68c0\u67e5\u8fd9 20 \u4e2a key \u662f\u5426\u8fc7\u671f\uff0c\u5e76\u5220\u9664\u5df2\u8fc7\u671f\u7684 key\uff1b</li> <li>\u5982\u679c\u672c\u8f6e\u68c0\u67e5\u7684\u5df2\u8fc7\u671f key \u7684\u6570\u91cf\uff0c\u8d85\u8fc7 5 \u4e2a\uff0820/4\uff09\uff0c\u4e5f\u5c31\u662f\u300c\u5df2\u8fc7\u671f key \u7684\u6570\u91cf\u300d\u5360\u6bd4\u300c\u968f\u673a\u62bd\u53d6 key \u7684\u6570\u91cf\u300d\u5927\u4e8e 25%\uff0c\u5219\u7ee7\u7eed\u91cd\u590d\u6b65\u9aa4 1\uff1b\u5982\u679c\u5df2\u8fc7\u671f\u7684 key \u6bd4\u4f8b\u5c0f\u4e8e 25%\uff0c\u5219\u505c\u6b62\u7ee7\u7eed\u5220\u9664\u8fc7\u671f key\uff0c\u7136\u540e\u7b49\u5f85\u4e0b\u4e00\u8f6e\u518d\u68c0\u67e5\u3002</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b9a\u671f\u5220\u9664\u662f\u4e00\u4e2a\u5faa\u73af\u7684\u6d41\u7a0b\u3002\u90a3 Redis \u4e3a\u4e86\u4fdd\u8bc1\u5b9a\u671f\u5220\u9664\u4e0d\u4f1a\u51fa\u73b0\u5faa\u73af\u8fc7\u5ea6\uff0c\u5bfc\u81f4\u7ebf\u7a0b\u5361\u6b7b\u73b0\u8c61\uff0c\u4e3a\u6b64\u589e\u52a0\u4e86\u5b9a\u671f\u5220\u9664\u5faa\u73af\u6d41\u7a0b\u7684\u65f6\u95f4\u4e0a\u9650\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u8d85\u8fc7 25ms\u3002</p> <p>\u5b9a\u671f\u5220\u9664\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u901a\u8fc7\u9650\u5236\u5220\u9664\u64cd\u4f5c\u6267\u884c\u7684\u65f6\u957f\u548c\u9891\u7387\uff0c\u6765\u51cf\u5c11\u5220\u9664\u64cd\u4f5c\u5bf9 CPU \u7684\u5f71\u54cd\uff0c\u540c\u65f6\u4e5f\u80fd\u5220\u9664\u4e00\u90e8\u5206\u8fc7\u671f\u7684\u6570\u636e\u51cf\u5c11\u4e86\u8fc7\u671f\u952e\u5bf9\u7a7a\u95f4\u7684\u65e0\u6548\u5360\u7528\u3002</li> </ul> <p>\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u96be\u4ee5\u786e\u5b9a\u5220\u9664\u64cd\u4f5c\u6267\u884c\u7684\u65f6\u957f\u548c\u9891\u7387\u3002\u5982\u679c\u6267\u884c\u7684\u592a\u9891\u7e41\uff0c\u5c31\u4f1a\u5bf9 CPU \u4e0d\u53cb\u597d\uff1b\u5982\u679c\u6267\u884c\u7684\u592a\u5c11\uff0c\u90a3\u53c8\u548c\u60f0\u6027\u5220\u9664\u4e00\u6837\u4e86\uff0c\u8fc7\u671f key \u5360\u7528\u7684\u5185\u5b58\u4e0d\u4f1a\u53ca\u65f6\u5f97\u5230\u91ca\u653e\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u60f0\u6027\u5220\u9664\u7b56\u7565\u548c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u90fd\u6709\u5404\u81ea\u7684\u4f18\u70b9\uff0c\u6240\u4ee5 Redis \u9009\u62e9\u300c\u60f0\u6027\u5220\u9664 + \u5b9a\u671f\u5220\u9664\u300d\u8fd9\u4e24\u79cd\u7b56\u7565\u914d\u548c\u4f7f\u7528\uff0c\u4ee5\u6c42\u5728\u5408\u7406\u4f7f\u7528 CPU \u65f6\u95f4\u548c\u907f\u514d\u5185\u5b58\u6d6a\u8d39\u4e4b\u95f4\u53d6\u5f97\u5e73\u8861\u3002</p> <p>::: tip</p> <p>Redis \u7684\u8fc7\u671f\u5220\u9664\u7684\u5185\u5bb9\u5c31\u6682\u65f6\u63d0\u8fd9\u4e9b\uff0c\u60f3\u66f4\u8be6\u7ec6\u4e86\u89e3\u7684\uff0c\u53ef\u4ee5\u8be6\u7ec6\u770b\u8fd9\u7bc7\uff1aRedis \u8fc7\u671f\u5220\u9664\u7b56\u7565\u548c\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>:::</p>"},{"location":"redis/base/redis_interview/#redis_16","title":"Redis \u6301\u4e45\u5316\u65f6\uff0c\u5bf9\u8fc7\u671f\u952e\u4f1a\u5982\u4f55\u5904\u7406\u7684\uff1f","text":"<p>Redis \u6301\u4e45\u5316\u6587\u4ef6\u6709\u4e24\u79cd\u683c\u5f0f\uff1aRDB\uff08Redis Database\uff09\u548c AOF\uff08Append Only File\uff09\uff0c\u4e0b\u9762\u6211\u4eec\u5206\u522b\u6765\u770b\u8fc7\u671f\u952e\u5728\u8fd9\u4e24\u79cd\u683c\u5f0f\u4e2d\u7684\u5448\u73b0\u72b6\u6001\u3002</p> <p>RDB \u6587\u4ef6\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff0cRDB \u6587\u4ef6\u751f\u6210\u9636\u6bb5\u548c\u52a0\u8f7d\u9636\u6bb5\u3002</p> <ul> <li>RDB \u6587\u4ef6\u751f\u6210\u9636\u6bb5\uff1a\u4ece\u5185\u5b58\u72b6\u6001\u6301\u4e45\u5316\u6210 RDB\uff08\u6587\u4ef6\uff09\u7684\u65f6\u5019\uff0c\u4f1a\u5bf9 key \u8fdb\u884c\u8fc7\u671f\u68c0\u67e5\uff0c\u8fc7\u671f\u7684\u952e\u300c\u4e0d\u4f1a\u300d\u88ab\u4fdd\u5b58\u5230\u65b0\u7684 RDB \u6587\u4ef6\u4e2d\uff0c\u56e0\u6b64 Redis \u4e2d\u7684\u8fc7\u671f\u952e\u4e0d\u4f1a\u5bf9\u751f\u6210\u65b0 RDB \u6587\u4ef6\u4ea7\u751f\u4efb\u4f55\u5f71\u54cd\u3002</li> <li>RDB \u52a0\u8f7d\u9636\u6bb5\uff1aRDB \u52a0\u8f7d\u9636\u6bb5\u65f6\uff0c\u8981\u770b\u670d\u52a1\u5668\u662f\u4e3b\u670d\u52a1\u5668\u8fd8\u662f\u4ece\u670d\u52a1\u5668\uff0c\u5206\u522b\u5bf9\u5e94\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\uff1a </li> <li>\u5982\u679c Redis \u662f\u300c\u4e3b\u670d\u52a1\u5668\u300d\u8fd0\u884c\u6a21\u5f0f\u7684\u8bdd\uff0c\u5728\u8f7d\u5165 RDB \u6587\u4ef6\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u5bf9\u6587\u4ef6\u4e2d\u4fdd\u5b58\u7684\u952e\u8fdb\u884c\u68c0\u67e5\uff0c\u8fc7\u671f\u952e\u300c\u4e0d\u4f1a\u300d\u88ab\u8f7d\u5165\u5230\u6570\u636e\u5e93\u4e2d\u3002\u6240\u4ee5\u8fc7\u671f\u952e\u4e0d\u4f1a\u5bf9\u8f7d\u5165 RDB \u6587\u4ef6\u7684\u4e3b\u670d\u52a1\u5668\u9020\u6210\u5f71\u54cd\uff1b</li> <li>\u5982\u679c Redis \u662f\u300c\u4ece\u670d\u52a1\u5668\u300d\u8fd0\u884c\u6a21\u5f0f\u7684\u8bdd\uff0c\u5728\u8f7d\u5165 RDB \u6587\u4ef6\u65f6\uff0c\u4e0d\u8bba\u952e\u662f\u5426\u8fc7\u671f\u90fd\u4f1a\u88ab\u8f7d\u5165\u5230\u6570\u636e\u5e93\u4e2d\u3002\u4f46\u7531\u4e8e\u4e3b\u4ece\u670d\u52a1\u5668\u5728\u8fdb\u884c\u6570\u636e\u540c\u6b65\u65f6\uff0c\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u4f1a\u88ab\u6e05\u7a7a\u3002\u6240\u4ee5\u4e00\u822c\u6765\u8bf4\uff0c\u8fc7\u671f\u952e\u5bf9\u8f7d\u5165 RDB \u6587\u4ef6\u7684\u4ece\u670d\u52a1\u5668\u4e5f\u4e0d\u4f1a\u9020\u6210\u5f71\u54cd\u3002</li> </ul> <p>AOF \u6587\u4ef6\u5206\u4e3a\u4e24\u4e2a\u9636\u6bb5\uff0cAOF \u6587\u4ef6\u5199\u5165\u9636\u6bb5\u548c AOF \u91cd\u5199\u9636\u6bb5\u3002</p> <ul> <li>AOF \u6587\u4ef6\u5199\u5165\u9636\u6bb5\uff1a\u5f53 Redis \u4ee5 AOF \u6a21\u5f0f\u6301\u4e45\u5316\u65f6\uff0c\u5982\u679c\u6570\u636e\u5e93\u67d0\u4e2a\u8fc7\u671f\u952e\u8fd8\u6ca1\u88ab\u5220\u9664\uff0c\u90a3\u4e48 AOF \u6587\u4ef6\u4f1a\u4fdd\u7559\u6b64\u8fc7\u671f\u952e\uff0c\u5f53\u6b64\u8fc7\u671f\u952e\u88ab\u5220\u9664\u540e\uff0cRedis \u4f1a\u5411 AOF \u6587\u4ef6\u8ffd\u52a0\u4e00\u6761 DEL \u547d\u4ee4\u6765\u663e\u5f0f\u5730\u5220\u9664\u8be5\u952e\u503c\u3002</li> <li>AOF \u91cd\u5199\u9636\u6bb5\uff1a\u6267\u884c AOF \u91cd\u5199\u65f6\uff0c\u4f1a\u5bf9 Redis \u4e2d\u7684\u952e\u503c\u5bf9\u8fdb\u884c\u68c0\u67e5\uff0c\u5df2\u8fc7\u671f\u7684\u952e\u4e0d\u4f1a\u88ab\u4fdd\u5b58\u5230\u91cd\u5199\u540e\u7684 AOF \u6587\u4ef6\u4e2d\uff0c\u56e0\u6b64\u4e0d\u4f1a\u5bf9 AOF \u91cd\u5199\u9020\u6210\u4efb\u4f55\u5f71\u54cd\u3002</li> </ul>"},{"location":"redis/base/redis_interview/#redis_17","title":"Redis \u4e3b\u4ece\u6a21\u5f0f\u4e2d\uff0c\u5bf9\u8fc7\u671f\u952e\u4f1a\u5982\u4f55\u5904\u7406\uff1f","text":"<p>\u5f53 Redis \u8fd0\u884c\u5728\u4e3b\u4ece\u6a21\u5f0f\u4e0b\u65f6\uff0c\u4ece\u5e93\u4e0d\u4f1a\u8fdb\u884c\u8fc7\u671f\u626b\u63cf\uff0c\u4ece\u5e93\u5bf9\u8fc7\u671f\u7684\u5904\u7406\u662f\u88ab\u52a8\u7684\u3002\u4e5f\u5c31\u662f\u5373\u4f7f\u4ece\u5e93\u4e2d\u7684 key \u8fc7\u671f\u4e86\uff0c\u5982\u679c\u6709\u5ba2\u6237\u7aef\u8bbf\u95ee\u4ece\u5e93\u65f6\uff0c\u4f9d\u7136\u53ef\u4ee5\u5f97\u5230 key \u5bf9\u5e94\u7684\u503c\uff0c\u50cf\u672a\u8fc7\u671f\u7684\u952e\u503c\u5bf9\u4e00\u6837\u8fd4\u56de\u3002</p> <p>\u4ece\u5e93\u7684\u8fc7\u671f\u952e\u5904\u7406\u4f9d\u9760\u4e3b\u670d\u52a1\u5668\u63a7\u5236\uff0c\u4e3b\u5e93\u5728 key \u5230\u671f\u65f6\uff0c\u4f1a\u5728 AOF \u6587\u4ef6\u91cc\u589e\u52a0\u4e00\u6761 del \u6307\u4ee4\uff0c\u540c\u6b65\u5230\u6240\u6709\u7684\u4ece\u5e93\uff0c\u4ece\u5e93\u901a\u8fc7\u6267\u884c\u8fd9\u6761 del \u6307\u4ee4\u6765\u5220\u9664\u8fc7\u671f\u7684 key\u3002</p>"},{"location":"redis/base/redis_interview/#redis_18","title":"Redis \u5185\u5b58\u6ee1\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5728 Redis \u7684\u8fd0\u884c\u5185\u5b58\u8fbe\u5230\u4e86\u67d0\u4e2a\u9600\u503c\uff0c\u5c31\u4f1a\u89e6\u53d1\u5185\u5b58\u6dd8\u6c70\u673a\u5236\uff0c\u8fd9\u4e2a\u9600\u503c\u5c31\u662f\u6211\u4eec\u8bbe\u7f6e\u7684\u6700\u5927\u8fd0\u884c\u5185\u5b58\uff0c\u6b64\u503c\u5728 Redis \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u53ef\u4ee5\u627e\u5230\uff0c\u914d\u7f6e\u9879\u4e3a maxmemory\u3002</p>"},{"location":"redis/base/redis_interview/#redis_19","title":"Redis \u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6709\u54ea\u4e9b\uff1f","text":"<p>Redis \u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u5171\u6709\u516b\u79cd\uff0c\u8fd9\u516b\u79cd\u7b56\u7565\u5927\u4f53\u5206\u4e3a\u300c\u4e0d\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u300d\u548c\u300c\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u300d\u4e24\u7c7b\u7b56\u7565\u3002</p> <p>1\u3001\u4e0d\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u7684\u7b56\u7565</p> <p>noeviction\uff08Redis3.0 \u4e4b\u540e\uff0c\u9ed8\u8ba4\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff09 \uff1a\u5b83\u8868\u793a\u5f53\u8fd0\u884c\u5185\u5b58\u8d85\u8fc7\u6700\u5927\u8bbe\u7f6e\u5185\u5b58\u65f6\uff0c\u4e0d\u6dd8\u6c70\u4efb\u4f55\u6570\u636e\uff0c\u800c\u662f\u4e0d\u518d\u63d0\u4f9b\u670d\u52a1\uff0c\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\u3002</p> <p>2\u3001\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u7684\u7b56\u7565</p> <p>\u9488\u5bf9\u300c\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u300d\u8fd9\u4e00\u7c7b\u7b56\u7565\uff0c\u53c8\u53ef\u4ee5\u7ec6\u5206\u4e3a\u300c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u4e2d\u8fdb\u884c\u6dd8\u6c70\u300d\u548c\u300c\u5728\u6240\u6709\u6570\u636e\u8303\u56f4\u5185\u8fdb\u884c\u6dd8\u6c70\u300d\u8fd9\u4e24\u7c7b\u7b56\u7565\u3002 \u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u4e2d\u8fdb\u884c\u6dd8\u6c70\uff1a</p> <ul> <li>volatile-random\uff1a\u968f\u673a\u6dd8\u6c70\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u4efb\u610f\u952e\u503c\uff1b</li> <li>volatile-ttl\uff1a\u4f18\u5148\u6dd8\u6c70\u66f4\u65e9\u8fc7\u671f\u7684\u952e\u503c\u3002</li> <li>volatile-lru\uff08Redis3.0 \u4e4b\u524d\uff0c\u9ed8\u8ba4\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff09\uff1a\u6dd8\u6c70\u6240\u6709\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u4e2d\uff0c\u6700\u4e45\u672a\u4f7f\u7528\u7684\u952e\u503c\uff1b</li> <li>volatile-lfu\uff08Redis 4.0 \u540e\u65b0\u589e\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff09\uff1a\u6dd8\u6c70\u6240\u6709\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u4e2d\uff0c\u6700\u5c11\u4f7f\u7528\u7684\u952e\u503c\uff1b</li> </ul> <p>\u5728\u6240\u6709\u6570\u636e\u8303\u56f4\u5185\u8fdb\u884c\u6dd8\u6c70\uff1a</p> <ul> <li>allkeys-random\uff1a\u968f\u673a\u6dd8\u6c70\u4efb\u610f\u952e\u503c;</li> <li>allkeys-lru\uff1a\u6dd8\u6c70\u6574\u4e2a\u952e\u503c\u4e2d\u6700\u4e45\u672a\u4f7f\u7528\u7684\u952e\u503c\uff1b</li> <li>allkeys-lfu\uff08Redis 4.0 \u540e\u65b0\u589e\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff09\uff1a\u6dd8\u6c70\u6574\u4e2a\u952e\u503c\u4e2d\u6700\u5c11\u4f7f\u7528\u7684\u952e\u503c\u3002</li> </ul>"},{"location":"redis/base/redis_interview/#lru-lfu","title":"LRU \u7b97\u6cd5\u548c LFU \u7b97\u6cd5\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u4ec0\u4e48\u662f LRU \u7b97\u6cd5\uff1f</p> <p>LRU \u5168\u79f0\u662f Least Recently Used \u7ffb\u8bd1\u4e3a\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff0c\u4f1a\u9009\u62e9\u6dd8\u6c70\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u3002</p> <p>\u4f20\u7edf LRU \u7b97\u6cd5\u7684\u5b9e\u73b0\u662f\u57fa\u4e8e\u300c\u94fe\u8868\u300d\u7ed3\u6784\uff0c\u94fe\u8868\u4e2d\u7684\u5143\u7d20\u6309\u7167\u64cd\u4f5c\u987a\u5e8f\u4ece\u524d\u5f80\u540e\u6392\u5217\uff0c\u6700\u65b0\u64cd\u4f5c\u7684\u952e\u4f1a\u88ab\u79fb\u52a8\u5230\u8868\u5934\uff0c\u5f53\u9700\u8981\u5185\u5b58\u6dd8\u6c70\u65f6\uff0c\u53ea\u9700\u8981\u5220\u9664\u94fe\u8868\u5c3e\u90e8\u7684\u5143\u7d20\u5373\u53ef\uff0c\u56e0\u4e3a\u94fe\u8868\u5c3e\u90e8\u7684\u5143\u7d20\u5c31\u4ee3\u8868\u6700\u4e45\u672a\u88ab\u4f7f\u7528\u7684\u5143\u7d20\u3002</p> <p>Redis \u5e76\u6ca1\u6709\u4f7f\u7528\u8fd9\u6837\u7684\u65b9\u5f0f\u5b9e\u73b0 LRU \u7b97\u6cd5\uff0c\u56e0\u4e3a\u4f20\u7edf\u7684 LRU \u7b97\u6cd5\u5b58\u5728\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u9700\u8981\u7528\u94fe\u8868\u7ba1\u7406\u6240\u6709\u7684\u7f13\u5b58\u6570\u636e\uff0c\u8fd9\u4f1a\u5e26\u6765\u989d\u5916\u7684\u7a7a\u95f4\u5f00\u9500\uff1b</li> <li>\u5f53\u6709\u6570\u636e\u88ab\u8bbf\u95ee\u65f6\uff0c\u9700\u8981\u5728\u94fe\u8868\u4e0a\u628a\u8be5\u6570\u636e\u79fb\u52a8\u5230\u5934\u7aef\uff0c\u5982\u679c\u6709\u5927\u91cf\u6570\u636e\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u5e26\u6765\u5f88\u591a\u94fe\u8868\u79fb\u52a8\u64cd\u4f5c\uff0c\u4f1a\u5f88\u8017\u65f6\uff0c\u8fdb\u800c\u4f1a\u964d\u4f4e Redis \u7f13\u5b58\u6027\u80fd\u3002 <p>Redis \u662f\u5982\u4f55\u5b9e\u73b0 LRU \u7b97\u6cd5\u7684\uff1f</p> </li> </ul> <p>Redis \u5b9e\u73b0\u7684\u662f\u4e00\u79cd\u8fd1\u4f3c LRU \u7b97\u6cd5\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u66f4\u597d\u7684\u8282\u7ea6\u5185\u5b58\uff0c\u5b83\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5728 Redis \u7684\u5bf9\u8c61\u7ed3\u6784\u4f53\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u989d\u5916\u7684\u5b57\u6bb5\uff0c\u7528\u4e8e\u8bb0\u5f55\u6b64\u6570\u636e\u7684\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u3002</p> <p>\u5f53 Redis \u8fdb\u884c\u5185\u5b58\u6dd8\u6c70\u65f6\uff0c\u4f1a\u4f7f\u7528\u968f\u673a\u91c7\u6837\u7684\u65b9\u5f0f\u6765\u6dd8\u6c70\u6570\u636e\uff0c\u5b83\u662f\u968f\u673a\u53d6 5 \u4e2a\u503c\uff08\u6b64\u503c\u53ef\u914d\u7f6e\uff09\uff0c\u7136\u540e\u6dd8\u6c70\u6700\u4e45\u6ca1\u6709\u4f7f\u7528\u7684\u90a3\u4e2a\u3002</p> <p>Redis \u5b9e\u73b0\u7684 LRU \u7b97\u6cd5\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u4e0d\u7528\u4e3a\u6240\u6709\u7684\u6570\u636e\u7ef4\u62a4\u4e00\u4e2a\u5927\u94fe\u8868\uff0c\u8282\u7701\u4e86\u7a7a\u95f4\u5360\u7528\uff1b</li> <li>\u4e0d\u7528\u5728\u6bcf\u6b21\u6570\u636e\u8bbf\u95ee\u65f6\u90fd\u79fb\u52a8\u94fe\u8868\u9879\uff0c\u63d0\u5347\u4e86\u7f13\u5b58\u7684\u6027\u80fd\uff1b</li> </ul> <p>\u4f46\u662f LRU \u7b97\u6cd5\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u65e0\u6cd5\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff0c\u6bd4\u5982\u5e94\u7528\u4e00\u6b21\u8bfb\u53d6\u4e86\u5927\u91cf\u7684\u6570\u636e\uff0c\u800c\u8fd9\u4e9b\u6570\u636e\u53ea\u4f1a\u88ab\u8bfb\u53d6\u8fd9\u4e00\u6b21\uff0c\u90a3\u4e48\u8fd9\u4e9b\u6570\u636e\u4f1a\u7559\u5b58\u5728 Redis \u7f13\u5b58\u4e2d\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff0c\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002</p> <p>\u56e0\u6b64\uff0c\u5728 Redis 4.0 \u4e4b\u540e\u5f15\u5165\u4e86 LFU \u7b97\u6cd5\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u4ec0\u4e48\u662f LFU \u7b97\u6cd5\uff1f</p> <p>LFU \u5168\u79f0\u662f Least Frequently Used \u7ffb\u8bd1\u4e3a\u6700\u8fd1\u6700\u4e0d\u5e38\u7528\u7684\uff0cLFU \u7b97\u6cd5\u662f\u6839\u636e\u6570\u636e\u8bbf\u95ee\u6b21\u6570\u6765\u6dd8\u6c70\u6570\u636e\u7684\uff0c\u5b83\u7684\u6838\u5fc3\u601d\u60f3\u662f\u201c\u5982\u679c\u6570\u636e\u8fc7\u53bb\u88ab\u8bbf\u95ee\u591a\u6b21\uff0c\u90a3\u4e48\u5c06\u6765\u88ab\u8bbf\u95ee\u7684\u9891\u7387\u4e5f\u66f4\u9ad8\u201d\u3002</p> <p>\u6240\u4ee5\uff0cLFU \u7b97\u6cd5\u4f1a\u8bb0\u5f55\u6bcf\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002\u5f53\u4e00\u4e2a\u6570\u636e\u88ab\u518d\u6b21\u8bbf\u95ee\u65f6\uff0c\u5c31\u4f1a\u589e\u52a0\u8be5\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u5076\u5c14\u88ab\u8bbf\u95ee\u4e00\u6b21\u4e4b\u540e\uff0c\u6570\u636e\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u7684\u95ee\u9898\uff0c\u76f8\u6bd4\u4e8e LRU \u7b97\u6cd5\u4e5f\u66f4\u5408\u7406\u4e00\u4e9b\u3002</p> <p>Redis \u662f\u5982\u4f55\u5b9e\u73b0 LFU \u7b97\u6cd5\u7684\uff1f</p> <p>LFU \u7b97\u6cd5\u76f8\u6bd4\u4e8e LRU \u7b97\u6cd5\u7684\u5b9e\u73b0\uff0c\u591a\u8bb0\u5f55\u4e86\u300c\u6570\u636e\u7684\u8bbf\u95ee\u9891\u6b21\u300d\u7684\u4fe1\u606f\u3002Redis \u5bf9\u8c61\u7684\u7ed3\u6784\u5982\u4e0b\uff1a C<pre><code>typedef struct redisObject {\n    ...\n\n    // 24 bits\uff0c\u7528\u4e8e\u8bb0\u5f55\u5bf9\u8c61\u7684\u8bbf\u95ee\u4fe1\u606f\n    unsigned lru:24;  \n    ...\n} robj;\n</code></pre></p> <p>Redis \u5bf9\u8c61\u5934\u4e2d\u7684 lru \u5b57\u6bb5\uff0c\u5728 LRU \u7b97\u6cd5\u4e0b\u548c LFU \u7b97\u6cd5\u4e0b\u4f7f\u7528\u65b9\u5f0f\u5e76\u4e0d\u76f8\u540c\u3002</p> <p>\u5728 LRU \u7b97\u6cd5\u4e2d\uff0cRedis \u5bf9\u8c61\u5934\u7684 24 bits \u7684 lru \u5b57\u6bb5\u662f\u7528\u6765\u8bb0\u5f55 key \u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff0c\u56e0\u6b64\u5728 LRU \u6a21\u5f0f\u4e0b\uff0cRedis \u53ef\u4ee5\u6839\u636e\u5bf9\u8c61\u5934\u4e2d\u7684 lru \u5b57\u6bb5\u8bb0\u5f55\u7684\u503c\uff0c\u6765\u6bd4\u8f83\u6700\u540e\u4e00\u6b21 key \u7684\u8bbf\u95ee\u65f6\u95f4\u957f\uff0c\u4ece\u800c\u6dd8\u6c70\u6700\u4e45\u672a\u88ab\u4f7f\u7528\u7684 key\u3002</p> <p>\u5728 LFU \u7b97\u6cd5\u4e2d\uff0cRedis \u5bf9\u8c61\u5934\u7684 24 bits \u7684 lru \u5b57\u6bb5\u88ab\u5206\u6210\u4e24\u6bb5\u6765\u5b58\u50a8\uff0c\u9ad8 16bit \u5b58\u50a8 ldt(Last Decrement Time)\uff0c\u7528\u6765\u8bb0\u5f55 key \u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff1b\u4f4e 8bit \u5b58\u50a8 logc(Logistic Counter)\uff0c\u7528\u6765\u8bb0\u5f55 key \u7684\u8bbf\u95ee\u9891\u6b21\u3002</p> <p></p> <p>::: tip</p> <p>Redis \u7684\u5185\u5b58\u6dd8\u6c70\u7684\u5185\u5bb9\u5c31\u6682\u65f6\u63d0\u8fd9\u4e9b\uff0c\u60f3\u66f4\u8be6\u7ec6\u4e86\u89e3\u7684\uff0c\u53ef\u4ee5\u8be6\u7ec6\u770b\u8fd9\u7bc7\uff1aRedis \u8fc7\u671f\u5220\u9664\u7b56\u7565\u548c\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>:::</p>"},{"location":"redis/base/redis_interview/#redis_20","title":"Redis \u7f13\u5b58\u8bbe\u8ba1","text":""},{"location":"redis/base/redis_interview/#_3","title":"\u5982\u4f55\u907f\u514d\u7f13\u5b58\u96ea\u5d29\u3001\u7f13\u5b58\u51fb\u7a7f\u3001\u7f13\u5b58\u7a7f\u900f\uff1f","text":"<p>\u5982\u4f55\u907f\u514d\u7f13\u5b58\u96ea\u5d29\uff1f</p> <p>\u901a\u5e38\u6211\u4eec\u4e3a\u4e86\u4fdd\u8bc1\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u4e0e\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f1a\u7ed9 Redis \u91cc\u7684\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5f53\u7f13\u5b58\u6570\u636e\u8fc7\u671f\u540e\uff0c\u7528\u6237\u8bbf\u95ee\u7684\u6570\u636e\u5982\u679c\u4e0d\u5728\u7f13\u5b58\u91cc\uff0c\u4e1a\u52a1\u7cfb\u7edf\u9700\u8981\u91cd\u65b0\u751f\u6210\u7f13\u5b58\uff0c\u56e0\u6b64\u5c31\u4f1a\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u5e76\u5c06\u6570\u636e\u66f4\u65b0\u5230 Redis \u91cc\uff0c\u8fd9\u6837\u540e\u7eed\u8bf7\u6c42\u90fd\u53ef\u4ee5\u76f4\u63a5\u547d\u4e2d\u7f13\u5b58\u3002</p> <p></p> <p>\u90a3\u4e48\uff0c\u5f53\u5927\u91cf\u7f13\u5b58\u6570\u636e\u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff08\u5931\u6548\uff09\u65f6\uff0c\u5982\u679c\u6b64\u65f6\u6709\u5927\u91cf\u7684\u7528\u6237\u8bf7\u6c42\uff0c\u90fd\u65e0\u6cd5\u5728 Redis \u4e2d\u5904\u7406\uff0c\u4e8e\u662f\u5168\u90e8\u8bf7\u6c42\u90fd\u76f4\u63a5\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u4ece\u800c\u5bfc\u81f4\u6570\u636e\u5e93\u7684\u538b\u529b\u9aa4\u589e\uff0c\u4e25\u91cd\u7684\u4f1a\u9020\u6210\u6570\u636e\u5e93\u5b95\u673a\uff0c\u4ece\u800c\u5f62\u6210\u4e00\u7cfb\u5217\u8fde\u9501\u53cd\u5e94\uff0c\u9020\u6210\u6574\u4e2a\u7cfb\u7edf\u5d29\u6e83\uff0c\u8fd9\u5c31\u662f\u7f13\u5b58\u96ea\u5d29\u7684\u95ee\u9898\u3002</p> <p>\u5bf9\u4e8e\u7f13\u5b58\u96ea\u5d29\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u7528\u4e24\u79cd\u65b9\u6848\u89e3\u51b3\u3002</p> <ul> <li>\u5c06\u7f13\u5b58\u5931\u6548\u65f6\u95f4\u968f\u673a\u6253\u6563\uff1a \u6211\u4eec\u53ef\u4ee5\u5728\u539f\u6709\u7684\u5931\u6548\u65f6\u95f4\u57fa\u7840\u4e0a\u589e\u52a0\u4e00\u4e2a\u968f\u673a\u503c\uff08\u6bd4\u5982 1 \u5230 10 \u5206\u949f\uff09\u8fd9\u6837\u6bcf\u4e2a\u7f13\u5b58\u7684\u8fc7\u671f\u65f6\u95f4\u90fd\u4e0d\u91cd\u590d\u4e86\uff0c\u4e5f\u5c31\u964d\u4f4e\u4e86\u7f13\u5b58\u96c6\u4f53\u5931\u6548\u7684\u6982\u7387\u3002</li> <li>\u8bbe\u7f6e\u7f13\u5b58\u4e0d\u8fc7\u671f\uff1a \u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u540e\u53f0\u670d\u52a1\u6765\u66f4\u65b0\u7f13\u5b58\u6570\u636e\uff0c\u4ece\u800c\u907f\u514d\u56e0\u4e3a\u7f13\u5b58\u5931\u6548\u9020\u6210\u7684\u7f13\u5b58\u96ea\u5d29\uff0c\u4e5f\u53ef\u4ee5\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u907f\u514d\u7f13\u5b58\u5e76\u53d1\u95ee\u9898\u3002 <p>\u5982\u4f55\u907f\u514d\u7f13\u5b58\u51fb\u7a7f\uff1f</p> </li> </ul> <p>\u6211\u4eec\u7684\u4e1a\u52a1\u901a\u5e38\u4f1a\u6709\u51e0\u4e2a\u6570\u636e\u4f1a\u88ab\u9891\u7e41\u5730\u8bbf\u95ee\uff0c\u6bd4\u5982\u79d2\u6740\u6d3b\u52a8\uff0c\u8fd9\u7c7b\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u88ab\u79f0\u4e3a\u70ed\u70b9\u6570\u636e\u3002</p> <p>\u5982\u679c\u7f13\u5b58\u4e2d\u7684\u67d0\u4e2a\u70ed\u70b9\u6570\u636e\u8fc7\u671f\u4e86\uff0c\u6b64\u65f6\u5927\u91cf\u7684\u8bf7\u6c42\u8bbf\u95ee\u4e86\u8be5\u70ed\u70b9\u6570\u636e\uff0c\u5c31\u65e0\u6cd5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\uff0c\u76f4\u63a5\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u5f88\u5bb9\u6613\u5c31\u88ab\u9ad8\u5e76\u53d1\u7684\u8bf7\u6c42\u51b2\u57ae\uff0c\u8fd9\u5c31\u662f\u7f13\u5b58\u51fb\u7a7f\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\u7f13\u5b58\u51fb\u7a7f\u8ddf\u7f13\u5b58\u96ea\u5d29\u5f88\u76f8\u4f3c\uff0c\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u7f13\u5b58\u51fb\u7a7f\u662f\u7f13\u5b58\u96ea\u5d29\u7684\u4e00\u4e2a\u5b50\u96c6\u3002 \u5e94\u5bf9\u7f13\u5b58\u51fb\u7a7f\u53ef\u4ee5\u91c7\u53d6\u524d\u9762\u8bf4\u5230\u4e24\u79cd\u65b9\u6848\uff1a</p> <ul> <li>\u4e92\u65a5\u9501\u65b9\u6848\uff08Redis \u4e2d\u4f7f\u7528 setNX \u65b9\u6cd5\u8bbe\u7f6e\u4e00\u4e2a\u72b6\u6001\u4f4d\uff0c\u8868\u793a\u8fd9\u662f\u4e00\u79cd\u9501\u5b9a\u72b6\u6001\uff09\uff0c\u4fdd\u8bc1\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u4e1a\u52a1\u7ebf\u7a0b\u8bf7\u6c42\u7f13\u5b58\uff0c\u672a\u80fd\u83b7\u53d6\u4e92\u65a5\u9501\u7684\u8bf7\u6c42\uff0c\u8981\u4e48\u7b49\u5f85\u9501\u91ca\u653e\u540e\u91cd\u65b0\u8bfb\u53d6\u7f13\u5b58\uff0c\u8981\u4e48\u5c31\u8fd4\u56de\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c\u3002</li> <li>\u4e0d\u7ed9\u70ed\u70b9\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u7531\u540e\u53f0\u5f02\u6b65\u66f4\u65b0\u7f13\u5b58\uff0c\u6216\u8005\u5728\u70ed\u70b9\u6570\u636e\u51c6\u5907\u8981\u8fc7\u671f\u524d\uff0c\u63d0\u524d\u901a\u77e5\u540e\u53f0\u7ebf\u7a0b\u66f4\u65b0\u7f13\u5b58\u4ee5\u53ca\u91cd\u65b0\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff1b <p>\u5982\u4f55\u907f\u514d\u7f13\u5b58\u7a7f\u900f\uff1f</p> </li> </ul> <p>\u5f53\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u6216\u51fb\u7a7f\u65f6\uff0c\u6570\u636e\u5e93\u4e2d\u8fd8\u662f\u4fdd\u5b58\u4e86\u5e94\u7528\u8981\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u4e00\u65e6\u7f13\u5b58\u6062\u590d\u76f8\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u538b\u529b\uff0c\u800c\u7f13\u5b58\u7a7f\u900f\u5c31\u4e0d\u4e00\u6837\u4e86\u3002</p> <p>\u5f53\u7528\u6237\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u65e2\u4e0d\u5728\u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u5bfc\u81f4\u8bf7\u6c42\u5728\u8bbf\u95ee\u7f13\u5b58\u65f6\uff0c\u53d1\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u518d\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u53d1\u73b0\u6570\u636e\u5e93\u4e2d\u4e5f\u6ca1\u6709\u8981\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u6ca1\u529e\u6cd5\u6784\u5efa\u7f13\u5b58\u6570\u636e\uff0c\u6765\u670d\u52a1\u540e\u7eed\u7684\u8bf7\u6c42\u3002\u90a3\u4e48\u5f53\u6709\u5927\u91cf\u8fd9\u6837\u7684\u8bf7\u6c42\u5230\u6765\u65f6\uff0c\u6570\u636e\u5e93\u7684\u538b\u529b\u9aa4\u589e\uff0c\u8fd9\u5c31\u662f\u7f13\u5b58\u7a7f\u900f\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u7f13\u5b58\u7a7f\u900f\u7684\u53d1\u751f\u4e00\u822c\u6709\u8fd9\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u4e1a\u52a1\u8bef\u64cd\u4f5c\uff0c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u90fd\u88ab\u8bef\u5220\u9664\u4e86\uff0c\u6240\u4ee5\u5bfc\u81f4\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u6570\u636e\uff1b</li> <li>\u9ed1\u5ba2\u6076\u610f\u653b\u51fb\uff0c\u6545\u610f\u5927\u91cf\u8bbf\u95ee\u67d0\u4e9b\u8bfb\u53d6\u4e0d\u5b58\u5728\u6570\u636e\u7684\u4e1a\u52a1\uff1b</li> </ul> <p>\u5e94\u5bf9\u7f13\u5b58\u7a7f\u900f\u7684\u65b9\u6848\uff0c\u5e38\u89c1\u7684\u65b9\u6848\u6709\u4e09\u79cd\u3002</p> <ul> <li>\u975e\u6cd5\u8bf7\u6c42\u7684\u9650\u5236\uff1a\u5f53\u6709\u5927\u91cf\u6076\u610f\u8bf7\u6c42\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e5f\u4f1a\u53d1\u751f\u7f13\u5b58\u7a7f\u900f\uff0c\u56e0\u6b64\u5728 API \u5165\u53e3\u5904\u6211\u4eec\u8981\u5224\u65ad\u6c42\u8bf7\u6c42\u53c2\u6570\u662f\u5426\u5408\u7406\uff0c\u8bf7\u6c42\u53c2\u6570\u662f\u5426\u542b\u6709\u975e\u6cd5\u503c\u3001\u8bf7\u6c42\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u5224\u65ad\u51fa\u662f\u6076\u610f\u8bf7\u6c42\u5c31\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\uff0c\u907f\u514d\u8fdb\u4e00\u6b65\u8bbf\u95ee\u7f13\u5b58\u548c\u6570\u636e\u5e93\u3002</li> <li>\u8bbe\u7f6e\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c\uff1a\u5f53\u6211\u4eec\u7ebf\u4e0a\u4e1a\u52a1\u53d1\u73b0\u7f13\u5b58\u7a7f\u900f\u7684\u73b0\u8c61\u65f6\uff0c\u53ef\u4ee5\u9488\u5bf9\u67e5\u8be2\u7684\u6570\u636e\uff0c\u5728\u7f13\u5b58\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c\uff0c\u8fd9\u6837\u540e\u7eed\u8bf7\u6c42\u5c31\u53ef\u4ee5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u5230\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c\uff0c\u8fd4\u56de\u7ed9\u5e94\u7528\uff0c\u800c\u4e0d\u4f1a\u7ee7\u7eed\u67e5\u8be2\u6570\u636e\u5e93\u3002</li> <li>\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u907f\u514d\u901a\u8fc7\u67e5\u8be2\u6570\u636e\u5e93\u6765\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff1a\u6211\u4eec\u53ef\u4ee5\u5728\u5199\u5165\u6570\u636e\u5e93\u6570\u636e\u65f6\uff0c\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u505a\u4e2a\u6807\u8bb0\uff0c\u7136\u540e\u5728\u7528\u6237\u8bf7\u6c42\u5230\u6765\u65f6\uff0c\u4e1a\u52a1\u7ebf\u7a0b\u786e\u8ba4\u7f13\u5b58\u5931\u6548\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u8be2\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u4e0d\u7528\u901a\u8fc7\u67e5\u8be2\u6570\u636e\u5e93\u6765\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u5373\u4f7f\u53d1\u751f\u4e86\u7f13\u5b58\u7a7f\u900f\uff0c\u5927\u91cf\u8bf7\u6c42\u53ea\u4f1a\u67e5\u8be2 Redis \u548c\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u800c\u4e0d\u4f1a\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u5e93\u80fd\u6b63\u5e38\u8fd0\u884c\uff0cRedis \u81ea\u8eab\u4e5f\u662f\u652f\u6301\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u3002</li> </ul> <p>::: tip</p> <p>\u63a8\u8350\u9605\u8bfb\uff1a\u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\u3001\u51fb\u7a7f\u3001\u7a7f\u900f\uff1f</p> <p>:::</p>"},{"location":"redis/base/redis_interview/#_4","title":"\u5982\u4f55\u8bbe\u8ba1\u4e00\u4e2a\u7f13\u5b58\u7b56\u7565\uff0c\u53ef\u4ee5\u52a8\u6001\u7f13\u5b58\u70ed\u70b9\u6570\u636e\u5462\uff1f","text":"<p>\u7531\u4e8e\u6570\u636e\u5b58\u50a8\u53d7\u9650\uff0c\u7cfb\u7edf\u5e76\u4e0d\u662f\u5c06\u6240\u6709\u6570\u636e\u90fd\u9700\u8981\u5b58\u653e\u5230\u7f13\u5b58\u4e2d\u7684\uff0c\u800c\u53ea\u662f\u5c06\u5176\u4e2d\u4e00\u90e8\u5206\u70ed\u70b9\u6570\u636e\u7f13\u5b58\u8d77\u6765\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u8bbe\u8ba1\u4e00\u4e2a\u70ed\u70b9\u6570\u636e\u52a8\u6001\u7f13\u5b58\u7684\u7b56\u7565\u3002</p> <p>\u70ed\u70b9\u6570\u636e\u52a8\u6001\u7f13\u5b58\u7684\u7b56\u7565\u603b\u4f53\u601d\u8def\uff1a\u901a\u8fc7\u6570\u636e\u6700\u65b0\u8bbf\u95ee\u65f6\u95f4\u6765\u505a\u6392\u540d\uff0c\u5e76\u8fc7\u6ee4\u6389\u4e0d\u5e38\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u53ea\u7559\u4e0b\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u3002</p> <p>\u4ee5\u7535\u5546\u5e73\u53f0\u573a\u666f\u4e2d\u7684\u4f8b\u5b50\uff0c\u73b0\u5728\u8981\u6c42\u53ea\u7f13\u5b58\u7528\u6237\u7ecf\u5e38\u8bbf\u95ee\u7684 Top 1000 \u7684\u5546\u54c1\u3002\u5177\u4f53\u7ec6\u8282\u5982\u4e0b\uff1a</p> <ul> <li>\u5148\u901a\u8fc7\u7f13\u5b58\u7cfb\u7edf\u505a\u4e00\u4e2a\u6392\u5e8f\u961f\u5217\uff08\u6bd4\u5982\u5b58\u653e 1000 \u4e2a\u5546\u54c1\uff09\uff0c\u7cfb\u7edf\u4f1a\u6839\u636e\u5546\u54c1\u7684\u8bbf\u95ee\u65f6\u95f4\uff0c\u66f4\u65b0\u961f\u5217\u4fe1\u606f\uff0c\u8d8a\u662f\u6700\u8fd1\u8bbf\u95ee\u7684\u5546\u54c1\u6392\u540d\u8d8a\u9760\u524d\uff1b</li> <li>\u540c\u65f6\u7cfb\u7edf\u4f1a\u5b9a\u671f\u8fc7\u6ee4\u6389\u961f\u5217\u4e2d\u6392\u540d\u6700\u540e\u7684 200 \u4e2a\u5546\u54c1\uff0c\u7136\u540e\u518d\u4ece\u6570\u636e\u5e93\u4e2d\u968f\u673a\u8bfb\u53d6\u51fa 200 \u4e2a\u5546\u54c1\u52a0\u5165\u961f\u5217\u4e2d\uff1b</li> <li>\u8fd9\u6837\u5f53\u8bf7\u6c42\u6bcf\u6b21\u5230\u8fbe\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u4ece\u961f\u5217\u4e2d\u83b7\u53d6\u5546\u54c1 ID\uff0c\u5982\u679c\u547d\u4e2d\uff0c\u5c31\u6839\u636e ID \u518d\u4ece\u53e6\u4e00\u4e2a\u7f13\u5b58\u6570\u636e\u7ed3\u6784\u4e2d\u8bfb\u53d6\u5b9e\u9645\u7684\u5546\u54c1\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u3002</li> </ul> <p>\u5728 Redis \u4e2d\u53ef\u4ee5\u7528 zadd \u65b9\u6cd5\u548c zrange \u65b9\u6cd5\u6765\u5b8c\u6210\u6392\u5e8f\u961f\u5217\u548c\u83b7\u53d6 200 \u4e2a\u5546\u54c1\u7684\u64cd\u4f5c\u3002</p>"},{"location":"redis/base/redis_interview/#_5","title":"\u8bf4\u8bf4\u5e38\u89c1\u7684\u7f13\u5b58\u66f4\u65b0\u7b56\u7565\uff1f","text":"<p>\u5e38\u89c1\u7684\u7f13\u5b58\u66f4\u65b0\u7b56\u7565\u5171\u6709 3 \u79cd\uff1a</p> <ul> <li>Cache Aside\uff08\u65c1\u8def\u7f13\u5b58\uff09\u7b56\u7565\uff1b</li> <li>Read/Write Through\uff08\u8bfb\u7a7f / \u5199\u7a7f\uff09\u7b56\u7565\uff1b</li> <li>Write Back\uff08\u5199\u56de\uff09\u7b56\u7565\uff1b</li> </ul> <p>\u5b9e\u9645\u5f00\u53d1\u4e2d\uff0cRedis \u548c MySQL \u7684\u66f4\u65b0\u7b56\u7565\u7528\u7684\u662f Cache Aside\uff0c\u53e6\u5916\u4e24\u79cd\u7b56\u7565\u5e94\u7528\u4e0d\u4e86\u3002</p> <p>Cache Aside\uff08\u65c1\u8def\u7f13\u5b58\uff09\u7b56\u7565</p> <p>Cache Aside\uff08\u65c1\u8def\u7f13\u5b58\uff09\u7b56\u7565\u662f\u6700\u5e38\u7528\u7684\uff0c\u5e94\u7528\u7a0b\u5e8f\u76f4\u63a5\u4e0e\u300c\u6570\u636e\u5e93\u3001\u7f13\u5b58\u300d\u4ea4\u4e92\uff0c\u5e76\u8d1f\u8d23\u5bf9\u7f13\u5b58\u7684\u7ef4\u62a4\uff0c\u8be5\u7b56\u7565\u53c8\u53ef\u4ee5\u7ec6\u5206\u4e3a\u300c\u8bfb\u7b56\u7565\u300d\u548c\u300c\u5199\u7b56\u7565\u300d\u3002</p> <p></p> <p>\u5199\u7b56\u7565\u7684\u6b65\u9aa4\uff1a</p> <ul> <li>\u5148\u66f4\u65b0\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\uff0c\u518d\u5220\u9664\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u3002</li> </ul> <p>\u8bfb\u7b56\u7565\u7684\u6b65\u9aa4\uff1a</p> <ul> <li>\u5982\u679c\u8bfb\u53d6\u7684\u6570\u636e\u547d\u4e2d\u4e86\u7f13\u5b58\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u6570\u636e\uff1b</li> <li>\u5982\u679c\u8bfb\u53d6\u7684\u6570\u636e\u6ca1\u6709\u547d\u4e2d\u7f13\u5b58\uff0c\u5219\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u5c06\u6570\u636e\u5199\u5165\u5230\u7f13\u5b58\uff0c\u5e76\u4e14\u8fd4\u56de\u7ed9\u7528\u6237\u3002</li> </ul> <p>\u6ce8\u610f\uff0c\u5199\u7b56\u7565\u7684\u6b65\u9aa4\u7684\u987a\u5e8f\u4e0d\u80fd\u5012\u8fc7\u6765\uff0c\u5373\u4e0d\u80fd\u5148\u5220\u9664\u7f13\u5b58\u518d\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u539f\u56e0\u662f\u5728\u300c\u8bfb + \u5199\u300d\u5e76\u53d1\u7684\u65f6\u5019\uff0c\u4f1a\u51fa\u73b0\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u6027\u7684\u95ee\u9898\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u67d0\u4e2a\u7528\u6237\u7684\u5e74\u9f84\u662f 20\uff0c\u8bf7\u6c42 A \u8981\u66f4\u65b0\u7528\u6237\u5e74\u9f84\u4e3a 21\uff0c\u6240\u4ee5\u5b83\u4f1a\u5220\u9664\u7f13\u5b58\u4e2d\u7684\u5185\u5bb9\u3002\u8fd9\u65f6\uff0c\u53e6\u4e00\u4e2a\u8bf7\u6c42 B \u8981\u8bfb\u53d6\u8fd9\u4e2a\u7528\u6237\u7684\u5e74\u9f84\uff0c\u5b83\u67e5\u8be2\u7f13\u5b58\u53d1\u73b0\u672a\u547d\u4e2d\u540e\uff0c\u4f1a\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u53d6\u5230\u5e74\u9f84\u4e3a 20\uff0c\u5e76\u4e14\u5199\u5165\u5230\u7f13\u5b58\u4e2d\uff0c\u7136\u540e\u8bf7\u6c42 A \u7ee7\u7eed\u66f4\u6539\u6570\u636e\u5e93\uff0c\u5c06\u7528\u6237\u7684\u5e74\u9f84\u66f4\u65b0\u4e3a 21\u3002</p> <p></p> <p>\u6700\u7ec8\uff0c\u8be5\u7528\u6237\u5e74\u9f84\u5728\u7f13\u5b58\u4e2d\u662f 20\uff08\u65e7\u503c\uff09\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u662f 21\uff08\u65b0\u503c\uff09\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u7684\u6570\u636e\u4e0d\u4e00\u81f4\u3002</p> <p>\u4e3a\u4ec0\u4e48\u300c\u5148\u66f4\u65b0\u6570\u636e\u5e93\u518d\u5220\u9664\u7f13\u5b58\u300d\u4e0d\u4f1a\u6709\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u95ee\u9898\uff1f</p> <p>\u7ee7\u7eed\u7528\u300c\u8bfb + \u5199\u300d\u8bf7\u6c42\u7684\u5e76\u53d1\u7684\u573a\u666f\u6765\u5206\u6790\u3002</p> <p>\u5047\u5982\u67d0\u4e2a\u7528\u6237\u6570\u636e\u5728\u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\uff0c\u8bf7\u6c42 A \u8bfb\u53d6\u6570\u636e\u65f6\u4ece\u6570\u636e\u5e93\u4e2d\u67e5\u8be2\u5230\u5e74\u9f84\u4e3a 20\uff0c\u5728\u672a\u5199\u5165\u7f13\u5b58\u4e2d\u65f6\u53e6\u4e00\u4e2a\u8bf7\u6c42 B \u66f4\u65b0\u6570\u636e\u3002\u5b83\u66f4\u65b0\u6570\u636e\u5e93\u4e2d\u7684\u5e74\u9f84\u4e3a 21\uff0c\u5e76\u4e14\u6e05\u7a7a\u7f13\u5b58\u3002\u8fd9\u65f6\u8bf7\u6c42 A \u628a\u4ece\u6570\u636e\u5e93\u4e2d\u8bfb\u5230\u7684\u5e74\u9f84\u4e3a 20 \u7684\u6570\u636e\u5199\u5165\u5230\u7f13\u5b58\u4e2d\u3002</p> <p></p> <p>\u6700\u7ec8\uff0c\u8be5\u7528\u6237\u5e74\u9f84\u5728\u7f13\u5b58\u4e2d\u662f 20\uff08\u65e7\u503c\uff09\uff0c\u5728\u6570\u636e\u5e93\u4e2d\u662f 21\uff08\u65b0\u503c\uff09\uff0c\u7f13\u5b58\u548c\u6570\u636e\u5e93\u6570\u636e\u4e0d\u4e00\u81f4\u3002 \u4ece\u4e0a\u9762\u7684\u7406\u8bba\u4e0a\u5206\u6790\uff0c\u5148\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u518d\u5220\u9664\u7f13\u5b58\u4e5f\u662f\u4f1a\u51fa\u73b0\u6570\u636e\u4e0d\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u4e2d\uff0c\u8fd9\u4e2a\u95ee\u9898\u51fa\u73b0\u7684\u6982\u7387\u5e76\u4e0d\u9ad8\u3002</p> <p>\u56e0\u4e3a\u7f13\u5b58\u7684\u5199\u5165\u901a\u5e38\u8981\u8fdc\u8fdc\u5feb\u4e8e\u6570\u636e\u5e93\u7684\u5199\u5165\uff0c\u6240\u4ee5\u5728\u5b9e\u9645\u4e2d\u5f88\u96be\u51fa\u73b0\u8bf7\u6c42 B \u5df2\u7ecf\u66f4\u65b0\u4e86\u6570\u636e\u5e93\u5e76\u4e14\u5220\u9664\u4e86\u7f13\u5b58\uff0c\u8bf7\u6c42 A \u624d\u66f4\u65b0\u5b8c\u7f13\u5b58\u7684\u60c5\u51b5\u3002\u800c\u4e00\u65e6\u8bf7\u6c42 A \u65e9\u4e8e\u8bf7\u6c42 B \u5220\u9664\u7f13\u5b58\u4e4b\u524d\u66f4\u65b0\u4e86\u7f13\u5b58\uff0c\u90a3\u4e48\u63a5\u4e0b\u6765\u7684\u8bf7\u6c42\u5c31\u4f1a\u56e0\u4e3a\u7f13\u5b58\u4e0d\u547d\u4e2d\u800c\u4ece\u6570\u636e\u5e93\u4e2d\u91cd\u65b0\u8bfb\u53d6\u6570\u636e\uff0c\u6240\u4ee5\u4e0d\u4f1a\u51fa\u73b0\u8fd9\u79cd\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\u3002</p> <p>Cache Aside \u7b56\u7565\u9002\u5408\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\uff0c\u4e0d\u9002\u5408\u5199\u591a\u7684\u573a\u666f\uff0c\u56e0\u4e3a\u5f53\u5199\u5165\u6bd4\u8f83\u9891\u7e41\u65f6\uff0c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u4f1a\u88ab\u9891\u7e41\u5730\u6e05\u7406\uff0c\u8fd9\u6837\u4f1a\u5bf9\u7f13\u5b58\u7684\u547d\u4e2d\u7387\u6709\u4e00\u4e9b\u5f71\u54cd\u3002\u5982\u679c\u4e1a\u52a1\u5bf9\u7f13\u5b58\u547d\u4e2d\u7387\u6709\u4e25\u683c\u7684\u8981\u6c42\uff0c\u90a3\u4e48\u53ef\u4ee5\u8003\u8651\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff1a</p> <ul> <li>\u4e00\u79cd\u505a\u6cd5\u662f\u5728\u66f4\u65b0\u6570\u636e\u65f6\u4e5f\u66f4\u65b0\u7f13\u5b58\uff0c\u53ea\u662f\u5728\u66f4\u65b0\u7f13\u5b58\u524d\u5148\u52a0\u4e00\u4e2a\u5206\u5e03\u5f0f\u9501\uff0c\u56e0\u4e3a\u8fd9\u6837\u5728\u540c\u4e00\u65f6\u95f4\u53ea\u5141\u8bb8\u4e00\u4e2a\u7ebf\u7a0b\u66f4\u65b0\u7f13\u5b58\uff0c\u5c31\u4e0d\u4f1a\u4ea7\u751f\u5e76\u53d1\u95ee\u9898\u4e86\u3002\u5f53\u7136\u8fd9\u4e48\u505a\u5bf9\u4e8e\u5199\u5165\u7684\u6027\u80fd\u4f1a\u6709\u4e00\u4e9b\u5f71\u54cd\uff1b</li> <li>\u53e6\u4e00\u79cd\u505a\u6cd5\u540c\u6837\u4e5f\u662f\u5728\u66f4\u65b0\u6570\u636e\u65f6\u66f4\u65b0\u7f13\u5b58\uff0c\u53ea\u662f\u7ed9\u7f13\u5b58\u52a0\u4e00\u4e2a\u8f83\u77ed\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u8fd9\u6837\u5373\u4f7f\u51fa\u73b0\u7f13\u5b58\u4e0d\u4e00\u81f4\u7684\u60c5\u51b5\uff0c\u7f13\u5b58\u7684\u6570\u636e\u4e5f\u4f1a\u5f88\u5feb\u8fc7\u671f\uff0c\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\u4e5f\u662f\u53ef\u4ee5\u63a5\u53d7\u3002 <p>Read/Write Through\uff08\u8bfb\u7a7f / \u5199\u7a7f\uff09\u7b56\u7565</p> </li> </ul> <p>Read/Write Through\uff08\u8bfb\u7a7f / \u5199\u7a7f\uff09\u7b56\u7565\u539f\u5219\u662f\u5e94\u7528\u7a0b\u5e8f\u53ea\u548c\u7f13\u5b58\u4ea4\u4e92\uff0c\u4e0d\u518d\u548c\u6570\u636e\u5e93\u4ea4\u4e92\uff0c\u800c\u662f\u7531\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4ea4\u4e92\uff0c\u76f8\u5f53\u4e8e\u66f4\u65b0\u6570\u636e\u5e93\u7684\u64cd\u4f5c\u7531\u7f13\u5b58\u81ea\u5df1\u4ee3\u7406\u4e86\u3002</p> <p>1\u3001Read Through \u7b56\u7565</p> <p>\u5148\u67e5\u8be2\u7f13\u5b58\u4e2d\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u5b58\u5728\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5219\u7531\u7f13\u5b58\u7ec4\u4ef6\u8d1f\u8d23\u4ece\u6570\u636e\u5e93\u67e5\u8be2\u6570\u636e\uff0c\u5e76\u5c06\u7ed3\u679c\u5199\u5165\u5230\u7f13\u5b58\u7ec4\u4ef6\uff0c\u6700\u540e\u7f13\u5b58\u7ec4\u4ef6\u5c06\u6570\u636e\u8fd4\u56de\u7ed9\u5e94\u7528\u3002</p> <p>2\u3001Write Through \u7b56\u7565</p> <p>\u5f53\u6709\u6570\u636e\u66f4\u65b0\u7684\u65f6\u5019\uff0c\u5148\u67e5\u8be2\u8981\u5199\u5165\u7684\u6570\u636e\u5728\u7f13\u5b58\u4e2d\u662f\u5426\u5df2\u7ecf\u5b58\u5728\uff1a</p> <ul> <li>\u5982\u679c\u7f13\u5b58\u4e2d\u6570\u636e\u5df2\u7ecf\u5b58\u5728\uff0c\u5219\u66f4\u65b0\u7f13\u5b58\u4e2d\u7684\u6570\u636e\uff0c\u5e76\u4e14\u7531\u7f13\u5b58\u7ec4\u4ef6\u540c\u6b65\u66f4\u65b0\u5230\u6570\u636e\u5e93\u4e2d\uff0c\u7136\u540e\u7f13\u5b58\u7ec4\u4ef6\u544a\u77e5\u5e94\u7528\u7a0b\u5e8f\u66f4\u65b0\u5b8c\u6210\u3002</li> <li>\u5982\u679c\u7f13\u5b58\u4e2d\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u76f4\u63a5\u66f4\u65b0\u6570\u636e\u5e93\uff0c\u7136\u540e\u8fd4\u56de\uff1b</li> </ul> <p>\u4e0b\u9762\u662f Read Through/Write Through \u7b56\u7565\u7684\u793a\u610f\u56fe\uff1a</p> <p></p> <p>Read Through/Write Through \u7b56\u7565\u7684\u7279\u70b9\u662f\u7531\u7f13\u5b58\u8282\u70b9\u800c\u975e\u5e94\u7528\u7a0b\u5e8f\u6765\u548c\u6570\u636e\u5e93\u6253\u4ea4\u9053\uff0c\u5728\u6211\u4eec\u5f00\u53d1\u8fc7\u7a0b\u4e2d\u76f8\u6bd4 Cache Aside \u7b56\u7565\u8981\u5c11\u89c1\u4e00\u4e9b\uff0c\u539f\u56e0\u662f\u6211\u4eec\u7ecf\u5e38\u4f7f\u7528\u7684\u5206\u5e03\u5f0f\u7f13\u5b58\u7ec4\u4ef6\uff0c\u65e0\u8bba\u662f Memcached \u8fd8\u662f Redis \u90fd\u4e0d\u63d0\u4f9b\u5199\u5165\u6570\u636e\u5e93\u548c\u81ea\u52a8\u52a0\u8f7d\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u7684\u529f\u80fd\u3002\u800c\u6211\u4eec\u5728\u4f7f\u7528\u672c\u5730\u7f13\u5b58\u7684\u65f6\u5019\u53ef\u4ee5\u8003\u8651\u4f7f\u7528\u8fd9\u79cd\u7b56\u7565\u3002</p> <p>Write Back\uff08\u5199\u56de\uff09\u7b56\u7565</p> <p>Write Back\uff08\u5199\u56de\uff09\u7b56\u7565\u5728\u66f4\u65b0\u6570\u636e\u7684\u65f6\u5019\uff0c\u53ea\u66f4\u65b0\u7f13\u5b58\uff0c\u540c\u65f6\u5c06\u7f13\u5b58\u6570\u636e\u8bbe\u7f6e\u4e3a\u810f\u7684\uff0c\u7136\u540e\u7acb\u9a6c\u8fd4\u56de\uff0c\u5e76\u4e0d\u4f1a\u66f4\u65b0\u6570\u636e\u5e93\u3002\u5bf9\u4e8e\u6570\u636e\u5e93\u7684\u66f4\u65b0\uff0c\u4f1a\u901a\u8fc7\u6279\u91cf\u5f02\u6b65\u66f4\u65b0\u7684\u65b9\u5f0f\u8fdb\u884c\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cWrite Back\uff08\u5199\u56de\uff09\u7b56\u7565\u4e5f\u4e0d\u80fd\u5e94\u7528\u5230\u6211\u4eec\u5e38\u7528\u7684\u6570\u636e\u5e93\u548c\u7f13\u5b58\u7684\u573a\u666f\u4e2d\uff0c\u56e0\u4e3a Redis \u5e76\u6ca1\u6709\u5f02\u6b65\u66f4\u65b0\u6570\u636e\u5e93\u7684\u529f\u80fd\u3002</p> <p>Write Back \u662f\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\u4e2d\u7684\u8bbe\u8ba1\uff0c\u6bd4\u5982 CPU \u7684\u7f13\u5b58\u3001\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u6587\u4ef6\u7cfb\u7edf\u7684\u7f13\u5b58\u90fd\u91c7\u7528\u4e86 Write Back\uff08\u5199\u56de\uff09\u7b56\u7565\u3002</p> <p>Write Back \u7b56\u7565\u7279\u522b\u9002\u5408\u5199\u591a\u7684\u573a\u666f\uff0c\u56e0\u4e3a\u53d1\u751f\u5199\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u66f4\u65b0\u7f13\u5b58\uff0c\u5c31\u7acb\u9a6c\u8fd4\u56de\u4e86\u3002\u6bd4\u5982\uff0c\u5199\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u662f\u5199\u5165\u5230\u6587\u4ef6\u7cfb\u7edf\u7684\u7f13\u5b58\u5c31\u8fd4\u56de\u4e86\uff0c\u5e76\u4e0d\u4f1a\u5199\u78c1\u76d8\u3002</p> <p>\u4f46\u662f\u5e26\u6765\u7684\u95ee\u9898\u662f\uff0c\u6570\u636e\u4e0d\u662f\u5f3a\u4e00\u81f4\u6027\u7684\uff0c\u800c\u4e14\u4f1a\u6709\u6570\u636e\u4e22\u5931\u7684\u98ce\u9669\uff0c\u56e0\u4e3a\u7f13\u5b58\u4e00\u822c\u4f7f\u7528\u5185\u5b58\uff0c\u800c\u5185\u5b58\u662f\u975e\u6301\u4e45\u5316\u7684\uff0c\u6240\u4ee5\u4e00\u65e6\u7f13\u5b58\u673a\u5668\u6389\u7535\uff0c\u5c31\u4f1a\u9020\u6210\u539f\u672c\u7f13\u5b58\u4e2d\u7684\u810f\u6570\u636e\u4e22\u5931\u3002\u6240\u4ee5\u4f60\u4f1a\u53d1\u73b0\u7cfb\u7edf\u5728\u6389\u7535\u4e4b\u540e\uff0c\u4e4b\u524d\u5199\u5165\u7684\u6587\u4ef6\u4f1a\u6709\u90e8\u5206\u4e22\u5931\uff0c\u5c31\u662f\u56e0\u4e3a Page Cache \u8fd8\u6ca1\u6709\u6765\u5f97\u53ca\u5237\u76d8\u9020\u6210\u7684\u3002</p> <p>\u8fd9\u91cc\u8d34\u4e00\u5f20 CPU \u7f13\u5b58\u4e0e\u5185\u5b58\u4f7f\u7528 Write Back \u7b56\u7565\u7684\u6d41\u7a0b\u56fe\uff1a</p> <p></p> <p>\u6709\u6ca1\u6709\u89c9\u5f97\u8fd9\u4e2a\u6d41\u7a0b\u5f88\u719f\u6089\uff1f\u56e0\u4e3a\u6211\u5728\u5199 CPU \u7f13\u5b58\u6587\u7ae0\u7684\u65f6\u5019\u63d0\u5230\u8fc7\u3002</p>"},{"location":"redis/base/redis_interview/#_6","title":"\u5982\u4f55\u4fdd\u8bc1\u7f13\u5b58\u548c\u6570\u636e\u5e93\u6570\u636e\u7684\u4e00\u81f4\u6027\uff1f","text":"<p>::: tip</p> <p>\u63a8\u8350\u9605\u8bfb\uff1a\u6570\u636e\u5e93\u548c\u7f13\u5b58\u5982\u4f55\u4fdd\u8bc1\u4e00\u81f4\u6027\uff1f</p> <p>:::</p>"},{"location":"redis/base/redis_interview/#redis_21","title":"Redis \u5b9e\u6218","text":""},{"location":"redis/base/redis_interview/#redis_22","title":"Redis \u5982\u4f55\u5b9e\u73b0\u5ef6\u8fdf\u961f\u5217\uff1f","text":"<p>\u5ef6\u8fdf\u961f\u5217\u662f\u6307\u628a\u5f53\u524d\u8981\u505a\u7684\u4e8b\u60c5\uff0c\u5f80\u540e\u63a8\u8fdf\u4e00\u6bb5\u65f6\u95f4\u518d\u505a\u3002\u5ef6\u8fdf\u961f\u5217\u7684\u5e38\u89c1\u4f7f\u7528\u573a\u666f\u6709\u4ee5\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>\u5728\u6dd8\u5b9d\u3001\u4eac\u4e1c\u7b49\u8d2d\u7269\u5e73\u53f0\u4e0a\u4e0b\u5355\uff0c\u8d85\u8fc7\u4e00\u5b9a\u65f6\u95f4\u672a\u4ed8\u6b3e\uff0c\u8ba2\u5355\u4f1a\u81ea\u52a8\u53d6\u6d88\uff1b</li> <li>\u6253\u8f66\u7684\u65f6\u5019\uff0c\u5728\u89c4\u5b9a\u65f6\u95f4\u6ca1\u6709\u8f66\u4e3b\u63a5\u5355\uff0c\u5e73\u53f0\u4f1a\u53d6\u6d88\u4f60\u7684\u5355\u5e76\u63d0\u9192\u4f60\u6682\u65f6\u6ca1\u6709\u8f66\u4e3b\u63a5\u5355\uff1b</li> <li>\u70b9\u5916\u5356\u7684\u65f6\u5019\uff0c\u5982\u679c\u5546\u5bb6\u5728 10 \u5206\u949f\u8fd8\u6ca1\u63a5\u5355\uff0c\u5c31\u4f1a\u81ea\u52a8\u53d6\u6d88\u8ba2\u5355\uff1b</li> </ul> <p>\u5728 Redis \u53ef\u4ee5\u4f7f\u7528\u6709\u5e8f\u96c6\u5408\uff08ZSet\uff09\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u5ef6\u8fdf\u6d88\u606f\u961f\u5217\u7684\uff0cZSet \u6709\u4e00\u4e2a Score \u5c5e\u6027\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u5ef6\u8fdf\u6267\u884c\u7684\u65f6\u95f4\u3002                 </p> <p>\u4f7f\u7528 zadd score1 value1 \u547d\u4ee4\u5c31\u53ef\u4ee5\u4e00\u76f4\u5f80\u5185\u5b58\u4e2d\u751f\u4ea7\u6d88\u606f\u3002\u518d\u5229\u7528 zrangebysocre \u67e5\u8be2\u7b26\u5408\u6761\u4ef6\u7684\u6240\u6709\u5f85\u5904\u7406\u7684\u4efb\u52a1\uff0c\u901a\u8fc7\u5faa\u73af\u6267\u884c\u961f\u5217\u4efb\u52a1\u5373\u53ef\u3002 </p> <p></p>"},{"location":"redis/base/redis_interview/#redis-key","title":"Redis \u7684\u5927 key \u5982\u4f55\u5904\u7406\uff1f","text":"<p>\u4ec0\u4e48\u662f Redis \u5927 key\uff1f</p> <p>\u5927 key \u5e76\u4e0d\u662f\u6307 key \u7684\u503c\u5f88\u5927\uff0c\u800c\u662f key \u5bf9\u5e94\u7684 value \u5f88\u5927\u3002</p> <p>\u4e00\u822c\u800c\u8a00\uff0c\u4e0b\u9762\u8fd9\u4e24\u79cd\u60c5\u51b5\u88ab\u79f0\u4e3a\u5927 key\uff1a</p> <ul> <li>String \u7c7b\u578b\u7684\u503c\u5927\u4e8e 10 KB\uff1b</li> <li>Hash\u3001List\u3001Set\u3001ZSet \u7c7b\u578b\u7684\u5143\u7d20\u7684\u4e2a\u6570\u8d85\u8fc7 5000 \u4e2a\uff1b <p>\u5927 key \u4f1a\u9020\u6210\u4ec0\u4e48\u95ee\u9898\uff1f</p> </li> </ul> <p>\u5927 key \u4f1a\u5e26\u6765\u4ee5\u4e0b\u56db\u79cd\u5f71\u54cd\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u8d85\u65f6\u963b\u585e\u3002\u7531\u4e8e Redis \u6267\u884c\u547d\u4ee4\u662f\u5355\u7ebf\u7a0b\u5904\u7406\uff0c\u7136\u540e\u5728\u64cd\u4f5c\u5927 key \u65f6\u4f1a\u6bd4\u8f83\u8017\u65f6\uff0c\u90a3\u4e48\u5c31\u4f1a\u963b\u585e Redis\uff0c\u4ece\u5ba2\u6237\u7aef\u8fd9\u4e00\u89c6\u89d2\u770b\uff0c\u5c31\u662f\u5f88\u4e45\u5f88\u4e45\u90fd\u6ca1\u6709\u54cd\u5e94\u3002</li> <li>\u5f15\u53d1\u7f51\u7edc\u963b\u585e\u3002\u6bcf\u6b21\u83b7\u53d6\u5927 key \u4ea7\u751f\u7684\u7f51\u7edc\u6d41\u91cf\u8f83\u5927\uff0c\u5982\u679c\u4e00\u4e2a key \u7684\u5927\u5c0f\u662f 1 MB\uff0c\u6bcf\u79d2\u8bbf\u95ee\u91cf\u4e3a 1000\uff0c\u90a3\u4e48\u6bcf\u79d2\u4f1a\u4ea7\u751f 1000MB \u7684\u6d41\u91cf\uff0c\u8fd9\u5bf9\u4e8e\u666e\u901a\u5343\u5146\u7f51\u5361\u7684\u670d\u52a1\u5668\u6765\u8bf4\u662f\u707e\u96be\u6027\u7684\u3002</li> <li>\u963b\u585e\u5de5\u4f5c\u7ebf\u7a0b\u3002\u5982\u679c\u4f7f\u7528 del \u5220\u9664\u5927 key \u65f6\uff0c\u4f1a\u963b\u585e\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u8fd9\u6837\u5c31\u6ca1\u529e\u6cd5\u5904\u7406\u540e\u7eed\u7684\u547d\u4ee4\u3002</li> <li>\u5185\u5b58\u5206\u5e03\u4e0d\u5747\u3002\u96c6\u7fa4\u6a21\u578b\u5728 slot \u5206\u7247\u5747\u5300\u60c5\u51b5\u4e0b\uff0c\u4f1a\u51fa\u73b0\u6570\u636e\u548c\u67e5\u8be2\u503e\u659c\u60c5\u51b5\uff0c\u90e8\u5206\u6709\u5927 key \u7684 Redis \u8282\u70b9\u5360\u7528\u5185\u5b58\u591a\uff0cQPS \u4e5f\u4f1a\u6bd4\u8f83\u5927\u3002</li> </ul> <p>\u5982\u4f55\u627e\u5230\u5927 key\uff1f</p> <p>1\u3001redis-cli --bigkeys \u67e5\u627e\u5927 key</p> <p>\u53ef\u4ee5\u901a\u8fc7 redis-cli --bigkeys \u547d\u4ee4\u67e5\u627e\u5927 key\uff1a</p> <p>Bash<pre><code>redis-cli -h 127.0.0.1 -p6379 -a \"password\" --bigkeys\n</code></pre> \u4f7f\u7528\u7684\u65f6\u5019\u6ce8\u610f\u4e8b\u9879\uff1a</p> <ul> <li>\u6700\u597d\u9009\u62e9\u5728\u4ece\u8282\u70b9\u4e0a\u6267\u884c\u8be5\u547d\u4ee4\u3002\u56e0\u4e3a\u4e3b\u8282\u70b9\u4e0a\u6267\u884c\u65f6\uff0c\u4f1a\u963b\u585e\u4e3b\u8282\u70b9\uff1b</li> <li>\u5982\u679c\u6ca1\u6709\u4ece\u8282\u70b9\uff0c\u90a3\u4e48\u53ef\u4ee5\u9009\u62e9\u5728 Redis \u5b9e\u4f8b\u4e1a\u52a1\u538b\u529b\u7684\u4f4e\u5cf0\u9636\u6bb5\u8fdb\u884c\u626b\u63cf\u67e5\u8be2\uff0c\u4ee5\u514d\u5f71\u54cd\u5230\u5b9e\u4f8b\u7684\u6b63\u5e38\u8fd0\u884c\uff1b\u6216\u8005\u53ef\u4ee5\u4f7f\u7528 -i \u53c2\u6570\u63a7\u5236\u626b\u63cf\u95f4\u9694\uff0c\u907f\u514d\u957f\u65f6\u95f4\u626b\u63cf\u964d\u4f4e Redis \u5b9e\u4f8b\u7684\u6027\u80fd\u3002</li> </ul> <p>\u8be5\u65b9\u5f0f\u7684\u4e0d\u8db3\u4e4b\u5904\uff1a</p> <ul> <li>\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u80fd\u8fd4\u56de\u6bcf\u79cd\u7c7b\u578b\u4e2d\u6700\u5927\u7684\u90a3\u4e2a bigkey\uff0c\u65e0\u6cd5\u5f97\u5230\u5927\u5c0f\u6392\u5728\u524d N \u4f4d\u7684 bigkey\uff1b</li> <li>\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u53ea\u7edf\u8ba1\u96c6\u5408\u5143\u7d20\u4e2a\u6570\u7684\u591a\u5c11\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u5360\u7528\u7684\u5185\u5b58\u91cf\u3002\u4f46\u662f\uff0c\u4e00\u4e2a\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\u591a\uff0c\u5e76\u4e0d\u4e00\u5b9a\u5360\u7528\u7684\u5185\u5b58\u5c31\u591a\u3002\u56e0\u4e3a\uff0c\u6709\u53ef\u80fd\u6bcf\u4e2a\u5143\u7d20\u5360\u7528\u7684\u5185\u5b58\u5f88\u5c0f\uff0c\u8fd9\u6837\u7684\u8bdd\uff0c\u5373\u4f7f\u5143\u7d20\u4e2a\u6570\u6709\u5f88\u591a\uff0c\u603b\u5185\u5b58\u5f00\u9500\u4e5f\u4e0d\u5927\uff1b</li> </ul> <p>2\u3001\u4f7f\u7528 SCAN \u547d\u4ee4\u67e5\u627e\u5927 key</p> <p>\u4f7f\u7528 SCAN \u547d\u4ee4\u5bf9\u6570\u636e\u5e93\u626b\u63cf\uff0c\u7136\u540e\u7528 TYPE \u547d\u4ee4\u83b7\u53d6\u8fd4\u56de\u7684\u6bcf\u4e00\u4e2a key \u7684\u7c7b\u578b\u3002</p> <p>\u5bf9\u4e8e String \u7c7b\u578b\uff0c\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528 STRLEN \u547d\u4ee4\u83b7\u53d6\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5b57\u8282\u6570\u3002</p> <p>\u5bf9\u4e8e\u96c6\u5408\u7c7b\u578b\u6765\u8bf4\uff0c\u6709\u4e24\u79cd\u65b9\u6cd5\u53ef\u4ee5\u83b7\u5f97\u5b83\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\uff1a</p> <ul> <li>\u5982\u679c\u80fd\u591f\u9884\u5148\u4ece\u4e1a\u52a1\u5c42\u77e5\u9053\u96c6\u5408\u5143\u7d20\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u90a3\u4e48\uff0c\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u83b7\u53d6\u96c6\u5408\u5143\u7d20\u7684\u4e2a\u6570\uff0c\u7136\u540e\u4e58\u4ee5\u96c6\u5408\u5143\u7d20\u7684\u5e73\u5747\u5927\u5c0f\uff0c\u8fd9\u6837\u5c31\u80fd\u83b7\u5f97\u96c6\u5408\u5360\u7528\u7684\u5185\u5b58\u5927\u5c0f\u4e86\u3002List \u7c7b\u578b\uff1a<code>LLEN</code> \u547d\u4ee4\uff1bHash \u7c7b\u578b\uff1a<code>HLEN</code> \u547d\u4ee4\uff1bSet \u7c7b\u578b\uff1a<code>SCARD</code> \u547d\u4ee4\uff1bSorted Set \u7c7b\u578b\uff1a<code>ZCARD</code> \u547d\u4ee4\uff1b</li> <li>\u5982\u679c\u4e0d\u80fd\u63d0\u524d\u77e5\u9053\u5199\u5165\u96c6\u5408\u7684\u5143\u7d20\u5927\u5c0f\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>MEMORY USAGE</code> \u547d\u4ee4\uff08\u9700\u8981 Redis 4.0 \u53ca\u4ee5\u4e0a\u7248\u672c\uff09\uff0c\u67e5\u8be2\u4e00\u4e2a\u952e\u503c\u5bf9\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u3002</li> </ul> <p>3\u3001\u4f7f\u7528 RdbTools \u5de5\u5177\u67e5\u627e\u5927 key</p> <p>\u4f7f\u7528 RdbTools \u7b2c\u4e09\u65b9\u5f00\u6e90\u5de5\u5177\uff0c\u53ef\u4ee5\u7528\u6765\u89e3\u6790 Redis \u5feb\u7167\uff08RDB\uff09\u6587\u4ef6\uff0c\u627e\u5230\u5176\u4e2d\u7684\u5927 key\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\uff0c\u5c06\u5927\u4e8e 10 kb \u7684 \u00a0key \u00a0\u8f93\u51fa\u5230\u4e00\u4e2a\u8868\u683c\u6587\u4ef6\u3002</p> Bash<pre><code>rdb dump.rdb -c memory --bytes 10240 -f redis.csv\n</code></pre> <p>\u5982\u4f55\u5220\u9664\u5927 key\uff1f</p> <p>\u5220\u9664\u64cd\u4f5c\u7684\u672c\u8d28\u662f\u8981\u91ca\u653e\u952e\u503c\u5bf9\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u4e0d\u8981\u5c0f\u77a7\u5185\u5b58\u7684\u91ca\u653e\u8fc7\u7a0b\u3002</p> <p>\u91ca\u653e\u5185\u5b58\u53ea\u662f\u7b2c\u4e00\u6b65\uff0c\u4e3a\u4e86\u66f4\u52a0\u9ad8\u6548\u5730\u7ba1\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u5728\u5e94\u7528\u7a0b\u5e8f\u91ca\u653e\u5185\u5b58\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u628a\u91ca\u653e\u6389\u7684\u5185\u5b58\u5757\u63d2\u5165\u4e00\u4e2a\u7a7a\u95f2\u5185\u5b58\u5757\u7684\u94fe\u8868\uff0c\u4ee5\u4fbf\u540e\u7eed\u8fdb\u884c\u7ba1\u7406\u548c\u518d\u5206\u914d\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u672c\u8eab\u9700\u8981\u4e00\u5b9a\u65f6\u95f4\uff0c\u800c\u4e14\u4f1a\u963b\u585e\u5f53\u524d\u91ca\u653e\u5185\u5b58\u7684\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u4e00\u4e0b\u5b50\u91ca\u653e\u4e86\u5927\u91cf\u5185\u5b58\uff0c\u7a7a\u95f2\u5185\u5b58\u5757\u94fe\u8868\u64cd\u4f5c\u65f6\u95f4\u5c31\u4f1a\u589e\u52a0\uff0c\u76f8\u5e94\u5730\u5c31\u4f1a\u9020\u6210 Redis \u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\uff0c\u5982\u679c\u4e3b\u7ebf\u7a0b\u53d1\u751f\u4e86\u963b\u585e\uff0c\u5176\u4ed6\u6240\u6709\u8bf7\u6c42\u53ef\u80fd\u90fd\u4f1a\u8d85\u65f6\uff0c\u8d85\u65f6\u8d8a\u6765\u8d8a\u591a\uff0c\u4f1a\u9020\u6210 Redis \u8fde\u63a5\u8017\u5c3d\uff0c\u4ea7\u751f\u5404\u79cd\u5f02\u5e38\u3002</p> <p>\u56e0\u6b64\uff0c\u5220\u9664\u5927 key \u8fd9\u4e00\u4e2a\u52a8\u4f5c\uff0c\u6211\u4eec\u8981\u5c0f\u5fc3\u3002\u5177\u4f53\u8981\u600e\u4e48\u505a\u5462\uff1f\u8fd9\u91cc\u7ed9\u51fa\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <ul> <li>\u5206\u6279\u6b21\u5220\u9664</li> <li>\u5f02\u6b65\u5220\u9664\uff08Redis 4.0 \u7248\u672c\u4ee5\u4e0a\uff09</li> </ul> <p>1\u3001\u5206\u6279\u6b21\u5220\u9664</p> <p>\u5bf9\u4e8e\u5220\u9664\u5927 Hash\uff0c\u4f7f\u7528 <code>hscan</code> \u547d\u4ee4\uff0c\u6bcf\u6b21\u83b7\u53d6 100 \u4e2a\u5b57\u6bb5\uff0c\u518d\u7528 <code>hdel</code> \u547d\u4ee4\uff0c\u6bcf\u6b21\u5220\u9664 1 \u4e2a\u5b57\u6bb5\u3002</p> <p>Python \u4ee3\u7801\uff1a</p> Python<pre><code>def del_large_hash():\n  r = redis.StrictRedis(host='redis-host1', port=6379)\n    large_hash_key =\"xxx\" #\u8981\u5220\u9664\u7684\u5927 hash \u952e\u540d\n    cursor = '0'\n    while cursor != 0:\n        # \u4f7f\u7528 hscan \u547d\u4ee4\uff0c\u6bcf\u6b21\u83b7\u53d6 100 \u4e2a\u5b57\u6bb5\n        cursor, data = r.hscan(large_hash_key, cursor=cursor, count=100)\n        for item in data.items():\n                # \u518d\u7528 hdel \u547d\u4ee4\uff0c\u6bcf\u6b21\u5220\u9664 1 \u4e2a\u5b57\u6bb5\n                r.hdel(large_hash_key, item[0])\n</code></pre> <p>\u5bf9\u4e8e\u5220\u9664\u5927 List\uff0c\u901a\u8fc7 <code>ltrim</code> \u547d\u4ee4\uff0c\u6bcf\u6b21\u5220\u9664\u5c11\u91cf\u5143\u7d20\u3002</p> <p>Python \u4ee3\u7801\uff1a</p> Python<pre><code>def del_large_list():\n  r = redis.StrictRedis(host='redis-host1', port=6379)\n  large_list_key = 'xxx'  #\u8981\u5220\u9664\u7684\u5927 list \u7684\u952e\u540d\n  while r.llen(large_list_key)&gt;0:\n      #\u6bcf\u6b21\u53ea\u5220\u9664\u6700\u53f3 100 \u4e2a\u5143\u7d20\n      r.ltrim(large_list_key, 0, -101) \n</code></pre> <p>\u5bf9\u4e8e\u5220\u9664\u5927 Set\uff0c\u4f7f\u7528 <code>sscan</code> \u547d\u4ee4\uff0c\u6bcf\u6b21\u626b\u63cf\u96c6\u5408\u4e2d 100 \u4e2a\u5143\u7d20\uff0c\u518d\u7528 <code>srem</code> \u547d\u4ee4\u6bcf\u6b21\u5220\u9664\u4e00\u4e2a\u952e\u3002</p> <p>Python \u4ee3\u7801\uff1a</p> Python<pre><code>def del_large_set():\n  r = redis.StrictRedis(host='redis-host1', port=6379)\n  large_set_key = 'xxx'   # \u8981\u5220\u9664\u7684\u5927 set \u7684\u952e\u540d\n  cursor = '0'\n  while cursor != 0:\n    # \u4f7f\u7528 sscan \u547d\u4ee4\uff0c\u6bcf\u6b21\u626b\u63cf\u96c6\u5408\u4e2d 100 \u4e2a\u5143\u7d20\n    cursor, data = r.sscan(large_set_key, cursor=cursor, count=100)\n    for item in data:\n      # \u518d\u7528 srem \u547d\u4ee4\u6bcf\u6b21\u5220\u9664\u4e00\u4e2a\u952e\n      r.srem(large_size_key, item)\n</code></pre> <p>\u5bf9\u4e8e\u5220\u9664\u5927 ZSet\uff0c\u4f7f\u7528 <code>zremrangebyrank</code> \u547d\u4ee4\uff0c\u6bcf\u6b21\u5220\u9664 top 100 \u4e2a\u5143\u7d20\u3002</p> <p>Python \u4ee3\u7801\uff1a</p> Python<pre><code>def del_large_sortedset():\n  r = redis.StrictRedis(host='large_sortedset_key', port=6379)\n  large_sortedset_key='xxx'\n  while r.zcard(large_sortedset_key)&gt;0:\n    # \u4f7f\u7528 zremrangebyrank \u547d\u4ee4\uff0c\u6bcf\u6b21\u5220\u9664 top 100 \u4e2a\u5143\u7d20\n    r.zremrangebyrank(large_sortedset_key,0,99) \n</code></pre> <p>2\u3001\u5f02\u6b65\u5220\u9664</p> <p>\u4ece Redis 4.0 \u7248\u672c\u5f00\u59cb\uff0c\u53ef\u4ee5\u91c7\u7528\u5f02\u6b65\u5220\u9664\u6cd5\uff0c\u7528 unlink \u547d\u4ee4\u4ee3\u66ff del \u6765\u5220\u9664\u3002</p> <p>\u8fd9\u6837 Redis \u4f1a\u5c06\u8fd9\u4e2a key \u653e\u5165\u5230\u4e00\u4e2a\u5f02\u6b65\u7ebf\u7a0b\u4e2d\u8fdb\u884c\u5220\u9664\uff0c\u8fd9\u6837\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002</p> <p>\u9664\u4e86\u4e3b\u52a8\u8c03\u7528 unlink \u547d\u4ee4\u5b9e\u73b0\u5f02\u6b65\u5220\u9664\u4e4b\u5916\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u53c2\u6570\uff0c\u8fbe\u5230\u67d0\u4e9b\u6761\u4ef6\u7684\u65f6\u5019\u81ea\u52a8\u8fdb\u884c\u5f02\u6b65\u5220\u9664\u3002</p> <p>\u4e3b\u8981\u6709 4 \u79cd\u573a\u666f\uff0c\u9ed8\u8ba4\u90fd\u662f\u5173\u95ed\u7684\uff1a</p> Text Only<pre><code>lazyfree-lazy-eviction no\nlazyfree-lazy-expire no\nlazyfree-lazy-server-del\nnoslave-lazy-flush no\n</code></pre> <p>\u5b83\u4eec\u4ee3\u8868\u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <ul> <li> <p>lazyfree-lazy-eviction\uff1a\u8868\u793a\u5f53 Redis \u8fd0\u884c\u5185\u5b58\u8d85\u8fc7 maxmeory \u65f6\uff0c\u662f\u5426\u5f00\u542f lazy free \u673a\u5236\u5220\u9664\uff1b</p> </li> <li> <p>lazyfree-lazy-expire\uff1a\u8868\u793a\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\uff0c\u5f53\u8fc7\u671f\u4e4b\u540e\u662f\u5426\u5f00\u542f lazy free \u673a\u5236\u5220\u9664\uff1b</p> </li> <li> <p>lazyfree-lazy-server-del\uff1a\u6709\u4e9b\u6307\u4ee4\u5728\u5904\u7406\u5df2\u5b58\u5728\u7684\u952e\u65f6\uff0c\u4f1a\u5e26\u6709\u4e00\u4e2a\u9690\u5f0f\u7684 del \u952e\u7684\u64cd\u4f5c\uff0c\u6bd4\u5982 rename \u547d\u4ee4\uff0c\u5f53\u76ee\u6807\u952e\u5df2\u5b58\u5728\uff0cRedis \u4f1a\u5148\u5220\u9664\u76ee\u6807\u952e\uff0c\u5982\u679c\u8fd9\u4e9b\u76ee\u6807\u952e\u662f\u4e00\u4e2a big key\uff0c\u5c31\u4f1a\u9020\u6210\u963b\u585e\u5220\u9664\u7684\u95ee\u9898\uff0c\u6b64\u914d\u7f6e\u8868\u793a\u5728\u8fd9\u79cd\u573a\u666f\u4e2d\u662f\u5426\u5f00\u542f lazy free \u673a\u5236\u5220\u9664\uff1b</p> </li> <li> <p>slave-lazy-flush\uff1a\u9488\u5bf9 slave (\u4ece\u8282\u70b9) \u8fdb\u884c\u5168\u91cf\u6570\u636e\u540c\u6b65\uff0cslave \u5728\u52a0\u8f7d master \u7684 RDB \u6587\u4ef6\u524d\uff0c\u4f1a\u8fd0\u884c flushall \u6765\u6e05\u7406\u81ea\u5df1\u7684\u6570\u636e\uff0c\u5b83\u8868\u793a\u6b64\u65f6\u662f\u5426\u5f00\u542f lazy free \u673a\u5236\u5220\u9664\u3002</p> </li> </ul> <p>\u5efa\u8bae\u5f00\u542f\u5176\u4e2d\u7684 lazyfree-lazy-eviction\u3001lazyfree-lazy-expire\u3001lazyfree-lazy-server-del \u7b49\u914d\u7f6e\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u6709\u6548\u7684\u63d0\u9ad8\u4e3b\u7ebf\u7a0b\u7684\u6267\u884c\u6548\u7387\u3002</p>"},{"location":"redis/base/redis_interview/#redis_23","title":"Redis \u7ba1\u9053\u6709\u4ec0\u4e48\u7528\uff1f","text":"<p>\u7ba1\u9053\u6280\u672f\uff08Pipeline\uff09\u662f\u5ba2\u6237\u7aef\u63d0\u4f9b\u7684\u4e00\u79cd\u6279\u5904\u7406\u6280\u672f\uff0c\u7528\u4e8e\u4e00\u6b21\u5904\u7406\u591a\u4e2a Redis \u547d\u4ee4\uff0c\u4ece\u800c\u63d0\u9ad8\u6574\u4e2a\u4ea4\u4e92\u7684\u6027\u80fd\u3002</p> <p>\u666e\u901a\u547d\u4ee4\u6a21\u5f0f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7ba1\u9053\u6a21\u5f0f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4f7f\u7528\u7ba1\u9053\u6280\u672f\u53ef\u4ee5\u89e3\u51b3\u591a\u4e2a\u547d\u4ee4\u6267\u884c\u65f6\u7684\u7f51\u7edc\u7b49\u5f85\uff0c\u5b83\u662f\u628a\u591a\u4e2a\u547d\u4ee4\u6574\u5408\u5230\u4e00\u8d77\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u7aef\u5904\u7406\u4e4b\u540e\u7edf\u4e00\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u8fd9\u6837\u5c31\u514d\u53bb\u4e86\u6bcf\u6761\u547d\u4ee4\u6267\u884c\u540e\u90fd\u8981\u7b49\u5f85\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u6709\u6548\u5730\u63d0\u9ad8\u4e86\u7a0b\u5e8f\u7684\u6267\u884c\u6548\u7387\u3002</p> <p>\u4f46\u4f7f\u7528\u7ba1\u9053\u6280\u672f\u4e5f\u8981\u6ce8\u610f\u907f\u514d\u53d1\u9001\u7684\u547d\u4ee4\u8fc7\u5927\uff0c\u6216\u7ba1\u9053\u5185\u7684\u6570\u636e\u592a\u591a\u800c\u5bfc\u81f4\u7684\u7f51\u7edc\u963b\u585e\u3002</p> <p>\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7ba1\u9053\u6280\u672f\u672c\u8d28\u4e0a\u662f\u5ba2\u6237\u7aef\u63d0\u4f9b\u7684\u529f\u80fd\uff0c\u800c\u975e Redis \u670d\u52a1\u5668\u7aef\u7684\u529f\u80fd\u3002</p>"},{"location":"redis/base/redis_interview/#redis_24","title":"Redis \u4e8b\u52a1\u652f\u6301\u56de\u6eda\u5417\uff1f","text":"<p>MySQL \u5728\u6267\u884c\u4e8b\u52a1\u65f6\uff0c\u4f1a\u63d0\u4f9b\u56de\u6eda\u673a\u5236\uff0c\u5f53\u4e8b\u52a1\u6267\u884c\u53d1\u751f\u9519\u8bef\u65f6\uff0c\u4e8b\u52a1\u4e2d\u7684\u6240\u6709\u64cd\u4f5c\u90fd\u4f1a\u64a4\u9500\uff0c\u5df2\u7ecf\u4fee\u6539\u7684\u6570\u636e\u4e5f\u4f1a\u88ab\u6062\u590d\u5230\u4e8b\u52a1\u6267\u884c\u524d\u7684\u72b6\u6001\u3002</p> <p>Redis \u4e2d\u5e76\u6ca1\u6709\u63d0\u4f9b\u56de\u6eda\u673a\u5236\uff0c\u867d\u7136 Redis \u63d0\u4f9b\u4e86 DISCARD \u547d\u4ee4\uff0c\u4f46\u662f\u8fd9\u4e2a\u547d\u4ee4\u53ea\u80fd\u7528\u6765\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1\u6267\u884c\uff0c\u628a\u6682\u5b58\u7684\u547d\u4ee4\u961f\u5217\u6e05\u7a7a\uff0c\u8d77\u4e0d\u5230\u56de\u6eda\u7684\u6548\u679c\u3002</p> <p>\u4e0b\u9762\u662f DISCARD \u547d\u4ee4\u7528\u6cd5\uff1a</p> <p>C<pre><code>#\u8bfb\u53d6 count \u7684\u503c4\n127.0.0.1:6379&gt; GET count\n\"1\"\n#\u5f00\u542f\u4e8b\u52a1\n127.0.0.1:6379&gt; MULTI \nOK\n#\u53d1\u9001\u4e8b\u52a1\u7684\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5bf9count\u51cf1\n127.0.0.1:6379&gt; DECR count\nQUEUED\n#\u6267\u884cDISCARD\u547d\u4ee4\uff0c\u4e3b\u52a8\u653e\u5f03\u4e8b\u52a1\n127.0.0.1:6379&gt; DISCARD\nOK\n#\u518d\u6b21\u8bfb\u53d6a:stock\u7684\u503c\uff0c\u503c\u6ca1\u6709\u88ab\u4fee\u6539\n127.0.0.1:6379&gt; GET count\n\"1\"\n</code></pre> \u4e8b\u52a1\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u547d\u4ee4\u5165\u961f\u65f6\u6ca1\u62a5\u9519\uff0c\u800c\u4e8b\u52a1\u63d0\u4ea4\u540e\uff0c\u5b9e\u9645\u6267\u884c\u65f6\u62a5\u9519\u4e86\uff0c\u6b63\u786e\u7684\u547d\u4ee4\u4f9d\u7136\u53ef\u4ee5\u6b63\u5e38\u6267\u884c\uff0c\u6240\u4ee5\u8fd9\u53ef\u4ee5\u770b\u51fa Redis \u5e76\u4e0d\u4e00\u5b9a\u4fdd\u8bc1\u539f\u5b50\u6027\uff08\u539f\u5b50\u6027\uff1a\u4e8b\u52a1\u4e2d\u7684\u547d\u4ee4\u8981\u4e0d\u5168\u90e8\u6210\u529f\uff0c\u8981\u4e0d\u5168\u90e8\u5931\u8d25\uff09\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e2a\u4f8b\u5b50\uff1a</p> C<pre><code>#\u83b7\u53d6name\u539f\u672c\u7684\u503c\n127.0.0.1:6379&gt; GET name\n\"xiaolin\"\n#\u5f00\u542f\u4e8b\u52a1\n127.0.0.1:6379&gt; MULTI\nOK\n#\u8bbe\u7f6e\u65b0\u503c\n127.0.0.1:6379(TX)&gt; SET name xialincoding\nQUEUED\n#\u6ce8\u610f\uff0c\u8fd9\u6761\u547d\u4ee4\u662f\u9519\u8bef\u7684\n# expire \u8fc7\u671f\u65f6\u95f4\u6b63\u786e\u6765\u8bf4\u662f\u6570\u5b57\uff0c\u5e76\u4e0d\u662f\u201810s\u2019\u5b57\u7b26\u4e32\uff0c\u4f46\u662f\u8fd8\u662f\u5165\u961f\u6210\u529f\u4e86\n127.0.0.1:6379(TX)&gt; EXPIRE name 10s\nQUEUED\n#\u63d0\u4ea4\u4e8b\u52a1\uff0c\u6267\u884c\u62a5\u9519\n#\u53ef\u4ee5\u770b\u5230 set \u6267\u884c\u6210\u529f\uff0c\u800c expire \u6267\u884c\u9519\u8bef\u3002\n127.0.0.1:6379(TX)&gt; EXEC\n1) OK\n2) (error) ERR value is not an integer or out of range\n#\u53ef\u4ee5\u770b\u5230\uff0cname \u8fd8\u662f\u88ab\u8bbe\u7f6e\u4e3a\u65b0\u503c\u4e86\n127.0.0.1:6379&gt; GET name\n\"xialincoding\"\n</code></pre> <p>\u4e3a\u4ec0\u4e48 Redis \u4e0d\u652f\u6301\u4e8b\u52a1\u56de\u6eda\uff1f</p> <p>Redis \u5b98\u65b9\u6587\u6863\u7684\u89e3\u91ca\u5982\u4e0b\uff1a</p> <p></p> <p>\u5927\u6982\u7684\u610f\u601d\u662f\uff0c\u4f5c\u8005\u4e0d\u652f\u6301\u4e8b\u52a1\u56de\u6eda\u7684\u539f\u56e0\u6709\u4ee5\u4e0b\u4e24\u4e2a\uff1a</p> <ul> <li>\u4ed6\u8ba4\u4e3a Redis \u4e8b\u52a1\u7684\u6267\u884c\u65f6\uff0c\u9519\u8bef\u901a\u5e38\u90fd\u662f\u7f16\u7a0b\u9519\u8bef\u9020\u6210\u7684\uff0c\u8fd9\u79cd\u9519\u8bef\u901a\u5e38\u53ea\u4f1a\u51fa\u73b0\u5728\u5f00\u53d1\u73af\u5883\u4e2d\uff0c\u800c\u5f88\u5c11\u4f1a\u5728\u5b9e\u9645\u7684\u751f\u4ea7\u73af\u5883\u4e2d\u51fa\u73b0\uff0c\u6240\u4ee5\u4ed6\u8ba4\u4e3a\u6ca1\u6709\u5fc5\u8981\u4e3a Redis \u5f00\u53d1\u4e8b\u52a1\u56de\u6eda\u529f\u80fd\uff1b</li> <li>\u4e0d\u652f\u6301\u4e8b\u52a1\u56de\u6eda\u662f\u56e0\u4e3a\u8fd9\u79cd\u590d\u6742\u7684\u529f\u80fd\u548c Redis \u8ffd\u6c42\u7684\u7b80\u5355\u9ad8\u6548\u7684\u8bbe\u8ba1\u4e3b\u65e8\u4e0d\u7b26\u5408\u3002</li> </ul> <p>\u8fd9\u91cc\u4e0d\u652f\u6301\u4e8b\u52a1\u56de\u6eda\uff0c\u6307\u7684\u662f\u4e0d\u652f\u6301\u4e8b\u52a1\u8fd0\u884c\u65f6\u9519\u8bef\u7684\u4e8b\u52a1\u56de\u6eda\u3002</p>"},{"location":"redis/base/redis_interview/#redis_25","title":"\u5982\u4f55\u7528 Redis \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7684\uff1f","text":"<p>\u5206\u5e03\u5f0f\u9501\u662f\u7528\u4e8e\u5206\u5e03\u5f0f\u73af\u5883\u4e0b\u5e76\u53d1\u63a7\u5236\u7684\u4e00\u79cd\u673a\u5236\uff0c\u7528\u4e8e\u63a7\u5236\u67d0\u4e2a\u8d44\u6e90\u5728\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u88ab\u4e00\u4e2a\u5e94\u7528\u6240\u4f7f\u7528\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>Redis \u672c\u8eab\u53ef\u4ee5\u88ab\u591a\u4e2a\u5ba2\u6237\u7aef\u5171\u4eab\u8bbf\u95ee\uff0c\u6b63\u597d\u5c31\u662f\u4e00\u4e2a\u5171\u4eab\u5b58\u50a8\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7528\u6765\u4fdd\u5b58\u5206\u5e03\u5f0f\u9501\uff0c\u800c\u4e14 Redis \u7684\u8bfb\u5199\u6027\u80fd\u9ad8\uff0c\u53ef\u4ee5\u5e94\u5bf9\u9ad8\u5e76\u53d1\u7684\u9501\u64cd\u4f5c\u573a\u666f\u3002</p> <p>Redis \u7684 SET \u547d\u4ee4\u6709\u4e2a NX \u53c2\u6570\u53ef\u4ee5\u5b9e\u73b0\u300ckey \u4e0d\u5b58\u5728\u624d\u63d2\u5165\u300d\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u5b83\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff1a</p> <ul> <li>\u5982\u679c key \u4e0d\u5b58\u5728\uff0c\u5219\u663e\u793a\u63d2\u5165\u6210\u529f\uff0c\u53ef\u4ee5\u7528\u6765\u8868\u793a\u52a0\u9501\u6210\u529f\uff1b</li> <li>\u5982\u679c key \u5b58\u5728\uff0c\u5219\u4f1a\u663e\u793a\u63d2\u5165\u5931\u8d25\uff0c\u53ef\u4ee5\u7528\u6765\u8868\u793a\u52a0\u9501\u5931\u8d25\u3002</li> </ul> <p>\u57fa\u4e8e Redis \u8282\u70b9\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u65f6\uff0c\u5bf9\u4e8e\u52a0\u9501\u64cd\u4f5c\uff0c\u6211\u4eec\u9700\u8981\u6ee1\u8db3\u4e09\u4e2a\u6761\u4ef6\u3002</p> <ul> <li>\u52a0\u9501\u5305\u62ec\u4e86\u8bfb\u53d6\u9501\u53d8\u91cf\u3001\u68c0\u67e5\u9501\u53d8\u91cf\u503c\u548c\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c\u4e09\u4e2a\u64cd\u4f5c\uff0c\u4f46\u9700\u8981\u4ee5\u539f\u5b50\u64cd\u4f5c\u7684\u65b9\u5f0f\u5b8c\u6210\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u5e26\u4e0a NX \u9009\u9879\u6765\u5b9e\u73b0\u52a0\u9501\uff1b</li> <li>\u9501\u53d8\u91cf\u9700\u8981\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u514d\u5ba2\u6237\u7aef\u62ff\u5230\u9501\u540e\u53d1\u751f\u5f02\u5e38\uff0c\u5bfc\u81f4\u9501\u4e00\u76f4\u65e0\u6cd5\u91ca\u653e\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5728 SET \u547d\u4ee4\u6267\u884c\u65f6\u52a0\u4e0a EX/PX \u9009\u9879\uff0c\u8bbe\u7f6e\u5176\u8fc7\u671f\u65f6\u95f4\uff1b</li> <li>\u9501\u53d8\u91cf\u7684\u503c\u9700\u8981\u80fd\u533a\u5206\u6765\u81ea\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u52a0\u9501\u64cd\u4f5c\uff0c\u4ee5\u514d\u5728\u91ca\u653e\u9501\u65f6\uff0c\u51fa\u73b0\u8bef\u91ca\u653e\u64cd\u4f5c\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u4f7f\u7528 SET \u547d\u4ee4\u8bbe\u7f6e\u9501\u53d8\u91cf\u503c\u65f6\uff0c\u6bcf\u4e2a\u5ba2\u6237\u7aef\u8bbe\u7f6e\u7684\u503c\u662f\u4e00\u4e2a\u552f\u4e00\u503c\uff0c\u7528\u4e8e\u6807\u8bc6\u5ba2\u6237\u7aef\uff1b</li> </ul> <p>\u6ee1\u8db3\u8fd9\u4e09\u4e2a\u6761\u4ef6\u7684\u5206\u5e03\u5f0f\u547d\u4ee4\u5982\u4e0b\uff1a C<pre><code>SET lock_key unique_value NX PX 10000 \n</code></pre></p> <ul> <li>lock_key \u5c31\u662f key \u952e\uff1b</li> <li>unique_value \u662f\u5ba2\u6237\u7aef\u751f\u6210\u7684\u552f\u4e00\u7684\u6807\u8bc6\uff0c\u533a\u5206\u6765\u81ea\u4e0d\u540c\u5ba2\u6237\u7aef\u7684\u9501\u64cd\u4f5c\uff1b</li> <li>NX \u4ee3\u8868\u53ea\u5728 lock_key \u4e0d\u5b58\u5728\u65f6\uff0c\u624d\u5bf9 lock_key \u8fdb\u884c\u8bbe\u7f6e\u64cd\u4f5c\uff1b</li> <li>PX 10000 \u8868\u793a\u8bbe\u7f6e lock_key \u7684\u8fc7\u671f\u65f6\u95f4\u4e3a 10s\uff0c\u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u5ba2\u6237\u7aef\u53d1\u751f\u5f02\u5e38\u800c\u65e0\u6cd5\u91ca\u653e\u9501\u3002</li> </ul> <p>\u800c\u89e3\u9501\u7684\u8fc7\u7a0b\u5c31\u662f\u5c06 lock_key \u952e\u5220\u9664\uff08del lock_key\uff09\uff0c\u4f46\u4e0d\u80fd\u4e71\u5220\uff0c\u8981\u4fdd\u8bc1\u6267\u884c\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef\u5c31\u662f\u52a0\u9501\u7684\u5ba2\u6237\u7aef\u3002\u6240\u4ee5\uff0c\u89e3\u9501\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8981\u5148\u5224\u65ad\u9501\u7684 unique_value \u662f\u5426\u4e3a\u52a0\u9501\u5ba2\u6237\u7aef\uff0c\u662f\u7684\u8bdd\uff0c\u624d\u5c06 lock_key \u952e\u5220\u9664\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u89e3\u9501\u662f\u6709\u4e24\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u65f6\u5c31\u9700\u8981 Lua \u811a\u672c\u6765\u4fdd\u8bc1\u89e3\u9501\u7684\u539f\u5b50\u6027\uff0c\u56e0\u4e3a Redis \u5728\u6267\u884c Lua \u811a\u672c\u65f6\uff0c\u53ef\u4ee5\u4ee5\u539f\u5b50\u6027\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u4fdd\u8bc1\u4e86\u9501\u91ca\u653e\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002</p> <p>C<pre><code>// \u91ca\u653e\u9501\u65f6\uff0c\u5148\u6bd4\u8f83 unique_value \u662f\u5426\u76f8\u7b49\uff0c\u907f\u514d\u9501\u7684\u8bef\u91ca\u653e\nif redis.call(\"get\",KEYS[1]) == ARGV[1] then\n    return redis.call(\"del\",KEYS[1])\nelse\n    return 0\nend\n</code></pre> \u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u901a\u8fc7\u4f7f\u7528 SET \u547d\u4ee4\u548c Lua \u811a\u672c\u5728 Redis \u5355\u8282\u70b9\u4e0a\u5b8c\u6210\u4e86\u5206\u5e03\u5f0f\u9501\u7684\u52a0\u9501\u548c\u89e3\u9501\u3002</p> <p>\u57fa\u4e8e Redis \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u6709\u4ec0\u4e48\u4f18\u7f3a\u70b9\uff1f</p> <p>\u57fa\u4e8e Redis \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7684\u4f18\u70b9\uff1a</p> <ol> <li>\u6027\u80fd\u9ad8\u6548\uff08\u8fd9\u662f\u9009\u62e9\u7f13\u5b58\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u6700\u6838\u5fc3\u7684\u51fa\u53d1\u70b9\uff09\u3002</li> <li>\u5b9e\u73b0\u65b9\u4fbf\u3002\u5f88\u591a\u7814\u53d1\u5de5\u7a0b\u5e08\u9009\u62e9\u4f7f\u7528 Redis \u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff0c\u5f88\u5927\u6210\u5206\u4e0a\u662f\u56e0\u4e3a Redis \u63d0\u4f9b\u4e86 setnx \u65b9\u6cd5\uff0c\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u5f88\u65b9\u4fbf\u3002</li> <li>\u907f\u514d\u5355\u70b9\u6545\u969c\uff08\u56e0\u4e3a Redis \u662f\u8de8\u96c6\u7fa4\u90e8\u7f72\u7684\uff0c\u81ea\u7136\u5c31\u907f\u514d\u4e86\u5355\u70b9\u6545\u969c\uff09\u3002</li> </ol> <p>\u57fa\u4e8e Redis \u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u8d85\u65f6\u65f6\u95f4\u4e0d\u597d\u8bbe\u7f6e\u3002\u5982\u679c\u9501\u7684\u8d85\u65f6\u65f6\u95f4\u8bbe\u7f6e\u8fc7\u957f\uff0c\u4f1a\u5f71\u54cd\u6027\u80fd\uff0c\u5982\u679c\u8bbe\u7f6e\u7684\u8d85\u65f6\u65f6\u95f4\u8fc7\u77ed\u4f1a\u4fdd\u62a4\u4e0d\u5230\u5171\u4eab\u8d44\u6e90\u3002\u6bd4\u5982\u5728\u6709\u4e9b\u573a\u666f\u4e2d\uff0c\u4e00\u4e2a\u7ebf\u7a0b A \u83b7\u53d6\u5230\u4e86\u9501\u4e4b\u540e\uff0c\u7531\u4e8e\u4e1a\u52a1\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u53ef\u80fd\u6bd4\u8f83\u957f\uff0c\u5bfc\u81f4\u8d85\u8fc7\u4e86\u9501\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u81ea\u52a8\u5931\u6548\uff0c\u6ce8\u610f A \u7ebf\u7a0b\u6ca1\u6267\u884c\u5b8c\uff0c\u540e\u7eed\u7ebf\u7a0b B \u53c8\u610f\u5916\u7684\u6301\u6709\u4e86\u9501\uff0c\u610f\u5473\u7740\u53ef\u4ee5\u64cd\u4f5c\u5171\u4eab\u8d44\u6e90\uff0c\u90a3\u4e48\u4e24\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u7684\u5171\u4eab\u8d44\u6e90\u5c31\u6ca1\u529e\u6cd5\u8fdb\u884c\u4fdd\u62a4\u4e86\u3002</li> <li>\u90a3\u4e48\u5982\u4f55\u5408\u7406\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\u5462\uff1f \u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e\u7eed\u7ea6\u7684\u65b9\u5f0f\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff1a\u5148\u7ed9\u9501\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4\uff0c\u7136\u540e\u542f\u52a8\u4e00\u4e2a\u5b88\u62a4\u7ebf\u7a0b\uff0c\u8ba9\u5b88\u62a4\u7ebf\u7a0b\u5728\u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u91cd\u65b0\u8bbe\u7f6e\u8fd9\u4e2a\u9501\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u5b9e\u73b0\u65b9\u5f0f\u5c31\u662f\uff1a\u5199\u4e00\u4e2a\u5b88\u62a4\u7ebf\u7a0b\uff0c\u7136\u540e\u53bb\u5224\u65ad\u9501\u7684\u60c5\u51b5\uff0c\u5f53\u9501\u5feb\u5931\u6548\u7684\u65f6\u5019\uff0c\u518d\u6b21\u8fdb\u884c\u7eed\u7ea6\u52a0\u9501\uff0c\u5f53\u4e3b\u7ebf\u7a0b\u6267\u884c\u5b8c\u6210\u540e\uff0c\u9500\u6bc1\u7eed\u7ea6\u9501\u5373\u53ef\uff0c\u4e0d\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u5b9e\u73b0\u8d77\u6765\u76f8\u5bf9\u590d\u6742\u3002</li> <li>Redis \u4e3b\u4ece\u590d\u5236\u6a21\u5f0f\u4e2d\u7684\u6570\u636e\u662f\u5f02\u6b65\u590d\u5236\u7684\uff0c\u8fd9\u6837\u5bfc\u81f4\u5206\u5e03\u5f0f\u9501\u7684\u4e0d\u53ef\u9760\u6027\u3002\u5982\u679c\u5728 Redis \u4e3b\u8282\u70b9\u83b7\u53d6\u5230\u9501\u540e\uff0c\u5728\u6ca1\u6709\u540c\u6b65\u5230\u5176\u4ed6\u8282\u70b9\u65f6\uff0cRedis \u4e3b\u8282\u70b9\u5b95\u673a\u4e86\uff0c\u6b64\u65f6\u65b0\u7684 Redis \u4e3b\u8282\u70b9\u4f9d\u7136\u53ef\u4ee5\u83b7\u53d6\u9501\uff0c\u6240\u4ee5\u591a\u4e2a\u5e94\u7528\u670d\u52a1\u5c31\u53ef\u4ee5\u540c\u65f6\u83b7\u53d6\u5230\u9501\u3002 <p>Redis \u5982\u4f55\u89e3\u51b3\u96c6\u7fa4\u60c5\u51b5\u4e0b\u5206\u5e03\u5f0f\u9501\u7684\u53ef\u9760\u6027\uff1f</p> </li> </ul> <p>\u4e3a\u4e86\u4fdd\u8bc1\u96c6\u7fa4\u73af\u5883\u4e0b\u5206\u5e03\u5f0f\u9501\u7684\u53ef\u9760\u6027\uff0cRedis \u5b98\u65b9\u5df2\u7ecf\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u5206\u5e03\u5f0f\u9501\u7b97\u6cd5 Redlock\uff08\u7ea2\u9501\uff09\u3002</p> <p>\u5b83\u662f\u57fa\u4e8e\u591a\u4e2a Redis \u8282\u70b9\u7684\u5206\u5e03\u5f0f\u9501\uff0c\u5373\u4f7f\u6709\u8282\u70b9\u53d1\u751f\u4e86\u6545\u969c\uff0c\u9501\u53d8\u91cf\u4ecd\u7136\u662f\u5b58\u5728\u7684\uff0c\u5ba2\u6237\u7aef\u8fd8\u662f\u53ef\u4ee5\u5b8c\u6210\u9501\u64cd\u4f5c\u3002\u5b98\u65b9\u63a8\u8350\u662f\u81f3\u5c11\u90e8\u7f72  5 \u4e2a Redis \u8282\u70b9\uff0c\u800c\u4e14\u90fd\u662f\u4e3b\u8282\u70b9\uff0c\u5b83\u4eec\u4e4b\u95f4\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\uff0c\u90fd\u662f\u4e00\u4e2a\u4e2a\u5b64\u7acb\u7684\u8282\u70b9\u3002</p> <p>Redlock \u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\uff0c\u662f\u8ba9\u5ba2\u6237\u7aef\u548c\u591a\u4e2a\u72ec\u7acb\u7684 Redis \u8282\u70b9\u4f9d\u6b21\u8bf7\u6c42\u7533\u8bf7\u52a0\u9501\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u80fd\u591f\u548c\u534a\u6570\u4ee5\u4e0a\u7684\u8282\u70b9\u6210\u529f\u5730\u5b8c\u6210\u52a0\u9501\u64cd\u4f5c\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u8ba4\u4e3a\uff0c\u5ba2\u6237\u7aef\u6210\u529f\u5730\u83b7\u5f97\u5206\u5e03\u5f0f\u9501\uff0c\u5426\u5219\u52a0\u9501\u5931\u8d25\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u6709\u67d0\u4e2a Redis \u8282\u70b9\u53d1\u751f\u6545\u969c\uff0c\u56e0\u4e3a\u9501\u7684\u6570\u636e\u5728\u5176\u4ed6\u8282\u70b9\u4e0a\u4e5f\u6709\u4fdd\u5b58\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u4ecd\u7136\u53ef\u4ee5\u6b63\u5e38\u5730\u8fdb\u884c\u9501\u64cd\u4f5c\uff0c\u9501\u7684\u6570\u636e\u4e5f\u4e0d\u4f1a\u4e22\u5931\u3002</p> <p>Redlock \u7b97\u6cd5\u52a0\u9501\u4e09\u4e2a\u8fc7\u7a0b\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\u662f\uff0c\u5ba2\u6237\u7aef\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\uff08t1\uff09\u3002</li> <li>\u7b2c\u4e8c\u6b65\u662f\uff0c\u5ba2\u6237\u7aef\u6309\u987a\u5e8f\u4f9d\u6b21\u5411 N \u4e2a Redis \u8282\u70b9\u6267\u884c\u52a0\u9501\u64cd\u4f5c\uff1a</li> <li>\u52a0\u9501\u64cd\u4f5c\u4f7f\u7528 SET \u547d\u4ee4\uff0c\u5e26\u4e0a NX\uff0cEX/PX \u9009\u9879\uff0c\u4ee5\u53ca\u5e26\u4e0a\u5ba2\u6237\u7aef\u7684\u552f\u4e00\u6807\u8bc6\u3002</li> <li>\u5982\u679c\u67d0\u4e2a Redis \u8282\u70b9\u53d1\u751f\u6545\u969c\u4e86\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0cRedlock \u7b97\u6cd5\u80fd\u591f\u7ee7\u7eed\u8fd0\u884c\uff0c\u6211\u4eec\u9700\u8981\u7ed9\u300c\u52a0\u9501\u64cd\u4f5c\u300d\u8bbe\u7f6e\u4e00\u4e2a\u8d85\u65f6\u65f6\u95f4\uff08\u4e0d\u662f\u5bf9\u300c\u9501\u300d\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u800c\u662f\u5bf9\u300c\u52a0\u9501\u64cd\u4f5c\u300d\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff09\uff0c\u52a0\u9501\u64cd\u4f5c\u7684\u8d85\u65f6\u65f6\u95f4\u9700\u8981\u8fdc\u8fdc\u5730\u5c0f\u4e8e\u9501\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4e00\u822c\u4e5f\u5c31\u662f\u8bbe\u7f6e\u4e3a\u51e0\u5341\u6beb\u79d2\u3002</li> <li>\u7b2c\u4e09\u6b65\u662f\uff0c\u4e00\u65e6\u5ba2\u6237\u7aef\u4ece\u8d85\u8fc7\u534a\u6570\uff08\u5927\u4e8e\u7b49\u4e8e N/2+1\uff09\u7684 Redis \u8282\u70b9\u4e0a\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u5c31\u518d\u6b21\u83b7\u53d6\u5f53\u524d\u65f6\u95f4\uff08t2\uff09\uff0c\u7136\u540e\u8ba1\u7b97\u8ba1\u7b97\u6574\u4e2a\u52a0\u9501\u8fc7\u7a0b\u7684\u603b\u8017\u65f6\uff08t2-t1\uff09\u3002\u5982\u679c t2-t1 &lt; \u9501\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u6b64\u65f6\uff0c\u8ba4\u4e3a\u5ba2\u6237\u7aef\u52a0\u9501\u6210\u529f\uff0c\u5426\u5219\u8ba4\u4e3a\u52a0\u9501\u5931\u8d25\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u52a0\u9501\u6210\u529f\u8981\u540c\u65f6\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff08\u7b80\u8ff0\uff1a\u5982\u679c\u6709\u8d85\u8fc7\u534a\u6570\u7684 Redis \u8282\u70b9\u6210\u529f\u7684\u83b7\u53d6\u5230\u4e86\u9501\uff0c\u5e76\u4e14\u603b\u8017\u65f6\u6ca1\u6709\u8d85\u8fc7\u9501\u7684\u6709\u6548\u65f6\u95f4\uff0c\u90a3\u4e48\u5c31\u662f\u52a0\u9501\u6210\u529f\uff09\uff1a</p> <ul> <li>\u6761\u4ef6\u4e00\uff1a\u5ba2\u6237\u7aef\u4ece\u8d85\u8fc7\u534a\u6570\uff08\u5927\u4e8e\u7b49\u4e8e N/2+1\uff09\u7684 Redis \u8282\u70b9\u4e0a\u6210\u529f\u83b7\u53d6\u5230\u4e86\u9501\uff1b</li> <li>\u6761\u4ef6\u4e8c\uff1a\u5ba2\u6237\u7aef\u4ece\u5927\u591a\u6570\u8282\u70b9\u83b7\u53d6\u9501\u7684\u603b\u8017\u65f6\uff08t2-t1\uff09\u5c0f\u4e8e\u9501\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\u3002</li> </ul> <p>\u52a0\u9501\u6210\u529f\u540e\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u91cd\u65b0\u8ba1\u7b97\u8fd9\u628a\u9501\u7684\u6709\u6548\u65f6\u95f4\uff0c\u8ba1\u7b97\u7684\u7ed3\u679c\u662f\u300c\u9501\u6700\u521d\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\u300d\u51cf\u53bb\u300c\u5ba2\u6237\u7aef\u4ece\u5927\u591a\u6570\u8282\u70b9\u83b7\u53d6\u9501\u7684\u603b\u8017\u65f6\uff08t2-t1\uff09\u300d\u3002\u5982\u679c\u8ba1\u7b97\u7684\u7ed3\u679c\u5df2\u7ecf\u6765\u4e0d\u53ca\u5b8c\u6210\u5171\u4eab\u6570\u636e\u7684\u64cd\u4f5c\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u91ca\u653e\u9501\uff0c\u4ee5\u514d\u51fa\u73b0\u8fd8\u6ca1\u5b8c\u6210\u6570\u636e\u64cd\u4f5c\uff0c\u9501\u5c31\u8fc7\u671f\u4e86\u7684\u60c5\u51b5\u3002</p> <p>\u52a0\u9501\u5931\u8d25\u540e\uff0c\u5ba2\u6237\u7aef\u5411\u6240\u6709 Redis \u8282\u70b9\u53d1\u8d77\u91ca\u653e\u9501\u7684\u64cd\u4f5c\uff0c\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u548c\u5728\u5355\u8282\u70b9\u4e0a\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u4e00\u6837\uff0c\u53ea\u8981\u6267\u884c\u91ca\u653e\u9501\u7684 Lua \u811a\u672c\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b</li> <li>\u300aRedis \u5b9e\u6218\u300b</li> <li>\u300aRedis \u6838\u5fc3\u6280\u672f\u4e0e\u5b9e\u6218\u300b</li> <li>\u300aRedis \u6838\u5fc3\u539f\u7406\u4e0e\u5b9e\u6218\u300b</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/cluster/cache_problem/","title":"\u4ec0\u4e48\u662f\u7f13\u5b58\u96ea\u5d29\u3001\u51fb\u7a7f\u3001\u7a7f\u900f\uff1f","text":"<p>\u7528\u6237\u7684\u6570\u636e\u4e00\u822c\u90fd\u662f\u5b58\u50a8\u4e8e\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u7684\u6570\u636e\u662f\u843d\u5728\u78c1\u76d8\u4e0a\u7684\uff0c\u78c1\u76d8\u7684\u8bfb\u5199\u901f\u5ea6\u53ef\u4ee5\u8bf4\u662f\u8ba1\u7b97\u673a\u91cc\u6700\u6162\u7684\u786c\u4ef6\u4e86\u3002</p> <p>\u5f53\u7528\u6237\u7684\u8bf7\u6c42\uff0c\u90fd\u8bbf\u95ee\u6570\u636e\u5e93\u7684\u8bdd\uff0c\u8bf7\u6c42\u6570\u91cf\u4e00\u4e0a\u6765\uff0c\u6570\u636e\u5e93\u5f88\u5bb9\u6613\u5c31\u5d29\u6e83\u7684\u4e86\uff0c\u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u7528\u6237\u76f4\u63a5\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u4f1a\u7528 Redis \u4f5c\u4e3a\u7f13\u5b58\u5c42\u3002</p> <p>\u56e0\u4e3a Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u6570\u636e\u5e93\u7684\u6570\u636e\u7f13\u5b58\u5728 Redis \u91cc\uff0c\u76f8\u5f53\u4e8e\u6570\u636e\u7f13\u5b58\u5728\u5185\u5b58\uff0c\u5185\u5b58\u7684\u8bfb\u5199\u901f\u5ea6\u6bd4\u786c\u76d8\u5feb\u597d\u51e0\u4e2a\u6570\u91cf\u7ea7\uff0c\u8fd9\u6837\u5927\u5927\u63d0\u9ad8\u4e86\u7cfb\u7edf\u6027\u80fd\u3002</p> <p></p> <p>\u5f15\u5165\u4e86\u7f13\u5b58\u5c42\uff0c\u5c31\u4f1a\u6709\u7f13\u5b58\u5f02\u5e38\u7684\u4e09\u4e2a\u95ee\u9898\uff0c\u5206\u522b\u662f\u7f13\u5b58\u96ea\u5d29\u3001\u7f13\u5b58\u51fb\u7a7f\u3001\u7f13\u5b58\u7a7f\u900f\u3002</p> <p>\u8fd9\u4e09\u4e2a\u95ee\u9898\u4e5f\u662f\u9762\u8bd5\u4e2d\u5f88\u5e38\u8003\u5bdf\u7684\u95ee\u9898\uff0c\u6211\u4eec\u4e0d\u5149\u8981\u6e05\u695a\u5730\u77e5\u9053\u5b83\u4eec\u662f\u600e\u4e48\u53d1\u751f\uff0c\u8fd8\u9700\u8981\u77e5\u9053\u5982\u4f55\u89e3\u51b3\u5b83\u4eec\u3002</p> <p>\u8bdd\u4e0d\u591a\u8bf4\uff0c\u53d1\u8f66\uff01</p> <p></p>"},{"location":"redis/cluster/cache_problem/#_2","title":"\u7f13\u5b58\u96ea\u5d29","text":"<p>\u901a\u5e38\u6211\u4eec\u4e3a\u4e86\u4fdd\u8bc1\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u4e0e\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f1a\u7ed9 Redis \u91cc\u7684\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5f53\u7f13\u5b58\u6570\u636e\u8fc7\u671f\u540e\uff0c\u7528\u6237\u8bbf\u95ee\u7684\u6570\u636e\u5982\u679c\u4e0d\u5728\u7f13\u5b58\u91cc\uff0c\u4e1a\u52a1\u7cfb\u7edf\u9700\u8981\u91cd\u65b0\u751f\u6210\u7f13\u5b58\uff0c\u56e0\u6b64\u5c31\u4f1a\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u5e76\u5c06\u6570\u636e\u66f4\u65b0\u5230 Redis \u91cc\uff0c\u8fd9\u6837\u540e\u7eed\u8bf7\u6c42\u90fd\u53ef\u4ee5\u76f4\u63a5\u547d\u4e2d\u7f13\u5b58\u3002</p> <p></p> <p>\u90a3\u4e48\uff0c\u5f53\u5927\u91cf\u7f13\u5b58\u6570\u636e\u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\uff08\u5931\u6548\uff09\u6216\u8005 Redis \u6545\u969c\u5b95\u673a\u65f6\uff0c\u5982\u679c\u6b64\u65f6\u6709\u5927\u91cf\u7684\u7528\u6237\u8bf7\u6c42\uff0c\u90fd\u65e0\u6cd5\u5728 Redis \u4e2d\u5904\u7406\uff0c\u4e8e\u662f\u5168\u90e8\u8bf7\u6c42\u90fd\u76f4\u63a5\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u4ece\u800c\u5bfc\u81f4\u6570\u636e\u5e93\u7684\u538b\u529b\u9aa4\u589e\uff0c\u4e25\u91cd\u7684\u4f1a\u9020\u6210\u6570\u636e\u5e93\u5b95\u673a\uff0c\u4ece\u800c\u5f62\u6210\u4e00\u7cfb\u5217\u8fde\u9501\u53cd\u5e94\uff0c\u9020\u6210\u6574\u4e2a\u7cfb\u7edf\u5d29\u6e83\uff0c\u8fd9\u5c31\u662f\u7f13\u5b58\u96ea\u5d29\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u6709\u4e24\u4e2a\u539f\u56e0\uff1a</p> <ul> <li>\u5927\u91cf\u6570\u636e\u540c\u65f6\u8fc7\u671f\uff1b</li> <li>Redis \u6545\u969c\u5b95\u673a\uff1b</li> </ul> <p>\u4e0d\u540c\u7684\u8bf1\u56e0\uff0c\u5e94\u5bf9\u7684\u7b56\u7565\u4e5f\u4f1a\u4e0d\u540c\u3002</p>"},{"location":"redis/cluster/cache_problem/#_3","title":"\u5927\u91cf\u6570\u636e\u540c\u65f6\u8fc7\u671f","text":"<p>\u9488\u5bf9\u5927\u91cf\u6570\u636e\u540c\u65f6\u8fc7\u671f\u800c\u5f15\u53d1\u7684\u7f13\u5b58\u96ea\u5d29\u95ee\u9898\uff0c\u5e38\u89c1\u7684\u5e94\u5bf9\u65b9\u6cd5\u6709\u4e0b\u9762\u8fd9\u51e0\u79cd\uff1a</p> <ul> <li>\u5747\u5300\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff1b</li> <li>\u4e92\u65a5\u9501\uff1b</li> <li>\u53cc key \u7b56\u7565\uff1b</li> <li>\u540e\u53f0\u66f4\u65b0\u7f13\u5b58\uff1b</li> </ul> <p>1. \u5747\u5300\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4</p> <p>\u5982\u679c\u8981\u7ed9\u7f13\u5b58\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5e94\u8be5\u907f\u514d\u5c06\u5927\u91cf\u7684\u6570\u636e\u8bbe\u7f6e\u6210\u540c\u4e00\u4e2a\u8fc7\u671f\u65f6\u95f4\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u5bf9\u7f13\u5b58\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u7ed9\u8fd9\u4e9b\u6570\u636e\u7684\u8fc7\u671f\u65f6\u95f4\u52a0\u4e0a\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u5728\u540c\u4e00\u65f6\u95f4\u8fc7\u671f\u3002</p> <p>2. \u4e92\u65a5\u9501</p> <p>\u5f53\u4e1a\u52a1\u7ebf\u7a0b\u5728\u5904\u7406\u7528\u6237\u8bf7\u6c42\u65f6\uff0c\u5982\u679c\u53d1\u73b0\u8bbf\u95ee\u7684\u6570\u636e\u4e0d\u5728 Redis \u91cc\uff0c\u5c31\u52a0\u4e2a\u4e92\u65a5\u9501\uff0c\u4fdd\u8bc1\u540c\u4e00\u65f6\u95f4\u5185\u53ea\u6709\u4e00\u4e2a\u8bf7\u6c42\u6765\u6784\u5efa\u7f13\u5b58\uff08\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\uff0c\u518d\u5c06\u6570\u636e\u66f4\u65b0\u5230 Redis \u91cc\uff09\uff0c\u5f53\u7f13\u5b58\u6784\u5efa\u5b8c\u6210\u540e\uff0c\u518d\u91ca\u653e\u9501\u3002\u672a\u80fd\u83b7\u53d6\u4e92\u65a5\u9501\u7684\u8bf7\u6c42\uff0c\u8981\u4e48\u7b49\u5f85\u9501\u91ca\u653e\u540e\u91cd\u65b0\u8bfb\u53d6\u7f13\u5b58\uff0c\u8981\u4e48\u5c31\u8fd4\u56de\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c\u3002</p> <p>\u5b9e\u73b0\u4e92\u65a5\u9501\u7684\u65f6\u5019\uff0c\u6700\u597d\u8bbe\u7f6e\u8d85\u65f6\u65f6\u95f4\uff0c\u4e0d\u7136\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u62ff\u5230\u4e86\u9501\uff0c\u7136\u540e\u8fd9\u4e2a\u8bf7\u6c42\u53d1\u751f\u4e86\u67d0\u79cd\u610f\u5916\u800c\u4e00\u76f4\u963b\u585e\uff0c\u4e00\u76f4\u4e0d\u91ca\u653e\u9501\uff0c\u8fd9\u65f6\u5176\u4ed6\u8bf7\u6c42\u4e5f\u4e00\u76f4\u62ff\u4e0d\u5230\u9501\uff0c\u6574\u4e2a\u7cfb\u7edf\u5c31\u4f1a\u51fa\u73b0\u65e0\u54cd\u5e94\u7684\u73b0\u8c61\u3002</p> <p>3. \u53cc key \u7b56\u7565</p> <p>\u6211\u4eec\u5bf9\u7f13\u5b58\u6570\u636e\u53ef\u4ee5\u4f7f\u7528\u4e24\u4e2a key\uff0c\u4e00\u4e2a\u662f\u4e3b key\uff0c\u4f1a\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u4e00\u4e2a\u662f\u5907 key\uff0c\u4e0d\u4f1a\u8bbe\u7f6e\u8fc7\u671f\uff0c\u5b83\u4eec\u53ea\u662f key \u4e0d\u4e00\u6837\uff0c\u4f46\u662f value \u503c\u662f\u4e00\u6837\u7684\uff0c\u76f8\u5f53\u4e8e\u7ed9\u7f13\u5b58\u6570\u636e\u505a\u4e86\u4e2a\u526f\u672c\u3002</p> <p>\u5f53\u4e1a\u52a1\u7ebf\u7a0b\u8bbf\u95ee\u4e0d\u5230\u300c\u4e3b key\u300d\u7684\u7f13\u5b58\u6570\u636e\u65f6\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\u300c\u5907 key\u300d\u7684\u7f13\u5b58\u6570\u636e\uff0c\u7136\u540e\u5728\u66f4\u65b0\u7f13\u5b58\u7684\u65f6\u5019\uff0c\u540c\u65f6\u66f4\u65b0\u300c\u4e3b key\u300d\u548c\u300c\u5907 key\u300d\u7684\u6570\u636e\u3002</p> <p>\u53cc key \u7b56\u7565\u7684\u597d\u5904\u662f\uff0c\u5f53\u4e3b key \u8fc7\u671f\u4e86\uff0c\u6709\u5927\u91cf\u8bf7\u6c42\u83b7\u53d6\u7f13\u5b58\u6570\u636e\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u8fd4\u56de\u5907 key \u7684\u6570\u636e\uff0c\u8fd9\u6837\u53ef\u4ee5\u5feb\u901f\u54cd\u5e94\u8bf7\u6c42\u3002\u800c\u4e0d\u7528\u56e0\u4e3a key \u5931\u6548\u800c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u88ab\u9501\u963b\u585e\u4f4f\uff08\u91c7\u7528\u4e86\u4e92\u65a5\u9501\uff0c\u4ec5\u4e00\u4e2a\u8bf7\u6c42\u6765\u6784\u5efa\u7f13\u5b58\uff09\uff0c\u540e\u7eed\u518d\u901a\u77e5\u540e\u53f0\u7ebf\u7a0b\uff0c\u91cd\u65b0\u6784\u5efa\u4e3b key \u7684\u6570\u636e\u3002</p> <p>4. \u540e\u53f0\u66f4\u65b0\u7f13\u5b58</p> <p>\u4e1a\u52a1\u7ebf\u7a0b\u4e0d\u518d\u8d1f\u8d23\u66f4\u65b0\u7f13\u5b58\uff0c\u7f13\u5b58\u4e5f\u4e0d\u8bbe\u7f6e\u6709\u6548\u671f\uff0c\u800c\u662f\u8ba9\u7f13\u5b58\u201c\u6c38\u4e45\u6709\u6548\u201d\uff0c\u5e76\u5c06\u66f4\u65b0\u7f13\u5b58\u7684\u5de5\u4f5c\u4ea4\u7531\u540e\u53f0\u7ebf\u7a0b\u5b9a\u65f6\u66f4\u65b0\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u7f13\u5b58\u6570\u636e\u4e0d\u8bbe\u7f6e\u6709\u6548\u671f\uff0c\u5e76\u4e0d\u662f\u610f\u5473\u7740\u6570\u636e\u4e00\u76f4\u80fd\u5728\u5185\u5b58\u91cc\uff0c\u56e0\u4e3a\u5f53\u7cfb\u7edf\u5185\u5b58\u7d27\u5f20\u7684\u65f6\u5019\uff0c\u6709\u4e9b\u7f13\u5b58\u6570\u636e\u4f1a\u88ab\u201c\u6dd8\u6c70\u201d\uff0c\u800c\u5728\u7f13\u5b58\u88ab\u201c\u6dd8\u6c70\u201d\u5230\u4e0b\u4e00\u6b21\u540e\u53f0\u5b9a\u65f6\u66f4\u65b0\u7f13\u5b58\u7684\u8fd9\u6bb5\u65f6\u95f4\u5185\uff0c\u4e1a\u52a1\u7ebf\u7a0b\u8bfb\u53d6\u7f13\u5b58\u5931\u8d25\u5c31\u8fd4\u56de\u7a7a\u503c\uff0c\u4e1a\u52a1\u7684\u89c6\u89d2\u5c31\u4ee5\u4e3a\u662f\u6570\u636e\u4e22\u5931\u4e86\u3002</p> <p>\u89e3\u51b3\u4e0a\u9762\u7684\u95ee\u9898\u7684\u65b9\u5f0f\u6709\u4e24\u79cd\u3002</p> <p>\u7b2c\u4e00\u79cd\u65b9\u5f0f\uff0c\u540e\u53f0\u7ebf\u7a0b\u4e0d\u4ec5\u8d1f\u8d23\u5b9a\u65f6\u66f4\u65b0\u7f13\u5b58\uff0c\u800c\u4e14\u4e5f\u8d1f\u8d23\u9891\u7e41\u5730\u68c0\u6d4b\u7f13\u5b58\u662f\u5426\u6709\u6548\uff0c\u68c0\u6d4b\u5230\u7f13\u5b58\u5931\u6548\u4e86\uff0c\u539f\u56e0\u53ef\u80fd\u662f\u7cfb\u7edf\u7d27\u5f20\u800c\u88ab\u6dd8\u6c70\u7684\uff0c\u4e8e\u662f\u5c31\u8981\u9a6c\u4e0a\u4ece\u6570\u636e\u5e93\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u66f4\u65b0\u5230\u7f13\u5b58\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u7684\u68c0\u6d4b\u65f6\u95f4\u95f4\u9694\u4e0d\u80fd\u592a\u957f\uff0c\u592a\u957f\u4e5f\u5bfc\u81f4\u7528\u6237\u83b7\u53d6\u7684\u6570\u636e\u662f\u4e00\u4e2a\u7a7a\u503c\u800c\u4e0d\u662f\u771f\u6b63\u7684\u6570\u636e\uff0c\u6240\u4ee5\u68c0\u6d4b\u7684\u95f4\u9694\u6700\u597d\u662f\u6beb\u79d2\u7ea7\u7684\uff0c\u4f46\u662f\u603b\u5f52\u662f\u6709\u4e2a\u95f4\u9694\u65f6\u95f4\uff0c\u7528\u6237\u4f53\u9a8c\u4e00\u822c\u3002</p> <p>\u7b2c\u4e8c\u79cd\u65b9\u5f0f\uff0c\u5728\u4e1a\u52a1\u7ebf\u7a0b\u53d1\u73b0\u7f13\u5b58\u6570\u636e\u5931\u6548\u540e\uff08\u7f13\u5b58\u6570\u636e\u88ab\u6dd8\u6c70\uff09\uff0c\u901a\u8fc7\u6d88\u606f\u961f\u5217\u53d1\u9001\u4e00\u6761\u6d88\u606f\u901a\u77e5\u540e\u53f0\u7ebf\u7a0b\u66f4\u65b0\u7f13\u5b58\uff0c\u540e\u53f0\u7ebf\u7a0b\u6536\u5230\u6d88\u606f\u540e\uff0c\u5728\u66f4\u65b0\u7f13\u5b58\u524d\u53ef\u4ee5\u5224\u65ad\u7f13\u5b58\u662f\u5426\u5b58\u5728\uff0c\u5b58\u5728\u5c31\u4e0d\u6267\u884c\u66f4\u65b0\u7f13\u5b58\u64cd\u4f5c\uff1b\u4e0d\u5b58\u5728\u5c31\u8bfb\u53d6\u6570\u636e\u5e93\u6570\u636e\uff0c\u5e76\u5c06\u6570\u636e\u52a0\u8f7d\u5230\u7f13\u5b58\u3002\u8fd9\u79cd\u65b9\u5f0f\u76f8\u6bd4\u7b2c\u4e00\u79cd\u65b9\u5f0f\u7f13\u5b58\u7684\u66f4\u65b0\u4f1a\u66f4\u53ca\u65f6\uff0c\u7528\u6237\u4f53\u9a8c\u4e5f\u6bd4\u8f83\u597d\u3002</p> <p>\u5728\u4e1a\u52a1\u521a\u4e0a\u7ebf\u7684\u65f6\u5019\uff0c\u6211\u4eec\u6700\u597d\u63d0\u524d\u628a\u6570\u636e\u7f13\u5b58\u8d77\u6765\uff0c\u800c\u4e0d\u662f\u7b49\u5f85\u7528\u6237\u8bbf\u95ee\u624d\u6765\u89e6\u53d1\u7f13\u5b58\u6784\u5efa\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u7f13\u5b58\u9884\u70ed\uff0c\u540e\u53f0\u66f4\u65b0\u7f13\u5b58\u7684\u673a\u5236\u521a\u597d\u4e5f\u9002\u5408\u5e72\u8fd9\u4e2a\u4e8b\u60c5\u3002</p>"},{"location":"redis/cluster/cache_problem/#redis","title":"Redis \u6545\u969c\u5b95\u673a","text":"<p>\u9488\u5bf9 Redis \u6545\u969c\u5b95\u673a\u800c\u5f15\u53d1\u7684\u7f13\u5b58\u96ea\u5d29\u95ee\u9898\uff0c\u5e38\u89c1\u7684\u5e94\u5bf9\u65b9\u6cd5\u6709\u4e0b\u9762\u8fd9\u51e0\u79cd\uff1a</p> <ul> <li>\u670d\u52a1\u7194\u65ad\u6216\u8bf7\u6c42\u9650\u6d41\u673a\u5236\uff1b</li> <li>\u6784\u5efa Redis \u7f13\u5b58\u9ad8\u53ef\u9760\u96c6\u7fa4\uff1b</li> </ul> <p>1. \u670d\u52a1\u7194\u65ad\u6216\u8bf7\u6c42\u9650\u6d41\u673a\u5236</p> <p>\u56e0\u4e3a Redis \u6545\u969c\u5b95\u673a\u800c\u5bfc\u81f4\u7f13\u5b58\u96ea\u5d29\u95ee\u9898\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u542f\u52a8\u670d\u52a1\u7194\u65ad\u673a\u5236\uff0c\u6682\u505c\u4e1a\u52a1\u5e94\u7528\u5bf9\u7f13\u5b58\u670d\u52a1\u7684\u8bbf\u95ee\uff0c\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\uff0c\u4e0d\u7528\u518d\u7ee7\u7eed\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u4ece\u800c\u964d\u4f4e\u5bf9\u6570\u636e\u5e93\u7684\u8bbf\u95ee\u538b\u529b\uff0c\u4fdd\u8bc1\u6570\u636e\u5e93\u7cfb\u7edf\u7684\u6b63\u5e38\u8fd0\u884c\uff0c\u7136\u540e\u7b49\u5230 Redis \u6062\u590d\u6b63\u5e38\u540e\uff0c\u518d\u5141\u8bb8\u4e1a\u52a1\u5e94\u7528\u8bbf\u95ee\u7f13\u5b58\u670d\u52a1\u3002</p> <p>\u670d\u52a1\u7194\u65ad\u673a\u5236\u662f\u4fdd\u62a4\u6570\u636e\u5e93\u7684\u6b63\u5e38\u8fd0\u884c\uff0c\u4f46\u662f\u6682\u505c\u4e86\u4e1a\u52a1\u5e94\u7528\u8bbf\u95ee\u7f13\u5b58\u670d\u7cfb\u7edf\uff0c\u5168\u90e8\u4e1a\u52a1\u90fd\u65e0\u6cd5\u6b63\u5e38\u5de5\u4f5c</p> <p>\u4e3a\u4e86\u51cf\u5c11\u5bf9\u4e1a\u52a1\u7684\u5f71\u54cd\uff0c\u6211\u4eec\u53ef\u4ee5\u542f\u7528\u8bf7\u6c42\u9650\u6d41\u673a\u5236\uff0c\u53ea\u5c06\u5c11\u90e8\u5206\u8bf7\u6c42\u53d1\u9001\u5230\u6570\u636e\u5e93\u8fdb\u884c\u5904\u7406\uff0c\u518d\u591a\u7684\u8bf7\u6c42\u5c31\u5728\u5165\u53e3\u76f4\u63a5\u62d2\u7edd\u670d\u52a1\uff0c\u7b49\u5230 Redis \u6062\u590d\u6b63\u5e38\u5e76\u628a\u7f13\u5b58\u9884\u70ed\u5b8c\u540e\uff0c\u518d\u89e3\u9664\u8bf7\u6c42\u9650\u6d41\u7684\u673a\u5236\u3002</p> <p>2. \u6784\u5efa Redis \u7f13\u5b58\u9ad8\u53ef\u9760\u96c6\u7fa4</p> <p>\u670d\u52a1\u7194\u65ad\u6216\u8bf7\u6c42\u9650\u6d41\u673a\u5236\u662f\u7f13\u5b58\u96ea\u5d29\u53d1\u751f\u540e\u7684\u5e94\u5bf9\u65b9\u6848\uff0c\u6211\u4eec\u6700\u597d\u901a\u8fc7\u4e3b\u4ece\u8282\u70b9\u7684\u65b9\u5f0f\u6784\u5efa Redis \u7f13\u5b58\u9ad8\u53ef\u9760\u96c6\u7fa4\u3002</p> <p>\u5982\u679c Redis \u7f13\u5b58\u7684\u4e3b\u8282\u70b9\u6545\u969c\u5b95\u673a\uff0c\u4ece\u8282\u70b9\u53ef\u4ee5\u5207\u6362\u6210\u4e3a\u4e3b\u8282\u70b9\uff0c\u7ee7\u7eed\u63d0\u4f9b\u7f13\u5b58\u670d\u52a1\uff0c\u907f\u514d\u4e86\u7531\u4e8e Redis \u6545\u969c\u5b95\u673a\u800c\u5bfc\u81f4\u7684\u7f13\u5b58\u96ea\u5d29\u95ee\u9898\u3002</p>"},{"location":"redis/cluster/cache_problem/#_4","title":"\u7f13\u5b58\u51fb\u7a7f","text":"<p>\u6211\u4eec\u7684\u4e1a\u52a1\u901a\u5e38\u4f1a\u6709\u51e0\u4e2a\u6570\u636e\u4f1a\u88ab\u9891\u7e41\u5730\u8bbf\u95ee\uff0c\u6bd4\u5982\u79d2\u6740\u6d3b\u52a8\uff0c\u8fd9\u7c7b\u88ab\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u88ab\u79f0\u4e3a\u70ed\u70b9\u6570\u636e\u3002</p> <p>\u5982\u679c\u7f13\u5b58\u4e2d\u7684\u67d0\u4e2a\u70ed\u70b9\u6570\u636e\u8fc7\u671f\u4e86\uff0c\u6b64\u65f6\u5927\u91cf\u7684\u8bf7\u6c42\u8bbf\u95ee\u4e86\u8be5\u70ed\u70b9\u6570\u636e\uff0c\u5c31\u65e0\u6cd5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\uff0c\u76f4\u63a5\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u5f88\u5bb9\u6613\u5c31\u88ab\u9ad8\u5e76\u53d1\u7684\u8bf7\u6c42\u51b2\u57ae\uff0c\u8fd9\u5c31\u662f\u7f13\u5b58\u51fb\u7a7f\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\u7f13\u5b58\u51fb\u7a7f\u8ddf\u7f13\u5b58\u96ea\u5d29\u5f88\u76f8\u4f3c\uff0c\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u7f13\u5b58\u51fb\u7a7f\u662f\u7f13\u5b58\u96ea\u5d29\u7684\u4e00\u4e2a\u5b50\u96c6\u3002</p> <p>\u5e94\u5bf9\u7f13\u5b58\u51fb\u7a7f\u53ef\u4ee5\u91c7\u53d6\u524d\u9762\u8bf4\u5230\u4e24\u79cd\u65b9\u6848\uff1a</p> <ul> <li>\u4e92\u65a5\u9501\u65b9\u6848\uff0c\u4fdd\u8bc1\u540c\u4e00\u65f6\u95f4\u53ea\u6709\u4e00\u4e2a\u4e1a\u52a1\u7ebf\u7a0b\u66f4\u65b0\u7f13\u5b58\uff0c\u672a\u80fd\u83b7\u53d6\u4e92\u65a5\u9501\u7684\u8bf7\u6c42\uff0c\u8981\u4e48\u7b49\u5f85\u9501\u91ca\u653e\u540e\u91cd\u65b0\u8bfb\u53d6\u7f13\u5b58\uff0c\u8981\u4e48\u5c31\u8fd4\u56de\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c\u3002</li> <li>\u4e0d\u7ed9\u70ed\u70b9\u6570\u636e\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u7531\u540e\u53f0\u5f02\u6b65\u66f4\u65b0\u7f13\u5b58\uff0c\u6216\u8005\u5728\u70ed\u70b9\u6570\u636e\u51c6\u5907\u8981\u8fc7\u671f\u524d\uff0c\u63d0\u524d\u901a\u77e5\u540e\u53f0\u7ebf\u7a0b\u66f4\u65b0\u7f13\u5b58\u4ee5\u53ca\u91cd\u65b0\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff1b</li> </ul>"},{"location":"redis/cluster/cache_problem/#_5","title":"\u7f13\u5b58\u7a7f\u900f","text":"<p>\u5f53\u53d1\u751f\u7f13\u5b58\u96ea\u5d29\u6216\u51fb\u7a7f\u65f6\uff0c\u6570\u636e\u5e93\u4e2d\u8fd8\u662f\u4fdd\u5b58\u4e86\u5e94\u7528\u8981\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u4e00\u65e6\u7f13\u5b58\u6062\u590d\u76f8\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u51cf\u8f7b\u6570\u636e\u5e93\u7684\u538b\u529b\uff0c\u800c\u7f13\u5b58\u7a7f\u900f\u5c31\u4e0d\u4e00\u6837\u4e86\u3002</p> <p>\u5f53\u7528\u6237\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u65e2\u4e0d\u5728\u7f13\u5b58\u4e2d\uff0c\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u5bfc\u81f4\u8bf7\u6c42\u5728\u8bbf\u95ee\u7f13\u5b58\u65f6\uff0c\u53d1\u73b0\u7f13\u5b58\u7f3a\u5931\uff0c\u518d\u53bb\u8bbf\u95ee\u6570\u636e\u5e93\u65f6\uff0c\u53d1\u73b0\u6570\u636e\u5e93\u4e2d\u4e5f\u6ca1\u6709\u8981\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u6ca1\u529e\u6cd5\u6784\u5efa\u7f13\u5b58\u6570\u636e\uff0c\u6765\u670d\u52a1\u540e\u7eed\u7684\u8bf7\u6c42\u3002\u90a3\u4e48\u5f53\u6709\u5927\u91cf\u8fd9\u6837\u7684\u8bf7\u6c42\u5230\u6765\u65f6\uff0c\u6570\u636e\u5e93\u7684\u538b\u529b\u9aa4\u589e\uff0c\u8fd9\u5c31\u662f\u7f13\u5b58\u7a7f\u900f\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u7f13\u5b58\u7a7f\u900f\u7684\u53d1\u751f\u4e00\u822c\u6709\u8fd9\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u4e1a\u52a1\u8bef\u64cd\u4f5c\uff0c\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u548c\u6570\u636e\u5e93\u4e2d\u7684\u6570\u636e\u90fd\u88ab\u8bef\u5220\u9664\u4e86\uff0c\u6240\u4ee5\u5bfc\u81f4\u7f13\u5b58\u548c\u6570\u636e\u5e93\u4e2d\u90fd\u6ca1\u6709\u6570\u636e\uff1b</li> <li>\u9ed1\u5ba2\u6076\u610f\u653b\u51fb\uff0c\u6545\u610f\u5927\u91cf\u8bbf\u95ee\u67d0\u4e9b\u8bfb\u53d6\u4e0d\u5b58\u5728\u6570\u636e\u7684\u4e1a\u52a1\uff1b</li> </ul> <p>\u5e94\u5bf9\u7f13\u5b58\u7a7f\u900f\u7684\u65b9\u6848\uff0c\u5e38\u89c1\u7684\u65b9\u6848\u6709\u4e09\u79cd\u3002</p> <ul> <li>\u7b2c\u4e00\u79cd\u65b9\u6848\uff0c\u975e\u6cd5\u8bf7\u6c42\u7684\u9650\u5236\uff1b</li> <li>\u7b2c\u4e8c\u79cd\u65b9\u6848\uff0c\u7f13\u5b58\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c\uff1b</li> <li>\u7b2c\u4e09\u79cd\u65b9\u6848\uff0c\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u907f\u514d\u901a\u8fc7\u67e5\u8be2\u6570\u636e\u5e93\u6765\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff1b</li> </ul> <p>\u7b2c\u4e00\u79cd\u65b9\u6848\uff0c\u975e\u6cd5\u8bf7\u6c42\u7684\u9650\u5236</p> <p>\u5f53\u6709\u5927\u91cf\u6076\u610f\u8bf7\u6c42\u8bbf\u95ee\u4e0d\u5b58\u5728\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e5f\u4f1a\u53d1\u751f\u7f13\u5b58\u7a7f\u900f\uff0c\u56e0\u6b64\u5728 API \u5165\u53e3\u5904\u6211\u4eec\u8981\u5224\u65ad\u51fa\u8bf7\u6c42\u53c2\u6570\u662f\u5426\u5408\u7406\uff0c\u8bf7\u6c42\u53c2\u6570\u662f\u5426\u542b\u6709\u975e\u6cd5\u503c\u3001\u8bf7\u6c42\u5b57\u6bb5\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u5224\u65ad\u51fa\u662f\u6076\u610f\u8bf7\u6c42\u5c31\u76f4\u63a5\u8fd4\u56de\u9519\u8bef\uff0c\u907f\u514d\u8fdb\u4e00\u6b65\u8bbf\u95ee\u7f13\u5b58\u548c\u6570\u636e\u5e93\u3002</p> <p>\u7b2c\u4e8c\u79cd\u65b9\u6848\uff0c\u7f13\u5b58\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c</p> <p>\u5f53\u6211\u4eec\u7ebf\u4e0a\u4e1a\u52a1\u53d1\u73b0\u7f13\u5b58\u7a7f\u900f\u7684\u73b0\u8c61\u65f6\uff0c\u53ef\u4ee5\u9488\u5bf9\u67e5\u8be2\u7684\u6570\u636e\uff0c\u5728\u7f13\u5b58\u4e2d\u8bbe\u7f6e\u4e00\u4e2a\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c\uff0c\u8fd9\u6837\u540e\u7eed\u8bf7\u6c42\u5c31\u53ef\u4ee5\u4ece\u7f13\u5b58\u4e2d\u8bfb\u53d6\u5230\u7a7a\u503c\u6216\u8005\u9ed8\u8ba4\u503c\uff0c\u8fd4\u56de\u7ed9\u5e94\u7528\uff0c\u800c\u4e0d\u4f1a\u7ee7\u7eed\u67e5\u8be2\u6570\u636e\u5e93\u3002</p> <p>\u7b2c\u4e09\u79cd\u65b9\u6848\uff0c\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u907f\u514d\u901a\u8fc7\u67e5\u8be2\u6570\u636e\u5e93\u6765\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u5199\u5165\u6570\u636e\u5e93\u6570\u636e\u65f6\uff0c\u4f7f\u7528\u5e03\u9686\u8fc7\u6ee4\u5668\u505a\u4e2a\u6807\u8bb0\uff0c\u7136\u540e\u5728\u7528\u6237\u8bf7\u6c42\u5230\u6765\u65f6\uff0c\u4e1a\u52a1\u7ebf\u7a0b\u786e\u8ba4\u7f13\u5b58\u5931\u6548\u540e\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u8be2\u5e03\u9686\u8fc7\u6ee4\u5668\u5feb\u901f\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\uff0c\u5c31\u4e0d\u7528\u901a\u8fc7\u67e5\u8be2\u6570\u636e\u5e93\u6765\u5224\u65ad\u6570\u636e\u662f\u5426\u5b58\u5728\u3002</p> <p>\u5373\u4f7f\u53d1\u751f\u4e86\u7f13\u5b58\u7a7f\u900f\uff0c\u5927\u91cf\u8bf7\u6c42\u53ea\u4f1a\u67e5\u8be2 Redis \u548c\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u800c\u4e0d\u4f1a\u67e5\u8be2\u6570\u636e\u5e93\uff0c\u4fdd\u8bc1\u4e86\u6570\u636e\u5e93\u80fd\u6b63\u5e38\u8fd0\u884c\uff0cRedis \u81ea\u8eab\u4e5f\u662f\u652f\u6301\u5e03\u9686\u8fc7\u6ee4\u5668\u7684\u3002</p> <p>\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u5e03\u9686\u8fc7\u6ee4\u5668\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u5462\uff1f\u63a5\u4e0b\u6765\uff0c\u6211\u4ecb\u7ecd\u4e0b\u3002</p> <p>\u5e03\u9686\u8fc7\u6ee4\u5668\u7531\u300c\u521d\u59cb\u503c\u90fd\u4e3a 0 \u7684\u4f4d\u56fe\u6570\u7ec4\u300d\u548c\u300cN \u4e2a\u54c8\u5e0c\u51fd\u6570\u300d\u4e24\u90e8\u5206\u7ec4\u6210\u3002\u5f53\u6211\u4eec\u5728\u5199\u5165\u6570\u636e\u5e93\u6570\u636e\u65f6\uff0c\u5728\u5e03\u9686\u8fc7\u6ee4\u5668\u91cc\u505a\u4e2a\u6807\u8bb0\uff0c\u8fd9\u6837\u4e0b\u6b21\u67e5\u8be2\u6570\u636e\u662f\u5426\u5728\u6570\u636e\u5e93\u65f6\uff0c\u53ea\u9700\u8981\u67e5\u8be2\u5e03\u9686\u8fc7\u6ee4\u5668\uff0c\u5982\u679c\u67e5\u8be2\u5230\u6570\u636e\u6ca1\u6709\u88ab\u6807\u8bb0\uff0c\u8bf4\u660e\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\u3002</p> <p>\u5e03\u9686\u8fc7\u6ee4\u5668\u4f1a\u901a\u8fc7 3 \u4e2a\u64cd\u4f5c\u5b8c\u6210\u6807\u8bb0\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\uff0c\u4f7f\u7528 N \u4e2a\u54c8\u5e0c\u51fd\u6570\u5206\u522b\u5bf9\u6570\u636e\u505a\u54c8\u5e0c\u8ba1\u7b97\uff0c\u5f97\u5230 N \u4e2a\u54c8\u5e0c\u503c\uff1b</li> <li>\u7b2c\u4e8c\u6b65\uff0c\u5c06\u7b2c\u4e00\u6b65\u5f97\u5230\u7684 N \u4e2a\u54c8\u5e0c\u503c\u5bf9\u4f4d\u56fe\u6570\u7ec4\u7684\u957f\u5ea6\u53d6\u6a21\uff0c\u5f97\u5230\u6bcf\u4e2a\u54c8\u5e0c\u503c\u5728\u4f4d\u56fe\u6570\u7ec4\u7684\u5bf9\u5e94\u4f4d\u7f6e\u3002</li> <li>\u7b2c\u4e09\u6b65\uff0c\u5c06\u6bcf\u4e2a\u54c8\u5e0c\u503c\u5728\u4f4d\u56fe\u6570\u7ec4\u7684\u5bf9\u5e94\u4f4d\u7f6e\u7684\u503c\u8bbe\u7f6e\u4e3a 1\uff1b</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u6709\u4e00\u4e2a\u4f4d\u56fe\u6570\u7ec4\u957f\u5ea6\u4e3a 8\uff0c\u54c8\u5e0c\u51fd\u6570 3 \u4e2a\u7684\u5e03\u9686\u8fc7\u6ee4\u5668\u3002</p> <p></p> <p>\u5728\u6570\u636e\u5e93\u5199\u5165\u6570\u636e x \u540e\uff0c\u628a\u6570\u636e x \u6807\u8bb0\u5728\u5e03\u9686\u8fc7\u6ee4\u5668\u65f6\uff0c\u6570\u636e x \u4f1a\u88ab 3 \u4e2a\u54c8\u5e0c\u51fd\u6570\u5206\u522b\u8ba1\u7b97\u51fa 3 \u4e2a\u54c8\u5e0c\u503c\uff0c\u7136\u540e\u5728\u5bf9\u8fd9 3 \u4e2a\u54c8\u5e0c\u503c\u5bf9 8 \u53d6\u6a21\uff0c\u5047\u8bbe\u53d6\u6a21\u7684\u7ed3\u679c\u4e3a 1\u30014\u30016\uff0c\u7136\u540e\u628a\u4f4d\u56fe\u6570\u7ec4\u7684\u7b2c 1\u30014\u30016 \u4f4d\u7f6e\u7684\u503c\u8bbe\u7f6e\u4e3a 1\u3002\u5f53\u5e94\u7528\u8981\u67e5\u8be2\u6570\u636e x \u662f\u5426\u6570\u636e\u5e93\u65f6\uff0c\u901a\u8fc7\u5e03\u9686\u8fc7\u6ee4\u5668\u53ea\u8981\u67e5\u5230\u4f4d\u56fe\u6570\u7ec4\u7684\u7b2c 1\u30014\u30016 \u4f4d\u7f6e\u7684\u503c\u662f\u5426\u5168\u4e3a 1\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u4e3a 0\uff0c\u5c31\u8ba4\u4e3a\u6570\u636e x \u4e0d\u5728\u6570\u636e\u5e93\u4e2d\u3002</p> <p>\u5e03\u9686\u8fc7\u6ee4\u5668\u7531\u4e8e\u662f\u57fa\u4e8e\u54c8\u5e0c\u51fd\u6570\u5b9e\u73b0\u67e5\u627e\u7684\uff0c\u9ad8\u6548\u67e5\u627e\u7684\u540c\u65f6\u5b58\u5728\u54c8\u5e0c\u51b2\u7a81\u7684\u53ef\u80fd\u6027\uff0c\u6bd4\u5982\u6570\u636e x \u548c\u6570\u636e y \u53ef\u80fd\u90fd\u843d\u5728\u7b2c 1\u30014\u30016 \u4f4d\u7f6e\uff0c\u800c\u4e8b\u5b9e\u4e0a\uff0c\u53ef\u80fd\u6570\u636e\u5e93\u4e2d\u5e76\u4e0d\u5b58\u5728\u6570\u636e y\uff0c\u5b58\u5728\u8bef\u5224\u7684\u60c5\u51b5\u3002</p> <p>\u6240\u4ee5\uff0c\u67e5\u8be2\u5e03\u9686\u8fc7\u6ee4\u5668\u8bf4\u6570\u636e\u5b58\u5728\uff0c\u5e76\u4e0d\u4e00\u5b9a\u8bc1\u660e\u6570\u636e\u5e93\u4e2d\u5b58\u5728\u8fd9\u4e2a\u6570\u636e\uff0c\u4f46\u662f\u67e5\u8be2\u5230\u6570\u636e\u4e0d\u5b58\u5728\uff0c\u6570\u636e\u5e93\u4e2d\u4e00\u5b9a\u5c31\u4e0d\u5b58\u5728\u8fd9\u4e2a\u6570\u636e\u3002</p>"},{"location":"redis/cluster/cache_problem/#_6","title":"\u603b\u7ed3","text":"<p>\u7f13\u5b58\u5f02\u5e38\u4f1a\u9762\u4e34\u7684\u4e09\u4e2a\u95ee\u9898\uff1a\u7f13\u5b58\u96ea\u5d29\u3001\u51fb\u7a7f\u548c\u7a7f\u900f\u3002</p> <p>\u5176\u4e2d\uff0c\u7f13\u5b58\u96ea\u5d29\u548c\u7f13\u5b58\u51fb\u7a7f\u4e3b\u8981\u539f\u56e0\u662f\u6570\u636e\u4e0d\u5728\u7f13\u5b58\u4e2d\uff0c\u800c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u8bbf\u95ee\u4e86\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u538b\u529b\u9aa4\u589e\uff0c\u5bb9\u6613\u5f15\u53d1\u4e00\u7cfb\u5217\u8fde\u9501\u53cd\u5e94\uff0c\u5bfc\u81f4\u7cfb\u7edf\u5954\u6e83\u3002\u4e0d\u8fc7\uff0c\u4e00\u65e6\u6570\u636e\u88ab\u91cd\u65b0\u52a0\u8f7d\u56de\u7f13\u5b58\uff0c\u5e94\u7528\u53c8\u53ef\u4ee5\u4ece\u7f13\u5b58\u5feb\u901f\u8bfb\u53d6\u6570\u636e\uff0c\u4e0d\u518d\u7ee7\u7eed\u8bbf\u95ee\u6570\u636e\u5e93\uff0c\u6570\u636e\u5e93\u7684\u538b\u529b\u4e5f\u4f1a\u77ac\u95f4\u964d\u4e0b\u6765\u3002\u56e0\u6b64\uff0c\u7f13\u5b58\u96ea\u5d29\u548c\u7f13\u5b58\u51fb\u7a7f\u5e94\u5bf9\u7684\u65b9\u6848\u6bd4\u8f83\u7c7b\u4f3c\u3002</p> <p>\u800c\u7f13\u5b58\u7a7f\u900f\u4e3b\u8981\u539f\u56e0\u662f\u6570\u636e\u65e2\u4e0d\u5728\u7f13\u5b58\u4e5f\u4e0d\u5728\u6570\u636e\u5e93\u4e2d\u3002\u56e0\u6b64\uff0c\u7f13\u5b58\u7a7f\u900f\u4e0e\u7f13\u5b58\u96ea\u5d29\u3001\u51fb\u7a7f\u5e94\u5bf9\u7684\u65b9\u6848\u4e0d\u592a\u4e00\u6837\u3002</p> <p>\u6211\u8fd9\u91cc\u6574\u7406\u4e86\u8868\u683c\uff0c\u4f60\u53ef\u4ee5\u4ece\u4e0b\u9762\u8fd9\u5f20\u8868\u683c\u5f88\u597d\u7684\u77e5\u9053\u7f13\u5b58\u96ea\u5d29\u3001\u51fb\u7a7f\u548c\u7a7f\u900f\u7684\u533a\u522b\u4ee5\u53ca\u5e94\u5bf9\u65b9\u6848\u3002</p> <p></p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <p>1.\u300a\u6781\u5ba2\u65f6\u95f4\uff1aRedis \u6838\u5fc3\u6280\u672f\u4e0e\u5b9e\u6218\u300b</p> <ol> <li>https://github.com/doocs/advanced-java/blob/main/docs/high-concurrency/redis-caching-avalanche-and-caching-penetration.md</li> <li>https://medium.com/@mena.meseha/3-major-problems-and-solutions-in-the-cache-world-155ecae41d4f</li> </ol> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/cluster/cluster/","title":"\u4e3a\u4ec0\u4e48\u8981\u6709\u96c6\u7fa4\uff1f","text":"<p>\u5c0f\u6797\u6b63\u5728\u8d76\u7a3f\u4e2d\u3002\u3002\u3002\u3002\u3002\u3002</p>"},{"location":"redis/cluster/master_slave_replication/","title":"\u4e3b\u4ece\u590d\u5236\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u54e5\u3002</p> <p>\u6211\u5728\u524d\u4e24\u7bc7\u5df2\u7ecf\u7ed9\u5927\u5bb6\u56fe\u89e3\u4e86 AOF \u548c RDB\uff0c\u8fd9\u4e24\u4e2a\u6301\u4e45\u5316\u6280\u672f\u4fdd\u8bc1\u4e86\u5373\u4f7f\u5728\u670d\u52a1\u5668\u91cd\u542f\u7684\u60c5\u51b5\u4e0b\u4e5f\u4e0d\u4f1a\u4e22\u5931\u6570\u636e\uff08\u6216\u5c11\u91cf\u635f\u5931\uff09\u3002</p> <p>\u4e0d\u8fc7\uff0c\u7531\u4e8e\u6570\u636e\u90fd\u662f\u5b58\u50a8\u5728\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\uff0c\u5982\u679c\u51fa\u4e8b\u5c31\u5b8c\u728a\u5b50\u4e86\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5982\u679c\u670d\u52a1\u5668\u53d1\u751f\u4e86\u5b95\u673a\uff0c\u7531\u4e8e\u6570\u636e\u6062\u590d\u662f\u9700\u8981\u70b9\u65f6\u95f4\uff0c\u90a3\u4e48\u8fd9\u4e2a\u671f\u95f4\u662f\u65e0\u6cd5\u670d\u52a1\u65b0\u7684\u8bf7\u6c42\u7684\uff1b</li> <li>\u5982\u679c\u8fd9\u53f0\u670d\u52a1\u5668\u7684\u786c\u76d8\u51fa\u73b0\u4e86\u6545\u969c\uff0c\u53ef\u80fd\u6570\u636e\u5c31\u90fd\u4e22\u5931\u4e86\u3002</li> </ul> <p>\u8981\u907f\u514d\u8fd9\u79cd\u5355\u70b9\u6545\u969c\uff0c\u6700\u597d\u7684\u529e\u6cd5\u662f\u5c06\u6570\u636e\u5907\u4efd\u5230\u5176\u4ed6\u670d\u52a1\u5668\u4e0a\uff0c\u8ba9\u8fd9\u4e9b\u670d\u52a1\u5668\u4e5f\u53ef\u4ee5\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\uff0c\u8fd9\u6837\u5373\u4f7f\u6709\u4e00\u53f0\u670d\u52a1\u5668\u51fa\u73b0\u4e86\u6545\u969c\uff0c\u5176\u4ed6\u670d\u52a1\u5668\u4f9d\u7136\u53ef\u4ee5\u7ee7\u7eed\u63d0\u4f9b\u670d\u52a1\u3002</p> <p></p> <p>\u591a\u53f0\u670d\u52a1\u5668\u8981\u4fdd\u5b58\u540c\u4e00\u4efd\u6570\u636e\uff0c\u8fd9\u91cc\u95ee\u9898\u5c31\u6765\u4e86\u3002</p> <p>\u8fd9\u4e9b\u670d\u52a1\u5668\u4e4b\u95f4\u7684\u6570\u636e\u5982\u4f55\u4fdd\u6301\u4e00\u81f4\u6027\u5462\uff1f\u6570\u636e\u7684\u8bfb\u5199\u64cd\u4f5c\u662f\u5426\u6bcf\u53f0\u670d\u52a1\u5668\u90fd\u53ef\u4ee5\u5904\u7406\uff1f</p> <p>Redis \u63d0\u4f9b\u4e86\u4e3b\u4ece\u590d\u5236\u6a21\u5f0f\uff0c\u6765\u907f\u514d\u4e0a\u8ff0\u7684\u95ee\u9898\u3002</p> <p>\u8fd9\u4e2a\u6a21\u5f0f\u53ef\u4ee5\u4fdd\u8bc1\u591a\u53f0\u670d\u52a1\u5668\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4e14\u4e3b\u4ece\u670d\u52a1\u5668\u4e4b\u95f4\u91c7\u7528\u7684\u662f\u300c\u8bfb\u5199\u5206\u79bb\u300d\u7684\u65b9\u5f0f\u3002</p> <p>\u4e3b\u670d\u52a1\u5668\u53ef\u4ee5\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u5f53\u53d1\u751f\u5199\u64cd\u4f5c\u65f6\u81ea\u52a8\u5c06\u5199\u64cd\u4f5c\u540c\u6b65\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u800c\u4ece\u670d\u52a1\u5668\u4e00\u822c\u662f\u53ea\u8bfb\uff0c\u5e76\u63a5\u53d7\u4e3b\u670d\u52a1\u5668\u540c\u6b65\u8fc7\u6765\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u7136\u540e\u6267\u884c\u8fd9\u6761\u547d\u4ee4\u3002</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6240\u6709\u7684\u6570\u636e\u4fee\u6539\u53ea\u5728\u4e3b\u670d\u52a1\u5668\u4e0a\u8fdb\u884c\uff0c\u7136\u540e\u5c06\u6700\u65b0\u7684\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u8fd9\u6837\u5c31\u4f7f\u5f97\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u540c\u6b65\u8fd9\u4e24\u4e2a\u5b57\u8bf4\u7684\u7b80\u5355\uff0c\u4f46\u662f\u8fd9\u4e2a\u540c\u6b65\u8fc7\u7a0b\u5e76\u6ca1\u6709\u60f3\u8c61\u4e2d\u90a3\u4e48\u7b80\u5355\uff0c\u8981\u8003\u8651\u7684\u4e8b\u60c5\u4e0d\u662f\u4e00\u4e24\u4e2a\u3002</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b\uff0c\u4e3b\u4ece\u670d\u52a1\u5668\u95f4\u7684\u7b2c\u4e00\u6b21\u540c\u6b65\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f</p>"},{"location":"redis/cluster/master_slave_replication/#_2","title":"\u7b2c\u4e00\u6b21\u540c\u6b65","text":"<p>\u591a\u53f0\u670d\u52a1\u5668\u4e4b\u95f4\u8981\u901a\u8fc7\u4ec0\u4e48\u65b9\u5f0f\u6765\u786e\u5b9a\u8c01\u662f\u4e3b\u670d\u52a1\u5668\uff0c\u6216\u8005\u8c01\u662f\u4ece\u670d\u52a1\u5668\u5462\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>replicaof</code>\uff08Redis 5.0 \u4e4b\u524d\u4f7f\u7528 slaveof\uff09\u547d\u4ee4\u5f62\u6210\u4e3b\u670d\u52a1\u5668\u548c\u4ece\u670d\u52a1\u5668\u7684\u5173\u7cfb\u3002</p> <p>\u6bd4\u5982\uff0c\u73b0\u5728\u6709\u670d\u52a1\u5668 A \u548c \u670d\u52a1\u5668 B\uff0c\u6211\u4eec\u5728\u670d\u52a1\u5668 B \u4e0a\u6267\u884c\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\uff1a</p> Text Only<pre><code># \u670d\u52a1\u5668 B \u6267\u884c\u8fd9\u6761\u547d\u4ee4\nreplicaof &lt;\u670d\u52a1\u5668 A \u7684 IP \u5730\u5740&gt; &lt;\u670d\u52a1\u5668 A \u7684 Redis \u7aef\u53e3\u53f7&gt;\n</code></pre> <p>\u63a5\u7740\uff0c\u670d\u52a1\u5668 B \u5c31\u4f1a\u53d8\u6210\u670d\u52a1\u5668 A \u7684\u300c\u4ece\u670d\u52a1\u5668\u300d\uff0c\u7136\u540e\u4e0e\u4e3b\u670d\u52a1\u5668\u8fdb\u884c\u7b2c\u4e00\u6b21\u540c\u6b65\u3002</p> <p>\u4e3b\u4ece\u670d\u52a1\u5668\u95f4\u7684\u7b2c\u4e00\u6b21\u540c\u6b65\u7684\u8fc7\u7a0b\u53ef\u5206\u4e3a\u4e09\u4e2a\u9636\u6bb5\uff1a</p> <ul> <li>\u7b2c\u4e00\u9636\u6bb5\u662f\u5efa\u7acb\u94fe\u63a5\u3001\u534f\u5546\u540c\u6b65\uff1b</li> <li>\u7b2c\u4e8c\u9636\u6bb5\u662f\u4e3b\u670d\u52a1\u5668\u540c\u6b65\u6570\u636e\u7ed9\u4ece\u670d\u52a1\u5668\uff1b</li> <li>\u7b2c\u4e09\u9636\u6bb5\u662f\u4e3b\u670d\u52a1\u5668\u53d1\u9001\u65b0\u5199\u64cd\u4f5c\u547d\u4ee4\u7ed9\u4ece\u670d\u52a1\u5668\u3002</li> </ul> <p>\u4e3a\u4e86\u8ba9\u4f60\u66f4\u6e05\u695a\u4e86\u89e3\u8fd9\u4e09\u4e2a\u9636\u6bb5\uff0c\u6211\u753b\u4e86\u4e00\u5f20\u56fe\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u5728\u5177\u4f53\u4ecb\u7ecd\u6bcf\u4e00\u4e2a\u9636\u6bb5\u90fd\u505a\u4e86\u4ec0\u4e48\u3002</p> <p>\u7b2c\u4e00\u9636\u6bb5\uff1a\u5efa\u7acb\u94fe\u63a5\u3001\u534f\u5546\u540c\u6b65</p> <p>\u6267\u884c\u4e86 replicaof \u547d\u4ee4\u540e\uff0c\u4ece\u670d\u52a1\u5668\u5c31\u4f1a\u7ed9\u4e3b\u670d\u52a1\u5668\u53d1\u9001 <code>psync</code> \u547d\u4ee4\uff0c\u8868\u793a\u8981\u8fdb\u884c\u6570\u636e\u540c\u6b65\u3002</p> <p>psync \u547d\u4ee4\u5305\u542b\u4e24\u4e2a\u53c2\u6570\uff0c\u5206\u522b\u662f\u4e3b\u670d\u52a1\u5668\u7684 runID \u548c\u590d\u5236\u8fdb\u5ea6 offset\u3002</p> <ul> <li>runID\uff0c\u6bcf\u4e2a Redis \u670d\u52a1\u5668\u5728\u542f\u52a8\u65f6\u90fd\u4f1a\u81ea\u52a8\u751f\u4ea7\u4e00\u4e2a\u968f\u673a\u7684 ID \u6765\u552f\u4e00\u6807\u8bc6\u81ea\u5df1\u3002\u5f53\u4ece\u670d\u52a1\u5668\u548c\u4e3b\u670d\u52a1\u5668\u7b2c\u4e00\u6b21\u540c\u6b65\u65f6\uff0c\u56e0\u4e3a\u4e0d\u77e5\u9053\u4e3b\u670d\u52a1\u5668\u7684 run ID\uff0c\u6240\u4ee5\u5c06\u5176\u8bbe\u7f6e\u4e3a \"?\"\u3002</li> <li>offset\uff0c\u8868\u793a\u590d\u5236\u7684\u8fdb\u5ea6\uff0c\u7b2c\u4e00\u6b21\u540c\u6b65\u65f6\uff0c\u5176\u503c\u4e3a -1\u3002</li> </ul> <p>\u4e3b\u670d\u52a1\u5668\u6536\u5230 psync \u547d\u4ee4\u540e\uff0c\u4f1a\u7528 <code>FULLRESYNC</code> \u4f5c\u4e3a\u54cd\u5e94\u547d\u4ee4\u8fd4\u56de\u7ed9\u5bf9\u65b9\u3002</p> <p>\u5e76\u4e14\u8fd9\u4e2a\u54cd\u5e94\u547d\u4ee4\u4f1a\u5e26\u4e0a\u4e24\u4e2a\u53c2\u6570\uff1a\u4e3b\u670d\u52a1\u5668\u7684 runID \u548c\u4e3b\u670d\u52a1\u5668\u76ee\u524d\u7684\u590d\u5236\u8fdb\u5ea6 offset\u3002\u4ece\u670d\u52a1\u5668\u6536\u5230\u54cd\u5e94\u540e\uff0c\u4f1a\u8bb0\u5f55\u8fd9\u4e24\u4e2a\u503c\u3002</p> <p>FULLRESYNC \u54cd\u5e94\u547d\u4ee4\u7684\u610f\u56fe\u662f\u91c7\u7528\u5168\u91cf\u590d\u5236\u7684\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f\u4e3b\u670d\u52a1\u5668\u4f1a\u628a\u6240\u6709\u7684\u6570\u636e\u90fd\u540c\u6b65\u7ed9\u4ece\u670d\u52a1\u5668\u3002</p> <p>\u6240\u4ee5\uff0c\u7b2c\u4e00\u9636\u6bb5\u7684\u5de5\u4f5c\u65f6\u4e3a\u4e86\u5168\u91cf\u590d\u5236\u505a\u51c6\u5907\u3002</p> <p>\u90a3\u5177\u4f53\u600e\u4e48\u5168\u91cf\u540c\u6b65\u5440\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u5f80\u4e0b\u770b\u7b2c\u4e8c\u9636\u6bb5\u3002</p> <p>\u7b2c\u4e8c\u9636\u6bb5\uff1a\u4e3b\u670d\u52a1\u5668\u540c\u6b65\u6570\u636e\u7ed9\u4ece\u670d\u52a1\u5668</p> <p>\u63a5\u7740\uff0c\u4e3b\u670d\u52a1\u5668\u4f1a\u6267\u884c bgsave \u547d\u4ee4\u6765\u751f\u6210 RDB \u6587\u4ef6\uff0c\u7136\u540e\u628a\u6587\u4ef6\u53d1\u9001\u7ed9\u4ece\u670d\u52a1\u5668\u3002</p> <p>\u4ece\u670d\u52a1\u5668\u6536\u5230 RDB \u6587\u4ef6\u540e\uff0c\u4f1a\u5148\u6e05\u7a7a\u5f53\u524d\u7684\u6570\u636e\uff0c\u7136\u540e\u8f7d\u5165 RDB \u6587\u4ef6\u3002</p> <p>\u8fd9\u91cc\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff0c\u4e3b\u670d\u52a1\u5668\u751f\u6210 RDB \u8fd9\u4e2a\u8fc7\u7a0b\u662f\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\uff0c\u56e0\u4e3a bgsave \u547d\u4ee4\u662f\u4ea7\u751f\u4e86\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u505a\u751f\u6210 RDB \u6587\u4ef6\u7684\u5de5\u4f5c\uff0c\u662f\u5f02\u6b65\u5de5\u4f5c\u7684\uff0c\u8fd9\u6837 Redis \u4f9d\u7136\u53ef\u4ee5\u6b63\u5e38\u5904\u7406\u547d\u4ee4\u3002</p> <p>\u4f46\u662f\uff0c\u8fd9\u671f\u95f4\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\u5e76\u6ca1\u6709\u8bb0\u5f55\u5230\u521a\u521a\u751f\u6210\u7684 RDB \u6587\u4ef6\u4e2d\uff0c\u8fd9\u65f6\u4e3b\u4ece\u670d\u52a1\u5668\u95f4\u7684\u6570\u636e\u5c31\u4e0d\u4e00\u81f4\u4e86\u3002</p> <p>\u90a3\u4e48\u4e3a\u4e86\u4fdd\u8bc1\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4e3b\u670d\u52a1\u5668\u5728\u4e0b\u9762\u8fd9\u4e09\u4e2a\u65f6\u95f4\u95f4\u9699\u4e2d\u5c06\u6536\u5230\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u5199\u5165\u5230 replication buffer \u7f13\u51b2\u533a\u91cc\uff1a</p> <ul> <li>\u4e3b\u670d\u52a1\u5668\u751f\u6210 RDB \u6587\u4ef6\u671f\u95f4\uff1b</li> <li>\u4e3b\u670d\u52a1\u5668\u53d1\u9001 RDB \u6587\u4ef6\u7ed9\u4ece\u670d\u52a1\u5668\u671f\u95f4\uff1b</li> <li>\u300c\u4ece\u670d\u52a1\u5668\u300d\u52a0\u8f7d RDB \u6587\u4ef6\u671f\u95f4\uff1b</li> </ul> <p>\u7b2c\u4e09\u9636\u6bb5\uff1a\u4e3b\u670d\u52a1\u5668\u53d1\u9001\u65b0\u5199\u64cd\u4f5c\u547d\u4ee4\u7ed9\u4ece\u670d\u52a1\u5668</p> <p>\u5728\u4e3b\u670d\u52a1\u5668\u751f\u6210\u7684 RDB \u6587\u4ef6\u53d1\u9001\u5b8c\uff0c\u4ece\u670d\u52a1\u5668\u6536\u5230 RDB \u6587\u4ef6\u540e\uff0c\u4e22\u5f03\u6240\u6709\u65e7\u6570\u636e\uff0c\u5c06 RDB \u6570\u636e\u8f7d\u5165\u5230\u5185\u5b58\u3002\u5b8c\u6210 RDB \u7684\u8f7d\u5165\u540e\uff0c\u4f1a\u56de\u590d\u4e00\u4e2a\u786e\u8ba4\u6d88\u606f\u7ed9\u4e3b\u670d\u52a1\u5668\u3002</p> <p>\u63a5\u7740\uff0c\u4e3b\u670d\u52a1\u5668\u5c06 replication buffer \u7f13\u51b2\u533a\u91cc\u6240\u8bb0\u5f55\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\u53d1\u9001\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u4ece\u670d\u52a1\u5668\u6267\u884c\u6765\u81ea\u4e3b\u670d\u52a1\u5668 replication buffer  \u7f13\u51b2\u533a\u91cc\u53d1\u6765\u7684\u547d\u4ee4\uff0c\u8fd9\u65f6\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u5c31\u4e00\u81f4\u4e86\u3002</p> <p>\u81f3\u6b64\uff0c\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u7b2c\u4e00\u6b21\u540c\u6b65\u7684\u5de5\u4f5c\u5c31\u5b8c\u6210\u4e86\u3002</p>"},{"location":"redis/cluster/master_slave_replication/#_3","title":"\u547d\u4ee4\u4f20\u64ad","text":"<p>\u4e3b\u4ece\u670d\u52a1\u5668\u5728\u5b8c\u6210\u7b2c\u4e00\u6b21\u540c\u6b65\u540e\uff0c\u53cc\u65b9\u4e4b\u95f4\u5c31\u4f1a\u7ef4\u62a4\u4e00\u4e2a TCP \u8fde\u63a5\u3002</p> <p></p> <p>\u540e\u7eed\u4e3b\u670d\u52a1\u5668\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u8fde\u63a5\u7ee7\u7eed\u5c06\u5199\u64cd\u4f5c\u547d\u4ee4\u4f20\u64ad\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u7136\u540e\u4ece\u670d\u52a1\u5668\u6267\u884c\u8be5\u547d\u4ee4\uff0c\u4f7f\u5f97\u4e0e\u4e3b\u670d\u52a1\u5668\u7684\u6570\u636e\u5e93\u72b6\u6001\u76f8\u540c\u3002</p> <p>\u800c\u4e14\u8fd9\u4e2a\u8fde\u63a5\u662f\u957f\u8fde\u63a5\u7684\uff0c\u76ee\u7684\u662f\u907f\u514d\u9891\u7e41\u7684 TCP \u8fde\u63a5\u548c\u65ad\u5f00\u5e26\u6765\u7684\u6027\u80fd\u5f00\u9500\u3002</p> <p>\u4e0a\u9762\u7684\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u57fa\u4e8e\u957f\u8fde\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\uff0c\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\u6765\u4fdd\u8bc1\u7b2c\u4e00\u6b21\u540c\u6b65\u540e\u7684\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002</p>"},{"location":"redis/cluster/master_slave_replication/#_4","title":"\u5206\u644a\u4e3b\u670d\u52a1\u5668\u7684\u538b\u529b","text":"<p>\u5728\u524d\u9762\u7684\u5206\u6790\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u4e3b\u4ece\u670d\u52a1\u5668\u5728\u7b2c\u4e00\u6b21\u6570\u636e\u540c\u6b65\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u670d\u52a1\u5668\u4f1a\u505a\u4e24\u4ef6\u8017\u65f6\u7684\u64cd\u4f5c\uff1a\u751f\u6210 RDB \u6587\u4ef6\u548c\u4f20\u8f93 RDB \u6587\u4ef6\u3002</p> <p>\u4e3b\u670d\u52a1\u5668\u662f\u53ef\u4ee5\u6709\u591a\u4e2a\u4ece\u670d\u52a1\u5668\u7684\uff0c\u5982\u679c\u4ece\u670d\u52a1\u5668\u6570\u91cf\u975e\u5e38\u591a\uff0c\u800c\u4e14\u90fd\u4e0e\u4e3b\u670d\u52a1\u5668\u8fdb\u884c\u5168\u91cf\u540c\u6b65\u7684\u8bdd\uff0c\u5c31\u4f1a\u5e26\u6765\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u7531\u4e8e\u662f\u901a\u8fc7 bgsave \u547d\u4ee4\u6765\u751f\u6210 RDB \u6587\u4ef6\u7684\uff0c\u90a3\u4e48\u4e3b\u670d\u52a1\u5668\u5c31\u4f1a\u5fd9\u4e8e\u4f7f\u7528 fork() \u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u5982\u679c\u4e3b\u670d\u52a1\u5668\u7684\u5185\u5b58\u6570\u636e\u975e\u5e38\u5927\uff0c\u5728\u6267\u884c fork() \u51fd\u6570\u65f6\u662f\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\uff0c\u4ece\u800c\u4f7f\u5f97 Redis \u65e0\u6cd5\u6b63\u5e38\u5904\u7406\u8bf7\u6c42\uff1b</li> <li>\u4f20\u8f93 RDB \u6587\u4ef6\u4f1a\u5360\u7528\u4e3b\u670d\u52a1\u5668\u7684\u7f51\u7edc\u5e26\u5bbd\uff0c\u4f1a\u5bf9\u4e3b\u670d\u52a1\u5668\u54cd\u5e94\u547d\u4ee4\u8bf7\u6c42\u4ea7\u751f\u5f71\u54cd\u3002</li> </ul> <p>\u8fd9\u79cd\u60c5\u51b5\u5c31\u597d\u50cf\uff0c\u521a\u521b\u4e1a\u7684\u516c\u53f8\uff0c\u7531\u4e8e\u4eba\u4e0d\u591a\uff0c\u6240\u4ee5\u5458\u5de5\u90fd\u5f52\u8001\u677f\u4e00\u4e2a\u4eba\u7ba1\uff0c\u4f46\u662f\u968f\u7740\u516c\u53f8\u7684\u53d1\u5c55\uff0c\u4eba\u5458\u7684\u6269\u5145\uff0c\u8001\u677f\u6162\u6162\u5c31\u65e0\u6cd5\u627f\u62c5\u5168\u90e8\u5458\u5de5\u7684\u7ba1\u7406\u5de5\u4f5c\u4e86\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u8001\u677f\u5c31\u9700\u8981\u8bbe\u7acb\u7ecf\u7406\u804c\u4f4d\uff0c\u7531\u7ecf\u7406\u7ba1\u7406\u591a\u540d\u666e\u901a\u5458\u5de5\uff0c\u7136\u540e\u8001\u677f\u53ea\u9700\u8981\u7ba1\u7406\u7ecf\u7406\u5c31\u597d\u3002</p> <p>Redis \u4e5f\u662f\u4e00\u6837\u7684\uff0c\u4ece\u670d\u52a1\u5668\u53ef\u4ee5\u6709\u81ea\u5df1\u7684\u4ece\u670d\u52a1\u5668\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u62e5\u6709\u4ece\u670d\u52a1\u5668\u7684\u4ece\u670d\u52a1\u5668\u5f53\u4f5c\u7ecf\u7406\u89d2\u8272\uff0c\u5b83\u4e0d\u4ec5\u53ef\u4ee5\u63a5\u6536\u4e3b\u670d\u52a1\u5668\u7684\u540c\u6b65\u6570\u636e\uff0c\u81ea\u5df1\u4e5f\u53ef\u4ee5\u540c\u65f6\u4f5c\u4e3a\u4e3b\u670d\u52a1\u5668\u7684\u5f62\u5f0f\u5c06\u6570\u636e\u540c\u6b65\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u7ec4\u7ec7\u5f62\u5f0f\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u901a\u8fc7\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4e3b\u670d\u52a1\u5668\u751f\u6210 RDB \u548c\u4f20\u8f93 RDB \u7684\u538b\u529b\u53ef\u4ee5\u5206\u644a\u5230\u5145\u5f53\u7ecf\u7406\u89d2\u8272\u7684\u4ece\u670d\u52a1\u5668\u3002</p> <p>\u90a3\u5177\u4f53\u600e\u4e48\u505a\u5230\u7684\u5462\uff1f</p> <p>\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u6211\u4eec\u5728\u300c\u4ece\u670d\u52a1\u5668\u300d\u4e0a\u6267\u884c\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\uff0c\u4f7f\u5176\u4f5c\u4e3a\u76ee\u6807\u670d\u52a1\u5668\u7684\u4ece\u670d\u52a1\u5668\uff1a</p> Text Only<pre><code>replicaof &lt;\u76ee\u6807\u670d\u52a1\u5668\u7684 IP&gt; 6379\n</code></pre> <p>\u6b64\u65f6\u5982\u679c\u76ee\u6807\u670d\u52a1\u5668\u672c\u8eab\u4e5f\u662f\u300c\u4ece\u670d\u52a1\u5668\u300d\uff0c\u90a3\u4e48\u8be5\u76ee\u6807\u670d\u52a1\u5668\u5c31\u4f1a\u6210\u4e3a\u300c\u7ecf\u7406\u300d\u7684\u89d2\u8272\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u63a5\u53d7\u4e3b\u670d\u52a1\u5668\u540c\u6b65\u7684\u6570\u636e\uff0c\u4e5f\u4f1a\u628a\u6570\u636e\u540c\u6b65\u7ed9\u81ea\u5df1\u65d7\u4e0b\u7684\u4ece\u670d\u52a1\u5668\uff0c\u4ece\u800c\u51cf\u8f7b\u4e3b\u670d\u52a1\u5668\u7684\u8d1f\u62c5\u3002</p>"},{"location":"redis/cluster/master_slave_replication/#_5","title":"\u589e\u91cf\u590d\u5236","text":"<p>\u4e3b\u4ece\u670d\u52a1\u5668\u5728\u5b8c\u6210\u7b2c\u4e00\u6b21\u540c\u6b65\u540e\uff0c\u5c31\u4f1a\u57fa\u4e8e\u957f\u8fde\u63a5\u8fdb\u884c\u547d\u4ee4\u4f20\u64ad\u3002</p> <p>\u53ef\u662f\uff0c\u7f51\u7edc\u603b\u662f\u4e0d\u6309\u5957\u8def\u51fa\u724c\u7684\u561b\uff0c\u8bf4\u5ef6\u8fdf\u5c31\u5ef6\u8fdf\uff0c\u8bf4\u65ad\u5f00\u5c31\u65ad\u5f00\u3002</p> <p>\u5982\u679c\u4e3b\u4ece\u670d\u52a1\u5668\u95f4\u7684\u7f51\u7edc\u8fde\u63a5\u65ad\u5f00\u4e86\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u8fdb\u884c\u547d\u4ee4\u4f20\u64ad\u4e86\uff0c\u8fd9\u65f6\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u5c31\u6ca1\u529e\u6cd5\u548c\u4e3b\u670d\u52a1\u5668\u4fdd\u6301\u4e00\u81f4\u4e86\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u80fd\u4ece\u300c\u4ece\u670d\u52a1\u5668\u300d\u8bfb\u5230\u65e7\u7684\u6570\u636e\u3002</p> <p></p> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u6b64\u65f6\u65ad\u5f00\u7684\u7f51\u7edc\uff0c\u53c8\u6062\u590d\u6b63\u5e38\u4e86\uff0c\u8981\u600e\u4e48\u7ee7\u7eed\u4fdd\u8bc1\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u4e00\u81f4\u6027\u5462\uff1f</p> <p>\u5728 Redis 2.8 \u4e4b\u524d\uff0c\u5982\u679c\u4e3b\u4ece\u670d\u52a1\u5668\u5728\u547d\u4ee4\u540c\u6b65\u65f6\u51fa\u73b0\u4e86\u7f51\u7edc\u65ad\u5f00\u53c8\u6062\u590d\u7684\u60c5\u51b5\uff0c\u4ece\u670d\u52a1\u5668\u5c31\u4f1a\u548c\u4e3b\u670d\u52a1\u5668\u91cd\u65b0\u8fdb\u884c\u4e00\u6b21\u5168\u91cf\u590d\u5236\uff0c\u5f88\u660e\u663e\u8fd9\u6837\u7684\u5f00\u9500\u592a\u5927\u4e86\uff0c\u5fc5\u987b\u8981\u6539\u8fdb\u4e00\u6ce2\u3002</p> <p>\u6240\u4ee5\uff0c\u4ece Redis 2.8 \u5f00\u59cb\uff0c\u7f51\u7edc\u65ad\u5f00\u53c8\u6062\u590d\u540e\uff0c\u4ece\u4e3b\u4ece\u670d\u52a1\u5668\u4f1a\u91c7\u7528\u589e\u91cf\u590d\u5236\u7684\u65b9\u5f0f\u7ee7\u7eed\u540c\u6b65\uff0c\u4e5f\u5c31\u662f\u53ea\u4f1a\u628a\u7f51\u7edc\u65ad\u5f00\u671f\u95f4\u4e3b\u670d\u52a1\u5668\u63a5\u6536\u5230\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u540c\u6b65\u7ed9\u4ece\u670d\u52a1\u5668\u3002</p> <p>\u7f51\u7edc\u6062\u590d\u540e\u7684\u589e\u91cf\u590d\u5236\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e3b\u8981\u6709\u4e09\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u4ece\u670d\u52a1\u5668\u5728\u6062\u590d\u7f51\u7edc\u540e\uff0c\u4f1a\u53d1\u9001 psync \u547d\u4ee4\u7ed9\u4e3b\u670d\u52a1\u5668\uff0c\u6b64\u65f6\u7684 psync \u547d\u4ee4\u91cc\u7684 offset \u53c2\u6570\u4e0d\u662f -1\uff1b</li> <li>\u4e3b\u670d\u52a1\u5668\u6536\u5230\u8be5\u547d\u4ee4\u540e\uff0c\u7136\u540e\u7528 CONTINUE \u54cd\u5e94\u547d\u4ee4\u544a\u8bc9\u4ece\u670d\u52a1\u5668\u63a5\u4e0b\u6765\u91c7\u7528\u589e\u91cf\u590d\u5236\u7684\u65b9\u5f0f\u540c\u6b65\u6570\u636e\uff1b</li> <li>\u7136\u540e\u4e3b\u670d\u52a1\u5c06\u4e3b\u4ece\u670d\u52a1\u5668\u65ad\u7ebf\u671f\u95f4\uff0c\u6240\u6267\u884c\u7684\u5199\u547d\u4ee4\u53d1\u9001\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u7136\u540e\u4ece\u670d\u52a1\u5668\u6267\u884c\u8fd9\u4e9b\u547d\u4ee4\u3002</li> </ul> <p>\u90a3\u4e48\u5173\u952e\u7684\u95ee\u9898\u6765\u4e86\uff0c\u4e3b\u670d\u52a1\u5668\u600e\u4e48\u77e5\u9053\u8981\u5c06\u54ea\u4e9b\u589e\u91cf\u6570\u636e\u53d1\u9001\u7ed9\u4ece\u670d\u52a1\u5668\u5462\uff1f</p> <p>\u7b54\u6848\u85cf\u5728\u8fd9\u4e24\u4e2a\u4e1c\u897f\u91cc\uff1a</p> <ul> <li>repl_backlog_buffer\uff0c\u662f\u4e00\u4e2a\u300c\u73af\u5f62\u300d\u7f13\u51b2\u533a\uff0c\u7528\u4e8e\u4e3b\u4ece\u670d\u52a1\u5668\u65ad\u8fde\u540e\uff0c\u4ece\u4e2d\u627e\u5230\u5dee\u5f02\u7684\u6570\u636e\uff1b</li> <li>replication offset\uff0c\u6807\u8bb0\u4e0a\u9762\u90a3\u4e2a\u7f13\u51b2\u533a\u7684\u540c\u6b65\u8fdb\u5ea6\uff0c\u4e3b\u4ece\u670d\u52a1\u5668\u90fd\u6709\u5404\u81ea\u7684\u504f\u79fb\u91cf\uff0c\u4e3b\u670d\u52a1\u5668\u4f7f\u7528 master_repl_offset \u6765\u8bb0\u5f55\u81ea\u5df1\u300c\u5199\u300d\u5230\u7684\u4f4d\u7f6e\uff0c\u4ece\u670d\u52a1\u5668\u4f7f\u7528 slave_repl_offset \u6765\u8bb0\u5f55\u81ea\u5df1\u300c\u8bfb\u300d\u5230\u7684\u4f4d\u7f6e\u3002</li> </ul> <p>\u90a3 repl_backlog_buffer \u7f13\u51b2\u533a\u662f\u4ec0\u4e48\u65f6\u5019\u5199\u5165\u7684\u5462\uff1f</p> <p>\u5728\u4e3b\u670d\u52a1\u5668\u8fdb\u884c\u547d\u4ee4\u4f20\u64ad\u65f6\uff0c\u4e0d\u4ec5\u4f1a\u5c06\u5199\u547d\u4ee4\u53d1\u9001\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u8fd8\u4f1a\u5c06\u5199\u547d\u4ee4\u5199\u5165\u5230 repl_backlog_buffer \u7f13\u51b2\u533a\u91cc\uff0c\u56e0\u6b64 \u8fd9\u4e2a\u7f13\u51b2\u533a\u91cc\u4f1a\u4fdd\u5b58\u7740\u6700\u8fd1\u4f20\u64ad\u7684\u5199\u547d\u4ee4\u3002</p> <p>\u7f51\u7edc\u65ad\u5f00\u540e\uff0c\u5f53\u4ece\u670d\u52a1\u5668\u91cd\u65b0\u8fde\u4e0a\u4e3b\u670d\u52a1\u5668\u65f6\uff0c\u4ece\u670d\u52a1\u5668\u4f1a\u901a\u8fc7 psync \u547d\u4ee4\u5c06\u81ea\u5df1\u7684\u590d\u5236\u504f\u79fb\u91cf slave_repl_offset \u53d1\u9001\u7ed9\u4e3b\u670d\u52a1\u5668\uff0c\u4e3b\u670d\u52a1\u5668\u6839\u636e\u81ea\u5df1\u7684 master_repl_offset \u548c slave_repl_offset \u4e4b\u95f4\u7684\u5dee\u8ddd\uff0c\u7136\u540e\u6765\u51b3\u5b9a\u5bf9\u4ece\u670d\u52a1\u5668\u6267\u884c\u54ea\u79cd\u540c\u6b65\u64cd\u4f5c\uff1a</p> <ul> <li>\u5982\u679c\u5224\u65ad\u51fa\u4ece\u670d\u52a1\u5668\u8981\u8bfb\u53d6\u7684\u6570\u636e\u8fd8\u5728 repl_backlog_buffer \u7f13\u51b2\u533a\u91cc\uff0c\u90a3\u4e48\u4e3b\u670d\u52a1\u5668\u5c06\u91c7\u7528\u589e\u91cf\u540c\u6b65\u7684\u65b9\u5f0f\uff1b</li> <li>\u76f8\u53cd\uff0c\u5982\u679c\u5224\u65ad\u51fa\u4ece\u670d\u52a1\u5668\u8981\u8bfb\u53d6\u7684\u6570\u636e\u5df2\u7ecf\u4e0d\u5b58\u5728    repl_backlog_buffer \u7f13\u51b2\u533a\u91cc\uff0c\u90a3\u4e48\u4e3b\u670d\u52a1\u5668\u5c06\u91c7\u7528\u5168\u91cf\u540c\u6b65\u7684\u65b9\u5f0f\u3002</li> </ul> <p>\u5f53\u4e3b\u670d\u52a1\u5668\u5728 repl_backlog_buffer \u4e2d\u627e\u5230\u4e3b\u4ece\u670d\u52a1\u5668\u5dee\u5f02\uff08\u589e\u91cf\uff09\u7684\u6570\u636e\u540e\uff0c\u5c31\u4f1a\u5c06\u589e\u91cf\u7684\u6570\u636e\u5199\u5165\u5230 replication buffer \u7f13\u51b2\u533a\uff0c\u8fd9\u4e2a\u7f13\u51b2\u533a\u6211\u4eec\u524d\u9762\u4e5f\u63d0\u5230\u8fc7\uff0c\u5b83\u662f\u7f13\u5b58\u5c06\u8981\u4f20\u64ad\u7ed9\u4ece\u670d\u52a1\u5668\u7684\u547d\u4ee4\u3002</p> <p></p> <p>repl_backlog_buffer \u7f13\u884c\u7f13\u51b2\u533a\u7684\u9ed8\u8ba4\u5927\u5c0f\u662f 1M\uff0c\u5e76\u4e14\u7531\u4e8e\u5b83\u662f\u4e00\u4e2a\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u6240\u4ee5\u5f53\u7f13\u51b2\u533a\u5199\u6ee1\u540e\uff0c\u4e3b\u670d\u52a1\u5668\u7ee7\u7eed\u5199\u5165\u7684\u8bdd\uff0c\u5c31\u4f1a\u8986\u76d6\u4e4b\u524d\u7684\u6570\u636e\u3002\u56e0\u6b64\uff0c\u5f53\u4e3b\u670d\u52a1\u5668\u7684\u5199\u5165\u901f\u5ea6\u8fdc\u8d85\u4e8e\u4ece\u670d\u52a1\u5668\u7684\u8bfb\u53d6\u901f\u5ea6\uff0c\u7f13\u51b2\u533a\u7684\u6570\u636e\u4e00\u4e0b\u5c31\u4f1a\u88ab\u8986\u76d6\u3002</p> <p>\u90a3\u4e48\u5728\u7f51\u7edc\u6062\u590d\u65f6\uff0c\u5982\u679c\u4ece\u670d\u52a1\u5668\u60f3\u8bfb\u7684\u6570\u636e\u5df2\u7ecf\u88ab\u8986\u76d6\u4e86\uff0c\u4e3b\u670d\u52a1\u5668\u5c31\u4f1a\u91c7\u7528\u5168\u91cf\u540c\u6b65\uff0c\u8fd9\u4e2a\u65b9\u5f0f\u6bd4\u589e\u91cf\u540c\u6b65\u7684\u6027\u80fd\u635f\u8017\u8981\u5927\u5f88\u591a\u3002</p> <p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u907f\u514d\u5728\u7f51\u7edc\u6062\u590d\u65f6\uff0c\u4e3b\u670d\u52a1\u5668\u9891\u7e41\u5730\u4f7f\u7528\u5168\u91cf\u540c\u6b65\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u5e94\u8be5\u8c03\u6574\u4e0b repl_backlog_buffer \u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u5c3d\u53ef\u80fd\u7684\u5927\u4e00\u4e9b\uff0c\u51cf\u5c11\u51fa\u73b0\u4ece\u670d\u52a1\u5668\u8981\u8bfb\u53d6\u7684\u6570\u636e\u88ab\u8986\u76d6\u7684\u6982\u7387\uff0c\u4ece\u800c\u4f7f\u5f97\u4e3b\u670d\u52a1\u5668\u91c7\u7528\u589e\u91cf\u540c\u6b65\u7684\u65b9\u5f0f\u3002</p> <p>\u90a3 repl_backlog_buffer \u7f13\u51b2\u533a\u5177\u4f53\u8981\u8c03\u6574\u5230\u591a\u5927\u5462\uff1f</p> <p>repl_backlog_buffer \u6700\u5c0f\u7684\u5927\u5c0f\u53ef\u4ee5\u6839\u636e\u8fd9\u9762\u8fd9\u4e2a\u516c\u5f0f\u4f30\u7b97\u3002</p> <p></p> <p>\u6211\u6765\u89e3\u91ca\u4e0b\u8fd9\u4e2a\u516c\u5f0f\u7684\u610f\u601d\uff1a</p> <ul> <li>second \u4e3a\u4ece\u670d\u52a1\u5668\u65ad\u7ebf\u540e\u91cd\u65b0\u8fde\u63a5\u4e0a\u4e3b\u670d\u52a1\u5668\u6240\u9700\u7684\u5e73\u5747 \u65f6\u95f4 (\u4ee5\u79d2\u8ba1\u7b97)\u3002</li> <li>write_size_per_second \u5219\u662f\u4e3b\u670d\u52a1\u5668\u5e73\u5747\u6bcf\u79d2\u4ea7\u751f\u7684\u5199\u547d\u4ee4\u6570\u636e\u91cf\u5927\u5c0f\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u4e3b\u670d\u52a1\u5668\u5e73\u5747\u6bcf\u79d2\u4ea7\u751f 1 MB \u7684\u5199\u547d\u4ee4\uff0c\u800c\u4ece\u670d\u52a1\u5668\u65ad\u7ebf\u4e4b\u540e\u5e73\u5747\u8981 5 \u79d2\u624d\u80fd\u91cd\u65b0\u8fde\u63a5\u4e3b\u670d\u52a1\u5668\u3002</p> <p>\u90a3\u4e48 repl_backlog_buffer \u5927\u5c0f\u5c31\u4e0d\u80fd\u4f4e\u4e8e 5 MB\uff0c\u5426\u5219\u65b0\u5199\u5730\u547d\u4ee4\u5c31\u4f1a\u8986\u76d6\u65e7\u6570\u636e\u4e86\u3002</p> <p>\u5f53\u7136\uff0c\u4e3a\u4e86\u5e94\u5bf9\u4e00\u4e9b\u7a81\u53d1\u7684\u60c5\u51b5\uff0c\u53ef\u4ee5\u5c06 repl_backlog_buffer \u7684\u5927\u5c0f\u8bbe\u7f6e\u4e3a\u6b64\u57fa\u7840\u4e0a\u7684 2 \u500d\uff0c\u4e5f\u5c31\u662f 10 MB\u3002</p> <p>\u5173\u4e8e repl_backlog_buffer \u5927\u5c0f\u4fee\u6539\u7684\u65b9\u6cd5\uff0c\u53ea\u9700\u8981\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u91cc\u4e0b\u9762\u8fd9\u4e2a\u53c2\u6570\u9879\u7684\u503c\u5c31\u53ef\u4ee5\u3002</p> Bash<pre><code>repl-backlog-size 1mb\n</code></pre>"},{"location":"redis/cluster/master_slave_replication/#_6","title":"\u603b\u7ed3","text":"<p>\u4e3b\u4ece\u590d\u5236\u5171\u6709\u4e09\u79cd\u6a21\u5f0f\uff1a\u5168\u91cf\u590d\u5236\u3001\u57fa\u4e8e\u957f\u8fde\u63a5\u7684\u547d\u4ee4\u4f20\u64ad\u3001\u589e\u91cf\u590d\u5236\u3002</p> <p>\u4e3b\u4ece\u670d\u52a1\u5668\u7b2c\u4e00\u6b21\u540c\u6b65\u7684\u65f6\u5019\uff0c\u5c31\u662f\u91c7\u7528\u5168\u91cf\u590d\u5236\uff0c\u6b64\u65f6\u4e3b\u670d\u52a1\u5668\u4f1a\u6709\u4e24\u4e2a\u8017\u65f6\u7684\u5730\u65b9\uff0c\u5206\u522b\u662f\u751f\u6210 RDB \u6587\u4ef6\u548c\u4f20\u8f93 RDB \u6587\u4ef6\u3002\u4e3a\u4e86\u907f\u514d\u8fc7\u591a\u7684\u4ece\u670d\u52a1\u5668\u548c\u4e3b\u670d\u52a1\u5668\u8fdb\u884c\u5168\u91cf\u590d\u5236\uff0c\u53ef\u4ee5\u628a\u4e00\u90e8\u5206\u4ece\u670d\u52a1\u5668\u5347\u7ea7\u4e3a\u300c\u7ecf\u7406\u89d2\u8272\u300d\uff0c\u8ba9\u5b83\u4e5f\u6709\u81ea\u5df1\u7684\u4ece\u670d\u52a1\u5668\uff0c\u901a\u8fc7\u8fd9\u6837\u53ef\u4ee5\u5206\u644a\u4e3b\u670d\u52a1\u5668\u7684\u538b\u529b\u3002</p> <p>\u7b2c\u4e00\u6b21\u540c\u6b65\u5b8c\u6210\u540e\uff0c\u4e3b\u4ece\u670d\u52a1\u5668\u90fd\u4f1a\u7ef4\u62a4\u7740\u4e00\u4e2a\u957f\u8fde\u63a5\uff0c\u4e3b\u670d\u52a1\u5668\u5728\u63a5\u6536\u5230\u5199\u64cd\u4f5c\u547d\u4ee4\u540e\uff0c\u5c31\u4f1a\u901a\u8fc7\u8fd9\u4e2a\u8fde\u63a5\u5c06\u5199\u547d\u4ee4\u4f20\u64ad\u7ed9\u4ece\u670d\u52a1\u5668\uff0c\u6765\u4fdd\u8bc1\u4e3b\u4ece\u670d\u52a1\u5668\u7684\u6570\u636e\u4e00\u81f4\u6027\u3002</p> <p>\u5982\u679c\u9047\u5230\u7f51\u7edc\u65ad\u5f00\uff0c\u589e\u91cf\u590d\u5236\u5c31\u53ef\u4ee5\u4e0a\u573a\u4e86\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u8fd8\u8ddf repl_backlog_size \u8fd9\u4e2a\u5927\u5c0f\u6709\u5173\u7cfb\u3002</p> <p>\u5982\u679c\u5b83\u914d\u7f6e\u7684\u8fc7\u5c0f\uff0c\u4e3b\u4ece\u670d\u52a1\u5668\u7f51\u7edc\u6062\u590d\u65f6\uff0c\u53ef\u80fd\u53d1\u751f\u300c\u4ece\u670d\u52a1\u5668\u300d\u60f3\u8bfb\u7684\u6570\u636e\u5df2\u7ecf\u88ab\u8986\u76d6\u4e86\uff0c\u90a3\u4e48\u8fd9\u65f6\u5c31\u4f1a\u5bfc\u81f4\u4e3b\u670d\u52a1\u5668\u91c7\u7528\u5168\u91cf\u590d\u5236\u7684\u65b9\u5f0f\u3002\u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u7684\u9891\u7e41\u53d1\u751f\uff0c\u8981\u8c03\u5927\u8fd9\u4e2a\u53c2\u6570\u7684\u503c\uff0c\u4ee5\u964d\u4f4e\u4e3b\u4ece\u670d\u52a1\u5668\u65ad\u5f00\u540e\u5168\u91cf\u540c\u6b65\u7684\u6982\u7387\u3002</p>"},{"location":"redis/cluster/master_slave_replication/#_7","title":"\u9762\u8bd5\u9898","text":""},{"location":"redis/cluster/master_slave_replication/#redis","title":"Redis \u4e3b\u4ece\u8282\u70b9\u662f\u957f\u8fde\u63a5\u8fd8\u662f\u77ed\u94fe\u63a5\uff1f","text":"<p>\u957f\u8fde\u63a5</p>"},{"location":"redis/cluster/master_slave_replication/#redis_1","title":"\u600e\u4e48\u5224\u65ad Redis \u67d0\u4e2a\u8282\u70b9\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\uff1f","text":"<p>Redis \u5224\u65ad\u8282\u70b9\u662f\u5426\u6b63\u5e38\u5de5\u4f5c\uff0c\u57fa\u672c\u90fd\u662f\u901a\u8fc7\u4e92\u76f8\u7684 ping-pong \u5fc3\u8df3\u68c0\u6d4b\u673a\u5236\uff0c\u5982\u679c\u6709\u4e00\u534a\u4ee5\u4e0a\u7684\u8282\u70b9\u53bb ping \u4e00\u4e2a\u8282\u70b9\u7684\u65f6\u5019\u6ca1\u6709 pong \u56de\u5e94\uff0c\u96c6\u7fa4\u5c31\u4f1a\u8ba4\u4e3a\u8fd9\u4e2a\u8282\u70b9\u6302\u6389\u4e86\uff0c\u4f1a\u65ad\u5f00\u4e0e\u8fd9\u4e2a\u8282\u70b9\u7684\u8fde\u63a5\u3002</p> <p>Redis \u4e3b\u4ece\u8282\u70b9\u53d1\u9001\u7684\u5fc3\u8df3\u95f4\u9694\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u800c\u4e14\u4f5c\u7528\u4e5f\u6709\u4e00\u70b9\u533a\u522b\uff1a</p> <ul> <li>Redis \u4e3b\u8282\u70b9\u9ed8\u8ba4\u6bcf\u9694 10 \u79d2\u5bf9\u4ece\u8282\u70b9\u53d1\u9001 ping \u547d\u4ee4\uff0c\u5224\u65ad\u4ece\u8282\u70b9\u7684\u5b58\u6d3b\u6027\u548c\u8fde\u63a5\u72b6\u6001\uff0c\u53ef\u901a\u8fc7\u53c2\u6570 repl-ping-slave-period \u63a7\u5236\u53d1\u9001\u9891\u7387\u3002</li> <li>Redis \u4ece\u8282\u70b9\u6bcf\u9694 1 \u79d2\u53d1\u9001 replconf ack{offset} \u547d\u4ee4\uff0c\u7ed9\u4e3b\u8282\u70b9\u4e0a\u62a5\u81ea\u8eab\u5f53\u524d\u7684\u590d\u5236\u504f\u79fb\u91cf\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\uff1a</li> <li>\u5b9e\u65f6\u76d1\u6d4b\u4e3b\u4ece\u8282\u70b9\u7f51\u7edc\u72b6\u6001\uff1b</li> <li>\u4e0a\u62a5\u81ea\u8eab\u590d\u5236\u504f\u79fb\u91cf\uff0c\u68c0\u67e5\u590d\u5236\u6570\u636e\u662f\u5426\u4e22\u5931\uff0c\u5982\u679c\u4ece\u8282\u70b9\u6570\u636e\u4e22\u5931\uff0c\u518d\u4ece\u4e3b\u8282\u70b9\u7684\u590d\u5236\u7f13\u51b2\u533a\u4e2d\u62c9\u53d6\u4e22\u5931\u6570\u636e\u3002</li> </ul>"},{"location":"redis/cluster/master_slave_replication/#key","title":"\u4e3b\u4ece\u590d\u5236\u67b6\u6784\u4e2d\uff0c\u8fc7\u671f key \u5982\u4f55\u5904\u7406\uff1f","text":"<p>\u4e3b\u8282\u70b9\u5904\u7406\u4e86\u4e00\u4e2a key \u6216\u8005\u901a\u8fc7\u6dd8\u6c70\u7b97\u6cd5\u6dd8\u6c70\u4e86\u4e00\u4e2a key\uff0c\u8fd9\u4e2a\u65f6\u95f4\u4e3b\u8282\u70b9\u6a21\u62df\u4e00\u6761 del \u547d\u4ee4\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\uff0c\u4ece\u8282\u70b9\u6536\u5230\u8be5\u547d\u4ee4\u540e\uff0c\u5c31\u8fdb\u884c\u5220\u9664 key \u7684\u64cd\u4f5c\u3002</p>"},{"location":"redis/cluster/master_slave_replication/#redis_2","title":"Redis \u662f\u540c\u6b65\u590d\u5236\u8fd8\u662f\u5f02\u6b65\u590d\u5236\uff1f","text":"<p>Redis \u4e3b\u8282\u70b9\u6bcf\u6b21\u6536\u5230\u5199\u547d\u4ee4\u4e4b\u540e\uff0c\u5148\u5199\u5230\u5185\u90e8\u7684\u7f13\u51b2\u533a\uff0c\u7136\u540e\u5f02\u6b65\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\u3002</p>"},{"location":"redis/cluster/master_slave_replication/#bufferreplication-bufferrepl-backlog-buffer","title":"\u4e3b\u4ece\u590d\u5236\u4e2d\u4e24\u4e2a Buffer(replication buffer\u3001repl backlog buffer) \u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>replication buffer\u3001repl backlog buffer \u533a\u522b\u5982\u4e0b\uff1a</p> <ul> <li>\u51fa\u73b0\u7684\u9636\u6bb5\u4e0d\u4e00\u6837\uff1a</li> <li>repl backlog buffer \u662f\u5728\u589e\u91cf\u590d\u5236\u9636\u6bb5\u51fa\u73b0\uff0c\u4e00\u4e2a\u4e3b\u8282\u70b9\u53ea\u5206\u914d\u4e00\u4e2a repl backlog buffer\uff1b</li> <li>replication buffer \u662f\u5728\u5168\u91cf\u590d\u5236\u9636\u6bb5\u548c\u589e\u91cf\u590d\u5236\u9636\u6bb5\u90fd\u4f1a\u51fa\u73b0\uff0c\u4e3b\u8282\u70b9\u4f1a\u7ed9\u6bcf\u4e2a\u65b0\u8fde\u63a5\u7684\u4ece\u8282\u70b9\uff0c\u5206\u914d\u4e00\u4e2a replication buffer\uff1b</li> <li>\u8fd9\u4e24\u4e2a Buffer \u90fd\u6709\u5927\u5c0f\u9650\u5236\u7684\uff0c\u5f53\u7f13\u51b2\u533a\u6ee1\u4e86\u4e4b\u540e\uff0c\u53d1\u751f\u7684\u4e8b\u60c5\u4e0d\u4e00\u6837\uff1a</li> <li>\u5f53 repl backlog buffer \u6ee1\u4e86\uff0c\u56e0\u4e3a\u662f\u73af\u5f62\u7ed3\u6784\uff0c\u4f1a\u76f4\u63a5\u8986\u76d6\u8d77\u59cb\u4f4d\u7f6e\u6570\u636e;</li> <li>\u5f53 replication buffer \u6ee1\u4e86\uff0c\u4f1a\u5bfc\u81f4\u8fde\u63a5\u65ad\u5f00\uff0c\u5220\u9664\u7f13\u5b58\uff0c\u4ece\u8282\u70b9\u91cd\u65b0\u8fde\u63a5\uff0c\u91cd\u65b0\u5f00\u59cb\u5168\u91cf\u590d\u5236\u3002</li> </ul>"},{"location":"redis/cluster/master_slave_replication/#_8","title":"\u5982\u4f55\u5e94\u5bf9\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\uff1f","text":"<p>\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\uff1f</p> <p>\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u5c31\u662f\u6307\u5ba2\u6237\u7aef\u4ece\u4ece\u8282\u70b9\u4e2d\u8bfb\u53d6\u5230\u7684\u503c\u548c\u4e3b\u8282\u70b9\u4e2d\u7684\u6700\u65b0\u503c\u5e76\u4e0d\u4e00\u81f4\u3002</p> <p>\u4e4b\u6240\u4ee5\u4f1a\u51fa\u73b0\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\u7684\u73b0\u8c61\uff0c\u662f\u56e0\u4e3a\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u547d\u4ee4\u590d\u5236\u662f\u5f02\u6b65\u8fdb\u884c\u7684\uff0c\u6240\u4ee5\u65e0\u6cd5\u5b9e\u73b0\u5f3a\u4e00\u81f4\u6027\u4fdd\u8bc1\uff08\u4e3b\u4ece\u6570\u636e\u65f6\u65f6\u523b\u523b\u4fdd\u6301\u4e00\u81f4\uff09\u3002</p> <p>\u5177\u4f53\u6765\u8bf4\uff0c\u5728\u4e3b\u4ece\u8282\u70b9\u547d\u4ee4\u4f20\u64ad\u9636\u6bb5\uff0c\u4e3b\u8282\u70b9\u6536\u5230\u65b0\u7684\u5199\u547d\u4ee4\u540e\uff0c\u4f1a\u53d1\u9001\u7ed9\u4ece\u8282\u70b9\u3002\u4f46\u662f\uff0c\u4e3b\u8282\u70b9\u5e76\u4e0d\u4f1a\u7b49\u5230\u4ece\u8282\u70b9\u5b9e\u9645\u6267\u884c\u5b8c\u547d\u4ee4\u540e\uff0c\u518d\u628a\u7ed3\u679c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u800c\u662f\u4e3b\u8282\u70b9\u81ea\u5df1\u5728\u672c\u5730\u6267\u884c\u5b8c\u547d\u4ee4\u540e\uff0c\u5c31\u4f1a\u5411\u5ba2\u6237\u7aef\u8fd4\u56de\u7ed3\u679c\u4e86\u3002\u5982\u679c\u4ece\u8282\u70b9\u8fd8\u6ca1\u6709\u6267\u884c\u4e3b\u8282\u70b9\u540c\u6b65\u8fc7\u6765\u7684\u547d\u4ee4\uff0c\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u6570\u636e\u5c31\u4e0d\u4e00\u81f4\u4e86\u3002</p> <p>\u5982\u4f55\u5982\u4f55\u5e94\u5bf9\u4e3b\u4ece\u6570\u636e\u4e0d\u4e00\u81f4\uff1f</p> <p>\u7b2c\u4e00\u79cd\u65b9\u6cd5\uff0c\u5c3d\u91cf\u4fdd\u8bc1\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u51b5\u826f\u597d\uff0c\u907f\u514d\u4e3b\u4ece\u8282\u70b9\u5728\u4e0d\u540c\u7684\u673a\u623f\u3002</p> <p>\u7b2c\u4e8c\u79cd\u65b9\u6cd5\uff0c\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a\u5916\u90e8\u7a0b\u5e8f\u6765\u76d1\u63a7\u4e3b\u4ece\u8282\u70b9\u95f4\u7684\u590d\u5236\u8fdb\u5ea6\u3002\u5177\u4f53\u505a\u6cd5\uff1a</p> <ul> <li>Redis \u7684 INFO replication \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u4e3b\u8282\u70b9\u63a5\u6536\u5199\u547d\u4ee4\u7684\u8fdb\u5ea6\u4fe1\u606f\uff08master_repl_offset\uff09\u548c\u4ece\u8282\u70b9\u590d\u5236\u5199\u547d\u4ee4\u7684\u8fdb\u5ea6\u4fe1\u606f\uff08slave_repl_offset\uff09\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5f00\u53d1\u4e00\u4e2a\u76d1\u63a7\u7a0b\u5e8f\uff0c\u5148\u7528 INFO replication \u547d\u4ee4\u67e5\u5230\u4e3b\u3001\u4ece\u8282\u70b9\u7684\u8fdb\u5ea6\uff0c\u7136\u540e\uff0c\u6211\u4eec\u7528 master_repl_offset \u51cf\u53bb slave_repl_offset\uff0c\u8fd9\u6837\u5c31\u80fd\u5f97\u5230\u4ece\u8282\u70b9\u548c\u4e3b\u8282\u70b9\u95f4\u7684\u590d\u5236\u8fdb\u5ea6\u5dee\u503c\u4e86\u3002</li> <li>\u5982\u679c\u67d0\u4e2a\u4ece\u8282\u70b9\u7684\u8fdb\u5ea6\u5dee\u503c\u5927\u4e8e\u6211\u4eec\u9884\u8bbe\u7684\u9608\u503c\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u5ba2\u6237\u7aef\u4e0d\u518d\u548c\u8fd9\u4e2a\u4ece\u8282\u70b9\u8fde\u63a5\u8fdb\u884c\u6570\u636e\u8bfb\u53d6\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u8bfb\u5230\u4e0d\u4e00\u81f4\u6570\u636e\u7684\u60c5\u51b5\u3002\u4e0d\u8fc7\uff0c\u4e3a\u4e86\u907f\u514d\u51fa\u73b0\u5ba2\u6237\u7aef\u548c\u6240\u6709\u4ece\u8282\u70b9\u90fd\u4e0d\u80fd\u8fde\u63a5\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u9700\u8981\u628a\u590d\u5236\u8fdb\u5ea6\u5dee\u503c\u7684\u9608\u503c\u8bbe\u7f6e\u5f97\u5927\u4e00\u4e9b\u3002</li> </ul>"},{"location":"redis/cluster/master_slave_replication/#_9","title":"\u4e3b\u4ece\u5207\u6362\u5982\u4f55\u51cf\u5c11\u6570\u636e\u4e22\u5931\uff1f","text":"<p>\u4e3b\u4ece\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u4ea7\u751f\u6570\u636e\u4e22\u5931\u7684\u60c5\u51b5\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u5f02\u6b65\u590d\u5236\u540c\u6b65\u4e22\u5931</li> <li>\u96c6\u7fa4\u4ea7\u751f\u8111\u88c2\u6570\u636e\u4e22\u5931</li> </ul> <p>\u6211\u4eec\u4e0d\u53ef\u80fd\u4fdd\u8bc1\u6570\u636e\u5b8c\u5168\u4e0d\u4e22\u5931\uff0c\u53ea\u80fd\u505a\u5230\u4f7f\u5f97\u5c3d\u91cf\u5c11\u7684\u6570\u636e\u4e22\u5931\u3002</p>"},{"location":"redis/cluster/master_slave_replication/#_10","title":"\u5f02\u6b65\u590d\u5236\u540c\u6b65\u4e22\u5931","text":"<p>\u5bf9\u4e8e Redis \u4e3b\u8282\u70b9\u4e0e\u4ece\u8282\u70b9\u4e4b\u95f4\u7684\u6570\u636e\u590d\u5236\uff0c\u662f\u5f02\u6b65\u590d\u5236\u7684\uff0c\u5f53\u5ba2\u6237\u7aef\u53d1\u9001\u5199\u8bf7\u6c42\u7ed9\u4e3b\u8282\u70b9\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u4f1a\u8fd4\u56de ok\uff0c\u63a5\u7740\u4e3b\u8282\u70b9\u5c06\u5199\u8bf7\u6c42\u5f02\u6b65\u540c\u6b65\u7ed9\u5404\u4e2a\u4ece\u8282\u70b9\uff0c\u4f46\u662f\u5982\u679c\u6b64\u65f6\u4e3b\u8282\u70b9\u8fd8\u6ca1\u6765\u5f97\u53ca\u540c\u6b65\u7ed9\u4ece\u8282\u70b9\u65f6\u53d1\u751f\u4e86\u65ad\u7535\uff0c\u90a3\u4e48\u4e3b\u8282\u70b9\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4f1a\u4e22\u5931\u3002</p> <p>\u51cf\u5c11\u5f02\u6b65\u590d\u5236\u7684\u6570\u636e\u4e22\u5931\u7684\u65b9\u6848</p> <p>Redis \u914d\u7f6e\u91cc\u6709\u4e00\u4e2a\u53c2\u6570 min-slaves-max-lag\uff0c\u8868\u793a\u4e00\u65e6\u6240\u6709\u7684\u4ece\u8282\u70b9\u6570\u636e\u590d\u5236\u548c\u540c\u6b65\u7684\u5ef6\u8fdf\u90fd\u8d85\u8fc7\u4e86 min-slaves-max-lag \u5b9a\u4e49\u7684\u503c\uff0c\u90a3\u4e48\u4e3b\u8282\u70b9\u5c31\u4f1a\u62d2\u7edd\u63a5\u6536\u4efb\u4f55\u8bf7\u6c42\u3002</p> <p>\u5047\u8bbe\u5c06 min-slaves-max-lag \u914d\u7f6e\u4e3a 10s \u540e\uff0c\u6839\u636e\u76ee\u524d master-&gt;slave \u7684\u590d\u5236\u901f\u5ea6\uff0c\u5982\u679c\u6570\u636e\u540c\u6b65\u5b8c\u6210\u6240\u9700\u8981\u65f6\u95f4\u8d85\u8fc7 10s\uff0c\u5c31\u4f1a\u8ba4\u4e3a master \u672a\u6765\u5b95\u673a\u540e\u635f\u5931\u7684\u6570\u636e\u4f1a\u5f88\u591a\uff0cmaster \u5c31\u62d2\u7edd\u5199\u5165\u65b0\u8bf7\u6c42\u3002\u8fd9\u6837\u5c31\u80fd\u5c06 master \u548c slave \u6570\u636e\u5dee\u63a7\u5236\u5728 10s \u5185\uff0c\u5373\u4f7f master \u5b95\u673a\u4e5f\u53ea\u662f\u8fd9\u672a\u590d\u5236\u7684 10s \u6570\u636e\u3002</p> <p>\u90a3\u4e48\u5bf9\u4e8e\u5ba2\u6237\u7aef\uff0c\u5f53\u5ba2\u6237\u7aef\u53d1\u73b0 master \u4e0d\u53ef\u5199\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u91c7\u53d6\u964d\u7ea7\u63aa\u65bd\uff0c\u5c06\u6570\u636e\u6682\u65f6\u5199\u5165\u672c\u5730\u7f13\u5b58\u548c\u78c1\u76d8\u4e2d\uff0c\u5728\u4e00\u6bb5\u65f6\u95f4\uff08\u7b49 master \u6062\u590d\u6b63\u5e38\uff09\u540e\u91cd\u65b0\u5199\u5165 master \u6765\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4e5f\u53ef\u4ee5\u5c06\u6570\u636e\u5199\u5165 kafka \u6d88\u606f\u961f\u5217\uff0c\u7b49 master \u6062\u590d\u6b63\u5e38\uff0c\u518d\u9694\u4e00\u6bb5\u65f6\u95f4\u53bb\u6d88\u8d39 kafka \u4e2d\u7684\u6570\u636e\uff0c\u8ba9\u5c06\u6570\u636e\u91cd\u65b0\u5199\u5165 master\u3002</p>"},{"location":"redis/cluster/master_slave_replication/#_11","title":"\u96c6\u7fa4\u4ea7\u751f\u8111\u88c2\u6570\u636e\u4e22\u5931","text":"<p>\u5148\u6765\u7406\u89e3\u96c6\u7fa4\u7684\u8111\u88c2\u73b0\u8c61\uff0c\u8fd9\u5c31\u597d\u6bd4\u4e00\u4e2a\u4eba\u6709\u4e24\u4e2a\u5927\u8111\uff0c\u90a3\u4e48\u5230\u5e95\u53d7\u8c01\u63a7\u5236\u5462\uff1f</p> <p>\u90a3\u4e48\u5728 Redis \u4e2d\uff0c\u96c6\u7fa4\u8111\u88c2\u4ea7\u751f\u6570\u636e\u4e22\u5931\u7684\u73b0\u8c61\u662f\u600e\u6837\u7684\u5462\uff1f</p> <p>\u5728 Redis \u4e3b\u4ece\u67b6\u6784\u4e2d\uff0c\u90e8\u7f72\u65b9\u5f0f\u4e00\u822c\u662f\u300c\u4e00\u4e3b\u591a\u4ece\u300d\uff0c\u4e3b\u8282\u70b9\u63d0\u4f9b\u5199\u64cd\u4f5c\uff0c\u4ece\u8282\u70b9\u63d0\u4f9b\u8bfb\u64cd\u4f5c\u3002</p> <p>\u5982\u679c\u4e3b\u8282\u70b9\u7684\u7f51\u7edc\u7a81\u7136\u53d1\u751f\u4e86\u95ee\u9898\uff0c\u5b83\u4e0e\u6240\u6709\u7684\u4ece\u8282\u70b9\u90fd\u5931\u8054\u4e86\uff0c\u4f46\u662f\u6b64\u65f6\u7684\u4e3b\u8282\u70b9\u548c\u5ba2\u6237\u7aef\u7684\u7f51\u7edc\u662f\u6b63\u5e38\u7684\uff0c\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5e76\u4e0d\u77e5\u9053 Redis \u5185\u90e8\u5df2\u7ecf\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u8fd8\u5728\u7167\u6837\u7684\u5411\u8fd9\u4e2a\u5931\u8054\u7684\u4e3b\u8282\u70b9\u5199\u6570\u636e\uff08\u8fc7\u7a0b A\uff09\uff0c\u6b64\u65f6\u8fd9\u4e9b\u6570\u636e\u88ab\u4e3b\u8282\u70b9\u7f13\u5b58\u5230\u4e86\u7f13\u51b2\u533a\u91cc\uff0c\u56e0\u4e3a\u4e3b\u4ece\u8282\u70b9\u4e4b\u95f4\u7684\u7f51\u7edc\u95ee\u9898\uff0c\u8fd9\u4e9b\u6570\u636e\u90fd\u662f\u65e0\u6cd5\u540c\u6b65\u7ed9\u4ece\u8282\u70b9\u7684\u3002</p> <p>\u8fd9\u65f6\uff0c\u54e8\u5175\u4e5f\u53d1\u73b0\u4e3b\u8282\u70b9\u5931\u8054\u4e86\uff0c\u5b83\u5c31\u8ba4\u4e3a\u4e3b\u8282\u70b9\u6302\u4e86\uff08\u4f46\u5b9e\u9645\u4e0a\u4e3b\u8282\u70b9\u6b63\u5e38\u8fd0\u884c\uff0c\u53ea\u662f\u7f51\u7edc\u51fa\u95ee\u9898\u4e86\uff09\uff0c\u4e8e\u662f\u54e8\u5175\u5c31\u4f1a\u5728\u4ece\u8282\u70b9\u4e2d\u9009\u4e3e\u51fa\u4e00\u4e2a leader \u4f5c\u4e3a\u4e3b\u8282\u70b9\uff0c\u8fd9\u65f6\u96c6\u7fa4\u5c31\u6709\u4e24\u4e2a\u4e3b\u8282\u70b9\u4e86  \u2014\u2014 \u8111\u88c2\u51fa\u73b0\u4e86\u3002</p> <p>\u8fd9\u65f6\u5019\u7f51\u7edc\u7a81\u7136\u597d\u4e86\uff0c\u54e8\u5175\u56e0\u4e3a\u4e4b\u524d\u5df2\u7ecf\u9009\u4e3e\u51fa\u4e00\u4e2a\u65b0\u4e3b\u8282\u70b9\u4e86\uff0c\u5b83\u5c31\u4f1a\u628a\u65e7\u4e3b\u8282\u70b9\u964d\u7ea7\u4e3a\u4ece\u8282\u70b9\uff08A\uff09\uff0c\u7136\u540e\u4ece\u8282\u70b9\uff08A\uff09\u4f1a\u5411\u65b0\u4e3b\u8282\u70b9\u8bf7\u6c42\u6570\u636e\u540c\u6b65\uff0c\u56e0\u4e3a\u7b2c\u4e00\u6b21\u540c\u6b65\u662f\u5168\u91cf\u540c\u6b65\u7684\u65b9\u5f0f\uff0c\u6b64\u65f6\u7684\u4ece\u8282\u70b9\uff08A\uff09\u4f1a\u6e05\u7a7a\u6389\u81ea\u5df1\u672c\u5730\u7684\u6570\u636e\uff0c\u7136\u540e\u518d\u505a\u5168\u91cf\u540c\u6b65\u3002\u6240\u4ee5\uff0c\u4e4b\u524d\u5ba2\u6237\u7aef\u5728\u8fc7\u7a0b A \u5199\u5165\u7684\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u4e86\uff0c\u4e5f\u5c31\u662f\u96c6\u7fa4\u4ea7\u751f\u8111\u88c2\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u3002</p> <p>\u603b\u7ed3\u4e00\u53e5\u8bdd\u5c31\u662f\uff1a\u7531\u4e8e\u7f51\u7edc\u95ee\u9898\uff0c\u96c6\u7fa4\u8282\u70b9\u4e4b\u95f4\u5931\u53bb\u8054\u7cfb\u3002\u4e3b\u4ece\u6570\u636e\u4e0d\u540c\u6b65\uff1b\u91cd\u65b0\u5e73\u8861\u9009\u4e3e\uff0c\u4ea7\u751f\u4e24\u4e2a\u4e3b\u670d\u52a1\u3002\u7b49\u7f51\u7edc\u6062\u590d\uff0c\u65e7\u4e3b\u8282\u70b9\u4f1a\u964d\u7ea7\u4e3a\u4ece\u8282\u70b9\uff0c\u518d\u4e0e\u65b0\u4e3b\u8282\u70b9\u8fdb\u884c\u540c\u6b65\u590d\u5236\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u4f1a\u4ece\u8282\u70b9\u4f1a\u6e05\u7a7a\u81ea\u5df1\u7684\u7f13\u51b2\u533a\uff0c\u6240\u4ee5\u5bfc\u81f4\u4e4b\u524d\u5ba2\u6237\u7aef\u5199\u5165\u7684\u6570\u636e\u4e22\u5931\u4e86\u3002</p> <p>\u51cf\u5c11\u8111\u88c2\u7684\u6570\u636e\u4e22\u7684\u65b9\u6848</p> <p>\u5f53\u4e3b\u8282\u70b9\u53d1\u73b0\u300c\u4ece\u8282\u70b9\u4e0b\u7ebf\u7684\u6570\u91cf\u592a\u591a\u300d\uff0c\u6216\u8005\u300c\u7f51\u7edc\u5ef6\u8fdf\u592a\u5927\u300d\u7684\u65f6\u5019\uff0c\u90a3\u4e48\u4e3b\u8282\u70b9\u4f1a\u7981\u6b62\u5199\u64cd\u4f5c\uff0c\u76f4\u63a5\u628a\u9519\u8bef\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u5728 Redis \u7684\u914d\u7f6e\u6587\u4ef6\u4e2d\u6709\u4e24\u4e2a\u53c2\u6570\u6211\u4eec\u53ef\u4ee5\u8bbe\u7f6e\uff1a</p> <ul> <li>min-slaves-to-write x\uff0c\u4e3b\u8282\u70b9\u5fc5\u987b\u8981\u6709\u81f3\u5c11 x \u4e2a\u4ece\u8282\u70b9\u8fde\u63a5\uff0c\u5982\u679c\u5c0f\u4e8e\u8fd9\u4e2a\u6570\uff0c\u4e3b\u8282\u70b9\u4f1a\u7981\u6b62\u5199\u6570\u636e\u3002</li> <li>min-slaves-max-lag x\uff0c\u4e3b\u4ece\u6570\u636e\u590d\u5236\u548c\u540c\u6b65\u7684\u5ef6\u8fdf\u4e0d\u80fd\u8d85\u8fc7 x \u79d2\uff0c\u5982\u679c\u8d85\u8fc7\uff0c\u4e3b\u8282\u70b9\u4f1a\u7981\u6b62\u5199\u6570\u636e\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u628a min-slaves-to-write \u548c min-slaves-max-lag \u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u642d\u914d\u8d77\u6765\u4f7f\u7528\uff0c\u5206\u522b\u7ed9\u5b83\u4eec\u8bbe\u7f6e\u4e00\u5b9a\u7684\u9608\u503c\uff0c\u5047\u8bbe\u4e3a N \u548c T\u3002</p> <p>\u8fd9\u4e24\u4e2a\u914d\u7f6e\u9879\u7ec4\u5408\u540e\u7684\u8981\u6c42\u662f\uff0c\u4e3b\u8282\u70b9\u8fde\u63a5\u7684\u4ece\u8282\u70b9\u4e2d\u81f3\u5c11\u6709 N \u4e2a\u4ece\u8282\u70b9\uff0c\u300c\u5e76\u4e14\u300d\u4e3b\u8282\u70b9\u8fdb\u884c\u6570\u636e\u590d\u5236\u65f6\u7684 ACK \u6d88\u606f\u5ef6\u8fdf\u4e0d\u80fd\u8d85\u8fc7 T \u79d2\uff0c\u5426\u5219\uff0c\u4e3b\u8282\u70b9\u5c31\u4e0d\u4f1a\u518d\u63a5\u6536\u5ba2\u6237\u7aef\u7684\u5199\u8bf7\u6c42\u4e86\u3002</p> <p>\u5373\u4f7f\u539f\u4e3b\u8282\u70b9\u662f\u5047\u6545\u969c\uff0c\u5b83\u5728\u5047\u6545\u969c\u671f\u95f4\u4e5f\u65e0\u6cd5\u54cd\u5e94\u54e8\u5175\u5fc3\u8df3\uff0c\u4e5f\u4e0d\u80fd\u548c\u4ece\u8282\u70b9\u8fdb\u884c\u540c\u6b65\uff0c\u81ea\u7136\u4e5f\u5c31\u65e0\u6cd5\u548c\u4ece\u8282\u70b9\u8fdb\u884c ACK \u786e\u8ba4\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0cmin-slaves-to-write \u548c min-slaves-max-lag \u7684\u7ec4\u5408\u8981\u6c42\u5c31\u65e0\u6cd5\u5f97\u5230\u6ee1\u8db3\uff0c\u539f\u4e3b\u8282\u70b9\u5c31\u4f1a\u88ab\u9650\u5236\u63a5\u6536\u5ba2\u6237\u7aef\u5199\u8bf7\u6c42\uff0c\u5ba2\u6237\u7aef\u4e5f\u5c31\u4e0d\u80fd\u5728\u539f\u4e3b\u8282\u70b9\u4e2d\u5199\u5165\u65b0\u6570\u636e\u4e86\u3002</p> <p>\u7b49\u5230\u65b0\u4e3b\u8282\u70b9\u4e0a\u7ebf\u65f6\uff0c\u5c31\u53ea\u6709\u65b0\u4e3b\u8282\u70b9\u80fd\u63a5\u6536\u548c\u5904\u7406\u5ba2\u6237\u7aef\u8bf7\u6c42\uff0c\u6b64\u65f6\uff0c\u65b0\u5199\u7684\u6570\u636e\u4f1a\u88ab\u76f4\u63a5\u5199\u5230\u65b0\u4e3b\u8282\u70b9\u4e2d\u3002\u800c\u539f\u4e3b\u8282\u70b9\u4f1a\u88ab\u54e8\u5175\u964d\u4e3a\u4ece\u8282\u70b9\uff0c\u5373\u4f7f\u5b83\u7684\u6570\u636e\u88ab\u6e05\u7a7a\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u6709\u65b0\u6570\u636e\u4e22\u5931\u3002\u6211\u518d\u6765\u7ed9\u4f60\u4e3e\u4e2a\u4f8b\u5b50\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u5c06 min-slaves-to-write \u8bbe\u7f6e\u4e3a 1\uff0c\u628a min-slaves-max-lag \u8bbe\u7f6e\u4e3a 12s\uff0c\u628a\u54e8\u5175\u7684 down-after-milliseconds \u8bbe\u7f6e\u4e3a 10s\uff0c\u4e3b\u8282\u70b9\u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u5361\u4f4f\u4e86 15s\uff0c\u5bfc\u81f4\u54e8\u5175\u5224\u65ad\u4e3b\u8282\u70b9\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u5f00\u59cb\u8fdb\u884c\u4e3b\u4ece\u5207\u6362\u3002\u540c\u65f6\uff0c\u56e0\u4e3a\u539f\u4e3b\u8282\u70b9\u5361\u4f4f\u4e86 15s\uff0c\u6ca1\u6709\u4e00\u4e2a\u4ece\u8282\u70b9\u80fd\u548c\u539f\u4e3b\u8282\u70b9\u5728 12s \u5185\u8fdb\u884c\u6570\u636e\u590d\u5236\uff0c\u539f\u4e3b\u8282\u70b9\u4e5f\u65e0\u6cd5\u63a5\u6536\u5ba2\u6237\u7aef\u8bf7\u6c42\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e3b\u4ece\u5207\u6362\u5b8c\u6210\u540e\uff0c\u4e5f\u53ea\u6709\u65b0\u4e3b\u8282\u70b9\u80fd\u63a5\u6536\u8bf7\u6c42\uff0c\u4e0d\u4f1a\u53d1\u751f\u8111\u88c2\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u53d1\u751f\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u4e86\u3002</p>"},{"location":"redis/cluster/master_slave_replication/#_12","title":"\u4e3b\u4ece\u5982\u4f55\u505a\u5230\u6545\u969c\u81ea\u52a8\u5207\u6362\uff1f","text":"<p>\u4e3b\u8282\u70b9\u6302\u4e86\uff0c\u4ece\u8282\u70b9\u662f\u65e0\u6cd5\u81ea\u52a8\u5347\u7ea7\u4e3a\u4e3b\u8282\u70b9\u7684\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u9700\u8981\u4eba\u5de5\u5904\u7406\uff0c\u5728\u6b64\u671f\u95f4 Redis \u65e0\u6cd5\u5bf9\u5916\u63d0\u4f9b\u5199\u64cd\u4f5c\u3002</p> <p>\u6b64\u65f6\uff0cRedis \u54e8\u5175\u673a\u5236\u5c31\u767b\u573a\u4e86\uff0c\u54e8\u5175\u5728\u53d1\u73b0\u4e3b\u8282\u70b9\u51fa\u73b0\u6545\u969c\u65f6\uff0c\u7531\u54e8\u5175\u81ea\u52a8\u5b8c\u6210\u6545\u969c\u53d1\u73b0\u548c\u6545\u969c\u8f6c\u79fb\uff0c\u5e76\u901a\u77e5\u7ed9\u5e94\u7528\u65b9\uff0c\u4ece\u800c\u5b9e\u73b0\u9ad8\u53ef\u7528\u6027\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/cluster/sentinel/","title":"\u4e3a\u4ec0\u4e48\u8981\u6709\u54e8\u5175\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u8fd9\u6b21\u804a\u804a\uff0cRedis \u7684\u54e8\u5175\u673a\u5236\u3002</p> <p></p>"},{"location":"redis/cluster/sentinel/#_2","title":"\u4e3a\u4ec0\u4e48\u8981\u6709\u54e8\u5175\u673a\u5236\uff1f","text":"<p>\u5728 Redis \u7684\u4e3b\u4ece\u67b6\u6784\u4e2d\uff0c\u7531\u4e8e\u4e3b\u4ece\u6a21\u5f0f\u662f\u8bfb\u5199\u5206\u79bb\u7684\uff0c\u5982\u679c\u4e3b\u8282\u70b9\uff08master\uff09\u6302\u4e86\uff0c\u90a3\u4e48\u5c06\u6ca1\u6709\u4e3b\u8282\u70b9\u6765\u670d\u52a1\u5ba2\u6237\u7aef\u7684\u5199\u64cd\u4f5c\u8bf7\u6c42\uff0c\u4e5f\u6ca1\u6709\u4e3b\u8282\u70b9\u7ed9\u4ece\u8282\u70b9\uff08slave\uff09\u8fdb\u884c\u6570\u636e\u540c\u6b65\u4e86\u3002</p> <p></p> <p>\u8fd9\u65f6\u5982\u679c\u8981\u6062\u590d\u670d\u52a1\u7684\u8bdd\uff0c\u9700\u8981\u4eba\u5de5\u4ecb\u5165\uff0c\u9009\u62e9\u4e00\u4e2a\u300c\u4ece\u8282\u70b9\u300d\u5207\u6362\u4e3a\u300c\u4e3b\u8282\u70b9\u300d\uff0c\u7136\u540e\u8ba9\u5176\u4ed6\u4ece\u8282\u70b9\u6307\u5411\u65b0\u7684\u4e3b\u8282\u70b9\uff0c\u540c\u65f6\u8fd8\u9700\u8981\u901a\u77e5\u4e0a\u6e38\u90a3\u4e9b\u8fde\u63a5 Redis \u4e3b\u8282\u70b9\u7684\u5ba2\u6237\u7aef\uff0c\u5c06\u5176\u914d\u7f6e\u4e2d\u7684\u4e3b\u8282\u70b9 IP \u5730\u5740\u66f4\u65b0\u4e3a\u300c\u65b0\u4e3b\u8282\u70b9\u300d\u7684 IP \u5730\u5740\u3002</p> <p>\u8fd9\u6837\u4e5f\u4e0d\u592a\u201c\u667a\u80fd\u201d\u4e86\uff0c\u8981\u662f\u6709\u4e00\u4e2a\u8282\u70b9\u80fd\u76d1\u63a7\u300c\u4e3b\u8282\u70b9\u300d\u7684\u72b6\u6001\uff0c\u5f53\u53d1\u73b0\u4e3b\u8282\u70b9\u6302\u4e86\uff0c\u5b83\u81ea\u52a8\u5c06\u4e00\u4e2a\u300c\u4ece\u8282\u70b9\u300d\u5207\u6362\u4e3a\u300c\u4e3b\u8282\u70b9\u300d\u7684\u8bdd\uff0c\u90a3\u4e48\u53ef\u4ee5\u8282\u7701\u6211\u4eec\u5f88\u591a\u4e8b\u60c5\u554a\uff01</p> <p>Redis \u5728 2.8 \u7248\u672c\u4ee5\u540e\u63d0\u4f9b\u7684\u54e8\u5175\uff08Sentinel\uff09\u673a\u5236\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5b9e\u73b0\u4e3b\u4ece\u8282\u70b9\u6545\u969c\u8f6c\u79fb\u3002\u5b83\u4f1a\u76d1\u6d4b\u4e3b\u8282\u70b9\u662f\u5426\u5b58\u6d3b\uff0c\u5982\u679c\u53d1\u73b0\u4e3b\u8282\u70b9\u6302\u4e86\uff0c\u5b83\u5c31\u4f1a\u9009\u4e3e\u4e00\u4e2a\u4ece\u8282\u70b9\u5207\u6362\u4e3a\u4e3b\u8282\u70b9\uff0c\u5e76\u4e14\u628a\u65b0\u4e3b\u8282\u70b9\u7684\u76f8\u5173\u4fe1\u606f\u901a\u77e5\u7ed9\u4ece\u8282\u70b9\u548c\u5ba2\u6237\u7aef\u3002</p>"},{"location":"redis/cluster/sentinel/#_3","title":"\u54e8\u5175\u673a\u5236\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f","text":"<p>\u54e8\u5175\u5176\u5b9e\u662f\u4e00\u4e2a\u8fd0\u884c\u5728\u7279\u6b8a\u6a21\u5f0f\u4e0b\u7684 Redis \u8fdb\u7a0b\uff0c\u6240\u4ee5\u5b83\u4e5f\u662f\u4e00\u4e2a\u8282\u70b9\u3002\u4ece\u201c\u54e8\u5175\u201d\u8fd9\u4e2a\u540d\u5b57\u4e5f\u53ef\u4ee5\u770b\u5f97\u51fa\u6765\uff0c\u5b83\u76f8\u5f53\u4e8e\u662f\u201c\u89c2\u5bdf\u8005\u8282\u70b9\u201d\uff0c\u89c2\u5bdf\u7684\u5bf9\u8c61\u662f\u4e3b\u4ece\u8282\u70b9\u3002</p> <p>\u5f53\u7136\uff0c\u5b83\u4e0d\u4ec5\u4ec5\u662f\u89c2\u5bdf\u90a3\u4e48\u7b80\u5355\uff0c\u5728\u5b83\u89c2\u5bdf\u5230\u6709\u5f02\u5e38\u7684\u72b6\u51b5\u4e0b\uff0c\u4f1a\u505a\u51fa\u4e00\u4e9b\u201c\u52a8\u4f5c\u201d\uff0c\u6765\u4fee\u590d\u5f02\u5e38\u72b6\u6001\u3002</p> <p>\u54e8\u5175\u8282\u70b9\u4e3b\u8981\u8d1f\u8d23\u4e09\u4ef6\u4e8b\u60c5\uff1a\u76d1\u63a7\u3001\u9009\u4e3b\u3001\u901a\u77e5\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u91cd\u70b9\u8981\u5b66\u4e60\u8fd9\u4e09\u4ef6\u4e8b\u60c5\uff1a</p> <ul> <li>\u54e8\u5175\u8282\u70b9\u662f\u5982\u4f55\u76d1\u63a7\u8282\u70b9\u7684\uff1f\u53c8\u662f\u5982\u4f55\u5224\u65ad\u4e3b\u8282\u70b9\u662f\u5426\u771f\u7684\u6545\u969c\u4e86\uff1f</li> <li>\u6839\u636e\u4ec0\u4e48\u89c4\u5219\u9009\u62e9\u4e00\u4e2a\u4ece\u8282\u70b9\u5207\u6362\u4e3a\u4e3b\u8282\u70b9\uff1f</li> <li>\u600e\u4e48\u628a\u65b0\u4e3b\u8282\u70b9\u7684\u76f8\u5173\u4fe1\u606f\u901a\u77e5\u7ed9\u4ece\u8282\u70b9\u548c\u5ba2\u6237\u7aef\u5462\uff1f</li> </ul>"},{"location":"redis/cluster/sentinel/#_4","title":"\u5982\u4f55\u5224\u65ad\u4e3b\u8282\u70b9\u771f\u7684\u6545\u969c\u4e86\uff1f","text":"<p>\u54e8\u5175\u4f1a\u6bcf\u9694 1 \u79d2\u7ed9\u6240\u6709\u4e3b\u4ece\u8282\u70b9\u53d1\u9001 PING \u547d\u4ee4\uff0c\u5f53\u4e3b\u4ece\u8282\u70b9\u6536\u5230 PING \u547d\u4ee4\u540e\uff0c\u4f1a\u53d1\u9001\u4e00\u4e2a\u54cd\u5e94\u547d\u4ee4\u7ed9\u54e8\u5175\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5224\u65ad\u5b83\u4eec\u662f\u5426\u5728\u6b63\u5e38\u8fd0\u884c\u3002</p> <p></p> <p>\u5982\u679c\u4e3b\u8282\u70b9\u6216\u8005\u4ece\u8282\u70b9\u6ca1\u6709\u5728\u89c4\u5b9a\u7684\u65f6\u95f4\u5185\u54cd\u5e94\u54e8\u5175\u7684 PING \u547d\u4ee4\uff0c\u54e8\u5175\u5c31\u4f1a\u5c06\u5b83\u4eec\u6807\u8bb0\u4e3a\u300c\u4e3b\u89c2\u4e0b\u7ebf\u300d\u3002\u8fd9\u4e2a\u300c\u89c4\u5b9a\u7684\u65f6\u95f4\u300d\u662f\u914d\u7f6e\u9879  <code>down-after-milliseconds</code> \u53c2\u6570\u8bbe\u5b9a\u7684\uff0c\u5355\u4f4d\u662f\u6beb\u79d2\u3002</p> <p>\u4e3b\u89c2\u4e0b\u7ebf\uff1f\u96be\u9053\u8fd8\u6709\u5ba2\u89c2\u4e0b\u7ebf\uff1f</p> <p>\u662f\u7684\u6ca1\u9519\uff0c\u5ba2\u89c2\u4e0b\u7ebf\u53ea\u9002\u7528\u4e8e\u4e3b\u8282\u70b9\u3002</p> <p>\u4e4b\u6240\u4ee5\u9488\u5bf9\u300c\u4e3b\u8282\u70b9\u300d\u8bbe\u8ba1\u300c\u4e3b\u89c2\u4e0b\u7ebf\u300d\u548c\u300c\u5ba2\u89c2\u4e0b\u7ebf\u300d\u4e24\u4e2a\u72b6\u6001\uff0c\u662f\u56e0\u4e3a\u6709\u53ef\u80fd\u300c\u4e3b\u8282\u70b9\u300d\u5176\u5b9e\u5e76\u6ca1\u6709\u6545\u969c\uff0c\u53ef\u80fd\u53ea\u662f\u56e0\u4e3a\u4e3b\u8282\u70b9\u7684\u7cfb\u7edf\u538b\u529b\u6bd4\u8f83\u5927\u6216\u8005\u7f51\u7edc\u53d1\u9001\u4e86\u62e5\u585e\uff0c\u5bfc\u81f4\u4e3b\u8282\u70b9\u6ca1\u6709\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u54cd\u5e94\u54e8\u5175\u7684 PING \u547d\u4ee4\u3002</p> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u51cf\u5c11\u8bef\u5224\u7684\u60c5\u51b5\uff0c\u54e8\u5175\u5728\u90e8\u7f72\u7684\u65f6\u5019\u4e0d\u4f1a\u53ea\u90e8\u7f72\u4e00\u4e2a\u8282\u70b9\uff0c\u800c\u662f\u7528\u591a\u4e2a\u8282\u70b9\u90e8\u7f72\u6210\u54e8\u5175\u96c6\u7fa4\uff08\u6700\u5c11\u9700\u8981\u4e09\u53f0\u673a\u5668\u6765\u90e8\u7f72\u54e8\u5175\u96c6\u7fa4\uff09\uff0c\u901a\u8fc7\u591a\u4e2a\u54e8\u5175\u8282\u70b9\u4e00\u8d77\u5224\u65ad\uff0c\u5c31\u53ef\u4ee5\u5c31\u53ef\u4ee5\u907f\u514d\u5355\u4e2a\u54e8\u5175\u56e0\u4e3a\u81ea\u8eab\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u800c\u8bef\u5224\u4e3b\u8282\u70b9\u4e0b\u7ebf\u7684\u60c5\u51b5\u3002\u540c\u65f6\uff0c\u591a\u4e2a\u54e8\u5175\u7684\u7f51\u7edc\u540c\u65f6\u4e0d\u7a33\u5b9a\u7684\u6982\u7387\u8f83\u5c0f\uff0c\u7531\u5b83\u4eec\u4e00\u8d77\u505a\u51b3\u7b56\uff0c\u8bef\u5224\u7387\u4e5f\u80fd\u964d\u4f4e\u3002</p> <p>\u5177\u4f53\u662f\u600e\u4e48\u5224\u5b9a\u4e3b\u8282\u70b9\u4e3a\u300c\u5ba2\u89c2\u4e0b\u7ebf\u300d\u7684\u5462\uff1f</p> <p>\u5f53\u4e00\u4e2a\u54e8\u5175\u5224\u65ad\u4e3b\u8282\u70b9\u4e3a\u300c\u4e3b\u89c2\u4e0b\u7ebf\u300d\u540e\uff0c\u5c31\u4f1a\u5411\u5176\u4ed6\u54e8\u5175\u53d1\u8d77\u547d\u4ee4\uff0c\u5176\u4ed6\u54e8\u5175\u6536\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c\u5c31\u4f1a\u6839\u636e\u81ea\u8eab\u548c\u4e3b\u8282\u70b9\u7684\u7f51\u7edc\u72b6\u51b5\uff0c\u505a\u51fa\u8d5e\u6210\u6295\u7968\u6216\u8005\u62d2\u7edd\u6295\u7968\u7684\u54cd\u5e94\u3002</p> <p></p> <p>\u5f53\u8fd9\u4e2a\u54e8\u5175\u7684\u8d5e\u540c\u7968\u6570\u8fbe\u5230\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 quorum \u914d\u7f6e\u9879\u8bbe\u5b9a\u7684\u503c\u540e\uff0c\u8fd9\u65f6\u4e3b\u8282\u70b9\u5c31\u4f1a\u88ab\u8be5\u54e8\u5175\u6807\u8bb0\u4e3a\u300c\u5ba2\u89c2\u4e0b\u7ebf\u300d\u3002</p> <p>\u4f8b\u5982\uff0c\u73b0\u5728\u6709 3 \u4e2a\u54e8\u5175\uff0cquorum \u914d\u7f6e\u7684\u662f 2\uff0c\u90a3\u4e48\u4e00\u4e2a\u54e8\u5175\u9700\u8981 2 \u5f20\u8d5e\u6210\u7968\uff0c\u5c31\u53ef\u4ee5\u6807\u8bb0\u4e3b\u8282\u70b9\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u4e86\u3002\u8fd9 2 \u5f20\u8d5e\u6210\u7968\u5305\u62ec\u54e8\u5175\u81ea\u5df1\u7684\u4e00\u5f20\u8d5e\u6210\u7968\u548c\u53e6\u5916\u4e24\u4e2a\u54e8\u5175\u7684\u8d5e\u6210\u7968\u3002</p> <p>PS\uff1aquorum \u7684\u503c\u4e00\u822c\u8bbe\u7f6e\u4e3a\u54e8\u5175\u4e2a\u6570\u7684\u4e8c\u5206\u4e4b\u4e00\u52a0 1\uff0c\u4f8b\u5982 3 \u4e2a\u54e8\u5175\u5c31\u8bbe\u7f6e 2\u3002</p> <p>\u54e8\u5175\u5224\u65ad\u5b8c\u4e3b\u8282\u70b9\u5ba2\u89c2\u4e0b\u7ebf\u540e\uff0c\u54e8\u5175\u5c31\u8981\u5f00\u59cb\u5728\u591a\u4e2a\u300c\u4ece\u8282\u70b9\u300d\u4e2d\uff0c\u9009\u51fa\u4e00\u4e2a\u4ece\u8282\u70b9\u6765\u505a\u65b0\u4e3b\u8282\u70b9\u3002</p>"},{"location":"redis/cluster/sentinel/#_5","title":"\u7531\u54ea\u4e2a\u54e8\u5175\u8fdb\u884c\u4e3b\u4ece\u6545\u969c\u8f6c\u79fb\uff1f","text":"<p>\u524d\u9762\u8bf4\u8fc7\uff0c\u4e3a\u4e86\u66f4\u52a0\u201c\u5ba2\u89c2\u201d\u7684\u5224\u65ad\u4e3b\u8282\u70b9\u6545\u969c\u4e86\uff0c\u4e00\u822c\u4e0d\u4f1a\u53ea\u7531\u5355\u4e2a\u54e8\u5175\u7684\u68c0\u6d4b\u7ed3\u679c\u6765\u5224\u65ad\uff0c\u800c\u662f\u591a\u4e2a\u54e8\u5175\u4e00\u8d77\u5224\u65ad\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u8bef\u5224\u6982\u7387\uff0c\u6240\u4ee5\u54e8\u5175\u662f\u4ee5\u54e8\u5175\u96c6\u7fa4\u7684\u65b9\u5f0f\u5b58\u5728\u7684\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u7531\u54e8\u5175\u96c6\u7fa4\u4e2d\u7684\u54ea\u4e2a\u8282\u70b9\u8fdb\u884c\u4e3b\u4ece\u6545\u969c\u8f6c\u79fb\u5462\uff1f</p> <p>\u6240\u4ee5\u8fd9\u65f6\u5019\uff0c\u8fd8\u9700\u8981\u5728\u54e8\u5175\u96c6\u7fa4\u4e2d\u9009\u51fa\u4e00\u4e2a leader\uff0c\u8ba9 leader \u6765\u6267\u884c\u4e3b\u4ece\u5207\u6362\u3002</p> <p>\u9009\u4e3e leader \u7684\u8fc7\u7a0b\u5176\u5b9e\u662f\u4e00\u4e2a\u6295\u7968\u7684\u8fc7\u7a0b\uff0c\u5728\u6295\u7968\u5f00\u59cb\u524d\uff0c\u80af\u5b9a\u5f97\u6709\u4e2a\u300c\u5019\u9009\u8005\u300d\u3002</p> <p>\u90a3\u8c01\u6765\u4f5c\u4e3a\u5019\u9009\u8005\u5462\uff1f</p> <p>\u54ea\u4e2a\u54e8\u5175\u8282\u70b9\u5224\u65ad\u4e3b\u8282\u70b9\u4e3a\u300c\u5ba2\u89c2\u4e0b\u7ebf\u300d\uff0c\u8fd9\u4e2a\u54e8\u5175\u8282\u70b9\u5c31\u662f\u5019\u9009\u8005\uff0c\u6240\u8c13\u7684\u5019\u9009\u8005\u5c31\u662f\u60f3\u5f53 Leader \u7684\u54e8\u5175\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u6709\u4e09\u4e2a\u54e8\u5175\u3002\u5f53\u54e8\u5175 B \u5148\u5224\u65ad\u5230\u4e3b\u8282\u70b9\u300c\u4e3b\u89c2\u4e0b\u7ebf\u540e\u300d\uff0c\u5c31\u4f1a\u7ed9\u5176\u4ed6\u5b9e\u4f8b\u53d1\u9001 is-master-down-by-addr \u547d\u4ee4\u3002\u63a5\u7740\uff0c\u5176\u4ed6\u54e8\u5175\u4f1a\u6839\u636e\u81ea\u5df1\u548c\u4e3b\u8282\u70b9\u7684\u7f51\u7edc\u8fde\u63a5\u60c5\u51b5\uff0c\u505a\u51fa\u8d5e\u6210\u6295\u7968\u6216\u8005\u62d2\u7edd\u6295\u7968\u7684\u54cd\u5e94\u3002</p> <p></p> <p>\u5f53\u54e8\u5175 B \u6536\u5230\u8d5e\u6210\u7968\u6570\u8fbe\u5230\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 quorum \u914d\u7f6e\u9879\u8bbe\u5b9a\u7684\u503c\u540e\uff0c\u5c31\u4f1a\u5c06\u4e3b\u8282\u70b9\u6807\u8bb0\u4e3a\u300c\u5ba2\u89c2\u4e0b\u7ebf\u300d\uff0c\u6b64\u65f6\u7684\u54e8\u5175 B \u5c31\u662f\u4e00\u4e2a Leader \u5019\u9009\u8005\u3002 </p> <p>\u5019\u9009\u8005\u5982\u4f55\u9009\u4e3e\u6210\u4e3a Leader\uff1f</p> <p>\u5019\u9009\u8005\u4f1a\u5411\u5176\u4ed6\u54e8\u5175\u53d1\u9001\u547d\u4ee4\uff0c\u8868\u660e\u5e0c\u671b\u6210\u4e3a Leader \u6765\u6267\u884c\u4e3b\u4ece\u5207\u6362\uff0c\u5e76\u8ba9\u6240\u6709\u5176\u4ed6\u54e8\u5175\u5bf9\u5b83\u8fdb\u884c\u6295\u7968\u3002</p> <p>\u6bcf\u4e2a\u54e8\u5175\u53ea\u6709\u4e00\u6b21\u6295\u7968\u673a\u4f1a\uff0c\u5982\u679c\u7528\u5b8c\u540e\u5c31\u4e0d\u80fd\u53c2\u4e0e\u6295\u7968\u4e86\uff0c\u53ef\u4ee5\u6295\u7ed9\u81ea\u5df1\u6216\u6295\u7ed9\u522b\u4eba\uff0c\u4f46\u662f\u53ea\u6709\u5019\u9009\u8005\u624d\u80fd\u628a\u7968\u6295\u7ed9\u81ea\u5df1\u3002</p> <p>\u90a3\u4e48\u5728\u6295\u7968\u8fc7\u7a0b\u4e2d\uff0c\u4efb\u4f55\u4e00\u4e2a\u300c\u5019\u9009\u8005\u300d\uff0c\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a</p> <ul> <li>\u7b2c\u4e00\uff0c\u62ff\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u8d5e\u6210\u7968\uff1b</li> <li>\u7b2c\u4e8c\uff0c\u62ff\u5230\u7684\u7968\u6570\u540c\u65f6\u8fd8\u9700\u8981\u5927\u4e8e\u7b49\u4e8e\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 quorum \u503c\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u54e8\u5175\u8282\u70b9\u6709  3 \u4e2a\uff0cquorum \u8bbe\u7f6e\u4e3a 2\uff0c\u90a3\u4e48\u4efb\u4f55\u4e00\u4e2a\u60f3\u6210\u4e3a Leader \u7684\u54e8\u5175\u53ea\u8981\u62ff\u5230 2 \u5f20\u8d5e\u6210\u7968\uff0c\u5c31\u53ef\u4ee5\u9009\u4e3e\u6210\u529f\u4e86\u3002\u5982\u679c\u6ca1\u6709\u6ee1\u8db3\u6761\u4ef6\uff0c\u5c31\u9700\u8981\u91cd\u65b0\u8fdb\u884c\u9009\u4e3e\u3002</p> <p>\u8fd9\u65f6\u5019\u6709\u7684\u540c\u5b66\u5c31\u4f1a\u95ee\u4e86\uff0c\u5982\u679c\u67d0\u4e2a\u65f6\u95f4\u70b9\uff0c\u521a\u597d\u6709\u4e24\u4e2a\u54e8\u5175\u8282\u70b9\u5224\u65ad\u5230\u4e3b\u8282\u70b9\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\uff0c\u90a3\u8fd9\u65f6\u4e0d\u5c31\u6709\u4e24\u4e2a\u5019\u9009\u8005\u4e86\uff1f\u8fd9\u65f6\u8be5\u5982\u4f55\u51b3\u5b9a\u8c01\u662f Leader \u5462\uff1f</p> <p>\u6bcf\u4f4d\u5019\u9009\u8005\u90fd\u4f1a\u5148\u7ed9\u81ea\u5df1\u6295\u4e00\u7968\uff0c\u7136\u540e\u5411\u5176\u4ed6\u54e8\u5175\u53d1\u8d77\u6295\u7968\u8bf7\u6c42\u3002\u5982\u679c\u6295\u7968\u8005\u5148\u6536\u5230\u300c\u5019\u9009\u8005 A\u300d\u7684\u6295\u7968\u8bf7\u6c42\uff0c\u5c31\u4f1a\u5148\u6295\u7968\u7ed9\u5b83\uff0c\u5982\u679c\u6295\u7968\u8005\u7528\u5b8c\u6295\u7968\u673a\u4f1a\u540e\uff0c\u6536\u5230\u300c\u5019\u9009\u8005 B\u300d\u7684\u6295\u7968\u8bf7\u6c42\u540e\uff0c\u5c31\u4f1a\u62d2\u7edd\u6295\u7968\u3002\u8fd9\u65f6\uff0c\u5019\u9009\u8005 A \u5148\u6ee1\u8db3\u4e86\u4e0a\u9762\u7684\u90a3\u4e24\u4e2a\u6761\u4ef6\uff0c\u6240\u4ee5\u300c\u5019\u9009\u8005 A\u300d\u5c31\u4f1a\u88ab\u9009\u4e3e\u4e3a Leader\u3002</p> <p>\u4e3a\u4ec0\u4e48\u54e8\u5175\u8282\u70b9\u81f3\u5c11\u8981\u6709 3 \u4e2a\uff1f</p> <p>\u5982\u679c\u54e8\u5175\u96c6\u7fa4\u4e2d\u53ea\u6709 2 \u4e2a\u54e8\u5175\u8282\u70b9\uff0c\u6b64\u65f6\u5982\u679c\u4e00\u4e2a\u54e8\u5175\u60f3\u8981\u6210\u529f\u6210\u4e3a Leader\uff0c\u5fc5\u987b\u83b7\u5f97 2 \u7968\uff0c\u800c\u4e0d\u662f 1 \u7968\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u54e8\u5175\u96c6\u7fa4\u4e2d\u6709\u4e2a\u54e8\u5175\u6302\u6389\u4e86\uff0c\u90a3\u4e48\u5c31\u53ea\u5269\u4e00\u4e2a\u54e8\u5175\u4e86\uff0c\u5982\u679c\u8fd9\u4e2a\u54e8\u5175\u60f3\u8981\u6210\u4e3a Leader\uff0c\u8fd9\u65f6\u7968\u6570\u5c31\u6ca1\u529e\u6cd5\u8fbe\u5230 2 \u7968\uff0c\u5c31\u65e0\u6cd5\u6210\u529f\u6210\u4e3a Leader\uff0c\u8fd9\u65f6\u662f\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u8282\u70b9\u5207\u6362\u7684\u3002</p> <p>\u56e0\u6b64\uff0c\u901a\u5e38\u6211\u4eec\u81f3\u5c11\u4f1a\u914d\u7f6e 3 \u4e2a\u54e8\u5175\u8282\u70b9\u3002\u8fd9\u65f6\uff0c\u5982\u679c\u54e8\u5175\u96c6\u7fa4\u4e2d\u6709\u4e2a\u54e8\u5175\u6302\u6389\u4e86\uff0c\u90a3\u4e48\u8fd8\u5269\u4e0b\u4e24\u4e2a\u54e8\u5175\uff0c\u5982\u679c\u8fd9\u4e2a\u54e8\u5175\u60f3\u8981\u6210\u4e3a Leader\uff0c\u8fd9\u65f6\u8fd8\u662f\u6709\u673a\u4f1a\u8fbe\u5230 2 \u7968\u7684\uff0c\u6240\u4ee5\u8fd8\u662f\u53ef\u4ee5\u9009\u4e3e\u6210\u529f\u7684\uff0c\u4e0d\u4f1a\u5bfc\u81f4\u65e0\u6cd5\u8fdb\u884c\u4e3b\u4ece\u8282\u70b9\u5207\u6362\u3002</p> <p>\u5f53\u7136\uff0c\u4f60\u8981\u95ee\uff0c\u5982\u679c 3 \u4e2a\u54e8\u5175\u8282\u70b9\uff0c\u6302\u4e86 2 \u4e2a\u600e\u4e48\u529e\uff1f\u8fd9\u4e2a\u65f6\u5019\u5f97\u4eba\u4e3a\u4ecb\u5165\u4e86\uff0c\u6216\u8005\u589e\u52a0\u591a\u4e00\u70b9\u54e8\u5175\u8282\u70b9\u3002</p> <p>\u518d\u8bf4\u4e00\u4e2a\u95ee\u9898\uff0cRedis 1 \u4e3b 4 \u4ece\uff0c5 \u4e2a\u54e8\u5175\uff0cquorum \u8bbe\u7f6e\u4e3a 3\uff0c\u5982\u679c 2 \u4e2a\u54e8\u5175\u6545\u969c\uff0c\u5f53\u4e3b\u8282\u70b9\u5b95\u673a\u65f6\uff0c\u54e8\u5175\u80fd\u5426\u5224\u65ad\u4e3b\u8282\u70b9\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff1f\u4e3b\u4ece\u80fd\u5426\u81ea\u52a8\u5207\u6362\uff1f</p> <ul> <li> <p>\u54e8\u5175\u96c6\u7fa4\u53ef\u4ee5\u5224\u5b9a\u4e3b\u8282\u70b9\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u3002\u54e8\u5175\u96c6\u7fa4\u8fd8\u5269\u4e0b 3 \u4e2a\u54e8\u5175\uff0c\u5f53\u4e00\u4e2a\u54e8\u5175\u5224\u65ad\u4e3b\u8282\u70b9\u201c\u4e3b\u89c2\u4e0b\u7ebf\u201d\u540e\uff0c\u8be2\u95ee\u53e6\u5916 2 \u4e2a\u54e8\u5175\u540e\uff0c\u6709\u53ef\u80fd\u80fd\u62ff\u5230 3 \u5f20\u8d5e\u540c\u7968\uff0c\u8fd9\u65f6\u5c31\u8fbe\u5230\u4e86 quorum \u7684\u503c\uff0c\u56e0\u6b64\uff0c\u54e8\u5175\u96c6\u7fa4\u53ef\u4ee5\u5224\u5b9a\u4e3b\u8282\u70b9\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\u3002</p> </li> <li> <p>\u54e8\u5175\u96c6\u7fa4\u53ef\u4ee5\u5b8c\u6210\u4e3b\u4ece\u5207\u6362\u3002\u5f53\u6709\u4e2a\u54e8\u5175\u6807\u8bb0\u4e3b\u8282\u70b9\u4e3a\u300c\u5ba2\u89c2\u4e0b\u7ebf\u300d\u540e\uff0c\u5c31\u4f1a\u8fdb\u884c\u9009\u4e3e Leader \u7684\u8fc7\u7a0b\uff0c\u56e0\u4e3a\u6b64\u65f6\u54e8\u5175\u96c6\u7fa4\u8fd8\u5269\u4e0b 3 \u4e2a\u54e8\u5175\uff0c\u90a3\u4e48\u8fd8\u662f\u53ef\u4ee5\u62ff\u5230\u534a\u6570\u4ee5\u4e0a\uff085/2+1=3\uff09\u7684\u7968\uff0c\u800c\u4e14\u4e5f\u8fbe\u5230\u4e86 quorum \u503c\uff0c\u6ee1\u8db3\u4e86\u9009\u4e3e Leader \u7684\u4e24\u4e2a\u6761\u4ef6\uff0c\u6240\u4ee5\u5c31\u80fd\u9009\u4e3e\u6210\u529f\uff0c\u56e0\u6b64\u54e8\u5175\u96c6\u7fa4\u53ef\u4ee5\u5b8c\u6210\u4e3b\u4ece\u5207\u6362\u3002</p> </li> </ul> <p>\u5982\u679c quorum \u8bbe\u7f6e\u4e3a 2\uff0c\u5e76\u4e14\u5982\u679c\u6709 3 \u4e2a\u54e8\u5175\u6545\u969c\u7684\u8bdd\u3002\u6b64\u65f6\u54e8\u5175\u96c6\u7fa4\u8fd8\u662f\u53ef\u4ee5\u5224\u5b9a\u4e3b\u8282\u70b9\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u4f46\u662f\u54e8\u5175\u4e0d\u80fd\u5b8c\u6210\u4e3b\u4ece\u5207\u6362\u4e86\uff0c\u5927\u5bb6\u53ef\u4ee5\u81ea\u5df1\u63a8\u6f14\u4e0b\u3002</p> <p>\u5982\u679c quorum \u8bbe\u7f6e\u4e3a 3\uff0c\u5e76\u4e14\u5982\u679c\u6709 3 \u4e2a\u54e8\u5175\u6545\u969c\u7684\u8bdd\uff0c\u54e8\u5175\u96c6\u7fa4\u5373\u4e0d\u80fd\u5224\u5b9a\u4e3b\u8282\u70b9\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u4e5f\u4e0d\u80fd\u5b8c\u6210\u4e3b\u4ece\u5207\u6362\u4e86\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0cquorum \u4e3a 2 \u7684\u65f6\u5019\uff0c\u5e76\u4e14\u5982\u679c\u6709 3 \u4e2a\u54e8\u5175\u6545\u969c\u7684\u8bdd\uff0c\u867d\u7136\u53ef\u4ee5\u5224\u5b9a\u4e3b\u8282\u70b9\u4e3a\u201c\u5ba2\u89c2\u4e0b\u7ebf\u201d\uff0c\u4f46\u662f\u4e0d\u80fd\u5b8c\u6210\u4e3b\u4ece\u5207\u6362\uff0c\u8fd9\u6837\u611f\u89c9\u300c\u5224\u5b9a\u4e3b\u8282\u70b9\u4e3a\u5ba2\u89c2\u4e0b\u7ebf\u300d\u8fd9\u4ef6\u4e8b\u60c5\u767d\u505a\u4e86\u4e00\u6837\uff0c\u65e2\u7136\u8fd9\u6837\uff0c\u8fd8\u4e0d\u5982\u4e0d\u8981\u505a\uff0cquorum \u4e3a 3 \u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u907f\u514d\u8fd9\u79cd\u65e0\u7528\u529f\u3002</p> <p>\u6240\u4ee5\uff0cquorum \u7684\u503c\u5efa\u8bae\u8bbe\u7f6e\u4e3a\u54e8\u5175\u4e2a\u6570\u7684\u4e8c\u5206\u4e4b\u4e00\u52a0 1\uff0c\u4f8b\u5982 3 \u4e2a\u54e8\u5175\u5c31\u8bbe\u7f6e 2\uff0c5 \u4e2a\u54e8\u5175\u8bbe\u7f6e\u4e3a 3\uff0c\u800c\u4e14\u54e8\u5175\u8282\u70b9\u7684\u6570\u91cf\u5e94\u8be5\u662f\u5947\u6570\u3002</p>"},{"location":"redis/cluster/sentinel/#_6","title":"\u4e3b\u4ece\u6545\u969c\u8f6c\u79fb\u7684\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>\u5728\u54e8\u5175\u96c6\u7fa4\u4e2d\u901a\u8fc7\u6295\u7968\u7684\u65b9\u5f0f\uff0c\u9009\u4e3e\u51fa\u4e86\u54e8\u5175 leader \u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e3b\u4ece\u6545\u969c\u8f6c\u79fb\u7684\u8fc7\u7a0b\u4e86\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e3b\u4ece\u6545\u969c\u8f6c\u79fb\u64cd\u4f5c\u5305\u542b\u4ee5\u4e0b\u56db\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\uff1a\u5728\u5df2\u4e0b\u7ebf\u4e3b\u8282\u70b9\uff08\u65e7\u4e3b\u8282\u70b9\uff09\u5c5e\u4e0b\u7684\u6240\u6709\u300c\u4ece\u8282\u70b9\u300d\u91cc\u9762\uff0c\u6311\u9009\u51fa\u4e00\u4e2a\u4ece\u8282\u70b9\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u4e3b\u8282\u70b9\u3002</li> <li>\u7b2c\u4e8c\u6b65\uff1a\u8ba9\u5df2\u4e0b\u7ebf\u4e3b\u8282\u70b9\u5c5e\u4e0b\u7684\u6240\u6709\u300c\u4ece\u8282\u70b9\u300d\u4fee\u6539\u590d\u5236\u76ee\u6807\uff0c\u4fee\u6539\u4e3a\u590d\u5236\u300c\u65b0\u4e3b\u8282\u70b9\u300d\uff1b</li> <li>\u7b2c\u4e09\u6b65\uff1a\u5c06\u65b0\u4e3b\u8282\u70b9\u7684 IP \u5730\u5740\u548c\u4fe1\u606f\uff0c\u901a\u8fc7\u300c\u53d1\u5e03\u8005/\u8ba2\u9605\u8005\u673a\u5236\u300d\u901a\u77e5\u7ed9\u5ba2\u6237\u7aef\uff1b</li> <li>\u7b2c\u56db\u6b65\uff1a\u7ee7\u7eed\u76d1\u89c6\u65e7\u4e3b\u8282\u70b9\uff0c\u5f53\u8fd9\u4e2a\u65e7\u4e3b\u8282\u70b9\u91cd\u65b0\u4e0a\u7ebf\u65f6\uff0c\u5c06\u5b83\u8bbe\u7f6e\u4e3a\u65b0\u4e3b\u8282\u70b9\u7684\u4ece\u8282\u70b9\uff1b</li> </ul>"},{"location":"redis/cluster/sentinel/#_7","title":"\u6b65\u9aa4\u4e00\uff1a\u9009\u51fa\u65b0\u4e3b\u8282\u70b9","text":"<p>\u6545\u969c\u8f6c\u79fb\u64cd\u4f5c\u7b2c\u4e00\u6b65\u8981\u505a\u7684\u5c31\u662f\u5728\u5df2\u4e0b\u7ebf\u4e3b\u8282\u70b9\u5c5e\u4e0b\u7684\u6240\u6709\u300c\u4ece\u8282\u70b9\u300d\u4e2d\uff0c\u6311\u9009\u51fa\u4e00\u4e2a\u72b6\u6001\u826f\u597d\u3001\u6570\u636e\u5b8c\u6574\u7684\u4ece\u8282\u70b9\uff0c\u7136\u540e\u5411\u8fd9\u4e2a\u300c\u4ece\u8282\u70b9\u300d\u53d1\u9001 SLAVEOF no one \u547d\u4ee4\uff0c\u5c06\u8fd9\u4e2a\u300c\u4ece\u8282\u70b9\u300d\u8f6c\u6362\u4e3a\u300c\u4e3b\u8282\u70b9\u300d\u3002</p> <p>\u90a3\u4e48\u591a\u300c\u4ece\u8282\u70b9\u300d\uff0c\u5230\u5e95\u9009\u62e9\u54ea\u4e2a\u4ece\u8282\u70b9\u4f5c\u4e3a\u65b0\u4e3b\u8282\u70b9\u7684\uff1f</p> <p>\u968f\u673a\u7684\u65b9\u5f0f\u597d\u5417\uff1f\u968f\u673a\u7684\u65b9\u5f0f\uff0c\u5b9e\u73b0\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u5982\u679c\u9009\u5230\u4e00\u4e2a\u7f51\u7edc\u72b6\u6001\u4e0d\u597d\u7684\u4ece\u8282\u70b9\u4f5c\u4e3a\u65b0\u4e3b\u8282\u70b9\uff0c\u90a3\u4e48\u53ef\u80fd\u5728\u5c06\u6765\u4e0d\u4e45\u53c8\u8981\u505a\u4e00\u6b21\u4e3b\u4ece\u6545\u969c\u8fc1\u79fb\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u9996\u5148\u8981\u628a\u7f51\u7edc\u72b6\u6001\u4e0d\u597d\u7684\u4ece\u8282\u70b9\u7ed9\u8fc7\u6ee4\u6389\u3002\u9996\u5148\u628a\u5df2\u7ecf\u4e0b\u7ebf\u7684\u4ece\u8282\u70b9\u8fc7\u6ee4\u6389\uff0c\u7136\u540e\u628a\u4ee5\u5f80\u7f51\u7edc\u8fde\u63a5\u72b6\u6001\u4e0d\u597d\u7684\u4ece\u8282\u70b9\u4e5f\u7ed9\u8fc7\u6ee4\u6389\u3002</p> <p>\u600e\u4e48\u5224\u65ad\u4ece\u8282\u70b9\u4e4b\u524d\u7684\u7f51\u7edc\u8fde\u63a5\u72b6\u6001\u4e0d\u597d\u5462\uff1f</p> <p>Redis \u6709\u4e2a\u53eb down-after-milliseconds * 10 \u914d\u7f6e\u9879\uff0c\u5176 down-after-milliseconds \u662f\u4e3b\u4ece\u8282\u70b9\u65ad\u8fde\u7684\u6700\u5927\u8fde\u63a5\u8d85\u65f6\u65f6\u95f4\u3002\u5982\u679c\u5728 down-after-milliseconds \u6beb\u79d2\u5185\uff0c\u4e3b\u4ece\u8282\u70b9\u90fd\u6ca1\u6709\u901a\u8fc7\u7f51\u7edc\u8054\u7cfb\u4e0a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u8ba4\u4e3a\u4e3b\u4ece\u8282\u70b9\u65ad\u8fde\u4e86\u3002\u5982\u679c\u53d1\u751f\u65ad\u8fde\u7684\u6b21\u6570\u8d85\u8fc7\u4e86 10 \u6b21\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e2a\u4ece\u8282\u70b9\u7684\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u4e0d\u9002\u5408\u4f5c\u4e3a\u65b0\u4e3b\u8282\u70b9\u3002</p> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u5c31\u628a\u7f51\u7edc\u72b6\u6001\u4e0d\u597d\u7684\u4ece\u8282\u70b9\u8fc7\u6ee4\u6389\u4e86\uff0c\u63a5\u4e0b\u6765\u8981\u5bf9\u6240\u6709\u4ece\u8282\u70b9\u8fdb\u884c\u4e09\u8f6e\u8003\u5bdf\uff1a\u4f18\u5148\u7ea7\u3001\u590d\u5236\u8fdb\u5ea6\u3001ID \u53f7\u3002\u5728\u8fdb\u884c\u6bcf\u4e00\u8f6e\u8003\u5bdf\u7684\u65f6\u5019\uff0c\u54ea\u4e2a\u4ece\u8282\u70b9\u4f18\u5148\u80dc\u51fa\uff0c\u5c31\u9009\u62e9\u5176\u4f5c\u4e3a\u65b0\u4e3b\u8282\u70b9\u3002</p> <ul> <li>\u7b2c\u4e00\u8f6e\u8003\u5bdf\uff1a\u54e8\u5175\u9996\u5148\u4f1a\u6839\u636e\u4ece\u8282\u70b9\u7684\u4f18\u5148\u7ea7\u6765\u8fdb\u884c\u6392\u5e8f\uff0c\u4f18\u5148\u7ea7\u8d8a\u5c0f\u6392\u540d\u8d8a\u9760\u524d\uff0c</li> <li>\u7b2c\u4e8c\u8f6e\u8003\u5bdf\uff1a\u5982\u679c\u4f18\u5148\u7ea7\u76f8\u540c\uff0c\u5219\u67e5\u770b\u590d\u5236\u7684\u4e0b\u6807\uff0c\u54ea\u4e2a\u4ece\u300c\u4e3b\u8282\u70b9\u300d\u63a5\u6536\u7684\u590d\u5236\u6570\u636e\u591a\uff0c\u54ea\u4e2a\u5c31\u9760\u524d\u3002</li> <li>\u7b2c\u4e09\u8f6e\u8003\u5bdf\uff1a\u5982\u679c\u4f18\u5148\u7ea7\u548c\u4e0b\u6807\u90fd\u76f8\u540c\uff0c\u5c31\u9009\u62e9\u4ece\u8282\u70b9 ID \u8f83\u5c0f\u7684\u90a3\u4e2a\u3002</li> </ul>"},{"location":"redis/cluster/sentinel/#_8","title":"\u7b2c\u4e00\u8f6e\u8003\u5bdf\uff1a\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u4ece\u8282\u70b9\u80dc\u51fa","text":"<p>Redis \u6709\u4e2a\u53eb slave-priority \u914d\u7f6e\u9879\uff0c\u53ef\u4ee5\u7ed9\u4ece\u8282\u70b9\u8bbe\u7f6e\u4f18\u5148\u7ea7\u3002</p> <p>\u6bcf\u4e00\u53f0\u4ece\u8282\u70b9\u7684\u670d\u52a1\u5668\u914d\u7f6e\u4e0d\u4e00\u5b9a\u662f\u76f8\u540c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u670d\u52a1\u5668\u6027\u80fd\u914d\u7f6e\u6765\u8bbe\u7f6e\u4ece\u8282\u70b9\u7684\u4f18\u5148\u7ea7\u3002</p> <p>\u6bd4\u5982\uff0c\u5982\u679c\u300cA \u4ece\u8282\u70b9\u300d\u7684\u7269\u7406\u5185\u5b58\u662f\u6240\u6709\u4ece\u8282\u70b9\u4e2d\u6700\u5927\u7684\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u300cA \u4ece\u8282\u70b9\u300d\u7684\u4f18\u5148\u7ea7\u8bbe\u7f6e\u6210\u6700\u9ad8\u3002\u8fd9\u6837\u5f53\u54e8\u5175\u8fdb\u884c\u7b2c\u4e00\u8f6e\u8003\u8651\u7684\u65f6\u5019\uff0c\u4f18\u5148\u7ea7\u6700\u9ad8\u7684 A \u4ece\u8282\u70b9\u5c31\u4f1a\u4f18\u5148\u80dc\u51fa\uff0c\u4e8e\u662f\u5c31\u4f1a\u6210\u4e3a\u65b0\u4e3b\u8282\u70b9\u3002</p>"},{"location":"redis/cluster/sentinel/#_9","title":"\u7b2c\u4e8c\u8f6e\u8003\u5bdf\uff1a\u590d\u5236\u8fdb\u5ea6\u6700\u9760\u524d\u7684\u4ece\u8282\u70b9\u80dc\u51fa","text":"<p>\u5982\u679c\u5728\u7b2c\u4e00\u8f6e\u8003\u5bdf\u4e2d\uff0c\u53d1\u73b0\u4f18\u5148\u7ea7\u6700\u9ad8\u7684\u4ece\u8282\u70b9\u6709\u4e24\u4e2a\uff0c\u90a3\u4e48\u5c31\u4f1a\u8fdb\u884c\u7b2c\u4e8c\u8f6e\u8003\u5bdf\uff0c\u6bd4\u8f83\u4e24\u4e2a\u4ece\u8282\u70b9\u54ea\u4e2a\u590d\u5236\u8fdb\u5ea6\u3002</p> <p>\u4ec0\u4e48\u662f\u590d\u5236\u8fdb\u5ea6\uff1f\u4e3b\u4ece\u67b6\u6784\u4e2d\uff0c\u4e3b\u8282\u70b9\u4f1a\u5c06\u5199\u64cd\u4f5c\u540c\u6b65\u7ed9\u4ece\u8282\u70b9\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8282\u70b9\u4f1a\u7528 master_repl_offset \u8bb0\u5f55\u5f53\u524d\u7684\u6700\u65b0\u5199\u64cd\u4f5c\u5728 repl_backlog_buffer \u4e2d\u7684\u4f4d\u7f6e\uff08\u5982\u4e0b\u56fe\u4e2d\u7684\u300c\u4e3b\u670d\u52a1\u5668\u5df2\u7ecf\u5199\u5165\u7684\u6570\u636e\u300d\u7684\u4f4d\u7f6e\uff09\uff0c\u800c\u4ece\u8282\u70b9\u4f1a\u7528 slave_repl_offset \u8fd9\u4e2a\u503c\u8bb0\u5f55\u5f53\u524d\u7684\u590d\u5236\u8fdb\u5ea6\uff08\u5982\u4e0b\u56fe\u4e2d\u7684\u300c\u4ece\u670d\u52a1\u5668\u8981\u8bfb\u7684\u4f4d\u7f6e\u300d\u7684\u4f4d\u7f6e\uff09\u3002</p> <p></p> <p>\u5982\u679c\u67d0\u4e2a\u4ece\u8282\u70b9\u7684 slave_repl_offset \u6700\u63a5\u8fd1 master_repl_offset\uff0c\u8bf4\u660e\u5b83\u7684\u590d\u5236\u8fdb\u5ea6\u662f\u6700\u9760\u524d\u7684\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u5c06\u5b83\u9009\u4e3a\u65b0\u4e3b\u8282\u70b9\u3002</p>"},{"location":"redis/cluster/sentinel/#id","title":"\u7b2c\u4e09\u8f6e\u8003\u5bdf\uff1aID \u53f7\u5c0f\u7684\u4ece\u8282\u70b9\u80dc\u51fa","text":"<p>\u5982\u679c\u5728\u7b2c\u4e8c\u8f6e\u8003\u5bdf\u4e2d\uff0c\u53d1\u73b0\u6709\u4e24\u4e2a\u4ece\u8282\u70b9\u4f18\u5148\u7ea7\u548c\u590d\u5236\u8fdb\u5ea6\u90fd\u662f\u4e00\u6837\u7684\uff0c\u90a3\u4e48\u5c31\u4f1a\u8fdb\u884c\u7b2c\u4e09\u8f6e\u8003\u5bdf\uff0c\u6bd4\u8f83\u4e24\u4e2a\u4ece\u8282\u70b9\u7684 ID \u53f7\uff0cID \u53f7\u5c0f\u7684\u4ece\u8282\u70b9\u80dc\u51fa\u3002</p> <p>\u4ec0\u4e48\u662f ID \u53f7\uff1f\u6bcf\u4e2a\u4ece\u8282\u70b9\u90fd\u6709\u4e00\u4e2a\u7f16\u53f7\uff0c\u8fd9\u4e2a\u7f16\u53f7\u5c31\u662f ID \u53f7\uff0c\u662f\u7528\u6765\u552f\u4e00\u6807\u8bc6\u4ece\u8282\u70b9\u7684\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u9009\u4e3b\u7684\u4e8b\u60c5\u7ec8\u4e8e\u7ed3\u675f\u4e86\u3002\u7b80\u5355\u7ed9\u5927\u5bb6\u603b\u7ed3\u4e0b\uff1a</p> <p></p> <p>\u5728\u9009\u4e3e\u51fa\u4ece\u8282\u70b9\u540e\uff0c\u54e8\u5175 leader  \u5411\u88ab\u9009\u4e2d\u7684\u4ece\u8282\u70b9\u53d1\u9001 <code>SLAVEOF no one</code> \u547d\u4ee4\uff0c\u8ba9\u8fd9\u4e2a\u4ece\u8282\u70b9\u89e3\u9664\u4ece\u8282\u70b9\u7684\u8eab\u4efd\uff0c\u5c06\u5176\u53d8\u4e3a\u65b0\u4e3b\u8282\u70b9\u3002</p> <p>\u5982\u4e0b\u56fe\uff0c\u54e8\u5175 leader \u5411\u88ab\u9009\u4e2d\u7684\u4ece\u8282\u70b9 server2 \u53d1\u9001 <code>SLAVEOF no one</code> \u547d\u4ee4\uff0c\u5c06\u8be5\u4ece\u8282\u70b9\u5347\u7ea7\u4e3a\u65b0\u4e3b\u8282\u70b9\u3002</p> <p></p> <p>\u5728\u53d1\u9001 <code>SLAVEOF no one</code> \u547d\u4ee4\u4e4b\u540e\uff0c\u54e8\u5175 leader \u4f1a\u4ee5\u6bcf\u79d2\u4e00\u6b21\u7684\u9891\u7387\u5411\u88ab\u5347\u7ea7\u7684\u4ece\u8282\u70b9\u53d1\u9001 <code>INFO</code> \u547d\u4ee4\uff08\u6ca1\u8fdb\u884c\u6545\u969c\u8f6c\u79fb\u4e4b\u524d\uff0c<code>INFO</code> \u547d\u4ee4\u7684\u9891\u7387\u662f\u6bcf\u5341\u79d2\u4e00\u6b21\uff09\uff0c\u5e76\u89c2\u5bdf\u547d\u4ee4\u56de\u590d\u4e2d\u7684\u89d2\u8272\u4fe1\u606f\uff0c\u5f53\u88ab\u5347\u7ea7\u8282\u70b9\u7684\u89d2\u8272\u4fe1\u606f\u4ece\u539f\u6765\u7684 slave \u53d8\u4e3a master \u65f6\uff0c\u54e8\u5175 leader \u5c31\u77e5\u9053\u88ab\u9009\u4e2d\u7684\u4ece\u8282\u70b9\u5df2\u7ecf\u987a\u5229\u5347\u7ea7\u4e3a\u4e3b\u8282\u70b9\u4e86\u3002</p> <p>\u5982\u4e0b\u56fe\uff0c\u9009\u4e2d\u7684\u4ece\u8282\u70b9 server2 \u5347\u7ea7\u6210\u4e86\u65b0\u4e3b\u8282\u70b9\uff1a</p> <p></p>"},{"location":"redis/cluster/sentinel/#_10","title":"\u6b65\u9aa4\u4e8c\uff1a\u5c06\u4ece\u8282\u70b9\u6307\u5411\u65b0\u4e3b\u8282\u70b9","text":"<p>\u5f53\u65b0\u4e3b\u8282\u70b9\u51fa\u73b0\u4e4b\u540e\uff0c\u54e8\u5175 leader  \u4e0b\u4e00\u6b65\u8981\u505a\u7684\u5c31\u662f\uff0c\u8ba9\u5df2\u4e0b\u7ebf\u4e3b\u8282\u70b9\u5c5e\u4e0b\u7684\u6240\u6709\u300c\u4ece\u8282\u70b9\u300d\u6307\u5411\u300c\u65b0\u4e3b\u8282\u70b9\u300d\uff0c\u8fd9\u4e00\u52a8\u4f5c\u53ef\u4ee5\u901a\u8fc7\u5411\u300c\u4ece\u8282\u70b9\u300d\u53d1\u9001 <code>SLAVEOF</code> \u547d\u4ee4\u6765\u5b9e\u73b0\u3002</p> <p>\u5982\u4e0b\u56fe\uff0c\u54e8\u5175 leader \u5411\u6240\u6709\u4ece\u8282\u70b9\uff08server3 \u548c server4\uff09\u53d1\u9001 <code>SLAVEOF</code> \uff0c\u8ba9\u5b83\u4eec\u6210\u4e3a\u65b0\u4e3b\u8282\u70b9\u7684\u4ece\u8282\u70b9\u3002</p> <p></p> <p>\u6240\u6709\u4ece\u8282\u70b9\u6307\u5411\u65b0\u4e3b\u8282\u70b9\u540e\u7684\u62d3\u6251\u56fe\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"redis/cluster/sentinel/#_11","title":"\u6b65\u9aa4\u4e09\uff1a\u901a\u77e5\u5ba2\u6237\u7aef\u4e3b\u8282\u70b9\u5df2\u66f4\u6362","text":"<p>\u7ecf\u8fc7\u524d\u9762\u4e00\u7cfb\u5217\u7684\u64cd\u4f5c\u540e\uff0c\u54e8\u5175\u96c6\u7fa4\u7ec8\u4e8e\u5b8c\u6210\u4e3b\u4ece\u5207\u6362\u7684\u5de5\u4f5c\uff0c\u90a3\u4e48\u65b0\u4e3b\u8282\u70b9\u7684\u4fe1\u606f\u8981\u5982\u4f55\u901a\u77e5\u7ed9\u5ba2\u6237\u7aef\u5462\uff1f</p> <p>\u8fd9\u4e3b\u8981\u901a\u8fc7 Redis \u7684\u53d1\u5e03\u8005/\u8ba2\u9605\u8005\u673a\u5236\u6765\u5b9e\u73b0\u7684\u3002\u6bcf\u4e2a\u54e8\u5175\u8282\u70b9\u63d0\u4f9b\u53d1\u5e03\u8005/\u8ba2\u9605\u8005\u673a\u5236\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4ece\u54e8\u5175\u8ba2\u9605\u6d88\u606f\u3002</p> <p>\u54e8\u5175\u63d0\u4f9b\u7684\u6d88\u606f\u8ba2\u9605\u9891\u9053\u6709\u5f88\u591a\uff0c\u4e0d\u540c\u9891\u9053\u5305\u542b\u4e86\u4e3b\u4ece\u8282\u70b9\u5207\u6362\u8fc7\u7a0b\u4e2d\u7684\u4e0d\u540c\u5173\u952e\u4e8b\u4ef6\uff0c\u51e0\u4e2a\u5e38\u89c1\u7684\u4e8b\u4ef6\u5982\u4e0b\uff1a</p> <p></p> <p>\u5ba2\u6237\u7aef\u548c\u54e8\u5175\u5efa\u7acb\u8fde\u63a5\u540e\uff0c\u5ba2\u6237\u7aef\u4f1a\u8ba2\u9605\u54e8\u5175\u63d0\u4f9b\u7684\u9891\u9053\u3002\u4e3b\u4ece\u5207\u6362\u5b8c\u6210\u540e\uff0c\u54e8\u5175\u5c31\u4f1a\u5411  <code>+switch-master</code>  \u9891\u9053\u53d1\u5e03\u65b0\u4e3b\u8282\u70b9\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u7684\u6d88\u606f\uff0c\u8fd9\u4e2a\u65f6\u5019\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u6536\u5230\u8fd9\u6761\u4fe1\u606f\uff0c\u7136\u540e\u7528\u8fd9\u91cc\u9762\u7684\u65b0\u4e3b\u8282\u70b9\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u8fdb\u884c\u901a\u4fe1\u4e86\u3002</p> <p>\u901a\u8fc7\u53d1\u5e03\u8005/\u8ba2\u9605\u8005\u673a\u5236\u673a\u5236\uff0c\u6709\u4e86\u8fd9\u4e9b\u4e8b\u4ef6\u901a\u77e5\uff0c\u5ba2\u6237\u7aef\u4e0d\u4ec5\u53ef\u4ee5\u5728\u4e3b\u4ece\u5207\u6362\u540e\u5f97\u5230\u65b0\u4e3b\u8282\u70b9\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u8fd8\u53ef\u4ee5\u76d1\u63a7\u5230\u4e3b\u4ece\u8282\u70b9\u5207\u6362\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u5404\u4e2a\u91cd\u8981\u4e8b\u4ef6\u3002\u8fd9\u6837\uff0c\u5ba2\u6237\u7aef\u5c31\u53ef\u4ee5\u77e5\u9053\u4e3b\u4ece\u5207\u6362\u8fdb\u884c\u5230\u54ea\u4e00\u6b65\u4e86\uff0c\u6709\u52a9\u4e8e\u4e86\u89e3\u5207\u6362\u8fdb\u5ea6\u3002</p>"},{"location":"redis/cluster/sentinel/#_12","title":"\u6b65\u9aa4\u56db\uff1a\u5c06\u65e7\u4e3b\u8282\u70b9\u53d8\u4e3a\u4ece\u8282\u70b9","text":"<p>\u6545\u969c\u8f6c\u79fb\u64cd\u4f5c\u6700\u540e\u8981\u505a\u7684\u662f\uff0c\u7ee7\u7eed\u76d1\u89c6\u65e7\u4e3b\u8282\u70b9\uff0c\u5f53\u65e7\u4e3b\u8282\u70b9\u91cd\u65b0\u4e0a\u7ebf\u65f6\uff0c\u54e8\u5175\u96c6\u7fa4\u5c31\u4f1a\u5411\u5b83\u53d1\u9001 <code>SLAVEOF</code> \u547d\u4ee4\uff0c\u8ba9\u5b83\u6210\u4e3a\u65b0\u4e3b\u8282\u70b9\u7684\u4ece\u8282\u70b9\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u81f3\u6b64\uff0c\u6574\u4e2a\u4e3b\u4ece\u8282\u70b9\u7684\u6545\u969c\u8f6c\u79fb\u7684\u5de5\u4f5c\u7ed3\u675f\u3002</p>"},{"location":"redis/cluster/sentinel/#_13","title":"\u54e8\u5175\u96c6\u7fa4\u662f\u5982\u4f55\u7ec4\u6210\u7684\uff1f","text":"<p>\u524d\u9762\u63d0\u5230\u4e86  Redis \u7684\u53d1\u5e03\u8005/\u8ba2\u9605\u8005\u673a\u5236\uff0c\u90a3\u5c31\u4e0d\u5f97\u4e0d\u63d0\u4e00\u4e0b\u54e8\u5175\u96c6\u7fa4\u7684\u7ec4\u6210\u65b9\u5f0f\uff0c\u56e0\u4e3a\u5b83\u4e5f\u7528\u5230\u4e86\u8fd9\u4e2a\u6280\u672f\u3002</p> <p>\u5728\u6211\u7b2c\u4e00\u6b21\u642d\u5efa\u54e8\u5175\u96c6\u7fa4\u7684\u65f6\u5019\uff0c\u5f53\u65f6\u89c9\u5f97\u5f88\u8be7\u5f02\u3002\u56e0\u4e3a\u5728\u914d\u7f6e\u54e8\u5175\u7684\u4fe1\u606f\u65f6\uff0c\u7adf\u7136\u53ea\u9700\u8981\u586b\u4e0b\u9762\u8fd9\u51e0\u4e2a\u53c2\u6570\uff0c\u8bbe\u7f6e\u4e3b\u8282\u70b9\u540d\u5b57\u3001\u4e3b\u8282\u70b9\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\u4ee5\u53ca quorum \u503c\u3002</p> C<pre><code>sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt; \n</code></pre> <p>\u4e0d\u9700\u8981\u586b\u5176\u4ed6\u54e8\u5175\u8282\u70b9\u7684\u4fe1\u606f\uff0c\u6211\u5c31\u597d\u5947\u5b83\u4eec\u662f\u5982\u4f55\u611f\u77e5\u5bf9\u65b9\u7684\uff0c\u53c8\u662f\u5982\u4f55\u7ec4\u6210\u54e8\u5175\u96c6\u7fa4\u7684\uff1f</p> <p>\u540e\u9762\u624d\u4e86\u89e3\u5230\uff0c\u54e8\u5175\u8282\u70b9\u4e4b\u95f4\u662f\u901a\u8fc7 Redis \u7684\u53d1\u5e03\u8005/\u8ba2\u9605\u8005\u673a\u5236\u6765\u76f8\u4e92\u53d1\u73b0\u7684\u3002</p> <p>\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u4e3b\u8282\u70b9\u4e0a\u6709\u4e00\u4e2a\u540d\u4e3a<code>__sentinel__:hello</code>\u7684\u9891\u9053\uff0c\u4e0d\u540c\u54e8\u5175\u5c31\u662f\u901a\u8fc7\u5b83\u6765\u76f8\u4e92\u53d1\u73b0\uff0c\u5b9e\u73b0\u4e92\u76f8\u901a\u4fe1\u7684\u3002</p> <p>\u5728\u4e0b\u56fe\u4e2d\uff0c\u54e8\u5175 A \u628a\u81ea\u5df1\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u7684\u4fe1\u606f\u53d1\u5e03\u5230<code>__sentinel__:hello</code> \u9891\u9053\u4e0a\uff0c\u54e8\u5175 B \u548c C \u8ba2\u9605\u4e86\u8be5\u9891\u9053\u3002\u90a3\u4e48\u6b64\u65f6\uff0c\u54e8\u5175 B \u548c C \u5c31\u53ef\u4ee5\u4ece\u8fd9\u4e2a\u9891\u9053\u76f4\u63a5\u83b7\u53d6\u54e8\u5175 A \u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\u3002\u7136\u540e\uff0c\u54e8\u5175 B\u3001C \u53ef\u4ee5\u548c\u54e8\u5175 A \u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\u3002</p> <p></p> <p>\u901a\u8fc7\u8fd9\u4e2a\u65b9\u5f0f\uff0c\u54e8\u5175 B \u548c C \u4e5f\u53ef\u4ee5\u5efa\u7acb\u7f51\u7edc\u8fde\u63a5\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u54e8\u5175\u96c6\u7fa4\u5c31\u5f62\u6210\u4e86\u3002</p> <p>\u54e8\u5175\u96c6\u7fa4\u4f1a\u5bf9\u300c\u4ece\u8282\u70b9\u300d\u7684\u8fd0\u884c\u72b6\u6001\u8fdb\u884c\u76d1\u63a7\uff0c\u90a3\u54e8\u5175\u96c6\u7fa4\u5982\u4f55\u77e5\u9053\u300c\u4ece\u8282\u70b9\u300d\u7684\u4fe1\u606f\uff1f</p> <p>\u4e3b\u8282\u70b9\u77e5\u9053\u6240\u6709\u300c\u4ece\u8282\u70b9\u300d\u7684\u4fe1\u606f\uff0c\u6240\u4ee5\u54e8\u5175\u4f1a\u6bcf 10 \u79d2\u4e00\u6b21\u7684\u9891\u7387\u5411\u4e3b\u8282\u70b9\u53d1\u9001 INFO \u547d\u4ee4\u6765\u83b7\u53d6\u6240\u6709\u300c\u4ece\u8282\u70b9\u300d\u7684\u4fe1\u606f\u3002</p> <p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u54e8\u5175 B \u7ed9\u4e3b\u8282\u70b9\u53d1\u9001 INFO \u547d\u4ee4\uff0c\u4e3b\u8282\u70b9\u63a5\u53d7\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c\u5c31\u4f1a\u628a\u4ece\u8282\u70b9\u5217\u8868\u8fd4\u56de\u7ed9\u54e8\u5175\u3002\u63a5\u7740\uff0c\u54e8\u5175\u5c31\u53ef\u4ee5\u6839\u636e\u4ece\u8282\u70b9\u5217\u8868\u4e2d\u7684\u8fde\u63a5\u4fe1\u606f\uff0c\u548c\u6bcf\u4e2a\u4ece\u8282\u70b9\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u5728\u8fd9\u4e2a\u8fde\u63a5\u4e0a\u6301\u7eed\u5730\u5bf9\u4ece\u8282\u70b9\u8fdb\u884c\u76d1\u63a7\u3002\u54e8\u5175 A \u548c C \u53ef\u4ee5\u901a\u8fc7\u76f8\u540c\u7684\u65b9\u6cd5\u548c\u4ece\u8282\u70b9\u5efa\u7acb\u8fde\u63a5\u3002</p> <p></p> <p>\u6b63\u662f\u901a\u8fc7 Redis \u7684\u53d1\u5e03\u8005/\u8ba2\u9605\u8005\u673a\u5236\uff0c\u54e8\u5175\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u611f\u77e5\uff0c\u7136\u540e\u7ec4\u6210\u96c6\u7fa4\uff0c\u540c\u65f6\uff0c\u54e8\u5175\u53c8\u901a\u8fc7 INFO \u547d\u4ee4\uff0c\u5728\u4e3b\u8282\u70b9\u91cc\u83b7\u5f97\u4e86\u6240\u6709\u4ece\u8282\u70b9\u8fde\u63a5\u4fe1\u606f\uff0c\u4e8e\u662f\u5c31\u80fd\u548c\u4ece\u8282\u70b9\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u76d1\u63a7\u4e86\u3002</p>"},{"location":"redis/cluster/sentinel/#_14","title":"\u603b\u7ed3","text":"<p>Redis \u5728 2.8 \u7248\u672c\u4ee5\u540e\u63d0\u4f9b\u7684\u54e8\u5175\uff08Sentinel\uff09\u673a\u5236\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u5b9e\u73b0\u4e3b\u4ece\u8282\u70b9\u6545\u969c\u8f6c\u79fb\u3002\u5b83\u4f1a\u76d1\u6d4b\u4e3b\u8282\u70b9\u662f\u5426\u5b58\u6d3b\uff0c\u5982\u679c\u53d1\u73b0\u4e3b\u8282\u70b9\u6302\u4e86\uff0c\u5b83\u5c31\u4f1a\u9009\u4e3e\u4e00\u4e2a\u4ece\u8282\u70b9\u5207\u6362\u4e3a\u4e3b\u8282\u70b9\uff0c\u5e76\u4e14\u628a\u65b0\u4e3b\u8282\u70b9\u7684\u76f8\u5173\u4fe1\u606f\u901a\u77e5\u7ed9\u4ece\u8282\u70b9\u548c\u5ba2\u6237\u7aef\u3002</p> <p>\u54e8\u5175\u4e00\u822c\u662f\u4ee5\u96c6\u7fa4\u7684\u65b9\u5f0f\u90e8\u7f72\uff0c\u81f3\u5c11\u9700\u8981 3 \u4e2a\u54e8\u5175\u8282\u70b9\uff0c\u54e8\u5175\u96c6\u7fa4\u4e3b\u8981\u8d1f\u8d23\u4e09\u4ef6\u4e8b\u60c5\uff1a\u76d1\u63a7\u3001\u9009\u4e3b\u3001\u901a\u77e5\u3002</p> <p>\u54e8\u5175\u8282\u70b9\u901a\u8fc7 Redis \u7684\u53d1\u5e03\u8005/\u8ba2\u9605\u8005\u673a\u5236\uff0c\u54e8\u5175\u4e4b\u95f4\u53ef\u4ee5\u76f8\u4e92\u611f\u77e5\uff0c\u76f8\u4e92\u8fde\u63a5\uff0c\u7136\u540e\u7ec4\u6210\u54e8\u5175\u96c6\u7fa4\uff0c\u540c\u65f6\u54e8\u5175\u53c8\u901a\u8fc7 INFO \u547d\u4ee4\uff0c\u5728\u4e3b\u8282\u70b9\u91cc\u83b7\u5f97\u4e86\u6240\u6709\u4ece\u8282\u70b9\u8fde\u63a5\u4fe1\u606f\uff0c\u4e8e\u662f\u5c31\u80fd\u548c\u4ece\u8282\u70b9\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u8fdb\u884c\u76d1\u63a7\u4e86\u3002</p> <p>1\u3001\u7b2c\u4e00\u8f6e\u6295\u7968\uff1a\u5224\u65ad\u4e3b\u8282\u70b9\u4e0b\u7ebf</p> <p>\u5f53\u54e8\u5175\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e2a\u54e8\u5175\u5224\u5b9a\u4e3b\u8282\u70b9\u4e0b\u7ebf\uff08\u4e3b\u89c2\u4e0b\u7ebf\uff09\u540e\uff0c\u5c31\u4f1a\u5411\u5176\u4ed6\u54e8\u5175\u53d1\u8d77\u547d\u4ee4\uff0c\u5176\u4ed6\u54e8\u5175\u6536\u5230\u8fd9\u4e2a\u547d\u4ee4\u540e\uff0c\u5c31\u4f1a\u6839\u636e\u81ea\u8eab\u548c\u4e3b\u8282\u70b9\u7684\u7f51\u7edc\u72b6\u51b5\uff0c\u505a\u51fa\u8d5e\u6210\u6295\u7968\u6216\u8005\u62d2\u7edd\u6295\u7968\u7684\u54cd\u5e94\u3002</p> <p>\u5f53\u8fd9\u4e2a\u54e8\u5175\u7684\u8d5e\u540c\u7968\u6570\u8fbe\u5230\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 quorum \u914d\u7f6e\u9879\u8bbe\u5b9a\u7684\u503c\u540e\uff0c\u8fd9\u65f6\u4e3b\u8282\u70b9\u5c31\u4f1a\u88ab\u8be5\u54e8\u5175\u6807\u8bb0\u4e3a\u300c\u5ba2\u89c2\u4e0b\u7ebf\u300d\u3002</p> <p>2\u3001\u7b2c\u4e8c\u8f6e\u6295\u7968\uff1a\u9009\u51fa\u54e8\u5175 leader</p> <p>\u67d0\u4e2a\u54e8\u5175\u5224\u5b9a\u4e3b\u8282\u70b9\u5ba2\u89c2\u4e0b\u7ebf\u540e\uff0c\u8be5\u54e8\u5175\u5c31\u4f1a\u53d1\u8d77\u6295\u7968\uff0c\u544a\u8bc9\u5176\u4ed6\u54e8\u5175\uff0c\u5b83\u60f3\u6210\u4e3a leader\uff0c\u60f3\u6210\u4e3a leader \u7684\u54e8\u5175\u8282\u70b9\uff0c\u8981\u6ee1\u8db3\u4e24\u4e2a\u6761\u4ef6\uff1a</p> <ul> <li>\u7b2c\u4e00\uff0c\u62ff\u5230\u534a\u6570\u4ee5\u4e0a\u7684\u8d5e\u6210\u7968\uff1b</li> <li>\u7b2c\u4e8c\uff0c\u62ff\u5230\u7684\u7968\u6570\u540c\u65f6\u8fd8\u9700\u8981\u5927\u4e8e\u7b49\u4e8e\u54e8\u5175\u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 quorum \u503c\u3002</li> </ul> <p>3\u3001\u7531\u54e8\u5175 leader \u8fdb\u884c\u4e3b\u4ece\u6545\u969c\u8f6c\u79fb</p> <p>\u9009\u4e3e\u51fa\u4e86\u54e8\u5175 leader \u540e\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e3b\u4ece\u6545\u969c\u8f6c\u79fb\u7684\u8fc7\u7a0b\u4e86\u3002\u8be5\u64cd\u4f5c\u5305\u542b\u4ee5\u4e0b\u56db\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\uff1a\u5728\u5df2\u4e0b\u7ebf\u4e3b\u8282\u70b9\uff08\u65e7\u4e3b\u8282\u70b9\uff09\u5c5e\u4e0b\u7684\u6240\u6709\u300c\u4ece\u8282\u70b9\u300d\u91cc\u9762\uff0c\u6311\u9009\u51fa\u4e00\u4e2a\u4ece\u8282\u70b9\uff0c\u5e76\u5c06\u5176\u8f6c\u6362\u4e3a\u4e3b\u8282\u70b9\uff0c\u9009\u62e9\u7684\u89c4\u5219\uff1a</li> <li>\u8fc7\u6ee4\u6389\u5df2\u7ecf\u79bb\u7ebf\u7684\u4ece\u8282\u70b9\uff1b</li> <li>\u8fc7\u6ee4\u6389\u5386\u53f2\u7f51\u7edc\u8fde\u63a5\u72b6\u6001\u4e0d\u597d\u7684\u4ece\u8282\u70b9\uff1b</li> <li>\u5c06\u5269\u4e0b\u7684\u4ece\u8282\u70b9\uff0c\u8fdb\u884c\u4e09\u8f6e\u8003\u5bdf\uff1a\u4f18\u5148\u7ea7\u3001\u590d\u5236\u8fdb\u5ea6\u3001ID \u53f7\u3002\u5728\u6bcf\u4e00\u8f6e\u8003\u5bdf\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u627e\u5230\u4e86\u4e00\u4e2a\u80dc\u51fa\u7684\u4ece\u8282\u70b9\uff0c\u5c31\u5c06\u5176\u4f5c\u4e3a\u65b0\u4e3b\u8282\u70b9\u3002</li> <li>\u7b2c\u4e8c\u6b65\uff1a\u8ba9\u5df2\u4e0b\u7ebf\u4e3b\u8282\u70b9\u5c5e\u4e0b\u7684\u6240\u6709\u300c\u4ece\u8282\u70b9\u300d\u4fee\u6539\u590d\u5236\u76ee\u6807\uff0c\u4fee\u6539\u4e3a\u590d\u5236\u300c\u65b0\u4e3b\u8282\u70b9\u300d\uff1b</li> <li>\u7b2c\u4e09\u6b65\uff1a\u5c06\u65b0\u4e3b\u8282\u70b9\u7684 IP \u5730\u5740\u548c\u4fe1\u606f\uff0c\u901a\u8fc7\u300c\u53d1\u5e03\u8005/\u8ba2\u9605\u8005\u673a\u5236\u300d\u901a\u77e5\u7ed9\u5ba2\u6237\u7aef\uff1b</li> <li>\u7b2c\u56db\u6b65\uff1a\u7ee7\u7eed\u76d1\u89c6\u65e7\u4e3b\u8282\u70b9\uff0c\u5f53\u8fd9\u4e2a\u65e7\u4e3b\u8282\u70b9\u91cd\u65b0\u4e0a\u7ebf\u65f6\uff0c\u5c06\u5b83\u8bbe\u7f6e\u4e3a\u65b0\u4e3b\u8282\u70b9\u7684\u4ece\u8282\u70b9\uff1b</li> </ul> <p>\u5b8c\uff01</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u300aRedis \u6838\u5fc3\u6280\u672f\u4e0e\u5b9e\u6218\u300b</li> <li>\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/data_struct/command/","title":"Redis \u5e38\u89c1\u6570\u636e\u7c7b\u578b\u548c\u5e94\u7528\u573a\u666f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6211\u4eec\u90fd\u77e5\u9053 Redis \u63d0\u4f9b\u4e86\u4e30\u5bcc\u7684\u6570\u636e\u7c7b\u578b\uff0c\u5e38\u89c1\u7684\u6709\u4e94\u79cd\uff1aString\uff08\u5b57\u7b26\u4e32\uff09\uff0cHash\uff08\u54c8\u5e0c\uff09\uff0cList\uff08\u5217\u8868\uff09\uff0cSet\uff08\u96c6\u5408\uff09\u3001Zset\uff08\u6709\u5e8f\u96c6\u5408\uff09\u3002</p> <p>\u968f\u7740 Redis \u7248\u672c\u7684\u66f4\u65b0\uff0c\u540e\u9762\u53c8\u652f\u6301\u4e86\u56db\u79cd\u6570\u636e\u7c7b\u578b\uff1a BitMap\uff082.2 \u7248\u65b0\u589e\uff09\u3001HyperLogLog\uff082.8 \u7248\u65b0\u589e\uff09\u3001GEO\uff083.2 \u7248\u65b0\u589e\uff09\u3001Stream\uff085.0 \u7248\u65b0\u589e\uff09\u3002</p> <p>\u6bcf\u79cd\u6570\u636e\u5bf9\u8c61\u90fd\u6709\u5404\u81ea\u7684\u5e94\u7528\u573a\u666f\uff0c\u4f60\u80fd\u8bf4\u51fa\u5b83\u4eec\u5404\u81ea\u7684\u5e94\u7528\u573a\u666f\u5417\uff1f</p> <p>\u9762\u8bd5\u8fc7\u7a0b\u4e2d\uff0c\u8fd9\u4e2a\u95ee\u9898\u4e5f\u5f88\u5e38\u88ab\u95ee\u5230\uff0c\u53c8\u6bd4\u5982\u4f1a\u4e3e\u4f8b\u4e00\u4e2a\u5e94\u7528\u573a\u666f\u6765\u95ee\u4f60\uff0c\u8ba9\u4f60\u8bf4\u4f7f\u7528\u54ea\u79cd Redis \u6570\u636e\u7c7b\u578b\u6765\u5b9e\u73b0\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u6b21\u6211\u4eec\u5c31\u6765\u5b66\u4e60 Redis \u6570\u636e\u7c7b\u578b\u7684\u4f7f\u7528\u4ee5\u53ca\u5e94\u7528\u573a\u666f\u3002</p> <p>PS\uff1a\u4f60\u53ef\u4ee5\u81ea\u5df1\u672c\u673a\u5b89\u88c5 Redis \u6216\u8005\u901a\u8fc7 Redis \u5b98\u7f51\u63d0\u4f9b\u7684\u5728\u7ebf Redis \u73af\u5883 \u6765\u6572\u547d\u4ee4\u3002</p> <p></p>"},{"location":"redis/data_struct/command/#string","title":"String","text":""},{"location":"redis/data_struct/command/#_1","title":"\u4ecb\u7ecd","text":"<p>String \u662f\u6700\u57fa\u672c\u7684 key-value \u7ed3\u6784\uff0ckey \u662f\u552f\u4e00\u6807\u8bc6\uff0cvalue \u662f\u5177\u4f53\u7684\u503c\uff0cvalue \u5176\u5b9e\u4e0d\u4ec5\u662f\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u662f\u6570\u5b57\uff08\u6574\u6570\u6216\u6d6e\u70b9\u6570\uff09\uff0cvalue \u6700\u591a\u53ef\u4ee5\u5bb9\u7eb3\u7684\u6570\u636e\u957f\u5ea6\u662f <code>512M</code>\u3002</p> <p></p>"},{"location":"redis/data_struct/command/#_2","title":"\u5185\u90e8\u5b9e\u73b0","text":"<p>String \u7c7b\u578b\u7684\u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u4e3b\u8981\u662f int \u548c SDS\uff08\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff09\u3002</p> <p>SDS \u548c\u6211\u4eec\u8ba4\u8bc6\u7684 C \u5b57\u7b26\u4e32\u4e0d\u592a\u4e00\u6837\uff0c\u4e4b\u6240\u4ee5\u6ca1\u6709\u4f7f\u7528 C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u8868\u793a\uff0c\u56e0\u4e3a SDS \u76f8\u6bd4\u4e8e C \u7684\u539f\u751f\u5b57\u7b26\u4e32\uff1a</p> <ul> <li>SDS  \u4e0d\u4ec5\u53ef\u4ee5\u4fdd\u5b58\u6587\u672c\u6570\u636e\uff0c\u8fd8\u53ef\u4ee5\u4fdd\u5b58\u4e8c\u8fdb\u5236\u6570\u636e\u3002\u56e0\u4e3a <code>SDS</code> \u4f7f\u7528 <code>len</code> \u5c5e\u6027\u7684\u503c\u800c\u4e0d\u662f\u7a7a\u5b57\u7b26\u6765\u5224\u65ad\u5b57\u7b26\u4e32\u662f\u5426\u7ed3\u675f\uff0c\u5e76\u4e14 SDS \u7684\u6240\u6709 API \u90fd\u4f1a\u4ee5\u5904\u7406\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u6765\u5904\u7406 SDS \u5b58\u653e\u5728 <code>buf[]</code> \u6570\u7ec4\u91cc\u7684\u6570\u636e\u3002\u6240\u4ee5 SDS \u4e0d\u5149\u80fd\u5b58\u653e\u6587\u672c\u6570\u636e\uff0c\u800c\u4e14\u80fd\u4fdd\u5b58\u56fe\u7247\u3001\u97f3\u9891\u3001\u89c6\u9891\u3001\u538b\u7f29\u6587\u4ef6\u8fd9\u6837\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u3002</li> <li>SDS \u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\u3002\u56e0\u4e3a C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u5e76\u4e0d\u8bb0\u5f55\u81ea\u8eab\u957f\u5ea6\uff0c\u6240\u4ee5\u83b7\u53d6\u957f\u5ea6\u7684\u590d\u6742\u5ea6\u4e3a O(n)\uff1b\u800c SDS \u7ed3\u6784\u91cc\u7528 <code>len</code> \u5c5e\u6027\u8bb0\u5f55\u4e86\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u4e3a <code>O(1)</code>\u3002</li> <li>Redis \u7684 SDS API \u662f\u5b89\u5168\u7684\uff0c\u62fc\u63a5\u5b57\u7b26\u4e32\u4e0d\u4f1a\u9020\u6210\u7f13\u51b2\u533a\u6ea2\u51fa\u3002\u56e0\u4e3a SDS \u5728\u62fc\u63a5\u5b57\u7b26\u4e32\u4e4b\u524d\u4f1a\u68c0\u67e5 SDS \u7a7a\u95f4\u662f\u5426\u6ee1\u8db3\u8981\u6c42\uff0c\u5982\u679c\u7a7a\u95f4\u4e0d\u591f\u4f1a\u81ea\u52a8\u6269\u5bb9\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5bfc\u81f4\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\u3002</li> </ul> <p>\u5b57\u7b26\u4e32\u5bf9\u8c61\u7684\u5185\u90e8\u7f16\u7801\uff08encoding\uff09\u6709 3 \u79cd\uff1aint\u3001raw \u548c embstr\u3002</p> <p></p> <p>\u5982\u679c\u4e00\u4e2a\u5b57\u7b26\u4e32\u5bf9\u8c61\u4fdd\u5b58\u7684\u662f\u6574\u6570\u503c\uff0c\u5e76\u4e14\u8fd9\u4e2a\u6574\u6570\u503c\u53ef\u4ee5\u7528<code>long</code>\u7c7b\u578b\u6765\u8868\u793a\uff0c\u90a3\u4e48\u5b57\u7b26\u4e32\u5bf9\u8c61\u4f1a\u5c06\u6574\u6570\u503c\u4fdd\u5b58\u5728\u5b57\u7b26\u4e32\u5bf9\u8c61\u7ed3\u6784\u7684<code>ptr</code>\u5c5e\u6027\u91cc\u9762\uff08\u5c06<code>void*</code>\u8f6c\u6362\u6210 long\uff09\uff0c\u5e76\u5c06\u5b57\u7b26\u4e32\u5bf9\u8c61\u7684\u7f16\u7801\u8bbe\u7f6e\u4e3a<code>int</code>\u3002</p> <p></p> <p>\u5982\u679c\u5b57\u7b26\u4e32\u5bf9\u8c61\u4fdd\u5b58\u7684\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u5c0f\u4e8e\u7b49\u4e8e 32 \u5b57\u8282\uff08redis 2.+\u7248\u672c\uff09\uff0c\u90a3\u4e48\u5b57\u7b26\u4e32\u5bf9\u8c61\u5c06\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff08SDS\uff09\u6765\u4fdd\u5b58\u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u5c06\u5bf9\u8c61\u7684\u7f16\u7801\u8bbe\u7f6e\u4e3a<code>embstr</code>\uff0c <code>embstr</code>\u7f16\u7801\u662f\u4e13\u95e8\u7528\u4e8e\u4fdd\u5b58\u77ed\u5b57\u7b26\u4e32\u7684\u4e00\u79cd\u4f18\u5316\u7f16\u7801\u65b9\u5f0f\uff1a</p> <p></p> <p>\u5982\u679c\u5b57\u7b26\u4e32\u5bf9\u8c61\u4fdd\u5b58\u7684\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u4e14\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u5927\u4e8e 32 \u5b57\u8282\uff08redis 2.+\u7248\u672c\uff09\uff0c\u90a3\u4e48\u5b57\u7b26\u4e32\u5bf9\u8c61\u5c06\u4f7f\u7528\u4e00\u4e2a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff08SDS\uff09\u6765\u4fdd\u5b58\u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u5e76\u5c06\u5bf9\u8c61\u7684\u7f16\u7801\u8bbe\u7f6e\u4e3a<code>raw</code>\uff1a</p> <p></p> <p>\u6ce8\u610f\uff0cembstr \u7f16\u7801\u548c raw \u7f16\u7801\u7684\u8fb9\u754c\u5728 redis \u4e0d\u540c\u7248\u672c\u4e2d\u662f\u4e0d\u4e00\u6837\u7684\uff1a</p> <ul> <li>redis 2.+ \u662f 32 \u5b57\u8282</li> <li>redis 3.0-4.0 \u662f 39 \u5b57\u8282</li> <li>redis 5.0 \u662f 44 \u5b57\u8282</li> </ul> <p>\u53ef\u4ee5\u770b\u5230<code>embstr</code>\u548c<code>raw</code>\u7f16\u7801\u90fd\u4f1a\u4f7f\u7528<code>SDS</code>\u6765\u4fdd\u5b58\u503c\uff0c\u4f46\u4e0d\u540c\u4e4b\u5904\u5728\u4e8e<code>embstr</code>\u4f1a\u901a\u8fc7\u4e00\u6b21\u5185\u5b58\u5206\u914d\u51fd\u6570\u6765\u5206\u914d\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u6765\u4fdd\u5b58<code>redisObject</code>\u548c<code>SDS</code>\uff0c\u800c<code>raw</code>\u7f16\u7801\u4f1a\u901a\u8fc7\u8c03\u7528\u4e24\u6b21\u5185\u5b58\u5206\u914d\u51fd\u6570\u6765\u5206\u522b\u5206\u914d\u4e24\u5757\u7a7a\u95f4\u6765\u4fdd\u5b58<code>redisObject</code>\u548c<code>SDS</code>\u3002Redis \u8fd9\u6837\u505a\u4f1a\u6709\u5f88\u591a\u597d\u5904\uff1a</p> <ul> <li><code>embstr</code>\u7f16\u7801\u5c06\u521b\u5efa\u5b57\u7b26\u4e32\u5bf9\u8c61\u6240\u9700\u7684\u5185\u5b58\u5206\u914d\u6b21\u6570\u4ece <code>raw</code> \u7f16\u7801\u7684\u4e24\u6b21\u964d\u4f4e\u4e3a\u4e00\u6b21\uff1b</li> <li>\u91ca\u653e <code>embstr</code>\u7f16\u7801\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u540c\u6837\u53ea\u9700\u8981\u8c03\u7528\u4e00\u6b21\u5185\u5b58\u91ca\u653e\u51fd\u6570\uff1b</li> <li>\u56e0\u4e3a<code>embstr</code>\u7f16\u7801\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u7684\u6240\u6709\u6570\u636e\u90fd\u4fdd\u5b58\u5728\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u91cc\u9762\u53ef\u4ee5\u66f4\u597d\u7684\u5229\u7528 CPU \u7f13\u5b58\u63d0\u5347\u6027\u80fd\u3002</li> </ul> <p>\u4f46\u662f embstr \u4e5f\u6709\u7f3a\u70b9\u7684\uff1a</p> <ul> <li>\u5982\u679c\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u589e\u52a0\u9700\u8981\u91cd\u65b0\u5206\u914d\u5185\u5b58\u65f6\uff0c\u6574\u4e2a redisObject \u548c sds \u90fd\u9700\u8981\u91cd\u65b0\u5206\u914d\u7a7a\u95f4\uff0c\u6240\u4ee5embstr \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u5b9e\u9645\u4e0a\u662f\u53ea\u8bfb\u7684\uff0credis \u6ca1\u6709\u4e3a embstr \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u7f16\u5199\u4efb\u4f55\u76f8\u5e94\u7684\u4fee\u6539\u7a0b\u5e8f\u3002\u5f53\u6211\u4eec\u5bf9 embstr \u7f16\u7801\u7684\u5b57\u7b26\u4e32\u5bf9\u8c61\u6267\u884c\u4efb\u4f55\u4fee\u6539\u547d\u4ee4\uff08\u4f8b\u5982 append\uff09\u65f6\uff0c\u7a0b\u5e8f\u4f1a\u5148\u5c06\u5bf9\u8c61\u7684\u7f16\u7801\u4ece embstr \u8f6c\u6362\u6210 raw\uff0c\u7136\u540e\u518d\u6267\u884c\u4fee\u6539\u547d\u4ee4\u3002</li> </ul>"},{"location":"redis/data_struct/command/#_3","title":"\u5e38\u7528\u6307\u4ee4","text":"<p>\u666e\u901a\u5b57\u7b26\u4e32\u7684\u57fa\u672c\u64cd\u4f5c\uff1a</p> Bash<pre><code># \u8bbe\u7f6e key-value \u7c7b\u578b\u7684\u503c\n&gt; SET name lin\nOK\n# \u6839\u636e key \u83b7\u5f97\u5bf9\u5e94\u7684 value\n&gt; GET name\n\"lin\"\n# \u5224\u65ad\u67d0\u4e2a key \u662f\u5426\u5b58\u5728\n&gt; EXISTS name\n(integer) 1\n# \u8fd4\u56de key \u6240\u50a8\u5b58\u7684\u5b57\u7b26\u4e32\u503c\u7684\u957f\u5ea6\n&gt; STRLEN name\n(integer) 3\n# \u5220\u9664\u67d0\u4e2a key \u5bf9\u5e94\u7684\u503c\n&gt; DEL name\n(integer) 1\n</code></pre> <p>\u6279\u91cf\u8bbe\u7f6e :</p> Bash<pre><code># \u6279\u91cf\u8bbe\u7f6e key-value \u7c7b\u578b\u7684\u503c\n&gt; MSET key1 value1 key2 value2 \nOK\n# \u6279\u91cf\u83b7\u53d6\u591a\u4e2a key \u5bf9\u5e94\u7684 value\n&gt; MGET key1 key2 \n1) \"value1\"\n2) \"value2\"\n</code></pre> <p>\u8ba1\u6570\u5668\uff08\u5b57\u7b26\u4e32\u7684\u5185\u5bb9\u4e3a\u6574\u6570\u7684\u65f6\u5019\u53ef\u4ee5\u4f7f\u7528\uff09\uff1a</p> Bash<pre><code># \u8bbe\u7f6e key-value \u7c7b\u578b\u7684\u503c\n&gt; SET number 0\nOK\n# \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u589e\u4e00\n&gt; INCR number\n(integer) 1\n# \u5c06key\u4e2d\u5b58\u50a8\u7684\u6570\u5b57\u503c\u52a0 10\n&gt; INCRBY number 10\n(integer) 11\n# \u5c06 key \u4e2d\u50a8\u5b58\u7684\u6570\u5b57\u503c\u51cf\u4e00\n&gt; DECR number\n(integer) 10\n# \u5c06key\u4e2d\u5b58\u50a8\u7684\u6570\u5b57\u503c\u952e 10\n&gt; DECRBY number 10\n(integer) 0\n</code></pre> <p>\u8fc7\u671f\uff08\u9ed8\u8ba4\u4e3a\u6c38\u4e0d\u8fc7\u671f\uff09\uff1a</p> Bash<pre><code># \u8bbe\u7f6e key \u5728 60 \u79d2\u540e\u8fc7\u671f\uff08\u8be5\u65b9\u6cd5\u662f\u9488\u5bf9\u5df2\u7ecf\u5b58\u5728\u7684key\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff09\n&gt; EXPIRE name  60 \n(integer) 1\n# \u67e5\u770b\u6570\u636e\u8fd8\u6709\u591a\u4e45\u8fc7\u671f\n&gt; TTL name \n(integer) 51\n\n#\u8bbe\u7f6e key-value \u7c7b\u578b\u7684\u503c\uff0c\u5e76\u8bbe\u7f6e\u8be5key\u7684\u8fc7\u671f\u65f6\u95f4\u4e3a 60 \u79d2\n&gt; SET key  value EX 60\nOK\n&gt; SETEX key  60 value\nOK\n</code></pre> <p>\u4e0d\u5b58\u5728\u5c31\u63d2\u5165\uff1a</p> Bash<pre><code># \u4e0d\u5b58\u5728\u5c31\u63d2\u5165\uff08not exists\uff09\n&gt;SETNX key value\n(integer) 1\n</code></pre>"},{"location":"redis/data_struct/command/#_4","title":"\u5e94\u7528\u573a\u666f","text":""},{"location":"redis/data_struct/command/#_5","title":"\u7f13\u5b58\u5bf9\u8c61","text":"<p>\u4f7f\u7528 String \u6765\u7f13\u5b58\u5bf9\u8c61\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>\u76f4\u63a5\u7f13\u5b58\u6574\u4e2a\u5bf9\u8c61\u7684 JSON\uff0c\u547d\u4ee4\u4f8b\u5b50\uff1a <code>SET user:1 '{\"name\":\"xiaolin\", \"age\":18}'</code>\u3002</li> <li>\u91c7\u7528\u5c06 key \u8fdb\u884c\u5206\u79bb\u4e3a user:ID:\u5c5e\u6027\uff0c\u91c7\u7528 MSET \u5b58\u50a8\uff0c\u7528 MGET \u83b7\u53d6\u5404\u5c5e\u6027\u503c\uff0c\u547d\u4ee4\u4f8b\u5b50\uff1a <code>MSET user:1:name xiaolin user:1:age 18 user:2:name xiaomei user:2:age 20</code>\u3002</li> </ul>"},{"location":"redis/data_struct/command/#_6","title":"\u5e38\u89c4\u8ba1\u6570","text":"<p>\u56e0\u4e3a Redis \u5904\u7406\u547d\u4ee4\u662f\u5355\u7ebf\u7a0b\uff0c\u6240\u4ee5\u6267\u884c\u547d\u4ee4\u7684\u8fc7\u7a0b\u662f\u539f\u5b50\u7684\u3002\u56e0\u6b64 String \u6570\u636e\u7c7b\u578b\u9002\u5408\u8ba1\u6570\u573a\u666f\uff0c\u6bd4\u5982\u8ba1\u7b97\u8bbf\u95ee\u6b21\u6570\u3001\u70b9\u8d5e\u3001\u8f6c\u53d1\u3001\u5e93\u5b58\u6570\u91cf\u7b49\u7b49\u3002</p> <p>\u6bd4\u5982\u8ba1\u7b97\u6587\u7ae0\u7684\u9605\u8bfb\u91cf\uff1a</p> Bash<pre><code># \u521d\u59cb\u5316\u6587\u7ae0\u7684\u9605\u8bfb\u91cf\n&gt; SET aritcle:readcount:1001 0\nOK\n#\u9605\u8bfb\u91cf+1\n&gt; INCR aritcle:readcount:1001\n(integer) 1\n#\u9605\u8bfb\u91cf+1\n&gt; INCR aritcle:readcount:1001\n(integer) 2\n#\u9605\u8bfb\u91cf+1\n&gt; INCR aritcle:readcount:1001\n(integer) 3\n# \u83b7\u53d6\u5bf9\u5e94\u6587\u7ae0\u7684\u9605\u8bfb\u91cf\n&gt; GET aritcle:readcount:1001\n\"3\"\n</code></pre>"},{"location":"redis/data_struct/command/#_7","title":"\u5206\u5e03\u5f0f\u9501","text":"<p>SET \u547d\u4ee4\u6709\u4e2a NX \u53c2\u6570\u53ef\u4ee5\u5b9e\u73b0\u300ckey \u4e0d\u5b58\u5728\u624d\u63d2\u5165\u300d\uff0c\u53ef\u4ee5\u7528\u5b83\u6765\u5b9e\u73b0\u5206\u5e03\u5f0f\u9501\uff1a</p> <ul> <li>\u5982\u679c key \u4e0d\u5b58\u5728\uff0c\u5219\u663e\u793a\u63d2\u5165\u6210\u529f\uff0c\u53ef\u4ee5\u7528\u6765\u8868\u793a\u52a0\u9501\u6210\u529f\uff1b</li> <li>\u5982\u679c key \u5b58\u5728\uff0c\u5219\u4f1a\u663e\u793a\u63d2\u5165\u5931\u8d25\uff0c\u53ef\u4ee5\u7528\u6765\u8868\u793a\u52a0\u9501\u5931\u8d25\u3002</li> </ul> <p>\u4e00\u822c\u800c\u8a00\uff0c\u8fd8\u4f1a\u5bf9\u5206\u5e03\u5f0f\u9501\u52a0\u4e0a\u8fc7\u671f\u65f6\u95f4\uff0c\u5206\u5e03\u5f0f\u9501\u7684\u547d\u4ee4\u5982\u4e0b\uff1a</p> Bash<pre><code>SET lock_key unique_value NX PX 10000\n</code></pre> <ul> <li>lock_key \u5c31\u662f key \u952e\uff1b</li> <li>unique_value \u662f\u5ba2\u6237\u7aef\u751f\u6210\u7684\u552f\u4e00\u7684\u6807\u8bc6\uff1b</li> <li>NX \u4ee3\u8868\u53ea\u5728 lock_key \u4e0d\u5b58\u5728\u65f6\uff0c\u624d\u5bf9 lock_key \u8fdb\u884c\u8bbe\u7f6e\u64cd\u4f5c\uff1b</li> <li>PX 10000 \u8868\u793a\u8bbe\u7f6e lock_key \u7684\u8fc7\u671f\u65f6\u95f4\u4e3a 10s\uff0c\u8fd9\u662f\u4e3a\u4e86\u907f\u514d\u5ba2\u6237\u7aef\u53d1\u751f\u5f02\u5e38\u800c\u65e0\u6cd5\u91ca\u653e\u9501\u3002</li> </ul> <p>\u800c\u89e3\u9501\u7684\u8fc7\u7a0b\u5c31\u662f\u5c06 lock_key \u952e\u5220\u9664\uff0c\u4f46\u4e0d\u80fd\u4e71\u5220\uff0c\u8981\u4fdd\u8bc1\u6267\u884c\u64cd\u4f5c\u7684\u5ba2\u6237\u7aef\u5c31\u662f\u52a0\u9501\u7684\u5ba2\u6237\u7aef\u3002\u6240\u4ee5\uff0c\u89e3\u9501\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8981\u5148\u5224\u65ad\u9501\u7684 unique_value \u662f\u5426\u4e3a\u52a0\u9501\u5ba2\u6237\u7aef\uff0c\u662f\u7684\u8bdd\uff0c\u624d\u5c06 lock_key \u952e\u5220\u9664\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u89e3\u9501\u662f\u6709\u4e24\u4e2a\u64cd\u4f5c\uff0c\u8fd9\u65f6\u5c31\u9700\u8981 Lua \u811a\u672c\u6765\u4fdd\u8bc1\u89e3\u9501\u7684\u539f\u5b50\u6027\uff0c\u56e0\u4e3a Redis \u5728\u6267\u884c Lua \u811a\u672c\u65f6\uff0c\u53ef\u4ee5\u4ee5\u539f\u5b50\u6027\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u4fdd\u8bc1\u4e86\u9501\u91ca\u653e\u64cd\u4f5c\u7684\u539f\u5b50\u6027\u3002</p> Lua<pre><code>// \u91ca\u653e\u9501\u65f6\uff0c\u5148\u6bd4\u8f83 unique_value \u662f\u5426\u76f8\u7b49\uff0c\u907f\u514d\u9501\u7684\u8bef\u91ca\u653e\nif redis.call(\"get\",KEYS[1]) == ARGV[1] then\n    return redis.call(\"del\",KEYS[1])\nelse\n    return 0\nend\n</code></pre> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5c31\u901a\u8fc7\u4f7f\u7528 SET \u547d\u4ee4\u548c Lua \u811a\u672c\u5728 Redis \u5355\u8282\u70b9\u4e0a\u5b8c\u6210\u4e86\u5206\u5e03\u5f0f\u9501\u7684\u52a0\u9501\u548c\u89e3\u9501\u3002</p>"},{"location":"redis/data_struct/command/#session","title":"\u5171\u4eab Session \u4fe1\u606f","text":"<p>\u901a\u5e38\u6211\u4eec\u5728\u5f00\u53d1\u540e\u53f0\u7ba1\u7406\u7cfb\u7edf\u65f6\uff0c\u4f1a\u4f7f\u7528 Session \u6765\u4fdd\u5b58\u7528\u6237\u7684\u4f1a\u8bdd (\u767b\u5f55) \u72b6\u6001\uff0c\u8fd9\u4e9b Session \u4fe1\u606f\u4f1a\u88ab\u4fdd\u5b58\u5728\u670d\u52a1\u5668\u7aef\uff0c\u4f46\u8fd9\u53ea\u9002\u7528\u4e8e\u5355\u7cfb\u7edf\u5e94\u7528\uff0c\u5982\u679c\u662f\u5206\u5e03\u5f0f\u7cfb\u7edf\u6b64\u6a21\u5f0f\u5c06\u4e0d\u518d\u9002\u7528\u3002</p> <p>\u4f8b\u5982\u7528\u6237\u4e00\u7684 Session \u4fe1\u606f\u88ab\u5b58\u50a8\u5728\u670d\u52a1\u5668\u4e00\uff0c\u4f46\u7b2c\u4e8c\u6b21\u8bbf\u95ee\u65f6\u7528\u6237\u4e00\u88ab\u5206\u914d\u5230\u670d\u52a1\u5668\u4e8c\uff0c\u8fd9\u4e2a\u65f6\u5019\u670d\u52a1\u5668\u5e76\u6ca1\u6709\u7528\u6237\u4e00\u7684 Session \u4fe1\u606f\uff0c\u5c31\u4f1a\u51fa\u73b0\u9700\u8981\u91cd\u590d\u767b\u5f55\u7684\u95ee\u9898\uff0c\u95ee\u9898\u5728\u4e8e\u5206\u5e03\u5f0f\u7cfb\u7edf\u6bcf\u6b21\u4f1a\u628a\u8bf7\u6c42\u968f\u673a\u5206\u914d\u5230\u4e0d\u540c\u7684\u670d\u52a1\u5668\u3002</p> <p>\u5206\u5e03\u5f0f\u7cfb\u7edf\u5355\u72ec\u5b58\u50a8 Session \u6d41\u7a0b\u56fe\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u501f\u52a9 Redis \u5bf9\u8fd9\u4e9b Session \u4fe1\u606f\u8fdb\u884c\u7edf\u4e00\u7684\u5b58\u50a8\u548c\u7ba1\u7406\uff0c\u8fd9\u6837\u65e0\u8bba\u8bf7\u6c42\u53d1\u9001\u5230\u90a3\u53f0\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u90fd\u4f1a\u53bb\u540c\u4e00\u4e2a Redis \u83b7\u53d6\u76f8\u5173\u7684 Session \u4fe1\u606f\uff0c\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e0b Session \u5b58\u50a8\u7684\u95ee\u9898\u3002</p> <p>\u5206\u5e03\u5f0f\u7cfb\u7edf\u4f7f\u7528\u540c\u4e00\u4e2a Redis \u5b58\u50a8 Session \u6d41\u7a0b\u56fe\uff1a</p> <p></p>"},{"location":"redis/data_struct/command/#list","title":"List","text":""},{"location":"redis/data_struct/command/#_8","title":"\u4ecb\u7ecd","text":"<p>List \u5217\u8868\u662f\u7b80\u5355\u7684\u5b57\u7b26\u4e32\u5217\u8868\uff0c\u6309\u7167\u63d2\u5165\u987a\u5e8f\u6392\u5e8f\uff0c\u53ef\u4ee5\u4ece\u5934\u90e8\u6216\u5c3e\u90e8\u5411 List \u5217\u8868\u6dfb\u52a0\u5143\u7d20\u3002</p> <p>\u5217\u8868\u7684\u6700\u5927\u957f\u5ea6\u4e3a <code>2^32 - 1</code>\uff0c\u4e5f\u5373\u6bcf\u4e2a\u5217\u8868\u652f\u6301\u8d85\u8fc7 <code>40 \u4ebf</code>\u4e2a\u5143\u7d20\u3002</p>"},{"location":"redis/data_struct/command/#_9","title":"\u5185\u90e8\u5b9e\u73b0","text":"<p>List \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531\u53cc\u5411\u94fe\u8868\u6216\u538b\u7f29\u5217\u8868\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u5982\u679c\u5217\u8868\u7684\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e <code>512</code> \u4e2a\uff08\u9ed8\u8ba4\u503c\uff0c\u53ef\u7531 <code>list-max-ziplist-entries</code> \u914d\u7f6e\uff09\uff0c\u5217\u8868\u6bcf\u4e2a\u5143\u7d20\u7684\u503c\u90fd\u5c0f\u4e8e <code>64</code> \u5b57\u8282\uff08\u9ed8\u8ba4\u503c\uff0c\u53ef\u7531 <code>list-max-ziplist-value</code> \u914d\u7f6e\uff09\uff0cRedis \u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u4f5c\u4e3a List \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> <li>\u5982\u679c\u5217\u8868\u7684\u5143\u7d20\u4e0d\u6ee1\u8db3\u4e0a\u9762\u7684\u6761\u4ef6\uff0cRedis \u4f1a\u4f7f\u7528\u53cc\u5411\u94fe\u8868\u4f5c\u4e3a List \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> </ul> <p>\u4f46\u662f\u5728 Redis 3.2 \u7248\u672c\u4e4b\u540e\uff0cList \u6570\u636e\u7c7b\u578b\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5c31\u53ea\u7531 quicklist \u5b9e\u73b0\u4e86\uff0c\u66ff\u4ee3\u4e86\u53cc\u5411\u94fe\u8868\u548c\u538b\u7f29\u5217\u8868\u3002</p>"},{"location":"redis/data_struct/command/#_10","title":"\u5e38\u7528\u547d\u4ee4","text":"Bash<pre><code># \u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u503cvalue\u63d2\u5165\u5230key\u5217\u8868\u7684\u8868\u5934(\u6700\u5de6\u8fb9)\uff0c\u6700\u540e\u7684\u503c\u5728\u6700\u524d\u9762\nLPUSH key value [value ...] \n# \u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u503cvalue\u63d2\u5165\u5230key\u5217\u8868\u7684\u8868\u5c3e(\u6700\u53f3\u8fb9)\nRPUSH key value [value ...]\n# \u79fb\u9664\u5e76\u8fd4\u56dekey\u5217\u8868\u7684\u5934\u5143\u7d20\nLPOP key     \n# \u79fb\u9664\u5e76\u8fd4\u56dekey\u5217\u8868\u7684\u5c3e\u5143\u7d20\nRPOP key \n\n# \u8fd4\u56de\u5217\u8868key\u4e2d\u6307\u5b9a\u533a\u95f4\u5185\u7684\u5143\u7d20\uff0c\u533a\u95f4\u4ee5\u504f\u79fb\u91cfstart\u548cstop\u6307\u5b9a\uff0c\u4ece0\u5f00\u59cb\nLRANGE key start stop\n\n# \u4ecekey\u5217\u8868\u8868\u5934\u5f39\u51fa\u4e00\u4e2a\u5143\u7d20\uff0c\u6ca1\u6709\u5c31\u963b\u585etimeout\u79d2\uff0c\u5982\u679ctimeout=0\u5219\u4e00\u76f4\u963b\u585e\nBLPOP key [key ...] timeout\n# \u4ecekey\u5217\u8868\u8868\u5c3e\u5f39\u51fa\u4e00\u4e2a\u5143\u7d20\uff0c\u6ca1\u6709\u5c31\u963b\u585etimeout\u79d2\uff0c\u5982\u679ctimeout=0\u5219\u4e00\u76f4\u963b\u585e\nBRPOP key [key ...] timeout\n</code></pre>"},{"location":"redis/data_struct/command/#_11","title":"\u5e94\u7528\u573a\u666f","text":""},{"location":"redis/data_struct/command/#_12","title":"\u6d88\u606f\u961f\u5217","text":"<p>\u6d88\u606f\u961f\u5217\u5728\u5b58\u53d6\u6d88\u606f\u65f6\uff0c\u5fc5\u987b\u8981\u6ee1\u8db3\u4e09\u4e2a\u9700\u6c42\uff0c\u5206\u522b\u662f\u6d88\u606f\u4fdd\u5e8f\u3001\u5904\u7406\u91cd\u590d\u7684\u6d88\u606f\u548c\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027\u3002</p> <p>Redis \u7684 List \u548c Stream \u4e24\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u5c31\u53ef\u4ee5\u6ee1\u8db3\u6d88\u606f\u961f\u5217\u7684\u8fd9\u4e09\u4e2a\u9700\u6c42\u3002\u6211\u4eec\u5148\u6765\u4e86\u89e3\u4e0b\u57fa\u4e8e List \u7684\u6d88\u606f\u961f\u5217\u5b9e\u73b0\u65b9\u6cd5\uff0c\u540e\u9762\u5728\u4ecb\u7ecd Stream \u6570\u636e\u7c7b\u578b\u65f6\u5019\uff0c\u5728\u8be6\u7ec6\u8bf4\u8bf4 Stream\u3002</p> <p>1\u3001\u5982\u4f55\u6ee1\u8db3\u6d88\u606f\u4fdd\u5e8f\u9700\u6c42\uff1f</p> <p>List \u672c\u8eab\u5c31\u662f\u6309\u5148\u8fdb\u5148\u51fa\u7684\u987a\u5e8f\u5bf9\u6570\u636e\u8fdb\u884c\u5b58\u53d6\u7684\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u4f7f\u7528 List \u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u4fdd\u5b58\u6d88\u606f\u7684\u8bdd\uff0c\u5c31\u5df2\u7ecf\u80fd\u6ee1\u8db3\u6d88\u606f\u4fdd\u5e8f\u7684\u9700\u6c42\u4e86\u3002</p> <p>List \u53ef\u4ee5\u4f7f\u7528 LPUSH + RPOP\uff08\u6216\u8005\u53cd\u8fc7\u6765\uff0cRPUSH+LPOP\uff09\u547d\u4ee4\u5b9e\u73b0\u6d88\u606f\u961f\u5217\u3002</p> <p></p> <ul> <li> <p>\u751f\u4ea7\u8005\u4f7f\u7528 <code>LPUSH key value[value...]</code> \u5c06\u6d88\u606f\u63d2\u5165\u5230\u961f\u5217\u7684\u5934\u90e8\uff0c\u5982\u679c key \u4e0d\u5b58\u5728\u5219\u4f1a\u521b\u5efa\u4e00\u4e2a\u7a7a\u7684\u961f\u5217\u518d\u63d2\u5165\u6d88\u606f\u3002</p> </li> <li> <p>\u6d88\u8d39\u8005\u4f7f\u7528 <code>RPOP key</code> \u4f9d\u6b21\u8bfb\u53d6\u961f\u5217\u7684\u6d88\u606f\uff0c\u5148\u8fdb\u5148\u51fa\u3002</p> </li> </ul> <p>\u4e0d\u8fc7\uff0c\u5728\u6d88\u8d39\u8005\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u6709\u4e00\u4e2a\u6f5c\u5728\u7684\u6027\u80fd\u98ce\u9669\u70b9\u3002</p> <p>\u5728\u751f\u4ea7\u8005\u5f80 List \u4e2d\u5199\u5165\u6570\u636e\u65f6\uff0cList \u5e76\u4e0d\u4f1a\u4e3b\u52a8\u5730\u901a\u77e5\u6d88\u8d39\u8005\u6709\u65b0\u6d88\u606f\u5199\u5165\uff0c\u5982\u679c\u6d88\u8d39\u8005\u60f3\u8981\u53ca\u65f6\u5904\u7406\u6d88\u606f\uff0c\u5c31\u9700\u8981\u5728\u7a0b\u5e8f\u4e2d\u4e0d\u505c\u5730\u8c03\u7528 <code>RPOP</code> \u547d\u4ee4\uff08\u6bd4\u5982\u4f7f\u7528\u4e00\u4e2a while(1) \u5faa\u73af\uff09\u3002\u5982\u679c\u6709\u65b0\u6d88\u606f\u5199\u5165\uff0cRPOP \u547d\u4ee4\u5c31\u4f1a\u8fd4\u56de\u7ed3\u679c\uff0c\u5426\u5219\uff0cRPOP \u547d\u4ee4\u8fd4\u56de\u7a7a\u503c\uff0c\u518d\u7ee7\u7eed\u5faa\u73af\u3002</p> <p>\u6240\u4ee5\uff0c\u5373\u4f7f\u6ca1\u6709\u65b0\u6d88\u606f\u5199\u5165 List\uff0c\u6d88\u8d39\u8005\u4e5f\u8981\u4e0d\u505c\u5730\u8c03\u7528 RPOP \u547d\u4ee4\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u6d88\u8d39\u8005\u7a0b\u5e8f\u7684 CPU \u4e00\u76f4\u6d88\u8017\u5728\u6267\u884c RPOP \u547d\u4ee4\u4e0a\uff0c\u5e26\u6765\u4e0d\u5fc5\u8981\u7684\u6027\u80fd\u635f\u5931\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u63d0\u4f9b\u4e86 BRPOP \u547d\u4ee4\u3002BRPOP \u547d\u4ee4\u4e5f\u79f0\u4e3a\u963b\u585e\u5f0f\u8bfb\u53d6\uff0c\u5ba2\u6237\u7aef\u5728\u6ca1\u6709\u8bfb\u5230\u961f\u5217\u6570\u636e\u65f6\uff0c\u81ea\u52a8\u963b\u585e\uff0c\u76f4\u5230\u6709\u65b0\u7684\u6570\u636e\u5199\u5165\u961f\u5217\uff0c\u518d\u5f00\u59cb\u8bfb\u53d6\u65b0\u6570\u636e\u3002\u548c\u6d88\u8d39\u8005\u7a0b\u5e8f\u81ea\u5df1\u4e0d\u505c\u5730\u8c03\u7528 RPOP \u547d\u4ee4\u76f8\u6bd4\uff0c\u8fd9\u79cd\u65b9\u5f0f\u80fd\u8282\u7701 CPU \u5f00\u9500\u3002</p> <p></p> <p>2\u3001\u5982\u4f55\u5904\u7406\u91cd\u590d\u7684\u6d88\u606f\uff1f</p> <p>\u6d88\u8d39\u8005\u8981\u5b9e\u73b0\u91cd\u590d\u6d88\u606f\u7684\u5224\u65ad\uff0c\u9700\u8981 2 \u4e2a\u65b9\u9762\u7684\u8981\u6c42\uff1a</p> <ul> <li>\u6bcf\u4e2a\u6d88\u606f\u90fd\u6709\u4e00\u4e2a\u5168\u5c40\u7684 ID\u3002</li> <li>\u6d88\u8d39\u8005\u8981\u8bb0\u5f55\u5df2\u7ecf\u5904\u7406\u8fc7\u7684\u6d88\u606f\u7684 ID\u3002\u5f53\u6536\u5230\u4e00\u6761\u6d88\u606f\u540e\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u5bf9\u6bd4\u6536\u5230\u7684\u6d88\u606f ID \u548c\u8bb0\u5f55\u7684\u5df2\u5904\u7406\u8fc7\u7684\u6d88\u606f ID\uff0c\u6765\u5224\u65ad\u5f53\u524d\u6536\u5230\u7684\u6d88\u606f\u6709\u6ca1\u6709\u7ecf\u8fc7\u5904\u7406\u3002\u5982\u679c\u5df2\u7ecf\u5904\u7406\u8fc7\uff0c\u90a3\u4e48\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5c31\u4e0d\u518d\u8fdb\u884c\u5904\u7406\u4e86\u3002</li> </ul> <p>\u4f46\u662f List \u5e76\u4e0d\u4f1a\u4e3a\u6bcf\u4e2a\u6d88\u606f\u751f\u6210 ID \u53f7\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u81ea\u884c\u4e3a\u6bcf\u4e2a\u6d88\u606f\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00 ID\uff0c\u751f\u6210\u4e4b\u540e\uff0c\u6211\u4eec\u5728\u7528 LPUSH \u547d\u4ee4\u628a\u6d88\u606f\u63d2\u5165 List \u65f6\uff0c\u9700\u8981\u5728\u6d88\u606f\u4e2d\u5305\u542b\u8fd9\u4e2a\u5168\u5c40\u552f\u4e00 ID\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4\uff0c\u5c31\u628a\u4e00\u6761\u5168\u5c40 ID \u4e3a 111000102\u3001\u5e93\u5b58\u91cf\u4e3a 99 \u7684\u6d88\u606f\u63d2\u5165\u4e86\u6d88\u606f\u961f\u5217\uff1a</p> Bash<pre><code>&gt; LPUSH mq \"111000102:stock:99\"\n(integer) 1\n</code></pre> <p>3\u3001\u5982\u4f55\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027\uff1f</p> <p>\u5f53\u6d88\u8d39\u8005\u7a0b\u5e8f\u4ece List \u4e2d\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\u540e\uff0cList \u5c31\u4e0d\u4f1a\u518d\u7559\u5b58\u8fd9\u6761\u6d88\u606f\u4e86\u3002\u6240\u4ee5\uff0c\u5982\u679c\u6d88\u8d39\u8005\u7a0b\u5e8f\u5728\u5904\u7406\u6d88\u606f\u7684\u8fc7\u7a0b\u51fa\u73b0\u4e86\u6545\u969c\u6216\u5b95\u673a\uff0c\u5c31\u4f1a\u5bfc\u81f4\u6d88\u606f\u6ca1\u6709\u5904\u7406\u5b8c\u6210\uff0c\u90a3\u4e48\uff0c\u6d88\u8d39\u8005\u7a0b\u5e8f\u518d\u6b21\u542f\u52a8\u540e\uff0c\u5c31\u6ca1\u6cd5\u518d\u6b21\u4ece List \u4e2d\u8bfb\u53d6\u6d88\u606f\u4e86\u3002</p> <p>\u4e3a\u4e86\u7559\u5b58\u6d88\u606f\uff0cList \u7c7b\u578b\u63d0\u4f9b\u4e86 <code>BRPOPLPUSH</code> \u547d\u4ee4\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u662f\u8ba9\u6d88\u8d39\u8005\u7a0b\u5e8f\u4ece\u4e00\u4e2a List \u4e2d\u8bfb\u53d6\u6d88\u606f\uff0c\u540c\u65f6\uff0cRedis \u4f1a\u628a\u8fd9\u4e2a\u6d88\u606f\u518d\u63d2\u5165\u5230\u53e6\u4e00\u4e2a List\uff08\u53ef\u4ee5\u53eb\u4f5c\u5907\u4efd List\uff09\u7559\u5b58\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5982\u679c\u6d88\u8d39\u8005\u7a0b\u5e8f\u8bfb\u4e86\u6d88\u606f\u4f46\u6ca1\u80fd\u6b63\u5e38\u5904\u7406\uff0c\u7b49\u5b83\u91cd\u542f\u540e\uff0c\u5c31\u53ef\u4ee5\u4ece\u5907\u4efd List \u4e2d\u91cd\u65b0\u8bfb\u53d6\u6d88\u606f\u5e76\u8fdb\u884c\u5904\u7406\u4e86\u3002</p> <p>\u597d\u4e86\uff0c\u5230\u8fd9\u91cc\u53ef\u4ee5\u77e5\u9053\u57fa\u4e8e List \u7c7b\u578b\u7684\u6d88\u606f\u961f\u5217\uff0c\u6ee1\u8db3\u6d88\u606f\u961f\u5217\u7684\u4e09\u5927\u9700\u6c42\uff08\u6d88\u606f\u4fdd\u5e8f\u3001\u5904\u7406\u91cd\u590d\u7684\u6d88\u606f\u548c\u4fdd\u8bc1\u6d88\u606f\u53ef\u9760\u6027\uff09\u3002</p> <ul> <li>\u6d88\u606f\u4fdd\u5e8f\uff1a\u4f7f\u7528 LPUSH + RPOP\uff1b</li> <li>\u963b\u585e\u8bfb\u53d6\uff1a\u4f7f\u7528 BRPOP\uff1b</li> <li>\u91cd\u590d\u6d88\u606f\u5904\u7406\uff1a\u751f\u4ea7\u8005\u81ea\u884c\u5b9e\u73b0\u5168\u5c40\u552f\u4e00 ID\uff1b</li> <li>\u6d88\u606f\u7684\u53ef\u9760\u6027\uff1a\u4f7f\u7528 BRPOPLPUSH</li> </ul> <p>List \u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u6709\u4ec0\u4e48\u7f3a\u9677\uff1f</p> <p>List \u4e0d\u652f\u6301\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\u540c\u4e00\u6761\u6d88\u606f\uff0c\u56e0\u4e3a\u4e00\u65e6\u6d88\u8d39\u8005\u62c9\u53d6\u4e00\u6761\u6d88\u606f\u540e\uff0c\u8fd9\u6761\u6d88\u606f\u5c31\u4ece List \u4e2d\u5220\u9664\u4e86\uff0c\u65e0\u6cd5\u88ab\u5176\u5b83\u6d88\u8d39\u8005\u518d\u6b21\u6d88\u8d39\u3002</p> <p>\u8981\u5b9e\u73b0\u4e00\u6761\u6d88\u606f\u53ef\u4ee5\u88ab\u591a\u4e2a\u6d88\u8d39\u8005\u6d88\u8d39\uff0c\u90a3\u4e48\u5c31\u8981\u5c06\u591a\u4e2a\u6d88\u8d39\u8005\u7ec4\u6210\u4e00\u4e2a\u6d88\u8d39\u7ec4\uff0c\u4f7f\u5f97\u591a\u4e2a\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u540c\u4e00\u6761\u6d88\u606f\uff0c\u4f46\u662f List \u7c7b\u578b\u5e76\u4e0d\u652f\u6301\u6d88\u8d39\u7ec4\u7684\u5b9e\u73b0\u3002</p> <p>\u8fd9\u5c31\u8981\u8bf4\u8d77 Redis \u4ece 5.0 \u7248\u672c\u5f00\u59cb\u63d0\u4f9b\u7684 Stream \u6570\u636e\u7c7b\u578b\u4e86\uff0cStream \u540c\u6837\u80fd\u591f\u6ee1\u8db3\u6d88\u606f\u961f\u5217\u7684\u4e09\u5927\u9700\u6c42\uff0c\u800c\u4e14\u5b83\u8fd8\u652f\u6301\u300c\u6d88\u8d39\u7ec4\u300d\u5f62\u5f0f\u7684\u6d88\u606f\u8bfb\u53d6\u3002</p>"},{"location":"redis/data_struct/command/#hash","title":"Hash","text":""},{"location":"redis/data_struct/command/#_13","title":"\u4ecb\u7ecd","text":"<p>Hash \u662f\u4e00\u4e2a\u952e\u503c\u5bf9\uff08key - value\uff09\u96c6\u5408\uff0c\u5176\u4e2d value \u7684\u5f62\u5f0f\u5982\uff1a <code>value=[{field1\uff0cvalue1}\uff0c...{fieldN\uff0cvalueN}]</code>\u3002Hash \u7279\u522b\u9002\u5408\u7528\u4e8e\u5b58\u50a8\u5bf9\u8c61\u3002 </p> <p>Hash \u4e0e String \u5bf9\u8c61\u7684\u533a\u522b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"redis/data_struct/command/#_14","title":"\u5185\u90e8\u5b9e\u73b0","text":"<p>Hash \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531\u538b\u7f29\u5217\u8868\u6216\u54c8\u5e0c\u8868\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u5982\u679c\u54c8\u5e0c\u7c7b\u578b\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e <code>512</code> \u4e2a\uff08\u9ed8\u8ba4\u503c\uff0c\u53ef\u7531 <code>hash-max-ziplist-entries</code> \u914d\u7f6e\uff09\uff0c\u6240\u6709\u503c\u5c0f\u4e8e <code>64</code> \u5b57\u8282\uff08\u9ed8\u8ba4\u503c\uff0c\u53ef\u7531 <code>hash-max-ziplist-value</code> \u914d\u7f6e\uff09\u7684\u8bdd\uff0cRedis \u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u4f5c\u4e3a Hash \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> <li>\u5982\u679c\u54c8\u5e0c\u7c7b\u578b\u5143\u7d20\u4e0d\u6ee1\u8db3\u4e0a\u9762\u6761\u4ef6\uff0cRedis \u4f1a\u4f7f\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a Hash \u7c7b\u578b\u7684 \u5e95\u5c42\u6570\u636e\u7ed3\u6784\u3002</li> </ul> <p>\u5728 Redis 7.0 \u4e2d\uff0c\u538b\u7f29\u5217\u8868\u6570\u636e\u7ed3\u6784\u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u4ea4\u7531 listpack \u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u4e86\u3002</p>"},{"location":"redis/data_struct/command/#_15","title":"\u5e38\u7528\u547d\u4ee4","text":"Bash<pre><code># \u5b58\u50a8\u4e00\u4e2a\u54c8\u5e0c\u8868key\u7684\u952e\u503c\nHSET key field value   \n# \u83b7\u53d6\u54c8\u5e0c\u8868key\u5bf9\u5e94\u7684field\u952e\u503c\nHGET key field\n\n# \u5728\u4e00\u4e2a\u54c8\u5e0c\u8868key\u4e2d\u5b58\u50a8\u591a\u4e2a\u952e\u503c\u5bf9\nHMSET key field value [field value...] \n# \u6279\u91cf\u83b7\u53d6\u54c8\u5e0c\u8868key\u4e2d\u591a\u4e2afield\u952e\u503c\nHMGET key field [field ...]       \n# \u5220\u9664\u54c8\u5e0c\u8868key\u4e2d\u7684field\u952e\u503c\nHDEL key field [field ...]    \n\n# \u8fd4\u56de\u54c8\u5e0c\u8868key\u4e2dfield\u7684\u6570\u91cf\nHLEN key       \n# \u8fd4\u56de\u54c8\u5e0c\u8868key\u4e2d\u6240\u6709\u7684\u952e\u503c\nHGETALL key \n\n# \u4e3a\u54c8\u5e0c\u8868key\u4e2dfield\u952e\u7684\u503c\u52a0\u4e0a\u589e\u91cfn\nHINCRBY key field n                         \n</code></pre>"},{"location":"redis/data_struct/command/#_16","title":"\u5e94\u7528\u573a\u666f","text":""},{"location":"redis/data_struct/command/#_17","title":"\u7f13\u5b58\u5bf9\u8c61","text":"<p>Hash \u7c7b\u578b\u7684\uff08key\uff0cfield\uff0cvalue\uff09\u7684\u7ed3\u6784\u4e0e\u5bf9\u8c61\u7684\uff08\u5bf9\u8c61 id\uff0c\u5c5e\u6027\uff0c\u503c\uff09\u7684\u7ed3\u6784\u76f8\u4f3c\uff0c\u4e5f\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u5bf9\u8c61\u3002</p> <p>\u6211\u4eec\u4ee5\u7528\u6237\u4fe1\u606f\u4e3a\u4f8b\uff0c\u5b83\u5728\u5173\u7cfb\u578b\u6570\u636e\u5e93\u4e2d\u7684\u7ed3\u6784\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\uff0c\u5c06\u7528\u6237\u5bf9\u8c61\u7684\u4fe1\u606f\u5b58\u50a8\u5230 Hash \u7c7b\u578b\uff1a</p> Bash<pre><code># \u5b58\u50a8\u4e00\u4e2a\u54c8\u5e0c\u8868uid:1\u7684\u952e\u503c\n&gt; HMSET uid:1 name Tom age 15\n2\n# \u5b58\u50a8\u4e00\u4e2a\u54c8\u5e0c\u8868uid:2\u7684\u952e\u503c\n&gt; HMSET uid:2 name Jerry age 13\n2\n# \u83b7\u53d6\u54c8\u5e0c\u8868\u7528\u6237id\u4e3a1\u4e2d\u6240\u6709\u7684\u952e\u503c\n&gt; HGETALL uid:1\n1) \"name\"\n2) \"Tom\"\n3) \"age\"\n4) \"15\"\n</code></pre> <p>Redis Hash \u5b58\u50a8\u5176\u7ed3\u6784\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5728\u4ecb\u7ecd String \u7c7b\u578b\u7684\u5e94\u7528\u573a\u666f\u65f6\u6709\u6240\u4ecb\u7ecd\uff0cString + Json \u4e5f\u662f\u5b58\u50a8\u5bf9\u8c61\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u90a3\u4e48\u5b58\u50a8\u5bf9\u8c61\u65f6\uff0c\u5230\u5e95\u7528 String + json \u8fd8\u662f\u7528 Hash \u5462\uff1f</p> <p>\u4e00\u822c\u5bf9\u8c61\u7528 String + Json \u5b58\u50a8\uff0c\u5bf9\u8c61\u4e2d\u67d0\u4e9b\u9891\u7e41\u53d8\u5316\u7684\u5c5e\u6027\u53ef\u4ee5\u8003\u8651\u62bd\u51fa\u6765\u7528 Hash \u7c7b\u578b\u5b58\u50a8\u3002</p>"},{"location":"redis/data_struct/command/#_18","title":"\u8d2d\u7269\u8f66","text":"<p>\u4ee5\u7528\u6237 id \u4e3a key\uff0c\u5546\u54c1 id \u4e3a field\uff0c\u5546\u54c1\u6570\u91cf\u4e3a value\uff0c\u6070\u597d\u6784\u6210\u4e86\u8d2d\u7269\u8f66\u7684 3 \u4e2a\u8981\u7d20\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>\u6d89\u53ca\u7684\u547d\u4ee4\u5982\u4e0b\uff1a</p> <ul> <li>\u6dfb\u52a0\u5546\u54c1\uff1a<code>HSET  cart:{\u7528\u6237id}  {\u5546\u54c1id}  1</code></li> <li>\u6dfb\u52a0\u6570\u91cf\uff1a<code>HINCRBY  cart:{\u7528\u6237id}  {\u5546\u54c1id}  1</code></li> <li>\u5546\u54c1\u603b\u6570\uff1a<code>HLEN  cart:{\u7528\u6237id}</code></li> <li>\u5220\u9664\u5546\u54c1\uff1a<code>HDEL  cart:{\u7528\u6237id}  {\u5546\u54c1id}</code></li> <li>\u83b7\u53d6\u8d2d\u7269\u8f66\u6240\u6709\u5546\u54c1\uff1a<code>HGETALL  cart:{\u7528\u6237id}</code></li> </ul> <p>\u5f53\u524d\u4ec5\u4ec5\u662f\u5c06\u5546\u54c1 ID \u5b58\u50a8\u5230\u4e86 Redis \u4e2d\uff0c\u5728\u56de\u663e\u5546\u54c1\u5177\u4f53\u4fe1\u606f\u7684\u65f6\u5019\uff0c\u8fd8\u9700\u8981\u62ff\u7740\u5546\u54c1 id \u67e5\u8be2\u4e00\u6b21\u6570\u636e\u5e93\uff0c\u83b7\u53d6\u5b8c\u6574\u7684\u5546\u54c1\u7684\u4fe1\u606f\u3002</p>"},{"location":"redis/data_struct/command/#set","title":"Set","text":""},{"location":"redis/data_struct/command/#_19","title":"\u4ecb\u7ecd","text":"<p>Set \u7c7b\u578b\u662f\u4e00\u4e2a\u65e0\u5e8f\u5e76\u552f\u4e00\u7684\u952e\u503c\u96c6\u5408\uff0c\u5b83\u7684\u5b58\u50a8\u987a\u5e8f\u4e0d\u4f1a\u6309\u7167\u63d2\u5165\u7684\u5148\u540e\u987a\u5e8f\u8fdb\u884c\u5b58\u50a8\u3002</p> <p>\u4e00\u4e2a\u96c6\u5408\u6700\u591a\u53ef\u4ee5\u5b58\u50a8 <code>2^32-1</code> \u4e2a\u5143\u7d20\u3002\u6982\u5ff5\u548c\u6570\u5b66\u4e2d\u4e2a\u7684\u96c6\u5408\u57fa\u672c\u7c7b\u4f3c\uff0c\u53ef\u4ee5\u4ea4\u96c6\uff0c\u5e76\u96c6\uff0c\u5dee\u96c6\u7b49\u7b49\uff0c\u6240\u4ee5 Set \u7c7b\u578b\u9664\u4e86\u652f\u6301\u96c6\u5408\u5185\u7684\u589e\u5220\u6539\u67e5\uff0c\u540c\u65f6\u8fd8\u652f\u6301\u591a\u4e2a\u96c6\u5408\u53d6\u4ea4\u96c6\u3001\u5e76\u96c6\u3001\u5dee\u96c6\u3002</p> <p></p> <p>Set \u7c7b\u578b\u548c List \u7c7b\u578b\u7684\u533a\u522b\u5982\u4e0b\uff1a</p> <ul> <li>List \u53ef\u4ee5\u5b58\u50a8\u91cd\u590d\u5143\u7d20\uff0cSet \u53ea\u80fd\u5b58\u50a8\u975e\u91cd\u590d\u5143\u7d20\uff1b</li> <li>List \u662f\u6309\u7167\u5143\u7d20\u7684\u5148\u540e\u987a\u5e8f\u5b58\u50a8\u5143\u7d20\u7684\uff0c\u800c Set \u5219\u662f\u65e0\u5e8f\u65b9\u5f0f\u5b58\u50a8\u5143\u7d20\u7684\u3002</li> </ul>"},{"location":"redis/data_struct/command/#_20","title":"\u5185\u90e8\u5b9e\u73b0","text":"<p>Set \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531\u54c8\u5e0c\u8868\u6216\u6574\u6570\u96c6\u5408\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u5982\u679c\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u90fd\u662f\u6574\u6570\u4e14\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e <code>512</code> \uff08\u9ed8\u8ba4\u503c\uff0c<code>set-maxintset-entries</code>\u914d\u7f6e\uff09\u4e2a\uff0cRedis \u4f1a\u4f7f\u7528\u6574\u6570\u96c6\u5408\u4f5c\u4e3a Set \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> <li>\u5982\u679c\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u4e0d\u6ee1\u8db3\u4e0a\u9762\u6761\u4ef6\uff0c\u5219 Redis \u4f7f\u7528\u54c8\u5e0c\u8868\u4f5c\u4e3a Set \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u3002</li> </ul>"},{"location":"redis/data_struct/command/#_21","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>Set \u5e38\u7528\u64cd\u4f5c\uff1a</p> Bash<pre><code># \u5f80\u96c6\u5408key\u4e2d\u5b58\u5165\u5143\u7d20\uff0c\u5143\u7d20\u5b58\u5728\u5219\u5ffd\u7565\uff0c\u82e5key\u4e0d\u5b58\u5728\u5219\u65b0\u5efa\nSADD key member [member ...]\n# \u4ece\u96c6\u5408key\u4e2d\u5220\u9664\u5143\u7d20\nSREM key member [member ...] \n# \u83b7\u53d6\u96c6\u5408key\u4e2d\u6240\u6709\u5143\u7d20\nSMEMBERS key\n# \u83b7\u53d6\u96c6\u5408key\u4e2d\u7684\u5143\u7d20\u4e2a\u6570\nSCARD key\n\n# \u5224\u65admember\u5143\u7d20\u662f\u5426\u5b58\u5728\u4e8e\u96c6\u5408key\u4e2d\nSISMEMBER key member\n\n# \u4ece\u96c6\u5408key\u4e2d\u968f\u673a\u9009\u51facount\u4e2a\u5143\u7d20\uff0c\u5143\u7d20\u4e0d\u4ecekey\u4e2d\u5220\u9664\nSRANDMEMBER key [count]\n# \u4ece\u96c6\u5408key\u4e2d\u968f\u673a\u9009\u51facount\u4e2a\u5143\u7d20\uff0c\u5143\u7d20\u4ecekey\u4e2d\u5220\u9664\nSPOP key [count]\n</code></pre> <p>Set \u8fd0\u7b97\u64cd\u4f5c\uff1a</p> Bash<pre><code># \u4ea4\u96c6\u8fd0\u7b97\nSINTER key [key ...]\n# \u5c06\u4ea4\u96c6\u7ed3\u679c\u5b58\u5165\u65b0\u96c6\u5408destination\u4e2d\nSINTERSTORE destination key [key ...]\n\n# \u5e76\u96c6\u8fd0\u7b97\nSUNION key [key ...]\n# \u5c06\u5e76\u96c6\u7ed3\u679c\u5b58\u5165\u65b0\u96c6\u5408destination\u4e2d\nSUNIONSTORE destination key [key ...]\n\n# \u5dee\u96c6\u8fd0\u7b97\nSDIFF key [key ...]\n# \u5c06\u5dee\u96c6\u7ed3\u679c\u5b58\u5165\u65b0\u96c6\u5408destination\u4e2d\nSDIFFSTORE destination key [key ...]\n</code></pre>"},{"location":"redis/data_struct/command/#_22","title":"\u5e94\u7528\u573a\u666f","text":"<p>\u96c6\u5408\u7684\u4e3b\u8981\u51e0\u4e2a\u7279\u6027\uff0c\u65e0\u5e8f\u3001\u4e0d\u53ef\u91cd\u590d\u3001\u652f\u6301\u5e76\u4ea4\u5dee\u7b49\u64cd\u4f5c\u3002</p> <p>\u56e0\u6b64 Set \u7c7b\u578b\u6bd4\u8f83\u9002\u5408\u7528\u6765\u6570\u636e\u53bb\u91cd\u548c\u4fdd\u969c\u6570\u636e\u7684\u552f\u4e00\u6027\uff0c\u8fd8\u53ef\u4ee5\u7528\u6765\u7edf\u8ba1\u591a\u4e2a\u96c6\u5408\u7684\u4ea4\u96c6\u3001\u5dee\u96c6\u548c\u5e76\u96c6\u7b49\uff0c\u5f53\u6211\u4eec\u5b58\u50a8\u7684\u6570\u636e\u662f\u65e0\u5e8f\u5e76\u4e14\u9700\u8981\u53bb\u91cd\u7684\u60c5\u51b5\u4e0b\uff0c\u6bd4\u8f83\u9002\u5408\u4f7f\u7528\u96c6\u5408\u7c7b\u578b\u8fdb\u884c\u5b58\u50a8\u3002</p> <p>\u4f46\u662f\u8981\u63d0\u9192\u4f60\u4e00\u4e0b\uff0c\u8fd9\u91cc\u6709\u4e00\u4e2a\u6f5c\u5728\u7684\u98ce\u9669\u3002Set \u7684\u5dee\u96c6\u3001\u5e76\u96c6\u548c\u4ea4\u96c6\u7684\u8ba1\u7b97\u590d\u6742\u5ea6\u8f83\u9ad8\uff0c\u5728\u6570\u636e\u91cf\u8f83\u5927\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u76f4\u63a5\u6267\u884c\u8fd9\u4e9b\u8ba1\u7b97\uff0c\u4f1a\u5bfc\u81f4 Redis \u5b9e\u4f8b\u963b\u585e\u3002</p> <p>\u5728\u4e3b\u4ece\u96c6\u7fa4\u4e2d\uff0c\u4e3a\u4e86\u907f\u514d\u4e3b\u5e93\u56e0\u4e3a Set \u505a\u805a\u5408\u8ba1\u7b97\uff08\u4ea4\u96c6\u3001\u5dee\u96c6\u3001\u5e76\u96c6\uff09\u65f6\u5bfc\u81f4\u4e3b\u5e93\u88ab\u963b\u585e\uff0c\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u4e00\u4e2a\u4ece\u5e93\u5b8c\u6210\u805a\u5408\u7edf\u8ba1\uff0c\u6216\u8005\u628a\u6570\u636e\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\uff0c\u7531\u5ba2\u6237\u7aef\u6765\u5b8c\u6210\u805a\u5408\u7edf\u8ba1\u3002</p>"},{"location":"redis/data_struct/command/#_23","title":"\u70b9\u8d5e","text":"<p>Set \u7c7b\u578b\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u4e2a\u7528\u6237\u53ea\u80fd\u70b9\u4e00\u4e2a\u8d5e\uff0c\u8fd9\u91cc\u4e3e\u4f8b\u5b50\u4e00\u4e2a\u573a\u666f\uff0ckey \u662f\u6587\u7ae0 id\uff0cvalue \u662f\u7528\u6237 id\u3002</p> <p><code>uid:1</code> \u3001<code>uid:2</code>\u3001<code>uid:3</code>   \u4e09\u4e2a\u7528\u6237\u5206\u522b\u5bf9 article:1 \u6587\u7ae0\u70b9\u8d5e\u4e86\u3002</p> Bash<pre><code># uid:1 \u7528\u6237\u5bf9\u6587\u7ae0 article:1 \u70b9\u8d5e\n&gt; SADD article:1 uid:1\n(integer) 1\n# uid:2 \u7528\u6237\u5bf9\u6587\u7ae0 article:1 \u70b9\u8d5e\n&gt; SADD article:1 uid:2\n(integer) 1\n# uid:3 \u7528\u6237\u5bf9\u6587\u7ae0 article:1 \u70b9\u8d5e\n&gt; SADD article:1 uid:3\n(integer) 1\n</code></pre> <p><code>uid:1</code> \u53d6\u6d88\u4e86\u5bf9 article:1 \u6587\u7ae0\u70b9\u8d5e\u3002</p> Text Only<pre><code>&gt; SREM article:1 uid:1\n(integer) 1\n</code></pre> <p>\u83b7\u53d6  article:1 \u6587\u7ae0\u6240\u6709\u70b9\u8d5e\u7528\u6237 :</p> Bash<pre><code>&gt; SMEMBERS article:1\n1) \"uid:3\"\n2) \"uid:2\"\n</code></pre> <p>\u83b7\u53d6 article:1 \u6587\u7ae0\u7684\u70b9\u8d5e\u7528\u6237\u6570\u91cf\uff1a</p> Bash<pre><code>&gt; SCARD article:1\n(integer) 2\n</code></pre> <p>\u5224\u65ad\u7528\u6237 <code>uid:1</code> \u662f\u5426\u5bf9\u6587\u7ae0 article:1 \u70b9\u8d5e\u4e86\uff1a</p> Bash<pre><code>&gt; SISMEMBER article:1 uid:1\n(integer) 0  # \u8fd4\u56de0\u8bf4\u660e\u6ca1\u70b9\u8d5e\uff0c\u8fd4\u56de1\u5219\u8bf4\u660e\u70b9\u8d5e\u4e86\n</code></pre>"},{"location":"redis/data_struct/command/#_24","title":"\u5171\u540c\u5173\u6ce8","text":"<p>Set \u7c7b\u578b\u652f\u6301\u4ea4\u96c6\u8fd0\u7b97\uff0c\u6240\u4ee5\u53ef\u4ee5\u7528\u6765\u8ba1\u7b97\u5171\u540c\u5173\u6ce8\u7684\u597d\u53cb\u3001\u516c\u4f17\u53f7\u7b49\u3002</p> <p>key \u53ef\u4ee5\u662f\u7528\u6237 id\uff0cvalue \u5219\u662f\u5df2\u5173\u6ce8\u7684\u516c\u4f17\u53f7\u7684 id\u3002</p> <p><code>uid:1</code> \u7528\u6237\u5173\u6ce8\u516c\u4f17\u53f7 id \u4e3a 5\u30016\u30017\u30018\u30019\uff0c<code>uid:2</code>  \u7528\u6237\u5173\u6ce8\u516c\u4f17\u53f7 id \u4e3a 7\u30018\u30019\u300110\u300111\u3002</p> Bash<pre><code># uid:1 \u7528\u6237\u5173\u6ce8\u516c\u4f17\u53f7 id \u4e3a 5\u30016\u30017\u30018\u30019\n&gt; SADD uid:1 5 6 7 8 9\n(integer) 5\n# uid:2  \u7528\u6237\u5173\u6ce8\u516c\u4f17\u53f7 id \u4e3a 7\u30018\u30019\u300110\u300111\n&gt; SADD uid:2 7 8 9 10 11\n(integer) 5\n</code></pre> <p><code>uid:1</code>  \u548c <code>uid:2</code>  \u5171\u540c\u5173\u6ce8\u7684\u516c\u4f17\u53f7\uff1a</p> Bash<pre><code># \u83b7\u53d6\u5171\u540c\u5173\u6ce8\n&gt; SINTER uid:1 uid:2\n1) \"7\"\n2) \"8\"\n3) \"9\"\n</code></pre> <p>\u7ed9  <code>uid:2</code>   \u63a8\u8350 <code>uid:1</code> \u5173\u6ce8\u7684\u516c\u4f17\u53f7\uff1a</p> Bash<pre><code>&gt; SDIFF uid:1 uid:2\n1) \"5\"\n2) \"6\"\n</code></pre> <p>\u9a8c\u8bc1\u67d0\u4e2a\u516c\u4f17\u53f7\u662f\u5426\u540c\u65f6\u88ab  <code>uid:1</code>   \u6216  <code>uid:2</code>   \u5173\u6ce8\uff1a</p> Bash<pre><code>&gt; SISMEMBER uid:1 5\n(integer) 1 # \u8fd4\u56de1\uff0c\u8bf4\u660e\u5173\u6ce8\u4e86\n&gt; SISMEMBER uid:2 5\n(integer) 0 # \u8fd4\u56de0\uff0c\u8bf4\u660e\u6ca1\u5173\u6ce8\n</code></pre>"},{"location":"redis/data_struct/command/#_25","title":"\u62bd\u5956\u6d3b\u52a8","text":"<p>\u5b58\u50a8\u67d0\u6d3b\u52a8\u4e2d\u4e2d\u5956\u7684\u7528\u6237\u540d\uff0cSet \u7c7b\u578b\u56e0\u4e3a\u6709\u53bb\u91cd\u529f\u80fd\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u540c\u4e00\u4e2a\u7528\u6237\u4e0d\u4f1a\u4e2d\u5956\u4e24\u6b21\u3002</p> <p>key \u4e3a\u62bd\u5956\u6d3b\u52a8\u540d\uff0cvalue \u4e3a\u5458\u5de5\u540d\u79f0\uff0c\u628a\u6240\u6709\u5458\u5de5\u540d\u79f0\u653e\u5165\u62bd\u5956\u7bb1\uff1a</p> Bash<pre><code>&gt;SADD lucky Tom Jerry John Sean Marry Lindy Sary Mark\n(integer) 5\n</code></pre> <p>\u5982\u679c\u5141\u8bb8\u91cd\u590d\u4e2d\u5956\uff0c\u53ef\u4ee5\u4f7f\u7528 SRANDMEMBER \u547d\u4ee4\u3002</p> Bash<pre><code># \u62bd\u53d6 1 \u4e2a\u4e00\u7b49\u5956\uff1a\n&gt; SRANDMEMBER lucky 1\n1) \"Tom\"\n# \u62bd\u53d6 2 \u4e2a\u4e8c\u7b49\u5956\uff1a\n&gt; SRANDMEMBER lucky 2\n1) \"Mark\"\n2) \"Jerry\"\n# \u62bd\u53d6 3 \u4e2a\u4e09\u7b49\u5956\uff1a\n&gt; SRANDMEMBER lucky 3\n1) \"Sary\"\n2) \"Tom\"\n3) \"Jerry\"\n</code></pre> <p>\u5982\u679c\u4e0d\u5141\u8bb8\u91cd\u590d\u4e2d\u5956\uff0c\u53ef\u4ee5\u4f7f\u7528 SPOP \u547d\u4ee4\u3002</p> Bash<pre><code># \u62bd\u53d6\u4e00\u7b49\u59561\u4e2a\n&gt; SPOP lucky 1\n1) \"Sary\"\n# \u62bd\u53d6\u4e8c\u7b49\u59562\u4e2a\n&gt; SPOP lucky 2\n1) \"Jerry\"\n2) \"Mark\"\n# \u62bd\u53d6\u4e09\u7b49\u59563\u4e2a\n&gt; SPOP lucky 3\n1) \"John\"\n2) \"Sean\"\n3) \"Lindy\"\n</code></pre>"},{"location":"redis/data_struct/command/#zset","title":"Zset","text":""},{"location":"redis/data_struct/command/#_26","title":"\u4ecb\u7ecd","text":"<p>Zset \u7c7b\u578b\uff08\u6709\u5e8f\u96c6\u5408\u7c7b\u578b\uff09\u76f8\u6bd4\u4e8e Set \u7c7b\u578b\u591a\u4e86\u4e00\u4e2a\u6392\u5e8f\u5c5e\u6027 score\uff08\u5206\u503c\uff09\uff0c\u5bf9\u4e8e\u6709\u5e8f\u96c6\u5408 ZSet \u6765\u8bf4\uff0c\u6bcf\u4e2a\u5b58\u50a8\u5143\u7d20\u76f8\u5f53\u4e8e\u6709\u4e24\u4e2a\u503c\u7ec4\u6210\u7684\uff0c\u4e00\u4e2a\u662f\u6709\u5e8f\u7ed3\u5408\u7684\u5143\u7d20\u503c\uff0c\u4e00\u4e2a\u662f\u6392\u5e8f\u503c\u3002</p> <p>\u6709\u5e8f\u96c6\u5408\u4fdd\u7559\u4e86\u96c6\u5408\u4e0d\u80fd\u6709\u91cd\u590d\u6210\u5458\u7684\u7279\u6027\uff08\u5206\u503c\u53ef\u4ee5\u91cd\u590d\uff09\uff0c\u4f46\u4e0d\u540c\u7684\u662f\uff0c\u6709\u5e8f\u96c6\u5408\u4e2d\u7684\u5143\u7d20\u53ef\u4ee5\u6392\u5e8f\u3002</p> <p></p>"},{"location":"redis/data_struct/command/#_27","title":"\u5185\u90e8\u5b9e\u73b0","text":"<p>Zset \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531\u538b\u7f29\u5217\u8868\u6216\u8df3\u8868\u5b9e\u73b0\u7684\uff1a</p> <ul> <li>\u5982\u679c\u6709\u5e8f\u96c6\u5408\u7684\u5143\u7d20\u4e2a\u6570\u5c0f\u4e8e <code>128</code> \u4e2a\uff0c\u5e76\u4e14\u6bcf\u4e2a\u5143\u7d20\u7684\u503c\u5c0f\u4e8e <code>64</code> \u5b57\u8282\u65f6\uff0cRedis \u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u4f5c\u4e3a Zset \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> <li>\u5982\u679c\u6709\u5e8f\u96c6\u5408\u7684\u5143\u7d20\u4e0d\u6ee1\u8db3\u4e0a\u9762\u7684\u6761\u4ef6\uff0cRedis \u4f1a\u4f7f\u7528\u8df3\u8868\u4f5c\u4e3a Zset \u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff1b</li> </ul> <p>\u5728 Redis 7.0 \u4e2d\uff0c\u538b\u7f29\u5217\u8868\u6570\u636e\u7ed3\u6784\u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u4ea4\u7531 listpack \u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u4e86\u3002</p>"},{"location":"redis/data_struct/command/#_28","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>Zset \u5e38\u7528\u64cd\u4f5c\uff1a</p> Bash<pre><code># \u5f80\u6709\u5e8f\u96c6\u5408key\u4e2d\u52a0\u5165\u5e26\u5206\u503c\u5143\u7d20\nZADD key score member [[score member]...]   \n# \u5f80\u6709\u5e8f\u96c6\u5408key\u4e2d\u5220\u9664\u5143\u7d20\nZREM key member [member...]                 \n# \u8fd4\u56de\u6709\u5e8f\u96c6\u5408key\u4e2d\u5143\u7d20member\u7684\u5206\u503c\nZSCORE key member\n# \u8fd4\u56de\u6709\u5e8f\u96c6\u5408key\u4e2d\u5143\u7d20\u4e2a\u6570\nZCARD key \n\n# \u4e3a\u6709\u5e8f\u96c6\u5408key\u4e2d\u5143\u7d20member\u7684\u5206\u503c\u52a0\u4e0aincrement\nZINCRBY key increment member \n\n# \u6b63\u5e8f\u83b7\u53d6\u6709\u5e8f\u96c6\u5408key\u4ecestart\u4e0b\u6807\u5230stop\u4e0b\u6807\u7684\u5143\u7d20\nZRANGE key start stop [WITHSCORES]\n# \u5012\u5e8f\u83b7\u53d6\u6709\u5e8f\u96c6\u5408key\u4ecestart\u4e0b\u6807\u5230stop\u4e0b\u6807\u7684\u5143\u7d20\nZREVRANGE key start stop [WITHSCORES]\n\n# \u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u5206\u6570\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u5206\u6570\u7531\u4f4e\u5230\u9ad8\u6392\u5e8f\u3002\nZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count]\n\n# \u8fd4\u56de\u6307\u5b9a\u6210\u5458\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u6309\u5b57\u5178\u6b63\u5e8f\u6392\u5217, \u5206\u6570\u5fc5\u987b\u76f8\u540c\u3002\nZRANGEBYLEX key min max [LIMIT offset count]\n# \u8fd4\u56de\u6307\u5b9a\u6210\u5458\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u6309\u5b57\u5178\u5012\u5e8f\u6392\u5217, \u5206\u6570\u5fc5\u987b\u76f8\u540c\nZREVRANGEBYLEX key max min [LIMIT offset count]\n</code></pre> <p>Zset \u8fd0\u7b97\u64cd\u4f5c\uff08\u76f8\u6bd4\u4e8e Set \u7c7b\u578b\uff0cZSet \u7c7b\u578b\u6ca1\u6709\u652f\u6301\u5dee\u96c6\u8fd0\u7b97\uff09\uff1a</p> Bash<pre><code># \u5e76\u96c6\u8ba1\u7b97(\u76f8\u540c\u5143\u7d20\u5206\u503c\u76f8\u52a0)\uff0cnumberkeys\u4e00\u5171\u591a\u5c11\u4e2akey\uff0cWEIGHTS\u6bcf\u4e2akey\u5bf9\u5e94\u7684\u5206\u503c\u4e58\u79ef\nZUNIONSTORE destkey numberkeys key [key...] \n# \u4ea4\u96c6\u8ba1\u7b97(\u76f8\u540c\u5143\u7d20\u5206\u503c\u76f8\u52a0)\uff0cnumberkeys\u4e00\u5171\u591a\u5c11\u4e2akey\uff0cWEIGHTS\u6bcf\u4e2akey\u5bf9\u5e94\u7684\u5206\u503c\u4e58\u79ef\nZINTERSTORE destkey numberkeys key [key...]\n</code></pre>"},{"location":"redis/data_struct/command/#_29","title":"\u5e94\u7528\u573a\u666f","text":"<p>Zset \u7c7b\u578b\uff08Sorted Set\uff0c\u6709\u5e8f\u96c6\u5408\uff09\u53ef\u4ee5\u6839\u636e\u5143\u7d20\u7684\u6743\u91cd\u6765\u6392\u5e8f\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u6765\u51b3\u5b9a\u6bcf\u4e2a\u5143\u7d20\u7684\u6743\u91cd\u503c\u3002\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u5143\u7d20\u63d2\u5165 Sorted Set \u7684\u65f6\u95f4\u786e\u5b9a\u6743\u91cd\u503c\uff0c\u5148\u63d2\u5165\u7684\u5143\u7d20\u6743\u91cd\u5c0f\uff0c\u540e\u63d2\u5165\u7684\u5143\u7d20\u6743\u91cd\u5927\u3002</p> <p>\u5728\u9762\u5bf9\u9700\u8981\u5c55\u793a\u6700\u65b0\u5217\u8868\u3001\u6392\u884c\u699c\u7b49\u573a\u666f\u65f6\uff0c\u5982\u679c\u6570\u636e\u66f4\u65b0\u9891\u7e41\u6216\u8005\u9700\u8981\u5206\u9875\u663e\u793a\uff0c\u53ef\u4ee5\u4f18\u5148\u8003\u8651\u4f7f\u7528 Sorted Set\u3002</p>"},{"location":"redis/data_struct/command/#_30","title":"\u6392\u884c\u699c","text":"<p>\u6709\u5e8f\u96c6\u5408\u6bd4\u8f83\u5178\u578b\u7684\u4f7f\u7528\u573a\u666f\u5c31\u662f\u6392\u884c\u699c\u3002\u4f8b\u5982\u5b66\u751f\u6210\u7ee9\u7684\u6392\u540d\u699c\u3001\u6e38\u620f\u79ef\u5206\u6392\u884c\u699c\u3001\u89c6\u9891\u64ad\u653e\u6392\u540d\u3001\u7535\u5546\u7cfb\u7edf\u4e2d\u5546\u54c1\u7684\u9500\u91cf\u6392\u540d\u7b49\u3002</p> <p>\u6211\u4eec\u4ee5\u535a\u6587\u70b9\u8d5e\u6392\u540d\u4e3a\u4f8b\uff0c\u5c0f\u6797\u53d1\u8868\u4e86\u4e94\u7bc7\u535a\u6587\uff0c\u5206\u522b\u83b7\u5f97\u8d5e\u4e3a 200\u300140\u3001100\u300150\u3001150\u3002</p> Bash<pre><code># arcticle:1 \u6587\u7ae0\u83b7\u5f97\u4e86200\u4e2a\u8d5e\n&gt; ZADD user:xiaolin:ranking 200 arcticle:1\n(integer) 1\n# arcticle:2 \u6587\u7ae0\u83b7\u5f97\u4e8640\u4e2a\u8d5e\n&gt; ZADD user:xiaolin:ranking 40 arcticle:2\n(integer) 1\n# arcticle:3 \u6587\u7ae0\u83b7\u5f97\u4e86100\u4e2a\u8d5e\n&gt; ZADD user:xiaolin:ranking 100 arcticle:3\n(integer) 1\n# arcticle:4 \u6587\u7ae0\u83b7\u5f97\u4e8650\u4e2a\u8d5e\n&gt; ZADD user:xiaolin:ranking 50 arcticle:4\n(integer) 1\n# arcticle:5 \u6587\u7ae0\u83b7\u5f97\u4e86150\u4e2a\u8d5e\n&gt; ZADD user:xiaolin:ranking 150 arcticle:5\n(integer) 1\n</code></pre> <p>\u6587\u7ae0 arcticle:4 \u65b0\u589e\u4e00\u4e2a\u8d5e\uff0c\u53ef\u4ee5\u4f7f\u7528 ZINCRBY \u547d\u4ee4\uff08\u4e3a\u6709\u5e8f\u96c6\u5408 key \u4e2d\u5143\u7d20 member \u7684\u5206\u503c\u52a0\u4e0a increment\uff09\uff1a</p> Bash<pre><code>&gt; ZINCRBY user:xiaolin:ranking 1 arcticle:4\n\"51\"\n</code></pre> <p>\u67e5\u770b\u67d0\u7bc7\u6587\u7ae0\u7684\u8d5e\u6570\uff0c\u53ef\u4ee5\u4f7f\u7528 ZSCORE \u547d\u4ee4\uff08\u8fd4\u56de\u6709\u5e8f\u96c6\u5408 key \u4e2d\u5143\u7d20\u4e2a\u6570\uff09\uff1a</p> Bash<pre><code>&gt; ZSCORE user:xiaolin:ranking arcticle:4\n\"50\"\n</code></pre> <p>\u83b7\u53d6\u5c0f\u6797\u6587\u7ae0\u8d5e\u6570\u6700\u591a\u7684 3 \u7bc7\u6587\u7ae0\uff0c\u53ef\u4ee5\u4f7f\u7528 ZREVRANGE \u547d\u4ee4\uff08\u5012\u5e8f\u83b7\u53d6\u6709\u5e8f\u96c6\u5408 key \u4ece start \u4e0b\u6807\u5230 stop \u4e0b\u6807\u7684\u5143\u7d20\uff09\uff1a</p> Bash<pre><code># WITHSCORES \u8868\u793a\u628a score \u4e5f\u663e\u793a\u51fa\u6765\n&gt; ZREVRANGE user:xiaolin:ranking 0 2 WITHSCORES\n1) \"arcticle:1\"\n2) \"200\"\n3) \"arcticle:5\"\n4) \"150\"\n5) \"arcticle:3\"\n6) \"100\"\n</code></pre> <p>\u83b7\u53d6\u5c0f\u6797 100 \u8d5e\u5230 200 \u8d5e\u7684\u6587\u7ae0\uff0c\u53ef\u4ee5\u4f7f\u7528 ZRANGEBYSCORE \u547d\u4ee4\uff08\u8fd4\u56de\u6709\u5e8f\u96c6\u5408\u4e2d\u6307\u5b9a\u5206\u6570\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u5206\u6570\u7531\u4f4e\u5230\u9ad8\u6392\u5e8f\uff09\uff1a</p> Bash<pre><code>&gt; ZRANGEBYSCORE user:xiaolin:ranking 100 200 WITHSCORES\n1) \"arcticle:3\"\n2) \"100\"\n3) \"arcticle:5\"\n4) \"150\"\n5) \"arcticle:1\"\n6) \"200\"\n</code></pre>"},{"location":"redis/data_struct/command/#_31","title":"\u7535\u8bdd\u3001\u59d3\u540d\u6392\u5e8f","text":"<p>\u4f7f\u7528\u6709\u5e8f\u96c6\u5408\u7684 <code>ZRANGEBYLEX</code> \u6216 <code>ZREVRANGEBYLEX</code> \u53ef\u4ee5\u5e2e\u52a9\u6211\u4eec\u5b9e\u73b0\u7535\u8bdd\u53f7\u7801\u6216\u59d3\u540d\u7684\u6392\u5e8f\uff0c\u6211\u4eec\u4ee5 <code>ZRANGEBYLEX</code> \uff08\u8fd4\u56de\u6307\u5b9a\u6210\u5458\u533a\u95f4\u5185\u7684\u6210\u5458\uff0c\u6309 key \u6b63\u5e8f\u6392\u5217\uff0c\u5206\u6570\u5fc5\u987b\u76f8\u540c\uff09\u4e3a\u4f8b\u3002</p> <p>\u6ce8\u610f\uff1a\u4e0d\u8981\u5728\u5206\u6570\u4e0d\u4e00\u81f4\u7684 SortSet \u96c6\u5408\u4e2d\u53bb\u4f7f\u7528 ZRANGEBYLEX \u548c ZREVRANGEBYLEX \u6307\u4ee4\uff0c\u56e0\u4e3a\u83b7\u53d6\u7684\u7ed3\u679c\u4f1a\u4e0d\u51c6\u786e\u3002</p> <p>1\u3001\u7535\u8bdd\u6392\u5e8f</p> <p>\u6211\u4eec\u53ef\u4ee5\u5c06\u7535\u8bdd\u53f7\u7801\u5b58\u50a8\u5230 SortSet \u4e2d\uff0c\u7136\u540e\u6839\u636e\u9700\u8981\u6765\u83b7\u53d6\u53f7\u6bb5\uff1a</p> Bash<pre><code>&gt; ZADD phone 0 13100111100 0 13110114300 0 13132110901 \n(integer) 3\n&gt; ZADD phone 0 13200111100 0 13210414300 0 13252110901 \n(integer) 3\n&gt; ZADD phone 0 13300111100 0 13310414300 0 13352110901 \n(integer) 3\n</code></pre> <p>\u83b7\u53d6\u6240\u6709\u53f7\u7801\uff1a</p> Bash<pre><code>&gt; ZRANGEBYLEX phone - +\n1) \"13100111100\"\n2) \"13110114300\"\n3) \"13132110901\"\n4) \"13200111100\"\n5) \"13210414300\"\n6) \"13252110901\"\n7) \"13300111100\"\n8) \"13310414300\"\n9) \"13352110901\"\n</code></pre> <p>\u83b7\u53d6 132 \u53f7\u6bb5\u7684\u53f7\u7801\uff1a</p> Bash<pre><code>&gt; ZRANGEBYLEX phone [132 (133\n1) \"13200111100\"\n2) \"13210414300\"\n3) \"13252110901\"\n</code></pre> <p>\u83b7\u53d6 132\u3001133 \u53f7\u6bb5\u7684\u53f7\u7801\uff1a</p> Bash<pre><code>&gt; ZRANGEBYLEX phone [132 (134\n1) \"13200111100\"\n2) \"13210414300\"\n3) \"13252110901\"\n4) \"13300111100\"\n5) \"13310414300\"\n6) \"13352110901\"\n</code></pre> <p>2\u3001\u59d3\u540d\u6392\u5e8f</p> Bash<pre><code>&gt; zadd names 0 Toumas 0 Jake 0 Bluetuo 0 Gaodeng 0 Aimini 0 Aidehua \n(integer) 6\n</code></pre> <p>\u83b7\u53d6\u6240\u6709\u4eba\u7684\u540d\u5b57\uff1a</p> Bash<pre><code>&gt; ZRANGEBYLEX names - +\n1) \"Aidehua\"\n2) \"Aimini\"\n3) \"Bluetuo\"\n4) \"Gaodeng\"\n5) \"Jake\"\n6) \"Toumas\"\n</code></pre> <p>\u83b7\u53d6\u540d\u5b57\u4e2d\u5927\u5199\u5b57\u6bcd A \u5f00\u5934\u7684\u6240\u6709\u4eba\uff1a</p> Bash<pre><code>&gt; ZRANGEBYLEX names [A (B\n1) \"Aidehua\"\n2) \"Aimini\"\n</code></pre> <p>\u83b7\u53d6\u540d\u5b57\u4e2d\u5927\u5199\u5b57\u6bcd C \u5230 Z \u7684\u6240\u6709\u4eba\uff1a</p> Bash<pre><code>&gt; ZRANGEBYLEX names [C [Z\n1) \"Gaodeng\"\n2) \"Jake\"\n3) \"Toumas\"\n</code></pre>"},{"location":"redis/data_struct/command/#bitmap","title":"BitMap","text":""},{"location":"redis/data_struct/command/#_32","title":"\u4ecb\u7ecd","text":"<p>Bitmap\uff0c\u5373\u4f4d\u56fe\uff0c\u662f\u4e00\u4e32\u8fde\u7eed\u7684\u4e8c\u8fdb\u5236\u6570\u7ec4\uff080 \u548c 1\uff09\uff0c\u53ef\u4ee5\u901a\u8fc7\u504f\u79fb\u91cf\uff08offset\uff09\u5b9a\u4f4d\u5143\u7d20\u3002BitMap \u901a\u8fc7\u6700\u5c0f\u7684\u5355\u4f4d bit \u6765\u8fdb\u884c<code>0|1</code>\u7684\u8bbe\u7f6e\uff0c\u8868\u793a\u67d0\u4e2a\u5143\u7d20\u7684\u503c\u6216\u8005\u72b6\u6001\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(1)\u3002</p> <p>\u7531\u4e8e bit \u662f\u8ba1\u7b97\u673a\u4e2d\u6700\u5c0f\u7684\u5355\u4f4d\uff0c\u4f7f\u7528\u5b83\u8fdb\u884c\u50a8\u5b58\u5c06\u975e\u5e38\u8282\u7701\u7a7a\u95f4\uff0c\u7279\u522b\u9002\u5408\u4e00\u4e9b\u6570\u636e\u91cf\u5927\u4e14\u4f7f\u7528\u4e8c\u503c\u7edf\u8ba1\u7684\u573a\u666f\u3002</p> <p></p>"},{"location":"redis/data_struct/command/#_33","title":"\u5185\u90e8\u5b9e\u73b0","text":"<p>Bitmap \u672c\u8eab\u662f\u7528 String \u7c7b\u578b\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u7684\u4e00\u79cd\u7edf\u8ba1\u4e8c\u503c\u72b6\u6001\u7684\u6570\u636e\u7c7b\u578b\u3002</p> <p>String \u7c7b\u578b\u662f\u4f1a\u4fdd\u5b58\u4e3a\u4e8c\u8fdb\u5236\u7684\u5b57\u8282\u6570\u7ec4\uff0c\u6240\u4ee5\uff0cRedis \u5c31\u628a\u5b57\u8282\u6570\u7ec4\u7684\u6bcf\u4e2a bit \u4f4d\u5229\u7528\u8d77\u6765\uff0c\u7528\u6765\u8868\u793a\u4e00\u4e2a\u5143\u7d20\u7684\u4e8c\u503c\u72b6\u6001\uff0c\u4f60\u53ef\u4ee5\u628a Bitmap \u770b\u4f5c\u662f\u4e00\u4e2a bit \u6570\u7ec4\u3002</p>"},{"location":"redis/data_struct/command/#_34","title":"\u5e38\u7528\u547d\u4ee4","text":"<p>bitmap \u57fa\u672c\u64cd\u4f5c\uff1a</p> Bash<pre><code># \u8bbe\u7f6e\u503c\uff0c\u5176\u4e2dvalue\u53ea\u80fd\u662f 0 \u548c 1\nSETBIT key offset value\n\n# \u83b7\u53d6\u503c\nGETBIT key offset\n\n# \u83b7\u53d6\u6307\u5b9a\u8303\u56f4\u5185\u503c\u4e3a 1 \u7684\u4e2a\u6570\n# start \u548c end \u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\nBITCOUNT key start end\n</code></pre> <p>bitmap \u8fd0\u7b97\u64cd\u4f5c\uff1a</p> Bash<pre><code># BitMap\u95f4\u7684\u8fd0\u7b97\n# operations \u4f4d\u79fb\u64cd\u4f5c\u7b26\uff0c\u679a\u4e3e\u503c\n  AND \u4e0e\u8fd0\u7b97 &amp;\n  OR \u6216\u8fd0\u7b97 |\n  XOR \u5f02\u6216 ^\n  NOT \u53d6\u53cd ~\n# result \u8ba1\u7b97\u7684\u7ed3\u679c\uff0c\u4f1a\u5b58\u50a8\u5728\u8be5key\u4e2d\n# key1 \u2026 keyn \u53c2\u4e0e\u8fd0\u7b97\u7684key\uff0c\u53ef\u4ee5\u6709\u591a\u4e2a\uff0c\u7a7a\u683c\u5206\u5272\uff0cnot\u8fd0\u7b97\u53ea\u80fd\u4e00\u4e2akey\n# \u5f53 BITOP \u5904\u7406\u4e0d\u540c\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\u65f6\uff0c\u8f83\u77ed\u7684\u90a3\u4e2a\u5b57\u7b26\u4e32\u6240\u7f3a\u5c11\u7684\u90e8\u5206\u4f1a\u88ab\u770b\u4f5c 0\u3002\u8fd4\u56de\u503c\u662f\u4fdd\u5b58\u5230 destkey \u7684\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\uff08\u4ee5\u5b57\u8282byte\u4e3a\u5355\u4f4d\uff09\uff0c\u548c\u8f93\u5165 key \u4e2d\u6700\u957f\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u76f8\u7b49\u3002\nBITOP [operations] [result] [key1] [keyn\u2026]\n\n# \u8fd4\u56de\u6307\u5b9akey\u4e2d\u7b2c\u4e00\u6b21\u51fa\u73b0\u6307\u5b9avalue(0/1)\u7684\u4f4d\u7f6e\nBITPOS [key] [value]\n</code></pre>"},{"location":"redis/data_struct/command/#_35","title":"\u5e94\u7528\u573a\u666f","text":"<p>Bitmap \u7c7b\u578b\u975e\u5e38\u9002\u5408\u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\u7684\u573a\u666f\uff0c\u8fd9\u91cc\u7684\u4e8c\u503c\u72b6\u6001\u5c31\u662f\u6307\u96c6\u5408\u5143\u7d20\u7684\u53d6\u503c\u5c31\u53ea\u6709 0 \u548c 1 \u4e24\u79cd\uff0c\u5728\u8bb0\u5f55\u6d77\u91cf\u6570\u636e\u65f6\uff0cBitmap \u80fd\u591f\u6709\u6548\u5730\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002</p>"},{"location":"redis/data_struct/command/#_36","title":"\u7b7e\u5230\u7edf\u8ba1","text":"<p>\u5728\u7b7e\u5230\u6253\u5361\u7684\u573a\u666f\u4e2d\uff0c\u6211\u4eec\u53ea\u7528\u8bb0\u5f55\u7b7e\u5230\uff081\uff09\u6216\u672a\u7b7e\u5230\uff080\uff09\uff0c\u6240\u4ee5\u5b83\u5c31\u662f\u975e\u5e38\u5178\u578b\u7684\u4e8c\u503c\u72b6\u6001\u3002</p> <p>\u7b7e\u5230\u7edf\u8ba1\u65f6\uff0c\u6bcf\u4e2a\u7528\u6237\u4e00\u5929\u7684\u7b7e\u5230\u7528 1 \u4e2a bit \u4f4d\u5c31\u80fd\u8868\u793a\uff0c\u4e00\u4e2a\u6708\uff08\u5047\u8bbe\u662f 31 \u5929\uff09\u7684\u7b7e\u5230\u60c5\u51b5\u7528 31 \u4e2a bit \u4f4d\u5c31\u53ef\u4ee5\uff0c\u800c\u4e00\u5e74\u7684\u7b7e\u5230\u4e5f\u53ea\u9700\u8981\u7528 365 \u4e2a bit \u4f4d\uff0c\u6839\u672c\u4e0d\u7528\u592a\u590d\u6742\u7684\u96c6\u5408\u7c7b\u578b\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u8981\u7edf\u8ba1 ID 100 \u7684\u7528\u6237\u5728 2022 \u5e74 6 \u6708\u4efd\u7684\u7b7e\u5230\u60c5\u51b5\uff0c\u5c31\u53ef\u4ee5\u6309\u7167\u4e0b\u9762\u7684\u6b65\u9aa4\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u7b2c\u4e00\u6b65\uff0c\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u8bb0\u5f55\u8be5\u7528\u6237 6 \u6708 3 \u53f7\u5df2\u7b7e\u5230\u3002</p> Bash<pre><code>SETBIT uid:sign:100:202206 2 1\n</code></pre> <p>\u7b2c\u4e8c\u6b65\uff0c\u68c0\u67e5\u8be5\u7528\u6237 6 \u6708 3 \u65e5\u662f\u5426\u7b7e\u5230\u3002</p> Bash<pre><code>GETBIT uid:sign:100:202206 2 \n</code></pre> <p>\u7b2c\u4e09\u6b65\uff0c\u7edf\u8ba1\u8be5\u7528\u6237\u5728 6 \u6708\u4efd\u7684\u7b7e\u5230\u6b21\u6570\u3002</p> Bash<pre><code>BITCOUNT uid:sign:100:202206\n</code></pre> <p>\u8fd9\u6837\uff0c\u6211\u4eec\u5c31\u77e5\u9053\u8be5\u7528\u6237\u5728 6 \u6708\u4efd\u7684\u7b7e\u5230\u60c5\u51b5\u4e86\u3002</p> <p>\u5982\u4f55\u7edf\u8ba1\u8fd9\u4e2a\u6708\u9996\u6b21\u6253\u5361\u65f6\u95f4\u5462\uff1f</p> <p>Redis \u63d0\u4f9b\u4e86 <code>BITPOS key bitValue [start] [end]</code>\u6307\u4ee4\uff0c\u8fd4\u56de\u6570\u636e\u8868\u793a Bitmap \u4e2d\u7b2c\u4e00\u4e2a\u503c\u4e3a <code>bitValue</code> \u7684 offset \u4f4d\u7f6e\u3002</p> <p>\u5728\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u547d\u4ee4\u5c06\u68c0\u6d4b\u6574\u4e2a\u4f4d\u56fe\uff0c\u7528\u6237\u53ef\u4ee5\u901a\u8fc7\u53ef\u9009\u7684 <code>start</code> \u53c2\u6570\u548c <code>end</code> \u53c2\u6570\u6307\u5b9a\u8981\u68c0\u6d4b\u7684\u8303\u56f4\u3002\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u6267\u884c\u8fd9\u6761\u547d\u4ee4\u6765\u83b7\u53d6 userID = 100 \u5728 2022 \u5e74 6 \u6708\u4efd\u9996\u6b21\u6253\u5361\u65e5\u671f\uff1a</p> ApacheConf<pre><code>BITPOS uid:sign:100:202206 1\n</code></pre> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a offset \u4ece 0 \u5f00\u59cb\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c06\u8fd4\u56de\u7684 value + 1\u3002</p>"},{"location":"redis/data_struct/command/#_37","title":"\u5224\u65ad\u7528\u6237\u767b\u5f55\u6001","text":"<p>Bitmap \u63d0\u4f9b\u4e86 <code>GETBIT\u3001SETBIT</code> \u64cd\u4f5c\uff0c\u901a\u8fc7\u4e00\u4e2a\u504f\u79fb\u503c offset \u5bf9 bit \u6570\u7ec4\u7684 offset \u4f4d\u7f6e\u7684 bit \u4f4d\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f offset \u4ece 0 \u5f00\u59cb\u3002</p> <p>\u53ea\u9700\u8981\u4e00\u4e2a key = login_status \u8868\u793a\u5b58\u50a8\u7528\u6237\u767b\u5f55\u72b6\u6001\u96c6\u5408\u6570\u636e\uff0c\u5c06\u7528\u6237 ID \u4f5c\u4e3a offset\uff0c\u5728\u7ebf\u5c31\u8bbe\u7f6e\u4e3a 1\uff0c\u4e0b\u7ebf\u8bbe\u7f6e 0\u3002\u901a\u8fc7 <code>GETBIT</code>\u5224\u65ad\u5bf9\u5e94\u7684\u7528\u6237\u662f\u5426\u5728\u7ebf\u300250000 \u4e07 \u7528\u6237\u53ea\u9700\u8981 6 MB \u7684\u7a7a\u95f4\u3002</p> <p>\u5047\u5982\u6211\u4eec\u8981\u5224\u65ad ID = 10086 \u7684\u7528\u6237\u7684\u767b\u5f55\u60c5\u51b5\uff1a</p> <p>\u7b2c\u4e00\u6b65\uff0c\u6267\u884c\u4ee5\u4e0b\u6307\u4ee4\uff0c\u8868\u793a\u7528\u6237\u5df2\u767b\u5f55\u3002</p> Bash<pre><code>SETBIT login_status 10086 1\n</code></pre> <p>\u7b2c\u4e8c\u6b65\uff0c\u68c0\u67e5\u8be5\u7528\u6237\u662f\u5426\u767b\u5f55\uff0c\u8fd4\u56de\u503c 1 \u8868\u793a\u5df2\u767b\u5f55\u3002</p> ApacheConf<pre><code>GETBIT login_status 10086\n</code></pre> <p>\u7b2c\u4e09\u6b65\uff0c\u767b\u51fa\uff0c\u5c06 offset \u5bf9\u5e94\u7684 value \u8bbe\u7f6e\u6210 0\u3002</p> Bash<pre><code>SETBIT login_status 10086 0\n</code></pre>"},{"location":"redis/data_struct/command/#_38","title":"\u8fde\u7eed\u7b7e\u5230\u7528\u6237\u603b\u6570","text":"<p>\u5982\u4f55\u7edf\u8ba1\u51fa\u8fd9\u8fde\u7eed 7 \u5929\u8fde\u7eed\u6253\u5361\u7528\u6237\u603b\u6570\u5462\uff1f</p> <p>\u6211\u4eec\u628a\u6bcf\u5929\u7684\u65e5\u671f\u4f5c\u4e3a Bitmap \u7684 key\uff0cuserId \u4f5c\u4e3a offset\uff0c\u82e5\u662f\u6253\u5361\u5219\u5c06 offset \u4f4d\u7f6e\u7684 bit \u8bbe\u7f6e\u6210 1\u3002</p> <p>key \u5bf9\u5e94\u7684\u96c6\u5408\u7684\u6bcf\u4e2a bit \u4f4d\u7684\u6570\u636e\u5219\u662f\u4e00\u4e2a\u7528\u6237\u5728\u8be5\u65e5\u671f\u7684\u6253\u5361\u8bb0\u5f55\u3002</p> <p>\u4e00\u5171\u6709 7 \u4e2a\u8fd9\u6837\u7684 Bitmap\uff0c\u5982\u679c\u6211\u4eec\u80fd\u5bf9\u8fd9 7 \u4e2a Bitmap \u7684\u5bf9\u5e94\u7684 bit \u4f4d\u505a \u300e\u4e0e\u300f\u8fd0\u7b97\u3002\u540c\u6837\u7684 UserID offset \u90fd\u662f\u4e00\u6837\u7684\uff0c\u5f53\u4e00\u4e2a userID \u5728 7 \u4e2a Bitmap \u5bf9\u5e94\u5bf9\u5e94\u7684 offset \u4f4d\u7f6e\u7684 bit = 1 \u5c31\u8bf4\u660e\u8be5\u7528\u6237 7 \u5929\u8fde\u7eed\u6253\u5361\u3002</p> <p>\u7ed3\u679c\u4fdd\u5b58\u5230\u4e00\u4e2a\u65b0 Bitmap \u4e2d\uff0c\u6211\u4eec\u518d\u901a\u8fc7 <code>BITCOUNT</code> \u7edf\u8ba1 bit = 1 \u7684\u4e2a\u6570\u4fbf\u5f97\u5230\u4e86\u8fde\u7eed\u6253\u5361 7 \u5929\u7684\u7528\u6237\u603b\u6570\u4e86\u3002</p> <p>Redis \u63d0\u4f9b\u4e86 <code>BITOP operation destkey key [key ...]</code>\u8fd9\u4e2a\u6307\u4ee4\u7528\u4e8e\u5bf9\u4e00\u4e2a\u6216\u8005\u591a\u4e2a key \u7684 Bitmap \u8fdb\u884c\u4f4d\u5143\u64cd\u4f5c\u3002</p> <ul> <li><code>operation</code> \u53ef\u4ee5\u662f <code>and</code>\u3001<code>OR</code>\u3001<code>NOT</code>\u3001<code>XOR</code>\u3002\u5f53 BITOP \u5904\u7406\u4e0d\u540c\u957f\u5ea6\u7684\u5b57\u7b26\u4e32\u65f6\uff0c\u8f83\u77ed\u7684\u90a3\u4e2a\u5b57\u7b26\u4e32\u6240\u7f3a\u5c11\u7684\u90e8\u5206\u4f1a\u88ab\u770b\u4f5c <code>0</code> \u3002\u7a7a\u7684 <code>key</code> \u4e5f\u88ab\u770b\u4f5c\u662f\u5305\u542b <code>0</code> \u7684\u5b57\u7b26\u4e32\u5e8f\u5217\u3002</li> </ul> <p>\u5047\u8bbe\u8981\u7edf\u8ba1 3 \u5929\u8fde\u7eed\u6253\u5361\u7684\u7528\u6237\u6570\uff0c\u5219\u662f\u5c06\u4e09\u4e2a bitmap \u8fdb\u884c AND \u64cd\u4f5c\uff0c\u5e76\u5c06\u7ed3\u679c\u4fdd\u5b58\u5230 destmap \u4e2d\uff0c\u63a5\u7740\u5bf9 destmap \u6267\u884c BITCOUNT \u7edf\u8ba1\uff0c\u5982\u4e0b\u547d\u4ee4\uff1a</p> Bash<pre><code># \u4e0e\u64cd\u4f5c\nBITOP AND destmap bitmap:01 bitmap:02 bitmap:03\n# \u7edf\u8ba1 bit \u4f4d =  1 \u7684\u4e2a\u6570\nBITCOUNT destmap\n</code></pre> <p>\u5373\u4f7f\u4e00\u5929\u4ea7\u751f\u4e00\u4e2a\u4ebf\u7684\u6570\u636e\uff0cBitmap \u5360\u7528\u7684\u5185\u5b58\u4e5f\u4e0d\u5927\uff0c\u5927\u7ea6\u5360 12 MB \u7684\u5185\u5b58\uff0810^8/8/1024/1024\uff09\uff0c7 \u5929\u7684 Bitmap \u7684\u5185\u5b58\u5f00\u9500\u7ea6\u4e3a 84 MB\u3002\u540c\u65f6\u6211\u4eec\u6700\u597d\u7ed9 Bitmap \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u8ba9 Redis \u5220\u9664\u8fc7\u671f\u7684\u6253\u5361\u6570\u636e\uff0c\u8282\u7701\u5185\u5b58\u3002</p>"},{"location":"redis/data_struct/command/#hyperloglog","title":"HyperLogLog","text":""},{"location":"redis/data_struct/command/#_39","title":"\u4ecb\u7ecd","text":"<p>Redis HyperLogLog \u662f Redis 2.8.9 \u7248\u672c\u65b0\u589e\u7684\u6570\u636e\u7c7b\u578b\uff0c\u662f\u4e00\u79cd\u7528\u4e8e\u300c\u7edf\u8ba1\u57fa\u6570\u300d\u7684\u6570\u636e\u96c6\u5408\u7c7b\u578b\uff0c\u57fa\u6570\u7edf\u8ba1\u5c31\u662f\u6307\u7edf\u8ba1\u4e00\u4e2a\u96c6\u5408\u4e2d\u4e0d\u91cd\u590d\u7684\u5143\u7d20\u4e2a\u6570\u3002\u4f46\u8981\u6ce8\u610f\uff0cHyperLogLog \u7edf\u8ba1\u89c4\u5219\u662f\u57fa\u4e8e\u6982\u7387\u5b8c\u6210\u7684\uff0c\u4e0d\u662f\u975e\u5e38\u51c6\u786e\uff0c\u6807\u51c6\u8bef\u7b97\u7387\u662f 0.81%\u3002</p> <p>\u6240\u4ee5\uff0c\u7b80\u5355\u6765\u8bf4 HyperLogLog \u63d0\u4f9b\u4e0d\u7cbe\u786e\u7684\u53bb\u91cd\u8ba1\u6570\u3002</p> <p>HyperLogLog \u7684\u4f18\u70b9\u662f\uff0c\u5728\u8f93\u5165\u5143\u7d20\u7684\u6570\u91cf\u6216\u8005\u4f53\u79ef\u975e\u5e38\u975e\u5e38\u5927\u65f6\uff0c\u8ba1\u7b97\u57fa\u6570\u6240\u9700\u7684\u5185\u5b58\u7a7a\u95f4\u603b\u662f\u56fa\u5b9a\u7684\u3001\u5e76\u4e14\u662f\u5f88\u5c0f\u7684\u3002</p> <p>\u5728 Redis \u91cc\u9762\uff0c\u6bcf\u4e2a HyperLogLog \u952e\u53ea\u9700\u8981\u82b1\u8d39 12 KB \u5185\u5b58\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u63a5\u8fd1 <code>2^64</code> \u4e2a\u4e0d\u540c\u5143\u7d20\u7684\u57fa\u6570\uff0c\u548c\u5143\u7d20\u8d8a\u591a\u5c31\u8d8a\u8017\u8d39\u5185\u5b58\u7684 Set \u548c Hash \u7c7b\u578b\u76f8\u6bd4\uff0cHyperLogLog \u5c31\u975e\u5e38\u8282\u7701\u7a7a\u95f4\u3002</p> <p>\u8fd9\u4ec0\u4e48\u6982\u5ff5\uff1f\u4e3e\u4e2a\u4f8b\u5b50\u7ed9\u5927\u5bb6\u5bf9\u6bd4\u4e00\u4e0b\u3002</p> <p>\u7528 Java \u8bed\u8a00\u6765\u8bf4\uff0c\u4e00\u822c long \u7c7b\u578b\u5360\u7528 8 \u5b57\u8282\uff0c\u800c 1 \u5b57\u8282\u6709 8 \u4f4d\uff0c\u5373\uff1a1 byte = 8 bit\uff0c\u5373 long \u6570\u636e\u7c7b\u578b\u6700\u5927\u53ef\u4ee5\u8868\u793a\u7684\u6570\u662f\uff1a<code>2^63-1</code>\u3002\u5bf9\u5e94\u4e0a\u9762\u7684<code>2^64</code>\u4e2a\u6570\uff0c\u5047\u8bbe\u6b64\u65f6\u6709<code>2^63-1</code>\u8fd9\u4e48\u591a\u4e2a\u6570\uff0c\u4ece <code>0 ~ 2^63-1</code>\uff0c\u6309\u7167<code>long</code>\u4ee5\u53ca<code>1k = 1024 \u5b57\u8282</code>\u7684\u89c4\u5219\u6765\u8ba1\u7b97\u5185\u5b58\u603b\u6570\uff0c\u5c31\u662f\uff1a<code>((2^63-1) * 8/1024)K</code>\uff0c\u8fd9\u662f\u5f88\u5e9e\u5927\u7684\u4e00\u4e2a\u6570\uff0c\u5b58\u50a8\u7a7a\u95f4\u8fdc\u8fdc\u8d85\u8fc7<code>12K</code>\uff0c\u800c <code>HyperLogLog</code> \u5374\u53ef\u4ee5\u7528 <code>12K</code> \u5c31\u80fd\u7edf\u8ba1\u5b8c\u3002</p>"},{"location":"redis/data_struct/command/#_40","title":"\u5185\u90e8\u5b9e\u73b0","text":"<p>HyperLogLog \u7684\u5b9e\u73b0\u6d89\u53ca\u5230\u5f88\u591a\u6570\u5b66\u95ee\u9898\uff0c\u592a\u8d39\u8111\u5b50\u4e86\uff0c\u6211\u4e5f\u6ca1\u6709\u641e\u61c2\uff0c\u5982\u679c\u4f60\u60f3\u4e86\u89e3\u4e00\u4e0b\uff0c\u8bfe\u4e0b\u53ef\u4ee5\u770b\u770b\u8fd9\u4e2a\uff1aHyperLogLog\u3002</p>"},{"location":"redis/data_struct/command/#_41","title":"\u5e38\u89c1\u547d\u4ee4","text":"<p>HyperLogLog \u547d\u4ee4\u5f88\u5c11\uff0c\u5c31\u4e09\u4e2a\u3002</p> Bash<pre><code># \u6dfb\u52a0\u6307\u5b9a\u5143\u7d20\u5230 HyperLogLog \u4e2d\nPFADD key element [element ...]\n\n# \u8fd4\u56de\u7ed9\u5b9a HyperLogLog \u7684\u57fa\u6570\u4f30\u7b97\u503c\u3002\nPFCOUNT key [key ...]\n\n# \u5c06\u591a\u4e2a HyperLogLog \u5408\u5e76\u4e3a\u4e00\u4e2a HyperLogLog\nPFMERGE destkey sourcekey [sourcekey ...]\n</code></pre>"},{"location":"redis/data_struct/command/#_42","title":"\u5e94\u7528\u573a\u666f","text":""},{"location":"redis/data_struct/command/#ua-user-agent","title":"\u767e\u4e07\u7ea7\u7f51\u9875 UA (User Agent) \u8ba1\u6570","text":"<p>Redis HyperLogLog  \u4f18\u52bf\u5728\u4e8e\u53ea\u9700\u8981\u82b1\u8d39 12 KB \u5185\u5b58\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u63a5\u8fd1 2^64 \u4e2a\u5143\u7d20\u7684\u57fa\u6570\uff0c\u548c\u5143\u7d20\u8d8a\u591a\u5c31\u8d8a\u8017\u8d39\u5185\u5b58\u7684 Set \u548c Hash \u7c7b\u578b\u76f8\u6bd4\uff0cHyperLogLog \u5c31\u975e\u5e38\u8282\u7701\u7a7a\u95f4\u3002</p> <p>\u6240\u4ee5\uff0c\u975e\u5e38\u9002\u5408\u7edf\u8ba1\u767e\u4e07\u7ea7\u4ee5\u4e0a\u7684\u7f51\u9875 UA \u7684\u573a\u666f\u3002</p> <p>\u5728\u7edf\u8ba1 UA \u65f6\uff0c\u4f60\u53ef\u4ee5\u7528 PFADD \u547d\u4ee4\uff08\u7528\u4e8e\u5411 HyperLogLog \u4e2d\u6dfb\u52a0\u65b0\u5143\u7d20\uff09\u628a\u8bbf\u95ee\u9875\u9762\u7684\u6bcf\u4e2a\u7528\u6237\u90fd\u6dfb\u52a0\u5230 HyperLogLog \u4e2d\u3002</p> Bash<pre><code>PFADD page1:ua user1 user2 user3 user4 user5\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u53ef\u4ee5\u7528 PFCOUNT \u547d\u4ee4\u76f4\u63a5\u83b7\u5f97 page1 \u7684 UA \u503c\u4e86\uff0c\u8fd9\u4e2a\u547d\u4ee4\u7684\u4f5c\u7528\u5c31\u662f\u8fd4\u56de HyperLogLog \u7684\u7edf\u8ba1\u7ed3\u679c\u3002</p> Bash<pre><code>PFCOUNT page1:ua\n</code></pre> <p>\u4e0d\u8fc7\uff0c\u6709\u4e00\u70b9\u9700\u8981\u4f60\u6ce8\u610f\u4e00\u4e0b\uff0cHyperLogLog \u7684\u7edf\u8ba1\u89c4\u5219\u662f\u57fa\u4e8e\u6982\u7387\u5b8c\u6210\u7684\uff0c\u6240\u4ee5\u5b83\u7ed9\u51fa\u7684\u7edf\u8ba1\u7ed3\u679c\u662f\u6709\u4e00\u5b9a\u8bef\u5dee\u7684\uff0c\u6807\u51c6\u8bef\u7b97\u7387\u662f 0.81%\u3002</p> <p>\u8fd9\u4e5f\u5c31\u610f\u5473\u7740\uff0c\u4f60\u4f7f\u7528 HyperLogLog \u7edf\u8ba1\u7684 UA \u662f 100 \u4e07\uff0c\u4f46\u5b9e\u9645\u7684 UA \u53ef\u80fd\u662f 101 \u4e07\u3002\u867d\u7136\u8bef\u5dee\u7387\u4e0d\u7b97\u5927\uff0c\u4f46\u662f\uff0c\u5982\u679c\u4f60\u9700\u8981\u7cbe\u786e\u7edf\u8ba1\u7ed3\u679c\u7684\u8bdd\uff0c\u6700\u597d\u8fd8\u662f\u7ee7\u7eed\u7528 Set \u6216 Hash \u7c7b\u578b\u3002</p>"},{"location":"redis/data_struct/command/#geo","title":"GEO","text":"<p>Redis GEO \u662f Redis 3.2 \u7248\u672c\u65b0\u589e\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4e3b\u8981\u7528\u4e8e\u5b58\u50a8\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\uff0c\u5e76\u5bf9\u5b58\u50a8\u7684\u4fe1\u606f\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u5728\u65e5\u5e38\u751f\u6d3b\u4e2d\uff0c\u6211\u4eec\u8d8a\u6765\u8d8a\u4f9d\u8d56\u641c\u7d22\u201c\u9644\u8fd1\u7684\u9910\u9986\u201d\u3001\u5728\u6253\u8f66\u8f6f\u4ef6\u4e0a\u53eb\u8f66\uff0c\u8fd9\u4e9b\u90fd\u79bb\u4e0d\u5f00\u57fa\u4e8e\u4f4d\u7f6e\u4fe1\u606f\u670d\u52a1\uff08Location-Based Service\uff0cLBS\uff09\u7684\u5e94\u7528\u3002LBS \u5e94\u7528\u8bbf\u95ee\u7684\u6570\u636e\u662f\u548c\u4eba\u6216\u7269\u5173\u8054\u7684\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff0c\u800c\u4e14\u8981\u80fd\u67e5\u8be2\u76f8\u90bb\u7684\u7ecf\u7eac\u5ea6\u8303\u56f4\uff0cGEO \u5c31\u975e\u5e38\u9002\u5408\u5e94\u7528\u5728 LBS \u670d\u52a1\u7684\u573a\u666f\u4e2d\u3002</p>"},{"location":"redis/data_struct/command/#_43","title":"\u5185\u90e8\u5b9e\u73b0","text":"<p>GEO \u672c\u8eab\u5e76\u6ca1\u6709\u8bbe\u8ba1\u65b0\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u800c\u662f\u76f4\u63a5\u4f7f\u7528\u4e86 Sorted Set \u96c6\u5408\u7c7b\u578b\u3002</p> <p>GEO \u7c7b\u578b\u4f7f\u7528 GeoHash \u7f16\u7801\u65b9\u6cd5\u5b9e\u73b0\u4e86\u7ecf\u7eac\u5ea6\u5230 Sorted Set \u4e2d\u5143\u7d20\u6743\u91cd\u5206\u6570\u7684\u8f6c\u6362\uff0c\u8fd9\u5176\u4e2d\u7684\u4e24\u4e2a\u5173\u952e\u673a\u5236\u5c31\u662f\u300c\u5bf9\u4e8c\u7ef4\u5730\u56fe\u505a\u533a\u95f4\u5212\u5206\u300d\u548c\u300c\u5bf9\u533a\u95f4\u8fdb\u884c\u7f16\u7801\u300d\u3002\u4e00\u7ec4\u7ecf\u7eac\u5ea6\u843d\u5728\u67d0\u4e2a\u533a\u95f4\u540e\uff0c\u5c31\u7528\u533a\u95f4\u7684\u7f16\u7801\u503c\u6765\u8868\u793a\uff0c\u5e76\u628a\u7f16\u7801\u503c\u4f5c\u4e3a Sorted Set \u5143\u7d20\u7684\u6743\u91cd\u5206\u6570\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u628a\u7ecf\u7eac\u5ea6\u4fdd\u5b58\u5230 Sorted Set \u4e2d\uff0c\u5229\u7528 Sorted Set \u63d0\u4f9b\u7684\u201c\u6309\u6743\u91cd\u8fdb\u884c\u6709\u5e8f\u8303\u56f4\u67e5\u627e\u201d\u7684\u7279\u6027\uff0c\u5b9e\u73b0 LBS \u670d\u52a1\u4e2d\u9891\u7e41\u4f7f\u7528\u7684\u201c\u641c\u7d22\u9644\u8fd1\u201d\u7684\u9700\u6c42\u3002</p>"},{"location":"redis/data_struct/command/#_44","title":"\u5e38\u7528\u547d\u4ee4","text":"Bash<pre><code># \u5b58\u50a8\u6307\u5b9a\u7684\u5730\u7406\u7a7a\u95f4\u4f4d\u7f6e\uff0c\u53ef\u4ee5\u5c06\u4e00\u4e2a\u6216\u591a\u4e2a\u7ecf\u5ea6(longitude)\u3001\u7eac\u5ea6(latitude)\u3001\u4f4d\u7f6e\u540d\u79f0(member)\u6dfb\u52a0\u5230\u6307\u5b9a\u7684 key \u4e2d\u3002\nGEOADD key longitude latitude member [longitude latitude member ...]\n\n# \u4ece\u7ed9\u5b9a\u7684 key \u91cc\u8fd4\u56de\u6240\u6709\u6307\u5b9a\u540d\u79f0(member)\u7684\u4f4d\u7f6e\uff08\u7ecf\u5ea6\u548c\u7eac\u5ea6\uff09\uff0c\u4e0d\u5b58\u5728\u7684\u8fd4\u56de nil\u3002\nGEOPOS key member [member ...]\n\n# \u8fd4\u56de\u4e24\u4e2a\u7ed9\u5b9a\u4f4d\u7f6e\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002\nGEODIST key member1 member2 [m|km|ft|mi]\n\n# \u6839\u636e\u7528\u6237\u7ed9\u5b9a\u7684\u7ecf\u7eac\u5ea6\u5750\u6807\u6765\u83b7\u53d6\u6307\u5b9a\u8303\u56f4\u5185\u7684\u5730\u7406\u4f4d\u7f6e\u96c6\u5408\u3002\nGEORADIUS key longitude latitude radius m|km|ft|mi [WITHCOORD] [WITHDIST] [WITHHASH] [COUNT count] [ASC|DESC] [STORE key] [STOREDIST key]\n</code></pre>"},{"location":"redis/data_struct/command/#_45","title":"\u5e94\u7528\u573a\u666f","text":""},{"location":"redis/data_struct/command/#_46","title":"\u6ef4\u6ef4\u53eb\u8f66","text":"<p>\u8fd9\u91cc\u4ee5\u6ef4\u6ef4\u53eb\u8f66\u7684\u573a\u666f\u4e3a\u4f8b\uff0c\u4ecb\u7ecd\u4e0b\u5177\u4f53\u5982\u4f55\u4f7f\u7528 GEO \u547d\u4ee4\uff1aGEOADD \u548c GEORADIUS \u8fd9\u4e24\u4e2a\u547d\u4ee4\u3002</p> <p>\u5047\u8bbe\u8f66\u8f86 ID \u662f 33\uff0c\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\u662f\uff08116.034579\uff0c39.030452\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u4e00\u4e2a GEO \u96c6\u5408\u4fdd\u5b58\u6240\u6709\u8f66\u8f86\u7684\u7ecf\u7eac\u5ea6\uff0c\u96c6\u5408 key \u662f cars:locations\u3002</p> <p>\u6267\u884c\u4e0b\u9762\u7684\u8fd9\u4e2a\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u628a ID \u53f7\u4e3a 33 \u7684\u8f66\u8f86\u7684\u5f53\u524d\u7ecf\u7eac\u5ea6\u4f4d\u7f6e\u5b58\u5165 GEO \u96c6\u5408\u4e2d\uff1a</p> Bash<pre><code>GEOADD cars:locations 116.034579 39.030452 33\n</code></pre> <p>\u5f53\u7528\u6237\u60f3\u8981\u5bfb\u627e\u81ea\u5df1\u9644\u8fd1\u7684\u7f51\u7ea6\u8f66\u65f6\uff0cLBS \u5e94\u7528\u5c31\u53ef\u4ee5\u4f7f\u7528 GEORADIUS \u547d\u4ee4\u3002</p> <p>\u4f8b\u5982\uff0cLBS \u5e94\u7528\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u65f6\uff0cRedis \u4f1a\u6839\u636e\u8f93\u5165\u7684\u7528\u6237\u7684\u7ecf\u7eac\u5ea6\u4fe1\u606f\uff08116.054579\uff0c39.030452\uff09\uff0c\u67e5\u627e\u4ee5\u8fd9\u4e2a\u7ecf\u7eac\u5ea6\u4e3a\u4e2d\u5fc3\u7684 5 \u516c\u91cc\u5185\u7684\u8f66\u8f86\u4fe1\u606f\uff0c\u5e76\u8fd4\u56de\u7ed9 LBS \u5e94\u7528\u3002</p> Bash<pre><code>GEORADIUS cars:locations 116.054579 39.030452 5 km ASC COUNT 10\n</code></pre>"},{"location":"redis/data_struct/command/#stream","title":"Stream","text":""},{"location":"redis/data_struct/command/#_47","title":"\u4ecb\u7ecd","text":"<p>Redis Stream \u662f Redis 5.0 \u7248\u672c\u65b0\u589e\u52a0\u7684\u6570\u636e\u7c7b\u578b\uff0cRedis \u4e13\u95e8\u4e3a\u6d88\u606f\u961f\u5217\u8bbe\u8ba1\u7684\u6570\u636e\u7c7b\u578b\u3002</p> <p>\u5728 Redis 5.0 Stream \u6ca1\u51fa\u6765\u4e4b\u524d\uff0c\u6d88\u606f\u961f\u5217\u7684\u5b9e\u73b0\u65b9\u5f0f\u90fd\u6709\u7740\u5404\u81ea\u7684\u7f3a\u9677\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\uff0c\u4e0d\u80fd\u6301\u4e45\u5316\u4e5f\u5c31\u65e0\u6cd5\u53ef\u9760\u7684\u4fdd\u5b58\u6d88\u606f\uff0c\u5e76\u4e14\u5bf9\u4e8e\u79bb\u7ebf\u91cd\u8fde\u7684\u5ba2\u6237\u7aef\u4e0d\u80fd\u8bfb\u53d6\u5386\u53f2\u6d88\u606f\u7684\u7f3a\u9677\uff1b</li> <li>List \u5b9e\u73b0\u6d88\u606f\u961f\u5217\u7684\u65b9\u5f0f\u4e0d\u80fd\u91cd\u590d\u6d88\u8d39\uff0c\u4e00\u4e2a\u6d88\u606f\u6d88\u8d39\u5b8c\u5c31\u4f1a\u88ab\u5220\u9664\uff0c\u800c\u4e14\u751f\u4ea7\u8005\u9700\u8981\u81ea\u884c\u5b9e\u73b0\u5168\u5c40\u552f\u4e00 ID\u3002</li> </ul> <p>\u57fa\u4e8e\u4ee5\u4e0a\u95ee\u9898\uff0cRedis 5.0 \u4fbf\u63a8\u51fa\u4e86 Stream \u7c7b\u578b\u4e5f\u662f\u6b64\u7248\u672c\u6700\u91cd\u8981\u7684\u529f\u80fd\uff0c\u7528\u4e8e\u5b8c\u7f8e\u5730\u5b9e\u73b0\u6d88\u606f\u961f\u5217\uff0c\u5b83\u652f\u6301\u6d88\u606f\u7684\u6301\u4e45\u5316\u3001\u652f\u6301\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00 ID\u3001\u652f\u6301 ack \u786e\u8ba4\u6d88\u606f\u7684\u6a21\u5f0f\u3001\u652f\u6301\u6d88\u8d39\u7ec4\u6a21\u5f0f\u7b49\uff0c\u8ba9\u6d88\u606f\u961f\u5217\u66f4\u52a0\u7684\u7a33\u5b9a\u548c\u53ef\u9760\u3002</p>"},{"location":"redis/data_struct/command/#_48","title":"\u5e38\u89c1\u547d\u4ee4","text":"<p>Stream \u6d88\u606f\u961f\u5217\u64cd\u4f5c\u547d\u4ee4\uff1a</p> <ul> <li>XADD\uff1a\u63d2\u5165\u6d88\u606f\uff0c\u4fdd\u8bc1\u6709\u5e8f\uff0c\u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00 ID\uff1b</li> <li>XLEN\uff1a\u67e5\u8be2\u6d88\u606f\u957f\u5ea6\uff1b</li> <li>XREAD\uff1a\u7528\u4e8e\u8bfb\u53d6\u6d88\u606f\uff0c\u53ef\u4ee5\u6309 ID \u8bfb\u53d6\u6570\u636e\uff1b</li> <li>XDEL\uff1a\u6839\u636e\u6d88\u606f ID \u5220\u9664\u6d88\u606f\uff1b</li> <li>DEL\uff1a\u5220\u9664\u6574\u4e2a Stream\uff1b</li> <li>XRANGE\uff1a\u8bfb\u53d6\u533a\u95f4\u6d88\u606f</li> <li>XREADGROUP\uff1a\u6309\u6d88\u8d39\u7ec4\u5f62\u5f0f\u8bfb\u53d6\u6d88\u606f\uff1b</li> <li>XPENDING \u548c XACK\uff1a</li> <li>XPENDING \u547d\u4ee4\u53ef\u4ee5\u7528\u6765\u67e5\u8be2\u6bcf\u4e2a\u6d88\u8d39\u7ec4\u5185\u6240\u6709\u6d88\u8d39\u8005\u300c\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u300d\u7684\u6d88\u606f\uff1b</li> <li>XACK \u547d\u4ee4\u7528\u4e8e\u5411\u6d88\u606f\u961f\u5217\u786e\u8ba4\u6d88\u606f\u5904\u7406\u5df2\u5b8c\u6210\uff1b</li> </ul>"},{"location":"redis/data_struct/command/#_49","title":"\u5e94\u7528\u573a\u666f","text":""},{"location":"redis/data_struct/command/#_50","title":"\u6d88\u606f\u961f\u5217","text":"<p>\u751f\u4ea7\u8005\u901a\u8fc7 XADD \u547d\u4ee4\u63d2\u5165\u4e00\u6761\u6d88\u606f\uff1a</p> Bash<pre><code># * \u8868\u793a\u8ba9 Redis \u4e3a\u63d2\u5165\u7684\u6570\u636e\u81ea\u52a8\u751f\u6210\u4e00\u4e2a\u5168\u5c40\u552f\u4e00\u7684 ID\n# \u5f80\u540d\u79f0\u4e3a mymq \u7684\u6d88\u606f\u961f\u5217\u4e2d\u63d2\u5165\u4e00\u6761\u6d88\u606f\uff0c\u6d88\u606f\u7684\u952e\u662f name\uff0c\u503c\u662f xiaolin\n&gt; XADD mymq * name xiaolin\n\"1654254953808-0\"\n</code></pre> <p>\u63d2\u5165\u6210\u529f\u540e\u4f1a\u8fd4\u56de\u5168\u5c40\u552f\u4e00\u7684 ID\uff1a\"1654254953808-0\"\u3002\u6d88\u606f\u7684\u5168\u5c40\u552f\u4e00 ID \u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff1a</p> <ul> <li>\u7b2c\u4e00\u90e8\u5206\u201c1654254953808\u201d\u662f\u6570\u636e\u63d2\u5165\u65f6\uff0c\u4ee5\u6beb\u79d2\u4e3a\u5355\u4f4d\u8ba1\u7b97\u7684\u5f53\u524d\u670d\u52a1\u5668\u65f6\u95f4\uff1b</li> <li>\u7b2c\u4e8c\u90e8\u5206\u8868\u793a\u63d2\u5165\u6d88\u606f\u5728\u5f53\u524d\u6beb\u79d2\u5185\u7684\u6d88\u606f\u5e8f\u53f7\uff0c\u8fd9\u662f\u4ece 0 \u5f00\u59cb\u7f16\u53f7\u7684\u3002\u4f8b\u5982\uff0c\u201c1654254953808-0\u201d\u5c31\u8868\u793a\u5728\u201c1654254953808\u201d\u6beb\u79d2\u5185\u7684\u7b2c 1 \u6761\u6d88\u606f\u3002</li> </ul> <p>\u6d88\u8d39\u8005\u901a\u8fc7 XREAD \u547d\u4ee4\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u8bfb\u53d6\u6d88\u606f\u65f6\uff0c\u53ef\u4ee5\u6307\u5b9a\u4e00\u4e2a\u6d88\u606f ID\uff0c\u5e76\u4ece\u8fd9\u4e2a\u6d88\u606f ID \u7684\u4e0b\u4e00\u6761\u6d88\u606f\u5f00\u59cb\u8fdb\u884c\u8bfb\u53d6\uff08\u6ce8\u610f\u662f\u8f93\u5165\u6d88\u606f ID \u7684\u4e0b\u4e00\u6761\u4fe1\u606f\u5f00\u59cb\u8bfb\u53d6\uff0c\u4e0d\u662f\u67e5\u8be2\u8f93\u5165 ID \u7684\u6d88\u606f\uff09\u3002</p> Bash<pre><code># \u4ece ID \u53f7\u4e3a 1654254953807-0 \u7684\u6d88\u606f\u5f00\u59cb\uff0c\u8bfb\u53d6\u540e\u7eed\u7684\u6240\u6709\u6d88\u606f\uff08\u793a\u4f8b\u4e2d\u4e00\u5171 1 \u6761\uff09\u3002\n&gt; XREAD STREAMS mymq 1654254953807-0\n1) 1) \"mymq\"\n   2) 1) 1) \"1654254953808-0\"\n         2) 1) \"name\"\n            2) \"xiaolin\"\n</code></pre> <p>\u5982\u679c\u60f3\u8981\u5b9e\u73b0\u963b\u585e\u8bfb\uff08\u5f53\u6ca1\u6709\u6570\u636e\u65f6\uff0c\u963b\u585e\u4f4f\uff09\uff0c\u53ef\u4ee5\u8c03\u7528 XRAED \u65f6\u8bbe\u5b9a BLOCK \u914d\u7f6e\u9879\uff0c\u5b9e\u73b0\u7c7b\u4f3c\u4e8e BRPOP \u7684\u963b\u585e\u8bfb\u53d6\u64cd\u4f5c\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u547d\u4ee4\uff0c\u8bbe\u7f6e\u4e86 BLOCK 10000 \u7684\u914d\u7f6e\u9879\uff0c10000 \u7684\u5355\u4f4d\u662f\u6beb\u79d2\uff0c\u8868\u660e XREAD \u5728\u8bfb\u53d6\u6700\u65b0\u6d88\u606f\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u6d88\u606f\u5230\u6765\uff0cXREAD \u5c06\u963b\u585e 10000 \u6beb\u79d2\uff08\u5373 10 \u79d2\uff09\uff0c\u7136\u540e\u518d\u8fd4\u56de\u3002</p> Bash<pre><code># \u547d\u4ee4\u6700\u540e\u7684\u201c$\u201d\u7b26\u53f7\u8868\u793a\u8bfb\u53d6\u6700\u65b0\u7684\u6d88\u606f\n&gt; XREAD BLOCK 10000 STREAMS mymq $\n(nil)\n(10.00s)\n</code></pre> <p>Stream \u7684\u57fa\u7840\u65b9\u6cd5\uff0c\u4f7f\u7528 xadd \u5b58\u5165\u6d88\u606f\u548c xread \u5faa\u73af\u963b\u585e\u8bfb\u53d6\u6d88\u606f\u7684\u65b9\u5f0f\u53ef\u4ee5\u5b9e\u73b0\u7b80\u6613\u7248\u7684\u6d88\u606f\u961f\u5217\uff0c\u4ea4\u4e92\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u524d\u9762\u4ecb\u7ecd\u7684\u8fd9\u4e9b\u64cd\u4f5c List \u4e5f\u652f\u6301\u7684\uff0c\u63a5\u4e0b\u6765\u770b\u770b Stream \u7279\u6709\u7684\u529f\u80fd\u3002</p> <p>Stream \u53ef\u4ee5\u4ee5\u4f7f\u7528 XGROUP \u521b\u5efa\u6d88\u8d39\u7ec4\uff0c\u521b\u5efa\u6d88\u8d39\u7ec4\u4e4b\u540e\uff0cStream \u53ef\u4ee5\u4f7f\u7528 XREADGROUP \u547d\u4ee4\u8ba9\u6d88\u8d39\u7ec4\u5185\u7684\u6d88\u8d39\u8005\u8bfb\u53d6\u6d88\u606f\u3002</p> <p>\u521b\u5efa\u4e24\u4e2a\u6d88\u8d39\u7ec4\uff0c\u8fd9\u4e24\u4e2a\u6d88\u8d39\u7ec4\u6d88\u8d39\u7684\u6d88\u606f\u961f\u5217\u662f mymq\uff0c\u90fd\u6307\u5b9a\u4ece\u7b2c\u4e00\u6761\u6d88\u606f\u5f00\u59cb\u8bfb\u53d6\uff1a</p> Bash<pre><code># \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a group1 \u7684\u6d88\u8d39\u7ec4\uff0c0-0 \u8868\u793a\u4ece\u7b2c\u4e00\u6761\u6d88\u606f\u5f00\u59cb\u8bfb\u53d6\u3002\n&gt; XGROUP CREATE mymq group1 0-0\nOK\n# \u521b\u5efa\u4e00\u4e2a\u540d\u4e3a group2 \u7684\u6d88\u8d39\u7ec4\uff0c0-0 \u8868\u793a\u4ece\u7b2c\u4e00\u6761\u6d88\u606f\u5f00\u59cb\u8bfb\u53d6\u3002\n&gt; XGROUP CREATE mymq group2 0-0\nOK\n</code></pre> <p>\u6d88\u8d39\u7ec4 group1 \u5185\u7684\u6d88\u8d39\u8005  consumer1 \u4ece mymq \u6d88\u606f\u961f\u5217\u4e2d\u8bfb\u53d6\u6240\u6709\u6d88\u606f\u7684\u547d\u4ee4\u5982\u4e0b\uff1a</p> Bash<pre><code># \u547d\u4ee4\u6700\u540e\u7684\u53c2\u6570\u201c&gt;\u201d\uff0c\u8868\u793a\u4ece\u7b2c\u4e00\u6761\u5c1a\u672a\u88ab\u6d88\u8d39\u7684\u6d88\u606f\u5f00\u59cb\u8bfb\u53d6\u3002\n&gt; XREADGROUP GROUP group1 consumer1 STREAMS mymq &gt;\n1) 1) \"mymq\"\n   2) 1) 1) \"1654254953808-0\"\n         2) 1) \"name\"\n            2) \"xiaolin\"\n</code></pre> <p>\u6d88\u606f\u961f\u5217\u4e2d\u7684\u6d88\u606f\u4e00\u65e6\u88ab\u6d88\u8d39\u7ec4\u91cc\u7684\u4e00\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\uff0c\u5c31\u4e0d\u80fd\u518d\u88ab\u8be5\u6d88\u8d39\u7ec4\u5185\u7684\u5176\u4ed6\u6d88\u8d39\u8005\u8bfb\u53d6\u4e86\uff0c\u5373\u540c\u4e00\u4e2a\u6d88\u8d39\u7ec4\u91cc\u7684\u6d88\u8d39\u8005\u4e0d\u80fd\u6d88\u8d39\u540c\u4e00\u6761\u6d88\u606f\u3002</p> <p>\u6bd4\u5982\u8bf4\uff0c\u6211\u4eec\u6267\u884c\u5b8c\u521a\u624d\u7684 XREADGROUP \u547d\u4ee4\u540e\uff0c\u518d\u6267\u884c\u4e00\u6b21\u540c\u6837\u7684\u547d\u4ee4\uff0c\u6b64\u65f6\u8bfb\u5230\u7684\u5c31\u662f\u7a7a\u503c\u4e86\uff1a</p> Bash<pre><code>&gt; XREADGROUP GROUP group1 consumer1 STREAMS mymq &gt;\n(nil)\n</code></pre> <p>\u4f46\u662f\uff0c\u4e0d\u540c\u6d88\u8d39\u7ec4\u7684\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u540c\u4e00\u6761\u6d88\u606f\uff08\u4f46\u662f\u6709\u524d\u63d0\u6761\u4ef6\uff0c\u521b\u5efa\u6d88\u606f\u7ec4\u7684\u65f6\u5019\uff0c\u4e0d\u540c\u6d88\u8d39\u7ec4\u6307\u5b9a\u4e86\u76f8\u540c\u4f4d\u7f6e\u5f00\u59cb\u8bfb\u53d6\u6d88\u606f\uff09\u3002</p> <p>\u6bd4\u5982\u8bf4\uff0c\u521a\u624d group1 \u6d88\u8d39\u7ec4\u91cc\u7684 consumer1 \u6d88\u8d39\u8005\u6d88\u8d39\u4e86\u4e00\u6761 id \u4e3a 1654254953808-0 \u7684\u6d88\u606f\uff0c\u73b0\u5728\u7528 group2 \u6d88\u8d39\u7ec4\u91cc\u7684 consumer1 \u6d88\u8d39\u8005\u6d88\u8d39\u6d88\u606f\uff1a</p> Bash<pre><code>&gt; XREADGROUP GROUP group2 consumer1 STREAMS mymq &gt;\n1) 1) \"mymq\"\n   2) 1) 1) \"1654254953808-0\"\n         2) 1) \"name\"\n            2) \"xiaolin\"\n</code></pre> <p>\u56e0\u4e3a\u6211\u521b\u5efa\u4e24\u7ec4\u7684\u6d88\u8d39\u7ec4\u90fd\u662f\u4ece\u7b2c\u4e00\u6761\u6d88\u606f\u5f00\u59cb\u8bfb\u53d6\uff0c\u6240\u4ee5\u53ef\u4ee5\u770b\u5230\u7b2c\u4e8c\u7ec4\u7684\u6d88\u8d39\u8005\u4f9d\u7136\u53ef\u4ee5\u6d88\u8d39 id \u4e3a 1654254953808-0 \u7684\u8fd9\u4e00\u6761\u6d88\u606f\u3002\u56e0\u6b64\uff0c\u4e0d\u540c\u7684\u6d88\u8d39\u7ec4\u7684\u6d88\u8d39\u8005\u53ef\u4ee5\u6d88\u8d39\u540c\u4e00\u6761\u6d88\u606f\u3002</p> <p>\u4f7f\u7528\u6d88\u8d39\u7ec4\u7684\u76ee\u7684\u662f\u8ba9\u7ec4\u5185\u7684\u591a\u4e2a\u6d88\u8d39\u8005\u5171\u540c\u5206\u62c5\u8bfb\u53d6\u6d88\u606f\uff0c\u6240\u4ee5\uff0c\u6211\u4eec\u901a\u5e38\u4f1a\u8ba9\u6bcf\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u90e8\u5206\u6d88\u606f\uff0c\u4ece\u800c\u5b9e\u73b0\u6d88\u606f\u8bfb\u53d6\u8d1f\u8f7d\u5728\u591a\u4e2a\u6d88\u8d39\u8005\u95f4\u662f\u5747\u8861\u5206\u5e03\u7684\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u6267\u884c\u4e0b\u5217\u547d\u4ee4\uff0c\u8ba9 group2 \u4e2d\u7684 consumer1\u30012\u30013 \u5404\u81ea\u8bfb\u53d6\u4e00\u6761\u6d88\u606f\u3002</p> Bash<pre><code># \u8ba9 group2 \u4e2d\u7684 consumer1 \u4ece mymq \u6d88\u606f\u961f\u5217\u4e2d\u6d88\u8d39\u4e00\u6761\u6d88\u606f\n&gt; XREADGROUP GROUP group2 consumer1 COUNT 1 STREAMS mymq &gt;\n1) 1) \"mymq\"\n   2) 1) 1) \"1654254953808-0\"\n         2) 1) \"name\"\n            2) \"xiaolin\"\n# \u8ba9 group2 \u4e2d\u7684 consumer2 \u4ece mymq \u6d88\u606f\u961f\u5217\u4e2d\u6d88\u8d39\u4e00\u6761\u6d88\u606f\n&gt; XREADGROUP GROUP group2 consumer2 COUNT 1 STREAMS mymq &gt;\n1) 1) \"mymq\"\n   2) 1) 1) \"1654256265584-0\"\n         2) 1) \"name\"\n            2) \"xiaolincoding\"\n# \u8ba9 group2 \u4e2d\u7684 consumer3 \u4ece mymq \u6d88\u606f\u961f\u5217\u4e2d\u6d88\u8d39\u4e00\u6761\u6d88\u606f\n&gt; XREADGROUP GROUP group2 consumer3 COUNT 1 STREAMS mymq &gt;\n1) 1) \"mymq\"\n   2) 1) 1) \"1654256271337-0\"\n         2) 1) \"name\"\n            2) \"Tom\"\n</code></pre> <p>\u57fa\u4e8e Stream \u5b9e\u73b0\u7684\u6d88\u606f\u961f\u5217\uff0c\u5982\u4f55\u4fdd\u8bc1\u6d88\u8d39\u8005\u5728\u53d1\u751f\u6545\u969c\u6216\u5b95\u673a\u518d\u6b21\u91cd\u542f\u540e\uff0c\u4ecd\u7136\u53ef\u4ee5\u8bfb\u53d6\u672a\u5904\u7406\u5b8c\u7684\u6d88\u606f\uff1f</p> <p>Streams \u4f1a\u81ea\u52a8\u4f7f\u7528\u5185\u90e8\u961f\u5217\uff08\u4e5f\u79f0\u4e3a PENDING List\uff09\u7559\u5b58\u6d88\u8d39\u7ec4\u91cc\u6bcf\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u7684\u6d88\u606f\uff0c\u76f4\u5230\u6d88\u8d39\u8005\u4f7f\u7528 XACK \u547d\u4ee4\u901a\u77e5 Streams\u201c\u6d88\u606f\u5df2\u7ecf\u5904\u7406\u5b8c\u6210\u201d\u3002</p> <p>\u6d88\u8d39\u786e\u8ba4\u589e\u52a0\u4e86\u6d88\u606f\u7684\u53ef\u9760\u6027\uff0c\u4e00\u822c\u5728\u4e1a\u52a1\u5904\u7406\u5b8c\u6210\u4e4b\u540e\uff0c\u9700\u8981\u6267\u884c XACK \u547d\u4ee4\u786e\u8ba4\u6d88\u606f\u5df2\u7ecf\u88ab\u6d88\u8d39\u5b8c\u6210\uff0c\u6574\u4e2a\u6d41\u7a0b\u7684\u6267\u884c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5982\u679c\u6d88\u8d39\u8005\u6ca1\u6709\u6210\u529f\u5904\u7406\u6d88\u606f\uff0c\u5b83\u5c31\u4e0d\u4f1a\u7ed9 Streams \u53d1\u9001 XACK \u547d\u4ee4\uff0c\u6d88\u606f\u4ecd\u7136\u4f1a\u7559\u5b58\u3002\u6b64\u65f6\uff0c\u6d88\u8d39\u8005\u53ef\u4ee5\u5728\u91cd\u542f\u540e\uff0c\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u5b8c\u6210\u7684\u6d88\u606f\u3002</p> <p>\u4f8b\u5982\uff0c\u6211\u4eec\u6765\u67e5\u770b\u4e00\u4e0b group2 \u4e2d\u5404\u4e2a\u6d88\u8d39\u8005\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u7684\u6d88\u606f\u4e2a\u6570\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> Bash<pre><code>127.0.0.1:6379&gt; XPENDING mymq group2\n1) (integer) 3\n2) \"1654254953808-0\"  # \u8868\u793a group2 \u4e2d\u6240\u6709\u6d88\u8d39\u8005\u8bfb\u53d6\u7684\u6d88\u606f\u6700\u5c0f ID\n3) \"1654256271337-0\"  # \u8868\u793a group2 \u4e2d\u6240\u6709\u6d88\u8d39\u8005\u8bfb\u53d6\u7684\u6d88\u606f\u6700\u5927 ID\n4) 1) 1) \"consumer1\"\n      2) \"1\"\n   2) 1) \"consumer2\"\n      2) \"1\"\n   3) 1) \"consumer3\"\n      2) \"1\"\n</code></pre> <p>\u5982\u679c\u60f3\u67e5\u770b\u67d0\u4e2a\u6d88\u8d39\u8005\u5177\u4f53\u8bfb\u53d6\u4e86\u54ea\u4e9b\u6570\u636e\uff0c\u53ef\u4ee5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\uff1a</p> Bash<pre><code># \u67e5\u770b group2 \u91cc consumer2 \u5df2\u4ece mymq \u6d88\u606f\u961f\u5217\u4e2d\u8bfb\u53d6\u4e86\u54ea\u4e9b\u6d88\u606f\n&gt; XPENDING mymq group2 - + 10 consumer2\n1) 1) \"1654256265584-0\"\n   2) \"consumer2\"\n   3) (integer) 410700\n   4) (integer) 1\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0cconsumer2 \u5df2\u8bfb\u53d6\u7684\u6d88\u606f\u7684 ID \u662f 1654256265584-0\u3002</p> <p>\u4e00\u65e6\u6d88\u606f 1654256265584-0 \u88ab consumer2 \u5904\u7406\u4e86\uff0cconsumer2 \u5c31\u53ef\u4ee5\u4f7f\u7528 XACK \u547d\u4ee4\u901a\u77e5 Streams\uff0c\u7136\u540e\u8fd9\u6761\u6d88\u606f\u5c31\u4f1a\u88ab\u5220\u9664\u3002</p> Bash<pre><code>&gt; XACK mymq group2 1654256265584-0\n(integer) 1\n</code></pre> <p>\u5f53\u6211\u4eec\u518d\u4f7f\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u65f6\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\uff0cconsumer2 \u5df2\u7ecf\u6ca1\u6709\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u7684\u6d88\u606f\u4e86\u3002</p> Bash<pre><code>&gt; XPENDING mymq group2 - + 10 consumer2\n(empty array)\n</code></pre> <p>\u597d\u4e86\uff0c\u57fa\u4e8e Stream \u5b9e\u73b0\u7684\u6d88\u606f\u961f\u5217\u5c31\u8bf4\u5230\u8fd9\u91cc\u4e86\uff0c\u5c0f\u7ed3\u4e00\u4e0b\uff1a</p> <ul> <li>\u6d88\u606f\u4fdd\u5e8f\uff1aXADD/XREAD</li> <li>\u963b\u585e\u8bfb\u53d6\uff1aXREAD block</li> <li>\u91cd\u590d\u6d88\u606f\u5904\u7406\uff1aStream \u5728\u4f7f\u7528  XADD \u547d\u4ee4\uff0c\u4f1a\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00 ID\uff1b</li> <li>\u6d88\u606f\u53ef\u9760\u6027\uff1a\u5185\u90e8\u4f7f\u7528 PENDING List \u81ea\u52a8\u4fdd\u5b58\u6d88\u606f\uff0c\u4f7f\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u6d88\u8d39\u7ec4\u5df2\u7ecf\u8bfb\u53d6\u4f46\u662f\u672a\u88ab\u786e\u8ba4\u7684\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u4f7f\u7528 XACK \u786e\u8ba4\u6d88\u606f\uff1b</li> <li>\u652f\u6301\u6d88\u8d39\u7ec4\u5f62\u5f0f\u6d88\u8d39\u6570\u636e</li> </ul> <p>Redis \u57fa\u4e8e Stream \u6d88\u606f\u961f\u5217\u4e0e\u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\u6709\u54ea\u4e9b\u5dee\u8ddd\uff1f</p> <p>\u4e00\u4e2a\u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\uff0c\u5fc5\u987b\u8981\u505a\u5230\u4e24\u5927\u5757\uff1a</p> <ul> <li>\u6d88\u606f\u4e0d\u4e22\u3002</li> <li>\u6d88\u606f\u53ef\u5806\u79ef\u3002</li> </ul> <p>1\u3001Redis Stream \u6d88\u606f\u4f1a\u4e22\u5931\u5417\uff1f</p> <p>\u4f7f\u7528\u4e00\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u5176\u5b9e\u5c31\u5206\u4e3a\u4e09\u5927\u5757\uff1a\u751f\u4ea7\u8005\u3001\u961f\u5217\u4e2d\u95f4\u4ef6\u3001\u6d88\u8d39\u8005\uff0c\u6240\u4ee5\u8981\u4fdd\u8bc1\u6d88\u606f\u5c31\u662f\u4fdd\u8bc1\u4e09\u4e2a\u73af\u8282\u90fd\u4e0d\u80fd\u4e22\u5931\u6570\u636e\u3002</p> <p></p> <p>Redis Stream \u6d88\u606f\u961f\u5217\u80fd\u4e0d\u80fd\u4fdd\u8bc1\u4e09\u4e2a\u73af\u8282\u90fd\u4e0d\u4e22\u5931\u6570\u636e\uff1f</p> <ul> <li>Redis \u751f\u4ea7\u8005\u4f1a\u4e0d\u4f1a\u4e22\u6d88\u606f\uff1f\u751f\u4ea7\u8005\u4f1a\u4e0d\u4f1a\u4e22\u6d88\u606f\uff0c\u53d6\u51b3\u4e8e\u751f\u4ea7\u8005\u5bf9\u4e8e\u5f02\u5e38\u60c5\u51b5\u7684\u5904\u7406\u662f\u5426\u5408\u7406\u3002\u4ece\u6d88\u606f\u88ab\u751f\u4ea7\u51fa\u6765\uff0c\u7136\u540e\u63d0\u4ea4\u7ed9 MQ \u7684\u8fc7\u7a0b\u4e2d\uff0c\u53ea\u8981\u80fd\u6b63\u5e38\u6536\u5230\uff08MQ \u4e2d\u95f4\u4ef6\uff09\u7684 ack \u786e\u8ba4\u54cd\u5e94\uff0c\u5c31\u8868\u793a\u53d1\u9001\u6210\u529f\uff0c\u6240\u4ee5\u53ea\u8981\u5904\u7406\u597d\u8fd4\u56de\u503c\u548c\u5f02\u5e38\uff0c\u5982\u679c\u8fd4\u56de\u5f02\u5e38\u5219\u8fdb\u884c\u6d88\u606f\u91cd\u53d1\uff0c\u90a3\u4e48\u8fd9\u4e2a\u9636\u6bb5\u662f\u4e0d\u4f1a\u51fa\u73b0\u6d88\u606f\u4e22\u5931\u7684\u3002</li> <li>Redis \u6d88\u8d39\u8005\u4f1a\u4e0d\u4f1a\u4e22\u6d88\u606f\uff1f\u4e0d\u4f1a\uff0c\u56e0\u4e3a Stream\uff08MQ \u4e2d\u95f4\u4ef6\uff09\u4f1a\u81ea\u52a8\u4f7f\u7528\u5185\u90e8\u961f\u5217\uff08\u4e5f\u79f0\u4e3a PENDING List\uff09\u7559\u5b58\u6d88\u8d39\u7ec4\u91cc\u6bcf\u4e2a\u6d88\u8d39\u8005\u8bfb\u53d6\u7684\u6d88\u606f\uff0c\u4f46\u662f\u672a\u88ab\u786e\u8ba4\u7684\u6d88\u606f\u3002\u6d88\u8d39\u8005\u53ef\u4ee5\u5728\u91cd\u542f\u540e\uff0c\u7528 XPENDING \u547d\u4ee4\u67e5\u770b\u5df2\u8bfb\u53d6\u3001\u4f46\u5c1a\u672a\u786e\u8ba4\u5904\u7406\u5b8c\u6210\u7684\u6d88\u606f\u3002\u7b49\u5230\u6d88\u8d39\u8005\u6267\u884c\u5b8c\u4e1a\u52a1\u903b\u8f91\u540e\uff0c\u518d\u53d1\u9001\u6d88\u8d39\u786e\u8ba4 XACK \u547d\u4ee4\uff0c\u4e5f\u80fd\u4fdd\u8bc1\u6d88\u606f\u7684\u4e0d\u4e22\u5931\u3002</li> <li>Redis \u6d88\u606f\u4e2d\u95f4\u4ef6\u4f1a\u4e0d\u4f1a\u4e22\u6d88\u606f\uff1f\u4f1a\uff0cRedis \u5728\u4ee5\u4e0b 2 \u4e2a\u573a\u666f\u4e0b\uff0c\u90fd\u4f1a\u5bfc\u81f4\u6570\u636e\u4e22\u5931\uff1a</li> <li>AOF \u6301\u4e45\u5316\u914d\u7f6e\u4e3a\u6bcf\u79d2\u5199\u76d8\uff0c\u4f46\u8fd9\u4e2a\u5199\u76d8\u8fc7\u7a0b\u662f\u5f02\u6b65\u7684\uff0cRedis \u5b95\u673a\u65f6\u4f1a\u5b58\u5728\u6570\u636e\u4e22\u5931\u7684\u53ef\u80fd</li> <li>\u4e3b\u4ece\u590d\u5236\u4e5f\u662f\u5f02\u6b65\u7684\uff0c\u4e3b\u4ece\u5207\u6362\u65f6\uff0c\u4e5f\u5b58\u5728\u4e22\u5931\u6570\u636e\u7684\u53ef\u80fd\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0cRedis \u5728\u961f\u5217\u4e2d\u95f4\u4ef6\u73af\u8282\u65e0\u6cd5\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4e22\u3002\u50cf RabbitMQ \u6216 Kafka \u8fd9\u7c7b\u4e13\u4e1a\u7684\u961f\u5217\u4e2d\u95f4\u4ef6\uff0c\u5728\u4f7f\u7528\u65f6\u662f\u90e8\u7f72\u4e00\u4e2a\u96c6\u7fa4\uff0c\u751f\u4ea7\u8005\u5728\u53d1\u5e03\u6d88\u606f\u65f6\uff0c\u961f\u5217\u4e2d\u95f4\u4ef6\u901a\u5e38\u4f1a\u5199\u300c\u591a\u4e2a\u8282\u70b9\u300d\uff0c\u4e5f\u5c31\u662f\u6709\u591a\u4e2a\u526f\u672c\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4fbf\u5176\u4e2d\u4e00\u4e2a\u8282\u70b9\u6302\u4e86\uff0c\u4e5f\u80fd\u4fdd\u8bc1\u96c6\u7fa4\u7684\u6570\u636e\u4e0d\u4e22\u5931\u3002</p> <p>2\u3001Redis Stream \u6d88\u606f\u53ef\u5806\u79ef\u5417\uff1f</p> <p>Redis \u7684\u6570\u636e\u90fd\u5b58\u50a8\u5728\u5185\u5b58\u4e2d\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u4e00\u65e6\u53d1\u751f\u6d88\u606f\u79ef\u538b\uff0c\u5219\u4f1a\u5bfc\u81f4 Redis \u7684\u5185\u5b58\u6301\u7eed\u589e\u957f\uff0c\u5982\u679c\u8d85\u8fc7\u673a\u5668\u5185\u5b58\u4e0a\u9650\uff0c\u5c31\u4f1a\u9762\u4e34\u88ab OOM \u7684\u98ce\u9669\u3002</p> <p>\u6240\u4ee5 Redis \u7684 Stream \u63d0\u4f9b\u4e86\u53ef\u4ee5\u6307\u5b9a\u961f\u5217\u6700\u5927\u957f\u5ea6\u7684\u529f\u80fd\uff0c\u5c31\u662f\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\u3002</p> <p>\u5f53\u6307\u5b9a\u961f\u5217\u6700\u5927\u957f\u5ea6\u65f6\uff0c\u961f\u5217\u957f\u5ea6\u8d85\u8fc7\u4e0a\u9650\u540e\uff0c\u65e7\u6d88\u606f\u4f1a\u88ab\u5220\u9664\uff0c\u53ea\u4fdd\u7559\u56fa\u5b9a\u957f\u5ea6\u7684\u65b0\u6d88\u606f\u3002\u8fd9\u4e48\u6765\u770b\uff0cStream \u5728\u6d88\u606f\u79ef\u538b\u65f6\uff0c\u5982\u679c\u6307\u5b9a\u4e86\u6700\u5927\u957f\u5ea6\uff0c\u8fd8\u662f\u6709\u53ef\u80fd\u4e22\u5931\u6d88\u606f\u7684\u3002</p> <p>\u4f46 Kafka\u3001RabbitMQ \u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\u5b83\u4eec\u7684\u6570\u636e\u90fd\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\uff0c\u5f53\u6d88\u606f\u79ef\u538b\u65f6\uff0c\u65e0\u975e\u5c31\u662f\u591a\u5360\u7528\u4e00\u4e9b\u78c1\u76d8\u7a7a\u95f4\u3002</p> <p>\u56e0\u6b64\uff0c\u628a Redis \u5f53\u4f5c\u961f\u5217\u6765\u4f7f\u7528\u65f6\uff0c\u4f1a\u9762\u4e34\u7684 2 \u4e2a\u95ee\u9898\uff1a</p> <ul> <li>Redis \u672c\u8eab\u53ef\u80fd\u4f1a\u4e22\u6570\u636e\uff1b</li> <li>\u9762\u5bf9\u6d88\u606f\u6324\u538b\uff0c\u5185\u5b58\u8d44\u6e90\u4f1a\u7d27\u5f20\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u80fd\u4e0d\u80fd\u5c06 Redis \u4f5c\u4e3a\u6d88\u606f\u961f\u5217\u6765\u4f7f\u7528\uff0c\u5173\u952e\u770b\u4f60\u7684\u4e1a\u52a1\u573a\u666f\uff1a</p> <ul> <li>\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u573a\u666f\u8db3\u591f\u7b80\u5355\uff0c\u5bf9\u4e8e\u6570\u636e\u4e22\u5931\u4e0d\u654f\u611f\uff0c\u800c\u4e14\u6d88\u606f\u79ef\u538b\u6982\u7387\u6bd4\u8f83\u5c0f\u7684\u60c5\u51b5\u4e0b\uff0c\u628a Redis \u5f53\u4f5c\u961f\u5217\u662f\u5b8c\u5168\u53ef\u4ee5\u7684\u3002</li> <li>\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u6709\u6d77\u91cf\u6d88\u606f\uff0c\u6d88\u606f\u79ef\u538b\u7684\u6982\u7387\u6bd4\u8f83\u5927\uff0c\u5e76\u4e14\u4e0d\u80fd\u63a5\u53d7\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48\u8fd8\u662f\u7528\u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\u4e2d\u95f4\u4ef6\u5427\u3002</li> </ul> <p>\u8865\u5145\uff1aRedis \u53d1\u5e03/\u8ba2\u9605\u673a\u5236\u4e3a\u4ec0\u4e48\u4e0d\u53ef\u4ee5\u4f5c\u4e3a\u6d88\u606f\u961f\u5217\uff1f</p> <p>\u53d1\u5e03\u8ba2\u9605\u673a\u5236\u5b58\u5728\u4ee5\u4e0b\u7f3a\u70b9\uff0c\u90fd\u662f\u8ddf\u4e22\u5931\u6570\u636e\u6709\u5173\uff1a</p> <ol> <li>\u53d1\u5e03/\u8ba2\u9605\u673a\u5236\u6ca1\u6709\u57fa\u4e8e\u4efb\u4f55\u6570\u636e\u7c7b\u578b\u5b9e\u73b0\uff0c\u6240\u4ee5\u4e0d\u5177\u5907\u300c\u6570\u636e\u6301\u4e45\u5316\u300d\u7684\u80fd\u529b\uff0c\u4e5f\u5c31\u662f\u53d1\u5e03/\u8ba2\u9605\u673a\u5236\u7684\u76f8\u5173\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u5199\u5165\u5230 RDB \u548c AOF \u4e2d\uff0c\u5f53 Redis \u5b95\u673a\u91cd\u542f\uff0c\u53d1\u5e03/\u8ba2\u9605\u673a\u5236\u7684\u6570\u636e\u4e5f\u4f1a\u5168\u90e8\u4e22\u5931\u3002</li> <li>\u53d1\u5e03\u8ba2\u9605\u6a21\u5f0f\u662f\u201c\u53d1\u540e\u65e2\u5fd8\u201d\u7684\u5de5\u4f5c\u6a21\u5f0f\uff0c\u5982\u679c\u6709\u8ba2\u9605\u8005\u79bb\u7ebf\u91cd\u8fde\u4e4b\u540e\u4e0d\u80fd\u6d88\u8d39\u4e4b\u524d\u7684\u5386\u53f2\u6d88\u606f\u3002</li> <li>\u5f53\u6d88\u8d39\u7aef\u6709\u4e00\u5b9a\u7684\u6d88\u606f\u79ef\u538b\u65f6\uff0c\u4e5f\u5c31\u662f\u751f\u4ea7\u8005\u53d1\u9001\u7684\u6d88\u606f\uff0c\u6d88\u8d39\u8005\u6d88\u8d39\u4e0d\u8fc7\u6765\u65f6\uff0c\u5982\u679c\u8d85\u8fc7 32M \u6216\u8005\u662f 60s \u5185\u6301\u7eed\u4fdd\u6301\u5728 8M \u4ee5\u4e0a\uff0c\u6d88\u8d39\u7aef\u4f1a\u88ab\u5f3a\u884c\u65ad\u5f00\uff0c\u8fd9\u4e2a\u53c2\u6570\u662f\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u8bbe\u7f6e\u7684\uff0c\u9ed8\u8ba4\u503c\u662f <code>client-output-buffer-limit pubsub 32mb 8mb 60</code>\u3002</li> </ol> <p>\u6240\u4ee5\uff0c\u53d1\u5e03/\u8ba2\u9605\u673a\u5236\u53ea\u9002\u5408\u5373\u65f6\u901a\u8baf\u7684\u573a\u666f\uff0c\u6bd4\u5982\u6784\u5efa\u54e8\u5175\u96c6\u7fa4\u7684\u573a\u666f\u91c7\u7528\u4e86\u53d1\u5e03/\u8ba2\u9605\u673a\u5236\u3002</p>"},{"location":"redis/data_struct/command/#_51","title":"\u603b\u7ed3","text":"<p>Redis \u5e38\u89c1\u7684\u4e94\u79cd\u6570\u636e\u7c7b\u578b\uff1aString\uff08\u5b57\u7b26\u4e32\uff09\uff0cHash\uff08\u54c8\u5e0c\uff09\uff0cList\uff08\u5217\u8868\uff09\uff0cSet\uff08\u96c6\u5408\uff09\u53ca Zset(sorted set\uff1a\u6709\u5e8f\u96c6\u5408)\u3002</p> <p>\u8fd9\u4e94\u79cd\u6570\u636e\u7c7b\u578b\u90fd\u7531\u591a\u79cd\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u7684\uff0c\u4e3b\u8981\u662f\u51fa\u4e8e\u65f6\u95f4\u548c\u7a7a\u95f4\u7684\u8003\u8651\uff0c\u5f53\u6570\u636e\u91cf\u5c0f\u7684\u65f6\u5019\u4f7f\u7528\u66f4\u7b80\u5355\u7684\u6570\u636e\u7ed3\u6784\uff0c\u6709\u5229\u4e8e\u8282\u7701\u5185\u5b58\uff0c\u63d0\u9ad8\u6027\u80fd\u3002</p> <p>\u8fd9\u4e94\u79cd\u6570\u636e\u7c7b\u578b\u4e0e\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5bf9\u5e94\u5173\u7cfb\u56fe\u5982\u4e0b\uff0c\u5de6\u8fb9\u662f Redis 3.0 \u7248\u672c\u7684\uff0c\u4e5f\u5c31\u662f\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b\u8fd9\u672c\u4e66\u8bb2\u89e3\u7684\u7248\u672c\uff0c\u73b0\u5728\u770b\u8fd8\u662f\u6709\u70b9\u8fc7\u65f6\u4e86\uff0c\u53f3\u8fb9\u662f\u73b0\u5728 Github \u6700\u65b0\u7684 Redis \u4ee3\u7801\u7684\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cRedis \u6570\u636e\u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u968f\u7740\u7248\u672c\u7684\u66f4\u65b0\u4e5f\u6709\u6240\u4e0d\u540c\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5728 Redis 3.0 \u7248\u672c\u4e2d List \u5bf9\u8c61\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7531\u300c\u53cc\u5411\u94fe\u8868\u300d\u6216\u300c\u538b\u7f29\u8868\u5217\u8868\u300d\u5b9e\u73b0\uff0c\u4f46\u662f\u5728 3.2 \u7248\u672c\u4e4b\u540e\uff0cList \u6570\u636e\u7c7b\u578b\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531 quicklist \u5b9e\u73b0\u7684\uff1b</li> <li>\u5728\u6700\u65b0\u7684 Redis \u4ee3\u7801\u4e2d\uff0c\u538b\u7f29\u5217\u8868\u6570\u636e\u7ed3\u6784\u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u4ea4\u7531 listpack \u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u4e86\u3002</li> </ul> <p>Redis \u4e94\u79cd\u6570\u636e\u7c7b\u578b\u7684\u5e94\u7528\u573a\u666f\uff1a</p> <ul> <li>String \u7c7b\u578b\u7684\u5e94\u7528\u573a\u666f\uff1a\u7f13\u5b58\u5bf9\u8c61\u3001\u5e38\u89c4\u8ba1\u6570\u3001\u5206\u5e03\u5f0f\u9501\u3001\u5171\u4eab session \u4fe1\u606f\u7b49\u3002</li> <li>List \u7c7b\u578b\u7684\u5e94\u7528\u573a\u666f\uff1a\u6d88\u606f\u961f\u5217\uff08\u6709\u4e24\u4e2a\u95ee\u9898\uff1a1. \u751f\u4ea7\u8005\u9700\u8981\u81ea\u884c\u5b9e\u73b0\u5168\u5c40\u552f\u4e00 ID\uff1b2. \u4e0d\u80fd\u4ee5\u6d88\u8d39\u7ec4\u5f62\u5f0f\u6d88\u8d39\u6570\u636e\uff09\u7b49\u3002</li> <li>Hash \u7c7b\u578b\uff1a\u7f13\u5b58\u5bf9\u8c61\u3001\u8d2d\u7269\u8f66\u7b49\u3002</li> <li>Set \u7c7b\u578b\uff1a\u805a\u5408\u8ba1\u7b97\uff08\u5e76\u96c6\u3001\u4ea4\u96c6\u3001\u5dee\u96c6\uff09\u573a\u666f\uff0c\u6bd4\u5982\u70b9\u8d5e\u3001\u5171\u540c\u5173\u6ce8\u3001\u62bd\u5956\u6d3b\u52a8\u7b49\u3002</li> <li>Zset \u7c7b\u578b\uff1a\u6392\u5e8f\u573a\u666f\uff0c\u6bd4\u5982\u6392\u884c\u699c\u3001\u7535\u8bdd\u548c\u59d3\u540d\u6392\u5e8f\u7b49\u3002</li> </ul> <p>Redis \u540e\u7eed\u7248\u672c\u53c8\u652f\u6301\u56db\u79cd\u6570\u636e\u7c7b\u578b\uff0c\u5b83\u4eec\u7684\u5e94\u7528\u573a\u666f\u5982\u4e0b\uff1a</p> <ul> <li>BitMap\uff082.2 \u7248\u65b0\u589e\uff09\uff1a\u4e8c\u503c\u72b6\u6001\u7edf\u8ba1\u7684\u573a\u666f\uff0c\u6bd4\u5982\u7b7e\u5230\u3001\u5224\u65ad\u7528\u6237\u767b\u5f55\u72b6\u6001\u3001\u8fde\u7eed\u7b7e\u5230\u7528\u6237\u603b\u6570\u7b49\uff1b</li> <li>HyperLogLog\uff082.8 \u7248\u65b0\u589e\uff09\uff1a\u6d77\u91cf\u6570\u636e\u57fa\u6570\u7edf\u8ba1\u7684\u573a\u666f\uff0c\u6bd4\u5982\u767e\u4e07\u7ea7\u7f51\u9875 UV \u8ba1\u6570\u7b49\uff1b</li> <li>GEO\uff083.2 \u7248\u65b0\u589e\uff09\uff1a\u5b58\u50a8\u5730\u7406\u4f4d\u7f6e\u4fe1\u606f\u7684\u573a\u666f\uff0c\u6bd4\u5982\u6ef4\u6ef4\u53eb\u8f66\uff1b</li> <li>Stream\uff085.0 \u7248\u65b0\u589e\uff09\uff1a\u6d88\u606f\u961f\u5217\uff0c\u76f8\u6bd4\u4e8e\u57fa\u4e8e List \u7c7b\u578b\u5b9e\u73b0\u7684\u6d88\u606f\u961f\u5217\uff0c\u6709\u8fd9\u4e24\u4e2a\u7279\u6709\u7684\u7279\u6027\uff1a\u81ea\u52a8\u751f\u6210\u5168\u5c40\u552f\u4e00\u6d88\u606f ID\uff0c\u652f\u6301\u4ee5\u6d88\u8d39\u7ec4\u5f62\u5f0f\u6d88\u8d39\u6570\u636e\u3002</li> </ul> <p>\u9488\u5bf9 Redis \u662f\u5426\u9002\u5408\u505a\u6d88\u606f\u961f\u5217\uff0c\u5173\u952e\u770b\u4f60\u7684\u4e1a\u52a1\u573a\u666f\uff1a</p> <ul> <li>\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u573a\u666f\u8db3\u591f\u7b80\u5355\uff0c\u5bf9\u4e8e\u6570\u636e\u4e22\u5931\u4e0d\u654f\u611f\uff0c\u800c\u4e14\u6d88\u606f\u79ef\u538b\u6982\u7387\u6bd4\u8f83\u5c0f\u7684\u60c5\u51b5\u4e0b\uff0c\u628a Redis \u5f53\u4f5c\u961f\u5217\u662f\u5b8c\u5168\u53ef\u4ee5\u7684\u3002</li> <li>\u5982\u679c\u4f60\u7684\u4e1a\u52a1\u6709\u6d77\u91cf\u6d88\u606f\uff0c\u6d88\u606f\u79ef\u538b\u7684\u6982\u7387\u6bd4\u8f83\u5927\uff0c\u5e76\u4e14\u4e0d\u80fd\u63a5\u53d7\u6570\u636e\u4e22\u5931\uff0c\u90a3\u4e48\u8fd8\u662f\u7528\u4e13\u4e1a\u7684\u6d88\u606f\u961f\u5217\u4e2d\u95f4\u4ef6\u5427\u3002</li> </ul> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u300aRedis \u6838\u5fc3\u6280\u672f\u4e0e\u5b9e\u6218\u300b</li> <li>https://www.cnblogs.com/hunternet/p/12742390.html</li> <li>https://www.cnblogs.com/qdhxhz/p/15669348.html</li> <li>https://www.cnblogs.com/bbgs-xc/p/14376109.html</li> <li>http://kaito-kidd.com/2021/04/19/can-redis-be-used-as-a-queue/</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/data_struct/data_struct/","title":"Redis \u6570\u636e\u7ed3\u6784","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>Redis \u4e3a\u4ec0\u4e48\u90a3\u4e48\u5feb\uff1f</p> <p>\u9664\u4e86\u5b83\u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u4f7f\u5f97\u6240\u6709\u7684\u64cd\u4f5c\u90fd\u5728\u5185\u5b58\u4e0a\u8fdb\u884c\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u91cd\u8981\u56e0\u7d20\uff0c\u5b83\u5b9e\u73b0\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f7f\u5f97\u6211\u4eec\u5bf9\u6570\u636e\u8fdb\u884c\u589e\u5220\u67e5\u6539\u64cd\u4f5c\u65f6\uff0cRedis \u80fd\u9ad8\u6548\u7684\u5904\u7406\u3002</p> <p>\u56e0\u6b64\uff0c\u8fd9\u6b21\u6211\u4eec\u5c31\u6765\u597d\u597d\u804a\u4e00\u4e0b Redis \u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u4e2a\u5728\u9762\u8bd5\u4e2d\u592a\u5e38\u95ee\u4e86\u3002</p> <p>\u6ce8\u610f\uff0cRedis \u6570\u636e\u7ed3\u6784\u5e76\u4e0d\u662f\u6307 String\uff08\u5b57\u7b26\u4e32\uff09\u5bf9\u8c61\u3001List\uff08\u5217\u8868\uff09\u5bf9\u8c61\u3001Hash\uff08\u54c8\u5e0c\uff09\u5bf9\u8c61\u3001Set\uff08\u96c6\u5408\uff09\u5bf9\u8c61\u548c Zset\uff08\u6709\u5e8f\u96c6\u5408\uff09\u5bf9\u8c61\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u662f Redis \u952e\u503c\u5bf9\u4e2d\u503c\u7684\u6570\u636e\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u7684\u4fdd\u5b58\u5f62\u5f0f\uff0c\u8fd9\u4e9b\u5bf9\u8c61\u7684\u5e95\u5c42\u5b9e\u73b0\u7684\u65b9\u5f0f\u5c31\u7528\u5230\u4e86\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u6211\u753b\u4e86\u4e00\u5f20 Redis \u6570\u636e\u7c7b\u578b\uff08\u4e5f\u53eb Redis \u5bf9\u8c61\uff09\u548c\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7684\u5bf9\u5e94\u5173\u56fe\uff0c\u5de6\u8fb9\u662f Redis 3.0 \u7248\u672c\u7684\uff0c\u4e5f\u5c31\u662f\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b\u8fd9\u672c\u4e66\u8bb2\u89e3\u7684\u7248\u672c\uff0c\u73b0\u5728\u770b\u8fd8\u662f\u6709\u70b9\u8fc7\u65f6\u4e86\uff0c\u53f3\u8fb9\u662f\u73b0\u5728 Github \u6700\u65b0\u7684 Redis \u4ee3\u7801\u7684\uff08\u8fd8\u672a\u53d1\u5e03\u6b63\u5f0f\u7248\u672c\uff09\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cRedis \u6570\u636e\u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u968f\u7740\u7248\u672c\u7684\u66f4\u65b0\u4e5f\u6709\u6240\u4e0d\u540c\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5728 Redis 3.0 \u7248\u672c\u4e2d List \u5bf9\u8c61\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7531\u300c\u53cc\u5411\u94fe\u8868\u300d\u6216\u300c\u538b\u7f29\u8868\u5217\u8868\u300d\u5b9e\u73b0\uff0c\u4f46\u662f\u5728 3.2 \u7248\u672c\u4e4b\u540e\uff0cList \u6570\u636e\u7c7b\u578b\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u7531 quicklist \u5b9e\u73b0\u7684\uff1b</li> <li>\u5728\u6700\u65b0\u7684 Redis \u4ee3\u7801\uff08\u8fd8\u672a\u53d1\u5e03\u6b63\u5f0f\u7248\u672c\uff09\u4e2d\uff0c\u538b\u7f29\u5217\u8868\u6570\u636e\u7ed3\u6784\u5df2\u7ecf\u5e9f\u5f03\u4e86\uff0c\u4ea4\u7531 listpack \u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u4e86\u3002</li> </ul> <p>\u8fd9\u6b21\uff0c\u5c0f\u6797\u628a\u65b0\u65e7\u7248\u672c\u7684\u6570\u636e\u7ed3\u6784\u8bf4\u56fe\u89e3\u4e00\u904d\uff0c\u5171\u6709 9 \u79cd\u6570\u636e\u7ed3\u6784\uff1aSDS\u3001\u53cc\u5411\u94fe\u8868\u3001\u538b\u7f29\u5217\u8868\u3001\u54c8\u5e0c\u8868\u3001\u8df3\u8868\u3001\u6574\u6570\u96c6\u5408\u3001quicklist\u3001listpack\u3002</p> <p>\u4e0d\u591a BB \u4e86\uff0c\u76f4\u63a5\u53d1\u8f66\uff01</p> <p></p>"},{"location":"redis/data_struct/data_struct/#_1","title":"\u952e\u503c\u5bf9\u6570\u636e\u5e93\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f","text":"<p>\u5728\u5f00\u59cb\u8bb2\u6570\u636e\u7ed3\u6784\u4e4b\u524d\uff0c\u5148\u7ed9\u4ecb\u7ecd\u4e0b Redis \u662f\u600e\u6837\u5b9e\u73b0\u952e\u503c\u5bf9\uff08key-value\uff09\u6570\u636e\u5e93\u7684\u3002</p> <p>Redis \u7684\u952e\u503c\u5bf9\u4e2d\u7684 key \u5c31\u662f\u5b57\u7b26\u4e32\u5bf9\u8c61\uff0c\u800c value \u53ef\u4ee5\u662f\u5b57\u7b26\u4e32\u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u662f\u96c6\u5408\u6570\u636e\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982 List \u5bf9\u8c61\u3001Hash \u5bf9\u8c61\u3001Set \u5bf9\u8c61\u548c Zset \u5bf9\u8c61\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u8fd9\u91cc\u5217\u51fa\u51e0\u79cd Redis \u65b0\u589e\u952e\u503c\u5bf9\u7684\u547d\u4ee4\uff1a</p> Text Only<pre><code>&gt; SET name \"xiaolincoding\"\nOK\n\n&gt; HSET person name \"xiaolincoding\" age 18\n0\n\n&gt; RPUSH stu \"xiaolin\" \"xiaomei\"\n(integer) 4\n</code></pre> <p>\u8fd9\u4e9b\u547d\u4ee4\u4ee3\u8868\u7740\uff1a</p> <ul> <li>\u7b2c\u4e00\u6761\u547d\u4ee4\uff1aname \u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u952e\uff0c\u56e0\u4e3a\u952e\u7684\u503c\u662f\u4e00\u4e2a\u5b57\u7b26\u4e32\u5bf9\u8c61\uff1b</li> <li>\u7b2c\u4e8c\u6761\u547d\u4ee4\uff1aperson \u662f\u4e00\u4e2a\u54c8\u5e0c\u8868\u952e\uff0c\u56e0\u4e3a\u952e\u7684\u503c\u662f\u4e00\u4e2a\u5305\u542b\u4e24\u4e2a\u952e\u503c\u5bf9\u7684\u54c8\u5e0c\u8868\u5bf9\u8c61\uff1b</li> <li>\u7b2c\u4e09\u6761\u547d\u4ee4\uff1astu \u662f\u4e00\u4e2a\u5217\u8868\u952e\uff0c\u56e0\u4e3a\u952e\u7684\u503c\u662f\u4e00\u4e2a\u5305\u542b\u4e24\u4e2a\u5143\u7d20\u7684\u5217\u8868\u5bf9\u8c61\uff1b</li> </ul> <p>\u8fd9\u4e9b\u952e\u503c\u5bf9\u662f\u5982\u4f55\u4fdd\u5b58\u5728 Redis \u4e2d\u7684\u5462\uff1f</p> <p>Redis \u662f\u4f7f\u7528\u4e86\u4e00\u4e2a\u300c\u54c8\u5e0c\u8868\u300d\u4fdd\u5b58\u6240\u6709\u952e\u503c\u5bf9\uff0c\u54c8\u5e0c\u8868\u7684\u6700\u5927\u597d\u5904\u5c31\u662f\u8ba9\u6211\u4eec\u53ef\u4ee5\u7528 O(1) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6765\u5feb\u901f\u67e5\u627e\u5230\u952e\u503c\u5bf9\u3002\u54c8\u5e0c\u8868\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u53eb\u505a\u54c8\u5e0c\u6876\u3002</p> <p>Redis \u7684\u54c8\u5e0c\u6876\u662f\u600e\u4e48\u4fdd\u5b58\u952e\u503c\u5bf9\u6570\u636e\u7684\u5462\uff1f</p> <p>\u54c8\u5e0c\u6876\u5b58\u653e\u7684\u662f\u6307\u5411\u952e\u503c\u5bf9\u6570\u636e\u7684\u6307\u9488\uff08dictEntry*\uff09\uff0c\u8fd9\u6837\u901a\u8fc7\u6307\u9488\u5c31\u80fd\u627e\u5230\u952e\u503c\u5bf9\u6570\u636e\uff0c\u7136\u540e\u56e0\u4e3a\u952e\u503c\u5bf9\u7684\u503c\u53ef\u4ee5\u4fdd\u5b58\u5b57\u7b26\u4e32\u5bf9\u8c61\u548c\u96c6\u5408\u6570\u636e\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u6240\u4ee5\u952e\u503c\u5bf9\u7684\u6570\u636e\u7ed3\u6784\u4e2d\u5e76\u4e0d\u662f\u76f4\u63a5\u4fdd\u5b58\u503c\u672c\u8eab\uff0c\u800c\u662f\u4fdd\u5b58\u4e86 void * key \u548c void * value \u6307\u9488\uff0c\u5206\u522b\u6307\u5411\u4e86\u5b9e\u9645\u7684\u952e\u5bf9\u8c61\u548c\u503c\u5bf9\u8c61\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u5373\u4f7f\u503c\u662f\u96c6\u5408\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 void * value \u6307\u9488\u627e\u5230\u3002</p> <p>\u6211\u8fd9\u91cc\u753b\u4e86\u4e00\u5f20 Redis \u4fdd\u5b58\u952e\u503c\u5bf9\u6240\u6d89\u53ca\u5230\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p></p> <p>\u8fd9\u4e9b\u6570\u636e\u7ed3\u6784\u7684\u5185\u90e8\u7ec6\u8282\uff0c\u6211\u5148\u4e0d\u5c55\u5f00\u8bb2\uff0c\u540e\u9762\u5728\u8bb2\u54c8\u5e0c\u8868\u6570\u636e\u7ed3\u6784\u7684\u65f6\u5019\uff0c\u5728\u8be6\u7ec6\u7684\u8bf4\u8bf4\uff0c\u56e0\u4e3a\u7528\u5230\u7684\u6570\u636e\u7ed3\u6784\u662f\u4e00\u6837\u7684\u3002\u8fd9\u91cc\u5148\u5927\u6982\u8bf4\u4e0b\u56fe\u4e2d\u6d89\u53ca\u5230\u7684\u6570\u636e\u7ed3\u6784\u7684\u540d\u5b57\u548c\u7528\u9014\uff1a</p> <ul> <li>redisDb \u7ed3\u6784\uff0c\u8868\u793a Redis \u6570\u636e\u5e93\u7684\u7ed3\u6784\uff0c\u7ed3\u6784\u4f53\u91cc\u5b58\u653e\u4e86\u6307\u5411\u4e86 dict \u7ed3\u6784\u7684\u6307\u9488\uff1b</li> <li>dict \u7ed3\u6784\uff0c\u7ed3\u6784\u4f53\u91cc\u5b58\u653e\u4e86 2 \u4e2a\u54c8\u5e0c\u8868\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\u90fd\u662f\u7528\u300c\u54c8\u5e0c\u8868 1\u300d\uff0c\u300c\u54c8\u5e0c\u8868 2\u300d\u53ea\u6709\u5728 rehash \u7684\u65f6\u5019\u624d\u7528\uff0c\u5177\u4f53\u4ec0\u4e48\u662f rehash\uff0c\u6211\u5728\u672c\u6587\u7684\u54c8\u5e0c\u8868\u6570\u636e\u7ed3\u6784\u4f1a\u8bb2\uff1b</li> <li>ditctht \u7ed3\u6784\uff0c\u8868\u793a\u54c8\u5e0c\u8868\u7684\u7ed3\u6784\uff0c\u7ed3\u6784\u91cc\u5b58\u653e\u4e86\u54c8\u5e0c\u8868\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u90fd\u662f\u6307\u5411\u4e00\u4e2a\u54c8\u5e0c\u8868\u8282\u70b9\u7ed3\u6784\uff08dictEntry\uff09\u7684\u6307\u9488\uff1b</li> <li>dictEntry \u7ed3\u6784\uff0c\u8868\u793a\u54c8\u5e0c\u8868\u8282\u70b9\u7684\u7ed3\u6784\uff0c\u7ed3\u6784\u91cc\u5b58\u653e\u4e86 void * key \u548c void * value \u6307\u9488\uff0c key \u6307\u5411\u7684\u662f String \u5bf9\u8c61\uff0c\u800c value \u5219\u53ef\u4ee5\u6307\u5411 String \u5bf9\u8c61\uff0c\u4e5f\u53ef\u4ee5\u6307\u5411\u96c6\u5408\u7c7b\u578b\u7684\u5bf9\u8c61\uff0c\u6bd4\u5982 List \u5bf9\u8c61\u3001Hash \u5bf9\u8c61\u3001Set \u5bf9\u8c61\u548c Zset \u5bf9\u8c61\u3002</li> </ul> <p>\u7279\u522b\u8bf4\u660e\u4e0b\uff0cvoid * key \u548c void * value \u6307\u9488\u6307\u5411\u7684\u662f Redis \u5bf9\u8c61\uff0cRedis \u4e2d\u7684\u6bcf\u4e2a\u5bf9\u8c61\u90fd\u7531 redisObject \u7ed3\u6784\u8868\u793a\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5bf9\u8c61\u7ed3\u6784\u91cc\u5305\u542b\u7684\u6210\u5458\u53d8\u91cf\uff1a</p> <ul> <li>type\uff0c\u6807\u8bc6\u8be5\u5bf9\u8c61\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u5bf9\u8c61\uff08String \u5bf9\u8c61\u3001List \u5bf9\u8c61\u3001Hash \u5bf9\u8c61\u3001Set \u5bf9\u8c61\u548c Zset \u5bf9\u8c61\uff09\uff1b</li> <li>encoding\uff0c\u6807\u8bc6\u8be5\u5bf9\u8c61\u4f7f\u7528\u4e86\u54ea\u79cd\u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\uff1b</li> <li>ptr\uff0c\u6307\u5411\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7684\u6307\u9488\u3002</li> </ul> <p>\u6211\u753b\u4e86\u4e00\u5f20 Redis \u952e\u503c\u5bf9\u6570\u636e\u5e93\u7684\u5168\u666f\u56fe\uff0c\u4f60\u5c31\u80fd\u6e05\u6670\u77e5\u9053 Redis \u5bf9\u8c61\u548c\u6570\u636e\u7ed3\u6784\u7684\u5173\u7cfb\u4e86\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u597d\u597d\u804a\u4e00\u4e0b\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff01</p>"},{"location":"redis/data_struct/data_struct/#sds","title":"SDS","text":"<p>\u5b57\u7b26\u4e32\u5728 Redis \u4e2d\u662f\u5f88\u5e38\u7528\u7684\uff0c\u952e\u503c\u5bf9\u4e2d\u7684\u952e\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\uff0c\u503c\u6709\u65f6\u4e5f\u662f\u5b57\u7b26\u4e32\u7c7b\u578b\u3002</p> <p>Redis \u662f\u7528 C \u8bed\u8a00\u5b9e\u73b0\u7684\uff0c\u4f46\u662f\u5b83\u6ca1\u6709\u76f4\u63a5\u4f7f\u7528 C \u8bed\u8a00\u7684 char* \u5b57\u7b26\u6570\u7ec4\u6765\u5b9e\u73b0\u5b57\u7b26\u4e32\uff0c\u800c\u662f\u81ea\u5df1\u5c01\u88c5\u4e86\u4e00\u4e2a\u540d\u4e3a\u7b80\u5355\u52a8\u6001\u5b57\u7b26\u4e32\uff08simple dynamic string\uff0cSDS\uff09\u7684\u6570\u636e\u7ed3\u6784\u6765\u8868\u793a\u5b57\u7b26\u4e32\uff0c\u4e5f\u5c31\u662f Redis \u7684 String \u6570\u636e\u7c7b\u578b\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f SDS\u3002</p> <p>\u65e2\u7136 Redis \u8bbe\u8ba1\u4e86 SDS \u7ed3\u6784\u6765\u8868\u793a\u5b57\u7b26\u4e32\uff0c\u80af\u5b9a\u662f C \u8bed\u8a00\u7684 char* \u5b57\u7b26\u6570\u7ec4\u5b58\u5728\u4e00\u4e9b\u7f3a\u9677\u3002</p> <p>\u8981\u4e86\u89e3\u8fd9\u4e00\u70b9\uff0c\u5f97\u5148\u6765\u770b\u770b char* \u5b57\u7b26\u6570\u7ec4\u7684\u7ed3\u6784\u3002</p>"},{"location":"redis/data_struct/data_struct/#c","title":"C \u8bed\u8a00\u5b57\u7b26\u4e32\u7684\u7f3a\u9677","text":"<p>C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u5b57\u7b26\u6570\u7ec4\uff0c\u5373\u6570\u7ec4\u4e2d\u6bcf\u4e2a\u5143\u7d20\u662f\u5b57\u7b26\u4e32\u4e2d\u7684\u4e00\u4e2a\u5b57\u7b26\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u56fe\u5c31\u662f\u5b57\u7b26\u4e32\u201cxiaolin\u201d\u7684 char* \u5b57\u7b26\u6570\u7ec4\u7684\u7ed3\u6784\uff1a</p> <p></p> <p>\u6ca1\u5b66\u8fc7 C \u8bed\u8a00\u7684\u540c\u5b66\uff0c\u53ef\u80fd\u4f1a\u597d\u5947\u4e3a\u4ec0\u4e48\u6700\u540e\u4e00\u4e2a\u5b57\u7b26\u662f\u201c\\0\u201d\uff1f</p> <p>\u5728 C \u8bed\u8a00\u91cc\uff0c\u5bf9\u5b57\u7b26\u4e32\u64cd\u4f5c\u65f6\uff0cchar * \u6307\u9488\u53ea\u662f\u6307\u5411\u5b57\u7b26\u6570\u7ec4\u7684\u8d77\u59cb\u4f4d\u7f6e\uff0c\u800c\u5b57\u7b26\u6570\u7ec4\u7684\u7ed3\u5c3e\u4f4d\u7f6e\u5c31\u7528\u201c\\0\u201d\u8868\u793a\uff0c\u610f\u601d\u662f\u6307\u5b57\u7b26\u4e32\u7684\u7ed3\u675f\u3002</p> <p>\u56e0\u6b64\uff0cC \u8bed\u8a00\u6807\u51c6\u5e93\u4e2d\u7684\u5b57\u7b26\u4e32\u64cd\u4f5c\u51fd\u6570\u5c31\u901a\u8fc7\u5224\u65ad\u5b57\u7b26\u662f\u4e0d\u662f\u201c\\0\u201d\u6765\u51b3\u5b9a\u8981\u4e0d\u8981\u505c\u6b62\u64cd\u4f5c\uff0c\u5982\u679c\u5f53\u524d\u5b57\u7b26\u4e0d\u662f\u201c\\0\u201d \uff0c\u8bf4\u660e\u5b57\u7b26\u4e32\u8fd8\u6ca1\u7ed3\u675f\uff0c\u53ef\u4ee5\u7ee7\u7eed\u64cd\u4f5c\uff0c\u5982\u679c\u5f53\u524d\u5b57\u7b26\u662f\u201c\\0\u201d\u662f\u5219\u8bf4\u660e\u5b57\u7b26\u4e32\u7ed3\u675f\u4e86\uff0c\u5c31\u8981\u505c\u6b62\u64cd\u4f5c\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0cC \u8bed\u8a00\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u51fd\u6570 <code>strlen</code>\uff0c\u5c31\u662f\u901a\u8fc7\u5b57\u7b26\u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5b57\u7b26\uff0c\u5e76\u8fdb\u884c\u8ba1\u6570\uff0c\u7b49\u9047\u5230\u5b57\u7b26\u4e3a\u201c\\0\u201d\u540e\uff0c\u5c31\u4f1a\u505c\u6b62\u904d\u5386\uff0c\u7136\u540e\u8fd4\u56de\u5df2\u7ecf\u7edf\u8ba1\u5230\u7684\u5b57\u7b26\u4e2a\u6570\uff0c\u5373\u4e3a\u5b57\u7b26\u4e32\u957f\u5ea6\u3002\u4e0b\u56fe\u663e\u793a\u4e86 strlen \u51fd\u6570\u7684\u6267\u884c\u6d41\u7a0b\uff1a</p> <p></p> <p>\u5f88\u660e\u663e\uff0cC \u8bed\u8a00\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O\uff08N\uff09\uff08\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u6539\u8fdb\u7684\u5730\u65b9\uff09</p> <p>C \u8bed\u8a00\u5b57\u7b26\u4e32\u7528\u201c\\0\u201d\u5b57\u7b26\u4f5c\u4e3a\u7ed3\u5c3e\u6807\u8bb0\u6709\u4e2a\u7f3a\u9677\u3002\u5047\u8bbe\u6709\u4e2a\u5b57\u7b26\u4e32\u4e2d\u6709\u4e2a\u201c\\0\u201d\u5b57\u7b26\uff0c\u8fd9\u65f6\u5728\u64cd\u4f5c\u8fd9\u4e2a\u5b57\u7b26\u4e32\u65f6\u5c31\u4f1a\u63d0\u65e9\u7ed3\u675f\uff0c\u6bd4\u5982\u201cxiao\\0lin\u201d\u5b57\u7b26\u4e32\uff0c\u8ba1\u7b97\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u65f6\u5019\u5219\u4f1a\u662f 4\uff0c\u5982\u4e0b\u56fe\uff1a                                                                               </p> <p></p> <p>\u56e0\u6b64\uff0c\u9664\u4e86\u5b57\u7b26\u4e32\u7684\u672b\u5c3e\u4e4b\u5916\uff0c\u5b57\u7b26\u4e32\u91cc\u9762\u4e0d\u80fd\u542b\u6709\u201c\\0\u201d\u5b57\u7b26\uff0c\u5426\u5219\u6700\u5148\u88ab\u7a0b\u5e8f\u8bfb\u5165\u7684\u201c\\0\u201d\u5b57\u7b26\u5c06\u88ab\u8bef\u8ba4\u4e3a\u662f\u5b57\u7b26\u4e32\u7ed3\u5c3e\uff0c\u8fd9\u4e2a\u9650\u5236\u4f7f\u5f97 C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u53ea\u80fd\u4fdd\u5b58\u6587\u672c\u6570\u636e\uff0c\u4e0d\u80fd\u4fdd\u5b58\u50cf\u56fe\u7247\u3001\u97f3\u9891\u3001\u89c6\u9891\u6587\u5316\u8fd9\u6837\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff08\u8fd9\u4e5f\u662f\u4e00\u4e2a\u53ef\u4ee5\u6539\u8fdb\u7684\u5730\u65b9\uff09</p> <p>\u53e6\u5916\uff0cC \u8bed\u8a00\u6807\u51c6\u5e93\u4e2d\u5b57\u7b26\u4e32\u7684\u64cd\u4f5c\u51fd\u6570\u662f\u5f88\u4e0d\u5b89\u5168\u7684\uff0c\u5bf9\u7a0b\u5e8f\u5458\u5f88\u4e0d\u53cb\u597d\uff0c\u7a0d\u5fae\u4e00\u4e0d\u6ce8\u610f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7f13\u51b2\u533a\u6ea2\u51fa\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0cstrcat \u51fd\u6570\u662f\u53ef\u4ee5\u5c06\u4e24\u4e2a\u5b57\u7b26\u4e32\u62fc\u63a5\u5728\u4e00\u8d77\u3002</p> C<pre><code>//\u5c06 src \u5b57\u7b26\u4e32\u62fc\u63a5\u5230 dest \u5b57\u7b26\u4e32\u540e\u9762\nchar *strcat(char *dest, const char* src);\n</code></pre> <p>C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u662f\u4e0d\u4f1a\u8bb0\u5f55\u81ea\u8eab\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u7684\uff0c\u6240\u4ee5 strcat \u51fd\u6570\u5047\u5b9a\u7a0b\u5e8f\u5458\u5728\u6267\u884c\u8fd9\u4e2a\u51fd\u6570\u65f6\uff0c\u5df2\u7ecf\u4e3a dest \u5206\u914d\u4e86\u8db3\u591f\u591a\u7684\u5185\u5b58\uff0c\u53ef\u4ee5\u5bb9\u7eb3 src \u5b57\u7b26\u4e32\u4e2d\u7684\u6240\u6709\u5185\u5bb9\uff0c\u800c\u4e00\u65e6\u8fd9\u4e2a\u5047\u5b9a\u4e0d\u6210\u7acb\uff0c\u5c31\u4f1a\u53d1\u751f\u7f13\u51b2\u533a\u6ea2\u51fa\u5c06\u53ef\u80fd\u4f1a\u9020\u6210\u7a0b\u5e8f\u8fd0\u884c\u7ec8\u6b62\uff0c\uff08\u8fd9\u662f\u4e00\u4e2a\u53ef\u4ee5\u6539\u8fdb\u7684\u5730\u65b9\uff09\u3002</p> <p>\u800c\u4e14\uff0cstrcat \u51fd\u6570\u548c strlen \u51fd\u6570\u7c7b\u4f3c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e5f\u5f88\u9ad8\uff0c\u4e5f\u90fd\u9700\u8981\u5148\u901a\u8fc7\u904d\u5386\u5b57\u7b26\u4e32\u624d\u80fd\u5f97\u5230\u76ee\u6807\u5b57\u7b26\u4e32\u7684\u672b\u5c3e\u3002\u7136\u540e\u5bf9\u4e8e strcat \u51fd\u6570\u6765\u8bf4\uff0c\u8fd8\u8981\u518d\u904d\u5386\u6e90\u5b57\u7b26\u4e32\u624d\u80fd\u5b8c\u6210\u8ffd\u52a0\uff0c\u5bf9\u5b57\u7b26\u4e32\u7684\u64cd\u4f5c\u6548\u7387\u4e0d\u9ad8\u3002</p> <p>\u597d\u4e86\uff0c\u901a\u8fc7\u4ee5\u4e0a\u7684\u5206\u6790\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5 C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u4e0d\u8db3\u4e4b\u5904\u4ee5\u53ca\u53ef\u4ee5\u6539\u8fdb\u7684\u5730\u65b9\uff1a</p> <ul> <li>\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a  O\uff08N\uff09\uff1b</li> <li>\u5b57\u7b26\u4e32\u7684\u7ed3\u5c3e\u662f\u4ee5\u201c\\0\u201d\u5b57\u7b26\u6807\u8bc6\uff0c\u5b57\u7b26\u4e32\u91cc\u9762\u4e0d\u80fd\u5305\u542b\u6709\u201c\\0\u201d\u5b57\u7b26\uff0c\u56e0\u6b64\u4e0d\u80fd\u4fdd\u5b58\u4e8c\u8fdb\u5236\u6570\u636e\uff1b</li> <li>\u5b57\u7b26\u4e32\u64cd\u4f5c\u51fd\u6570\u4e0d\u9ad8\u6548\u4e14\u4e0d\u5b89\u5168\uff0c\u6bd4\u5982\u6709\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u98ce\u9669\uff0c\u6709\u53ef\u80fd\u4f1a\u9020\u6210\u7a0b\u5e8f\u8fd0\u884c\u7ec8\u6b62\uff1b</li> </ul> <p>Redis \u5b9e\u73b0\u7684 SDS \u7684\u7ed3\u6784\u5c31\u628a\u4e0a\u9762\u8fd9\u4e9b\u95ee\u9898\u89e3\u51b3\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4e00\u8d77\u770b\u770b Redis \u662f\u5982\u4f55\u89e3\u51b3\u7684\u3002</p>"},{"location":"redis/data_struct/data_struct/#sds_1","title":"SDS \u7ed3\u6784\u8bbe\u8ba1","text":"<p>\u4e0b\u56fe\u5c31\u662f Redis 5.0 \u7684 SDS \u7684\u6570\u636e\u7ed3\u6784\uff1a</p> <p></p> <p>\u7ed3\u6784\u4e2d\u7684\u6bcf\u4e2a\u6210\u5458\u53d8\u91cf\u5206\u522b\u4ecb\u7ecd\u4e0b\uff1a</p> <ul> <li>len\uff0c\u8bb0\u5f55\u4e86\u5b57\u7b26\u4e32\u957f\u5ea6\u3002\u8fd9\u6837\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u8fd4\u56de\u8fd9\u4e2a\u6210\u5458\u53d8\u91cf\u503c\u5c31\u884c\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53ea\u9700\u8981 O\uff081\uff09\u3002</li> <li>alloc\uff0c\u5206\u914d\u7ed9\u5b57\u7b26\u6570\u7ec4\u7684\u7a7a\u95f4\u957f\u5ea6\u3002\u8fd9\u6837\u5728\u4fee\u6539\u5b57\u7b26\u4e32\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>alloc - len</code> \u8ba1\u7b97\u51fa\u5269\u4f59\u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u53ef\u4ee5\u7528\u6765\u5224\u65ad\u7a7a\u95f4\u662f\u5426\u6ee1\u8db3\u4fee\u6539\u9700\u6c42\uff0c\u5982\u679c\u4e0d\u6ee1\u8db3\u7684\u8bdd\uff0c\u5c31\u4f1a\u81ea\u52a8\u5c06 SDS  \u7684\u7a7a\u95f4\u6269\u5c55\u81f3\u6267\u884c\u4fee\u6539\u6240\u9700\u7684\u5927\u5c0f\uff0c\u7136\u540e\u624d\u6267\u884c\u5b9e\u9645\u7684\u4fee\u6539\u64cd\u4f5c\uff0c\u6240\u4ee5\u4f7f\u7528 SDS \u65e2\u4e0d\u9700\u8981\u624b\u52a8\u4fee\u6539 SDS \u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u524d\u9762\u6240\u8bf4\u7684\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\u3002</li> <li>flags\uff0c\u7528\u6765\u8868\u793a\u4e0d\u540c\u7c7b\u578b\u7684 SDS\u3002\u4e00\u5171\u8bbe\u8ba1\u4e86 5 \u79cd\u7c7b\u578b\uff0c\u5206\u522b\u662f sdshdr5\u3001sdshdr8\u3001sdshdr16\u3001sdshdr32 \u548c sdshdr64\uff0c\u540e\u9762\u5728\u8bf4\u660e\u533a\u522b\u4e4b\u5904\u3002</li> <li>buf[]\uff0c\u5b57\u7b26\u6570\u7ec4\uff0c\u7528\u6765\u4fdd\u5b58\u5b9e\u9645\u6570\u636e\u3002\u4e0d\u4ec5\u53ef\u4ee5\u4fdd\u5b58\u5b57\u7b26\u4e32\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u5b58\u4e8c\u8fdb\u5236\u6570\u636e\u3002</li> </ul> <p>\u603b\u7684\u6765\u8bf4\uff0cRedis \u7684 SDS \u7ed3\u6784\u5728\u539f\u672c\u5b57\u7b26\u6570\u7ec4\u4e4b\u4e0a\uff0c\u589e\u52a0\u4e86\u4e09\u4e2a\u5143\u6570\u636e\uff1alen\u3001alloc\u3001flags\uff0c\u7528\u6765\u89e3\u51b3 C \u8bed\u8a00\u5b57\u7b26\u4e32\u7684\u7f3a\u9677\u3002</p>"},{"location":"redis/data_struct/data_struct/#o1","title":"O\uff081\uff09\u590d\u6742\u5ea6\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6","text":"<p>C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u957f\u5ea6\u83b7\u53d6 strlen \u51fd\u6570\uff0c\u9700\u8981\u901a\u8fc7\u904d\u5386\u7684\u65b9\u5f0f\u6765\u7edf\u8ba1\u5b57\u7b26\u4e32\u957f\u5ea6\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O\uff08N\uff09\u3002</p> <p>\u800c Redis \u7684 SDS \u7ed3\u6784\u56e0\u4e3a\u52a0\u5165\u4e86 len \u6210\u5458\u53d8\u91cf\uff0c\u90a3\u4e48\u83b7\u53d6\u5b57\u7b26\u4e32\u957f\u5ea6\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u8fd4\u56de\u8fd9\u4e2a\u6210\u5458\u53d8\u91cf\u7684\u503c\u5c31\u884c\uff0c\u6240\u4ee5\u590d\u6742\u5ea6\u53ea\u6709 O\uff081\uff09\u3002</p>"},{"location":"redis/data_struct/data_struct/#_2","title":"\u4e8c\u8fdb\u5236\u5b89\u5168","text":"<p>\u56e0\u4e3a SDS \u4e0d\u9700\u8981\u7528\u201c\\0\u201d\u5b57\u7b26\u6765\u6807\u8bc6\u5b57\u7b26\u4e32\u7ed3\u5c3e\u4e86\uff0c\u800c\u662f\u6709\u4e2a\u4e13\u95e8\u7684 len \u6210\u5458\u53d8\u91cf\u6765\u8bb0\u5f55\u957f\u5ea6\uff0c\u6240\u4ee5\u53ef\u5b58\u50a8\u5305\u542b\u201c\\0\u201d\u7684\u6570\u636e\u3002\u4f46\u662f SDS \u4e3a\u4e86\u517c\u5bb9\u90e8\u5206 C \u8bed\u8a00\u6807\u51c6\u5e93\u7684\u51fd\u6570\uff0cSDS \u5b57\u7b26\u4e32\u7ed3\u5c3e\u8fd8\u662f\u4f1a\u52a0\u4e0a\u201c\\0\u201d\u5b57\u7b26\u3002</p> <p>\u56e0\u6b64\uff0cSDS \u7684 API \u90fd\u662f\u4ee5\u5904\u7406\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u6765\u5904\u7406 SDS \u5b58\u653e\u5728 buf[] \u91cc\u7684\u6570\u636e\uff0c\u7a0b\u5e8f\u4e0d\u4f1a\u5bf9\u5176\u4e2d\u7684\u6570\u636e\u505a\u4efb\u4f55\u9650\u5236\uff0c\u6570\u636e\u5199\u5165\u7684\u65f6\u5019\u65f6\u4ec0\u4e48\u6837\u7684\uff0c\u5b83\u88ab\u8bfb\u53d6\u65f6\u5c31\u662f\u4ec0\u4e48\u6837\u7684\u3002</p> <p>\u901a\u8fc7\u4f7f\u7528\u4e8c\u8fdb\u5236\u5b89\u5168\u7684 SDS\uff0c\u800c\u4e0d\u662f C \u5b57\u7b26\u4e32\uff0c\u4f7f\u5f97 Redis \u4e0d\u4ec5\u53ef\u4ee5\u4fdd\u5b58\u6587\u672c\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u4fdd\u5b58\u4efb\u610f\u683c\u5f0f\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u3002</p>"},{"location":"redis/data_struct/data_struct/#_3","title":"\u4e0d\u4f1a\u53d1\u751f\u7f13\u51b2\u533a\u6ea2\u51fa","text":"<p>C \u8bed\u8a00\u7684\u5b57\u7b26\u4e32\u6807\u51c6\u5e93\u63d0\u4f9b\u7684\u5b57\u7b26\u4e32\u64cd\u4f5c\u51fd\u6570\uff0c\u5927\u591a\u6570\uff08\u6bd4\u5982 strcat \u8ffd\u52a0\u5b57\u7b26\u4e32\u51fd\u6570\uff09\u90fd\u662f\u4e0d\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u51fd\u6570\u628a\u7f13\u51b2\u533a\u5927\u5c0f\u662f\u5426\u6ee1\u8db3\u64cd\u4f5c\u9700\u6c42\u7684\u5de5\u4f5c\u4ea4\u7531\u5f00\u53d1\u8005\u6765\u4fdd\u8bc1\uff0c\u7a0b\u5e8f\u5185\u90e8\u5e76\u4e0d\u4f1a\u5224\u65ad\u7f13\u51b2\u533a\u5927\u5c0f\u662f\u5426\u8db3\u591f\u7528\uff0c\u5f53\u53d1\u751f\u4e86\u7f13\u51b2\u533a\u6ea2\u51fa\u5c31\u6709\u53ef\u80fd\u9020\u6210\u7a0b\u5e8f\u5f02\u5e38\u7ed3\u675f\u3002</p> <p>\u6240\u4ee5\uff0cRedis \u7684 SDS \u7ed3\u6784\u91cc\u5f15\u5165\u4e86 alloc \u548c len \u6210\u5458\u53d8\u91cf\uff0c\u8fd9\u6837 SDS API \u901a\u8fc7 <code>alloc - len</code> \u8ba1\u7b97\uff0c\u53ef\u4ee5\u7b97\u51fa\u5269\u4f59\u53ef\u7528\u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u8fd9\u6837\u5728\u5bf9\u5b57\u7b26\u4e32\u505a\u4fee\u6539\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u7531\u7a0b\u5e8f\u5185\u90e8\u5224\u65ad\u7f13\u51b2\u533a\u5927\u5c0f\u662f\u5426\u8db3\u591f\u7528\u3002</p> <p>\u800c\u4e14\uff0c\u5f53\u5224\u65ad\u51fa\u7f13\u51b2\u533a\u5927\u5c0f\u4e0d\u591f\u7528\u65f6\uff0cRedis \u4f1a\u81ea\u52a8\u5c06\u6269\u5927 SDS \u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u4ee5\u6ee1\u8db3\u4fee\u6539\u6240\u9700\u7684\u5927\u5c0f\u3002</p> <p>SDS \u6269\u5bb9\u7684\u89c4\u5219\u4ee3\u7801\u5982\u4e0b\uff1a</p> C<pre><code>hisds hi_sdsMakeRoomFor(hisds s, size_t addlen)\n{\n    ... ...\n    // s \u76ee\u524d\u7684\u5269\u4f59\u7a7a\u95f4\u5df2\u8db3\u591f\uff0c\u65e0\u9700\u6269\u5c55\uff0c\u76f4\u63a5\u8fd4\u56de\n    if (avail &gt;= addlen)\n        return s;\n    //\u83b7\u53d6\u76ee\u524d s \u7684\u957f\u5ea6\n    len = hi_sdslen(s);\n    sh = (char *)s - hi_sdsHdrSize(oldtype);\n    //\u6269\u5c55\u4e4b\u540e s \u81f3\u5c11\u9700\u8981\u7684\u957f\u5ea6\n    newlen = (len + addlen);\n    //\u6839\u636e\u65b0\u957f\u5ea6\uff0c\u4e3a s \u5206\u914d\u65b0\u7a7a\u95f4\u6240\u9700\u8981\u7684\u5927\u5c0f\n    if (newlen &lt; HI_SDS_MAX_PREALLOC)\n        //\u65b0\u957f\u5ea6&lt;HI_SDS_MAX_PREALLOC \u5219\u5206\u914d\u6240\u9700\u7a7a\u95f4*2 \u7684\u7a7a\u95f4\n        newlen *= 2;\n    else\n        //\u5426\u5219\uff0c\u5206\u914d\u957f\u5ea6\u4e3a\u76ee\u524d\u957f\u5ea6 +1MB\n        newlen += HI_SDS_MAX_PREALLOC;\n       ...\n}\n</code></pre> <ul> <li>\u5982\u679c\u6240\u9700\u7684 sds \u957f\u5ea6\u5c0f\u4e8e 1 MB\uff0c\u90a3\u4e48\u6700\u540e\u7684\u6269\u5bb9\u662f\u6309\u7167\u7ffb\u500d\u6269\u5bb9\u6765\u6267\u884c\u7684\uff0c\u5373 2 \u500d\u7684 newlen</li> <li>\u5982\u679c\u6240\u9700\u7684 sds \u957f\u5ea6\u8d85\u8fc7 1 MB\uff0c\u90a3\u4e48\u6700\u540e\u7684\u6269\u5bb9\u957f\u5ea6\u5e94\u8be5\u662f newlen + 1MB\u3002</li> </ul> <p>\u5728\u6269\u5bb9 SDS \u7a7a\u95f4\u4e4b\u524d\uff0cSDS API \u4f1a\u4f18\u5148\u68c0\u67e5\u672a\u4f7f\u7528\u7a7a\u95f4\u662f\u5426\u8db3\u591f\uff0c\u5982\u679c\u4e0d\u591f\u7684\u8bdd\uff0cAPI \u4e0d\u4ec5\u4f1a\u4e3a SDS \u5206\u914d\u4fee\u6539\u6240\u5fc5\u987b\u8981\u7684\u7a7a\u95f4\uff0c\u8fd8\u4f1a\u7ed9 SDS \u5206\u914d\u989d\u5916\u7684\u300c\u672a\u4f7f\u7528\u7a7a\u95f4\u300d\u3002</p> <p>\u8fd9\u6837\u7684\u597d\u5904\u662f\uff0c\u4e0b\u6b21\u5728\u64cd\u4f5c SDS \u65f6\uff0c\u5982\u679c SDS \u7a7a\u95f4\u591f\u7684\u8bdd\uff0cAPI \u5c31\u4f1a\u76f4\u63a5\u4f7f\u7528\u300c\u672a\u4f7f\u7528\u7a7a\u95f4\u300d\uff0c\u800c\u65e0\u987b\u6267\u884c\u5185\u5b58\u5206\u914d\uff0c\u6709\u6548\u7684\u51cf\u5c11\u5185\u5b58\u5206\u914d\u6b21\u6570\u3002</p> <p>\u6240\u4ee5\uff0c\u4f7f\u7528 SDS \u5373\u4e0d\u9700\u8981\u624b\u52a8\u4fee\u6539 SDS \u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u7f13\u51b2\u533a\u6ea2\u51fa\u7684\u95ee\u9898\u3002</p>"},{"location":"redis/data_struct/data_struct/#_4","title":"\u8282\u7701\u5185\u5b58\u7a7a\u95f4","text":"<p>SDS \u7ed3\u6784\u4e2d\u6709\u4e2a flags \u6210\u5458\u53d8\u91cf\uff0c\u8868\u793a\u7684\u662f SDS \u7c7b\u578b\u3002</p> <p>Redis \u4e00\u5171\u8bbe\u8ba1\u4e86 5 \u79cd\u7c7b\u578b\uff0c\u5206\u522b\u662f sdshdr5\u3001sdshdr8\u3001sdshdr16\u3001sdshdr32 \u548c sdshdr64\u3002</p> <p>\u8fd9 5 \u79cd\u7c7b\u578b\u7684\u4e3b\u8981\u533a\u522b\u5c31\u5728\u4e8e\uff0c\u5b83\u4eec\u6570\u636e\u7ed3\u6784\u4e2d\u7684 len \u548c alloc \u6210\u5458\u53d8\u91cf\u7684\u6570\u636e\u7c7b\u578b\u4e0d\u540c\u3002</p> <p>\u6bd4\u5982 sdshdr16 \u548c sdshdr32 \u8fd9\u4e24\u4e2a\u7c7b\u578b\uff0c\u5b83\u4eec\u7684\u5b9a\u4e49\u5206\u522b\u5982\u4e0b\uff1a</p> C<pre><code>struct __attribute__ ((__packed__)) sdshdr16 {\n    uint16_t len;\n    uint16_t alloc; \n    unsigned char flags; \n    char buf[];\n};\n\n\nstruct __attribute__ ((__packed__)) sdshdr32 {\n    uint32_t len;\n    uint32_t alloc; \n    unsigned char flags;\n    char buf[];\n};\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff1a</p> <ul> <li>sdshdr16 \u7c7b\u578b\u7684 len \u548c alloc \u7684\u6570\u636e\u7c7b\u578b\u90fd\u662f uint16_t\uff0c\u8868\u793a\u5b57\u7b26\u6570\u7ec4\u957f\u5ea6\u548c\u5206\u914d\u7a7a\u95f4\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 2 \u7684 16 \u6b21\u65b9\u3002</li> <li>sdshdr32 \u5219\u90fd\u662f uint32_t\uff0c\u8868\u793a\u8868\u793a\u5b57\u7b26\u6570\u7ec4\u957f\u5ea6\u548c\u5206\u914d\u7a7a\u95f4\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7 2 \u7684 32 \u6b21\u65b9\u3002</li> </ul> <p>\u4e4b\u6240\u4ee5 SDS \u8bbe\u8ba1\u4e0d\u540c\u7c7b\u578b\u7684\u7ed3\u6784\u4f53\uff0c\u662f\u4e3a\u4e86\u80fd\u7075\u6d3b\u4fdd\u5b58\u4e0d\u540c\u5927\u5c0f\u7684\u5b57\u7b26\u4e32\uff0c\u4ece\u800c\u6709\u6548\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002\u6bd4\u5982\uff0c\u5728\u4fdd\u5b58\u5c0f\u5b57\u7b26\u4e32\u65f6\uff0c\u7ed3\u6784\u5934\u5360\u7528\u7a7a\u95f4\u4e5f\u6bd4\u8f83\u5c11\u3002</p> <p>\u9664\u4e86\u8bbe\u8ba1\u4e0d\u540c\u7c7b\u578b\u7684\u7ed3\u6784\u4f53\uff0cRedis \u5728\u7f16\u7a0b\u4e0a\u8fd8\u4f7f\u7528\u4e86\u4e13\u95e8\u7684\u7f16\u8bd1\u4f18\u5316\u6765\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u5373\u5728 struct \u58f0\u660e\u4e86 <code>__attribute__ ((packed))</code> \uff0c\u5b83\u7684\u4f5c\u7528\u662f\uff1a\u544a\u8bc9\u7f16\u8bd1\u5668\u53d6\u6d88\u7ed3\u6784\u4f53\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\u7684\u4f18\u5316\u5bf9\u9f50\uff0c\u6309\u7167\u5b9e\u9645\u5360\u7528\u5b57\u8282\u6570\u8fdb\u884c\u5bf9\u9f50\u3002</p> <p>\u6bd4\u5982\uff0csdshdr16 \u7c7b\u578b\u7684 SDS\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f16\u8bd1\u5668\u4f1a\u6309\u7167 2 \u5b57\u8282\u5bf9\u9f50\u7684\u65b9\u5f0f\u7ed9\u53d8\u91cf\u5206\u914d\u5185\u5b58\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u5373\u4f7f\u4e00\u4e2a\u53d8\u91cf\u7684\u5927\u5c0f\u4e0d\u5230 2 \u4e2a\u5b57\u8282\uff0c\u7f16\u8bd1\u5668\u4e5f\u4f1a\u7ed9\u5b83\u5206\u914d 2 \u4e2a\u5b57\u8282\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e0b\u9762\u8fd9\u4e2a\u7ed3\u6784\u4f53\uff0c\u5b83\u6709\u4e24\u4e2a\u6210\u5458\u53d8\u91cf\uff0c\u7c7b\u578b\u5206\u522b\u662f char \u548c int\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> C<pre><code>#include &lt;stdio.h&gt;\n\nstruct test1 {\n    char a;\n    int b;\n } test1;\n\nint main() {\n     printf(\"%lu\\n\", sizeof(test1));\n     return 0;\n}\n</code></pre> <p>\u5927\u5bb6\u731c\u731c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u5927\u5c0f\u662f\u591a\u5c11\uff1f\u6211\u5148\u76f4\u63a5\u8bf4\u7b54\u6848\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u5927\u5c0f\u8ba1\u7b97\u51fa\u6765\u662f 8\u3002</p> <p></p> <p>\u8fd9\u662f\u56e0\u4e3a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u7f16\u8bd1\u5668\u662f\u4f7f\u7528\u300c\u5b57\u8282\u5bf9\u9f50\u300d\u7684\u65b9\u5f0f\u5206\u914d\u5185\u5b58\uff0c\u867d\u7136 char \u7c7b\u578b\u53ea\u5360\u4e00\u4e2a\u5b57\u8282\uff0c\u4f46\u662f\u7531\u4e8e\u6210\u5458\u53d8\u91cf\u91cc\u6709 int \u7c7b\u578b\uff0c\u5b83\u5360\u7528\u4e86 4 \u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u5728\u6210\u5458\u53d8\u91cf\u4e3a char \u7c7b\u578b\u5206\u914d\u5185\u5b58\u65f6\uff0c\u4f1a\u5206\u914d 4 \u4e2a\u5b57\u8282\uff0c\u5176\u4e2d\u8fd9\u591a\u4f59\u7684 3 \u4e2a\u5b57\u8282\u662f\u4e3a\u4e86\u5b57\u8282\u5bf9\u9f50\u800c\u5206\u914d\u7684\uff0c\u76f8\u5f53\u4e8e\u6709 3 \u4e2a\u5b57\u8282\u88ab\u6d6a\u8d39\u6389\u4e86\u3002</p> <p>\u5982\u679c\u4e0d\u60f3\u7f16\u8bd1\u5668\u4f7f\u7528\u5b57\u8282\u5bf9\u9f50\u7684\u65b9\u5f0f\u8fdb\u884c\u5206\u914d\u5185\u5b58\uff0c\u53ef\u4ee5\u91c7\u7528\u4e86 <code>__attribute__ ((packed))</code> \u5c5e\u6027\u5b9a\u4e49\u7ed3\u6784\u4f53\uff0c\u8fd9\u6837\u4e00\u6765\uff0c\u7ed3\u6784\u4f53\u5b9e\u9645\u5360\u7528\u591a\u5c11\u5185\u5b58\u7a7a\u95f4\uff0c\u7f16\u8bd1\u5668\u5c31\u5206\u914d\u591a\u5c11\u7a7a\u95f4\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u7528 <code>__attribute__ ((packed))</code> \u5c5e\u6027\u5b9a\u4e49\u4e0b\u9762\u7684\u7ed3\u6784\u4f53\uff0c\u540c\u6837\u5305\u542b char \u548c int \u4e24\u4e2a\u7c7b\u578b\u7684\u6210\u5458\u53d8\u91cf\uff0c\u4ee3\u7801\u5982\u4e0b\u6240\u793a\uff1a</p> C<pre><code>#include &lt;stdio.h&gt;\n\nstruct __attribute__((packed)) test2  {\n    char a;\n    int b;\n } test2;\n\nint main() {\n     printf(\"%lu\\n\", sizeof(test2));\n     return 0;\n}\n</code></pre> <p>\u8fd9\u65f6\u6253\u5370\u7684\u7ed3\u679c\u662f 5\uff081 \u4e2a\u5b57\u8282 char  + 4 \u5b57\u8282 int\uff09\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5f97\u51fa\uff0c\u8fd9\u662f\u6309\u7167\u5b9e\u9645\u5360\u7528\u5b57\u8282\u6570\u8fdb\u884c\u5206\u914d\u5185\u5b58\u7684\uff0c\u8fd9\u6837\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u7a7a\u95f4\u3002</p>"},{"location":"redis/data_struct/data_struct/#_5","title":"\u94fe\u8868","text":"<p>\u5927\u5bb6\u6700\u719f\u6089\u7684\u6570\u636e\u7ed3\u6784\u9664\u4e86\u6570\u7ec4\u4e4b\u5916\uff0c\u6211\u76f8\u4fe1\u5c31\u662f\u94fe\u8868\u4e86\u3002</p> <p>Redis \u7684 List \u5bf9\u8c61\u7684\u5e95\u5c42\u5b9e\u73b0\u4e4b\u4e00\u5c31\u662f\u94fe\u8868\u3002C \u8bed\u8a00\u672c\u8eab\u6ca1\u6709\u94fe\u8868\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u7684\uff0c\u6240\u4ee5 Redis \u81ea\u5df1\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u94fe\u8868\u6570\u636e\u7ed3\u6784\u3002</p>"},{"location":"redis/data_struct/data_struct/#_6","title":"\u94fe\u8868\u8282\u70b9\u7ed3\u6784\u8bbe\u8ba1","text":"<p>\u5148\u6765\u770b\u770b\u300c\u94fe\u8868\u8282\u70b9\u300d\u7ed3\u6784\u7684\u6837\u5b50\uff1a</p> C<pre><code>typedef struct listNode {\n    //\u524d\u7f6e\u8282\u70b9\n    struct listNode *prev;\n    //\u540e\u7f6e\u8282\u70b9\n    struct listNode *next;\n    //\u8282\u70b9\u7684\u503c\n    void *value;\n} listNode;\n</code></pre> <p>\u6709\u524d\u7f6e\u8282\u70b9\u548c\u540e\u7f6e\u8282\u70b9\uff0c\u53ef\u4ee5\u770b\u7684\u51fa\uff0c\u8fd9\u4e2a\u662f\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\u3002</p> <p></p>"},{"location":"redis/data_struct/data_struct/#_7","title":"\u94fe\u8868\u7ed3\u6784\u8bbe\u8ba1","text":"<p>\u4e0d\u8fc7\uff0cRedis \u5728 listNode \u7ed3\u6784\u4f53\u57fa\u7840\u4e0a\u53c8\u5c01\u88c5\u4e86 list \u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u8fd9\u6837\u64cd\u4f5c\u8d77\u6765\u4f1a\u66f4\u65b9\u4fbf\uff0c\u94fe\u8868\u7ed3\u6784\u5982\u4e0b\uff1a</p> C<pre><code>typedef struct list {\n    //\u94fe\u8868\u5934\u8282\u70b9\n    listNode *head;\n    //\u94fe\u8868\u5c3e\u8282\u70b9\n    listNode *tail;\n    //\u8282\u70b9\u503c\u590d\u5236\u51fd\u6570\n    void *(*dup)(void *ptr);\n    //\u8282\u70b9\u503c\u91ca\u653e\u51fd\u6570\n    void (*free)(void *ptr);\n    //\u8282\u70b9\u503c\u6bd4\u8f83\u51fd\u6570\n    int (*match)(void *ptr, void *key);\n    //\u94fe\u8868\u8282\u70b9\u6570\u91cf\n    unsigned long len;\n} list;\n</code></pre> <p>list \u7ed3\u6784\u4e3a\u94fe\u8868\u63d0\u4f9b\u4e86\u94fe\u8868\u5934\u6307\u9488 head\u3001\u94fe\u8868\u5c3e\u8282\u70b9 tail\u3001\u94fe\u8868\u8282\u70b9\u6570\u91cf len\u3001\u4ee5\u53ca\u53ef\u4ee5\u81ea\u5b9a\u4e49\u5b9e\u73b0\u7684 dup\u3001free\u3001match \u51fd\u6570\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u662f\u7531 list \u7ed3\u6784\u548c 3 \u4e2a listNode \u7ed3\u6784\u7ec4\u6210\u7684\u94fe\u8868\u3002</p> <p></p>"},{"location":"redis/data_struct/data_struct/#_8","title":"\u94fe\u8868\u7684\u4f18\u52bf\u4e0e\u7f3a\u9677","text":"<p>Redis \u7684\u94fe\u8868\u5b9e\u73b0\u4f18\u70b9\u5982\u4e0b\uff1a</p> <ul> <li>listNode \u94fe\u8868\u8282\u70b9\u7684\u7ed3\u6784\u91cc\u5e26\u6709 prev \u548c next \u6307\u9488\uff0c\u83b7\u53d6\u67d0\u4e2a\u8282\u70b9\u7684\u524d\u7f6e\u8282\u70b9\u6216\u540e\u7f6e\u8282\u70b9\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u53ea\u9700 O(1)\uff0c\u800c\u4e14\u8fd9\u4e24\u4e2a\u6307\u9488\u90fd\u53ef\u4ee5\u6307\u5411 NULL\uff0c\u6240\u4ee5\u94fe\u8868\u662f\u65e0\u73af\u94fe\u8868\uff1b</li> <li>list \u7ed3\u6784\u56e0\u4e3a\u63d0\u4f9b\u4e86\u8868\u5934\u6307\u9488 head \u548c\u8868\u5c3e\u8282\u70b9 tail\uff0c\u6240\u4ee5\u83b7\u53d6\u94fe\u8868\u7684\u8868\u5934\u8282\u70b9\u548c\u8868\u5c3e\u8282\u70b9\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u53ea\u9700 O(1)\uff1b</li> <li>list \u7ed3\u6784\u56e0\u4e3a\u63d0\u4f9b\u4e86\u94fe\u8868\u8282\u70b9\u6570\u91cf len\uff0c\u6240\u4ee5\u83b7\u53d6\u94fe\u8868\u4e2d\u7684\u8282\u70b9\u6570\u91cf\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u53ea\u9700 O(1)\uff1b</li> <li>listNode \u94fe\u8868\u8282\u4f7f\u7528 void \u6307\u9488\u4fdd\u5b58\u8282\u70b9\u503c\uff0c\u5e76\u4e14\u53ef\u4ee5\u901a\u8fc7 list \u7ed3\u6784\u7684 dup\u3001free\u3001match \u51fd\u6570\u6307\u9488\u4e3a\u8282\u70b9\u8bbe\u7f6e\u8be5\u8282\u70b9\u7c7b\u578b\u7279\u5b9a\u7684\u51fd\u6570\uff0c\u56e0\u6b64\u94fe\u8868\u8282\u70b9\u53ef\u4ee5\u4fdd\u5b58\u5404\u79cd\u4e0d\u540c\u7c7b\u578b\u7684\u503c*\uff1b</li> </ul> <p>\u94fe\u8868\u7684\u7f3a\u9677\u4e5f\u662f\u6709\u7684\uff1a</p> <ul> <li> <p>\u94fe\u8868\u6bcf\u4e2a\u8282\u70b9\u4e4b\u95f4\u7684\u5185\u5b58\u90fd\u662f\u4e0d\u8fde\u7eed\u7684\uff0c\u610f\u5473\u7740\u65e0\u6cd5\u5f88\u597d\u5229\u7528 CPU \u7f13\u5b58\u3002\u80fd\u5f88\u597d\u5229\u7528 CPU \u7f13\u5b58\u7684\u6570\u636e\u7ed3\u6784\u5c31\u662f\u6570\u7ec4\uff0c\u56e0\u4e3a\u6570\u7ec4\u7684\u5185\u5b58\u662f\u8fde\u7eed\u7684\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5145\u5206\u5229\u7528 CPU \u7f13\u5b58\u6765\u52a0\u901f\u8bbf\u95ee\u3002</p> </li> <li> <p>\u8fd8\u6709\u4e00\u70b9\uff0c\u4fdd\u5b58\u4e00\u4e2a\u94fe\u8868\u8282\u70b9\u7684\u503c\u90fd\u9700\u8981\u4e00\u4e2a\u94fe\u8868\u8282\u70b9\u7ed3\u6784\u5934\u7684\u5206\u914d\uff0c\u5185\u5b58\u5f00\u9500\u8f83\u5927\u3002</p> </li> </ul> <p>\u56e0\u6b64\uff0cRedis 3.0 \u7684 List \u5bf9\u8c61\u5728\u6570\u636e\u91cf\u6bd4\u8f83\u5c11\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u91c7\u7528\u300c\u538b\u7f29\u5217\u8868\u300d\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7684\u5b9e\u73b0\uff0c\u5b83\u7684\u4f18\u52bf\u662f\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u5e76\u4e14\u662f\u5185\u5b58\u7d27\u51d1\u578b\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u4e0d\u8fc7\uff0c\u538b\u7f29\u5217\u8868\u5b58\u5728\u6027\u80fd\u95ee\u9898\uff08\u5177\u4f53\u4ec0\u4e48\u95ee\u9898\uff0c\u4e0b\u9762\u4f1a\u8bf4\uff09\uff0c\u6240\u4ee5 Redis \u5728 3.2 \u7248\u672c\u8bbe\u8ba1\u4e86\u65b0\u7684\u6570\u636e\u7ed3\u6784 quicklist\uff0c\u5e76\u5c06 List \u5bf9\u8c61\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u6539\u7531 quicklist \u5b9e\u73b0\u3002</p> <p>\u7136\u540e\u5728  Redis 5.0 \u8bbe\u8ba1\u4e86\u65b0\u7684\u6570\u636e\u7ed3\u6784 listpack\uff0c\u6cbf\u7528\u4e86\u538b\u7f29\u5217\u8868\u7d27\u51d1\u578b\u7684\u5185\u5b58\u5e03\u5c40\uff0c\u6700\u7ec8\u5728\u6700\u65b0\u7684 Redis \u7248\u672c\uff0c\u5c06 Hash \u5bf9\u8c61\u548c Zset \u5bf9\u8c61\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u4e4b\u4e00\u7684\u538b\u7f29\u5217\u8868\uff0c\u66ff\u6362\u6210\u7531  listpack \u5b9e\u73b0\u3002</p>"},{"location":"redis/data_struct/data_struct/#_9","title":"\u538b\u7f29\u5217\u8868","text":"<p>\u538b\u7f29\u5217\u8868\u7684\u6700\u5927\u7279\u70b9\uff0c\u5c31\u662f\u5b83\u88ab\u8bbe\u8ba1\u6210\u4e00\u79cd\u5185\u5b58\u7d27\u51d1\u578b\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5360\u7528\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u5229\u7528 CPU \u7f13\u5b58\uff0c\u800c\u4e14\u4f1a\u9488\u5bf9\u4e0d\u540c\u957f\u5ea6\u7684\u6570\u636e\uff0c\u8fdb\u884c\u76f8\u5e94\u7f16\u7801\uff0c\u8fd9\u79cd\u65b9\u6cd5\u53ef\u4ee5\u6709\u6548\u5730\u8282\u7701\u5185\u5b58\u5f00\u9500\u3002</p> <p>\u4f46\u662f\uff0c\u538b\u7f29\u5217\u8868\u7684\u7f3a\u9677\u4e5f\u662f\u6709\u7684\uff1a</p> <ul> <li>\u4e0d\u80fd\u4fdd\u5b58\u8fc7\u591a\u7684\u5143\u7d20\uff0c\u5426\u5219\u67e5\u8be2\u6548\u7387\u5c31\u4f1a\u964d\u4f4e\uff1b</li> <li>\u65b0\u589e\u6216\u4fee\u6539\u67d0\u4e2a\u5143\u7d20\u65f6\uff0c\u538b\u7f29\u5217\u8868\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u9700\u8981\u91cd\u65b0\u5206\u914d\uff0c\u751a\u81f3\u53ef\u80fd\u5f15\u53d1\u8fde\u9501\u66f4\u65b0\u7684\u95ee\u9898\u3002</li> </ul> <p>\u56e0\u6b64\uff0cRedis \u5bf9\u8c61\uff08List \u5bf9\u8c61\u3001Hash \u5bf9\u8c61\u3001Zset \u5bf9\u8c61\uff09\u5305\u542b\u7684\u5143\u7d20\u6570\u91cf\u8f83\u5c11\uff0c\u6216\u8005\u5143\u7d20\u503c\u4e0d\u5927\u7684\u60c5\u51b5\u624d\u4f1a\u4f7f\u7528\u538b\u7f29\u5217\u8868\u4f5c\u4e3a\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u8ddf\u5927\u5bb6\u8be6\u7ec6\u804a\u4e0b\u538b\u7f29\u5217\u8868\u3002 </p>"},{"location":"redis/data_struct/data_struct/#_10","title":"\u538b\u7f29\u5217\u8868\u7ed3\u6784\u8bbe\u8ba1","text":"<p>\u538b\u7f29\u5217\u8868\u662f Redis \u4e3a\u4e86\u8282\u7ea6\u5185\u5b58\u800c\u5f00\u53d1\u7684\uff0c\u5b83\u662f\u7531\u8fde\u7eed\u5185\u5b58\u5757\u7ec4\u6210\u7684\u987a\u5e8f\u578b\u6570\u636e\u7ed3\u6784\uff0c\u6709\u70b9\u7c7b\u4f3c\u4e8e\u6570\u7ec4\u3002</p> <p></p> <p>\u538b\u7f29\u5217\u8868\u5728\u8868\u5934\u6709\u4e09\u4e2a\u5b57\u6bb5\uff1a</p> <ul> <li>zlbytes\uff0c\u8bb0\u5f55\u6574\u4e2a\u538b\u7f29\u5217\u8868\u5360\u7528\u7684\u5185\u5b58\u5b57\u8282\u6570\uff1b</li> <li>zltail\uff0c\u8bb0\u5f55\u538b\u7f29\u5217\u8868\u300c\u5c3e\u90e8\u300d\u8282\u70b9\u8ddd\u79bb\u8d77\u59cb\u5730\u5740\u7531\u591a\u5c11\u5b57\u8282\uff0c\u4e5f\u5c31\u662f\u5217\u8868\u5c3e\u7684\u504f\u79fb\u91cf\uff1b</li> <li>zllen\uff0c\u8bb0\u5f55\u538b\u7f29\u5217\u8868\u5305\u542b\u7684\u8282\u70b9\u6570\u91cf\uff1b</li> <li>zlend\uff0c\u6807\u8bb0\u538b\u7f29\u5217\u8868\u7684\u7ed3\u675f\u70b9\uff0c\u56fa\u5b9a\u503c 0xFF\uff08\u5341\u8fdb\u5236 255\uff09\u3002</li> </ul> <p>\u5728\u538b\u7f29\u5217\u8868\u4e2d\uff0c\u5982\u679c\u6211\u4eec\u8981\u67e5\u627e\u5b9a\u4f4d\u7b2c\u4e00\u4e2a\u5143\u7d20\u548c\u6700\u540e\u4e00\u4e2a\u5143\u7d20\uff0c\u53ef\u4ee5\u901a\u8fc7\u8868\u5934\u4e09\u4e2a\u5b57\u6bb5\uff08zllen\uff09\u7684\u957f\u5ea6\u76f4\u63a5\u5b9a\u4f4d\uff0c\u590d\u6742\u5ea6\u662f O(1)\u3002\u800c\u67e5\u627e\u5176\u4ed6\u5143\u7d20\u65f6\uff0c\u5c31\u6ca1\u6709\u8fd9\u4e48\u9ad8\u6548\u4e86\uff0c\u53ea\u80fd\u9010\u4e2a\u67e5\u627e\uff0c\u6b64\u65f6\u7684\u590d\u6742\u5ea6\u5c31\u662f O(N) \u4e86\uff0c\u56e0\u6b64\u538b\u7f29\u5217\u8868\u4e0d\u9002\u5408\u4fdd\u5b58\u8fc7\u591a\u7684\u5143\u7d20\u3002</p> <p>\u53e6\u5916\uff0c\u538b\u7f29\u5217\u8868\u8282\u70b9\uff08entry\uff09\u7684\u6784\u6210\u5982\u4e0b\uff1a</p> <p></p> <p>\u538b\u7f29\u5217\u8868\u8282\u70b9\u5305\u542b\u4e09\u90e8\u5206\u5185\u5bb9\uff1a</p> <ul> <li>prevlen\uff0c\u8bb0\u5f55\u4e86\u300c\u524d\u4e00\u4e2a\u8282\u70b9\u300d\u7684\u957f\u5ea6\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u5b9e\u73b0\u4ece\u540e\u5411\u524d\u904d\u5386\uff1b</li> <li>encoding\uff0c\u8bb0\u5f55\u4e86\u5f53\u524d\u8282\u70b9\u5b9e\u9645\u6570\u636e\u7684\u300c\u7c7b\u578b\u548c\u957f\u5ea6\u300d\uff0c\u7c7b\u578b\u4e3b\u8981\u6709\u4e24\u79cd\uff1a\u5b57\u7b26\u4e32\u548c\u6574\u6570\u3002</li> <li>data\uff0c\u8bb0\u5f55\u4e86\u5f53\u524d\u8282\u70b9\u7684\u5b9e\u9645\u6570\u636e\uff0c\u7c7b\u578b\u548c\u957f\u5ea6\u90fd\u7531 <code>encoding</code>  \u51b3\u5b9a\uff1b</li> </ul> <p>\u5f53\u6211\u4eec\u5f80\u538b\u7f29\u5217\u8868\u4e2d\u63d2\u5165\u6570\u636e\u65f6\uff0c\u538b\u7f29\u5217\u8868\u5c31\u4f1a\u6839\u636e\u6570\u636e\u7c7b\u578b\u662f\u5b57\u7b26\u4e32\u8fd8\u662f\u6574\u6570\uff0c\u4ee5\u53ca\u6570\u636e\u7684\u5927\u5c0f\uff0c\u4f1a\u4f7f\u7528\u4e0d\u540c\u7a7a\u95f4\u5927\u5c0f\u7684 prevlen \u548c encoding \u8fd9\u4e24\u4e2a\u5143\u7d20\u91cc\u4fdd\u5b58\u7684\u4fe1\u606f\uff0c\u8fd9\u79cd\u6839\u636e\u6570\u636e\u5927\u5c0f\u548c\u7c7b\u578b\u8fdb\u884c\u4e0d\u540c\u7684\u7a7a\u95f4\u5927\u5c0f\u5206\u914d\u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u6b63\u662f Redis \u4e3a\u4e86\u8282\u7701\u5185\u5b58\u800c\u91c7\u7528\u7684\u3002</p> <p>\u5206\u522b\u8bf4\u4e0b\uff0cprevlen \u548c encoding \u662f\u5982\u4f55\u6839\u636e\u6570\u636e\u7684\u5927\u5c0f\u548c\u7c7b\u578b\u6765\u8fdb\u884c\u4e0d\u540c\u7684\u7a7a\u95f4\u5927\u5c0f\u5206\u914d\u3002</p> <p>\u538b\u7f29\u5217\u8868\u91cc\u7684\u6bcf\u4e2a\u8282\u70b9\u4e2d\u7684  prevlen \u5c5e\u6027\u90fd\u8bb0\u5f55\u4e86\u300c\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u300d\uff0c\u800c\u4e14 prevlen \u5c5e\u6027\u7684\u7a7a\u95f4\u5927\u5c0f\u8ddf\u524d\u4e00\u4e2a\u8282\u70b9\u957f\u5ea6\u503c\u6709\u5173\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5982\u679c\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\uff0c\u90a3\u4e48 prevlen \u5c5e\u6027\u9700\u8981\u7528 1 \u5b57\u8282\u7684\u7a7a\u95f4\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c\uff1b</li> <li>\u5982\u679c\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e 254 \u5b57\u8282\uff0c\u90a3\u4e48 prevlen \u5c5e\u6027\u9700\u8981\u7528 5 \u5b57\u8282\u7684\u7a7a\u95f4\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c\uff1b</li> </ul> <p>encoding \u5c5e\u6027\u7684\u7a7a\u95f4\u5927\u5c0f\u8ddf\u6570\u636e\u662f\u5b57\u7b26\u4e32\u8fd8\u662f\u6574\u6570\uff0c\u4ee5\u53ca\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u6709\u5173\uff0c\u5982\u4e0b\u56fe\uff08\u4e0b\u56fe\u4e2d\u7684 content \u8868\u793a\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u5373\u672c\u6587\u7684 data \u5b57\u6bb5\uff09\uff1a</p> <p></p> <ul> <li>\u5982\u679c\u5f53\u524d\u8282\u70b9\u7684\u6570\u636e\u662f\u6574\u6570\uff0c\u5219 encoding \u4f1a\u4f7f\u7528 1 \u5b57\u8282\u7684\u7a7a\u95f4\u8fdb\u884c\u7f16\u7801\uff0c\u4e5f\u5c31\u662f encoding \u957f\u5ea6\u4e3a 1 \u5b57\u8282\u3002\u901a\u8fc7 encoding \u786e\u8ba4\u4e86\u6574\u6570\u7c7b\u578b\uff0c\u5c31\u53ef\u4ee5\u786e\u8ba4\u6574\u6570\u6570\u636e\u7684\u5b9e\u9645\u5927\u5c0f\u4e86\uff0c\u6bd4\u5982\u5982\u679c encoding \u7f16\u7801\u786e\u8ba4\u4e86\u6570\u636e\u662f int16 \u6574\u6570\uff0c\u90a3\u4e48 data \u7684\u957f\u5ea6\u5c31\u662f int16 \u7684\u5927\u5c0f\u3002</li> <li>\u5982\u679c\u5f53\u524d\u8282\u70b9\u7684\u6570\u636e\u662f\u5b57\u7b26\u4e32\uff0c\u6839\u636e\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u5927\u5c0f\uff0cencoding \u4f1a\u4f7f\u7528 1 \u5b57\u8282/2 \u5b57\u8282/5 \u5b57\u8282\u7684\u7a7a\u95f4\u8fdb\u884c\u7f16\u7801\uff0cencoding \u7f16\u7801\u7684\u524d\u4e24\u4e2a bit \u8868\u793a\u6570\u636e\u7684\u7c7b\u578b\uff0c\u540e\u7eed\u7684\u5176\u4ed6 bit \u6807\u8bc6\u5b57\u7b26\u4e32\u6570\u636e\u7684\u5b9e\u9645\u957f\u5ea6\uff0c\u5373 data \u7684\u957f\u5ea6\u3002</li> </ul>"},{"location":"redis/data_struct/data_struct/#_11","title":"\u8fde\u9501\u66f4\u65b0","text":"<p>\u538b\u7f29\u5217\u8868\u9664\u4e86\u67e5\u627e\u590d\u6742\u5ea6\u9ad8\u7684\u95ee\u9898\uff0c\u8fd8\u6709\u4e00\u4e2a\u95ee\u9898\u3002</p> <p>\u538b\u7f29\u5217\u8868\u65b0\u589e\u67d0\u4e2a\u5143\u7d20\u6216\u4fee\u6539\u67d0\u4e2a\u5143\u7d20\u65f6\uff0c\u5982\u679c\u7a7a\u95f4\u4e0d\u591f\uff0c\u538b\u7f29\u5217\u8868\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u9700\u8981\u91cd\u65b0\u5206\u914d\u3002\u800c\u5f53\u65b0\u63d2\u5165\u7684\u5143\u7d20\u8f83\u5927\u65f6\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u540e\u7eed\u5143\u7d20\u7684 prevlen \u5360\u7528\u7a7a\u95f4\u90fd\u53d1\u751f\u53d8\u5316\uff0c\u4ece\u800c\u5f15\u8d77\u300c\u8fde\u9501\u66f4\u65b0\u300d\u95ee\u9898\uff0c\u5bfc\u81f4\u6bcf\u4e2a\u5143\u7d20\u7684\u7a7a\u95f4\u90fd\u8981\u91cd\u65b0\u5206\u914d\uff0c\u9020\u6210\u8bbf\u95ee\u538b\u7f29\u5217\u8868\u6027\u80fd\u7684\u4e0b\u964d\u3002</p> <p>\u524d\u9762\u63d0\u5230\uff0c\u538b\u7f29\u5217\u8868\u8282\u70b9\u7684 prevlen \u5c5e\u6027\u4f1a\u6839\u636e\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u8fdb\u884c\u4e0d\u540c\u7684\u7a7a\u95f4\u5927\u5c0f\u5206\u914d\uff1a</p> <ul> <li>\u5982\u679c\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u5c0f\u4e8e 254 \u5b57\u8282\uff0c\u90a3\u4e48 prevlen \u5c5e\u6027\u9700\u8981\u7528 1 \u5b57\u8282\u7684\u7a7a\u95f4\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c\uff1b</li> <li>\u5982\u679c\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e 254 \u5b57\u8282\uff0c\u90a3\u4e48 prevlen \u5c5e\u6027\u9700\u8981\u7528 5 \u5b57\u8282\u7684\u7a7a\u95f4\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c\uff1b</li> </ul> <p>\u73b0\u5728\u5047\u8bbe\u4e00\u4e2a\u538b\u7f29\u5217\u8868\u4e2d\u6709\u591a\u4e2a\u8fde\u7eed\u7684\u3001\u957f\u5ea6\u5728 250\uff5e253 \u4e4b\u95f4\u7684\u8282\u70b9\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u56e0\u4e3a\u8fd9\u4e9b\u8282\u70b9\u957f\u5ea6\u503c\u5c0f\u4e8e 254 \u5b57\u8282\uff0c\u6240\u4ee5 prevlen \u5c5e\u6027\u9700\u8981\u7528 1 \u5b57\u8282\u7684\u7a7a\u95f4\u6765\u4fdd\u5b58\u8fd9\u4e2a\u957f\u5ea6\u503c\u3002</p> <p>\u8fd9\u65f6\uff0c\u5982\u679c\u5c06\u4e00\u4e2a\u957f\u5ea6\u5927\u4e8e\u7b49\u4e8e 254 \u5b57\u8282\u7684\u65b0\u8282\u70b9\u52a0\u5165\u5230\u538b\u7f29\u5217\u8868\u7684\u8868\u5934\u8282\u70b9\uff0c\u5373\u65b0\u8282\u70b9\u5c06\u6210\u4e3a e1 \u7684\u524d\u7f6e\u8282\u70b9\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u56e0\u4e3a e1 \u8282\u70b9\u7684 prevlen \u5c5e\u6027\u53ea\u6709 1 \u4e2a\u5b57\u8282\u5927\u5c0f\uff0c\u65e0\u6cd5\u4fdd\u5b58\u65b0\u8282\u70b9\u7684\u957f\u5ea6\uff0c\u6b64\u65f6\u5c31\u9700\u8981\u5bf9\u538b\u7f29\u5217\u8868\u7684\u7a7a\u95f4\u91cd\u5206\u914d\u64cd\u4f5c\uff0c\u5e76\u5c06 e1 \u8282\u70b9\u7684 prevlen \u5c5e\u6027\u4ece\u539f\u6765\u7684 1 \u5b57\u8282\u5927\u5c0f\u6269\u5c55\u4e3a 5 \u5b57\u8282\u5927\u5c0f\u3002</p> <p>\u591a\u7c73\u8bfa\u724c\u7684\u6548\u5e94\u5c31\u6b64\u5f00\u59cb\u3002</p> <p></p> <p>e1 \u539f\u672c\u7684\u957f\u5ea6\u5728 250\uff5e253 \u4e4b\u95f4\uff0c\u56e0\u4e3a\u521a\u624d\u7684\u6269\u5c55\u7a7a\u95f4\uff0c\u6b64\u65f6 e1 \u7684\u957f\u5ea6\u5c31\u5927\u4e8e\u7b49\u4e8e 254 \u4e86\uff0c\u56e0\u6b64\u539f\u672c e2 \u4fdd\u5b58 e1 \u7684 prevlen \u5c5e\u6027\u4e5f\u5fc5\u987b\u4ece 1 \u5b57\u8282\u6269\u5c55\u81f3 5 \u5b57\u8282\u5927\u5c0f\u3002</p> <p>\u6b63\u5982\u6269\u5c55 e1 \u5f15\u53d1\u4e86\u5bf9 e2 \u6269\u5c55\u4e00\u6837\uff0c\u6269\u5c55 e2 \u4e5f\u4f1a\u5f15\u53d1\u5bf9 e3 \u7684\u6269\u5c55\uff0c\u800c\u6269\u5c55 e3 \u53c8\u4f1a\u5f15\u53d1\u5bf9 e4 \u7684\u6269\u5c55\u2026\u2026 \u4e00\u76f4\u6301\u7eed\u5230\u7ed3\u5c3e\u3002</p> <p>\u8fd9\u79cd\u5728\u7279\u6b8a\u60c5\u51b5\u4e0b\u4ea7\u751f\u7684\u8fde\u7eed\u591a\u6b21\u7a7a\u95f4\u6269\u5c55\u64cd\u4f5c\u5c31\u53eb\u505a\u300c\u8fde\u9501\u66f4\u65b0\u300d\uff0c\u5c31\u50cf\u591a\u7c73\u8bfa\u724c\u7684\u6548\u5e94\u4e00\u6837\uff0c\u7b2c\u4e00\u5f20\u724c\u5012\u4e0b\u4e86\uff0c\u63a8\u52a8\u4e86\u7b2c\u4e8c\u5f20\u724c\u5012\u4e0b\uff1b\u7b2c\u4e8c\u5f20\u724c\u5012\u4e0b\uff0c\u53c8\u63a8\u52a8\u4e86\u7b2c\u4e09\u5f20\u724c\u5012\u4e0b\u2026\u2026\uff0c</p>"},{"location":"redis/data_struct/data_struct/#_12","title":"\u538b\u7f29\u5217\u8868\u7684\u7f3a\u9677","text":"<p>\u7a7a\u95f4\u6269\u5c55\u64cd\u4f5c\u4e5f\u5c31\u662f\u91cd\u65b0\u5206\u914d\u5185\u5b58\uff0c\u56e0\u6b64\u8fde\u9501\u66f4\u65b0\u4e00\u65e6\u53d1\u751f\uff0c\u5c31\u4f1a\u5bfc\u81f4\u538b\u7f29\u5217\u8868\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u8981\u591a\u6b21\u91cd\u65b0\u5206\u914d\uff0c\u8fd9\u5c31\u4f1a\u76f4\u63a5\u5f71\u54cd\u5230\u538b\u7f29\u5217\u8868\u7684\u8bbf\u95ee\u6027\u80fd\u3002</p> <p>\u6240\u4ee5\u8bf4\uff0c\u867d\u7136\u538b\u7f29\u5217\u8868\u7d27\u51d1\u578b\u7684\u5185\u5b58\u5e03\u5c40\u80fd\u8282\u7701\u5185\u5b58\u5f00\u9500\uff0c\u4f46\u662f\u5982\u679c\u4fdd\u5b58\u7684\u5143\u7d20\u6570\u91cf\u589e\u52a0\u4e86\uff0c\u6216\u662f\u5143\u7d20\u53d8\u5927\u4e86\uff0c\u4f1a\u5bfc\u81f4\u5185\u5b58\u91cd\u65b0\u5206\u914d\uff0c\u6700\u7cdf\u7cd5\u7684\u662f\u4f1a\u6709\u300c\u8fde\u9501\u66f4\u65b0\u300d\u7684\u95ee\u9898\u3002</p> <p>\u56e0\u6b64\uff0c\u538b\u7f29\u5217\u8868\u53ea\u4f1a\u7528\u4e8e\u4fdd\u5b58\u7684\u8282\u70b9\u6570\u91cf\u4e0d\u591a\u7684\u573a\u666f\uff0c\u53ea\u8981\u8282\u70b9\u6570\u91cf\u8db3\u591f\u5c0f\uff0c\u5373\u4f7f\u53d1\u751f\u8fde\u9501\u66f4\u65b0\uff0c\u4e5f\u662f\u80fd\u63a5\u53d7\u7684\u3002</p> <p>\u867d\u8bf4\u5982\u6b64\uff0cRedis \u9488\u5bf9\u538b\u7f29\u5217\u8868\u5728\u8bbe\u8ba1\u4e0a\u7684\u4e0d\u8db3\uff0c\u5728\u540e\u6765\u7684\u7248\u672c\u4e2d\uff0c\u65b0\u589e\u8bbe\u8ba1\u4e86\u4e24\u79cd\u6570\u636e\u7ed3\u6784\uff1aquicklist\uff08Redis 3.2 \u5f15\u5165\uff09\u548c listpack\uff08Redis 5.0 \u5f15\u5165\uff09\u3002\u8fd9\u4e24\u79cd\u6570\u636e\u7ed3\u6784\u7684\u8bbe\u8ba1\u76ee\u6807\uff0c\u5c31\u662f\u5c3d\u53ef\u80fd\u5730\u4fdd\u6301\u538b\u7f29\u5217\u8868\u8282\u7701\u5185\u5b58\u7684\u4f18\u52bf\uff0c\u540c\u65f6\u89e3\u51b3\u538b\u7f29\u5217\u8868\u7684\u300c\u8fde\u9501\u66f4\u65b0\u300d\u7684\u95ee\u9898\u3002</p>"},{"location":"redis/data_struct/data_struct/#_13","title":"\u54c8\u5e0c\u8868","text":"<p>\u54c8\u5e0c\u8868\u662f\u4e00\u79cd\u4fdd\u5b58\u952e\u503c\u5bf9\uff08key-value\uff09\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u54c8\u5e0c\u8868\u4e2d\u7684\u6bcf\u4e00\u4e2a key \u90fd\u662f\u72ec\u4e00\u65e0\u4e8c\u7684\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u6839\u636e key \u67e5\u627e\u5230\u4e0e\u4e4b\u5173\u8054\u7684 value\uff0c\u6216\u8005\u901a\u8fc7 key \u6765\u66f4\u65b0 value\uff0c\u53c8\u6216\u8005\u6839\u636e key \u6765\u5220\u9664\u6574\u4e2a key-value \u7b49\u7b49\u3002</p> <p>\u5728\u8bb2\u538b\u7f29\u5217\u8868\u7684\u65f6\u5019\uff0c\u63d0\u5230\u8fc7 Redis \u7684 Hash \u5bf9\u8c61\u7684\u5e95\u5c42\u5b9e\u73b0\u4e4b\u4e00\u662f\u538b\u7f29\u5217\u8868\uff08\u6700\u65b0 Redis \u4ee3\u7801\u5df2\u5c06\u538b\u7f29\u5217\u8868\u66ff\u6362\u6210 listpack\uff09\u3002Hash \u5bf9\u8c61\u7684\u53e6\u5916\u4e00\u4e2a\u5e95\u5c42\u5b9e\u73b0\u5c31\u662f\u54c8\u5e0c\u8868\u3002</p> <p>\u54c8\u5e0c\u8868\u4f18\u70b9\u5728\u4e8e\uff0c\u5b83\u80fd\u4ee5 O(1) \u7684\u590d\u6742\u5ea6\u5feb\u901f\u67e5\u8be2\u6570\u636e\u3002\u600e\u4e48\u505a\u5230\u7684\u5462\uff1f\u5c06 key \u901a\u8fc7 Hash \u51fd\u6570\u7684\u8ba1\u7b97\uff0c\u5c31\u80fd\u5b9a\u4f4d\u6570\u636e\u5728\u8868\u4e2d\u7684\u4f4d\u7f6e\uff0c\u56e0\u4e3a\u54c8\u5e0c\u8868\u5b9e\u9645\u4e0a\u662f\u6570\u7ec4\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7\u7d22\u5f15\u503c\u5feb\u901f\u67e5\u8be2\u5230\u6570\u636e\u3002</p> <p>\u4f46\u662f\u5b58\u5728\u7684\u98ce\u9669\u4e5f\u662f\u6709\uff0c\u5728\u54c8\u5e0c\u8868\u5927\u5c0f\u56fa\u5b9a\u7684\u60c5\u51b5\u4e0b\uff0c\u968f\u7740\u6570\u636e\u4e0d\u65ad\u589e\u591a\uff0c\u90a3\u4e48\u54c8\u5e0c\u51b2\u7a81\u7684\u53ef\u80fd\u6027\u4e5f\u4f1a\u8d8a\u9ad8\u3002</p> <p>\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7684\u65b9\u5f0f\uff0c\u6709\u5f88\u591a\u79cd\u3002</p> <p>Redis \u91c7\u7528\u4e86\u300c\u94fe\u5f0f\u54c8\u5e0c\u300d\u6765\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\uff0c\u5728\u4e0d\u6269\u5bb9\u54c8\u5e0c\u8868\u7684\u524d\u63d0\u4e0b\uff0c\u5c06\u5177\u6709\u76f8\u540c\u54c8\u5e0c\u503c\u7684\u6570\u636e\u4e32\u8d77\u6765\uff0c\u5f62\u6210\u94fe\u8868\uff0c\u4ee5\u4fbf\u8fd9\u4e9b\u6570\u636e\u5728\u8868\u4e2d\u4ecd\u7136\u53ef\u4ee5\u88ab\u67e5\u8be2\u5230\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8be6\u7ec6\u8bf4\u8bf4\u54c8\u5e0c\u8868\u3002</p>"},{"location":"redis/data_struct/data_struct/#_14","title":"\u54c8\u5e0c\u8868\u7ed3\u6784\u8bbe\u8ba1","text":"<p>Redis \u7684\u54c8\u5e0c\u8868\u7ed3\u6784\u5982\u4e0b\uff1a</p> C<pre><code>typedef struct dictht {\n    //\u54c8\u5e0c\u8868\u6570\u7ec4\n    dictEntry **table;\n    //\u54c8\u5e0c\u8868\u5927\u5c0f\n    unsigned long size;  \n    //\u54c8\u5e0c\u8868\u5927\u5c0f\u63a9\u7801\uff0c\u7528\u4e8e\u8ba1\u7b97\u7d22\u5f15\u503c\n    unsigned long sizemask;\n    //\u8be5\u54c8\u5e0c\u8868\u5df2\u6709\u7684\u8282\u70b9\u6570\u91cf\n    unsigned long used;\n} dictht;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u54c8\u5e0c\u8868\u662f\u4e00\u4e2a\u6570\u7ec4\uff08dictEntry **table\uff09\uff0c\u6570\u7ec4\u7684\u6bcf\u4e2a\u5143\u7d20\u662f\u4e00\u4e2a\u6307\u5411\u300c\u54c8\u5e0c\u8868\u8282\u70b9\uff08dictEntry\uff09\u300d\u7684\u6307\u9488\u3002</p> <p></p> <p>\u54c8\u5e0c\u8868\u8282\u70b9\u7684\u7ed3\u6784\u5982\u4e0b\uff1a</p> C<pre><code>typedef struct dictEntry {\n    //\u952e\u503c\u5bf9\u4e2d\u7684\u952e\n    void *key;\n\n    //\u952e\u503c\u5bf9\u4e2d\u7684\u503c\n    union {\n        void *val;\n        uint64_t u64;\n        int64_t s64;\n        double d;\n    } v;\n    //\u6307\u5411\u4e0b\u4e00\u4e2a\u54c8\u5e0c\u8868\u8282\u70b9\uff0c\u5f62\u6210\u94fe\u8868\n    struct dictEntry *next;\n} dictEntry;\n</code></pre> <p>dictEntry \u7ed3\u6784\u91cc\u4e0d\u4ec5\u5305\u542b\u6307\u5411\u952e\u548c\u503c\u7684\u6307\u9488\uff0c\u8fd8\u5305\u542b\u4e86\u6307\u5411\u4e0b\u4e00\u4e2a\u54c8\u5e0c\u8868\u8282\u70b9\u7684\u6307\u9488\uff0c\u8fd9\u4e2a\u6307\u9488\u53ef\u4ee5\u5c06\u591a\u4e2a\u54c8\u5e0c\u503c\u76f8\u540c\u7684\u952e\u503c\u5bf9\u94fe\u63a5\u8d77\u6765\uff0c\u4ee5\u6b64\u6765\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u7684\u95ee\u9898\uff0c\u8fd9\u5c31\u662f\u94fe\u5f0f\u54c8\u5e0c\u3002</p> <p>\u53e6\u5916\uff0c\u8fd9\u91cc\u8fd8\u8ddf\u4f60\u63d0\u4e00\u4e0b\uff0cdictEntry \u7ed3\u6784\u91cc\u952e\u503c\u5bf9\u4e2d\u7684\u503c\u662f\u4e00\u4e2a\u300c\u8054\u5408\u4f53 v\u300d\u5b9a\u4e49\u7684\uff0c\u56e0\u6b64\uff0c\u952e\u503c\u5bf9\u4e2d\u7684\u503c\u53ef\u4ee5\u662f\u4e00\u4e2a\u6307\u5411\u5b9e\u9645\u503c\u7684\u6307\u9488\uff0c\u6216\u8005\u662f\u4e00\u4e2a\u65e0\u7b26\u53f7\u7684 64 \u4f4d\u6574\u6570\u6216\u6709\u7b26\u53f7\u7684 64 \u4f4d\u6574\u6570\u6216 double \u7c7b\u7684\u503c\u3002\u8fd9\u4e48\u505a\u7684\u597d\u5904\u662f\u53ef\u4ee5\u8282\u7701\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u4e3a\u5f53\u300c\u503c\u300d\u662f\u6574\u6570\u6216\u6d6e\u70b9\u6570\u65f6\uff0c\u5c31\u53ef\u4ee5\u5c06\u503c\u7684\u6570\u636e\u5185\u5d4c\u5728 dictEntry \u7ed3\u6784\u91cc\uff0c\u65e0\u9700\u518d\u7528\u4e00\u4e2a\u6307\u9488\u6307\u5411\u5b9e\u9645\u7684\u503c\uff0c\u4ece\u800c\u8282\u7701\u4e86\u5185\u5b58\u7a7a\u95f4\u3002</p>"},{"location":"redis/data_struct/data_struct/#_15","title":"\u54c8\u5e0c\u51b2\u7a81","text":"<p>\u54c8\u5e0c\u8868\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6570\u7ec4\uff0c\u6570\u7ec4\u91cc\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u5c31\u662f\u4e00\u4e2a\u54c8\u5e0c\u6876\u3002</p> <p>\u5f53\u4e00\u4e2a\u952e\u503c\u5bf9\u7684\u952e\u7ecf\u8fc7 Hash \u51fd\u6570\u8ba1\u7b97\u540e\u5f97\u5230\u54c8\u5e0c\u503c\uff0c\u518d\u5c06 (\u54c8\u5e0c\u503c % \u54c8\u5e0c\u8868\u5927\u5c0f) \u53d6\u6a21\u8ba1\u7b97\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u503c\u5c31\u662f\u8be5 key-value \u5bf9\u5e94\u7684\u6570\u7ec4\u5143\u7d20\u4f4d\u7f6e\uff0c\u4e5f\u5c31\u662f\u7b2c\u51e0\u4e2a\u54c8\u5e0c\u6876\u3002</p> <p>\u4ec0\u4e48\u662f\u54c8\u5e0c\u51b2\u7a81\u5462\uff1f</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6709\u4e00\u4e2a\u53ef\u4ee5\u5b58\u653e 8 \u4e2a\u54c8\u5e0c\u6876\u7684\u54c8\u5e0c\u8868\u3002key1 \u7ecf\u8fc7\u54c8\u5e0c\u51fd\u6570\u8ba1\u7b97\u540e\uff0c\u518d\u5c06\u300c\u54c8\u5e0c\u503c % 8\u300d\u8fdb\u884c\u53d6\u6a21\u8ba1\u7b97\uff0c\u7ed3\u679c\u503c\u4e3a 1\uff0c\u90a3\u4e48\u5c31\u5bf9\u5e94\u54c8\u5e0c\u6876 1\uff0c\u7c7b\u4f3c\u7684\uff0ckey9 \u548c key10 \u5206\u522b\u5bf9\u5e94\u54c8\u5e0c\u6876 1 \u548c\u6876 6\u3002</p> <p></p> <p>\u6b64\u65f6\uff0ckey1 \u548c key9 \u5bf9\u5e94\u5230\u4e86\u76f8\u540c\u7684\u54c8\u5e0c\u6876\u4e2d\uff0c\u8fd9\u5c31\u53d1\u751f\u4e86\u54c8\u5e0c\u51b2\u7a81\u3002</p> <p>\u56e0\u6b64\uff0c\u5f53\u6709\u4e24\u4e2a\u4ee5\u4e0a\u6570\u91cf\u7684 kay \u88ab\u5206\u914d\u5230\u4e86\u54c8\u5e0c\u8868\u4e2d\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e0a\u65f6\uff0c\u6b64\u65f6\u79f0\u8fd9\u4e9b key \u53d1\u751f\u4e86\u51b2\u7a81\u3002</p>"},{"location":"redis/data_struct/data_struct/#_16","title":"\u94fe\u5f0f\u54c8\u5e0c","text":"<p>Redis \u91c7\u7528\u4e86\u300c\u94fe\u5f0f\u54c8\u5e0c\u300d\u7684\u65b9\u6cd5\u6765\u89e3\u51b3\u54c8\u5e0c\u51b2\u7a81\u3002</p> <p>\u94fe\u5f0f\u54c8\u5e0c\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f</p> <p>\u5b9e\u73b0\u7684\u65b9\u5f0f\u5c31\u662f\u6bcf\u4e2a\u54c8\u5e0c\u8868\u8282\u70b9\u90fd\u6709\u4e00\u4e2a next \u6307\u9488\uff0c\u7528\u4e8e\u6307\u5411\u4e0b\u4e00\u4e2a\u54c8\u5e0c\u8868\u8282\u70b9\uff0c\u56e0\u6b64\u591a\u4e2a\u54c8\u5e0c\u8868\u8282\u70b9\u53ef\u4ee5\u7528 next \u6307\u9488\u6784\u6210\u4e00\u4e2a\u5355\u9879\u94fe\u8868\uff0c\u88ab\u5206\u914d\u5230\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\u4e0a\u7684\u591a\u4e2a\u8282\u70b9\u53ef\u4ee5\u7528\u8fd9\u4e2a\u5355\u9879\u94fe\u8868\u8fde\u63a5\u8d77\u6765\uff0c\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u54c8\u5e0c\u51b2\u7a81\u3002</p> <p>\u8fd8\u662f\u7528\u524d\u9762\u7684\u54c8\u5e0c\u51b2\u7a81\u4f8b\u5b50\uff0ckey1 \u548c key9 \u7ecf\u8fc7\u54c8\u5e0c\u8ba1\u7b97\u540e\uff0c\u90fd\u843d\u5728\u540c\u4e00\u4e2a\u54c8\u5e0c\u6876\uff0c\u94fe\u5f0f\u54c8\u5e0c\u7684\u8bdd\uff0ckey1 \u5c31\u4f1a\u901a\u8fc7 next \u6307\u9488\u6307\u5411 key9\uff0c\u5f62\u6210\u4e00\u4e2a\u5355\u5411\u94fe\u8868\u3002</p> <p></p> <p>\u4e0d\u8fc7\uff0c\u94fe\u5f0f\u54c8\u5e0c\u5c40\u9650\u6027\u4e5f\u5f88\u660e\u663e\uff0c\u968f\u7740\u94fe\u8868\u957f\u5ea6\u7684\u589e\u52a0\uff0c\u5728\u67e5\u8be2\u8fd9\u4e00\u4f4d\u7f6e\u4e0a\u7684\u6570\u636e\u7684\u8017\u65f6\u5c31\u4f1a\u589e\u52a0\uff0c\u6bd5\u7adf\u94fe\u8868\u7684\u67e5\u8be2\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(n)\u3002</p> <p>\u8981\u60f3\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u5c31\u9700\u8981\u8fdb\u884c rehash\uff0c\u4e5f\u5c31\u662f\u5bf9\u54c8\u5e0c\u8868\u7684\u5927\u5c0f\u8fdb\u884c\u6269\u5c55\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u770b\u770b Redis \u662f\u5982\u4f55\u5b9e\u73b0\u7684 rehash \u7684\u3002</p>"},{"location":"redis/data_struct/data_struct/#rehash","title":"rehash","text":"<p>\u54c8\u5e0c\u8868\u7ed3\u6784\u8bbe\u8ba1\u7684\u8fd9\u4e00\u5c0f\u8282\uff0c\u6211\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e86 Redis \u4f7f\u7528 dictht \u7ed3\u6784\u4f53\u8868\u793a\u54c8\u5e0c\u8868\u3002\u4e0d\u8fc7\uff0c\u5728\u5b9e\u9645\u4f7f\u7528\u54c8\u5e0c\u8868\u65f6\uff0cRedis \u5b9a\u4e49\u4e00\u4e2a dict \u7ed3\u6784\u4f53\uff0c\u8fd9\u4e2a\u7ed3\u6784\u4f53\u91cc\u5b9a\u4e49\u4e86\u4e24\u4e2a\u54c8\u5e0c\u8868\uff08ht[2]\uff09\u3002</p> C<pre><code>typedef struct dict {\n    \u2026\n    //\u4e24\u4e2a Hash \u8868\uff0c\u4ea4\u66ff\u4f7f\u7528\uff0c\u7528\u4e8e rehash \u64cd\u4f5c\n    dictht ht[2]; \n    \u2026\n} dict;\n</code></pre> <p>\u4e4b\u6240\u4ee5\u5b9a\u4e49\u4e86 2 \u4e2a\u54c8\u5e0c\u8868\uff0c\u662f\u56e0\u4e3a\u8fdb\u884c rehash \u7684\u65f6\u5019\uff0c\u9700\u8981\u7528\u4e0a 2 \u4e2a\u54c8\u5e0c\u8868\u4e86\u3002</p> <p></p> <p>\u5728\u6b63\u5e38\u670d\u52a1\u8bf7\u6c42\u9636\u6bb5\uff0c\u63d2\u5165\u7684\u6570\u636e\uff0c\u90fd\u4f1a\u5199\u5165\u5230\u300c\u54c8\u5e0c\u8868 1\u300d\uff0c\u6b64\u65f6\u7684\u300c\u54c8\u5e0c\u8868 2\u300d\u5e76\u6ca1\u6709\u88ab\u5206\u914d\u7a7a\u95f4\u3002</p> <p>\u968f\u7740\u6570\u636e\u9010\u6b65\u589e\u591a\uff0c\u89e6\u53d1\u4e86 rehash \u64cd\u4f5c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5206\u4e3a\u4e09\u6b65\uff1a</p> <ul> <li>\u7ed9\u300c\u54c8\u5e0c\u8868 2\u300d\u5206\u914d\u7a7a\u95f4\uff0c\u4e00\u822c\u4f1a\u6bd4\u300c\u54c8\u5e0c\u8868 1\u300d\u5927 2 \u500d\uff1b</li> <li>\u5c06\u300c\u54c8\u5e0c\u8868 1\u300d\u7684\u6570\u636e\u8fc1\u79fb\u5230\u300c\u54c8\u5e0c\u8868 2\u300d\u4e2d\uff1b</li> <li>\u8fc1\u79fb\u5b8c\u6210\u540e\uff0c\u300c\u54c8\u5e0c\u8868 1\u300d\u7684\u7a7a\u95f4\u4f1a\u88ab\u91ca\u653e\uff0c\u5e76\u628a\u300c\u54c8\u5e0c\u8868 2\u300d\u8bbe\u7f6e\u4e3a\u300c\u54c8\u5e0c\u8868 1\u300d\uff0c\u7136\u540e\u5728\u300c\u54c8\u5e0c\u8868 2\u300d\u65b0\u521b\u5efa\u4e00\u4e2a\u7a7a\u767d\u7684\u54c8\u5e0c\u8868\uff0c\u4e3a\u4e0b\u6b21 rehash \u505a\u51c6\u5907\u3002</li> </ul> <p>\u4e3a\u4e86\u65b9\u4fbf\u4f60\u7406\u89e3\uff0c\u6211\u628a rehash \u8fd9\u4e09\u4e2a\u8fc7\u7a0b\u753b\u5728\u4e86\u4e0b\u9762\u8fd9\u5f20\u56fe\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u770b\u8d77\u6765\u7b80\u5355\uff0c\u4f46\u662f\u5176\u5b9e\u7b2c\u4e8c\u6b65\u5f88\u6709\u95ee\u9898\uff0c\u5982\u679c\u300c\u54c8\u5e0c\u8868 1\u300d\u7684\u6570\u636e\u91cf\u975e\u5e38\u5927\uff0c\u90a3\u4e48\u5728\u8fc1\u79fb\u81f3\u300c\u54c8\u5e0c\u8868 2\u300d\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u4f1a\u6d89\u53ca\u5927\u91cf\u7684\u6570\u636e\u62f7\u8d1d\uff0c\u6b64\u65f6\u53ef\u80fd\u4f1a\u5bf9 Redis \u9020\u6210\u963b\u585e\uff0c\u65e0\u6cd5\u670d\u52a1\u5176\u4ed6\u8bf7\u6c42\u3002</p>"},{"location":"redis/data_struct/data_struct/#rehash_1","title":"\u6e10\u8fdb\u5f0f rehash","text":"<p>\u4e3a\u4e86\u907f\u514d rehash \u5728\u6570\u636e\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\uff0c\u56e0\u62f7\u8d1d\u6570\u636e\u7684\u8017\u65f6\uff0c\u5f71\u54cd Redis \u6027\u80fd\u7684\u60c5\u51b5\uff0c\u6240\u4ee5 Redis \u91c7\u7528\u4e86\u6e10\u8fdb\u5f0f rehash\uff0c\u4e5f\u5c31\u662f\u5c06\u6570\u636e\u7684\u8fc1\u79fb\u7684\u5de5\u4f5c\u4e0d\u518d\u662f\u4e00\u6b21\u6027\u8fc1\u79fb\u5b8c\u6210\uff0c\u800c\u662f\u5206\u591a\u6b21\u8fc1\u79fb\u3002</p> <p>\u6e10\u8fdb\u5f0f rehash \u6b65\u9aa4\u5982\u4e0b\uff1a</p> <ul> <li>\u7ed9\u300c\u54c8\u5e0c\u8868 2\u300d\u5206\u914d\u7a7a\u95f4\uff1b</li> <li>\u5728 rehash \u8fdb\u884c\u671f\u95f4\uff0c\u6bcf\u6b21\u54c8\u5e0c\u8868\u5143\u7d20\u8fdb\u884c\u65b0\u589e\u3001\u5220\u9664\u3001\u67e5\u627e\u6216\u8005\u66f4\u65b0\u64cd\u4f5c\u65f6\uff0cRedis \u9664\u4e86\u4f1a\u6267\u884c\u5bf9\u5e94\u7684\u64cd\u4f5c\u4e4b\u5916\uff0c\u8fd8\u4f1a\u987a\u5e8f\u5c06\u300c\u54c8\u5e0c\u8868 1\u300d\u4e2d\u7d22\u5f15\u4f4d\u7f6e\u4e0a\u7684\u6240\u6709 key-value \u8fc1\u79fb\u5230\u300c\u54c8\u5e0c\u8868 2\u300d\u4e0a\uff1b</li> <li>\u968f\u7740\u5904\u7406\u5ba2\u6237\u7aef\u53d1\u8d77\u7684\u54c8\u5e0c\u8868\u64cd\u4f5c\u8bf7\u6c42\u6570\u91cf\u8d8a\u591a\uff0c\u6700\u7ec8\u5728\u67d0\u4e2a\u65f6\u95f4\u70b9\u4f1a\u628a\u300c\u54c8\u5e0c\u8868 1\u300d\u7684\u6240\u6709 key-value \u8fc1\u79fb\u5230\u300c\u54c8\u5e0c\u8868 2\u300d\uff0c\u4ece\u800c\u5b8c\u6210 rehash \u64cd\u4f5c\u3002</li> </ul> <p>\u8fd9\u6837\u5c31\u5de7\u5999\u5730\u628a\u4e00\u6b21\u6027\u5927\u91cf\u6570\u636e\u8fc1\u79fb\u5de5\u4f5c\u7684\u5f00\u9500\uff0c\u5206\u644a\u5230\u4e86\u591a\u6b21\u5904\u7406\u8bf7\u6c42\u7684\u8fc7\u7a0b\u4e2d\uff0c\u907f\u514d\u4e86\u4e00\u6b21\u6027 rehash \u7684\u8017\u65f6\u64cd\u4f5c\u3002</p> <p>\u5728\u8fdb\u884c\u6e10\u8fdb\u5f0f rehash \u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u6709\u4e24\u4e2a\u54c8\u5e0c\u8868\uff0c\u6240\u4ee5\u5728\u6e10\u8fdb\u5f0f rehash \u8fdb\u884c\u671f\u95f4\uff0c\u54c8\u5e0c\u8868\u5143\u7d20\u7684\u5220\u9664\u3001\u67e5\u627e\u3001\u66f4\u65b0\u7b49\u64cd\u4f5c\u90fd\u4f1a\u5728\u8fd9\u4e24\u4e2a\u54c8\u5e0c\u8868\u8fdb\u884c\u3002</p> <p>\u6bd4\u5982\uff0c\u67e5\u627e\u4e00\u4e2a key \u7684\u503c\u7684\u8bdd\uff0c\u5148\u4f1a\u5728\u300c\u54c8\u5e0c\u8868 1\u300d\u91cc\u9762\u8fdb\u884c\u67e5\u627e\uff0c\u5982\u679c\u6ca1\u627e\u5230\uff0c\u5c31\u4f1a\u7ee7\u7eed\u5230\u54c8\u5e0c\u8868 2 \u91cc\u9762\u8fdb\u884c\u627e\u5230\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u6e10\u8fdb\u5f0f rehash \u8fdb\u884c\u671f\u95f4\uff0c\u65b0\u589e\u4e00\u4e2a key-value \u65f6\uff0c\u4f1a\u88ab\u4fdd\u5b58\u5230\u300c\u54c8\u5e0c\u8868 2\u300d\u91cc\u9762\uff0c\u800c\u300c\u54c8\u5e0c\u8868 1\u300d\u5219\u4e0d\u518d\u8fdb\u884c\u4efb\u4f55\u6dfb\u52a0\u64cd\u4f5c\uff0c\u8fd9\u6837\u4fdd\u8bc1\u4e86\u300c\u54c8\u5e0c\u8868 1\u300d\u7684 key-value \u6570\u91cf\u53ea\u4f1a\u51cf\u5c11\uff0c\u968f\u7740 rehash \u64cd\u4f5c\u7684\u5b8c\u6210\uff0c\u6700\u7ec8\u300c\u54c8\u5e0c\u8868 1\u300d\u5c31\u4f1a\u53d8\u6210\u7a7a\u8868\u3002</p>"},{"location":"redis/data_struct/data_struct/#rehash_2","title":"rehash \u89e6\u53d1\u6761\u4ef6","text":"<p>\u4ecb\u7ecd\u4e86 rehash \u90a3\u4e48\u591a\uff0c\u8fd8\u6ca1\u8bf4\u4ec0\u4e48\u65f6\u60c5\u51b5\u4e0b\u4f1a\u89e6\u53d1 rehash \u64cd\u4f5c\u5462\uff1f</p> <p>rehash \u7684\u89e6\u53d1\u6761\u4ef6\u8ddf\u8d1f\u8f7d\u56e0\u5b50\uff08load factor\uff09\u6709\u5173\u7cfb\u3002</p> <p>\u8d1f\u8f7d\u56e0\u5b50\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e2a\u516c\u5f0f\u8ba1\u7b97\uff1a</p> <p></p> <p>\u89e6\u53d1 rehash \u64cd\u4f5c\u7684\u6761\u4ef6\uff0c\u4e3b\u8981\u6709\u4e24\u4e2a\uff1a</p> <ul> <li>\u5f53\u8d1f\u8f7d\u56e0\u5b50\u5927\u4e8e\u7b49\u4e8e 1\uff0c\u5e76\u4e14 Redis \u6ca1\u6709\u5728\u6267\u884c bgsave \u547d\u4ee4\u6216\u8005 bgrewiteaof \u547d\u4ee4\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u6267\u884c RDB \u5feb\u7167\u6216\u6ca1\u6709\u8fdb\u884c AOF \u91cd\u5199\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8fdb\u884c rehash \u64cd\u4f5c\u3002</li> <li>\u5f53\u8d1f\u8f7d\u56e0\u5b50\u5927\u4e8e\u7b49\u4e8e 5 \u65f6\uff0c\u6b64\u65f6\u8bf4\u660e\u54c8\u5e0c\u51b2\u7a81\u975e\u5e38\u4e25\u91cd\u4e86\uff0c\u4e0d\u7ba1\u6709\u6ca1\u6709\u6709\u5728\u6267\u884c RDB \u5feb\u7167\u6216 AOF \u91cd\u5199\uff0c\u90fd\u4f1a\u5f3a\u5236\u8fdb\u884c rehash \u64cd\u4f5c\u3002</li> </ul>"},{"location":"redis/data_struct/data_struct/#_17","title":"\u6574\u6570\u96c6\u5408","text":"<p>\u6574\u6570\u96c6\u5408\u662f  Set \u5bf9\u8c61\u7684\u5e95\u5c42\u5b9e\u73b0\u4e4b\u4e00\u3002\u5f53\u4e00\u4e2a Set \u5bf9\u8c61\u53ea\u5305\u542b\u6574\u6570\u503c\u5143\u7d20\uff0c\u5e76\u4e14\u5143\u7d20\u6570\u91cf\u4e0d\u5927\u65f6\uff0c\u5c31\u4f1a\u4f7f\u7528\u6574\u6570\u96c6\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u4f5c\u4e3a\u5e95\u5c42\u5b9e\u73b0\u3002</p>"},{"location":"redis/data_struct/data_struct/#_18","title":"\u6574\u6570\u96c6\u5408\u7ed3\u6784\u8bbe\u8ba1","text":"<p>\u6574\u6570\u96c6\u5408\u672c\u8d28\u4e0a\u662f\u4e00\u5757\u8fde\u7eed\u5185\u5b58\u7a7a\u95f4\uff0c\u5b83\u7684\u7ed3\u6784\u5b9a\u4e49\u5982\u4e0b\uff1a</p> C<pre><code>typedef struct intset {\n    //\u7f16\u7801\u65b9\u5f0f\n    uint32_t encoding;\n    //\u96c6\u5408\u5305\u542b\u7684\u5143\u7d20\u6570\u91cf\n    uint32_t length;\n    //\u4fdd\u5b58\u5143\u7d20\u7684\u6570\u7ec4\n    int8_t contents[];\n} intset;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4fdd\u5b58\u5143\u7d20\u7684\u5bb9\u5668\u662f\u4e00\u4e2a contents \u6570\u7ec4\uff0c\u867d\u7136 contents \u88ab\u58f0\u660e\u4e3a int8_t \u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a contents \u6570\u7ec4\u5e76\u4e0d\u4fdd\u5b58\u4efb\u4f55 int8_t \u7c7b\u578b\u7684\u5143\u7d20\uff0ccontents \u6570\u7ec4\u7684\u771f\u6b63\u7c7b\u578b\u53d6\u51b3\u4e8e intset \u7ed3\u6784\u4f53\u91cc\u7684 encoding \u5c5e\u6027\u7684\u503c\u3002\u6bd4\u5982\uff1a</p> <ul> <li>\u5982\u679c encoding \u5c5e\u6027\u503c\u4e3a INTSET_ENC_INT16\uff0c\u90a3\u4e48 contents \u5c31\u662f\u4e00\u4e2a int16_t \u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u7684\u7c7b\u578b\u90fd\u662f int16_t\uff1b</li> <li>\u5982\u679c encoding \u5c5e\u6027\u503c\u4e3a INTSET_ENC_INT32\uff0c\u90a3\u4e48 contents \u5c31\u662f\u4e00\u4e2a int32_t \u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u7684\u7c7b\u578b\u90fd\u662f int32_t\uff1b</li> <li>\u5982\u679c encoding \u5c5e\u6027\u503c\u4e3a INTSET_ENC_INT64\uff0c\u90a3\u4e48 contents \u5c31\u662f\u4e00\u4e2a int64_t \u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u6570\u7ec4\u4e2d\u6bcf\u4e00\u4e2a\u5143\u7d20\u7684\u7c7b\u578b\u90fd\u662f int64_t\uff1b</li> </ul> <p>\u4e0d\u540c\u7c7b\u578b\u7684 contents \u6570\u7ec4\uff0c\u610f\u5473\u7740\u6570\u7ec4\u7684\u5927\u5c0f\u4e5f\u4f1a\u4e0d\u540c\u3002</p>"},{"location":"redis/data_struct/data_struct/#_19","title":"\u6574\u6570\u96c6\u5408\u7684\u5347\u7ea7\u64cd\u4f5c","text":"<p>\u6574\u6570\u96c6\u5408\u4f1a\u6709\u4e00\u4e2a\u5347\u7ea7\u89c4\u5219\uff0c\u5c31\u662f\u5f53\u6211\u4eec\u5c06\u4e00\u4e2a\u65b0\u5143\u7d20\u52a0\u5165\u5230\u6574\u6570\u96c6\u5408\u91cc\u9762\uff0c\u5982\u679c\u65b0\u5143\u7d20\u7684\u7c7b\u578b\uff08int32_t\uff09\u6bd4\u6574\u6570\u96c6\u5408\u73b0\u6709\u6240\u6709\u5143\u7d20\u7684\u7c7b\u578b\uff08int16_t\uff09\u90fd\u8981\u957f\u65f6\uff0c\u6574\u6570\u96c6\u5408\u9700\u8981\u5148\u8fdb\u884c\u5347\u7ea7\uff0c\u4e5f\u5c31\u662f\u6309\u65b0\u5143\u7d20\u7684\u7c7b\u578b\uff08int32_t\uff09\u6269\u5c55 contents \u6570\u7ec4\u7684\u7a7a\u95f4\u5927\u5c0f\uff0c\u7136\u540e\u624d\u80fd\u5c06\u65b0\u5143\u7d20\u52a0\u5165\u5230\u6574\u6570\u96c6\u5408\u91cc\uff0c\u5f53\u7136\u5347\u7ea7\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u8981\u7ef4\u6301\u6574\u6570\u96c6\u5408\u7684\u6709\u5e8f\u6027\u3002</p> <p>\u6574\u6570\u96c6\u5408\u5347\u7ea7\u7684\u8fc7\u7a0b\u4e0d\u4f1a\u91cd\u65b0\u5206\u914d\u4e00\u4e2a\u65b0\u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u800c\u662f\u5728\u539f\u672c\u7684\u6570\u7ec4\u4e0a\u6269\u5c55\u7a7a\u95f4\uff0c\u7136\u540e\u5728\u5c06\u6bcf\u4e2a\u5143\u7d20\u6309\u95f4\u9694\u7c7b\u578b\u5927\u5c0f\u5206\u5272\uff0c\u5982\u679c encoding \u5c5e\u6027\u503c\u4e3a INTSET_ENC_INT16\uff0c\u5219\u6bcf\u4e2a\u5143\u7d20\u7684\u95f4\u9694\u5c31\u662f 16 \u4f4d\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u6709\u4e00\u4e2a\u6574\u6570\u96c6\u5408\u91cc\u6709 3 \u4e2a\u7c7b\u578b\u4e3a int16_t \u7684\u5143\u7d20\u3002</p> <p></p> <p>\u73b0\u5728\uff0c\u5f80\u8fd9\u4e2a\u6574\u6570\u96c6\u5408\u4e2d\u52a0\u5165\u4e00\u4e2a\u65b0\u5143\u7d20 65535\uff0c\u8fd9\u4e2a\u65b0\u5143\u7d20\u9700\u8981\u7528 int32_t \u7c7b\u578b\u6765\u4fdd\u5b58\uff0c\u6240\u4ee5\u6574\u6570\u96c6\u5408\u8981\u8fdb\u884c\u5347\u7ea7\u64cd\u4f5c\uff0c\u9996\u5148\u9700\u8981\u4e3a contents \u6570\u7ec4\u6269\u5bb9\uff0c\u5728\u539f\u672c\u7a7a\u95f4\u7684\u5927\u5c0f\u4e4b\u4e0a\u518d\u6269\u5bb9\u591a 80 \u4f4d\uff084x32-3x16=80\uff09\uff0c\u8fd9\u6837\u5c31\u80fd\u4fdd\u5b58\u4e0b 4 \u4e2a\u7c7b\u578b\u4e3a int32_t \u7684\u5143\u7d20\u3002</p> <p></p> <p>\u6269\u5bb9\u5b8c contents \u6570\u7ec4\u7a7a\u95f4\u5927\u5c0f\u540e\uff0c\u9700\u8981\u5c06\u4e4b\u524d\u7684\u4e09\u4e2a\u5143\u7d20\u8f6c\u6362\u4e3a int32_t \u7c7b\u578b\uff0c\u5e76\u5c06\u8f6c\u6362\u540e\u7684\u5143\u7d20\u653e\u7f6e\u5230\u6b63\u786e\u7684\u4f4d\u4e0a\u9762\uff0c\u5e76\u4e14\u9700\u8981\u7ef4\u6301\u5e95\u5c42\u6570\u7ec4\u7684\u6709\u5e8f\u6027\u4e0d\u53d8\uff0c\u6574\u4e2a\u8f6c\u6362\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u6574\u6570\u96c6\u5408\u5347\u7ea7\u6709\u4ec0\u4e48\u597d\u5904\u5462\uff1f</p> <p>\u5982\u679c\u8981\u8ba9\u4e00\u4e2a\u6570\u7ec4\u540c\u65f6\u4fdd\u5b58 int16_t\u3001int32_t\u3001int64_t \u7c7b\u578b\u7684\u5143\u7d20\uff0c\u6700\u7b80\u5355\u505a\u6cd5\u5c31\u662f\u76f4\u63a5\u4f7f\u7528 int64_t \u7c7b\u578b\u7684\u6570\u7ec4\u3002\u4e0d\u8fc7\u8fd9\u6837\u7684\u8bdd\uff0c\u5f53\u5982\u679c\u5143\u7d20\u90fd\u662f int16_t \u7c7b\u578b\u7684\uff0c\u5c31\u4f1a\u9020\u6210\u5185\u5b58\u6d6a\u8d39\u7684\u60c5\u51b5\u3002</p> <p>\u6574\u6570\u96c6\u5408\u5347\u7ea7\u5c31\u80fd\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u5982\u679c\u4e00\u76f4\u5411\u6574\u6570\u96c6\u5408\u6dfb\u52a0 int16_t \u7c7b\u578b\u7684\u5143\u7d20\uff0c\u90a3\u4e48\u6574\u6570\u96c6\u5408\u7684\u5e95\u5c42\u5b9e\u73b0\u5c31\u4e00\u76f4\u662f\u7528 int16_t \u7c7b\u578b\u7684\u6570\u7ec4\uff0c\u53ea\u6709\u5728\u6211\u4eec\u8981\u5c06 int32_t \u7c7b\u578b\u6216 int64_t \u7c7b\u578b\u7684\u5143\u7d20\u6dfb\u52a0\u5230\u96c6\u5408\u65f6\uff0c\u624d\u4f1a\u5bf9\u6570\u7ec4\u8fdb\u884c\u5347\u7ea7\u64cd\u4f5c\u3002</p> <p>\u56e0\u6b64\uff0c\u6574\u6570\u96c6\u5408\u5347\u7ea7\u7684\u597d\u5904\u662f\u8282\u7701\u5185\u5b58\u8d44\u6e90\u3002</p> <p>\u6574\u6570\u96c6\u5408\u652f\u6301\u964d\u7ea7\u64cd\u4f5c\u5417\uff1f</p> <p>\u4e0d\u652f\u6301\u964d\u7ea7\u64cd\u4f5c\uff0c\u4e00\u65e6\u5bf9\u6570\u7ec4\u8fdb\u884c\u4e86\u5347\u7ea7\uff0c\u5c31\u4f1a\u4e00\u76f4\u4fdd\u6301\u5347\u7ea7\u540e\u7684\u72b6\u6001\u3002\u6bd4\u5982\u524d\u9762\u7684\u5347\u7ea7\u64cd\u4f5c\u7684\u4f8b\u5b50\uff0c\u5982\u679c\u5220\u9664\u4e86 65535 \u5143\u7d20\uff0c\u6574\u6570\u96c6\u5408\u7684\u6570\u7ec4\u8fd8\u662f int32_t \u7c7b\u578b\u7684\uff0c\u5e76\u4e0d\u4f1a\u56e0\u6b64\u964d\u7ea7\u4e3a int16_t \u7c7b\u578b\u3002</p>"},{"location":"redis/data_struct/data_struct/#_20","title":"\u8df3\u8868","text":"<p>Redis \u53ea\u6709 Zset \u5bf9\u8c61\u7684\u5e95\u5c42\u5b9e\u73b0\u7528\u5230\u4e86\u8df3\u8868\uff0c\u8df3\u8868\u7684\u4f18\u52bf\u662f\u80fd\u652f\u6301\u5e73\u5747 O(logN) \u590d\u6742\u5ea6\u7684\u8282\u70b9\u67e5\u627e\u3002</p> <p>zset \u7ed3\u6784\u4f53\u91cc\u6709\u4e24\u4e2a\u6570\u636e\u7ed3\u6784\uff1a\u4e00\u4e2a\u662f\u8df3\u8868\uff0c\u4e00\u4e2a\u662f\u54c8\u5e0c\u8868\u3002\u8fd9\u6837\u7684\u597d\u5904\u662f\u65e2\u80fd\u8fdb\u884c\u9ad8\u6548\u7684\u8303\u56f4\u67e5\u8be2\uff0c\u4e5f\u80fd\u8fdb\u884c\u9ad8\u6548\u5355\u70b9\u67e5\u8be2\u3002</p> C<pre><code>typedef struct zset {\n    dict *dict;\n    zskiplist *zsl;\n} zset;\n</code></pre> <p>Zset \u5bf9\u8c61\u5728\u6267\u884c\u6570\u636e\u63d2\u5165\u6216\u662f\u6570\u636e\u66f4\u65b0\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u4f9d\u6b21\u5728\u8df3\u8868\u548c\u54c8\u5e0c\u8868\u4e2d\u63d2\u5165\u6216\u66f4\u65b0\u76f8\u5e94\u7684\u6570\u636e\uff0c\u4ece\u800c\u4fdd\u8bc1\u4e86\u8df3\u8868\u548c\u54c8\u5e0c\u8868\u4e2d\u8bb0\u5f55\u7684\u4fe1\u606f\u4e00\u81f4\u3002</p> <p>Zset \u5bf9\u8c61\u80fd\u652f\u6301\u8303\u56f4\u67e5\u8be2\uff08\u5982 ZRANGEBYSCORE \u64cd\u4f5c\uff09\uff0c\u8fd9\u662f\u56e0\u4e3a\u5b83\u7684\u6570\u636e\u7ed3\u6784\u8bbe\u8ba1\u91c7\u7528\u4e86\u8df3\u8868\uff0c\u800c\u53c8\u80fd\u4ee5\u5e38\u6570\u590d\u6742\u5ea6\u83b7\u53d6\u5143\u7d20\u6743\u91cd\uff08\u5982 ZSCORE \u64cd\u4f5c\uff09\uff0c\u8fd9\u662f\u56e0\u4e3a\u5b83\u540c\u65f6\u91c7\u7528\u4e86\u54c8\u5e0c\u8868\u8fdb\u884c\u7d22\u5f15\u3002</p> <p>\u53ef\u80fd\u5f88\u591a\u4eba\u4f1a\u5947\u602a\uff0c\u4e3a\u4ec0\u4e48\u6211\u5f00\u5934\u8bf4 Zset \u5bf9\u8c61\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u300c\u538b\u7f29\u5217\u8868\u300d\u6216\u8005\u300c\u8df3\u8868\u300d\uff0c\u800c\u6ca1\u6709\u8bf4\u54c8\u5e0c\u8868\u5462\uff1f</p> <p>Zset \u5bf9\u8c61\u5728\u4f7f\u7528\u8df3\u8868\u4f5c\u4e3a\u6570\u636e\u7ed3\u6784\u7684\u65f6\u5019\uff0c\u662f\u4f7f\u7528\u7531\u300c\u54c8\u5e0c\u8868 + \u8df3\u8868\u300d\u7ec4\u6210\u7684 struct zset\uff0c\u4f46\u662f\u6211\u4eec\u8ba8\u8bba\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u8bf4\u8df3\u8868\u662f Zset \u5bf9\u8c61\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\uff0c\u800c\u4e0d\u4f1a\u63d0\u53ca\u54c8\u5e0c\u8868\uff0c\u662f\u56e0\u4e3a struct zset \u4e2d\u7684\u54c8\u5e0c\u8868\u53ea\u662f\u7528\u4e8e\u4ee5\u5e38\u6570\u590d\u6742\u5ea6\u83b7\u53d6\u5143\u7d20\u6743\u91cd\uff0c\u5927\u90e8\u5206\u64cd\u4f5c\u90fd\u662f\u8df3\u8868\u5b9e\u73b0\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8be6\u7ec6\u7684\u8bf4\u4e0b\u8df3\u8868\u3002</p>"},{"location":"redis/data_struct/data_struct/#_21","title":"\u8df3\u8868\u7ed3\u6784\u8bbe\u8ba1","text":"<p>\u94fe\u8868\u5728\u67e5\u627e\u5143\u7d20\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u9700\u8981\u9010\u4e00\u67e5\u627e\uff0c\u6240\u4ee5\u67e5\u8be2\u6548\u7387\u975e\u5e38\u4f4e\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(N)\uff0c\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u8df3\u8868\u3002\u8df3\u8868\u662f\u5728\u94fe\u8868\u57fa\u7840\u4e0a\u6539\u8fdb\u8fc7\u6765\u7684\uff0c\u5b9e\u73b0\u4e86\u4e00\u79cd\u300c\u591a\u5c42\u300d\u7684\u6709\u5e8f\u94fe\u8868\uff0c\u8fd9\u6837\u7684\u597d\u5904\u662f\u80fd\u5feb\u8bfb\u5b9a\u4f4d\u6570\u636e\u3002</p> <p>\u90a3\u8df3\u8868\u957f\u4ec0\u4e48\u6837\u5462\uff1f\u6211\u8fd9\u91cc\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u56fe\u5c55\u793a\u4e86\u4e00\u4e2a\u5c42\u7ea7\u4e3a 3 \u7684\u8df3\u8868\u3002</p> <p></p> <p>\u56fe\u4e2d\u5934\u8282\u70b9\u6709 L0~L2 \u4e09\u4e2a\u5934\u6307\u9488\uff0c\u5206\u522b\u6307\u5411\u4e86\u4e0d\u540c\u5c42\u7ea7\u7684\u8282\u70b9\uff0c\u7136\u540e\u6bcf\u4e2a\u5c42\u7ea7\u7684\u8282\u70b9\u90fd\u901a\u8fc7\u6307\u9488\u8fde\u63a5\u8d77\u6765\uff1a</p> <ul> <li>L0 \u5c42\u7ea7\u5171\u6709 5 \u4e2a\u8282\u70b9\uff0c\u5206\u522b\u662f\u8282\u70b9 1\u30012\u30013\u30014\u30015\uff1b</li> <li>L1 \u5c42\u7ea7\u5171\u6709 3 \u4e2a\u8282\u70b9\uff0c\u5206\u522b\u662f\u8282\u70b9 2\u30013\u30015\uff1b</li> <li>L2 \u5c42\u7ea7\u53ea\u6709 1 \u4e2a\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u8282\u70b9 3\u3002</li> </ul> <p>\u5982\u679c\u6211\u4eec\u8981\u5728\u94fe\u8868\u4e2d\u67e5\u627e\u8282\u70b9 4 \u8fd9\u4e2a\u5143\u7d20\uff0c\u53ea\u80fd\u4ece\u5934\u5f00\u59cb\u904d\u5386\u94fe\u8868\uff0c\u9700\u8981\u67e5\u627e 4 \u6b21\uff0c\u800c\u4f7f\u7528\u4e86\u8df3\u8868\u540e\uff0c\u53ea\u9700\u8981\u67e5\u627e 2 \u6b21\u5c31\u80fd\u5b9a\u4f4d\u5230\u8282\u70b9 4\uff0c\u56e0\u4e3a\u53ef\u4ee5\u5728\u5934\u8282\u70b9\u76f4\u63a5\u4ece L2 \u5c42\u7ea7\u8df3\u5230\u8282\u70b9 3\uff0c\u7136\u540e\u518d\u5f80\u524d\u904d\u5386\u627e\u5230\u8282\u70b9 4\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e2a\u67e5\u627e\u8fc7\u7a0b\u5c31\u662f\u5728\u591a\u4e2a\u5c42\u7ea7\u4e0a\u8df3\u6765\u8df3\u53bb\uff0c\u6700\u540e\u5b9a\u4f4d\u5230\u5143\u7d20\u3002\u5f53\u6570\u636e\u91cf\u5f88\u5927\u65f6\uff0c\u8df3\u8868\u7684\u67e5\u627e\u590d\u6742\u5ea6\u5c31\u662f O(logN)\u3002</p> <p>\u90a3\u8df3\u8868\u8282\u70b9\u662f\u600e\u4e48\u5b9e\u73b0\u591a\u5c42\u7ea7\u7684\u5462\uff1f\u8fd9\u5c31\u9700\u8981\u770b\u300c\u8df3\u8868\u8282\u70b9\u300d\u7684\u6570\u636e\u7ed3\u6784\u4e86\uff0c\u5982\u4e0b\uff1a</p> C<pre><code>typedef struct zskiplistNode {\n    //Zset \u5bf9\u8c61\u7684\u5143\u7d20\u503c\n    sds ele;\n    //\u5143\u7d20\u6743\u91cd\u503c\n    double score;\n    //\u540e\u5411\u6307\u9488\n    struct zskiplistNode *backward;\n\n    //\u8282\u70b9\u7684 level \u6570\u7ec4\uff0c\u4fdd\u5b58\u6bcf\u5c42\u4e0a\u7684\u524d\u5411\u6307\u9488\u548c\u8de8\u5ea6\n    struct zskiplistLevel {\n        struct zskiplistNode *forward;\n        unsigned long span;\n    } level[];\n} zskiplistNode;\n</code></pre> <p>Zset \u5bf9\u8c61\u8981\u540c\u65f6\u4fdd\u5b58\u300c\u5143\u7d20\u300d\u548c\u300c\u5143\u7d20\u7684\u6743\u91cd\u300d\uff0c\u5bf9\u5e94\u5230\u8df3\u8868\u8282\u70b9\u7ed3\u6784\u91cc\u5c31\u662f sds \u7c7b\u578b\u7684 ele \u53d8\u91cf\u548c double \u7c7b\u578b\u7684 score \u53d8\u91cf\u3002\u6bcf\u4e2a\u8df3\u8868\u8282\u70b9\u90fd\u6709\u4e00\u4e2a\u540e\u5411\u6307\u9488\uff08struct zskiplistNode *backward\uff09\uff0c\u6307\u5411\u524d\u4e00\u4e2a\u8282\u70b9\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u4ece\u8df3\u8868\u7684\u5c3e\u8282\u70b9\u5f00\u59cb\u8bbf\u95ee\u8282\u70b9\uff0c\u8fd9\u6837\u5012\u5e8f\u67e5\u627e\u65f6\u5f88\u65b9\u4fbf\u3002</p> <p>\u8df3\u8868\u662f\u4e00\u4e2a\u5e26\u6709\u5c42\u7ea7\u5173\u7cfb\u7684\u94fe\u8868\uff0c\u800c\u4e14\u6bcf\u4e00\u5c42\u7ea7\u53ef\u4ee5\u5305\u542b\u591a\u4e2a\u8282\u70b9\uff0c\u6bcf\u4e00\u4e2a\u8282\u70b9\u901a\u8fc7\u6307\u9488\u8fde\u63a5\u8d77\u6765\uff0c\u5b9e\u73b0\u8fd9\u4e00\u7279\u6027\u5c31\u662f\u9760\u8df3\u8868\u8282\u70b9\u7ed3\u6784\u4f53\u4e2d\u7684zskiplistLevel \u7ed3\u6784\u4f53\u7c7b\u578b\u7684 level \u6570\u7ec4\u3002</p> <p>level \u6570\u7ec4\u4e2d\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u4ee3\u8868\u8df3\u8868\u7684\u4e00\u5c42\uff0c\u4e5f\u5c31\u662f\u7531 zskiplistLevel \u7ed3\u6784\u4f53\u8868\u793a\uff0c\u6bd4\u5982 leve[0] \u5c31\u8868\u793a\u7b2c\u4e00\u5c42\uff0cleve[1] \u5c31\u8868\u793a\u7b2c\u4e8c\u5c42\u3002zskiplistLevel \u7ed3\u6784\u4f53\u91cc\u5b9a\u4e49\u4e86\u300c\u6307\u5411\u4e0b\u4e00\u4e2a\u8df3\u8868\u8282\u70b9\u7684\u6307\u9488\u300d\u548c\u300c\u8de8\u5ea6\u300d\uff0c\u8de8\u5ea6\u65f6\u7528\u6765\u8bb0\u5f55\u4e24\u4e2a\u8282\u70b9\u4e4b\u95f4\u7684\u8ddd\u79bb\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u5f20\u56fe\uff0c\u5c55\u793a\u4e86\u5404\u4e2a\u8282\u70b9\u7684\u8de8\u5ea6\u3002</p> <p></p> <p>\u7b2c\u4e00\u773c\u770b\u5230\u8de8\u5ea6\u7684\u65f6\u5019\uff0c\u4ee5\u4e3a\u662f\u904d\u5386\u64cd\u4f5c\u6709\u5173\uff0c\u5b9e\u9645\u4e0a\u5e76\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\uff0c\u904d\u5386\u64cd\u4f5c\u53ea\u9700\u8981\u7528\u524d\u5411\u6307\u9488\uff08struct zskiplistNode *forward\uff09\u5c31\u53ef\u4ee5\u5b8c\u6210\u4e86\u3002</p> <p>\u8de8\u5ea6\u5b9e\u9645\u4e0a\u662f\u4e3a\u4e86\u8ba1\u7b97\u8fd9\u4e2a\u8282\u70b9\u5728\u8df3\u8868\u4e2d\u7684\u6392\u4f4d\u3002\u5177\u4f53\u600e\u4e48\u505a\u7684\u5462\uff1f\u56e0\u4e3a\u8df3\u8868\u4e2d\u7684\u8282\u70b9\u90fd\u662f\u6309\u5e8f\u6392\u5217\u7684\uff0c\u90a3\u4e48\u8ba1\u7b97\u67d0\u4e2a\u8282\u70b9\u6392\u4f4d\u7684\u65f6\u5019\uff0c\u4ece\u5934\u8282\u70b9\u70b9\u5230\u8be5\u7ed3\u70b9\u7684\u67e5\u8be2\u8def\u5f84\u4e0a\uff0c\u5c06\u6cbf\u9014\u8bbf\u95ee\u8fc7\u7684\u6240\u6709\u5c42\u7684\u8de8\u5ea6\u7d2f\u52a0\u8d77\u6765\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u5c31\u662f\u76ee\u6807\u8282\u70b9\u5728\u8df3\u8868\u4e2d\u7684\u6392\u4f4d\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u67e5\u627e\u56fe\u4e2d\u8282\u70b9 3 \u5728\u8df3\u8868\u4e2d\u7684\u6392\u4f4d\uff0c\u4ece\u5934\u8282\u70b9\u5f00\u59cb\u67e5\u627e\u8282\u70b9 3\uff0c\u67e5\u627e\u7684\u8fc7\u7a0b\u53ea\u7ecf\u8fc7\u4e86\u4e00\u4e2a\u5c42\uff08L2\uff09\uff0c\u5e76\u4e14\u5c42\u7684\u8de8\u5ea6\u662f 3\uff0c\u6240\u4ee5\u8282\u70b9 3 \u5728\u8df3\u8868\u4e2d\u7684\u6392\u4f4d\u662f 3\u3002</p> <p>\u53e6\u5916\uff0c\u56fe\u4e2d\u7684\u5934\u8282\u70b9\u5176\u5b9e\u4e5f\u662f zskiplistNode \u8df3\u8868\u8282\u70b9\uff0c\u53ea\u4e0d\u8fc7\u5934\u8282\u70b9\u7684\u540e\u5411\u6307\u9488\u3001\u6743\u91cd\u3001\u5143\u7d20\u503c\u90fd\u6ca1\u6709\u7528\u5230\uff0c\u6240\u4ee5\u56fe\u4e2d\u7701\u7565\u4e86\u8fd9\u90e8\u5206\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u7531\u8c01\u5b9a\u4e49\u54ea\u4e2a\u8df3\u8868\u8282\u70b9\u662f\u5934\u8282\u70b9\u5462\uff1f\u8fd9\u5c31\u4ecb\u7ecd\u300c\u8df3\u8868\u300d\u7ed3\u6784\u4f53\u4e86\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> C<pre><code>typedef struct zskiplist {\n    struct zskiplistNode *header, *tail;\n    unsigned long length;\n    int level;\n} zskiplist;\n</code></pre> <p>\u8df3\u8868\u7ed3\u6784\u91cc\u5305\u542b\u4e86\uff1a</p> <ul> <li>\u8df3\u8868\u7684\u5934\u5c3e\u8282\u70b9\uff0c\u4fbf\u4e8e\u5728 O(1) \u65f6\u95f4\u590d\u6742\u5ea6\u5185\u8bbf\u95ee\u8df3\u8868\u7684\u5934\u8282\u70b9\u548c\u5c3e\u8282\u70b9\uff1b</li> <li>\u8df3\u8868\u7684\u957f\u5ea6\uff0c\u4fbf\u4e8e\u5728 O(1) \u65f6\u95f4\u590d\u6742\u5ea6\u83b7\u53d6\u8df3\u8868\u8282\u70b9\u7684\u6570\u91cf\uff1b</li> <li>\u8df3\u8868\u7684\u6700\u5927\u5c42\u6570\uff0c\u4fbf\u4e8e\u5728 O(1) \u65f6\u95f4\u590d\u6742\u5ea6\u83b7\u53d6\u8df3\u8868\u4e2d\u5c42\u9ad8\u6700\u5927\u7684\u90a3\u4e2a\u8282\u70b9\u7684\u5c42\u6570\u91cf\uff1b</li> </ul>"},{"location":"redis/data_struct/data_struct/#_22","title":"\u8df3\u8868\u8282\u70b9\u67e5\u8be2\u8fc7\u7a0b","text":"<p>\u67e5\u627e\u4e00\u4e2a\u8df3\u8868\u8282\u70b9\u7684\u8fc7\u7a0b\u65f6\uff0c\u8df3\u8868\u4f1a\u4ece\u5934\u8282\u70b9\u7684\u6700\u9ad8\u5c42\u5f00\u59cb\uff0c\u9010\u4e00\u904d\u5386\u6bcf\u4e00\u5c42\u3002\u5728\u904d\u5386\u67d0\u4e00\u5c42\u7684\u8df3\u8868\u8282\u70b9\u65f6\uff0c\u4f1a\u7528\u8df3\u8868\u8282\u70b9\u4e2d\u7684 SDS \u7c7b\u578b\u7684\u5143\u7d20\u548c\u5143\u7d20\u7684\u6743\u91cd\u6765\u8fdb\u884c\u5224\u65ad\uff0c\u5171\u6709\u4e24\u4e2a\u5224\u65ad\u6761\u4ef6\uff1a</p> <ul> <li>\u5982\u679c\u5f53\u524d\u8282\u70b9\u6307\u5411\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9(forward\u6307\u5411\u7684\u8282\u70b9)\u7684\u6743\u91cd\u300c\u5c0f\u4e8e\u300d\u8981\u67e5\u627e\u7684\u6743\u91cd\u65f6\uff0c\u8df3\u8868\u5c31\u4f1a\u8bbf\u95ee\u8be5\u5c42\u4e0a\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\u3002</li> <li>\u5982\u679c\u5f53\u524d\u8282\u70b9\u6307\u5411\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9(forward\u6307\u5411\u7684\u8282\u70b9)\u7684\u6743\u91cd\u300c\u7b49\u4e8e\u300d\u8981\u67e5\u627e\u7684\u6743\u91cd\u65f6\uff0c\u5e76\u4e14\u4e0b\u4e00\u4e2a\u8282\u70b9\u7684 SDS \u7c7b\u578b\u6570\u636e\u300c\u5c0f\u4e8e\u300d\u8981\u67e5\u627e\u7684\u6570\u636e\u65f6\uff0c\u8df3\u8868\u5c31\u4f1a\u8bbf\u95ee\u8be5\u5c42\u4e0a\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\u3002</li> </ul> <p>\u5982\u679c\u4e0a\u9762\u4e24\u4e2a\u6761\u4ef6\u90fd\u4e0d\u6ee1\u8db3\uff0c\u6216\u8005\u4e0b\u4e00\u4e2a\u8282\u70b9\u4e3a\u7a7a\u65f6\uff0c\u8df3\u8868\u5c31\u4f1a\u4f7f\u7528\u76ee\u524d\u904d\u5386\u5230\u7684\u8282\u70b9\u7684 level \u6570\u7ec4\u91cc\u7684\u4e0b\u4e00\u5c42\u6307\u9488\uff0c\u7136\u540e\u6cbf\u7740\u4e0b\u4e00\u5c42\u6307\u9488\u7ee7\u7eed\u67e5\u627e\uff0c\u8fd9\u5c31\u76f8\u5f53\u4e8e\u8df3\u5230\u4e86\u4e0b\u4e00\u5c42\u63a5\u7740\u67e5\u627e\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u56fe\u6709\u4e2a 3 \u5c42\u7ea7\u7684\u8df3\u8868\u3002</p> <p></p> <p>\u5982\u679c\u8981\u67e5\u627e\u300c\u5143\u7d20\uff1aabcd\uff0c\u6743\u91cd\uff1a4\u300d\u7684\u8282\u70b9\uff0c\u67e5\u627e\u7684\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>\u5148\u4ece\u5934\u8282\u70b9\u7684\u6700\u9ad8\u5c42\u5f00\u59cb\uff0cL2 \u6307\u5411\u4e86\u300c\u5143\u7d20\uff1aabc\uff0c\u6743\u91cd\uff1a3\u300d\u8282\u70b9\uff0c\u8fd9\u4e2a\u8282\u70b9\u7684\u6743\u91cd\u6bd4\u8981\u67e5\u627e\u8282\u70b9\u7684\u5c0f\uff0c\u6240\u4ee5\u8981\u8bbf\u95ee\u8be5\u5c42\u4e0a\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\uff1b</li> <li>\u4f46\u662f\u8be5\u5c42\u7684\u4e0b\u4e00\u4e2a\u8282\u70b9\u662f\u7a7a\u8282\u70b9\uff08leve[2]\u6307\u5411\u7684\u662f\u7a7a\u8282\u70b9\uff09\uff0c\u4e8e\u662f\u5c31\u4f1a\u8df3\u5230\u300c\u5143\u7d20\uff1aabc\uff0c\u6743\u91cd\uff1a3\u300d\u8282\u70b9\u7684\u4e0b\u4e00\u5c42\u53bb\u627e\uff0c\u4e5f\u5c31\u662f leve[1];</li> <li>\u300c\u5143\u7d20\uff1aabc\uff0c\u6743\u91cd\uff1a3\u300d\u8282\u70b9\u7684  leve[1] \u7684\u4e0b\u4e00\u4e2a\u6307\u9488\u6307\u5411\u4e86\u300c\u5143\u7d20\uff1aabcde\uff0c\u6743\u91cd\uff1a4\u300d\u7684\u8282\u70b9\uff0c\u7136\u540e\u5c06\u5176\u548c\u8981\u67e5\u627e\u7684\u8282\u70b9\u6bd4\u8f83\u3002\u867d\u7136\u300c\u5143\u7d20\uff1aabcde\uff0c\u6743\u91cd\uff1a4\u300d\u7684\u8282\u70b9\u7684\u6743\u91cd\u548c\u8981\u67e5\u627e\u7684\u6743\u91cd\u76f8\u540c\uff0c\u4f46\u662f\u5f53\u524d\u8282\u70b9\u7684 SDS \u7c7b\u578b\u6570\u636e\u300c\u5927\u4e8e\u300d\u8981\u67e5\u627e\u7684\u6570\u636e\uff0c\u6240\u4ee5\u4f1a\u7ee7\u7eed\u8df3\u5230\u300c\u5143\u7d20\uff1aabc\uff0c\u6743\u91cd\uff1a3\u300d\u8282\u70b9\u7684\u4e0b\u4e00\u5c42\u53bb\u627e\uff0c\u4e5f\u5c31\u662f leve[0]\uff1b</li> <li>\u300c\u5143\u7d20\uff1aabc\uff0c\u6743\u91cd\uff1a3\u300d\u8282\u70b9\u7684 leve[0] \u7684\u4e0b\u4e00\u4e2a\u6307\u9488\u6307\u5411\u4e86\u300c\u5143\u7d20\uff1aabcd\uff0c\u6743\u91cd\uff1a4\u300d\u7684\u8282\u70b9\uff0c\u8be5\u8282\u70b9\u6b63\u662f\u8981\u67e5\u627e\u7684\u8282\u70b9\uff0c\u67e5\u8be2\u7ed3\u675f\u3002</li> </ul>"},{"location":"redis/data_struct/data_struct/#_23","title":"\u8df3\u8868\u8282\u70b9\u5c42\u6570\u8bbe\u7f6e","text":"<p>\u8df3\u8868\u7684\u76f8\u90bb\u4e24\u5c42\u7684\u8282\u70b9\u6570\u91cf\u7684\u6bd4\u4f8b\u4f1a\u5f71\u54cd\u8df3\u8868\u7684\u67e5\u8be2\u6027\u80fd\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u56fe\u7684\u8df3\u8868\uff0c\u7b2c\u4e8c\u5c42\u7684\u8282\u70b9\u6570\u91cf\u53ea\u6709 1 \u4e2a\uff0c\u800c\u7b2c\u4e00\u5c42\u7684\u8282\u70b9\u6570\u91cf\u6709 6 \u4e2a\u3002</p> <p></p> <p>\u8fd9\u65f6\uff0c\u5982\u679c\u60f3\u8981\u67e5\u8be2\u8282\u70b9 6\uff0c\u90a3\u57fa\u672c\u5c31\u8ddf\u94fe\u8868\u7684\u67e5\u8be2\u590d\u6742\u5ea6\u4e00\u6837\uff0c\u5c31\u9700\u8981\u5728\u7b2c\u4e00\u5c42\u7684\u8282\u70b9\u4e2d\u4f9d\u6b21\u987a\u5e8f\u67e5\u627e\uff0c\u590d\u6742\u5ea6\u5c31\u662f O(N) \u4e86\u3002\u6240\u4ee5\uff0c\u4e3a\u4e86\u964d\u4f4e\u67e5\u8be2\u590d\u6742\u5ea6\uff0c\u6211\u4eec\u5c31\u9700\u8981\u7ef4\u6301\u76f8\u90bb\u5c42\u7ed3\u70b9\u6570\u95f4\u7684\u5173\u7cfb\u3002</p> <p>\u8df3\u8868\u7684\u76f8\u90bb\u4e24\u5c42\u7684\u8282\u70b9\u6570\u91cf\u6700\u7406\u60f3\u7684\u6bd4\u4f8b\u662f 2:1\uff0c\u67e5\u627e\u590d\u6742\u5ea6\u53ef\u4ee5\u964d\u4f4e\u5230 O(logN)\u3002</p> <p>\u4e0b\u56fe\u7684\u8df3\u8868\u5c31\u662f\uff0c\u76f8\u90bb\u4e24\u5c42\u7684\u8282\u70b9\u6570\u91cf\u7684\u6bd4\u4f8b\u662f 2 : 1\u3002</p> <p></p> <p>\u90a3\u600e\u6837\u624d\u80fd\u7ef4\u6301\u76f8\u90bb\u4e24\u5c42\u7684\u8282\u70b9\u6570\u91cf\u7684\u6bd4\u4f8b\u4e3a 2 : 1  \u5462\uff1f</p> <p>\u5982\u679c\u91c7\u7528\u65b0\u589e\u8282\u70b9\u6216\u8005\u5220\u9664\u8282\u70b9\u65f6\uff0c\u6765\u8c03\u6574\u8df3\u8868\u8282\u70b9\u4ee5\u7ef4\u6301\u6bd4\u4f8b\u7684\u65b9\u6cd5\u7684\u8bdd\uff0c\u4f1a\u5e26\u6765\u989d\u5916\u7684\u5f00\u9500\u3002</p> <p>Redis \u5219\u91c7\u7528\u4e00\u79cd\u5de7\u5999\u7684\u65b9\u6cd5\u662f\uff0c\u8df3\u8868\u5728\u521b\u5efa\u8282\u70b9\u7684\u65f6\u5019\uff0c\u968f\u673a\u751f\u6210\u6bcf\u4e2a\u8282\u70b9\u7684\u5c42\u6570\uff0c\u5e76\u6ca1\u6709\u4e25\u683c\u7ef4\u6301\u76f8\u90bb\u4e24\u5c42\u7684\u8282\u70b9\u6570\u91cf\u6bd4\u4f8b\u4e3a 2 : 1 \u7684\u60c5\u51b5\u3002</p> <p>\u5177\u4f53\u7684\u505a\u6cd5\u662f\uff0c\u8df3\u8868\u5728\u521b\u5efa\u8282\u70b9\u65f6\u5019\uff0c\u4f1a\u751f\u6210\u8303\u56f4\u4e3a[0-1]\u7684\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u5982\u679c\u8fd9\u4e2a\u968f\u673a\u6570\u5c0f\u4e8e 0.25\uff08\u76f8\u5f53\u4e8e\u6982\u7387 25%\uff09\uff0c\u90a3\u4e48\u5c42\u6570\u5c31\u589e\u52a0 1 \u5c42\uff0c\u7136\u540e\u7ee7\u7eed\u751f\u6210\u4e0b\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u76f4\u5230\u968f\u673a\u6570\u7684\u7ed3\u679c\u5927\u4e8e 0.25 \u7ed3\u675f\uff0c\u6700\u7ec8\u786e\u5b9a\u8be5\u8282\u70b9\u7684\u5c42\u6570\u3002</p> <p>\u8fd9\u6837\u7684\u505a\u6cd5\uff0c\u76f8\u5f53\u4e8e\u6bcf\u589e\u52a0\u4e00\u5c42\u7684\u6982\u7387\u4e0d\u8d85\u8fc7 25%\uff0c\u5c42\u6570\u8d8a\u9ad8\uff0c\u6982\u7387\u8d8a\u4f4e\uff0c\u5c42\u9ad8\u6700\u5927\u9650\u5236\u662f 64\u3002</p> <p>\u867d\u7136\u6211\u524d\u9762\u8bb2\u89e3\u8df3\u8868\u7684\u65f6\u5019\uff0c\u56fe\u4e2d\u7684\u8df3\u8868\u7684\u300c\u5934\u8282\u70b9\u300d\u90fd\u662f 3 \u5c42\u9ad8\uff0c\u4f46\u662f\u5176\u5b9e\u5982\u679c\u5c42\u9ad8\u6700\u5927\u9650\u5236\u662f 64\uff0c\u90a3\u4e48\u5728\u521b\u5efa\u8df3\u8868\u300c\u5934\u8282\u70b9\u300d\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u76f4\u63a5\u521b\u5efa 64 \u5c42\u9ad8\u7684\u5934\u8282\u70b9\u3002</p> <p>\u5982\u4e0b\u4ee3\u7801\uff0c\u521b\u5efa\u8df3\u8868\u65f6\uff0c\u5934\u8282\u70b9\u7684 level \u6570\u7ec4\u6709 ZSKIPLIST_MAXLEVEL \u4e2a\u5143\u7d20\uff08\u5c42\uff09\uff0c\u8282\u70b9\u4e0d\u5b58\u50a8\u4efb\u4f55 member \u548c score \u503c\uff0clevel \u6570\u7ec4\u5143\u7d20\u7684 forward \u90fd\u6307\u5411 NULL\uff0cspan \u503c\u90fd\u4e3a 0\u3002</p> C<pre><code>/* Create a new skiplist. */\nzskiplist *zslCreate(void) {\n    int j;\n    zskiplist *zsl;\n\n    zsl = zmalloc(sizeof(*zsl));\n    zsl-&gt;level = 1;\n    zsl-&gt;length = 0;\n    zsl-&gt;header = zslCreateNode(ZSKIPLIST_MAXLEVEL,0,NULL);\n    for (j = 0; j &lt; ZSKIPLIST_MAXLEVEL; j++) {\n        zsl-&gt;header-&gt;level[j].forward = NULL;\n        zsl-&gt;header-&gt;level[j].span = 0;\n    }\n    zsl-&gt;header-&gt;backward = NULL;\n    zsl-&gt;tail = NULL;\n    return zsl;\n}\n</code></pre> <p>\u5176\u4e2d\uff0cZSKIPLIST_MAXLEVEL \u5b9a\u4e49\u7684\u662f\u6700\u9ad8\u7684\u5c42\u6570\uff0cRedis 7.0 \u5b9a\u4e49\u4e3a 32\uff0cRedis 5.0 \u5b9a\u4e49\u4e3a 64\uff0cRedis 3.0 \u5b9a\u4e49\u4e3a 32\u3002</p>"},{"location":"redis/data_struct/data_struct/#_24","title":"\u4e3a\u4ec0\u4e48\u7528\u8df3\u8868\u800c\u4e0d\u7528\u5e73\u8861\u6811\uff1f","text":"<p>\u8fd9\u91cc\u63d2\u4e00\u4e2a\u5e38\u89c1\u7684\u9762\u8bd5\u9898\uff1a\u4e3a\u4ec0\u4e48 Zset \u7684\u5b9e\u73b0\u7528\u8df3\u8868\u800c\u4e0d\u7528\u5e73\u8861\u6811\uff08\u5982 AVL \u6811\u3001\u7ea2\u9ed1\u6811\u7b49\uff09\uff1f</p> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0cRedis \u7684\u4f5c\u8005 @antirez \u662f\u600e\u4e48\u8bf4\u7684\uff1a</p> <p>There are a few reasons:</p> <p>1) They are not very memory intensive. It's up to you basically. Changing parameters about the probability of a node to have a given number of levels will make then less memory intensive than btrees.</p> <p>2) A sorted set is often target of many ZRANGE or ZREVRANGE operations, that is, traversing the skip list as a linked list. With this operation the cache locality of skip lists is at least as good as with other kind of balanced trees.</p> <p>3) They are simpler to implement, debug, and so forth. For instance thanks to the skip list simplicity I received a patch (already in Redis master) with augmented skip lists implementing ZRANK in O(log(N)). It required little changes to the code.</p> <p>\u7b80\u5355\u7ffb\u8bd1\u4e00\u4e0b\uff0c\u4e3b\u8981\u662f\u4ece\u5185\u5b58\u5360\u7528\u3001\u5bf9\u8303\u56f4\u67e5\u627e\u7684\u652f\u6301\u3001\u5b9e\u73b0\u96be\u6613\u7a0b\u5ea6\u8fd9\u4e09\u65b9\u9762\u603b\u7ed3\u7684\u539f\u56e0\uff1a</p> <ul> <li>\u5b83\u4eec\u4e0d\u662f\u975e\u5e38\u5185\u5b58\u5bc6\u96c6\u578b\u7684\u3002\u57fa\u672c\u4e0a\u7531\u4f60\u51b3\u5b9a\u3002\u6539\u53d8\u5173\u4e8e\u8282\u70b9\u5177\u6709\u7ed9\u5b9a\u7ea7\u522b\u6570\u7684\u6982\u7387\u7684\u53c2\u6570\u5c06\u4f7f\u5176\u6bd4 btree \u5360\u7528\u66f4\u5c11\u7684\u5185\u5b58\u3002</li> <li>Zset \u7ecf\u5e38\u9700\u8981\u6267\u884c ZRANGE \u6216 ZREVRANGE \u7684\u547d\u4ee4\uff0c\u5373\u4f5c\u4e3a\u94fe\u8868\u904d\u5386\u8df3\u8868\u3002\u901a\u8fc7\u6b64\u64cd\u4f5c\uff0c\u8df3\u8868\u7684\u7f13\u5b58\u5c40\u90e8\u6027\u81f3\u5c11\u4e0e\u5176\u4ed6\u7c7b\u578b\u7684\u5e73\u8861\u6811\u4e00\u6837\u597d\u3002</li> <li>\u5b83\u4eec\u66f4\u6613\u4e8e\u5b9e\u73b0\u3001\u8c03\u8bd5\u7b49\u3002\u4f8b\u5982\uff0c\u7531\u4e8e\u8df3\u8868\u7684\u7b80\u5355\u6027\uff0c\u6211\u6536\u5230\u4e86\u4e00\u4e2a\u8865\u4e01\uff08\u5df2\u7ecf\u5728 Redis master \u4e2d\uff09\uff0c\u5176\u4e2d\u6269\u5c55\u4e86\u8df3\u8868\uff0c\u5728 O(log(N)) \u4e2d\u5b9e\u73b0\u4e86 ZRANK\u3002\u5b83\u53ea\u9700\u8981\u5bf9\u4ee3\u7801\u8fdb\u884c\u5c11\u91cf\u4fee\u6539\u3002</li> </ul> <p>\u6211\u518d\u8be6\u7ec6\u8865\u5145\u70b9\uff1a</p> <ul> <li>\u4ece\u5185\u5b58\u5360\u7528\u4e0a\u6765\u6bd4\u8f83\uff0c\u8df3\u8868\u6bd4\u5e73\u8861\u6811\u66f4\u7075\u6d3b\u4e00\u4e9b\u3002\u5e73\u8861\u6811\u6bcf\u4e2a\u8282\u70b9\u5305\u542b 2 \u4e2a\u6307\u9488\uff08\u5206\u522b\u6307\u5411\u5de6\u53f3\u5b50\u6811\uff09\uff0c\u800c\u8df3\u8868\u6bcf\u4e2a\u8282\u70b9\u5305\u542b\u7684\u6307\u9488\u6570\u76ee\u5e73\u5747\u4e3a 1/(1-p)\uff0c\u5177\u4f53\u53d6\u51b3\u4e8e\u53c2\u6570 p \u7684\u5927\u5c0f\u3002\u5982\u679c\u50cf Redis \u91cc\u7684\u5b9e\u73b0\u4e00\u6837\uff0c\u53d6 p=1/4\uff0c\u90a3\u4e48\u5e73\u5747\u6bcf\u4e2a\u8282\u70b9\u5305\u542b 1.33 \u4e2a\u6307\u9488\uff0c\u6bd4\u5e73\u8861\u6811\u66f4\u6709\u4f18\u52bf\u3002</li> <li>\u5728\u505a\u8303\u56f4\u67e5\u627e\u7684\u65f6\u5019\uff0c\u8df3\u8868\u6bd4\u5e73\u8861\u6811\u64cd\u4f5c\u8981\u7b80\u5355\u3002\u5728\u5e73\u8861\u6811\u4e0a\uff0c\u6211\u4eec\u627e\u5230\u6307\u5b9a\u8303\u56f4\u7684\u5c0f\u503c\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u4ee5\u4e2d\u5e8f\u904d\u5386\u7684\u987a\u5e8f\u7ee7\u7eed\u5bfb\u627e\u5176\u5b83\u4e0d\u8d85\u8fc7\u5927\u503c\u7684\u8282\u70b9\u3002\u5982\u679c\u4e0d\u5bf9\u5e73\u8861\u6811\u8fdb\u884c\u4e00\u5b9a\u7684\u6539\u9020\uff0c\u8fd9\u91cc\u7684\u4e2d\u5e8f\u904d\u5386\u5e76\u4e0d\u5bb9\u6613\u5b9e\u73b0\u3002\u800c\u5728\u8df3\u8868\u4e0a\u8fdb\u884c\u8303\u56f4\u67e5\u627e\u5c31\u975e\u5e38\u7b80\u5355\uff0c\u53ea\u9700\u8981\u5728\u627e\u5230\u5c0f\u503c\u4e4b\u540e\uff0c\u5bf9\u7b2c 1 \u5c42\u94fe\u8868\u8fdb\u884c\u82e5\u5e72\u6b65\u7684\u904d\u5386\u5c31\u53ef\u4ee5\u5b9e\u73b0\u3002</li> <li>\u4ece\u7b97\u6cd5\u5b9e\u73b0\u96be\u5ea6\u4e0a\u6765\u6bd4\u8f83\uff0c\u8df3\u8868\u6bd4\u5e73\u8861\u6811\u8981\u7b80\u5355\u5f97\u591a\u3002\u5e73\u8861\u6811\u7684\u63d2\u5165\u548c\u5220\u9664\u64cd\u4f5c\u53ef\u80fd\u5f15\u53d1\u5b50\u6811\u7684\u8c03\u6574\uff0c\u903b\u8f91\u590d\u6742\uff0c\u800c\u8df3\u8868\u7684\u63d2\u5165\u548c\u5220\u9664\u53ea\u9700\u8981\u4fee\u6539\u76f8\u90bb\u8282\u70b9\u7684\u6307\u9488\uff0c\u64cd\u4f5c\u7b80\u5355\u53c8\u5feb\u901f\u3002</li> </ul>"},{"location":"redis/data_struct/data_struct/#quicklist","title":"quicklist","text":"<p>\u5728 Redis 3.0 \u4e4b\u524d\uff0cList \u5bf9\u8c61\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u662f\u53cc\u5411\u94fe\u8868\u6216\u8005\u538b\u7f29\u5217\u8868\u3002\u7136\u540e\u5728  Redis 3.2 \u7684\u65f6\u5019\uff0cList \u5bf9\u8c61\u7684\u5e95\u5c42\u6539\u7531 quicklist \u6570\u636e\u7ed3\u6784\u5b9e\u73b0\u3002</p> <p>\u5176\u5b9e quicklist \u5c31\u662f\u300c\u53cc\u5411\u94fe\u8868 + \u538b\u7f29\u5217\u8868\u300d\u7ec4\u5408\uff0c\u56e0\u4e3a\u4e00\u4e2a quicklist \u5c31\u662f\u4e00\u4e2a\u94fe\u8868\uff0c\u800c\u94fe\u8868\u4e2d\u7684\u6bcf\u4e2a\u5143\u7d20\u53c8\u662f\u4e00\u4e2a\u538b\u7f29\u5217\u8868\u3002</p> <p>\u5728\u524d\u9762\u8bb2\u538b\u7f29\u5217\u8868\u7684\u65f6\u5019\uff0c\u6211\u4e5f\u63d0\u5230\u4e86\u538b\u7f29\u5217\u8868\u7684\u4e0d\u8db3\uff0c\u867d\u7136\u538b\u7f29\u5217\u8868\u662f\u901a\u8fc7\u7d27\u51d1\u578b\u7684\u5185\u5b58\u5e03\u5c40\u8282\u7701\u4e86\u5185\u5b58\u5f00\u9500\uff0c\u4f46\u662f\u56e0\u4e3a\u5b83\u7684\u7ed3\u6784\u8bbe\u8ba1\uff0c\u5982\u679c\u4fdd\u5b58\u7684\u5143\u7d20\u6570\u91cf\u589e\u52a0\uff0c\u6216\u8005\u5143\u7d20\u53d8\u5927\u4e86\uff0c\u538b\u7f29\u5217\u8868\u4f1a\u6709\u300c\u8fde\u9501\u66f4\u65b0\u300d\u7684\u98ce\u9669\uff0c\u4e00\u65e6\u53d1\u751f\uff0c\u4f1a\u9020\u6210\u6027\u80fd\u4e0b\u964d\u3002</p> <p>quicklist \u89e3\u51b3\u529e\u6cd5\uff0c\u901a\u8fc7\u63a7\u5236\u6bcf\u4e2a\u94fe\u8868\u8282\u70b9\u4e2d\u7684\u538b\u7f29\u5217\u8868\u7684\u5927\u5c0f\u6216\u8005\u5143\u7d20\u4e2a\u6570\uff0c\u6765\u89c4\u907f\u8fde\u9501\u66f4\u65b0\u7684\u95ee\u9898\u3002\u56e0\u4e3a\u538b\u7f29\u5217\u8868\u5143\u7d20\u8d8a\u5c11\u6216\u8d8a\u5c0f\uff0c\u8fde\u9501\u66f4\u65b0\u5e26\u6765\u7684\u5f71\u54cd\u5c31\u8d8a\u5c0f\uff0c\u4ece\u800c\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u8bbf\u95ee\u6027\u80fd\u3002</p>"},{"location":"redis/data_struct/data_struct/#quicklist_1","title":"quicklist \u7ed3\u6784\u8bbe\u8ba1","text":"<p>quicklist \u7684\u7ed3\u6784\u4f53\u8ddf\u94fe\u8868\u7684\u7ed3\u6784\u4f53\u7c7b\u4f3c\uff0c\u90fd\u5305\u542b\u4e86\u8868\u5934\u548c\u8868\u5c3e\uff0c\u533a\u522b\u5728\u4e8e quicklist \u7684\u8282\u70b9\u662f quicklistNode\u3002</p> C<pre><code>typedef struct quicklist {\n    //quicklist \u7684\u94fe\u8868\u5934\n    quicklistNode *head;      //quicklist \u7684\u94fe\u8868\u5934\n    //quicklist \u7684\u94fe\u8868\u5c3e\n    quicklistNode *tail; \n    //\u6240\u6709\u538b\u7f29\u5217\u8868\u4e2d\u7684\u603b\u5143\u7d20\u4e2a\u6570\n    unsigned long count;\n    //quicklistNodes \u7684\u4e2a\u6570\n    unsigned long len;       \n    ...\n} quicklist;\n</code></pre> <p>\u63a5\u4e0b\u6765\u770b\u770b\uff0cquicklistNode \u7684\u7ed3\u6784\u5b9a\u4e49\uff1a</p> C<pre><code>typedef struct quicklistNode {\n    //\u524d\u4e00\u4e2a quicklistNode\n    struct quicklistNode *prev;     //\u524d\u4e00\u4e2a quicklistNode\n    //\u4e0b\u4e00\u4e2a quicklistNode\n    struct quicklistNode *next;     //\u540e\u4e00\u4e2a quicklistNode\n    //quicklistNode \u6307\u5411\u7684\u538b\u7f29\u5217\u8868\n    unsigned char *zl;              \n    //\u538b\u7f29\u5217\u8868\u7684\u7684\u5b57\u8282\u5927\u5c0f\n    unsigned int sz;                \n    //\u538b\u7f29\u5217\u8868\u7684\u5143\u7d20\u4e2a\u6570\n    unsigned int count : 16;        //ziplist \u4e2d\u7684\u5143\u7d20\u4e2a\u6570 \n    ....\n} quicklistNode;\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0cquicklistNode \u7ed3\u6784\u4f53\u91cc\u5305\u542b\u4e86\u524d\u4e00\u4e2a\u8282\u70b9\u548c\u4e0b\u4e00\u4e2a\u8282\u70b9\u6307\u9488\uff0c\u8fd9\u6837\u6bcf\u4e2a quicklistNode \u5f62\u6210\u4e86\u4e00\u4e2a\u53cc\u5411\u94fe\u8868\u3002\u4f46\u662f\u94fe\u8868\u8282\u70b9\u7684\u5143\u7d20\u4e0d\u518d\u662f\u5355\u7eaf\u4fdd\u5b58\u5143\u7d20\u503c\uff0c\u800c\u662f\u4fdd\u5b58\u4e86\u4e00\u4e2a\u538b\u7f29\u5217\u8868\uff0c\u6240\u4ee5 quicklistNode \u7ed3\u6784\u4f53\u91cc\u6709\u4e2a\u6307\u5411\u538b\u7f29\u5217\u8868\u7684\u6307\u9488 *zl\u3002</p> <p>\u6211\u753b\u4e86\u4e00\u5f20\u56fe\uff0c\u65b9\u4fbf\u4f60\u7406\u89e3 quicklist \u6570\u636e\u7ed3\u6784\u3002</p> <p></p> <p>\u5728\u5411 quicklist \u6dfb\u52a0\u4e00\u4e2a\u5143\u7d20\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u50cf\u666e\u901a\u7684\u94fe\u8868\u90a3\u6837\uff0c\u76f4\u63a5\u65b0\u5efa\u4e00\u4e2a\u94fe\u8868\u8282\u70b9\u3002\u800c\u662f\u4f1a\u68c0\u67e5\u63d2\u5165\u4f4d\u7f6e\u7684\u538b\u7f29\u5217\u8868\u662f\u5426\u80fd\u5bb9\u7eb3\u8be5\u5143\u7d20\uff0c\u5982\u679c\u80fd\u5bb9\u7eb3\u5c31\u76f4\u63a5\u4fdd\u5b58\u5230 quicklistNode \u7ed3\u6784\u91cc\u7684\u538b\u7f29\u5217\u8868\uff0c\u5982\u679c\u4e0d\u80fd\u5bb9\u7eb3\uff0c\u624d\u4f1a\u65b0\u5efa\u4e00\u4e2a\u65b0\u7684 quicklistNode \u7ed3\u6784\u3002</p> <p>quicklist \u4f1a\u63a7\u5236 quicklistNode \u7ed3\u6784\u91cc\u7684\u538b\u7f29\u5217\u8868\u7684\u5927\u5c0f\u6216\u8005\u5143\u7d20\u4e2a\u6570\uff0c\u6765\u89c4\u907f\u6f5c\u5728\u7684\u8fde\u9501\u66f4\u65b0\u7684\u98ce\u9669\uff0c\u4f46\u662f\u8fd9\u5e76\u6ca1\u6709\u5b8c\u5168\u89e3\u51b3\u8fde\u9501\u66f4\u65b0\u7684\u95ee\u9898\u3002</p>"},{"location":"redis/data_struct/data_struct/#listpack","title":"listpack","text":"<p>quicklist \u867d\u7136\u901a\u8fc7\u63a7\u5236 quicklistNode \u7ed3\u6784\u91cc\u7684\u538b\u7f29\u5217\u8868\u7684\u5927\u5c0f\u6216\u8005\u5143\u7d20\u4e2a\u6570\uff0c\u6765\u51cf\u5c11\u8fde\u9501\u66f4\u65b0\u5e26\u6765\u7684\u6027\u80fd\u5f71\u54cd\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u5b8c\u5168\u89e3\u51b3\u8fde\u9501\u66f4\u65b0\u7684\u95ee\u9898\u3002</p> <p>\u56e0\u4e3a quicklistNode \u8fd8\u662f\u7528\u4e86\u538b\u7f29\u5217\u8868\u6765\u4fdd\u5b58\u5143\u7d20\uff0c\u538b\u7f29\u5217\u8868\u8fde\u9501\u66f4\u65b0\u7684\u95ee\u9898\uff0c\u6765\u6e90\u4e8e\u5b83\u7684\u7ed3\u6784\u8bbe\u8ba1\uff0c\u6240\u4ee5\u8981\u60f3\u5f7b\u5e95\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u9700\u8981\u8bbe\u8ba1\u4e00\u4e2a\u65b0\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p>\u4e8e\u662f\uff0cRedis \u5728 5.0 \u65b0\u8bbe\u8ba1\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\u53eb listpack\uff0c\u76ee\u7684\u662f\u66ff\u4ee3\u538b\u7f29\u5217\u8868\uff0c\u5b83\u6700\u5927\u7279\u70b9\u662f listpack \u4e2d\u6bcf\u4e2a\u8282\u70b9\u4e0d\u518d\u5305\u542b\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u4e86\uff0c\u538b\u7f29\u5217\u8868\u6bcf\u4e2a\u8282\u70b9\u6b63\u56e0\u4e3a\u9700\u8981\u4fdd\u5b58\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\u5b57\u6bb5\uff0c\u5c31\u4f1a\u6709\u8fde\u9501\u66f4\u65b0\u7684\u9690\u60a3\u3002</p> <p>\u6211\u770b\u4e86 Redis \u7684 Github\uff0c\u5728\u6700\u65b0  6.2 \u53d1\u884c\u7248\u672c\u4e2d\uff0cRedis Hash \u5bf9\u8c61\u3001ZSet \u5bf9\u8c61\u7684\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7684\u538b\u7f29\u5217\u8868\u8fd8\u672a\u88ab\u66ff\u6362\u6210 listpack\uff0c\u800c Redis \u7684\u6700\u65b0\u4ee3\u7801\uff08\u8fd8\u672a\u53d1\u5e03\u7248\u672c\uff09\u5df2\u7ecf\u5c06\u6240\u6709\u7528\u5230\u538b\u7f29\u5217\u8868\u5e95\u5c42\u6570\u636e\u7ed3\u6784\u7684 Redis \u5bf9\u8c61\u66ff\u6362\u6210 listpack \u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\uff0c\u4f30\u8ba1\u4e0d\u4e45\u5c06\u6765\uff0cRedis \u5c31\u4f1a\u53d1\u5e03\u4e00\u4e2a\u5c06\u538b\u7f29\u5217\u8868\u4e3a listpack \u7684\u53d1\u884c\u7248\u672c\u3002</p>"},{"location":"redis/data_struct/data_struct/#listpack_1","title":"listpack \u7ed3\u6784\u8bbe\u8ba1","text":"<p>listpack \u91c7\u7528\u4e86\u538b\u7f29\u5217\u8868\u7684\u5f88\u591a\u4f18\u79c0\u7684\u8bbe\u8ba1\uff0c\u6bd4\u5982\u8fd8\u662f\u7528\u4e00\u5757\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\u6765\u7d27\u51d1\u5730\u4fdd\u5b58\u6570\u636e\uff0c\u5e76\u4e14\u4e3a\u4e86\u8282\u7701\u5185\u5b58\u7684\u5f00\u9500\uff0clistpack \u8282\u70b9\u4f1a\u91c7\u7528\u4e0d\u540c\u7684\u7f16\u7801\u65b9\u5f0f\u4fdd\u5b58\u4e0d\u540c\u5927\u5c0f\u7684\u6570\u636e\u3002</p> <p>\u6211\u4eec\u5148\u770b\u770b listpack \u7ed3\u6784\uff1a</p> <p></p> <p>listpack \u5934\u5305\u542b\u4e24\u4e2a\u5c5e\u6027\uff0c\u5206\u522b\u8bb0\u5f55\u4e86 listpack \u603b\u5b57\u8282\u6570\u548c\u5143\u7d20\u6570\u91cf\uff0c\u7136\u540e listpack \u672b\u5c3e\u4e5f\u6709\u4e2a\u7ed3\u5c3e\u6807\u8bc6\u3002\u56fe\u4e2d\u7684 listpack entry \u5c31\u662f listpack \u7684\u8282\u70b9\u4e86\u3002</p> <p>\u6bcf\u4e2a listpack \u8282\u70b9\u7ed3\u6784\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e3b\u8981\u5305\u542b\u4e09\u4e2a\u65b9\u9762\u5185\u5bb9\uff1a</p> <ul> <li>encoding\uff0c\u5b9a\u4e49\u8be5\u5143\u7d20\u7684\u7f16\u7801\u7c7b\u578b\uff0c\u4f1a\u5bf9\u4e0d\u540c\u957f\u5ea6\u7684\u6574\u6570\u548c\u5b57\u7b26\u4e32\u8fdb\u884c\u7f16\u7801\uff1b</li> <li>data\uff0c\u5b9e\u9645\u5b58\u653e\u7684\u6570\u636e\uff1b</li> <li>len\uff0cencoding+data \u7684\u603b\u957f\u5ea6\uff1b</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0clistpack \u6ca1\u6709\u538b\u7f29\u5217\u8868\u4e2d\u8bb0\u5f55\u524d\u4e00\u4e2a\u8282\u70b9\u957f\u5ea6\u7684\u5b57\u6bb5\u4e86\uff0clistpack \u53ea\u8bb0\u5f55\u5f53\u524d\u8282\u70b9\u7684\u957f\u5ea6\uff0c\u5f53\u6211\u4eec\u5411 listpack \u52a0\u5165\u4e00\u4e2a\u65b0\u5143\u7d20\u7684\u65f6\u5019\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u8282\u70b9\u7684\u957f\u5ea6\u5b57\u6bb5\u7684\u53d8\u5316\uff0c\u4ece\u800c\u907f\u514d\u4e86\u538b\u7f29\u5217\u8868\u7684\u8fde\u9501\u66f4\u65b0\u95ee\u9898\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b</li> <li>\u300aRedis \u6e90\u7801\u5256\u6790\u4e0e\u5b9e\u6218\u300b</li> </ul>"},{"location":"redis/data_struct/data_struct/#_25","title":"\u603b\u7ed3","text":"<p>\u7ec8\u4e8e\u5b8c\u5de5\u4e86\uff0c\u677e\u4e00\u53e3\u6c14\u3002</p> <p>\u597d\u4e45\u6ca1\u5199\u90a3\u4e48\u957f\u7684\u56fe\u89e3\u6280\u672f\u6587\u5566\uff0c\u8fd9\u6b21\u6f47\u6f47\u6d12\u6d12\u5199\u4e86 1.5 \u4e07\u5b57 + \u753b\u4e86 40 \u591a\u5f20\u56fe\uff0c\u82b1\u8d39\u4e86\u4e0d\u5c11\u65f6\u95f4\uff0c\u53c8\u662f\u770b\u4e66\uff0c\u53c8\u662f\u770b\u6e90\u7801\u3002</p> <p>\u5e0c\u671b\u8fd9\u7bc7\u6587\u7ae0\uff0c\u80fd\u5e2e\u4f60\u7834\u9664 Redis \u6570\u636e\u7ed3\u6784\u7684\u8ff7\u96fe\uff01</p>"},{"location":"redis/data_struct/data_struct/#_26","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u538b\u7f29\u5217\u8868\u7684 entry \u4e3a\u4ec0\u4e48\u8981\u4fdd\u5b58 prevlen \u5462\uff1flistpack \u6539\u6210 len \u4e4b\u540e\u4e0d\u4f1a\u5f71\u54cd\u529f\u80fd\u5417\uff1f</p> <p>\u538b\u7f29\u5217\u8868\u7684 entry \u4fdd\u5b58 prevlen \u662f\u4e3a\u4e86\u5b9e\u73b0\u8282\u70b9\u4ece\u540e\u5f80\u524d\u904d\u5386\uff0c\u77e5\u9053\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u957f\u5ea6\uff0c\u5c31\u53ef\u4ee5\u8ba1\u7b97\u524d\u4e00\u4e2a\u8282\u70b9\u7684\u504f\u79fb\u91cf\u3002</p> <p>listpack \u4e00\u6837\u53ef\u4ee5\u652f\u6301\u4ece\u540e\u5f80\u524d\u904d\u5386\u7684\u3002\u8be6\u7ec6\u7684\u7b97\u6cd5\u53ef\u4ee5\u770b\uff1ahttps://github.com/antirez/listpack/blob/master/listpack.c \u91cc\u7684 lpDecodeBacklen \u51fd\u6570\uff0clpDecodeBacklen \u51fd\u6570\u5c31\u53ef\u4ee5\u4ece\u5f53\u524d\u5217\u8868\u9879\u8d77\u59cb\u4f4d\u7f6e\u7684\u6307\u9488\u5f00\u59cb\uff0c\u5411\u5de6\u9010\u4e2a\u5b57\u8282\u89e3\u6790\uff0c\u5f97\u5230\u524d\u4e00\u9879\u7684 entry-len \u503c\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/module/strategy/","title":"Redis \u8fc7\u671f\u5220\u9664\u7b56\u7565\u548c\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>Redis \u7684\u300c\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u300d\u548c\u300c\u8fc7\u671f\u5220\u9664\u7b56\u7565\u300d\uff0c\u5f88\u591a\u5c0f\u4f19\u4f34\u5bb9\u6613\u6df7\u6dc6\uff0c\u8fd9\u4e24\u4e2a\u673a\u5236\u867d\u7136\u90fd\u662f\u505a\u5220\u9664\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u89e6\u53d1\u7684\u6761\u4ef6\u548c\u4f7f\u7528\u7684\u7b56\u7565\u90fd\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u4eca\u5929\u5c31\u8ddf\u5927\u5bb6\u7406\u4e00\u7406\uff0c\u300c\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u300d\u548c\u300c\u8fc7\u671f\u5220\u9664\u7b56\u7565\u300d\u3002</p> <p>\u53d1\u8f66\uff01</p> <p></p>"},{"location":"redis/module/strategy/#_1","title":"\u8fc7\u671f\u5220\u9664\u7b56\u7565","text":"<p>Redis \u662f\u53ef\u4ee5\u5bf9 key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\uff0c\u56e0\u6b64\u9700\u8981\u6709\u76f8\u5e94\u7684\u673a\u5236\u5c06\u5df2\u8fc7\u671f\u7684\u952e\u503c\u5bf9\u5220\u9664\uff0c\u800c\u505a\u8fd9\u4e2a\u5de5\u4f5c\u7684\u5c31\u662f\u8fc7\u671f\u952e\u503c\u5220\u9664\u7b56\u7565\u3002</p>"},{"location":"redis/module/strategy/#_2","title":"\u5982\u4f55\u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff1f","text":"<p>\u5148\u8bf4\u4e00\u4e0b\u5bf9 key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\u7684\u547d\u4ee4\u3002 \u8bbe\u7f6e key \u8fc7\u671f\u65f6\u95f4\u7684\u547d\u4ee4\u4e00\u5171\u6709 4 \u4e2a\uff1a</p> <ul> <li><code>expire &lt;key&gt; &lt;n&gt;</code>\uff1a\u8bbe\u7f6e key \u5728 n \u79d2\u540e\u8fc7\u671f\uff0c\u6bd4\u5982 expire key 100 \u8868\u793a\u8bbe\u7f6e key \u5728 100 \u79d2\u540e\u8fc7\u671f\uff1b</li> <li><code>pexpire &lt;key&gt; &lt;n&gt;</code>\uff1a\u8bbe\u7f6e key \u5728 n \u6beb\u79d2\u540e\u8fc7\u671f\uff0c\u6bd4\u5982 pexpire key2 100000 \u8868\u793a\u8bbe\u7f6e key2 \u5728 100000 \u6beb\u79d2\uff08100 \u79d2\uff09\u540e\u8fc7\u671f\u3002</li> <li><code>expireat &lt;key&gt;  &lt;n&gt;</code>\uff1a\u8bbe\u7f6e key \u5728\u67d0\u4e2a\u65f6\u95f4\u6233\uff08\u7cbe\u786e\u5230\u79d2\uff09\u4e4b\u540e\u8fc7\u671f\uff0c\u6bd4\u5982 expireat key3 1655654400 \u8868\u793a key3 \u5728\u65f6\u95f4\u6233 1655654400 \u540e\u8fc7\u671f\uff08\u7cbe\u786e\u5230\u79d2\uff09\uff1b</li> <li><code>pexpireat &lt;key&gt;  &lt;n&gt;</code>\uff1a\u8bbe\u7f6e key \u5728\u67d0\u4e2a\u65f6\u95f4\u6233\uff08\u7cbe\u786e\u5230\u6beb\u79d2\uff09\u4e4b\u540e\u8fc7\u671f\uff0c\u6bd4\u5982 pexpireat key4 1655654400000 \u8868\u793a key4 \u5728\u65f6\u95f4\u6233 1655654400000 \u540e\u8fc7\u671f\uff08\u7cbe\u786e\u5230\u6beb\u79d2\uff09</li> </ul> <p>\u5f53\u7136\uff0c\u5728\u8bbe\u7f6e\u5b57\u7b26\u4e32\u65f6\uff0c\u4e5f\u53ef\u4ee5\u540c\u65f6\u5bf9 key \u8bbe\u7f6e\u8fc7\u671f\u65f6\u95f4\uff0c\u5171\u6709 3 \u79cd\u547d\u4ee4\uff1a</p> <ul> <li><code>set &lt;key&gt;  &lt;value&gt; ex &lt;n&gt;</code> \uff1a\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u65f6\u5019\uff0c\u540c\u65f6\u6307\u5b9a\u8fc7\u671f\u65f6\u95f4\uff08\u7cbe\u786e\u5230\u79d2\uff09\uff1b</li> <li><code>set &lt;key&gt;  &lt;value&gt; px &lt;n&gt;</code> \uff1a\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u65f6\u5019\uff0c\u540c\u65f6\u6307\u5b9a\u8fc7\u671f\u65f6\u95f4\uff08\u7cbe\u786e\u5230\u6beb\u79d2\uff09\uff1b</li> <li><code>setex &lt;key&gt;  &lt;n&gt;  &lt;value&gt;</code>   \uff1a\u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u65f6\u5019\uff0c\u540c\u65f6\u6307\u5b9a\u8fc7\u671f\u65f6\u95f4\uff08\u7cbe\u786e\u5230\u79d2\uff09\u3002</li> </ul> <p>\u5982\u679c\u4f60\u60f3\u67e5\u770b\u67d0\u4e2a key \u5269\u4f59\u7684\u5b58\u6d3b\u65f6\u95f4\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>TTL &lt;key&gt;</code> \u547d\u4ee4\u3002</p> Bash<pre><code># \u8bbe\u7f6e\u952e\u503c\u5bf9\u7684\u65f6\u5019\uff0c\u540c\u65f6\u6307\u5b9a\u8fc7\u671f\u65f6\u95f4\u4f4d 60 \u79d2\n&gt; setex key1 60 value1\nOK\n\n# \u67e5\u770b key1 \u8fc7\u671f\u65f6\u95f4\u8fd8\u5269\u591a\u5c11\n&gt; ttl key1\n(integer) 56\n&gt; ttl key1\n(integer) 52\n</code></pre> <p>\u5982\u679c\u7a81\u7136\u53cd\u6094\uff0c\u53d6\u6d88 key \u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 <code>PERSIST &lt;key&gt;</code> \u547d\u4ee4\u3002</p> Bash<pre><code># \u53d6\u6d88 key1 \u7684\u8fc7\u671f\u65f6\u95f4\n&gt; persist key1\n(integer) 1\n\n# \u4f7f\u7528\u5b8c persist \u547d\u4ee4\u4e4b\u540e\uff0c\n# \u67e5\u4e0b key1 \u7684\u5b58\u6d3b\u65f6\u95f4\u7ed3\u679c\u662f -1\uff0c\u8868\u660e key1 \u6c38\u4e0d\u8fc7\u671f \n&gt; ttl key1 \n(integer) -1\n</code></pre>"},{"location":"redis/module/strategy/#key","title":"\u5982\u4f55\u5224\u5b9a key \u5df2\u8fc7\u671f\u4e86\uff1f","text":"<p>\u6bcf\u5f53\u6211\u4eec\u5bf9\u4e00\u4e2a key \u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u65f6\uff0cRedis  \u4f1a\u628a\u8be5 key \u5e26\u4e0a\u8fc7\u671f\u65f6\u95f4\u5b58\u50a8\u5230\u4e00\u4e2a\u8fc7\u671f\u5b57\u5178\uff08expires dict\uff09\u4e2d\uff0c\u4e5f\u5c31\u662f\u8bf4\u300c\u8fc7\u671f\u5b57\u5178\u300d\u4fdd\u5b58\u4e86\u6570\u636e\u5e93\u4e2d\u6240\u6709 key \u7684\u8fc7\u671f\u65f6\u95f4\u3002</p> <p>\u8fc7\u671f\u5b57\u5178\u5b58\u50a8\u5728 redisDb \u7ed3\u6784\u4e2d\uff0c\u5982\u4e0b\uff1a</p> C<pre><code>typedef struct redisDb {\n    dict *dict;    /* \u6570\u636e\u5e93\u952e\u7a7a\u95f4\uff0c\u5b58\u653e\u7740\u6240\u6709\u7684\u952e\u503c\u5bf9 */\n    dict *expires; /* \u952e\u7684\u8fc7\u671f\u65f6\u95f4 */\n    ....\n} redisDb;\n</code></pre> <p>\u8fc7\u671f\u5b57\u5178\u6570\u636e\u7ed3\u6784\u7ed3\u6784\u5982\u4e0b\uff1a</p> <ul> <li>\u8fc7\u671f\u5b57\u5178\u7684 key \u662f\u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u67d0\u4e2a\u952e\u5bf9\u8c61\uff1b</li> <li>\u8fc7\u671f\u5b57\u5178\u7684 value \u662f\u4e00\u4e2a long long \u7c7b\u578b\u7684\u6574\u6570\uff0c\u8fd9\u4e2a\u6574\u6570\u4fdd\u5b58\u4e86 key \u7684\u8fc7\u671f\u65f6\u95f4\uff1b</li> </ul> <p>\u8fc7\u671f\u5b57\u5178\u7684\u6570\u636e\u7ed3\u6784\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5b57\u5178\u5b9e\u9645\u4e0a\u662f\u54c8\u5e0c\u8868\uff0c\u54c8\u5e0c\u8868\u7684\u6700\u5927\u597d\u5904\u5c31\u662f\u8ba9\u6211\u4eec\u53ef\u4ee5\u7528 O(1) \u7684\u65f6\u95f4\u590d\u6742\u5ea6\u6765\u5feb\u901f\u67e5\u627e\u3002\u5f53\u6211\u4eec\u67e5\u8be2\u4e00\u4e2a key \u65f6\uff0cRedis \u9996\u5148\u68c0\u67e5\u8be5 key \u662f\u5426\u5b58\u5728\u4e8e\u8fc7\u671f\u5b57\u5178\u4e2d\uff1a</p> <ul> <li>\u5982\u679c\u4e0d\u5728\uff0c\u5219\u6b63\u5e38\u8bfb\u53d6\u952e\u503c\uff1b</li> <li>\u5982\u679c\u5b58\u5728\uff0c\u5219\u4f1a\u83b7\u53d6\u8be5 key \u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u7136\u540e\u4e0e\u5f53\u524d\u7cfb\u7edf\u65f6\u95f4\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5982\u679c\u6bd4\u7cfb\u7edf\u65f6\u95f4\u5927\uff0c\u90a3\u5c31\u6ca1\u6709\u8fc7\u671f\uff0c\u5426\u5219\u5224\u5b9a\u8be5 key \u5df2\u8fc7\u671f\u3002</li> </ul> <p>\u8fc7\u671f\u952e\u5224\u65ad\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p>"},{"location":"redis/module/strategy/#_3","title":"\u8fc7\u671f\u5220\u9664\u7b56\u7565\u6709\u54ea\u4e9b\uff1f","text":"<p>\u5728\u8bf4 Redis \u8fc7\u671f\u5220\u9664\u7b56\u7565\u4e4b\u524d\uff0c\u5148\u8ddf\u5927\u5bb6\u4ecb\u7ecd\u4e0b\uff0c\u5e38\u89c1\u7684\u4e09\u79cd\u8fc7\u671f\u5220\u9664\u7b56\u7565\uff1a</p> <ul> <li>\u5b9a\u65f6\u5220\u9664\uff1b</li> <li>\u60f0\u6027\u5220\u9664\uff1b</li> <li>\u5b9a\u671f\u5220\u9664\uff1b</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u522b\u5206\u6790\u5b83\u4eec\u7684\u4f18\u7f3a\u70b9\u3002</p> <p>\u5b9a\u65f6\u5220\u9664\u7b56\u7565\u662f\u600e\u4e48\u6837\u7684\uff1f</p> <p>\u5b9a\u65f6\u5220\u9664\u7b56\u7565\u7684\u505a\u6cd5\u662f\uff0c\u5728\u8bbe\u7f6e key \u7684\u8fc7\u671f\u65f6\u95f4\u65f6\uff0c\u540c\u65f6\u521b\u5efa\u4e00\u4e2a\u5b9a\u65f6\u4e8b\u4ef6\uff0c\u5f53\u65f6\u95f4\u5230\u8fbe\u65f6\uff0c\u7531\u4e8b\u4ef6\u5904\u7406\u5668\u81ea\u52a8\u6267\u884c key \u7684\u5220\u9664\u64cd\u4f5c\u3002</p> <p>\u5b9a\u65f6\u5220\u9664\u7b56\u7565\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u53ef\u4ee5\u4fdd\u8bc1\u8fc7\u671f key \u4f1a\u88ab\u5c3d\u5feb\u5220\u9664\uff0c\u4e5f\u5c31\u662f\u5185\u5b58\u53ef\u4ee5\u88ab\u5c3d\u5feb\u5730\u91ca\u653e\u3002\u56e0\u6b64\uff0c\u5b9a\u65f6\u5220\u9664\u5bf9\u5185\u5b58\u662f\u6700\u53cb\u597d\u7684\u3002</li> </ul> <p>\u5b9a\u65f6\u5220\u9664\u7b56\u7565\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u5728\u8fc7\u671f key \u6bd4\u8f83\u591a\u7684\u60c5\u51b5\u4e0b\uff0c\u5220\u9664\u8fc7\u671f key \u53ef\u80fd\u4f1a\u5360\u7528\u76f8\u5f53\u4e00\u90e8\u5206 CPU \u65f6\u95f4\uff0c\u5728\u5185\u5b58\u4e0d\u7d27\u5f20\u4f46 CPU \u65f6\u95f4\u7d27\u5f20\u7684\u60c5\u51b5\u4e0b\uff0c\u5c06 CPU \u65f6\u95f4\u7528\u4e8e\u5220\u9664\u548c\u5f53\u524d\u4efb\u52a1\u65e0\u5173\u7684\u8fc7\u671f\u952e\u4e0a\uff0c\u65e0\u7591\u4f1a\u5bf9\u670d\u52a1\u5668\u7684\u54cd\u5e94\u65f6\u95f4\u548c\u541e\u5410\u91cf\u9020\u6210\u5f71\u54cd\u3002\u6240\u4ee5\uff0c\u5b9a\u65f6\u5220\u9664\u7b56\u7565\u5bf9 CPU \u4e0d\u53cb\u597d\u3002</li> </ul> <p>\u60f0\u6027\u5220\u9664\u7b56\u7565\u662f\u600e\u4e48\u6837\u7684\uff1f</p> <p>\u60f0\u6027\u5220\u9664\u7b56\u7565\u7684\u505a\u6cd5\u662f\uff0c\u4e0d\u4e3b\u52a8\u5220\u9664\u8fc7\u671f\u952e\uff0c\u6bcf\u6b21\u4ece\u6570\u636e\u5e93\u8bbf\u95ee key \u65f6\uff0c\u90fd\u68c0\u6d4b key \u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u8fc7\u671f\u5219\u5220\u9664\u8be5 key\u3002</p> <p>\u60f0\u6027\u5220\u9664\u7b56\u7565\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u56e0\u4e3a\u6bcf\u6b21\u8bbf\u95ee\u65f6\uff0c\u624d\u4f1a\u68c0\u67e5 key \u662f\u5426\u8fc7\u671f\uff0c\u6240\u4ee5\u6b64\u7b56\u7565\u53ea\u4f1a\u4f7f\u7528\u5f88\u5c11\u7684\u7cfb\u7edf\u8d44\u6e90\uff0c\u56e0\u6b64\uff0c\u60f0\u6027\u5220\u9664\u7b56\u7565\u5bf9 CPU \u65f6\u95f4\u6700\u53cb\u597d\u3002</li> </ul> <p>\u60f0\u6027\u5220\u9664\u7b56\u7565\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u5982\u679c\u4e00\u4e2a key \u5df2\u7ecf\u8fc7\u671f\uff0c\u800c\u8fd9\u4e2a key \u53c8\u4ecd\u7136\u4fdd\u7559\u5728\u6570\u636e\u5e93\u4e2d\uff0c\u90a3\u4e48\u53ea\u8981\u8fd9\u4e2a\u8fc7\u671f key \u4e00\u76f4\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u5b83\u6240\u5360\u7528\u7684\u5185\u5b58\u5c31\u4e0d\u4f1a\u91ca\u653e\uff0c\u9020\u6210\u4e86\u4e00\u5b9a\u7684\u5185\u5b58\u7a7a\u95f4\u6d6a\u8d39\u3002\u6240\u4ee5\uff0c\u60f0\u6027\u5220\u9664\u7b56\u7565\u5bf9\u5185\u5b58\u4e0d\u53cb\u597d\u3002</li> </ul> <p>\u5b9a\u671f\u5220\u9664\u7b56\u7565\u662f\u600e\u4e48\u6837\u7684\uff1f</p> <p>\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7684\u505a\u6cd5\u662f\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u300c\u968f\u673a\u300d\u4ece\u6570\u636e\u5e93\u4e2d\u53d6\u51fa\u4e00\u5b9a\u6570\u91cf\u7684 key \u8fdb\u884c\u68c0\u67e5\uff0c\u5e76\u5220\u9664\u5176\u4e2d\u7684\u8fc7\u671f key\u3002</p> <p>\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u901a\u8fc7\u9650\u5236\u5220\u9664\u64cd\u4f5c\u6267\u884c\u7684\u65f6\u957f\u548c\u9891\u7387\uff0c\u6765\u51cf\u5c11\u5220\u9664\u64cd\u4f5c\u5bf9 CPU \u7684\u5f71\u54cd\uff0c\u540c\u65f6\u4e5f\u80fd\u5220\u9664\u4e00\u90e8\u5206\u8fc7\u671f\u7684\u6570\u636e\u51cf\u5c11\u4e86\u8fc7\u671f\u952e\u5bf9\u7a7a\u95f4\u7684\u65e0\u6548\u5360\u7528\u3002</li> </ul> <p>\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u5185\u5b58\u6e05\u7406\u65b9\u9762\u6ca1\u6709\u5b9a\u65f6\u5220\u9664\u6548\u679c\u597d\uff0c\u540c\u65f6\u6ca1\u6709\u60f0\u6027\u5220\u9664\u4f7f\u7528\u7684\u7cfb\u7edf\u8d44\u6e90\u5c11\u3002</li> <li>\u96be\u4ee5\u786e\u5b9a\u5220\u9664\u64cd\u4f5c\u6267\u884c\u7684\u65f6\u957f\u548c\u9891\u7387\u3002\u5982\u679c\u6267\u884c\u7684\u592a\u9891\u7e41\uff0c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u53d8\u5f97\u548c\u5b9a\u65f6\u5220\u9664\u7b56\u7565\u4e00\u6837\uff0c\u5bf9 CPU \u4e0d\u53cb\u597d\uff1b\u5982\u679c\u6267\u884c\u7684\u592a\u5c11\uff0c\u90a3\u53c8\u548c\u60f0\u6027\u5220\u9664\u4e00\u6837\u4e86\uff0c\u8fc7\u671f key \u5360\u7528\u7684\u5185\u5b58\u4e0d\u4f1a\u53ca\u65f6\u5f97\u5230\u91ca\u653e\u3002</li> </ul>"},{"location":"redis/module/strategy/#redis_1","title":"Redis \u8fc7\u671f\u5220\u9664\u7b56\u7565\u662f\u4ec0\u4e48\uff1f","text":"<p>\u524d\u9762\u4ecb\u7ecd\u4e86\u4e09\u79cd\u8fc7\u671f\u5220\u9664\u7b56\u7565\uff0c\u6bcf\u4e00\u79cd\u90fd\u6709\u4f18\u7f3a\u70b9\uff0c\u4ec5\u4f7f\u7528\u67d0\u4e00\u4e2a\u7b56\u7565\u90fd\u4e0d\u80fd\u6ee1\u8db3\u5b9e\u9645\u9700\u6c42\u3002</p> <p>\u6240\u4ee5\uff0c Redis \u9009\u62e9\u300c\u60f0\u6027\u5220\u9664 + \u5b9a\u671f\u5220\u9664\u300d\u8fd9\u4e24\u79cd\u7b56\u7565\u914d\u548c\u4f7f\u7528\uff0c\u4ee5\u6c42\u5728\u5408\u7406\u4f7f\u7528 CPU \u65f6\u95f4\u548c\u907f\u514d\u5185\u5b58\u6d6a\u8d39\u4e4b\u95f4\u53d6\u5f97\u5e73\u8861\u3002</p> <p>Redis \u662f\u600e\u4e48\u5b9e\u73b0\u60f0\u6027\u5220\u9664\u7684\uff1f</p> <p>Redis \u7684\u60f0\u6027\u5220\u9664\u7b56\u7565\u7531 db.c \u6587\u4ef6\u4e2d\u7684 <code>expireIfNeeded</code> \u51fd\u6570\u5b9e\u73b0\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> C<pre><code>int expireIfNeeded(redisDb *db, robj *key) {\n    // \u5224\u65ad key \u662f\u5426\u8fc7\u671f\n    if (!keyIsExpired(db,key)) return 0;\n    ....\n    /* \u5220\u9664\u8fc7\u671f\u952e */\n    ....\n    // \u5982\u679c server.lazyfree_lazy_expire \u4e3a 1 \u8868\u793a\u5f02\u6b65\u5220\u9664\uff0c\u53cd\u4e4b\u540c\u6b65\u5220\u9664\uff1b\n    return server.lazyfree_lazy_expire ? dbAsyncDelete(db,key) :\n                                         dbSyncDelete(db,key);\n}\n</code></pre> <p>Redis \u5728\u8bbf\u95ee\u6216\u8005\u4fee\u6539 key \u4e4b\u524d\uff0c\u90fd\u4f1a\u8c03\u7528 expireIfNeeded \u51fd\u6570\u5bf9\u5176\u8fdb\u884c\u68c0\u67e5\uff0c\u68c0\u67e5 key \u662f\u5426\u8fc7\u671f\uff1a</p> <ul> <li>\u5982\u679c\u8fc7\u671f\uff0c\u5219\u5220\u9664\u8be5 key\uff0c\u81f3\u4e8e\u9009\u62e9\u5f02\u6b65\u5220\u9664\uff0c\u8fd8\u662f\u9009\u62e9\u540c\u6b65\u5220\u9664\uff0c\u6839\u636e <code>lazyfree-lazy-expire</code> \u53c2\u6570\u914d\u7f6e\u51b3\u5b9a\uff08Redis 4.0 \u7248\u672c\u5f00\u59cb\u63d0\u4f9b\u53c2\u6570\uff09\uff0c\u7136\u540e\u8fd4\u56de null \u5ba2\u6237\u7aef\uff1b</li> <li>\u5982\u679c\u6ca1\u6709\u8fc7\u671f\uff0c\u4e0d\u505a\u4efb\u4f55\u5904\u7406\uff0c\u7136\u540e\u8fd4\u56de\u6b63\u5e38\u7684\u952e\u503c\u5bf9\u7ed9\u5ba2\u6237\u7aef\uff1b</li> </ul> <p>\u60f0\u6027\u5220\u9664\u7684\u6d41\u7a0b\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>Redis \u662f\u600e\u4e48\u5b9e\u73b0\u5b9a\u671f\u5220\u9664\u7684\uff1f</p> <p>\u518d\u56de\u5fc6\u4e00\u4e0b\uff0c\u5b9a\u671f\u5220\u9664\u7b56\u7565\u7684\u505a\u6cd5\uff1a\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u300c\u968f\u673a\u300d\u4ece\u6570\u636e\u5e93\u4e2d\u53d6\u51fa\u4e00\u5b9a\u6570\u91cf\u7684 key \u8fdb\u884c\u68c0\u67e5\uff0c\u5e76\u5220\u9664\u5176\u4e2d\u7684\u8fc7\u671f key\u3002</p> <p>1\u3001\u8fd9\u4e2a\u95f4\u9694\u68c0\u67e5\u7684\u65f6\u95f4\u662f\u591a\u957f\u5462\uff1f</p> <p>\u5728 Redis \u4e2d\uff0c\u9ed8\u8ba4\u6bcf\u79d2\u8fdb\u884c 10 \u6b21\u8fc7\u671f\u68c0\u67e5\u4e00\u6b21\u6570\u636e\u5e93\uff0c\u6b64\u914d\u7f6e\u53ef\u901a\u8fc7 Redis \u7684\u914d\u7f6e\u6587\u4ef6 redis.conf \u8fdb\u884c\u914d\u7f6e\uff0c\u914d\u7f6e\u952e\u4e3a hz \u5b83\u7684\u9ed8\u8ba4\u503c\u662f hz 10\u3002</p> <p>\u7279\u522b\u5f3a\u8c03\u4e0b\uff0c\u6bcf\u6b21\u68c0\u67e5\u6570\u636e\u5e93\u5e76\u4e0d\u662f\u904d\u5386\u8fc7\u671f\u5b57\u5178\u4e2d\u7684\u6240\u6709 key\uff0c\u800c\u662f\u4ece\u6570\u636e\u5e93\u4e2d\u968f\u673a\u62bd\u53d6\u4e00\u5b9a\u6570\u91cf\u7684 key \u8fdb\u884c\u8fc7\u671f\u68c0\u67e5\u3002</p> <p>2\u3001\u968f\u673a\u62bd\u67e5\u7684\u6570\u91cf\u662f\u591a\u5c11\u5462\uff1f</p> <p>\u6211\u67e5\u4e86\u4e0b\u6e90\u7801\uff0c\u5b9a\u671f\u5220\u9664\u7684\u5b9e\u73b0\u5728 expire.c \u6587\u4ef6\u4e0b\u7684 <code>activeExpireCycle</code> \u51fd\u6570\u4e2d\uff0c\u5176\u4e2d\u968f\u673a\u62bd\u67e5\u7684\u6570\u91cf\u7531 <code>ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP</code> \u5b9a\u4e49\u7684\uff0c\u5b83\u662f\u5199\u6b7b\u5728\u4ee3\u7801\u4e2d\u7684\uff0c\u6570\u503c\u662f 20\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6570\u636e\u5e93\u6bcf\u8f6e\u62bd\u67e5\u65f6\uff0c\u4f1a\u968f\u673a\u9009\u62e9 20 \u4e2a key \u5224\u65ad\u662f\u5426\u8fc7\u671f\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8be6\u7ec6\u8bf4\u8bf4 Redis \u7684\u5b9a\u671f\u5220\u9664\u7684\u6d41\u7a0b\uff1a</p> <ol> <li>\u4ece\u8fc7\u671f\u5b57\u5178\u4e2d\u968f\u673a\u62bd\u53d6 20 \u4e2a key\uff1b</li> <li>\u68c0\u67e5\u8fd9 20 \u4e2a key \u662f\u5426\u8fc7\u671f\uff0c\u5e76\u5220\u9664\u5df2\u8fc7\u671f\u7684 key\uff1b</li> <li>\u5982\u679c\u672c\u8f6e\u68c0\u67e5\u7684\u5df2\u8fc7\u671f key \u7684\u6570\u91cf\uff0c\u8d85\u8fc7 5 \u4e2a\uff0820/4\uff09\uff0c\u4e5f\u5c31\u662f\u300c\u5df2\u8fc7\u671f key \u7684\u6570\u91cf\u300d\u5360\u6bd4\u300c\u968f\u673a\u62bd\u53d6 key \u7684\u6570\u91cf\u300d\u5927\u4e8e 25%\uff0c\u5219\u7ee7\u7eed\u91cd\u590d\u6b65\u9aa4 1\uff1b\u5982\u679c\u5df2\u8fc7\u671f\u7684 key \u6bd4\u4f8b\u5c0f\u4e8e 25%\uff0c\u5219\u505c\u6b62\u7ee7\u7eed\u5220\u9664\u8fc7\u671f key\uff0c\u7136\u540e\u7b49\u5f85\u4e0b\u4e00\u8f6e\u518d\u68c0\u67e5\u3002</li> </ol> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5b9a\u671f\u5220\u9664\u662f\u4e00\u4e2a\u5faa\u73af\u7684\u6d41\u7a0b\u3002</p> <p>\u90a3 Redis \u4e3a\u4e86\u4fdd\u8bc1\u5b9a\u671f\u5220\u9664\u4e0d\u4f1a\u51fa\u73b0\u5faa\u73af\u8fc7\u5ea6\uff0c\u5bfc\u81f4\u7ebf\u7a0b\u5361\u6b7b\u73b0\u8c61\uff0c\u4e3a\u6b64\u589e\u52a0\u4e86\u5b9a\u671f\u5220\u9664\u5faa\u73af\u6d41\u7a0b\u7684\u65f6\u95f4\u4e0a\u9650\uff0c\u9ed8\u8ba4\u4e0d\u4f1a\u8d85\u8fc7 25ms\u3002</p> <p>\u9488\u5bf9\u5b9a\u671f\u5220\u9664\u7684\u6d41\u7a0b\uff0c\u6211\u5199\u4e86\u4e2a\u4f2a\u4ee3\u7801\uff1a</p> C<pre><code>do {\n    //\u5df2\u8fc7\u671f\u7684\u6570\u91cf\n    expired = 0\uff1b\n    //\u968f\u673a\u62bd\u53d6\u7684\u6570\u91cf\n    num = 20;\n    while (num--) {\n        //1. \u4ece\u8fc7\u671f\u5b57\u5178\u4e2d\u968f\u673a\u62bd\u53d6 1 \u4e2a key\n        //2. \u5224\u65ad\u8be5 key \u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u5df2\u8fc7\u671f\u5219\u8fdb\u884c\u5220\u9664\uff0c\u540c\u65f6\u5bf9 expired++\n    }\n\n    // \u8d85\u8fc7\u65f6\u95f4\u9650\u5236\u5219\u9000\u51fa\n    if (timelimit_exit) return;\n\n  /* \u5982\u679c\u672c\u8f6e\u68c0\u67e5\u7684\u5df2\u8fc7\u671f key \u7684\u6570\u91cf\uff0c\u8d85\u8fc7 25%\uff0c\u5219\u7ee7\u7eed\u968f\u673a\u62bd\u67e5\uff0c\u5426\u5219\u9000\u51fa\u672c\u8f6e\u68c0\u67e5 */\n} while (expired &gt; 20/4); \n</code></pre> <p>\u5b9a\u671f\u5220\u9664\u7684\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"redis/module/strategy/#_4","title":"\u5185\u5b58\u6dd8\u6c70\u7b56\u7565","text":"<p>\u524d\u9762\u8bf4\u7684\u8fc7\u671f\u5220\u9664\u7b56\u7565\uff0c\u662f\u5220\u9664\u5df2\u8fc7\u671f\u7684 key\uff0c\u800c\u5f53 Redis \u7684\u8fd0\u884c\u5185\u5b58\u5df2\u7ecf\u8d85\u8fc7 Redis \u8bbe\u7f6e\u7684\u6700\u5927\u5185\u5b58\u4e4b\u540e\uff0c\u5219\u4f1a\u4f7f\u7528\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u5220\u9664\u7b26\u5408\u6761\u4ef6\u7684 key\uff0c\u4ee5\u6b64\u6765\u4fdd\u969c Redis \u9ad8\u6548\u7684\u8fd0\u884c\u3002</p>"},{"location":"redis/module/strategy/#redis_2","title":"\u5982\u4f55\u8bbe\u7f6e Redis \u6700\u5927\u8fd0\u884c\u5185\u5b58\uff1f","text":"<p>\u5728\u914d\u7f6e\u6587\u4ef6 redis.conf \u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570 <code>maxmemory &lt;bytes&gt;</code> \u6765\u8bbe\u5b9a\u6700\u5927\u8fd0\u884c\u5185\u5b58\uff0c\u53ea\u6709\u5728 Redis \u7684\u8fd0\u884c\u5185\u5b58\u8fbe\u5230\u4e86\u6211\u4eec\u8bbe\u7f6e\u7684\u6700\u5927\u8fd0\u884c\u5185\u5b58\uff0c\u624d\u4f1a\u89e6\u53d1\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u3002 \u4e0d\u540c\u4f4d\u6570\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0cmaxmemory \u7684\u9ed8\u8ba4\u503c\u662f\u4e0d\u540c\u7684\uff1a</p> <ul> <li>\u5728 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0cmaxmemory \u7684\u9ed8\u8ba4\u503c\u662f 0\uff0c\u8868\u793a\u6ca1\u6709\u5185\u5b58\u5927\u5c0f\u9650\u5236\uff0c\u90a3\u4e48\u4e0d\u7ba1\u7528\u6237\u5b58\u653e\u591a\u5c11\u6570\u636e\u5230 Redis \u4e2d\uff0cRedis \u4e5f\u4e0d\u4f1a\u5bf9\u53ef\u7528\u5185\u5b58\u8fdb\u884c\u68c0\u67e5\uff0c\u76f4\u5230 Redis \u5b9e\u4f8b\u56e0\u5185\u5b58\u4e0d\u8db3\u800c\u5d29\u6e83\u4e5f\u65e0\u4f5c\u4e3a\u3002</li> <li>\u5728 32 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0cmaxmemory \u7684\u9ed8\u8ba4\u503c\u662f 3G\uff0c\u56e0\u4e3a 32 \u4f4d\u7684\u673a\u5668\u6700\u5927\u53ea\u652f\u6301 4GB \u7684\u5185\u5b58\uff0c\u800c\u7cfb\u7edf\u672c\u8eab\u5c31\u9700\u8981\u4e00\u5b9a\u7684\u5185\u5b58\u8d44\u6e90\u6765\u652f\u6301\u8fd0\u884c\uff0c\u6240\u4ee5 32 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u9650\u5236\u6700\u5927 3 GB \u7684\u53ef\u7528\u5185\u5b58\u662f\u975e\u5e38\u5408\u7406\u7684\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u56e0\u4e3a\u5185\u5b58\u4e0d\u8db3\u800c\u5bfc\u81f4 Redis \u5b9e\u4f8b\u5d29\u6e83\u3002</li> </ul>"},{"location":"redis/module/strategy/#redis_3","title":"Redis \u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6709\u54ea\u4e9b\uff1f","text":"<p>Redis \u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u5171\u6709\u516b\u79cd\uff0c\u8fd9\u516b\u79cd\u7b56\u7565\u5927\u4f53\u5206\u4e3a\u300c\u4e0d\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u300d\u548c\u300c\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u300d\u4e24\u7c7b\u7b56\u7565\u3002</p> <p>1\u3001\u4e0d\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u7684\u7b56\u7565</p> <p>noeviction\uff08Redis3.0 \u4e4b\u540e\uff0c\u9ed8\u8ba4\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff09 \uff1a\u5b83\u8868\u793a\u5f53\u8fd0\u884c\u5185\u5b58\u8d85\u8fc7\u6700\u5927\u8bbe\u7f6e\u5185\u5b58\u65f6\uff0c\u4e0d\u6dd8\u6c70\u4efb\u4f55\u6570\u636e\uff0c\u8fd9\u65f6\u5982\u679c\u6709\u65b0\u7684\u6570\u636e\u5199\u5165\uff0c\u5219\u4f1a\u89e6\u53d1 OOM\uff0c\u4f46\u662f\u5982\u679c\u6ca1\u6709\u6570\u636e\u5199\u5165\u7684\u8bdd\uff0c\u53ea\u662f\u5355\u7eaf\u7684\u67e5\u8be2\u6216\u8005\u5220\u9664\u64cd\u4f5c\u7684\u8bdd\uff0c\u8fd8\u662f\u53ef\u4ee5\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>2\u3001\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u7684\u7b56\u7565</p> <p>\u9488\u5bf9\u300c\u8fdb\u884c\u6570\u636e\u6dd8\u6c70\u300d\u8fd9\u4e00\u7c7b\u7b56\u7565\uff0c\u53c8\u53ef\u4ee5\u7ec6\u5206\u4e3a\u300c\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u4e2d\u8fdb\u884c\u6dd8\u6c70\u300d\u548c\u300c\u5728\u6240\u6709\u6570\u636e\u8303\u56f4\u5185\u8fdb\u884c\u6dd8\u6c70\u300d\u8fd9\u4e24\u7c7b\u7b56\u7565\u3002</p> <p>\u5728\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u6570\u636e\u4e2d\u8fdb\u884c\u6dd8\u6c70\uff1a</p> <ul> <li>volatile-random\uff1a\u968f\u673a\u6dd8\u6c70\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u4efb\u610f\u952e\u503c\uff1b</li> <li>volatile-ttl\uff1a\u4f18\u5148\u6dd8\u6c70\u66f4\u65e9\u8fc7\u671f\u7684\u952e\u503c\u3002</li> <li>volatile-lru\uff08Redis3.0 \u4e4b\u524d\uff0c\u9ed8\u8ba4\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff09\uff1a\u6dd8\u6c70\u6240\u6709\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u4e2d\uff0c\u6700\u4e45\u672a\u4f7f\u7528\u7684\u952e\u503c\uff1b</li> <li>volatile-lfu\uff08Redis 4.0 \u540e\u65b0\u589e\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff09\uff1a\u6dd8\u6c70\u6240\u6709\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u7684\u952e\u503c\u4e2d\uff0c\u6700\u5c11\u4f7f\u7528\u7684\u952e\u503c\uff1b</li> </ul> <p>\u5728\u6240\u6709\u6570\u636e\u8303\u56f4\u5185\u8fdb\u884c\u6dd8\u6c70\uff1a</p> <ul> <li>allkeys-random\uff1a\u968f\u673a\u6dd8\u6c70\u4efb\u610f\u952e\u503c;</li> <li>allkeys-lru\uff1a\u6dd8\u6c70\u6574\u4e2a\u952e\u503c\u4e2d\u6700\u4e45\u672a\u4f7f\u7528\u7684\u952e\u503c\uff1b</li> <li>allkeys-lfu\uff08Redis 4.0 \u540e\u65b0\u589e\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff09\uff1a\u6dd8\u6c70\u6574\u4e2a\u952e\u503c\u4e2d\u6700\u5c11\u4f7f\u7528\u7684\u952e\u503c\u3002</li> </ul> <p>\u5982\u4f55\u67e5\u770b\u5f53\u524d Redis \u4f7f\u7528\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff1f</p> <p>\u53ef\u4ee5\u4f7f\u7528 <code>config get maxmemory-policy</code> \u547d\u4ee4\uff0c\u6765\u67e5\u770b\u5f53\u524d Redis \u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> Bash<pre><code>127.0.0.1:6379&gt; config get maxmemory-policy\n1) \"maxmemory-policy\"\n2) \"noeviction\"\n</code></pre> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u5f53\u524d Redis \u4f7f\u7528\u7684\u662f <code>noeviction</code> \u7c7b\u578b\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u5b83\u662f Redis 3.0 \u4e4b\u540e\u9ed8\u8ba4\u4f7f\u7528\u7684\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u8868\u793a\u5f53\u8fd0\u884c\u5185\u5b58\u8d85\u8fc7\u6700\u5927\u8bbe\u7f6e\u5185\u5b58\u65f6\uff0c\u4e0d\u6dd8\u6c70\u4efb\u4f55\u6570\u636e\uff0c\u4f46\u65b0\u589e\u64cd\u4f5c\u4f1a\u62a5\u9519\u3002</p> <p>\u5982\u4f55\u4fee\u6539 Redis \u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff1f</p> <p>\u8bbe\u7f6e\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u6709\u4e24\u79cd\u65b9\u6cd5\uff1a</p> <ul> <li>\u65b9\u5f0f\u4e00\uff1a\u901a\u8fc7\u201c<code>config set maxmemory-policy &lt;\u7b56\u7565&gt;</code>\u201d\u547d\u4ee4\u8bbe\u7f6e\u3002\u5b83\u7684\u4f18\u70b9\u662f\u8bbe\u7f6e\u4e4b\u540e\u7acb\u5373\u751f\u6548\uff0c\u4e0d\u9700\u8981\u91cd\u542f Redis \u670d\u52a1\uff0c\u7f3a\u70b9\u662f\u91cd\u542f Redis \u4e4b\u540e\uff0c\u8bbe\u7f6e\u5c31\u4f1a\u5931\u6548\u3002</li> <li>\u65b9\u5f0f\u4e8c\uff1a\u901a\u8fc7\u4fee\u6539 Redis \u914d\u7f6e\u6587\u4ef6\u4fee\u6539\uff0c\u8bbe\u7f6e\u201c<code>maxmemory-policy &lt;\u7b56\u7565&gt;</code>\u201d\uff0c\u5b83\u7684\u4f18\u70b9\u662f\u91cd\u542f Redis \u670d\u52a1\u540e\u914d\u7f6e\u4e0d\u4f1a\u4e22\u5931\uff0c\u7f3a\u70b9\u662f\u5fc5\u987b\u91cd\u542f Redis \u670d\u52a1\uff0c\u8bbe\u7f6e\u624d\u80fd\u751f\u6548\u3002</li> </ul>"},{"location":"redis/module/strategy/#lru-lfu","title":"LRU \u7b97\u6cd5\u548c LFU \u7b97\u6cd5\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>LFU \u5185\u5b58\u6dd8\u6c70\u7b97\u6cd5\u662f Redis  4.0 \u4e4b\u540e\u65b0\u589e\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u90a3\u4e3a\u4ec0\u4e48\u8981\u65b0\u589e\u8fd9\u4e2a\u7b97\u6cd5\uff1f\u90a3\u80af\u5b9a\u662f\u4e3a\u4e86\u89e3\u51b3 LRU \u7b97\u6cd5\u7684\u95ee\u9898\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u770b\u770b\u8fd9\u4e24\u4e2a\u7b97\u6cd5\u6709\u4ec0\u4e48\u533a\u522b\uff1fRedis \u53c8\u662f\u5982\u4f55\u5b9e\u73b0\u8fd9\u4e24\u4e2a\u7b97\u6cd5\u7684\uff1f</p> <p>\u4ec0\u4e48\u662f LRU \u7b97\u6cd5\uff1f</p> <p>LRU \u5168\u79f0\u662f Least Recently Used \u7ffb\u8bd1\u4e3a\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\uff0c\u4f1a\u9009\u62e9\u6dd8\u6c70\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u6570\u636e\u3002</p> <p>\u4f20\u7edf LRU \u7b97\u6cd5\u7684\u5b9e\u73b0\u662f\u57fa\u4e8e\u300c\u94fe\u8868\u300d\u7ed3\u6784\uff0c\u94fe\u8868\u4e2d\u7684\u5143\u7d20\u6309\u7167\u64cd\u4f5c\u987a\u5e8f\u4ece\u524d\u5f80\u540e\u6392\u5217\uff0c\u6700\u65b0\u64cd\u4f5c\u7684\u952e\u4f1a\u88ab\u79fb\u52a8\u5230\u8868\u5934\uff0c\u5f53\u9700\u8981\u5185\u5b58\u6dd8\u6c70\u65f6\uff0c\u53ea\u9700\u8981\u5220\u9664\u94fe\u8868\u5c3e\u90e8\u7684\u5143\u7d20\u5373\u53ef\uff0c\u56e0\u4e3a\u94fe\u8868\u5c3e\u90e8\u7684\u5143\u7d20\u5c31\u4ee3\u8868\u6700\u4e45\u672a\u88ab\u4f7f\u7528\u7684\u5143\u7d20\u3002</p> <p>Redis \u5e76\u6ca1\u6709\u4f7f\u7528\u8fd9\u6837\u7684\u65b9\u5f0f\u5b9e\u73b0 LRU \u7b97\u6cd5\uff0c\u56e0\u4e3a\u4f20\u7edf\u7684 LRU \u7b97\u6cd5\u5b58\u5728\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u9700\u8981\u7528\u94fe\u8868\u7ba1\u7406\u6240\u6709\u7684\u7f13\u5b58\u6570\u636e\uff0c\u8fd9\u4f1a\u5e26\u6765\u989d\u5916\u7684\u7a7a\u95f4\u5f00\u9500\uff1b</li> <li>\u5f53\u6709\u6570\u636e\u88ab\u8bbf\u95ee\u65f6\uff0c\u9700\u8981\u5728\u94fe\u8868\u4e0a\u628a\u8be5\u6570\u636e\u79fb\u52a8\u5230\u5934\u7aef\uff0c\u5982\u679c\u6709\u5927\u91cf\u6570\u636e\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u5e26\u6765\u5f88\u591a\u94fe\u8868\u79fb\u52a8\u64cd\u4f5c\uff0c\u4f1a\u5f88\u8017\u65f6\uff0c\u8fdb\u800c\u4f1a\u964d\u4f4e Redis \u7f13\u5b58\u6027\u80fd\u3002</li> </ul> <p>Redis \u662f\u5982\u4f55\u5b9e\u73b0 LRU \u7b97\u6cd5\u7684\uff1f</p> <p>Redis \u5b9e\u73b0\u7684\u662f\u4e00\u79cd\u8fd1\u4f3c LRU \u7b97\u6cd5\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u66f4\u597d\u7684\u8282\u7ea6\u5185\u5b58\uff0c\u5b83\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5728 Redis \u7684\u5bf9\u8c61\u7ed3\u6784\u4f53\u4e2d\u6dfb\u52a0\u4e00\u4e2a\u989d\u5916\u7684\u5b57\u6bb5\uff0c\u7528\u4e8e\u8bb0\u5f55\u6b64\u6570\u636e\u7684\u6700\u540e\u4e00\u6b21\u8bbf\u95ee\u65f6\u95f4\u3002</p> <p>\u5f53 Redis \u8fdb\u884c\u5185\u5b58\u6dd8\u6c70\u65f6\uff0c\u4f1a\u4f7f\u7528\u968f\u673a\u91c7\u6837\u7684\u65b9\u5f0f\u6765\u6dd8\u6c70\u6570\u636e\uff0c\u5b83\u662f\u968f\u673a\u53d6 5 \u4e2a\u503c\uff08\u6b64\u503c\u53ef\u914d\u7f6e\uff09\uff0c\u7136\u540e\u6dd8\u6c70\u6700\u4e45\u6ca1\u6709\u4f7f\u7528\u7684\u90a3\u4e2a\u3002</p> <p>Redis \u5b9e\u73b0\u7684 LRU \u7b97\u6cd5\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u4e0d\u7528\u4e3a\u6240\u6709\u7684\u6570\u636e\u7ef4\u62a4\u4e00\u4e2a\u5927\u94fe\u8868\uff0c\u8282\u7701\u4e86\u7a7a\u95f4\u5360\u7528\uff1b</li> <li>\u4e0d\u7528\u5728\u6bcf\u6b21\u6570\u636e\u8bbf\u95ee\u65f6\u90fd\u79fb\u52a8\u94fe\u8868\u9879\uff0c\u63d0\u5347\u4e86\u7f13\u5b58\u7684\u6027\u80fd\uff1b</li> </ul> <p>\u4f46\u662f LRU \u7b97\u6cd5\u6709\u4e00\u4e2a\u95ee\u9898\uff0c\u65e0\u6cd5\u89e3\u51b3\u7f13\u5b58\u6c61\u67d3\u95ee\u9898\uff0c\u6bd4\u5982\u5e94\u7528\u4e00\u6b21\u8bfb\u53d6\u4e86\u5927\u91cf\u7684\u6570\u636e\uff0c\u800c\u8fd9\u4e9b\u6570\u636e\u53ea\u4f1a\u88ab\u8bfb\u53d6\u8fd9\u4e00\u6b21\uff0c\u90a3\u4e48\u8fd9\u4e9b\u6570\u636e\u4f1a\u7559\u5b58\u5728 Redis \u7f13\u5b58\u4e2d\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\uff0c\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002</p> <p>\u56e0\u6b64\uff0c\u5728 Redis 4.0 \u4e4b\u540e\u5f15\u5165\u4e86 LFU \u7b97\u6cd5\u6765\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u4ec0\u4e48\u662f LFU \u7b97\u6cd5\uff1f</p> <p>LFU \u5168\u79f0\u662f Least Frequently Used \u7ffb\u8bd1\u4e3a\u6700\u8fd1\u6700\u4e0d\u5e38\u7528\uff0cLFU \u7b97\u6cd5\u662f\u6839\u636e\u6570\u636e\u8bbf\u95ee\u6b21\u6570\u6765\u6dd8\u6c70\u6570\u636e\u7684\uff0c\u5b83\u7684\u6838\u5fc3\u601d\u60f3\u662f\u201c\u5982\u679c\u6570\u636e\u8fc7\u53bb\u88ab\u8bbf\u95ee\u591a\u6b21\uff0c\u90a3\u4e48\u5c06\u6765\u88ab\u8bbf\u95ee\u7684\u9891\u7387\u4e5f\u66f4\u9ad8\u201d\u3002</p> <p>\u6240\u4ee5\uff0cLFU \u7b97\u6cd5\u4f1a\u8bb0\u5f55\u6bcf\u4e2a\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002\u5f53\u4e00\u4e2a\u6570\u636e\u88ab\u518d\u6b21\u8bbf\u95ee\u65f6\uff0c\u5c31\u4f1a\u589e\u52a0\u8be5\u6570\u636e\u7684\u8bbf\u95ee\u6b21\u6570\u3002\u8fd9\u6837\u5c31\u89e3\u51b3\u4e86\u5076\u5c14\u88ab\u8bbf\u95ee\u4e00\u6b21\u4e4b\u540e\uff0c\u6570\u636e\u7559\u5b58\u5728\u7f13\u5b58\u4e2d\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u7684\u95ee\u9898\uff0c\u76f8\u6bd4\u4e8e LRU \u7b97\u6cd5\u4e5f\u66f4\u5408\u7406\u4e00\u4e9b\u3002</p> <p>Redis \u662f\u5982\u4f55\u5b9e\u73b0 LFU \u7b97\u6cd5\u7684\uff1f</p> <p>LFU \u7b97\u6cd5\u76f8\u6bd4\u4e8e  LRU \u7b97\u6cd5\u7684\u5b9e\u73b0\uff0c\u591a\u8bb0\u5f55\u4e86\u300c\u6570\u636e\u7684\u8bbf\u95ee\u9891\u6b21\u300d\u7684\u4fe1\u606f\u3002Redis \u5bf9\u8c61\u7684\u7ed3\u6784\u5982\u4e0b\uff1a</p> C<pre><code>typedef struct redisObject {\n    ...\n\n    // 24 bits\uff0c\u7528\u4e8e\u8bb0\u5f55\u5bf9\u8c61\u7684\u8bbf\u95ee\u4fe1\u606f\n    unsigned lru:24;  \n    ...\n} robj;\n</code></pre> <p>Redis \u5bf9\u8c61\u5934\u4e2d\u7684 lru \u5b57\u6bb5\uff0c\u5728 LRU \u7b97\u6cd5\u4e0b\u548c LFU \u7b97\u6cd5\u4e0b\u4f7f\u7528\u65b9\u5f0f\u5e76\u4e0d\u76f8\u540c\u3002</p> <p>\u5728 LRU \u7b97\u6cd5\u4e2d\uff0cRedis \u5bf9\u8c61\u5934\u7684 24 bits \u7684 lru \u5b57\u6bb5\u662f\u7528\u6765\u8bb0\u5f55 key \u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff0c\u56e0\u6b64\u5728 LRU \u6a21\u5f0f\u4e0b\uff0cRedis \u53ef\u4ee5\u6839\u636e\u5bf9\u8c61\u5934\u4e2d\u7684 lru \u5b57\u6bb5\u8bb0\u5f55\u7684\u503c\uff0c\u6765\u6bd4\u8f83\u6700\u540e\u4e00\u6b21 key \u7684\u8bbf\u95ee\u65f6\u95f4\u957f\uff0c\u4ece\u800c\u6dd8\u6c70\u6700\u4e45\u672a\u88ab\u4f7f\u7528\u7684 key\u3002</p> <p>\u5728 LFU \u7b97\u6cd5\u4e2d\uff0cRedis \u5bf9\u8c61\u5934\u7684 24 bits \u7684 lru \u5b57\u6bb5\u88ab\u5206\u6210\u4e24\u6bb5\u6765\u5b58\u50a8\uff0c\u9ad8 16bit \u5b58\u50a8 ldt(Last Decrement Time)\uff0c\u4f4e 8bit \u5b58\u50a8 logc(Logistic Counter)\u3002</p> <p></p> <ul> <li>ldt \u662f\u7528\u6765\u8bb0\u5f55 key \u7684\u8bbf\u95ee\u65f6\u95f4\u6233\uff1b</li> <li>logc \u662f\u7528\u6765\u8bb0\u5f55 key \u7684\u8bbf\u95ee\u9891\u6b21\uff0c\u5b83\u7684\u503c\u8d8a\u5c0f\u8868\u793a\u4f7f\u7528\u9891\u7387\u8d8a\u4f4e\uff0c\u8d8a\u5bb9\u6613\u6dd8\u6c70\uff0c\u6bcf\u4e2a\u65b0\u52a0\u5165\u7684 key \u7684 logc \u521d\u59cb\u503c\u4e3a 5\u3002</li> </ul> <p>\u6ce8\u610f\uff0clogc \u5e76\u4e0d\u662f\u5355\u7eaf\u7684\u8bbf\u95ee\u6b21\u6570\uff0c\u800c\u662f\u8bbf\u95ee\u9891\u6b21\uff08\u8bbf\u95ee\u9891\u7387\uff09\uff0c\u56e0\u4e3a logc  \u4f1a\u968f\u65f6\u95f4\u63a8\u79fb\u800c\u8870\u51cf\u7684\u3002</p> <p>\u5728\u6bcf\u6b21 key \u88ab\u8bbf\u95ee\u65f6\uff0c\u4f1a\u5148\u5bf9 logc \u505a\u4e00\u4e2a\u8870\u51cf\u64cd\u4f5c\uff0c\u8870\u51cf\u7684\u503c\u8ddf\u524d\u540e\u8bbf\u95ee\u65f6\u95f4\u7684\u5dee\u8ddd\u6709\u5173\u7cfb\uff0c\u5982\u679c\u4e0a\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u4e0e\u8fd9\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u5dee\u8ddd\u5f88\u5927\uff0c\u90a3\u4e48\u8870\u51cf\u7684\u503c\u5c31\u8d8a\u5927\uff0c\u8fd9\u6837\u5b9e\u73b0\u7684 LFU \u7b97\u6cd5\u662f\u6839\u636e\u8bbf\u95ee\u9891\u7387\u6765\u6dd8\u6c70\u6570\u636e\u7684\uff0c\u800c\u4e0d\u53ea\u662f\u8bbf\u95ee\u6b21\u6570\u3002\u8bbf\u95ee\u9891\u7387\u9700\u8981\u8003\u8651 key \u7684\u8bbf\u95ee\u662f\u591a\u957f\u65f6\u95f4\u6bb5\u5185\u53d1\u751f\u7684\u3002key \u7684\u5148\u524d\u8bbf\u95ee\u8ddd\u79bb\u5f53\u524d\u65f6\u95f4\u8d8a\u957f\uff0c\u90a3\u4e48\u8fd9\u4e2a key \u7684\u8bbf\u95ee\u9891\u7387\u76f8\u5e94\u5730\u4e5f\u5c31\u4f1a\u964d\u4f4e\uff0c\u8fd9\u6837\u88ab\u6dd8\u6c70\u7684\u6982\u7387\u4e5f\u4f1a\u66f4\u5927\u3002</p> <p>\u5bf9 logc \u505a\u5b8c\u8870\u51cf\u64cd\u4f5c\u540e\uff0c\u5c31\u5f00\u59cb\u5bf9 logc  \u8fdb\u884c\u589e\u52a0\u64cd\u4f5c\uff0c\u589e\u52a0\u64cd\u4f5c\u5e76\u4e0d\u662f\u5355\u7eaf\u7684 + 1\uff0c\u800c\u662f\u6839\u636e\u6982\u7387\u589e\u52a0\uff0c\u5982\u679c logc \u8d8a\u5927\u7684 key\uff0c\u5b83\u7684 logc \u5c31\u8d8a\u96be\u518d\u589e\u52a0\u3002</p> <p>\u6240\u4ee5\uff0cRedis \u5728\u8bbf\u95ee key \u65f6\uff0c\u5bf9\u4e8e logc  \u662f\u8fd9\u6837\u53d8\u5316\u7684\uff1a</p> <ol> <li>\u5148\u6309\u7167\u4e0a\u6b21\u8bbf\u95ee\u8ddd\u79bb\u5f53\u524d\u7684\u65f6\u957f\uff0c\u6765\u5bf9 logc \u8fdb\u884c\u8870\u51cf\uff1b</li> <li>\u7136\u540e\uff0c\u518d\u6309\u7167\u4e00\u5b9a\u6982\u7387\u589e\u52a0 logc \u7684\u503c</li> </ol> <p>redis.conf \u63d0\u4f9b\u4e86\u4e24\u4e2a\u914d\u7f6e\u9879\uff0c\u7528\u4e8e\u8c03\u6574 LFU \u7b97\u6cd5\u4ece\u800c\u63a7\u5236 logc \u7684\u589e\u957f\u548c\u8870\u51cf\uff1a</p> <ul> <li><code>lfu-decay-time</code> \u7528\u4e8e\u8c03\u6574 logc \u7684\u8870\u51cf\u901f\u5ea6\uff0c\u5b83\u662f\u4e00\u4e2a\u4ee5\u5206\u949f\u4e3a\u5355\u4f4d\u7684\u6570\u503c\uff0c\u9ed8\u8ba4\u503c\u4e3a 1\uff0clfu-decay-time \u503c\u8d8a\u5927\uff0c\u8870\u51cf\u8d8a\u6162\uff1b</li> <li><code>lfu-log-factor</code> \u7528\u4e8e\u8c03\u6574 logc \u7684\u589e\u957f\u901f\u5ea6\uff0clfu-log-factor \u503c\u8d8a\u5927\uff0clogc \u589e\u957f\u8d8a\u6162\u3002</li> </ul>"},{"location":"redis/module/strategy/#_5","title":"\u603b\u7ed3","text":"<p>Redis \u4f7f\u7528\u7684\u8fc7\u671f\u5220\u9664\u7b56\u7565\u662f\u300c\u60f0\u6027\u5220\u9664 + \u5b9a\u671f\u5220\u9664\u300d\uff0c\u5220\u9664\u7684\u5bf9\u8c61\u662f\u5df2\u8fc7\u671f\u7684 key\u3002</p> <p></p> <p>\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\u662f\u89e3\u51b3\u5185\u5b58\u8fc7\u5927\u7684\u95ee\u9898\uff0c\u5f53 Redis \u7684\u8fd0\u884c\u5185\u5b58\u8d85\u8fc7\u6700\u5927\u8fd0\u884c\u5185\u5b58\u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff0cRedis 4.0 \u4e4b\u540e\u5171\u5b9e\u73b0\u4e86 8 \u79cd\u5185\u5b58\u6dd8\u6c70\u7b56\u7565\uff0c\u6211\u4e5f\u5bf9\u8fd9 8 \u79cd\u7684\u7b56\u7565\u8fdb\u884c\u5206\u7c7b\uff0c\u5982\u4e0b\uff1a</p> <p></p> <p>\u5b8c\uff01</p> <p>\u7b54\u5e94\u6211\uff0c\u4e0b\u6b21\u522b\u518d\u641e\u6df7\u4e86</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/storage/aof/","title":"AOF \u6301\u4e45\u5316\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f","text":""},{"location":"redis/storage/aof/#aof_1","title":"AOF \u65e5\u5fd7","text":"<p>\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c Redis \u6bcf\u6267\u884c\u4e00\u6761\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u5c31\u628a\u8be5\u547d\u4ee4\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u5199\u5165\u5230\u4e00\u4e2a\u6587\u4ef6\u91cc\uff0c\u7136\u540e\u91cd\u542f Redis \u7684\u65f6\u5019\uff0c\u5148\u53bb\u8bfb\u53d6\u8fd9\u4e2a\u6587\u4ef6\u91cc\u7684\u547d\u4ee4\uff0c\u5e76\u4e14\u6267\u884c\u5b83\uff0c\u8fd9\u4e0d\u5c31\u76f8\u5f53\u4e8e\u6062\u590d\u4e86\u7f13\u5b58\u6570\u636e\u4e86\u5417\uff1f</p> <p></p> <p>\u8fd9\u79cd\u4fdd\u5b58\u5199\u64cd\u4f5c\u547d\u4ee4\u5230\u65e5\u5fd7\u7684\u6301\u4e45\u5316\u65b9\u5f0f\uff0c\u5c31\u662f Redis \u91cc\u7684 AOF(Append Only File) \u6301\u4e45\u5316\u529f\u80fd\uff0c\u6ce8\u610f\u53ea\u4f1a\u8bb0\u5f55\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u8bfb\u64cd\u4f5c\u547d\u4ee4\u662f\u4e0d\u4f1a\u88ab\u8bb0\u5f55\u7684\uff0c\u56e0\u4e3a\u6ca1\u610f\u4e49\u3002</p> <p>\u5728 Redis \u4e2d AOF \u6301\u4e45\u5316\u529f\u80fd\u9ed8\u8ba4\u662f\u4e0d\u5f00\u542f\u7684\uff0c\u9700\u8981\u6211\u4eec\u4fee\u6539 <code>redis.conf</code> \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684\u4ee5\u4e0b\u53c2\u6570\uff1a</p> <p></p> <p>AOF \u65e5\u5fd7\u6587\u4ef6\u5176\u5b9e\u5c31\u662f\u666e\u901a\u7684\u6587\u672c\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>cat</code> \u547d\u4ee4\u67e5\u770b\u91cc\u9762\u7684\u5185\u5bb9\uff0c\u4e0d\u8fc7\u91cc\u9762\u7684\u5185\u5bb9\u5982\u679c\u4e0d\u77e5\u9053\u4e00\u5b9a\u7684\u89c4\u5219\u7684\u8bdd\uff0c\u53ef\u80fd\u4f1a\u770b\u4e0d\u61c2\u3002</p> <p>\u6211\u8fd9\u91cc\u4ee5\u300cset name xiaolin\u300d\u547d\u4ee4\u4f5c\u4e3a\u4f8b\u5b50\uff0cRedis \u6267\u884c\u4e86\u8fd9\u6761\u547d\u4ee4\u540e\uff0c\u8bb0\u5f55\u5728 AOF \u65e5\u5fd7\u91cc\u7684\u5185\u5bb9\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6211\u8fd9\u91cc\u7ed9\u5927\u5bb6\u89e3\u91ca\u4e0b\u3002</p> <p>\u300c<code>*3</code>\u300d\u8868\u793a\u5f53\u524d\u547d\u4ee4\u6709\u4e09\u4e2a\u90e8\u5206\uff0c\u6bcf\u90e8\u5206\u90fd\u662f\u4ee5\u300c<code>$+\u6570\u5b57</code>\u300d\u5f00\u5934\uff0c\u540e\u9762\u7d27\u8ddf\u7740\u5177\u4f53\u7684\u547d\u4ee4\u3001\u952e\u6216\u503c\u3002\u7136\u540e\uff0c\u8fd9\u91cc\u7684\u300c<code>\u6570\u5b57</code>\u300d\u8868\u793a\u8fd9\u90e8\u5206\u4e2d\u7684\u547d\u4ee4\u3001\u952e\u6216\u503c\u4e00\u5171\u6709\u591a\u5c11\u5b57\u8282\u3002\u4f8b\u5982\uff0c\u300c<code>$3 set</code>\u300d\u8868\u793a\u8fd9\u90e8\u5206\u6709 3 \u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u662f\u300c<code>set</code>\u300d\u547d\u4ee4\u8fd9\u4e2a\u5b57\u7b26\u4e32\u7684\u957f\u5ea6\u3002</p> <p>\u4e0d\u77e5\u9053\u5927\u5bb6\u6ce8\u610f\u5230\u6ca1\u6709\uff0cRedis \u662f\u5148\u6267\u884c\u5199\u64cd\u4f5c\u547d\u4ee4\u540e\uff0c\u624d\u5c06\u8be5\u547d\u4ee4\u8bb0\u5f55\u5230  AOF \u65e5\u5fd7\u91cc\u7684\uff0c\u8fd9\u4e48\u505a\u5176\u5b9e\u6709\u4e24\u4e2a\u597d\u5904\u3002</p> <p>\u7b2c\u4e00\u4e2a\u597d\u5904\uff0c\u907f\u514d\u989d\u5916\u7684\u68c0\u67e5\u5f00\u9500\u3002</p> <p>\u56e0\u4e3a\u5982\u679c\u5148\u5c06\u5199\u64cd\u4f5c\u547d\u4ee4\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u91cc\uff0c\u518d\u6267\u884c\u8be5\u547d\u4ee4\u7684\u8bdd\uff0c\u5982\u679c\u5f53\u524d\u7684\u547d\u4ee4\u8bed\u6cd5\u6709\u95ee\u9898\uff0c\u90a3\u4e48\u5982\u679c\u4e0d\u8fdb\u884c\u547d\u4ee4\u8bed\u6cd5\u68c0\u67e5\uff0c\u8be5\u9519\u8bef\u7684\u547d\u4ee4\u8bb0\u5f55\u5230 AOF  \u65e5\u5fd7\u91cc\u540e\uff0cRedis \u5728\u4f7f\u7528\u65e5\u5fd7\u6062\u590d\u6570\u636e\u65f6\uff0c\u5c31\u53ef\u80fd\u4f1a\u51fa\u9519\u3002</p> <p>\u800c\u5982\u679c\u5148\u6267\u884c\u5199\u64cd\u4f5c\u547d\u4ee4\u518d\u8bb0\u5f55\u65e5\u5fd7\u7684\u8bdd\uff0c\u53ea\u6709\u5728\u8be5\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\uff0c\u624d\u5c06\u547d\u4ee4\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u91cc\uff0c\u8fd9\u6837\u5c31\u4e0d\u7528\u989d\u5916\u7684\u68c0\u67e5\u5f00\u9500\uff0c\u4fdd\u8bc1\u8bb0\u5f55\u5728 AOF  \u65e5\u5fd7\u91cc\u7684\u547d\u4ee4\u90fd\u662f\u53ef\u6267\u884c\u5e76\u4e14\u6b63\u786e\u7684\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u597d\u5904\uff0c\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u5199\u64cd\u4f5c\u547d\u4ee4\u7684\u6267\u884c\uff0c\u56e0\u4e3a\u5f53\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\uff0c\u624d\u4f1a\u5c06\u547d\u4ee4\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\u3002</p> <p>\u5f53\u7136\uff0cAOF \u6301\u4e45\u5316\u529f\u80fd\u4e5f\u4e0d\u662f\u6ca1\u6709\u6f5c\u5728\u98ce\u9669\u3002</p> <p>\u7b2c\u4e00\u4e2a\u98ce\u9669\uff0c\u6267\u884c\u5199\u64cd\u4f5c\u547d\u4ee4\u548c\u8bb0\u5f55\u65e5\u5fd7\u662f\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u90a3\u5f53 Redis \u5728\u8fd8\u6ca1\u6765\u5f97\u53ca\u5c06\u547d\u4ee4\u5199\u5165\u5230\u786c\u76d8\u65f6\uff0c\u670d\u52a1\u5668\u53d1\u751f\u5b95\u673a\u4e86\uff0c\u8fd9\u4e2a\u6570\u636e\u5c31\u4f1a\u6709\u4e22\u5931\u7684\u98ce\u9669\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u98ce\u9669\uff0c\u524d\u9762\u8bf4\u9053\uff0c\u7531\u4e8e\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u6210\u529f\u540e\u624d\u8bb0\u5f55\u5230 AOF \u65e5\u5fd7\uff0c\u6240\u4ee5\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u5199\u64cd\u4f5c\u547d\u4ee4\u7684\u6267\u884c\uff0c\u4f46\u662f\u53ef\u80fd\u4f1a\u7ed9\u300c\u4e0b\u4e00\u4e2a\u300d\u547d\u4ee4\u5e26\u6765\u963b\u585e\u98ce\u9669\u3002</p> <p>\u56e0\u4e3a\u5c06\u547d\u4ee4\u5199\u5165\u5230\u65e5\u5fd7\u7684\u8fd9\u4e2a\u64cd\u4f5c\u4e5f\u662f\u5728\u4e3b\u8fdb\u7a0b\u5b8c\u6210\u7684\uff08\u6267\u884c\u547d\u4ee4\u4e5f\u662f\u5728\u4e3b\u8fdb\u7a0b\uff09\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u662f\u540c\u6b65\u7684\u3002</p> <p></p> <p>\u5982\u679c\u5728\u5c06\u65e5\u5fd7\u5185\u5bb9\u5199\u5165\u5230\u786c\u76d8\u65f6\uff0c\u670d\u52a1\u5668\u7684\u786c\u76d8\u7684 I/O \u538b\u529b\u592a\u5927\uff0c\u5c31\u4f1a\u5bfc\u81f4\u5199\u786c\u76d8\u7684\u901f\u5ea6\u5f88\u6162\uff0c\u8fdb\u800c\u963b\u585e\u4f4f\u4e86\uff0c\u4e5f\u5c31\u4f1a\u5bfc\u81f4\u540e\u7eed\u7684\u547d\u4ee4\u65e0\u6cd5\u6267\u884c\u3002</p> <p>\u8ba4\u771f\u5206\u6790\u4e00\u4e0b\uff0c\u5176\u5b9e\u8fd9\u4e24\u4e2a\u98ce\u9669\u90fd\u6709\u4e00\u4e2a\u5171\u6027\uff0c\u90fd\u8ddf\u300cAOF \u65e5\u5fd7\u5199\u56de\u786c\u76d8\u7684\u65f6\u673a\u300d\u6709\u5173\u3002</p>"},{"location":"redis/storage/aof/#_1","title":"\u4e09\u79cd\u5199\u56de\u7b56\u7565","text":"<p>Redis \u5199\u5165 AOF \u65e5\u5fd7\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6211\u5148\u6765\u5177\u4f53\u8bf4\u8bf4\uff1a 1. Redis \u6267\u884c\u5b8c\u5199\u64cd\u4f5c\u547d\u4ee4\u540e\uff0c\u4f1a\u5c06\u547d\u4ee4\u8ffd\u52a0\u5230 <code>server.aof_buf</code> \u7f13\u51b2\u533a\uff1b 2. \u7136\u540e\u901a\u8fc7 write() \u7cfb\u7edf\u8c03\u7528\uff0c\u5c06 aof_buf  \u7f13\u51b2\u533a\u7684\u6570\u636e\u5199\u5165\u5230 AOF \u6587\u4ef6\uff0c\u6b64\u65f6\u6570\u636e\u5e76\u6ca1\u6709\u5199\u5165\u5230\u786c\u76d8\uff0c\u800c\u662f\u62f7\u8d1d\u5230\u4e86\u5185\u6838\u7f13\u51b2\u533a page cache\uff0c\u7b49\u5f85\u5185\u6838\u5c06\u6570\u636e\u5199\u5165\u786c\u76d8\uff1b 3. \u5177\u4f53\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u4ec0\u4e48\u65f6\u5019\u5199\u5165\u5230\u786c\u76d8\uff0c\u7531\u5185\u6838\u51b3\u5b9a\u3002</p> <p>Redis \u63d0\u4f9b\u4e86 3 \u79cd\u5199\u56de\u786c\u76d8\u7684\u7b56\u7565\uff0c\u63a7\u5236\u7684\u5c31\u662f\u4e0a\u9762\u8bf4\u7684\u7b2c\u4e09\u6b65\u7684\u8fc7\u7a0b\u3002</p> <p>\u5728 <code>redis.conf</code> \u914d\u7f6e\u6587\u4ef6\u4e2d\u7684 <code>appendfsync</code> \u914d\u7f6e\u9879\u53ef\u4ee5\u6709\u4ee5\u4e0b 3 \u79cd\u53c2\u6570\u53ef\u586b\uff1a - Always\uff0c\u8fd9\u4e2a\u5355\u8bcd\u7684\u610f\u601d\u662f\u300c\u603b\u662f\u300d\uff0c\u6240\u4ee5\u5b83\u7684\u610f\u601d\u662f\u6bcf\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u540c\u6b65\u5c06 AOF \u65e5\u5fd7\u6570\u636e\u5199\u56de\u786c\u76d8\uff1b - Everysec\uff0c\u8fd9\u4e2a\u5355\u8bcd\u7684\u610f\u601d\u662f\u300c\u6bcf\u79d2\u300d\uff0c\u6240\u4ee5\u5b83\u7684\u610f\u601d\u662f\u6bcf\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u5148\u5c06\u547d\u4ee4\u5199\u5165\u5230 AOF \u6587\u4ef6\u7684\u5185\u6838\u7f13\u51b2\u533a\uff0c\u7136\u540e\u6bcf\u9694\u4e00\u79d2\u5c06\u7f13\u51b2\u533a\u91cc\u7684\u5185\u5bb9\u5199\u56de\u5230\u786c\u76d8\uff1b - No\uff0c\u610f\u5473\u7740\u4e0d\u7531 Redis \u63a7\u5236\u5199\u56de\u786c\u76d8\u7684\u65f6\u673a\uff0c\u8f6c\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u5199\u56de\u7684\u65f6\u673a\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u5148\u5c06\u547d\u4ee4\u5199\u5165\u5230 AOF \u6587\u4ef6\u7684\u5185\u6838\u7f13\u51b2\u533a\uff0c\u518d\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f55\u65f6\u5c06\u7f13\u51b2\u533a\u5185\u5bb9\u5199\u56de\u786c\u76d8\u3002</p> <p>\u8fd9 3 \u79cd\u5199\u56de\u7b56\u7565\u90fd\u65e0\u6cd5\u80fd\u5b8c\u7f8e\u89e3\u51b3\u300c\u4e3b\u8fdb\u7a0b\u963b\u585e\u300d\u548c\u300c\u51cf\u5c11\u6570\u636e\u4e22\u5931\u300d\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u4e24\u4e2a\u95ee\u9898\u662f\u5bf9\u7acb\u7684\uff0c\u504f\u5411\u4e8e\u4e00\u8fb9\u7684\u8bdd\uff0c\u5c31\u4f1a\u8981\u727a\u7272\u53e6\u5916\u4e00\u8fb9\uff0c\u539f\u56e0\u5982\u4e0b\uff1a - Always \u7b56\u7565\u7684\u8bdd\uff0c\u53ef\u4ee5\u6700\u5927\u7a0b\u5ea6\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\uff0c\u4f46\u662f\u7531\u4e8e\u5b83\u6bcf\u6267\u884c\u4e00\u6761\u5199\u64cd\u4f5c\u547d\u4ee4\u5c31\u540c\u6b65\u5c06 AOF \u5185\u5bb9\u5199\u56de\u786c\u76d8\uff0c\u6240\u4ee5\u662f\u4e0d\u53ef\u907f\u514d\u4f1a\u5f71\u54cd\u4e3b\u8fdb\u7a0b\u7684\u6027\u80fd\uff1b - No \u7b56\u7565\u7684\u8bdd\uff0c\u662f\u4ea4\u7531\u64cd\u4f5c\u7cfb\u7edf\u6765\u51b3\u5b9a\u4f55\u65f6\u5c06 AOF \u65e5\u5fd7\u5185\u5bb9\u5199\u56de\u786c\u76d8\uff0c\u76f8\u6bd4\u4e8e Always \u7b56\u7565\u6027\u80fd\u8f83\u597d\uff0c\u4f46\u662f\u64cd\u4f5c\u7cfb\u7edf\u5199\u56de\u786c\u76d8\u7684\u65f6\u673a\u662f\u4e0d\u53ef\u9884\u77e5\u7684\uff0c\u5982\u679c AOF \u65e5\u5fd7\u5185\u5bb9\u6ca1\u6709\u5199\u56de\u786c\u76d8\uff0c\u4e00\u65e6\u670d\u52a1\u5668\u5b95\u673a\uff0c\u5c31\u4f1a\u4e22\u5931\u4e0d\u5b9a\u6570\u91cf\u7684\u6570\u636e\u3002 - Everysec \u7b56\u7565\u7684\u8bdd\uff0c\u662f\u6298\u4e2d\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u907f\u514d\u4e86 Always \u7b56\u7565\u7684\u6027\u80fd\u5f00\u9500\uff0c\u4e5f\u6bd4 No \u7b56\u7565\u66f4\u80fd\u907f\u514d\u6570\u636e\u4e22\u5931\uff0c\u5f53\u7136\u5982\u679c\u4e0a\u4e00\u79d2\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\u65e5\u5fd7\u6ca1\u6709\u5199\u56de\u5230\u786c\u76d8\uff0c\u53d1\u751f\u4e86\u5b95\u673a\uff0c\u8fd9\u4e00\u79d2\u5185\u7684\u6570\u636e\u81ea\u7136\u4e5f\u4f1a\u4e22\u5931\u3002</p> <p>\u5927\u5bb6\u6839\u636e\u81ea\u5df1\u7684\u4e1a\u52a1\u573a\u666f\u8fdb\u884c\u9009\u62e9\uff1a - \u5982\u679c\u8981\u9ad8\u6027\u80fd\uff0c\u5c31\u9009\u62e9 No \u7b56\u7565\uff1b - \u5982\u679c\u8981\u9ad8\u53ef\u9760\uff0c\u5c31\u9009\u62e9 Always \u7b56\u7565\uff1b - \u5982\u679c\u5141\u8bb8\u6570\u636e\u4e22\u5931\u4e00\u70b9\uff0c\u4f46\u53c8\u60f3\u6027\u80fd\u9ad8\uff0c\u5c31\u9009\u62e9 Everysec \u7b56\u7565\u3002</p> <p>\u6211\u4e5f\u628a\u8fd9 3 \u4e2a\u5199\u56de\u7b56\u7565\u7684\u4f18\u7f3a\u70b9\u603b\u7ed3\u6210\u4e86\u4e00\u5f20\u8868\u683c\uff1a</p> <p></p> <p>\u5927\u5bb6\u77e5\u9053\u8fd9\u4e09\u79cd\u7b56\u7565\u662f\u600e\u4e48\u5b9e\u73b0\u7684\u5417\uff1f</p> <p>\u6df1\u5165\u5230\u6e90\u7801\u540e\uff0c\u4f60\u5c31\u4f1a\u53d1\u73b0\u8fd9\u4e09\u79cd\u7b56\u7565\u53ea\u662f\u5728\u63a7\u5236 <code>fsync()</code> \u51fd\u6570\u7684\u8c03\u7528\u65f6\u673a\u3002</p> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u5411\u6587\u4ef6\u5199\u5165\u6570\u636e\u65f6\uff0c\u5185\u6838\u901a\u5e38\u5148\u5c06\u6570\u636e\u590d\u5236\u5230\u5185\u6838\u7f13\u51b2\u533a\u4e2d\uff0c\u7136\u540e\u6392\u5165\u961f\u5217\uff0c\u7136\u540e\u7531\u5185\u6838\u51b3\u5b9a\u4f55\u65f6\u5199\u5165\u786c\u76d8\u3002</p> <p></p> <p>\u5982\u679c\u60f3\u8981\u5e94\u7528\u7a0b\u5e8f\u5411\u6587\u4ef6\u5199\u5165\u6570\u636e\u540e\uff0c\u80fd\u7acb\u9a6c\u5c06\u6570\u636e\u540c\u6b65\u5230\u786c\u76d8\uff0c\u5c31\u53ef\u4ee5\u8c03\u7528 <code>fsync()</code> \u51fd\u6570\uff0c\u8fd9\u6837\u5185\u6838\u5c31\u4f1a\u5c06\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u76f4\u63a5\u5199\u5165\u5230\u786c\u76d8\uff0c\u7b49\u5230\u786c\u76d8\u5199\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u8be5\u51fd\u6570\u624d\u4f1a\u8fd4\u56de\u3002</p> <ul> <li>Always \u7b56\u7565\u5c31\u662f\u6bcf\u6b21\u5199\u5165 AOF \u6587\u4ef6\u6570\u636e\u540e\uff0c\u5c31\u6267\u884c fsync() \u51fd\u6570\uff1b</li> <li>Everysec \u7b56\u7565\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1\u6765\u6267\u884c fsync() \u51fd\u6570\uff1b</li> <li>No \u7b56\u7565\u5c31\u662f\u6c38\u4e0d\u6267\u884c fsync() \u51fd\u6570;</li> </ul>"},{"location":"redis/storage/aof/#aof_2","title":"AOF \u91cd\u5199\u673a\u5236","text":"<p>AOF \u65e5\u5fd7\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u968f\u7740\u6267\u884c\u7684\u5199\u64cd\u4f5c\u547d\u4ee4\u8d8a\u6765\u8d8a\u591a\uff0c\u6587\u4ef6\u7684\u5927\u5c0f\u4f1a\u8d8a\u6765\u8d8a\u5927\u3002</p> <p>\u5982\u679c\u5f53 AOF \u65e5\u5fd7\u6587\u4ef6\u8fc7\u5927\u5c31\u4f1a\u5e26\u6765\u6027\u80fd\u95ee\u9898\uff0c\u6bd4\u5982\u91cd\u542f Redis \u540e\uff0c\u9700\u8981\u8bfb AOF \u6587\u4ef6\u7684\u5185\u5bb9\u4ee5\u6062\u590d\u6570\u636e\uff0c\u5982\u679c\u6587\u4ef6\u8fc7\u5927\uff0c\u6574\u4e2a\u6062\u590d\u7684\u8fc7\u7a0b\u5c31\u4f1a\u5f88\u6162\u3002</p> <p>\u6240\u4ee5\uff0cRedis \u4e3a\u4e86\u907f\u514d AOF \u6587\u4ef6\u8d8a\u5199\u8d8a\u5927\uff0c\u63d0\u4f9b\u4e86 AOF \u91cd\u5199\u673a\u5236\uff0c\u5f53 AOF \u6587\u4ef6\u7684\u5927\u5c0f\u8d85\u8fc7\u6240\u8bbe\u5b9a\u7684\u9608\u503c\u540e\uff0cRedis \u5c31\u4f1a\u542f\u7528 AOF \u91cd\u5199\u673a\u5236\uff0c\u6765\u538b\u7f29 AOF \u6587\u4ef6\u3002</p> <p>AOF \u91cd\u5199\u673a\u5236\u662f\u5728\u91cd\u5199\u65f6\uff0c\u8bfb\u53d6\u5f53\u524d\u6570\u636e\u5e93\u4e2d\u7684\u6240\u6709\u952e\u503c\u5bf9\uff0c\u7136\u540e\u5c06\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\u7528\u4e00\u6761\u547d\u4ee4\u8bb0\u5f55\u5230\u300c\u65b0\u7684 AOF \u6587\u4ef6\u300d\uff0c\u7b49\u5230\u5168\u90e8\u8bb0\u5f55\u5b8c\u540e\uff0c\u5c31\u5c06\u65b0\u7684 AOF \u6587\u4ef6\u66ff\u6362\u6389\u73b0\u6709\u7684 AOF \u6587\u4ef6\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5728\u6ca1\u6709\u4f7f\u7528\u91cd\u5199\u673a\u5236\u524d\uff0c\u5047\u8bbe\u524d\u540e\u6267\u884c\u4e86\u300cset name xiaolin\u300d\u548c\u300cset name xiaolincoding\u300d\u8fd9\u4e24\u4e2a\u547d\u4ee4\u7684\u8bdd\uff0c\u5c31\u4f1a\u5c06\u8fd9\u4e24\u4e2a\u547d\u4ee4\u8bb0\u5f55\u5230 AOF \u6587\u4ef6\u3002</p> <p></p> <p>\u4f46\u662f\u5728\u4f7f\u7528\u91cd\u5199\u673a\u5236\u540e\uff0c\u5c31\u4f1a\u8bfb\u53d6 name \u6700\u65b0\u7684 value\uff08\u952e\u503c\u5bf9\uff09 \uff0c\u7136\u540e\u7528\u4e00\u6761\u300cset name xiaolincoding\u300d\u547d\u4ee4\u8bb0\u5f55\u5230\u65b0\u7684 AOF \u6587\u4ef6\uff0c\u4e4b\u524d\u7684\u7b2c\u4e00\u4e2a\u547d\u4ee4\u5c31\u6ca1\u6709\u5fc5\u8981\u8bb0\u5f55\u4e86\uff0c\u56e0\u4e3a\u5b83\u5c5e\u4e8e\u300c\u5386\u53f2\u300d\u547d\u4ee4\uff0c\u6ca1\u6709\u4f5c\u7528\u4e86\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4e00\u4e2a\u952e\u503c\u5bf9\u5728\u91cd\u5199\u65e5\u5fd7\u4e2d\u53ea\u7528\u4e00\u6761\u547d\u4ee4\u5c31\u884c\u4e86\u3002</p> <p>\u91cd\u5199\u5de5\u4f5c\u5b8c\u6210\u540e\uff0c\u5c31\u4f1a\u5c06\u65b0\u7684 AOF \u6587\u4ef6\u8986\u76d6\u73b0\u6709\u7684 AOF \u6587\u4ef6\uff0c\u8fd9\u5c31\u76f8\u5f53\u4e8e\u538b\u7f29\u4e86 AOF \u6587\u4ef6\uff0c\u4f7f\u5f97  AOF \u6587\u4ef6\u4f53\u79ef\u53d8\u5c0f\u4e86\u3002</p> <p>\u7136\u540e\uff0c\u5728\u901a\u8fc7 AOF \u65e5\u5fd7\u6062\u590d\u6570\u636e\u65f6\uff0c\u53ea\u7528\u6267\u884c\u8fd9\u6761\u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u5b8c\u6210\u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u5199\u5165\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u91cd\u5199\u673a\u5236\u7684\u5999\u5904\u5728\u4e8e\uff0c\u5c3d\u7ba1\u67d0\u4e2a\u952e\u503c\u5bf9\u88ab\u591a\u6761\u5199\u547d\u4ee4\u53cd\u590d\u4fee\u6539\uff0c\u6700\u7ec8\u4e5f\u53ea\u9700\u8981\u6839\u636e\u8fd9\u4e2a\u300c\u952e\u503c\u5bf9\u300d\u5f53\u524d\u7684\u6700\u65b0\u72b6\u6001\uff0c\u7136\u540e\u7528\u4e00\u6761\u547d\u4ee4\u53bb\u8bb0\u5f55\u952e\u503c\u5bf9\uff0c\u4ee3\u66ff\u4e4b\u524d\u8bb0\u5f55\u8fd9\u4e2a\u952e\u503c\u5bf9\u7684\u591a\u6761\u547d\u4ee4\uff0c\u8fd9\u6837\u5c31\u51cf\u5c11\u4e86 AOF \u6587\u4ef6\u4e2d\u7684\u547d\u4ee4\u6570\u91cf\u3002\u6700\u540e\u5728\u91cd\u5199\u5de5\u4f5c\u5b8c\u6210\u540e\uff0c\u5c06\u65b0\u7684 AOF \u6587\u4ef6\u8986\u76d6\u73b0\u6709\u7684 AOF \u6587\u4ef6\u3002</p> <p>\u8fd9\u91cc\u8bf4\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u91cd\u5199 AOF \u7684\u65f6\u5019\uff0c\u4e0d\u76f4\u63a5\u590d\u7528\u73b0\u6709\u7684 AOF \u6587\u4ef6\uff0c\u800c\u662f\u5148\u5199\u5230\u65b0\u7684 AOF \u6587\u4ef6\u518d\u8986\u76d6\u8fc7\u53bb\u3002</p> <p>\u56e0\u4e3a\u5982\u679c AOF \u91cd\u5199\u8fc7\u7a0b\u4e2d\u5931\u8d25\u4e86\uff0c\u73b0\u6709\u7684 AOF \u6587\u4ef6\u5c31\u4f1a\u9020\u6210\u6c61\u67d3\uff0c\u53ef\u80fd\u65e0\u6cd5\u7528\u4e8e\u6062\u590d\u4f7f\u7528\u3002</p> <p>\u6240\u4ee5 AOF \u91cd\u5199\u8fc7\u7a0b\uff0c\u5148\u91cd\u5199\u5230\u65b0\u7684 AOF \u6587\u4ef6\uff0c\u91cd\u5199\u5931\u8d25\u7684\u8bdd\uff0c\u5c31\u76f4\u63a5\u5220\u9664\u8fd9\u4e2a\u6587\u4ef6\u5c31\u597d\uff0c\u4e0d\u4f1a\u5bf9\u73b0\u6709\u7684 AOF \u6587\u4ef6\u9020\u6210\u5f71\u54cd\u3002</p>"},{"location":"redis/storage/aof/#aof_3","title":"AOF \u540e\u53f0\u91cd\u5199","text":"<p>\u5199\u5165 AOF \u65e5\u5fd7\u7684\u64cd\u4f5c\u867d\u7136\u662f\u5728\u4e3b\u8fdb\u7a0b\u5b8c\u6210\u7684\uff0c\u56e0\u4e3a\u5b83\u5199\u5165\u7684\u5185\u5bb9\u4e0d\u591a\uff0c\u6240\u4ee5\u4e00\u822c\u4e0d\u592a\u5f71\u54cd\u547d\u4ee4\u7684\u64cd\u4f5c\u3002</p> <p>\u4f46\u662f\u5728\u89e6\u53d1 AOF \u91cd\u5199\u65f6\uff0c\u6bd4\u5982\u5f53 AOF \u6587\u4ef6\u5927\u4e8e 64M \u65f6\uff0c\u5c31\u4f1a\u5bf9 AOF \u6587\u4ef6\u8fdb\u884c\u91cd\u5199\uff0c\u8fd9\u65f6\u662f\u9700\u8981\u8bfb\u53d6\u6240\u6709\u7f13\u5b58\u7684\u952e\u503c\u5bf9\u6570\u636e\uff0c\u5e76\u4e3a\u6bcf\u4e2a\u952e\u503c\u5bf9\u751f\u6210\u4e00\u6761\u547d\u4ee4\uff0c\u7136\u540e\u5c06\u5176\u5199\u5165\u5230\u65b0\u7684 AOF \u6587\u4ef6\uff0c\u91cd\u5199\u5b8c\u540e\uff0c\u5c31\u628a\u73b0\u5728\u7684 AOF \u6587\u4ef6\u66ff\u6362\u6389\u3002</p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u5176\u5b9e\u662f\u5f88\u8017\u65f6\u7684\uff0c\u6240\u4ee5\u91cd\u5199\u7684\u64cd\u4f5c\u4e0d\u80fd\u653e\u5728\u4e3b\u8fdb\u7a0b\u91cc\u3002</p> <p>\u6240\u4ee5\uff0cRedis \u7684\u91cd\u5199 AOF \u8fc7\u7a0b\u662f\u7531\u540e\u53f0\u5b50\u8fdb\u7a0b bgrewriteaof \u6765\u5b8c\u6210\u7684\uff0c\u8fd9\u4e48\u505a\u53ef\u4ee5\u8fbe\u5230\u4e24\u4e2a\u597d\u5904\uff1a - \u5b50\u8fdb\u7a0b\u8fdb\u884c AOF \u91cd\u5199\u671f\u95f4\uff0c\u4e3b\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u5904\u7406\u547d\u4ee4\u8bf7\u6c42\uff0c\u4ece\u800c\u907f\u514d\u963b\u585e\u4e3b\u8fdb\u7a0b\uff1b - \u5b50\u8fdb\u7a0b\u5e26\u6709\u4e3b\u8fdb\u7a0b\u7684\u6570\u636e\u526f\u672c\uff08\u6570\u636e\u526f\u672c\u600e\u4e48\u4ea7\u751f\u7684\u540e\u9762\u4f1a\u8bf4\uff09\uff0c\u8fd9\u91cc\u4f7f\u7528\u5b50\u8fdb\u7a0b\u800c\u4e0d\u662f\u7ebf\u7a0b\uff0c\u56e0\u4e3a\u5982\u679c\u662f\u4f7f\u7528\u7ebf\u7a0b\uff0c\u591a\u7ebf\u7a0b\u4e4b\u95f4\u4f1a\u5171\u4eab\u5185\u5b58\uff0c\u90a3\u4e48\u5728\u4fee\u6539\u5171\u4eab\u5185\u5b58\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u901a\u8fc7\u52a0\u9501\u6765\u4fdd\u8bc1\u6570\u636e\u7684\u5b89\u5168\uff0c\u800c\u8fd9\u6837\u5c31\u4f1a\u964d\u4f4e\u6027\u80fd\u3002\u800c\u4f7f\u7528\u5b50\u8fdb\u7a0b\uff0c\u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u7236\u5b50\u8fdb\u7a0b\u662f\u5171\u4eab\u5185\u5b58\u6570\u636e\u7684\uff0c\u4e0d\u8fc7\u8fd9\u4e2a\u5171\u4eab\u7684\u5185\u5b58\u53ea\u80fd\u4ee5\u53ea\u8bfb\u7684\u65b9\u5f0f\uff0c\u800c\u5f53\u7236\u5b50\u8fdb\u7a0b\u4efb\u610f\u4e00\u65b9\u4fee\u6539\u4e86\u8be5\u5171\u4eab\u5185\u5b58\uff0c\u5c31\u4f1a\u53d1\u751f\u300c\u5199\u65f6\u590d\u5236\u300d\uff0c\u4e8e\u662f\u7236\u5b50\u8fdb\u7a0b\u5c31\u6709\u4e86\u72ec\u7acb\u7684\u6570\u636e\u526f\u672c\uff0c\u5c31\u4e0d\u7528\u52a0\u9501\u6765\u4fdd\u8bc1\u6570\u636e\u5b89\u5168\u3002</p> <p>\u5b50\u8fdb\u7a0b\u662f\u600e\u4e48\u62e5\u6709\u4e3b\u8fdb\u7a0b\u4e00\u6837\u7684\u6570\u636e\u526f\u672c\u7684\u5462\uff1f</p> <p>\u4e3b\u8fdb\u7a0b\u5728\u901a\u8fc7 <code>fork</code> \u7cfb\u7edf\u8c03\u7528\u751f\u6210  bgrewriteaof \u5b50\u8fdb\u7a0b\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u628a\u4e3b\u8fdb\u7a0b\u7684\u300c\u9875\u8868\u300d\u590d\u5236\u4e00\u4efd\u7ed9\u5b50\u8fdb\u7a0b\uff0c\u8fd9\u4e2a\u9875\u8868\u8bb0\u5f55\u7740\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u6620\u5c04\u5173\u7cfb\uff0c\u800c\u4e0d\u4f1a\u590d\u5236\u7269\u7406\u5185\u5b58\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e24\u8005\u7684\u865a\u62df\u7a7a\u95f4\u4e0d\u540c\uff0c\u4f46\u5176\u5bf9\u5e94\u7684\u7269\u7406\u7a7a\u95f4\u662f\u540c\u4e00\u4e2a\u3002</p> <p></p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u5b50\u8fdb\u7a0b\u5c31\u5171\u4eab\u4e86\u7236\u8fdb\u7a0b\u7684\u7269\u7406\u5185\u5b58\u6570\u636e\u4e86\uff0c\u8fd9\u6837\u80fd\u591f\u8282\u7ea6\u7269\u7406\u5185\u5b58\u8d44\u6e90\uff0c\u9875\u8868\u5bf9\u5e94\u7684\u9875\u8868\u9879\u7684\u5c5e\u6027\u4f1a\u6807\u8bb0\u8be5\u7269\u7406\u5185\u5b58\u7684\u6743\u9650\u4e3a\u53ea\u8bfb\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5f53\u7236\u8fdb\u7a0b\u6216\u8005\u5b50\u8fdb\u7a0b\u5728\u5411\u8fd9\u4e2a\u5185\u5b58\u53d1\u8d77\u5199\u64cd\u4f5c\u65f6\uff0cCPU \u5c31\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u8fd9\u4e2a\u7f3a\u9875\u4e2d\u65ad\u662f\u7531\u4e8e\u8fdd\u53cd\u6743\u9650\u5bfc\u81f4\u7684\uff0c\u7136\u540e\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5728\u300c\u7f3a\u9875\u5f02\u5e38\u5904\u7406\u51fd\u6570\u300d\u91cc\u8fdb\u884c\u7269\u7406\u5185\u5b58\u7684\u590d\u5236\uff0c\u5e76\u91cd\u65b0\u8bbe\u7f6e\u5176\u5185\u5b58\u6620\u5c04\u5173\u7cfb\uff0c\u5c06\u7236\u5b50\u8fdb\u7a0b\u7684\u5185\u5b58\u8bfb\u5199\u6743\u9650\u8bbe\u7f6e\u4e3a\u53ef\u8bfb\u5199\uff0c\u6700\u540e\u624d\u4f1a\u5bf9\u5185\u5b58\u8fdb\u884c\u5199\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u300c\u5199\u65f6\u590d\u5236 (Copy On Write)\u300d\u3002</p> <p></p> <p>\u5199\u65f6\u590d\u5236\u987e\u540d\u601d\u4e49\uff0c\u5728\u53d1\u751f\u5199\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7cfb\u7edf\u624d\u4f1a\u53bb\u590d\u5236\u7269\u7406\u5185\u5b58\uff0c\u8fd9\u6837\u662f\u4e3a\u4e86\u9632\u6b62 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u7531\u4e8e\u7269\u7406\u5185\u5b58\u6570\u636e\u7684\u590d\u5236\u65f6\u95f4\u8fc7\u957f\u800c\u5bfc\u81f4\u7236\u8fdb\u7a0b\u957f\u65f6\u95f4\u963b\u585e\u7684\u95ee\u9898\u3002</p> <p>\u5f53\u7136\uff0c\u64cd\u4f5c\u7cfb\u7edf\u590d\u5236\u7236\u8fdb\u7a0b\u9875\u8868\u7684\u65f6\u5019\uff0c\u7236\u8fdb\u7a0b\u4e5f\u662f\u963b\u585e\u4e2d\u7684\uff0c\u4e0d\u8fc7\u9875\u8868\u7684\u5927\u5c0f\u76f8\u6bd4\u5b9e\u9645\u7684\u7269\u7406\u5185\u5b58\u5c0f\u5f88\u591a\uff0c\u6240\u4ee5\u901a\u5e38\u590d\u5236\u9875\u8868\u7684\u8fc7\u7a0b\u662f\u6bd4\u8f83\u5feb\u7684\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5982\u679c\u7236\u8fdb\u7a0b\u7684\u5185\u5b58\u6570\u636e\u975e\u5e38\u5927\uff0c\u90a3\u81ea\u7136\u9875\u8868\u4e5f\u4f1a\u5f88\u5927\uff0c\u8fd9\u65f6\u7236\u8fdb\u7a0b\u5728\u901a\u8fc7 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u963b\u585e\u7684\u65f6\u95f4\u4e5f\u8d8a\u4e45\u3002</p> <p>\u6240\u4ee5\uff0c\u6709\u4e24\u4e2a\u9636\u6bb5\u4f1a\u5bfc\u81f4\u963b\u585e\u7236\u8fdb\u7a0b\uff1a - \u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u9014\u4e2d\uff0c\u7531\u4e8e\u8981\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u9875\u8868\u7b49\u6570\u636e\u7ed3\u6784\uff0c\u963b\u585e\u7684\u65f6\u95f4\u8ddf\u9875\u8868\u7684\u5927\u5c0f\u6709\u5173\uff0c\u9875\u8868\u8d8a\u5927\uff0c\u963b\u585e\u7684\u65f6\u95f4\u4e5f\u8d8a\u957f\uff1b - \u521b\u5efa\u5b8c\u5b50\u8fdb\u7a0b\u540e\uff0c\u5982\u679c\u5b50\u8fdb\u7a0b\u6216\u8005\u7236\u8fdb\u7a0b\u4fee\u6539\u4e86\u5171\u4eab\u6570\u636e\uff0c\u5c31\u4f1a\u53d1\u751f\u5199\u65f6\u590d\u5236\uff0c\u8fd9\u671f\u95f4\u4f1a\u62f7\u8d1d\u7269\u7406\u5185\u5b58\uff0c\u5982\u679c\u5185\u5b58\u8d8a\u5927\uff0c\u81ea\u7136\u963b\u585e\u7684\u65f6\u95f4\u4e5f\u8d8a\u957f\uff1b</p> <p>\u89e6\u53d1\u91cd\u5199\u673a\u5236\u540e\uff0c\u4e3b\u8fdb\u7a0b\u5c31\u4f1a\u521b\u5efa\u91cd\u5199 AOF \u7684\u5b50\u8fdb\u7a0b\uff0c\u6b64\u65f6\u7236\u5b50\u8fdb\u7a0b\u5171\u4eab\u7269\u7406\u5185\u5b58\uff0c\u91cd\u5199\u5b50\u8fdb\u7a0b\u53ea\u4f1a\u5bf9\u8fd9\u4e2a\u5185\u5b58\u8fdb\u884c\u53ea\u8bfb\uff0c\u91cd\u5199 AOF \u5b50\u8fdb\u7a0b\u4f1a\u8bfb\u53d6\u6570\u636e\u5e93\u91cc\u7684\u6240\u6709\u6570\u636e\uff0c\u5e76\u9010\u4e00\u628a\u5185\u5b58\u6570\u636e\u7684\u952e\u503c\u5bf9\u8f6c\u6362\u6210\u4e00\u6761\u547d\u4ee4\uff0c\u518d\u5c06\u547d\u4ee4\u8bb0\u5f55\u5230\u91cd\u5199\u65e5\u5fd7\uff08\u65b0\u7684 AOF \u6587\u4ef6\uff09\u3002</p> <p>\u4f46\u662f\u5b50\u8fdb\u7a0b\u91cd\u5199\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u8fdb\u7a0b\u4f9d\u7136\u53ef\u4ee5\u6b63\u5e38\u5904\u7406\u547d\u4ee4\u3002</p> <p>\u5982\u679c\u6b64\u65f6\u4e3b\u8fdb\u7a0b\u4fee\u6539\u4e86\u5df2\u7ecf\u5b58\u5728 key-value\uff0c\u5c31\u4f1a\u53d1\u751f\u5199\u65f6\u590d\u5236\uff0c\u6ce8\u610f\u8fd9\u91cc\u53ea\u4f1a\u590d\u5236\u4e3b\u8fdb\u7a0b\u4fee\u6539\u7684\u7269\u7406\u5185\u5b58\u6570\u636e\uff0c\u6ca1\u4fee\u6539\u7269\u7406\u5185\u5b58\u8fd8\u662f\u4e0e\u5b50\u8fdb\u7a0b\u5171\u4eab\u7684\u3002</p> <p>\u6240\u4ee5\u5982\u679c\u8fd9\u4e2a\u9636\u6bb5\u4fee\u6539\u7684\u662f\u4e00\u4e2a bigkey\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u91cf\u6bd4\u8f83\u5927\u7684 key-value \u7684\u65f6\u5019\uff0c\u8fd9\u65f6\u590d\u5236\u7684\u7269\u7406\u5185\u5b58\u6570\u636e\u7684\u8fc7\u7a0b\u5c31\u4f1a\u6bd4\u8f83\u8017\u65f6\uff0c\u6709\u963b\u585e\u4e3b\u8fdb\u7a0b\u7684\u98ce\u9669\u3002</p> <p>\u8fd8\u6709\u4e2a\u95ee\u9898\uff0c\u91cd\u5199 AOF \u65e5\u5fd7\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4e3b\u8fdb\u7a0b\u4fee\u6539\u4e86\u5df2\u7ecf\u5b58\u5728 key-value\uff0c\u6b64\u65f6\u8fd9\u4e2a key-value \u6570\u636e\u5728\u5b50\u8fdb\u7a0b\u7684\u5185\u5b58\u6570\u636e\u5c31\u8ddf\u4e3b\u8fdb\u7a0b\u7684\u5185\u5b58\u6570\u636e\u4e0d\u4e00\u81f4\u4e86\uff0c\u8fd9\u65f6\u8981\u600e\u4e48\u529e\u5462\uff1f</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u79cd\u6570\u636e\u4e0d\u4e00\u81f4\u95ee\u9898\uff0cRedis \u8bbe\u7f6e\u4e86\u4e00\u4e2a AOF \u91cd\u5199\u7f13\u51b2\u533a\uff0c\u8fd9\u4e2a\u7f13\u51b2\u533a\u5728\u521b\u5efa bgrewriteaof \u5b50\u8fdb\u7a0b\u4e4b\u540e\u5f00\u59cb\u4f7f\u7528\u3002</p> <p>\u5728\u91cd\u5199 AOF \u671f\u95f4\uff0c\u5f53 Redis \u6267\u884c\u5b8c\u4e00\u4e2a\u5199\u547d\u4ee4\u4e4b\u540e\uff0c\u5b83\u4f1a\u540c\u65f6\u5c06\u8fd9\u4e2a\u5199\u547d\u4ee4\u5199\u5165\u5230\u300cAOF \u7f13\u51b2\u533a\u300d\u548c\u300cAOF \u91cd\u5199\u7f13\u51b2\u533a\u300d\u3002</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728 bgrewriteaof \u5b50\u8fdb\u7a0b\u6267\u884c AOF \u91cd\u5199\u671f\u95f4\uff0c\u4e3b\u8fdb\u7a0b\u9700\u8981\u6267\u884c\u4ee5\u4e0b\u4e09\u4e2a\u5de5\u4f5c\uff1a - \u6267\u884c\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u547d\u4ee4\uff1b - \u5c06\u6267\u884c\u540e\u7684\u5199\u547d\u4ee4\u8ffd\u52a0\u5230\u300cAOF \u7f13\u51b2\u533a\u300d\uff1b - \u5c06\u6267\u884c\u540e\u7684\u5199\u547d\u4ee4\u8ffd\u52a0\u5230\u300cAOF \u91cd\u5199\u7f13\u51b2\u533a\u300d\uff1b</p> <p>\u5f53\u5b50\u8fdb\u7a0b\u5b8c\u6210 AOF \u91cd\u5199\u5de5\u4f5c\uff08\u626b\u63cf\u6570\u636e\u5e93\u4e2d\u6240\u6709\u6570\u636e\uff0c\u9010\u4e00\u628a\u5185\u5b58\u6570\u636e\u7684\u952e\u503c\u5bf9\u8f6c\u6362\u6210\u4e00\u6761\u547d\u4ee4\uff0c\u518d\u5c06\u547d\u4ee4\u8bb0\u5f55\u5230\u91cd\u5199\u65e5\u5fd7\uff09\u540e\uff0c\u4f1a\u5411\u4e3b\u8fdb\u7a0b\u53d1\u9001\u4e00\u6761\u4fe1\u53f7\uff0c\u4fe1\u53f7\u662f\u8fdb\u7a0b\u95f4\u901a\u8baf\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u4e14\u662f\u5f02\u6b65\u7684\u3002</p> <p>\u4e3b\u8fdb\u7a0b\u6536\u5230\u8be5\u4fe1\u53f7\u540e\uff0c\u4f1a\u8c03\u7528\u4e00\u4e2a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u8be5\u51fd\u6570\u4e3b\u8981\u505a\u4ee5\u4e0b\u5de5\u4f5c\uff1a - \u5c06 AOF \u91cd\u5199\u7f13\u51b2\u533a\u4e2d\u7684\u6240\u6709\u5185\u5bb9\u8ffd\u52a0\u5230\u65b0\u7684 AOF \u7684\u6587\u4ef6\u4e2d\uff0c\u4f7f\u5f97\u65b0\u65e7\u4e24\u4e2a AOF \u6587\u4ef6\u6240\u4fdd\u5b58\u7684\u6570\u636e\u5e93\u72b6\u6001\u4e00\u81f4\uff1b - \u65b0\u7684 AOF \u7684\u6587\u4ef6\u8fdb\u884c\u6539\u540d\uff0c\u8986\u76d6\u73b0\u6709\u7684 AOF \u6587\u4ef6\u3002</p> <p>\u4fe1\u53f7\u51fd\u6570\u6267\u884c\u5b8c\u540e\uff0c\u4e3b\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u7ee7\u7eed\u50cf\u5f80\u5e38\u4e00\u6837\u5904\u7406\u547d\u4ee4\u4e86\u3002</p> <p>\u5728\u6574\u4e2a AOF \u540e\u53f0\u91cd\u5199\u8fc7\u7a0b\u4e2d\uff0c\u9664\u4e86\u53d1\u751f\u5199\u65f6\u590d\u5236\u4f1a\u5bf9\u4e3b\u8fdb\u7a0b\u9020\u6210\u963b\u585e\uff0c\u8fd8\u6709\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6267\u884c\u65f6\u4e5f\u4f1a\u5bf9\u4e3b\u8fdb\u7a0b\u9020\u6210\u963b\u585e\uff0c\u5728\u5176\u4ed6\u65f6\u5019\uff0cAOF \u540e\u53f0\u91cd\u5199\u90fd\u4e0d\u4f1a\u963b\u585e\u4e3b\u8fdb\u7a0b\u3002</p>"},{"location":"redis/storage/aof/#_2","title":"\u603b\u7ed3","text":"<p>\u8fd9\u6b21\u5c0f\u6797\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e86 Redis \u6301\u4e45\u5316\u6280\u672f\u4e2d\u7684 AOF \u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u6bcf\u6267\u884c\u4e00\u6761\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u5c31\u5c06\u8be5\u547d\u4ee4\u4ee5\u8ffd\u52a0\u7684\u65b9\u5f0f\u5199\u5165\u5230 AOF \u6587\u4ef6\uff0c\u7136\u540e\u5728\u6062\u590d\u65f6\uff0c\u4ee5\u9010\u4e00\u6267\u884c\u547d\u4ee4\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\u6570\u636e\u6062\u590d\u3002</p> <p>Redis \u63d0\u4f9b\u4e86\u4e09\u79cd\u5c06 AOF \u65e5\u5fd7\u5199\u56de\u786c\u76d8\u7684\u7b56\u7565\uff0c\u5206\u522b\u662f Always\u3001Everysec \u548c No\uff0c\u8fd9\u4e09\u79cd\u7b56\u7565\u5728\u53ef\u9760\u6027\u4e0a\u662f\u4ece\u9ad8\u5230\u4f4e\uff0c\u800c\u5728\u6027\u80fd\u4e0a\u5219\u662f\u4ece\u4f4e\u5230\u9ad8\u3002</p> <p>\u968f\u7740\u6267\u884c\u7684\u547d\u4ee4\u8d8a\u591a\uff0cAOF \u6587\u4ef6\u7684\u4f53\u79ef\u81ea\u7136\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u4e3a\u4e86\u907f\u514d\u65e5\u5fd7\u6587\u4ef6\u8fc7\u5927\uff0cRedis \u63d0\u4f9b\u4e86 AOF \u91cd\u5199\u673a\u5236\uff0c\u5b83\u4f1a\u76f4\u63a5\u626b\u63cf\u6570\u636e\u4e2d\u6240\u6709\u7684\u952e\u503c\u5bf9\u6570\u636e\uff0c\u7136\u540e\u4e3a\u6bcf\u4e00\u4e2a\u952e\u503c\u5bf9\u751f\u6210\u4e00\u6761\u5199\u64cd\u4f5c\u547d\u4ee4\uff0c\u63a5\u7740\u5c06\u8be5\u547d\u4ee4\u5199\u5165\u5230\u65b0\u7684 AOF  \u6587\u4ef6\uff0c\u91cd\u5199\u5b8c\u6210\u540e\uff0c\u5c31\u66ff\u6362\u6389\u73b0\u6709\u7684 AOF \u65e5\u5fd7\u3002\u91cd\u5199\u7684\u8fc7\u7a0b\u662f\u7531\u540e\u53f0\u5b50\u8fdb\u7a0b\u5b8c\u6210\u7684\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u4e3b\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u6b63\u5e38\u5904\u7406\u547d\u4ee4\u3002</p> <p>\u7528 AOF \u65e5\u5fd7\u7684\u65b9\u5f0f\u6765\u6062\u590d\u6570\u636e\u5176\u5b9e\u662f\u5f88\u6162\u7684\uff0c\u56e0\u4e3a Redis \u6267\u884c\u547d\u4ee4\u7531\u5355\u7ebf\u7a0b\u8d1f\u8d23\u7684\uff0c\u800c AOF \u65e5\u5fd7\u6062\u590d\u6570\u636e\u7684\u65b9\u5f0f\u662f\u987a\u5e8f\u6267\u884c\u65e5\u5fd7\u91cc\u7684\u6bcf\u4e00\u6761\u547d\u4ee4\uff0c\u5982\u679c AOF \u65e5\u5fd7\u5f88\u5927\uff0c\u8fd9\u4e2a\u300c\u91cd\u653e\u300d\u7684\u8fc7\u7a0b\u5c31\u4f1a\u5f88\u6162\u4e86\u3002</p>"},{"location":"redis/storage/aof/#_3","title":"\u53c2\u8003\u8d44\u6599","text":"<ul> <li>\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b</li> <li>\u300aRedis \u6838\u5fc3\u6280\u672f\u4e0e\u5b9e\u6218 - \u6781\u5ba2\u65f6\u95f4\u300b</li> <li>\u300aRedis \u6e90\u7801\u5206\u6790\u300b</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/storage/bigkey_aof_rdb/","title":"Redis \u5927 Key \u5bf9\u6301\u4e45\u5316\u6709\u4ec0\u4e48\u5f71\u54cd\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e0a\u5468\u6709\u4f4d\u8bfb\u8005\u5b57\u8282\u4e00\u4e8c\u9762\u65f6\uff0c\u88ab\u95ee\u5230\uff1aRedis \u7684\u5927 Key \u5bf9\u6301\u4e45\u5316\u6709\u4ec0\u4e48\u5f71\u54cd\uff1f</p> <p></p> <p>Redis \u7684\u6301\u4e45\u5316\u65b9\u5f0f\u6709\u4e24\u79cd\uff1aAOF \u65e5\u5fd7\u548c RDB \u5feb\u7167\u3002</p> <p>\u6240\u4ee5\u63a5\u4e0b\u6765\uff0c\u9488\u5bf9\u8fd9\u4e24\u79cd\u6301\u4e45\u5316\u65b9\u5f0f\u5177\u4f53\u5206\u6790\u5206\u6790\u3002</p>"},{"location":"redis/storage/bigkey_aof_rdb/#key-aof","title":"\u5927 Key \u5bf9 AOF \u65e5\u5fd7\u7684\u5f71\u54cd","text":"<p>\u5148\u8bf4\u8bf4 AOF \u65e5\u5fd7\u4e09\u79cd\u5199\u56de\u78c1\u76d8\u7684\u7b56\u7565</p> <p>Redis \u63d0\u4f9b\u4e86 3 \u79cd AOF \u65e5\u5fd7\u5199\u56de\u786c\u76d8\u7684\u7b56\u7565\uff0c\u5206\u522b\u662f\uff1a - Always\uff0c\u8fd9\u4e2a\u5355\u8bcd\u7684\u610f\u601d\u662f\u300c\u603b\u662f\u300d\uff0c\u6240\u4ee5\u5b83\u7684\u610f\u601d\u662f\u6bcf\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u540c\u6b65\u5c06 AOF \u65e5\u5fd7\u6570\u636e\u5199\u56de\u786c\u76d8\uff1b - Everysec\uff0c\u8fd9\u4e2a\u5355\u8bcd\u7684\u610f\u601d\u662f\u300c\u6bcf\u79d2\u300d\uff0c\u6240\u4ee5\u5b83\u7684\u610f\u601d\u662f\u6bcf\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u5148\u5c06\u547d\u4ee4\u5199\u5165\u5230 AOF \u6587\u4ef6\u7684\u5185\u6838\u7f13\u51b2\u533a\uff0c\u7136\u540e\u6bcf\u9694\u4e00\u79d2\u5c06\u7f13\u51b2\u533a\u91cc\u7684\u5185\u5bb9\u5199\u56de\u5230\u786c\u76d8\uff1b - No\uff0c\u610f\u5473\u7740\u4e0d\u7531 Redis \u63a7\u5236\u5199\u56de\u786c\u76d8\u7684\u65f6\u673a\uff0c\u8f6c\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u63a7\u5236\u5199\u56de\u7684\u65f6\u673a\uff0c\u4e5f\u5c31\u662f\u6bcf\u6b21\u5199\u64cd\u4f5c\u547d\u4ee4\u6267\u884c\u5b8c\u540e\uff0c\u5148\u5c06\u547d\u4ee4\u5199\u5165\u5230 AOF \u6587\u4ef6\u7684\u5185\u6838\u7f13\u51b2\u533a\uff0c\u518d\u7531\u64cd\u4f5c\u7cfb\u7edf\u51b3\u5b9a\u4f55\u65f6\u5c06\u7f13\u51b2\u533a\u5185\u5bb9\u5199\u56de\u786c\u76d8\u3002</p> <p>\u8fd9\u4e09\u79cd\u7b56\u7565\u53ea\u662f\u5728\u63a7\u5236 fsync() \u51fd\u6570\u7684\u8c03\u7528\u65f6\u673a\u3002</p> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u5411\u6587\u4ef6\u5199\u5165\u6570\u636e\u65f6\uff0c\u5185\u6838\u901a\u5e38\u5148\u5c06\u6570\u636e\u590d\u5236\u5230\u5185\u6838\u7f13\u51b2\u533a\u4e2d\uff0c\u7136\u540e\u6392\u5165\u961f\u5217\uff0c\u7136\u540e\u7531\u5185\u6838\u51b3\u5b9a\u4f55\u65f6\u5199\u5165\u786c\u76d8\u3002</p> <p></p> <p>\u5982\u679c\u60f3\u8981\u5e94\u7528\u7a0b\u5e8f\u5411\u6587\u4ef6\u5199\u5165\u6570\u636e\u540e\uff0c\u80fd\u7acb\u9a6c\u5c06\u6570\u636e\u540c\u6b65\u5230\u786c\u76d8\uff0c\u5c31\u53ef\u4ee5\u8c03\u7528 fsync() \u51fd\u6570\uff0c\u8fd9\u6837\u5185\u6838\u5c31\u4f1a\u5c06\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u76f4\u63a5\u5199\u5165\u5230\u786c\u76d8\uff0c\u7b49\u5230\u786c\u76d8\u5199\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u8be5\u51fd\u6570\u624d\u4f1a\u8fd4\u56de\u3002</p> <ul> <li>Always \u7b56\u7565\u5c31\u662f\u6bcf\u6b21\u5199\u5165 AOF \u6587\u4ef6\u6570\u636e\u540e\uff0c\u5c31\u6267\u884c fsync() \u51fd\u6570\uff1b</li> <li>Everysec \u7b56\u7565\u5c31\u4f1a\u521b\u5efa\u4e00\u4e2a\u5f02\u6b65\u4efb\u52a1\u6765\u6267\u884c fsync() \u51fd\u6570\uff1b</li> <li>No \u7b56\u7565\u5c31\u662f\u6c38\u4e0d\u6267\u884c fsync() \u51fd\u6570;</li> </ul> <p>\u5206\u522b\u8bf4\u8bf4\u8fd9\u4e09\u79cd\u7b56\u7565\uff0c\u5728\u6301\u4e45\u5316\u5927 Key \u7684\u65f6\u5019\uff0c\u4f1a\u5f71\u54cd\u4ec0\u4e48\uff1f</p> <p>\u5728\u4f7f\u7528 Always \u7b56\u7565\u7684\u65f6\u5019\uff0c\u4e3b\u7ebf\u7a0b\u5728\u6267\u884c\u5b8c\u547d\u4ee4\u540e\uff0c\u4f1a\u628a\u6570\u636e\u5199\u5165\u5230 AOF \u65e5\u5fd7\u6587\u4ef6\uff0c\u7136\u540e\u4f1a\u8c03\u7528  fsync() \u51fd\u6570\uff0c\u5c06\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u76f4\u63a5\u5199\u5165\u5230\u786c\u76d8\uff0c\u7b49\u5230\u786c\u76d8\u5199\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u8be5\u51fd\u6570\u624d\u4f1a\u8fd4\u56de\u3002</p> <p>\u5f53\u4f7f\u7528 Always \u7b56\u7565\u7684\u65f6\u5019\uff0c\u5982\u679c\u5199\u5165\u662f\u4e00\u4e2a\u5927 Key\uff0c\u4e3b\u7ebf\u7a0b\u5728\u6267\u884c fsync() \u51fd\u6570\u7684\u65f6\u5019\uff0c\u963b\u585e\u7684\u65f6\u95f4\u4f1a\u6bd4\u8f83\u4e45\uff0c\u56e0\u4e3a\u5f53\u5199\u5165\u7684\u6570\u636e\u91cf\u5f88\u5927\u7684\u65f6\u5019\uff0c\u6570\u636e\u540c\u6b65\u5230\u786c\u76d8\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5f88\u8017\u65f6\u7684\u3002</p> <p>\u5f53\u4f7f\u7528 Everysec \u7b56\u7565\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u662f\u5f02\u6b65\u6267\u884c fsync() \u51fd\u6570\uff0c\u6240\u4ee5\u5927 Key \u6301\u4e45\u5316\u7684\u8fc7\u7a0b\uff08\u6570\u636e\u540c\u6b65\u78c1\u76d8\uff09\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u3002</p> <p>\u5f53\u4f7f\u7528 No \u7b56\u7565\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u6c38\u4e0d\u6267\u884c fsync() \u51fd\u6570\uff0c\u6240\u4ee5\u5927 Key \u6301\u4e45\u5316\u7684\u8fc7\u7a0b\u4e0d\u4f1a\u5f71\u54cd\u4e3b\u7ebf\u7a0b\u3002</p>"},{"location":"redis/storage/bigkey_aof_rdb/#key-aof-rdb","title":"\u5927 Key \u5bf9 AOF \u91cd\u5199\u548c RDB \u7684\u5f71\u54cd","text":"<p>\u5f53 AOF \u65e5\u5fd7\u5199\u5165\u4e86\u5f88\u591a\u7684\u5927 Key\uff0cAOF \u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f\u4f1a\u5f88\u5927\uff0c\u90a3\u4e48\u5f88\u5feb\u5c31\u4f1a\u89e6\u53d1 AOF \u91cd\u5199\u673a\u5236\u3002</p> <p>AOF \u91cd\u5199\u673a\u5236\u548c RDB \u5feb\u7167\uff08bgsave \u547d\u4ee4\uff09\u7684\u8fc7\u7a0b\uff0c\u90fd\u4f1a\u5206\u522b\u901a\u8fc7 <code>fork()</code> \u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u5904\u7406\u4efb\u52a1\u3002</p> <p>\u5728\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u628a\u7236\u8fdb\u7a0b\u7684\u300c\u9875\u8868\u300d\u590d\u5236\u4e00\u4efd\u7ed9\u5b50\u8fdb\u7a0b\uff0c\u8fd9\u4e2a\u9875\u8868\u8bb0\u5f55\u7740\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u6620\u5c04\u5173\u7cfb\uff0c\u800c\u4e0d\u4f1a\u590d\u5236\u7269\u7406\u5185\u5b58\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e24\u8005\u7684\u865a\u62df\u7a7a\u95f4\u4e0d\u540c\uff0c\u4f46\u5176\u5bf9\u5e94\u7684\u7269\u7406\u7a7a\u95f4\u662f\u540c\u4e00\u4e2a\u3002</p> <p> \u8fd9\u6837\u4e00\u6765\uff0c\u5b50\u8fdb\u7a0b\u5c31\u5171\u4eab\u4e86\u7236\u8fdb\u7a0b\u7684\u7269\u7406\u5185\u5b58\u6570\u636e\u4e86\uff0c\u8fd9\u6837\u80fd\u591f\u8282\u7ea6\u7269\u7406\u5185\u5b58\u8d44\u6e90\uff0c\u9875\u8868\u5bf9\u5e94\u7684\u9875\u8868\u9879\u7684\u5c5e\u6027\u4f1a\u6807\u8bb0\u8be5\u7269\u7406\u5185\u5b58\u7684\u6743\u9650\u4e3a\u53ea\u8bfb\u3002</p> <p>\u968f\u7740 Redis \u5b58\u5728\u8d8a\u6765\u8d8a\u591a\u7684\u5927 Key\uff0c\u90a3\u4e48 Redis \u5c31\u4f1a\u5360\u7528\u5f88\u591a\u5185\u5b58\uff0c\u5bf9\u5e94\u7684\u9875\u8868\u5c31\u4f1a\u8d8a\u5927\u3002</p> <p>\u5728\u901a\u8fc7  <code>fork()</code>  \u51fd\u6570\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u867d\u7136\u4e0d\u4f1a\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u7269\u7406\u5185\u5b58\uff0c\u4f46\u662f\u5185\u6838\u4f1a\u628a\u7236\u8fdb\u7a0b\u7684\u9875\u8868\u590d\u5236\u4e00\u4efd\u7ed9\u5b50\u8fdb\u7a0b\uff0c\u5982\u679c\u9875\u8868\u5f88\u5927\uff0c\u90a3\u4e48\u8fd9\u4e2a\u590d\u5236\u8fc7\u7a0b\u662f\u4f1a\u5f88\u8017\u65f6\u7684\uff0c\u90a3\u4e48\u5728\u6267\u884c fork \u51fd\u6570\u7684\u65f6\u5019\u5c31\u4f1a\u53d1\u751f\u963b\u585e\u73b0\u8c61\u3002</p> <p>\u800c\u4e14\uff0cfork \u51fd\u6570\u662f\u7531 Redis \u4e3b\u7ebf\u7a0b\u8c03\u7528\u7684\uff0c\u5982\u679c fork \u51fd\u6570\u53d1\u751f\u963b\u585e\uff0c\u90a3\u4e48\u610f\u5473\u7740\u5c31\u4f1a\u963b\u585e Redis \u4e3b\u7ebf\u7a0b\u3002\u7531\u4e8e Redis \u6267\u884c\u547d\u4ee4\u662f\u5728\u4e3b\u7ebf\u7a0b\u5904\u7406\u7684\uff0c\u6240\u4ee5\u5f53 Redis \u4e3b\u7ebf\u7a0b\u53d1\u751f\u963b\u585e\uff0c\u5c31\u65e0\u6cd5\u5904\u7406\u540e\u7eed\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u547d\u4ee4\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u6267\u884c <code>info</code> \u547d\u4ee4\u83b7\u53d6\u5230 latest_fork_usec \u6307\u6807\uff0c\u8868\u793a Redis \u6700\u8fd1\u4e00\u6b21 fork \u64cd\u4f5c\u8017\u65f6\u3002</p> <p>SQL<pre><code># \u6700\u8fd1\u4e00\u6b21 fork \u64cd\u4f5c\u8017\u65f6\nlatest_fork_usec:315\n</code></pre> \u5982\u679c fork \u8017\u65f6\u5f88\u5927\uff0c\u6bd4\u5982\u8d85\u8fc7 1 \u79d2\uff0c\u5219\u9700\u8981\u505a\u51fa\u4f18\u5316\u8c03\u6574\uff1a - \u5355\u4e2a\u5b9e\u4f8b\u7684\u5185\u5b58\u5360\u7528\u63a7\u5236\u5728 10 GB \u4ee5\u4e0b\uff0c\u8fd9\u6837 fork \u51fd\u6570\u5c31\u80fd\u5f88\u5feb\u8fd4\u56de\u3002 -  \u5982\u679c Redis \u53ea\u662f\u5f53\u4f5c\u7eaf\u7f13\u5b58\u4f7f\u7528\uff0c\u4e0d\u5173\u5fc3 Redis \u6570\u636e\u5b89\u5168\u6027\u95ee\u9898\uff0c\u53ef\u4ee5\u8003\u8651\u5173\u95ed AOF \u548c AOF \u91cd\u5199\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u8c03\u7528 fork \u51fd\u6570\u4e86\u3002 - \u5728\u4e3b\u4ece\u67b6\u6784\u4e2d\uff0c\u8981\u9002\u5f53\u8c03\u5927 repl-backlog-size\uff0c\u907f\u514d\u56e0\u4e3a  repl_backlog_buffer \u4e0d\u591f\u5927\uff0c\u5bfc\u81f4\u4e3b\u8282\u70b9\u9891\u7e41\u5730\u4f7f\u7528\u5168\u91cf\u540c\u6b65\u7684\u65b9\u5f0f\uff0c\u5168\u91cf\u540c\u6b65\u7684\u65f6\u5019\uff0c\u662f\u4f1a\u521b\u5efa RDB \u6587\u4ef6\u7684\uff0c\u4e5f\u5c31\u662f\u4f1a\u8c03\u7528 fork \u51fd\u6570\u3002</p> <p>\u90a3\u4ec0\u4e48\u65f6\u5019\u4f1a\u53d1\u751f\u7269\u7406\u5185\u5b58\u7684\u590d\u5236\u5462\uff1f</p> <p>\u5f53\u7236\u8fdb\u7a0b\u6216\u8005\u5b50\u8fdb\u7a0b\u5728\u5411\u5171\u4eab\u5185\u5b58\u53d1\u8d77\u5199\u64cd\u4f5c\u65f6\uff0cCPU \u5c31\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u8fd9\u4e2a\u7f3a\u9875\u4e2d\u65ad\u662f\u7531\u4e8e\u8fdd\u53cd\u6743\u9650\u5bfc\u81f4\u7684\uff0c\u7136\u540e\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5728\u300c\u7f3a\u9875\u5f02\u5e38\u5904\u7406\u51fd\u6570\u300d\u91cc\u8fdb\u884c\u7269\u7406\u5185\u5b58\u7684\u590d\u5236\uff0c\u5e76\u91cd\u65b0\u8bbe\u7f6e\u5176\u5185\u5b58\u6620\u5c04\u5173\u7cfb\uff0c\u5c06\u7236\u5b50\u8fdb\u7a0b\u7684\u5185\u5b58\u8bfb\u5199\u6743\u9650\u8bbe\u7f6e\u4e3a\u53ef\u8bfb\u5199\uff0c\u6700\u540e\u624d\u4f1a\u5bf9\u5185\u5b58\u8fdb\u884c\u5199\u64cd\u4f5c\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u300c\u5199\u65f6\u590d\u5236 (Copy On Write)\u300d\u3002</p> <p></p> <p>\u5199\u65f6\u590d\u5236\u987e\u540d\u601d\u4e49\uff0c\u5728\u53d1\u751f\u5199\u64cd\u4f5c\u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7cfb\u7edf\u624d\u4f1a\u53bb\u590d\u5236\u7269\u7406\u5185\u5b58\uff0c\u8fd9\u6837\u662f\u4e3a\u4e86\u9632\u6b62 fork \u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\uff0c\u7531\u4e8e\u7269\u7406\u5185\u5b58\u6570\u636e\u7684\u590d\u5236\u65f6\u95f4\u8fc7\u957f\u800c\u5bfc\u81f4\u7236\u8fdb\u7a0b\u957f\u65f6\u95f4\u963b\u585e\u7684\u95ee\u9898\u3002</p> <p>\u5982\u679c\u521b\u5efa\u5b8c\u5b50\u8fdb\u7a0b\u540e\uff0c\u7236\u8fdb\u7a0b\u5bf9\u5171\u4eab\u5185\u5b58\u4e2d\u7684\u5927 Key \u8fdb\u884c\u4e86\u4fee\u6539\uff0c\u90a3\u4e48\u5185\u6838\u5c31\u4f1a\u53d1\u751f\u5199\u65f6\u590d\u5236\uff0c\u4f1a\u628a\u7269\u7406\u5185\u5b58\u590d\u5236\u4e00\u4efd\uff0c\u7531\u4e8e\u5927 Key \u5360\u7528\u7684\u7269\u7406\u5185\u5b58\u662f\u6bd4\u8f83\u5927\u7684\uff0c\u90a3\u4e48\u5728\u590d\u5236\u7269\u7406\u5185\u5b58\u8fd9\u4e00\u8fc7\u7a0b\u4e2d\uff0c\u4e5f\u662f\u6bd4\u8f83\u8017\u65f6\u7684\uff0c\u4e8e\u662f\u7236\u8fdb\u7a0b\uff08\u4e3b\u7ebf\u7a0b\uff09\u5c31\u4f1a\u53d1\u751f\u963b\u585e\u3002</p> <p>\u6240\u4ee5\uff0c\u6709\u4e24\u4e2a\u9636\u6bb5\u4f1a\u5bfc\u81f4\u963b\u585e\u7236\u8fdb\u7a0b\uff1a</p> <ul> <li>\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u9014\u4e2d\uff0c\u7531\u4e8e\u8981\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u9875\u8868\u7b49\u6570\u636e\u7ed3\u6784\uff0c\u963b\u585e\u7684\u65f6\u95f4\u8ddf\u9875\u8868\u7684\u5927\u5c0f\u6709\u5173\uff0c\u9875\u8868\u8d8a\u5927\uff0c\u963b\u585e\u7684\u65f6\u95f4\u4e5f\u8d8a\u957f\uff1b</li> <li>\u521b\u5efa\u5b8c\u5b50\u8fdb\u7a0b\u540e\uff0c\u5982\u679c\u5b50\u8fdb\u7a0b\u6216\u8005\u7236\u8fdb\u7a0b\u4fee\u6539\u4e86\u5171\u4eab\u6570\u636e\uff0c\u5c31\u4f1a\u53d1\u751f\u5199\u65f6\u590d\u5236\uff0c\u8fd9\u671f\u95f4\u4f1a\u62f7\u8d1d\u7269\u7406\u5185\u5b58\uff0c\u5982\u679c\u5185\u5b58\u8d8a\u5927\uff0c\u81ea\u7136\u963b\u585e\u7684\u65f6\u95f4\u4e5f\u8d8a\u957f\uff1b</li> </ul> <p>\u8fd9\u91cc\u989d\u5916\u63d0\u4e00\u4e0b\uff0c\u5982\u679c Linux \u5f00\u542f\u4e86\u5185\u5b58\u5927\u9875\uff0c\u4f1a\u5f71\u54cd Redis \u7684\u6027\u80fd\u7684\u3002</p> <p>Linux \u5185\u6838\u4ece 2.6.38 \u5f00\u59cb\u652f\u6301\u5185\u5b58\u5927\u9875\u673a\u5236\uff0c\u8be5\u673a\u5236\u652f\u6301 2MB \u5927\u5c0f\u7684\u5185\u5b58\u9875\u5206\u914d\uff0c\u800c\u5e38\u89c4\u7684\u5185\u5b58\u9875\u5206\u914d\u662f\u6309 4KB \u7684\u7c92\u5ea6\u6765\u6267\u884c\u7684\u3002</p> <p>\u5982\u679c\u91c7\u7528\u4e86\u5185\u5b58\u5927\u9875\uff0c\u90a3\u4e48\u5373\u4f7f\u5ba2\u6237\u7aef\u8bf7\u6c42\u53ea\u4fee\u6539 100B \u7684\u6570\u636e\uff0c\u5728\u53d1\u751f\u5199\u65f6\u590d\u5236\u540e\uff0cRedis \u4e5f\u9700\u8981\u62f7\u8d1d 2MB \u7684\u5927\u9875\u3002\u76f8\u53cd\uff0c\u5982\u679c\u662f\u5e38\u89c4\u5185\u5b58\u9875\u673a\u5236\uff0c\u53ea\u7528\u62f7\u8d1d 4KB\u3002</p> <p>\u4e24\u8005\u76f8\u6bd4\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u6b21\u5199\u547d\u4ee4\u5f15\u8d77\u7684\u590d\u5236\u5185\u5b58\u9875\u5355\u4f4d\u653e\u5927\u4e86 512 \u500d\uff0c\u4f1a\u62d6\u6162\u5199\u64cd\u4f5c\u7684\u6267\u884c\u65f6\u95f4\uff0c\u6700\u7ec8\u5bfc\u81f4 Redis \u6027\u80fd\u53d8\u6162\u3002</p> <p>\u90a3\u8be5\u600e\u4e48\u529e\u5462\uff1f\u5f88\u7b80\u5355\uff0c\u5173\u95ed\u5185\u5b58\u5927\u9875\uff08\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff09\u3002</p> <p>\u7981\u7528\u65b9\u6cd5\u5982\u4e0b\uff1a</p> Bash<pre><code>echo never &gt;  /sys/kernel/mm/transparent_hugepage/enabled\n</code></pre>"},{"location":"redis/storage/bigkey_aof_rdb/#_1","title":"\u603b\u7ed3","text":"<p>\u5f53 AOF \u5199\u56de\u7b56\u7565\u914d\u7f6e\u4e86 Always \u7b56\u7565\uff0c\u5982\u679c\u5199\u5165\u662f\u4e00\u4e2a\u5927 Key\uff0c\u4e3b\u7ebf\u7a0b\u5728\u6267\u884c fsync() \u51fd\u6570\u7684\u65f6\u5019\uff0c\u963b\u585e\u7684\u65f6\u95f4\u4f1a\u6bd4\u8f83\u4e45\uff0c\u56e0\u4e3a\u5f53\u5199\u5165\u7684\u6570\u636e\u91cf\u5f88\u5927\u7684\u65f6\u5019\uff0c\u6570\u636e\u540c\u6b65\u5230\u786c\u76d8\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5f88\u8017\u65f6\u7684\u3002</p> <p>AOF \u91cd\u5199\u673a\u5236\u548c RDB \u5feb\u7167\uff08bgsave \u547d\u4ee4\uff09\u7684\u8fc7\u7a0b\uff0c\u90fd\u4f1a\u5206\u522b\u901a\u8fc7 <code>fork()</code> \u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u5904\u7406\u4efb\u52a1\u3002\u4f1a\u6709\u4e24\u4e2a\u9636\u6bb5\u4f1a\u5bfc\u81f4\u963b\u585e\u7236\u8fdb\u7a0b\uff08\u4e3b\u7ebf\u7a0b\uff09\uff1a</p> <ul> <li>\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u9014\u4e2d\uff0c\u7531\u4e8e\u8981\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u9875\u8868\u7b49\u6570\u636e\u7ed3\u6784\uff0c\u963b\u585e\u7684\u65f6\u95f4\u8ddf\u9875\u8868\u7684\u5927\u5c0f\u6709\u5173\uff0c\u9875\u8868\u8d8a\u5927\uff0c\u963b\u585e\u7684\u65f6\u95f4\u4e5f\u8d8a\u957f\uff1b</li> <li>\u521b\u5efa\u5b8c\u5b50\u8fdb\u7a0b\u540e\uff0c\u5982\u679c\u7236\u8fdb\u7a0b\u4fee\u6539\u4e86\u5171\u4eab\u6570\u636e\u4e2d\u7684\u5927 Key\uff0c\u5c31\u4f1a\u53d1\u751f\u5199\u65f6\u590d\u5236\uff0c\u8fd9\u671f\u95f4\u4f1a\u62f7\u8d1d\u7269\u7406\u5185\u5b58\uff0c\u7531\u4e8e\u5927 Key \u5360\u7528\u7684\u7269\u7406\u5185\u5b58\u4f1a\u5f88\u5927\uff0c\u90a3\u4e48\u5728\u590d\u5236\u7269\u7406\u5185\u5b58\u8fd9\u4e00\u8fc7\u7a0b\uff0c\u5c31\u4f1a\u6bd4\u8f83\u8017\u65f6\uff0c\u6240\u4ee5\u6709\u53ef\u80fd\u4f1a\u963b\u585e\u7236\u8fdb\u7a0b\u3002</li> </ul> <p>\u5927 key \u9664\u4e86\u4f1a\u5f71\u54cd\u6301\u4e45\u5316\u4e4b\u5916\uff0c\u8fd8\u4f1a\u6709\u4ee5\u4e0b\u7684\u5f71\u54cd\u3002</p> <ul> <li> <p>\u5ba2\u6237\u7aef\u8d85\u65f6\u963b\u585e\u3002\u7531\u4e8e Redis \u6267\u884c\u547d\u4ee4\u662f\u5355\u7ebf\u7a0b\u5904\u7406\uff0c\u7136\u540e\u5728\u64cd\u4f5c\u5927 key \u65f6\u4f1a\u6bd4\u8f83\u8017\u65f6\uff0c\u90a3\u4e48\u5c31\u4f1a\u963b\u585e Redis\uff0c\u4ece\u5ba2\u6237\u7aef\u8fd9\u4e00\u89c6\u89d2\u770b\uff0c\u5c31\u662f\u5f88\u4e45\u5f88\u4e45\u90fd\u6ca1\u6709\u54cd\u5e94\u3002</p> </li> <li> <p>\u5f15\u53d1\u7f51\u7edc\u963b\u585e\u3002\u6bcf\u6b21\u83b7\u53d6\u5927 key \u4ea7\u751f\u7684\u7f51\u7edc\u6d41\u91cf\u8f83\u5927\uff0c\u5982\u679c\u4e00\u4e2a key \u7684\u5927\u5c0f\u662f 1 MB\uff0c\u6bcf\u79d2\u8bbf\u95ee\u91cf\u4e3a 1000\uff0c\u90a3\u4e48\u6bcf\u79d2\u4f1a\u4ea7\u751f 1000MB \u7684\u6d41\u91cf\uff0c\u8fd9\u5bf9\u4e8e\u666e\u901a\u5343\u5146\u7f51\u5361\u7684\u670d\u52a1\u5668\u6765\u8bf4\u662f\u707e\u96be\u6027\u7684\u3002</p> </li> <li> <p>\u963b\u585e\u5de5\u4f5c\u7ebf\u7a0b\u3002\u5982\u679c\u4f7f\u7528 del \u5220\u9664\u5927 key \u65f6\uff0c\u4f1a\u963b\u585e\u5de5\u4f5c\u7ebf\u7a0b\uff0c\u8fd9\u6837\u5c31\u6ca1\u529e\u6cd5\u5904\u7406\u540e\u7eed\u7684\u547d\u4ee4\u3002</p> </li> <li> <p>\u5185\u5b58\u5206\u5e03\u4e0d\u5747\u3002\u96c6\u7fa4\u6a21\u578b\u5728 slot \u5206\u7247\u5747\u5300\u60c5\u51b5\u4e0b\uff0c\u4f1a\u51fa\u73b0\u6570\u636e\u548c\u67e5\u8be2\u503e\u659c\u60c5\u51b5\uff0c\u90e8\u5206\u6709\u5927 key \u7684 Redis \u8282\u70b9\u5360\u7528\u5185\u5b58\u591a\uff0cQPS \u4e5f\u4f1a\u6bd4\u8f83\u5927\u3002</p> </li> </ul> <p>\u5982\u4f55\u907f\u514d\u5927 Key \u5462\uff1f</p> <p>\u6700\u597d\u5728\u8bbe\u8ba1\u9636\u6bb5\uff0c\u5c31\u628a\u5927 key \u62c6\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u5c0f key\u3002\u6216\u8005\uff0c\u5b9a\u65f6\u68c0\u67e5 Redis \u662f\u5426\u5b58\u5728\u5927 key\uff0c\u5982\u679c\u8be5\u5927 key \u662f\u53ef\u4ee5\u5220\u9664\u7684\uff0c\u4e0d\u8981\u4f7f\u7528 DEL \u547d\u4ee4\u5220\u9664\uff0c\u56e0\u4e3a\u8be5\u547d\u4ee4\u5220\u9664\u8fc7\u7a0b\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u800c\u662f\u7528 unlink \u547d\u4ee4\uff08Redis 4.0+\uff09\u5220\u9664\u5927 key\uff0c\u56e0\u4e3a\u8be5\u547d\u4ee4\u7684\u5220\u9664\u8fc7\u7a0b\u662f\u5f02\u6b65\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u3002 </p> <p>\u5b8c\uff01</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"redis/storage/rdb/","title":"RDB \u5feb\u7167\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u54e5\u3002</p> <p>\u867d\u8bf4 Redis \u662f\u5185\u5b58\u6570\u636e\u5e93\uff0c\u4f46\u662f\u5b83\u4e3a\u6570\u636e\u7684\u6301\u4e45\u5316\u63d0\u4f9b\u4e86\u4e24\u4e2a\u6280\u672f\u3002</p> <p>\u5206\u522b\u662f\u300cAOF \u65e5\u5fd7\u548c RDB \u5feb\u7167\u300d\u3002</p> <p>\u8fd9\u4e24\u79cd\u6280\u672f\u90fd\u4f1a\u7528\u5404\u7528\u4e00\u4e2a\u65e5\u5fd7\u6587\u4ef6\u6765\u8bb0\u5f55\u4fe1\u606f\uff0c\u4f46\u662f\u8bb0\u5f55\u7684\u5185\u5bb9\u662f\u4e0d\u540c\u7684\u3002</p> <ul> <li>AOF \u6587\u4ef6\u7684\u5185\u5bb9\u662f\u64cd\u4f5c\u547d\u4ee4\uff1b</li> <li>RDB \u6587\u4ef6\u7684\u5185\u5bb9\u662f\u4e8c\u8fdb\u5236\u6570\u636e\u3002</li> </ul> <p>\u5173\u4e8e AOF \u6301\u4e45\u5316\u7684\u539f\u7406\u6211\u5728\u4e0a\u4e00\u7bc7\u5df2\u7ecf\u4ecb\u7ecd\u4e86\uff0c\u4eca\u5929\u4e3b\u8981\u8bb2\u4e0b RDB \u5feb\u7167\u3002</p> <p>\u6240\u8c13\u7684\u5feb\u7167\uff0c\u5c31\u662f\u8bb0\u5f55\u67d0\u4e00\u4e2a\u77ac\u95f4\u4e1c\u897f\uff0c\u6bd4\u5982\u5f53\u6211\u4eec\u7ed9\u98ce\u666f\u62cd\u7167\u65f6\uff0c\u90a3\u4e00\u4e2a\u77ac\u95f4\u7684\u753b\u9762\u548c\u4fe1\u606f\u5c31\u8bb0\u5f55\u5230\u4e86\u4e00\u5f20\u7167\u7247\u3002</p> <p>\u6240\u4ee5\uff0cRDB \u5feb\u7167\u5c31\u662f\u8bb0\u5f55\u67d0\u4e00\u4e2a\u77ac\u95f4\u7684\u5185\u5b58\u6570\u636e\uff0c\u8bb0\u5f55\u7684\u662f\u5b9e\u9645\u6570\u636e\uff0c\u800c AOF \u6587\u4ef6\u8bb0\u5f55\u7684\u662f\u547d\u4ee4\u64cd\u4f5c\u7684\u65e5\u5fd7\uff0c\u800c\u4e0d\u662f\u5b9e\u9645\u7684\u6570\u636e\u3002</p> <p>\u56e0\u6b64\u5728 Redis \u6062\u590d\u6570\u636e\u65f6\uff0cRDB \u6062\u590d\u6570\u636e\u7684\u6548\u7387\u4f1a\u6bd4 AOF \u9ad8\u4e9b\uff0c\u56e0\u4e3a\u76f4\u63a5\u5c06 RDB \u6587\u4ef6\u8bfb\u5165\u5185\u5b58\u5c31\u53ef\u4ee5\uff0c\u4e0d\u9700\u8981\u50cf AOF \u90a3\u6837\u8fd8\u9700\u8981\u989d\u5916\u6267\u884c\u64cd\u4f5c\u547d\u4ee4\u7684\u6b65\u9aa4\u624d\u80fd\u6062\u590d\u6570\u636e\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u6765\u5177\u4f53\u804a\u804a RDB \u5feb\u7167\u3002</p>"},{"location":"redis/storage/rdb/#_1","title":"\u5feb\u7167\u600e\u4e48\u7528\uff1f","text":"<p>\u8981\u719f\u6089\u4e00\u4e2a\u4e1c\u897f\uff0c\u5148\u770b\u770b\u600e\u4e48\u7528\u662f\u6bd4\u8f83\u597d\u7684\u65b9\u5f0f\u3002</p> <p>Redis \u63d0\u4f9b\u4e86\u4e24\u4e2a\u547d\u4ee4\u6765\u751f\u6210 RDB \u6587\u4ef6\uff0c\u5206\u522b\u662f <code>save</code> \u548c <code>bgsave</code>\uff0c\u4ed6\u4eec\u7684\u533a\u522b\u5c31\u5728\u4e8e\u662f\u5426\u5728\u300c\u4e3b\u7ebf\u7a0b\u300d\u91cc\u6267\u884c\uff1a</p> <ul> <li>\u6267\u884c\u4e86 save \u547d\u4ee4\uff0c\u5c31\u4f1a\u5728\u4e3b\u7ebf\u7a0b\u751f\u6210 RDB \u6587\u4ef6\uff0c\u7531\u4e8e\u548c\u6267\u884c\u64cd\u4f5c\u547d\u4ee4\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u6240\u4ee5\u5982\u679c\u5199\u5165 RDB \u6587\u4ef6\u7684\u65f6\u95f4\u592a\u957f\uff0c\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff1b</li> <li>\u6267\u884c\u4e86 bgsave \u547d\u4ee4\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u6765\u751f\u6210 RDB \u6587\u4ef6\uff0c\u8fd9\u6837\u53ef\u4ee5\u907f\u514d\u4e3b\u7ebf\u7a0b\u7684\u963b\u585e\uff1b</li> </ul> <p>RDB \u6587\u4ef6\u7684\u52a0\u8f7d\u5de5\u4f5c\u662f\u5728\u670d\u52a1\u5668\u542f\u52a8\u65f6\u81ea\u52a8\u6267\u884c\u7684\uff0cRedis \u5e76\u6ca1\u6709\u63d0\u4f9b\u4e13\u95e8\u7528\u4e8e\u52a0\u8f7d RDB \u6587\u4ef6\u7684\u547d\u4ee4\u3002</p> <p>Redis \u8fd8\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\u6587\u4ef6\u7684\u9009\u9879\u6765\u5b9e\u73b0\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\u81ea\u52a8\u6267\u884c\u4e00\u6b21 bgsave \u547d\u4ee4\uff0c\u9ed8\u8ba4\u4f1a\u63d0\u4f9b\u4ee5\u4e0b\u914d\u7f6e\uff1a</p> Text Only<pre><code>save 900 1\nsave 300 10\nsave 60 10000\n</code></pre> <p>\u522b\u770b\u9009\u9879\u540d\u53eb save\uff0c\u5b9e\u9645\u4e0a\u6267\u884c\u7684\u662f bgsave \u547d\u4ee4\uff0c\u4e5f\u5c31\u662f\u4f1a\u521b\u5efa\u5b50\u8fdb\u7a0b\u6765\u751f\u6210 RDB \u5feb\u7167\u6587\u4ef6\u3002</p> <p>\u53ea\u8981\u6ee1\u8db3\u4e0a\u9762\u6761\u4ef6\u7684\u4efb\u610f\u4e00\u4e2a\uff0c\u5c31\u4f1a\u6267\u884c bgsave\uff0c\u5b83\u4eec\u7684\u610f\u601d\u5206\u522b\u662f\uff1a</p> <ul> <li>900 \u79d2\u4e4b\u5185\uff0c\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e86\u81f3\u5c11 1 \u6b21\u4fee\u6539\uff1b</li> <li>300 \u79d2\u4e4b\u5185\uff0c\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e86\u81f3\u5c11 10 \u6b21\u4fee\u6539\uff1b</li> <li>60 \u79d2\u4e4b\u5185\uff0c\u5bf9\u6570\u636e\u5e93\u8fdb\u884c\u4e86\u81f3\u5c11 10000 \u6b21\u4fee\u6539\u3002</li> </ul> <p>\u8fd9\u91cc\u63d0\u4e00\u70b9\uff0cRedis \u7684\u5feb\u7167\u662f\u5168\u91cf\u5feb\u7167\uff0c\u4e5f\u5c31\u662f\u8bf4\u6bcf\u6b21\u6267\u884c\u5feb\u7167\uff0c\u90fd\u662f\u628a\u5185\u5b58\u4e2d\u7684\u300c\u6240\u6709\u6570\u636e\u300d\u90fd\u8bb0\u5f55\u5230\u78c1\u76d8\u4e2d\u3002</p> <p>\u6240\u4ee5\u53ef\u4ee5\u8ba4\u4e3a\uff0c\u6267\u884c\u5feb\u7167\u662f\u4e00\u4e2a\u6bd4\u8f83\u91cd\u7684\u64cd\u4f5c\uff0c\u5982\u679c\u9891\u7387\u592a\u9891\u7e41\uff0c\u53ef\u80fd\u4f1a\u5bf9 Redis \u6027\u80fd\u4ea7\u751f\u5f71\u54cd\u3002\u5982\u679c\u9891\u7387\u592a\u4f4e\uff0c\u670d\u52a1\u5668\u6545\u969c\u65f6\uff0c\u4e22\u5931\u7684\u6570\u636e\u4f1a\u66f4\u591a\u3002</p> <p>\u901a\u5e38\u53ef\u80fd\u8bbe\u7f6e\u81f3\u5c11 5 \u5206\u949f\u624d\u4fdd\u5b58\u4e00\u6b21\u5feb\u7167\uff0c\u8fd9\u65f6\u5982\u679c Redis \u51fa\u73b0\u5b95\u673a\u7b49\u60c5\u51b5\uff0c\u5219\u610f\u5473\u7740\u6700\u591a\u53ef\u80fd\u4e22\u5931 5 \u5206\u949f\u6570\u636e\u3002</p> <p>\u8fd9\u5c31\u662f RDB \u5feb\u7167\u7684\u7f3a\u70b9\uff0c\u5728\u670d\u52a1\u5668\u53d1\u751f\u6545\u969c\u65f6\uff0c\u4e22\u5931\u7684\u6570\u636e\u4f1a\u6bd4 AOF \u6301\u4e45\u5316\u7684\u65b9\u5f0f\u66f4\u591a\uff0c\u56e0\u4e3a RDB \u5feb\u7167\u662f\u5168\u91cf\u5feb\u7167\u7684\u65b9\u5f0f\uff0c\u56e0\u6b64\u6267\u884c\u7684\u9891\u7387\u4e0d\u80fd\u592a\u9891\u7e41\uff0c\u5426\u5219\u4f1a\u5f71\u54cd Redis \u6027\u80fd\uff0c\u800c AOF \u65e5\u5fd7\u53ef\u4ee5\u4ee5\u79d2\u7ea7\u7684\u65b9\u5f0f\u8bb0\u5f55\u64cd\u4f5c\u547d\u4ee4\uff0c\u6240\u4ee5\u4e22\u5931\u7684\u6570\u636e\u5c31\u76f8\u5bf9\u66f4\u5c11\u3002</p>"},{"location":"redis/storage/rdb/#_2","title":"\u6267\u884c\u5feb\u7167\u65f6\uff0c\u6570\u636e\u80fd\u88ab\u4fee\u6539\u5417\uff1f","text":"<p>\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u6267\u884c bgsave \u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u662f\u4ea4\u7ed9\u5b50\u8fdb\u7a0b\u6765\u6784\u5efa RDB \u6587\u4ef6\uff0c\u4e3b\u7ebf\u7a0b\u8fd8\u662f\u53ef\u4ee5\u7ee7\u7eed\u5de5\u4f5c\u7684\uff0c\u6b64\u65f6\u4e3b\u7ebf\u7a0b\u53ef\u4ee5\u4fee\u6539\u6570\u636e\u5417\uff1f</p> <p>\u5982\u679c\u4e0d\u53ef\u4ee5\u4fee\u6539\u6570\u636e\u7684\u8bdd\uff0c\u90a3\u8fd9\u6837\u6027\u80fd\u4e00\u4e0b\u5c31\u964d\u4f4e\u4e86\u5f88\u591a\u3002\u5982\u679c\u53ef\u4ee5\u4fee\u6539\u6570\u636e\uff0c\u53c8\u662f\u5982\u4f55\u505a\u5230\u5230\u5462\uff1f</p> <p>\u76f4\u63a5\u8bf4\u7ed3\u8bba\u5427\uff0c\u6267\u884c bgsave \u8fc7\u7a0b\u4e2d\uff0cRedis \u4f9d\u7136\u53ef\u4ee5\u7ee7\u7eed\u5904\u7406\u64cd\u4f5c\u547d\u4ee4\u7684\uff0c\u4e5f\u5c31\u662f\u6570\u636e\u662f\u80fd\u88ab\u4fee\u6539\u7684\u3002</p> <p>\u90a3\u5177\u4f53\u5982\u4f55\u505a\u5230\u5230\u5462\uff1f\u5173\u952e\u7684\u6280\u672f\u5c31\u5728\u4e8e\u5199\u65f6\u590d\u5236\u6280\u672f\uff08Copy-On-Write, COW\uff09\u3002</p> <p>\u6267\u884c bgsave \u547d\u4ee4\u7684\u65f6\u5019\uff0c\u4f1a\u901a\u8fc7 <code>fork()</code> \u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u6b64\u65f6\u5b50\u8fdb\u7a0b\u548c\u7236\u8fdb\u7a0b\u662f\u5171\u4eab\u540c\u4e00\u7247\u5185\u5b58\u6570\u636e\u7684\uff0c\u56e0\u4e3a\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u4f1a\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u9875\u8868\uff0c\u4f46\u662f\u9875\u8868\u6307\u5411\u7684\u7269\u7406\u5185\u5b58\u8fd8\u662f\u4e00\u4e2a\u3002</p> <p></p> <p>\u53ea\u6709\u5728\u53d1\u751f\u4fee\u6539\u5185\u5b58\u6570\u636e\u7684\u60c5\u51b5\u65f6\uff0c\u7269\u7406\u5185\u5b58\u624d\u4f1a\u88ab\u590d\u5236\u4e00\u4efd\u3002</p> <p></p> <p>\u8fd9\u6837\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u521b\u5efa\u5b50\u8fdb\u7a0b\u65f6\u7684\u6027\u80fd\u635f\u8017\uff0c\u4ece\u800c\u52a0\u5feb\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u901f\u5ea6\uff0c\u6bd5\u7adf\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u8fc7\u7a0b\u4e2d\uff0c\u662f\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u521b\u5efa bgsave \u5b50\u8fdb\u7a0b\u540e\uff0c\u7531\u4e8e\u5171\u4eab\u7236\u8fdb\u7a0b\u7684\u6240\u6709\u5185\u5b58\u6570\u636e\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u76f4\u63a5\u8bfb\u53d6\u4e3b\u7ebf\u7a0b\uff08\u7236\u8fdb\u7a0b\uff09\u91cc\u7684\u5185\u5b58\u6570\u636e\uff0c\u5e76\u5c06\u6570\u636e\u5199\u5165\u5230 RDB \u6587\u4ef6\u3002</p> <p>\u5f53\u4e3b\u7ebf\u7a0b\uff08\u7236\u8fdb\u7a0b\uff09\u5bf9\u8fd9\u4e9b\u5171\u4eab\u7684\u5185\u5b58\u6570\u636e\u4e5f\u90fd\u662f\u53ea\u8bfb\u64cd\u4f5c\uff0c\u90a3\u4e48\uff0c\u4e3b\u7ebf\u7a0b\uff08\u7236\u8fdb\u7a0b\uff09\u548c bgsave \u5b50\u8fdb\u7a0b\u76f8\u4e92\u4e0d\u5f71\u54cd\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u4e3b\u7ebf\u7a0b\uff08\u7236\u8fdb\u7a0b\uff09\u8981\u4fee\u6539\u5171\u4eab\u6570\u636e\u91cc\u7684\u67d0\u4e00\u5757\u6570\u636e\uff08\u6bd4\u5982\u952e\u503c\u5bf9 <code>A</code>\uff09\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u5199\u65f6\u590d\u5236\uff0c\u4e8e\u662f\u8fd9\u5757\u6570\u636e\u7684\u7269\u7406\u5185\u5b58\u5c31\u4f1a\u88ab\u590d\u5236\u4e00\u4efd\uff08\u952e\u503c\u5bf9 <code>A'</code>\uff09\uff0c\u7136\u540e\u4e3b\u7ebf\u7a0b\u5728\u8fd9\u4e2a\u6570\u636e\u526f\u672c\uff08\u952e\u503c\u5bf9 <code>A'</code>\uff09\u8fdb\u884c\u4fee\u6539\u64cd\u4f5c\u3002\u4e0e\u6b64\u540c\u65f6\uff0cbgsave \u5b50\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u628a\u539f\u6765\u7684\u6570\u636e\uff08\u952e\u503c\u5bf9 <code>A</code>\uff09\u5199\u5165\u5230 RDB \u6587\u4ef6\u3002</p> <p>\u5c31\u662f\u8fd9\u6837\uff0cRedis \u4f7f\u7528 bgsave \u5bf9\u5f53\u524d\u5185\u5b58\u4e2d\u7684\u6240\u6709\u6570\u636e\u505a\u5feb\u7167\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u7531 bgsave \u5b50\u8fdb\u7a0b\u5728\u540e\u53f0\u5b8c\u6210\u7684\uff0c\u6267\u884c\u65f6\u4e0d\u4f1a\u963b\u585e\u4e3b\u7ebf\u7a0b\uff0c\u8fd9\u5c31\u4f7f\u5f97\u4e3b\u7ebf\u7a0b\u540c\u65f6\u53ef\u4ee5\u4fee\u6539\u6570\u636e\u3002</p> <p>\u7ec6\u5fc3\u7684\u540c\u5b66\uff0c\u80af\u5b9a\u53d1\u73b0\u4e86\uff0cbgsave \u5feb\u7167\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4e3b\u7ebf\u7a0b\u4fee\u6539\u4e86\u5171\u4eab\u6570\u636e\uff0c\u53d1\u751f\u4e86\u5199\u65f6\u590d\u5236\u540e\uff0cRDB \u5feb\u7167\u4fdd\u5b58\u7684\u662f\u539f\u672c\u7684\u5185\u5b58\u6570\u636e\uff0c\u800c\u4e3b\u7ebf\u7a0b\u521a\u4fee\u6539\u7684\u6570\u636e\uff0c\u662f\u6ca1\u529e\u6cd5\u5728\u8fd9\u4e00\u65f6\u95f4\u5199\u5165 RDB \u6587\u4ef6\u7684\uff0c\u53ea\u80fd\u4ea4\u7531\u4e0b\u4e00\u6b21\u7684 bgsave \u5feb\u7167\u3002</p> <p>\u6240\u4ee5 Redis \u5728\u4f7f\u7528 bgsave \u5feb\u7167\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4e3b\u7ebf\u7a0b\u4fee\u6539\u4e86\u5185\u5b58\u6570\u636e\uff0c\u4e0d\u7ba1\u662f\u5426\u662f\u5171\u4eab\u7684\u5185\u5b58\u6570\u636e\uff0cRDB \u5feb\u7167\u90fd\u65e0\u6cd5\u5199\u5165\u4e3b\u7ebf\u7a0b\u521a\u4fee\u6539\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u6b64\u65f6\u4e3b\u7ebf\u7a0b\uff08\u7236\u8fdb\u7a0b\uff09\u7684\u5185\u5b58\u6570\u636e\u548c\u5b50\u8fdb\u7a0b\u7684\u5185\u5b58\u6570\u636e\u5df2\u7ecf\u5206\u79bb\u4e86\uff0c\u5b50\u8fdb\u7a0b\u5199\u5165\u5230 RDB \u6587\u4ef6\u7684\u5185\u5b58\u6570\u636e\u53ea\u80fd\u662f\u539f\u672c\u7684\u5185\u5b58\u6570\u636e\u3002</p> <p>\u5982\u679c\u7cfb\u7edf\u6070\u597d\u5728 RDB \u5feb\u7167\u6587\u4ef6\u521b\u5efa\u5b8c\u6bd5\u540e\u5d29\u6e83\u4e86\uff0c\u90a3\u4e48 Redis \u5c06\u4f1a\u4e22\u5931\u4e3b\u7ebf\u7a0b\u5728\u5feb\u7167\u671f\u95f4\u4fee\u6539\u7684\u6570\u636e\u3002</p> <p>\u53e6\u5916\uff0c\u5199\u65f6\u590d\u5236\u7684\u65f6\u5019\u4f1a\u51fa\u73b0\u8fd9\u4e48\u4e2a\u6781\u7aef\u7684\u60c5\u51b5\u3002</p> <p>\u5728 Redis \u6267\u884c RDB \u6301\u4e45\u5316\u671f\u95f4\uff0c\u521a fork \u65f6\uff0c\u4e3b\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u5171\u4eab\u540c\u4e00\u7269\u7406\u5185\u5b58\uff0c\u4f46\u662f\u9014\u4e2d\u4e3b\u8fdb\u7a0b\u5904\u7406\u4e86\u5199\u64cd\u4f5c\uff0c\u4fee\u6539\u4e86\u5171\u4eab\u5185\u5b58\uff0c\u4e8e\u662f\u5f53\u524d\u88ab\u4fee\u6539\u7684\u6570\u636e\u7684\u7269\u7406\u5185\u5b58\u5c31\u4f1a\u88ab\u590d\u5236\u4e00\u4efd\u3002</p> <p>\u90a3\u4e48\u6781\u7aef\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u6240\u6709\u7684\u5171\u4eab\u5185\u5b58\u90fd\u88ab\u4fee\u6539\uff0c\u5219\u6b64\u65f6\u7684\u5185\u5b58\u5360\u7528\u662f\u539f\u5148\u7684 2 \u500d\u3002</p> <p>\u6240\u4ee5\uff0c\u9488\u5bf9\u5199\u64cd\u4f5c\u591a\u7684\u573a\u666f\uff0c\u6211\u4eec\u8981\u7559\u610f\u4e0b\u5feb\u7167\u8fc7\u7a0b\u4e2d\u5185\u5b58\u7684\u53d8\u5316\uff0c\u9632\u6b62\u5185\u5b58\u88ab\u5360\u6ee1\u4e86\u3002</p>"},{"location":"redis/storage/rdb/#rdb-aof","title":"RDB \u548c AOF \u5408\u4f53","text":"<p>\u5c3d\u7ba1 RDB \u6bd4 AOF \u7684\u6570\u636e\u6062\u590d\u901f\u5ea6\u5feb\uff0c\u4f46\u662f\u5feb\u7167\u7684\u9891\u7387\u4e0d\u597d\u628a\u63e1\uff1a</p> <ul> <li>\u5982\u679c\u9891\u7387\u592a\u4f4e\uff0c\u4e24\u6b21\u5feb\u7167\u95f4\u4e00\u65e6\u670d\u52a1\u5668\u53d1\u751f\u5b95\u673a\uff0c\u5c31\u53ef\u80fd\u4f1a\u4e22\u5931\u6bd4\u8f83\u591a\u7684\u6570\u636e\uff1b</li> <li>\u5982\u679c\u9891\u7387\u592a\u9ad8\uff0c\u9891\u7e41\u5199\u5165\u78c1\u76d8\u548c\u521b\u5efa\u5b50\u8fdb\u7a0b\u4f1a\u5e26\u6765\u989d\u5916\u7684\u6027\u80fd\u5f00\u9500\u3002</li> </ul> <p>\u90a3\u6709\u6ca1\u6709\u4ec0\u4e48\u65b9\u6cd5\u4e0d\u4ec5\u6709 RDB \u6062\u590d\u901f\u5ea6\u5feb\u7684\u4f18\u70b9\u548c\uff0c\u53c8\u6709 AOF \u4e22\u5931\u6570\u636e\u5c11\u7684\u4f18\u70b9\u5462\uff1f</p> <p>\u5f53\u7136\u6709\uff0c\u90a3\u5c31\u662f\u5c06 RDB \u548c AOF \u5408\u4f53\u4f7f\u7528\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u662f\u5728 Redis 4.0 \u63d0\u51fa\u7684\uff0c\u8be5\u65b9\u6cd5\u53eb\u6df7\u5408\u4f7f\u7528 AOF \u65e5\u5fd7\u548c\u5185\u5b58\u5feb\u7167\uff0c\u4e5f\u53eb\u6df7\u5408\u6301\u4e45\u5316\u3002</p> <p>\u5982\u679c\u60f3\u8981\u5f00\u542f\u6df7\u5408\u6301\u4e45\u5316\u529f\u80fd\uff0c\u53ef\u4ee5\u5728 Redis \u914d\u7f6e\u6587\u4ef6\u5c06\u4e0b\u9762\u8fd9\u4e2a\u914d\u7f6e\u9879\u8bbe\u7f6e\u6210 yes\uff1a</p> Text Only<pre><code>aof-use-rdb-preamble yes\n</code></pre> <p>\u6df7\u5408\u6301\u4e45\u5316\u5de5\u4f5c\u5728 AOF \u65e5\u5fd7\u91cd\u5199\u8fc7\u7a0b\u3002</p> <p>\u5f53\u5f00\u542f\u4e86\u6df7\u5408\u6301\u4e45\u5316\u65f6\uff0c\u5728 AOF \u91cd\u5199\u65e5\u5fd7\u65f6\uff0c<code>fork</code> \u51fa\u6765\u7684\u91cd\u5199\u5b50\u8fdb\u7a0b\u4f1a\u5148\u5c06\u4e0e\u4e3b\u7ebf\u7a0b\u5171\u4eab\u7684\u5185\u5b58\u6570\u636e\u4ee5 RDB \u65b9\u5f0f\u5199\u5165\u5230 AOF \u6587\u4ef6\uff0c\u7136\u540e\u4e3b\u7ebf\u7a0b\u5904\u7406\u7684\u64cd\u4f5c\u547d\u4ee4\u4f1a\u88ab\u8bb0\u5f55\u5728\u91cd\u5199\u7f13\u51b2\u533a\u91cc\uff0c\u91cd\u5199\u7f13\u51b2\u533a\u91cc\u7684\u589e\u91cf\u547d\u4ee4\u4f1a\u4ee5 AOF \u65b9\u5f0f\u5199\u5165\u5230 AOF \u6587\u4ef6\uff0c\u5199\u5165\u5b8c\u6210\u540e\u901a\u77e5\u4e3b\u8fdb\u7a0b\u5c06\u65b0\u7684\u542b\u6709 RDB \u683c\u5f0f\u548c AOF \u683c\u5f0f\u7684 AOF \u6587\u4ef6\u66ff\u6362\u65e7\u7684\u7684 AOF \u6587\u4ef6\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u4f7f\u7528\u4e86\u6df7\u5408\u6301\u4e45\u5316\uff0cAOF \u6587\u4ef6\u7684\u524d\u534a\u90e8\u5206\u662f RDB \u683c\u5f0f\u7684\u5168\u91cf\u6570\u636e\uff0c\u540e\u534a\u90e8\u5206\u662f AOF \u683c\u5f0f\u7684\u589e\u91cf\u6570\u636e\u3002</p> <p></p> <p>\u8fd9\u6837\u7684\u597d\u5904\u5728\u4e8e\uff0c\u91cd\u542f Redis \u52a0\u8f7d\u6570\u636e\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u524d\u534a\u90e8\u5206\u662f RDB \u5185\u5bb9\uff0c\u8fd9\u6837\u52a0\u8f7d\u7684\u65f6\u5019\u901f\u5ea6\u4f1a\u5f88\u5feb\u3002</p> <p>\u52a0\u8f7d\u5b8c RDB \u7684\u5185\u5bb9\u540e\uff0c\u624d\u4f1a\u52a0\u8f7d\u540e\u534a\u90e8\u5206\u7684 AOF \u5185\u5bb9\uff0c\u8fd9\u91cc\u7684\u5185\u5bb9\u662f Redis \u540e\u53f0\u5b50\u8fdb\u7a0b\u91cd\u5199 AOF \u671f\u95f4\uff0c\u4e3b\u7ebf\u7a0b\u5904\u7406\u7684\u64cd\u4f5c\u547d\u4ee4\uff0c\u53ef\u4ee5\u4f7f\u5f97\u6570\u636e\u66f4\u5c11\u7684\u4e22\u5931\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/","title":"\u56fe\u89e3\u7cfb\u7edf\u4ecb\u7ecd","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u662f\u300a\u56fe\u89e3\u7cfb\u7edf\u300b\u7684\u4f5c\u8005\uff0c\u672c\u7ad9\u7684\u5185\u5bb9\u90fd\u662f\u6574\u7406\u4e8e\u6211\u516c\u4f17\u53f7\u91cc\u7684\u56fe\u89e3\u6587\u7ae0\u3002</p> <p>\u8fd8\u6ca1\u5173\u6ce8\u7684\u670b\u53cb\uff0c\u53ef\u4ee5\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7\uff0c\u540e\u7eed\u6700\u65b0\u7248\u672c\u7684 PDF \u4f1a\u5728\u6211\u7684\u516c\u4f17\u53f7\u7b2c\u4e00\u65f6\u95f4\u53d1\u5e03\uff0c\u800c\u4e14\u4f1a\u6709\u66f4\u591a\u5176\u4ed6\u7cfb\u5217\u7684\u56fe\u89e3\u6587\u7ae0\uff0c\u6bd4\u5982\u64cd\u4f5c\u7cfb\u7edf\u3001\u8ba1\u7b97\u673a\u7ec4\u6210\u3001\u6570\u636e\u5e93\u3001\u7b97\u6cd5\u7b49\u7b49\u3002</p> <p>\u7b80\u5355\u4ecb\u7ecd\u4e0b\u8fd9\u4e2a\u300a\u56fe\u89e3\u7cfb\u7edf\u300b\uff0c\u6574\u4e2a\u5185\u5bb9\u5171\u6709 <code>16W</code> \u5b57 + <code>400</code> \u5f20\u56fe\uff0c\u6587\u5b57\u90fd\u662f\u5c0f\u6797\u4e00\u4e2a\u5b57\u4e00\u4e2a\u5b57\u6572\u51fa\u6765\u7684\uff0c\u56fe\u7247\u90fd\u662f\u5c0f\u6797\u4e00\u4e2a\u70b9\u4e00\u6761\u7ebf\u753b\u51fa\u6765\u7684\uff0c\u975e\u5e38\u7684\u4e0d\u5bb9\u6613\u3002</p> <p></p> <p>\u56fe\u89e3\u7cfb\u7edf\u4e0d\u4ec5\u4ec5\u6d89\u53ca\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5bb9\uff0c\u8fd8\u6d89\u53ca\u4e00\u4e9b\u8ba1\u7b97\u673a\u7ec4\u6210\u548c Linux \u547d\u4ee4\u7684\u5185\u5bb9\uff0c</p> <p>\u5f53\u7136\u8fd8\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5bb9\u5360\u6bd4\u8f83\u9ad8\uff0c\u57fa\u672c\u628a\u64cd\u4f5c\u7cfb\u7edf\u8fdb\u7a0b\u7ba1\u7406\u3001\u5185\u5b58\u7ba1\u7406\u3001\u6587\u4ef6\u7cfb\u7edf\u3001\u8bbe\u5907\u7ba1\u7406\u3001\u7f51\u7edc\u7cfb\u7edf\u8fd9\u4e94\u5927\u7ed3\u6784\u56fe\u89e3\u4e86\uff0c\u5176\u4e2d\u8fdb\u7a0b\u7ba1\u7406\u548c\u7f51\u7edc\u7cfb\u7edf\u8fd9\u4e24\u4e2a\u7ae0\u8282\u7bc7\u5e45\u6bd4\u8f83\u591a\uff0c\u8fdb\u7a0b\u7ba1\u7406\u4e0d\u4ec5\u5305\u542b\u4e86\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b\u7684\u57fa\u672c\u77e5\u8bc6\uff0c\u8fd8\u5305\u542b\u4e86\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u591a\u7ebf\u7a0b\u540c\u6b65\u3001\u6b7b\u9501\u3001\u60b2\u89c2\u9501\u548c\u4e50\u89c2\u9501\u3002\u7f51\u7edc\u7cfb\u7edf\u5305\u542b I/O \u591a\u8def\u590d\u7528\u3001\u96f6\u62f7\u8d1d\u3001Reactor \u7b49\u7b49\u3002</p> <p>\u8ba1\u7b97\u673a\u7ec4\u6210\u4e3b\u8981\u6d89\u53ca\u662f CPU \u65b9\u9762\u7684\u77e5\u8bc6\uff0c\u6211\u4eec\u4e0d\u5173\u6ce8 CPU \u662f\u600e\u4e48\u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u7684\uff0c\u53ea\u5173\u6ce8\u8ddf\u6211\u4eec\u5f00\u53d1\u8005\u6709\u5173\u7cfb\u7684 CPU \u77e5\u8bc6\uff0c\u6bd4\u5982 CPU \u6267\u884c\u7a0b\u5e8f\u7684\u539f\u7406\uff0cCPU \u7f13\u5b58\uff0cCPU \u4f2a\u5171\u4eab\u7b49\u7b49\uff0c\u8fd9\u4e9b\u770b\u4f3c\u8ddf\u6211\u4eec\u5f00\u53d1\u8005\u65e0\u5173\uff0c\u5b9e\u9645\u4e0a\u5173\u7cfb\u633a\u5927\u7684\uff0c\u53ea\u6709\u4e86\u89e3 CPU \u7f13\u5b58\u624d\u80fd\u5199\u51fa\u66f4\u5feb\u7684\u4ee3\u7801\uff0c\u53ea\u8981\u4e86\u89e3 CPU \u4f2a\u5171\u4eab\u624d\u80fd\u907f\u514d\u5199\u51fa\u65e0\u6548\u7f13\u5b58\u7684\u4ee3\u7801\u3002</p> <p>\u81f3\u4e8e Linux \u547d\u4ee4\u7684\u7ae0\u8282\u6682\u65f6\u5185\u5bb9\u6ca1\u6709\u5f88\u591a\uff0c\u4e3b\u8981\u5c31\u5199\u4e86\u5982\u4f55\u7528 Linux \u547d\u4ee4\u300c\u67e5\u770b\u7f51\u7edc\u6307\u6807\u300d\u548c\u300c\u4ece\u65e5\u5fd7\u5206\u6790 PV\u3001UV\u300d\uff0c\u4e4b\u6240\u4ee5\u6ca1\u6709\u5199\u592a\u591a\u662f\u89c9\u5f97\u547d\u4ee4\u7c7b\u7684\u6587\u7ae0\u6ca1\u529e\u6cd5\u4f53\u73b0\u51fa\u5c0f\u6797\u7684\u56fe\u89e3\u529f\u529b\uff0c\u518d\u52a0\u4e0a\u8fd9\u7c7b\u547d\u4ee4\u4e00\u822c\u7f51\u4e0a\u8d44\u6e90\u4e5f\u5f88\u591a\uff0c\u5de5\u4f5c\u4e2d\u9047\u5230\u9700\u8981\u4f7f\u7528\u67d0\u4e2a\u547d\u4ee4\u65f6\uff0c\u53bb\u641c\u7d22\u4e86\u89e3\u5e76\u81ea\u5df1\u4f53\u9a8c\u4e86\u4e00\u756a\u540e\uff0c\u624d\u4f1a\u6bd4\u8f83\u6df1\u523b\uff0c\u5355\u7eaf\u53ea\u770b\u6587\u7ae0\u5f88\u5bb9\u6613\u5c31\u5fd8\u8bb0\u8fd9\u4e9b\u547d\u4ee4\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_2","title":"\u5c0f\u767d\u9002\u5408\u770b\u5417\uff1f","text":"<p>\u300a\u56fe\u89e3\u7cfb\u7edf\u300b\u4e0d\u662f\u5355\u7eaf\u7684\u9762\u7ecf\uff0c\u800c\u662f\u76f8\u5bf9\u6bd4\u8f83\u7cfb\u7edf\u5316\u7684\u5185\u5bb9\uff0c\u5f53\u7136\u5c0f\u6797\u6240\u5199\u7684\u5185\u5bb9\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u91cd\u70b9\u77e5\u8bc6\uff0c\u4e5f\u662f\u9762\u8bd5\u5e38\u95ee\u7684\u77e5\u8bc6\u70b9\u3002</p> <p>\u6211\u89c9\u5f97\u76f8\u6bd4\u80cc\u96f6\u96f6\u6563\u6563\u7684\u9762\u7ecf\uff0c\u66f4\u5efa\u8bae\u4f60\u5b66\u597d\u6574\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u77e5\u8bc6\u4f53\u7cfb\uff0c\u540e\u9762\u4f60\u5728\u770b\u9762\u7ecf\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u53d1\u89c9\u8fd9\u4e9b\u53ea\u4e0d\u8fc7\u662f\u8fd9\u9897\u77e5\u8bc6\u6811\u4e2d\u7684\u4e00\u4e2a\u5c0f\u5206\u652f\uff0c\u800c\u4e14\u5ef6\u5c55\u6027\u4f1a\u66f4\u597d\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u662f\u5f88\u5bb9\u6613\u8ba9\u5c0f\u767d\u754f\u60e7\u4e00\u95e8\u8bfe\uff0c\u56e0\u4e3a\u4e0d\u7ba1\u54ea\u672c\u64cd\u4f5c\u7cfb\u7edf\u4e66\u90fd\u662f\u539a\u539a\u7684\uff0c\u5c31\u4f1a\u89c9\u5f97\u64cd\u4f5c\u7cfb\u7edf\u4e1c\u897f\u592a\u591a\uff0c\u800c\u4e14\u4e5f\u4e0d\u5bb9\u6613\u770b\u61c2\uff0c\u6bcf\u4e2a\u5b57\u6211\u4eec\u80fd\u5f97\u61c2\uff0c\u4f46\u662f\u8fde\u6210\u4e00\u53e5\u8bdd\u5c31\u770b\u61f5\u4e86\u3002</p> <p>\u5176\u5b9e\u5c0f\u6797\u5f53\u65f6\u5728\u5165\u95e8\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u8ddf\u5927\u5bb6\u611f\u53d7\u4e00\u6837\u7684\uff0c\u8c01\u4e0d\u662f\u4ece\u5c0f\u767d\u5ea6\u8fc7\u8fc7\u6765\u7684\u5462\uff1f</p> <p>\u4e4b\u524d\u6211\u82b1\u4e86\u5f88\u591a\u65f6\u95f4\u770b\u4e66\u548c\u770b\u89c6\u9891\uff0c\u5b66\u597d\u64cd\u4f5c\u7cfb\u7edf\u540e\uff0c\u6211\u5c31\u5728\u60f3\u80fd\u4e0d\u80fd\u5199\u4e00\u4efd\u5e2e\u52a9\u5927\u5bb6\u5feb\u901f\u5165\u95e8\u64cd\u4f5c\u7cfb\u7edf\u7cfb\u7edf\u6587\u7ae0\u5462\uff0c\u4e8e\u662f\u5c31\u5f00\u59cb\u8e0f\u4e0a\u4e86\u56fe\u89e3\u4e4b\u8def\uff0c\u7528\u7cbe\u7f8e\u7684\u56fe\u7247\u6253\u7834\u5927\u5bb6\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u7684\u754f\u60e7\u611f\u3002</p> <p>\u4e8b\u5b9e\u8bc1\u660e\uff0c\u56fe\u89e3\u7cfb\u5217\u662f\u6b63\u786e\u7684\uff0c\u5728\u516c\u4f17\u53f7\u8fde\u7eed\u5199\u4e86\u5f88\u591a\u7bc7\u56fe\u89e3\u7cfb\u7edf\u7684\u6587\u7ae0\u540e\uff0c\u6536\u5230\u4e86\u975e\u5e38\u591a\u8bfb\u8005\u7684\u652f\u6301\u4e0e\u8ba4\u53ef\uff0c\u6709\u53cd\u9988\u4ee5\u524d\u5927\u5b66\u6ca1\u5b66\u4f1a\u7684\uff0c\u7136\u540e\u770b\u4e86\u6211\u7684\u6587\u7ae0\u7a81\u7136\u5c31\u9192\u609f\u4e86\uff0c\u4e5f\u6709\u53cd\u9988\u9762\u8bd5\u524d\u7a81\u51fb\u4e86\u6211\u7684\u6587\u7ae0\uff0c\u7136\u540e\u62ff\u5230\u4e86\u5fc3\u610f\u7684 offer\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u4efd\u56fe\u89e3\u7cfb\u7edf\u9002\u5408\u5c0f\u767d\u5b66\u4e60\uff0c\u4e5f\u53ef\u4ee5\u5f53\u4f5c\u9762\u8bd5\u7a81\u51fb\u7528\u7684\u624b\u518c\u3002</p> <p>\u4e0d\u8fc7\uff0c\u518d\u600e\u4e48\u5439\u6211\u7684\u300a\u56fe\u89e3\u7cfb\u7edf\u300b\uff0c\u5982\u679c\u5927\u5bb6\u60f3\u8981\u7cfb\u7edf\u5316\u5168\u9762\u7684\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\uff0c\u81ea\u7136\u8fd8\u662f\u79bb\u4e0d\u5f00\u4e66\u7684\uff0c\u300a\u56fe\u89e3\u7cfb\u7edf\u300b\u7684\u672b\u5c3e\u4f1a\u6709\u6211\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\u7684\u5fc3\u5f97\uff0c\u4f1a\u63a8\u8350\u6211\u770b\u8fc7\u5e76\u4e14\u8ba4\u4e3a\u4e0d\u9519\u7684\u4e66\u548c\u89c6\u9891\uff0c\u5927\u5bb6\u53ef\u4ee5\u7559\u610f\u4e00\u4e0b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_3","title":"\u8981\u600e\u4e48\u9605\u8bfb\uff1f","text":"<p>\u5f88\u8bda\u6073\u7684\u544a\u8bc9\u4f60\uff0c\u300a\u56fe\u89e3\u7cfb\u7edf\u300b\u4e0d\u662f\u6559\u79d1\u4e66\u3002\u800c\u662f\u6211\u5728\u516c\u4f17\u53f7\u91cc\u5199\u7684\u56fe\u89e3\u7cfb\u7edf\u6587\u7ae0\u7684\u6574\u5408\uff0c\u6240\u4ee5\u80af\u5b9a\u662f\u6ca1\u6709\u6559\u79d1\u4e66\u90a3\u4e48\u7ec6\u81f4\u548c\u5168\u9762\uff0c\u5f53\u7136\u4e5f\u5c31\u4e0d\u4f1a\u6709\u5f88\u591a\u5e9f\u8bdd\uff0c\u90fd\u662f\u76f4\u51fb\u91cd\u70b9\uff0c\u4e0d\u7ed5\u5f2f\uff0c\u800c\u4e14\u6709\u7684\u77e5\u8bc6\u70b9\u4e66\u4e0a\u770b\u4e0d\u5230\u3002</p> <p>\u9605\u8bfb\u7684\u987a\u5e8f\u53ef\u4ee5\u4e0d\u7528\u4ece\u5934\u8bfb\u5230\u5c3e\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u4f60\u60f3\u8981\u4e86\u89e3\u7684\u77e5\u8bc6\u70b9\uff0c\u901a\u8fc7\u672c\u7ad9\u7684\u641c\u7d22\u529f\u80fd\uff0c\u53bb\u770b\u54ea\u4e2a\u7ae0\u8282\u7684\u6587\u7ae0\u5c31\u597d\uff0c\u53ef\u4ee5\u968f\u610f\u9605\u8bfb\u4efb\u4f55\u7ae0\u8282\u3002</p> <p>\u672c\u7ad9\u7684\u5de6\u4fa7\u83dc\u5355\u5c31\u662f\u300a\u56fe\u89e3\u7cfb\u7edf\u300b\u7684\u76ee\u5f55\u7ed3\u6784\uff08\u522b\u770b\u7bc7\u7ae0\u4e0d\u591a\uff0c\u6bcf\u4e00\u7ae0\u90fd\u662f\u5f88\u957f\u5f88\u957f\u7684\u6587\u7ae0\u54e6 :laughing:\uff09\uff1a</p> <ul> <li>\u786c\u4ef6\u7ed3\u6784 :point_down:</li> <li>CPU \u662f\u5982\u4f55\u6267\u884c\u7a0b\u5e8f\u7684\uff1f </li> <li>\u78c1\u76d8\u6bd4\u5185\u5b58\u6162\u51e0\u4e07\u500d\uff1f </li> <li>\u5982\u4f55\u5199\u51fa\u8ba9 CPU \u8dd1\u5f97\u66f4\u5feb\u7684\u4ee3\u7801\uff1f </li> <li>CPU \u7f13\u5b58\u4e00\u81f4\u6027 </li> <li>CPU \u662f\u5982\u4f55\u6267\u884c\u4efb\u52a1\u7684\uff1f </li> <li>\u4ec0\u4e48\u662f\u8f6f\u4e2d\u65ad\uff1f </li> <li>\u4e3a\u4ec0\u4e48 0.1 + 0.2 \u4e0d\u7b49\u4e8e 0.3\uff1f </li> <li>\u64cd\u4f5c\u7cfb\u7edf\u7ed3\u6784 :point_down:<ul> <li>Linux \u5185\u6838 vs Windows \u5185\u6838 </li> </ul> </li> <li>\u5185\u5b58\u7ba1\u7406 :point_down:<ul> <li>\u4e3a\u4ec0\u4e48\u8981\u6709\u865a\u62df\u5185\u5b58\uff1f </li> <li>malloc \u662f\u5982\u4f55\u5206\u914d\u5185\u5b58\u7684\uff1f </li> <li>\u5185\u5b58\u6ee1\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f </li> <li>\u5728 4GB \u7269\u7406\u5185\u5b58\u7684\u673a\u5668\u4e0a\uff0c\u7533\u8bf7 8G \u5185\u5b58\u4f1a\u600e\u4e48\u6837\uff1f </li> <li>\u5982\u4f55\u907f\u514d\u9884\u8bfb\u5931\u6548\u548c\u7f13\u5b58\u6c61\u67d3\u7684\u95ee\u9898\uff1f </li> <li>\u6df1\u5165\u7406\u89e3 Linux \u865a\u62df\u5185\u5b58\u7ba1\u7406 </li> </ul> </li> <li>\u8fdb\u7a0b\u7ba1\u7406 :point_down:<ul> <li>\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u57fa\u7840\u77e5\u8bc6 </li> <li>\u8fdb\u7a0b\u95f4\u6709\u54ea\u4e9b\u901a\u4fe1\u65b9\u5f0f\uff1f </li> <li>\u591a\u7ebf\u7a0b\u51b2\u7a81\u4e86\u600e\u4e48\u529e\uff1f </li> <li>\u600e\u4e48\u907f\u514d\u6b7b\u9501\uff1f </li> <li>\u4ec0\u4e48\u662f\u60b2\u89c2\u9501\u3001\u4e50\u89c2\u9501\uff1f </li> <li>\u4e00\u4e2a\u8fdb\u7a0b\u6700\u591a\u53ef\u4ee5\u521b\u5efa\u591a\u5c11\u4e2a\u7ebf\u7a0b\uff1f </li> <li>\u7ebf\u7a0b\u5d29\u6e83\u4e86\uff0c\u8fdb\u7a0b\u4e5f\u4f1a\u5d29\u6e83\u5417\uff1f </li> </ul> </li> <li>\u8c03\u5ea6\u7b97\u6cd5 :point_down:<ul> <li>\u8fdb\u7a0b\u8c03\u5ea6/\u9875\u9762\u7f6e\u6362/\u78c1\u76d8\u8c03\u5ea6\u7b97\u6cd5</li> </ul> </li> <li>\u6587\u4ef6\u7cfb\u7edf :point_down:<ul> <li>\u6587\u4ef6\u7cfb\u7edf\u5168\u5bb6\u6876 </li> <li>\u8fdb\u7a0b\u5199\u6587\u4ef6\u65f6\uff0c\u8fdb\u7a0b\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u5df2\u5199\u5165\u7684\u6570\u636e\u4f1a\u4e22\u5931\u5417\uff1f </li> </ul> </li> <li>\u8bbe\u5907\u7ba1\u7406 :point_down:<ul> <li>\u952e\u76d8\u6572\u5165 A \u5b57\u6bcd\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f </li> </ul> </li> <li>\u7f51\u7edc\u7cfb\u7edf :point_down:<ul> <li>\u4ec0\u4e48\u662f\u96f6\u62f7\u8d1d\uff1f </li> <li>I/O \u591a\u8def\u590d\u7528\uff1aselect/poll/epoll </li> <li>\u9ad8\u6027\u80fd\u7f51\u7edc\u6a21\u5f0f\uff1aReactor \u548c Proactor </li> <li>\u4ec0\u4e48\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\uff1f </li> </ul> </li> <li>Linux \u547d\u4ee4 :point_down:<ul> <li>\u5982\u4f55\u67e5\u770b\u7f51\u7edc\u7684\u6027\u80fd\u6307\u6807\uff1f </li> <li>\u5982\u4f55\u4ece\u65e5\u5fd7\u5206\u6790 PV\u3001UV\uff1f </li> </ul> </li> <li>\u5b66\u4e60\u5fc3\u5f97 :point_down:<ul> <li>\u64cd\u4f5c\u7cfb\u7edf\u600e\u4e48\u5b66\uff1f </li> <li>\u753b\u56fe\u7ecf\u9a8c\u5206\u4eab </li> </ul> </li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/#_4","title":"\u6709\u9519\u8bef\u600e\u4e48\u529e\uff1f","text":"<p>\u5c0f\u6797\u662f\u4e2a\u624b\u6b8b\u515a\uff0c\u65f6\u5e38\u5199\u51fa\u9519\u522b\u5b57\u3002</p> <p>\u5982\u679c\u4f60\u5728\u5b66\u4e60\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4f60\u53d1\u73b0\u6709\u4efb\u4f55\u9519\u8bef\u6216\u8005\u7591\u60d1\u7684\u5730\u65b9\uff0c\u6b22\u8fce\u4f60\u901a\u8fc7\u90ae\u7bb1\u6216\u8005\u5e95\u90e8\u7559\u8a00\u7ed9\u5c0f\u6797\uff0c\u52d8\u8bef\u90ae\u7bb1\uff1axiaolincoding@163.com</p> <p>\u5c0f\u6797\u62bd\u65f6\u95f4\u4f1a\u9010\u4e2a\u4fee\u6b63\uff0c\u7136\u540e\u53d1\u5e03\u65b0\u7248\u672c\u7684\u56fe\u89e3\u7cfb\u7edf PDF\uff0c\u4e00\u8d77\u8fed\u4ee3\u51fa\u66f4\u597d\u7684\u56fe\u89e3\u7cfb\u7edf\uff01</p> <p>\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u4e86\u54e6\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/10_learn/draw/","title":"11.2 \u753b\u56fe\u7ecf\u9a8c\u5206\u4eab","text":"<p>\u5c0f\u6797\u5199\u8fd9\u4e48\u591a\u7bc7\u56fe\u89e3\u6587\u7ae0\uff0c\u4f60\u4eec\u731c\u6211\u6536\u5230\u7684\u6700\u591a\u7684\u8bfb\u8005\u95ee\u9898\u662f\u4ec0\u4e48\uff1f\u6ca1\u9519\uff0c\u5c31\u662f\u95ee\u6211\u662f\u4f7f\u7528\u4ec0\u4e48\u753b\u56fe\u5de5\u5177\uff0c\u770b\u6765\u5bf9\u8fd9\u4e00\u70b9\u5927\u5bb6\u90fd\u76f8\u5f53\u597d\u5947\uff0c\u90a3\u5e72\u8106\u4e0d\u5982\u5199\u4e00\u7bc7\u4ecb\u7ecd\u4e0b\u6211\u662f\u600e\u4e48\u753b\u56fe\u7684\u3002</p> <p>\u5982\u679c\u6211\u7684\u6587\u7ae0\u7f3a\u5c11\u4e86\u81ea\u5df1\u753b\u7684\u56fe\u7247\uff0c\u76f8\u5f53\u4e8e\u5931\u53bb\u4e86\u7075\u9b42\uff0c\u6280\u672f\u6587\u7ae0\u672c\u8eab\u5c31\u5f88\u67af\u71e5\uff0c\u5982\u679c\u6587\u7ae0\u4e2d\u6ca1\u6709\u51e0\u5f20\u56fe\u7247\uff0c\u8bfb\u8005\u88ab\u529d\u9000\u7684\u6982\u7387\u98d9\u98d9\u5347\uff0c\u5269\u4e0b\u6ca1\u88ab\u529d\u9000\u7684\u4f30\u8ba1\u770b\u7740\u770b\u7740\u5c31\u7761\u7740\u4e86\u3002\u6240\u4ee5\uff0c\u7cbe\u7f8e\u7684\u56fe\u7247\u53ef\u4ee5\u8bf4\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u4e00\u90e8\u5206\uff0c\u4e0d\u4ec5\u5728\u9605\u8bfb\u65f6\u80fd\u5e26\u6765\u89c6\u89c9\u7684\u51b2\u51fb\uff0c\u800c\u4e14\u56fe\u7247\u76f8\u6bd4\u6587\u5b57\u80fd\u6db5\u76d6\u66f4\u591a\u7684\u4fe1\u606f\uff0c\u4e0d\u7136\u600e\u4f1a\u6709\u4e00\u56fe\u80dc\u5343\u8a00\u7684\u8bf4\u6cd5\u5462\uff1f</p> <p>\u8fd9\u65f6\uff0c\u53ef\u80fd\u6709\u7684\u8bfb\u8005\u4f1a\u8bf4\u81ea\u5df1\u4e0d\u5199\u6587\u7ae0\u5440\uff0c\u662f\u4e0d\u662f\u6ca1\u6709\u5fc5\u8981\u4e86\u89e3\u753b\u56fe\u4e86\uff1f\u6211\u89c9\u5f97\u8fd9\u662f\u4e0d\u5bf9\uff0c\u753b\u56fe\u5728\u6211\u4eec\u5de5\u4f5c\u4e2d\u5176\u5b9e\u4e5f\u662f\u6709\u5e2e\u52a9\u7684\uff0c\u6bd4\u5982\u5982\u679c\u4f60\u60f3\u8ddf\u9886\u5bfc\u6c47\u62a5\u4e00\u4e2a\u4e1a\u52a1\u6d41\u7a0b\u7684\u95ee\u9898\uff0c\u628a\u4e1a\u52a1\u6d41\u7a0b\u753b\u51fa\u6765\uff0c\u80af\u5b9a\u7528\u56fe\u7684\u65b9\u5f0f\u6bd4\u7528\u6587\u5b57\u7684\u65b9\u5f0f\u4ea4\u6d41\u8d77\u6765\u4f1a\u66f4\u6709\u6548\u7387\uff0c\u66f4\u8f7b\u677e\u4e9b\uff1b\u5982\u679c\u4f60\u53c2\u4e0e\u4e86\u4e00\u4e2a\u6bd4\u8f83\u590d\u6742\u7684\u9879\u76ee\u5f00\u53d1\uff0c\u4f60\u4e5f\u53ef\u4ee5\u628a\u4ee3\u7801\u7684\u6d41\u7a0b\u56fe\u7ed9\u753b\u51fa\u6765\uff0c\u4e0d\u4ec5\u80fd\u5e2e\u52a9\u81ea\u5df1\u52a0\u6df1\u7406\u89e3\uff0c\u4e5f\u80fd\u5e2e\u52a9\u540e\u9762\u53c2\u4e0e\u7684\u540c\u4e8b\u80fd\u66f4\u5feb\u7684\u63a5\u624b\u8fd9\u4e2a\u9879\u76ee\uff1b\u751a\u81f3\u5982\u679c\u4f60\u8981\u664b\u5347\u7ea7\u522b\u4e86\uff0c\u6f14\u8bb2 PTT \u91cc\u7684\u914d\u56fe\u4e5f\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002</p> <p>\u4e0d\u8fc7\u5f88\u591a\u4eba\u90fd\u662f\u7ea0\u7ed3\u7528\u4ec0\u4e48\u753b\u56fe\u5de5\u5177\uff0c\u5176\u5b9e\u5c0f\u6797\u89c9\u5f97\u518d\u70c2\u7684\u753b\u56fe\u5de5\u5177\uff0c\u53ea\u8981\u4f60\u601d\u8def\u6e05\u6670\uff0c\u786e\u5b9a\u81ea\u5df1\u8981\u8868\u8fbe\u51fa\u4ec0\u4e48\u4fe1\u606f\uff0c\u4e5f\u662f\u80fd\u628a\u56fe\u753b\u597d\u7684\uff0c\u6240\u4ee5\u4e0d\u5fc5\u7ea0\u7ed3\u54ea\u6b3e\u753b\u56fe\u5de5\u5177\uff0c\u6311\u4e00\u6b3e\u81ea\u5df1\u753b\u8d77\u6765\u8212\u670d\u7684\u5c31\u884c\u4e86\u3002</p> <p>\u201c\u5c0f\u6797\uff0c\u4f60\u8bf4\u7684\u6211\u90fd\u61c2\uff0c\u6211\u5c31\u662f\u559c\u6b22\u4f60\u7684\u753b\u56fe\u98ce\u683c\u561b\uff0c\u4f60\u5c31\u8bf4\u8bf4\u4f60\u7528\u5565\u753b\u7684\uff1f\u201d</p> <p>\u54b3\u54b3\uff0c\u6ca1\u95ee\u9898\uff0c\u76f4\u63a5\u5766\u767d\u8bb2\uff0c\u6211\u7528\u7684\u662f\u4e00\u4e2a\u5728\u7ebf\u7684\u753b\u56fe\u7f51\u5740\uff0c\u5730\u5740\u662f\uff1a - https://draw.io</p> <p>\u7528\u5b83\u7684\u539f\u56e0\u662f\u4f7f\u7528\u65b9\u4fbf\u548c\u7b80\u5355\uff0c\u5f53\u7136\u6700\u91cd\u8981\u7684\u662f\u5b83\u5b8c\u5168\u514d\u8d39\uff0c\u6ca1\u6709\u4ec0\u4e48\u9650\u5236\uff0c\u751a\u81f3\u8fd8\u80fd\u76f4\u63a5\u628a\u56fe\u7247\u4fdd\u5b58\u5230 GoogleDrive\u3001OneDrive \u548c Github\uff0c\u6211\u5c31\u662f\u4fdd\u5b58\u5230 Github\uff0c\u7136\u540e\u7528 Github \u4f5c\u4e3a\u6211\u7684\u56fe\u5e8a\u3002</p> <p>\u65e2\u7136\u8981\u8ba4\u8bc6\u5b83\uff0c\u90a3\u5c31\u5148\u6765\u770b\u770b\u5b83\u957f\u4ec0\u4e48\u6837\u5b50\uff0c\u5b83\u4e3b\u8981\u5206\u4e3a\u4e09\u4e2a\u533a\u57df\uff0c\u4ece\u5de6\u5f80\u53f3\u7684\u987a\u5e8f\u662f\u300c\u56fe\u5f62\u9009\u62e9\u533a\u57df\u3001\u7ed8\u56fe\u533a\u57df\u3001\u5c5e\u6027\u8bbe\u7f6e\u533a\u57df\u300d\u3002</p> <p></p> <p>\u5176\u4e2d\uff0c\u6700\u5de6\u8fb9\u7684\u300c\u56fe\u5f62\u9009\u62e9\u533a\u57df\u300d\u53ef\u4ee5\u9009\u62e9\u7684\u56fe\u6848\u6709\u5f88\u591a\u79cd\uff0c\u5e38\u89c1\u7684\u6d41\u7a0b\u56fe\u3001\u65f6\u5e8f\u56fe\u3001\u8868\u683c\u56fe\u90fd\u6709\uff0c\u751a\u81f3\u8fd8\u53ef\u4ee5\u5728\u6700\u5de6\u4e0b\u89d2\u7684\u300c\u66f4\u591a\u56fe\u5f62\u300d\u627e\u5230\u5176\u4ed6\u79cd\u7c7b\u7684\u56fe\u5f62\uff0c\u6bd4\u5982\u7f51\u7edc\u8bbe\u5907\u56fe\u6807\u7b49\u3002</p> <p></p> <p>\u518d\u6765\uff0c\u6700\u53f3\u8fb9\u300c\u5c5e\u6027\u8bbe\u7f6e\u533a\u57df\u300d\u53ef\u4ee5\u8bbe\u7f6e\u6587\u5b57\u7684\u5927\u5c0f\uff0c\u56fe\u7247\u989c\u8272\u3001\u7ebf\u6761\u5f62\u72b6\u7b49\uff0c\u800c\u6211\u6700\u5e38\u7528\u989c\u8272\u677f\u5757\u662f\u4e0b\u9762\u8fd9\u4e09\u79cd\uff0c\u90fd\u662f\u6bd4\u8f83\u6d45\u8272\u7684\uff0c\u8fd9\u6837\u770b\u8d77\u6765\u8212\u670d\u4e9b\u3002</p> <p></p> <p></p> <p></p> <p>\u6211\u6700\u8fd1\u5e38\u7528\u7684\u4e00\u4e2a\u56fe\u5f62\u662f\u5706\u89d2\u65b9\u5757\u56fe\uff0c\u5b83\u7684\u4f4d\u7f6e\u5982\u4e0b\u56fe\uff0c\u4f46\u662f\u5b83\u9ed8\u8ba4\u7684\u989c\u8272\u8fc7\u4e8e\u6df1\u8272\uff0c\u5982\u679c\u8981\u5728\u65b9\u6846\u56fe\u4e2d\u63cf\u8ff0\u6587\u5b57\uff0c\u5219\u53ef\u80fd\u770b\u4e0d\u6e05\u695a\uff0c\u8fd9\u65f6\u6211\u4f1a\u5728\u6700\u53f3\u4fa7\u7684\u300c\u5c5e\u6027\u8bbe\u7f6e\u533a\u57df\u300d\u628a\u65b9\u5757\u989c\u8272\u8bbe\u7f6e\u6210\u6d45\u8272\u7cfb\u5217\u7684\u3002\u53e6\u5916\uff0c\u8fd8\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u9ed8\u8ba4\u7684\u5b57\u4f53\u5927\u5c0f\u6bd4\u8f83\u5c0f\uff0c\u6211\u4e00\u822c\u4f1a\u8c03\u6210 <code>16px</code> \u5927\u5c0f\u3002</p> <p></p> <p>\u5982\u679c\u4f60\u4e0d\u559c\u6b22\u4e0a\u56fe\u7684\u5e26\u6709\u300c\u5212\u75d5\u300d\u7684\u5706\u89d2\u65b9\u5757\u56fe\u5f62\uff0c\u53ef\u4ee5\u9009\u62e9\u4e0b\u56fe\u4e2d\u8fd9\u4e2a\u6700\u7b80\u6d01\u7684\u5706\u89d2\u65b9\u6846\u56fe\u5f62\u3002</p> <p></p> <p>\u8fd9\u4e2a\u7b80\u6d01\u7684\u5706\u89d2\u65b9\u6846\u56fe\u5f62\uff0c\u518d\u642d\u914d\u989c\u8272\uff0c\u80fd\u7ec4\u5408\u6210\u5f88\u591a\u7ed3\u6784\u56fe\uff0c\u6bd4\u5982\u6211\u7528\u8fc7\u5b83\u7ec4\u6210\u8fc7 CPU Cache \u7684\u7ed3\u6784\u56fe\u3002</p> <p></p> <p>\u90a3\u76f4\u89d2\u65b9\u6846\u56fe\u5f62\uff0c\u6211\u4e3b\u8981\u662f\u7528\u6765\u7ec4\u6210\u300c\u8868\u683c\u300d\uff0c\u539f\u56e0\u81ea\u5e26\u7684\u8868\u683c\u4e0d\u597d\u770b\uff0c\u4e5f\u4e0d\u65b9\u4fbf\u8c03\u3002</p> <p></p> <p>\u5982\u679c\u89c9\u5f97\u76f4\u76f4\u7684\u7ebf\u6761\u592a\u6b7b\u677f\uff0c\u4f60\u53ef\u4ee5\u628a\u56fe\u7247\u5c5e\u6027\u4e2d\u7684\u300cComic\u300d\u52fe\u4e0a\uff0c\u4e8e\u662f\u5c31\u4f1a\u53d8\u6210\u6b6a\u6b6a\u626d\u626d\u7684\u6548\u679c\u5566\uff0c\u6709\u70b9\u50cf\u624b\u7ed8\u98ce\u683c\uff0c\u633a\u591a\u4eba\u559c\u6b22\u8fd9\u79cd\u98ce\u683c\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u7528\u8fc7\u8fd9\u79cd\u98ce\u683c\u753b\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\u6d41\u7a0b\u7684\u56fe\u3002</p> <p></p> <p>\u65b9\u5757\u56fe\u5f62\u518d\u52a0\u4e0a\u83f1\u5f62\uff0c\u5c31\u53ef\u4ee5\u7ec4\u5408\u6210\u7b80\u5355\u7a0b\u5e8f\u6d41\u7a0b\u56fe\u4e86\uff0c\u6bd4\u5982\u6211\u753b\u8fc7\u5b58\u50a8\u5668\u7f13\u5b58\u6d41\u7a0b\u56fe\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u4e0d\u8981\u5c0f\u770b\u8fd9\u4e9b\u57fa\u672c\u56fe\u5f62\uff0c\u53ea\u8981\u6784\u601d\u6e05\u6670\uff0c\u518d\u57fa\u672c\u7684\u56fe\u5f62\uff0c\u4e5f\u662f\u80fd\u6784\u6210\u5c42\u6b21\u5206\u660e\u5e76\u4e14\u597d\u770b\u7684\u56fe\u3002</p> <p>\u57fa\u672c\u7684\u56fe\u5f62\u4ecb\u7ecd\u5b8c\u540e\uff0c\u76f8\u4fe1\u4f60\u753b\u4e00\u4e9b\u7b80\u5355\u7a0b\u5e8f\u6d41\u7a0b\u56fe\u7b49\u56fe\u5f62\u662f\u6ca1\u95ee\u9898\u7684\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u5404\u79cd\u56fe\u5f62 + \u7ebf\u6761\u7684\u7ec4\u5408\u7684\u4e86\u3002</p> <p>\u901a\u8fc7\u4e00\u4e9b\u57fa\u672c\u7684\u56fe\u5f62\u7ec4\u5408\uff0c\u4f60\u8fd8\u53ef\u4ee5\u753b\u51fa\u65f6\u5e8f\u56fe\uff0c\u65f6\u5e8f\u56fe\u53ef\u4ee5\u7528\u6765\u63cf\u8ff0\u591a\u4e2a\u5bf9\u8c61\u4e4b\u95f4\u7684\u4ea4\u4e92\u6d41\u7a0b\uff0c\u6bd4\u5982\u6211\u753b\u8fc7\u591a\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u4e92\u65a5\u9501\u7684\u65f6\u5e8f\u56fe\u3002</p> <p></p> <p>\u518d\u6765\uff0c\u4e3a\u4e86\u66f4\u597d\u8868\u8fbe\u96f6\u62f7\u8d1d\u6280\u672f\u7684\u8fc7\u7a0b\uff0c\u90a3\u4e48\u7528\u56fe\u7684\u65b9\u5f0f\u4f1a\u66f4\u6e05\u6670\u3002</p> <p></p> <p>\u524d\u9762\u4e5f\u63d0\u5230\uff0c\u56fe\u5f62\u4e0d\u53ea\u662f\u7b80\u5355\u56fe\u5f62\uff0c\u8fd8\u6709\u5176\u4ed6\u81ea\u5e26\u7684\u8bbe\u5907\u7c7b\u56fe\u5f62\uff0c\u6bd4\u5982\u6211\u7528\u7f51\u7edc\u8bbe\u5907\u56fe\u753b\u8fc7\u5355\u64ad\u3001\u5e7f\u64ad\u3001\u591a\u64ad\u901a\u4fe1\u7684\u533a\u522b\u56fe\u3002</p> <p></p> <p>\u4f60\u8981\u8bf4\uff0c\u6211\u753b\u8fc7\u6700\u590d\u6742\u7684\u56fe\uff0c\u90a3\u5c31\u662f\u5199 TCP \u6d41\u91cf\u63a7\u5236\u7684\u65f6\u5019\uff0c\u628a\u6574\u4e2a\u4ea4\u4e92\u8fc7\u7a0b + \u6587\u5b57\u63cf\u8ff0 + \u6ed1\u52a8\u7a97\u53e3\u72b6\u51b5\u90fd\u753b\u51fa\u6765\u4e86\uff0c\u73b0\u5728\u56de\u60f3\u8d77\u6765\u8fd8\u662f\u89c9\u5f97\u7d2f\u4eba\u3002</p> <p></p> <p>\u8fd8\u6709\u597d\u591a\u597d\u591a\uff0c\u6211\u5c31\u6bd4\u4e00\u4e00\u5217\u4e3e\uff0c\u8fd9\u534a\u5e74\u4e0b\u6765\uff0c\u5c0f\u6797\u81f3\u5c11\u753b\u4e86 <code>500+</code> \u5f20\u56fe\u4e86\uff0c\u6bcf\u4e00\u5f20\u56fe\u5176\u5b9e\u8fd8\u662f\u633a\u8d39\u65f6\u95f4\u7684\uff0c\u76f8\u4fe1\u753b\u8fc7\u56fe\u7684\u670b\u53cb\u540e\uff0c\u90fd\u80fd\u4f53\u4f1a\u5230\u8fd9\u79cd\u611f\u89c9\u4e86\u3002\u4f46\u6ca1\u529e\u6cd5\uff0c\u8c01\u53eb\u5c0f\u6797\u662f\u56fe\u89e3\u5de5\u5177\u4eba\u5462\uff0c\u753b\u56fe\u53ef\u4ee5\u66f4\u597d\u7684\u8be0\u91ca\u6587\u7ae0\u5185\u5bb9\uff0c\u4f46\u6700\u91cd\u8981\u7684\u662f\uff0c\u628a\u4f60\u4eec\u5438\u5f15\u8fc7\u6765\u4e86\uff0c\u8fd9\u662f\u4ef6\u8ba9\u6211\u975e\u5e38\u9ad8\u5174\u7684\u4e8b\u60c5\uff0c\u4e5f\u662f\u8ba9\u6211\u611f\u89c9\u753b\u56fe\u8fd9\u4e2a\u4e8b\u60c5\u503c\u5f97\u8ba4\u771f\u505a\u3002</p> <p>\u53e6\u5916\uff0c\u7ec6\u5fc3\u7684\u8bfb\u8005\u4e5f\u53d1\u73b0\u4e86\uff0c\u5c0f\u6797\u8d34\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u7684\u662f\u56fe\u7247\u7684\u5f62\u5f0f\uff0c\u539f\u56e0\u662f\u4ee3\u7801\u901a\u5e38\u90fd\u662f\u6bd4\u8f83\u957f\uff0c\u5728\u624b\u673a\u770b\u6587\u7ae0\u7528\u56fe\u7247\u7684\u5448\u73b0\u7684\u65b9\u5f0f\u4f1a\u66f4\u8212\u670d\u6e05\u6670\u3002</p> <p>\u5728\u8fd9\u91cc\u4e5f\u63a8\u8350\u4e0b\u8fd9\u4e2a\u4ee3\u7801\u622a\u56fe\u7f51\u5740\uff1a - https://carbon.now.sh/</p> <p>\u7f51\u7ad9\u9875\u9762\u5982\u4e0b\u56fe\uff0c\u4ee3\u7801\u663e\u793a\u7684\u6548\u679c\u662f\u4e0d\u662f\u5f88\u7f8e\u89c2\uff1f</p> <p></p> <p>\u6587\u5b57\u7684\u5206\u4eab\u6709\u5c40\u9650\u6027\uff0c\u5173\u952e\u8fd8\u662f\u8981\u4f60\u81ea\u5df1\u52a8\u624b\u6478\u7d22\u6478\u7d22\uff0c\u5f62\u6210\u81ea\u5df1\u4e00\u5957\u753b\u56fe\u7684\u65b9\u6cd5\u8bba\uff0c\u7ec3\u4e60\u7684\u65f6\u5019\u53ef\u4ee5\u5148\u4ece\u6a21\u4eff\u753b\u8d77\uff0c\u540e\u9762\u518d\u7ed3\u5408\u5de5\u4f5c\u6216\u6587\u7ae0\u7684\u9700\u6c42\u753b\u51fa\u81ea\u5df1\u5fc3\u4e2d\u7684\u90a3\u4e2a\u56fe\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/10_learn/learn_os/","title":"11.1 \u64cd\u4f5c\u7cfb\u7edf\u600e\u4e48\u5b66\uff1f","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u771f\u7684\u53ef\u4ee5\u8bf4\u662f <code>Super Man</code>\uff0c\u5b83\u4e3a\u4e86\u6211\u4eec\u505a\u4e86\u975e\u5e38\u5389\u5bb3\u7684\u4e8b\u60c5\uff0c\u4ee5\u81f3\u4e8e\u6211\u4eec\u6839\u672c\u5bdf\u89c9\u4e0d\u5230\uff0c\u53ea\u6709\u901a\u8fc7\u5b66\u4e60\u5b83\uff0c\u6211\u4eec\u624d\u80fd\u6df1\u523b\u4f53\u4f1a\u5230\u5b83\u7684\u7cbe\u5999\u4e4b\u5904\uff0c\u751a\u81f3\u4f1a\u88ab\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6\u8bbe\u8ba1\u601d\u60f3\u6240\u9707\u64bc\uff0c\u6709\u4e9b\u601d\u60f3\u5b9e\u9645\u4e0a\u4e5f\u662f\u53ef\u4ee5\u5e94\u7528\u4e8e\u6211\u4eec\u5de5\u4f5c\u5f00\u53d1\u4e2d\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u6bd4\u8f83\u91cd\u8981\u7684\u56db\u5927\u6a21\u5757\uff0c\u5206\u522b\u662f\u5185\u5b58\u7ba1\u7406\u3001\u8fdb\u7a0b\u7ba1\u7406\u3001\u6587\u4ef6\u7cfb\u7edf\u7ba1\u7406\u3001\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7ba1\u7406\u3002\u8fd9\u662f\u6211\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\u7684\u987a\u5e8f\uff0c\u4e5f\u662f\u6211\u63a8\u8350\u7ed9\u5927\u5bb6\u7684\u5b66\u4e60\u987a\u5e8f\uff0c\u56e0\u4e3a\u5185\u5b58\u7ba1\u7406\u4e0d\u4ec5\u662f\u6700\u91cd\u8981\u3001\u6700\u96be\u7684\u6a21\u5757\uff0c\u4e5f\u662f\u548c\u5176\u4ed6\u6a21\u5757\u5173\u8054\u6027\u6700\u5927\u7684\u6a21\u5757\uff0c\u5148\u628a\u5b83\u641e\u5b9a\uff0c\u540e\u7eed\u7684\u6a21\u5757\u5b66\u8d77\u6765\u6211\u8ba4\u4e3a\u4f1a\u76f8\u5bf9\u8f7b\u677e\u4e00\u4e9b\u3002  </p> <p>\u5b66\u4e60\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u53ef\u80fd\u4f1a\u9047\u5230\u5f88\u591a\u300c\u865a\u62df\u300d\u7684\u6982\u5ff5\uff0c\u6bd4\u5982\u865a\u62df\u5185\u5b58\u3001\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b9e\u9645\u4e0a\u5b83\u4eec\u7684\u672c\u8d28\u4e0a\u90fd\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u5411\u4e0b\u5c4f\u853d\u5dee\u5f02\uff0c\u5411\u4e0a\u63d0\u4f9b\u7edf\u4e00\u7684\u4e1c\u897f\uff0c\u4ee5\u65b9\u4fbf\u6211\u4eec\u7a0b\u5e8f\u5458\u4f7f\u7528\u3002</p> <p>\u8fd8\u6709\uff0c\u4f60\u4e5f\u9047\u5230\u5404\u79cd\u5404\u6837\u7684\u8c03\u5ea6\u7b97\u6cd5\uff0c\u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u770b\u5230\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u7684\u9b45\u529b\uff0c\u91cd\u8981\u7684\u662f\u6211\u4eec\u8981\u7406\u89e3\u4e3a\u4ec0\u4e48\u8981\u63d0\u51fa\u90a3\u4e48\u591a\u8c03\u5ea6\u7b97\u6cd5\uff0c\u4f60\u5f53\u7136\u53ef\u4ee5\u8bf4\u662f\u4e3a\u4e86\u66f4\u5feb\u66f4\u6709\u6548\u7387\uff0c\u4f46\u662f\u56e0\u4ec0\u4e48\u95ee\u9898\u800c\u56e0\u6b64\u5f15\u5165\u65b0\u7b97\u6cd5\u7684\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u66f4\u662f\u6211\u4eec\u91cd\u70b9\u5b66\u4e60\u7684\u5730\u65b9\u3002</p> <p>\u4f60\u4e5f\u4f1a\u5f00\u59cb\u660e\u767d\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b\u6700\u5927\u7684\u533a\u522b\u5728\u4e8e\u4e0a\u4e0b\u6587\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u7ebf\u7a0b\u4e0d\u7528\u5207\u6362\u865a\u62df\u5185\u5b58\uff0c\u56e0\u4e3a\u540c\u4e00\u4e2a\u8fdb\u7a0b\u5185\u7684\u7ebf\u7a0b\u90fd\u662f\u5171\u4eab\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u7684\uff0c\u7ebf\u7a0b\u5c31\u5355\u8fd9\u4e00\u70b9\u4e0d\u7528\u5207\u6362\uff0c\u5c31\u76f8\u6bd4\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6027\u80fd\u5f00\u9500\u51cf\u5c11\u4e86\u5f88\u591a\u3002\u7531\u4e8e\u865a\u62df\u5185\u5b58\u4e0e\u7269\u7406\u5185\u5b58\u7684\u6620\u5c04\u5173\u7cfb\u9700\u8981\u67e5\u8be2\u9875\u8868\uff0c\u9875\u8868\u7684\u67e5\u8be2\u662f\u5f88\u6162\u7684\u8fc7\u7a0b\uff0c\u56e0\u6b64\u4f1a\u628a\u5e38\u7528\u7684\u5730\u5740\u6620\u5c04\u5173\u7cfb\u7f13\u5b58\u5728 TLB \u91cc\u7684\uff0c\u8fd9\u6837\u4fbf\u53ef\u4ee5\u63d0\u9ad8\u9875\u8868\u7684\u67e5\u8be2\u901f\u5ea6\uff0c\u5982\u679c\u53d1\u751f\u4e86\u8fdb\u7a0b\u5207\u6362\uff0c\u90a3 TLB \u7f13\u5b58\u7684\u5730\u5740\u6620\u5c04\u5173\u7cfb\u5c31\u4f1a\u5931\u6548\uff0c\u7f13\u5b58\u5931\u6548\u5c31\u610f\u5473\u7740\u547d\u4e2d\u7387\u964d\u4f4e\uff0c\u4e8e\u662f\u865a\u62df\u5730\u5740\u8f6c\u4e3a\u7269\u7406\u5730\u5740\u8fd9\u4e00\u8fc7\u7a0b\u5c31\u4f1a\u5f88\u6162\u3002</p> <p>\u4f60\u4e5f\u5f00\u59cb\u4e0d\u4f1a\u50bb\u50bb\u7684\u8ba4\u4e3a read \u6216 write \u4e4b\u540e\u6570\u636e\u5c31\u76f4\u63a5\u5199\u5230\u786c\u76d8\u4e86\uff0c\u66f4\u4e0d\u4f1a\u89c9\u5f97\u591a\u6b21\u64cd\u4f5c read \u6216 write \u65b9\u6cd5\u6027\u80fd\u4f1a\u5f88\u4f4e\uff0c\u56e0\u4e3a\u4f60\u53d1\u73b0\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6709\u4e2a\u300c\u78c1\u76d8\u9ad8\u901f\u7f13\u51b2\u533a\u300d\uff0c\u5b83\u5df2\u7ecf\u5e2e\u6211\u4eec\u505a\u4e86\u7f13\u5b58\u7684\u5de5\u4f5c\uff0c\u5b83\u4f1a\u9884\u8bfb\u6570\u636e\u3001\u7f13\u5b58\u6700\u8fd1\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u4ee5\u53ca\u4f7f\u7528 I/O \u8c03\u5ea6\u7b97\u6cd5\u6765\u5408\u5e76\u548c\u6392\u961f\u78c1\u76d8\u8c03\u5ea6 I/O\uff0c\u8fd9\u4e9b\u90fd\u662f\u4e3a\u4e86\u51cf\u5c11\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u78c1\u76d8\u7684\u8bbf\u95ee\u9891\u7387\u3002</p> <p>\u2026\u2026</p> <p>\u8fd8\u6709\u592a\u591a\u592a\u591a\u4e86\uff0c\u6211\u5728\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\uff0c\u5269\u4e0b\u7684\u5c31\u4ea4\u7ed9\u4f60\u4eec\u5728\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\u7684\u9014\u4e2d\u53bb\u63a2\u7d22\u548c\u53d1\u73b0\u4e86\u3002</p> <p>\u8fd8\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\uff0c\u5b66\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u5019\uff0c\u4e0d\u8981\u8bef\u4ee5\u4e3a\u5b83\u662f\u5728\u8bf4 Linux \u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd9\u4e5f\u662f\u6211\u521d\u5b66\u7684\u65f6\u5019\u72af\u7684\u4e00\u4e2a\u9519\u8bef\uff0c\u64cd\u4f5c\u7cfb\u7edf\u662f\u96c6\u5408\u5927\u591a\u6570\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u7684\u601d\u60f3\uff0c\u8ddf\u5b9e\u9645\u5177\u4f53\u5b9e\u73b0\u7684 Linux \u64cd\u4f5c\u7cfb\u7edf\u591a\u5c11\u90fd\u4f1a\u6709\u70b9\u5dee\u522b\uff0c\u5982\u679c\u8981\u60f3 Linux \u64cd\u4f5c\u7cfb\u7edf\u7684\u5177\u4f53\u5b9e\u73b0\u65b9\u5f0f\uff0c\u53ef\u4ee5\u9009\u62e9\u770b Linux \u5185\u6838\u76f8\u5173\u7684\u8d44\u6599\uff0c\u4f46\u662f\u5728\u8fd9\u4e4b\u524d\u4f60\u5148\u638c\u63e1\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u77e5\u8bc6\uff0c\u8fd9\u6837\u5b66\u8d77\u6765\u624d\u80fd\u4e8b\u534a\u529f\u500d\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/10_learn/learn_os/#_1","title":"\u5165\u95e8\u7cfb\u5217","text":"<p>\u5bf9\u4e8e\u6ca1\u5b66\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u7684\u5c0f\u767d\uff0c\u6211\u5efa\u8bae\u5b66\u7684\u65f6\u5019\uff0c\u4e0d\u8981\u76f4\u63a5\u95f7\u5934\u770b\u4e66\u3002\u76f8\u4fe1\u6211\uff0c\u4f60\u4e0d\u7528\u51e0\u5206\u949f\u5c31\u4f1a\u6253\u9000\u5802\u9f13\uff0c\u7136\u540e\u5c31\u628a\u539a\u539a\u7684\u4e66\u62ff\u53bb\u57ab\u663e\u793a\u5668\u4e86\uff0c\u4ece\u6b64\u518d\u65e0\u540e\u7eed\uff0c\u6bd5\u7adf\u76f4\u63a5\u770b\u4e66\u592a\u7279\u55b5\u7684\u67af\u71e5\u4e86\uff0c\u5f53\u7136\u4e0d\u5982\u7528\u6765\u57ab\u663e\u793a\u5668\u73a9\u6e38\u620f\u6765\u7740\u9999\u3002</p> <p>B \u7ad9\u5173\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u7a0b\u8d44\u6e90\u5f88\u591a\uff0c\u6211\u5728\u91cc\u9762\u4e5f\u770b\u4e86\u4e0d\u540c\u8001\u5e08\u8bb2\u7684\u8bfe\u7a0b\uff0c\u89c9\u5f97\u6bd4\u8f83\u597d\u7684\u5165\u95e8\u7ea7\u8bfe\u7a0b\u662f\u300a\u64cd\u4f5c\u7cfb\u7edf - \u6e05\u534e\u5927\u5b66\u300b\uff0c\u8be5\u8bfe\u7a0b\u7531\u6e05\u534e\u5927\u5b66\u8001\u5e08\u5411\u52c7\u548c\u9648\u6e1d\u6388\u8bfe\uff0c\u867d\u7136\u6211\u4eec\u4e0a\u4e0d\u4e86\u6e05\u534e\u5927\u5b66\uff0c\u4f46\u662f\u81f3\u5c11\u6211\u4eec\u53ef\u4ee5\u5728\u7f51\u4e0a\u9009\u62e9\u542c\u6e05\u534e\u5927\u5b66\u7684\u8bfe\u561b\u3002\u8bfe\u7a0b\u6388\u8bfe\u7684\u987a\u5e8f\uff0c\u5c31\u5982\u6211\u524d\u9762\u63a8\u8350\u7684\u5b66\u4e60\u987a\u5e8f\uff1a\u300c\u5185\u5b58\u7ba1\u7406 -&gt; \u8fdb\u7a0b\u7ba1\u7406 -&gt; \u6587\u4ef6\u7cfb\u7edf\u7ba1\u7406 -&gt; \u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7ba1\u7406\u300d\u3002</p> <p></p> <p>B \u7ad9\u6e05\u534e\u5927\u5b66\u64cd\u4f5c\u7cfb\u7edf\u89c6\u9891\u5730\u5740\uff1ahttps://www.bilibili.com/video/BV1js411b7vg?from=search&amp;seid=2361361014547524697</p> <p>\u8be5\u6e05\u534e\u5927\u5b66\u7684\u89c6\u9891\u6559\u5b66\u642d\u914d\u7684\u4e66\u5e94\u8be5\u662f\u300a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u300b\uff0c\u4f60\u53ef\u4ee5\u89c6\u9891\u548c\u4e66\u7c4d\u4e24\u8005\u7ed3\u5408\u4e00\u8d77\u5b66\uff0c\u6bd4\u5982\u770b\u5b8c\u89c6\u9891\u7684\u5185\u5b58\u7ba1\u7406\uff0c\u7136\u540e\u5c31\u770b\u4e66\u4e0a\u5bf9\u5e94\u7684\u7ae0\u8282\uff0c\u8fd9\u6837\u76f8\u6bd4\u76f4\u63a5\u5543\u4e66\u76f8\u5bf9\u4f1a\u6bd4\u8f83\u597d\u3002</p> <p></p> <p>\u6e05\u534e\u5927\u5b66\u7684\u64cd\u4f5c\u7cfb\u7edf\u89c6\u9891\u8bfe\u8bb2\u7684\u6bd4\u8f83\u7cbe\u70bc\uff0c\u6d89\u53ca\u5230\u7684\u5185\u5bb9\u6ca1\u6709\u90a3\u4e48\u7ec6\uff0c\u300a\u64cd\u4f5c\u7cfb\u7edf - \u54c8\u5de5\u5927\u300b\u674e\u6cbb\u519b\u8001\u5e08\u6388\u8bfe\u7684\u89c6\u9891\u8bfe\u7a0b\u76f8\u5bf9\u5c31\u4f1a\u6bd4\u8f83\u7ec6\u8282\uff0c\u8001\u5e08\u4f1a\u7528 Linux \u5185\u6838\u4ee3\u7801\u7684\u89d2\u5ea6\u5e26\u4f60\u8fdb\u4e00\u6b65\u7406\u89e3\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e5f\u4f1a\u7528\u751f\u6d3b\u5c0f\u4f8b\u5b50\u5e2e\u52a9\u4f60\u7406\u89e3\u3002</p> <p></p> <p>B \u7ad9\u54c8\u5de5\u5927\u64cd\u4f5c\u7cfb\u7edf\u89c6\u9891\u5730\u5740\uff1ahttps://www.bilibili.com/video/BV1d4411v7u7?from=search&amp;seid=2361361014547524697</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/10_learn/learn_os/#_2","title":"\u6df1\u5165\u5b66\u4e60\u7cfb\u5217","text":"<p>\u300a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u300b\u8fd9\u672c\u4e66\u6211\u611f\u89c9\u7f3a\u5c11\u6bd4\u8f83\u591a\u7ec6\u8282\uff0c\u8bf4\u7684\u8fd8\u662f\u6bd4\u8f83\u7b3c\u7edf\uff0c\u800c\u4e14\u4e66\u4e5f\u597d\u65e0\u804a\u3002</p> <p>\u63a8\u8350\u4e00\u4e2a\u8bf4\u7684\u66f4\u7ec6\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e66 \u2014\u2014 \u300a\u64cd\u4f5c\u7cfb\u7edf\u5bfc\u8bba\u300b\uff0c\u8fd9\u672c\u4e66\u4e0d\u4ec5\u544a\u8bc9\u4f60 What\uff0c\u8fd8\u4f1a\u544a\u8bc9\u4f60 How\uff0c\u4e66\u7684\u5185\u5bb9\u90fd\u662f\u5faa\u5e8f\u6e10\u8fdb\uff0c\u5c42\u5c42\u9012\u8fdb\u7684\uff0c\u9605\u8bfb\u8d77\u6765\u8fd8\u662f\u89c9\u5f97\u633a\u6709\u610f\u601d\u7684\uff0c\u8fd9\u672c\u4e66\u7684\u5185\u5b58\u7ba1\u7406\u548c\u5e76\u53d1\u8fd9\u4e24\u4e2a\u90e8\u5206\u8bf4\u7684\u5f88\u68d2\uff0c\u8fd9\u672c\u4e66\u7684\u4e2d\u6587\u7248\u672c\u6211\u4e5f\u6ca1\u627e\u5230\u8d44\u6e90\uff0c\u4e0d\u8fc7\u5fae\u4fe1\u8bfb\u4e66\u53ef\u4ee5\u514d\u8d39\u770b\u8fd9\u672c\u4e66\u3002</p> <p></p> <p>\u5f53\u7136\uff0c\u5c11\u4e0d\u4e86\u8fd9\u672c\u88ab\u79f0\u4e3a\u795e\u4e66\u7684\u300a\u6df1\u5165\u7406\u89e3\u8ba1\u7b97\u673a\u7cfb\u7edf\u300b\uff0c\u8c46\u74e3\u8bc4\u5206\u9ad8\u8fbe <code>9.8</code> \u5206\uff0c\u8fd9\u672c\u4e66\u4e25\u683c\u6765\u8bf4\u4e0d\u7b97\u64cd\u4f5c\u7cfb\u7edf\u4e66\uff0c\u5b83\u662f\u4ee5\u7a0b\u5e8f\u5458\u89c6\u89d2\u7406\u89e3\u8ba1\u7b97\u673a\u7cfb\u7edf\uff0c\u4e0d\u53ea\u662f\u6d89\u53ca\u5230\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd8\u6d89\u53ca\u5230\u4e86\u8ba1\u7b97\u673a\u7ec4\u6210\u3001C \u8bed\u8a00\u3001\u6c47\u7f16\u8bed\u8a00\u7b49\u77e5\u8bc6\uff0c\u662f\u4e00\u672c\u7efc\u5408\u6027\u6bd4\u8f83\u5f3a\u7684\u4e66\u3002</p> <p></p> <p>\u5b83\u544a\u8bc9\u6211\u4eec\u8ba1\u7b97\u673a\u662f\u5982\u4f55\u8bbe\u8ba1\u548c\u5de5\u4f5c\u7684\uff0c\u64cd\u4f5c\u7cfb\u7edf\u6709\u54ea\u4e9b\u91cd\u70b9\uff0c\u5b83\u4eec\u7684\u4f5c\u7528\u53c8\u662f\u4ec0\u4e48\uff0c\u8fd9\u672c\u4e66\u7684\u76ee\u6807\u5176\u5b9e\u4fbf\u662f\u8981\u8bb2\u6e05\u695a\u539f\u7406\uff0c\u4f46\u5e76\u4e0d\u4f1a\u628a\u67d0\u4e2a\u8bdd\u9898\u6316\u6398\u5730\u8fc7\u4e8e\u6df1\u5165\uff0c\u8fc7\u4e8e\u7ec6\u8282\u3002\u770b\u770b\u8fd9\u672c\u4e66\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5bf9\u8ba1\u7b97\u673a\u7cfb\u7edf\u5404\u7ec4\u4ef6\u7684\u5de5\u4f5c\u65b9\u5f0f\u6709\u4e86\u7406\u6027\u7684\u8ba4\u8bc6\u3002\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\uff0c\u5176\u5b9e\u5b83\u662f\u5728\u953b\u70bc\u4e00\u79cd\u601d\u7ef4\u65b9\u5f0f \u2014\u2014 \u8ba1\u7b97\u601d\u7ef4\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/10_learn/learn_os/#_3","title":"\u6700\u540e","text":"<p>\u6587\u4e2d\u63a8\u8350\u7684\u4e66\uff0c\u5c0f\u6797\u90fd\u5df2\u7ecf\u628a\u7535\u5b50\u4e66\u6574\u7406\u597d\u7ed9\u5927\u5bb6\u4e86\uff0c\u53ea\u9700\u8981\u5728\u5c0f\u6797\u7684\u516c\u4f17\u53f7\u540e\u53f0\u56de\u590d\u300c\u6211\u8981\u5b66\u4e60\u300d\uff0c\u5373\u53ef\u83b7\u53d6\u767e\u5ea6\u7f51\u76d8\u4e0b\u8f7d\u94fe\u63a5\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/cpu_mesi/","title":"2.4 CPU \u7f13\u5b58\u4e00\u81f4\u6027","text":"<p>\u76f4\u63a5\u4e0a\uff0c\u4e0d\u591a BB \u4e86\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/cpu_mesi/#cpu-cache","title":"CPU Cache \u7684\u6570\u636e\u5199\u5165","text":"<p>\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\uff0cCPU \u548c\u5185\u5b58\u7684\u8bbf\u95ee\u6027\u80fd\u76f8\u5dee\u8d8a\u6765\u8d8a\u5927\uff0c\u4e8e\u662f\u5c31\u5728 CPU \u5185\u90e8\u5d4c\u5165\u4e86 CPU Cache\uff08\u9ad8\u901f\u7f13\u5b58\uff09\uff0cCPU Cache \u79bb CPU \u6838\u5fc3\u76f8\u5f53\u8fd1\uff0c\u56e0\u6b64\u5b83\u7684\u8bbf\u95ee\u901f\u5ea6\u662f\u5f88\u5feb\u7684\uff0c\u4e8e\u662f\u5b83\u5145\u5f53\u4e86 CPU \u4e0e\u5185\u5b58\u4e4b\u95f4\u7684\u7f13\u5b58\u89d2\u8272\u3002</p> <p>CPU Cache \u901a\u5e38\u5206\u4e3a\u4e09\u7ea7\u7f13\u5b58\uff1aL1 Cache\u3001L2 Cache\u3001L3 Cache\uff0c\u7ea7\u522b\u8d8a\u4f4e\u7684\u79bb CPU \u6838\u5fc3\u8d8a\u8fd1\uff0c\u8bbf\u95ee\u901f\u5ea6\u4e5f\u5feb\uff0c\u4f46\u662f\u5b58\u50a8\u5bb9\u91cf\u76f8\u5bf9\u5c31\u4f1a\u8d8a\u5c0f\u3002\u5176\u4e2d\uff0c\u5728\u591a\u6838\u5fc3\u7684 CPU \u91cc\uff0c\u6bcf\u4e2a\u6838\u5fc3\u90fd\u6709\u5404\u81ea\u7684 L1/L2 Cache\uff0c\u800c L3 Cache \u662f\u6240\u6709\u6838\u5fc3\u5171\u4eab\u4f7f\u7528\u7684\u3002</p> <p></p> <p>\u6211\u4eec\u5148\u7b80\u5355\u4e86\u89e3\u4e0b CPU Cache \u7684\u7ed3\u6784\uff0cCPU Cache \u662f\u7531\u5f88\u591a\u4e2a Cache Line \u7ec4\u6210\u7684\uff0cCPU Line \u662f CPU \u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u800c CPU Line \u662f\u7531\u5404\u79cd\u6807\u5fd7\uff08Tag\uff09+ \u6570\u636e\u5757\uff08Data Block\uff09\u7ec4\u6210\uff0c\u4f60\u53ef\u4ee5\u5728\u4e0b\u56fe\u6e05\u6670\u7684\u770b\u5230\uff1a</p> <p></p> <p>\u6211\u4eec\u5f53\u7136\u671f\u671b CPU \u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u90fd\u662f\u5c3d\u53ef\u80fd\u5730\u4ece CPU Cache \u4e2d\u8bfb\u53d6\uff0c\u800c\u4e0d\u662f\u6bcf\u4e00\u6b21\u90fd\u8981\u4ece\u5185\u5b58\u4e2d\u83b7\u53d6\u6570\u636e\u3002\u6240\u4ee5\uff0c\u8eab\u4e3a\u7a0b\u5e8f\u5458\uff0c\u6211\u4eec\u8981\u5c3d\u53ef\u80fd\u5199\u51fa\u7f13\u5b58\u547d\u4e2d\u7387\u9ad8\u7684\u4ee3\u7801\uff0c\u8fd9\u6837\u5c31\u6709\u6548\u63d0\u9ad8\u7a0b\u5e8f\u7684\u6027\u80fd\uff0c\u5177\u4f53\u7684\u505a\u6cd5\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003\u6211\u4e0a\u4e00\u7bc7\u6587\u7ae0\u300c\u5982\u4f55\u5199\u51fa\u8ba9 CPU \u8dd1\u5f97\u66f4\u5feb\u7684\u4ee3\u7801\uff1f\u300d</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u6570\u636e\u4e0d\u5149\u662f\u53ea\u6709\u8bfb\u64cd\u4f5c\uff0c\u8fd8\u6709\u5199\u64cd\u4f5c\uff0c\u90a3\u4e48\u5982\u679c\u6570\u636e\u5199\u5165 Cache \u4e4b\u540e\uff0c\u5185\u5b58\u4e0e Cache \u76f8\u5bf9\u5e94\u7684\u6570\u636e\u5c06\u4f1a\u4e0d\u540c\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b Cache \u548c\u5185\u5b58\u6570\u636e\u90fd\u4e0d\u4e00\u81f4\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u80af\u5b9a\u662f\u8981\u628a Cache \u4e2d\u7684\u6570\u636e\u540c\u6b65\u5230\u5185\u5b58\u91cc\u7684\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u90a3\u5728\u4ec0\u4e48\u65f6\u673a\u624d\u628a Cache \u4e2d\u7684\u6570\u636e\u5199\u56de\u5230\u5185\u5b58\u5462\uff1f\u4e3a\u4e86\u5e94\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e0b\u9762\u4ecb\u7ecd\u4e24\u79cd\u9488\u5bf9\u5199\u5165\u6570\u636e\u7684\u65b9\u6cd5\uff1a</p> <ul> <li>\u5199\u76f4\u8fbe\uff08Write Through\uff09</li> <li>\u5199\u56de\uff08Write Back\uff09</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/cpu_mesi/#_1","title":"\u5199\u76f4\u8fbe","text":"<p>\u4fdd\u6301\u5185\u5b58\u4e0e Cache \u4e00\u81f4\u6027\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\uff0c\u628a\u6570\u636e\u540c\u65f6\u5199\u5165\u5185\u5b58\u548c Cache \u4e2d\uff0c\u8fd9\u79cd\u65b9\u6cd5\u79f0\u4e3a\u5199\u76f4\u8fbe\uff08Write Through\uff09\u3002</p> <p></p> <p>\u5728\u8fd9\u4e2a\u65b9\u6cd5\u91cc\uff0c\u5199\u5165\u524d\u4f1a\u5148\u5224\u65ad\u6570\u636e\u662f\u5426\u5df2\u7ecf\u5728 CPU Cache \u91cc\u9762\u4e86\uff1a</p> <ul> <li>\u5982\u679c\u6570\u636e\u5df2\u7ecf\u5728 Cache \u91cc\u9762\uff0c\u5148\u5c06\u6570\u636e\u66f4\u65b0\u5230 Cache \u91cc\u9762\uff0c\u518d\u5199\u5165\u5230\u5185\u5b58\u91cc\u9762\uff1b</li> <li>\u5982\u679c\u6570\u636e\u6ca1\u6709\u5728 Cache \u91cc\u9762\uff0c\u5c31\u76f4\u63a5\u628a\u6570\u636e\u66f4\u65b0\u5230\u5185\u5b58\u91cc\u9762\u3002</li> </ul> <p>\u5199\u76f4\u8fbe\u6cd5\u5f88\u76f4\u89c2\uff0c\u4e5f\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u95ee\u9898\u660e\u663e\uff0c\u65e0\u8bba\u6570\u636e\u5728\u4e0d\u5728 Cache \u91cc\u9762\uff0c\u6bcf\u6b21\u5199\u64cd\u4f5c\u90fd\u4f1a\u5199\u56de\u5230\u5185\u5b58\uff0c\u8fd9\u6837\u5199\u64cd\u4f5c\u5c06\u4f1a\u82b1\u8d39\u5927\u91cf\u7684\u65f6\u95f4\uff0c\u65e0\u7591\u6027\u80fd\u4f1a\u53d7\u5230\u5f88\u5927\u7684\u5f71\u54cd\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/cpu_mesi/#_2","title":"\u5199\u56de","text":"<p>\u65e2\u7136\u5199\u76f4\u8fbe\u7531\u4e8e\u6bcf\u6b21\u5199\u64cd\u4f5c\u90fd\u4f1a\u628a\u6570\u636e\u5199\u56de\u5230\u5185\u5b58\uff0c\u800c\u5bfc\u81f4\u5f71\u54cd\u6027\u80fd\uff0c\u4e8e\u662f\u4e3a\u4e86\u8981\u51cf\u5c11\u6570\u636e\u5199\u56de\u5185\u5b58\u7684\u9891\u7387\uff0c\u5c31\u51fa\u73b0\u4e86\u5199\u56de\uff08Write Back\uff09\u7684\u65b9\u6cd5\u3002</p> <p>\u5728\u5199\u56de\u673a\u5236\u4e2d\uff0c\u5f53\u53d1\u751f\u5199\u64cd\u4f5c\u65f6\uff0c\u65b0\u7684\u6570\u636e\u4ec5\u4ec5\u88ab\u5199\u5165 Cache Block \u91cc\uff0c\u53ea\u6709\u5f53\u4fee\u6539\u8fc7\u7684 Cache Block\u300c\u88ab\u66ff\u6362\u300d\u65f6\u624d\u9700\u8981\u5199\u5230\u5185\u5b58\u4e2d\uff0c\u51cf\u5c11\u4e86\u6570\u636e\u5199\u56de\u5185\u5b58\u7684\u9891\u7387\uff0c\u8fd9\u6837\u4fbf\u53ef\u4ee5\u63d0\u9ad8\u7cfb\u7edf\u7684\u6027\u80fd\u3002</p> <p></p> <p>\u90a3\u5177\u4f53\u5982\u4f55\u505a\u5230\u7684\u5462\uff1f\u4e0b\u9762\u6765\u8be6\u7ec6\u8bf4\u4e00\u4e0b\uff1a</p> <ul> <li>\u5982\u679c\u5f53\u53d1\u751f\u5199\u64cd\u4f5c\u65f6\uff0c\u6570\u636e\u5df2\u7ecf\u5728 CPU Cache \u91cc\u7684\u8bdd\uff0c\u5219\u628a\u6570\u636e\u66f4\u65b0\u5230 CPU Cache \u91cc\uff0c\u540c\u65f6\u6807\u8bb0 CPU Cache \u91cc\u7684\u8fd9\u4e2a Cache Block \u4e3a\u810f\uff08Dirty\uff09\u7684\uff0c\u8fd9\u4e2a\u810f\u7684\u6807\u8bb0\u4ee3\u8868\u8fd9\u4e2a\u65f6\u5019\uff0c\u6211\u4eec CPU Cache \u91cc\u9762\u7684\u8fd9\u4e2a Cache Block \u7684\u6570\u636e\u548c\u5185\u5b58\u662f\u4e0d\u4e00\u81f4\u7684\uff0c\u8fd9\u79cd\u60c5\u51b5\u662f\u4e0d\u7528\u628a\u6570\u636e\u5199\u5230\u5185\u5b58\u91cc\u7684\uff1b</li> <li>\u5982\u679c\u5f53\u53d1\u751f\u5199\u64cd\u4f5c\u65f6\uff0c\u6570\u636e\u6240\u5bf9\u5e94\u7684 Cache Block \u91cc\u5b58\u653e\u7684\u662f\u300c\u522b\u7684\u5185\u5b58\u5730\u5740\u7684\u6570\u636e\u300d\u7684\u8bdd\uff0c\u5c31\u8981\u68c0\u67e5\u8fd9\u4e2a Cache Block \u91cc\u7684\u6570\u636e\u6709\u6ca1\u6709\u88ab\u6807\u8bb0\u4e3a\u810f\u7684\uff1a</li> <li>\u5982\u679c\u662f\u810f\u7684\u8bdd\uff0c\u6211\u4eec\u5c31\u8981\u628a\u8fd9\u4e2a Cache Block \u91cc\u7684\u6570\u636e\u5199\u56de\u5230\u5185\u5b58\uff0c\u7136\u540e\u518d\u628a\u5f53\u524d\u8981\u5199\u5165\u7684\u6570\u636e\uff0c\u5148\u4ece\u5185\u5b58\u8bfb\u5165\u5230 Cache Block \u91cc\uff08\u6ce8\u610f\uff0c\u8fd9\u4e00\u6b65\u4e0d\u662f\u6ca1\u7528\u7684\uff0c\u5177\u4f53\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e00\u6b65\uff0c\u53ef\u4ee5\u770b\u8fd9\u4e2a\u300c\u56de\u7b54\u300d\uff09\uff0c\u7136\u540e\u518d\u628a\u5f53\u524d\u8981\u5199\u5165\u7684\u6570\u636e\u5199\u5165\u5230  Cache Block\uff0c\u6700\u540e\u4e5f\u628a\u5b83\u6807\u8bb0\u4e3a\u810f\u7684\uff1b</li> <li>\u5982\u679c\u4e0d\u662f\u810f\u7684\u8bdd\uff0c\u628a\u5f53\u524d\u8981\u5199\u5165\u7684\u6570\u636e\u5148\u4ece\u5185\u5b58\u8bfb\u5165\u5230 Cache Block \u91cc\uff0c\u63a5\u7740\u5c06\u6570\u636e\u5199\u5165\u5230\u8fd9\u4e2a Cache Block \u91cc\uff0c\u7136\u540e\u518d\u628a\u8fd9\u4e2a Cache Block \u6807\u8bb0\u4e3a\u810f\u7684\u5c31\u597d\u4e86\u3002</li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0\u5199\u56de\u8fd9\u4e2a\u65b9\u6cd5\uff0c\u5728\u628a\u6570\u636e\u5199\u5165\u5230 Cache \u7684\u65f6\u5019\uff0c\u53ea\u6709\u5728\u7f13\u5b58\u4e0d\u547d\u4e2d\uff0c\u540c\u65f6\u6570\u636e\u5bf9\u5e94\u7684 Cache \u4e2d\u7684 Cache Block \u4e3a\u810f\u6807\u8bb0\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u4f1a\u5c06\u6570\u636e\u5199\u5230\u5185\u5b58\u4e2d\uff0c\u800c\u5728\u7f13\u5b58\u547d\u4e2d\u7684\u60c5\u51b5\u4e0b\uff0c\u5219\u5728\u5199\u5165\u540e Cache \u540e\uff0c\u53ea\u9700\u628a\u8be5\u6570\u636e\u5bf9\u5e94\u7684 Cache Block \u6807\u8bb0\u4e3a\u810f\u5373\u53ef\uff0c\u800c\u4e0d\u7528\u5199\u5230\u5185\u5b58\u91cc\u3002</p> <p>\u8fd9\u6837\u7684\u597d\u5904\u662f\uff0c\u5982\u679c\u6211\u4eec\u5927\u91cf\u7684\u64cd\u4f5c\u90fd\u80fd\u591f\u547d\u4e2d\u7f13\u5b58\uff0c\u90a3\u4e48\u5927\u90e8\u5206\u65f6\u95f4\u91cc CPU \u90fd\u4e0d\u9700\u8981\u8bfb\u5199\u5185\u5b58\uff0c\u81ea\u7136\u6027\u80fd\u76f8\u6bd4\u5199\u76f4\u8fbe\u4f1a\u9ad8\u5f88\u591a\u3002</p> <p>\u4e3a\u4ec0\u4e48\u7f13\u5b58\u6ca1\u547d\u4e2d\u65f6\uff0c\u8fd8\u8981\u5b9a\u4f4d Cache Block\uff1f\u8fd9\u662f\u56e0\u4e3a\u6b64\u65f6\u662f\u8981\u5224\u65ad\u6570\u636e\u5373\u5c06\u5199\u5165\u5230 cache block \u91cc\u7684\u4f4d\u7f6e\uff0c\u662f\u5426\u88ab\u300c\u5176\u4ed6\u6570\u636e\u300d\u5360\u7528\u4e86\u6b64\u4f4d\u7f6e\uff0c\u5982\u679c\u8fd9\u4e2a\u300c\u5176\u4ed6\u6570\u636e\u300d\u662f\u810f\u6570\u636e\uff0c\u90a3\u4e48\u5c31\u8981\u5e2e\u5fd9\u628a\u5b83\u5199\u56de\u5230\u5185\u5b58\u3002</p> <p>CPU \u7f13\u5b58\u4e0e\u5185\u5b58\u4f7f\u7528\u300c\u5199\u56de\u300d\u673a\u5236\u7684\u6d41\u7a0b\u56fe\u5982\u4e0b\uff0c\u5de6\u534a\u90e8\u5206\u5c31\u662f\u8bfb\u64cd\u4f5c\u7684\u6d41\u7a0b\uff0c\u53f3\u534a\u90e8\u5206\u5c31\u662f\u5199\u64cd\u4f5c\u7684\u6d41\u7a0b\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u4e0a\u9762\u8bb2\u7684\u5185\u5bb9\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/cpu_mesi/#_3","title":"\u7f13\u5b58\u4e00\u81f4\u6027\u95ee\u9898","text":"<p>\u73b0\u5728 CPU \u90fd\u662f\u591a\u6838\u7684\uff0c\u7531\u4e8e L1/L2 Cache \u662f\u591a\u4e2a\u6838\u5fc3\u5404\u81ea\u72ec\u6709\u7684\uff0c\u90a3\u4e48\u4f1a\u5e26\u6765\u591a\u6838\u5fc3\u7684\u7f13\u5b58\u4e00\u81f4\u6027\uff08Cache Coherence\uff09 \u7684\u95ee\u9898\uff0c\u5982\u679c\u4e0d\u80fd\u4fdd\u8bc1\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u95ee\u9898\uff0c\u5c31\u53ef\u80fd\u9020\u6210\u7ed3\u679c\u9519\u8bef\u3002</p> <p>\u90a3\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u95ee\u9898\u5177\u4f53\u662f\u600e\u4e48\u53d1\u751f\u7684\u5462\uff1f\u6211\u4eec\u4ee5\u4e00\u4e2a\u542b\u6709\u4e24\u4e2a\u6838\u5fc3\u7684 CPU  \u4f5c\u4e3a\u4f8b\u5b50\u770b\u4e00\u770b\u3002</p> <p>\u5047\u8bbe A \u53f7\u6838\u5fc3\u548c B \u53f7\u6838\u5fc3\u540c\u65f6\u8fd0\u884c\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u90fd\u64cd\u4f5c\u5171\u540c\u7684\u53d8\u91cf i\uff08\u521d\u59cb\u503c\u4e3a 0\uff09\u3002</p> <p></p> <p>\u8fd9\u65f6\u5982\u679c A \u53f7\u6838\u5fc3\u6267\u884c\u4e86 <code>i++</code> \u8bed\u53e5\u7684\u65f6\u5019\uff0c\u4e3a\u4e86\u8003\u8651\u6027\u80fd\uff0c\u4f7f\u7528\u4e86\u6211\u4eec\u524d\u9762\u6240\u8bf4\u7684\u5199\u56de\u7b56\u7565\uff0c\u5148\u628a\u503c\u4e3a <code>1</code> \u7684\u6267\u884c\u7ed3\u679c\u5199\u5165\u5230 L1/L2 Cache \u4e2d\uff0c\u7136\u540e\u628a L1/L2 Cache \u4e2d\u5bf9\u5e94\u7684 Block \u6807\u8bb0\u4e3a\u810f\u7684\uff0c\u8fd9\u4e2a\u65f6\u5019\u6570\u636e\u5176\u5b9e\u6ca1\u6709\u88ab\u540c\u6b65\u5230\u5185\u5b58\u4e2d\u7684\uff0c\u56e0\u4e3a\u5199\u56de\u7b56\u7565\uff0c\u53ea\u6709\u5728 A \u53f7\u6838\u5fc3\u4e2d\u7684\u8fd9\u4e2a Cache Block \u8981\u88ab\u66ff\u6362\u7684\u65f6\u5019\uff0c\u6570\u636e\u624d\u4f1a\u5199\u5165\u5230\u5185\u5b58\u91cc\u3002</p> <p>\u5982\u679c\u8fd9\u65f6\u65c1\u8fb9\u7684 B \u53f7\u6838\u5fc3\u5c1d\u8bd5\u4ece\u5185\u5b58\u8bfb\u53d6 i \u53d8\u91cf\u7684\u503c\uff0c\u5219\u8bfb\u5230\u7684\u5c06\u4f1a\u662f\u9519\u8bef\u7684\u503c\uff0c\u56e0\u4e3a\u521a\u624d A \u53f7\u6838\u5fc3\u66f4\u65b0 i \u503c\u8fd8\u6ca1\u5199\u5165\u5230\u5185\u5b58\u4e2d\uff0c\u5185\u5b58\u4e2d\u7684\u503c\u8fd8\u4f9d\u7136\u662f 0\u3002\u8fd9\u4e2a\u5c31\u662f\u6240\u8c13\u7684\u7f13\u5b58\u4e00\u81f4\u6027\u95ee\u9898\uff0cA \u53f7\u6838\u5fc3\u548c B \u53f7\u6838\u5fc3\u7684\u7f13\u5b58\uff0c\u5728\u8fd9\u4e2a\u65f6\u5019\u662f\u4e0d\u4e00\u81f4\uff0c\u4ece\u800c\u4f1a\u5bfc\u81f4\u6267\u884c\u7ed3\u679c\u7684\u9519\u8bef\u3002</p> <p></p> <p>\u90a3\u4e48\uff0c\u8981\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u5c31\u9700\u8981\u4e00\u79cd\u673a\u5236\uff0c\u6765\u540c\u6b65\u4e24\u4e2a\u4e0d\u540c\u6838\u5fc3\u91cc\u9762\u7684\u7f13\u5b58\u6570\u636e\u3002\u8981\u5b9e\u73b0\u7684\u8fd9\u4e2a\u673a\u5236\u7684\u8bdd\uff0c\u8981\u4fdd\u8bc1\u505a\u5230\u4e0b\u9762\u8fd9 2 \u70b9\uff1a</p> <ul> <li>\u7b2c\u4e00\u70b9\uff0c\u67d0\u4e2a CPU \u6838\u5fc3\u91cc\u7684 Cache \u6570\u636e\u66f4\u65b0\u65f6\uff0c\u5fc5\u987b\u8981\u4f20\u64ad\u5230\u5176\u4ed6\u6838\u5fc3\u7684 Cache\uff0c\u8fd9\u4e2a\u79f0\u4e3a\u5199\u4f20\u64ad\uff08Write Propagation\uff09\uff1b</li> <li>\u7b2c\u4e8c\u70b9\uff0c\u67d0\u4e2a CPU \u6838\u5fc3\u91cc\u5bf9\u6570\u636e\u7684\u64cd\u4f5c\u987a\u5e8f\uff0c\u5fc5\u987b\u5728\u5176\u4ed6\u6838\u5fc3\u770b\u8d77\u6765\u987a\u5e8f\u662f\u4e00\u6837\u7684\uff0c\u8fd9\u4e2a\u79f0\u4e3a\u4e8b\u52a1\u7684\u4e32\u884c\u5316\uff08Transaction Serialization\uff09\u3002</li> </ul> <p>\u7b2c\u4e00\u70b9\u5199\u4f20\u64ad\u5f88\u5bb9\u6613\u5c31\u7406\u89e3\uff0c\u5f53\u67d0\u4e2a\u6838\u5fc3\u5728 Cache \u66f4\u65b0\u4e86\u6570\u636e\uff0c\u5c31\u9700\u8981\u540c\u6b65\u5230\u5176\u4ed6\u6838\u5fc3\u7684 Cache \u91cc\u3002\u800c\u5bf9\u4e8e\u7b2c\u4e8c\u70b9\u4e8b\u52a1\u7684\u4e32\u884c\u5316\uff0c\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\u6765\u7406\u89e3\u5b83\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u542b\u6709 4 \u4e2a\u6838\u5fc3\u7684 CPU\uff0c\u8fd9 4 \u4e2a\u6838\u5fc3\u90fd\u64cd\u4f5c\u5171\u540c\u7684\u53d8\u91cf i\uff08\u521d\u59cb\u503c\u4e3a 0\uff09\u3002A \u53f7\u6838\u5fc3\u5148\u628a i \u503c\u53d8\u4e3a 100\uff0c\u800c\u6b64\u65f6\u540c\u4e00\u65f6\u95f4\uff0cB \u53f7\u6838\u5fc3\u5148\u628a i \u503c\u53d8\u4e3a 200\uff0c\u8fd9\u91cc\u4e24\u4e2a\u4fee\u6539\uff0c\u90fd\u4f1a\u300c\u4f20\u64ad\u300d\u5230 C \u548c D \u53f7\u6838\u5fc3\u3002</p> <p></p> <p>\u90a3\u4e48\u95ee\u9898\u5c31\u6765\u4e86\uff0cC \u53f7\u6838\u5fc3\u5148\u6536\u5230\u4e86 A \u53f7\u6838\u5fc3\u66f4\u65b0\u6570\u636e\u7684\u4e8b\u4ef6\uff0c\u518d\u6536\u5230 B \u53f7\u6838\u5fc3\u66f4\u65b0\u6570\u636e\u7684\u4e8b\u4ef6\uff0c\u56e0\u6b64 C \u53f7\u6838\u5fc3\u770b\u5230\u7684\u53d8\u91cf i \u662f\u5148\u53d8\u6210 100\uff0c\u540e\u53d8\u6210 200\u3002</p> <p>\u800c\u5982\u679c D \u53f7\u6838\u5fc3\u6536\u5230\u7684\u4e8b\u4ef6\u662f\u53cd\u8fc7\u6765\u7684\uff0c\u5219 D \u53f7\u6838\u5fc3\u770b\u5230\u7684\u662f\u53d8\u91cf i \u5148\u53d8\u6210 200\uff0c\u518d\u53d8\u6210 100\uff0c\u867d\u7136\u662f\u505a\u5230\u4e86\u5199\u4f20\u64ad\uff0c\u4f46\u662f\u5404\u4e2a Cache \u91cc\u9762\u7684\u6570\u636e\u8fd8\u662f\u4e0d\u4e00\u81f4\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u4fdd\u8bc1 C \u53f7\u6838\u5fc3\u548c D \u53f7\u6838\u5fc3\u90fd\u80fd\u770b\u5230\u76f8\u540c\u987a\u5e8f\u7684\u6570\u636e\u53d8\u5316\uff0c\u6bd4\u5982\u53d8\u91cf i \u90fd\u662f\u5148\u53d8\u6210 100\uff0c\u518d\u53d8\u6210 200\uff0c\u8fd9\u6837\u7684\u8fc7\u7a0b\u5c31\u662f\u4e8b\u52a1\u7684\u4e32\u884c\u5316\u3002</p> <p>\u8981\u5b9e\u73b0\u4e8b\u52a1\u4e32\u884c\u5316\uff0c\u8981\u505a\u5230 2 \u70b9\uff1a</p> <ul> <li>CPU \u6838\u5fc3\u5bf9\u4e8e Cache \u4e2d\u6570\u636e\u7684\u64cd\u4f5c\uff0c\u9700\u8981\u540c\u6b65\u7ed9\u5176\u4ed6 CPU \u6838\u5fc3\uff1b</li> <li>\u8981\u5f15\u5165\u300c\u9501\u300d\u7684\u6982\u5ff5\uff0c\u5982\u679c\u4e24\u4e2a CPU \u6838\u5fc3\u91cc\u6709\u76f8\u540c\u6570\u636e\u7684 Cache\uff0c\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e2a Cache \u6570\u636e\u7684\u66f4\u65b0\uff0c\u53ea\u6709\u62ff\u5230\u4e86\u300c\u9501\u300d\uff0c\u624d\u80fd\u8fdb\u884c\u5bf9\u5e94\u7684\u6570\u636e\u66f4\u65b0\u3002</li> </ul> <p>\u90a3\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b\uff0c\u5199\u4f20\u64ad\u548c\u4e8b\u52a1\u4e32\u884c\u5316\u5177\u4f53\u662f\u7528\u4ec0\u4e48\u6280\u672f\u5b9e\u73b0\u7684\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/cpu_mesi/#_4","title":"\u603b\u7ebf\u55c5\u63a2","text":"<p>\u5199\u4f20\u64ad\u7684\u539f\u5219\u5c31\u662f\u5f53\u67d0\u4e2a CPU \u6838\u5fc3\u66f4\u65b0\u4e86 Cache \u4e2d\u7684\u6570\u636e\uff0c\u8981\u628a\u8be5\u4e8b\u4ef6\u5e7f\u64ad\u901a\u77e5\u5230\u5176\u4ed6\u6838\u5fc3\u3002\u6700\u5e38\u89c1\u5b9e\u73b0\u7684\u65b9\u5f0f\u662f\u603b\u7ebf\u55c5\u63a2\uff08Bus Snooping\uff09\u3002</p> <p>\u6211\u8fd8\u662f\u4ee5\u524d\u9762\u7684 i \u53d8\u91cf\u4f8b\u5b50\u6765\u8bf4\u660e\u603b\u7ebf\u55c5\u63a2\u7684\u5de5\u4f5c\u673a\u5236\uff0c\u5f53 A \u53f7 CPU \u6838\u5fc3\u4fee\u6539\u4e86 L1 Cache \u4e2d i \u53d8\u91cf\u7684\u503c\uff0c\u901a\u8fc7\u603b\u7ebf\u628a\u8fd9\u4e2a\u4e8b\u4ef6\u5e7f\u64ad\u901a\u77e5\u7ed9\u5176\u4ed6\u6240\u6709\u7684\u6838\u5fc3\uff0c\u7136\u540e\u6bcf\u4e2a CPU \u6838\u5fc3\u90fd\u4f1a\u76d1\u542c\u603b\u7ebf\u4e0a\u7684\u5e7f\u64ad\u4e8b\u4ef6\uff0c\u5e76\u68c0\u67e5\u662f\u5426\u6709\u76f8\u540c\u7684\u6570\u636e\u5728\u81ea\u5df1\u7684 L1 Cache \u91cc\u9762\uff0c\u5982\u679c B \u53f7 CPU \u6838\u5fc3\u7684 L1 Cache \u4e2d\u6709\u8be5\u6570\u636e\uff0c\u90a3\u4e48\u4e5f\u9700\u8981\u628a\u8be5\u6570\u636e\u66f4\u65b0\u5230\u81ea\u5df1\u7684 L1 Cache\u3002</p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u603b\u7ebf\u55c5\u63a2\u65b9\u6cd5\u5f88\u7b80\u5355\uff0cCPU \u9700\u8981\u6bcf\u65f6\u6bcf\u523b\u76d1\u542c\u603b\u7ebf\u4e0a\u7684\u4e00\u5207\u6d3b\u52a8\uff0c\u4f46\u662f\u4e0d\u7ba1\u522b\u7684\u6838\u5fc3\u7684 Cache \u662f\u5426\u7f13\u5b58\u76f8\u540c\u7684\u6570\u636e\uff0c\u90fd\u9700\u8981\u53d1\u51fa\u4e00\u4e2a\u5e7f\u64ad\u4e8b\u4ef6\uff0c\u8fd9\u65e0\u7591\u4f1a\u52a0\u91cd\u603b\u7ebf\u7684\u8d1f\u8f7d\u3002</p> <p>\u53e6\u5916\uff0c\u603b\u7ebf\u55c5\u63a2\u53ea\u662f\u4fdd\u8bc1\u4e86\u67d0\u4e2a CPU \u6838\u5fc3\u7684 Cache \u66f4\u65b0\u6570\u636e\u8fd9\u4e2a\u4e8b\u4ef6\u80fd\u88ab\u5176\u4ed6 CPU \u6838\u5fc3\u77e5\u9053\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u4e8b\u52a1\u4e32\u884c\u5316\u3002</p> <p>\u4e8e\u662f\uff0c\u6709\u4e00\u4e2a\u534f\u8bae\u57fa\u4e8e\u603b\u7ebf\u55c5\u63a2\u673a\u5236\u5b9e\u73b0\u4e86\u4e8b\u52a1\u4e32\u884c\u5316\uff0c\u4e5f\u7528\u72b6\u6001\u673a\u673a\u5236\u964d\u4f4e\u4e86\u603b\u7ebf\u5e26\u5bbd\u538b\u529b\uff0c\u8fd9\u4e2a\u534f\u8bae\u5c31\u662f MESI \u534f\u8bae\uff0c\u8fd9\u4e2a\u534f\u8bae\u5c31\u505a\u5230\u4e86 CPU \u7f13\u5b58\u4e00\u81f4\u6027\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/cpu_mesi/#mesi","title":"MESI \u534f\u8bae","text":"<p>MESI \u534f\u8bae\u5176\u5b9e\u662f 4 \u4e2a\u72b6\u6001\u5355\u8bcd\u7684\u5f00\u5934\u5b57\u6bcd\u7f29\u5199\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>Modified\uff0c\u5df2\u4fee\u6539</li> <li>Exclusive\uff0c\u72ec\u5360</li> <li>Shared\uff0c\u5171\u4eab</li> <li>Invalidated\uff0c\u5df2\u5931\u6548</li> </ul> <p>\u8fd9\u56db\u4e2a\u72b6\u6001\u6765\u6807\u8bb0 Cache Line \u56db\u4e2a\u4e0d\u540c\u7684\u72b6\u6001\u3002</p> <p>\u300c\u5df2\u4fee\u6539\u300d\u72b6\u6001\u5c31\u662f\u6211\u4eec\u524d\u9762\u63d0\u5230\u7684\u810f\u6807\u8bb0\uff0c\u4ee3\u8868\u8be5 Cache Block \u4e0a\u7684\u6570\u636e\u5df2\u7ecf\u88ab\u66f4\u65b0\u8fc7\uff0c\u4f46\u662f\u8fd8\u6ca1\u6709\u5199\u5230\u5185\u5b58\u91cc\u3002\u800c\u300c\u5df2\u5931\u6548\u300d\u72b6\u6001\uff0c\u8868\u793a\u7684\u662f\u8fd9\u4e2a Cache Block \u91cc\u7684\u6570\u636e\u5df2\u7ecf\u5931\u6548\u4e86\uff0c\u4e0d\u53ef\u4ee5\u8bfb\u53d6\u8be5\u72b6\u6001\u7684\u6570\u636e\u3002</p> <p>\u300c\u72ec\u5360\u300d\u548c\u300c\u5171\u4eab\u300d\u72b6\u6001\u90fd\u4ee3\u8868 Cache Block \u91cc\u7684\u6570\u636e\u662f\u5e72\u51c0\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u4e2a\u65f6\u5019 Cache Block \u91cc\u7684\u6570\u636e\u548c\u5185\u5b58\u91cc\u9762\u7684\u6570\u636e\u662f\u4e00\u81f4\u6027\u7684\u3002</p> <p>\u300c\u72ec\u5360\u300d\u548c\u300c\u5171\u4eab\u300d\u7684\u5dee\u522b\u5728\u4e8e\uff0c\u72ec\u5360\u72b6\u6001\u7684\u65f6\u5019\uff0c\u6570\u636e\u53ea\u5b58\u50a8\u5728\u4e00\u4e2a CPU \u6838\u5fc3\u7684 Cache \u91cc\uff0c\u800c\u5176\u4ed6 CPU \u6838\u5fc3\u7684 Cache \u6ca1\u6709\u8be5\u6570\u636e\u3002\u8fd9\u4e2a\u65f6\u5019\uff0c\u5982\u679c\u8981\u5411\u72ec\u5360\u7684 Cache \u5199\u6570\u636e\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u81ea\u7531\u5730\u5199\u5165\uff0c\u800c\u4e0d\u9700\u8981\u901a\u77e5\u5176\u4ed6 CPU \u6838\u5fc3\uff0c\u56e0\u4e3a\u53ea\u6709\u4f60\u8fd9\u6709\u8fd9\u4e2a\u6570\u636e\uff0c\u5c31\u4e0d\u5b58\u5728\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u95ee\u9898\u4e86\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u968f\u4fbf\u64cd\u4f5c\u8be5\u6570\u636e\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u300c\u72ec\u5360\u300d\u72b6\u6001\u4e0b\u7684\u6570\u636e\uff0c\u5982\u679c\u6709\u5176\u4ed6\u6838\u5fc3\u4ece\u5185\u5b58\u8bfb\u53d6\u4e86\u76f8\u540c\u7684\u6570\u636e\u5230\u5404\u81ea\u7684 Cache\uff0c\u90a3\u4e48\u8fd9\u4e2a\u65f6\u5019\uff0c\u72ec\u5360\u72b6\u6001\u4e0b\u7684\u6570\u636e\u5c31\u4f1a\u53d8\u6210\u5171\u4eab\u72b6\u6001\u3002</p> <p>\u90a3\u4e48\uff0c\u300c\u5171\u4eab\u300d\u72b6\u6001\u4ee3\u8868\u7740\u76f8\u540c\u7684\u6570\u636e\u5728\u591a\u4e2a CPU \u6838\u5fc3\u7684 Cache \u91cc\u90fd\u6709\uff0c\u6240\u4ee5\u5f53\u6211\u4eec\u8981\u66f4\u65b0 Cache \u91cc\u9762\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e0d\u80fd\u76f4\u63a5\u4fee\u6539\uff0c\u800c\u662f\u8981\u5148\u5411\u6240\u6709\u7684\u5176\u4ed6 CPU \u6838\u5fc3\u5e7f\u64ad\u4e00\u4e2a\u8bf7\u6c42\uff0c\u8981\u6c42\u5148\u628a\u5176\u4ed6\u6838\u5fc3\u7684 Cache \u4e2d\u5bf9\u5e94\u7684 Cache Line \u6807\u8bb0\u4e3a\u300c\u65e0\u6548\u300d\u72b6\u6001\uff0c\u7136\u540e\u518d\u66f4\u65b0\u5f53\u524d Cache \u91cc\u9762\u7684\u6570\u636e\u3002</p> <p>\u6211\u4eec\u4e3e\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\u6765\u770b\u770b\u8fd9\u56db\u4e2a\u72b6\u6001\u7684\u8f6c\u6362\uff1a</p> <ol> <li>\u5f53 A \u53f7 CPU \u6838\u5fc3\u4ece\u5185\u5b58\u8bfb\u53d6\u53d8\u91cf i \u7684\u503c\uff0c\u6570\u636e\u88ab\u7f13\u5b58\u5728 A \u53f7 CPU \u6838\u5fc3\u81ea\u5df1\u7684 Cache \u91cc\u9762\uff0c\u6b64\u65f6\u5176\u4ed6 CPU \u6838\u5fc3\u7684 Cache \u6ca1\u6709\u7f13\u5b58\u8be5\u6570\u636e\uff0c\u4e8e\u662f\u6807\u8bb0 Cache Line \u72b6\u6001\u4e3a\u300c\u72ec\u5360\u300d\uff0c\u6b64\u65f6\u5176 Cache \u4e2d\u7684\u6570\u636e\u4e0e\u5185\u5b58\u662f\u4e00\u81f4\u7684\uff1b</li> <li>\u7136\u540e B \u53f7 CPU \u6838\u5fc3\u4e5f\u4ece\u5185\u5b58\u8bfb\u53d6\u4e86\u53d8\u91cf i \u7684\u503c\uff0c\u6b64\u65f6\u4f1a\u53d1\u9001\u6d88\u606f\u7ed9\u5176\u4ed6 CPU \u6838\u5fc3\uff0c\u7531\u4e8e A \u53f7 CPU \u6838\u5fc3\u5df2\u7ecf\u7f13\u5b58\u4e86\u8be5\u6570\u636e\uff0c\u6240\u4ee5\u4f1a\u628a\u6570\u636e\u8fd4\u56de\u7ed9 B \u53f7 CPU \u6838\u5fc3\u3002\u5728\u8fd9\u4e2a\u65f6\u5019\uff0cA \u548c B \u6838\u5fc3\u7f13\u5b58\u4e86\u76f8\u540c\u7684\u6570\u636e\uff0cCache Line \u7684\u72b6\u6001\u5c31\u4f1a\u53d8\u6210\u300c\u5171\u4eab\u300d\uff0c\u5e76\u4e14\u5176 Cache \u4e2d\u7684\u6570\u636e\u4e0e\u5185\u5b58\u4e5f\u662f\u4e00\u81f4\u7684\uff1b</li> <li>\u5f53 A \u53f7 CPU \u6838\u5fc3\u8981\u4fee\u6539 Cache \u4e2d i \u53d8\u91cf\u7684\u503c\uff0c\u53d1\u73b0\u6570\u636e\u5bf9\u5e94\u7684 Cache Line \u7684\u72b6\u6001\u662f\u5171\u4eab\u72b6\u6001\uff0c\u5219\u8981\u5411\u6240\u6709\u7684\u5176\u4ed6 CPU \u6838\u5fc3\u5e7f\u64ad\u4e00\u4e2a\u8bf7\u6c42\uff0c\u8981\u6c42\u5148\u628a\u5176\u4ed6\u6838\u5fc3\u7684 Cache \u4e2d\u5bf9\u5e94\u7684 Cache Line \u6807\u8bb0\u4e3a\u300c\u65e0\u6548\u300d\u72b6\u6001\uff0c\u7136\u540e A \u53f7 CPU \u6838\u5fc3\u624d\u66f4\u65b0 Cache \u91cc\u9762\u7684\u6570\u636e\uff0c\u540c\u65f6\u6807\u8bb0 Cache Line \u4e3a\u300c\u5df2\u4fee\u6539\u300d\u72b6\u6001\uff0c\u6b64\u65f6 Cache \u4e2d\u7684\u6570\u636e\u5c31\u4e0e\u5185\u5b58\u4e0d\u4e00\u81f4\u4e86\u3002</li> <li>\u5982\u679c A \u53f7 CPU \u6838\u5fc3\u300c\u7ee7\u7eed\u300d\u4fee\u6539 Cache \u4e2d i \u53d8\u91cf\u7684\u503c\uff0c\u7531\u4e8e\u6b64\u65f6\u7684 Cache Line \u662f\u300c\u5df2\u4fee\u6539\u300d\u72b6\u6001\uff0c\u56e0\u6b64\u4e0d\u9700\u8981\u7ed9\u5176\u4ed6 CPU \u6838\u5fc3\u53d1\u9001\u6d88\u606f\uff0c\u76f4\u63a5\u66f4\u65b0\u6570\u636e\u5373\u53ef\u3002</li> <li>\u5982\u679c A \u53f7 CPU \u6838\u5fc3\u7684 Cache \u91cc\u7684 i \u53d8\u91cf\u5bf9\u5e94\u7684  Cache Line \u8981\u88ab\u300c\u66ff\u6362\u300d\uff0c\u53d1\u73b0  Cache Line \u72b6\u6001\u662f\u300c\u5df2\u4fee\u6539\u300d\u72b6\u6001\uff0c\u5c31\u4f1a\u5728\u66ff\u6362\u524d\u5148\u628a\u6570\u636e\u540c\u6b65\u5230\u5185\u5b58\u3002</li> </ol> <p>\u6240\u4ee5\uff0c\u53ef\u4ee5\u53d1\u73b0\u5f53 Cache Line \u72b6\u6001\u662f\u300c\u5df2\u4fee\u6539\u300d\u6216\u8005\u300c\u72ec\u5360\u300d\u72b6\u6001\u65f6\uff0c\u4fee\u6539\u66f4\u65b0\u5176\u6570\u636e\u4e0d\u9700\u8981\u53d1\u9001\u5e7f\u64ad\u7ed9\u5176\u4ed6 CPU \u6838\u5fc3\uff0c\u8fd9\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u51cf\u5c11\u4e86\u603b\u7ebf\u5e26\u5bbd\u538b\u529b\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u6574\u4e2a MESI \u7684\u72b6\u6001\u53ef\u4ee5\u7528\u4e00\u4e2a\u6709\u9650\u72b6\u6001\u673a\u6765\u8868\u793a\u5b83\u7684\u72b6\u6001\u6d41\u8f6c\u3002\u8fd8\u6709\u4e00\u70b9\uff0c\u5bf9\u4e8e\u4e0d\u540c\u72b6\u6001\u89e6\u53d1\u7684\u4e8b\u4ef6\u64cd\u4f5c\uff0c\u53ef\u80fd\u662f\u6765\u81ea\u672c\u5730 CPU \u6838\u5fc3\u53d1\u51fa\u7684\u5e7f\u64ad\u4e8b\u4ef6\uff0c\u4e5f\u53ef\u4ee5\u662f\u6765\u81ea\u5176\u4ed6 CPU \u6838\u5fc3\u901a\u8fc7\u603b\u7ebf\u53d1\u51fa\u7684\u5e7f\u64ad\u4e8b\u4ef6\u3002\u4e0b\u56fe\u5373\u662f MESI \u534f\u8bae\u7684\u72b6\u6001\u56fe\uff1a</p> <p></p> <p>MESI \u534f\u8bae\u7684\u56db\u79cd\u72b6\u6001\u4e4b\u95f4\u7684\u6d41\u8f6c\u8fc7\u7a0b\uff0c\u6211\u6c47\u603b\u6210\u4e86\u4e0b\u9762\u7684\u8868\u683c\uff0c\u4f60\u53ef\u4ee5\u66f4\u8be6\u7ec6\u7684\u770b\u5230\u6bcf\u4e2a\u72b6\u6001\u8f6c\u6362\u7684\u539f\u56e0\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/cpu_mesi/#_5","title":"\u603b\u7ed3","text":"<p>CPU \u5728\u8bfb\u5199\u6570\u636e\u7684\u65f6\u5019\uff0c\u90fd\u662f\u5728 CPU Cache \u8bfb\u5199\u6570\u636e\u7684\uff0c\u539f\u56e0\u662f Cache \u79bb CPU \u5f88\u8fd1\uff0c\u8bfb\u5199\u6027\u80fd\u76f8\u6bd4\u5185\u5b58\u9ad8\u51fa\u5f88\u591a\u3002\u5bf9\u4e8e Cache \u91cc\u6ca1\u6709\u7f13\u5b58 CPU \u6240\u9700\u8981\u8bfb\u53d6\u7684\u6570\u636e\u7684\u8fd9\u79cd\u60c5\u51b5\uff0cCPU \u5219\u4f1a\u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u5c06\u6570\u636e\u7f13\u5b58\u5230 Cache \u91cc\u9762\uff0c\u6700\u540e CPU \u518d\u4ece Cache \u8bfb\u53d6\u6570\u636e\u3002</p> <p>\u800c\u5bf9\u4e8e\u6570\u636e\u7684\u5199\u5165\uff0cCPU \u90fd\u4f1a\u5148\u5199\u5165\u5230 Cache \u91cc\u9762\uff0c\u7136\u540e\u518d\u5728\u627e\u4e2a\u5408\u9002\u7684\u65f6\u673a\u5199\u5165\u5230\u5185\u5b58\uff0c\u90a3\u5c31\u6709\u300c\u5199\u76f4\u8fbe\u300d\u548c\u300c\u5199\u56de\u300d\u8fd9\u4e24\u79cd\u7b56\u7565\u6765\u4fdd\u8bc1 Cache \u4e0e\u5185\u5b58\u7684\u6570\u636e\u4e00\u81f4\u6027\uff1a</p> <ul> <li>\u5199\u76f4\u8fbe\uff0c\u53ea\u8981\u6709\u6570\u636e\u5199\u5165\uff0c\u90fd\u4f1a\u76f4\u63a5\u628a\u6570\u636e\u5199\u5165\u5230\u5185\u5b58\u91cc\u9762\uff0c\u8fd9\u79cd\u65b9\u5f0f\u7b80\u5355\u76f4\u89c2\uff0c\u4f46\u662f\u6027\u80fd\u5c31\u4f1a\u53d7\u9650\u4e8e\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\uff1b</li> <li>\u5199\u56de\uff0c\u5bf9\u4e8e\u5df2\u7ecf\u7f13\u5b58\u5728 Cache \u7684\u6570\u636e\u7684\u5199\u5165\uff0c\u53ea\u9700\u8981\u66f4\u65b0\u5176\u6570\u636e\u5c31\u53ef\u4ee5\uff0c\u4e0d\u7528\u5199\u5165\u5230\u5185\u5b58\uff0c\u53ea\u6709\u5728\u9700\u8981\u628a\u7f13\u5b58\u91cc\u9762\u7684\u810f\u6570\u636e\u4ea4\u6362\u51fa\u53bb\u7684\u65f6\u5019\uff0c\u624d\u628a\u6570\u636e\u540c\u6b65\u5230\u5185\u5b58\u91cc\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5728\u7f13\u5b58\u547d\u4e2d\u7387\u9ad8\u7684\u60c5\u51b5\uff0c\u6027\u80fd\u4f1a\u66f4\u597d\uff1b</li> </ul> <p>\u5f53\u4eca CPU \u90fd\u662f\u591a\u6838\u7684\uff0c\u6bcf\u4e2a\u6838\u5fc3\u90fd\u6709\u5404\u81ea\u72ec\u7acb\u7684 L1/L2 Cache\uff0c\u53ea\u6709 L3 Cache \u662f\u591a\u4e2a\u6838\u5fc3\u4e4b\u95f4\u5171\u4eab\u7684\u3002\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u786e\u4fdd\u591a\u6838\u7f13\u5b58\u662f\u4e00\u81f4\u6027\u7684\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u9519\u8bef\u7684\u7ed3\u679c\u3002</p> <p>\u8981\u60f3\u5b9e\u73b0\u7f13\u5b58\u4e00\u81f4\u6027\uff0c\u5173\u952e\u662f\u8981\u6ee1\u8db3 2 \u70b9\uff1a</p> <ul> <li>\u7b2c\u4e00\u70b9\u662f\u5199\u4f20\u64ad\uff0c\u4e5f\u5c31\u662f\u5f53\u67d0\u4e2a CPU \u6838\u5fc3\u53d1\u751f\u5199\u5165\u64cd\u4f5c\u65f6\uff0c\u9700\u8981\u628a\u8be5\u4e8b\u4ef6\u5e7f\u64ad\u901a\u77e5\u7ed9\u5176\u4ed6\u6838\u5fc3\uff1b</li> <li>\u7b2c\u4e8c\u70b9\u662f\u4e8b\u52a1\u7684\u4e32\u884c\u5316\uff0c\u8fd9\u4e2a\u5f88\u91cd\u8981\uff0c\u53ea\u6709\u4fdd\u8bc1\u4e86\u8fd9\u4e2a\uff0c\u624d\u80fd\u4fdd\u969c\u6211\u4eec\u7684\u6570\u636e\u662f\u771f\u6b63\u4e00\u81f4\u7684\uff0c\u6211\u4eec\u7684\u7a0b\u5e8f\u5728\u5404\u4e2a\u4e0d\u540c\u7684\u6838\u5fc3\u4e0a\u8fd0\u884c\u7684\u7ed3\u679c\u4e5f\u662f\u4e00\u81f4\u7684\uff1b</li> </ul> <p>\u57fa\u4e8e\u603b\u7ebf\u55c5\u63a2\u673a\u5236\u7684 MESI \u534f\u8bae\uff0c\u5c31\u6ee1\u8db3\u4e0a\u9762\u4e86\u8fd9\u4e24\u70b9\uff0c\u56e0\u6b64\u5b83\u662f\u4fdd\u969c\u7f13\u5b58\u4e00\u81f4\u6027\u7684\u534f\u8bae\u3002</p> <p>MESI \u534f\u8bae\uff0c\u662f\u5df2\u4fee\u6539\u3001\u72ec\u5360\u3001\u5171\u4eab\u3001\u5df2\u5931\u6548\u8fd9\u56db\u4e2a\u72b6\u6001\u7684\u82f1\u6587\u7f29\u5199\u7684\u7ec4\u5408\u3002\u6574\u4e2a MESI \u72b6\u6001\u7684\u53d8\u66f4\uff0c\u5219\u662f\u6839\u636e\u6765\u81ea\u672c\u5730 CPU \u6838\u5fc3\u7684\u8bf7\u6c42\uff0c\u6216\u8005\u6765\u81ea\u5176\u4ed6 CPU \u6838\u5fc3\u901a\u8fc7\u603b\u7ebf\u4f20\u8f93\u8fc7\u6765\u7684\u8bf7\u6c42\uff0c\u4ece\u800c\u6784\u6210\u4e00\u4e2a\u6d41\u52a8\u7684\u72b6\u6001\u673a\u3002\u53e6\u5916\uff0c\u5bf9\u4e8e\u5728\u300c\u5df2\u4fee\u6539\u300d\u6216\u8005\u300c\u72ec\u5360\u300d\u72b6\u6001\u7684 Cache Line\uff0c\u4fee\u6539\u66f4\u65b0\u5176\u6570\u636e\u4e0d\u9700\u8981\u53d1\u9001\u5e7f\u64ad\u7ed9\u5176\u4ed6 CPU \u6838\u5fc3\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/cpu_mesi/#_6","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/float/","title":"2.7  \u4e3a\u4ec0\u4e48 0.1 + 0.2 \u4e0d\u7b49\u4e8e 0.3\uff1f","text":"<p>\u6211\u4eec\u6765\u601d\u8003\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u4e3a\u4ec0\u4e48\u8d1f\u6570\u8981\u7528\u8865\u7801\u8868\u793a\uff1f</li> <li>\u5341\u8fdb\u5236\u5c0f\u6570\u600e\u4e48\u8f6c\u6210\u4e8c\u8fdb\u5236\uff1f</li> <li>\u8ba1\u7b97\u673a\u662f\u600e\u4e48\u5b58\u5c0f\u6570\u7684\uff1f</li> <li>0.1 + 0.2 == 0.3 \u5417\uff1f</li> <li>...</li> </ul> <p>\u522b\u770b\u8fd9\u4e9b\u95ee\u9898\u90fd\u770b\u4f3c\u7b80\u5355\uff0c\u4f46\u662f\u5176\u5b9e\u8fd8\u662f\u6709\u70b9\u4e1c\u897f\u7684\u8fd9\u4e9b\u95ee\u9898\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/float/#_1","title":"\u4e3a\u4ec0\u4e48\u8d1f\u6570\u8981\u7528\u8865\u7801\u8868\u793a\uff1f","text":"<p>\u5341\u8fdb\u5236\u8f6c\u6362\u4e8c\u8fdb\u5236\u7684\u65b9\u6cd5\u76f8\u4fe1\u5927\u5bb6\u90fd\u719f\u80fd\u751f\u5de7\u4e86\uff0c\u5982\u679c\u4f60\u8bf4\u4f60\u8fd8\u4e0d\u77e5\u9053\uff0c\u6211\u89c9\u5f97\u4f60\u8fd8\u662f\u592a\u8c26\u865a\uff0c\u53ef\u80fd\u4f60\u53ea\u662f\u5fd8\u8bb0\u4e86\uff0c\u5373\u4f7f\u4f60\u771f\u7684\u5fd8\u8bb0\u4e86\uff0c\u4e0d\u6015\uff0c\u8d34\u5fc3\u7684\u5c0f\u6797\u5728\u548c\u4f60\u4e00\u8d77\u56de\u5fc6\u4e00\u4e0b\u3002</p> <p>\u5341\u8fdb\u5236\u6570\u8f6c\u4e8c\u8fdb\u5236\u91c7\u7528\u7684\u662f\u9664 2 \u53d6\u4f59\u6cd5\uff0c\u6bd4\u5982\u6570\u5b57 8 \u8f6c\u4e8c\u8fdb\u5236\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u770b\u770b\u300c\u6574\u6570\u7c7b\u578b\u300d\u7684\u6570\u5b57\u5728\u8ba1\u7b97\u673a\u7684\u5b58\u50a8\u65b9\u5f0f\uff0c\u8fd9\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u4e5f\u5f88\u76f4\u89c2\uff0c\u5c31\u662f\u5c06\u5341\u8fdb\u5236\u7684\u6570\u5b57\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\u5373\u53ef\u3002</p> <p>\u6211\u4eec\u4ee5 <code>int</code> \u7c7b\u578b\u7684\u6570\u5b57\u4f5c\u4e3a\u4f8b\u5b50\uff0cint \u7c7b\u578b\u662f <code>32</code> \u4f4d\u7684\uff0c\u5176\u4e2d\u6700\u9ad8\u4f4d\u662f\u4f5c\u4e3a\u300c\u7b26\u53f7\u6807\u5fd7\u4f4d\u300d\uff0c\u6b63\u6570\u7684\u7b26\u53f7\u4f4d\u662f <code>0</code>\uff0c\u8d1f\u6570\u7684\u7b26\u53f7\u4f4d\u662f <code>1</code>\uff0c\u5269\u4f59\u7684 31 \u4f4d\u5219\u8868\u793a\u4e8c\u8fdb\u5236\u6570\u636e\u3002</p> <p>\u90a3\u4e48\uff0c\u5bf9\u4e8e int \u7c7b\u578b\u7684\u6570\u5b57 1 \u7684\u4e8c\u8fdb\u5236\u6570\u8868\u793a\u5982\u4e0b\uff1a</p> <p></p> <p>\u800c\u8d1f\u6570\u5c31\u6bd4\u8f83\u7279\u6b8a\u4e86\u70b9\uff0c\u8d1f\u6570\u5728\u8ba1\u7b97\u673a\u4e2d\u662f\u4ee5\u300c\u8865\u7801\u300d\u8868\u793a\u7684\uff0c\u6240\u8c13\u7684\u8865\u7801\u5c31\u662f\u628a\u6b63\u6570\u7684\u4e8c\u8fdb\u5236\u5168\u90e8\u53d6\u53cd\u518d\u52a0 1\uff0c\u6bd4\u5982 -1 \u7684\u4e8c\u8fdb\u5236\u662f\u628a\u6570\u5b57 1 \u7684\u4e8c\u8fdb\u5236\u53d6\u53cd\u540e\u518d\u52a0 1\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0d\u77e5\u9053\u4f60\u6709\u6ca1\u6709\u60f3\u8fc7\uff0c\u4e3a\u4ec0\u4e48\u8ba1\u7b97\u673a\u8981\u7528\u8865\u7801\u7684\u65b9\u5f0f\u6765\u8868\u793a\u8d1f\u6570\uff1f\u5728\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u524d\uff0c\u6211\u4eec\u5047\u8bbe\u4e0d\u7528\u8865\u7801\u7684\u65b9\u5f0f\u6765\u8868\u793a\u8d1f\u6570\uff0c\u800c\u53ea\u662f\u628a\u6700\u9ad8\u4f4d\u7684\u7b26\u53f7\u6807\u5fd7\u4f4d\u53d8\u4e3a 1 \u8868\u793a\u8d1f\u6570\uff0c\u5982\u4e0b\u56fe\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u5982\u679c\u91c7\u7528\u8fd9\u79cd\u65b9\u5f0f\u6765\u8868\u793a\u8d1f\u6570\u7684\u4e8c\u8fdb\u5236\u7684\u8bdd\uff0c\u8bd5\u60f3\u4e00\u4e0b <code>-2 + 1</code> \u7684\u8fd0\u7b97\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6309\u9053\u7406\uff0c<code>-2 + 1 = -1</code>\uff0c\u4f46\u662f\u4e0a\u9762\u7684\u8fd0\u7b97\u8fc7\u7a0b\u4e2d\u5f97\u5230\u7ed3\u679c\u5374\u662f <code>-3</code>\uff0c\u6240\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u79cd\u8d1f\u6570\u7684\u8868\u793a\u65b9\u5f0f\u662f\u4e0d\u80fd\u7528\u5e38\u89c4\u7684\u52a0\u6cd5\u6765\u8ba1\u7b97\u4e86\uff0c\u5c31\u9700\u8981\u7279\u6b8a\u5904\u7406\uff0c\u8981\u5148\u5224\u65ad\u6570\u5b57\u662f\u5426\u4e3a\u8d1f\u6570\uff0c\u5982\u679c\u662f\u8d1f\u6570\u5c31\u8981\u628a\u52a0\u6cd5\u64cd\u4f5c\u53d8\u6210\u51cf\u6cd5\u64cd\u4f5c\u624d\u53ef\u4ee5\u5f97\u5230\u6b63\u786e\u5bf9\u7ed3\u679c\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u56de\u7b54\u524d\u9762\u63d0\u5230\u7684\u300c\u8d1f\u6570\u4e3a\u4ec0\u4e48\u8981\u7528\u8865\u7801\u65b9\u5f0f\u6765\u8868\u793a\u300d\u7684\u95ee\u9898\u4e86\u3002</p> <p>\u5982\u679c\u8d1f\u6570\u4e0d\u662f\u4f7f\u7528\u8865\u7801\u7684\u65b9\u5f0f\u8868\u793a\uff0c\u5219\u5728\u505a\u57fa\u672c\u5bf9\u52a0\u51cf\u6cd5\u8fd0\u7b97\u7684\u65f6\u5019\uff0c\u8fd8\u9700\u8981\u591a\u4e00\u6b65\u64cd\u4f5c\u6765\u5224\u65ad\u662f\u5426\u4e3a\u8d1f\u6570\uff0c\u5982\u679c\u4e3a\u8d1f\u6570\uff0c\u8fd8\u5f97\u628a\u52a0\u6cd5\u53cd\u8f6c\u6210\u51cf\u6cd5\uff0c\u6216\u8005\u628a\u51cf\u6cd5\u53cd\u8f6c\u6210\u52a0\u6cd5\uff0c\u8fd9\u5c31\u975e\u5e38\u4e0d\u597d\u4e86\uff0c\u6bd5\u7adf\u52a0\u51cf\u6cd5\u8fd0\u7b97\u5728\u8ba1\u7b97\u673a\u91cc\u662f\u5f88\u5e38\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u4e3a\u4e86\u6027\u80fd\u8003\u8651\uff0c\u5e94\u8be5\u8981\u5c3d\u91cf\u7b80\u5316\u8fd9\u4e2a\u8fd0\u7b97\u8fc7\u7a0b\u3002</p> <p>\u800c\u7528\u4e86\u8865\u7801\u7684\u8868\u793a\u65b9\u5f0f\uff0c\u5bf9\u4e8e\u8d1f\u6570\u7684\u52a0\u51cf\u6cd5\u64cd\u4f5c\uff0c\u5b9e\u9645\u4e0a\u662f\u548c\u6b63\u6570\u52a0\u51cf\u6cd5\u64cd\u4f5c\u4e00\u6837\u7684\u3002\u4f60\u53ef\u4ee5\u770b\u5230\u4e0b\u56fe\uff0c\u7528\u8865\u7801\u8868\u793a\u7684\u8d1f\u6570\u5728\u8fd0\u7b97 <code>-2 + 1</code> \u8fc7\u7a0b\u7684\u65f6\u5019\uff0c\u5176\u7ed3\u679c\u662f\u6b63\u786e\u7684\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/float/#_2","title":"\u5341\u8fdb\u5236\u5c0f\u6570\u4e0e\u4e8c\u8fdb\u5236\u7684\u8f6c\u6362","text":"<p>\u597d\u4e86\uff0c\u6574\u6570\u5341\u8fdb\u5236\u8f6c\u4e8c\u8fdb\u5236\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u63a5\u4e0b\u6765\u770b\u770b\u5c0f\u6570\u662f\u600e\u4e48\u8f6c\u4e8c\u8fdb\u5236\u7684\uff0c\u5c0f\u6570\u90e8\u5206\u7684\u8f6c\u6362\u4e0d\u540c\u4e8e\u6574\u6570\u90e8\u5206\uff0c\u5b83\u91c7\u7528\u7684\u662f\u4e58 2 \u53d6\u6574\u6cd5\uff0c\u5c06\u5341\u8fdb\u5236\u4e2d\u7684\u5c0f\u6570\u90e8\u5206\u4e58\u4ee5 2 \u4f5c\u4e3a\u4e8c\u8fdb\u5236\u7684\u4e00\u4f4d\uff0c\u7136\u540e\u7ee7\u7eed\u53d6\u5c0f\u6570\u90e8\u5206\u4e58\u4ee5 2 \u4f5c\u4e3a\u4e0b\u4e00\u4f4d\uff0c\u76f4\u5230\u4e0d\u5b58\u5728\u5c0f\u6570\u4e3a\u6b62\u3002</p> <p>\u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u5c31\u4ee5 <code>8.625</code> \u8f6c\u4e8c\u8fdb\u5236\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u76f4\u63a5\u4e0a\u56fe\uff1a</p> <p></p> <p>\u6700\u540e\u628a\u300c\u6574\u6570\u90e8\u5206 + \u5c0f\u6570\u90e8\u5206\u300d\u7ed3\u5408\u5728\u4e00\u8d77\u540e\uff0c\u5176\u7ed3\u679c\u5c31\u662f <code>1000.101</code>\u3002</p> <p>\u4f46\u662f\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u5c0f\u6570\u90fd\u53ef\u4ee5\u7528\u4e8c\u8fdb\u5236\u8868\u793a\uff0c\u524d\u9762\u63d0\u5230\u7684 0.625 \u5c0f\u6570\u662f\u4e00\u4e2a\u7279\u4f8b\uff0c\u521a\u597d\u901a\u8fc7\u4e58 2 \u53d6\u6574\u6cd5\u7684\u65b9\u5f0f\u5b8c\u6574\u7684\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\u3002</p> <p>\u5982\u679c\u6211\u4eec\u7528\u76f8\u540c\u7684\u65b9\u5f0f\uff0c\u6765\u628a <code>0.1</code> \u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c<code>0.1</code> \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u662f\u65e0\u9650\u5faa\u73af\u7684\u3002</p> <p>\u7531\u4e8e\u8ba1\u7b97\u673a\u7684\u8d44\u6e90\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5\u662f\u6ca1\u529e\u6cd5\u7528\u4e8c\u8fdb\u5236\u7cbe\u786e\u7684\u8868\u793a 0.1\uff0c\u53ea\u80fd\u7528\u300c\u8fd1\u4f3c\u503c\u300d\u6765\u8868\u793a\uff0c\u5c31\u662f\u5728\u6709\u9650\u7684\u7cbe\u5ea6\u60c5\u51b5\u4e0b\uff0c\u6700\u5927\u5316\u63a5\u8fd1 0.1 \u7684\u4e8c\u8fdb\u5236\u6570\uff0c\u4e8e\u662f\u5c31\u4f1a\u9020\u6210\u7cbe\u5ea6\u7f3a\u5931\u7684\u60c5\u51b5\u3002</p> <p>\u5bf9\u4e8e\u4e8c\u8fdb\u5236\u5c0f\u6570\u8f6c\u5341\u8fdb\u5236\u65f6\uff0c\u9700\u8981\u6ce8\u610f\u4e00\u70b9\uff0c\u5c0f\u6570\u70b9\u540e\u9762\u7684\u6307\u6570\u5e42\u662f\u8d1f\u6570\u3002</p> <p>\u6bd4\u5982\uff0c\u4e8c\u8fdb\u5236 <code>0.1</code> \u8f6c\u6210\u5341\u8fdb\u5236\u5c31\u662f <code>2^(-1)</code>\uff0c\u4e5f\u5c31\u662f\u5341\u8fdb\u5236 <code>0.5</code>\uff0c\u4e8c\u8fdb\u5236 <code>0.01</code> \u8f6c\u6210\u5341\u8fdb\u5236\u5c31\u662f <code>2^-2</code>\uff0c\u4e5f\u5c31\u662f\u5341\u8fdb\u5236 <code>0.25</code>\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e8c\u8fdb\u5236 <code>1010.101</code> \u8f6c\u5341\u8fdb\u5236\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/float/#_3","title":"\u8ba1\u7b97\u673a\u662f\u600e\u4e48\u5b58\u5c0f\u6570\u7684\uff1f","text":"<p><code>1000.101</code> \u8fd9\u79cd\u4e8c\u8fdb\u5236\u5c0f\u6570\u662f\u300c\u5b9a\u70b9\u6570\u300d\u5f62\u5f0f\uff0c\u4ee3\u8868\u7740\u5c0f\u6570\u70b9\u662f\u5b9a\u6b7b\u7684\uff0c\u4e0d\u80fd\u79fb\u52a8\uff0c\u5982\u679c\u4f60\u79fb\u52a8\u4e86\u5b83\u7684\u5c0f\u6570\u70b9\uff0c\u8fd9\u4e2a\u6570\u5c31\u53d8\u4e86\uff0c\u5c31\u4e0d\u518d\u662f\u5b83\u539f\u6765\u7684\u503c\u4e86\u3002</p> <p>\u7136\u800c\uff0c\u8ba1\u7b97\u673a\u5e76\u4e0d\u662f\u8fd9\u6837\u5b58\u50a8\u7684\u5c0f\u6570\u7684\uff0c\u8ba1\u7b97\u673a\u5b58\u50a8\u5c0f\u6570\u7684\u91c7\u7528\u7684\u662f\u6d6e\u70b9\u6570\uff0c\u540d\u5b57\u91cc\u7684\u300c\u6d6e\u70b9\u300d\u8868\u793a\u5c0f\u6570\u70b9\u662f\u53ef\u4ee5\u6d6e\u52a8\u7684\u3002</p> <p>\u6bd4\u5982 <code>1000.101</code> \u8fd9\u4e2a\u4e8c\u8fdb\u5236\u6570\uff0c\u53ef\u4ee5\u8868\u793a\u6210 <code>1.000101 x 2^3</code>\uff0c\u7c7b\u4f3c\u4e8e\u6570\u5b66\u4e0a\u7684\u79d1\u5b66\u8bb0\u6570\u6cd5\u3002</p> <p>\u65e2\u7136\u63d0\u5230\u4e86\u79d1\u5b66\u8ba1\u6570\u6cd5\uff0c\u6211\u518d\u5e2e\u5927\u5bb6\u590d\u4e60\u4e00\u4e0b\u3002</p> <p>\u6bd4\u5982\u6709\u4e2a\u5f88\u5927\u7684\u5341\u8fdb\u5236\u6570 1230000\uff0c\u6211\u4eec\u53ef\u4ee5\u4e5f\u53ef\u4ee5\u8868\u793a\u6210 <code>1.23 x 10^6</code>\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5c31\u79f0\u4e3a\u79d1\u5b66\u8bb0\u6570\u6cd5\u3002</p> <p>\u8be5\u65b9\u6cd5\u5728\u5c0f\u6570\u70b9\u5de6\u8fb9\u53ea\u6709\u4e00\u4e2a\u6570\u5b57\uff0c\u800c\u4e14\u628a\u8fd9\u79cd\u6574\u6570\u90e8\u5206\u6ca1\u6709\u524d\u5bfc 0 \u7684\u6570\u5b57\u79f0\u4e3a\u89c4\u683c\u5316\uff0c\u6bd4\u5982 <code>1.0 x 10^(-9)</code> \u662f\u89c4\u683c\u5316\u7684\u79d1\u5b66\u8bb0\u6570\u6cd5\uff0c\u800c <code>0.1 x 10^(-9)</code> \u548c <code>10.0 x 10^(-9)</code> \u5c31\u4e0d\u662f\u4e86\u3002</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u4e8c\u8fdb\u5236\u8981\u7528\u5230\u79d1\u5b66\u8bb0\u6570\u6cd5\uff0c\u540c\u65f6\u8981\u89c4\u8303\u5316\uff0c\u90a3\u4e48\u4e0d\u4ec5\u8981\u4fdd\u8bc1\u57fa\u6570\u4e3a 2\uff0c\u8fd8\u8981\u4fdd\u8bc1\u5c0f\u6570\u70b9\u5de6\u4fa7\u53ea\u6709 1 \u4f4d\uff0c\u800c\u4e14\u5fc5\u987b\u4e3a 1\u3002</p> <p>\u6240\u4ee5\u901a\u5e38\u5c06 <code>1000.101</code> \u8fd9\u79cd\u4e8c\u8fdb\u5236\u6570\uff0c\u89c4\u683c\u5316\u8868\u793a\u6210 <code>1.000101 x 2^3</code>\uff0c\u5176\u4e2d\uff0c\u6700\u4e3a\u5173\u952e\u7684\u662f 000101 \u548c 3 \u8fd9\u4e24\u4e2a\u4e1c\u897f\uff0c\u5b83\u5c31\u53ef\u4ee5\u5305\u542b\u4e86\u8fd9\u4e2a\u4e8c\u8fdb\u5236\u5c0f\u6570\u7684\u6240\u6709\u4fe1\u606f\uff1a</p> <ul> <li><code>000101</code> \u79f0\u4e3a\u5c3e\u6570\uff0c\u5373\u5c0f\u6570\u70b9\u540e\u9762\u7684\u6570\u5b57\uff1b</li> <li><code>3</code> \u79f0\u4e3a\u6307\u6570\uff0c\u6307\u5b9a\u4e86\u5c0f\u6570\u70b9\u5728\u6570\u636e\u4e2d\u7684\u4f4d\u7f6e\uff1b</li> </ul> <p>\u73b0\u5728\u7edd\u5927\u591a\u6570\u8ba1\u7b97\u673a\u4f7f\u7528\u7684\u6d6e\u70b9\u6570\uff0c\u4e00\u822c\u91c7\u7528\u7684\u662f IEEE \u5236\u5b9a\u7684\u56fd\u9645\u6807\u51c6\uff0c\u8fd9\u79cd\u6807\u51c6\u5f62\u5f0f\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u4e09\u4e2a\u91cd\u8981\u90e8\u5206\u7684\u610f\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>\u7b26\u53f7\u4f4d\uff1a\u8868\u793a\u6570\u5b57\u662f\u6b63\u6570\u8fd8\u662f\u8d1f\u6570\uff0c\u4e3a 0 \u8868\u793a\u6b63\u6570\uff0c\u4e3a 1 \u8868\u793a\u8d1f\u6570\uff1b</li> <li>\u6307\u6570\u4f4d\uff1a\u6307\u5b9a\u4e86\u5c0f\u6570\u70b9\u5728\u6570\u636e\u4e2d\u7684\u4f4d\u7f6e\uff0c\u6307\u6570\u53ef\u4ee5\u662f\u8d1f\u6570\uff0c\u4e5f\u53ef\u4ee5\u662f\u6b63\u6570\uff0c\u6307\u6570\u4f4d\u7684\u957f\u5ea6\u8d8a\u957f\u5219\u6570\u503c\u7684\u8868\u8fbe\u8303\u56f4\u5c31\u8d8a\u5927\uff1b</li> <li>\u5c3e\u6570\u4f4d\uff1a\u5c0f\u6570\u70b9\u53f3\u4fa7\u7684\u6570\u5b57\uff0c\u4e5f\u5c31\u662f\u5c0f\u6570\u90e8\u5206\uff0c\u6bd4\u5982\u4e8c\u8fdb\u5236 1.0011 x 2^(-2)\uff0c\u5c3e\u6570\u90e8\u5206\u5c31\u662f 0011\uff0c\u800c\u4e14\u5c3e\u6570\u7684\u957f\u5ea6\u51b3\u5b9a\u4e86\u8fd9\u4e2a\u6570\u7684\u7cbe\u5ea6\uff0c\u56e0\u6b64\u5982\u679c\u8981\u8868\u793a\u7cbe\u5ea6\u66f4\u9ad8\u7684\u5c0f\u6570\uff0c\u5219\u5c31\u8981\u63d0\u9ad8\u5c3e\u6570\u4f4d\u7684\u957f\u5ea6\uff1b</li> </ul> <p>\u7528 <code>32</code> \u4f4d\u6765\u8868\u793a\u7684\u6d6e\u70b9\u6570\uff0c\u5219\u79f0\u4e3a\u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7f16\u7a0b\u8bed\u8a00\u4e2d\u7684 <code>float</code> \u53d8\u91cf\uff0c\u800c\u7528 <code>64</code> \u4f4d\u6765\u8868\u793a\u7684\u6d6e\u70b9\u6570\uff0c\u79f0\u4e3a\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570\uff0c\u4e5f\u5c31\u662f <code>double</code>  \u53d8\u91cf\uff0c\u5b83\u4eec\u7684\u7ed3\u6784\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff1a</p> <ul> <li>double \u7684\u5c3e\u6570\u90e8\u5206\u662f 52 \u4f4d\uff0cfloat \u7684\u5c3e\u6570\u90e8\u5206\u662f 23 \u4f4d\uff0c\u7531\u4e8e\u540c\u65f6\u90fd\u5e26\u6709\u4e00\u4e2a\u56fa\u5b9a\u9690\u542b\u4f4d\uff08\u8fd9\u4e2a\u540e\u9762\u4f1a\u8bf4\uff09\uff0c\u6240\u4ee5 double \u6709 53 \u4e2a\u4e8c\u8fdb\u5236\u6709\u6548\u4f4d\uff0cfloat \u6709 24 \u4e2a\u4e8c\u8fdb\u5236\u6709\u6548\u4f4d\uff0c\u6240\u4ee5\u6240\u4ee5\u5b83\u4eec\u7684\u7cbe\u5ea6\u5728\u5341\u8fdb\u5236\u4e2d\u5206\u522b\u662f <code>log10(2^53)</code> \u7ea6\u7b49\u4e8e <code>15.95</code> \u548c <code>log10(2^24)</code> \u7ea6\u7b49\u4e8e <code>7.22</code>  \u4f4d\uff0c\u56e0\u6b64 double \u7684\u6709\u6548\u6570\u5b57\u662f <code>15~16</code> \u4f4d\uff0cfloat \u7684\u6709\u6548\u6570\u5b57\u662f <code>7~8</code> \u4f4d\uff0c\u8fd9\u4e9b\u6709\u6548\u4f4d\u662f\u5305\u542b\u6574\u6570\u90e8\u5206\u548c\u5c0f\u6570\u90e8\u5206\uff1b</li> <li>double \u7684\u6307\u6570\u90e8\u5206\u662f 11 \u4f4d\uff0c\u800c float \u7684\u6307\u6570\u4f4d\u662f 8 \u4f4d\uff0c\u610f\u5473\u7740 double \u76f8\u6bd4 float \u80fd\u8868\u793a\u66f4\u5927\u7684\u6570\u503c\u8303\u56f4\uff1b</li> </ul> <p>\u90a3\u4e8c\u8fdb\u5236\u5c0f\u6570\uff0c\u662f\u5982\u4f55\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\u6d6e\u70b9\u6570\u7684\u5462\uff1f</p> <p>\u6211\u4eec\u5c31\u4ee5 <code>10.625</code> \u4f5c\u4e3a\u4f8b\u5b50\uff0c\u770b\u770b\u8fd9\u4e2a\u6570\u5b57\u5728 float \u91cc\u662f\u5982\u4f55\u5b58\u50a8\u7684\u3002</p> <p></p> <p>\u9996\u5148\uff0c\u6211\u4eec\u8ba1\u7b97\u51fa 10.625 \u7684\u4e8c\u8fdb\u5236\u5c0f\u6570\u4e3a 1010.101\u3002</p> <p>\u7136\u540e\u628a\u5c0f\u6570\u70b9\uff0c\u79fb\u52a8\u5230\u7b2c\u4e00\u4e2a\u6709\u6548\u6570\u5b57\u540e\u9762\uff0c\u5373\u5c06 1010.101 \u53f3\u79fb <code>3</code> \u4f4d\u6210 <code>1.010101</code>\uff0c\u53f3\u79fb 3 \u4f4d\u5c31\u4ee3\u8868 +3\uff0c\u5de6\u79fb 3 \u4f4d\u5c31\u662f -3\u3002</p> <p>float \u4e2d\u7684\u300c\u6307\u6570\u4f4d\u300d\u5c31\u8ddf\u8fd9\u91cc\u79fb\u52a8\u7684\u4f4d\u6570\u6709\u5173\u7cfb\uff0c\u628a\u79fb\u52a8\u7684\u4f4d\u6570\u518d\u52a0\u4e0a\u300c\u504f\u79fb\u91cf\u300d\uff0cfloat \u7684\u8bdd\u504f\u79fb\u91cf\u662f 127\uff0c\u76f8\u52a0\u540e\u5c31\u662f\u6307\u6570\u4f4d\u7684\u503c\u4e86\uff0c\u5373\u6307\u6570\u4f4d\u8fd9 8 \u4f4d\u5b58\u7684\u662f <code>10000010</code>\uff08\u5341\u8fdb\u5236 130\uff09\uff0c\u56e0\u6b64\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u300c\u6307\u6570\u4f4d\u300d\u76f8\u5f53\u4e8e\u6307\u660e\u4e86\u5c0f\u6570\u70b9\u5728\u6570\u636e\u4e2d\u7684\u4f4d\u7f6e\u3002</p> <p><code>1.010101</code> \u8fd9\u4e2a\u6570\u7684\u5c0f\u6570\u70b9\u53f3\u4fa7\u7684\u6570\u5b57\u5c31\u662f float \u91cc\u7684\u300c\u5c3e\u6570\u4f4d\u300d\uff0c\u7531\u4e8e\u5c3e\u6570\u4f4d\u662f 23 \u4f4d\uff0c\u5219\u540e\u9762\u8981\u8865\u5145 0\uff0c\u6240\u4ee5\u6700\u7ec8\u5c3e\u6570\u4f4d\u5b58\u50a8\u7684\u6570\u5b57\u662f <code>01010100000000000000000</code>\u3002</p> <p>\u5728\u7b97\u6307\u6570\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u4f1a\u6709\u7591\u95ee\u4e3a\u4ec0\u4e48\u8981\u52a0\u4e0a\u504f\u79fb\u91cf\u5462\uff1f</p> <p>\u524d\u9762\u4e5f\u63d0\u5230\uff0c\u6307\u6570\u53ef\u80fd\u662f\u6b63\u6570\uff0c\u4e5f\u53ef\u80fd\u662f\u8d1f\u6570\uff0c\u5373\u6307\u6570\u662f\u6709\u7b26\u53f7\u7684\u6574\u6570\uff0c\u800c\u6709\u7b26\u53f7\u6574\u6570\u7684\u8ba1\u7b97\u662f\u6bd4\u65e0\u7b26\u53f7\u6574\u6570\u9ebb\u70e6\u7684\uff0c\u6240\u4ee5\u4e3a\u4e86\u51cf\u5c11\u4e0d\u5fc5\u8981\u7684\u9ebb\u70e6\uff0c\u5728\u5b9e\u9645\u5b58\u50a8\u6307\u6570\u7684\u65f6\u5019\uff0c\u9700\u8981\u628a\u6307\u6570\u8f6c\u6362\u6210\u65e0\u7b26\u53f7\u6574\u6570\u3002</p> <p>float \u7684\u6307\u6570\u90e8\u5206\u662f 8 \u4f4d\uff0cIEEE \u6807\u51c6\u89c4\u5b9a\u5355\u7cbe\u5ea6\u6d6e\u70b9\u7684\u6307\u6570\u53d6\u503c\u8303\u56f4\u662f <code>-126 ~ +127</code>\uff0c\u4e8e\u662f\u4e3a\u4e86\u628a\u6307\u6570\u8f6c\u6362\u6210\u65e0\u7b26\u53f7\u6574\u6570\uff0c\u5c31\u8981\u52a0\u4e2a\u504f\u79fb\u91cf\uff0c\u6bd4\u5982 float \u7684\u6307\u6570\u504f\u79fb\u91cf\u662f <code>127</code>\uff0c\u8fd9\u6837\u6307\u6570\u5c31\u4e0d\u4f1a\u51fa\u73b0\u8d1f\u6570\u4e86\u3002</p> <p>\u6bd4\u5982\uff0c\u6307\u6570\u5982\u679c\u662f 8\uff0c\u5219\u5b9e\u9645\u5b58\u50a8\u7684\u6307\u6570\u662f 8 + 127\uff08\u504f\u79fb\u91cf\uff09= 135\uff0c\u5373\u628a 135 \u8f6c\u6362\u4e3a\u4e8c\u8fdb\u5236\u4e4b\u540e\u518d\u5b58\u50a8\uff0c\u800c\u5f53\u6211\u4eec\u9700\u8981\u8ba1\u7b97\u5b9e\u9645\u7684\u5341\u8fdb\u5236\u6570\u7684\u65f6\u5019\uff0c\u518d\u628a\u6307\u6570\u51cf\u53bb\u300c\u504f\u79fb\u91cf\u300d\u5373\u53ef\u3002</p> <p>\u7ec6\u5fc3\u7684\u670b\u53cb\u80af\u5b9a\u53d1\u73b0\uff0c\u79fb\u52a8\u540e\u7684\u5c0f\u6570\u70b9\u5de6\u4fa7\u7684\u6709\u6548\u4f4d\uff08\u5373 1\uff09\u6d88\u5931\u4e86\uff0c\u5b83\u5e76\u6ca1\u6709\u5b58\u50a8\u5230 float \u91cc\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a IEEE \u6807\u51c6\u89c4\u5b9a\uff0c\u4e8c\u8fdb\u5236\u6d6e\u70b9\u6570\u7684\u5c0f\u6570\u70b9\u5de6\u4fa7\u53ea\u80fd\u6709 1 \u4f4d\uff0c\u5e76\u4e14\u8fd8\u53ea\u80fd\u662f 1\uff0c\u65e2\u7136\u8fd9\u4e00\u4f4d\u6c38\u8fdc\u90fd\u662f 1\uff0c\u90a3\u5c31\u53ef\u4ee5\u4e0d\u7528\u5b58\u8d77\u6765\u4e86\u3002</p> <p>\u4e8e\u662f\u5c31\u8ba9 23 \u4f4d\u5c3e\u6570\u53ea\u5b58\u50a8\u5c0f\u6570\u90e8\u5206\uff0c\u7136\u540e\u5728\u8ba1\u7b97\u65f6\u4f1a\u81ea\u52a8\u628a\u8fd9\u4e2a 1 \u52a0\u4e0a\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8282\u7ea6 1 \u4f4d\u7684\u7a7a\u95f4\uff0c\u5c3e\u6570\u5c31\u80fd\u591a\u5b58\u4e00\u4f4d\u5c0f\u6570\uff0c\u76f8\u5e94\u7684\u7cbe\u5ea6\u5c31\u66f4\u9ad8\u4e86\u4e00\u70b9\u3002</p> <p>\u90a3\u4e48\uff0c\u5bf9\u4e8e\u6211\u4eec\u5728\u4ece float \u7684\u4e8c\u8fdb\u5236\u6d6e\u70b9\u6570\u8f6c\u6362\u6210\u5341\u8fdb\u5236\u65f6\uff0c\u8981\u8003\u8651\u5230\u8fd9\u4e2a\u9690\u542b\u7684 1\uff0c\u8f6c\u6362\u516c\u5f0f\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u628a\u4e0b\u56fe\u8fd9\u4e2a float \u7684\u6570\u636e\u8f6c\u6362\u6210\u5341\u8fdb\u5236\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/float/#01-02-03","title":"0.1 + 0.2 == 0.3 ?","text":"<p>\u524d\u9762\u63d0\u5230\u8fc7\uff0c\u5e76\u4e0d\u662f\u6240\u6709\u5c0f\u6570\u90fd\u53ef\u4ee5\u7528\u300c\u5b8c\u6574\u300d\u7684\u4e8c\u8fdb\u5236\u6765\u8868\u793a\u7684\uff0c\u6bd4\u5982\u5341\u8fdb\u5236 0.1 \u5728\u8f6c\u6362\u6210\u4e8c\u8fdb\u5236\u5c0f\u6570\u7684\u65f6\u5019\uff0c\u662f\u4e00\u4e32\u65e0\u9650\u5faa\u73af\u7684\u4e8c\u8fdb\u5236\u6570\uff0c\u8ba1\u7b97\u673a\u662f\u65e0\u6cd5\u8868\u8fbe\u65e0\u9650\u5faa\u73af\u7684\u4e8c\u8fdb\u5236\u6570\u7684\uff0c\u6bd5\u7adf\u8ba1\u7b97\u673a\u7684\u8d44\u6e90\u662f\u6709\u9650\u3002</p> <p>\u56e0\u6b64\uff0c\u8ba1\u7b97\u673a\u53ea\u80fd\u7528\u300c\u8fd1\u4f3c\u503c\u300d\u6765\u8868\u793a\u8be5\u4e8c\u8fdb\u5236\uff0c\u90a3\u4e48\u610f\u5473\u7740\u8ba1\u7b97\u673a\u5b58\u653e\u7684\u5c0f\u6570\u53ef\u80fd\u4e0d\u662f\u4e00\u4e2a\u771f\u5b9e\u503c\u3002</p> <p>\u73b0\u5728\u57fa\u672c\u90fd\u662f\u7528  IEEE 754 \u89c4\u8303\u7684\u300c\u5355\u7cbe\u5ea6\u6d6e\u70b9\u7c7b\u578b\u300d\u6216\u300c\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u7c7b\u578b\u300d\u6765\u5b58\u50a8\u5c0f\u6570\u7684\uff0c\u6839\u636e\u7cbe\u5ea6\u7684\u4e0d\u540c\uff0c\u8fd1\u4f3c\u503c\u4e5f\u4f1a\u4e0d\u540c\u3002</p> <p>\u90a3\u8ba1\u7b97\u673a\u662f\u5b58\u50a8 0.1 \u662f\u4e00\u4e2a\u600e\u4e48\u6837\u7684\u4e8c\u8fdb\u5236\u6d6e\u70b9\u6570\u5462\uff1f</p> <p>\u5077\u4e2a\u61d2\uff0c\u6211\u5c31\u4e0d\u81ea\u5df1\u624b\u52a8\u7b97\u4e86\uff0c\u53ef\u4ee5\u4f7f\u7528 binaryconvert \u8fd9\u4e2a\u5de5\u5177\uff0c\u5c06\u5341\u8fdb\u5236 0.1 \u5c0f\u6570\u8f6c\u6362\u6210 float \u6d6e\u70b9\u6570\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c8 \u4f4d\u6307\u6570\u90e8\u5206\u662f <code>01111011</code>\uff0c23 \u4f4d\u7684\u5c3e\u6570\u90e8\u5206\u662f <code>10011001100110011001101</code>\uff0c\u53ef\u4ee5\u770b\u5230\u5c3e\u6570\u90e8\u5206\u662f <code>0011</code> \u662f\u4e00\u76f4\u5faa\u73af\u7684\uff0c\u53ea\u4e0d\u8fc7\u5c3e\u6570\u662f\u6709\u957f\u5ea6\u9650\u5236\u7684\uff0c\u6240\u4ee5\u53ea\u4f1a\u663e\u793a\u4e00\u90e8\u5206\uff0c\u6240\u4ee5\u662f\u4e00\u4e2a\u8fd1\u4f3c\u503c\uff0c\u7cbe\u5ea6\u5341\u5206\u6709\u9650\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u770b 0.2 \u7684 float \u6d6e\u70b9\u6570\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c8 \u4f4d\u6307\u6570\u90e8\u5206\u662f <code>01111100</code>\uff0c\u7a0d\u5fae\u548c 0.1 \u7684\u6307\u6570\u4e0d\u540c\uff0c23 \u4f4d\u7684\u5c3e\u6570\u90e8\u5206\u662f <code>10011001100110011001101</code> \u548c 0.1 \u7684\u5c3e\u6570\u90e8\u5206\u662f\u76f8\u540c\u7684\uff0c\u4e5f\u662f\u4e00\u4e2a\u8fd1\u4f3c\u503c\u3002</p> <p>0.1 \u7684\u4e8c\u8fdb\u5236\u6d6e\u70b9\u6570\u8f6c\u6362\u6210\u5341\u8fdb\u5236\u7684\u7ed3\u679c\u662f <code>0.100000001490116119384765625</code>\uff1a</p> <p></p> <p>0.2 \u7684\u4e8c\u8fdb\u5236\u6d6e\u70b9\u6570\u8f6c\u6362\u6210\u5341\u8fdb\u5236\u7684\u7ed3\u679c\u662f <code>0.20000000298023223876953125</code>\uff1a</p> <p></p> <p>\u8fd9\u4e24\u4e2a\u7ed3\u679c\u76f8\u52a0\u5c31\u662f <code>0.300000004470348358154296875</code>\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u4f60\u4f1a\u770b\u5230\u5728\u8ba1\u7b97\u673a\u4e2d 0.1 + 0.2 \u5e76\u4e0d\u7b49\u4e8e\u5b8c\u6574\u7684 0.3\u3002</p> <p>\u8fd9\u4e3b\u8981\u662f\u56e0\u4e3a\u6709\u7684\u5c0f\u6570\u65e0\u6cd5\u53ef\u4ee5\u7528\u300c\u5b8c\u6574\u300d\u7684\u4e8c\u8fdb\u5236\u6765\u8868\u793a\uff0c\u6240\u4ee5\u8ba1\u7b97\u673a\u91cc\u53ea\u80fd\u91c7\u7528\u8fd1\u4f3c\u6570\u7684\u65b9\u5f0f\u6765\u4fdd\u5b58\uff0c\u90a3\u4e24\u4e2a\u8fd1\u4f3c\u6570\u76f8\u52a0\uff0c\u5f97\u5230\u7684\u5fc5\u7136\u4e5f\u662f\u4e00\u4e2a\u8fd1\u4f3c\u6570\u3002</p> <p>\u6211\u4eec\u5728 JavaScript \u91cc\u6267\u884c 0.1 + 0.2\uff0c\u4f60\u4f1a\u5f97\u5230\u4e0b\u9762\u8fd9\u4e2a\u7ed3\u679c\uff1a</p> <p></p> <p>\u7ed3\u679c\u548c\u6211\u4eec\u524d\u9762\u63a8\u5230\u7684\u7c7b\u4f3c\uff0c\u56e0\u4e3a JavaScript \u5bf9\u4e8e\u6570\u5b57\u90fd\u662f\u4f7f\u7528 IEEE 754 \u6807\u51c6\u4e0b\u7684\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u7c7b\u578b\u6765\u5b58\u50a8\u7684\u3002</p> <p>\u800c\u6211\u4eec\u4e8c\u8fdb\u5236\u53ea\u80fd\u7cbe\u51c6\u8868\u8fbe 2 \u9664\u5c3d\u7684\u6570\u5b57 1/2, 1/4, 1/8\uff0c\u4f46\u662f\u5bf9\u4e8e 0.1(1/10) \u548c 0.2(1/5)\uff0c\u5728\u4e8c\u8fdb\u5236\u4e2d\u90fd\u65e0\u6cd5\u7cbe\u51c6\u8868\u793a\u65f6\uff0c\u9700\u8981\u6839\u636e\u7cbe\u5ea6\u820d\u5165\u3002</p> <p>\u6211\u4eec\u4eba\u7c7b\u719f\u6089\u7684\u5341\u8fdb\u5236\u8fd0\u7b97\u7cfb\u7edf\uff0c\u53ef\u4ee5\u7cbe\u51c6\u8868\u8fbe 2 \u548c 5 \u9664\u5c3d\u7684\u6570\u5b57\uff0c\u4f8b\u5982 1/2, 1/4, 1/5(0.2), 1/8, 1/10(0.1)\u3002</p> <p>\u5f53\u7136\uff0c\u5341\u8fdb\u5236\u4e5f\u6709\u65e0\u6cd5\u9664\u5c3d\u7684\u5730\u65b9\uff0c\u4f8b\u5982 1/3, 1/7\uff0c\u4e5f\u9700\u8981\u6839\u636e\u7cbe\u5ea6\u820d\u5165\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/float/#_4","title":"\u603b\u7ed3","text":"<p>\u6700\u540e\uff0c\u518d\u6765\u56de\u7b54\u5f00\u5934\u7684\u95ee\u9898\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8d1f\u6570\u8981\u7528\u8865\u7801\u8868\u793a\uff1f</p> <p>\u8d1f\u6570\u4e4b\u6240\u4ee5\u7528\u8865\u7801\u7684\u65b9\u5f0f\u6765\u8868\u793a\uff0c\u4e3b\u8981\u662f\u4e3a\u4e86\u7edf\u4e00\u548c\u6b63\u6570\u7684\u52a0\u51cf\u6cd5\u64cd\u4f5c\u4e00\u6837\uff0c\u6bd5\u7adf\u6570\u5b57\u7684\u52a0\u51cf\u6cd5\u662f\u5f88\u5e38\u7528\u7684\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5c31\u4e0d\u8981\u641e\u7279\u6b8a\u5316\uff0c\u5c3d\u91cf\u4ee5\u7edf\u4e00\u7684\u65b9\u5f0f\u6765\u8fd0\u7b97\u3002</p> <p>\u5341\u8fdb\u5236\u5c0f\u6570\u600e\u4e48\u8f6c\u6210\u4e8c\u8fdb\u5236\uff1f</p> <p>\u5341\u8fdb\u5236\u6574\u6570\u8f6c\u4e8c\u8fdb\u5236\u4f7f\u7528\u7684\u662f\u300c\u9664 2 \u53d6\u4f59\u6cd5\u300d\uff0c\u5341\u8fdb\u5236\u5c0f\u6570\u4f7f\u7528\u7684\u662f\u300c\u4e58 2 \u53d6\u6574\u6cd5\u300d\u3002</p> <p>\u8ba1\u7b97\u673a\u662f\u600e\u4e48\u5b58\u5c0f\u6570\u7684\uff1f</p> <p>\u8ba1\u7b97\u673a\u662f\u4ee5\u6d6e\u70b9\u6570\u7684\u5f62\u5f0f\u5b58\u50a8\u5c0f\u6570\u7684\uff0c\u5927\u591a\u6570\u8ba1\u7b97\u673a\u90fd\u662f IEEE 754 \u6807\u51c6\u5b9a\u4e49\u7684\u6d6e\u70b9\u6570\u683c\u5f0f\uff0c\u5305\u542b\u4e09\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>\u7b26\u53f7\u4f4d\uff1a\u8868\u793a\u6570\u5b57\u662f\u6b63\u6570\u8fd8\u662f\u8d1f\u6570\uff0c\u4e3a 0 \u8868\u793a\u6b63\u6570\uff0c\u4e3a 1 \u8868\u793a\u8d1f\u6570\uff1b</li> <li>\u6307\u6570\u4f4d\uff1a\u6307\u5b9a\u4e86\u5c0f\u6570\u70b9\u5728\u6570\u636e\u4e2d\u7684\u4f4d\u7f6e\uff0c\u6307\u6570\u53ef\u4ee5\u662f\u8d1f\u6570\uff0c\u4e5f\u53ef\u4ee5\u662f\u6b63\u6570\uff0c\u6307\u6570\u4f4d\u7684\u957f\u5ea6\u8d8a\u957f\u5219\u6570\u503c\u7684\u8868\u8fbe\u8303\u56f4\u5c31\u8d8a\u5927\uff1b</li> <li>\u5c3e\u6570\u4f4d\uff1a\u5c0f\u6570\u70b9\u53f3\u4fa7\u7684\u6570\u5b57\uff0c\u4e5f\u5c31\u662f\u5c0f\u6570\u90e8\u5206\uff0c\u6bd4\u5982\u4e8c\u8fdb\u5236 1.0011 x 2^(-2)\uff0c\u5c3e\u6570\u90e8\u5206\u5c31\u662f 0011\uff0c\u800c\u4e14\u5c3e\u6570\u7684\u957f\u5ea6\u51b3\u5b9a\u4e86\u8fd9\u4e2a\u6570\u7684\u7cbe\u5ea6\uff0c\u56e0\u6b64\u5982\u679c\u8981\u8868\u793a\u7cbe\u5ea6\u66f4\u9ad8\u7684\u5c0f\u6570\uff0c\u5219\u5c31\u8981\u63d0\u9ad8\u5c3e\u6570\u4f4d\u7684\u957f\u5ea6\uff1b</li> </ul> <p>\u7528 32 \u4f4d\u6765\u8868\u793a\u7684\u6d6e\u70b9\u6570\uff0c\u5219\u79f0\u4e3a\u5355\u7cbe\u5ea6\u6d6e\u70b9\u6570\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u7f16\u7a0b\u8bed\u8a00\u4e2d\u7684 float \u53d8\u91cf\uff0c\u800c\u7528 64 \u4f4d\u6765\u8868\u793a\u7684\u6d6e\u70b9\u6570\uff0c\u79f0\u4e3a\u53cc\u7cbe\u5ea6\u6d6e\u70b9\u6570\uff0c\u4e5f\u5c31\u662f double \u53d8\u91cf\u3002</p> <p>0.1 + 0.2 == 0.3 \u5417\uff1f</p> <p>\u4e0d\u662f\u7684\uff0c0.1 \u548c 0.2 \u8fd9\u4e24\u4e2a\u6570\u5b57\u7528\u4e8c\u8fdb\u5236\u8868\u8fbe\u4f1a\u662f\u4e00\u4e2a\u4e00\u76f4\u5faa\u73af\u7684\u4e8c\u8fdb\u5236\u6570\uff0c\u6bd4\u5982 0.1 \u7684\u4e8c\u8fdb\u5236\u8868\u793a\u4e3a 0.0 0011 0011 0011\u2026\u2026 \uff080011 \u65e0\u9650\u5faa\u73af)\uff0c\u5bf9\u4e8e\u8ba1\u7b97\u673a\u800c\u8a00\uff0c0.1 \u65e0\u6cd5\u7cbe\u786e\u8868\u8fbe\uff0c\u8fd9\u662f\u6d6e\u70b9\u6570\u8ba1\u7b97\u9020\u6210\u7cbe\u5ea6\u635f\u5931\u7684\u6839\u6e90\u3002</p> <p>\u56e0\u6b64\uff0cIEEE 754 \u6807\u51c6\u5b9a\u4e49\u7684\u6d6e\u70b9\u6570\u53ea\u80fd\u6839\u636e\u7cbe\u5ea6\u820d\u5165\uff0c\u7136\u540e\u7528\u300c\u8fd1\u4f3c\u503c\u300d\u6765\u8868\u793a\u8be5\u4e8c\u8fdb\u5236\uff0c\u90a3\u4e48\u610f\u5473\u7740\u8ba1\u7b97\u673a\u5b58\u653e\u7684\u5c0f\u6570\u53ef\u80fd\u4e0d\u662f\u4e00\u4e2a\u771f\u5b9e\u503c\u3002</p> <p>0.1 + 0.2 \u5e76\u4e0d\u7b49\u4e8e\u5b8c\u6574\u7684 0.3\uff0c\u8fd9\u4e3b\u8981\u662f\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u5c0f\u6570\u65e0\u6cd5\u7528\u300c\u5b8c\u6574\u300d\u7684\u4e8c\u8fdb\u5236\u6765\u8868\u793a\uff0c\u53ea\u80fd\u6839\u636e\u7cbe\u5ea6\u820d\u5165\uff0c\u6240\u4ee5\u8ba1\u7b97\u673a\u91cc\u53ea\u80fd\u91c7\u7528\u8fd1\u4f3c\u6570\u7684\u65b9\u5f0f\u6765\u4fdd\u5b58\uff0c\u90a3\u4e24\u4e2a\u8fd1\u4f3c\u6570\u76f8\u52a0\uff0c\u5f97\u5230\u7684\u5fc5\u7136\u4e5f\u662f\u4e00\u4e2a\u8fd1\u4f3c\u6570\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/","title":"2.5 CPU \u662f\u5982\u4f55\u6267\u884c\u4efb\u52a1\u7684\uff1f","text":"<p>\u4f60\u6e05\u695a\u4e0b\u9762\u8fd9\u51e0\u4e2a\u95ee\u9898\u5417\uff1f</p> <ul> <li>\u6709\u4e86\u5185\u5b58\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981 CPU Cache\uff1f</li> <li>CPU \u662f\u600e\u4e48\u8bfb\u5199\u6570\u636e\u7684\uff1f</li> <li>\u5982\u4f55\u8ba9 CPU \u80fd\u8bfb\u53d6\u6570\u636e\u66f4\u5feb\u4e00\u4e9b\uff1f</li> <li>CPU \u4f2a\u5171\u4eab\u662f\u5982\u4f55\u53d1\u751f\u7684\uff1f\u53c8\u8be5\u5982\u4f55\u907f\u514d\uff1f</li> <li>CPU \u662f\u5982\u4f55\u8c03\u5ea6\u4efb\u52a1\u7684\uff1f\u5982\u679c\u4f60\u7684\u4efb\u52a1\u5bf9\u54cd\u5e94\u8981\u6c42\u5f88\u9ad8\uff0c\u4f60\u5e0c\u671b\u5b83\u603b\u662f\u80fd\u88ab\u5148\u8c03\u5ea6\uff0c\u8fd9\u8be5\u600e\u4e48\u529e\uff1f</li> <li>...</li> </ul> <p>\u8fd9\u7bc7\uff0c\u6211\u4eec\u5c31\u6765\u56de\u7b54\u8fd9\u4e9b\u95ee\u9898\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#cpu","title":"CPU \u5982\u4f55\u8bfb\u5199\u6570\u636e\u7684\uff1f","text":"<p>\u5148\u6765\u8ba4\u8bc6 CPU \u7684\u67b6\u6784\uff0c\u53ea\u6709\u7406\u89e3\u4e86 CPU \u7684 \u67b6\u6784\uff0c\u624d\u80fd\u66f4\u597d\u5730\u7406\u89e3 CPU \u662f\u5982\u4f55\u8bfb\u5199\u6570\u636e\u7684\uff0c\u5bf9\u4e8e\u73b0\u4ee3 CPU \u7684\u67b6\u6784\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e00\u4e2a CPU \u91cc\u901a\u5e38\u4f1a\u6709\u591a\u4e2a CPU \u6838\u5fc3\uff0c\u6bd4\u5982\u4e0a\u56fe\u4e2d\u7684 1 \u53f7\u548c 2 \u53f7 CPU \u6838\u5fc3\uff0c\u5e76\u4e14\u6bcf\u4e2a CPU \u6838\u5fc3\u90fd\u6709\u81ea\u5df1\u7684 L1 Cache \u548c L2 Cache\uff0c\u800c L1 Cache \u901a\u5e38\u5206\u4e3a dCache\uff08\u6570\u636e\u7f13\u5b58\uff09\u548c iCache\uff08\u6307\u4ee4\u7f13\u5b58\uff09\uff0cL3 Cache \u5219\u662f\u591a\u4e2a\u6838\u5fc3\u5171\u4eab\u7684\uff0c\u8fd9\u5c31\u662f CPU \u5178\u578b\u7684\u7f13\u5b58\u5c42\u6b21\u3002</p> <p>\u4e0a\u9762\u63d0\u5230\u7684\u90fd\u662f CPU \u5185\u90e8\u7684 Cache\uff0c\u653e\u773c\u5916\u90e8\u7684\u8bdd\uff0c\u8fd8\u4f1a\u6709\u5185\u5b58\u548c\u786c\u76d8\uff0c\u8fd9\u4e9b\u5b58\u50a8\u8bbe\u5907\u5171\u540c\u6784\u6210\u4e86\u91d1\u5b57\u5854\u5b58\u50a8\u5c42\u6b21\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u4e5f\u53ef\u4ee5\u770b\u5230\uff0c\u4ece\u4e0a\u5f80\u4e0b\uff0c\u5b58\u50a8\u8bbe\u5907\u7684\u5bb9\u91cf\u4f1a\u8d8a\u5927\uff0c\u800c\u8bbf\u95ee\u901f\u5ea6\u4f1a\u8d8a\u6162\u3002\u81f3\u4e8e\u6bcf\u4e2a\u5b58\u50a8\u8bbe\u5907\u7684\u8bbf\u95ee\u5ef6\u65f6\uff0c\u4f60\u53ef\u4ee5\u770b\u4e0b\u56fe\u7684\u8868\u683c\uff1a</p> <p></p> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0cCPU \u8bbf\u95ee L1 Cache \u901f\u5ea6\u6bd4\u8bbf\u95ee\u5185\u5b58\u5feb 100 \u500d\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48 CPU \u91cc\u4f1a\u6709 L1~L3 Cache \u7684\u539f\u56e0\uff0c\u76ee\u7684\u5c31\u662f\u628a Cache \u4f5c\u4e3a CPU \u4e0e\u5185\u5b58\u4e4b\u95f4\u7684\u7f13\u5b58\u5c42\uff0c\u4ee5\u51cf\u5c11\u5bf9\u5185\u5b58\u7684\u8bbf\u95ee\u9891\u7387\u3002</p> <p>CPU \u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u6570\u636e\u5230 Cache \u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u4e00\u4e2a\u5b57\u8282\u4e00\u4e2a\u5b57\u8282\u8bfb\u53d6\uff0c\u800c\u662f\u4e00\u5757\u4e00\u5757\u7684\u65b9\u5f0f\u6765\u8bfb\u53d6\u6570\u636e\u7684\uff0c\u8fd9\u4e00\u5757\u4e00\u5757\u7684\u6570\u636e\u88ab\u79f0\u4e3a CPU Cache  Line\uff08\u7f13\u5b58\u5757\uff09\uff0c\u6240\u4ee5 CPU Cache  Line \u662f CPU \u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\u5230 Cache \u7684\u5355\u4f4d\u3002</p> <p>\u81f3\u4e8e CPU Cache  Line \u5927\u5c0f\uff0c\u5728 Linux \u7cfb\u7edf\u53ef\u4ee5\u7528\u4e0b\u9762\u7684\u65b9\u5f0f\u67e5\u770b\u5230\uff0c\u4f60\u53ef\u4ee5\u770b\u6211\u670d\u52a1\u5668\u7684 L1 Cache Line \u5927\u5c0f\u662f 64 \u5b57\u8282\uff0c\u4e5f\u5c31\u610f\u5473\u7740 L1 Cache \u4e00\u6b21\u8f7d\u5165\u6570\u636e\u7684\u5927\u5c0f\u662f 64 \u5b57\u8282\u3002</p> <p></p> <p>\u90a3\u4e48\u5bf9\u6570\u7ec4\u7684\u52a0\u8f7d\uff0cCPU \u5c31\u4f1a\u52a0\u8f7d\u6570\u7ec4\u91cc\u9762\u8fde\u7eed\u7684\u591a\u4e2a\u6570\u636e\u5230 Cache \u91cc\uff0c\u56e0\u6b64\u6211\u4eec\u5e94\u8be5\u6309\u7167\u7269\u7406\u5185\u5b58\u5730\u5740\u5206\u5e03\u7684\u987a\u5e8f\u53bb\u8bbf\u95ee\u5143\u7d20\uff0c\u8fd9\u6837\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\u7684\u65f6\u5019\uff0cCache \u547d\u4e2d\u7387\u5c31\u4f1a\u5f88\u9ad8\uff0c\u4e8e\u662f\u5c31\u80fd\u51cf\u5c11\u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\u7684\u9891\u7387\uff0c\u4ece\u800c\u53ef\u63d0\u9ad8\u7a0b\u5e8f\u7684\u6027\u80fd\u3002</p> <p>\u4f46\u662f\uff0c\u5728\u6211\u4eec\u4e0d\u4f7f\u7528\u6570\u7ec4\uff0c\u800c\u662f\u4f7f\u7528\u5355\u72ec\u7684\u53d8\u91cf\u7684\u65f6\u5019\uff0c\u5219\u4f1a\u6709 Cache \u4f2a\u5171\u4eab\u7684\u95ee\u9898\uff0cCache \u4f2a\u5171\u4eab\u95ee\u9898\u4e0a\u662f\u4e00\u4e2a\u6027\u80fd\u6740\u624b\uff0c\u6211\u4eec\u5e94\u8be5\u8981\u89c4\u907f\u5b83\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u6765\u770b\u770b Cache \u4f2a\u5171\u4eab\u662f\u4ec0\u4e48\uff1f\u53c8\u5982\u4f55\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\uff1f</p> <p>\u73b0\u5728\u5047\u8bbe\u6709\u4e00\u4e2a\u53cc\u6838\u5fc3\u7684 CPU\uff0c\u8fd9\u4e24\u4e2a CPU \u6838\u5fc3\u5e76\u884c\u8fd0\u884c\u7740\u4e24\u4e2a\u4e0d\u540c\u7684\u7ebf\u7a0b\uff0c\u5b83\u4eec\u540c\u65f6\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u4e24\u4e2a\u4e0d\u540c\u7684\u6570\u636e\uff0c\u5206\u522b\u662f\u7c7b\u578b\u4e3a <code>long</code> \u7684\u53d8\u91cf A \u548c B\uff0c\u8fd9\u4e2a\u4e24\u4e2a\u6570\u636e\u7684\u5730\u5740\u5728\u7269\u7406\u5185\u5b58\u4e0a\u662f\u8fde\u7eed\u7684\uff0c\u5982\u679c Cahce Line \u7684\u5927\u5c0f\u662f 64 \u5b57\u8282\uff0c\u5e76\u4e14\u53d8\u91cf A \u5728 Cahce Line \u7684\u5f00\u5934\u4f4d\u7f6e\uff0c\u90a3\u4e48\u8fd9\u4e24\u4e2a\u6570\u636e\u662f\u4f4d\u4e8e\u540c\u4e00\u4e2a Cache Line \u4e2d\uff0c\u53c8\u56e0\u4e3a CPU Cache  Line \u662f CPU \u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\u5230 Cache \u7684\u5355\u4f4d\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u6570\u636e\u4f1a\u88ab\u540c\u65f6\u8bfb\u5165\u5230\u4e86\u4e24\u4e2a CPU \u6838\u5fc3\u4e2d\u5404\u81ea Cache \u4e2d\u3002</p> <p></p> <p>\u6211\u4eec\u6765\u601d\u8003\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u679c\u8fd9\u4e24\u4e2a\u4e0d\u540c\u6838\u5fc3\u7684\u7ebf\u7a0b\u5206\u522b\u4fee\u6539\u4e0d\u540c\u7684\u6570\u636e\uff0c\u6bd4\u5982 1 \u53f7 CPU \u6838\u5fc3\u7684\u7ebf\u7a0b\u53ea\u4fee\u6539\u4e86 \u53d8\u91cf A\uff0c\u6216 2 \u53f7 CPU \u6838\u5fc3\u7684\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u53ea\u4fee\u6539\u4e86\u53d8\u91cf B\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff1f</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#_1","title":"\u5206\u6790\u4f2a\u5171\u4eab\u7684\u95ee\u9898","text":"<p>\u73b0\u5728\u6211\u4eec\u7ed3\u5408\u4fdd\u8bc1\u591a\u6838\u7f13\u5b58\u4e00\u81f4\u7684 MESI \u534f\u8bae\uff0c\u6765\u8bf4\u660e\u8fd9\u4e00\u6574\u4e2a\u7684\u8fc7\u7a0b\uff0c\u5982\u679c\u4f60\u8fd8\u4e0d\u77e5\u9053 MESI \u534f\u8bae\uff0c\u4f60\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\u300c10 \u5f20\u56fe\u6253\u5f00 CPU \u7f13\u5b58\u4e00\u81f4\u6027\u7684\u5927\u95e8\u300d\u3002</p> <p>\u2460. \u6700\u5f00\u59cb\u53d8\u91cf A \u548c B \u90fd\u8fd8\u4e0d\u5728 Cache \u91cc\u9762\uff0c\u5047\u8bbe 1 \u53f7\u6838\u5fc3\u7ed1\u5b9a\u4e86\u7ebf\u7a0b A\uff0c2 \u53f7\u6838\u5fc3\u7ed1\u5b9a\u4e86\u7ebf\u7a0b B\uff0c\u7ebf\u7a0b A \u53ea\u4f1a\u8bfb\u5199\u53d8\u91cf A\uff0c\u7ebf\u7a0b B \u53ea\u4f1a\u8bfb\u5199\u53d8\u91cf B\u3002</p> <p></p> <p>\u2461. 1 \u53f7\u6838\u5fc3\u8bfb\u53d6\u53d8\u91cf A\uff0c\u7531\u4e8e CPU \u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\u5230 Cache \u7684\u5355\u4f4d\u662f Cache Line\uff0c\u4e5f\u6b63\u597d\u53d8\u91cf A \u548c \u53d8\u91cf B \u7684\u6570\u636e\u5f52\u5c5e\u4e8e\u540c\u4e00\u4e2a Cache Line\uff0c\u6240\u4ee5 A \u548c B \u7684\u6570\u636e\u90fd\u4f1a\u88ab\u52a0\u8f7d\u5230 Cache\uff0c\u5e76\u5c06\u6b64 Cache Line \u6807\u8bb0\u4e3a\u300c\u72ec\u5360\u300d\u72b6\u6001\u3002</p> <p></p> <p>\u2462.  \u63a5\u7740\uff0c2 \u53f7\u6838\u5fc3\u5f00\u59cb\u4ece\u5185\u5b58\u91cc\u8bfb\u53d6\u53d8\u91cf B\uff0c\u540c\u6837\u7684\u4e5f\u662f\u8bfb\u53d6 Cache Line \u5927\u5c0f\u7684\u6570\u636e\u5230 Cache \u4e2d\uff0c\u6b64 Cache Line \u4e2d\u7684\u6570\u636e\u4e5f\u5305\u542b\u4e86\u53d8\u91cf A \u548c \u53d8\u91cf B\uff0c\u6b64\u65f6 1 \u53f7\u548c 2 \u53f7\u6838\u5fc3\u7684 Cache Line \u72b6\u6001\u53d8\u4e3a\u300c\u5171\u4eab\u300d\u72b6\u6001\u3002</p> <p></p> <p>\u2463. 1 \u53f7\u6838\u5fc3\u9700\u8981\u4fee\u6539\u53d8\u91cf A\uff0c\u53d1\u73b0\u6b64 Cache Line \u7684\u72b6\u6001\u662f\u300c\u5171\u4eab\u300d\u72b6\u6001\uff0c\u6240\u4ee5\u5148\u9700\u8981\u901a\u8fc7\u603b\u7ebf\u53d1\u9001\u6d88\u606f\u7ed9 2 \u53f7\u6838\u5fc3\uff0c\u901a\u77e5 2 \u53f7\u6838\u5fc3\u628a Cache \u4e2d\u5bf9\u5e94\u7684 Cache Line \u6807\u8bb0\u4e3a\u300c\u5df2\u5931\u6548\u300d\u72b6\u6001\uff0c\u7136\u540e 1 \u53f7\u6838\u5fc3\u5bf9\u5e94\u7684 Cache Line \u72b6\u6001\u53d8\u6210\u300c\u5df2\u4fee\u6539\u300d\u72b6\u6001\uff0c\u5e76\u4e14\u4fee\u6539\u53d8\u91cf A\u3002</p> <p></p> <p>\u2464. \u4e4b\u540e\uff0c2 \u53f7\u6838\u5fc3\u9700\u8981\u4fee\u6539\u53d8\u91cf B\uff0c\u6b64\u65f6 2 \u53f7\u6838\u5fc3\u7684 Cache \u4e2d\u5bf9\u5e94\u7684 Cache Line \u662f\u5df2\u5931\u6548\u72b6\u6001\uff0c\u53e6\u5916\u7531\u4e8e 1 \u53f7\u6838\u5fc3\u7684 Cache \u4e5f\u6709\u6b64\u76f8\u540c\u7684\u6570\u636e\uff0c\u4e14\u72b6\u6001\u4e3a\u300c\u5df2\u4fee\u6539\u300d\u72b6\u6001\uff0c\u6240\u4ee5\u8981\u5148\u628a 1 \u53f7\u6838\u5fc3\u7684 Cache \u5bf9\u5e94\u7684 Cache Line \u5199\u56de\u5230\u5185\u5b58\uff0c\u7136\u540e 2 \u53f7\u6838\u5fc3\u518d\u4ece\u5185\u5b58\u8bfb\u53d6 Cache Line \u5927\u5c0f\u7684\u6570\u636e\u5230 Cache \u4e2d\uff0c\u6700\u540e\u628a\u53d8\u91cf B \u4fee\u6539\u5230 2 \u53f7\u6838\u5fc3\u7684 Cache \u4e2d\uff0c\u5e76\u5c06\u72b6\u6001\u6807\u8bb0\u4e3a\u300c\u5df2\u4fee\u6539\u300d\u72b6\u6001\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u53ef\u4ee5\u53d1\u73b0\u5982\u679c 1 \u53f7\u548c 2 \u53f7 CPU \u6838\u5fc3\u8fd9\u6837\u6301\u7eed\u4ea4\u66ff\u7684\u5206\u522b\u4fee\u6539\u53d8\u91cf A \u548c B\uff0c\u5c31\u4f1a\u91cd\u590d \u2463 \u548c \u2464 \u8fd9\u4e24\u4e2a\u6b65\u9aa4\uff0cCache \u5e76\u6ca1\u6709\u8d77\u5230\u7f13\u5b58\u7684\u6548\u679c\uff0c\u867d\u7136\u53d8\u91cf A \u548c B \u4e4b\u95f4\u5176\u5b9e\u5e76\u6ca1\u6709\u4efb\u4f55\u7684\u5173\u7cfb\uff0c\u4f46\u662f\u56e0\u4e3a\u540c\u65f6\u5f52\u5c5e\u4e8e\u4e00\u4e2a Cache Line\uff0c\u8fd9\u4e2a Cache Line \u4e2d\u7684\u4efb\u610f\u6570\u636e\u88ab\u4fee\u6539\u540e\uff0c\u90fd\u4f1a\u76f8\u4e92\u5f71\u54cd\uff0c\u4ece\u800c\u51fa\u73b0 \u2463 \u548c \u2464 \u8fd9\u4e24\u4e2a\u6b65\u9aa4\u3002</p> <p>\u56e0\u6b64\uff0c\u8fd9\u79cd\u56e0\u4e3a\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bfb\u5199\u540c\u4e00\u4e2a Cache Line \u7684\u4e0d\u540c\u53d8\u91cf\u65f6\uff0c\u800c\u5bfc\u81f4 CPU Cache \u5931\u6548\u7684\u73b0\u8c61\u79f0\u4e3a\u4f2a\u5171\u4eab\uff08False Sharing\uff09\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#_2","title":"\u907f\u514d\u4f2a\u5171\u4eab\u7684\u65b9\u6cd5","text":"<p>\u56e0\u6b64\uff0c\u5bf9\u4e8e\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u70ed\u70b9\u6570\u636e\uff0c\u5373\u7ecf\u5e38\u4f1a\u4fee\u6539\u7684\u6570\u636e\uff0c\u5e94\u8be5\u907f\u514d\u8fd9\u4e9b\u6570\u636e\u521a\u597d\u5728\u540c\u4e00\u4e2a Cache Line \u4e2d\uff0c\u5426\u5219\u5c31\u4f1a\u51fa\u73b0\u4e3a\u4f2a\u5171\u4eab\u7684\u95ee\u9898\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u770b\u770b\u5728\u5b9e\u9645\u9879\u76ee\u4e2d\u662f\u7528\u4ec0\u4e48\u65b9\u5f0f\u6765\u907f\u514d\u4f2a\u5171\u4eab\u7684\u95ee\u9898\u7684\u3002</p> <p>\u5728 Linux \u5185\u6838\u4e2d\u5b58\u5728 <code>__cacheline_aligned_in_smp</code> \u5b8f\u5b9a\u4e49\uff0c\u662f\u7528\u4e8e\u89e3\u51b3\u4f2a\u5171\u4eab\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684\u5b8f\u5b9a\u4e49\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\uff1a</p> <ul> <li>\u5982\u679c\u5728\u591a\u6838\uff08MP\uff09\u7cfb\u7edf\u91cc\uff0c\u8be5\u5b8f\u5b9a\u4e49\u662f <code>__cacheline_aligned</code>\uff0c\u4e5f\u5c31\u662f Cache Line \u7684\u5927\u5c0f\uff1b</li> <li>\u800c\u5982\u679c\u5728\u5355\u6838\u7cfb\u7edf\u91cc\uff0c\u8be5\u5b8f\u5b9a\u4e49\u662f\u7a7a\u7684\uff1b</li> </ul> <p>\u56e0\u6b64\uff0c\u9488\u5bf9\u5728\u540c\u4e00\u4e2a Cache Line \u4e2d\u7684\u5171\u4eab\u7684\u6570\u636e\uff0c\u5982\u679c\u5728\u591a\u6838\u4e4b\u95f4\u7ade\u4e89\u6bd4\u8f83\u4e25\u91cd\uff0c\u4e3a\u4e86\u9632\u6b62\u4f2a\u5171\u4eab\u73b0\u8c61\u7684\u53d1\u751f\uff0c\u53ef\u4ee5\u91c7\u7528\u4e0a\u9762\u7684\u5b8f\u5b9a\u4e49\u4f7f\u5f97\u53d8\u91cf\u5728 Cache Line \u91cc\u662f\u5bf9\u9f50\u7684\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6709\u4e0b\u9762\u8fd9\u4e2a\u7ed3\u6784\u4f53\uff1a</p> <p></p> <p>\u7ed3\u6784\u4f53\u91cc\u7684\u4e24\u4e2a\u6210\u5458\u53d8\u91cf a \u548c b \u5728\u7269\u7406\u5185\u5b58\u5730\u5740\u4e0a\u662f\u8fde\u7eed\u7684\uff0c\u4e8e\u662f\u5b83\u4eec\u53ef\u80fd\u4f1a\u4f4d\u4e8e\u540c\u4e00\u4e2a Cache Line \u4e2d\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u9632\u6b62\u524d\u9762\u63d0\u5230\u7684 Cache \u4f2a\u5171\u4eab\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u4ecb\u7ecd\u7684\u5b8f\u5b9a\u4e49\uff0c\u5c06 b \u7684\u5730\u5740\u8bbe\u7f6e\u4e3a Cache Line \u5bf9\u9f50\u5730\u5740\uff0c\u5982\u4e0b\uff1a</p> <p></p> <p>\u8fd9\u6837 a \u548c b \u53d8\u91cf\u5c31\u4e0d\u4f1a\u5728\u540c\u4e00\u4e2a Cache Line \u4e2d\u4e86\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u907f\u514d  Cache \u4f2a\u5171\u4eab\u5b9e\u9645\u4e0a\u662f\u7528\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u601d\u60f3\uff0c\u6d6a\u8d39\u4e00\u90e8\u5206 Cache \u7a7a\u95f4\uff0c\u4ece\u800c\u6362\u6765\u6027\u80fd\u7684\u63d0\u5347\u3002</p> <p>\u6211\u4eec\u518d\u6765\u770b\u4e00\u4e2a\u5e94\u7528\u5c42\u9762\u7684\u89c4\u907f\u65b9\u6848\uff0c\u6709\u4e00\u4e2a Java \u5e76\u53d1\u6846\u67b6 Disruptor \u4f7f\u7528\u300c\u5b57\u8282\u586b\u5145 + \u7ee7\u627f\u300d\u7684\u65b9\u5f0f\uff0c\u6765\u907f\u514d\u4f2a\u5171\u4eab\u7684\u95ee\u9898\u3002</p> <p>Disruptor \u4e2d\u6709\u4e00\u4e2a RingBuffer \u7c7b\u4f1a\u7ecf\u5e38\u88ab\u591a\u4e2a\u7ebf\u7a0b\u4f7f\u7528\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p></p> <p>\u4f60\u53ef\u80fd\u4f1a\u89c9\u5f97 RingBufferPad \u7c7b\u91cc 7 \u4e2a long \u7c7b\u578b\u7684\u540d\u5b57\u5f88\u5947\u602a\uff0c\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u5b83\u4eec\u867d\u7136\u770b\u8d77\u6765\u6beb\u65e0\u4f5c\u7528\uff0c\u4f46\u5374\u5bf9\u6027\u80fd\u7684\u63d0\u5347\u8d77\u5230\u4e86\u81f3\u5173\u91cd\u8981\u7684\u4f5c\u7528\u3002</p> <p>\u6211\u4eec\u90fd\u77e5\u9053\uff0cCPU Cache \u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\u7684\u5355\u4f4d\u662f CPU Cache  Line\uff0c\u4e00\u822c 64 \u4f4d CPU \u7684 CPU Cache  Line \u7684\u5927\u5c0f\u662f 64 \u4e2a\u5b57\u8282\uff0c\u4e00\u4e2a long \u7c7b\u578b\u7684\u6570\u636e\u662f 8 \u4e2a\u5b57\u8282\uff0c\u6240\u4ee5 CPU \u4e00\u4e0b\u4f1a\u52a0\u8f7d 8 \u4e2a long \u7c7b\u578b\u7684\u6570\u636e\u3002</p> <p>\u6839\u636e JVM \u5bf9\u8c61\u7ee7\u627f\u5173\u7cfb\u4e2d\u7236\u7c7b\u6210\u5458\u548c\u5b50\u7c7b\u6210\u5458\uff0c\u5185\u5b58\u5730\u5740\u662f\u8fde\u7eed\u6392\u5217\u5e03\u5c40\u7684\uff0c\u56e0\u6b64 RingBufferPad \u4e2d\u7684 7 \u4e2a long \u7c7b\u578b\u6570\u636e\u4f5c\u4e3a Cache Line \u524d\u7f6e\u586b\u5145\uff0c\u800c RingBuffer \u4e2d\u7684 7 \u4e2a long \u7c7b\u578b\u6570\u636e\u5219\u4f5c\u4e3a Cache Line \u540e\u7f6e\u586b\u5145\uff0c\u8fd9 14 \u4e2a long \u53d8\u91cf\u6ca1\u6709\u4efb\u4f55\u5b9e\u9645\u7528\u9014\uff0c\u66f4\u4e0d\u4f1a\u5bf9\u5b83\u4eec\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u3002</p> <p></p> <p>\u53e6\u5916\uff0cRingBufferFelds \u91cc\u9762\u5b9a\u4e49\u7684\u8fd9\u4e9b\u53d8\u91cf\u90fd\u662f <code>final</code> \u4fee\u9970\u7684\uff0c\u610f\u5473\u7740\u7b2c\u4e00\u6b21\u52a0\u8f7d\u4e4b\u540e\u4e0d\u4f1a\u518d\u4fee\u6539\uff0c\u53c8\u7531\u4e8e\u300c\u524d\u540e\u300d\u5404\u586b\u5145\u4e86 7 \u4e2a\u4e0d\u4f1a\u88ab\u8bfb\u5199\u7684 long \u7c7b\u578b\u53d8\u91cf\uff0c\u6240\u4ee5\u65e0\u8bba\u600e\u4e48\u52a0\u8f7d Cache Line\uff0c\u8fd9\u6574\u4e2a Cache Line \u91cc\u90fd\u6ca1\u6709\u4f1a\u53d1\u751f\u66f4\u65b0\u64cd\u4f5c\u7684\u6570\u636e\uff0c\u4e8e\u662f\u53ea\u8981\u6570\u636e\u88ab\u9891\u7e41\u5730\u8bfb\u53d6\u8bbf\u95ee\uff0c\u5c31\u81ea\u7136\u6ca1\u6709\u6570\u636e\u88ab\u6362\u51fa Cache \u7684\u53ef\u80fd\uff0c\u4e5f\u56e0\u6b64\u4e0d\u4f1a\u4ea7\u751f\u4f2a\u5171\u4eab\u7684\u95ee\u9898\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#cpu_1","title":"CPU \u5982\u4f55\u9009\u62e9\u7ebf\u7a0b\u7684\uff1f","text":"<p>\u4e86\u89e3\u5b8c CPU \u8bfb\u53d6\u6570\u636e\u7684\u8fc7\u7a0b\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b CPU \u662f\u6839\u636e\u4ec0\u4e48\u6765\u9009\u62e9\u5f53\u524d\u8981\u6267\u884c\u7684\u7ebf\u7a0b\u3002</p> <p>\u5728 Linux \u5185\u6838\u4e2d\uff0c\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u90fd\u662f\u7528 <code>task_struct</code> \u7ed3\u6784\u4f53\u8868\u793a\u7684\uff0c\u533a\u522b\u5728\u4e8e\u7ebf\u7a0b\u7684 task_struct \u7ed3\u6784\u4f53\u91cc\u90e8\u5206\u8d44\u6e90\u662f\u5171\u4eab\u4e86\u8fdb\u7a0b\u5df2\u521b\u5efa\u7684\u8d44\u6e90\uff0c\u6bd4\u5982\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u3001\u4ee3\u7801\u6bb5\u3001\u6587\u4ef6\u63cf\u8ff0\u7b26\u7b49\uff0c\u6240\u4ee5 Linux \u4e2d\u7684\u7ebf\u7a0b\u4e5f\u88ab\u79f0\u4e3a\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u7684 task_struct \u76f8\u6bd4\u8fdb\u7a0b\u7684 task_struct \u627f\u8f7d\u7684 \u8d44\u6e90\u6bd4\u8f83\u5c11\uff0c\u56e0\u6b64\u4ee5\u300c\u8f7b\u300d\u5f97\u540d\u3002 </p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u6ca1\u6709\u521b\u5efa\u7ebf\u7a0b\u7684\u8fdb\u7a0b\uff0c\u662f\u53ea\u6709\u5355\u4e2a\u6267\u884c\u6d41\uff0c\u5b83\u88ab\u79f0\u4e3a\u662f\u4e3b\u7ebf\u7a0b\u3002\u5982\u679c\u60f3\u8ba9\u8fdb\u7a0b\u5904\u7406\u66f4\u591a\u7684\u4e8b\u60c5\uff0c\u53ef\u4ee5\u521b\u5efa\u591a\u4e2a\u7ebf\u7a0b\u5206\u522b\u53bb\u5904\u7406\uff0c\u4f46\u4e0d\u7ba1\u600e\u4e48\u6837\uff0c\u5b83\u4eec\u5bf9\u5e94\u5230\u5185\u6838\u91cc\u90fd\u662f <code>task_struct</code>\u3002</p> <p></p> <p>\u6240\u4ee5\uff0cLinux \u5185\u6838\u91cc\u7684\u8c03\u5ea6\u5668\uff0c\u8c03\u5ea6\u7684\u5bf9\u8c61\u5c31\u662f <code>task_struct</code>\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u628a\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u7edf\u79f0\u4e3a\u4efb\u52a1\u3002</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u6839\u636e\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u4ee5\u53ca\u54cd\u5e94\u8981\u6c42\uff0c\u4e3b\u8981\u5206\u4e3a\u4e24\u79cd\uff0c\u5176\u4e2d\u4f18\u5148\u7ea7\u7684\u6570\u503c\u8d8a\u5c0f\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff1a</p> <ul> <li>\u5b9e\u65f6\u4efb\u52a1\uff0c\u5bf9\u7cfb\u7edf\u7684\u54cd\u5e94\u65f6\u95f4\u8981\u6c42\u5f88\u9ad8\uff0c\u4e5f\u5c31\u662f\u8981\u5c3d\u53ef\u80fd\u5feb\u7684\u6267\u884c\u5b9e\u65f6\u4efb\u52a1\uff0c\u4f18\u5148\u7ea7\u5728 <code>0~99</code> \u8303\u56f4\u5185\u7684\u5c31\u7b97\u5b9e\u65f6\u4efb\u52a1\uff1b</li> <li>\u666e\u901a\u4efb\u52a1\uff0c\u54cd\u5e94\u65f6\u95f4\u6ca1\u6709\u5f88\u9ad8\u7684\u8981\u6c42\uff0c\u4f18\u5148\u7ea7\u5728 <code>100~139</code> \u8303\u56f4\u5185\u90fd\u662f\u666e\u901a\u4efb\u52a1\u7ea7\u522b\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#_3","title":"\u8c03\u5ea6\u7c7b","text":"<p>\u7531\u4e8e\u4efb\u52a1\u6709\u4f18\u5148\u7ea7\u4e4b\u5206\uff0cLinux \u7cfb\u7edf\u4e3a\u4e86\u4fdd\u969c\u9ad8\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\u80fd\u591f\u5c3d\u53ef\u80fd\u65e9\u7684\u88ab\u6267\u884c\uff0c\u4e8e\u662f\u5206\u4e3a\u4e86\u8fd9\u51e0\u79cd\u8c03\u5ea6\u7c7b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>Deadline \u548c Realtime \u8fd9\u4e24\u4e2a\u8c03\u5ea6\u7c7b\uff0c\u90fd\u662f\u5e94\u7528\u4e8e\u5b9e\u65f6\u4efb\u52a1\u7684\uff0c\u8fd9\u4e24\u4e2a\u8c03\u5ea6\u7c7b\u7684\u8c03\u5ea6\u7b56\u7565\u5408\u8d77\u6765\u5171\u6709\u8fd9\u4e09\u79cd\uff0c\u5b83\u4eec\u7684\u4f5c\u7528\u5982\u4e0b\uff1a </p> <ul> <li>SCHED_DEADLINE\uff1a\u662f\u6309\u7167 deadline \u8fdb\u884c\u8c03\u5ea6\u7684\uff0c\u8ddd\u79bb\u5f53\u524d\u65f6\u95f4\u70b9\u6700\u8fd1\u7684 deadline \u7684\u4efb\u52a1\u4f1a\u88ab\u4f18\u5148\u8c03\u5ea6\uff1b</li> <li>SCHED_FIFO\uff1a\u5bf9\u4e8e\u76f8\u540c\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\uff0c\u6309\u5148\u6765\u5148\u670d\u52a1\u7684\u539f\u5219\uff0c\u4f46\u662f\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u4efb\u52a1\uff0c\u53ef\u4ee5\u62a2\u5360\u4f4e\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\uff0c\u4e5f\u5c31\u662f\u4f18\u5148\u7ea7\u9ad8\u7684\u53ef\u4ee5\u300c\u63d2\u961f\u300d\uff1b</li> <li>SCHED_RR\uff1a\u5bf9\u4e8e\u76f8\u540c\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\uff0c\u8f6e\u6d41\u7740\u8fd0\u884c\uff0c\u6bcf\u4e2a\u4efb\u52a1\u90fd\u6709\u4e00\u5b9a\u7684\u65f6\u95f4\u7247\uff0c\u5f53\u7528\u5b8c\u65f6\u95f4\u7247\u7684\u4efb\u52a1\u4f1a\u88ab\u653e\u5230\u961f\u5217\u5c3e\u90e8\uff0c\u4ee5\u4fdd\u8bc1\u76f8\u540c\u4f18\u5148\u7ea7\u4efb\u52a1\u7684\u516c\u5e73\u6027\uff0c\u4f46\u662f\u9ad8\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\u4f9d\u7136\u53ef\u4ee5\u62a2\u5360\u4f4e\u4f18\u5148\u7ea7\u7684\u4efb\u52a1\uff1b</li> </ul> <p>\u800c Fair \u8c03\u5ea6\u7c7b\u662f\u5e94\u7528\u4e8e\u666e\u901a\u4efb\u52a1\uff0c\u90fd\u662f\u7531 CFS \u8c03\u5ea6\u5668\u7ba1\u7406\u7684\uff0c\u5206\u4e3a\u4e24\u79cd\u8c03\u5ea6\u7b56\u7565\uff1a</p> <ul> <li>SCHED_NORMAL\uff1a\u666e\u901a\u4efb\u52a1\u4f7f\u7528\u7684\u8c03\u5ea6\u7b56\u7565\uff1b</li> <li>SCHED_BATCH\uff1a\u540e\u53f0\u4efb\u52a1\u7684\u8c03\u5ea6\u7b56\u7565\uff0c\u4e0d\u548c\u7ec8\u7aef\u8fdb\u884c\u4ea4\u4e92\uff0c\u56e0\u6b64\u5728\u4e0d\u5f71\u54cd\u5176\u4ed6\u9700\u8981\u4ea4\u4e92\u7684\u4efb\u52a1\uff0c\u53ef\u4ee5\u9002\u5f53\u964d\u4f4e\u5b83\u7684\u4f18\u5148\u7ea7\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#_4","title":"\u5b8c\u5168\u516c\u5e73\u8c03\u5ea6","text":"<p>\u6211\u4eec\u5e73\u65e5\u91cc\u9047\u5230\u7684\u57fa\u672c\u90fd\u662f\u666e\u901a\u4efb\u52a1\uff0c\u5bf9\u4e8e\u666e\u901a\u4efb\u52a1\u6765\u8bf4\uff0c\u516c\u5e73\u6027\u6700\u91cd\u8981\uff0c\u5728 Linux \u91cc\u9762\uff0c\u5b9e\u73b0\u4e86\u4e00\u4e2a\u57fa\u4e8e CFS \u7684\u8c03\u5ea6\u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\u5b8c\u5168\u516c\u5e73\u8c03\u5ea6\uff08Completely Fair Scheduling\uff09\u3002</p> <p>\u8fd9\u4e2a\u7b97\u6cd5\u7684\u7406\u5ff5\u662f\u60f3\u8ba9\u5206\u914d\u7ed9\u6bcf\u4e2a\u4efb\u52a1\u7684 CPU \u65f6\u95f4\u662f\u4e00\u6837\uff0c\u4e8e\u662f\u5b83\u4e3a\u6bcf\u4e2a\u4efb\u52a1\u5b89\u6392\u4e00\u4e2a\u865a\u62df\u8fd0\u884c\u65f6\u95f4 vruntime\uff0c\u5982\u679c\u4e00\u4e2a\u4efb\u52a1\u5728\u8fd0\u884c\uff0c\u5176\u8fd0\u884c\u7684\u8d8a\u4e45\uff0c\u8be5\u4efb\u52a1\u7684 vruntime \u81ea\u7136\u5c31\u4f1a\u8d8a\u5927\uff0c\u800c\u6ca1\u6709\u88ab\u8fd0\u884c\u7684\u4efb\u52a1\uff0cvruntime \u662f\u4e0d\u4f1a\u53d8\u5316\u7684\u3002</p> <p>\u90a3\u4e48\uff0c\u5728 CFS \u7b97\u6cd5\u8c03\u5ea6\u7684\u65f6\u5019\uff0c\u4f1a\u4f18\u5148\u9009\u62e9 vruntime \u5c11\u7684\u4efb\u52a1\uff0c\u4ee5\u4fdd\u8bc1\u6bcf\u4e2a\u4efb\u52a1\u7684\u516c\u5e73\u6027\u3002</p> <p>\u8fd9\u5c31\u597d\u6bd4\uff0c\u8ba9\u4f60\u628a\u4e00\u6876\u7684\u5976\u8336\u5e73\u5747\u5206\u5230 10 \u676f\u5976\u8336\u676f\u91cc\uff0c\u4f60\u770b\u7740\u54ea\u676f\u5976\u8336\u5c11\uff0c\u5c31\u591a\u5012\u4e00\u4e9b\uff1b\u54ea\u4e2a\u591a\u4e86\uff0c\u5c31\u5148\u4e0d\u5012\uff0c\u8fd9\u6837\u7ecf\u8fc7\u591a\u8f6e\u64cd\u4f5c\uff0c\u867d\u7136\u4e0d\u80fd\u4fdd\u8bc1\u6bcf\u676f\u5976\u8336\u5b8c\u5168\u4e00\u6837\u591a\uff0c\u4f46\u81f3\u5c11\u662f\u516c\u5e73\u7684\u3002</p> <p>\u5f53\u7136\uff0c\u4e0a\u9762\u63d0\u5230\u7684\u4f8b\u5b50\u6ca1\u6709\u8003\u8651\u5230\u4f18\u5148\u7ea7\u7684\u95ee\u9898\uff0c\u867d\u7136\u662f\u666e\u901a\u4efb\u52a1\uff0c\u4f46\u662f\u666e\u901a\u4efb\u52a1\u4e4b\u95f4\u8fd8\u662f\u6709\u4f18\u5148\u7ea7\u533a\u5206\u7684\uff0c\u6240\u4ee5\u5728\u8ba1\u7b97\u865a\u62df\u8fd0\u884c\u65f6\u95f4 vruntime \u8fd8\u8981\u8003\u8651\u666e\u901a\u4efb\u52a1\u7684\u6743\u91cd\u503c\uff0c\u6ce8\u610f\u6743\u91cd\u503c\u5e76\u4e0d\u662f\u4f18\u5148\u7ea7\u7684\u503c\uff0c\u5185\u6838\u4e2d\u4f1a\u6709\u4e00\u4e2a nice \u7ea7\u522b\u4e0e\u6743\u91cd\u503c\u7684\u8f6c\u6362\u8868\uff0cnice \u7ea7\u522b\u8d8a\u4f4e\u7684\u6743\u91cd\u503c\u5c31\u8d8a\u5927\uff0c\u81f3\u4e8e nice \u503c\u662f\u4ec0\u4e48\uff0c\u6211\u4eec\u540e\u9762\u4f1a\u63d0\u5230\u3002 \u4e8e\u662f\u5c31\u6709\u4e86\u4ee5\u4e0b\u8fd9\u4e2a\u516c\u5f0f\uff1a</p> <p></p> <p>\u4f60\u53ef\u4ee5\u4e0d\u7528\u7ba1 NICE_0_LOAD \u662f\u4ec0\u4e48\uff0c\u4f60\u5c31\u8ba4\u4e3a\u5b83\u662f\u4e00\u4e2a\u5e38\u91cf\uff0c\u90a3\u4e48\u5728\u300c\u540c\u6837\u7684\u5b9e\u9645\u8fd0\u884c\u65f6\u95f4\u300d\u91cc\uff0c\u9ad8\u6743\u91cd\u4efb\u52a1\u7684 vruntime \u6bd4\u4f4e\u6743\u91cd\u4efb\u52a1\u7684 vruntime \u5c11\uff0c\u4f60\u53ef\u80fd\u4f1a\u5947\u602a\u4e3a\u4ec0\u4e48\u662f\u5c11\u7684\uff1f\u4f60\u8fd8\u8bb0\u5f97 CFS \u8c03\u5ea6\u5417\uff0c\u5b83\u662f\u4f1a\u4f18\u5148\u9009\u62e9 vruntime \u5c11\u7684\u4efb\u52a1\u8fdb\u884c\u8c03\u5ea6\uff0c\u6240\u4ee5\u9ad8\u6743\u91cd\u7684\u4efb\u52a1\u5c31\u4f1a\u88ab\u4f18\u5148\u8c03\u5ea6\u4e86\uff0c\u4e8e\u662f\u9ad8\u6743\u91cd\u7684\u83b7\u5f97\u7684\u5b9e\u9645\u8fd0\u884c\u65f6\u95f4\u81ea\u7136\u5c31\u591a\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#cpu_2","title":"CPU \u8fd0\u884c\u961f\u5217","text":"<p>\u4e00\u4e2a\u7cfb\u7edf\u901a\u5e38\u90fd\u4f1a\u8fd0\u884c\u7740\u5f88\u591a\u4efb\u52a1\uff0c\u591a\u4efb\u52a1\u7684\u6570\u91cf\u57fa\u672c\u90fd\u662f\u8fdc\u8d85 CPU \u6838\u5fc3\u6570\u91cf\uff0c\u56e0\u6b64\u8fd9\u65f6\u5019\u5c31\u9700\u8981\u6392\u961f\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u6bcf\u4e2a CPU \u90fd\u6709\u81ea\u5df1\u7684\u8fd0\u884c\u961f\u5217\uff08Run Queue, rq\uff09\uff0c\u7528\u4e8e\u63cf\u8ff0\u5728\u6b64 CPU \u4e0a\u6240\u8fd0\u884c\u7684\u6240\u6709\u8fdb\u7a0b\uff0c\u5176\u961f\u5217\u5305\u542b\u4e09\u4e2a\u8fd0\u884c\u961f\u5217\uff0cDeadline \u8fd0\u884c\u961f\u5217 dl_rq\u3001\u5b9e\u65f6\u4efb\u52a1\u8fd0\u884c\u961f\u5217 rt_rq \u548c CFS \u8fd0\u884c\u961f\u5217 cfs_rq\uff0c\u5176\u4e2d cfs_rq \u662f\u7528\u7ea2\u9ed1\u6811\u6765\u63cf\u8ff0\u7684\uff0c\u6309 vruntime \u5927\u5c0f\u6765\u6392\u5e8f\u7684\uff0c\u6700\u5de6\u4fa7\u7684\u53f6\u5b50\u8282\u70b9\uff0c\u5c31\u662f\u4e0b\u6b21\u4f1a\u88ab\u8c03\u5ea6\u7684\u4efb\u52a1\u3002</p> <p>PS\uff1a\u4e0b\u56fe\u4e2d\u7684 csf_rq \u5e94\u8be5\u662f <code>cfs_rq</code>\uff0c\u7531\u4e8e\u627e\u4e0d\u5230\u539f\u56fe\u4e86\uff0c\u6211\u5077\u4e2a\u61d2\uff0c\u6211\u5c31\u4e0d\u91cd\u65b0\u753b\u4e86\uff0c\u563b\u563b\u3002</p> <p></p> <p>\u8fd9\u51e0\u79cd\u8c03\u5ea6\u7c7b\u662f\u6709\u4f18\u5148\u7ea7\u7684\uff0c\u4f18\u5148\u7ea7\u5982\u4e0b\uff1aDeadline &gt; Realtime &gt; Fair\uff0c\u8fd9\u610f\u5473\u7740 Linux \u9009\u62e9\u4e0b\u4e00\u4e2a\u4efb\u52a1\u6267\u884c\u7684\u65f6\u5019\uff0c\u4f1a\u6309\u7167\u6b64\u4f18\u5148\u7ea7\u987a\u5e8f\u8fdb\u884c\u9009\u62e9\uff0c\u4e5f\u5c31\u662f\u8bf4\u5148\u4ece <code>dl_rq</code> \u91cc\u9009\u62e9\u4efb\u52a1\uff0c\u7136\u540e\u4ece <code>rt_rq</code> \u91cc\u9009\u62e9\u4efb\u52a1\uff0c\u6700\u540e\u4ece <code>cfs_rq</code> \u91cc\u9009\u62e9\u4efb\u52a1\u3002\u56e0\u6b64\uff0c\u5b9e\u65f6\u4efb\u52a1\u603b\u662f\u4f1a\u6bd4\u666e\u901a\u4efb\u52a1\u4f18\u5148\u88ab\u6267\u884c\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#_5","title":"\u8c03\u6574\u4f18\u5148\u7ea7","text":"<p>\u5982\u679c\u6211\u4eec\u542f\u52a8\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u6ca1\u6709\u7279\u610f\u53bb\u6307\u5b9a\u4f18\u5148\u7ea7\u7684\u8bdd\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u90fd\u662f\u666e\u901a\u4efb\u52a1\uff0c\u666e\u901a\u4efb\u52a1\u7684\u8c03\u5ea6\u7c7b\u662f Fair\uff0c\u7531 CFS \u8c03\u5ea6\u5668\u6765\u8fdb\u884c\u7ba1\u7406\u3002CFS \u8c03\u5ea6\u5668\u7684\u76ee\u7684\u662f\u5b9e\u73b0\u4efb\u52a1\u8fd0\u884c\u7684\u516c\u5e73\u6027\uff0c\u4e5f\u5c31\u662f\u4fdd\u969c\u6bcf\u4e2a\u4efb\u52a1\u7684\u8fd0\u884c\u7684\u65f6\u95f4\u662f\u5dee\u4e0d\u591a\u7684\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u8ba9\u67d0\u4e2a\u666e\u901a\u4efb\u52a1\u6709\u66f4\u591a\u7684\u6267\u884c\u65f6\u95f4\uff0c\u53ef\u4ee5\u8c03\u6574\u4efb\u52a1\u7684 <code>nice</code> \u503c\uff0c\u4ece\u800c\u8ba9\u4f18\u5148\u7ea7\u9ad8\u4e00\u4e9b\u7684\u4efb\u52a1\u6267\u884c\u66f4\u591a\u65f6\u95f4\u3002nice \u7684\u503c\u80fd\u8bbe\u7f6e\u7684\u8303\u56f4\u662f <code>-20\uff5e19</code>\uff0c\u503c\u8d8a\u4f4e\uff0c\u8868\u660e\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0c\u56e0\u6b64 -20 \u662f\u6700\u9ad8\u4f18\u5148\u7ea7\uff0c19 \u5219\u662f\u6700\u4f4e\u4f18\u5148\u7ea7\uff0c\u9ed8\u8ba4\u4f18\u5148\u7ea7\u662f 0\u3002</p> <p>\u662f\u4e0d\u662f\u89c9\u5f97 nice \u503c\u7684\u8303\u56f4\u5f88\u8be1\u5f02\uff1f\u4e8b\u5b9e\u4e0a\uff0cnice \u503c\u5e76\u4e0d\u662f\u8868\u793a\u4f18\u5148\u7ea7\uff0c\u800c\u662f\u8868\u793a\u4f18\u5148\u7ea7\u7684\u4fee\u6b63\u6570\u503c\uff0c\u5b83\u4e0e\u4f18\u5148\u7ea7\uff08priority\uff09\u7684\u5173\u7cfb\u662f\u8fd9\u6837\u7684\uff1apriority(new) = priority(old) + nice\u3002\u5185\u6838\u4e2d\uff0cpriority \u7684\u8303\u56f4\u662f 0~139\uff0c\u503c\u8d8a\u4f4e\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\uff0c\u5176\u4e2d\u524d\u9762\u7684 0~99 \u8303\u56f4\u662f\u63d0\u4f9b\u7ed9\u5b9e\u65f6\u4efb\u52a1\u4f7f\u7528\u7684\uff0c\u800c nice \u503c\u662f\u6620\u5c04\u5230 100~139\uff0c\u8fd9\u4e2a\u8303\u56f4\u662f\u63d0\u4f9b\u7ed9\u666e\u901a\u4efb\u52a1\u7528\u7684\uff0c\u56e0\u6b64 nice \u503c\u8c03\u6574\u7684\u662f\u666e\u901a\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u3002</p> <p></p> <p>\u5728\u524d\u9762\u6211\u4eec\u63d0\u5230\u4e86\uff0c\u6743\u91cd\u503c\u4e0e nice \u503c\u662f\u6709\u5173\u7cfb\u7684\uff0cnice \u503c\u8d8a\u4f4e\uff0c\u6743\u91cd\u503c\u5c31\u8d8a\u5927\uff0c\u8ba1\u7b97\u51fa\u6765\u7684 vruntime \u5c31\u4f1a\u8d8a\u5c11\uff0c\u7531\u4e8e CFS \u7b97\u6cd5\u8c03\u5ea6\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4f18\u5148\u9009\u62e9 vruntime \u5c11\u7684\u4efb\u52a1\u8fdb\u884c\u6267\u884c\uff0c\u6240\u4ee5 nice \u503c\u8d8a\u4f4e\uff0c\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u5c31\u8d8a\u9ad8\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u542f\u52a8\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6307\u5b9a nice \u7684\u503c\uff0c\u6bd4\u5982\u5c06 mysqld \u4ee5 -3 \u4f18\u5148\u7ea7\uff1a</p> <p></p> <p>\u5982\u679c\u60f3\u4fee\u6539\u5df2\u7ecf\u8fd0\u884c\u4e2d\u7684\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 <code>renice</code> \u6765\u8c03\u6574 nice \u503c\uff1a</p> <p></p> <p>nice \u8c03\u6574\u7684\u662f\u666e\u901a\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\uff0c\u6240\u4ee5\u4e0d\u7ba1\u600e\u4e48\u7f29\u5c0f nice \u503c\uff0c\u4efb\u52a1\u6c38\u8fdc\u90fd\u662f\u666e\u901a\u4efb\u52a1\uff0c\u5982\u679c\u67d0\u4e9b\u4efb\u52a1\u8981\u6c42\u5b9e\u65f6\u6027\u6bd4\u8f83\u9ad8\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u8003\u8651\u6539\u53d8\u4efb\u52a1\u7684\u4f18\u5148\u7ea7\u4ee5\u53ca\u8c03\u5ea6\u7b56\u7565\uff0c\u4f7f\u5f97\u5b83\u53d8\u6210\u5b9e\u65f6\u4efb\u52a1\uff0c\u6bd4\u5982\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#_6","title":"\u603b\u7ed3","text":"<p>\u7406\u89e3 CPU \u662f\u5982\u4f55\u8bfb\u5199\u6570\u636e\u7684\u524d\u63d0\uff0c\u662f\u8981\u7406\u89e3 CPU \u7684\u67b6\u6784\uff0cCPU \u5185\u90e8\u7684\u591a\u4e2a Cache + \u5916\u90e8\u7684\u5185\u5b58\u548c\u78c1\u76d8\u90fd\u5c31\u6784\u6210\u4e86\u91d1\u5b57\u5854\u7684\u5b58\u50a8\u5668\u7ed3\u6784\uff0c\u5728\u8fd9\u4e2a\u91d1\u5b57\u5854\u4e2d\uff0c\u8d8a\u5f80\u4e0b\uff0c\u5b58\u50a8\u5668\u7684\u5bb9\u91cf\u5c31\u8d8a\u5927\uff0c\u4f46\u8bbf\u95ee\u901f\u5ea6\u5c31\u4f1a\u5c0f\u3002</p> <p>CPU \u8bfb\u5199\u6570\u636e\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u6309\u4e00\u4e2a\u4e00\u4e2a\u5b57\u8282\u4e3a\u5355\u4f4d\u6765\u8fdb\u884c\u8bfb\u5199\uff0c\u800c\u662f\u4ee5 CPU Cache  Line \u5927\u5c0f\u4e3a\u5355\u4f4d\uff0cCPU Cache  Line \u5927\u5c0f\u4e00\u822c\u662f 64 \u4e2a\u5b57\u8282\uff0c\u4e5f\u5c31\u610f\u5473\u7740 CPU \u8bfb\u5199\u6570\u636e\u7684\u65f6\u5019\uff0c\u6bcf\u4e00\u6b21\u90fd\u662f\u4ee5 64 \u5b57\u8282\u5927\u5c0f\u4e3a\u4e00\u5757\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u56e0\u6b64\uff0c\u5982\u679c\u6211\u4eec\u64cd\u4f5c\u7684\u6570\u636e\u662f\u6570\u7ec4\uff0c\u90a3\u4e48\u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\u7684\u65f6\u5019\uff0c\u6309\u5185\u5b58\u5206\u5e03\u7684\u5730\u5740\u987a\u5e8f\u8fdb\u884c\u8bbf\u95ee\uff0c\u8fd9\u6837\u80fd\u5145\u5206\u5229\u7528\u5230 Cache\uff0c\u7a0b\u5e8f\u7684\u6027\u80fd\u5f97\u5230\u63d0\u5347\u3002\u4f46\u5982\u679c\u64cd\u4f5c\u7684\u6570\u636e\u4e0d\u662f\u6570\u7ec4\uff0c\u800c\u662f\u666e\u901a\u7684\u53d8\u91cf\uff0c\u5e76\u5728\u591a\u6838 CPU \u7684\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u907f\u514d Cache Line \u4f2a\u5171\u4eab\u7684\u95ee\u9898\u3002</p> <p>\u6240\u8c13\u7684 Cache Line \u4f2a\u5171\u4eab\u95ee\u9898\u5c31\u662f\uff0c\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u8bfb\u5199\u540c\u4e00\u4e2a Cache Line \u7684\u4e0d\u540c\u53d8\u91cf\u65f6\uff0c\u800c\u5bfc\u81f4 CPU Cache \u5931\u6548\u7684\u73b0\u8c61\u3002\u90a3\u4e48\u5bf9\u4e8e\u591a\u4e2a\u7ebf\u7a0b\u5171\u4eab\u7684\u70ed\u70b9\u6570\u636e\uff0c\u5373\u7ecf\u5e38\u4f1a\u4fee\u6539\u7684\u6570\u636e\uff0c\u5e94\u8be5\u907f\u514d\u8fd9\u4e9b\u6570\u636e\u521a\u597d\u5728\u540c\u4e00\u4e2a Cache Line \u4e2d\uff0c\u907f\u514d\u7684\u65b9\u5f0f\u4e00\u822c\u6709 Cache Line \u5927\u5c0f\u5b57\u8282\u5bf9\u9f50\uff0c\u4ee5\u53ca\u5b57\u8282\u586b\u5145\u7b49\u65b9\u6cd5\u3002</p> <p>\u7cfb\u7edf\u4e2d\u9700\u8981\u8fd0\u884c\u7684\u591a\u7ebf\u7a0b\u6570\u4e00\u822c\u90fd\u4f1a\u5927\u4e8e CPU \u6838\u5fc3\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u7ebf\u7a0b\u6392\u961f\u7b49\u5f85 CPU\uff0c\u8fd9\u53ef\u80fd\u4f1a\u4ea7\u751f\u4e00\u5b9a\u7684\u5ef6\u65f6\uff0c\u5982\u679c\u6211\u4eec\u7684\u4efb\u52a1\u5bf9\u5ef6\u65f6\u5bb9\u5fcd\u5ea6\u5f88\u4f4e\uff0c\u5219\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u4eba\u4e3a\u624b\u6bb5\u5e72\u9884 Linux \u7684\u9ed8\u8ba4\u8c03\u5ea6\u7b56\u7565\u548c\u4f18\u5148\u7ea7\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_deal_task/#_7","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/","title":"2.1 CPU \u662f\u5982\u4f55\u6267\u884c\u7a0b\u5e8f\u7684\uff1f","text":"<p>\u4ee3\u7801\u5199\u4e86\u90a3\u4e48\u591a\uff0c\u4f60\u77e5\u9053 <code>a = 1 + 2</code> \u8fd9\u6761\u4ee3\u7801\u662f\u600e\u4e48\u88ab CPU \u6267\u884c\u7684\u5417\uff1f</p> <p>\u8f6f\u4ef6\u7528\u4e86\u90a3\u4e48\u591a\uff0c\u4f60\u77e5\u9053\u8f6f\u4ef6\u7684 32 \u4f4d\u548c 64 \u4f4d\u4e4b\u95f4\u7684\u533a\u522b\u5417\uff1f\u518d\u6765 32 \u4f4d\u7684\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u8fd0\u884c\u5728 64 \u4f4d\u7684\u7535\u8111\u4e0a\u5417\uff1f64 \u4f4d\u7684\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u8fd0\u884c\u5728 32 \u4f4d\u7684\u7535\u8111\u4e0a\u5417\uff1f\u5982\u679c\u4e0d\u884c\uff0c\u539f\u56e0\u662f\u4ec0\u4e48\uff1f</p> <p>CPU \u770b\u4e86\u90a3\u4e48\u591a\uff0c\u6211\u4eec\u90fd\u77e5\u9053 CPU \u901a\u5e38\u5206\u4e3a 32 \u4f4d\u548c 64 \u4f4d\uff0c\u4f60\u77e5\u9053 64 \u4f4d\u76f8\u6bd4 32 \u4f4d CPU \u7684\u4f18\u52bf\u5728\u54ea\u5417\uff1f64 \u4f4d CPU \u7684\u8ba1\u7b97\u6027\u80fd\u4e00\u5b9a\u6bd4 32 \u4f4d CPU \u9ad8\u5f88\u591a\u5417\uff1f</p> <p>\u4e0d\u77e5\u9053\u4e5f\u4e0d\u7528\u614c\u5f20\uff0c\u63a5\u4e0b\u6765\u5c31\u5faa\u5e8f\u6e10\u8fdb\u7684\u3001\u4e00\u5c42\u4e00\u5c42\u7684\u653b\u7834\u8fd9\u4e9b\u95ee\u9898\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_1","title":"\u56fe\u7075\u673a\u7684\u5de5\u4f5c\u65b9\u5f0f","text":"<p>\u8981\u60f3\u77e5\u9053\u7a0b\u5e8f\u6267\u884c\u7684\u539f\u7406\uff0c\u6211\u4eec\u53ef\u4ee5\u5148\u4ece\u300c\u56fe\u7075\u673a\u300d\u8bf4\u8d77\uff0c\u56fe\u7075\u7684\u57fa\u672c\u601d\u60f3\u662f\u7528\u673a\u5668\u6765\u6a21\u62df\u4eba\u4eec\u7528\u7eb8\u7b14\u8fdb\u884c\u6570\u5b66\u8fd0\u7b97\u7684\u8fc7\u7a0b\uff0c\u800c\u4e14\u8fd8\u5b9a\u4e49\u4e86\u8ba1\u7b97\u673a\u7531\u54ea\u4e9b\u90e8\u5206\u7ec4\u6210\uff0c\u7a0b\u5e8f\u53c8\u662f\u5982\u4f55\u6267\u884c\u7684\u3002</p> <p>\u56fe\u7075\u673a\u957f\u4ec0\u4e48\u6837\u5b50\u5462\uff1f\u4f60\u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\u56fe\u7075\u673a\u7684\u5b9e\u9645\u6837\u5b50\uff1a</p> <p></p> <p>\u56fe\u7075\u673a\u7684\u57fa\u672c\u7ec4\u6210\u5982\u4e0b\uff1a</p> <ul> <li>\u6709\u4e00\u6761\u300c\u7eb8\u5e26\u300d\uff0c\u7eb8\u5e26\u7531\u4e00\u4e2a\u4e2a\u8fde\u7eed\u7684\u683c\u5b50\u7ec4\u6210\uff0c\u6bcf\u4e2a\u683c\u5b50\u53ef\u4ee5\u5199\u5165\u5b57\u7b26\uff0c\u7eb8\u5e26\u5c31\u597d\u6bd4\u5185\u5b58\uff0c\u800c\u7eb8\u5e26\u4e0a\u7684\u683c\u5b50\u7684\u5b57\u7b26\u5c31\u597d\u6bd4\u5185\u5b58\u4e2d\u7684\u6570\u636e\u6216\u7a0b\u5e8f\uff1b</li> <li>\u6709\u4e00\u4e2a\u300c\u8bfb\u5199\u5934\u300d\uff0c\u8bfb\u5199\u5934\u53ef\u4ee5\u8bfb\u53d6\u7eb8\u5e26\u4e0a\u4efb\u610f\u683c\u5b50\u7684\u5b57\u7b26\uff0c\u4e5f\u53ef\u4ee5\u628a\u5b57\u7b26\u5199\u5165\u5230\u7eb8\u5e26\u7684\u683c\u5b50\uff1b</li> <li>\u8bfb\u5199\u5934\u4e0a\u6709\u4e00\u4e9b\u90e8\u4ef6\uff0c\u6bd4\u5982\u5b58\u50a8\u5355\u5143\u3001\u63a7\u5236\u5355\u5143\u4ee5\u53ca\u8fd0\u7b97\u5355\u5143\uff1a   1\u3001\u5b58\u50a8\u5355\u5143\u7528\u4e8e\u5b58\u653e\u6570\u636e\uff1b   2\u3001\u63a7\u5236\u5355\u5143\u7528\u4e8e\u8bc6\u522b\u5b57\u7b26\u662f\u6570\u636e\u8fd8\u662f\u6307\u4ee4\uff0c\u4ee5\u53ca\u63a7\u5236\u7a0b\u5e8f\u7684\u6d41\u7a0b\u7b49\uff1b   3\u3001\u8fd0\u7b97\u5355\u5143\u7528\u4e8e\u6267\u884c\u8fd0\u7b97\u6307\u4ee4\uff1b</li> </ul> <p>\u77e5\u9053\u4e86\u56fe\u7075\u673a\u7684\u7ec4\u6210\u540e\uff0c\u6211\u4eec\u4ee5\u7b80\u5355\u6570\u5b66\u8fd0\u7b97\u7684 <code>1 + 2</code> \u4f5c\u4e3a\u4f8b\u5b50\uff0c\u6765\u770b\u770b\u5b83\u662f\u600e\u4e48\u6267\u884c\u8fd9\u884c\u4ee3\u7801\u7684\u3002</p> <ul> <li>\u9996\u5148\uff0c\u7528\u8bfb\u5199\u5934\u628a\u300c1\u30012\u3001+\u300d\u8fd9 3 \u4e2a\u5b57\u7b26\u5206\u522b\u5199\u5165\u5230\u7eb8\u5e26\u4e0a\u7684 3 \u4e2a\u683c\u5b50\uff0c\u7136\u540e\u8bfb\u5199\u5934\u5148\u505c\u5728 1 \u5b57\u7b26\u5bf9\u5e94\u7684\u683c\u5b50\u4e0a\uff1b</li> </ul> <p></p> <ul> <li>\u63a5\u7740\uff0c\u8bfb\u5199\u5934\u8bfb\u5165 1 \u5230\u5b58\u50a8\u8bbe\u5907\u4e2d\uff0c\u8fd9\u4e2a\u5b58\u50a8\u8bbe\u5907\u79f0\u4e3a\u56fe\u7075\u673a\u7684\u72b6\u6001\uff1b</li> </ul> <p></p> <ul> <li>\u7136\u540e\u8bfb\u5199\u5934\u5411\u53f3\u79fb\u52a8\u4e00\u4e2a\u683c\uff0c\u7528\u540c\u6837\u7684\u65b9\u5f0f\u628a 2 \u8bfb\u5165\u5230\u56fe\u7075\u673a\u7684\u72b6\u6001\uff0c\u4e8e\u662f\u73b0\u5728\u56fe\u7075\u673a\u7684\u72b6\u6001\u4e2d\u5b58\u50a8\u7740\u4e24\u4e2a\u8fde\u7eed\u7684\u6570\u5b57\uff0c1 \u548c 2\uff1b</li> </ul> <p></p> <ul> <li>\u8bfb\u5199\u5934\u518d\u5f80\u53f3\u79fb\u52a8\u4e00\u4e2a\u683c\uff0c\u5c31\u4f1a\u78b0\u5230 + \u53f7\uff0c\u8bfb\u5199\u5934\u8bfb\u5230 + \u53f7\u540e\uff0c\u5c06 + \u53f7\u4f20\u8f93\u7ed9\u300c\u63a7\u5236\u5355\u5143\u300d\uff0c\u63a7\u5236\u5355\u5143\u53d1\u73b0\u662f\u4e00\u4e2a + \u53f7\u800c\u4e0d\u662f\u6570\u5b57\uff0c\u6240\u4ee5\u6ca1\u6709\u5b58\u5165\u5230\u72b6\u6001\u4e2d\uff0c\u56e0\u4e3a <code>+</code> \u53f7\u662f\u8fd0\u7b97\u7b26\u6307\u4ee4\uff0c\u4f5c\u7528\u662f\u52a0\u548c\u76ee\u524d\u7684\u72b6\u6001\uff0c\u4e8e\u662f\u901a\u77e5\u300c\u8fd0\u7b97\u5355\u5143\u300d\u5de5\u4f5c\u3002\u8fd0\u7b97\u5355\u5143\u6536\u5230\u8981\u52a0\u548c\u72b6\u6001\u4e2d\u7684\u503c\u7684\u901a\u77e5\u540e\uff0c\u5c31\u4f1a\u628a\u72b6\u6001\u4e2d\u7684 1 \u548c 2 \u8bfb\u5165\u5e76\u8ba1\u7b97\uff0c\u518d\u5c06\u8ba1\u7b97\u7684\u7ed3\u679c 3 \u5b58\u653e\u5230\u72b6\u6001\u4e2d\uff1b</li> </ul> <p></p> <ul> <li>\u6700\u540e\uff0c\u8fd0\u7b97\u5355\u5143\u5c06\u7ed3\u679c\u8fd4\u56de\u7ed9\u63a7\u5236\u5355\u5143\uff0c\u63a7\u5236\u5355\u5143\u5c06\u7ed3\u679c\u4f20\u8f93\u7ed9\u8bfb\u5199\u5934\uff0c\u8bfb\u5199\u5934\u5411\u53f3\u79fb\u52a8\uff0c\u628a\u7ed3\u679c 3 \u5199\u5165\u5230\u7eb8\u5e26\u7684\u683c\u5b50\u4e2d\uff1b</li> </ul> <p></p> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u56fe\u7075\u673a\u8ba1\u7b97 <code>1 + 2</code>  \u7684\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u53d1\u73b0\u56fe\u7075\u673a\u4e3b\u8981\u529f\u80fd\u5c31\u662f\u8bfb\u53d6\u7eb8\u5e26\u683c\u5b50\u4e2d\u7684\u5185\u5bb9\uff0c\u7136\u540e\u4ea4\u7ed9\u63a7\u5236\u5355\u5143\u8bc6\u522b\u5b57\u7b26\u662f\u6570\u5b57\u8fd8\u662f\u8fd0\u7b97\u7b26\u6307\u4ee4\uff0c\u5982\u679c\u662f\u6570\u5b57\u5219\u5b58\u5165\u5230\u56fe\u7075\u673a\u72b6\u6001\u4e2d\uff0c\u5982\u679c\u662f\u8fd0\u7b97\u7b26\uff0c\u5219\u901a\u77e5\u8fd0\u7b97\u7b26\u5355\u5143\u8bfb\u53d6\u72b6\u6001\u4e2d\u7684\u6570\u503c\u8fdb\u884c\u8ba1\u7b97\uff0c\u8ba1\u7b97\u7ed3\u679c\u6700\u7ec8\u8fd4\u56de\u7ed9\u8bfb\u5199\u5934\uff0c\u8bfb\u5199\u5934\u628a\u7ed3\u679c\u5199\u5165\u5230\u7eb8\u5e26\u7684\u683c\u5b50\u4e2d\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u56fe\u7075\u673a\u8fd9\u4e2a\u770b\u8d77\u6765\u5f88\u7b80\u5355\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u548c\u6211\u4eec\u4eca\u5929\u7684\u8ba1\u7b97\u673a\u662f\u57fa\u672c\u4e00\u6837\u7684\u3002\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4e00\u540c\u518d\u770b\u770b\u5f53\u4eca\u8ba1\u7b97\u673a\u7684\u7ec4\u6210\u4ee5\u53ca\u5de5\u4f5c\u65b9\u5f0f\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_2","title":"\u51af\u8bfa\u4f9d\u66fc\u6a21\u578b","text":"<p>\u5728 1945 \u5e74\u51af\u8bfa\u4f9d\u66fc\u548c\u5176\u4ed6\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6\u4eec\u63d0\u51fa\u4e86\u8ba1\u7b97\u673a\u5177\u4f53\u5b9e\u73b0\u7684\u62a5\u544a\uff0c\u5176\u9075\u5faa\u4e86\u56fe\u7075\u673a\u7684\u8bbe\u8ba1\uff0c\u800c\u4e14\u8fd8\u63d0\u51fa\u7528\u7535\u5b50\u5143\u4ef6\u6784\u9020\u8ba1\u7b97\u673a\uff0c\u5e76\u7ea6\u5b9a\u4e86\u7528\u4e8c\u8fdb\u5236\u8fdb\u884c\u8ba1\u7b97\u548c\u5b58\u50a8\u3002</p> <p>\u6700\u91cd\u8981\u7684\u662f\u5b9a\u4e49\u8ba1\u7b97\u673a\u57fa\u672c\u7ed3\u6784\u4e3a 5 \u4e2a\u90e8\u5206\uff0c\u5206\u522b\u662f\u8fd0\u7b97\u5668\u3001\u63a7\u5236\u5668\u3001\u5b58\u50a8\u5668\u3001\u8f93\u5165\u8bbe\u5907\u3001\u8f93\u51fa\u8bbe\u5907\uff0c\u8fd9 5 \u4e2a\u90e8\u5206\u4e5f\u88ab\u79f0\u4e3a\u51af\u8bfa\u4f9d\u66fc\u6a21\u578b\u3002</p> <p></p> <p>\u8fd0\u7b97\u5668\u3001\u63a7\u5236\u5668\u662f\u5728\u4e2d\u592e\u5904\u7406\u5668\u91cc\u7684\uff0c\u5b58\u50a8\u5668\u5c31\u6211\u4eec\u5e38\u89c1\u7684\u5185\u5b58\uff0c\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u5219\u662f\u8ba1\u7b97\u673a\u5916\u63a5\u7684\u8bbe\u5907\uff0c\u6bd4\u5982\u952e\u76d8\u5c31\u662f\u8f93\u5165\u8bbe\u5907\uff0c\u663e\u793a\u5668\u5c31\u662f\u8f93\u51fa\u8bbe\u5907\u3002</p> <p>\u5b58\u50a8\u5355\u5143\u548c\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u8981\u4e0e\u4e2d\u592e\u5904\u7406\u5668\u6253\u4ea4\u9053\u7684\u8bdd\uff0c\u79bb\u4e0d\u5f00\u603b\u7ebf\u3002\u6240\u4ee5\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u522b\u4ecb\u7ecd\u5185\u5b58\u3001\u4e2d\u592e\u5904\u7406\u5668\u3001\u603b\u7ebf\u3001\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_3","title":"\u5185\u5b58","text":"<p>\u6211\u4eec\u7684\u7a0b\u5e8f\u548c\u6570\u636e\u90fd\u662f\u5b58\u50a8\u5728\u5185\u5b58\uff0c\u5b58\u50a8\u7684\u533a\u57df\u662f\u7ebf\u6027\u7684\u3002</p> <p>\u5728\u8ba1\u7b97\u673a\u6570\u636e\u5b58\u50a8\u4e2d\uff0c\u5b58\u50a8\u6570\u636e\u7684\u57fa\u672c\u5355\u4f4d\u662f\u5b57\u8282\uff08byte\uff09\uff0c1 \u5b57\u8282\u7b49\u4e8e 8 \u4f4d\uff088 bit\uff09\u3002\u6bcf\u4e00\u4e2a\u5b57\u8282\u90fd\u5bf9\u5e94\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u3002</p> <p>\u5185\u5b58\u7684\u5730\u5740\u662f\u4ece 0 \u5f00\u59cb\u7f16\u53f7\u7684\uff0c\u7136\u540e\u81ea\u589e\u6392\u5217\uff0c\u6700\u540e\u4e00\u4e2a\u5730\u5740\u4e3a\u5185\u5b58\u603b\u5b57\u8282\u6570 - 1\uff0c\u8fd9\u79cd\u7ed3\u6784\u597d\u4f3c\u6211\u4eec\u7a0b\u5e8f\u91cc\u7684\u6570\u7ec4\uff0c\u6240\u4ee5\u5185\u5b58\u7684\u8bfb\u5199\u4efb\u4f55\u4e00\u4e2a\u6570\u636e\u7684\u901f\u5ea6\u90fd\u662f\u4e00\u6837\u7684\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_4","title":"\u4e2d\u592e\u5904\u7406\u5668","text":"<p>\u4e2d\u592e\u5904\u7406\u5668\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684 CPU\uff0c32 \u4f4d\u548c 64 \u4f4d CPU \u6700\u4e3b\u8981\u533a\u522b\u5728\u4e8e\u4e00\u6b21\u80fd\u8ba1\u7b97\u591a\u5c11\u5b57\u8282\u6570\u636e\uff1a</p> <ul> <li>32 \u4f4d CPU \u4e00\u6b21\u53ef\u4ee5\u8ba1\u7b97 4 \u4e2a\u5b57\u8282\uff1b</li> <li>64 \u4f4d CPU \u4e00\u6b21\u53ef\u4ee5\u8ba1\u7b97 8 \u4e2a\u5b57\u8282\uff1b</li> </ul> <p>\u8fd9\u91cc\u7684 32 \u4f4d\u548c 64 \u4f4d\uff0c\u901a\u5e38\u79f0\u4e3a CPU \u7684\u4f4d\u5bbd\u3002</p> <p>\u4e4b\u6240\u4ee5 CPU \u8981\u8fd9\u6837\u8bbe\u8ba1\uff0c\u662f\u4e3a\u4e86\u80fd\u8ba1\u7b97\u66f4\u5927\u7684\u6570\u503c\uff0c\u5982\u679c\u662f 8 \u4f4d\u7684 CPU\uff0c\u90a3\u4e48\u4e00\u6b21\u53ea\u80fd\u8ba1\u7b97 1 \u4e2a\u5b57\u8282 <code>0~255</code> \u8303\u56f4\u5185\u7684\u6570\u503c\uff0c\u8fd9\u6837\u5c31\u65e0\u6cd5\u4e00\u6b21\u5b8c\u6210\u8ba1\u7b97 <code>10000 * 500</code> \uff0c\u4e8e\u662f\u4e3a\u4e86\u80fd\u4e00\u6b21\u8ba1\u7b97\u5927\u6570\u7684\u8fd0\u7b97\uff0cCPU \u9700\u8981\u652f\u6301\u591a\u4e2a byte \u4e00\u8d77\u8ba1\u7b97\uff0c\u6240\u4ee5 CPU \u4f4d\u5bbd\u8d8a\u5927\uff0c\u53ef\u4ee5\u8ba1\u7b97\u7684\u6570\u503c\u5c31\u8d8a\u5927\uff0c\u6bd4\u5982\u8bf4 32 \u4f4d CPU \u80fd\u8ba1\u7b97\u7684\u6700\u5927\u6574\u6570\u662f <code>4294967295</code>\u3002</p> <p>CPU \u5185\u90e8\u8fd8\u6709\u4e00\u4e9b\u7ec4\u4ef6\uff0c\u5e38\u89c1\u7684\u6709\u5bc4\u5b58\u5668\u3001\u63a7\u5236\u5355\u5143\u548c\u903b\u8f91\u8fd0\u7b97\u5355\u5143\u7b49\u3002\u5176\u4e2d\uff0c\u63a7\u5236\u5355\u5143\u8d1f\u8d23\u63a7\u5236 CPU \u5de5\u4f5c\uff0c\u903b\u8f91\u8fd0\u7b97\u5355\u5143\u8d1f\u8d23\u8ba1\u7b97\uff0c\u800c\u5bc4\u5b58\u5668\u53ef\u4ee5\u5206\u4e3a\u591a\u79cd\u7c7b\uff0c\u6bcf\u79cd\u5bc4\u5b58\u5668\u7684\u529f\u80fd\u53c8\u4e0d\u5c3d\u76f8\u540c\u3002</p> <p>CPU \u4e2d\u7684\u5bc4\u5b58\u5668\u4e3b\u8981\u4f5c\u7528\u662f\u5b58\u50a8\u8ba1\u7b97\u65f6\u7684\u6570\u636e\uff0c\u4f60\u53ef\u80fd\u597d\u5947\u4e3a\u4ec0\u4e48\u6709\u4e86\u5185\u5b58\u8fd8\u9700\u8981\u5bc4\u5b58\u5668\uff1f\u539f\u56e0\u5f88\u7b80\u5355\uff0c\u56e0\u4e3a\u5185\u5b58\u79bb CPU \u592a\u8fdc\u4e86\uff0c\u800c\u5bc4\u5b58\u5668\u5c31\u5728 CPU \u91cc\uff0c\u8fd8\u7d27\u6328\u7740\u63a7\u5236\u5355\u5143\u548c\u903b\u8f91\u8fd0\u7b97\u5355\u5143\uff0c\u81ea\u7136\u8ba1\u7b97\u65f6\u901f\u5ea6\u4f1a\u5f88\u5feb\u3002</p> <p>\u5e38\u89c1\u7684\u5bc4\u5b58\u5668\u79cd\u7c7b\uff1a</p> <ul> <li>\u901a\u7528\u5bc4\u5b58\u5668\uff0c\u7528\u6765\u5b58\u653e\u9700\u8981\u8fdb\u884c\u8fd0\u7b97\u7684\u6570\u636e\uff0c\u6bd4\u5982\u9700\u8981\u8fdb\u884c\u52a0\u548c\u8fd0\u7b97\u7684\u4e24\u4e2a\u6570\u636e\u3002</li> <li>\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u7528\u6765\u5b58\u50a8 CPU \u8981\u6267\u884c\u4e0b\u4e00\u6761\u6307\u4ee4\u300c\u6240\u5728\u7684\u5185\u5b58\u5730\u5740\u300d\uff0c\u6ce8\u610f\u4e0d\u662f\u5b58\u50a8\u4e86\u4e0b\u4e00\u6761\u8981\u6267\u884c\u7684\u6307\u4ee4\uff0c\u6b64\u65f6\u6307\u4ee4\u8fd8\u5728\u5185\u5b58\u4e2d\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u53ea\u662f\u5b58\u50a8\u4e86\u4e0b\u4e00\u6761\u6307\u4ee4\u300c\u7684\u5730\u5740\u300d\u3002</li> <li>\u6307\u4ee4\u5bc4\u5b58\u5668\uff0c\u7528\u6765\u5b58\u653e\u5f53\u524d\u6b63\u5728\u6267\u884c\u7684\u6307\u4ee4\uff0c\u4e5f\u5c31\u662f\u6307\u4ee4\u672c\u8eab\uff0c\u6307\u4ee4\u88ab\u6267\u884c\u5b8c\u6210\u4e4b\u524d\uff0c\u6307\u4ee4\u90fd\u5b58\u50a8\u5728\u8fd9\u91cc\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_5","title":"\u603b\u7ebf","text":"<p>\u603b\u7ebf\u662f\u7528\u4e8e CPU \u548c\u5185\u5b58\u4ee5\u53ca\u5176\u4ed6\u8bbe\u5907\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u603b\u7ebf\u53ef\u5206\u4e3a 3 \u79cd\uff1a</p> <ul> <li>\u5730\u5740\u603b\u7ebf\uff0c\u7528\u4e8e\u6307\u5b9a CPU \u5c06\u8981\u64cd\u4f5c\u7684\u5185\u5b58\u5730\u5740\uff1b</li> <li>\u6570\u636e\u603b\u7ebf\uff0c\u7528\u4e8e\u8bfb\u5199\u5185\u5b58\u7684\u6570\u636e\uff1b</li> <li>\u63a7\u5236\u603b\u7ebf\uff0c\u7528\u4e8e\u53d1\u9001\u548c\u63a5\u6536\u4fe1\u53f7\uff0c\u6bd4\u5982\u4e2d\u65ad\u3001\u8bbe\u5907\u590d\u4f4d\u7b49\u4fe1\u53f7\uff0cCPU \u6536\u5230\u4fe1\u53f7\u540e\u81ea\u7136\u8fdb\u884c\u54cd\u5e94\uff0c\u8fd9\u65f6\u4e5f\u9700\u8981\u63a7\u5236\u603b\u7ebf\uff1b</li> </ul> <p>\u5f53 CPU \u8981\u8bfb\u5199\u5185\u5b58\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e00\u822c\u9700\u8981\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e09\u4e2a\u603b\u7ebf\uff1a</p> <ul> <li>\u9996\u5148\u8981\u901a\u8fc7\u300c\u5730\u5740\u603b\u7ebf\u300d\u6765\u6307\u5b9a\u5185\u5b58\u7684\u5730\u5740\uff1b</li> <li>\u7136\u540e\u901a\u8fc7\u300c\u63a7\u5236\u603b\u7ebf\u300d\u63a7\u5236\u662f\u8bfb\u6216\u5199\u547d\u4ee4\uff1b</li> <li>\u6700\u540e\u901a\u8fc7\u300c\u6570\u636e\u603b\u7ebf\u300d\u6765\u4f20\u8f93\u6570\u636e\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_6","title":"\u8f93\u5165\u3001\u8f93\u51fa\u8bbe\u5907","text":"<p>\u8f93\u5165\u8bbe\u5907\u5411\u8ba1\u7b97\u673a\u8f93\u5165\u6570\u636e\uff0c\u8ba1\u7b97\u673a\u7ecf\u8fc7\u8ba1\u7b97\u540e\uff0c\u628a\u6570\u636e\u8f93\u51fa\u7ed9\u8f93\u51fa\u8bbe\u5907\u3002\u671f\u95f4\uff0c\u5982\u679c\u8f93\u5165\u8bbe\u5907\u662f\u952e\u76d8\uff0c\u6309\u4e0b\u6309\u952e\u65f6\u662f\u9700\u8981\u548c CPU \u8fdb\u884c\u4ea4\u4e92\u7684\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u7528\u5230\u63a7\u5236\u603b\u7ebf\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#cpu","title":"\u7ebf\u8def\u4f4d\u5bbd\u4e0e CPU \u4f4d\u5bbd","text":"<p>\u6570\u636e\u662f\u5982\u4f55\u901a\u8fc7\u7ebf\u8def\u4f20\u8f93\u7684\u5462\uff1f\u5176\u5b9e\u662f\u901a\u8fc7\u64cd\u4f5c\u7535\u538b\uff0c\u4f4e\u7535\u538b\u8868\u793a 0\uff0c\u9ad8\u538b\u7535\u538b\u5219\u8868\u793a 1\u3002</p> <p>\u5982\u679c\u6784\u9020\u4e86\u9ad8\u4f4e\u9ad8\u8fd9\u6837\u7684\u4fe1\u53f7\uff0c\u5176\u5b9e\u5c31\u662f 101 \u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u5341\u8fdb\u5236\u5219\u8868\u793a 5\uff0c\u5982\u679c\u53ea\u6709\u4e00\u6761\u7ebf\u8def\uff0c\u5c31\u610f\u5473\u7740\u6bcf\u6b21\u53ea\u80fd\u4f20\u9012 1 bit \u7684\u6570\u636e\uff0c\u5373 0 \u6216 1\uff0c\u90a3\u4e48\u4f20\u8f93 101 \u8fd9\u4e2a\u6570\u636e\uff0c\u5c31\u9700\u8981 3 \u6b21\u624d\u80fd\u4f20\u8f93\u5b8c\u6210\uff0c\u8fd9\u6837\u7684\u6548\u7387\u975e\u5e38\u4f4e\u3002</p> <p>\u8fd9\u6837\u4e00\u4f4d\u4e00\u4f4d\u4f20\u8f93\u7684\u65b9\u5f0f\uff0c\u79f0\u4e3a\u4e32\u884c\uff0c\u4e0b\u4e00\u4e2a bit \u5fc5\u987b\u7b49\u5f85\u4e0a\u4e00\u4e2a bit \u4f20\u8f93\u5b8c\u6210\u624d\u80fd\u8fdb\u884c\u4f20\u8f93\u3002\u5f53\u7136\uff0c\u60f3\u4e00\u6b21\u591a\u4f20\u4e00\u4e9b\u6570\u636e\uff0c\u589e\u52a0\u7ebf\u8def\u5373\u53ef\uff0c\u8fd9\u65f6\u6570\u636e\u5c31\u53ef\u4ee5\u5e76\u884c\u4f20\u8f93\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u4f4e\u6548\u7387\u7684\u4e32\u884c\u4f20\u8f93\u7684\u65b9\u5f0f\uff0c\u7ebf\u8def\u7684\u4f4d\u5bbd\u6700\u597d\u4e00\u6b21\u5c31\u80fd\u8bbf\u95ee\u5230\u6240\u6709\u7684\u5185\u5b58\u5730\u5740\u3002 </p> <p>CPU \u8981\u60f3\u64cd\u4f5c\u7684\u5185\u5b58\u5730\u5740\u5c31\u9700\u8981\u5730\u5740\u603b\u7ebf\uff1a</p> <ul> <li>\u5982\u679c\u5730\u5740\u603b\u7ebf\u53ea\u6709 1 \u6761\uff0c\u90a3\u6bcf\u6b21\u53ea\u80fd\u8868\u793a\u300c0 \u6216 1\u300d\u8fd9\u4e24\u79cd\u5730\u5740\uff0c\u6240\u4ee5 CPU \u80fd\u64cd\u4f5c\u7684\u5185\u5b58\u5730\u5740\u6700\u5927\u6570\u91cf\u4e3a 2\uff082^1\uff09\u4e2a\uff08\u6ce8\u610f\uff0c\u4e0d\u8981\u7406\u89e3\u6210\u540c\u65f6\u80fd\u64cd\u4f5c 2 \u4e2a\u5185\u5b58\u5730\u5740\uff09\uff1b</li> <li>\u5982\u679c\u5730\u5740\u603b\u7ebf\u6709 2 \u6761\uff0c\u90a3\u4e48\u80fd\u8868\u793a 00\u300101\u300110\u300111 \u8fd9\u56db\u79cd\u5730\u5740\uff0c\u6240\u4ee5 CPU \u80fd\u64cd\u4f5c\u7684\u5185\u5b58\u5730\u5740\u6700\u5927\u6570\u91cf\u4e3a 4\uff082^2\uff09\u4e2a\u3002</li> </ul> <p>\u90a3\u4e48\uff0c\u60f3\u8981 CPU \u64cd\u4f5c 4G \u5927\u7684\u5185\u5b58\uff0c\u90a3\u4e48\u5c31\u9700\u8981 32 \u6761\u5730\u5740\u603b\u7ebf\uff0c\u56e0\u4e3a <code>2 ^ 32 = 4G</code>\u3002</p> <p>\u77e5\u9053\u4e86\u7ebf\u8def\u4f4d\u5bbd\u7684\u610f\u4e49\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b CPU \u4f4d\u5bbd\u3002</p> <p>CPU \u7684\u4f4d\u5bbd\u6700\u597d\u4e0d\u8981\u5c0f\u4e8e\u7ebf\u8def\u4f4d\u5bbd\uff0c\u6bd4\u5982 32 \u4f4d CPU \u63a7\u5236 40 \u4f4d\u5bbd\u7684\u5730\u5740\u603b\u7ebf\u548c\u6570\u636e\u603b\u7ebf\u7684\u8bdd\uff0c\u5de5\u4f5c\u8d77\u6765\u5c31\u4f1a\u975e\u5e38\u590d\u6742\u4e14\u9ebb\u70e6\uff0c\u6240\u4ee5 32 \u4f4d\u7684 CPU \u6700\u597d\u548c 32 \u4f4d\u5bbd\u7684\u7ebf\u8def\u642d\u914d\uff0c\u56e0\u4e3a 32 \u4f4d CPU \u4e00\u6b21\u6700\u591a\u53ea\u80fd\u64cd\u4f5c 32 \u4f4d\u5bbd\u7684\u5730\u5740\u603b\u7ebf\u548c\u6570\u636e\u603b\u7ebf\u3002</p> <p>\u5982\u679c\u7528 32 \u4f4d CPU \u53bb\u52a0\u548c\u4e24\u4e2a 64 \u4f4d\u5927\u5c0f\u7684\u6570\u5b57\uff0c\u5c31\u9700\u8981\u628a\u8fd9 2 \u4e2a 64 \u4f4d\u7684\u6570\u5b57\u5206\u6210 2 \u4e2a\u4f4e\u4f4d 32 \u4f4d\u6570\u5b57\u548c 2 \u4e2a\u9ad8\u4f4d 32 \u4f4d\u6570\u5b57\u6765\u8ba1\u7b97\uff0c\u5148\u52a0\u4e2a\u4e24\u4e2a\u4f4e\u4f4d\u7684 32 \u4f4d\u6570\u5b57\uff0c\u7b97\u51fa\u8fdb\u4f4d\uff0c\u7136\u540e\u52a0\u548c\u4e24\u4e2a\u9ad8\u4f4d\u7684 32 \u4f4d\u6570\u5b57\uff0c\u6700\u540e\u518d\u52a0\u4e0a\u8fdb\u4f4d\uff0c\u5c31\u80fd\u7b97\u51fa\u7ed3\u679c\u4e86\uff0c\u53ef\u4ee5\u53d1\u73b0 32 \u4f4d CPU \u5e76\u4e0d\u80fd\u4e00\u6b21\u6027\u8ba1\u7b97\u51fa\u52a0\u548c\u4e24\u4e2a 64 \u4f4d\u6570\u5b57\u7684\u7ed3\u679c\u3002</p> <p>\u5bf9\u4e8e 64 \u4f4d CPU \u5c31\u53ef\u4ee5\u4e00\u6b21\u6027\u7b97\u51fa\u52a0\u548c\u4e24\u4e2a 64 \u4f4d\u6570\u5b57\u7684\u7ed3\u679c\uff0c\u56e0\u4e3a 64 \u4f4d CPU \u53ef\u4ee5\u4e00\u6b21\u8bfb\u5165 64 \u4f4d\u7684\u6570\u5b57\uff0c\u5e76\u4e14 64 \u4f4d CPU \u5185\u90e8\u7684\u903b\u8f91\u8fd0\u7b97\u5355\u5143\u4e5f\u652f\u6301 64 \u4f4d\u6570\u5b57\u7684\u8ba1\u7b97\u3002</p> <p>\u4f46\u662f\u5e76\u4e0d\u4ee3\u8868 64 \u4f4d CPU \u6027\u80fd\u6bd4 32 \u4f4d CPU \u9ad8\u5f88\u591a\uff0c\u5f88\u5c11\u5e94\u7528\u9700\u8981\u7b97\u8d85\u8fc7 32 \u4f4d\u7684\u6570\u5b57\uff0c\u6240\u4ee5\u5982\u679c\u8ba1\u7b97\u7684\u6570\u989d\u4e0d\u8d85\u8fc7 32 \u4f4d\u6570\u5b57\u7684\u60c5\u51b5\u4e0b\uff0c32 \u4f4d\u548c 64 \u4f4d CPU \u4e4b\u95f4\u6ca1\u4ec0\u4e48\u533a\u522b\u7684\uff0c\u53ea\u6709\u5f53\u8ba1\u7b97\u8d85\u8fc7 32 \u4f4d\u6570\u5b57\u7684\u60c5\u51b5\u4e0b\uff0c64 \u4f4d\u7684\u4f18\u52bf\u624d\u80fd\u4f53\u73b0\u51fa\u6765\u3002</p> <p>\u53e6\u5916\uff0c32 \u4f4d CPU \u6700\u5927\u53ea\u80fd\u64cd\u4f5c 4GB \u5185\u5b58\uff0c\u5c31\u7b97\u4f60\u88c5\u4e86 8 GB \u5185\u5b58\u6761\uff0c\u4e5f\u6ca1\u7528\u3002\u800c 64 \u4f4d CPU \u5bfb\u5740\u8303\u56f4\u5219\u5f88\u5927\uff0c\u7406\u8bba\u6700\u5927\u7684\u5bfb\u5740\u7a7a\u95f4\u4e3a <code>2^64</code>\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_7","title":"\u7a0b\u5e8f\u6267\u884c\u7684\u57fa\u672c\u8fc7\u7a0b","text":"<p>\u5728\u524d\u9762\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u7a0b\u5e8f\u5728\u56fe\u7075\u673a\u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u6765\u770b\u770b\u7a0b\u5e8f\u5728\u51af\u8bfa\u4f9d\u66fc\u6a21\u578b\u4e0a\u662f\u600e\u4e48\u6267\u884c\u7684\u3002</p> <p>\u7a0b\u5e8f\u5b9e\u9645\u4e0a\u662f\u4e00\u6761\u4e00\u6761\u6307\u4ee4\uff0c\u6240\u4ee5\u7a0b\u5e8f\u7684\u8fd0\u884c\u8fc7\u7a0b\u5c31\u662f\u628a\u6bcf\u4e00\u6761\u6307\u4ee4\u4e00\u6b65\u4e00\u6b65\u7684\u6267\u884c\u8d77\u6765\uff0c\u8d1f\u8d23\u6267\u884c\u6307\u4ee4\u7684\u5c31\u662f CPU \u4e86\u3002</p> <p></p> <p>\u90a3 CPU \u6267\u884c\u7a0b\u5e8f\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\uff0cCPU \u8bfb\u53d6\u300c\u7a0b\u5e8f\u8ba1\u6570\u5668\u300d\u7684\u503c\uff0c\u8fd9\u4e2a\u503c\u662f\u6307\u4ee4\u7684\u5185\u5b58\u5730\u5740\uff0c\u7136\u540e CPU \u7684\u300c\u63a7\u5236\u5355\u5143\u300d\u64cd\u4f5c\u300c\u5730\u5740\u603b\u7ebf\u300d\u6307\u5b9a\u9700\u8981\u8bbf\u95ee\u7684\u5185\u5b58\u5730\u5740\uff0c\u63a5\u7740\u901a\u77e5\u5185\u5b58\u8bbe\u5907\u51c6\u5907\u6570\u636e\uff0c\u6570\u636e\u51c6\u5907\u597d\u540e\u901a\u8fc7\u300c\u6570\u636e\u603b\u7ebf\u300d\u5c06\u6307\u4ee4\u6570\u636e\u4f20\u7ed9 CPU\uff0cCPU \u6536\u5230\u5185\u5b58\u4f20\u6765\u7684\u6570\u636e\u540e\uff0c\u5c06\u8fd9\u4e2a\u6307\u4ee4\u6570\u636e\u5b58\u5165\u5230\u300c\u6307\u4ee4\u5bc4\u5b58\u5668\u300d\u3002</li> <li>\u7b2c\u4e8c\u6b65\uff0c\u300c\u7a0b\u5e8f\u8ba1\u6570\u5668\u300d\u7684\u503c\u81ea\u589e\uff0c\u8868\u793a\u6307\u5411\u4e0b\u4e00\u6761\u6307\u4ee4\u3002\u8fd9\u4e2a\u81ea\u589e\u7684\u5927\u5c0f\uff0c\u7531 CPU \u7684\u4f4d\u5bbd\u51b3\u5b9a\uff0c\u6bd4\u5982 32 \u4f4d\u7684 CPU\uff0c\u6307\u4ee4\u662f 4 \u4e2a\u5b57\u8282\uff0c\u9700\u8981 4 \u4e2a\u5185\u5b58\u5730\u5740\u5b58\u653e\uff0c\u56e0\u6b64\u300c\u7a0b\u5e8f\u8ba1\u6570\u5668\u300d\u7684\u503c\u4f1a\u81ea\u589e 4\uff1b</li> <li>\u7b2c\u4e09\u6b65\uff0cCPU \u5206\u6790\u300c\u6307\u4ee4\u5bc4\u5b58\u5668\u300d\u4e2d\u7684\u6307\u4ee4\uff0c\u786e\u5b9a\u6307\u4ee4\u7684\u7c7b\u578b\u548c\u53c2\u6570\uff0c\u5982\u679c\u662f\u8ba1\u7b97\u7c7b\u578b\u7684\u6307\u4ee4\uff0c\u5c31\u628a\u6307\u4ee4\u4ea4\u7ed9\u300c\u903b\u8f91\u8fd0\u7b97\u5355\u5143\u300d\u8fd0\u7b97\uff1b\u5982\u679c\u662f\u5b58\u50a8\u7c7b\u578b\u7684\u6307\u4ee4\uff0c\u5219\u4ea4\u7531\u300c\u63a7\u5236\u5355\u5143\u300d\u6267\u884c\uff1b</li> </ul> <p>\u7b80\u5355\u603b\u7ed3\u4e00\u4e0b\u5c31\u662f\uff0c\u4e00\u4e2a\u7a0b\u5e8f\u6267\u884c\u7684\u65f6\u5019\uff0cCPU \u4f1a\u6839\u636e\u7a0b\u5e8f\u8ba1\u6570\u5668\u91cc\u7684\u5185\u5b58\u5730\u5740\uff0c\u4ece\u5185\u5b58\u91cc\u9762\u628a\u9700\u8981\u6267\u884c\u7684\u6307\u4ee4\u8bfb\u53d6\u5230\u6307\u4ee4\u5bc4\u5b58\u5668\u91cc\u9762\u6267\u884c\uff0c\u7136\u540e\u6839\u636e\u6307\u4ee4\u957f\u5ea6\u81ea\u589e\uff0c\u5f00\u59cb\u987a\u5e8f\u8bfb\u53d6\u4e0b\u4e00\u6761\u6307\u4ee4\u3002</p> <p>CPU \u4ece\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bfb\u53d6\u6307\u4ee4\u3001\u5230\u6267\u884c\u3001\u518d\u5230\u4e0b\u4e00\u6761\u6307\u4ee4\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u4e0d\u65ad\u5faa\u73af\uff0c\u76f4\u5230\u7a0b\u5e8f\u6267\u884c\u7ed3\u675f\uff0c\u8fd9\u4e2a\u4e0d\u65ad\u5faa\u73af\u7684\u8fc7\u7a0b\u88ab\u79f0\u4e3a CPU \u7684\u6307\u4ee4\u5468\u671f\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#a-1-2","title":"a = 1 + 2 \u6267\u884c\u5177\u4f53\u8fc7\u7a0b","text":"<p>\u77e5\u9053\u4e86\u57fa\u672c\u7684\u7a0b\u5e8f\u6267\u884c\u8fc7\u7a0b\u540e\uff0c\u63a5\u4e0b\u6765\u7528 <code>a = 1 + 2</code> \u7684\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u8fdb\u4e00\u6b65\u5206\u6790\u8be5\u7a0b\u5e8f\u5728\u51af\u8bfa\u4f0a\u66fc\u6a21\u578b\u7684\u6267\u884c\u8fc7\u7a0b\u3002</p> <p>CPU \u662f\u4e0d\u8ba4\u8bc6 <code>a = 1 + 2</code> \u8fd9\u4e2a\u5b57\u7b26\u4e32\uff0c\u8fd9\u4e9b\u5b57\u7b26\u4e32\u53ea\u662f\u65b9\u4fbf\u6211\u4eec\u7a0b\u5e8f\u5458\u8ba4\u8bc6\uff0c\u8981\u60f3\u8fd9\u6bb5\u7a0b\u5e8f\u80fd\u8dd1\u8d77\u6765\uff0c\u8fd8\u9700\u8981\u628a\u6574\u4e2a\u7a0b\u5e8f\u7ffb\u8bd1\u6210\u6c47\u7f16\u8bed\u8a00\u7684\u7a0b\u5e8f\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u79f0\u4e3a\u7f16\u8bd1\u6210\u6c47\u7f16\u4ee3\u7801\u3002</p> <p>\u9488\u5bf9\u6c47\u7f16\u4ee3\u7801\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u7528\u6c47\u7f16\u5668\u7ffb\u8bd1\u6210\u673a\u5668\u7801\uff0c\u8fd9\u4e9b\u673a\u5668\u7801\u7531 0 \u548c 1 \u7ec4\u6210\u7684\u673a\u5668\u8bed\u8a00\uff0c\u8fd9\u4e00\u6761\u6761\u673a\u5668\u7801\uff0c\u5c31\u662f\u4e00\u6761\u6761\u7684\u8ba1\u7b97\u673a\u6307\u4ee4\uff0c\u8fd9\u4e2a\u624d\u662f CPU \u80fd\u591f\u771f\u6b63\u8ba4\u8bc6\u7684\u4e1c\u897f\u3002</p> <p>\u4e0b\u9762\u6765\u770b\u770b  <code>a = 1 + 2</code> \u5728 32 \u4f4d CPU \u7684\u6267\u884c\u8fc7\u7a0b\u3002</p> <p>\u7a0b\u5e8f\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\uff0c\u7f16\u8bd1\u5668\u901a\u8fc7\u5206\u6790\u4ee3\u7801\uff0c\u53d1\u73b0 1 \u548c 2 \u662f\u6570\u636e\uff0c\u4e8e\u662f\u7a0b\u5e8f\u8fd0\u884c\u65f6\uff0c\u5185\u5b58\u4f1a\u6709\u4e2a\u4e13\u95e8\u7684\u533a\u57df\u6765\u5b58\u653e\u8fd9\u4e9b\u6570\u636e\uff0c\u8fd9\u4e2a\u533a\u57df\u5c31\u662f\u300c\u6570\u636e\u6bb5\u300d\u3002\u5982\u4e0b\u56fe\uff0c\u6570\u636e 1 \u548c 2 \u7684\u533a\u57df\u4f4d\u7f6e\uff1a</p> <ul> <li>\u6570\u636e 1 \u88ab\u5b58\u653e\u5230 0x200 \u4f4d\u7f6e\uff1b</li> <li>\u6570\u636e 2 \u88ab\u5b58\u653e\u5230 0x204 \u4f4d\u7f6e\uff1b</li> </ul> <p>\u6ce8\u610f\uff0c\u6570\u636e\u548c\u6307\u4ee4\u662f\u5206\u5f00\u533a\u57df\u5b58\u653e\u7684\uff0c\u5b58\u653e\u6307\u4ee4\u533a\u57df\u7684\u5730\u65b9\u79f0\u4e3a\u300c\u6b63\u6587\u6bb5\u300d\u3002</p> <p></p> <p>\u7f16\u8bd1\u5668\u4f1a\u628a <code>a = 1 + 2</code> \u7ffb\u8bd1\u6210 4 \u6761\u6307\u4ee4\uff0c\u5b58\u653e\u5230\u6b63\u6587\u6bb5\u4e2d\u3002\u5982\u56fe\uff0c\u8fd9 4 \u6761\u6307\u4ee4\u88ab\u5b58\u653e\u5230\u4e86 0x100 ~ 0x10c \u7684\u533a\u57df\u4e2d\uff1a </p> <ul> <li>0x100 \u7684\u5185\u5bb9\u662f <code>load</code> \u6307\u4ee4\u5c06 0x200 \u5730\u5740\u4e2d\u7684\u6570\u636e 1 \u88c5\u5165\u5230\u5bc4\u5b58\u5668 <code>R0</code>\uff1b</li> <li>0x104 \u7684\u5185\u5bb9\u662f <code>load</code> \u6307\u4ee4\u5c06 0x204 \u5730\u5740\u4e2d\u7684\u6570\u636e 2 \u88c5\u5165\u5230\u5bc4\u5b58\u5668 <code>R1</code>\uff1b</li> <li>0x108 \u7684\u5185\u5bb9\u662f <code>add</code> \u6307\u4ee4\u5c06\u5bc4\u5b58\u5668 <code>R0</code> \u548c <code>R1</code> \u7684\u6570\u636e\u76f8\u52a0\uff0c\u5e76\u628a\u7ed3\u679c\u5b58\u653e\u5230\u5bc4\u5b58\u5668 <code>R2</code>\uff1b</li> <li>0x10c \u7684\u5185\u5bb9\u662f <code>store</code> \u6307\u4ee4\u5c06\u5bc4\u5b58\u5668 <code>R2</code> \u4e2d\u7684\u6570\u636e\u5b58\u56de\u6570\u636e\u6bb5\u4e2d\u7684 0x208 \u5730\u5740\u4e2d\uff0c\u8fd9\u4e2a\u5730\u5740\u4e5f\u5c31\u662f\u53d8\u91cf <code>a</code> \u5185\u5b58\u4e2d\u7684\u5730\u5740\uff1b</li> </ul> <p>\u7f16\u8bd1\u5b8c\u6210\u540e\uff0c\u5177\u4f53\u6267\u884c\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u4f1a\u88ab\u8bbe\u7f6e\u4e3a 0x100 \u5730\u5740\uff0c\u7136\u540e\u4f9d\u6b21\u6267\u884c\u8fd9 4 \u6761\u6307\u4ee4\u3002</p> <p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u7531\u4e8e\u662f\u5728 32 \u4f4d CPU \u6267\u884c\u7684\uff0c\u56e0\u6b64\u4e00\u6761\u6307\u4ee4\u662f\u5360 32 \u4f4d\u5927\u5c0f\uff0c\u6240\u4ee5\u4f60\u4f1a\u53d1\u73b0\u6bcf\u6761\u6307\u4ee4\u95f4\u9694 4 \u4e2a\u5b57\u8282\u3002</p> <p>\u800c\u6570\u636e\u7684\u5927\u5c0f\u662f\u6839\u636e\u4f60\u5728\u7a0b\u5e8f\u4e2d\u6307\u5b9a\u7684\u53d8\u91cf\u7c7b\u578b\uff0c\u6bd4\u5982 <code>int</code> \u7c7b\u578b\u7684\u6570\u636e\u5219\u5360 4 \u4e2a\u5b57\u8282\uff0c<code>char</code> \u7c7b\u578b\u7684\u6570\u636e\u5219\u5360 1 \u4e2a\u5b57\u8282\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_8","title":"\u6307\u4ee4","text":"<p>\u4e0a\u9762\u7684\u4f8b\u5b50\u4e2d\uff0c\u56fe\u4e2d\u6307\u4ee4\u7684\u5185\u5bb9\u6211\u5199\u7684\u662f\u7b80\u6613\u7684\u6c47\u7f16\u4ee3\u7801\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u65b9\u4fbf\u7406\u89e3\u6307\u4ee4\u7684\u5177\u4f53\u5185\u5bb9\uff0c\u4e8b\u5b9e\u4e0a\u6307\u4ee4\u7684\u5185\u5bb9\u662f\u4e00\u4e32\u4e8c\u8fdb\u5236\u6570\u5b57\u7684\u673a\u5668\u7801\uff0c\u6bcf\u6761\u6307\u4ee4\u90fd\u6709\u5bf9\u5e94\u7684\u673a\u5668\u7801\uff0cCPU \u901a\u8fc7\u89e3\u6790\u673a\u5668\u7801\u6765\u77e5\u9053\u6307\u4ee4\u7684\u5185\u5bb9\u3002</p> <p>\u4e0d\u540c\u7684 CPU \u6709\u4e0d\u540c\u7684\u6307\u4ee4\u96c6\uff0c\u4e5f\u5c31\u662f\u5bf9\u5e94\u7740\u4e0d\u540c\u7684\u6c47\u7f16\u8bed\u8a00\u548c\u4e0d\u540c\u7684\u673a\u5668\u7801\uff0c\u63a5\u4e0b\u6765\u9009\u7528\u6700\u7b80\u5355\u7684 MIPS \u6307\u96c6\uff0c\u6765\u770b\u770b\u673a\u5668\u7801\u662f\u5982\u4f55\u751f\u6210\u7684\uff0c\u8fd9\u6837\u4e5f\u80fd\u660e\u767d\u4e8c\u8fdb\u5236\u7684\u673a\u5668\u7801\u7684\u5177\u4f53\u542b\u4e49\u3002</p> <p>MIPS \u7684\u6307\u4ee4\u662f\u4e00\u4e2a 32 \u4f4d\u7684\u6574\u6570\uff0c\u9ad8 6 \u4f4d\u4ee3\u8868\u7740\u64cd\u4f5c\u7801\uff0c\u8868\u793a\u8fd9\u6761\u6307\u4ee4\u662f\u4e00\u6761\u4ec0\u4e48\u6837\u7684\u6307\u4ee4\uff0c\u5269\u4e0b\u7684 26 \u4f4d\u4e0d\u540c\u6307\u4ee4\u7c7b\u578b\u6240\u8868\u793a\u7684\u5185\u5bb9\u4e5f\u5c31\u4e0d\u76f8\u540c\uff0c\u4e3b\u8981\u6709\u4e09\u79cd\u7c7b\u578b R\u3001I \u548c J\u3002</p> <p></p> <p>\u4e00\u8d77\u5177\u4f53\u770b\u770b\u8fd9\u4e09\u79cd\u7c7b\u578b\u7684\u542b\u4e49\uff1a</p> <ul> <li>R \u6307\u4ee4\uff0c\u7528\u5728\u7b97\u672f\u548c\u903b\u8f91\u64cd\u4f5c\uff0c\u91cc\u9762\u6709\u8bfb\u53d6\u548c\u5199\u5165\u6570\u636e\u7684\u5bc4\u5b58\u5668\u5730\u5740\u3002\u5982\u679c\u662f\u903b\u8f91\u4f4d\u79fb\u64cd\u4f5c\uff0c\u540e\u9762\u8fd8\u6709\u4f4d\u79fb\u64cd\u4f5c\u7684\u300c\u4f4d\u79fb\u91cf\u300d\uff0c\u800c\u6700\u540e\u7684\u300c\u529f\u80fd\u7801\u300d\u5219\u662f\u518d\u524d\u9762\u7684\u64cd\u4f5c\u7801\u4e0d\u591f\u7684\u65f6\u5019\uff0c\u6269\u5c55\u64cd\u4f5c\u7801\u6765\u8868\u793a\u5bf9\u5e94\u7684\u5177\u4f53\u6307\u4ee4\u7684\uff1b</li> <li>I \u6307\u4ee4\uff0c\u7528\u5728\u6570\u636e\u4f20\u8f93\u3001\u6761\u4ef6\u5206\u652f\u7b49\u3002\u8fd9\u4e2a\u7c7b\u578b\u7684\u6307\u4ee4\uff0c\u5c31\u6ca1\u6709\u4e86\u4f4d\u79fb\u91cf\u548c\u529f\u80fd\u7801\uff0c\u4e5f\u6ca1\u6709\u4e86\u7b2c\u4e09\u4e2a\u5bc4\u5b58\u5668\uff0c\u800c\u662f\u628a\u8fd9\u4e09\u90e8\u5206\u76f4\u63a5\u5408\u5e76\u6210\u4e86\u4e00\u4e2a\u5730\u5740\u503c\u6216\u4e00\u4e2a\u5e38\u6570\uff1b</li> <li>J \u6307\u4ee4\uff0c\u7528\u5728\u8df3\u8f6c\uff0c\u9ad8 6 \u4f4d\u4e4b\u5916\u7684 26 \u4f4d\u90fd\u662f\u4e00\u4e2a\u8df3\u8f6c\u540e\u7684\u5730\u5740\uff1b</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u628a\u524d\u9762\u4f8b\u5b50\u7684\u8fd9\u6761\u6307\u4ee4\uff1a\u300c<code>add</code> \u6307\u4ee4\u5c06\u5bc4\u5b58\u5668 <code>R0</code> \u548c <code>R1</code> \u7684\u6570\u636e\u76f8\u52a0\uff0c\u5e76\u628a\u7ed3\u679c\u653e\u5165\u5230 <code>R2</code>\u300d\uff0c\u7ffb\u8bd1\u6210\u673a\u5668\u7801\u3002</p> <p></p> <p>\u52a0\u548c\u8fd0\u7b97 add \u6307\u4ee4\u662f\u5c5e\u4e8e R \u6307\u4ee4\u7c7b\u578b\uff1a</p> <ul> <li>add \u5bf9\u5e94\u7684 MIPS \u6307\u4ee4\u91cc\u64cd\u4f5c\u7801\u662f <code>000000</code>\uff0c\u4ee5\u53ca\u6700\u672b\u5c3e\u7684\u529f\u80fd\u7801\u662f <code>100000</code>\uff0c\u8fd9\u4e9b\u6570\u503c\u90fd\u662f\u56fa\u5b9a\u7684\uff0c\u67e5\u4e00\u4e0b MIPS \u6307\u4ee4\u96c6\u7684\u624b\u518c\u5c31\u80fd\u77e5\u9053\u7684\uff1b</li> <li>rs \u4ee3\u8868\u7b2c\u4e00\u4e2a\u5bc4\u5b58\u5668 R0 \u7684\u7f16\u53f7\uff0c\u5373 <code>00000</code>\uff1b</li> <li>rt \u4ee3\u8868\u7b2c\u4e8c\u4e2a\u5bc4\u5b58\u5668 R1 \u7684\u7f16\u53f7\uff0c\u5373 <code>00001</code>\uff1b</li> <li>rd \u4ee3\u8868\u76ee\u6807\u7684\u4e34\u65f6\u5bc4\u5b58\u5668 R2 \u7684\u7f16\u53f7\uff0c\u5373 <code>00010</code>\uff1b</li> <li>\u56e0\u4e3a\u4e0d\u662f\u4f4d\u79fb\u64cd\u4f5c\uff0c\u6240\u4ee5\u4f4d\u79fb\u91cf\u662f <code>00000</code></li> </ul> <p>\u628a\u4e0a\u9762\u8fd9\u4e9b\u6570\u5b57\u62fc\u5728\u4e00\u8d77\u5c31\u662f\u4e00\u6761 32 \u4f4d\u7684 MIPS \u52a0\u6cd5\u6307\u4ee4\u4e86\uff0c\u90a3\u4e48\u7528 16 \u8fdb\u5236\u8868\u793a\u7684\u673a\u5668\u7801\u5219\u662f <code>0x00011020</code>\u3002</p> <p>\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4f1a\u6784\u9020\u6307\u4ee4\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u505a\u6307\u4ee4\u7684\u7f16\u7801\u3002CPU \u6267\u884c\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u89e3\u6790\u6307\u4ee4\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53eb\u4f5c\u6307\u4ee4\u7684\u89e3\u7801\u3002</p> <p>\u73b0\u4ee3\u5927\u591a\u6570 CPU \u90fd\u4f7f\u7528\u6765\u6d41\u6c34\u7ebf\u7684\u65b9\u5f0f\u6765\u6267\u884c\u6307\u4ee4\uff0c\u6240\u8c13\u7684\u6d41\u6c34\u7ebf\u5c31\u662f\u628a\u4e00\u4e2a\u4efb\u52a1\u62c6\u5206\u6210\u591a\u4e2a\u5c0f\u4efb\u52a1\uff0c\u4e8e\u662f\u4e00\u6761\u6307\u4ee4\u901a\u5e38\u5206\u4e3a 4 \u4e2a\u9636\u6bb5\uff0c\u79f0\u4e3a 4 \u7ea7\u6d41\u6c34\u7ebf\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u56db\u4e2a\u9636\u6bb5\u7684\u5177\u4f53\u542b\u4e49\uff1a</p> <ol> <li>CPU \u901a\u8fc7\u7a0b\u5e8f\u8ba1\u6570\u5668\u8bfb\u53d6\u5bf9\u5e94\u5185\u5b58\u5730\u5740\u7684\u6307\u4ee4\uff0c\u8fd9\u4e2a\u90e8\u5206\u79f0\u4e3a Fetch\uff08\u53d6\u5f97\u6307\u4ee4\uff09\uff1b</li> <li>CPU \u5bf9\u6307\u4ee4\u8fdb\u884c\u89e3\u7801\uff0c\u8fd9\u4e2a\u90e8\u5206\u79f0\u4e3a Decode\uff08\u6307\u4ee4\u8bd1\u7801\uff09\uff1b</li> <li>CPU \u6267\u884c\u6307\u4ee4\uff0c\u8fd9\u4e2a\u90e8\u5206\u79f0\u4e3a Execution\uff08\u6267\u884c\u6307\u4ee4\uff09\uff1b</li> <li>CPU \u5c06\u8ba1\u7b97\u7ed3\u679c\u5b58\u56de\u5bc4\u5b58\u5668\u6216\u8005\u5c06\u5bc4\u5b58\u5668\u7684\u503c\u5b58\u5165\u5185\u5b58\uff0c\u8fd9\u4e2a\u90e8\u5206\u79f0\u4e3a Store\uff08\u6570\u636e\u56de\u5199\uff09\uff1b</li> </ol> <p>\u4e0a\u9762\u8fd9 4 \u4e2a\u9636\u6bb5\uff0c\u6211\u4eec\u79f0\u4e3a\u6307\u4ee4\u5468\u671f\uff08Instrution Cycle\uff09\uff0cCPU \u7684\u5de5\u4f5c\u5c31\u662f\u4e00\u4e2a\u5468\u671f\u63a5\u7740\u4e00\u4e2a\u5468\u671f\uff0c\u5468\u800c\u590d\u59cb\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u4e0d\u540c\u7684\u9636\u6bb5\u5176\u5b9e\u662f\u7531\u8ba1\u7b97\u673a\u4e2d\u7684\u4e0d\u540c\u7ec4\u4ef6\u5b8c\u6210\u7684\uff1a</p> <p></p> <ul> <li>\u53d6\u6307\u4ee4\u7684\u9636\u6bb5\uff0c\u6211\u4eec\u7684\u6307\u4ee4\u662f\u5b58\u653e\u5728\u5b58\u50a8\u5668\u91cc\u7684\uff0c\u5b9e\u9645\u4e0a\uff0c\u901a\u8fc7\u7a0b\u5e8f\u8ba1\u6570\u5668\u548c\u6307\u4ee4\u5bc4\u5b58\u5668\u53d6\u51fa\u6307\u4ee4\u7684\u8fc7\u7a0b\uff0c\u662f\u7531\u63a7\u5236\u5668\u64cd\u4f5c\u7684\uff1b</li> <li>\u6307\u4ee4\u7684\u8bd1\u7801\u8fc7\u7a0b\uff0c\u4e5f\u662f\u7531\u63a7\u5236\u5668\u8fdb\u884c\u7684\uff1b</li> <li>\u6307\u4ee4\u6267\u884c\u7684\u8fc7\u7a0b\uff0c\u65e0\u8bba\u662f\u8fdb\u884c\u7b97\u672f\u64cd\u4f5c\u3001\u903b\u8f91\u64cd\u4f5c\uff0c\u8fd8\u662f\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3001\u6761\u4ef6\u5206\u652f\u64cd\u4f5c\uff0c\u90fd\u662f\u7531\u7b97\u672f\u903b\u8f91\u5355\u5143\u64cd\u4f5c\u7684\uff0c\u4e5f\u5c31\u662f\u7531\u8fd0\u7b97\u5668\u5904\u7406\u7684\u3002\u4f46\u662f\u5982\u679c\u662f\u4e00\u4e2a\u7b80\u5355\u7684\u65e0\u6761\u4ef6\u5730\u5740\u8df3\u8f6c\uff0c\u5219\u662f\u76f4\u63a5\u5728\u63a7\u5236\u5668\u91cc\u9762\u5b8c\u6210\u7684\uff0c\u4e0d\u9700\u8981\u7528\u5230\u8fd0\u7b97\u5668\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_9","title":"\u6307\u4ee4\u7684\u7c7b\u578b","text":"<p>\u6307\u4ee4\u4ece\u529f\u80fd\u89d2\u5ea6\u5212\u5206\uff0c\u53ef\u4ee5\u5206\u4e3a 5 \u5927\u7c7b\uff1a</p> <ul> <li>\u6570\u636e\u4f20\u8f93\u7c7b\u578b\u7684\u6307\u4ee4\uff0c\u6bd4\u5982 <code>store/load</code> \u662f\u5bc4\u5b58\u5668\u4e0e\u5185\u5b58\u95f4\u6570\u636e\u4f20\u8f93\u7684\u6307\u4ee4\uff0c<code>mov</code> \u662f\u5c06\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u7684\u6570\u636e\u79fb\u52a8\u5230\u53e6\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u7684\u6307\u4ee4\uff1b</li> <li>\u8fd0\u7b97\u7c7b\u578b\u7684\u6307\u4ee4\uff0c\u6bd4\u5982\u52a0\u51cf\u4e58\u9664\u3001\u4f4d\u8fd0\u7b97\u3001\u6bd4\u8f83\u5927\u5c0f\u7b49\u7b49\uff0c\u5b83\u4eec\u6700\u591a\u53ea\u80fd\u5904\u7406\u4e24\u4e2a\u5bc4\u5b58\u5668\u4e2d\u7684\u6570\u636e\uff1b</li> <li>\u8df3\u8f6c\u7c7b\u578b\u7684\u6307\u4ee4\uff0c\u901a\u8fc7\u4fee\u6539\u7a0b\u5e8f\u8ba1\u6570\u5668\u7684\u503c\u6765\u8fbe\u5230\u8df3\u8f6c\u6267\u884c\u6307\u4ee4\u7684\u8fc7\u7a0b\uff0c\u6bd4\u5982\u7f16\u7a0b\u4e2d\u5e38\u89c1\u7684 <code>if-else</code>\u3001<code>switch-case</code>\u3001\u51fd\u6570\u8c03\u7528\u7b49\u3002</li> <li>\u4fe1\u53f7\u7c7b\u578b\u7684\u6307\u4ee4\uff0c\u6bd4\u5982\u53d1\u751f\u4e2d\u65ad\u7684\u6307\u4ee4 <code>trap</code>\uff1b</li> <li>\u95f2\u7f6e\u7c7b\u578b\u7684\u6307\u4ee4\uff0c\u6bd4\u5982\u6307\u4ee4 <code>nop</code>\uff0c\u6267\u884c\u540e CPU \u4f1a\u7a7a\u8f6c\u4e00\u4e2a\u5468\u671f\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_10","title":"\u6307\u4ee4\u7684\u6267\u884c\u901f\u5ea6","text":"<p>CPU \u7684\u786c\u4ef6\u53c2\u6570\u90fd\u4f1a\u6709 <code>GHz</code> \u8fd9\u4e2a\u53c2\u6570\uff0c\u6bd4\u5982\u4e00\u4e2a 1 GHz \u7684 CPU\uff0c\u6307\u7684\u662f\u65f6\u949f\u9891\u7387\u662f 1 G\uff0c\u4ee3\u8868\u7740 1 \u79d2\u4f1a\u4ea7\u751f 1G \u6b21\u6570\u7684\u8109\u51b2\u4fe1\u53f7\uff0c\u6bcf\u4e00\u6b21\u8109\u51b2\u4fe1\u53f7\u9ad8\u4f4e\u7535\u5e73\u7684\u8f6c\u6362\u5c31\u662f\u4e00\u4e2a\u5468\u671f\uff0c\u79f0\u4e3a\u65f6\u949f\u5468\u671f\u3002</p> <p>\u5bf9\u4e8e CPU \u6765\u8bf4\uff0c\u5728\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u5185\uff0cCPU \u4ec5\u80fd\u5b8c\u6210\u4e00\u4e2a\u6700\u57fa\u672c\u7684\u52a8\u4f5c\uff0c\u65f6\u949f\u9891\u7387\u8d8a\u9ad8\uff0c\u65f6\u949f\u5468\u671f\u5c31\u8d8a\u77ed\uff0c\u5de5\u4f5c\u901f\u5ea6\u4e5f\u5c31\u8d8a\u5feb\u3002</p> <p>\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u4e00\u5b9a\u80fd\u6267\u884c\u5b8c\u4e00\u6761\u6307\u4ee4\u5417\uff1f\u7b54\u6848\u662f\u4e0d\u4e00\u5b9a\u7684\uff0c\u5927\u591a\u6570\u6307\u4ee4\u4e0d\u80fd\u5728\u4e00\u4e2a\u65f6\u949f\u5468\u671f\u5b8c\u6210\uff0c\u901a\u5e38\u9700\u8981\u82e5\u5e72\u4e2a\u65f6\u949f\u5468\u671f\u3002\u4e0d\u540c\u7684\u6307\u4ee4\u9700\u8981\u7684\u65f6\u949f\u5468\u671f\u662f\u4e0d\u540c\u7684\uff0c\u52a0\u6cd5\u548c\u4e58\u6cd5\u90fd\u5bf9\u5e94\u7740\u4e00\u6761 CPU \u6307\u4ee4\uff0c\u4f46\u662f\u4e58\u6cd5\u9700\u8981\u7684\u65f6\u949f\u5468\u671f\u5c31\u8981\u6bd4\u52a0\u6cd5\u591a\u3002</p> <p>\u5982\u4f55\u8ba9\u7a0b\u5e8f\u8dd1\u7684\u66f4\u5feb\uff1f</p> <p>\u7a0b\u5e8f\u6267\u884c\u7684\u65f6\u5019\uff0c\u8017\u8d39\u7684 CPU \u65f6\u95f4\u5c11\u5c31\u8bf4\u660e\u7a0b\u5e8f\u662f\u5feb\u7684\uff0c\u5bf9\u4e8e\u7a0b\u5e8f\u7684 CPU \u6267\u884c\u65f6\u95f4\uff0c\u6211\u4eec\u53ef\u4ee5\u62c6\u89e3\u6210 CPU \u65f6\u949f\u5468\u671f\u6570\uff08CPU Cycles\uff09\u548c\u65f6\u949f\u5468\u671f\u65f6\u95f4\uff08Clock Cycle Time\uff09\u7684\u4e58\u79ef\u3002</p> <p></p> <p>\u65f6\u949f\u5468\u671f\u65f6\u95f4\u5c31\u662f\u6211\u4eec\u524d\u9762\u63d0\u53ca\u7684 CPU \u4e3b\u9891\uff0c\u4e3b\u9891\u8d8a\u9ad8\u8bf4\u660e CPU \u7684\u5de5\u4f5c\u901f\u5ea6\u5c31\u8d8a\u5feb\uff0c\u6bd4\u5982\u6211\u624b\u5934\u4e0a\u7684\u7535\u8111\u7684 CPU \u662f 2.4 GHz \u56db\u6838 Intel Core i5\uff0c\u8fd9\u91cc\u7684 2.4 GHz \u5c31\u662f\u7535\u8111\u7684\u4e3b\u9891\uff0c\u65f6\u949f\u5468\u671f\u65f6\u95f4\u5c31\u662f 1/2.4G\u3002</p> <p>\u8981\u60f3 CPU \u8dd1\u7684\u66f4\u5feb\uff0c\u81ea\u7136\u7f29\u77ed\u65f6\u949f\u5468\u671f\u65f6\u95f4\uff0c\u4e5f\u5c31\u662f\u63d0\u5347 CPU \u4e3b\u9891\uff0c\u4f46\u662f\u4eca\u975e\u5f7c\u65e5\uff0c\u6469\u5c14\u5b9a\u5f8b\u65e9\u5df2\u5931\u6548\uff0c\u5f53\u4eca\u7684 CPU \u4e3b\u9891\u5df2\u7ecf\u5f88\u96be\u518d\u505a\u5230\u7ffb\u500d\u7684\u6548\u679c\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u6362\u4e00\u4e2a\u66f4\u597d\u7684 CPU\uff0c\u8fd9\u4e2a\u4e5f\u662f\u6211\u4eec\u8f6f\u4ef6\u5de5\u7a0b\u5e08\u63a7\u5236\u4e0d\u4e86\u7684\u4e8b\u60c5\uff0c\u6211\u4eec\u5e94\u8be5\u628a\u76ee\u5149\u653e\u5230\u53e6\u5916\u4e00\u4e2a\u4e58\u6cd5\u56e0\u5b50 \u2014\u2014 CPU \u65f6\u949f\u5468\u671f\u6570\uff0c\u5982\u679c\u80fd\u51cf\u5c11\u7a0b\u5e8f\u6240\u9700\u7684 CPU \u65f6\u949f\u5468\u671f\u6570\u91cf\uff0c\u4e00\u6837\u4e5f\u662f\u80fd\u63d0\u5347\u7a0b\u5e8f\u7684\u6027\u80fd\u7684\u3002</p> <p>\u5bf9\u4e8e CPU \u65f6\u949f\u5468\u671f\u6570\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u62c6\u89e3\u6210\uff1a\u300c\u6307\u4ee4\u6570 x \u6bcf\u6761\u6307\u4ee4\u7684\u5e73\u5747\u65f6\u949f\u5468\u671f\u6570\uff08Cycles Per Instruction\uff0c\u7b80\u79f0 <code>CPI</code>\uff09\u300d\uff0c\u4e8e\u662f\u7a0b\u5e8f\u7684 CPU \u6267\u884c\u65f6\u95f4\u7684\u516c\u5f0f\u53ef\u53d8\u6210\u5982\u4e0b\uff1a</p> <p></p> <p>\u56e0\u6b64\uff0c\u8981\u60f3\u7a0b\u5e8f\u8dd1\u7684\u66f4\u5feb\uff0c\u4f18\u5316\u8fd9\u4e09\u8005\u5373\u53ef\uff1a</p> <ul> <li>\u6307\u4ee4\u6570\uff0c\u8868\u793a\u6267\u884c\u7a0b\u5e8f\u6240\u9700\u8981\u591a\u5c11\u6761\u6307\u4ee4\uff0c\u4ee5\u53ca\u54ea\u4e9b\u6307\u4ee4\u3002\u8fd9\u4e2a\u5c42\u9762\u662f\u57fa\u672c\u9760\u7f16\u8bd1\u5668\u6765\u4f18\u5316\uff0c\u6bd5\u7adf\u540c\u6837\u7684\u4ee3\u7801\uff0c\u5728\u4e0d\u540c\u7684\u7f16\u8bd1\u5668\uff0c\u7f16\u8bd1\u51fa\u6765\u7684\u8ba1\u7b97\u673a\u6307\u4ee4\u4f1a\u6709\u5404\u79cd\u4e0d\u540c\u7684\u8868\u793a\u65b9\u5f0f\u3002</li> <li>\u6bcf\u6761\u6307\u4ee4\u7684\u5e73\u5747\u65f6\u949f\u5468\u671f\u6570 CPI\uff0c\u8868\u793a\u4e00\u6761\u6307\u4ee4\u9700\u8981\u591a\u5c11\u4e2a\u65f6\u949f\u5468\u671f\u6570\uff0c\u73b0\u4ee3\u5927\u591a\u6570 CPU \u901a\u8fc7\u6d41\u6c34\u7ebf\u6280\u672f\uff08Pipeline\uff09\uff0c\u8ba9\u4e00\u6761\u6307\u4ee4\u9700\u8981\u7684 CPU \u65f6\u949f\u5468\u671f\u6570\u5c3d\u53ef\u80fd\u7684\u5c11\uff1b</li> <li>\u65f6\u949f\u5468\u671f\u65f6\u95f4\uff0c\u8868\u793a\u8ba1\u7b97\u673a\u4e3b\u9891\uff0c\u53d6\u51b3\u4e8e\u8ba1\u7b97\u673a\u786c\u4ef6\u3002\u6709\u7684 CPU \u652f\u6301\u8d85\u9891\u6280\u672f\uff0c\u6253\u5f00\u4e86\u8d85\u9891\u610f\u5473\u7740\u628a CPU \u5185\u90e8\u7684\u65f6\u949f\u7ed9\u8c03\u5feb\u4e86\uff0c\u4e8e\u662f CPU \u5de5\u4f5c\u901f\u5ea6\u5c31\u53d8\u5feb\u4e86\uff0c\u4f46\u662f\u4e5f\u662f\u6709\u4ee3\u4ef7\u7684\uff0cCPU \u8dd1\u7684\u8d8a\u5feb\uff0c\u6563\u70ed\u7684\u538b\u529b\u5c31\u4f1a\u8d8a\u5927\uff0cCPU \u4f1a\u5f88\u5bb9\u6613\u5d29\u6e83\u3002</li> </ul> <p>\u5f88\u591a\u5382\u5546\u4e3a\u4e86\u8dd1\u5206\u800c\u8dd1\u5206\uff0c\u57fa\u672c\u90fd\u662f\u5728\u8fd9\u4e09\u4e2a\u65b9\u9762\u5165\u624b\u7684\u54e6\uff0c\u7279\u522b\u662f\u8d85\u9891\u8fd9\u4e00\u5757\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_11","title":"\u603b\u7ed3","text":"<p>\u6700\u540e\u6211\u4eec\u518d\u6765\u56de\u7b54\u5f00\u5934\u7684\u95ee\u9898\u3002</p> <p>64 \u4f4d\u76f8\u6bd4 32 \u4f4d CPU \u7684\u4f18\u52bf\u5728\u54ea\u5417\uff1f64 \u4f4d CPU \u7684\u8ba1\u7b97\u6027\u80fd\u4e00\u5b9a\u6bd4 32 \u4f4d CPU \u9ad8\u5f88\u591a\u5417\uff1f</p> <p>64 \u4f4d\u76f8\u6bd4 32 \u4f4d CPU \u7684\u4f18\u52bf\u4e3b\u8981\u4f53\u73b0\u5728\u4e24\u4e2a\u65b9\u9762\uff1a</p> <ul> <li>64 \u4f4d CPU \u53ef\u4ee5\u4e00\u6b21\u8ba1\u7b97\u8d85\u8fc7 32 \u4f4d\u7684\u6570\u5b57\uff0c\u800c 32 \u4f4d CPU \u5982\u679c\u8981\u8ba1\u7b97\u8d85\u8fc7 32 \u4f4d\u7684\u6570\u5b57\uff0c\u8981\u5206\u591a\u6b65\u9aa4\u8fdb\u884c\u8ba1\u7b97\uff0c\u6548\u7387\u5c31\u6ca1\u90a3\u4e48\u9ad8\uff0c\u4f46\u662f\u5927\u90e8\u5206\u5e94\u7528\u7a0b\u5e8f\u5f88\u5c11\u4f1a\u8ba1\u7b97\u90a3\u4e48\u5927\u7684\u6570\u5b57\uff0c\u6240\u4ee5\u53ea\u6709\u8fd0\u7b97\u5927\u6570\u5b57\u7684\u65f6\u5019\uff0c64 \u4f4d CPU \u7684\u4f18\u52bf\u624d\u80fd\u4f53\u73b0\u51fa\u6765\uff0c\u5426\u5219\u548c 32 \u4f4d CPU \u7684\u8ba1\u7b97\u6027\u80fd\u76f8\u5dee\u4e0d\u5927\u3002</li> <li>64 \u4f4d CPU \u53ef\u4ee5\u5bfb\u5740\u66f4\u5927\u7684\u5185\u5b58\u7a7a\u95f4\uff0c32 \u4f4d CPU \u6700\u5927\u7684\u5bfb\u5740\u5730\u5740\u662f 4G\uff0c\u5373\u4f7f\u4f60\u52a0\u4e86 8G \u5927\u5c0f\u7684\u5185\u5b58\uff0c\u4e5f\u8fd8\u662f\u53ea\u80fd\u5bfb\u5740\u5230 4G\uff0c\u800c 64 \u4f4d CPU \u6700\u5927\u5bfb\u5740\u5730\u5740\u662f <code>2^64</code>\uff0c\u8fdc\u8d85\u4e8e 32 \u4f4d CPU \u6700\u5927\u5bfb\u5740\u5730\u5740\u7684 <code>2^32</code>\u3002</li> </ul> <p>\u4f60\u77e5\u9053\u8f6f\u4ef6\u7684 32 \u4f4d\u548c 64 \u4f4d\u4e4b\u95f4\u7684\u533a\u522b\u5417\uff1f\u518d\u6765 32 \u4f4d\u7684\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u8fd0\u884c\u5728 64 \u4f4d\u7684\u7535\u8111\u4e0a\u5417\uff1f64 \u4f4d\u7684\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u8fd0\u884c\u5728 32 \u4f4d\u7684\u7535\u8111\u4e0a\u5417\uff1f\u5982\u679c\u4e0d\u884c\uff0c\u539f\u56e0\u662f\u4ec0\u4e48\uff1f</p> <p>64 \u4f4d\u548c 32 \u4f4d\u8f6f\u4ef6\uff0c\u5b9e\u9645\u4e0a\u4ee3\u8868\u6307\u4ee4\u662f 64 \u4f4d\u8fd8\u662f 32 \u4f4d\u7684\uff1a</p> <ul> <li>\u5982\u679c 32 \u4f4d\u6307\u4ee4\u5728 64 \u4f4d\u673a\u5668\u4e0a\u6267\u884c\uff0c\u9700\u8981\u4e00\u5957\u517c\u5bb9\u673a\u5236\uff0c\u5c31\u53ef\u4ee5\u505a\u5230\u517c\u5bb9\u8fd0\u884c\u4e86\u3002\u4f46\u662f\u5982\u679c 64 \u4f4d\u6307\u4ee4\u5728 32 \u4f4d\u673a\u5668\u4e0a\u6267\u884c\uff0c\u5c31\u6bd4\u8f83\u56f0\u96be\u4e86\uff0c\u56e0\u4e3a 32 \u4f4d\u7684\u5bc4\u5b58\u5668\u5b58\u4e0d\u4e0b 64 \u4f4d\u7684\u6307\u4ee4\uff1b</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u5176\u5b9e\u4e5f\u662f\u4e00\u79cd\u7a0b\u5e8f\uff0c\u6211\u4eec\u4e5f\u4f1a\u770b\u5230\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5206\u6210 32 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u300164 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5176\u4ee3\u8868\u610f\u4e49\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7a0b\u5e8f\u7684\u6307\u4ee4\u662f\u591a\u5c11\u4f4d\uff0c\u6bd4\u5982 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6307\u4ee4\u4e5f\u5c31\u662f 64 \u4f4d\uff0c\u56e0\u6b64\u4e0d\u80fd\u88c5\u5728 32 \u4f4d\u673a\u5668\u4e0a\u3002</li> </ul> <p>\u603b\u4e4b\uff0c\u786c\u4ef6\u7684 64 \u4f4d\u548c 32 \u4f4d\u6307\u7684\u662f CPU \u7684\u4f4d\u5bbd\uff0c\u8f6f\u4ef6\u7684 64 \u4f4d\u548c 32 \u4f4d\u6307\u7684\u662f\u6307\u4ee4\u7684\u4f4d\u5bbd\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_cpu_run/#_12","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_to_make_cpu_run_faster/","title":"2.3 \u5982\u4f55\u5199\u51fa\u8ba9 CPU \u8dd1\u5f97\u66f4\u5feb\u7684\u4ee3\u7801\uff1f","text":"<p>\u4ee3\u7801\u90fd\u662f\u7531 CPU \u8dd1\u8d77\u6765\u7684\uff0c\u6211\u4eec\u4ee3\u7801\u5199\u7684\u597d\u4e0e\u574f\u5c31\u51b3\u5b9a\u4e86 CPU \u7684\u6267\u884c\u6548\u7387\uff0c\u7279\u522b\u662f\u5728\u7f16\u5199\u8ba1\u7b97\u5bc6\u96c6\u578b\u7684\u7a0b\u5e8f\uff0c\u66f4\u8981\u6ce8\u91cd CPU \u7684\u6267\u884c\u6548\u7387\uff0c\u5426\u5219\u5c06\u4f1a\u5927\u5927\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u3002</p> <p>CPU \u5185\u90e8\u5d4c\u5165\u4e86 CPU Cache\uff08\u9ad8\u901f\u7f13\u5b58\uff09\uff0c\u5b83\u7684\u5b58\u50a8\u5bb9\u91cf\u5f88\u5c0f\uff0c\u4f46\u662f\u79bb CPU \u6838\u5fc3\u5f88\u8fd1\uff0c\u6240\u4ee5\u7f13\u5b58\u7684\u8bfb\u5199\u901f\u5ea6\u662f\u6781\u5feb\u7684\uff0c\u90a3\u4e48\u5982\u679c CPU \u8fd0\u7b97\u65f6\uff0c\u76f4\u63a5\u4ece CPU Cache \u8bfb\u53d6\u6570\u636e\uff0c\u800c\u4e0d\u662f\u4ece\u5185\u5b58\u7684\u8bdd\uff0c\u8fd0\u7b97\u901f\u5ea6\u5c31\u4f1a\u5f88\u5feb\u3002</p> <p>\u4f46\u662f\uff0c\u5927\u591a\u6570\u4eba\u4e0d\u77e5\u9053 CPU Cache \u7684\u8fd0\u884c\u673a\u5236\uff0c\u4ee5\u81f3\u4e8e\u4e0d\u77e5\u9053\u5982\u4f55\u624d\u80fd\u591f\u5199\u51fa\u80fd\u591f\u914d\u5408 CPU Cache \u5de5\u4f5c\u673a\u5236\u7684\u4ee3\u7801\uff0c\u4e00\u65e6\u4f60\u638c\u63e1\u4e86\u5b83\uff0c\u4f60\u5199\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u5c31\u6709\u65b0\u7684\u4f18\u5316\u601d\u8def\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u5c31\u6765\u770b\u770b\uff0cCPU Cache \u5230\u5e95\u662f\u4ec0\u4e48\u6837\u7684\uff0c\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u5462\uff0c\u53c8\u8be5\u5982\u4f55\u5199\u51fa\u8ba9 CPU \u6267\u884c\u66f4\u5feb\u7684\u4ee3\u7801\u5462\uff1f</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_to_make_cpu_run_faster/#cpu-cache","title":"CPU Cache \u6709\u591a\u5feb\uff1f","text":"<p>\u4f60\u53ef\u80fd\u4f1a\u597d\u5947\u4e3a\u4ec0\u4e48\u6709\u4e86\u5185\u5b58\uff0c\u8fd8\u9700\u8981 CPU Cache\uff1f\u6839\u636e\u6469\u5c14\u5b9a\u5f8b\uff0cCPU \u7684\u8bbf\u95ee\u901f\u5ea6\u6bcf 18 \u4e2a\u6708\u5c31\u4f1a\u7ffb\u500d\uff0c\u76f8\u5f53\u4e8e\u6bcf\u5e74\u589e\u957f 60% \u5de6\u53f3\uff0c\u5185\u5b58\u7684\u901f\u5ea6\u5f53\u7136\u4e5f\u4f1a\u4e0d\u65ad\u589e\u957f\uff0c\u4f46\u662f\u589e\u957f\u7684\u901f\u5ea6\u8fdc\u5c0f\u4e8e CPU\uff0c\u5e73\u5747\u6bcf\u5e74\u53ea\u589e\u957f 7% \u5de6\u53f3\u3002\u4e8e\u662f\uff0cCPU \u4e0e\u5185\u5b58\u7684\u8bbf\u95ee\u6027\u80fd\u7684\u5dee\u8ddd\u4e0d\u65ad\u62c9\u5927\u3002</p> <p>\u5230\u73b0\u5728\uff0c\u4e00\u6b21\u5185\u5b58\u8bbf\u95ee\u6240\u9700\u65f6\u95f4\u662f <code>200~300</code> \u591a\u4e2a\u65f6\u949f\u5468\u671f\uff0c\u8fd9\u610f\u5473\u7740 CPU \u548c\u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u5df2\u7ecf\u76f8\u5dee <code>200~300</code> \u591a\u500d\u4e86\u3002</p> <p>\u4e3a\u4e86\u5f25\u8865 CPU \u4e0e\u5185\u5b58\u4e24\u8005\u4e4b\u95f4\u7684\u6027\u80fd\u5dee\u5f02\uff0c\u5c31\u5728 CPU \u5185\u90e8\u5f15\u5165\u4e86  CPU Cache\uff0c\u4e5f\u79f0\u9ad8\u901f\u7f13\u5b58\u3002</p> <p>CPU Cache \u901a\u5e38\u5206\u4e3a\u5927\u5c0f\u4e0d\u7b49\u7684\u4e09\u7ea7\u7f13\u5b58\uff0c\u5206\u522b\u662f L1 Cache\u3001L2 Cache \u548c L3 Cache\u3002</p> <p>\u7531\u4e8e CPU Cache \u6240\u4f7f\u7528\u7684\u6750\u6599\u662f SRAM\uff0c\u4ef7\u683c\u6bd4\u5185\u5b58\u4f7f\u7528\u7684 DRAM \u9ad8\u51fa\u5f88\u591a\uff0c\u5728\u5f53\u4eca\u6bcf\u751f\u4ea7 1 MB \u5927\u5c0f\u7684 CPU Cache \u9700\u8981 7 \u7f8e\u91d1\u7684\u6210\u672c\uff0c\u800c\u5185\u5b58\u53ea\u9700\u8981 0.015 \u7f8e\u91d1\u7684\u6210\u672c\uff0c\u6210\u672c\u65b9\u9762\u76f8\u5dee\u4e86 466 \u500d\uff0c\u6240\u4ee5 CPU Cache \u4e0d\u50cf\u5185\u5b58\u90a3\u6837\u52a8\u8f84\u4ee5 GB \u8ba1\u7b97\uff0c\u5b83\u7684\u5927\u5c0f\u662f\u4ee5 KB \u6216 MB \u6765\u8ba1\u7b97\u7684\u3002</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0b\u56fe\u7684\u65b9\u5f0f\u6765\u67e5\u770b\u5404\u7ea7 CPU Cache \u7684\u5927\u5c0f\uff0c\u6bd4\u5982\u6211\u8fd9\u624b\u4e0a\u8fd9\u53f0\u670d\u52a1\u5668\uff0c\u79bb CPU \u6838\u5fc3\u6700\u8fd1\u7684 L1 Cache \u662f 32KB\uff0c\u5176\u6b21\u662f L2 Cache \u662f 256KB\uff0c\u6700\u5927\u7684 L3 Cache \u5219\u662f 3MB\u3002</p> <p></p> <p>\u5176\u4e2d\uff0cL1 Cache \u901a\u5e38\u4f1a\u5206\u4e3a\u300c\u6570\u636e\u7f13\u5b58\u300d\u548c\u300c\u6307\u4ee4\u7f13\u5b58\u300d\uff0c\u8fd9\u610f\u5473\u7740\u6570\u636e\u548c\u6307\u4ee4\u5728 L1 Cache \u8fd9\u4e00\u5c42\u662f\u5206\u5f00\u7f13\u5b58\u7684\uff0c\u4e0a\u56fe\u4e2d\u7684 <code>index0</code> \u4e5f\u5c31\u662f\u6570\u636e\u7f13\u5b58\uff0c\u800c <code>index1</code> \u5219\u662f\u6307\u4ee4\u7f13\u5b58\uff0c\u5b83\u4e24\u7684\u5927\u5c0f\u901a\u5e38\u662f\u4e00\u6837\u7684\u3002</p> <p>\u53e6\u5916\uff0c\u4f60\u4e5f\u4f1a\u6ce8\u610f\u5230\uff0cL3 Cache \u6bd4 L1 Cache \u548c L2 Cache \u5927\u5f88\u591a\uff0c\u8fd9\u662f\u56e0\u4e3a L1 Cache \u548c L2 Cache \u90fd\u662f\u6bcf\u4e2a CPU \u6838\u5fc3\u72ec\u6709\u7684\uff0c\u800c L3 Cache \u662f\u591a\u4e2a CPU \u6838\u5fc3\u5171\u4eab\u7684\u3002</p> <p>\u7a0b\u5e8f\u6267\u884c\u65f6\uff0c\u4f1a\u5148\u5c06\u5185\u5b58\u4e2d\u7684\u6570\u636e\u52a0\u8f7d\u5230\u5171\u4eab\u7684 L3 Cache \u4e2d\uff0c\u518d\u52a0\u8f7d\u5230\u6bcf\u4e2a\u6838\u5fc3\u72ec\u6709\u7684 L2 Cache\uff0c\u6700\u540e\u8fdb\u5165\u5230\u6700\u5feb\u7684 L1 Cache\uff0c\u4e4b\u540e\u624d\u4f1a\u88ab CPU \u8bfb\u53d6\u3002\u5b83\u4eec\u4e4b\u95f4\u7684\u5c42\u7ea7\u5173\u7cfb\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8d8a\u9760\u8fd1 CPU \u6838\u5fc3\u7684\u7f13\u5b58\u5176\u8bbf\u95ee\u901f\u5ea6\u8d8a\u5feb\uff0cCPU \u8bbf\u95ee L1 Cache \u53ea\u9700\u8981 <code>2~4</code> \u4e2a\u65f6\u949f\u5468\u671f\uff0c\u8bbf\u95ee L2 Cache \u5927\u7ea6 <code>10~20</code> \u4e2a\u65f6\u949f\u5468\u671f\uff0c\u8bbf\u95ee L3 Cache \u5927\u7ea6 <code>20~60</code> \u4e2a\u65f6\u949f\u5468\u671f\uff0c\u800c\u8bbf\u95ee\u5185\u5b58\u901f\u5ea6\u5927\u6982\u5728 <code>200~300</code> \u4e2a \u65f6\u949f\u5468\u671f\u4e4b\u95f4\u3002\u5982\u4e0b\u8868\u683c\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0cCPU \u4ece L1 Cache \u8bfb\u53d6\u6570\u636e\u7684\u901f\u5ea6\uff0c\u76f8\u6bd4\u4ece\u5185\u5b58\u8bfb\u53d6\u7684\u901f\u5ea6\uff0c\u4f1a\u5feb <code>100</code> \u591a\u500d\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_to_make_cpu_run_faster/#cpu-cache_1","title":"CPU Cache \u7684\u6570\u636e\u7ed3\u6784\u548c\u8bfb\u53d6\u8fc7\u7a0b\u662f\u4ec0\u4e48\u6837\u7684\uff1f","text":"<p>\u6211\u4eec\u5148\u7b80\u5355\u4e86\u89e3\u4e0b CPU Cache \u7684\u7ed3\u6784\uff0cCPU Cache \u662f\u7531\u5f88\u591a\u4e2a Cache Line \u7ec4\u6210\u7684\uff0cCache Line \u662f CPU \u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u800c Cache Line \u662f\u7531\u5404\u79cd\u6807\u5fd7\uff08Tag\uff09+ \u6570\u636e\u5757\uff08Data Block\uff09\u7ec4\u6210\uff0c\u4f60\u53ef\u4ee5\u5728\u4e0b\u56fe\u6e05\u6670\u7684\u770b\u5230\uff1a</p> <p></p> <p>CPU Cache \u7684\u6570\u636e\u662f\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\u8fc7\u6765\u7684\uff0c\u5b83\u662f\u4ee5\u4e00\u5c0f\u5757\u4e00\u5c0f\u5757\u8bfb\u53d6\u6570\u636e\u7684\uff0c\u800c\u4e0d\u662f\u6309\u7167\u5355\u4e2a\u6570\u7ec4\u5143\u7d20\u6765\u8bfb\u53d6\u6570\u636e\u7684\uff0c\u5728 CPU Cache \u4e2d\u7684\uff0c\u8fd9\u6837\u4e00\u5c0f\u5757\u4e00\u5c0f\u5757\u7684\u6570\u636e\uff0c\u79f0\u4e3a Cache Line\uff08\u7f13\u5b58\u5757\uff09\u3002</p> <p>\u4f60\u53ef\u4ee5\u5728\u4f60\u7684 Linux \u7cfb\u7edf\uff0c\u7528\u4e0b\u9762\u8fd9\u79cd\u65b9\u5f0f\u6765\u67e5\u770b CPU \u7684 Cache Line\uff0c\u4f60\u53ef\u4ee5\u770b\u6211\u670d\u52a1\u5668\u7684 L1 Cache Line \u5927\u5c0f\u662f 64 \u5b57\u8282\uff0c\u4e5f\u5c31\u610f\u5473\u7740 L1 Cache \u4e00\u6b21\u8f7d\u5165\u6570\u636e\u7684\u5927\u5c0f\u662f 64 \u5b57\u8282\u3002</p> <p></p> <p>\u6bd4\u5982\uff0c\u6709\u4e00\u4e2a <code>int array[100]</code> \u7684\u6570\u7ec4\uff0c\u5f53\u8f7d\u5165 <code>array[0]</code> \u65f6\uff0c\u7531\u4e8e\u8fd9\u4e2a\u6570\u7ec4\u5143\u7d20\u7684\u5927\u5c0f\u5728\u5185\u5b58\u53ea\u5360 4 \u5b57\u8282\uff0c\u4e0d\u8db3 64 \u5b57\u8282\uff0cCPU \u5c31\u4f1a\u987a\u5e8f\u52a0\u8f7d\u6570\u7ec4\u5143\u7d20\u5230 <code>array[15]</code>\uff0c\u610f\u5473\u7740 <code>array[0]~array[15]</code> \u6570\u7ec4\u5143\u7d20\u90fd\u4f1a\u88ab\u7f13\u5b58\u5728 CPU Cache \u4e2d\u4e86\uff0c\u56e0\u6b64\u5f53\u4e0b\u6b21\u8bbf\u95ee\u8fd9\u4e9b\u6570\u7ec4\u5143\u7d20\u65f6\uff0c\u4f1a\u76f4\u63a5\u4ece CPU Cache \u8bfb\u53d6\uff0c\u800c\u4e0d\u7528\u518d\u4ece\u5185\u5b58\u4e2d\u8bfb\u53d6\uff0c\u5927\u5927\u63d0\u9ad8\u4e86 CPU \u8bfb\u53d6\u6570\u636e\u7684\u6027\u80fd\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0cCPU \u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u65e0\u8bba\u6570\u636e\u662f\u5426\u5b58\u653e\u5230 Cache \u4e2d\uff0cCPU \u90fd\u662f\u5148\u8bbf\u95ee Cache\uff0c\u53ea\u6709\u5f53 Cache \u4e2d\u627e\u4e0d\u5230\u6570\u636e\u65f6\uff0c\u624d\u4f1a\u53bb\u8bbf\u95ee\u5185\u5b58\uff0c\u5e76\u628a\u5185\u5b58\u4e2d\u7684\u6570\u636e\u8bfb\u5165\u5230 Cache \u4e2d\uff0cCPU \u518d\u4ece CPU Cache \u8bfb\u53d6\u6570\u636e\u3002</p> <p></p> <p>\u8fd9\u6837\u7684\u8bbf\u95ee\u673a\u5236\uff0c\u8ddf\u6211\u4eec\u4f7f\u7528\u300c\u5185\u5b58\u4f5c\u4e3a\u786c\u76d8\u7684\u7f13\u5b58\u300d\u7684\u903b\u8f91\u662f\u4e00\u6837\u7684\uff0c\u5982\u679c\u5185\u5b58\u6709\u7f13\u5b58\u7684\u6570\u636e\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\uff0c\u5426\u5219\u8981\u8bbf\u95ee\u9f9f\u901f\u4e00\u822c\u7684\u786c\u76d8\u3002</p> <p>\u90a3 CPU \u600e\u4e48\u77e5\u9053\u8981\u8bbf\u95ee\u7684\u5185\u5b58\u6570\u636e\uff0c\u662f\u5426\u5728 Cache \u91cc\uff1f\u5982\u679c\u5728\u7684\u8bdd\uff0c\u5982\u4f55\u627e\u5230 Cache \u5bf9\u5e94\u7684\u6570\u636e\u5462\uff1f\u6211\u4eec\u4ece\u6700\u7b80\u5355\u3001\u57fa\u7840\u7684\u76f4\u63a5\u6620\u5c04 Cache\uff08Direct Mapped Cache\uff09 \u8bf4\u8d77\uff0c\u6765\u770b\u770b\u6574\u4e2a CPU Cache \u7684\u6570\u636e\u7ed3\u6784\u548c\u8bbf\u95ee\u903b\u8f91\u3002</p> <p>\u524d\u9762\uff0c\u6211\u4eec\u63d0\u5230 CPU \u8bbf\u95ee\u5185\u5b58\u6570\u636e\u65f6\uff0c\u662f\u4e00\u5c0f\u5757\u4e00\u5c0f\u5757\u6570\u636e\u8bfb\u53d6\u7684\uff0c\u5177\u4f53\u8fd9\u4e00\u5c0f\u5757\u6570\u636e\u7684\u5927\u5c0f\uff0c\u53d6\u51b3\u4e8e <code>coherency_line_size</code> \u7684\u503c\uff0c\u4e00\u822c 64 \u5b57\u8282\u3002\u5728\u5185\u5b58\u4e2d\uff0c\u8fd9\u4e00\u5757\u7684\u6570\u636e\u6211\u4eec\u79f0\u4e3a\u5185\u5b58\u5757\uff08Block\uff09\uff0c\u8bfb\u53d6\u7684\u65f6\u5019\u6211\u4eec\u8981\u62ff\u5230\u6570\u636e\u6240\u5728\u5185\u5b58\u5757\u7684\u5730\u5740\u3002</p> <p>\u5bf9\u4e8e\u76f4\u63a5\u6620\u5c04 Cache \u91c7\u7528\u7684\u7b56\u7565\uff0c\u5c31\u662f\u628a\u5185\u5b58\u5757\u7684\u5730\u5740\u59cb\u7ec8\u300c\u6620\u5c04\u300d\u5728\u4e00\u4e2a CPU Cache Line\uff08\u7f13\u5b58\u5757\uff09\u7684\u5730\u5740\uff0c\u81f3\u4e8e\u6620\u5c04\u5173\u7cfb\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5219\u662f\u4f7f\u7528\u300c\u53d6\u6a21\u8fd0\u7b97\u300d\uff0c\u53d6\u6a21\u8fd0\u7b97\u7684\u7ed3\u679c\u5c31\u662f\u5185\u5b58\u5757\u5730\u5740\u5bf9\u5e94\u7684 CPU Cache Line\uff08\u7f13\u5b58\u5757\uff09\u7684\u5730\u5740\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5185\u5b58\u5171\u88ab\u5212\u5206\u4e3a 32 \u4e2a\u5185\u5b58\u5757\uff0cCPU Cache \u5171\u6709 8 \u4e2a CPU Cache Line\uff0c\u5047\u8bbe CPU \u60f3\u8981\u8bbf\u95ee\u7b2c 15 \u53f7\u5185\u5b58\u5757\uff0c\u5982\u679c 15 \u53f7\u5185\u5b58\u5757\u4e2d\u7684\u6570\u636e\u5df2\u7ecf\u7f13\u5b58\u5728 CPU Cache Line \u4e2d\u7684\u8bdd\uff0c\u5219\u662f\u4e00\u5b9a\u6620\u5c04\u5728 7 \u53f7 CPU Cache Line \u4e2d\uff0c\u56e0\u4e3a <code>15 % 8</code> \u7684\u503c\u662f 7\u3002</p> <p>\u673a\u667a\u7684\u4f60\u80af\u5b9a\u53d1\u73b0\u4e86\uff0c\u4f7f\u7528\u53d6\u6a21\u65b9\u5f0f\u6620\u5c04\u7684\u8bdd\uff0c\u5c31\u4f1a\u51fa\u73b0\u591a\u4e2a\u5185\u5b58\u5757\u5bf9\u5e94\u540c\u4e00\u4e2a CPU Cache Line\uff0c\u6bd4\u5982\u4e0a\u9762\u7684\u4f8b\u5b50\uff0c\u9664\u4e86 15 \u53f7\u5185\u5b58\u5757\u662f\u6620\u5c04\u5728 7 \u53f7 CPU Cache Line \u4e2d\uff0c\u8fd8\u6709 7 \u53f7\u300123 \u53f7\u300131 \u53f7\u5185\u5b58\u5757\u90fd\u662f\u6620\u5c04\u5230 7 \u53f7 CPU Cache Line \u4e2d\u3002</p> <p></p> <p>\u56e0\u6b64\uff0c\u4e3a\u4e86\u533a\u522b\u4e0d\u540c\u7684\u5185\u5b58\u5757\uff0c\u5728\u5bf9\u5e94\u7684 CPU Cache Line \u4e2d\u6211\u4eec\u8fd8\u4f1a\u5b58\u50a8\u4e00\u4e2a\u7ec4\u6807\u8bb0\uff08Tag\uff09\u3002\u8fd9\u4e2a\u7ec4\u6807\u8bb0\u4f1a\u8bb0\u5f55\u5f53\u524d CPU Cache Line \u4e2d\u5b58\u50a8\u7684\u6570\u636e\u5bf9\u5e94\u7684\u5185\u5b58\u5757\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u8fd9\u4e2a\u7ec4\u6807\u8bb0\u6765\u533a\u5206\u4e0d\u540c\u7684\u5185\u5b58\u5757\u3002</p> <p>\u9664\u4e86\u7ec4\u6807\u8bb0\u4fe1\u606f\u5916\uff0cCPU Cache Line \u8fd8\u6709\u4e24\u4e2a\u4fe1\u606f\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f\uff0c\u4ece\u5185\u5b58\u52a0\u8f7d\u8fc7\u6765\u7684\u5b9e\u9645\u5b58\u653e\u6570\u636e\uff08Data\uff09\u3002</li> <li>\u53e6\u4e00\u4e2a\u662f\uff0c\u6709\u6548\u4f4d\uff08Valid bit\uff09\uff0c\u5b83\u662f\u7528\u6765\u6807\u8bb0\u5bf9\u5e94\u7684 CPU Cache Line \u4e2d\u7684\u6570\u636e\u662f\u5426\u662f\u6709\u6548\u7684\uff0c\u5982\u679c\u6709\u6548\u4f4d\u662f 0\uff0c\u65e0\u8bba CPU Cache Line \u4e2d\u662f\u5426\u6709\u6570\u636e\uff0cCPU \u90fd\u4f1a\u76f4\u63a5\u8bbf\u95ee\u5185\u5b58\uff0c\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\u3002</li> </ul> <p>CPU \u5728\u4ece CPU Cache \u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u8bfb\u53d6 CPU Cache Line \u4e2d\u7684\u6574\u4e2a\u6570\u636e\u5757\uff0c\u800c\u662f\u8bfb\u53d6 CPU \u6240\u9700\u8981\u7684\u4e00\u4e2a\u6570\u636e\u7247\u6bb5\uff0c\u8fd9\u6837\u7684\u6570\u636e\u7edf\u79f0\u4e3a\u4e00\u4e2a\u5b57\uff08Word\uff09\u3002\u90a3\u600e\u4e48\u5728\u5bf9\u5e94\u7684 CPU Cache Line \u4e2d\u6570\u636e\u5757\u4e2d\u627e\u5230\u6240\u9700\u7684\u5b57\u5462\uff1f\u7b54\u6848\u662f\uff0c\u9700\u8981\u4e00\u4e2a\u504f\u79fb\u91cf\uff08Offset\uff09\u3002</p> <p>\u56e0\u6b64\uff0c\u4e00\u4e2a\u5185\u5b58\u7684\u8bbf\u95ee\u5730\u5740\uff0c\u5305\u62ec\u7ec4\u6807\u8bb0\u3001CPU Cache Line \u7d22\u5f15\u3001\u504f\u79fb\u91cf\u8fd9\u4e09\u79cd\u4fe1\u606f\uff0c\u4e8e\u662f CPU \u5c31\u80fd\u901a\u8fc7\u8fd9\u4e9b\u4fe1\u606f\uff0c\u5728 CPU Cache \u4e2d\u627e\u5230\u7f13\u5b58\u7684\u6570\u636e\u3002\u800c\u5bf9\u4e8e CPU Cache \u91cc\u7684\u6570\u636e\u7ed3\u6784\uff0c\u5219\u662f\u7531\u7d22\u5f15 + \u6709\u6548\u4f4d + \u7ec4\u6807\u8bb0 + \u6570\u636e\u5757\u7ec4\u6210\u3002</p> <p></p> <p>\u5982\u679c\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5df2\u7ecf\u5728 CPU Cahe \u4e2d\u4e86\uff0c\u90a3 CPU \u8bbf\u95ee\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u7684\u65f6\u5019\uff0c\u4f1a\u7ecf\u5386\u8fd9 4 \u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u6839\u636e\u5185\u5b58\u5730\u5740\u4e2d\u7d22\u5f15\u4fe1\u606f\uff0c\u8ba1\u7b97\u5728 CPU Cahe \u4e2d\u7684\u7d22\u5f15\uff0c\u4e5f\u5c31\u662f\u627e\u51fa\u5bf9\u5e94\u7684 CPU Cache Line \u7684\u5730\u5740\uff1b</li> <li>\u627e\u5230\u5bf9\u5e94 CPU Cache Line \u540e\uff0c\u5224\u65ad CPU Cache Line \u4e2d\u7684\u6709\u6548\u4f4d\uff0c\u786e\u8ba4 CPU Cache Line \u4e2d\u6570\u636e\u662f\u5426\u662f\u6709\u6548\u7684\uff0c\u5982\u679c\u662f\u65e0\u6548\u7684\uff0cCPU \u5c31\u4f1a\u76f4\u63a5\u8bbf\u95ee\u5185\u5b58\uff0c\u5e76\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\uff0c\u5982\u679c\u6570\u636e\u6709\u6548\uff0c\u5219\u5f80\u4e0b\u6267\u884c\uff1b</li> <li>\u5bf9\u6bd4\u5185\u5b58\u5730\u5740\u4e2d\u7ec4\u6807\u8bb0\u548c CPU Cache Line \u4e2d\u7684\u7ec4\u6807\u8bb0\uff0c\u786e\u8ba4 CPU Cache Line \u4e2d\u7684\u6570\u636e\u662f\u6211\u4eec\u8981\u8bbf\u95ee\u7684\u5185\u5b58\u6570\u636e\uff0c\u5982\u679c\u4e0d\u662f\u7684\u8bdd\uff0cCPU \u5c31\u4f1a\u76f4\u63a5\u8bbf\u95ee\u5185\u5b58\uff0c\u5e76\u91cd\u65b0\u52a0\u8f7d\u6570\u636e\uff0c\u5982\u679c\u662f\u7684\u8bdd\uff0c\u5219\u5f80\u4e0b\u6267\u884c\uff1b</li> <li>\u6839\u636e\u5185\u5b58\u5730\u5740\u4e2d\u504f\u79fb\u91cf\u4fe1\u606f\uff0c\u4ece CPU Cache Line \u7684\u6570\u636e\u5757\u4e2d\uff0c\u8bfb\u53d6\u5bf9\u5e94\u7684\u5b57\u3002</li> </ol> <p>\u5230\u8fd9\u91cc\uff0c\u76f8\u4fe1\u4f60\u5bf9\u76f4\u63a5\u6620\u5c04 Cache \u6709\u4e86\u4e00\u5b9a\u8ba4\u8bc6\uff0c\u4f46\u5176\u5b9e\u9664\u4e86\u76f4\u63a5\u6620\u5c04 Cache \u4e4b\u5916\uff0c\u8fd8\u6709\u5176\u4ed6\u901a\u8fc7\u5185\u5b58\u5730\u5740\u627e\u5230 CPU Cache \u4e2d\u7684\u6570\u636e\u7684\u7b56\u7565\uff0c\u6bd4\u5982\u5168\u76f8\u8fde Cache\uff08Fully Associative Cache\uff09\u3001\u7ec4\u76f8\u8fde Cache\uff08Set Associative Cache\uff09\u7b49\uff0c\u8fd9\u51e0\u79cd\u7b56\u7b56\u7565\u7684\u6570\u636e\u7ed3\u6784\u90fd\u6bd4\u8f83\u76f8\u4f3c\uff0c\u6211\u4eec\u7406\u89e3\u4e86\u76f4\u63a5\u6620\u5c04 Cache \u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u5176\u4ed6\u7684\u7b56\u7565\u5982\u679c\u4f60\u6709\u5174\u8da3\u53bb\u770b\uff0c\u76f8\u4fe1\u5f88\u5feb\u5c31\u80fd\u7406\u89e3\u7684\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_to_make_cpu_run_faster/#cpu","title":"\u5982\u4f55\u5199\u51fa\u8ba9 CPU \u8dd1\u5f97\u66f4\u5feb\u7684\u4ee3\u7801\uff1f","text":"<p>\u6211\u4eec\u77e5\u9053 CPU \u8bbf\u95ee\u5185\u5b58\u7684\u901f\u5ea6\uff0c\u6bd4\u8bbf\u95ee CPU Cache \u7684\u901f\u5ea6\u6162\u4e86 100 \u591a\u500d\uff0c\u6240\u4ee5\u5982\u679c CPU \u6240\u8981\u64cd\u4f5c\u7684\u6570\u636e\u5728 CPU Cache \u4e2d\u7684\u8bdd\uff0c\u8fd9\u6837\u5c06\u4f1a\u5e26\u6765\u5f88\u5927\u7684\u6027\u80fd\u63d0\u5347\u3002\u8bbf\u95ee\u7684\u6570\u636e\u5728 CPU Cache \u4e2d\u7684\u8bdd\uff0c\u610f\u5473\u7740\u7f13\u5b58\u547d\u4e2d\uff0c\u7f13\u5b58\u547d\u4e2d\u7387\u8d8a\u9ad8\u7684\u8bdd\uff0c\u4ee3\u7801\u7684\u6027\u80fd\u5c31\u4f1a\u8d8a\u597d\uff0cCPU \u4e5f\u5c31\u8dd1\u7684\u8d8a\u5feb\u3002</p> <p>\u4e8e\u662f\uff0c\u300c\u5982\u4f55\u5199\u51fa\u8ba9 CPU \u8dd1\u5f97\u66f4\u5feb\u7684\u4ee3\u7801\uff1f\u300d\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u6539\u6210\u300c\u5982\u4f55\u5199\u51fa CPU \u7f13\u5b58\u547d\u4e2d\u7387\u9ad8\u7684\u4ee3\u7801\uff1f\u300d\u3002</p> <p>\u5728\u524d\u9762\u6211\u4e5f\u63d0\u5230\uff0cL1 Cache \u901a\u5e38\u5206\u4e3a\u300c\u6570\u636e\u7f13\u5b58\u300d\u548c\u300c\u6307\u4ee4\u7f13\u5b58\u300d\uff0c\u8fd9\u662f\u56e0\u4e3a CPU \u4f1a\u5206\u522b\u5904\u7406\u6570\u636e\u548c\u6307\u4ee4\uff0c\u6bd4\u5982 <code>1+1=2</code> \u8fd9\u4e2a\u8fd0\u7b97\uff0c<code>+</code> \u5c31\u662f\u6307\u4ee4\uff0c\u4f1a\u88ab\u653e\u5728\u300c\u6307\u4ee4\u7f13\u5b58\u300d\u4e2d\uff0c\u800c\u8f93\u5165\u6570\u5b57 <code>1</code> \u5219\u4f1a\u88ab\u653e\u5728\u300c\u6570\u636e\u7f13\u5b58\u300d\u91cc\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u8981\u5206\u5f00\u6765\u770b\u300c\u6570\u636e\u7f13\u5b58\u300d\u548c\u300c\u6307\u4ee4\u7f13\u5b58\u300d\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_to_make_cpu_run_faster/#_1","title":"\u5982\u4f55\u63d0\u5347\u6570\u636e\u7f13\u5b58\u7684\u547d\u4e2d\u7387\uff1f","text":"<p>\u5047\u8bbe\u8981\u904d\u5386\u4e8c\u7ef4\u6570\u7ec4\uff0c\u6709\u4ee5\u4e0b\u4e24\u79cd\u5f62\u5f0f\uff0c\u867d\u7136\u4ee3\u7801\u6267\u884c\u7ed3\u679c\u662f\u4e00\u6837\uff0c\u4f46\u4f60\u89c9\u5f97\u54ea\u79cd\u5f62\u5f0f\u6548\u7387\u6700\u9ad8\u5462\uff1f\u4e3a\u4ec0\u4e48\u9ad8\u5462\uff1f</p> <p></p> <p>\u7ecf\u8fc7\u6d4b\u8bd5\uff0c\u5f62\u5f0f\u4e00 <code>array[i][j]</code>  \u6267\u884c\u65f6\u95f4\u6bd4\u5f62\u5f0f\u4e8c <code>array[j][i]</code> \u5feb\u597d\u51e0\u500d\u3002</p> <p>\u4e4b\u6240\u4ee5\u6709\u8fd9\u4e48\u5927\u7684\u5dee\u8ddd\uff0c\u662f\u56e0\u4e3a\u4e8c\u7ef4\u6570\u7ec4 <code>array</code> \u6240\u5360\u7528\u7684\u5185\u5b58\u662f\u8fde\u7eed\u7684\uff0c\u6bd4\u5982\u957f\u5ea6 <code>N</code> \u7684\u503c\u662f <code>2</code> \u7684\u8bdd\uff0c\u90a3\u4e48\u5185\u5b58\u4e2d\u7684\u6570\u7ec4\u5143\u7d20\u7684\u5e03\u5c40\u987a\u5e8f\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u5f62\u5f0f\u4e00\u7528 <code>array[i][j]</code>  \u8bbf\u95ee\u6570\u7ec4\u5143\u7d20\u7684\u987a\u5e8f\uff0c\u6b63\u662f\u548c\u5185\u5b58\u4e2d\u6570\u7ec4\u5143\u7d20\u5b58\u653e\u7684\u987a\u5e8f\u4e00\u81f4\u3002\u5f53 CPU \u8bbf\u95ee <code>array[0][0]</code> \u65f6\uff0c\u7531\u4e8e\u8be5\u6570\u636e\u4e0d\u5728 Cache \u4e2d\uff0c\u4e8e\u662f\u4f1a\u300c\u987a\u5e8f\u300d\u628a\u8ddf\u968f\u5176\u540e\u7684 3 \u4e2a\u5143\u7d20\u4ece\u5185\u5b58\u4e2d\u52a0\u8f7d\u5230 CPU Cache\uff0c\u8fd9\u6837\u5f53 CPU \u8bbf\u95ee\u540e\u9762\u7684 3 \u4e2a\u6570\u7ec4\u5143\u7d20\u65f6\uff0c\u5c31\u80fd\u5728 CPU Cache \u4e2d\u6210\u529f\u5730\u627e\u5230\u6570\u636e\uff0c\u8fd9\u610f\u5473\u7740\u7f13\u5b58\u547d\u4e2d\u7387\u5f88\u9ad8\uff0c\u7f13\u5b58\u547d\u4e2d\u7684\u6570\u636e\u4e0d\u9700\u8981\u8bbf\u95ee\u5185\u5b58\uff0c\u8fd9\u4fbf\u5927\u5927\u63d0\u9ad8\u4e86\u4ee3\u7801\u7684\u6027\u80fd\u3002</p> <p>\u800c\u5982\u679c\u7528\u5f62\u5f0f\u4e8c\u7684 <code>array[j][i]</code> \u6765\u8bbf\u95ee\uff0c\u5219\u8bbf\u95ee\u7684\u987a\u5e8f\u5c31\u662f\uff1a</p> <p></p> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u8bbf\u95ee\u7684\u65b9\u5f0f\u8df3\u8dc3\u5f0f\u7684\uff0c\u800c\u4e0d\u662f\u987a\u5e8f\u7684\uff0c\u90a3\u4e48\u5982\u679c N \u7684\u6570\u503c\u5f88\u5927\uff0c\u90a3\u4e48\u64cd\u4f5c <code>array[j][i]</code> \u65f6\uff0c\u662f\u6ca1\u529e\u6cd5\u628a <code>array[j+1][i]</code> \u4e5f\u8bfb\u5165\u5230 CPU Cache \u4e2d\u7684\uff0c\u65e2\u7136 <code>array[j+1][i]</code> \u6ca1\u6709\u8bfb\u53d6\u5230 CPU Cache\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u4ece\u5185\u5b58\u8bfb\u53d6\u8be5\u6570\u636e\u5143\u7d20\u4e86\u3002\u5f88\u660e\u663e\uff0c\u8fd9\u79cd\u4e0d\u8fde\u7eed\u6027\u3001\u8df3\u8dc3\u5f0f\u8bbf\u95ee\u6570\u636e\u5143\u7d20\u7684\u65b9\u5f0f\uff0c\u53ef\u80fd\u4e0d\u80fd\u5145\u5206\u5229\u7528\u5230\u4e86 CPU Cache \u7684\u7279\u6027\uff0c\u4ece\u800c\u4ee3\u7801\u7684\u6027\u80fd\u4e0d\u9ad8\u3002</p> <p>\u90a3\u8bbf\u95ee <code>array[0][0]</code> \u5143\u7d20\u65f6\uff0cCPU \u5177\u4f53\u4f1a\u4e00\u6b21\u4ece\u5185\u5b58\u4e2d\u52a0\u8f7d\u591a\u5c11\u5143\u7d20\u5230 CPU Cache \u5462\uff1f\u8fd9\u4e2a\u95ee\u9898\uff0c\u5728\u524d\u9762\u6211\u4eec\u4e5f\u63d0\u5230\u8fc7\uff0c\u8fd9\u8ddf CPU Cache Line \u6709\u5173\uff0c\u5b83\u8868\u793a CPU Cache \u4e00\u6b21\u6027\u80fd\u52a0\u8f7d\u6570\u636e\u7684\u5927\u5c0f\uff0c\u53ef\u4ee5\u5728 Linux \u91cc\u901a\u8fc7 <code>coherency_line_size</code> \u914d\u7f6e\u67e5\u770b \u5b83\u7684\u5927\u5c0f\uff0c\u901a\u5e38\u662f 64 \u4e2a\u5b57\u8282\u3002</p> <p></p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5f53 CPU \u8bbf\u95ee\u5185\u5b58\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u4e0d\u5728 CPU Cache \u4e2d\uff0c\u5219\u4f1a\u4e00\u6b21\u6027\u4f1a\u8fde\u7eed\u52a0\u8f7d 64 \u5b57\u8282\u5927\u5c0f\u7684\u6570\u636e\u5230 CPU Cache\uff0c\u90a3\u4e48\u5f53\u8bbf\u95ee <code>array[0][0]</code> \u65f6\uff0c\u7531\u4e8e\u8be5\u5143\u7d20\u4e0d\u8db3 64 \u5b57\u8282\uff0c\u4e8e\u662f\u5c31\u4f1a\u5f80\u540e\u987a\u5e8f\u8bfb\u53d6 <code>array[0][0]~array[0][15]</code> \u5230 CPU Cache \u4e2d\u3002\u987a\u5e8f\u8bbf\u95ee\u7684 <code>array[i][j]</code> \u56e0\u4e3a\u5229\u7528\u4e86\u8fd9\u4e00\u7279\u70b9\uff0c\u6240\u4ee5\u5c31\u4f1a\u6bd4\u8df3\u8dc3\u5f0f\u8bbf\u95ee\u7684 <code>array[j][i]</code> \u8981\u5feb\u3002</p> <p>\u56e0\u6b64\uff0c\u9047\u5230\u8fd9\u79cd\u904d\u5386\u6570\u7ec4\u7684\u60c5\u51b5\u65f6\uff0c\u6309\u7167\u5185\u5b58\u5e03\u5c40\u987a\u5e8f\u8bbf\u95ee\uff0c\u5c06\u53ef\u4ee5\u6709\u6548\u7684\u5229\u7528 CPU Cache \u5e26\u6765\u7684\u597d\u5904\uff0c\u8fd9\u6837\u6211\u4eec\u4ee3\u7801\u7684\u6027\u80fd\u5c31\u4f1a\u5f97\u5230\u5f88\u5927\u7684\u63d0\u5347\uff0c</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_to_make_cpu_run_faster/#_2","title":"\u5982\u4f55\u63d0\u5347\u6307\u4ee4\u7f13\u5b58\u7684\u547d\u4e2d\u7387\uff1f","text":"<p>\u63d0\u5347\u6570\u636e\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u7684\u65b9\u5f0f\uff0c\u662f\u6309\u7167\u5185\u5b58\u5e03\u5c40\u987a\u5e8f\u8bbf\u95ee\uff0c\u90a3\u9488\u5bf9\u6307\u4ee4\u7684\u7f13\u5b58\u8be5\u5982\u4f55\u63d0\u5347\u5462\uff1f</p> <p>\u6211\u4eec\u4ee5\u4e00\u4e2a\u4f8b\u5b50\u6765\u770b\u770b\uff0c\u6709\u4e00\u4e2a\u5143\u7d20\u4e3a 0 \u5230 100 \u4e4b\u95f4\u968f\u673a\u6570\u5b57\u7ec4\u6210\u7684\u4e00\u7ef4\u6570\u7ec4\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u5bf9\u8fd9\u4e2a\u6570\u7ec4\u505a\u4e24\u4e2a\u64cd\u4f5c\uff1a</p> <p></p> <ul> <li>\u7b2c\u4e00\u4e2a\u64cd\u4f5c\uff0c\u5faa\u73af\u904d\u5386\u6570\u7ec4\uff0c\u628a\u5c0f\u4e8e 50 \u7684\u6570\u7ec4\u5143\u7d20\u7f6e\u4e3a 0\uff1b</li> <li>\u7b2c\u4e8c\u4e2a\u64cd\u4f5c\uff0c\u5c06\u6570\u7ec4\u6392\u5e8f\uff1b</li> </ul> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u4f60\u89c9\u5f97\u5148\u904d\u5386\u518d\u6392\u5e8f\u901f\u5ea6\u5feb\uff0c\u8fd8\u662f\u5148\u6392\u5e8f\u518d\u904d\u5386\u901f\u5ea6\u5feb\u5462\uff1f</p> <p>\u5728\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u4e86\u89e3 CPU \u7684\u5206\u652f\u9884\u6d4b\u5668\u3002\u5bf9\u4e8e if \u6761\u4ef6\u8bed\u53e5\uff0c\u610f\u5473\u7740\u6b64\u65f6\u81f3\u5c11\u53ef\u4ee5\u9009\u62e9\u8df3\u8f6c\u5230\u4e24\u6bb5\u4e0d\u540c\u7684\u6307\u4ee4\u6267\u884c\uff0c\u4e5f\u5c31\u662f if \u8fd8\u662f else \u4e2d\u7684\u6307\u4ee4\u3002\u90a3\u4e48\uff0c\u5982\u679c\u5206\u652f\u9884\u6d4b\u53ef\u4ee5\u9884\u6d4b\u5230\u63a5\u4e0b\u6765\u8981\u6267\u884c if \u91cc\u7684\u6307\u4ee4\uff0c\u8fd8\u662f else \u6307\u4ee4\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u300c\u63d0\u524d\u300d\u628a\u8fd9\u4e9b\u6307\u4ee4\u653e\u5728\u6307\u4ee4\u7f13\u5b58\u4e2d\uff0c\u8fd9\u6837 CPU \u53ef\u4ee5\u76f4\u63a5\u4ece Cache \u8bfb\u53d6\u5230\u6307\u4ee4\uff0c\u4e8e\u662f\u6267\u884c\u901f\u5ea6\u5c31\u4f1a\u5f88\u5feb\u3002</p> <p>\u5f53\u6570\u7ec4\u4e2d\u7684\u5143\u7d20\u662f\u968f\u673a\u7684\uff0c\u5206\u652f\u9884\u6d4b\u5c31\u65e0\u6cd5\u6709\u6548\u5de5\u4f5c\uff0c\u800c\u5f53\u6570\u7ec4\u5143\u7d20\u90fd\u662f\u662f\u987a\u5e8f\u7684\uff0c\u5206\u652f\u9884\u6d4b\u5668\u4f1a\u52a8\u6001\u5730\u6839\u636e\u5386\u53f2\u547d\u4e2d\u6570\u636e\u5bf9\u672a\u6765\u8fdb\u884c\u9884\u6d4b\uff0c\u8fd9\u6837\u547d\u4e2d\u7387\u5c31\u4f1a\u5f88\u9ad8\u3002</p> <p>\u56e0\u6b64\uff0c\u5148\u6392\u5e8f\u518d\u904d\u5386\u901f\u5ea6\u4f1a\u66f4\u5feb\uff0c\u8fd9\u662f\u56e0\u4e3a\u6392\u5e8f\u4e4b\u540e\uff0c\u6570\u5b57\u662f\u4ece\u5c0f\u5230\u5927\u7684\uff0c\u90a3\u4e48\u524d\u51e0\u6b21\u5faa\u73af\u547d\u4e2d <code>if &lt; 50</code> \u7684\u6b21\u6570\u4f1a\u6bd4\u8f83\u591a\uff0c\u4e8e\u662f\u5206\u652f\u9884\u6d4b\u5c31\u4f1a\u7f13\u5b58 <code>if</code> \u91cc\u7684 <code>array[i] = 0</code> \u6307\u4ee4\u5230 Cache \u4e2d\uff0c\u540e\u7eed CPU \u6267\u884c\u8be5\u6307\u4ee4\u5c31\u53ea\u9700\u8981\u4ece Cache \u8bfb\u53d6\u5c31\u597d\u4e86\u3002</p> <p>\u5982\u679c\u4f60\u80af\u5b9a\u4ee3\u7801\u4e2d\u7684 <code>if</code> \u4e2d\u7684\u8868\u8fbe\u5f0f\u5224\u65ad\u4e3a <code>true</code> \u7684\u6982\u7387\u6bd4\u8f83\u9ad8\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u663e\u793a\u5206\u652f\u9884\u6d4b\u5de5\u5177\uff0c\u6bd4\u5982\u5728 C/C++ \u8bed\u8a00\u4e2d\u7f16\u8bd1\u5668\u63d0\u4f9b\u4e86 <code>likely</code> \u548c <code>unlikely</code> \u8fd9\u4e24\u79cd\u5b8f\uff0c\u5982\u679c <code>if</code> \u6761\u4ef6\u4e3a <code>ture</code> \u7684\u6982\u7387\u5927\uff0c\u5219\u53ef\u4ee5\u7528 <code>likely</code> \u5b8f\u628a <code>if</code> \u91cc\u7684\u8868\u8fbe\u5f0f\u5305\u88f9\u8d77\u6765\uff0c\u53cd\u4e4b\u7528 <code>unlikely</code> \u5b8f\u3002</p> <p></p> <p>\u5b9e\u9645\u4e0a\uff0cCPU \u81ea\u8eab\u7684\u52a8\u6001\u5206\u652f\u9884\u6d4b\u5df2\u7ecf\u662f\u6bd4\u8f83\u51c6\u7684\u4e86\uff0c\u6240\u4ee5\u53ea\u6709\u5f53\u975e\u5e38\u786e\u4fe1 CPU \u9884\u6d4b\u7684\u4e0d\u51c6\uff0c\u4e14\u80fd\u591f\u77e5\u9053\u5b9e\u9645\u7684\u6982\u7387\u60c5\u51b5\u65f6\uff0c\u624d\u5efa\u8bae\u4f7f\u7528\u8fd9\u4e24\u79cd\u5b8f\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_to_make_cpu_run_faster/#cpu_1","title":"\u5982\u4f55\u63d0\u5347\u591a\u6838 CPU \u7684\u7f13\u5b58\u547d\u4e2d\u7387\uff1f","text":"<p>\u5728\u5355\u6838 CPU\uff0c\u867d\u7136\u53ea\u80fd\u6267\u884c\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4f46\u662f\u64cd\u4f5c\u7cfb\u7edf\u7ed9\u6bcf\u4e2a\u7ebf\u7a0b\u5206\u914d\u4e86\u4e00\u4e2a\u65f6\u95f4\u7247\uff0c\u65f6\u95f4\u7247\u7528\u5b8c\u4e86\uff0c\u5c31\u8c03\u5ea6\u4e0b\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u4e8e\u662f\u5404\u4e2a\u7ebf\u7a0b\u5c31\u6309\u65f6\u95f4\u7247\u4ea4\u66ff\u5730\u5360\u7528 CPU\uff0c\u4ece\u5b8f\u89c2\u4e0a\u770b\u8d77\u6765\u5404\u4e2a\u7ebf\u7a0b\u540c\u65f6\u5728\u6267\u884c\u3002</p> <p>\u800c\u73b0\u4ee3 CPU \u90fd\u662f\u591a\u6838\u5fc3\u7684\uff0c\u7ebf\u7a0b\u53ef\u80fd\u5728\u4e0d\u540c CPU \u6838\u5fc3\u6765\u56de\u5207\u6362\u6267\u884c\uff0c\u8fd9\u5bf9 CPU Cache \u4e0d\u662f\u6709\u5229\u7684\uff0c\u867d\u7136 L3 Cache \u662f\u591a\u6838\u5fc3\u4e4b\u95f4\u5171\u4eab\u7684\uff0c\u4f46\u662f L1 \u548c L2 Cache \u90fd\u662f\u6bcf\u4e2a\u6838\u5fc3\u72ec\u6709\u7684\uff0c\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u5728\u4e0d\u540c\u6838\u5fc3\u6765\u56de\u5207\u6362\uff0c\u5404\u4e2a\u6838\u5fc3\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u5c31\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u76f8\u53cd\u5982\u679c\u7ebf\u7a0b\u90fd\u5728\u540c\u4e00\u4e2a\u6838\u5fc3\u4e0a\u6267\u884c\uff0c\u90a3\u4e48\u5176\u6570\u636e\u7684 L1 \u548c L2 Cache \u7684\u7f13\u5b58\u547d\u4e2d\u7387\u53ef\u4ee5\u5f97\u5230\u6709\u6548\u63d0\u9ad8\uff0c\u7f13\u5b58\u547d\u4e2d\u7387\u9ad8\u5c31\u610f\u5473\u7740 CPU \u53ef\u4ee5\u51cf\u5c11\u8bbf\u95ee \u5185\u5b58\u7684\u9891\u7387\u3002</p> <p>\u5f53\u6709\u591a\u4e2a\u540c\u65f6\u6267\u884c\u300c\u8ba1\u7b97\u5bc6\u96c6\u578b\u300d\u7684\u7ebf\u7a0b\uff0c\u4e3a\u4e86\u9632\u6b62\u56e0\u4e3a\u5207\u6362\u5230\u4e0d\u540c\u7684\u6838\u5fc3\uff0c\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\u7684\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7ebf\u7a0b\u7ed1\u5b9a\u5728\u67d0\u4e00\u4e2a CPU \u6838\u5fc3\u4e0a\uff0c\u8fd9\u6837\u6027\u80fd\u53ef\u4ee5\u5f97\u5230\u975e\u5e38\u53ef\u89c2\u7684\u63d0\u5347\u3002</p> <p>\u5728 Linux \u4e0a\u63d0\u4f9b\u4e86 <code>sched_setaffinity</code> \u65b9\u6cd5\uff0c\u6765\u5b9e\u73b0\u5c06\u7ebf\u7a0b\u7ed1\u5b9a\u5230\u67d0\u4e2a CPU \u6838\u5fc3\u8fd9\u4e00\u529f\u80fd\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_to_make_cpu_run_faster/#_3","title":"\u603b\u7ed3","text":"<p>\u7531\u4e8e\u968f\u7740\u8ba1\u7b97\u673a\u6280\u672f\u7684\u53d1\u5c55\uff0cCPU \u4e0e \u5185\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u76f8\u5dee\u8d8a\u6765\u8d8a\u591a\uff0c\u5982\u4eca\u5dee\u8ddd\u5df2\u7ecf\u9ad8\u8fbe\u597d\u51e0\u767e\u500d\u4e86\uff0c\u6240\u4ee5 CPU \u5185\u90e8\u5d4c\u5165\u4e86 CPU Cache \u7ec4\u4ef6\uff0c\u4f5c\u4e3a\u5185\u5b58\u4e0e CPU \u4e4b\u95f4\u7684\u7f13\u5b58\u5c42\uff0cCPU Cache \u7531\u4e8e\u79bb CPU \u6838\u5fc3\u5f88\u8fd1\uff0c\u6240\u4ee5\u8bbf\u95ee\u901f\u5ea6\u4e5f\u662f\u975e\u5e38\u5feb\u7684\uff0c\u4f46\u7531\u4e8e\u6240\u9700\u6750\u6599\u6210\u672c\u6bd4\u8f83\u9ad8\uff0c\u5b83\u4e0d\u50cf\u5185\u5b58\u52a8\u8f84\u51e0\u4e2a GB \u5927\u5c0f\uff0c\u800c\u662f\u4ec5\u6709\u51e0\u5341 KB \u5230 MB \u5927\u5c0f\u3002</p> <p>\u5f53 CPU \u8bbf\u95ee\u6570\u636e\u7684\u65f6\u5019\uff0c\u5148\u662f\u8bbf\u95ee CPU Cache\uff0c\u5982\u679c\u7f13\u5b58\u547d\u4e2d\u7684\u8bdd\uff0c\u5219\u76f4\u63a5\u8fd4\u56de\u6570\u636e\uff0c\u5c31\u4e0d\u7528\u6bcf\u6b21\u90fd\u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\u4e86\u3002\u56e0\u6b64\uff0c\u7f13\u5b58\u547d\u4e2d\u7387\u8d8a\u9ad8\uff0c\u4ee3\u7801\u7684\u6027\u80fd\u8d8a\u597d\u3002</p> <p>\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5f53 CPU \u8bbf\u95ee\u6570\u636e\u65f6\uff0c\u5982\u679c CPU Cache \u6ca1\u6709\u7f13\u5b58\u8be5\u6570\u636e\uff0c\u5219\u4f1a\u4ece\u5185\u5b58\u8bfb\u53d6\u6570\u636e\uff0c\u4f46\u662f\u5e76\u4e0d\u662f\u53ea\u8bfb\u4e00\u4e2a\u6570\u636e\uff0c\u800c\u662f\u4e00\u6b21\u6027\u8bfb\u53d6\u4e00\u5757\u4e00\u5757\u7684\u6570\u636e\u5b58\u653e\u5230 CPU Cache \u4e2d\uff0c\u4e4b\u540e\u624d\u4f1a\u88ab CPU \u8bfb\u53d6\u3002</p> <p>\u5185\u5b58\u5730\u5740\u6620\u5c04\u5230 CPU Cache \u5730\u5740\u91cc\u7684\u7b56\u7565\u6709\u5f88\u591a\u79cd\uff0c\u5176\u4e2d\u6bd4\u8f83\u7b80\u5355\u662f\u76f4\u63a5\u6620\u5c04 Cache\uff0c\u5b83\u5de7\u5999\u7684\u628a\u5185\u5b58\u5730\u5740\u62c6\u5206\u6210\u300c\u7d22\u5f15 + \u7ec4\u6807\u8bb0 + \u504f\u79fb\u91cf\u300d\u7684\u65b9\u5f0f\uff0c\u4f7f\u5f97\u6211\u4eec\u53ef\u4ee5\u5c06\u5f88\u5927\u7684\u5185\u5b58\u5730\u5740\uff0c\u6620\u5c04\u5230\u5f88\u5c0f\u7684 CPU Cache \u5730\u5740\u91cc\u3002</p> <p>\u8981\u60f3\u5199\u51fa\u8ba9 CPU \u8dd1\u5f97\u66f4\u5feb\u7684\u4ee3\u7801\uff0c\u5c31\u9700\u8981\u5199\u51fa\u7f13\u5b58\u547d\u4e2d\u7387\u9ad8\u7684\u4ee3\u7801\uff0cCPU L1 Cache \u5206\u4e3a\u6570\u636e\u7f13\u5b58\u548c\u6307\u4ee4\u7f13\u5b58\uff0c\u56e0\u800c\u9700\u8981\u5206\u522b\u63d0\u9ad8\u5b83\u4eec\u7684\u7f13\u5b58\u547d\u4e2d\u7387\uff1a</p> <ul> <li>\u5bf9\u4e8e\u6570\u636e\u7f13\u5b58\uff0c\u6211\u4eec\u5728\u904d\u5386\u6570\u636e\u7684\u65f6\u5019\uff0c\u5e94\u8be5\u6309\u7167\u5185\u5b58\u5e03\u5c40\u7684\u987a\u5e8f\u64cd\u4f5c\uff0c\u8fd9\u662f\u56e0\u4e3a CPU Cache \u662f\u6839\u636e CPU Cache Line \u6279\u91cf\u64cd\u4f5c\u6570\u636e\u7684\uff0c\u6240\u4ee5\u987a\u5e8f\u5730\u64cd\u4f5c\u8fde\u7eed\u5185\u5b58\u6570\u636e\u65f6\uff0c\u6027\u80fd\u80fd\u5f97\u5230\u6709\u6548\u7684\u63d0\u5347\uff1b</li> <li>\u5bf9\u4e8e\u6307\u4ee4\u7f13\u5b58\uff0c\u6709\u89c4\u5f8b\u7684\u6761\u4ef6\u5206\u652f\u8bed\u53e5\u80fd\u591f\u8ba9 CPU \u7684\u5206\u652f\u9884\u6d4b\u5668\u53d1\u6325\u4f5c\u7528\uff0c\u8fdb\u4e00\u6b65\u63d0\u9ad8\u6267\u884c\u7684\u6548\u7387\uff1b</li> </ul> <p>\u53e6\u5916\uff0c\u5bf9\u4e8e\u591a\u6838 CPU \u7cfb\u7edf\uff0c\u7ebf\u7a0b\u53ef\u80fd\u5728\u4e0d\u540c CPU \u6838\u5fc3\u6765\u56de\u5207\u6362\uff0c\u8fd9\u6837\u5404\u4e2a\u6838\u5fc3\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u5c31\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u4e8e\u662f\u8981\u60f3\u63d0\u9ad8\u7ebf\u7a0b\u7684\u7f13\u5b58\u547d\u4e2d\u7387\uff0c\u53ef\u4ee5\u8003\u8651\u628a\u7ebf\u7a0b\u7ed1\u5b9a CPU \u5230\u67d0\u4e00\u4e2a CPU \u6838\u5fc3\u3002 </p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/how_to_make_cpu_run_faster/#_4","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u5206\u4eab\u4e2a\u559c\u4e8b\uff0c\u5c0f\u6797\u5e73\u65e5\u91cc\u5fd9\u7740\u8f93\u51fa\u6587\u7ae0\uff0c\u4eca\u5929\u6536\u5230\u4e00\u4efd\u7279\u522b\u7684\u5feb\u9012\uff0c\u662f CSDN \u5bc4\u6765\u7684\u5956\u72b6\u3002</p> <p></p> <p>\u9a84\u50b2\u7684\u8bf4\uff0c\u4f60\u4eec\u5173\u6ce8\u7684\u662f CSDN \u9996\u5c4a\u6280\u672f\u539f\u521b\u7b2c\u4e00\u540d\u7684\u535a\u4e3b\uff0c\u4ee5\u540e\u7b80\u5386\u53c8\u53ef\u4ee5\u5439\u725b\u903c\u4e86</p> <p>\u6ca1\u6709\u5566\uff0c\u5176\u5b9e\u4e3b\u8981\u8fd8\u662f\u8c22\u8c22\u4f60\u4eec\u4e0d\u79bb\u4e0d\u5f03\u7684\u652f\u6301\u3002</p> <p>sao</p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/soft_interrupt/","title":"2.6 \u4ec0\u4e48\u662f\u8f6f\u4e2d\u65ad\uff1f","text":"<p>\u4eca\u65e5\u7684\u6280\u672f\u4e3b\u9898\uff1a\u4ec0\u4e48\u662f\u8f6f\u4e2d\u65ad\uff1f\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/soft_interrupt/#_1","title":"\u4e2d\u65ad\u662f\u4ec0\u4e48\uff1f","text":"<p>\u5148\u6765\u770b\u770b\u4ec0\u4e48\u662f\u4e2d\u65ad\uff1f\u5728\u8ba1\u7b97\u673a\u4e2d\uff0c\u4e2d\u65ad\u662f\u7cfb\u7edf\u7528\u6765\u54cd\u5e94\u786c\u4ef6\u8bbe\u5907\u8bf7\u6c42\u7684\u4e00\u79cd\u673a\u5236\uff0c\u64cd\u4f5c\u7cfb\u7edf\u6536\u5230\u786c\u4ef6\u7684\u4e2d\u65ad\u8bf7\u6c42\uff0c\u4f1a\u6253\u65ad\u6b63\u5728\u6267\u884c\u7684\u8fdb\u7a0b\uff0c\u7136\u540e\u8c03\u7528\u5185\u6838\u4e2d\u7684\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u6765\u54cd\u5e94\u8bf7\u6c42\u3002</p> <p>\u8fd9\u6837\u7684\u89e3\u91ca\u53ef\u80fd\u8fc7\u4e8e\u5b66\u672f\u4e86\uff0c\u5bb9\u6613\u4e91\u91cc\u96fe\u91cc\uff0c\u6211\u5c31\u4e3e\u4e2a\u751f\u6d3b\u4e2d\u53d6\u5916\u5356\u7684\u4f8b\u5b50\u3002</p> <p>\u5c0f\u6797\u4e2d\u5348\u642c\u5b8c\u7816\uff0c\u809a\u5b50\u997f\u4e86\uff0c\u70b9\u4e86\u4efd\u767d\u5207\u9e21\u5916\u5356\uff0c\u8fd9\u6b21\u6211\u5e26\u95ea\u4e86\uff0c\u6ca1\u6709\u88ab\u67d0\u56e2\u5927\u6570\u636e\u6740\u719f\u3002\u867d\u7136\u5e73\u53f0\u4e0a\u4f1a\u663e\u793a\u914d\u9001\u8fdb\u5ea6\uff0c\u4f46\u662f\u6211\u4e5f\u4e0d\u80fd\u4e00\u76f4\u50bb\u50bb\u5730\u76ef\u7740\u5440\uff0c\u65f6\u95f4\u5f88\u5b9d\u8d35\uff0c\u5f53\u7136\u5f97\u53bb\u5e72\u522b\u7684\u4e8b\u60c5\uff0c\u7b49\u5916\u5356\u5230\u4e86\u914d\u9001\u5458\u4f1a\u901a\u8fc7\u300c\u7535\u8bdd\u300d\u901a\u77e5\u6211\uff0c\u7535\u8bdd\u54cd\u4e86\uff0c\u6211\u5c31\u4f1a\u505c\u4e0b\u624b\u4e2d\u5730\u4e8b\u60c5\uff0c\u53bb\u62ff\u5916\u5356\u3002</p> <p>\u8fd9\u91cc\u7684\u6253\u7535\u8bdd\uff0c\u5176\u5b9e\u5c31\u662f\u5bf9\u5e94\u8ba1\u7b97\u673a\u91cc\u7684\u4e2d\u65ad\uff0c\u6ca1\u63a5\u5230\u7535\u8bdd\u7684\u65f6\u5019\uff0c\u6211\u53ef\u4ee5\u505a\u5176\u4ed6\u7684\u4e8b\u60c5\uff0c\u53ea\u6709\u63a5\u5230\u4e86\u7535\u8bdd\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u4e2d\u65ad\uff0c\u6211\u624d\u4f1a\u505c\u4e0b\u5f53\u524d\u7684\u4e8b\u60c5\uff0c\u53bb\u8fdb\u884c\u53e6\u4e00\u4e2a\u4e8b\u60c5\uff0c\u4e5f\u5c31\u662f\u62ff\u5916\u5356\u3002</p> <p>\u4ece\u8fd9\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u4e2d\u65ad\u662f\u4e00\u79cd\u5f02\u6b65\u7684\u4e8b\u4ef6\u5904\u7406\u673a\u5236\uff0c\u53ef\u4ee5\u63d0\u9ad8\u7cfb\u7edf\u7684\u5e76\u53d1\u5904\u7406\u80fd\u529b\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u6536\u5230\u4e86\u4e2d\u65ad\u8bf7\u6c42\uff0c\u4f1a\u6253\u65ad\u5176\u4ed6\u8fdb\u7a0b\u7684\u8fd0\u884c\uff0c\u6240\u4ee5\u4e2d\u65ad\u8bf7\u6c42\u7684\u54cd\u5e94\u7a0b\u5e8f\uff0c\u4e5f\u5c31\u662f\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\uff0c\u8981\u5c3d\u53ef\u80fd\u5feb\u7684\u6267\u884c\u5b8c\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u5bf9\u6b63\u5e38\u8fdb\u7a0b\u8fd0\u884c\u8c03\u5ea6\u5730\u5f71\u54cd\u3002</p> <p>\u800c\u4e14\uff0c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5728\u54cd\u5e94\u4e2d\u65ad\u65f6\uff0c\u53ef\u80fd\u8fd8\u4f1a\u300c\u4e34\u65f6\u5173\u95ed\u4e2d\u65ad\u300d\uff0c\u8fd9\u610f\u5473\u7740\uff0c\u5982\u679c\u5f53\u524d\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u6ca1\u6709\u6267\u884c\u5b8c\u4e4b\u524d\uff0c\u7cfb\u7edf\u4e2d\u5176\u4ed6\u7684\u4e2d\u65ad\u8bf7\u6c42\u90fd\u65e0\u6cd5\u88ab\u54cd\u5e94\uff0c\u4e5f\u5c31\u8bf4\u4e2d\u65ad\u6709\u53ef\u80fd\u4f1a\u4e22\u5931\uff0c\u6240\u4ee5\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8981\u77ed\u4e14\u5feb\u3002</p> <p>\u8fd8\u662f\u56de\u5230\u5916\u5356\u7684\u4f8b\u5b50\uff0c\u5c0f\u6797\u5230\u4e86\u665a\u4e0a\u53c8\u70b9\u8d77\u4e86\u5916\u5356\uff0c\u8fd9\u6b21\u4e3a\u4e86\u7292\u52b3\u81ea\u5df1\uff0c\u5171\u70b9\u4e86\u4e24\u4efd\u5916\u5356\uff0c\u4e00\u4efd\u5c0f\u9f99\u867e\u548c\u4e00\u4efd\u5976\u8336\uff0c\u5e76\u4e14\u662f\u7531\u4e0d\u540c\u5730\u914d\u9001\u5458\u6765\u914d\u9001\uff0c\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u5f53\u7b2c\u4e00\u4efd\u5916\u5356\u9001\u5230\u65f6\uff0c\u914d\u9001\u5458\u7ed9\u6211\u6253\u4e86\u957f\u957f\u7684\u7535\u8bdd\uff0c\u8bf4\u4e86\u4e00\u4e9b\u6742\u4e03\u6742\u516b\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u7ed9\u4e2a\u597d\u8bc4\u7b49\u7b49\uff0c\u4f46\u5982\u679c\u8fd9\u65f6\u53e6\u4e00\u4f4d\u914d\u9001\u5458\u4e5f\u60f3\u7ed9\u6211\u6253\u7535\u8bdd\u3002</p> <p>\u5f88\u660e\u663e\uff0c\u8fd9\u65f6\u7b2c\u4e8c\u4f4d\u914d\u9001\u5458\u56e0\u4e3a\u6211\u5728\u901a\u8bdd\u4e2d\uff08\u76f8\u5f53\u4e8e\u5173\u95ed\u4e86\u4e2d\u65ad\u54cd\u5e94\uff09\uff0c\u81ea\u7136\u5c31\u65e0\u6cd5\u6253\u901a\u6211\u7684\u7535\u8bdd\uff0c\u4ed6\u53ef\u80fd\u5c1d\u8bd5\u4e86\u51e0\u6b21\u540e\u5c31\u8d70\u6389\u4e86\uff08\u76f8\u5f53\u4e8e\u4e22\u5931\u4e86\u4e00\u6b21\u4e2d\u65ad\uff09\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/soft_interrupt/#_2","title":"\u4ec0\u4e48\u662f\u8f6f\u4e2d\u65ad\uff1f","text":"<p>\u524d\u9762\u6211\u4eec\u4e5f\u63d0\u5230\u4e86\uff0c\u4e2d\u65ad\u8bf7\u6c42\u7684\u5904\u7406\u7a0b\u5e8f\u5e94\u8be5\u8981\u77ed\u4e14\u5feb\uff0c\u8fd9\u6837\u624d\u80fd\u51cf\u5c11\u5bf9\u6b63\u5e38\u8fdb\u7a0b\u8fd0\u884c\u8c03\u5ea6\u5730\u5f71\u54cd\uff0c\u800c\u4e14\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u53ef\u80fd\u4f1a\u6682\u65f6\u5173\u95ed\u4e2d\u65ad\uff0c\u8fd9\u65f6\u5982\u679c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u6267\u884c\u65f6\u95f4\u8fc7\u957f\uff0c\u53ef\u80fd\u5728\u8fd8\u672a\u6267\u884c\u5b8c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u524d\uff0c\u4f1a\u4e22\u5931\u5f53\u524d\u5176\u4ed6\u8bbe\u5907\u7684\u4e2d\u65ad\u8bf7\u6c42\u3002</p> <p>\u90a3 Linux \u7cfb\u7edf\u4e3a\u4e86\u89e3\u51b3\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u6267\u884c\u8fc7\u957f\u548c\u4e2d\u65ad\u4e22\u5931\u7684\u95ee\u9898\uff0c\u5c06\u4e2d\u65ad\u8fc7\u7a0b\u5206\u6210\u4e86\u4e24\u4e2a\u9636\u6bb5\uff0c\u5206\u522b\u662f\u300c\u4e0a\u534a\u90e8\u548c\u4e0b\u534a\u90e8\u5206\u300d\u3002</p> <ul> <li>\u4e0a\u534a\u90e8\u7528\u6765\u5feb\u901f\u5904\u7406\u4e2d\u65ad\uff0c\u4e00\u822c\u4f1a\u6682\u65f6\u5173\u95ed\u4e2d\u65ad\u8bf7\u6c42\uff0c\u4e3b\u8981\u8d1f\u8d23\u5904\u7406\u8ddf\u786c\u4ef6\u7d27\u5bc6\u76f8\u5173\u6216\u8005\u65f6\u95f4\u654f\u611f\u7684\u4e8b\u60c5\u3002</li> <li>\u4e0b\u534a\u90e8\u7528\u6765\u5ef6\u8fdf\u5904\u7406\u4e0a\u534a\u90e8\u672a\u5b8c\u6210\u7684\u5de5\u4f5c\uff0c\u4e00\u822c\u4ee5\u300c\u5185\u6838\u7ebf\u7a0b\u300d\u7684\u65b9\u5f0f\u8fd0\u884c\u3002</li> </ul> <p>\u524d\u9762\u7684\u5916\u5356\u4f8b\u5b50\uff0c\u7531\u4e8e\u7b2c\u4e00\u4e2a\u914d\u9001\u5458\u957f\u65f6\u95f4\u8ddf\u6211\u901a\u8bdd\uff0c\u5219\u5bfc\u81f4\u7b2c\u4e8c\u4f4d\u914d\u9001\u5458\u65e0\u6cd5\u62e8\u901a\u6211\u7684\u7535\u8bdd\uff0c\u5176\u5b9e\u5f53\u6211\u63a5\u5230\u7b2c\u4e00\u4f4d\u914d\u9001\u5458\u7684\u7535\u8bdd\uff0c\u53ef\u4ee5\u544a\u8bc9\u914d\u9001\u5458\u8bf4\u6211\u73b0\u5728\u4e0b\u697c\uff0c\u5269\u4e0b\u7684\u4e8b\u60c5\uff0c\u7b49\u6211\u4eec\u89c1\u9762\u518d\u8bf4\uff08\u4e0a\u534a\u90e8\uff09\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6302\u65ad\u7535\u8bdd\uff0c\u5230\u697c\u4e0b\u540e\uff0c\u5728\u62ff\u5916\u5356\uff0c\u4ee5\u53ca\u8ddf\u914d\u9001\u5458\u8bf4\u5176\u4ed6\u7684\u4e8b\u60c5\uff08\u4e0b\u534a\u90e8\uff09\u3002</p> <p>\u8fd9\u6837\uff0c\u7b2c\u4e00\u4f4d\u914d\u9001\u5458\u5c31\u4e0d\u4f1a\u5360\u7528\u6211\u624b\u673a\u592a\u591a\u65f6\u95f4\uff0c\u5f53\u7b2c\u4e8c\u4f4d\u914d\u9001\u5458\u6b63\u597d\u8fc7\u6765\u65f6\uff0c\u4f1a\u6709\u5f88\u5927\u51e0\u7387\u62e8\u901a\u6211\u7684\u7535\u8bdd\u3002</p> <p>\u518d\u4e3e\u4e00\u4e2a\u8ba1\u7b97\u673a\u4e2d\u7684\u4f8b\u5b50\uff0c\u5e38\u89c1\u7684\u7f51\u5361\u63a5\u6536\u7f51\u7edc\u5305\u7684\u4f8b\u5b50\u3002</p> <p>\u7f51\u5361\u6536\u5230\u7f51\u7edc\u5305\u540e\uff0c\u901a\u8fc7 DMA \u65b9\u5f0f\u5c06\u63a5\u6536\u5230\u7684\u6570\u636e\u5199\u5165\u5185\u5b58\uff0c\u63a5\u7740\u4f1a\u901a\u8fc7\u786c\u4ef6\u4e2d\u65ad\u901a\u77e5\u5185\u6838\u6709\u65b0\u7684\u6570\u636e\u5230\u4e86\uff0c\u4e8e\u662f\u5185\u6838\u5c31\u4f1a\u8c03\u7528\u5bf9\u5e94\u7684\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u6765\u5904\u7406\u8be5\u4e8b\u4ef6\uff0c\u8fd9\u4e2a\u4e8b\u4ef6\u7684\u5904\u7406\u4e5f\u662f\u4f1a\u5206\u6210\u4e0a\u534a\u90e8\u548c\u4e0b\u534a\u90e8\u3002</p> <p>\u4e0a\u90e8\u5206\u8981\u505a\u7684\u4e8b\u60c5\u5f88\u5c11\uff0c\u4f1a\u5148\u7981\u6b62\u7f51\u5361\u4e2d\u65ad\uff0c\u907f\u514d\u9891\u7e41\u786c\u4e2d\u65ad\uff0c\u800c\u964d\u4f4e\u5185\u6838\u7684\u5de5\u4f5c\u6548\u7387\u3002\u63a5\u7740\uff0c\u5185\u6838\u4f1a\u89e6\u53d1\u4e00\u4e2a\u8f6f\u4e2d\u65ad\uff0c\u628a\u4e00\u4e9b\u5904\u7406\u6bd4\u8f83\u8017\u65f6\u4e14\u590d\u6742\u7684\u4e8b\u60c5\uff0c\u4ea4\u7ed9\u300c\u8f6f\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u300d\u53bb\u505a\uff0c\u4e5f\u5c31\u662f\u4e2d\u65ad\u7684\u4e0b\u534a\u90e8\uff0c\u5176\u4e3b\u8981\u662f\u9700\u8981\u4ece\u5185\u5b58\u4e2d\u627e\u5230\u7f51\u7edc\u6570\u636e\uff0c\u518d\u6309\u7167\u7f51\u7edc\u534f\u8bae\u6808\uff0c\u5bf9\u7f51\u7edc\u6570\u636e\u8fdb\u884c\u9010\u5c42\u89e3\u6790\u548c\u5904\u7406\uff0c\u6700\u540e\u628a\u6570\u636e\u9001\u7ed9\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u6240\u4ee5\uff0c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u7684\u4e0a\u90e8\u5206\u548c\u4e0b\u534a\u90e8\u53ef\u4ee5\u7406\u89e3\u4e3a\uff1a</p> <ul> <li>\u4e0a\u534a\u90e8\u76f4\u63a5\u5904\u7406\u786c\u4ef6\u8bf7\u6c42\uff0c\u4e5f\u5c31\u662f\u786c\u4e2d\u65ad\uff0c\u4e3b\u8981\u662f\u8d1f\u8d23\u8017\u65f6\u77ed\u7684\u5de5\u4f5c\uff0c\u7279\u70b9\u662f\u5feb\u901f\u6267\u884c\uff1b</li> <li>\u4e0b\u534a\u90e8\u662f\u7531\u5185\u6838\u89e6\u53d1\uff0c\u4e5f\u5c31\u8bf4\u8f6f\u4e2d\u65ad\uff0c\u4e3b\u8981\u662f\u8d1f\u8d23\u4e0a\u534a\u90e8\u672a\u5b8c\u6210\u7684\u5de5\u4f5c\uff0c\u901a\u5e38\u90fd\u662f\u8017\u65f6\u6bd4\u8f83\u957f\u7684\u4e8b\u60c5\uff0c\u7279\u70b9\u662f\u5ef6\u8fdf\u6267\u884c\uff1b</li> </ul> <p>\u8fd8\u6709\u4e00\u4e2a\u533a\u522b\uff0c\u786c\u4e2d\u65ad\uff08\u4e0a\u534a\u90e8\uff09\u662f\u4f1a\u6253\u65ad CPU \u6b63\u5728\u6267\u884c\u7684\u4efb\u52a1\uff0c\u7136\u540e\u7acb\u5373\u6267\u884c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\uff0c\u800c\u8f6f\u4e2d\u65ad\uff08\u4e0b\u534a\u90e8\uff09\u662f\u4ee5\u5185\u6838\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6267\u884c\uff0c\u5e76\u4e14\u6bcf\u4e00\u4e2a CPU \u90fd\u5bf9\u5e94\u4e00\u4e2a\u8f6f\u4e2d\u65ad\u5185\u6838\u7ebf\u7a0b\uff0c\u540d\u5b57\u901a\u5e38\u4e3a\u300cksoftirqd/CPU \u7f16\u53f7\u300d\uff0c\u6bd4\u5982 0 \u53f7 CPU \u5bf9\u5e94\u7684\u8f6f\u4e2d\u65ad\u5185\u6838\u7ebf\u7a0b\u7684\u540d\u5b57\u662f <code>ksoftirqd/0</code></p> <p>\u4e0d\u8fc7\uff0c\u8f6f\u4e2d\u65ad\u4e0d\u53ea\u662f\u5305\u62ec\u786c\u4ef6\u8bbe\u5907\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u7684\u4e0b\u534a\u90e8\uff0c\u4e00\u4e9b\u5185\u6838\u81ea\u5b9a\u4e49\u4e8b\u4ef6\u4e5f\u5c5e\u4e8e\u8f6f\u4e2d\u65ad\uff0c\u6bd4\u5982\u5185\u6838\u8c03\u5ea6\u7b49\u3001RCU \u9501\uff08\u5185\u6838\u91cc\u5e38\u7528\u7684\u4e00\u79cd\u9501\uff09\u7b49\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/soft_interrupt/#_3","title":"\u7cfb\u7edf\u91cc\u6709\u54ea\u4e9b\u8f6f\u4e2d\u65ad\uff1f","text":"<p>\u5728 Linux \u7cfb\u7edf\u91cc\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b <code>/proc/softirqs</code> \u7684 \u5185\u5bb9\u6765\u77e5\u6653\u300c\u8f6f\u4e2d\u65ad\u300d\u7684\u8fd0\u884c\u60c5\u51b5\uff0c\u4ee5\u53ca <code>/proc/interrupts</code> \u7684 \u5185\u5bb9\u6765\u77e5\u6653\u300c\u786c\u4e2d\u65ad\u300d\u7684\u8fd0\u884c\u60c5\u51b5\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u6765\u7b80\u5355\u7684\u89e3\u6790\u4e0b  <code>/proc/softirqs</code> \u6587\u4ef6\u7684\u5185\u5bb9\uff0c\u5728\u6211\u670d\u52a1\u5668\u4e0a\u67e5\u770b\u5230\u7684\u6587\u4ef6\u5185\u5bb9\u5982\u4e0b\uff1a</p> <p></p> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u4e00\u4e2a CPU \u90fd\u6709\u81ea\u5df1\u5bf9\u5e94\u7684\u4e0d\u540c\u7c7b\u578b\u8f6f\u4e2d\u65ad\u7684\u7d2f\u8ba1\u8fd0\u884c\u6b21\u6570\uff0c\u6709 3 \u70b9\u9700\u8981\u6ce8\u610f\u4e0b\u3002</p> <p>\u7b2c\u4e00\u70b9\uff0c\u8981\u6ce8\u610f\u7b2c\u4e00\u5217\u7684\u5185\u5bb9\uff0c\u5b83\u662f\u4ee3\u8868\u7740\u8f6f\u4e2d\u65ad\u7684\u7c7b\u578b\uff0c\u5728\u6211\u7684\u7cfb\u7edf\u91cc\uff0c\u8f6f\u4e2d\u65ad\u5305\u62ec\u4e86 10 \u4e2a\u7c7b\u578b\uff0c\u5206\u522b\u5bf9\u5e94\u4e0d\u540c\u7684\u5de5\u4f5c\u7c7b\u578b\uff0c\u6bd4\u5982 <code>NET_RX</code> \u8868\u793a\u7f51\u7edc\u63a5\u6536\u4e2d\u65ad\uff0c<code>NET_TX</code> \u8868\u793a\u7f51\u7edc\u53d1\u9001\u4e2d\u65ad\u3001<code>TIMER</code> \u8868\u793a\u5b9a\u65f6\u4e2d\u65ad\u3001<code>RCU</code> \u8868\u793a RCU \u9501\u4e2d\u65ad\u3001<code>SCHED</code> \u8868\u793a\u5185\u6838\u8c03\u5ea6\u4e2d\u65ad\u3002</p> <p>\u7b2c\u4e8c\u70b9\uff0c\u8981\u6ce8\u610f\u540c\u4e00\u79cd\u7c7b\u578b\u7684\u8f6f\u4e2d\u65ad\u5728\u4e0d\u540c CPU \u7684\u5206\u5e03\u60c5\u51b5\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u540c\u4e00\u79cd\u4e2d\u65ad\u5728\u4e0d\u540c CPU \u4e0a\u7684\u7d2f\u8ba1\u6b21\u6570\u76f8\u5dee\u4e0d\u591a\uff0c\u6bd4\u5982\u6211\u7684\u7cfb\u7edf\u91cc\uff0c<code>NET_RX</code> \u5728 CPU0\u3001CPU1\u3001CPU2\u3001CPU3 \u4e0a\u7684\u4e2d\u65ad\u6b21\u6570\u57fa\u672c\u662f\u540c\u4e00\u4e2a\u6570\u91cf\u7ea7\uff0c\u76f8\u5dee\u4e0d\u591a\u3002</p> <p>\u7b2c\u4e09\u70b9\uff0c\u8fd9\u4e9b\u6570\u503c\u662f\u7cfb\u7edf\u8fd0\u884c\u4ee5\u6765\u7684\u7d2f\u8ba1\u4e2d\u65ad\u6b21\u6570\uff0c\u6570\u503c\u7684\u5927\u5c0f\u6ca1\u4ec0\u4e48\u53c2\u8003\u610f\u4e49\uff0c\u4f46\u662f\u7cfb\u7edf\u7684\u4e2d\u65ad\u6b21\u6570\u7684\u53d8\u5316\u901f\u7387\u624d\u662f\u6211\u4eec\u8981\u5173\u6ce8\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>watch -d cat /proc/softirqs</code> \u547d\u4ee4\u67e5\u770b\u4e2d\u65ad\u6b21\u6570\u7684\u53d8\u5316\u901f\u7387\u3002</p> <p>\u524d\u9762\u63d0\u5230\u8fc7\uff0c\u8f6f\u4e2d\u65ad\u662f\u4ee5\u5185\u6838\u7ebf\u7a0b\u7684\u65b9\u5f0f\u6267\u884c\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 <code>ps</code> \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u5230\uff0c\u4e0b\u9762\u8fd9\u4e2a\u5c31\u662f\u5728\u6211\u7684\u670d\u52a1\u5668\u4e0a\u67e5\u5230\u8f6f\u4e2d\u65ad\u5185\u6838\u7ebf\u7a0b\u7684\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u5185\u6838\u7ebf\u7a0b\u7684\u540d\u5b57\u5916\u9762\u90fd\u6709\u6709\u4e2d\u62ec\u53f7\uff0c\u8fd9\u8bf4\u660e ps \u65e0\u6cd5\u83b7\u53d6\u5b83\u4eec\u7684\u547d\u4ee4\u884c\u53c2\u6570\uff0c\u6240\u4ee5\u4e00\u822c\u6765\u8bf4\uff0c\u540d\u5b57\u5728\u4e2d\u62ec\u53f7\u91cc\u7684\u90fd\u53ef\u4ee5\u8ba4\u4e3a\u662f\u5185\u6838\u7ebf\u7a0b\u3002</p> <p>\u800c\u4e14\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u6709 4 \u4e2a <code>ksoftirqd</code> \u5185\u6838\u7ebf\u7a0b\uff0c\u8fd9\u662f\u56e0\u4e3a\u6211\u8fd9\u53f0\u670d\u52a1\u5668\u7684 CPU \u662f 4 \u6838\u5fc3\u7684\uff0c\u6bcf\u4e2a CPU \u6838\u5fc3\u90fd\u5bf9\u5e94\u7740\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/soft_interrupt/#cpu","title":"\u5982\u4f55\u5b9a\u4f4d\u8f6f\u4e2d\u65ad CPU \u4f7f\u7528\u7387\u8fc7\u9ad8\u7684\u95ee\u9898\uff1f","text":"<p>\u8981\u60f3\u77e5\u9053\u5f53\u524d\u7684\u7cfb\u7edf\u7684\u8f6f\u4e2d\u65ad\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>top</code> \u547d\u4ee4\u67e5\u770b\uff0c\u4e0b\u9762\u662f\u4e00\u53f0\u670d\u52a1\u5668\u4e0a\u7684 top \u7684\u6570\u636e\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u7684\u9ec4\u8272\u90e8\u5206 <code>si</code>\uff0c\u5c31\u662f CPU \u5728\u8f6f\u4e2d\u65ad\u4e0a\u7684\u4f7f\u7528\u7387\uff0c\u800c\u4e14\u53ef\u4ee5\u53d1\u73b0\uff0c\u6bcf\u4e2a CPU \u4f7f\u7528\u7387\u90fd\u4e0d\u9ad8\uff0c\u4e24\u4e2a CPU \u7684\u4f7f\u7528\u7387\u867d\u7136\u53ea\u6709 3% \u548c 4% \u5de6\u53f3\uff0c\u4f46\u662f\u90fd\u662f\u7528\u5728\u8f6f\u4e2d\u65ad\u4e0a\u4e86\u3002</p> <p>\u53e6\u5916\uff0c\u4e5f\u53ef\u4ee5\u770b\u5230 CPU \u4f7f\u7528\u7387\u6700\u9ad8\u7684\u8fdb\u7a0b\u4e5f\u662f\u8f6f\u4e2d\u65ad <code>ksoftirqd</code>\uff0c\u56e0\u6b64\u53ef\u4ee5\u8ba4\u4e3a\u6b64\u65f6\u7cfb\u7edf\u7684\u5f00\u9500\u4e3b\u8981\u6765\u6e90\u4e8e\u8f6f\u4e2d\u65ad\u3002</p> <p>\u5982\u679c\u8981\u77e5\u9053\u662f\u54ea\u79cd\u8f6f\u4e2d\u65ad\u7c7b\u578b\u5bfc\u81f4\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>watch -d cat /proc/softirqs</code> \u547d\u4ee4\u67e5\u770b\u6bcf\u4e2a\u8f6f\u4e2d\u65ad\u7c7b\u578b\u7684\u4e2d\u65ad\u6b21\u6570\u7684\u53d8\u5316\u901f\u7387\u3002</p> <p></p> <p>\u4e00\u822c\u5bf9\u4e8e\u7f51\u7edc I/O \u6bd4\u8f83\u9ad8\u7684 Web \u670d\u52a1\u5668\uff0c<code>NET_RX</code> \u7f51\u7edc\u63a5\u6536\u4e2d\u65ad\u7684\u53d8\u5316\u901f\u7387\u76f8\u6bd4\u5176\u4ed6\u4e2d\u65ad\u7c7b\u578b\u5feb\u5f88\u591a\u3002</p> <p>\u5982\u679c\u53d1\u73b0 <code>NET_RX</code> \u7f51\u7edc\u63a5\u6536\u4e2d\u65ad\u6b21\u6570\u7684\u53d8\u5316\u901f\u7387\u8fc7\u5feb\uff0c\u63a5\u4e0b\u6765\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>sar -n DEV</code> \u67e5\u770b\u7f51\u5361\u7684\u7f51\u7edc\u5305\u63a5\u6536\u901f\u7387\u60c5\u51b5\uff0c\u7136\u540e\u5206\u6790\u662f\u54ea\u4e2a\u7f51\u5361\u6709\u5927\u91cf\u7684\u7f51\u7edc\u5305\u8fdb\u6765\u3002</p> <p></p> <p>\u63a5\u7740\uff0c\u5728\u901a\u8fc7 <code>tcpdump</code> \u6293\u5305\uff0c\u5206\u6790\u8fd9\u4e9b\u5305\u7684\u6765\u6e90\uff0c\u5982\u679c\u662f\u975e\u6cd5\u7684\u5730\u5740\uff0c\u53ef\u4ee5\u8003\u8651\u52a0\u9632\u706b\u5899\uff0c\u5982\u679c\u662f\u6b63\u5e38\u6d41\u91cf\uff0c\u5219\u8981\u8003\u8651\u786c\u4ef6\u5347\u7ea7\u7b49\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/soft_interrupt/#_4","title":"\u603b\u7ed3","text":"<p>\u4e3a\u4e86\u907f\u514d\u7531\u4e8e\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u6267\u884c\u65f6\u95f4\u8fc7\u957f\uff0c\u800c\u5f71\u54cd\u6b63\u5e38\u8fdb\u7a0b\u7684\u8c03\u5ea6\uff0cLinux \u5c06\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u5206\u4e3a\u4e0a\u534a\u90e8\u548c\u4e0b\u534a\u90e8\uff1a</p> <ul> <li>\u4e0a\u534a\u90e8\uff0c\u5bf9\u5e94\u786c\u4e2d\u65ad\uff0c\u7531\u786c\u4ef6\u89e6\u53d1\u4e2d\u65ad\uff0c\u7528\u6765\u5feb\u901f\u5904\u7406\u4e2d\u65ad\uff1b</li> <li>\u4e0b\u534a\u90e8\uff0c\u5bf9\u5e94\u8f6f\u4e2d\u65ad\uff0c\u7531\u5185\u6838\u89e6\u53d1\u4e2d\u65ad\uff0c\u7528\u6765\u5f02\u6b65\u5904\u7406\u4e0a\u534a\u90e8\u672a\u5b8c\u6210\u7684\u5de5\u4f5c\uff1b</li> </ul> <p>Linux \u4e2d\u7684\u8f6f\u4e2d\u65ad\u5305\u62ec\u7f51\u7edc\u6536\u53d1\u3001\u5b9a\u65f6\u3001\u8c03\u5ea6\u3001RCU \u9501\u7b49\u5404\u79cd\u7c7b\u578b\uff0c\u53ef\u4ee5\u901a\u8fc7\u67e5\u770b /proc/softirqs \u6765\u89c2\u5bdf\u8f6f\u4e2d\u65ad\u7684\u7d2f\u8ba1\u4e2d\u65ad\u6b21\u6570\u60c5\u51b5\uff0c\u5982\u679c\u8981\u5b9e\u65f6\u67e5\u770b\u4e2d\u65ad\u6b21\u6570\u7684\u53d8\u5316\u7387\uff0c\u53ef\u4ee5\u4f7f\u7528 watch -d cat /proc/softirqs \u547d\u4ee4\u3002</p> <p>\u6bcf\u4e00\u4e2a CPU \u90fd\u6709\u5404\u81ea\u7684\u8f6f\u4e2d\u65ad\u5185\u6838\u7ebf\u7a0b\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u7528 ps \u547d\u4ee4\u6765\u67e5\u770b\u5185\u6838\u7ebf\u7a0b\uff0c\u4e00\u822c\u540d\u5b57\u5728\u4e2d\u62ec\u53f7\u91cc\u9762\u5230\uff0c\u90fd\u8ba4\u4e3a\u662f\u5185\u6838\u7ebf\u7a0b\u3002</p> <p>\u5982\u679c\u5728 top \u547d\u4ee4\u53d1\u73b0\uff0cCPU \u5728\u8f6f\u4e2d\u65ad\u4e0a\u7684\u4f7f\u7528\u7387\u6bd4\u8f83\u9ad8\uff0c\u800c\u4e14 CPU \u4f7f\u7528\u7387\u6700\u9ad8\u7684\u8fdb\u7a0b\u4e5f\u662f\u8f6f\u4e2d\u65ad ksoftirqd \u7684\u65f6\u5019\uff0c\u8fd9\u79cd\u4e00\u822c\u53ef\u4ee5\u8ba4\u4e3a\u7cfb\u7edf\u7684\u5f00\u9500\u88ab\u8f6f\u4e2d\u65ad\u5360\u636e\u4e86\u3002</p> <p>\u8fd9\u65f6\u6211\u4eec\u5c31\u53ef\u4ee5\u5206\u6790\u662f\u54ea\u79cd\u8f6f\u4e2d\u65ad\u7c7b\u578b\u5bfc\u81f4\u7684\uff0c\u4e00\u822c\u6765\u8bf4\u90fd\u662f\u56e0\u4e3a\u7f51\u7edc\u63a5\u6536\u8f6f\u4e2d\u65ad\u5bfc\u81f4\u7684\uff0c\u5982\u679c\u662f\u7684\u8bdd\uff0c\u53ef\u4ee5\u7528 sar \u547d\u4ee4\u67e5\u770b\u662f\u54ea\u4e2a\u7f51\u5361\u7684\u6709\u5927\u91cf\u7684\u7f51\u7edc\u5305\u63a5\u6536\uff0c\u518d\u7528 tcpdump \u6293\u7f51\u7edc\u5305\uff0c\u505a\u8fdb\u4e00\u6b65\u5206\u6790\u8be5\u7f51\u7edc\u5305\u7684\u6e90\u5934\u662f\u4e0d\u662f\u975e\u6cd5\u5730\u5740\uff0c\u5982\u679c\u662f\u5c31\u9700\u8981\u8003\u8651\u9632\u706b\u5899\u589e\u52a0\u89c4\u5219\uff0c\u5982\u679c\u4e0d\u662f\uff0c\u5219\u8003\u8651\u786c\u4ef6\u5347\u7ea7\u7b49\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/soft_interrupt/#_5","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/","title":"2.2 \u78c1\u76d8\u6bd4\u5185\u5b58\u6162\u51e0\u4e07\u500d\uff1f","text":"<p>\u5927\u5bb6\u5982\u679c\u60f3\u81ea\u5df1\u7ec4\u88c5\u7535\u8111\u7684\u8bdd\uff0c\u80af\u5b9a\u9700\u8981\u8d2d\u4e70\u4e00\u4e2a CPU\uff0c\u4f46\u662f\u5b58\u50a8\u5668\u65b9\u9762\u7684\u8bbe\u5907\uff0c\u5206\u7c7b\u6bd4\u8f83\u591a\uff0c\u90a3\u6211\u4eec\u80af\u5b9a\u4e0d\u80fd\u53ea\u4e70\u4e00\u79cd\u5b58\u50a8\u5668\uff0c\u6bd4\u5982\u4f60\u9664\u4e86\u8981\u4e70\u5185\u5b58\uff0c\u8fd8\u8981\u4e70\u786c\u76d8\uff0c\u800c\u9488\u5bf9\u786c\u76d8\u6211\u4eec\u8fd8\u53ef\u4ee5\u9009\u62e9\u662f\u56fa\u6001\u786c\u76d8\u8fd8\u662f\u673a\u68b0\u786c\u76d8\u3002</p> <p>\u76f8\u4fe1\u5927\u5bb6\u90fd\u77e5\u9053\u5185\u5b58\u548c\u786c\u76d8\u90fd\u5c5e\u4e8e\u8ba1\u7b97\u673a\u7684\u5b58\u50a8\u8bbe\u5907\uff0c\u65ad\u7535\u540e\u5185\u5b58\u7684\u6570\u636e\u662f\u4f1a\u4e22\u5931\u7684\uff0c\u800c\u786c\u76d8\u5219\u4e0d\u4f1a\uff0c\u56e0\u4e3a\u786c\u76d8\u662f\u6301\u4e45\u5316\u5b58\u50a8\u8bbe\u5907\uff0c\u540c\u65f6\u4e5f\u662f\u4e00\u4e2a I/O \u8bbe\u5907\u3002</p> <p>\u4f46\u5176\u5b9e CPU \u5185\u90e8\u4e5f\u6709\u5b58\u50a8\u6570\u636e\u7684\u7ec4\u4ef6\uff0c\u8fd9\u4e2a\u5e94\u8be5\u6bd4\u8f83\u5c11\u4eba\u6ce8\u610f\u5230\uff0c\u6bd4\u5982\u5bc4\u5b58\u5668\u3001CPU L1/L2/L3 Cache \u4e5f\u90fd\u662f\u5c5e\u4e8e\u5b58\u50a8\u8bbe\u5907\uff0c\u53ea\u4e0d\u8fc7\u5b83\u4eec\u80fd\u5b58\u50a8\u7684\u6570\u636e\u975e\u5e38\u5c0f\uff0c\u4f46\u662f\u5b83\u4eec\u56e0\u4e3a\u9760\u8fd1 CPU \u6838\u5fc3\uff0c\u6240\u4ee5\u8bbf\u95ee\u901f\u5ea6\u90fd\u975e\u5e38\u5feb\uff0c\u5feb\u8fc7\u786c\u76d8\u597d\u51e0\u4e2a\u6570\u91cf\u7ea7\u522b\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u90a3\u673a\u68b0\u786c\u76d8\u3001\u56fa\u6001\u786c\u76d8\u3001\u5185\u5b58\u8fd9\u4e09\u4e2a\u5b58\u50a8\u5668\uff0c\u5230\u5e95\u548c CPU L1 Cache \u76f8\u6bd4\u901f\u5ea6\u5dee\u591a\u5c11\u500d\u5462\uff1f</p> <p>\u5728\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u300c\u5b58\u50a8\u5668\u7684\u5c42\u6b21\u7ed3\u6784\u300d\uff0c\u597d\u8ba9\u6211\u4eec\u5bf9\u5b58\u50a8\u5668\u8bbe\u5907\u6709\u4e00\u4e2a\u6574\u4f53\u7684\u8ba4\u8bc6\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#_1","title":"\u5b58\u50a8\u5668\u7684\u5c42\u6b21\u7ed3\u6784","text":"<p>\u6211\u4eec\u60f3\u8c61\u4e2d\u4e00\u4e2a\u573a\u666f\uff0c\u5927\u5b66\u671f\u672b\u51c6\u5907\u8003\u8bd5\u4e86\uff0c\u4f60\u524d\u53bb\u56fe\u4e66\u9986\u4e34\u65f6\u62b1\u4f5b\u811a\u3002\u90a3\u4e48\uff0c\u5728\u770b\u4e66\u7684\u65f6\u5019\uff0c\u6211\u4eec\u7684\u5927\u8111\u4f1a\u601d\u8003\u95ee\u9898\uff0c\u4e5f\u4f1a\u8bb0\u5fc6\u77e5\u8bc6\u70b9\uff0c\u53e6\u5916\u6211\u4eec\u901a\u5e38\u4e5f\u4f1a\u628a\u5e38\u7528\u7684\u4e66\u653e\u5728\u81ea\u5df1\u7684\u684c\u5b50\u4e0a\uff0c\u5f53\u6211\u4eec\u8981\u627e\u4e00\u672c\u4e0d\u5e38\u7528\u7684\u4e66\uff0c\u5219\u4f1a\u53bb\u56fe\u4e66\u9986\u7684\u4e66\u67b6\u627e\u3002</p> <p>\u5c31\u662f\u8fd9\u4e48\u4e00\u4e2a\u5c0f\u5c0f\u7684\u573a\u666f\uff0c\u5df2\u7ecf\u628a\u8ba1\u7b97\u673a\u7684\u5b58\u50a8\u7ed3\u6784\u57fa\u672c\u90fd\u6db5\u76d6\u4e86\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u628a CPU \u6bd4\u55bb\u6210\u6211\u4eec\u7684\u5927\u8111\uff0c\u5927\u8111\u6b63\u5728\u601d\u8003\u7684\u4e1c\u897f\uff0c\u5c31\u597d\u6bd4 CPU \u4e2d\u7684\u5bc4\u5b58\u5668\uff0c\u5904\u7406\u901f\u5ea6\u662f\u6700\u5feb\u7684\uff0c\u4f46\u662f\u80fd\u5b58\u50a8\u7684\u6570\u636e\u4e5f\u662f\u6700\u5c11\u7684\uff0c\u6bd5\u7adf\u6211\u4eec\u4e5f\u4e0d\u80fd\u4e00\u4e0b\u540c\u65f6\u601d\u8003\u592a\u591a\u7684\u4e8b\u60c5\uff0c\u9664\u975e\u4f60\u7ec3\u8fc7\u3002</p> <p>\u6211\u4eec\u5927\u8111\u4e2d\u7684\u8bb0\u5fc6\uff0c\u5c31\u597d\u6bd4 CPU Cache\uff0c\u4e2d\u6587\u79f0\u4e3a CPU \u9ad8\u901f\u7f13\u5b58\uff0c\u5904\u7406\u901f\u5ea6\u76f8\u6bd4\u5bc4\u5b58\u5668\u6162\u4e86\u4e00\u70b9\uff0c\u4f46\u662f\u80fd\u5b58\u50a8\u7684\u6570\u636e\u4e5f\u7a0d\u5fae\u591a\u4e86\u4e00\u4e9b\u3002</p> <p>CPU Cache \u901a\u5e38\u4f1a\u5206\u4e3a L1\u3001L2\u3001L3 \u4e09\u5c42\uff0c\u5176\u4e2d L1 Cache \u901a\u5e38\u5206\u6210\u300c\u6570\u636e\u7f13\u5b58\u300d\u548c\u300c\u6307\u4ee4\u7f13\u5b58\u300d\uff0cL1 \u662f\u8ddd\u79bb CPU \u6700\u8fd1\u7684\uff0c\u56e0\u6b64\u5b83\u6bd4 L2\u3001L3 \u7684\u8bfb\u5199\u901f\u5ea6\u90fd\u5feb\u3001\u5b58\u50a8\u7a7a\u95f4\u90fd\u5c0f\u3002\u6211\u4eec\u5927\u8111\u4e2d\u77ed\u671f\u8bb0\u5fc6\uff0c\u5c31\u597d\u6bd4 L1 Cache\uff0c\u800c\u957f\u671f\u8bb0\u5fc6\u5c31\u597d\u6bd4 L2/L3 Cache\u3002</p> <p>\u5bc4\u5b58\u5668\u548c CPU Cache \u90fd\u662f\u5728 CPU \u5185\u90e8\uff0c\u8ddf CPU \u6328\u7740\u5f88\u8fd1\uff0c\u56e0\u6b64\u5b83\u4eec\u7684\u8bfb\u5199\u901f\u5ea6\u90fd\u76f8\u5f53\u7684\u5feb\uff0c\u4f46\u662f\u80fd\u5b58\u50a8\u7684\u6570\u636e\u5f88\u5c11\uff0c\u6bd5\u7adf CPU \u5c31\u8fd9\u4e48\u4e01\u70b9\u5927\u3002</p> <p>\u77e5\u9053 CPU \u5185\u90e8\u7684\u5b58\u50a8\u5668\u7684\u5c42\u6b21\u5206\u5e03\uff0c\u6211\u4eec\u653e\u773c\u770b\u770b CPU \u5916\u90e8\u7684\u5b58\u50a8\u5668\u3002</p> <p>\u5f53\u6211\u4eec\u5927\u8111\u8bb0\u5fc6\u4e2d\u6ca1\u6709\u8d44\u6599\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4ece\u4e66\u684c\u6216\u4e66\u67b6\u4e0a\u62ff\u4e66\u6765\u9605\u8bfb\uff0c\u90a3\u6211\u4eec\u684c\u5b50\u4e0a\u7684\u4e66\uff0c\u5c31\u597d\u6bd4\u5185\u5b58\uff0c\u6211\u4eec\u867d\u7136\u53ef\u4ee5\u4e00\u4f38\u624b\u5c31\u53ef\u4ee5\u62ff\u5230\uff0c\u4f46\u8bfb\u5199\u901f\u5ea6\u80af\u5b9a\u8fdc\u6162\u4e8e\u5bc4\u5b58\u5668\uff0c\u90a3\u56fe\u4e66\u9986\u4e66\u67b6\u4e0a\u7684\u4e66\uff0c\u5c31\u597d\u6bd4\u786c\u76d8\uff0c\u80fd\u5b58\u50a8\u7684\u6570\u636e\u975e\u5e38\u5927\uff0c\u4f46\u662f\u8bfb\u5199\u901f\u5ea6\u76f8\u6bd4\u5185\u5b58\u5dee\u597d\u51e0\u4e2a\u6570\u91cf\u7ea7\uff0c\u66f4\u522b\u8bf4\u8ddf\u5bc4\u5b58\u5668\u7684\u5dee\u8ddd\u4e86\u3002</p> <p></p> <p>\u6211\u4eec\u4ece\u56fe\u4e66\u9986\u4e66\u67b6\u53d6\u4e66\uff0c\u628a\u4e66\u653e\u5230\u684c\u5b50\u4e0a\uff0c\u518d\u9605\u8bfb\u4e66\uff0c\u6211\u4eec\u5927\u8111\u5c31\u4f1a\u8bb0\u5fc6\u77e5\u8bc6\u70b9\uff0c\u7136\u540e\u518d\u7ecf\u8fc7\u5927\u8111\u601d\u8003\uff0c\u8fd9\u4e00\u7cfb\u5217\u8fc7\u7a0b\u76f8\u5f53\u4e8e\uff0c\u6570\u636e\u4ece\u786c\u76d8\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u518d\u4ece\u5185\u5b58\u52a0\u8f7d\u5230 CPU \u7684\u5bc4\u5b58\u5668\u548c Cache \u4e2d\uff0c\u7136\u540e\u518d\u901a\u8fc7 CPU \u8fdb\u884c\u5904\u7406\u548c\u8ba1\u7b97\u3002</p> <p>\u5bf9\u4e8e\u5b58\u50a8\u5668\uff0c\u5b83\u7684\u901f\u5ea6\u8d8a\u5feb\u3001\u80fd\u8017\u4f1a\u8d8a\u9ad8\u3001\u800c\u4e14\u6750\u6599\u7684\u6210\u672c\u4e5f\u662f\u8d8a\u8d35\u7684\uff0c\u4ee5\u81f3\u4e8e\u901f\u5ea6\u5feb\u7684\u5b58\u50a8\u5668\u7684\u5bb9\u91cf\u90fd\u6bd4\u8f83\u5c0f\u3002</p> <p>CPU \u91cc\u7684\u5bc4\u5b58\u5668\u548c Cache\uff0c\u662f\u6574\u4e2a\u8ba1\u7b97\u673a\u5b58\u50a8\u5668\u4e2d\u4ef7\u683c\u6700\u8d35\u7684\uff0c\u867d\u7136\u5b58\u50a8\u7a7a\u95f4\u5f88\u5c0f\uff0c\u4f46\u662f\u8bfb\u5199\u901f\u5ea6\u662f\u6781\u5feb\u7684\uff0c\u800c\u76f8\u5bf9\u6bd4\u8f83\u4fbf\u5b9c\u7684\u5185\u5b58\u548c\u786c\u76d8\uff0c\u901f\u5ea6\u80af\u5b9a\u6bd4\u4e0d\u4e0a CPU \u5185\u90e8\u7684\u5b58\u50a8\u5668\uff0c\u4f46\u662f\u80fd\u5f25\u8865\u5b58\u50a8\u7a7a\u95f4\u7684\u4e0d\u8db3\u3002</p> <p>\u5b58\u50a8\u5668\u901a\u5e38\u53ef\u4ee5\u5206\u4e3a\u8fd9\u4e48\u51e0\u4e2a\u7ea7\u522b\uff1a</p> <p></p> <ul> <li>\u5bc4\u5b58\u5668\uff1b</li> <li>CPU Cache\uff1b</li> <li>L1-Cache\uff1b</li> <li>L2-Cache\uff1b</li> <li>L3-Cahce\uff1b</li> <li>\u5185\u5b58\uff1b</li> <li>SSD/HDD \u786c\u76d8</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#_2","title":"\u5bc4\u5b58\u5668","text":"<p>\u6700\u9760\u8fd1 CPU \u7684\u63a7\u5236\u5355\u5143\u548c\u903b\u8f91\u8ba1\u7b97\u5355\u5143\u7684\u5b58\u50a8\u5668\uff0c\u5c31\u662f\u5bc4\u5b58\u5668\u4e86\uff0c\u5b83\u4f7f\u7528\u7684\u6750\u6599\u901f\u5ea6\u4e5f\u662f\u6700\u5feb\u7684\uff0c\u56e0\u6b64\u4ef7\u683c\u4e5f\u662f\u6700\u8d35\u7684\uff0c\u90a3\u4e48\u6570\u91cf\u4e0d\u80fd\u5f88\u591a\u3002</p> <p>\u5b58\u50a8\u5668\u7684\u6570\u91cf\u901a\u5e38\u5728\u51e0\u5341\u5230\u51e0\u767e\u4e4b\u95f4\uff0c\u6bcf\u4e2a\u5bc4\u5b58\u5668\u53ef\u4ee5\u7528\u6765\u5b58\u50a8\u4e00\u5b9a\u7684\u5b57\u8282\uff08byte\uff09\u7684\u6570\u636e\u3002\u6bd4\u5982\uff1a</p> <ul> <li>32 \u4f4d CPU \u4e2d\u5927\u591a\u6570\u5bc4\u5b58\u5668\u53ef\u4ee5\u5b58\u50a8 <code>4</code> \u4e2a\u5b57\u8282\uff1b</li> <li>64 \u4f4d CPU \u4e2d\u5927\u591a\u6570\u5bc4\u5b58\u5668\u53ef\u4ee5\u5b58\u50a8 <code>8</code> \u4e2a\u5b57\u8282\u3002</li> </ul> <p>\u5bc4\u5b58\u5668\u7684\u8bbf\u95ee\u901f\u5ea6\u975e\u5e38\u5feb\uff0c\u4e00\u822c\u8981\u6c42\u5728\u534a\u4e2a CPU \u65f6\u949f\u5468\u671f\u5185\u5b8c\u6210\u8bfb\u5199\uff0cCPU \u65f6\u949f\u5468\u671f\u8ddf CPU \u4e3b\u9891\u606f\u606f\u76f8\u5173\uff0c\u6bd4\u5982 2 GHz \u4e3b\u9891\u7684 CPU\uff0c\u90a3\u4e48\u5b83\u7684\u65f6\u949f\u5468\u671f\u5c31\u662f 1/2G\uff0c\u4e5f\u5c31\u662f 0.5ns\uff08\u7eb3\u79d2\uff09\u3002</p> <p>CPU \u5904\u7406\u4e00\u6761\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u9664\u4e86\u8bfb\u5199\u5bc4\u5b58\u5668\uff0c\u8fd8\u9700\u8981\u89e3\u7801\u6307\u4ee4\u3001\u63a7\u5236\u6307\u4ee4\u6267\u884c\u548c\u8ba1\u7b97\u3002\u5982\u679c\u5bc4\u5b58\u5668\u7684\u901f\u5ea6\u592a\u6162\uff0c\u5219\u4f1a\u62c9\u957f\u6307\u4ee4\u7684\u5904\u7406\u5468\u671f\uff0c\u4ece\u800c\u7ed9\u7528\u6237\u7684\u611f\u89c9\uff0c\u5c31\u662f\u7535\u8111\u300c\u5f88\u6162\u300d\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#cpu-cache","title":"CPU Cache","text":"<p>CPU Cache \u7528\u7684\u662f\u4e00\u79cd\u53eb SRAM\uff08Static Random-Access Memory\uff0c\u9759\u6001\u968f\u673a\u5b58\u50a8\u5668\uff09 \u7684\u82af\u7247\u3002</p> <p>SRAM \u4e4b\u6240\u4ee5\u53eb\u300c\u9759\u6001\u300d\u5b58\u50a8\u5668\uff0c\u662f\u56e0\u4e3a\u53ea\u8981\u6709\u7535\uff0c\u6570\u636e\u5c31\u53ef\u4ee5\u4fdd\u6301\u5b58\u5728\uff0c\u800c\u4e00\u65e6\u65ad\u7535\uff0c\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u4e86\u3002</p> <p>\u5728 SRAM \u91cc\u9762\uff0c\u4e00\u4e2a bit \u7684\u6570\u636e\uff0c\u901a\u5e38\u9700\u8981 6 \u4e2a\u6676\u4f53\u7ba1\uff0c\u6240\u4ee5 SRAM \u7684\u5b58\u50a8\u5bc6\u5ea6\u4e0d\u9ad8\uff0c\u540c\u6837\u7684\u7269\u7406\u7a7a\u95f4\u4e0b\uff0c\u80fd\u5b58\u50a8\u7684\u6570\u636e\u662f\u6709\u9650\u7684\uff0c\u4e0d\u8fc7\u4e5f\u56e0\u4e3a SRAM \u7684\u7535\u8def\u7b80\u5355\uff0c\u6240\u4ee5\u8bbf\u95ee\u901f\u5ea6\u975e\u5e38\u5feb\u3002</p> <p>CPU \u7684\u9ad8\u901f\u7f13\u5b58\uff0c\u901a\u5e38\u53ef\u4ee5\u5206\u4e3a L1\u3001L2\u3001L3 \u8fd9\u6837\u7684\u4e09\u5c42\u9ad8\u901f\u7f13\u5b58\uff0c\u4e5f\u79f0\u4e3a\u4e00\u7ea7\u7f13\u5b58\u3001\u4e8c\u7ea7\u7f13\u5b58\u3001\u4e09\u7ea7\u7f13\u5b58\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#l1","title":"L1 \u9ad8\u901f\u7f13\u5b58","text":"<p>L1 \u9ad8\u901f\u7f13\u5b58\u7684\u8bbf\u95ee\u901f\u5ea6\u51e0\u4e4e\u548c\u5bc4\u5b58\u5668\u4e00\u6837\u5feb\uff0c\u901a\u5e38\u53ea\u9700\u8981 <code>2~4</code> \u4e2a\u65f6\u949f\u5468\u671f\uff0c\u800c\u5927\u5c0f\u5728\u51e0\u5341 KB \u5230\u51e0\u767e KB \u4e0d\u7b49\u3002</p> <p>\u6bcf\u4e2a CPU \u6838\u5fc3\u90fd\u6709\u4e00\u5757\u5c5e\u4e8e\u81ea\u5df1\u7684 L1 \u9ad8\u901f\u7f13\u5b58\uff0c\u6307\u4ee4\u548c\u6570\u636e\u5728 L1 \u662f\u5206\u5f00\u5b58\u653e\u7684\uff0c\u6240\u4ee5 L1 \u9ad8\u901f\u7f13\u5b58\u901a\u5e38\u5206\u6210\u6307\u4ee4\u7f13\u5b58\u548c\u6570\u636e\u7f13\u5b58\u3002</p> <p>\u5728 Linux \u7cfb\u7edf\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u6761\u547d\u4ee4\uff0c\u67e5\u770b CPU \u91cc\u7684 L1 Cache\u300c\u6570\u636e\u300d\u7f13\u5b58\u7684\u5bb9\u91cf\u5927\u5c0f\uff1a</p> Bash<pre><code>$ cat /sys/devices/system/cpu/cpu0/cache/index0/size\n32K\n</code></pre> <p>\u800c\u67e5\u770b L1 Cache\u300c\u6307\u4ee4\u300d\u7f13\u5b58\u7684\u5bb9\u91cf\u5927\u5c0f\uff0c\u5219\u662f\uff1a</p> Bash<pre><code>$ cat /sys/devices/system/cpu/cpu0/cache/index1/size\n32K\n</code></pre>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#l2","title":"L2 \u9ad8\u901f\u7f13\u5b58","text":"<p>L2 \u9ad8\u901f\u7f13\u5b58\u540c\u6837\u6bcf\u4e2a CPU \u6838\u5fc3\u90fd\u6709\uff0c\u4f46\u662f L2 \u9ad8\u901f\u7f13\u5b58\u4f4d\u7f6e\u6bd4 L1 \u9ad8\u901f\u7f13\u5b58\u8ddd\u79bb CPU \u6838\u5fc3 \u66f4\u8fdc\uff0c\u5b83\u5927\u5c0f\u6bd4 L1 \u9ad8\u901f\u7f13\u5b58\u66f4\u5927\uff0cCPU \u578b\u53f7\u4e0d\u540c\u5927\u5c0f\u4e5f\u5c31\u4e0d\u540c\uff0c\u901a\u5e38\u5927\u5c0f\u5728\u51e0\u767e KB \u5230\u51e0 MB \u4e0d\u7b49\uff0c\u8bbf\u95ee\u901f\u5ea6\u5219\u66f4\u6162\uff0c\u901f\u5ea6\u5728 <code>10~20</code> \u4e2a\u65f6\u949f\u5468\u671f\u3002</p> <p>\u5728 Linux \u7cfb\u7edf\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u6761\u547d\u4ee4\uff0c\u67e5\u770b CPU \u91cc\u7684 L2 Cache \u7684\u5bb9\u91cf\u5927\u5c0f\uff1a</p> Bash<pre><code>$ cat /sys/devices/system/cpu/cpu0/cache/index2/size\n256K\n</code></pre>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#l3","title":"L3 \u9ad8\u901f\u7f13\u5b58","text":"<p>L3 \u9ad8\u901f\u7f13\u5b58\u901a\u5e38\u662f\u591a\u4e2a CPU \u6838\u5fc3\u5171\u7528\u7684\uff0c\u4f4d\u7f6e\u6bd4 L2 \u9ad8\u901f\u7f13\u5b58\u8ddd\u79bb CPU \u6838\u5fc3 \u66f4\u8fdc\uff0c\u5927\u5c0f\u4e5f\u4f1a\u66f4\u5927\u4e9b\uff0c\u901a\u5e38\u5927\u5c0f\u5728\u51e0 MB \u5230\u51e0\u5341 MB \u4e0d\u7b49\uff0c\u5177\u4f53\u503c\u6839\u636e CPU \u578b\u53f7\u800c\u5b9a\u3002</p> <p>\u8bbf\u95ee\u901f\u5ea6\u76f8\u5bf9\u4e5f\u6bd4\u8f83\u6162\u4e00\u4e9b\uff0c\u8bbf\u95ee\u901f\u5ea6\u5728 <code>20~60</code>\u4e2a\u65f6\u949f\u5468\u671f\u3002</p> <p>\u5728 Linux \u7cfb\u7edf\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8fd9\u6761\u547d\u4ee4\uff0c\u67e5\u770b CPU \u91cc\u7684 L3 Cache \u7684\u5bb9\u91cf\u5927\u5c0f\uff1a</p> Bash<pre><code>$ cat /sys/devices/system/cpu/cpu0/cache/index3/size \n3072K\n</code></pre>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#_3","title":"\u5185\u5b58","text":"<p>\u5185\u5b58\u7528\u7684\u82af\u7247\u548c CPU Cache \u6709\u6240\u4e0d\u540c\uff0c\u5b83\u4f7f\u7528\u7684\u662f\u4e00\u79cd\u53eb\u4f5c DRAM \uff08Dynamic Random Access Memory\uff0c\u52a8\u6001\u968f\u673a\u5b58\u53d6\u5b58\u50a8\u5668\uff09 \u7684\u82af\u7247\u3002</p> <p>\u76f8\u6bd4 SRAM\uff0cDRAM \u7684\u5bc6\u5ea6\u66f4\u9ad8\uff0c\u529f\u8017\u66f4\u4f4e\uff0c\u6709\u66f4\u5927\u7684\u5bb9\u91cf\uff0c\u800c\u4e14\u9020\u4ef7\u6bd4 SRAM \u82af\u7247\u4fbf\u5b9c\u5f88\u591a\u3002</p> <p>DRAM \u5b58\u50a8\u4e00\u4e2a bit \u6570\u636e\uff0c\u53ea\u9700\u8981\u4e00\u4e2a\u6676\u4f53\u7ba1\u548c\u4e00\u4e2a\u7535\u5bb9\u5c31\u80fd\u5b58\u50a8\uff0c\u4f46\u662f\u56e0\u4e3a\u6570\u636e\u4f1a\u88ab\u5b58\u50a8\u5728\u7535\u5bb9\u91cc\uff0c\u7535\u5bb9\u4f1a\u4e0d\u65ad\u6f0f\u7535\uff0c\u6240\u4ee5\u9700\u8981\u300c\u5b9a\u65f6\u5237\u65b0\u300d\u7535\u5bb9\uff0c\u624d\u80fd\u4fdd\u8bc1\u6570\u636e\u4e0d\u4f1a\u88ab\u4e22\u5931\uff0c\u8fd9\u5c31\u662f DRAM \u4e4b\u6240\u4ee5\u88ab\u79f0\u4e3a\u300c\u52a8\u6001\u300d\u5b58\u50a8\u5668\u7684\u539f\u56e0\uff0c\u53ea\u6709\u4e0d\u65ad\u5237\u65b0\uff0c\u6570\u636e\u624d\u80fd\u88ab\u5b58\u50a8\u8d77\u6765\u3002</p> <p>DRAM \u7684\u6570\u636e\u8bbf\u95ee\u7535\u8def\u548c\u5237\u65b0\u7535\u8def\u90fd\u6bd4 SRAM \u66f4\u590d\u6742\uff0c\u6240\u4ee5\u8bbf\u95ee\u7684\u901f\u5ea6\u4f1a\u66f4\u6162\uff0c\u5185\u5b58\u901f\u5ea6\u5927\u6982\u5728 <code>200~300</code> \u4e2a \u65f6\u949f\u5468\u671f\u4e4b\u95f4\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#ssdhdd","title":"SSD/HDD \u786c\u76d8","text":"<p>SSD\uff08Solid-state disk\uff09\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u56fa\u4f53\u786c\u76d8\uff0c\u7ed3\u6784\u548c\u5185\u5b58\u7c7b\u4f3c\uff0c\u4f46\u662f\u5b83\u76f8\u6bd4\u5185\u5b58\u7684\u4f18\u70b9\u662f\u65ad\u7535\u540e\u6570\u636e\u8fd8\u662f\u5b58\u5728\u7684\uff0c\u800c\u5185\u5b58\u3001\u5bc4\u5b58\u5668\u3001\u9ad8\u901f\u7f13\u5b58\u65ad\u7535\u540e\u6570\u636e\u90fd\u4f1a\u4e22\u5931\u3002\u5185\u5b58\u7684\u8bfb\u5199\u901f\u5ea6\u6bd4 SSD \u5927\u6982\u5feb <code>10~1000</code> \u500d\u3002</p> <p>\u5f53\u7136\uff0c\u8fd8\u6709\u4e00\u6b3e\u4f20\u7edf\u7684\u786c\u76d8\uff0c\u4e5f\u5c31\u662f\u673a\u68b0\u786c\u76d8\uff08Hard Disk Drive, HDD\uff09\uff0c\u5b83\u662f\u901a\u8fc7\u7269\u7406\u8bfb\u5199\u7684\u65b9\u5f0f\u6765\u8bbf\u95ee\u6570\u636e\u7684\uff0c\u56e0\u6b64\u5b83\u8bbf\u95ee\u901f\u5ea6\u662f\u975e\u5e38\u6162\u7684\uff0c\u5b83\u7684\u901f\u5ea6\u6bd4\u5185\u5b58\u6162 <code>10W</code> \u500d\u5de6\u53f3\u3002</p> <p>\u7531\u4e8e SSD \u7684\u4ef7\u683c\u5feb\u63a5\u8fd1\u673a\u68b0\u786c\u76d8\u4e86\uff0c\u56e0\u6b64\u673a\u68b0\u786c\u76d8\u5df2\u7ecf\u9010\u6e10\u88ab SSD \u66ff\u4ee3\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#_4","title":"\u5b58\u50a8\u5668\u7684\u5c42\u6b21\u5173\u7cfb","text":"<p>\u73b0\u4ee3\u7684\u4e00\u53f0\u8ba1\u7b97\u673a\uff0c\u90fd\u7528\u4e0a\u4e86 CPU Cahce\u3001\u5185\u5b58\u3001\u5230 SSD \u6216 HDD \u786c\u76d8\u8fd9\u4e9b\u5b58\u50a8\u5668\u8bbe\u5907\u4e86\u3002</p> <p>\u5176\u4e2d\uff0c\u5b58\u50a8\u7a7a\u95f4\u8d8a\u5927\u7684\u5b58\u50a8\u5668\u8bbe\u5907\uff0c\u5176\u8bbf\u95ee\u901f\u5ea6\u8d8a\u6162\uff0c\u6240\u9700\u6210\u672c\u4e5f\u76f8\u5bf9\u8d8a\u5c11\u3002</p> <p>CPU \u5e76\u4e0d\u4f1a\u76f4\u63a5\u548c\u6bcf\u4e00\u79cd\u5b58\u50a8\u5668\u8bbe\u5907\u76f4\u63a5\u6253\u4ea4\u9053\uff0c\u800c\u662f\u6bcf\u4e00\u79cd\u5b58\u50a8\u5668\u8bbe\u5907\u53ea\u548c\u5b83\u76f8\u90bb\u7684\u5b58\u50a8\u5668\u8bbe\u5907\u6253\u4ea4\u9053\u3002</p> <p>\u6bd4\u5982\uff0cCPU Cache \u7684\u6570\u636e\u662f\u4ece\u5185\u5b58\u52a0\u8f7d\u8fc7\u6765\u7684\uff0c\u5199\u56de\u6570\u636e\u7684\u65f6\u5019\u4e5f\u53ea\u5199\u56de\u5230\u5185\u5b58\uff0cCPU Cache \u4e0d\u4f1a\u76f4\u63a5\u628a\u6570\u636e\u5199\u5230\u786c\u76d8\uff0c\u4e5f\u4e0d\u4f1a\u76f4\u63a5\u4ece\u786c\u76d8\u52a0\u8f7d\u6570\u636e\uff0c\u800c\u662f\u5148\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u518d\u4ece\u5185\u5b58\u52a0\u8f7d\u5230 CPU Cache \u4e2d\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u6bcf\u4e2a\u5b58\u50a8\u5668\u53ea\u548c\u76f8\u90bb\u7684\u4e00\u5c42\u5b58\u50a8\u5668\u8bbe\u5907\u6253\u4ea4\u9053\uff0c\u5e76\u4e14\u5b58\u50a8\u8bbe\u5907\u4e3a\u4e86\u8ffd\u6c42\u66f4\u5feb\u7684\u901f\u5ea6\uff0c\u6240\u9700\u7684\u6750\u6599\u6210\u672c\u5fc5\u7136\u4e5f\u662f\u66f4\u9ad8\uff0c\u4e5f\u6b63\u56e0\u4e3a\u6210\u672c\u592a\u9ad8\uff0c\u6240\u4ee5 CPU \u5185\u90e8\u7684\u5bc4\u5b58\u5668\u3001L1\\L2\\L3 Cache \u53ea\u597d\u7528\u8f83\u5c0f\u7684\u5bb9\u91cf\uff0c\u76f8\u53cd\u5185\u5b58\u3001\u786c\u76d8\u5219\u53ef\u7528\u66f4\u5927\u7684\u5bb9\u91cf\uff0c\u8fd9\u5c31\u6211\u4eec\u4eca\u5929\u6240\u8bf4\u7684\u5b58\u50a8\u5668\u5c42\u6b21\u7ed3\u6784\u3002</p> <p>\u53e6\u5916\uff0c\u5f53 CPU \u9700\u8981\u8bbf\u95ee\u5185\u5b58\u4e2d\u67d0\u4e2a\u6570\u636e\u7684\u65f6\u5019\uff0c\u5982\u679c\u5bc4\u5b58\u5668\u6709\u8fd9\u4e2a\u6570\u636e\uff0cCPU \u5c31\u76f4\u63a5\u4ece\u5bc4\u5b58\u5668\u53d6\u6570\u636e\u5373\u53ef\uff0c\u5982\u679c\u5bc4\u5b58\u5668\u6ca1\u6709\u8fd9\u4e2a\u6570\u636e\uff0cCPU \u5c31\u4f1a\u67e5\u8be2 L1 \u9ad8\u901f\u7f13\u5b58\uff0c\u5982\u679c L1 \u6ca1\u6709\uff0c\u5219\u67e5\u8be2 L2 \u9ad8\u901f\u7f13\u5b58\uff0cL2 \u8fd8\u662f\u6ca1\u6709\u7684\u8bdd\u5c31\u67e5\u8be2 L3 \u9ad8\u901f\u7f13\u5b58\uff0cL3 \u4f9d\u7136\u6ca1\u6709\u7684\u8bdd\uff0c\u624d\u53bb\u5185\u5b58\u4e2d\u53d6\u6570\u636e\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u5b58\u50a8\u5c42\u6b21\u7ed3\u6784\u4e5f\u5f62\u6210\u4e86\u7f13\u5b58\u7684\u4f53\u7cfb\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#_5","title":"\u5b58\u50a8\u5668\u4e4b\u95f4\u7684\u5b9e\u9645\u4ef7\u683c\u548c\u6027\u80fd\u5dee\u8ddd","text":"<p>\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u901f\u5ea6\u8d8a\u5feb\u7684\u5b58\u50a8\u5668\uff0c\u9020\u4ef7\u6210\u672c\u5f80\u5f80\u4e5f\u8d8a\u9ad8\uff0c\u90a3\u6211\u4eec\u5c31\u4ee5\u5b9e\u9645\u7684\u6570\u636e\u6765\u770b\u770b\uff0c\u4e0d\u540c\u5c42\u7ea7\u7684\u5b58\u50a8\u5668\u4e4b\u95f4\u7684\u6027\u80fd\u548c\u4ef7\u683c\u5dee\u5f02\u3002</p> <p>\u4e0b\u9762\u8fd9\u5f20\u8868\u683c\u662f\u4e0d\u540c\u5c42\u7ea7\u7684\u5b58\u50a8\u5668\u4e4b\u95f4\u7684\u6210\u672c\u5bf9\u6bd4\u56fe\uff1a</p> <p></p> <p>\u4f60\u53ef\u4ee5\u770b\u5230 L1 Cache \u7684\u8bbf\u95ee\u5ef6\u65f6\u662f 1 \u7eb3\u79d2\uff0c\u800c\u5185\u5b58\u5df2\u7ecf\u662f 100 \u7eb3\u79d2\u4e86\uff0c\u76f8\u6bd4 L1 Cache \u901f\u5ea6\u6162\u4e86 <code>100</code> \u500d\u3002\u53e6\u5916\uff0c\u673a\u68b0\u786c\u76d8\u7684\u8bbf\u95ee\u5ef6\u65f6\u66f4\u662f\u9ad8\u8fbe 10 \u6beb\u79d2\uff0c\u76f8\u6bd4 L1 Cache \u901f\u5ea6\u6162\u4e86 <code>10000000</code> \u500d\uff0c\u5dee\u4e86\u597d\u51e0\u4e2a\u6570\u91cf\u7ea7\u522b\u3002</p> <p>\u5728\u4ef7\u683c\u4e0a\uff0c\u6bcf\u751f\u6210 MB \u5927\u5c0f\u7684 L1 Cache \u76f8\u6bd4\u5185\u5b58\u8d35\u4e86 <code>466</code> \u500d\uff0c\u76f8\u6bd4\u673a\u68b0\u786c\u76d8\u90a3\u66f4\u662f\u8d35\u4e86 <code>175000</code> \u500d\u3002</p> <p>\u6211\u5728\u67d0\u4e1c\u901b\u4e86\u4e0b\u5404\u4e2a\u5b58\u50a8\u5668\u8bbe\u5907\u7684\u96f6\u552e\u4ef7\uff0c8G \u5185\u5b58 + 1T \u673a\u68b0\u786c\u76d8 + 256G \u56fa\u6001\u786c\u76d8\u7684\u603b\u4ef7\u683c\uff0c\u90fd\u4e0d\u53ca\u4e00\u5757 Intle i5-10400 \u7684 CPU \u7684\u4ef7\u683c\uff0c\u8fd9\u6b3e CPU \u7684\u9ad8\u901f\u7f13\u5b58\u7684\u603b\u5927\u5c0f\u4e5f\u5c31\u5341\u591a MB\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#_6","title":"\u603b\u7ed3","text":"<p>\u5404\u79cd\u5b58\u50a8\u5668\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u53ef\u4ee5\u7528\u6211\u4eec\u5728\u56fe\u4e66\u9986\u5b66\u4e60\u8fd9\u4e2a\u573a\u666f\u6765\u7406\u89e3\u3002</p> <p>CPU \u53ef\u4ee5\u6bd4\u55bb\u6210\u6211\u4eec\u7684\u5927\u8111\uff0c\u6211\u4eec\u5f53\u524d\u6b63\u5728\u601d\u8003\u548c\u5904\u7406\u7684\u77e5\u8bc6\u7684\u8fc7\u7a0b\uff0c\u5c31\u597d\u6bd4 CPU \u4e2d\u7684\u5bc4\u5b58\u5668\u5904\u7406\u6570\u636e\u7684\u8fc7\u7a0b\uff0c\u901f\u5ea6\u6781\u5feb\uff0c\u4f46\u662f\u5bb9\u91cf\u5f88\u5c0f\u3002\u800c CPU \u4e2d\u7684 L1-L3 Cache \u597d\u6bd4\u6211\u4eec\u5927\u8111\u4e2d\u7684\u77ed\u671f\u8bb0\u5fc6\u548c\u957f\u671f\u8bb0\u5fc6\uff0c\u9700\u8981\u5c0f\u5c0f\u82b1\u8d39\u70b9\u65f6\u95f4\u6765\u8c03\u53d6\u6570\u636e\u5e76\u5904\u7406\u3002</p> <p>\u6211\u4eec\u9762\u524d\u7684\u684c\u5b50\u5c31\u76f8\u5f53\u4e8e\u5185\u5b58\uff0c\u80fd\u653e\u4e0b\u66f4\u591a\u7684\u4e66\uff08\u6570\u636e\uff09\uff0c\u4f46\u662f\u627e\u8d77\u6765\u548c\u770b\u8d77\u6765\u5c31\u8981\u82b1\u8d39\u4e00\u4e9b\u65f6\u95f4\uff0c\u76f8\u6bd4 CPU Cache \u6162\u4e0d\u5c11\u3002\u800c\u56fe\u4e66\u9986\u7684\u4e66\u67b6\u76f8\u5f53\u4e8e\u786c\u76d8\uff0c\u80fd\u653e\u4e0b\u6bd4\u5185\u5b58\u66f4\u591a\u7684\u6570\u636e\uff0c\u4f46\u627e\u8d77\u6765\u5c31\u66f4\u8d39\u65f6\u95f4\u4e86\uff0c\u53ef\u4ee5\u8bf4\u662f\u6700\u6162\u7684\u5b58\u50a8\u5668\u8bbe\u5907\u4e86\u3002</p> <p>\u4ece \u5bc4\u5b58\u5668\u3001CPU Cache\uff0c\u5230\u5185\u5b58\u3001\u786c\u76d8\uff0c\u8fd9\u6837\u4e00\u5c42\u5c42\u4e0b\u6765\u7684\u5b58\u50a8\u5668\uff0c\u8bbf\u95ee\u901f\u5ea6\u8d8a\u6765\u8d8a\u6162\uff0c\u5b58\u50a8\u5bb9\u91cf\u8d8a\u6765\u8d8a\u5927\uff0c\u4ef7\u683c\u4e5f\u8d8a\u6765\u8d8a\u4fbf\u5b9c\uff0c\u800c\u4e14\u6bcf\u4e2a\u5b58\u50a8\u5668\u53ea\u548c\u76f8\u90bb\u7684\u4e00\u5c42\u5b58\u50a8\u5668\u8bbe\u5907\u6253\u4ea4\u9053\uff0c\u4e8e\u662f\u8fd9\u6837\u5c31\u5f62\u6210\u4e86\u5b58\u50a8\u5668\u7684\u5c42\u6b21\u7ed3\u6784\u3002</p> <p>\u518d\u6765\u56de\u7b54\uff0c\u5f00\u5934\u7684\u95ee\u9898\uff1a\u90a3\u673a\u68b0\u786c\u76d8\u3001\u56fa\u6001\u786c\u76d8\u3001\u5185\u5b58\u8fd9\u4e09\u4e2a\u5b58\u50a8\u5668\uff0c\u5230\u5e95\u548c <code>CPU L1 Cache</code> \u76f8\u6bd4\u901f\u5ea6\u5dee\u591a\u5c11\u500d\u5462\uff1f</p> <p>CPU L1 Cache \u968f\u673a\u8bbf\u95ee\u5ef6\u65f6\u662f 1 \u7eb3\u79d2\uff0c\u5185\u5b58\u5219\u662f 100 \u7eb3\u79d2\uff0c\u6240\u4ee5 CPU L1 Cache \u6bd4\u5185\u5b58\u5feb <code>100</code> \u500d\u5de6\u53f3\u3002</p> <p>SSD \u968f\u673a\u8bbf\u95ee\u5ef6\u65f6\u662f 150 \u5fae\u79d2\uff0c\u6240\u4ee5 CPU L1 Cache \u6bd4 SSD \u5feb <code>150000</code> \u500d\u5de6\u53f3\u3002</p> <p>\u6700\u6162\u7684\u673a\u68b0\u786c\u76d8\u968f\u673a\u8bbf\u95ee\u5ef6\u65f6\u5df2\u7ecf\u9ad8\u8fbe 10 \u6beb\u79d2\uff0c\u6211\u4eec\u6765\u770b\u770b\u673a\u68b0\u786c\u76d8\u5230\u5e95\u6709\u591a\u300c\u9f9f\u901f\u300d\uff1a</p> <ul> <li>SSD \u6bd4\u673a\u68b0\u786c\u76d8\u5feb 70 \u500d\u5de6\u53f3\uff1b</li> <li>\u5185\u5b58\u6bd4\u673a\u68b0\u786c\u76d8\u5feb 100000 \u500d\u5de6\u53f3\uff1b</li> <li>CPU L1 Cache \u6bd4\u673a\u68b0\u786c\u76d8\u5feb 10000000 \u500d\u5de6\u53f3\uff1b</li> </ul> <p>\u6211\u4eec\u628a\u4e0a\u8ff0\u7684\u65f6\u95f4\u6bd4\u4f8b\u5dee\u5f02\u653e\u5927\u540e\uff0c\u5c31\u80fd\u975e\u5e38\u76f4\u89c2\u611f\u53d7\u5230\u5b83\u4eec\u7684\u6027\u80fd\u5dee\u5f02\u4e86\u3002\u5982\u679c CPU \u8bbf\u95ee L1 Cache \u7684\u7f13\u5b58\u65f6\u95f4\u662f 1 \u79d2\uff0c\u90a3\u8bbf\u95ee\u5185\u5b58\u5219\u9700\u8981\u5927\u7ea6 2 \u5206\u949f\uff0c\u968f\u673a\u8bbf\u95ee SSD \u91cc\u7684\u6570\u636e\u5219\u9700\u8981 1.7 \u5929\uff0c\u8bbf\u95ee\u673a\u68b0\u786c\u76d8\u90a3\u66f4\u4e45\uff0c\u957f\u8fbe\u8fd1 4 \u4e2a\u6708\u3002</p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u4e0d\u540c\u7684\u5b58\u50a8\u5668\u4e4b\u95f4\u6027\u80fd\u5dee\u8ddd\u5f88\u5927\uff0c\u6784\u9020\u5b58\u50a8\u5668\u5206\u7ea7\u5f88\u6709\u610f\u4e49\uff0c\u5206\u7ea7\u7684\u76ee\u7684\u662f\u8981\u6784\u9020\u7f13\u5b58\u4f53\u7cfb\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/1_hardware/storage/#_7","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u65b0\u7684\u6280\u672f\u4ea4\u6d41\u7fa4\u5df2\u7ecf\u6162\u6162\u4eba\u591a\u8d77\u6765\u4e86\uff0c\u7fa4\u91cc\u7684\u5927\u725b\u771f\u7684\u591a\uff0c\u5927\u5bb6\u4ea4\u6d41\u90fd\u5f88\u8e0a\u8dc3\uff0c\u4e5f\u6709\u5f88\u591a\u70ed\u5fc3\u5206\u4eab\u548c\u56de\u7b54\u95ee\u9898\u7684\u5c0f\u4f19\u4f34\uff0c\u662f\u4f60\u4ea4\u670b\u53cb\u597d\u5730\u65b9\uff0c\u66f4\u662f\u4f60\u4e0a\u73ed\u5212\u6c34\u7684\u597d\u5165\u53e3\u3002</p> <p>\u51c6\u5907\u5165\u51ac\u4e86\uff0c\u4e00\u8d77\u6765\u62b1\u56e2\u53d6\u6696\u5427\uff0c\u52a0\u7fa4\u65b9\u5f0f\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981\u52a0\u6211\u7684\u5fae\u4fe1\u4e8c\u7ef4\u7801\uff0c\u5907\u6ce8\u300c\u52a0\u7fa4\u300d\u5373\u53ef\u3002</p> <p></p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/","title":"3.1 Linux \u5185\u6838 vs Windows \u5185\u6838","text":"<p>Windows \u548c Linux \u53ef\u4ee5\u8bf4\u662f\u6211\u4eec\u6bd4\u8f83\u5e38\u89c1\u7684\u4e24\u6b3e\u64cd\u4f5c\u7cfb\u7edf\u7684\u3002</p> <p>Windows \u57fa\u672c\u5360\u9886\u4e86\u7535\u8111\u65f6\u4ee3\u7684\u5e02\u573a\uff0c\u5546\u4e1a\u4e0a\u53d6\u5f97\u4e86\u5f88\u5927\u6210\u5c31\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u5f00\u6e90\uff0c\u6240\u4ee5\u8981\u60f3\u63a5\u89e6\u6e90\u7801\u5f97\u52a0\u5165 Windows \u7684\u5f00\u53d1\u56e2\u961f\u4e2d\u3002</p> <p>\u5bf9\u4e8e\u670d\u52a1\u5668\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u57fa\u672c\u4e0a\u90fd\u662f Linux\uff0c\u800c\u4e14\u5185\u6838\u6e90\u7801\u4e5f\u662f\u5f00\u6e90\u7684\uff0c\u4efb\u4f55\u4eba\u90fd\u53ef\u4ee5\u4e0b\u8f7d\uff0c\u5e76\u589e\u52a0\u81ea\u5df1\u7684\u6539\u52a8\u6216\u529f\u80fd\uff0cLinux \u6700\u5927\u7684\u9b45\u529b\u5728\u4e8e\uff0c\u5168\u4e16\u754c\u6709\u975e\u5e38\u591a\u7684\u6280\u672f\u5927\u4f6c\u4e3a\u5b83\u8d21\u732e\u4ee3\u7801\u3002</p> <p>\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u5404\u6709\u5343\u79cb\uff0c\u4e0d\u5206\u4f2f\u4ef2\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u6838\u5fc3\u7684\u4e1c\u897f\u5c31\u662f\u5185\u6838\uff0c\u8fd9\u6b21\u6211\u4eec\u5c31\u6765\u770b\u770b\uff0cLinux \u5185\u6838\u548c Windows \u5185\u6838\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/#_1","title":"\u5185\u6838","text":"<p>\u4ec0\u4e48\u662f\u5185\u6838\u5462\uff1f</p> <p>\u8ba1\u7b97\u673a\u662f\u7531\u5404\u79cd\u5916\u90e8\u786c\u4ef6\u8bbe\u5907\u7ec4\u6210\u7684\uff0c\u6bd4\u5982\u5185\u5b58\u3001cpu\u3001\u786c\u76d8\u7b49\uff0c\u5982\u679c\u6bcf\u4e2a\u5e94\u7528\u90fd\u8981\u548c\u8fd9\u4e9b\u786c\u4ef6\u8bbe\u5907\u5bf9\u63a5\u901a\u4fe1\u534f\u8bae\uff0c\u90a3\u8fd9\u6837\u592a\u7d2f\u4e86\uff0c\u6240\u4ee5\u8fd9\u4e2a\u4e2d\u95f4\u4eba\u5c31\u7531\u5185\u6838\u6765\u8d1f\u8d23\uff0c\u8ba9\u5185\u6838\u4f5c\u4e3a\u5e94\u7528\u8fde\u63a5\u786c\u4ef6\u8bbe\u5907\u7684\u6865\u6881\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ea\u9700\u5173\u5fc3\u4e0e\u5185\u6838\u4ea4\u4e92\uff0c\u4e0d\u7528\u5173\u5fc3\u786c\u4ef6\u7684\u7ec6\u8282\u3002</p> <p></p> <p>\u5185\u6838\u6709\u54ea\u4e9b\u80fd\u529b\u5462\uff1f</p> <p>\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5185\u6838\u4e00\u822c\u4f1a\u63d0\u4f9b 4 \u4e2a\u57fa\u672c\u80fd\u529b\uff1a</p> <ul> <li>\u7ba1\u7406\u8fdb\u7a0b\u3001\u7ebf\u7a0b\uff0c\u51b3\u5b9a\u54ea\u4e2a\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u4f7f\u7528 CPU\uff0c\u4e5f\u5c31\u662f\u8fdb\u7a0b\u8c03\u5ea6\u7684\u80fd\u529b\uff1b</li> <li>\u7ba1\u7406\u5185\u5b58\uff0c\u51b3\u5b9a\u5185\u5b58\u7684\u5206\u914d\u548c\u56de\u6536\uff0c\u4e5f\u5c31\u662f\u5185\u5b58\u7ba1\u7406\u7684\u80fd\u529b\uff1b</li> <li>\u7ba1\u7406\u786c\u4ef6\u8bbe\u5907\uff0c\u4e3a\u8fdb\u7a0b\u4e0e\u786c\u4ef6\u8bbe\u5907\u4e4b\u95f4\u63d0\u4f9b\u901a\u4fe1\u80fd\u529b\uff0c\u4e5f\u5c31\u662f\u786c\u4ef6\u901a\u4fe1\u80fd\u529b\uff1b</li> <li>\u63d0\u4f9b\u7cfb\u7edf\u8c03\u7528\uff0c\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u8981\u8fd0\u884c\u66f4\u9ad8\u6743\u9650\u8fd0\u884c\u7684\u670d\u52a1\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u6709\u7cfb\u7edf\u8c03\u7528\uff0c\u5b83\u662f\u7528\u6237\u7a0b\u5e8f\u4e0e\u64cd\u4f5c\u7cfb\u7edf\u4e4b\u95f4\u7684\u63a5\u53e3\u3002</li> </ul> <p>\u5185\u6838\u662f\u600e\u4e48\u5de5\u4f5c\u7684\uff1f</p> <p>\u5185\u6838\u5177\u6709\u5f88\u9ad8\u7684\u6743\u9650\uff0c\u53ef\u4ee5\u63a7\u5236 cpu\u3001\u5185\u5b58\u3001\u786c\u76d8\u7b49\u786c\u4ef6\uff0c\u800c\u5e94\u7528\u7a0b\u5e8f\u5177\u6709\u7684\u6743\u9650\u5f88\u5c0f\uff0c\u56e0\u6b64\u5927\u591a\u6570\u64cd\u4f5c\u7cfb\u7edf\uff0c\u628a\u5185\u5b58\u5206\u6210\u4e86\u4e24\u4e2a\u533a\u57df\uff1a</p> <ul> <li>\u5185\u6838\u7a7a\u95f4\uff0c\u8fd9\u4e2a\u5185\u5b58\u7a7a\u95f4\u53ea\u6709\u5185\u6838\u7a0b\u5e8f\u53ef\u4ee5\u8bbf\u95ee\uff1b</li> <li>\u7528\u6237\u7a7a\u95f4\uff0c\u8fd9\u4e2a\u5185\u5b58\u7a7a\u95f4\u4e13\u95e8\u7ed9\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\uff1b</li> </ul> <p>\u7528\u6237\u7a7a\u95f4\u7684\u4ee3\u7801\u53ea\u80fd\u8bbf\u95ee\u4e00\u4e2a\u5c40\u90e8\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u800c\u5185\u6838\u7a7a\u95f4\u7684\u4ee3\u7801\u53ef\u4ee5\u8bbf\u95ee\u6240\u6709\u5185\u5b58\u7a7a\u95f4\u3002\u56e0\u6b64\uff0c\u5f53\u7a0b\u5e8f\u4f7f\u7528\u7528\u6237\u7a7a\u95f4\u65f6\uff0c\u6211\u4eec\u5e38\u8bf4\u8be5\u7a0b\u5e8f\u5728\u7528\u6237\u6001\u6267\u884c\uff0c\u800c\u5f53\u7a0b\u5e8f\u4f7f\u5185\u6838\u7a7a\u95f4\u65f6\uff0c\u7a0b\u5e8f\u5219\u5728\u5185\u6838\u6001\u6267\u884c\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u5982\u679c\u9700\u8981\u8fdb\u5165\u5185\u6838\u7a7a\u95f4\uff0c\u5c31\u9700\u8981\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\uff0c\u4e0b\u9762\u6765\u770b\u770b\u7cfb\u7edf\u8c03\u7528\u7684\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u5185\u6838\u7a0b\u5e8f\u6267\u884c\u5728\u5185\u6838\u6001\uff0c\u7528\u6237\u7a0b\u5e8f\u6267\u884c\u5728\u7528\u6237\u6001\u3002\u5f53\u5e94\u7528\u7a0b\u5e8f\u4f7f\u7528\u7cfb\u7edf\u8c03\u7528\u65f6\uff0c\u4f1a\u4ea7\u751f\u4e00\u4e2a\u4e2d\u65ad\u3002\u53d1\u751f\u4e2d\u65ad\u540e\uff0cCPU \u4f1a\u4e2d\u65ad\u5f53\u524d\u5728\u6267\u884c\u7684\u7528\u6237\u7a0b\u5e8f\uff0c\u8f6c\u800c\u8df3\u8f6c\u5230\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\uff0c\u4e5f\u5c31\u662f\u5f00\u59cb\u6267\u884c\u5185\u6838\u7a0b\u5e8f\u3002\u5185\u6838\u5904\u7406\u5b8c\u540e\uff0c\u4e3b\u52a8\u89e6\u53d1\u4e2d\u65ad\uff0c\u628a CPU \u6267\u884c\u6743\u9650\u4ea4\u56de\u7ed9\u7528\u6237\u7a0b\u5e8f\uff0c\u56de\u5230\u7528\u6237\u6001\u7ee7\u7eed\u5de5\u4f5c\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/#linux","title":"Linux \u7684\u8bbe\u8ba1","text":"<p>Linux \u7684\u5f00\u5c71\u59cb\u7956\u662f\u6765\u81ea\u4e00\u4f4d\u540d\u53eb Linus Torvalds \u7684\u82ac\u5170\u5c0f\u4f19\u5b50\uff0c\u4ed6\u5728 1991 \u5e74\u7528 C \u8bed\u8a00\u5199\u51fa\u4e86\u7b2c\u4e00\u7248\u7684 Linux \u64cd\u4f5c\u7cfb\u7edf\uff0c\u90a3\u5e74\u4ed6 22 \u5c81\u3002</p> <p>\u5b8c\u6210\u7b2c\u4e00\u7248 Linux \u540e\uff0cLinux Torvalds \u5c31\u5728\u7f51\u7edc\u4e0a\u53d1\u5e03\u4e86 Linux \u5185\u6838\u7684\u6e90\u4ee3\u7801\uff0c\u6bcf\u4e2a\u4eba\u90fd\u53ef\u4ee5\u514d\u8d39\u4e0b\u8f7d\u548c\u4f7f\u7528\u3002</p> <p>Linux \u5185\u6838\u8bbe\u8ba1\u7684\u7406\u5ff5\u4e3b\u8981\u6709\u8fd9\u51e0\u4e2a\u70b9\uff1a</p> <ul> <li>MultiTask\uff0c\u591a\u4efb\u52a1</li> <li>SMP\uff0c\u5bf9\u79f0\u591a\u5904\u7406</li> <li>ELF\uff0c\u53ef\u6267\u884c\u6587\u4ef6\u94fe\u63a5\u683c\u5f0f</li> <li>Monolithic Kernel\uff0c\u5b8f\u5185\u6838</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/#multitask","title":"MultiTask","text":"<p>MultiTask \u7684\u610f\u601d\u662f\u591a\u4efb\u52a1\uff0c\u4ee3\u8868\u7740 Linux \u662f\u4e00\u4e2a\u591a\u4efb\u52a1\u7684\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u591a\u4efb\u52a1\u610f\u5473\u7740\u53ef\u4ee5\u6709\u591a\u4e2a\u4efb\u52a1\u540c\u65f6\u6267\u884c\uff0c\u8fd9\u91cc\u7684\u300c\u540c\u65f6\u300d\u53ef\u4ee5\u662f\u5e76\u53d1\u6216\u5e76\u884c\uff1a</p> <ul> <li>\u5bf9\u4e8e\u5355\u6838 CPU \u65f6\uff0c\u53ef\u4ee5\u8ba9\u6bcf\u4e2a\u4efb\u52a1\u6267\u884c\u4e00\u5c0f\u6bb5\u65f6\u95f4\uff0c\u65f6\u95f4\u5230\u5c31\u5207\u6362\u53e6\u5916\u4e00\u4e2a\u4efb\u52a1\uff0c\u4ece\u5b8f\u89c2\u89d2\u5ea6\u770b\uff0c\u4e00\u6bb5\u65f6\u95f4\u5185\u6267\u884c\u4e86\u591a\u4e2a\u4efb\u52a1\uff0c\u8fd9\u88ab\u79f0\u4e3a\u5e76\u53d1\u3002</li> <li>\u5bf9\u4e8e\u591a\u6838 CPU \u65f6\uff0c\u591a\u4e2a\u4efb\u52a1\u53ef\u4ee5\u540c\u65f6\u88ab\u4e0d\u540c\u6838\u5fc3\u7684 CPU \u540c\u65f6\u6267\u884c\uff0c\u8fd9\u88ab\u79f0\u4e3a\u5e76\u884c\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/#smp","title":"SMP","text":"<p>SMP \u7684\u610f\u601d\u662f\u5bf9\u79f0\u591a\u5904\u7406\uff0c\u4ee3\u8868\u7740\u6bcf\u4e2a CPU \u7684\u5730\u4f4d\u662f\u76f8\u7b49\u7684\uff0c\u5bf9\u8d44\u6e90\u7684\u4f7f\u7528\u6743\u9650\u4e5f\u662f\u76f8\u540c\u7684\uff0c\u591a\u4e2a CPU \u5171\u4eab\u540c\u4e00\u4e2a\u5185\u5b58\uff0c\u6bcf\u4e2a CPU \u90fd\u53ef\u4ee5\u8bbf\u95ee\u5b8c\u6574\u7684\u5185\u5b58\u548c\u786c\u4ef6\u8d44\u6e90\u3002</p> <p>\u8fd9\u4e2a\u7279\u70b9\u51b3\u5b9a\u4e86 Linux \u64cd\u4f5c\u7cfb\u7edf\u4e0d\u4f1a\u6709\u67d0\u4e2a CPU \u5355\u72ec\u670d\u52a1\u5e94\u7528\u7a0b\u5e8f\u6216\u5185\u6838\u7a0b\u5e8f\uff0c\u800c\u662f\u6bcf\u4e2a\u7a0b\u5e8f\u90fd\u53ef\u4ee5\u88ab\u5206\u914d\u5230\u4efb\u610f\u4e00\u4e2a CPU \u4e0a\u88ab\u6267\u884c\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/#elf","title":"ELF","text":"<p>ELF \u7684\u610f\u601d\u662f\u53ef\u6267\u884c\u6587\u4ef6\u94fe\u63a5\u683c\u5f0f\uff0c\u5b83\u662f Linux \u64cd\u4f5c\u7cfb\u7edf\u4e2d\u53ef\u6267\u884c\u6587\u4ef6\u7684\u5b58\u50a8\u683c\u5f0f\uff0c\u4f60\u53ef\u4ee5\u4ece\u4e0b\u56fe\u770b\u5230\u5b83\u7684\u7ed3\u6784\uff1a</p> <p></p> <p>ELF \u628a\u6587\u4ef6\u5206\u6210\u4e86\u4e00\u4e2a\u4e2a\u5206\u6bb5\uff0c\u6bcf\u4e00\u4e2a\u6bb5\u90fd\u6709\u81ea\u5df1\u7684\u4f5c\u7528\uff0c\u5177\u4f53\u6bcf\u4e2a\u6bb5\u7684\u4f5c\u7528\u8fd9\u91cc\u6211\u5c31\u4e0d\u8be6\u7ec6\u8bf4\u660e\u4e86\uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u53bb\u770b\u300a\u7a0b\u5e8f\u5458\u7684\u81ea\u6211\u4fee\u517b\u2014\u2014\u94fe\u63a5\u3001\u88c5\u8f7d\u548c\u5e93\u300b\u8fd9\u672c\u4e66\u3002</p> <p>\u53e6\u5916\uff0cELF \u6587\u4ef6\u6709\u4e24\u79cd\u7d22\u5f15\uff0cProgram header table \u4e2d\u8bb0\u5f55\u4e86\u300c\u8fd0\u884c\u65f6\u300d\u6240\u9700\u7684\u6bb5\uff0c\u800c Section header table \u8bb0\u5f55\u4e86\u4e8c\u8fdb\u5236\u6587\u4ef6\u4e2d\u5404\u4e2a\u300c\u6bb5\u7684\u9996\u5730\u5740\u300d\u3002</p> <p>\u90a3 ELF \u6587\u4ef6\u600e\u4e48\u751f\u6210\u7684\u5462\uff1f</p> <p>\u6211\u4eec\u7f16\u5199\u7684\u4ee3\u7801\uff0c\u9996\u5148\u901a\u8fc7\u300c\u7f16\u8bd1\u5668\u300d\u7f16\u8bd1\u6210\u6c47\u7f16\u4ee3\u7801\uff0c\u63a5\u7740\u901a\u8fc7\u300c\u6c47\u7f16\u5668\u300d\u53d8\u6210\u76ee\u6807\u4ee3\u7801\uff0c\u4e5f\u5c31\u662f\u76ee\u6807\u6587\u4ef6\uff0c\u6700\u540e\u901a\u8fc7\u300c\u94fe\u63a5\u5668\u300d\u628a\u591a\u4e2a\u76ee\u6807\u6587\u4ef6\u4ee5\u53ca\u8c03\u7528\u7684\u5404\u79cd\u51fd\u6570\u5e93\u94fe\u63a5\u8d77\u6765\uff0c\u5f62\u6210\u4e00\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f ELF \u6587\u4ef6\u3002</p> <p>\u90a3 ELF \u6587\u4ef6\u662f\u600e\u4e48\u88ab\u6267\u884c\u7684\u5462\uff1f</p> <p>\u6267\u884c ELF \u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4f1a\u901a\u8fc7\u300c\u88c5\u8f7d\u5668\u300d\u628a ELF \u6587\u4ef6\u88c5\u8f7d\u5230\u5185\u5b58\u91cc\uff0cCPU \u8bfb\u53d6\u5185\u5b58\u4e2d\u7684\u6307\u4ee4\u548c\u6570\u636e\uff0c\u4e8e\u662f\u7a0b\u5e8f\u5c31\u88ab\u6267\u884c\u8d77\u6765\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/#monolithic-kernel","title":"Monolithic Kernel","text":"<p>Monolithic Kernel \u7684\u610f\u601d\u662f\u5b8f\u5185\u6838\uff0cLinux \u5185\u6838\u67b6\u6784\u5c31\u662f\u5b8f\u5185\u6838\uff0c\u610f\u5473\u7740 Linux \u7684\u5185\u6838\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u53ef\u6267\u884c\u7a0b\u5e8f\uff0c\u4e14\u62e5\u6709\u6700\u9ad8\u7684\u6743\u9650\u3002</p> <p>\u5b8f\u5185\u6838\u7684\u7279\u5f81\u662f\u7cfb\u7edf\u5185\u6838\u7684\u6240\u6709\u6a21\u5757\uff0c\u6bd4\u5982\u8fdb\u7a0b\u8c03\u5ea6\u3001\u5185\u5b58\u7ba1\u7406\u3001\u6587\u4ef6\u7cfb\u7edf\u3001\u8bbe\u5907\u9a71\u52a8\u7b49\uff0c\u90fd\u8fd0\u884c\u5728\u5185\u6838\u6001\u3002</p> <p>\u4e0d\u8fc7\uff0cLinux \u4e5f\u5b9e\u73b0\u4e86\u52a8\u6001\u52a0\u8f7d\u5185\u6838\u6a21\u5757\u7684\u529f\u80fd\uff0c\u4f8b\u5982\u5927\u90e8\u5206\u8bbe\u5907\u9a71\u52a8\u662f\u4ee5\u53ef\u52a0\u8f7d\u6a21\u5757\u7684\u5f62\u5f0f\u5b58\u5728\u7684\uff0c\u4e0e\u5185\u6838\u5176\u4ed6\u6a21\u5757\u89e3\u8026\uff0c\u8ba9\u9a71\u52a8\u5f00\u53d1\u548c\u9a71\u52a8\u52a0\u8f7d\u66f4\u4e3a\u65b9\u4fbf\u3001\u7075\u6d3b\u3002</p> <p></p> <p>\u4e0e\u5b8f\u5185\u6838\u76f8\u53cd\u7684\u662f\u5fae\u5185\u6838\uff0c\u5fae\u5185\u6838\u67b6\u6784\u7684\u5185\u6838\u53ea\u4fdd\u7559\u6700\u57fa\u672c\u7684\u80fd\u529b\uff0c\u6bd4\u5982\u8fdb\u7a0b\u8c03\u5ea6\u3001\u865a\u62df\u673a\u5185\u5b58\u3001\u4e2d\u65ad\u7b49\uff0c\u628a\u4e00\u4e9b\u5e94\u7528\u653e\u5230\u4e86\u7528\u6237\u7a7a\u95f4\uff0c\u6bd4\u5982\u9a71\u52a8\u7a0b\u5e8f\u3001\u6587\u4ef6\u7cfb\u7edf\u7b49\u3002\u8fd9\u6837\u670d\u52a1\u4e0e\u670d\u52a1\u4e4b\u95f4\u662f\u9694\u79bb\u7684\uff0c\u5355\u4e2a\u670d\u52a1\u51fa\u73b0\u6545\u969c\u6216\u8005\u5b8c\u5168\u653b\u51fb\uff0c\u4e5f\u4e0d\u4f1a\u5bfc\u81f4\u6574\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u6302\u6389\uff0c\u63d0\u9ad8\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u548c\u53ef\u9760\u6027\u3002 </p> <p>\u5fae\u5185\u6838\u5185\u6838\u529f\u80fd\u5c11\uff0c\u53ef\u79fb\u690d\u6027\u9ad8\uff0c\u76f8\u6bd4\u5b8f\u5185\u6838\u6709\u4e00\u70b9\u4e0d\u597d\u7684\u5730\u65b9\u5728\u4e8e\uff0c\u7531\u4e8e\u9a71\u52a8\u7a0b\u5e8f\u4e0d\u5728\u5185\u6838\u4e2d\uff0c\u800c\u4e14\u9a71\u52a8\u7a0b\u5e8f\u4e00\u822c\u4f1a\u9891\u7e41\u8c03\u7528\u5e95\u5c42\u80fd\u529b\u7684\uff0c\u4e8e\u662f\u9a71\u52a8\u548c\u786c\u4ef6\u8bbe\u5907\u4ea4\u4e92\u5c31\u9700\u8981\u9891\u7e41\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u8fd9\u6837\u4f1a\u5e26\u6765\u6027\u80fd\u635f\u8017\u3002\u534e\u4e3a\u7684\u9e3f\u8499\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u6838\u67b6\u6784\u5c31\u662f\u5fae\u5185\u6838\u3002</p> <p>\u8fd8\u6709\u4e00\u79cd\u5185\u6838\u53eb\u6df7\u5408\u7c7b\u578b\u5185\u6838\uff0c\u5b83\u7684\u67b6\u6784\u6709\u70b9\u50cf\u5fae\u5185\u6838\uff0c\u5185\u6838\u91cc\u9762\u4f1a\u6709\u4e00\u4e2a\u6700\u5c0f\u7248\u672c\u7684\u5185\u6838\uff0c\u7136\u540e\u5176\u4ed6\u6a21\u5757\u4f1a\u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\u642d\u5efa\uff0c\u7136\u540e\u5b9e\u73b0\u7684\u65f6\u5019\u4f1a\u8ddf\u5b8f\u5185\u6838\u7c7b\u4f3c\uff0c\u4e5f\u5c31\u662f\u628a\u6574\u4e2a\u5185\u6838\u505a\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u7a0b\u5e8f\uff0c\u5927\u90e8\u5206\u670d\u52a1\u90fd\u5728\u5185\u6838\u4e2d\uff0c\u8fd9\u5c31\u50cf\u662f\u5b8f\u5185\u6838\u7684\u65b9\u5f0f\u5305\u88f9\u7740\u4e00\u4e2a\u5fae\u5185\u6838\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/#windows","title":"Windows \u8bbe\u8ba1","text":"<p>\u5f53\u4eca Windows 7\u3001Windows 10 \u4f7f\u7528\u7684\u5185\u6838\u53eb Windows NT\uff0cNT \u5168\u79f0\u53eb New Technology\u3002</p> <p>\u4e0b\u56fe\u662f Windows NT \u7684\u7ed3\u6784\u56fe\u7247\uff1a</p> <p></p> <p>Windows \u548c Linux \u4e00\u6837\uff0c\u540c\u6837\u652f\u6301 MutiTask \u548c SMP\uff0c\u4f46\u4e0d\u540c\u7684\u662f\uff0cWindow \u7684\u5185\u6838\u8bbe\u8ba1\u662f\u6df7\u5408\u578b\u5185\u6838\uff0c\u5728\u4e0a\u56fe\u4f60\u53ef\u4ee5\u770b\u5230\u5185\u6838\u4e2d\u6709\u4e00\u4e2a MicroKernel \u6a21\u5757\uff0c\u8fd9\u4e2a\u5c31\u662f\u6700\u5c0f\u7248\u672c\u7684\u5185\u6838\uff0c\u800c\u6574\u4e2a\u5185\u6838\u5b9e\u73b0\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u7a0b\u5e8f\uff0c\u542b\u6709\u975e\u5e38\u591a\u6a21\u5757\u3002</p> <p>Windows \u7684\u53ef\u6267\u884c\u6587\u4ef6\u7684\u683c\u5f0f\u4e0e Linux \u4e5f\u4e0d\u540c\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a\u7cfb\u7edf\u7684\u53ef\u6267\u884c\u6587\u4ef6\u662f\u4e0d\u53ef\u4ee5\u5728\u5bf9\u65b9\u4e0a\u8fd0\u884c\u7684\u3002</p> <p>Windows \u7684\u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u53eb PE\uff0c\u79f0\u4e3a\u53ef\u79fb\u690d\u6267\u884c\u6587\u4ef6\uff0c\u6269\u5c55\u540d\u901a\u5e38\u662f<code>.exe</code>\u3001<code>.dll</code>\u3001<code>.sys</code>\u7b49\u3002</p> <p>PE \u7684\u7ed3\u6784\u4f60\u53ef\u4ee5\u4ece\u4e0b\u56fe\u4e2d\u770b\u5230\uff0c\u5b83\u4e0e ELF \u7ed3\u6784\u6709\u4e00\u70b9\u76f8\u4f3c\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/#_2","title":"\u603b\u7ed3","text":"<p>\u5bf9\u4e8e\u5185\u6838\u7684\u67b6\u6784\u4e00\u822c\u6709\u8fd9\u4e09\u79cd\u7c7b\u578b\uff1a</p> <ul> <li>\u5b8f\u5185\u6838\uff0c\u5305\u542b\u591a\u4e2a\u6a21\u5757\uff0c\u6574\u4e2a\u5185\u6838\u50cf\u4e00\u4e2a\u5b8c\u6574\u7684\u7a0b\u5e8f\uff1b</li> <li>\u5fae\u5185\u6838\uff0c\u6709\u4e00\u4e2a\u6700\u5c0f\u7248\u672c\u7684\u5185\u6838\uff0c\u4e00\u4e9b\u6a21\u5757\u548c\u670d\u52a1\u5219\u7531\u7528\u6237\u6001\u7ba1\u7406\uff1b</li> <li>\u6df7\u5408\u5185\u6838\uff0c\u662f\u5b8f\u5185\u6838\u548c\u5fae\u5185\u6838\u7684\u7ed3\u5408\u4f53\uff0c\u5185\u6838\u4e2d\u62bd\u8c61\u51fa\u4e86\u5fae\u5185\u6838\u7684\u6982\u5ff5\uff0c\u4e5f\u5c31\u662f\u5185\u6838\u4e2d\u4f1a\u6709\u4e00\u4e2a\u5c0f\u578b\u7684\u5185\u6838\uff0c\u5176\u4ed6\u6a21\u5757\u5c31\u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\u642d\u5efa\uff0c\u6574\u4e2a\u5185\u6838\u662f\u4e2a\u5b8c\u6574\u7684\u7a0b\u5e8f\uff1b</li> </ul> <p>Linux \u7684\u5185\u6838\u8bbe\u8ba1\u662f\u91c7\u7528\u4e86\u5b8f\u5185\u6838\uff0cWindow \u7684\u5185\u6838\u8bbe\u8ba1\u5219\u662f\u91c7\u7528\u4e86\u6df7\u5408\u5185\u6838\u3002</p> <p>\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u4e5f\u4e0d\u4e00\u6837\uff0cLinux \u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u53eb\u4f5c ELF\uff0cWindows \u53ef\u6267\u884c\u6587\u4ef6\u683c\u5f0f\u53eb\u4f5c PE\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/2_os_structure/linux_vs_windows/#_3","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/alloc_mem/","title":"4.4 \u5728 4GB \u7269\u7406\u5185\u5b58\u7684\u673a\u5668\u4e0a\uff0c\u7533\u8bf7 8G \u5185\u5b58\u4f1a\u600e\u4e48\u6837\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u770b\u5230\u8bfb\u8005\u5728\u7fa4\u91cc\u8ba8\u8bba\u8fd9\u4e9b\u9762\u8bd5\u9898\uff1a</p> <p></p> <p>\u5176\u4e2d\uff0c\u7b2c\u4e00\u4e2a\u95ee\u9898\u300c\u5728 4GB \u7269\u7406\u5185\u5b58\u7684\u673a\u5668\u4e0a\uff0c\u7533\u8bf7 8G \u5185\u5b58\u4f1a\u600e\u4e48\u6837\uff1f\u300d\u5b58\u5728\u6bd4\u8f83\u5927\u7684\u4e89\u8bae\uff0c\u6709\u4eba\u8bf4\u4f1a\u7533\u8bf7\u5931\u8d25\uff0c\u6709\u7684\u4eba\u8bf4\u53ef\u4ee5\u7533\u8bf7\u6210\u529f\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u5728\u6ca1\u6709\u524d\u7f6e\u6761\u4ef6\u4e0b\uff0c\u5c31\u8bf4\u51fa\u7b54\u6848\u5c31\u662f\u800d\u6d41\u6c13\u3002\u8fd9\u4e2a\u95ee\u9898\u8981\u8003\u8651\u4e09\u4e2a\u524d\u7f6e\u6761\u4ef6\uff1a</p> <ul> <li>\u64cd\u4f5c\u7cfb\u7edf\u662f 32 \u4f4d\u7684\uff0c\u8fd8\u662f 64 \u4f4d\u7684\uff1f</li> <li>\u7533\u8bf7\u5b8c 8G \u5185\u5b58\u540e\u4f1a\u4e0d\u4f1a\u88ab\u4f7f\u7528\uff1f</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u6709\u6ca1\u6709\u4f7f\u7528 Swap \u673a\u5236\uff1f</li> </ul> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u5206\u573a\u666f\u8ba8\u8bba\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/alloc_mem/#_1","title":"\u64cd\u4f5c\u7cfb\u7edf\u865a\u62df\u5185\u5b58\u5927\u5c0f","text":"<p>\u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7 malloc \u51fd\u6570\u7533\u8bf7\u5185\u5b58\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u7533\u8bf7\u7684\u662f\u865a\u62df\u5185\u5b58\uff0c\u6b64\u65f6\u5e76\u4e0d\u4f1a\u5206\u914d\u7269\u7406\u5185\u5b58\u3002</p> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u8bfb\u5199\u4e86\u8fd9\u5757\u865a\u62df\u5185\u5b58\uff0cCPU \u5c31\u4f1a\u53bb\u8bbf\u95ee\u8fd9\u4e2a\u865a\u62df\u5185\u5b58\uff0c\u8fd9\u65f6\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u865a\u62df\u5185\u5b58\u6ca1\u6709\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\uff0cCPU \u5c31\u4f1a\u4ea7\u751f\u7f3a\u9875\u4e2d\u65ad\uff0c\u8fdb\u7a0b\u4f1a\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u5e76\u5c06\u7f3a\u9875\u4e2d\u65ad\u4ea4\u7ed9\u5185\u6838\u7684 Page Fault Handler\uff08\u7f3a\u9875\u4e2d\u65ad\u51fd\u6570\uff09\u5904\u7406\u3002</p> <p>\u7f3a\u9875\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u4f1a\u770b\u662f\u5426\u6709\u7a7a\u95f2\u7684\u7269\u7406\u5185\u5b58\uff1a</p> <ul> <li>\u5982\u679c\u6709\uff0c\u5c31\u76f4\u63a5\u5206\u914d\u7269\u7406\u5185\u5b58\uff0c\u5e76\u5efa\u7acb\u865a\u62df\u5185\u5b58\u4e0e\u7269\u7406\u5185\u5b58\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002</li> <li>\u5982\u679c\u6ca1\u6709\u7a7a\u95f2\u7684\u7269\u7406\u5185\u5b58\uff0c\u90a3\u4e48\u5185\u6838\u5c31\u4f1a\u5f00\u59cb\u8fdb\u884c\u56de\u6536\u5185\u5b58\u7684\u5de5\u4f5c\uff0c\u5982\u679c\u56de\u6536\u5185\u5b58\u5de5\u4f5c\u7ed3\u675f\u540e\uff0c\u7a7a\u95f2\u7684\u7269\u7406\u5185\u5b58\u4ecd\u7136\u65e0\u6cd5\u6ee1\u8db3\u6b64\u6b21\u7269\u7406\u5185\u5b58\u7684\u7533\u8bf7\uff0c\u90a3\u4e48\u5185\u6838\u5c31\u4f1a\u653e\u6700\u540e\u7684\u5927\u62db\u4e86\u89e6\u53d1 OOM\uff08Out of Memory\uff09\u673a\u5236\u3002</li> </ul> <p>32 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u548c 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5927\u5c0f\u662f\u4e0d\u540c\u7684\uff0c\u5728 Linux \u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u5185\u90e8\u53c8\u88ab\u5206\u4e3a\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u4e24\u90e8\u5206\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\uff1a</p> <ul> <li><code>32</code> \u4f4d\u7cfb\u7edf\u7684\u5185\u6838\u7a7a\u95f4\u5360\u7528 <code>1G</code>\uff0c\u4f4d\u4e8e\u6700\u9ad8\u5904\uff0c\u5269\u4e0b\u7684 <code>3G</code> \u662f\u7528\u6237\u7a7a\u95f4\uff1b</li> <li><code>64</code> \u4f4d\u7cfb\u7edf\u7684\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u90fd\u662f <code>128T</code>\uff0c\u5206\u522b\u5360\u636e\u6574\u4e2a\u5185\u5b58\u7a7a\u95f4\u7684\u6700\u9ad8\u548c\u6700\u4f4e\u5904\uff0c\u5269\u4e0b\u7684\u4e2d\u95f4\u90e8\u5206\u662f\u672a\u5b9a\u4e49\u7684\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/alloc_mem/#32","title":"32 \u4f4d\u7cfb\u7edf\u7684\u573a\u666f","text":"<p>\u73b0\u5728\u53ef\u4ee5\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u4e86\uff1a\u5728 32 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u30014GB \u7269\u7406\u5185\u5b58\u7684\u673a\u5668\u4e0a\uff0c\u7533\u8bf7 8GB \u5185\u5b58\uff0c\u4f1a\u600e\u4e48\u6837\uff1f</p> <p>\u56e0\u4e3a 32 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fdb\u7a0b\u6700\u591a\u53ea\u80fd\u7533\u8bf7 3 GB \u5927\u5c0f\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\uff0c\u6240\u4ee5\u8fdb\u7a0b\u7533\u8bf7 8GB \u5185\u5b58\u7684\u8bdd\uff0c\u5728\u7533\u8bf7\u865a\u62df\u5185\u5b58\u9636\u6bb5\u5c31\u4f1a\u5931\u8d25\uff08\u6211\u624b\u4e0a\u6ca1\u6709 32 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u6d4b\u8bd5\uff0c\u6211\u4f30\u8ba1\u5931\u8d25\u7684\u9519\u8bef\u662f cannot allocate memory\uff0c\u4e5f\u5c31\u662f\u65e0\u6cd5\u7533\u8bf7\u5185\u5b58\u5931\u8d25\uff09\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/alloc_mem/#64","title":"64 \u4f4d\u7cfb\u7edf\u7684\u573a\u666f","text":"<p>\u5728 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u30014GB \u7269\u7406\u5185\u5b58\u7684\u673a\u5668\u4e0a\uff0c\u7533\u8bf7 8G \u5185\u5b58\uff0c\u4f1a\u600e\u4e48\u6837\uff1f</p> <p>64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fdb\u7a0b\u53ef\u4ee5\u4f7f\u7528 128 TB \u5927\u5c0f\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\uff0c\u6240\u4ee5\u8fdb\u7a0b\u7533\u8bf7 8GB \u5185\u5b58\u662f\u6ca1\u95ee\u9898\u7684\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u7533\u8bf7\u5185\u5b58\u662f\u7533\u8bf7\u865a\u62df\u5185\u5b58\uff0c\u53ea\u8981\u4e0d\u8bfb\u5199\u8fd9\u4e2a\u865a\u62df\u5185\u5b58\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4e0d\u4f1a\u5206\u914d\u7269\u7406\u5185\u5b58\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u505a\u4e2a\u6d4b\u8bd5\uff0c\u6211\u7684\u670d\u52a1\u5668\u662f 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f46\u662f\u7269\u7406\u5185\u5b58\u53ea\u6709 2 GB\uff1a</p> <p></p> <p>\u73b0\u5728\uff0c\u6211\u5728\u673a\u5668\u4e0a\uff0c\u8fde\u7eed\u7533\u8bf7 4 \u6b21 1 GB \u5185\u5b58\uff0c\u4e5f\u5c31\u662f\u4e00\u5171\u7533\u8bf7\u4e86 4 GB \u5185\u5b58\uff0c\u6ce8\u610f\u4e0b\u9762\u4ee3\u7801\u53ea\u662f\u5355\u7eaf\u5206\u914d\u4e86\u865a\u62df\u5185\u5b58\uff0c\u5e76\u6ca1\u6709\u4f7f\u7528\u8be5\u865a\u62df\u5185\u5b58\uff1a</p> C<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;errno.h&gt;\n\n#define MEM_SIZE 1024 * 1024 * 1024\n\nint main() {\n    char* addr[4];\n    int i = 0;\n    for(i = 0; i &lt; 4; ++i) {\n        addr[i] = (char*) malloc(MEM_SIZE);\n        if(!addr[i]) {\n            printf(\"\u6267\u884c malloc \u5931\u8d25\uff0c\u9519\u8bef\uff1a%s\\n\",strerror(errno));\n                return -1;\n        }\n        printf(\"\u4e3b\u7ebf\u7a0b\u8c03\u7528 malloc \u540e\uff0c\u7533\u8bf7 1gb \u5927\u5c0f\u5f97\u5185\u5b58\uff0c\u6b64\u5185\u5b58\u8d77\u59cb\u5730\u5740\uff1a0X%p\\n\", addr[i]);\n    }\n\n    //\u8f93\u5165\u4efb\u610f\u5b57\u7b26\u540e\uff0c\u624d\u7ed3\u675f\n    getchar();\n    return 0;\n}\n</code></pre> <p>\u7136\u540e\u8fd0\u884c\u8fd9\u4e2a\u4ee3\u7801\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u7684\u7269\u7406\u5185\u5b58\u867d\u7136\u53ea\u6709 2GB\uff0c\u4f46\u662f\u7a0b\u5e8f\u6b63\u5e38\u5206\u914d\u4e86 4GB \u5927\u5c0f\u7684\u865a\u62df\u5185\u5b58\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u8fd9\u6761\u547d\u4ee4\u67e5\u770b\u8fdb\u7a0b\uff08test\uff09\u7684\u865a\u62df\u5185\u5b58\u5927\u5c0f\uff1a</p> Bash<pre><code># ps aux | grep test\nUSER       PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND\nroot      7797  0.0  0.0 4198540  352 pts/1    S+   16:58   0:00 ./test\n</code></pre> <p>\u5176\u4e2d\uff0cVSZ \u5c31\u4ee3\u8868\u8fdb\u7a0b\u4f7f\u7528\u7684\u865a\u62df\u5185\u5b58\u5927\u5c0f\uff0cRSS \u4ee3\u8868\u8fdb\u7a0b\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\u5927\u5c0f\u3002\u53ef\u4ee5\u770b\u5230\uff0cVSZ \u5927\u5c0f\u4e3a 4198540\uff0c\u4e5f\u5c31\u662f 4GB \u7684\u865a\u62df\u5185\u5b58\u3002</p> <p>\u4e4b\u524d\u6709\u8bfb\u8005\u8ddf\u6211\u53cd\u9988\uff0c\u8bf4\u4ed6\u81ea\u5df1\u4e5f\u505a\u4e86\u8fd9\u4e2a\u5b9e\u9a8c\uff0c\u7136\u540e\u53d1\u73b0 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5728\u7533\u8bf7 4GB \u865a\u62df\u5185\u5b58\u7684\u65f6\u5019\u5931\u8d25\u4e86\uff0c\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p>\u5931\u8d25\u7684\u9519\u8bef\uff1a</p> <p></p> <p>\u6211\u5f53\u65f6\u5e2e\u4ed6\u6392\u67e5\u4e86\u4e0b\uff0c\u53d1\u73b0\u8ddf Linux \u4e2d\u7684 overcommit_memory \u53c2\u6570\u6709\u5173\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>cat /proc/sys/vm/overcommit_memory</code> \u6765\u67e5\u770b\u8fd9\u4e2a\u53c2\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u63a5\u53d7\u4e09\u4e2a\u503c\uff1a</p> <ul> <li>\u5982\u679c\u503c\u4e3a 0\uff08\u9ed8\u8ba4\u503c\uff09\uff0c\u4ee3\u8868\uff1aHeuristic overcommit handling\uff0c\u5b83\u5141\u8bb8 overcommit\uff0c\u4f46\u8fc7\u4e8e\u660e\u76ee\u5f20\u80c6\u7684 overcommit \u4f1a\u88ab\u62d2\u7edd\uff0c\u6bd4\u5982 malloc \u4e00\u6b21\u6027\u7533\u8bf7\u7684\u5185\u5b58\u5927\u5c0f\u5c31\u8d85\u8fc7\u4e86\u7cfb\u7edf\u603b\u5185\u5b58\u3002Heuristic \u7684\u610f\u601d\u662f\u201c\u8bd5\u63a2\u5f0f\u7684\u201d\uff0c\u5185\u6838\u5229\u7528\u67d0\u79cd\u7b97\u6cd5\u731c\u6d4b\u4f60\u7684\u5185\u5b58\u7533\u8bf7\u662f\u5426\u5408\u7406\uff0c\u5927\u6982\u53ef\u4ee5\u7406\u89e3\u4e3a\u5355\u6b21\u7533\u8bf7\u4e0d\u80fd\u8d85\u8fc7 free memory + free swap + pagecache \u7684\u5927\u5c0f + SLAB \u4e2d\u53ef\u56de\u6536\u7684\u90e8\u5206\uff0c\u8d85\u8fc7\u4e86\u5c31\u4f1a\u62d2\u7edd overcommit\u3002</li> <li>\u5982\u679c\u503c\u4e3a 1\uff0c\u4ee3\u8868\uff1aAlways overcommit. \u5141\u8bb8 overcommit\uff0c\u5bf9\u5185\u5b58\u7533\u8bf7\u6765\u8005\u4e0d\u62d2\u3002</li> <li>\u5982\u679c\u503c\u4e3a 2\uff0c\u4ee3\u8868\uff1aDon\u2019t overcommit. \u7981\u6b62 overcommit\u3002</li> </ul> <p>\u5f53\u65f6\u90a3\u4f4d\u8bfb\u8005\u7684 overcommit_memory \u53c2\u6570\u662f\u9ed8\u8ba4\u503c 0\uff0c\u6240\u4ee5\u7533\u8bf7\u5931\u8d25\u7684\u539f\u56e0\u53ef\u80fd\u662f\u5185\u6838\u8ba4\u4e3a\u6211\u4eec\u7533\u8bf7\u7684\u5185\u5b58\u592a\u5927\u4e86\uff0c\u5b83\u8ba4\u4e3a\u4e0d\u5408\u7406\uff0c\u6240\u4ee5 malloc() \u8fd4\u56de\u4e86 Cannot allocate memory \u9519\u8bef\uff0c\u8fd9\u91cc\u7533\u8bf7 4GB \u865a\u62df\u5185\u5b58\u5931\u8d25\u7684\u540c\u5b66\u53ef\u4ee5\u5c06\u8fd9\u4e2a overcommit_memory \u8bbe\u7f6e\u4e3a 1\uff0c\u5c31\u53ef\u4ee5 overcommit \u4e86\u3002</p> Bash<pre><code>echo 1 &gt; /proc/sys/vm/overcommit_memory \n</code></pre> <p>\u8bbe\u7f6e\u5b8c\u4e3a 1 \u540e\uff0c\u8bfb\u8005\u7684\u673a\u5b50\u5c31\u53ef\u4ee5\u6b63\u5e38\u7533\u8bf7 4GB \u865a\u62df\u5185\u5b58\u4e86\u3002</p> <p></p> <p>\u4e0d\u8fc7\u6211\u7684\u73af\u5883 overcommit_memory \u662f 0\uff0c\u5728 64 \u7cfb\u7edf\u30012 G \u7269\u7406\u5185\u5b58\u573a\u666f\u4e0b\uff0c\u4e5f\u662f\u53ef\u4ee5\u6210\u529f\u7533\u8bf7 4 G \u5185\u5b58\u7684\uff0c\u6211\u6000\u7591\u53ef\u80fd\u662f\u4e0d\u540c\u7248\u672c\u7684\u5185\u6838\u5728 overcommit_memory \u4e3a 0 \u65f6\uff0c\u68c0\u6d4b\u5185\u5b58\u7533\u8bf7\u662f\u5426\u5408\u7406\u7684\u7b97\u6cd5\u53ef\u80fd\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u603b\u4e4b\uff0c\u5982\u679c\u4f60\u7533\u8bf7\u5927\u5185\u5b58\u7684\u65f6\u5019\uff0c\u4e0d\u60f3\u88ab\u5185\u6838\u68c0\u6d4b\u5185\u5b58\u7533\u8bf7\u662f\u5426\u5408\u7406\u7684\u7b97\u6cd5\u5e72\u6270\u7684\u8bdd\uff0c\u5c06 overcommit_memory \u8bbe\u7f6e\u4e3a 1 \u5c31\u884c\u3002</p> <p>\u90a3\u4e48\u5c06\u8fd9\u4e2a overcommit_memory \u8bbe\u7f6e\u4e3a 1 \u4e4b\u540e\uff0c64 \u4f4d\u7684\u4e3b\u673a\u5c31\u53ef\u4ee5\u7533\u8bf7\u63a5\u8fd1 128T \u865a\u62df\u5185\u5b58\u4e86\u5417\uff1f</p> <p>\u4e0d\u4e00\u5b9a\uff0c\u8fd8\u5f97\u770b\u4f60\u670d\u52a1\u5668\u7684\u7269\u7406\u5185\u5b58\u5927\u5c0f\u3002</p> <p>\u8bfb\u8005\u7684\u670d\u52a1\u5668\u7269\u7406\u5185\u5b58\u662f 2 GB\uff0c\u5b9e\u9a8c\u540e\u53d1\u73b0\uff0c\u8fdb\u7a0b\u8fd8\u6ca1\u6709\u7533\u8bf7\u5230 128T \u865a\u62df\u5185\u5b58\u7684\u65f6\u5019\u5c31\u88ab\u6740\u6b7b\u4e86\u3002</p> <p></p> <p>\u6ce8\u610f\uff0c\u8fd9\u6b21\u662f killed\uff0c\u800c\u4e0d\u662f Cannot Allocate Memory\uff0c\u8bf4\u660e\u5e76\u4e0d\u662f\u5185\u5b58\u7533\u8bf7\u6709\u95ee\u9898\uff0c\u800c\u662f\u89e6\u53d1 OOM \u4e86\u3002</p> <p>\u4f46\u662f\u4e3a\u4ec0\u4e48\u4f1a\u89e6\u53d1 OOM \u5462\uff1f</p> <p>\u90a3\u5f97\u770b\u4f60\u7684\u4e3b\u673a\u7684\u300c\u7269\u7406\u5185\u5b58\u300d\u591f\u4e0d\u591f\u5927\u4e86\uff0c\u5373\u4f7f malloc \u7533\u8bf7\u7684\u662f\u865a\u62df\u5185\u5b58\uff0c\u53ea\u8981\u4e0d\u53bb\u8bbf\u95ee\u5c31\u4e0d\u4f1a\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\uff0c\u4f46\u662f\u7533\u8bf7\u865a\u62df\u5185\u5b58\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u662f\u4f7f\u7528\u5230\u4e86\u7269\u7406\u5185\u5b58\uff08\u6bd4\u5982\u5185\u6838\u4fdd\u5b58\u865a\u62df\u5185\u5b58\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4e5f\u662f\u5360\u7528\u7269\u7406\u5185\u5b58\u7684\uff09\uff0c\u5982\u679c\u4f60\u7684\u4e3b\u673a\u662f\u53ea\u6709 2GB \u7684\u7269\u7406\u5185\u5b58\u7684\u8bdd\uff0c\u5927\u6982\u7387\u4f1a\u89e6\u53d1 OOM\u3002</p> <p>\u53ef\u4ee5\u4f7f\u7528 top \u547d\u4ee4\uff0c\u70b9\u51fb\u4e24\u4e0b m\uff0c\u901a\u8fc7\u8fdb\u5ea6\u6761\u89c2\u5bdf\u7269\u7406\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u7533\u8bf7\u865a\u62df\u5185\u5b58\u7684\u8fc7\u7a0b\u4e2d\u7269\u7406\u5185\u5b58\u4f7f\u7528\u91cf\u4e00\u76f4\u5728\u589e\u957f\u3002</p> <p></p> <p></p> <p></p> <p>\u76f4\u5230\u76f4\u63a5\u5185\u5b58\u56de\u6536\u4e4b\u540e\uff0c\u4e5f\u65e0\u6cd5\u56de\u6536\u51fa\u4e00\u5757\u7a7a\u95f4\u4f9b\u8fd9\u4e2a\u8fdb\u7a0b\u4f7f\u7528\uff0c\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u89e6\u53d1 OOM\uff0c\u7ed9\u6240\u6709\u80fd\u6740\u6b7b\u7684\u8fdb\u7a0b\u6253\u5206\uff0c\u5206\u6570\u8d8a\u9ad8\u7684\u8fdb\u7a0b\u8d8a\u5bb9\u6613\u88ab\u6740\u6b7b\u3002</p> <p>\u5728\u8fd9\u91cc\u5f53\u7136\u662f\u8fd9\u4e2a\u8fdb\u7a0b\u5f97\u5206\u6700\u9ad8\uff0c\u90a3\u4e48\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4f1a\u5c06\u8fd9\u4e2a\u8fdb\u7a0b\u6740\u6b7b\uff0c\u6240\u4ee5\u6700\u540e\u4f1a\u51fa\u73b0 killed\uff0c\u800c\u4e0d\u662f Cannot allocate memory\u3002</p> <p>\u90a3\u4e48 2GB \u7684\u7269\u7406\u5185\u5b58\u7684 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5c31\u4e0d\u80fd\u7533\u8bf7 128T \u7684\u865a\u62df\u5185\u5b58\u4e86\u5417\uff1f</p> <p>\u5176\u5b9e\u53ef\u4ee5\uff0c\u4e0a\u9762\u7684\u60c5\u51b5\u662f\u8fd8\u6ca1\u5f00\u542f swap \u7684\u60c5\u51b5\u3002</p> <p>\u4f7f\u7528 swapfile \u7684\u65b9\u5f0f\u5f00\u542f\u4e86 1GB \u7684 swap \u7a7a\u95f4\u4e4b\u540e\u518d\u505a\u5b9e\u9a8c\uff1a</p> <p></p> <p></p> <p>\u53d1\u73b0\u51fa\u73b0\u4e86 Cannot allocate memory\uff0c\u4f46\u662f\u5176\u5b9e\u5230\u8fd9\u91cc\u5df2\u7ecf\u6210\u529f\u4e86\uff0c</p> <p>\u6253\u5f00\u8ba1\u7b97\u5668\u8ba1\u7b97\u4e00\u4e0b\uff0c\u53d1\u73b0\u5df2\u7ecf\u7533\u8bf7\u4e86 127.998T \u865a\u62df\u5185\u5b58\u4e86\u3002</p> <p></p> <p>\u5b9e\u9645\u4e0a\u6211\u4eec\u662f\u4e0d\u53ef\u80fd\u7533\u8bf7\u5b8c\u6574\u4e2a 128T \u7684\u7528\u6237\u7a7a\u95f4\u7684\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u8fd0\u884c\u672c\u8eab\u4e5f\u9700\u8981\u7533\u8bf7\u865a\u62df\u7a7a\u95f4</p> <p>\u7533\u8bf7 127T \u865a\u62df\u5185\u5b58\u8bd5\u8bd5\uff1a</p> <p></p> <p>\u53d1\u73b0\u8fdb\u7a0b\u6ca1\u6709\u88ab\u6740\u6b7b\uff0c\u4e5f\u6ca1\u6709 Cannot allocate memory\uff0c\u4e5f\u6b63\u597d\u662f 127T \u865a\u62df\u5185\u5b58\u7a7a\u95f4\u3002</p> <p></p> <p>\u5728 top \u4e2d\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u8fd9\u4e2a\u7533\u8bf7\u4e86 127T \u865a\u62df\u5185\u5b58\u7684\u8fdb\u7a0b\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/alloc_mem/#swap","title":"Swap \u673a\u5236\u7684\u4f5c\u7528","text":"<p>\u524d\u9762\u8ba8\u8bba\u5728 32 \u4f4d/64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\u73af\u5883\u4e0b\uff0c\u7533\u8bf7\u7684\u865a\u62df\u5185\u5b58\u8d85\u8fc7\u7269\u7406\u5185\u5b58\u540e\u4f1a\u600e\u4e48\u6837\uff1f</p> <ul> <li>\u5728 32 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u6700\u5927\u53ea\u80fd\u7533\u8bf7 3 GB \u5927\u5c0f\u7684\u865a\u62df\u5185\u5b58\uff0c\u6240\u4ee5\u76f4\u63a5\u7533\u8bf7 8G \u5185\u5b58\uff0c\u4f1a\u7533\u8bf7\u5931\u8d25\u3002</li> <li>\u5728 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u6700\u5927\u53ea\u80fd\u7533\u8bf7 128 TB \u5927\u5c0f\u7684\u865a\u62df\u5185\u5b58\uff0c\u5373\u4f7f\u7269\u7406\u5185\u5b58\u53ea\u6709 4GB\uff0c\u7533\u8bf7 8G \u5185\u5b58\u4e5f\u662f\u6ca1\u95ee\u9898\uff0c\u56e0\u4e3a\u7533\u8bf7\u7684\u5185\u5b58\u662f\u865a\u62df\u5185\u5b58\u3002</li> </ul> <p>\u7a0b\u5e8f\u7533\u8bf7\u7684\u865a\u62df\u5185\u5b58\uff0c\u5982\u679c\u6ca1\u6709\u88ab\u4f7f\u7528\uff0c\u5b83\u662f\u4e0d\u4f1a\u5360\u7528\u7269\u7406\u7a7a\u95f4\u7684\u3002\u5f53\u8bbf\u95ee\u8fd9\u5757\u865a\u62df\u5185\u5b58\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u624d\u4f1a\u8fdb\u884c\u7269\u7406\u5185\u5b58\u5206\u914d\u3002</p> <p>\u5982\u679c\u7533\u8bf7\u7269\u7406\u5185\u5b58\u5927\u5c0f\u8d85\u8fc7\u4e86\u7a7a\u95f2\u7269\u7406\u5185\u5b58\u5927\u5c0f\uff0c\u5c31\u8981\u770b\u64cd\u4f5c\u7cfb\u7edf\u6709\u6ca1\u6709\u5f00\u542f Swap \u673a\u5236\uff1a</p> <ul> <li>\u5982\u679c\u6ca1\u6709\u5f00\u542f Swap \u673a\u5236\uff0c\u7a0b\u5e8f\u5c31\u4f1a\u76f4\u63a5 OOM\uff1b</li> <li>\u5982\u679c\u6709\u5f00\u542f Swap \u673a\u5236\uff0c\u7a0b\u5e8f\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\u3002</li> </ul> <p>\u4ec0\u4e48\u662f Swap \u673a\u5236\uff1f</p> <p>\u5f53\u7cfb\u7edf\u7684\u7269\u7406\u5185\u5b58\u4e0d\u591f\u7528\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u5c06\u7269\u7406\u5185\u5b58\u4e2d\u7684\u4e00\u90e8\u5206\u7a7a\u95f4\u91ca\u653e\u51fa\u6765\uff0c\u4ee5\u4f9b\u5f53\u524d\u8fd0\u884c\u7684\u7a0b\u5e8f\u4f7f\u7528\u3002\u90a3\u4e9b\u88ab\u91ca\u653e\u7684\u7a7a\u95f4\u53ef\u80fd\u6765\u81ea\u4e00\u4e9b\u5f88\u957f\u65f6\u95f4\u6ca1\u6709\u4ec0\u4e48\u64cd\u4f5c\u7684\u7a0b\u5e8f\uff0c\u8fd9\u4e9b\u88ab\u91ca\u653e\u7684\u7a7a\u95f4\u4f1a\u88ab\u4e34\u65f6\u4fdd\u5b58\u5230\u78c1\u76d8\uff0c\u7b49\u5230\u90a3\u4e9b\u7a0b\u5e8f\u8981\u8fd0\u884c\u65f6\uff0c\u518d\u4ece\u78c1\u76d8\u4e2d\u6062\u590d\u4fdd\u5b58\u7684\u6570\u636e\u5230\u5185\u5b58\u4e2d\u3002</p> <p>\u53e6\u5916\uff0c\u5f53\u5185\u5b58\u4f7f\u7528\u5b58\u5728\u538b\u529b\u7684\u65f6\u5019\uff0c\u4f1a\u5f00\u59cb\u89e6\u53d1\u5185\u5b58\u56de\u6536\u884c\u4e3a\uff0c\u4f1a\u628a\u8fd9\u4e9b\u4e0d\u5e38\u8bbf\u95ee\u7684\u5185\u5b58\u5148\u5199\u5230\u78c1\u76d8\u4e2d\uff0c\u7136\u540e\u91ca\u653e\u8fd9\u4e9b\u5185\u5b58\uff0c\u7ed9\u5176\u4ed6\u66f4\u9700\u8981\u7684\u8fdb\u7a0b\u4f7f\u7528\u3002\u518d\u6b21\u8bbf\u95ee\u8fd9\u4e9b\u5185\u5b58\u65f6\uff0c\u91cd\u65b0\u4ece\u78c1\u76d8\u8bfb\u5165\u5185\u5b58\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u8fd9\u79cd\uff0c\u5c06\u5185\u5b58\u6570\u636e\u6362\u51fa\u78c1\u76d8\uff0c\u53c8\u4ece\u78c1\u76d8\u4e2d\u6062\u590d\u6570\u636e\u5230\u5185\u5b58\u7684\u8fc7\u7a0b\uff0c\u5c31\u662f Swap \u673a\u5236\u8d1f\u8d23\u7684\u3002</p> <p>Swap \u5c31\u662f\u628a\u4e00\u5757\u78c1\u76d8\u7a7a\u95f4\u6216\u8005\u672c\u5730\u6587\u4ef6\uff0c\u5f53\u6210\u5185\u5b58\u6765\u4f7f\u7528\uff0c\u5b83\u5305\u542b\u6362\u51fa\u548c\u6362\u5165\u4e24\u4e2a\u8fc7\u7a0b\uff1a</p> <ul> <li>\u6362\u51fa\uff08Swap Out\uff09 \uff0c\u662f\u628a\u8fdb\u7a0b\u6682\u65f6\u4e0d\u7528\u7684\u5185\u5b58\u6570\u636e\u5b58\u50a8\u5230\u78c1\u76d8\u4e2d\uff0c\u5e76\u91ca\u653e\u8fd9\u4e9b\u6570\u636e\u5360\u7528\u7684\u5185\u5b58\uff1b</li> <li>\u6362\u5165\uff08Swap In\uff09\uff0c\u662f\u5728\u8fdb\u7a0b\u518d\u6b21\u8bbf\u95ee\u8fd9\u4e9b\u5185\u5b58\u7684\u65f6\u5019\uff0c\u628a\u5b83\u4eec\u4ece\u78c1\u76d8\u8bfb\u5230\u5185\u5b58\u4e2d\u6765\uff1b</li> </ul> <p>Swap \u6362\u5165\u6362\u51fa\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4f7f\u7528 Swap \u673a\u5236\u4f18\u70b9\u662f\uff0c\u5e94\u7528\u7a0b\u5e8f\u5b9e\u9645\u53ef\u4ee5\u4f7f\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5c06\u8fdc\u8fdc\u8d85\u8fc7\u7cfb\u7edf\u7684\u7269\u7406\u5185\u5b58\u3002\u7531\u4e8e\u786c\u76d8\u7a7a\u95f4\u7684\u4ef7\u683c\u8fdc\u6bd4\u5185\u5b58\u8981\u4f4e\uff0c\u56e0\u6b64\u8fd9\u79cd\u65b9\u5f0f\u65e0\u7591\u662f\u7ecf\u6d4e\u5b9e\u60e0\u7684\u3002\u5f53\u7136\uff0c\u9891\u7e41\u5730\u8bfb\u5199\u786c\u76d8\uff0c\u4f1a\u663e\u8457\u964d\u4f4e\u64cd\u4f5c\u7cfb\u7edf\u7684\u8fd0\u884c\u901f\u7387\uff0c\u8fd9\u4e5f\u662f Swap \u7684\u5f0a\u7aef\u3002</p> <p>Linux \u4e2d\u7684 Swap \u673a\u5236\u4f1a\u5728\u5185\u5b58\u4e0d\u8db3\u548c\u5185\u5b58\u95f2\u7f6e\u7684\u573a\u666f\u4e0b\u89e6\u53d1\uff1a</p> <ul> <li>\u5185\u5b58\u4e0d\u8db3\uff1a\u5f53\u7cfb\u7edf\u9700\u8981\u7684\u5185\u5b58\u8d85\u8fc7\u4e86\u53ef\u7528\u7684\u7269\u7406\u5185\u5b58\u65f6\uff0c\u5185\u6838\u4f1a\u5c06\u5185\u5b58\u4e2d\u4e0d\u5e38\u4f7f\u7528\u7684\u5185\u5b58\u9875\u4ea4\u6362\u5230\u78c1\u76d8\u4e0a\u4e3a\u5f53\u524d\u8fdb\u7a0b\u8ba9\u51fa\u5185\u5b58\uff0c\u4fdd\u8bc1\u6b63\u5728\u6267\u884c\u7684\u8fdb\u7a0b\u7684\u53ef\u7528\u6027\uff0c\u8fd9\u4e2a\u5185\u5b58\u56de\u6536\u7684\u8fc7\u7a0b\u662f\u5f3a\u5236\u7684\u76f4\u63a5\u5185\u5b58\u56de\u6536\uff08Direct Page Reclaim\uff09\u3002\u76f4\u63a5\u5185\u5b58\u56de\u6536\u662f\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u4f1a\u963b\u585e\u5f53\u524d\u7533\u8bf7\u5185\u5b58\u7684\u8fdb\u7a0b\u3002</li> <li>\u5185\u5b58\u95f2\u7f6e\uff1a\u5e94\u7528\u7a0b\u5e8f\u5728\u542f\u52a8\u9636\u6bb5\u4f7f\u7528\u7684\u5927\u91cf\u5185\u5b58\u5728\u542f\u52a8\u540e\u5f80\u5f80\u90fd\u4e0d\u4f1a\u4f7f\u7528\uff0c\u901a\u8fc7\u540e\u53f0\u8fd0\u884c\u7684\u5b88\u62a4\u8fdb\u7a0b\uff08kSwapd\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u5c06\u8fd9\u90e8\u5206\u53ea\u4f7f\u7528\u4e00\u6b21\u7684\u5185\u5b58\u4ea4\u6362\u5230\u78c1\u76d8\u4e0a\u4e3a\u5176\u4ed6\u5185\u5b58\u7684\u7533\u8bf7\u9884\u7559\u7a7a\u95f4\u3002kSwapd \u662f Linux \u8d1f\u8d23\u9875\u9762\u7f6e\u6362\uff08Page replacement\uff09\u7684\u5b88\u62a4\u8fdb\u7a0b\uff0c\u5b83\u4e5f\u662f\u8d1f\u8d23\u4ea4\u6362\u95f2\u7f6e\u5185\u5b58\u7684\u4e3b\u8981\u8fdb\u7a0b\uff0c\u5b83\u4f1a\u5728\u7a7a\u95f2\u5185\u5b58\u4f4e\u4e8e\u4e00\u5b9a\u6c34\u4f4d\u65f6\uff0c\u56de\u6536\u5185\u5b58\u9875\u4e2d\u7684\u7a7a\u95f2\u5185\u5b58\u4fdd\u8bc1\u7cfb\u7edf\u4e2d\u7684\u5176\u4ed6\u8fdb\u7a0b\u53ef\u4ee5\u5c3d\u5feb\u83b7\u5f97\u7533\u8bf7\u7684\u5185\u5b58\u3002kSwapd \u662f\u540e\u53f0\u8fdb\u7a0b\uff0c\u6240\u4ee5\u56de\u6536\u5185\u5b58\u7684\u8fc7\u7a0b\u662f\u5f02\u6b65\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u5f53\u524d\u7533\u8bf7\u5185\u5b58\u7684\u8fdb\u7a0b\u3002</li> </ul> <p>Linux \u63d0\u4f9b\u4e86\u4e24\u79cd\u4e0d\u540c\u7684\u65b9\u6cd5\u542f\u7528 Swap\uff0c\u5206\u522b\u662f Swap \u5206\u533a\uff08Swap Partition\uff09\u548c Swap \u6587\u4ef6\uff08Swapfile\uff09\uff0c\u5f00\u542f\u65b9\u6cd5\u53ef\u4ee5\u770b\u8fd9\u4e2a\u8d44\u6599\uff1a</p> <ul> <li>Swap \u5206\u533a\u662f\u786c\u76d8\u4e0a\u7684\u72ec\u7acb\u533a\u57df\uff0c\u8be5\u533a\u57df\u53ea\u4f1a\u7528\u4e8e\u4ea4\u6362\u5206\u533a\uff0c\u5176\u4ed6\u7684\u6587\u4ef6\u4e0d\u80fd\u5b58\u50a8\u5728\u8be5\u533a\u57df\u4e0a\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>swapon -s</code> \u547d\u4ee4\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u4e0a\u7684\u4ea4\u6362\u5206\u533a\uff1b</li> <li>Swap \u6587\u4ef6\u662f\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u7279\u6b8a\u6587\u4ef6\uff0c\u5b83\u4e0e\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684\u5176\u4ed6\u6587\u4ef6\u4e5f\u6ca1\u6709\u592a\u591a\u7684\u533a\u522b\uff1b</li> </ul> <p>Swap \u6362\u5165\u6362\u51fa\u7684\u662f\u4ec0\u4e48\u7c7b\u578b\u7684\u5185\u5b58\uff1f</p> <p>\u5185\u6838\u7f13\u5b58\u7684\u6587\u4ef6\u6570\u636e\uff0c\u56e0\u4e3a\u90fd\u6709\u5bf9\u5e94\u7684\u78c1\u76d8\u6587\u4ef6\uff0c\u6240\u4ee5\u5728\u56de\u6536\u6587\u4ef6\u6570\u636e\u7684\u65f6\u5019\uff0c\u76f4\u63a5\u5199\u56de\u5230\u5bf9\u5e94\u7684\u6587\u4ef6\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u4f46\u662f\u50cf\u8fdb\u7a0b\u7684\u5806\u3001\u6808\u6570\u636e\u7b49\uff0c\u5b83\u4eec\u662f\u6ca1\u6709\u5b9e\u9645\u8f7d\u4f53\uff0c\u8fd9\u90e8\u5206\u5185\u5b58\u88ab\u79f0\u4e3a\u533f\u540d\u9875\u3002\u800c\u4e14\u8fd9\u90e8\u5206\u5185\u5b58\u5f88\u53ef\u80fd\u8fd8\u8981\u518d\u6b21\u88ab\u8bbf\u95ee\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u91ca\u653e\u5185\u5b58\uff0c\u4e8e\u662f\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u80fd\u4fdd\u5b58\u533f\u540d\u9875\u7684\u78c1\u76d8\u8f7d\u4f53\uff0c\u8fd9\u4e2a\u8f7d\u4f53\u5c31\u662f Swap \u5206\u533a\u3002</p> <p>\u533f\u540d\u9875\u56de\u6536\u7684\u65b9\u5f0f\u662f\u901a\u8fc7 Linux \u7684 Swap \u673a\u5236\uff0cSwap \u4f1a\u628a\u4e0d\u5e38\u8bbf\u95ee\u7684\u5185\u5b58\u5148\u5199\u5230\u78c1\u76d8\u4e2d\uff0c\u7136\u540e\u91ca\u653e\u8fd9\u4e9b\u5185\u5b58\uff0c\u7ed9\u5176\u4ed6\u66f4\u9700\u8981\u7684\u8fdb\u7a0b\u4f7f\u7528\u3002\u518d\u6b21\u8bbf\u95ee\u8fd9\u4e9b\u5185\u5b58\u65f6\uff0c\u91cd\u65b0\u4ece\u78c1\u76d8\u8bfb\u5165\u5185\u5b58\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u901a\u8fc7\u4e24\u4e2a\u5b9e\u9a8c\uff0c\u770b\u770b\u7533\u8bf7\u7684\u7269\u7406\u5185\u5b58\u8d85\u8fc7\u7269\u7406\u5185\u5b58\u4f1a\u600e\u6837\uff1f</p> <ul> <li>\u5b9e\u9a8c\u4e00\uff1a\u6ca1\u6709\u5f00\u542f Swap \u673a\u5236</li> <li>\u5b9e\u9a8c\u4e8c\uff1a\u6709\u5f00\u542f Swap \u673a\u5236</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/alloc_mem/#swap_1","title":"\u5b9e\u9a8c\u4e00\uff1a\u6ca1\u6709\u5f00\u542f Swap \u673a\u5236","text":"<p>\u6211\u7684\u670d\u52a1\u5668\u662f 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4f46\u662f\u7269\u7406\u5185\u5b58\u53ea\u6709 2 GB\uff0c\u800c\u4e14\u6ca1\u6709 Swap \u5206\u533a\uff1a</p> <p></p> <p>\u6211\u4eec\u6539\u4e00\u4e0b\u524d\u9762\u7684\u4ee3\u7801\uff0c\u4f7f\u5f97\u5728\u7533\u8bf7\u5b8c 4GB \u865a\u62df\u5185\u5b58\u540e\uff0c\u901a\u8fc7 memset \u51fd\u6570\u8bbf\u95ee\u8fd9\u4e2a\u865a\u62df\u5185\u5b58\uff0c\u770b\u770b\u5728\u6ca1\u6709 Swap \u5206\u533a\u7684\u60c5\u51b5\u4e0b\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</p> C<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;errno.h&gt;\n\n#define MEM_SIZE 1024 * 1024 * 1024\n\nint main() {\n    char* addr[4];\n    int i = 0;\n    for(i = 0; i &lt; 4; ++i) {\n        addr[i] = (char*) malloc(MEM_SIZE);\n        if(!addr[i]) {\n            printf(\"\u6267\u884c malloc \u5931\u8d25\uff0c\u9519\u8bef\uff1a%s\\n\",strerror(errno));\n            return -1;\n        }\n        printf(\"\u4e3b\u7ebf\u7a0b\u8c03\u7528 malloc \u540e\uff0c\u7533\u8bf7 1gb \u5927\u5c0f\u5f97\u5185\u5b58\uff0c\u6b64\u5185\u5b58\u8d77\u59cb\u5730\u5740\uff1a0X%p\\n\", addr[i]);\n    }\n\n    for(i = 0; i &lt; 4; ++i) {\n        printf(\"\u5f00\u59cb\u8bbf\u95ee\u7b2c %d \u5757\u865a\u62df\u5185\u5b58 (\u6bcf\u4e00\u5757\u865a\u62df\u5185\u5b58\u4e3a 1 GB)\\n\", i + 1);\n        memset(addr[i], 0, MEM_SIZE);\n    }\n\n    //\u8f93\u5165\u4efb\u610f\u5b57\u7b26\u540e\uff0c\u624d\u7ed3\u675f\n    getchar();\n    return 0;\n}\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u8bbf\u95ee\u7b2c 2 \u5757\u865a\u62df\u5185\u5b58\uff08\u6bcf\u4e00\u5757\u865a\u62df\u5185\u5b58\u662f 1 GB\uff09\u7684\u65f6\u5019\uff0c\u56e0\u4e3a\u8d85\u8fc7\u4e86\u673a\u5668\u7684\u7269\u7406\u5185\u5b58\uff082GB\uff09\uff0c\u8fdb\u7a0b\uff08test\uff09\u88ab\u64cd\u4f5c\u7cfb\u7edf\u6740\u6389\u4e86\u3002</p> <p>\u901a\u8fc7\u67e5\u770b message \u7cfb\u7edf\u65e5\u5fd7\uff0c\u53ef\u4ee5\u53d1\u73b0\u8be5\u8fdb\u7a0b\u662f\u88ab\u64cd\u4f5c\u7cfb\u7edf OOM killer \u673a\u5236\u6740\u6389\u4e86\uff0c\u65e5\u5fd7\u91cc\u62a5\u9519\u4e86 Out of memory\uff0c\u4e5f\u5c31\u662f\u53d1\u751f OOM\uff08\u5185\u5b58\u6ea2\u51fa\u9519\u8bef\uff09\u3002</p> <p></p> <p>\u4ec0\u4e48\u662f OOM?</p> <p>\u5185\u5b58\u6ea2\u51fa (Out Of Memory\uff0c\u7b80\u79f0 OOM) \u662f\u6307\u5e94\u7528\u7cfb\u7edf\u4e2d\u5b58\u5728\u65e0\u6cd5\u56de\u6536\u7684\u5185\u5b58\u6216\u4f7f\u7528\u7684\u5185\u5b58\u8fc7\u591a\uff0c\u6700\u7ec8\u4f7f\u5f97\u7a0b\u5e8f\u8fd0\u884c\u8981\u7528\u5230\u7684\u5185\u5b58\u5927\u4e8e\u80fd\u63d0\u4f9b\u7684\u6700\u5927\u5185\u5b58\u3002\u6b64\u65f6\u7a0b\u5e8f\u5c31\u8fd0\u884c\u4e0d\u4e86\uff0c\u7cfb\u7edf\u4f1a\u63d0\u793a\u5185\u5b58\u6ea2\u51fa\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/alloc_mem/#swap_2","title":"\u5b9e\u9a8c\u4e8c\uff1a\u6709\u5f00\u542f Swap \u673a\u5236","text":"<p>\u6211\u7528\u6211\u7684 mac book pro \u7b14\u8bb0\u672c\u505a\u6d4b\u8bd5\uff0c\u6211\u7684\u7b14\u8bb0\u672c\u662f 64 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u7269\u7406\u5185\u5b58\u662f 8 GB\uff0c\u76ee\u524d Swap \u5206\u533a\u5927\u5c0f\u4e3a 1 GB\uff08\u6ce8\u610f\u8fd9\u4e2a\u5927\u5c0f\u4e0d\u662f\u56fa\u5b9a\u4e0d\u53d8\u7684\uff0cSwap \u5206\u533a\u603b\u5927\u5c0f\u662f\u4f1a\u52a8\u6001\u53d8\u5316\u7684\uff0c\u5f53\u6ca1\u6709\u4f7f\u7528 Swap \u5206\u533a\u65f6\uff0cSwap \u5206\u533a\u603b\u5927\u5c0f\u662f 0\uff1b\u5f53\u4f7f\u7528\u4e86 Swap \u5206\u533a\uff0cSwap \u5206\u533a\u603b\u5927\u5c0f\u4f1a\u589e\u52a0\u81f3 1 GB\uff1b\u5f53 Swap \u5206\u533a\u5df2\u4f7f\u7528\u7684\u5927\u5c0f\u8d85\u8fc7 1 GB \u65f6\uff1bSwap \u5206\u533a\u603b\u5927\u5c0f\u5c31\u4f1a\u589e\u52a0\u5230\u81f3 2 GB\uff1b\u5f53 Swap \u5206\u533a\u5df2\u4f7f\u7528\u7684\u5927\u5c0f\u8d85\u8fc7 2 GB \u65f6\uff1bSwap \u5206\u533a\u603b\u5927\u5c0f\u5c31\u589e\u52a0\u81f3 3GB\uff0c\u5982\u6b64\u5f80\u590d\u3002\u8fd9\u4e2a\u4f30\u8ba1\u662f macos \u81ea\u5df1\u5b9e\u73b0\u7684\uff0cLinux \u7684\u5206\u533a\u5219\u662f\u56fa\u5b9a\u5927\u5c0f\u7684\uff0cSwap \u5206\u533a\u4e0d\u4f1a\u6839\u636e\u4f7f\u7528\u60c5\u51b5\u800c\u81ea\u52a8\u589e\u957f\uff09\u3002</p> <p></p> <p>\u4e3a\u4e86\u65b9\u4fbf\u89c2\u5bdf\u78c1\u76d8 I/O \u60c5\u51b5\uff0c\u6211\u4eec\u6539\u8fdb\u4e00\u4e0b\u524d\u9762\u7684\u4ee3\u7801\uff0c\u5206\u914d\u5b8c 32 GB \u865a\u62df\u5185\u5b58\u540e\uff08\u7b14\u8bb0\u672c\u7269\u7406\u5185\u5b58\u662f 8 GB\uff09\uff0c\u901a\u8fc7\u4e00\u4e2a while \u5faa\u73af\u9891\u7e41\u8bbf\u95ee\u865a\u62df\u5185\u5b58\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> C<pre><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\n#define MEM_SIZE 32 * 1024 * 1024 * 1024\n\nint main() {\n    char* addr = (char*) malloc((long)MEM_SIZE);\n    printf(\"\u4e3b\u7ebf\u7a0b\u8c03\u7528 malloc \u540e\uff0c\u76ee\u524d\u5171\u7533\u8bf7\u4e86 32gb \u7684\u865a\u62df\u5185\u5b58\\n\");\n\n    //\u5faa\u73af\u9891\u7e41\u8bbf\u95ee\u865a\u62df\u5185\u5b58\n    while(1) {\n          printf(\"\u5f00\u59cb\u8bbf\u95ee 32gb \u5927\u5c0f\u7684\u865a\u62df\u5185\u5b58...\\n\");\n          memset(addr, 0, (long)MEM_SIZE);\n    }\n    return 0;\n}\n</code></pre> <p>\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u6709 Swap \u5206\u533a\u7684\u60c5\u51b5\u4e0b\uff0c\u5373\u4f7f\u7b14\u8bb0\u672c\u7269\u7406\u5185\u5b58\u662f 8 GB\uff0c\u7533\u8bf7\u5e76\u4f7f\u7528 32 GB \u5185\u5b58\u662f\u6ca1\u95ee\u9898\uff0c\u7a0b\u5e8f\u6b63\u5e38\u8fd0\u884c\u4e86\uff0c\u5e76\u6ca1\u6709\u53d1\u751f OOM\u3002</p> <p>\u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u8fdb\u7a0b\u7684\u5185\u5b58\u663e\u793a 32 GB\uff08\u8fd9\u4e2a\u4e0d\u8981\u7406\u89e3\u4e3a\u5360\u7528\u7684\u7269\u7406\u5185\u5b58\uff0c\u7406\u89e3\u4e3a\u5df2\u88ab\u8bbf\u95ee\u7684\u865a\u62df\u5185\u5b58\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u5728\u7269\u7406\u5185\u5b58\u5446\u8fc7\u7684\u5185\u5b58\u5927\u5c0f\uff09\uff0c\u7cfb\u7edf\u5df2\u4f7f\u7528\u7684 Swap \u5206\u533a\u8fbe\u5230 2.3 GB\u3002</p> <p></p> <p>\u6b64\u65f6\u6211\u7684\u7b14\u8bb0\u672c\u7535\u8111\u7684\u78c1\u76d8\u5f00\u59cb\u51fa\u73b0\u201c\u6c99\u6c99\u201d\u7684\u58f0\u97f3\uff0c\u901a\u8fc7\u67e5\u770b\u78c1\u76d8\u7684 I/O \u60c5\u51b5\uff0c\u53ef\u4ee5\u770b\u5230\u78c1\u76d8 I/O \u8fbe\u5230\u4e86\u4e00\u4e2a\u5cf0\u503c\uff0c\u975e\u5e38\u9ad8\uff1a</p> <p></p> <p>\u6709\u4e86 Swap \u5206\u533a\uff0c\u662f\u4e0d\u662f\u610f\u5473\u7740\u8fdb\u7a0b\u53ef\u4ee5\u4f7f\u7528\u7684\u5185\u5b58\u662f\u65e0\u4e0a\u9650\u7684\uff1f</p> <p>\u5f53\u7136\u4e0d\u662f\uff0c\u6211\u628a\u4e0a\u9762\u7684\u4ee3\u7801\u6539\u6210\u4e86\u7533\u8bf7 64GB \u5185\u5b58\u540e\uff0c\u5f53\u8fdb\u7a0b\u7533\u8bf7\u5b8c 64GB \u865a\u62df\u5185\u5b58\u540e\uff0c\u4f7f\u7528\u5230 56 GB\uff08\u8fd9\u4e2a\u4e0d\u8981\u7406\u89e3\u4e3a\u5360\u7528\u7684\u7269\u7406\u5185\u5b58\uff0c\u7406\u89e3\u4e3a\u5df2\u88ab\u8bbf\u95ee\u7684\u865a\u62df\u5185\u5b58\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u5728\u7269\u7406\u5185\u5b58\u5446\u8fc7\u7684\u5185\u5b58\u5927\u5c0f\uff09\u7684\u65f6\u5019\uff0c\u8fdb\u7a0b\u5c31\u88ab\u7cfb\u7edf kill \u6389\u4e86\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5f53\u7cfb\u7edf\u591a\u6b21\u5c1d\u8bd5\u56de\u6536\u5185\u5b58\uff0c\u8fd8\u662f\u65e0\u6cd5\u6ee1\u8db3\u6240\u9700\u4f7f\u7528\u7684\u5185\u5b58\u5927\u5c0f\uff0c\u8fdb\u7a0b\u5c31\u4f1a\u88ab\u7cfb\u7edf kill \u6389\u4e86\uff0c\u610f\u5473\u7740\u53d1\u751f\u4e86 OOM\uff08PS\uff1a\u6211\u6ca1\u6709\u5728 macos \u7cfb\u7edf\u627e\u5230\u50cf linux \u7cfb\u7edf\u91cc\u7684 /var/log/message \u7cfb\u7edf\u65e5\u5fd7\u6587\u4ef6\uff0c\u6240\u4ee5\u65e0\u6cd5\u901a\u8fc7\u67e5\u770b\u65e5\u5fd7\u786e\u8ba4\u662f\u5426\u53d1\u751f\u4e86 OOM\uff09\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/alloc_mem/#_2","title":"\u603b\u7ed3","text":"<p>\u81f3\u6b64\uff0c\u9a8c\u8bc1\u5b8c\u6210\u4e86\u3002\u7b80\u5355\u603b\u7ed3\u4e0b\uff1a</p> <ul> <li>\u5728 32 \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u7406\u8bba\u4e0a\u6700\u5927\u80fd\u7533\u8bf7 3 GB \u5927\u5c0f\u7684\u865a\u62df\u5185\u5b58\uff0c\u6240\u4ee5\u76f4\u63a5\u7533\u8bf7 8G \u5185\u5b58\uff0c\u4f1a\u7533\u8bf7\u5931\u8d25\u3002</li> <li>\u5728 64 \u4f4d \u4f4d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u7406\u8bba\u4e0a\u6700\u5927\u80fd\u7533\u8bf7 128 TB \u5927\u5c0f\u7684\u865a\u62df\u5185\u5b58\uff0c\u5373\u4f7f\u7269\u7406\u5185\u5b58\u53ea\u6709 4GB\uff0c\u7533\u8bf7 8G \u5185\u5b58\u4e5f\u662f\u6ca1\u95ee\u9898\uff0c\u56e0\u4e3a\u7533\u8bf7\u7684\u5185\u5b58\u662f\u865a\u62df\u5185\u5b58\u3002\u5982\u679c\u8fd9\u5757\u865a\u62df\u5185\u5b58\u88ab\u8bbf\u95ee\u4e86\uff0c\u8981\u770b\u7cfb\u7edf\u6709\u6ca1\u6709 Swap \u5206\u533a\uff1a</li> <li>\u5982\u679c\u6ca1\u6709 Swap \u5206\u533a\uff0c\u56e0\u4e3a\u7269\u7406\u7a7a\u95f4\u4e0d\u591f\uff0c\u8fdb\u7a0b\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u6740\u6389\uff0c\u539f\u56e0\u662f OOM\uff08\u5185\u5b58\u6ea2\u51fa\uff09\uff1b</li> <li>\u5982\u679c\u6709 Swap \u5206\u533a\uff0c\u5373\u4f7f\u7269\u7406\u5185\u5b58\u53ea\u6709 4GB\uff0c\u7a0b\u5e8f\u4e5f\u80fd\u6b63\u5e38\u4f7f\u7528 8GB \u7684\u5185\u5b58\uff0c\u8fdb\u7a0b\u53ef\u4ee5\u6b63\u5e38\u8fd0\u884c\uff1b</li> </ul> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/","title":"4.5 \u5982\u4f55\u907f\u514d\u9884\u8bfb\u5931\u6548\u548c\u7f13\u5b58\u6c61\u67d3\u7684\u95ee\u9898\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e0a\u5468\u7fa4\u91cc\u770b\u5230\u6709\u4f4d\u5c0f\u4f19\u4f34\u9762\u8bd5\u65f6\uff0c\u88ab\u95ee\u5230\u8fd9\u4e24\u4e2a\u95ee\u9898\uff1a</p> <p></p> <p>\u548b\u4e00\u770b\uff0c\u4ee5\u4e3a\u662f\u5728\u95ee\u64cd\u4f5c\u7cfb\u7edf\u7684\u95ee\u9898\uff0c\u5176\u5b9e\u8fd9\u4e24\u4e2a\u9898\u76ee\u90fd\u662f\u5728\u95ee\u5982\u4f55\u6539\u8fdb LRU \u7b97\u6cd5\u3002</p> <p>\u56e0\u4e3a\u4f20\u7edf\u7684 LRU \u7b97\u6cd5\u5b58\u5728\u8fd9\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u300c\u9884\u8bfb\u5931\u6548\u300d\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\uff08\u5bf9\u5e94\u7b2c\u4e00\u4e2a\u9898\u76ee\uff09</li> <li>\u300c\u7f13\u5b58\u6c61\u67d3\u300d\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\uff08\u5bf9\u5e94\u7b2c\u4e8c\u4e2a\u9898\u76ee\uff09</li> </ul> <p>Redis \u7684\u7f13\u5b58\u6dd8\u6c70\u7b97\u6cd5\u5219\u662f\u901a\u8fc7\u5b9e\u73b0 LFU \u7b97\u6cd5\u6765\u907f\u514d\u300c\u7f13\u5b58\u6c61\u67d3\u300d\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\u7684\u95ee\u9898\uff08Redis \u6ca1\u6709\u9884\u8bfb\u673a\u5236\uff09\u3002</p> <p>MySQL \u548c Linux \u64cd\u4f5c\u7cfb\u7edf\u662f\u901a\u8fc7\u6539\u8fdb LRU \u7b97\u6cd5\u6765\u907f\u514d\u300c\u9884\u8bfb\u5931\u6548\u548c\u7f13\u5b58\u6c61\u67d3\u300d\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\u7684\u95ee\u9898\u3002</p> <p>\u8fd9\u6b21\uff0c\u5c31\u91cd\u70b9\u8bb2\u8bb2 MySQL \u548c Linux \u64cd\u4f5c\u7cfb\u7edf\u662f\u5982\u4f55\u6539\u8fdb LRU \u7b97\u6cd5\u7684\uff1f</p> <p>\u597d\u4e86\uff0c\u5f00\u59cb\u53d1\u8f66\uff0c\u5750\u7a33\u4e86\uff01</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#linux-mysql","title":"Linux \u548c MySQL \u7684\u7f13\u5b58","text":""},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#linux","title":"Linux \u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u5b58","text":"<p>\u5728\u5e94\u7528\u7a0b\u5e8f\u8bfb\u53d6\u6587\u4ef6\u7684\u6570\u636e\u7684\u65f6\u5019\uff0cLinux \u64cd\u4f5c\u7cfb\u7edf\u662f\u4f1a\u5bf9\u8bfb\u53d6\u7684\u6587\u4ef6\u6570\u636e\u8fdb\u884c\u7f13\u5b58\u7684\uff0c\u4f1a\u7f13\u5b58\u5728\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7684 Page Cache\uff08\u5982\u4e0b\u56fe\u4e2d\u7684\u9875\u7f13\u5b58\uff09\u3002</p> <p></p> <p>Page Cache \u5c5e\u4e8e\u5185\u5b58\u7a7a\u95f4\u91cc\u7684\u6570\u636e\uff0c\u7531\u4e8e\u5185\u5b58\u8bbf\u95ee\u6bd4\u78c1\u76d8\u8bbf\u95ee\u5feb\u5f88\u591a\uff0c\u5728\u4e0b\u4e00\u6b21\u8bbf\u95ee\u76f8\u540c\u7684\u6570\u636e\u5c31\u4e0d\u9700\u8981\u901a\u8fc7\u78c1\u76d8 I/O \u4e86\uff0c\u547d\u4e2d\u7f13\u5b58\u5c31\u76f4\u63a5\u8fd4\u56de\u6570\u636e\u5373\u53ef\u3002</p> <p>\u56e0\u6b64\uff0cPage Cache \u8d77\u5230\u4e86\u52a0\u901f\u8bbf\u95ee\u6570\u636e\u7684\u4f5c\u7528\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#mysql","title":"MySQL \u7684\u7f13\u5b58","text":"<p>MySQL \u7684\u6570\u636e\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u91cc\u7684\uff0c\u4e3a\u4e86\u63d0\u5347\u6570\u636e\u5e93\u7684\u8bfb\u5199\u6027\u80fd\uff0cInnodb \u5b58\u50a8\u5f15\u64ce\u8bbe\u8ba1\u4e86\u4e00\u4e2a\u7f13\u51b2\u6c60\uff08Buffer Pool\uff09\uff0cBuffer Pool \u5c5e\u4e8e\u5185\u5b58\u7a7a\u95f4\u91cc\u7684\u6570\u636e\u3002</p> <p></p> <p>\u6709\u4e86\u7f13\u51b2\u6c60\u540e\uff1a</p> <ul> <li>\u5f53\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u4e8e Buffer Pool \u4e2d\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u76f4\u63a5\u8bfb\u53d6 Buffer Pool \u4e2d\u7684\u6570\u636e\uff0c\u5426\u5219\u518d\u53bb\u78c1\u76d8\u4e2d\u8bfb\u53d6\u3002</li> <li>\u5f53\u4fee\u6539\u6570\u636e\u65f6\uff0c\u9996\u5148\u662f\u4fee\u6539 Buffer Pool \u4e2d\u6570\u636e\u6240\u5728\u7684\u9875\uff0c\u7136\u540e\u5c06\u5176\u9875\u8bbe\u7f6e\u4e3a\u810f\u9875\uff0c\u6700\u540e\u7531\u540e\u53f0\u7ebf\u7a0b\u5c06\u810f\u9875\u5199\u5165\u5230\u78c1\u76d8\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#lru","title":"\u4f20\u7edf LRU \u662f\u5982\u4f55\u7ba1\u7406\u5185\u5b58\u6570\u636e\u7684\uff1f","text":"<p>Linux \u7684 Page Cache \u548c  MySQL \u7684 Buffer Pool \u7684\u5927\u5c0f\u662f\u6709\u9650\u7684\uff0c\u5e76\u4e0d\u80fd\u65e0\u9650\u7684\u7f13\u5b58\u6570\u636e\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u9891\u7e41\u8bbf\u95ee\u7684\u6570\u636e\u6211\u4eec\u5e0c\u671b\u53ef\u4ee5\u4e00\u76f4\u7559\u5728\u5185\u5b58\u4e2d\uff0c\u800c\u4e00\u4e9b\u5f88\u5c11\u8bbf\u95ee\u7684\u6570\u636e\u5e0c\u671b\u53ef\u4ee5\u5728\u67d0\u4e9b\u65f6\u673a\u53ef\u4ee5\u6dd8\u6c70\u6389\uff0c\u4ece\u800c\u4fdd\u8bc1\u5185\u5b58\u4e0d\u4f1a\u56e0\u4e3a\u6ee1\u4e86\u800c\u5bfc\u81f4\u65e0\u6cd5\u518d\u7f13\u5b58\u65b0\u7684\u6570\u636e\uff0c\u540c\u65f6\u8fd8\u80fd\u4fdd\u8bc1\u5e38\u7528\u6570\u636e\u7559\u5728\u5185\u5b58\u4e2d\u3002</p> <p>\u8981\u5b9e\u73b0\u8fd9\u4e2a\uff0c\u6700\u5bb9\u6613\u60f3\u5230\u7684\u5c31\u662f LRU\uff08Least recently used\uff09\u7b97\u6cd5\u3002</p> <p>LRU \u7b97\u6cd5\u4e00\u822c\u662f\u7528\u300c\u94fe\u8868\u300d\u4f5c\u4e3a\u6570\u636e\u7ed3\u6784\u6765\u5b9e\u73b0\u7684\uff0c\u94fe\u8868\u5934\u90e8\u7684\u6570\u636e\u662f\u6700\u8fd1\u4f7f\u7528\u7684\uff0c\u800c\u94fe\u8868\u672b\u5c3e\u7684\u6570\u636e\u662f\u6700\u4e45\u6ca1\u88ab\u4f7f\u7528\u7684\u3002\u90a3\u4e48\uff0c\u5f53\u7a7a\u95f4\u4e0d\u591f\u4e86\uff0c\u5c31\u6dd8\u6c70\u6700\u4e45\u6ca1\u88ab\u4f7f\u7528\u7684\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u94fe\u8868\u672b\u5c3e\u7684\u6570\u636e\uff0c\u4ece\u800c\u817e\u51fa\u5185\u5b58\u7a7a\u95f4\u3002</p> <p>\u56e0\u4e3a Linux \u7684 Page Cache \u548c  MySQL \u7684 Buffer Pool \u7f13\u5b58\u7684\u57fa\u672c\u6570\u636e\u5355\u4f4d\u90fd\u662f\u9875\uff08Page\uff09\u5355\u4f4d\uff0c\u6240\u4ee5\u540e\u7eed\u4ee5\u300c\u9875\u300d\u540d\u79f0\u4ee3\u66ff\u300c\u6570\u636e\u300d\u3002</p> <p>\u4f20\u7edf\u7684 LRU \u7b97\u6cd5\u7684\u5b9e\u73b0\u601d\u8def\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>\u5f53\u8bbf\u95ee\u7684\u9875\u5728\u5185\u5b58\u91cc\uff0c\u5c31\u76f4\u63a5\u628a\u8be5\u9875\u5bf9\u5e94\u7684 LRU \u94fe\u8868\u8282\u70b9\u79fb\u52a8\u5230\u94fe\u8868\u7684\u5934\u90e8\u3002</li> <li>\u5f53\u8bbf\u95ee\u7684\u9875\u4e0d\u5728\u5185\u5b58\u91cc\uff0c\u9664\u4e86\u8981\u628a\u8be5\u9875\u653e\u5165\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u8fd8\u8981\u6dd8\u6c70 LRU \u94fe\u8868\u672b\u5c3e\u7684\u9875\u3002</li> </ul> <p>\u6bd4\u5982\u4e0b\u56fe\uff0c\u5047\u8bbe LRU \u94fe\u8868\u957f\u5ea6\u4e3a 5\uff0cLRU \u94fe\u8868\u4ece\u5de6\u5230\u53f3\u6709\u7f16\u53f7\u4e3a 1\uff0c2\uff0c3\uff0c4\uff0c5 \u7684\u9875\u3002</p> <p></p> <p>\u5982\u679c\u8bbf\u95ee\u4e86 3 \u53f7\u9875\uff0c\u56e0\u4e3a 3 \u53f7\u9875\u5df2\u7ecf\u5728\u5185\u5b58\u4e86\uff0c\u6240\u4ee5\u628a 3 \u53f7\u9875\u79fb\u52a8\u5230\u94fe\u8868\u5934\u90e8\u5373\u53ef\uff0c\u8868\u793a\u6700\u8fd1\u88ab\u8bbf\u95ee\u4e86\u3002</p> <p></p> <p>\u800c\u5982\u679c\u63a5\u4e0b\u6765\uff0c\u8bbf\u95ee\u4e86 8 \u53f7\u9875\uff0c\u56e0\u4e3a 8 \u53f7\u9875\u4e0d\u5728\u5185\u5b58\u91cc\uff0c\u4e14 LRU \u94fe\u8868\u957f\u5ea6\u4e3a 5\uff0c\u6240\u4ee5\u5fc5\u987b\u8981\u6dd8\u6c70\u6570\u636e\uff0c\u4ee5\u817e\u51fa\u5185\u5b58\u7a7a\u95f4\u6765\u7f13\u5b58 8 \u53f7\u9875\uff0c\u4e8e\u662f\u5c31\u4f1a\u6dd8\u6c70\u672b\u5c3e\u7684 5 \u53f7\u9875\uff0c\u7136\u540e\u518d\u5c06 8 \u53f7\u9875\u52a0\u5165\u5230\u5934\u90e8\u3002</p> <p></p> <p>\u4f20\u7edf\u7684 LRU \u7b97\u6cd5\u5e76\u6ca1\u6709\u88ab Linux \u548c MySQL \u4f7f\u7528\uff0c\u56e0\u4e3a\u4f20\u7edf\u7684 LRU \u7b97\u6cd5\u65e0\u6cd5\u907f\u514d\u4e0b\u9762\u8fd9\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u9884\u8bfb\u5931\u6548\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\uff1b</li> <li>\u7f13\u5b58\u6c61\u67d3\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#_1","title":"\u9884\u8bfb\u5931\u6548\uff0c\u600e\u4e48\u529e\uff1f","text":""},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#_2","title":"\u4ec0\u4e48\u662f\u9884\u8bfb\u673a\u5236\uff1f","text":"<p>Linux \u64cd\u4f5c\u7cfb\u7edf\u4e3a\u57fa\u4e8e Page Cache \u7684\u8bfb\u7f13\u5b58\u673a\u5236\u63d0\u4f9b\u9884\u8bfb\u673a\u5236\uff0c\u4e00\u4e2a\u4f8b\u5b50\u662f\uff1a</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f\u53ea\u60f3\u8bfb\u53d6\u78c1\u76d8\u4e0a\u6587\u4ef6 A \u7684 offset \u4e3a 0-3KB \u8303\u56f4\u5185\u7684\u6570\u636e\uff0c\u7531\u4e8e\u78c1\u76d8\u7684\u57fa\u672c\u8bfb\u5199\u5355\u4f4d\u4e3a block\uff084KB\uff09\uff0c\u4e8e\u662f\u64cd\u4f5c\u7cfb\u7edf\u81f3\u5c11\u4f1a\u8bfb 0-4KB \u7684\u5185\u5bb9\uff0c\u8fd9\u6070\u597d\u53ef\u4ee5\u5728\u4e00\u4e2a page \u4e2d\u88c5\u4e0b\u3002</li> <li>\u4f46\u662f\u64cd\u4f5c\u7cfb\u7edf\u51fa\u4e8e\u7a7a\u95f4\u5c40\u90e8\u6027\u539f\u7406\uff08\u9760\u8fd1\u5f53\u524d\u88ab\u8bbf\u95ee\u6570\u636e\u7684\u6570\u636e\uff0c\u5728\u672a\u6765\u5f88\u5927\u6982\u7387\u4f1a\u88ab\u8bbf\u95ee\u5230\uff09\uff0c\u4f1a\u9009\u62e9\u5c06\u78c1\u76d8\u5757 offset [4KB,8KB)\u3001[8KB,12KB) \u4ee5\u53ca [12KB,16KB) \u90fd\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u4e8e\u662f\u989d\u5916\u5728\u5185\u5b58\u4e2d\u7533\u8bf7\u4e86 3 \u4e2a page\uff1b</li> </ul> <p>\u4e0b\u56fe\u4ee3\u8868\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u9884\u8bfb\u673a\u5236\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u5229\u7528 read \u7cfb\u7edf\u8c03\u52a8\u8bfb\u53d6 4KB \u6570\u636e\uff0c\u5b9e\u9645\u4e0a\u5185\u6838\u4f7f\u7528\u9884\u8bfb\u673a\u5236\uff08ReadaHead\uff09\u673a\u5236\u5b8c\u6210\u4e86 16KB \u6570\u636e\u7684\u8bfb\u53d6\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u4e00\u6b21\u78c1\u76d8\u987a\u5e8f\u8bfb\u5c06\u591a\u4e2a Page \u6570\u636e\u88c5\u5165 Page Cache\u3002</p> <p>\u8fd9\u6837\u4e0b\u6b21\u8bfb\u53d6 4KB \u6570\u636e\u540e\u9762\u7684\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u4e0d\u7528\u4ece\u78c1\u76d8\u8bfb\u53d6\u4e86\uff0c\u76f4\u63a5\u5728 Page Cache \u5373\u53ef\u547d\u4e2d\u6570\u636e\u3002\u56e0\u6b64\uff0c\u9884\u8bfb\u673a\u5236\u5e26\u6765\u7684\u597d\u5904\u5c31\u662f\u51cf\u5c11\u4e86 \u78c1\u76d8 I/O \u6b21\u6570\uff0c\u63d0\u9ad8\u7cfb\u7edf\u78c1\u76d8 I/O \u541e\u5410\u91cf\u3002</p> <p>MySQL Innodb \u5b58\u50a8\u5f15\u64ce\u7684 Buffer Pool \u4e5f\u6709\u7c7b\u4f3c\u7684\u9884\u8bfb\u673a\u5236\uff0cMySQL \u4ece\u78c1\u76d8\u52a0\u8f7d\u9875\u65f6\uff0c\u4f1a\u63d0\u524d\u628a\u5b83\u76f8\u90bb\u7684\u9875\u4e00\u5e76\u52a0\u8f7d\u8fdb\u6765\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8 IO\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#_3","title":"\u9884\u8bfb\u5931\u6548\u4f1a\u5e26\u6765\u4ec0\u4e48\u95ee\u9898\uff1f","text":"<p>\u5982\u679c\u8fd9\u4e9b\u88ab\u63d0\u524d\u52a0\u8f7d\u8fdb\u6765\u7684\u9875\uff0c\u5e76\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u76f8\u5f53\u4e8e\u8fd9\u4e2a\u9884\u8bfb\u5de5\u4f5c\u662f\u767d\u505a\u4e86\uff0c\u8fd9\u4e2a\u5c31\u662f\u9884\u8bfb\u5931\u6548\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u4f20\u7edf\u7684 LRU \u7b97\u6cd5\uff0c\u5c31\u4f1a\u628a\u300c\u9884\u8bfb\u9875\u300d\u653e\u5230 LRU \u94fe\u8868\u5934\u90e8\uff0c\u800c\u5f53\u5185\u5b58\u7a7a\u95f4\u4e0d\u591f\u7684\u65f6\u5019\uff0c\u8fd8\u9700\u8981\u628a\u672b\u5c3e\u7684\u9875\u6dd8\u6c70\u6389\u3002</p> <p>\u5982\u679c\u8fd9\u4e9b\u300c\u9884\u8bfb\u9875\u300d\u5982\u679c\u4e00\u76f4\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u5230\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e00\u4e2a\u5f88\u5947\u602a\u7684\u95ee\u9898\uff0c\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u7684\u9884\u8bfb\u9875\u5374\u5360\u7528\u4e86 LRU \u94fe\u8868\u524d\u6392\u7684\u4f4d\u7f6e\uff0c\u800c\u672b\u5c3e\u6dd8\u6c70\u7684\u9875\uff0c\u53ef\u80fd\u662f\u70ed\u70b9\u6570\u636e\uff0c\u8fd9\u6837\u5c31\u5927\u5927\u964d\u4f4e\u4e86\u7f13\u5b58\u547d\u4e2d\u7387 \u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#_4","title":"\u5982\u4f55\u907f\u514d\u9884\u8bfb\u5931\u6548\u9020\u6210\u7684\u5f71\u54cd\uff1f","text":"<p>\u6211\u4eec\u4e0d\u80fd\u56e0\u4e3a\u5bb3\u6015\u9884\u8bfb\u5931\u6548\uff0c\u800c\u5c06\u9884\u8bfb\u673a\u5236\u53bb\u6389\uff0c\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u7a7a\u95f4\u5c40\u90e8\u6027\u539f\u7406\u8fd8\u662f\u6210\u7acb\u7684\u3002</p> <p>\u8981\u907f\u514d\u9884\u8bfb\u5931\u6548\u5e26\u6765\u5f71\u54cd\uff0c\u6700\u597d\u5c31\u662f\u8ba9\u9884\u8bfb\u9875\u505c\u7559\u5728\u5185\u5b58\u91cc\u7684\u65f6\u95f4\u8981\u5c3d\u53ef\u80fd\u7684\u77ed\uff0c\u8ba9\u771f\u6b63\u88ab\u8bbf\u95ee\u7684\u9875\u624d\u79fb\u52a8\u5230 LRU \u94fe\u8868\u7684\u5934\u90e8\uff0c\u4ece\u800c\u4fdd\u8bc1\u771f\u6b63\u88ab\u8bfb\u53d6\u7684\u70ed\u6570\u636e\u7559\u5728\u5185\u5b58\u91cc\u7684\u65f6\u95f4\u5c3d\u53ef\u80fd\u957f\u3002</p> <p>\u90a3\u5230\u5e95\u600e\u4e48\u624d\u80fd\u907f\u514d\u5462\uff1f</p> <p>Linux \u64cd\u4f5c\u7cfb\u7edf\u548c MySQL Innodb \u901a\u8fc7\u6539\u8fdb\u4f20\u7edf LRU \u94fe\u8868\u6765\u907f\u514d\u9884\u8bfb\u5931\u6548\u5e26\u6765\u7684\u5f71\u54cd\uff0c\u5177\u4f53\u7684\u6539\u8fdb\u5206\u522b\u5982\u4e0b\uff1a</p> <ul> <li>Linux \u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u4e24\u4e2a\u4e86 LRU \u94fe\u8868\uff1a\u6d3b\u8dc3 LRU \u94fe\u8868\uff08active_list\uff09\u548c\u975e\u6d3b\u8dc3 LRU \u94fe\u8868\uff08inactive_list\uff09\uff1b</li> <li>MySQL \u7684 Innodb \u5b58\u50a8\u5f15\u64ce\u662f\u5728\u4e00\u4e2a LRU \u94fe\u8868\u4e0a\u5212\u5206\u6765 2 \u4e2a\u533a\u57df\uff1ayoung \u533a\u57df \u548c old \u533a\u57df\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u6539\u8fdb\u65b9\u5f0f\uff0c\u8bbe\u8ba1\u601d\u60f3\u90fd\u662f\u7c7b\u4f3c\u7684\uff0c\u90fd\u662f\u5c06\u6570\u636e\u5206\u4e3a\u4e86\u51b7\u6570\u636e\u548c\u70ed\u6570\u636e\uff0c\u7136\u540e\u5206\u522b\u8fdb\u884c LRU \u7b97\u6cd5\u3002\u4e0d\u518d\u50cf\u4f20\u7edf\u7684 LRU \u7b97\u6cd5\u90a3\u6837\uff0c\u6240\u6709\u6570\u636e\u90fd\u53ea\u7528\u4e00\u4e2a LRU \u7b97\u6cd5\u7ba1\u7406\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5177\u4f53\u804a\u804a Linux \u548c MySQL \u662f\u5982\u4f55\u907f\u514d\u9884\u8bfb\u5931\u6548\u5e26\u6765\u7684\u5f71\u54cd\uff1f</p> <p>Linux \u662f\u5982\u4f55\u907f\u514d\u9884\u8bfb\u5931\u6548\u5e26\u6765\u7684\u5f71\u54cd\uff1f</p> <p>Linux \u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u4e24\u4e2a\u4e86 LRU \u94fe\u8868\uff1a\u6d3b\u8dc3 LRU \u94fe\u8868\uff08active_list\uff09\u548c\u975e\u6d3b\u8dc3 LRU \u94fe\u8868\uff08inactive_list\uff09\u3002</p> <ul> <li>active list \u6d3b\u8dc3\u5185\u5b58\u9875\u94fe\u8868\uff0c\u8fd9\u91cc\u5b58\u653e\u7684\u662f\u6700\u8fd1\u88ab\u8bbf\u95ee\u8fc7\uff08\u6d3b\u8dc3\uff09\u7684\u5185\u5b58\u9875\uff1b</li> <li>inactive list \u4e0d\u6d3b\u8dc3\u5185\u5b58\u9875\u94fe\u8868\uff0c\u8fd9\u91cc\u5b58\u653e\u7684\u662f\u5f88\u5c11\u88ab\u8bbf\u95ee\uff08\u975e\u6d3b\u8dc3\uff09\u7684\u5185\u5b58\u9875\uff1b</li> </ul> <p>\u6709\u4e86\u8fd9\u4e24\u4e2a LRU \u94fe\u8868\u540e\uff0c\u9884\u8bfb\u9875\u5c31\u53ea\u9700\u8981\u52a0\u5165\u5230 inactive list \u533a\u57df\u7684\u5934\u90e8\uff0c\u5f53\u9875\u88ab\u771f\u6b63\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u624d\u5c06\u9875\u63d2\u5165 active list \u7684\u5934\u90e8\u3002\u5982\u679c\u9884\u8bfb\u7684\u9875\u4e00\u76f4\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u4ece inactive list \u79fb\u9664\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u5f71\u54cd active list \u4e2d\u7684\u70ed\u70b9\u6570\u636e\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u7ed9\u5927\u5bb6\u4e3e\u4e2a\u4f8b\u5b50\u3002</p> <p>\u5047\u8bbe active list \u548c inactive list \u7684\u957f\u5ea6\u4e3a 5\uff0c\u76ee\u524d\u5185\u5b58\u4e2d\u5df2\u7ecf\u6709\u5982\u4e0b 10 \u4e2a\u9875\uff1a</p> <p></p> <p>\u73b0\u5728\u6709\u4e2a\u7f16\u53f7\u4e3a 20 \u7684\u9875\u88ab\u9884\u8bfb\u4e86\uff0c\u8fd9\u4e2a\u9875\u53ea\u4f1a\u88ab\u63d2\u5165\u5230 inactive list \u7684\u5934\u90e8\uff0c\u800c inactive list \u672b\u5c3e\u7684\u9875\uff0810 \u53f7\uff09\u4f1a\u88ab\u6dd8\u6c70\u6389\u3002</p> <p></p> <p>\u5373\u4f7f\u7f16\u53f7\u4e3a 20 \u7684\u9884\u8bfb\u9875\u4e00\u76f4\u4e0d\u4f1a\u88ab\u8bbf\u95ee\uff0c\u5b83\u4e5f\u6ca1\u6709\u5360\u7528\u5230  active list \u7684\u4f4d\u7f6e\uff0c\u800c\u4e14\u8fd8\u4f1a\u6bd4 active list \u4e2d\u7684\u9875\u66f4\u65e9\u88ab\u6dd8\u6c70\u51fa\u53bb\u3002</p> <p>\u5982\u679c 20 \u53f7\u9875\u88ab\u9884\u8bfb\u540e\uff0c\u7acb\u523b\u88ab\u8bbf\u95ee\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06\u5b83\u63d2\u5165\u5230  active list \u7684\u5934\u90e8\uff0cactive list \u672b\u5c3e\u7684\u9875\uff085 \u53f7\uff09\uff0c\u4f1a\u88ab\u964d\u7ea7\u5230 inactive list\uff0c\u4f5c\u4e3a inactive list \u7684\u5934\u90e8\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u6709\u6570\u636e\u88ab\u6dd8\u6c70\u3002</p> <p></p> <p>MySQL \u662f\u5982\u4f55\u907f\u514d\u9884\u8bfb\u5931\u6548\u5e26\u6765\u7684\u5f71\u54cd\uff1f</p> <p>MySQL \u7684 Innodb \u5b58\u50a8\u5f15\u64ce\u662f\u5728\u4e00\u4e2a LRU \u94fe\u8868\u4e0a\u5212\u5206\u6765 2 \u4e2a\u533a\u57df\uff0cyoung \u533a\u57df \u548c old \u533a\u57df\u3002</p> <p>young \u533a\u57df\u5728 LRU \u94fe\u8868\u7684\u524d\u534a\u90e8\u5206\uff0cold \u533a\u57df\u5219\u662f\u5728\u540e\u534a\u90e8\u5206\uff0c\u8fd9\u4e24\u4e2a\u533a\u57df\u90fd\u6709\u5404\u81ea\u7684\u5934\u548c\u5c3e\u8282\u70b9\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>young \u533a\u57df\u4e0e old \u533a\u57df\u5728 LRU \u94fe\u8868\u4e2d\u7684\u5360\u6bd4\u5173\u7cfb\u5e76\u4e0d\u662f\u4e00\u6bd4\u4e00\u7684\u5173\u7cfb\uff0c\u800c\u662f\u662f 7 \u6bd4 3\uff08\u9ed8\u8ba4\u6bd4\u4f8b\uff09\u7684\u5173\u7cfb\u3002</p> <p>\u5212\u5206\u8fd9\u4e24\u4e2a\u533a\u57df\u540e\uff0c\u9884\u8bfb\u7684\u9875\u5c31\u53ea\u9700\u8981\u52a0\u5165\u5230 old \u533a\u57df\u7684\u5934\u90e8\uff0c\u5f53\u9875\u88ab\u771f\u6b63\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u624d\u5c06\u9875\u63d2\u5165 young \u533a\u57df\u7684\u5934\u90e8\u3002\u5982\u679c\u9884\u8bfb\u7684\u9875\u4e00\u76f4\u6ca1\u6709\u88ab\u8bbf\u95ee\uff0c\u5c31\u4f1a\u4ece old \u533a\u57df\u79fb\u9664\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u5f71\u54cd young \u533a\u57df\u4e2d\u7684\u70ed\u70b9\u6570\u636e\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u7ed9\u5927\u5bb6\u4e3e\u4e2a\u4f8b\u5b50\u3002</p> <p>\u5047\u8bbe\u6709\u4e00\u4e2a\u957f\u5ea6\u4e3a 10 \u7684 LRU \u94fe\u8868\uff0c\u5176\u4e2d young \u533a\u57df\u5360\u6bd4 70 %\uff0cold \u533a\u57df\u5360\u6bd4 30 %\u3002</p> <p></p> <p>\u73b0\u5728\u6709\u4e2a\u7f16\u53f7\u4e3a 20 \u7684\u9875\u88ab\u9884\u8bfb\u4e86\uff0c\u8fd9\u4e2a\u9875\u53ea\u4f1a\u88ab\u63d2\u5165\u5230 old \u533a\u57df\u5934\u90e8\uff0c\u800c old \u533a\u57df\u672b\u5c3e\u7684\u9875\uff0810 \u53f7\uff09\u4f1a\u88ab\u6dd8\u6c70\u6389\u3002</p> <p></p> <p>\u5982\u679c 20 \u53f7\u9875\u4e00\u76f4\u4e0d\u4f1a\u88ab\u8bbf\u95ee\uff0c\u5b83\u4e5f\u6ca1\u6709\u5360\u7528\u5230 young \u533a\u57df\u7684\u4f4d\u7f6e\uff0c\u800c\u4e14\u8fd8\u4f1a\u6bd4 young \u533a\u57df\u7684\u6570\u636e\u66f4\u65e9\u88ab\u6dd8\u6c70\u51fa\u53bb\u3002</p> <p>\u5982\u679c 20 \u53f7\u9875\u88ab\u9884\u8bfb\u540e\uff0c\u7acb\u523b\u88ab\u8bbf\u95ee\u4e86\uff0c\u90a3\u4e48\u5c31\u4f1a\u5c06\u5b83\u63d2\u5165\u5230 young \u533a\u57df\u7684\u5934\u90e8\uff0cyoung \u533a\u57df\u672b\u5c3e\u7684\u9875\uff087 \u53f7\uff09\uff0c\u4f1a\u88ab\u6324\u5230 old \u533a\u57df\uff0c\u4f5c\u4e3a old \u533a\u57df\u7684\u5934\u90e8\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5e76\u4e0d\u4f1a\u6709\u9875\u88ab\u6dd8\u6c70\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#_5","title":"\u7f13\u5b58\u6c61\u67d3\uff0c\u600e\u4e48\u529e\uff1f","text":""},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#_6","title":"\u4ec0\u4e48\u662f\u7f13\u5b58\u6c61\u67d3\uff1f","text":"<p>\u867d\u7136 Linux\uff08\u5b9e\u73b0\u4e24\u4e2a LRU \u94fe\u8868\uff09\u548c MySQL\uff08\u5212\u5206\u4e24\u4e2a\u533a\u57df\uff09\u901a\u8fc7\u6539\u8fdb\u4f20\u7edf\u7684 LRU \u6570\u636e\u7ed3\u6784\uff0c\u907f\u514d\u4e86\u9884\u8bfb\u5931\u6548\u5e26\u6765\u7684\u5f71\u54cd\u3002</p> <p>\u4f46\u662f\u5982\u679c\u8fd8\u662f\u4f7f\u7528\u300c\u53ea\u8981\u6570\u636e\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u5c31\u5c06\u6570\u636e\u52a0\u5165\u5230\u6d3b\u8dc3 LRU \u94fe\u8868\u5934\u90e8\uff08\u6216\u8005 young \u533a\u57df\uff09\u300d\u8fd9\u79cd\u65b9\u5f0f\u7684\u8bdd\uff0c\u90a3\u4e48\u8fd8\u5b58\u5728\u7f13\u5b58\u6c61\u67d3\u7684\u95ee\u9898\u3002</p> <p>\u5f53\u6211\u4eec\u5728\u6279\u91cf\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u6570\u636e\u88ab\u8bbf\u95ee\u4e86\u4e00\u6b21\uff0c\u8fd9\u4e9b\u5927\u91cf\u6570\u636e\u90fd\u4f1a\u88ab\u52a0\u5165\u5230\u300c\u6d3b\u8dc3 LRU \u94fe\u8868\u300d\u91cc\uff0c\u7136\u540e\u4e4b\u524d\u7f13\u5b58\u5728\u6d3b\u8dc3 LRU \u94fe\u8868\uff08\u6216\u8005 young \u533a\u57df\uff09\u91cc\u7684\u70ed\u70b9\u6570\u636e\u5168\u90e8\u90fd\u88ab\u6dd8\u6c70\u4e86\uff0c\u5982\u679c\u8fd9\u4e9b\u5927\u91cf\u7684\u6570\u636e\u5728\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u90fd\u4e0d\u4f1a\u88ab\u8bbf\u95ee\u7684\u8bdd\uff0c\u90a3\u4e48\u6574\u4e2a\u6d3b\u8dc3 LRU \u94fe\u8868\uff08\u6216\u8005 young \u533a\u57df\uff09\u5c31\u88ab\u6c61\u67d3\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#_7","title":"\u7f13\u5b58\u6c61\u67d3\u4f1a\u5e26\u6765\u4ec0\u4e48\u95ee\u9898\uff1f","text":"<p>\u7f13\u5b58\u6c61\u67d3\u5e26\u6765\u7684\u5f71\u54cd\u5c31\u662f\u5f88\u81f4\u547d\u7684\uff0c\u7b49\u8fd9\u4e9b\u70ed\u6570\u636e\u53c8\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5c31\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u78c1\u76d8 I/O\uff0c\u7cfb\u7edf\u6027\u80fd\u5c31\u4f1a\u6025\u5267\u4e0b\u964d\u3002</p> <p>\u6211\u4ee5 MySQL \u4e3e\u4f8b\u5b50\uff0cLinux \u53d1\u751f\u7f13\u5b58\u6c61\u67d3\u7684\u73b0\u8c61\u4e5f\u662f\u7c7b\u4f3c\u3002</p> <p>\u5f53\u67d0\u4e00\u4e2a SQL \u8bed\u53e5\u626b\u63cf\u4e86\u5927\u91cf\u7684\u6570\u636e\u65f6\uff0c\u5728 Buffer Pool \u7a7a\u95f4\u6bd4\u8f83\u6709\u9650\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u80fd\u4f1a\u5c06 Buffer Pool \u91cc\u7684\u6240\u6709\u9875\u90fd\u66ff\u6362\u51fa\u53bb\uff0c\u5bfc\u81f4\u5927\u91cf\u70ed\u6570\u636e\u88ab\u6dd8\u6c70\u4e86\uff0c\u7b49\u8fd9\u4e9b\u70ed\u6570\u636e\u53c8\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5c31\u4f1a\u4ea7\u751f\u5927\u91cf\u7684\u78c1\u76d8 I/O\uff0cMySQL \u6027\u80fd\u5c31\u4f1a\u6025\u5267\u4e0b\u964d\u3002</p> <p>\u6ce8\u610f\uff0c\u7f13\u5b58\u6c61\u67d3\u5e76\u4e0d\u53ea\u662f\u67e5\u8be2\u8bed\u53e5\u67e5\u8be2\u51fa\u4e86\u5927\u91cf\u7684\u6570\u636e\u624d\u51fa\u73b0\u7684\u95ee\u9898\uff0c\u5373\u4f7f\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u96c6\u5f88\u5c0f\uff0c\u4e5f\u4f1a\u9020\u6210\u7f13\u5b58\u6c61\u67d3\u3002</p> <p>\u6bd4\u5982\uff0c\u5728\u4e00\u4e2a\u6570\u636e\u91cf\u975e\u5e38\u5927\u7684\u8868\uff0c\u6267\u884c\u4e86\u8fd9\u6761\u8bed\u53e5\uff1a</p> SQL<pre><code>select * from t_user where name like \"%xiaolin%\";\n</code></pre> <p>\u53ef\u80fd\u8fd9\u4e2a\u67e5\u8be2\u51fa\u6765\u7684\u7ed3\u679c\u5c31\u51e0\u6761\u8bb0\u5f55\uff0c\u4f46\u662f\u7531\u4e8e\u8fd9\u6761\u8bed\u53e5\u4f1a\u53d1\u751f\u7d22\u5f15\u5931\u6548\uff0c\u6240\u4ee5\u8fd9\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u662f\u5168\u8868\u626b\u63cf\u7684\uff0c\u63a5\u7740\u4f1a\u53d1\u751f\u5982\u4e0b\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u4ece\u78c1\u76d8\u8bfb\u5230\u7684\u9875\u52a0\u5165\u5230 LRU \u94fe\u8868\u7684 old \u533a\u57df\u5934\u90e8\uff1b</li> <li>\u5f53\u4ece\u9875\u91cc\u8bfb\u53d6\u884c\u8bb0\u5f55\u65f6\uff0c\u4e5f\u5c31\u662f\u9875\u88ab\u8bbf\u95ee\u7684\u65f6\u5019\uff0c\u5c31\u8981\u5c06\u8be5\u9875\u653e\u5230 young \u533a\u57df\u5934\u90e8\uff1b</li> <li>\u63a5\u4e0b\u6765\u62ff\u884c\u8bb0\u5f55\u7684 name \u5b57\u6bb5\u548c\u5b57\u7b26\u4e32 xiaolin \u8fdb\u884c\u6a21\u7cca\u5339\u914d\uff0c\u5982\u679c\u7b26\u5408\u6761\u4ef6\uff0c\u5c31\u52a0\u5165\u5230\u7ed3\u679c\u96c6\u91cc\uff1b</li> <li>\u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u626b\u63cf\u5b8c\u8868\u4e2d\u7684\u6240\u6709\u8bb0\u5f55\u3002</li> </ul> <p>\u7ecf\u8fc7\u8fd9\u4e00\u756a\u6298\u817e\uff0c\u7531\u4e8e\u8fd9\u6761 SQL \u8bed\u53e5\u8bbf\u95ee\u7684\u9875\u975e\u5e38\u591a\uff0c\u6bcf\u8bbf\u95ee\u4e00\u4e2a\u9875\uff0c\u90fd\u4f1a\u5c06\u5176\u52a0\u5165 young \u533a\u57df\u5934\u90e8\uff0c\u90a3\u4e48\u539f\u672c young \u533a\u57df\u7684\u70ed\u70b9\u6570\u636e\u90fd\u4f1a\u88ab\u66ff\u6362\u6389\uff0c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\u3002\u90a3\u4e9b\u5728\u6279\u91cf\u626b\u63cf\u65f6\uff0c\u800c\u88ab\u52a0\u5165\u5230 young \u533a\u57df\u7684\u9875\uff0c\u5982\u679c\u5728\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u90fd\u4e0d\u4f1a\u518d\u88ab\u8bbf\u95ee\u7684\u8bdd\uff0c\u90a3\u4e48\u5c31\u6c61\u67d3\u4e86 young \u533a\u57df\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u9700\u8981\u6279\u91cf\u626b\u63cf\uff1a21\uff0c22\uff0c23\uff0c24\uff0c25 \u8fd9\u4e94\u4e2a\u9875\uff0c\u8fd9\u4e9b\u9875\u90fd\u4f1a\u88ab\u9010\u4e00\u8bbf\u95ee\uff08\u8bfb\u53d6\u9875\u91cc\u7684\u8bb0\u5f55\uff09\u3002</p> <p></p> <p>\u5728\u6279\u91cf\u8bbf\u95ee\u8fd9\u4e9b\u9875\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u9010\u4e00\u63d2\u5165\u5230 young \u533a\u57df\u5934\u90e8\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u539f\u672c\u5728 young \u533a\u57df\u7684 6 \u548c 7 \u53f7\u9875\u90fd\u88ab\u6dd8\u6c70\u4e86\uff0c\u800c\u6279\u91cf\u626b\u63cf\u7684\u9875\u57fa\u672c\u5360\u6ee1\u4e86 young \u533a\u57df\uff0c\u5982\u679c\u8fd9\u4e9b\u9875\u5728\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u90fd\u4e0d\u4f1a\u88ab\u8bbf\u95ee\uff0c\u90a3\u4e48\u5c31\u5bf9 young \u533a\u57df\u9020\u6210\u4e86\u6c61\u67d3\u3002</p> <p>\u5982\u679c 6 \u548c 7 \u53f7\u9875\u662f\u70ed\u70b9\u6570\u636e\uff0c\u90a3\u4e48\u5728\u88ab\u6dd8\u6c70\u540e\uff0c\u540e\u7eed\u6709 SQL \u518d\u6b21\u8bfb\u53d6  6 \u548c 7 \u53f7\u9875\u65f6\uff0c\u7531\u4e8e\u7f13\u5b58\u672a\u547d\u4e2d\uff0c\u5c31\u8981\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6\u4e86\uff0c\u964d\u4f4e\u4e86 MySQL \u7684\u6027\u80fd\uff0c\u8fd9\u5c31\u662f\u7f13\u5b58\u6c61\u67d3\u5e26\u6765\u7684\u5f71\u54cd\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#_8","title":"\u600e\u4e48\u907f\u514d\u7f13\u5b58\u6c61\u67d3\u9020\u6210\u7684\u5f71\u54cd\uff1f","text":"<p>\u524d\u9762\u7684 LRU \u7b97\u6cd5\u53ea\u8981\u6570\u636e\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u5c31\u5c06\u6570\u636e\u52a0\u5165\u6d3b\u8dc3 LRU \u94fe\u8868\uff08\u6216\u8005 young \u533a\u57df\uff09\uff0c\u8fd9\u79cd LRU \u7b97\u6cd5\u8fdb\u5165\u6d3b\u8dc3 LRU \u94fe\u8868\u7684\u95e8\u69db\u592a\u4f4e\u4e86\uff01\u6b63\u662f\u56e0\u4e3a\u95e8\u69db\u592a\u4f4e\uff0c\u624d\u5bfc\u81f4\u5728\u53d1\u751f\u7f13\u5b58\u6c61\u67d3\u7684\u65f6\u5019\uff0c\u5f88\u5bb9\u5c31\u5c06\u539f\u672c\u5728\u6d3b\u8dc3 LRU \u94fe\u8868\u91cc\u7684\u70ed\u70b9\u6570\u636e\u6dd8\u6c70\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u53ea\u8981\u6211\u4eec\u63d0\u9ad8\u8fdb\u5165\u5230\u6d3b\u8dc3 LRU \u94fe\u8868\uff08\u6216\u8005 young \u533a\u57df\uff09\u7684\u95e8\u69db\uff0c\u5c31\u80fd\u6709\u6548\u5730\u4fdd\u8bc1\u6d3b\u8dc3 LRU \u94fe\u8868\uff08\u6216\u8005 young \u533a\u57df\uff09\u91cc\u7684\u70ed\u70b9\u6570\u636e\u4e0d\u4f1a\u88ab\u8f7b\u6613\u66ff\u6362\u6389\u3002</p> <p>Linux \u64cd\u4f5c\u7cfb\u7edf\u548c MySQL Innodb \u5b58\u50a8\u5f15\u64ce\u5206\u522b\u662f\u8fd9\u6837\u63d0\u9ad8\u95e8\u69db\u7684\uff1a</p> <ul> <li>Linux \u64cd\u4f5c\u7cfb\u7edf\uff1a\u5728\u5185\u5b58\u9875\u88ab\u8bbf\u95ee\u7b2c\u4e8c\u6b21\u7684\u65f6\u5019\uff0c\u624d\u5c06\u9875\u4ece inactive list \u5347\u7ea7\u5230 active list \u91cc\u3002</li> <li>MySQL Innodb\uff1a\u5728\u5185\u5b58\u9875\u88ab\u8bbf\u95ee\u7b2c\u4e8c\u6b21\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u5c06\u8be5\u9875\u4ece old \u533a\u57df\u5347\u7ea7\u5230 young \u533a\u57df\uff0c\u56e0\u4e3a\u8fd8\u8981\u8fdb\u884c\u505c\u7559\u5728 old \u533a\u57df\u7684\u65f6\u95f4\u5224\u65ad\uff1a</li> <li>\u5982\u679c\u7b2c\u4e8c\u6b21\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u5728 1 \u79d2\u5185\uff08\u9ed8\u8ba4\u503c\uff09\uff0c\u90a3\u4e48\u8be5\u9875\u5c31\u4e0d\u4f1a\u88ab\u4ece old \u533a\u57df\u5347\u7ea7\u5230 young \u533a\u57df\uff1b</li> <li>\u5982\u679c\u7b2c\u4e8c\u6b21\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u8d85\u8fc7 1 \u79d2\uff0c\u90a3\u4e48\u8be5\u9875\u5c31\u4f1a\u4ece old \u533a\u57df\u5347\u7ea7\u5230 young \u533a\u57df\uff1b</li> </ul> <p>\u63d0\u9ad8\u4e86\u8fdb\u5165\u6d3b\u8dc3 LRU \u94fe\u8868\uff08\u6216\u8005 young \u533a\u57df\uff09\u7684\u95e8\u69db\u540e\uff0c\u5c31\u5f88\u597d\u4e86\u907f\u514d\u7f13\u5b58\u6c61\u67d3\u5e26\u6765\u7684\u5f71\u54cd\u3002</p> <p>\u5728\u6279\u91cf\u8bfb\u53d6\u6570\u636e\u65f6\u5019\uff0c\u5982\u679c\u8fd9\u4e9b\u5927\u91cf\u6570\u636e\u53ea\u4f1a\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u90a3\u4e48\u5b83\u4eec\u5c31\u4e0d\u4f1a\u8fdb\u5165\u5230\u6d3b\u8dc3 LRU \u94fe\u8868\uff08\u6216\u8005 young \u533a\u57df\uff09\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u628a\u70ed\u70b9\u6570\u636e\u6dd8\u6c70\uff0c\u53ea\u4f1a\u5f85\u5728\u975e\u6d3b\u8dc3 LRU \u94fe\u8868\uff08\u6216\u8005 old \u533a\u57df\uff09\u4e2d\uff0c\u540e\u7eed\u5f88\u5feb\u4e5f\u4f1a\u88ab\u6dd8\u6c70\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/cache_lru/#_9","title":"\u603b\u7ed3","text":"<p>\u4f20\u7edf\u7684 LRU \u7b97\u6cd5\u6cd5\u65e0\u6cd5\u907f\u514d\u4e0b\u9762\u8fd9\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u9884\u8bfb\u5931\u6548\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\uff1b</li> <li>\u7f13\u5b58\u6c61\u67d3\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\uff1b</li> </ul> <p>\u4e3a\u4e86\u907f\u514d\u300c\u9884\u8bfb\u5931\u6548\u300d\u9020\u6210\u7684\u5f71\u54cd\uff0cLinux \u548c MySQL \u5bf9\u4f20\u7edf\u7684 LRU \u94fe\u8868\u505a\u4e86\u6539\u8fdb\uff1a</p> <ul> <li>Linux \u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u4e24\u4e2a\u4e86 LRU \u94fe\u8868\uff1a\u6d3b\u8dc3 LRU \u94fe\u8868\uff08active list\uff09\u548c\u975e\u6d3b\u8dc3 LRU \u94fe\u8868\uff08inactive list\uff09\u3002</li> <li>MySQL  Innodb \u5b58\u50a8\u5f15\u64ce\u662f\u5728\u4e00\u4e2a LRU \u94fe\u8868\u4e0a\u5212\u5206\u6765 2 \u4e2a\u533a\u57df\uff1ayoung \u533a\u57df \u548c old \u533a\u57df\u3002</li> </ul> <p>\u4f46\u662f\u5982\u679c\u8fd8\u662f\u4f7f\u7528\u300c\u53ea\u8981\u6570\u636e\u88ab\u8bbf\u95ee\u4e00\u6b21\uff0c\u5c31\u5c06\u6570\u636e\u52a0\u5165\u5230\u6d3b\u8dc3 LRU \u94fe\u8868\u5934\u90e8\uff08\u6216\u8005 young \u533a\u57df\uff09\u300d\u8fd9\u79cd\u65b9\u5f0f\u7684\u8bdd\uff0c\u90a3\u4e48\u8fd8\u5b58\u5728\u7f13\u5b58\u6c61\u67d3\u7684\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u300c\u7f13\u5b58\u6c61\u67d3\u300d\u9020\u6210\u7684\u5f71\u54cd\uff0cLinux \u64cd\u4f5c\u7cfb\u7edf\u548c MySQL Innodb \u5b58\u50a8\u5f15\u64ce\u5206\u522b\u63d0\u9ad8\u4e86\u5347\u7ea7\u4e3a\u70ed\u70b9\u6570\u636e\u7684\u95e8\u69db\uff1a</p> <ul> <li>Linux \u64cd\u4f5c\u7cfb\u7edf\uff1a\u5728\u5185\u5b58\u9875\u88ab\u8bbf\u95ee\u7b2c\u4e8c\u6b21\u7684\u65f6\u5019\uff0c\u624d\u5c06\u9875\u4ece inactive list \u5347\u7ea7\u5230 active list \u91cc\u3002</li> <li>MySQL Innodb\uff1a\u5728\u5185\u5b58\u9875\u88ab\u8bbf\u95ee\u7b2c\u4e8c\u6b21\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u9a6c\u4e0a\u5c06\u8be5\u9875\u4ece old \u533a\u57df\u5347\u7ea7\u5230 young \u533a\u57df\uff0c\u56e0\u4e3a\u8fd8\u8981\u8fdb\u884c\u505c\u7559\u5728 old \u533a\u57df\u7684\u65f6\u95f4\u5224\u65ad\uff1a</li> <li>\u5982\u679c\u7b2c\u4e8c\u6b21\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u5728 1 \u79d2\u5185\uff08\u9ed8\u8ba4\u503c\uff09\uff0c\u90a3\u4e48\u8be5\u9875\u5c31\u4e0d\u4f1a\u88ab\u4ece old \u533a\u57df\u5347\u7ea7\u5230 young \u533a\u57df\uff1b</li> <li>\u5982\u679c\u7b2c\u4e8c\u6b21\u7684\u8bbf\u95ee\u65f6\u95f4\u4e0e\u7b2c\u4e00\u6b21\u8bbf\u95ee\u7684\u65f6\u95f4\u8d85\u8fc7 1 \u79d2\uff0c\u90a3\u4e48\u8be5\u9875\u5c31\u4f1a\u4ece old \u533a\u57df\u5347\u7ea7\u5230 young \u533a\u57df\uff1b</li> </ul> <p>\u901a\u8fc7\u63d0\u9ad8\u4e86\u8fdb\u5165 active list\uff08\u6216\u8005 young \u533a\u57df\uff09\u7684\u95e8\u69db\u540e\uff0c\u5c31\u5f88\u597d\u4e86\u907f\u514d\u7f13\u5b58\u6c61\u67d3\u5e26\u6765\u7684\u5f71\u54cd\u3002</p> <p>\u5b8c\uff01</p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/malloc/","title":"4.2 malloc \u662f\u5982\u4f55\u5206\u914d\u5185\u5b58\u7684\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u8fd9\u6b21\u6211\u4eec\u5c31\u4ee5 malloc \u52a8\u6001\u5185\u5b58\u5206\u914d\u4e3a\u5207\u5165\u70b9\uff0c\u6211\u5728\u6587\u4e2d\u4e5f\u505a\u4e86\u5c0f\u5b9e\u9a8c\uff1a</p> <ul> <li>malloc \u662f\u5982\u4f55\u5206\u914d\u5185\u5b58\u7684\uff1f</li> <li>malloc \u5206\u914d\u7684\u662f\u7269\u7406\u5185\u5b58\u5417\uff1f</li> <li>malloc(1)  \u4f1a\u5206\u914d\u591a\u5927\u7684\u5185\u5b58\uff1f</li> <li>free \u91ca\u653e\u5185\u5b58\uff0c\u4f1a\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u5417\uff1f</li> <li>free() \u51fd\u6570\u53ea\u4f20\u5165\u4e00\u4e2a\u5185\u5b58\u5730\u5740\uff0c\u4e3a\u4ec0\u4e48\u80fd\u77e5\u9053\u8981\u91ca\u653e\u591a\u5927\u7684\u5185\u5b58\uff1f</li> </ul> <p>\u53d1\u8f66\uff01</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/malloc/#linux","title":"Linux \u8fdb\u7a0b\u7684\u5185\u5b58\u5206\u5e03\u957f\u4ec0\u4e48\u6837\uff1f","text":"<p>\u5728 Linux \u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u5185\u90e8\u53c8\u88ab\u5206\u4e3a\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u4e24\u90e8\u5206\uff0c\u4e0d\u540c\u4f4d\u6570\u7684\u7cfb\u7edf\uff0c\u5730\u5740\u7a7a\u95f4\u7684\u8303\u56f4\u4e5f\u4e0d\u540c\u3002\u6bd4\u5982\u6700\u5e38\u89c1\u7684 32 \u4f4d\u548c 64 \u4f4d\u7cfb\u7edf\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\uff1a</p> <ul> <li><code>32</code> \u4f4d\u7cfb\u7edf\u7684\u5185\u6838\u7a7a\u95f4\u5360\u7528 <code>1G</code>\uff0c\u4f4d\u4e8e\u6700\u9ad8\u5904\uff0c\u5269\u4e0b\u7684 <code>3G</code> \u662f\u7528\u6237\u7a7a\u95f4\uff1b</li> <li><code>64</code> \u4f4d\u7cfb\u7edf\u7684\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u90fd\u662f <code>128T</code>\uff0c\u5206\u522b\u5360\u636e\u6574\u4e2a\u5185\u5b58\u7a7a\u95f4\u7684\u6700\u9ad8\u548c\u6700\u4f4e\u5904\uff0c\u5269\u4e0b\u7684\u4e2d\u95f4\u90e8\u5206\u662f\u672a\u5b9a\u4e49\u7684\u3002</li> </ul> <p>\u518d\u6765\u8bf4\u8bf4\uff0c\u5185\u6838\u7a7a\u95f4\u4e0e\u7528\u6237\u7a7a\u95f4\u7684\u533a\u522b\uff1a</p> <ul> <li>\u8fdb\u7a0b\u5728\u7528\u6237\u6001\u65f6\uff0c\u53ea\u80fd\u8bbf\u95ee\u7528\u6237\u7a7a\u95f4\u5185\u5b58\uff1b</li> <li>\u53ea\u6709\u8fdb\u5165\u5185\u6838\u6001\u540e\uff0c\u624d\u53ef\u4ee5\u8bbf\u95ee\u5185\u6838\u7a7a\u95f4\u7684\u5185\u5b58\uff1b</li> </ul> <p>\u867d\u7136\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u5404\u81ea\u6709\u72ec\u7acb\u7684\u865a\u62df\u5185\u5b58\uff0c\u4f46\u662f\u6bcf\u4e2a\u865a\u62df\u5185\u5b58\u4e2d\u7684\u5185\u6838\u5730\u5740\uff0c\u5176\u5b9e\u5173\u8054\u7684\u90fd\u662f\u76f8\u540c\u7684\u7269\u7406\u5185\u5b58\u3002\u8fd9\u6837\uff0c\u8fdb\u7a0b\u5207\u6362\u5230\u5185\u6838\u6001\u540e\uff0c\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8bbf\u95ee\u5185\u6838\u7a7a\u95f4\u5185\u5b58\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u8fdb\u4e00\u6b65\u4e86\u89e3\u865a\u62df\u7a7a\u95f4\u7684\u5212\u5206\u60c5\u51b5\uff0c\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u5212\u5206\u7684\u65b9\u5f0f\u662f\u4e0d\u540c\u7684\uff0c\u5185\u6838\u7a7a\u95f4\u7684\u5206\u5e03\u60c5\u51b5\u5c31\u4e0d\u591a\u8bf4\u4e86\u3002</p> <p>\u6211\u4eec\u770b\u770b\u7528\u6237\u7a7a\u95f4\u5206\u5e03\u7684\u60c5\u51b5\uff0c\u4ee5 32 \u4f4d\u7cfb\u7edf\u4e3a\u4f8b\uff0c\u6211\u753b\u4e86\u4e00\u5f20\u56fe\u6765\u8868\u793a\u5b83\u4eec\u7684\u5173\u7cfb\uff1a</p> <p>\u901a\u8fc7\u8fd9\u5f20\u56fe\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u7528\u6237\u7a7a\u95f4\u5185\u5b58\u4ece\u4f4e\u5230\u9ad8\u5206\u522b\u662f 6 \u79cd\u4e0d\u540c\u7684\u5185\u5b58\u6bb5\uff1a</p> <p></p> <ul> <li>\u7a0b\u5e8f\u6587\u4ef6\u6bb5\uff0c\u5305\u62ec\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u4ee3\u7801\uff1b</li> <li>\u5df2\u521d\u59cb\u5316\u6570\u636e\u6bb5\uff0c\u5305\u62ec\u9759\u6001\u5e38\u91cf\uff1b</li> <li>\u672a\u521d\u59cb\u5316\u6570\u636e\u6bb5\uff0c\u5305\u62ec\u672a\u521d\u59cb\u5316\u7684\u9759\u6001\u53d8\u91cf\uff1b</li> <li>\u5806\u6bb5\uff0c\u5305\u62ec\u52a8\u6001\u5206\u914d\u7684\u5185\u5b58\uff0c\u4ece\u4f4e\u5730\u5740\u5f00\u59cb\u5411\u4e0a\u589e\u957f\uff1b</li> <li>\u6587\u4ef6\u6620\u5c04\u6bb5\uff0c\u5305\u62ec\u52a8\u6001\u5e93\u3001\u5171\u4eab\u5185\u5b58\u7b49\uff0c\u4ece\u4f4e\u5730\u5740\u5f00\u59cb\u5411\u4e0a\u589e\u957f\uff08\u8ddf\u786c\u4ef6\u548c\u5185\u6838\u7248\u672c\u6709\u5173\uff09\uff1b</li> <li>\u6808\u6bb5\uff0c\u5305\u62ec\u5c40\u90e8\u53d8\u91cf\u548c\u51fd\u6570\u8c03\u7528\u7684\u4e0a\u4e0b\u6587\u7b49\u3002\u6808\u7684\u5927\u5c0f\u662f\u56fa\u5b9a\u7684\uff0c\u4e00\u822c\u662f <code>8 MB</code>\u3002\u5f53\u7136\u7cfb\u7edf\u4e5f\u63d0\u4f9b\u4e86\u53c2\u6570\uff0c\u4ee5\u4fbf\u6211\u4eec\u81ea\u5b9a\u4e49\u5927\u5c0f\uff1b</li> </ul> <p>\u5728\u8fd9 6 \u4e2a\u5185\u5b58\u6bb5\u4e2d\uff0c\u5806\u548c\u6587\u4ef6\u6620\u5c04\u6bb5\u7684\u5185\u5b58\u662f\u52a8\u6001\u5206\u914d\u7684\u3002\u6bd4\u5982\u8bf4\uff0c\u4f7f\u7528 C \u6807\u51c6\u5e93\u7684 <code>malloc()</code> \u6216\u8005 <code>mmap()</code> \uff0c\u5c31\u53ef\u4ee5\u5206\u522b\u5728\u5806\u548c\u6587\u4ef6\u6620\u5c04\u6bb5\u52a8\u6001\u5206\u914d\u5185\u5b58\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/malloc/#malloc","title":"malloc \u662f\u5982\u4f55\u5206\u914d\u5185\u5b58\u7684\uff1f","text":"<p>\u5b9e\u9645\u4e0a\uff0cmalloc() \u5e76\u4e0d\u662f\u7cfb\u7edf\u8c03\u7528\uff0c\u800c\u662f C \u5e93\u91cc\u7684\u51fd\u6570\uff0c\u7528\u4e8e\u52a8\u6001\u5206\u914d\u5185\u5b58\u3002</p> <p>malloc \u7533\u8bf7\u5185\u5b58\u7684\u65f6\u5019\uff0c\u4f1a\u6709\u4e24\u79cd\u65b9\u5f0f\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u5806\u5185\u5b58\u3002</p> <ul> <li>\u65b9\u5f0f\u4e00\uff1a\u901a\u8fc7 brk() \u7cfb\u7edf\u8c03\u7528\u4ece\u5806\u5206\u914d\u5185\u5b58</li> <li>\u65b9\u5f0f\u4e8c\uff1a\u901a\u8fc7 mmap() \u7cfb\u7edf\u8c03\u7528\u5728\u6587\u4ef6\u6620\u5c04\u533a\u57df\u5206\u914d\u5185\u5b58\uff1b</li> </ul> <p>\u65b9\u5f0f\u4e00\u5b9e\u73b0\u7684\u65b9\u5f0f\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u901a\u8fc7 brk() \u51fd\u6570\u5c06\u300c\u5806\u9876\u300d\u6307\u9488\u5411\u9ad8\u5730\u5740\u79fb\u52a8\uff0c\u83b7\u5f97\u65b0\u7684\u5185\u5b58\u7a7a\u95f4\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u65b9\u5f0f\u4e8c\u901a\u8fc7 mmap() \u7cfb\u7edf\u8c03\u7528\u4e2d\u300c\u79c1\u6709\u533f\u540d\u6620\u5c04\u300d\u7684\u65b9\u5f0f\uff0c\u5728\u6587\u4ef6\u6620\u5c04\u533a\u5206\u914d\u4e00\u5757\u5185\u5b58\uff0c\u4e5f\u5c31\u662f\u4ece\u6587\u4ef6\u6620\u5c04\u533a\u201c\u5077\u201d\u4e86\u4e00\u5757\u5185\u5b58\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4ec0\u4e48\u573a\u666f\u4e0b malloc()  \u4f1a\u901a\u8fc7 brk() \u5206\u914d\u5185\u5b58\uff1f\u53c8\u662f\u4ec0\u4e48\u573a\u666f\u4e0b\u901a\u8fc7 mmap() \u5206\u914d\u5185\u5b58\uff1f</p> <p>malloc() \u6e90\u7801\u91cc\u9ed8\u8ba4\u5b9a\u4e49\u4e86\u4e00\u4e2a\u9608\u503c\uff1a</p> <ul> <li>\u5982\u679c\u7528\u6237\u5206\u914d\u7684\u5185\u5b58\u5c0f\u4e8e 128 KB\uff0c\u5219\u901a\u8fc7 brk() \u7533\u8bf7\u5185\u5b58\uff1b</li> <li>\u5982\u679c\u7528\u6237\u5206\u914d\u7684\u5185\u5b58\u5927\u4e8e 128 KB\uff0c\u5219\u901a\u8fc7 mmap()  \u7533\u8bf7\u5185\u5b58\uff1b</li> </ul> <p>\u6ce8\u610f\uff0c\u4e0d\u540c\u7684 glibc \u7248\u672c\u5b9a\u4e49\u7684\u9608\u503c\u4e5f\u662f\u4e0d\u540c\u7684\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/malloc/#malloc_1","title":"malloc()  \u5206\u914d\u7684\u662f\u7269\u7406\u5185\u5b58\u5417\uff1f","text":"<p>\u4e0d\u662f\u7684\uff0cmalloc() \u5206\u914d\u7684\u662f\u865a\u62df\u5185\u5b58\u3002</p> <p>\u5982\u679c\u5206\u914d\u540e\u7684\u865a\u62df\u5185\u5b58\u6ca1\u6709\u88ab\u8bbf\u95ee\u7684\u8bdd\uff0c\u865a\u62df\u5185\u5b58\u662f\u4e0d\u4f1a\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\u7684\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u5360\u7528\u7269\u7406\u5185\u5b58\u4e86\u3002</p> <p>\u53ea\u6709\u5728\u8bbf\u95ee\u5df2\u5206\u914d\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7cfb\u7edf\u901a\u8fc7\u67e5\u627e\u9875\u8868\uff0c\u53d1\u73b0\u865a\u62df\u5185\u5b58\u5bf9\u5e94\u7684\u9875\u6ca1\u6709\u5728\u7269\u7406\u5185\u5b58\u4e2d\uff0c\u5c31\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\uff0c\u7136\u540e\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5efa\u7acb\u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/malloc/#malloc1","title":"malloc(1)  \u4f1a\u5206\u914d\u591a\u5927\u7684\u865a\u62df\u5185\u5b58\uff1f","text":"<p>malloc() \u5728\u5206\u914d\u5185\u5b58\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u662f\u8001\u8001\u5b9e\u5b9e\u6309\u7528\u6237\u9884\u671f\u7533\u8bf7\u7684\u5b57\u8282\u6570\u6765\u5206\u914d\u5185\u5b58\u7a7a\u95f4\u5927\u5c0f\uff0c\u800c\u662f\u4f1a\u9884\u5206\u914d\u66f4\u5927\u7684\u7a7a\u95f4\u4f5c\u4e3a\u5185\u5b58\u6c60\u3002</p> <p>\u5177\u4f53\u4f1a\u9884\u5206\u914d\u591a\u5927\u7684\u7a7a\u95f4\uff0c\u8ddf malloc \u4f7f\u7528\u7684\u5185\u5b58\u7ba1\u7406\u5668\u6709\u5173\u7cfb\uff0c\u6211\u4eec\u5c31\u4ee5 malloc \u9ed8\u8ba4\u7684\u5185\u5b58\u7ba1\u7406\u5668\uff08Ptmalloc2\uff09\u6765\u5206\u6790\u3002</p> <p>\u63a5\u4e0b\u91cc\uff0c\u6211\u4eec\u505a\u4e2a\u5b9e\u9a8c\uff0c\u7528\u4e0b\u9762\u8fd9\u4e2a\u4ee3\u7801\uff0c\u901a\u8fc7 malloc \u7533\u8bf7 1 \u5b57\u8282\u7684\u5185\u5b58\u65f6\uff0c\u770b\u770b\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u9645\u5206\u914d\u4e86\u591a\u5927\u7684\u5185\u5b58\u7a7a\u95f4\u3002</p> C<pre><code>#include &lt;stdio.h&gt;\n#include &lt;malloc.h&gt;\n\nint main() {\n  printf(\"\u4f7f\u7528 cat /proc/%d/maps\u67e5\u770b\u5185\u5b58\u5206\u914d\\n\",getpid());\n\n  //\u7533\u8bf7 1 \u5b57\u8282\u7684\u5185\u5b58\n  void *addr = malloc(1);\n  printf(\"\u6b64 1 \u5b57\u8282\u7684\u5185\u5b58\u8d77\u59cb\u5730\u5740\uff1a%x\\n\", addr);\n  printf(\"\u4f7f\u7528 cat /proc/%d/maps\u67e5\u770b\u5185\u5b58\u5206\u914d\\n\",getpid());\n\n  //\u5c06\u7a0b\u5e8f\u963b\u585e\uff0c\u5f53\u8f93\u5165\u4efb\u610f\u5b57\u7b26\u65f6\u624d\u5f80\u4e0b\u6267\u884c\n  getchar();\n\n  //\u91ca\u653e\u5185\u5b58\n  free(addr);\n  printf(\"\u91ca\u653e\u4e86 1 \u5b57\u8282\u7684\u5185\u5b58\uff0c\u4f46 heap \u5806\u5e76\u4e0d\u4f1a\u91ca\u653e\\n\");\n\n  getchar();\n  return 0;\n}\n</code></pre> <p>\u6267\u884c\u4ee3\u7801\uff08\u5148\u63d0\u524d\u8bf4\u660e\uff0c\u6211\u4f7f\u7528\u7684 glibc \u5e93\u7684\u7248\u672c\u662f 2.17\uff09\uff1a</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 /proc//maps \u6587\u4ef6\u67e5\u770b\u8fdb\u7a0b\u7684\u5185\u5b58\u5206\u5e03\u60c5\u51b5\u3002\u6211\u5728 maps \u6587\u4ef6\u901a\u8fc7\u6b64 1 \u5b57\u8282\u7684\u5185\u5b58\u8d77\u59cb\u5730\u5740\u8fc7\u6ee4\u51fa\u4e86\u5185\u5b58\u5730\u5740\u7684\u8303\u56f4\u3002</p> Bash<pre><code>[root@xiaolin ~]# cat /proc/3191/maps | grep d730\n00d73000-00d94000 rw-p 00000000 00:00 0                                  [heap]\n</code></pre> <p>\u8fd9\u4e2a\u4f8b\u5b50\u5206\u914d\u7684\u5185\u5b58\u5c0f\u4e8e 128 KB\uff0c\u6240\u4ee5\u662f\u901a\u8fc7 brk() \u7cfb\u7edf\u8c03\u7528\u5411\u5806\u7a7a\u95f4\u7533\u8bf7\u7684\u5185\u5b58\uff0c\u56e0\u6b64\u53ef\u4ee5\u770b\u5230\u6700\u53f3\u8fb9\u6709 [heap] \u7684\u6807\u8bc6\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5806\u7a7a\u95f4\u7684\u5185\u5b58\u5730\u5740\u8303\u56f4\u662f 00d73000-00d94000\uff0c\u8fd9\u4e2a\u8303\u56f4\u5927\u5c0f\u662f 132KB\uff0c\u4e5f\u5c31\u8bf4\u660e\u4e86 malloc(1) \u5b9e\u9645\u4e0a\u9884\u5206\u914d 132K \u5b57\u8282\u7684\u5185\u5b58\u3002</p> <p>\u53ef\u80fd\u6709\u7684\u540c\u5b66\u6ce8\u610f\u5230\u4e86\uff0c\u7a0b\u5e8f\u91cc\u6253\u5370\u7684\u5185\u5b58\u8d77\u59cb\u5730\u5740\u662f <code>d73010</code>\uff0c\u800c maps \u6587\u4ef6\u663e\u793a\u5806\u5185\u5b58\u7a7a\u95f4\u7684\u8d77\u59cb\u5730\u5740\u662f <code>d73000</code>\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u591a\u51fa\u6765 <code>0x10</code> \uff0816 \u5b57\u8282\uff09\u5462\uff1f\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u5148\u653e\u7740\uff0c\u540e\u9762\u4f1a\u8bf4\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/malloc/#free","title":"free \u91ca\u653e\u5185\u5b58\uff0c\u4f1a\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u5417\uff1f","text":"<p>\u6211\u4eec\u5728\u4e0a\u9762\u7684\u8fdb\u7a0b\u5f80\u4e0b\u6267\u884c\uff0c\u770b\u770b\u901a\u8fc7 free() \u51fd\u6570\u91ca\u653e\u5185\u5b58\u540e\uff0c\u5806\u5185\u5b58\u8fd8\u5728\u5417\uff1f</p> <p></p> <p>\u4ece\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u901a\u8fc7 free \u91ca\u653e\u5185\u5b58\u540e\uff0c\u5806\u5185\u5b58\u8fd8\u662f\u5b58\u5728\u7684\uff0c\u5e76\u6ca1\u6709\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p></p> <p>\u8fd9\u662f\u56e0\u4e3a\u4e0e\u5176\u628a\u8fd9 1 \u5b57\u8282\u91ca\u653e\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e0d\u5982\u5148\u7f13\u5b58\u7740\u653e\u8fdb malloc \u7684\u5185\u5b58\u6c60\u91cc\uff0c\u5f53\u8fdb\u7a0b\u518d\u6b21\u7533\u8bf7 1 \u5b57\u8282\u7684\u5185\u5b58\u65f6\u5c31\u53ef\u4ee5\u76f4\u63a5\u590d\u7528\uff0c\u8fd9\u6837\u901f\u5ea6\u5feb\u4e86\u5f88\u591a\u3002</p> <p>\u5f53\u7136\uff0c\u5f53\u8fdb\u7a0b\u9000\u51fa\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4f1a\u56de\u6536\u8fdb\u7a0b\u7684\u6240\u6709\u8d44\u6e90\u3002</p> <p>\u4e0a\u9762\u8bf4\u7684 free \u5185\u5b58\u540e\u5806\u5185\u5b58\u8fd8\u5b58\u5728\uff0c\u662f\u9488\u5bf9 malloc \u901a\u8fc7  brk() \u65b9\u5f0f\u7533\u8bf7\u7684\u5185\u5b58\u7684\u60c5\u51b5\u3002</p> <p>\u5982\u679c malloc \u901a\u8fc7 mmap \u65b9\u5f0f\u7533\u8bf7\u7684\u5185\u5b58\uff0cfree \u91ca\u653e\u5185\u5b58\u540e\u5c31\u4f1a\u5f52\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u6211\u4eec\u505a\u4e2a\u5b9e\u9a8c\u9a8c\u8bc1\u4e0b\uff0c\u901a\u8fc7 malloc \u7533\u8bf7 128 KB \u5b57\u8282\u7684\u5185\u5b58\uff0c\u6765\u4f7f\u5f97 malloc \u901a\u8fc7 mmap \u65b9\u5f0f\u6765\u5206\u914d\u5185\u5b58\u3002</p> C<pre><code>#include &lt;stdio.h&gt;\n#include &lt;malloc.h&gt;\n\nint main() {\n  //\u7533\u8bf7 1 \u5b57\u8282\u7684\u5185\u5b58\n  void *addr = malloc(128*1024);\n  printf(\"\u6b64 128KB \u5b57\u8282\u7684\u5185\u5b58\u8d77\u59cb\u5730\u5740\uff1a%x\\n\", addr);\n  printf(\"\u4f7f\u7528 cat /proc/%d/maps\u67e5\u770b\u5185\u5b58\u5206\u914d\\n\",getpid());\n\n  //\u5c06\u7a0b\u5e8f\u963b\u585e\uff0c\u5f53\u8f93\u5165\u4efb\u610f\u5b57\u7b26\u65f6\u624d\u5f80\u4e0b\u6267\u884c\n  getchar();\n\n  //\u91ca\u653e\u5185\u5b58\n  free(addr);\n  printf(\"\u91ca\u653e\u4e86 128KB \u5b57\u8282\u7684\u5185\u5b58\uff0c\u5185\u5b58\u4e5f\u5f52\u8fd8\u7ed9\u4e86\u64cd\u4f5c\u7cfb\u7edf\\n\");\n\n  getchar();\n  return 0;\n}\n</code></pre> <p>\u6267\u884c\u4ee3\u7801\uff1a</p> <p></p> <p>\u67e5\u770b\u8fdb\u7a0b\u7684\u5185\u5b58\u7684\u5206\u5e03\u60c5\u51b5\uff0c\u53ef\u4ee5\u53d1\u73b0\u6700\u53f3\u8fb9\u6ca1\u6709 [head] \u6807\u5fd7\uff0c\u8bf4\u660e\u662f\u901a\u8fc7 mmap \u4ee5\u533f\u540d\u6620\u5c04\u7684\u65b9\u5f0f\u4ece\u6587\u4ef6\u6620\u5c04\u533a\u5206\u914d\u7684\u533f\u540d\u5185\u5b58\u3002</p> <p></p> <p>\u7136\u540e\u6211\u4eec\u91ca\u653e\u6389\u8fd9\u4e2a\u5185\u5b58\u770b\u770b\uff1a</p> <p></p> <p>\u518d\u6b21\u67e5\u770b\u8be5 128 KB \u5185\u5b58\u7684\u8d77\u59cb\u5730\u5740\uff0c\u53ef\u4ee5\u53d1\u73b0\u5df2\u7ecf\u4e0d\u5b58\u5728\u4e86\uff0c\u8bf4\u660e\u5f52\u8fd8\u7ed9\u4e86\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p></p> <p>\u5bf9\u4e8e\u300cmalloc \u7533\u8bf7\u7684\u5185\u5b58\uff0cfree \u91ca\u653e\u5185\u5b58\u4f1a\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u5417\uff1f\u300d\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u505a\u4e2a\u603b\u7ed3\u4e86\uff1a</p> <ul> <li>malloc \u901a\u8fc7 brk() \u65b9\u5f0f\u7533\u8bf7\u7684\u5185\u5b58\uff0cfree \u91ca\u653e\u5185\u5b58\u7684\u65f6\u5019\uff0c\u5e76\u4e0d\u4f1a\u628a\u5185\u5b58\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u800c\u662f\u7f13\u5b58\u5728 malloc \u7684\u5185\u5b58\u6c60\u4e2d\uff0c\u5f85\u4e0b\u6b21\u4f7f\u7528\uff1b</li> <li>malloc \u901a\u8fc7 mmap() \u65b9\u5f0f\u7533\u8bf7\u7684\u5185\u5b58\uff0cfree \u91ca\u653e\u5185\u5b58\u7684\u65f6\u5019\uff0c\u4f1a\u628a\u5185\u5b58\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5185\u5b58\u5f97\u5230\u771f\u6b63\u7684\u91ca\u653e\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/malloc/#mmap","title":"\u4e3a\u4ec0\u4e48\u4e0d\u5168\u90e8\u4f7f\u7528 mmap \u6765\u5206\u914d\u5185\u5b58\uff1f","text":"<p>\u56e0\u4e3a\u5411\u64cd\u4f5c\u7cfb\u7edf\u7533\u8bf7\u5185\u5b58\uff0c\u662f\u8981\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7684\uff0c\u6267\u884c\u7cfb\u7edf\u8c03\u7528\u662f\u8981\u8fdb\u5165\u5185\u6838\u6001\u7684\uff0c\u7136\u540e\u5728\u56de\u5230\u7528\u6237\u6001\uff0c\u8fd0\u884c\u6001\u7684\u5207\u6362\u4f1a\u8017\u8d39\u4e0d\u5c11\u65f6\u95f4\u3002</p> <p>\u6240\u4ee5\uff0c\u7533\u8bf7\u5185\u5b58\u7684\u64cd\u4f5c\u5e94\u8be5\u907f\u514d\u9891\u7e41\u7684\u7cfb\u7edf\u8c03\u7528\uff0c\u5982\u679c\u90fd\u7528 mmap \u6765\u5206\u914d\u5185\u5b58\uff0c\u7b49\u4e8e\u6bcf\u6b21\u90fd\u8981\u6267\u884c\u7cfb\u7edf\u8c03\u7528\u3002</p> <p>\u53e6\u5916\uff0c\u56e0\u4e3a mmap \u5206\u914d\u7684\u5185\u5b58\u6bcf\u6b21\u91ca\u653e\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e8e\u662f\u6bcf\u6b21  mmap \u5206\u914d\u7684\u865a\u62df\u5730\u5740\u90fd\u662f\u7f3a\u9875\u72b6\u6001\u7684\uff0c\u7136\u540e\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u8be5\u865a\u62df\u5730\u5740\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u89e6\u53d1\u7f3a\u9875\u4e2d\u65ad\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u9891\u7e41\u901a\u8fc7 mmap \u5206\u914d\u7684\u5185\u5b58\u8bdd\uff0c\u4e0d\u4ec5\u6bcf\u6b21\u90fd\u4f1a\u53d1\u751f\u8fd0\u884c\u6001\u7684\u5207\u6362\uff0c\u8fd8\u4f1a\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\uff08\u5728\u7b2c\u4e00\u6b21\u8bbf\u95ee\u865a\u62df\u5730\u5740\u540e\uff09\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4 CPU \u6d88\u8017\u8f83\u5927\u3002</p> <p>\u4e3a\u4e86\u6539\u8fdb\u8fd9\u4e24\u4e2a\u95ee\u9898\uff0cmalloc \u901a\u8fc7 brk() \u7cfb\u7edf\u8c03\u7528\u5728\u5806\u7a7a\u95f4\u7533\u8bf7\u5185\u5b58\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u5806\u7a7a\u95f4\u662f\u8fde\u7eed\u7684\uff0c\u6240\u4ee5\u76f4\u63a5\u9884\u5206\u914d\u66f4\u5927\u7684\u5185\u5b58\u6765\u4f5c\u4e3a\u5185\u5b58\u6c60\uff0c\u5f53\u5185\u5b58\u91ca\u653e\u7684\u65f6\u5019\uff0c\u5c31\u7f13\u5b58\u5728\u5185\u5b58\u6c60\u4e2d\u3002</p> <p>\u7b49\u4e0b\u6b21\u5728\u7533\u8bf7\u5185\u5b58\u7684\u65f6\u5019\uff0c\u5c31\u76f4\u63a5\u4ece\u5185\u5b58\u6c60\u53d6\u51fa\u5bf9\u5e94\u7684\u5185\u5b58\u5757\u5c31\u884c\u4e86\uff0c\u800c\u4e14\u53ef\u80fd\u8fd9\u4e2a\u5185\u5b58\u5757\u7684\u865a\u62df\u5730\u5740\u4e0e\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\u8fd8\u5b58\u5728\uff0c\u8fd9\u6837\u4e0d\u4ec5\u51cf\u5c11\u4e86\u7cfb\u7edf\u8c03\u7528\u7684\u6b21\u6570\uff0c\u4e5f\u51cf\u5c11\u4e86\u7f3a\u9875\u4e2d\u65ad\u7684\u6b21\u6570\uff0c\u8fd9\u5c06\u5927\u5927\u964d\u4f4e CPU \u7684\u6d88\u8017\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/malloc/#brk-brk","title":"\u65e2\u7136 brk \u90a3\u4e48\u725b\u903c\uff0c\u4e3a\u4ec0\u4e48\u4e0d\u5168\u90e8\u4f7f\u7528 brk \u6765\u5206\u914d\uff1f","text":"<p>\u524d\u9762\u6211\u4eec\u63d0\u5230\u901a\u8fc7 brk \u4ece\u5806\u7a7a\u95f4\u5206\u914d\u7684\u5185\u5b58\uff0c\u5e76\u4e0d\u4f1a\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u90a3\u4e48\u6211\u4eec\u90a3\u8003\u8651\u8fd9\u6837\u4e00\u4e2a\u573a\u666f\u3002</p> <p>\u5982\u679c\u6211\u4eec\u8fde\u7eed\u7533\u8bf7\u4e86 10k\uff0c20k\uff0c30k \u8fd9\u4e09\u7247\u5185\u5b58\uff0c\u5982\u679c 10k \u548c 20k \u8fd9\u4e24\u7247\u91ca\u653e\u4e86\uff0c\u53d8\u4e3a\u4e86\u7a7a\u95f2\u5185\u5b58\u7a7a\u95f4\uff0c\u5982\u679c\u4e0b\u6b21\u7533\u8bf7\u7684\u5185\u5b58\u5c0f\u4e8e 30k\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u91cd\u7528\u8fd9\u4e2a\u7a7a\u95f2\u5185\u5b58\u7a7a\u95f4\u3002</p> <p></p> <p>\u4f46\u662f\u5982\u679c\u4e0b\u6b21\u7533\u8bf7\u7684\u5185\u5b58\u5927\u4e8e 30k\uff0c\u6ca1\u6709\u53ef\u7528\u7684\u7a7a\u95f2\u5185\u5b58\u7a7a\u95f4\uff0c\u5fc5\u987b\u5411 OS \u7533\u8bf7\uff0c\u5b9e\u9645\u4f7f\u7528\u5185\u5b58\u7ee7\u7eed\u589e\u5927\u3002</p> <p>\u56e0\u6b64\uff0c\u968f\u7740\u7cfb\u7edf\u9891\u7e41\u5730 malloc \u548c free\uff0c\u5c24\u5176\u5bf9\u4e8e\u5c0f\u5757\u5185\u5b58\uff0c\u5806\u5185\u5c06\u4ea7\u751f\u8d8a\u6765\u8d8a\u591a\u4e0d\u53ef\u7528\u7684\u788e\u7247\uff0c\u5bfc\u81f4\u201c\u5185\u5b58\u6cc4\u9732\u201d\u3002\u800c\u8fd9\u79cd\u201c\u6cc4\u9732\u201d\u73b0\u8c61\u4f7f\u7528 valgrind \u662f\u65e0\u6cd5\u68c0\u6d4b\u51fa\u6765\u7684\u3002</p> <p>\u6240\u4ee5\uff0cmalloc \u5b9e\u73b0\u4e2d\uff0c\u5145\u5206\u8003\u8651\u4e86 brk \u548c mmap \u884c\u4e3a\u4e0a\u7684\u5dee\u5f02\u53ca\u4f18\u7f3a\u70b9\uff0c\u9ed8\u8ba4\u5206\u914d\u5927\u5757\u5185\u5b58 (128KB) \u624d\u4f7f\u7528 mmap \u5206\u914d\u5185\u5b58\u7a7a\u95f4\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/malloc/#free_1","title":"free() \u51fd\u6570\u53ea\u4f20\u5165\u4e00\u4e2a\u5185\u5b58\u5730\u5740\uff0c\u4e3a\u4ec0\u4e48\u80fd\u77e5\u9053\u8981\u91ca\u653e\u591a\u5927\u7684\u5185\u5b58\uff1f","text":"<p>\u8fd8\u8bb0\u5f97\uff0c\u6211\u524d\u9762\u63d0\u5230\uff0cmalloc \u8fd4\u56de\u7ed9\u7528\u6237\u6001\u7684\u5185\u5b58\u8d77\u59cb\u5730\u5740\u6bd4\u8fdb\u7a0b\u7684\u5806\u7a7a\u95f4\u8d77\u59cb\u5730\u5740\u591a\u4e86 16 \u5b57\u8282\u5417\uff1f</p> <p>\u8fd9\u4e2a\u591a\u51fa\u6765\u7684 16 \u5b57\u8282\u5c31\u662f\u4fdd\u5b58\u4e86\u8be5\u5185\u5b58\u5757\u7684\u63cf\u8ff0\u4fe1\u606f\uff0c\u6bd4\u5982\u6709\u8be5\u5185\u5b58\u5757\u7684\u5927\u5c0f\u3002</p> <p></p> <p>\u8fd9\u6837\u5f53\u6267\u884c free() \u51fd\u6570\u65f6\uff0cfree \u4f1a\u5bf9\u4f20\u5165\u8fdb\u6765\u7684\u5185\u5b58\u5730\u5740\u5411\u5de6\u504f\u79fb 16 \u5b57\u8282\uff0c\u7136\u540e\u4ece\u8fd9\u4e2a 16 \u5b57\u8282\u7684\u5206\u6790\u51fa\u5f53\u524d\u7684\u5185\u5b58\u5757\u7684\u5927\u5c0f\uff0c\u81ea\u7136\u5c31\u77e5\u9053\u8981\u91ca\u653e\u591a\u5927\u7684\u5185\u5b58\u4e86\u3002</p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/mem_reclaim/","title":"4.3 \u5185\u5b58\u6ee1\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u524d\u51e0\u5929\u6709\u4f4d\u8bfb\u8005\u7559\u8a00\u8bf4\uff0c\u9762\u817e\u8baf\u65f6\uff0c\u88ab\u95ee\u4e86\u4e24\u4e2a\u5185\u5b58\u7ba1\u7406\u7684\u95ee\u9898\uff1a</p> <p></p> <p></p> <p>\u5148\u6765\u8bf4\u8bf4\u7b2c\u4e00\u4e2a\u95ee\u9898\uff1a\u865a\u62df\u5185\u5b58\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f</p> <ul> <li>\u7b2c\u4e00\uff0c\u865a\u62df\u5185\u5b58\u53ef\u4ee5\u4f7f\u5f97\u8fdb\u7a0b\u5bf9\u8fd0\u884c\u5185\u5b58\u8d85\u8fc7\u7269\u7406\u5185\u5b58\u5927\u5c0f\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u8fd0\u884c\u7b26\u5408\u5c40\u90e8\u6027\u539f\u7406\uff0cCPU \u8bbf\u95ee\u5185\u5b58\u4f1a\u6709\u5f88\u660e\u663e\u7684\u91cd\u590d\u8bbf\u95ee\u7684\u503e\u5411\u6027\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u6ca1\u6709\u88ab\u7ecf\u5e38\u4f7f\u7528\u5230\u7684\u5185\u5b58\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u6362\u51fa\u5230\u7269\u7406\u5185\u5b58\u4e4b\u5916\uff0c\u6bd4\u5982\u786c\u76d8\u4e0a\u7684 swap \u533a\u57df\u3002</li> <li>\u7b2c\u4e8c\uff0c\u7531\u4e8e\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u9875\u8868\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5c31\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u3002\u8fdb\u7a0b\u4e5f\u6ca1\u6709\u529e\u6cd5\u8bbf\u95ee\u5176\u4ed6\u8fdb\u7a0b\u7684\u9875\u8868\uff0c\u6240\u4ee5\u8fd9\u4e9b\u9875\u8868\u662f\u79c1\u6709\u7684\uff0c\u8fd9\u5c31\u89e3\u51b3\u4e86\u591a\u8fdb\u7a0b\u4e4b\u95f4\u5730\u5740\u51b2\u7a81\u7684\u95ee\u9898\u3002</li> <li>\u7b2c\u4e09\uff0c\u9875\u8868\u91cc\u7684\u9875\u8868\u9879\u4e2d\u9664\u4e86\u7269\u7406\u5730\u5740\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u6807\u8bb0\u5c5e\u6027\u7684\u6bd4\u7279\uff0c\u6bd4\u5982\u63a7\u5236\u4e00\u4e2a\u9875\u7684\u8bfb\u5199\u6743\u9650\uff0c\u6807\u8bb0\u8be5\u9875\u662f\u5426\u5b58\u5728\u7b49\u3002\u5728\u5185\u5b58\u8bbf\u95ee\u65b9\u9762\uff0c\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u5b89\u5168\u6027\u3002</li> </ul> <p>\u7136\u540e\u4eca\u5929\u4e3b\u8981\u662f\u804a\u804a\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff0c\u300c\u7cfb\u7edf\u5185\u5b58\u7d27\u5f20\u65f6\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u300d</p> <p>\u53d1\u8f66\uff01</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/mem_reclaim/#_1","title":"\u5185\u5b58\u5206\u914d\u7684\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>\u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7 malloc \u51fd\u6570\u7533\u8bf7\u5185\u5b58\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u7533\u8bf7\u7684\u662f\u865a\u62df\u5185\u5b58\uff0c\u6b64\u65f6\u5e76\u4e0d\u4f1a\u5206\u914d\u7269\u7406\u5185\u5b58\u3002</p> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u8bfb\u5199\u4e86\u8fd9\u5757\u865a\u62df\u5185\u5b58\uff0cCPU \u5c31\u4f1a\u53bb\u8bbf\u95ee\u8fd9\u4e2a\u865a\u62df\u5185\u5b58\uff0c\u8fd9\u65f6\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u865a\u62df\u5185\u5b58\u6ca1\u6709\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\uff0cCPU \u5c31\u4f1a\u4ea7\u751f\u7f3a\u9875\u4e2d\u65ad\uff0c\u8fdb\u7a0b\u4f1a\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u5e76\u5c06\u7f3a\u9875\u4e2d\u65ad\u4ea4\u7ed9\u5185\u6838\u7684 Page Fault Handler\uff08\u7f3a\u9875\u4e2d\u65ad\u51fd\u6570\uff09\u5904\u7406\u3002</p> <p>\u7f3a\u9875\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u4f1a\u770b\u662f\u5426\u6709\u7a7a\u95f2\u7684\u7269\u7406\u5185\u5b58\uff0c\u5982\u679c\u6709\uff0c\u5c31\u76f4\u63a5\u5206\u914d\u7269\u7406\u5185\u5b58\uff0c\u5e76\u5efa\u7acb\u865a\u62df\u5185\u5b58\u4e0e\u7269\u7406\u5185\u5b58\u4e4b\u95f4\u7684\u6620\u5c04\u5173\u7cfb\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u7a7a\u95f2\u7684\u7269\u7406\u5185\u5b58\uff0c\u90a3\u4e48\u5185\u6838\u5c31\u4f1a\u5f00\u59cb\u8fdb\u884c\u56de\u6536\u5185\u5b58\u7684\u5de5\u4f5c\uff0c\u56de\u6536\u7684\u65b9\u5f0f\u4e3b\u8981\u662f\u4e24\u79cd\uff1a\u76f4\u63a5\u5185\u5b58\u56de\u6536\u548c\u540e\u53f0\u5185\u5b58\u56de\u6536\u3002</p> <ul> <li>\u540e\u53f0\u5185\u5b58\u56de\u6536\uff08kswapd\uff09\uff1a\u5728\u7269\u7406\u5185\u5b58\u7d27\u5f20\u7684\u65f6\u5019\uff0c\u4f1a\u5524\u9192 kswapd \u5185\u6838\u7ebf\u7a0b\u6765\u56de\u6536\u5185\u5b58\uff0c\u8fd9\u4e2a\u56de\u6536\u5185\u5b58\u7684\u8fc7\u7a0b\u5f02\u6b65\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u8fdb\u7a0b\u7684\u6267\u884c\u3002</li> <li>\u76f4\u63a5\u5185\u5b58\u56de\u6536\uff08direct reclaim\uff09\uff1a\u5982\u679c\u540e\u53f0\u5f02\u6b65\u56de\u6536\u8ddf\u4e0d\u4e0a\u8fdb\u7a0b\u5185\u5b58\u7533\u8bf7\u7684\u901f\u5ea6\uff0c\u5c31\u4f1a\u5f00\u59cb\u76f4\u63a5\u56de\u6536\uff0c\u8fd9\u4e2a\u56de\u6536\u5185\u5b58\u7684\u8fc7\u7a0b\u662f\u540c\u6b65\u7684\uff0c\u4f1a\u963b\u585e\u8fdb\u7a0b\u7684\u6267\u884c\u3002</li> </ul> <p>\u5982\u679c\u76f4\u63a5\u5185\u5b58\u56de\u6536\u540e\uff0c\u7a7a\u95f2\u7684\u7269\u7406\u5185\u5b58\u4ecd\u7136\u65e0\u6cd5\u6ee1\u8db3\u6b64\u6b21\u7269\u7406\u5185\u5b58\u7684\u7533\u8bf7\uff0c\u90a3\u4e48\u5185\u6838\u5c31\u4f1a\u653e\u6700\u540e\u7684\u5927\u62db\u4e86 \u2014\u2014\u89e6\u53d1 OOM\uff08Out of Memory\uff09\u673a\u5236\u3002</p> <p>OOM Killer \u673a\u5236\u4f1a\u6839\u636e\u7b97\u6cd5\u9009\u62e9\u4e00\u4e2a\u5360\u7528\u7269\u7406\u5185\u5b58\u8f83\u9ad8\u7684\u8fdb\u7a0b\uff0c\u7136\u540e\u5c06\u5176\u6740\u6b7b\uff0c\u4ee5\u4fbf\u91ca\u653e\u5185\u5b58\u8d44\u6e90\uff0c\u5982\u679c\u7269\u7406\u5185\u5b58\u4f9d\u7136\u4e0d\u8db3\uff0cOOM Killer \u4f1a\u7ee7\u7eed\u6740\u6b7b\u5360\u7528\u7269\u7406\u5185\u5b58\u8f83\u9ad8\u7684\u8fdb\u7a0b\uff0c\u76f4\u5230\u91ca\u653e\u8db3\u591f\u7684\u5185\u5b58\u4f4d\u7f6e\u3002</p> <p>\u7533\u8bf7\u7269\u7406\u5185\u5b58\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/mem_reclaim/#_2","title":"\u54ea\u4e9b\u5185\u5b58\u53ef\u4ee5\u88ab\u56de\u6536\uff1f","text":"<p>\u7cfb\u7edf\u5185\u5b58\u7d27\u5f20\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8fdb\u884c\u56de\u6536\u5185\u5b58\u7684\u5de5\u4f5c\uff0c\u90a3\u5177\u4f53\u54ea\u4e9b\u5185\u5b58\u662f\u53ef\u4ee5\u88ab\u56de\u6536\u7684\u5462\uff1f</p> <p>\u4e3b\u8981\u6709\u4e24\u7c7b\u5185\u5b58\u53ef\u4ee5\u88ab\u56de\u6536\uff0c\u800c\u4e14\u5b83\u4eec\u7684\u56de\u6536\u65b9\u5f0f\u4e5f\u4e0d\u540c\u3002</p> <ul> <li>\u6587\u4ef6\u9875\uff08File-backed Page\uff09\uff1a\u5185\u6838\u7f13\u5b58\u7684\u78c1\u76d8\u6570\u636e\uff08Buffer\uff09\u548c\u5185\u6838\u7f13\u5b58\u7684\u6587\u4ef6\u6570\u636e\uff08Cache\uff09\u90fd\u53eb\u4f5c\u6587\u4ef6\u9875\u3002\u5927\u90e8\u5206\u6587\u4ef6\u9875\uff0c\u90fd\u53ef\u4ee5\u76f4\u63a5\u91ca\u653e\u5185\u5b58\uff0c\u4ee5\u540e\u6709\u9700\u8981\u65f6\uff0c\u518d\u4ece\u78c1\u76d8\u91cd\u65b0\u8bfb\u53d6\u5c31\u53ef\u4ee5\u4e86\u3002\u800c\u90a3\u4e9b\u88ab\u5e94\u7528\u7a0b\u5e8f\u4fee\u6539\u8fc7\uff0c\u5e76\u4e14\u6682\u65f6\u8fd8\u6ca1\u5199\u5165\u78c1\u76d8\u7684\u6570\u636e\uff08\u4e5f\u5c31\u662f\u810f\u9875\uff09\uff0c\u5c31\u5f97\u5148\u5199\u5165\u78c1\u76d8\uff0c\u7136\u540e\u624d\u80fd\u8fdb\u884c\u5185\u5b58\u91ca\u653e\u3002\u6240\u4ee5\uff0c\u56de\u6536\u5e72\u51c0\u9875\u7684\u65b9\u5f0f\u662f\u76f4\u63a5\u91ca\u653e\u5185\u5b58\uff0c\u56de\u6536\u810f\u9875\u7684\u65b9\u5f0f\u662f\u5148\u5199\u56de\u78c1\u76d8\u540e\u518d\u91ca\u653e\u5185\u5b58\u3002</li> <li>\u533f\u540d\u9875\uff08Anonymous Page\uff09\uff1a\u8fd9\u90e8\u5206\u5185\u5b58\u6ca1\u6709\u5b9e\u9645\u8f7d\u4f53\uff0c\u4e0d\u50cf\u6587\u4ef6\u7f13\u5b58\u6709\u786c\u76d8\u6587\u4ef6\u8fd9\u6837\u4e00\u4e2a\u8f7d\u4f53\uff0c\u6bd4\u5982\u5806\u3001\u6808\u6570\u636e\u7b49\u3002\u8fd9\u90e8\u5206\u5185\u5b58\u5f88\u53ef\u80fd\u8fd8\u8981\u518d\u6b21\u88ab\u8bbf\u95ee\uff0c\u6240\u4ee5\u4e0d\u80fd\u76f4\u63a5\u91ca\u653e\u5185\u5b58\uff0c\u5b83\u4eec\u56de\u6536\u7684\u65b9\u5f0f\u662f\u901a\u8fc7 Linux \u7684 Swap \u673a\u5236\uff0cSwap \u4f1a\u628a\u4e0d\u5e38\u8bbf\u95ee\u7684\u5185\u5b58\u5148\u5199\u5230\u78c1\u76d8\u4e2d\uff0c\u7136\u540e\u91ca\u653e\u8fd9\u4e9b\u5185\u5b58\uff0c\u7ed9\u5176\u4ed6\u66f4\u9700\u8981\u7684\u8fdb\u7a0b\u4f7f\u7528\u3002\u518d\u6b21\u8bbf\u95ee\u8fd9\u4e9b\u5185\u5b58\u65f6\uff0c\u91cd\u65b0\u4ece\u78c1\u76d8\u8bfb\u5165\u5185\u5b58\u5c31\u53ef\u4ee5\u4e86\u3002</li> </ul> <p>\u6587\u4ef6\u9875\u548c\u533f\u540d\u9875\u7684\u56de\u6536\u90fd\u662f\u57fa\u4e8e LRU \u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\u4f18\u5148\u56de\u6536\u4e0d\u5e38\u8bbf\u95ee\u7684\u5185\u5b58\u3002LRU \u56de\u6536\u7b97\u6cd5\uff0c\u5b9e\u9645\u4e0a\u7ef4\u62a4\u7740 active \u548c inactive \u4e24\u4e2a\u53cc\u5411\u94fe\u8868\uff0c\u5176\u4e2d\uff1a</p> <ul> <li>active_list \u6d3b\u8dc3\u5185\u5b58\u9875\u94fe\u8868\uff0c\u8fd9\u91cc\u5b58\u653e\u7684\u662f\u6700\u8fd1\u88ab\u8bbf\u95ee\u8fc7\uff08\u6d3b\u8dc3\uff09\u7684\u5185\u5b58\u9875\uff1b</li> <li>inactive_list \u4e0d\u6d3b\u8dc3\u5185\u5b58\u9875\u94fe\u8868\uff0c\u8fd9\u91cc\u5b58\u653e\u7684\u662f\u5f88\u5c11\u88ab\u8bbf\u95ee\uff08\u975e\u6d3b\u8dc3\uff09\u7684\u5185\u5b58\u9875\uff1b</li> </ul> <p>\u8d8a\u63a5\u8fd1\u94fe\u8868\u5c3e\u90e8\uff0c\u5c31\u8868\u793a\u5185\u5b58\u9875\u8d8a\u4e0d\u5e38\u8bbf\u95ee\u3002\u8fd9\u6837\uff0c\u5728\u56de\u6536\u5185\u5b58\u65f6\uff0c\u7cfb\u7edf\u5c31\u53ef\u4ee5\u6839\u636e\u6d3b\u8dc3\u7a0b\u5ea6\uff0c\u4f18\u5148\u56de\u6536\u4e0d\u6d3b\u8dc3\u7684\u5185\u5b58\u3002</p> <p>\u6d3b\u8dc3\u548c\u975e\u6d3b\u8dc3\u7684\u5185\u5b58\u9875\uff0c\u6309\u7167\u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u53c8\u5206\u522b\u5206\u4e3a\u6587\u4ef6\u9875\u548c\u533f\u540d\u9875\u3002\u53ef\u4ee5\u4ece /proc/meminfo \u4e2d\uff0c\u67e5\u8be2\u5b83\u4eec\u7684\u5927\u5c0f\uff0c\u6bd4\u5982\uff1a</p> Bash<pre><code># grep\u8868\u793a\u53ea\u4fdd\u7559\u5305\u542bactive\u7684\u6307\u6807\uff08\u5ffd\u7565\u5927\u5c0f\u5199\uff09\n# sort\u8868\u793a\u6309\u7167\u5b57\u6bcd\u987a\u5e8f\u6392\u5e8f\n[root@xiaolin ~]# cat /proc/meminfo | grep -i active | sort\nActive:           901456 kB\nActive(anon):     227252 kB\nActive(file):     674204 kB\nInactive:         226232 kB\nInactive(anon):    41948 kB\nInactive(file):   184284 kB\n</code></pre>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/mem_reclaim/#_3","title":"\u56de\u6536\u5185\u5b58\u5e26\u6765\u7684\u6027\u80fd\u5f71\u54cd","text":"<p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\u56de\u6536\u5185\u5b58\u6709\u4e24\u79cd\u65b9\u5f0f\u3002</p> <ul> <li>\u4e00\u79cd\u662f\u540e\u53f0\u5185\u5b58\u56de\u6536\uff0c\u4e5f\u5c31\u662f\u5524\u9192 kswapd \u5185\u6838\u7ebf\u7a0b\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u5f02\u6b65\u56de\u6536\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u8fdb\u7a0b\u3002</li> <li>\u4e00\u79cd\u662f\u76f4\u63a5\u5185\u5b58\u56de\u6536\uff0c\u8fd9\u79cd\u65b9\u5f0f\u662f\u540c\u6b65\u56de\u6536\u7684\uff0c\u4f1a\u963b\u585e\u8fdb\u7a0b\uff0c\u8fd9\u6837\u5c31\u4f1a\u9020\u6210\u5f88\u957f\u65f6\u95f4\u7684\u5ef6\u8fdf\uff0c\u4ee5\u53ca\u7cfb\u7edf\u7684 CPU \u5229\u7528\u7387\u4f1a\u5347\u9ad8\uff0c\u6700\u7ec8\u5f15\u8d77\u7cfb\u7edf\u8d1f\u8377\u98d9\u9ad8\u3002</li> </ul> <p>\u53ef\u88ab\u56de\u6536\u7684\u5185\u5b58\u7c7b\u578b\u6709\u6587\u4ef6\u9875\u548c\u533f\u540d\u9875\uff1a</p> <ul> <li>\u6587\u4ef6\u9875\u7684\u56de\u6536\uff1a\u5bf9\u4e8e\u5e72\u51c0\u9875\u662f\u76f4\u63a5\u91ca\u653e\u5185\u5b58\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4e0d\u4f1a\u5f71\u54cd\u6027\u80fd\uff0c\u800c\u5bf9\u4e8e\u810f\u9875\u4f1a\u5148\u5199\u56de\u5230\u78c1\u76d8\u518d\u91ca\u653e\u5185\u5b58\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u53d1\u751f\u78c1\u76d8 I/O \u7684\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u4f1a\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u7684\u3002</li> <li>\u533f\u540d\u9875\u7684\u56de\u6536\uff1a\u5982\u679c\u5f00\u542f\u4e86 Swap \u673a\u5236\uff0c\u90a3\u4e48 Swap \u673a\u5236\u4f1a\u5c06\u4e0d\u5e38\u8bbf\u95ee\u7684\u533f\u540d\u9875\u6362\u51fa\u5230\u78c1\u76d8\u4e2d\uff0c\u4e0b\u6b21\u8bbf\u95ee\u65f6\uff0c\u518d\u4ece\u78c1\u76d8\u6362\u5165\u5230\u5185\u5b58\u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u4f1a\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u7684\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u56de\u6536\u5185\u5b58\u7684\u64cd\u4f5c\u57fa\u672c\u90fd\u4f1a\u53d1\u751f\u78c1\u76d8 I/O \u7684\uff0c\u5982\u679c\u56de\u6536\u5185\u5b58\u7684\u64cd\u4f5c\u5f88\u9891\u7e41\uff0c\u610f\u5473\u7740\u78c1\u76d8 I/O \u6b21\u6570\u4f1a\u5f88\u591a\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u52bf\u5fc5\u4f1a\u5f71\u54cd\u7cfb\u7edf\u7684\u6027\u80fd\uff0c\u6574\u4e2a\u7cfb\u7edf\u7ed9\u4eba\u7684\u611f\u89c9\u5c31\u662f\u5f88\u5361\u3002</p> <p>\u4e0b\u9762\u9488\u5bf9\u56de\u6536\u5185\u5b58\u5bfc\u81f4\u7684\u6027\u80fd\u5f71\u54cd\uff0c\u8bf4\u8bf4\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u5f0f\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/mem_reclaim/#_4","title":"\u8c03\u6574\u6587\u4ef6\u9875\u548c\u533f\u540d\u9875\u7684\u56de\u6536\u503e\u5411","text":"<p>\u4ece\u6587\u4ef6\u9875\u548c\u533f\u540d\u9875\u7684\u56de\u6536\u64cd\u4f5c\u6765\u770b\uff0c\u6587\u4ef6\u9875\u7684\u56de\u6536\u64cd\u4f5c\u5bf9\u7cfb\u7edf\u7684\u5f71\u54cd\u76f8\u6bd4\u533f\u540d\u9875\u7684\u56de\u6536\u64cd\u4f5c\u4f1a\u5c11\u4e00\u70b9\uff0c\u56e0\u4e3a\u6587\u4ef6\u9875\u5bf9\u4e8e\u5e72\u51c0\u9875\u56de\u6536\u662f\u4e0d\u4f1a\u53d1\u751f\u78c1\u76d8 I/O \u7684\uff0c\u800c\u533f\u540d\u9875\u7684 Swap \u6362\u5165\u6362\u51fa\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u90fd\u4f1a\u53d1\u751f\u78c1\u76d8 I/O\u3002</p> <p>Linux \u63d0\u4f9b\u4e86\u4e00\u4e2a <code>/proc/sys/vm/swappiness</code> \u9009\u9879\uff0c\u7528\u6765\u8c03\u6574\u6587\u4ef6\u9875\u548c\u533f\u540d\u9875\u7684\u56de\u6536\u503e\u5411\u3002</p> <p>swappiness \u7684\u8303\u56f4\u662f 0-100\uff0c\u6570\u503c\u8d8a\u5927\uff0c\u8d8a\u79ef\u6781\u4f7f\u7528 Swap\uff0c\u4e5f\u5c31\u662f\u66f4\u503e\u5411\u4e8e\u56de\u6536\u533f\u540d\u9875\uff1b\u6570\u503c\u8d8a\u5c0f\uff0c\u8d8a\u6d88\u6781\u4f7f\u7528 Swap\uff0c\u4e5f\u5c31\u662f\u66f4\u503e\u5411\u4e8e\u56de\u6536\u6587\u4ef6\u9875\u3002</p> Bash<pre><code>[root@xiaolin ~]# cat /proc/sys/vm/swappiness\n0\n</code></pre> <p>\u4e00\u822c\u5efa\u8bae swappiness \u8bbe\u7f6e\u4e3a 0\uff08\u9ed8\u8ba4\u503c\u662f 60\uff09\uff0c\u8fd9\u6837\u5728\u56de\u6536\u5185\u5b58\u7684\u65f6\u5019\uff0c\u4f1a\u66f4\u503e\u5411\u4e8e\u6587\u4ef6\u9875\u7684\u56de\u6536\uff0c\u4f46\u662f\u5e76\u4e0d\u4ee3\u8868\u4e0d\u4f1a\u56de\u6536\u533f\u540d\u9875\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/mem_reclaim/#kswapd","title":"\u5c3d\u65e9\u89e6\u53d1 kswapd \u5185\u6838\u7ebf\u7a0b\u5f02\u6b65\u56de\u6536\u5185\u5b58","text":"<p>\u5982\u4f55\u67e5\u770b\u7cfb\u7edf\u7684\u76f4\u63a5\u5185\u5b58\u56de\u6536\u548c\u540e\u53f0\u5185\u5b58\u56de\u6536\u7684\u6307\u6807\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>sar -B 1</code> \u547d\u4ee4\u6765\u89c2\u5bdf\uff1a</p> <p></p> <p>\u56fe\u4e2d\u7ea2\u8272\u6846\u4f4f\u7684\u5c31\u662f\u540e\u53f0\u5185\u5b58\u56de\u6536\u548c\u76f4\u63a5\u5185\u5b58\u56de\u6536\u7684\u6307\u6807\uff0c\u5b83\u4eec\u5206\u522b\u8868\u793a\uff1a</p> <ul> <li>pgscank/s : kswapd(\u540e\u53f0\u56de\u6536\u7ebf\u7a0b) \u6bcf\u79d2\u626b\u63cf\u7684 page \u4e2a\u6570\u3002</li> <li>pgscand/s: \u5e94\u7528\u7a0b\u5e8f\u5728\u5185\u5b58\u7533\u8bf7\u8fc7\u7a0b\u4e2d\u6bcf\u79d2\u76f4\u63a5\u626b\u63cf\u7684 page \u4e2a\u6570\u3002</li> <li>pgsteal/s: \u626b\u63cf\u7684 page \u4e2d\u6bcf\u79d2\u88ab\u56de\u6536\u7684\u4e2a\u6570\uff08pgscank+pgscand\uff09\u3002</li> </ul> <p>\u5982\u679c\u7cfb\u7edf\u65f6\u4e0d\u65f6\u53d1\u751f\u6296\u52a8\uff0c\u5e76\u4e14\u5728\u6296\u52a8\u7684\u65f6\u95f4\u6bb5\u91cc\u5982\u679c\u901a\u8fc7 sar -B \u89c2\u5bdf\u5230 pgscand \u6570\u503c\u5f88\u5927\uff0c\u90a3\u5927\u6982\u7387\u662f\u56e0\u4e3a\u300c\u76f4\u63a5\u5185\u5b58\u56de\u6536\u300d\u5bfc\u81f4\u7684\u3002</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u89e3\u51b3\u7684\u529e\u6cd5\u5c31\u662f\uff0c\u53ef\u4ee5\u901a\u8fc7\u5c3d\u65e9\u7684\u89e6\u53d1\u300c\u540e\u53f0\u5185\u5b58\u56de\u6536\u300d\u6765\u907f\u514d\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u76f4\u63a5\u5185\u5b58\u56de\u6536\u3002</p> <p>\u4ec0\u4e48\u6761\u4ef6\u4e0b\u624d\u80fd\u89e6\u53d1 kswapd \u5185\u6838\u7ebf\u7a0b\u56de\u6536\u5185\u5b58\u5462\uff1f</p> <p>\u5185\u6838\u5b9a\u4e49\u4e86\u4e09\u4e2a\u5185\u5b58\u9608\u503c\uff08watermark\uff0c\u4e5f\u79f0\u4e3a\u6c34\u4f4d\uff09\uff0c\u7528\u6765\u8861\u91cf\u5f53\u524d\u5269\u4f59\u5185\u5b58\uff08pages_free\uff09\u662f\u5426\u5145\u88d5\u6216\u8005\u7d27\u5f20\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u9875\u6700\u5c0f\u9608\u503c\uff08pages_min\uff09\uff1b</li> <li>\u9875\u4f4e\u9608\u503c\uff08pages_low\uff09\uff1b</li> <li>\u9875\u9ad8\u9608\u503c\uff08pages_high\uff09\uff1b</li> </ul> <p>\u8fd9\u4e09\u4e2a\u5185\u5b58\u9608\u503c\u4f1a\u5212\u5206\u4e3a\u56db\u79cd\u5185\u5b58\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>kswapd \u4f1a\u5b9a\u671f\u626b\u63cf\u5185\u5b58\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u6839\u636e\u5269\u4f59\u5185\u5b58\uff08pages_free\uff09\u7684\u60c5\u51b5\u6765\u8fdb\u884c\u5185\u5b58\u56de\u6536\u7684\u5de5\u4f5c\u3002</p> <ul> <li> <p>\u56fe\u4e2d\u7eff\u8272\u90e8\u5206\uff1a\u5982\u679c\u5269\u4f59\u5185\u5b58\uff08pages_free\uff09\u5927\u4e8e \u9875\u9ad8\u9608\u503c\uff08pages_high\uff09\uff0c\u8bf4\u660e\u5269\u4f59\u5185\u5b58\u662f\u5145\u8db3\u7684\uff1b</p> </li> <li> <p>\u56fe\u4e2d\u84dd\u8272\u90e8\u5206\uff1a\u5982\u679c\u5269\u4f59\u5185\u5b58\uff08pages_free\uff09\u5728\u9875\u9ad8\u9608\u503c\uff08pages_high\uff09\u548c\u9875\u4f4e\u9608\u503c\uff08pages_low\uff09\u4e4b\u95f4\uff0c\u8bf4\u660e\u5185\u5b58\u6709\u4e00\u5b9a\u538b\u529b\uff0c\u4f46\u8fd8\u53ef\u4ee5\u6ee1\u8db3\u5e94\u7528\u7a0b\u5e8f\u7533\u8bf7\u5185\u5b58\u7684\u8bf7\u6c42\uff1b</p> </li> <li>\u56fe\u4e2d\u6a59\u8272\u90e8\u5206\uff1a\u5982\u679c\u5269\u4f59\u5185\u5b58\uff08pages_free\uff09\u5728\u9875\u4f4e\u9608\u503c\uff08pages_low\uff09\u548c\u9875\u6700\u5c0f\u9608\u503c\uff08pages_min\uff09\u4e4b\u95f4\uff0c\u8bf4\u660e\u5185\u5b58\u538b\u529b\u6bd4\u8f83\u5927\uff0c\u5269\u4f59\u5185\u5b58\u4e0d\u591a\u4e86\u3002\u8fd9\u65f6 kswapd0 \u4f1a\u6267\u884c\u5185\u5b58\u56de\u6536\uff0c\u76f4\u5230\u5269\u4f59\u5185\u5b58\u5927\u4e8e\u9ad8\u9608\u503c\uff08pages_high\uff09\u4e3a\u6b62\u3002\u867d\u7136\u4f1a\u89e6\u53d1\u5185\u5b58\u56de\u6536\uff0c\u4f46\u662f\u4e0d\u4f1a\u963b\u585e\u5e94\u7528\u7a0b\u5e8f\uff0c\u56e0\u4e3a\u4e24\u8005\u5173\u7cfb\u662f\u5f02\u6b65\u7684\u3002</li> <li>\u56fe\u4e2d\u7ea2\u8272\u90e8\u5206\uff1a\u5982\u679c\u5269\u4f59\u5185\u5b58\uff08pages_free\uff09\u5c0f\u4e8e\u9875\u6700\u5c0f\u9608\u503c\uff08pages_min\uff09\uff0c\u8bf4\u660e\u7528\u6237\u53ef\u7528\u5185\u5b58\u90fd\u8017\u5c3d\u4e86\uff0c\u6b64\u65f6\u5c31\u4f1a\u89e6\u53d1\u76f4\u63a5\u5185\u5b58\u56de\u6536\uff0c\u8fd9\u65f6\u5e94\u7528\u7a0b\u5e8f\u5c31\u4f1a\u88ab\u963b\u585e\uff0c\u56e0\u4e3a\u4e24\u8005\u5173\u7cfb\u662f\u540c\u6b65\u7684\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u5269\u4f59\u5185\u5b58\u9875\uff08pages_free\uff09\u5c0f\u4e8e\u9875\u4f4e\u9608\u503c\uff08pages_low\uff09\uff0c\u5c31\u4f1a\u89e6\u53d1 kswapd \u8fdb\u884c\u540e\u53f0\u56de\u6536\uff0c\u7136\u540e kswapd \u4f1a\u4e00\u76f4\u56de\u6536\u5230\u5269\u4f59\u5185\u5b58\u9875\uff08pages_free\uff09\u5927\u4e8e\u9875\u9ad8\u9608\u503c\uff08pages_high\uff09\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4 kswapd \u7684\u6d3b\u52a8\u7a7a\u95f4\u53ea\u6709 pages_low \u4e0e pages_min \u4e4b\u95f4\u7684\u8fd9\u6bb5\u533a\u57df\uff0c\u5982\u679c\u5269\u4f59\u5185\u5b58\u4f4e\u4e8e\u4e86 pages_min \u4f1a\u89e6\u53d1\u76f4\u63a5\u5185\u5b58\u56de\u6536\uff0c\u9ad8\u4e8e\u4e86 pages_high \u53c8\u4e0d\u4f1a\u5524\u9192 kswapd\u3002</p> <p>\u9875\u4f4e\u9608\u503c\uff08pages_low\uff09\u53ef\u4ee5\u901a\u8fc7\u5185\u6838\u9009\u9879  <code>/proc/sys/vm/min_free_kbytes</code> \uff08\u8be5\u53c2\u6570\u4ee3\u8868\u7cfb\u7edf\u6240\u4fdd\u7559\u7a7a\u95f2\u5185\u5b58\u7684\u6700\u4f4e\u9650\uff09\u6765\u95f4\u63a5\u8bbe\u7f6e\u3002</p> <p>min_free_kbytes \u867d\u7136\u8bbe\u7f6e\u7684\u662f\u9875\u6700\u5c0f\u9608\u503c\uff08pages_min\uff09\uff0c\u4f46\u662f\u9875\u9ad8\u9608\u503c\uff08pages_high\uff09\u548c\u9875\u4f4e\u9608\u503c\uff08pages_low\uff09\u90fd\u662f\u6839\u636e\u9875\u6700\u5c0f\u9608\u503c\uff08pages_min\uff09\u8ba1\u7b97\u751f\u6210\u7684\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u8ba1\u7b97\u5173\u7cfb\u5982\u4e0b\uff1a</p> Text Only<pre><code>pages_min = min_free_kbytes\npages_low = pages_min*5/4\npages_high = pages_min*3/2\n</code></pre> <p>\u5982\u679c\u7cfb\u7edf\u65f6\u4e0d\u65f6\u53d1\u751f\u6296\u52a8\uff0c\u5e76\u4e14\u901a\u8fc7 sar -B \u89c2\u5bdf\u5230 pgscand \u6570\u503c\u5f88\u5927\uff0c\u90a3\u5927\u6982\u7387\u662f\u56e0\u4e3a\u76f4\u63a5\u5185\u5b58\u56de\u6536\u5bfc\u81f4\u7684\uff0c\u8fd9\u65f6\u53ef\u4ee5\u589e\u5927 min_free_kbytes \u8fd9\u4e2a\u914d\u7f6e\u9009\u9879\u6765\u53ca\u65e9\u5730\u89e6\u53d1\u540e\u53f0\u56de\u6536\uff0c\u7136\u540e\u7ee7\u7eed\u89c2\u5bdf pgscand \u662f\u5426\u4f1a\u964d\u4e3a 0\u3002</p> <p>\u589e\u5927\u4e86 min_free_kbytes \u914d\u7f6e\u540e\uff0c\u8fd9\u4f1a\u4f7f\u5f97\u7cfb\u7edf\u9884\u7559\u8fc7\u591a\u7684\u7a7a\u95f2\u5185\u5b58\uff0c\u4ece\u800c\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u964d\u4f4e\u4e86\u5e94\u7528\u7a0b\u5e8f\u53ef\u4f7f\u7528\u7684\u5185\u5b58\u91cf\uff0c\u8fd9\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u6d6a\u8d39\u4e86\u5185\u5b58\u3002\u6781\u7aef\u60c5\u51b5\u4e0b\u8bbe\u7f6e min_free_kbytes \u63a5\u8fd1\u5b9e\u9645\u7269\u7406\u5185\u5b58\u5927\u5c0f\u65f6\uff0c\u7559\u7ed9\u5e94\u7528\u7a0b\u5e8f\u7684\u5185\u5b58\u5c31\u4f1a\u592a\u5c11\u800c\u53ef\u80fd\u4f1a\u9891\u7e41\u5730\u5bfc\u81f4 OOM \u7684\u53d1\u751f\u3002</p> <p>\u6240\u4ee5\u5728\u8c03\u6574 min_free_kbytes \u4e4b\u524d\uff0c\u9700\u8981\u5148\u601d\u8003\u4e00\u4e0b\uff0c\u5e94\u7528\u7a0b\u5e8f\u66f4\u52a0\u5173\u6ce8\u4ec0\u4e48\uff0c\u5982\u679c\u5173\u6ce8\u5ef6\u8fdf\u90a3\u5c31\u9002\u5f53\u5730\u589e\u5927 min_free_kbytes\uff0c\u5982\u679c\u5173\u6ce8\u5185\u5b58\u7684\u4f7f\u7528\u91cf\u90a3\u5c31\u9002\u5f53\u5730\u8c03\u5c0f min_free_kbytes\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/mem_reclaim/#numa","title":"NUMA \u67b6\u6784\u4e0b\u7684\u5185\u5b58\u56de\u6536\u7b56\u7565","text":"<p>\u4ec0\u4e48\u662f NUMA \u67b6\u6784\uff1f</p> <p>\u518d\u8bf4 NUMA \u67b6\u6784\u524d\uff0c\u5148\u7ed9\u5927\u5bb6\u8bf4\u8bf4 SMP \u67b6\u6784\uff0c\u8fd9\u4e24\u4e2a\u67b6\u6784\u90fd\u662f\u9488\u5bf9 CPU \u7684\u3002</p> <p>SMP \u6307\u7684\u662f\u4e00\u79cd\u591a\u4e2a CPU \u5904\u7406\u5668\u5171\u4eab\u8d44\u6e90\u7684\u7535\u8111\u786c\u4ef6\u67b6\u6784\uff0c\u4e5f\u5c31\u662f\u8bf4\u6bcf\u4e2a CPU \u5730\u4f4d\u5e73\u7b49\uff0c\u5b83\u4eec\u5171\u4eab\u76f8\u540c\u7684\u7269\u7406\u8d44\u6e90\uff0c\u5305\u62ec\u603b\u7ebf\u3001\u5185\u5b58\u3001IO\u3001\u64cd\u4f5c\u7cfb\u7edf\u7b49\u3002\u6bcf\u4e2a CPU \u8bbf\u95ee\u5185\u5b58\u6240\u7528\u65f6\u95f4\u90fd\u662f\u76f8\u540c\u7684\uff0c\u56e0\u6b64\uff0c\u8fd9\u79cd\u7cfb\u7edf\u4e5f\u88ab\u79f0\u4e3a\u4e00\u81f4\u5b58\u50a8\u8bbf\u95ee\u7ed3\u6784\uff08UMA\uff0cUniform Memory Access\uff09\u3002</p> <p>\u968f\u7740 CPU \u5904\u7406\u5668\u6838\u6570\u7684\u589e\u591a\uff0c\u591a\u4e2a CPU \u90fd\u901a\u8fc7\u4e00\u4e2a\u603b\u7ebf\u8bbf\u95ee\u5185\u5b58\uff0c\u8fd9\u6837\u603b\u7ebf\u7684\u5e26\u5bbd\u538b\u529b\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u540c\u65f6\u6bcf\u4e2a CPU \u53ef\u7528\u5e26\u5bbd\u4f1a\u51cf\u5c11\uff0c\u8fd9\u4e5f\u5c31\u662f SMP \u67b6\u6784\u7684\u95ee\u9898\u3002</p> <p></p> <p>\u4e3a\u4e86\u89e3\u51b3 SMP \u67b6\u6784\u7684\u95ee\u9898\uff0c\u5c31\u7814\u5236\u51fa\u4e86 NUMA \u7ed3\u6784\uff0c\u5373\u975e\u4e00\u81f4\u5b58\u50a8\u8bbf\u95ee\u7ed3\u6784\uff08Non-uniform memory access\uff0cNUMA\uff09\u3002</p> <p>NUMA \u67b6\u6784\u5c06\u6bcf\u4e2a CPU  \u8fdb\u884c\u4e86\u5206\u7ec4\uff0c\u6bcf\u4e00\u7ec4 CPU \u7528 Node \u6765\u8868\u793a\uff0c\u4e00\u4e2a Node \u53ef\u80fd\u5305\u542b\u591a\u4e2a CPU\u3002</p> <p>\u6bcf\u4e2a Node \u6709\u81ea\u5df1\u72ec\u7acb\u7684\u8d44\u6e90\uff0c\u5305\u62ec\u5185\u5b58\u3001IO \u7b49\uff0c\u6bcf\u4e2a Node \u4e4b\u95f4\u53ef\u4ee5\u901a\u8fc7\u4e92\u8054\u6a21\u5757\u603b\u7ebf\uff08QPI\uff09\u8fdb\u884c\u901a\u4fe1\uff0c\u6240\u4ee5\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u6bcf\u4e2a Node \u4e0a\u7684 CPU \u90fd\u53ef\u4ee5\u8bbf\u95ee\u5230\u6574\u4e2a\u7cfb\u7edf\u4e2d\u7684\u6240\u6709\u5185\u5b58\u3002\u4f46\u662f\uff0c\u8bbf\u95ee\u8fdc\u7aef Node \u7684\u5185\u5b58\u6bd4\u8bbf\u95ee\u672c\u5730\u5185\u5b58\u8981\u8017\u65f6\u5f88\u591a\u3002</p> <p>NUMA \u67b6\u6784\u8ddf\u56de\u6536\u5185\u5b58\u6709\u4ec0\u4e48\u5173\u7cfb\uff1f</p> <p>\u5728 NUMA \u67b6\u6784\u4e0b\uff0c\u5f53\u67d0\u4e2a Node \u5185\u5b58\u4e0d\u8db3\u65f6\uff0c\u7cfb\u7edf\u53ef\u4ee5\u4ece\u5176\u4ed6 Node \u5bfb\u627e\u7a7a\u95f2\u5185\u5b58\uff0c\u4e5f\u53ef\u4ee5\u4ece\u672c\u5730\u5185\u5b58\u4e2d\u56de\u6536\u5185\u5b58\u3002</p> <p>\u5177\u4f53\u9009\u54ea\u79cd\u6a21\u5f0f\uff0c\u53ef\u4ee5\u901a\u8fc7 /proc/sys/vm/zone_reclaim_mode \u6765\u63a7\u5236\u3002\u5b83\u652f\u6301\u4ee5\u4e0b\u51e0\u4e2a\u9009\u9879\uff1a</p> <ul> <li>0\uff08\u9ed8\u8ba4\u503c\uff09\uff1a\u5728\u56de\u6536\u672c\u5730\u5185\u5b58\u4e4b\u524d\uff0c\u5728\u5176\u4ed6 Node \u5bfb\u627e\u7a7a\u95f2\u5185\u5b58\uff1b</li> <li>1\uff1a\u53ea\u56de\u6536\u672c\u5730\u5185\u5b58\uff1b</li> <li>2\uff1a\u53ea\u56de\u6536\u672c\u5730\u5185\u5b58\uff0c\u5728\u672c\u5730\u56de\u6536\u5185\u5b58\u65f6\uff0c\u53ef\u4ee5\u5c06\u6587\u4ef6\u9875\u4e2d\u7684\u810f\u9875\u5199\u56de\u786c\u76d8\uff0c\u4ee5\u56de\u6536\u5185\u5b58\u3002</li> <li>4\uff1a\u53ea\u56de\u6536\u672c\u5730\u5185\u5b58\uff0c\u5728\u672c\u5730\u56de\u6536\u5185\u5b58\u65f6\uff0c\u53ef\u4ee5\u7528 swap \u65b9\u5f0f\u56de\u6536\u5185\u5b58\u3002</li> </ul> <p>\u5728\u4f7f\u7528 NUMA \u67b6\u6784\u7684\u670d\u52a1\u5668\uff0c\u5982\u679c\u7cfb\u7edf\u51fa\u73b0\u8fd8\u6709\u4e00\u534a\u5185\u5b58\u7684\u65f6\u5019\uff0c\u5374\u53d1\u73b0\u7cfb\u7edf\u9891\u7e41\u89e6\u53d1\u300c\u76f4\u63a5\u5185\u5b58\u56de\u6536\u300d\uff0c\u5bfc\u81f4\u4e86\u5f71\u54cd\u4e86\u7cfb\u7edf\u6027\u80fd\uff0c\u90a3\u4e48\u5927\u6982\u7387\u662f\u56e0\u4e3a zone_reclaim_mode \u6ca1\u6709\u8bbe\u7f6e\u4e3a 0\uff0c\u5bfc\u81f4\u5f53\u672c\u5730\u5185\u5b58\u4e0d\u8db3\u7684\u65f6\u5019\uff0c\u53ea\u9009\u62e9\u56de\u6536\u672c\u5730\u5185\u5b58\u7684\u65b9\u5f0f\uff0c\u800c\u4e0d\u53bb\u4f7f\u7528\u5176\u4ed6 Node \u7684\u7a7a\u95f2\u5185\u5b58\u3002</p> <p>\u867d\u7136\u8bf4\u8bbf\u95ee\u8fdc\u7aef Node \u7684\u5185\u5b58\u6bd4\u8bbf\u95ee\u672c\u5730\u5185\u5b58\u8981\u8017\u65f6\u5f88\u591a\uff0c\u4f46\u662f\u76f8\u6bd4\u5185\u5b58\u56de\u6536\u7684\u5371\u5bb3\u800c\u8a00\uff0c\u8bbf\u95ee\u8fdc\u7aef Node \u7684\u5185\u5b58\u5e26\u6765\u7684\u6027\u80fd\u5f71\u54cd\u8fd8\u662f\u6bd4\u8f83\u5c0f\u7684\u3002\u56e0\u6b64\uff0czone_reclaim_mode \u4e00\u822c\u5efa\u8bae\u8bbe\u7f6e\u4e3a 0\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/mem_reclaim/#oom","title":"\u5982\u4f55\u4fdd\u62a4\u4e00\u4e2a\u8fdb\u7a0b\u4e0d\u88ab OOM \u6740\u6389\u5462\uff1f","text":"<p>\u5728\u7cfb\u7edf\u7a7a\u95f2\u5185\u5b58\u4e0d\u8db3\u7684\u60c5\u51b5\uff0c\u8fdb\u7a0b\u7533\u8bf7\u4e86\u4e00\u4e2a\u5f88\u5927\u7684\u5185\u5b58\uff0c\u5982\u679c\u76f4\u63a5\u5185\u5b58\u56de\u6536\u90fd\u65e0\u6cd5\u56de\u6536\u51fa\u8db3\u591f\u5927\u7684\u7a7a\u95f2\u5185\u5b58\uff0c\u90a3\u4e48\u5c31\u4f1a\u89e6\u53d1 OOM \u673a\u5236\uff0c\u5185\u6838\u5c31\u4f1a\u6839\u636e\u7b97\u6cd5\u9009\u62e9\u4e00\u4e2a\u8fdb\u7a0b\u6740\u6389\u3002</p> <p>Linux \u5230\u5e95\u662f\u6839\u636e\u4ec0\u4e48\u6807\u51c6\u6765\u9009\u62e9\u88ab\u6740\u7684\u8fdb\u7a0b\u5462\uff1f\u8fd9\u5c31\u8981\u63d0\u5230\u4e00\u4e2a\u5728 Linux \u5185\u6838\u91cc\u6709\u4e00\u4e2a <code>oom_badness()</code> \u51fd\u6570\uff0c\u5b83\u4f1a\u628a\u7cfb\u7edf\u4e2d\u53ef\u4ee5\u88ab\u6740\u6389\u7684\u8fdb\u7a0b\u626b\u63cf\u4e00\u904d\uff0c\u5e76\u5bf9\u6bcf\u4e2a\u8fdb\u7a0b\u6253\u5206\uff0c\u5f97\u5206\u6700\u9ad8\u7684\u8fdb\u7a0b\u5c31\u4f1a\u88ab\u9996\u5148\u6740\u6389\u3002</p> <p>\u8fdb\u7a0b\u5f97\u5206\u7684\u7ed3\u679c\u53d7\u4e0b\u9762\u8fd9\u4e24\u4e2a\u65b9\u9762\u5f71\u54cd\uff1a</p> <ul> <li>\u7b2c\u4e00\uff0c\u8fdb\u7a0b\u5df2\u7ecf\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\u9875\u9762\u6570\u3002</li> <li>\u7b2c\u4e8c\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u7684 OOM \u6821\u51c6\u503c oom_score_adj\u3002\u5b83\u662f\u53ef\u4ee5\u901a\u8fc7 <code>/proc/[pid]/oom_score_adj</code> \u6765\u914d\u7f6e\u7684\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u8bbe\u7f6e -1000 \u5230 1000 \u4e4b\u95f4\u7684\u4efb\u610f\u4e00\u4e2a\u6570\u503c\uff0c\u8c03\u6574\u8fdb\u7a0b\u88ab OOM Kill \u7684\u51e0\u7387\u3002</li> </ul> <p>\u51fd\u6570 oom_badness() \u91cc\u7684\u6700\u7ec8\u8ba1\u7b97\u65b9\u6cd5\u662f\u8fd9\u6837\u7684\uff1a</p> C<pre><code>// points \u4ee3\u8868\u6253\u5206\u7684\u7ed3\u679c\n// process_pages \u4ee3\u8868\u8fdb\u7a0b\u5df2\u7ecf\u4f7f\u7528\u7684\u7269\u7406\u5185\u5b58\u9875\u9762\u6570\n// oom_score_adj \u4ee3\u8868 OOM \u6821\u51c6\u503c\n// totalpages \u4ee3\u8868\u7cfb\u7edf\u603b\u7684\u53ef\u7528\u9875\u9762\u6570\npoints = process_pages + oom_score_adj*totalpages/1000\n</code></pre> <p>\u7528\u300c\u7cfb\u7edf\u603b\u7684\u53ef\u7528\u9875\u9762\u6570\u300d\u4e58\u4ee5\u300cOOM \u6821\u51c6\u503c oom_score_adj\u300d\u518d\u9664\u4ee5 1000\uff0c\u6700\u540e\u518d\u52a0\u4e0a\u8fdb\u7a0b\u5df2\u7ecf\u4f7f\u7528\u7684\u7269\u7406\u9875\u9762\u6570\uff0c\u8ba1\u7b97\u51fa\u6765\u7684\u503c\u8d8a\u5927\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8fdb\u7a0b\u88ab OOM Kill \u7684\u51e0\u7387\u4e5f\u5c31\u8d8a\u5927\u3002</p> <p>\u6bcf\u4e2a\u8fdb\u7a0b\u7684 oom_score_adj \u9ed8\u8ba4\u503c\u90fd\u4e3a 0\uff0c\u6240\u4ee5\u6700\u7ec8\u5f97\u5206\u8ddf\u8fdb\u7a0b\u81ea\u8eab\u6d88\u8017\u7684\u5185\u5b58\u6709\u5173\uff0c\u6d88\u8017\u7684\u5185\u5b58\u8d8a\u5927\u8d8a\u5bb9\u6613\u88ab\u6740\u6389\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574 oom_score_adj \u7684\u6570\u503c\uff0c\u6765\u6539\u6210\u8fdb\u7a0b\u7684\u5f97\u5206\u7ed3\u679c\uff1a</p> <ul> <li>\u5982\u679c\u4f60\u4e0d\u60f3\u67d0\u4e2a\u8fdb\u7a0b\u88ab\u9996\u5148\u6740\u6389\uff0c\u90a3\u4f60\u53ef\u4ee5\u8c03\u6574\u8be5\u8fdb\u7a0b\u7684 oom_score_adj\uff0c\u4ece\u800c\u6539\u53d8\u8fd9\u4e2a\u8fdb\u7a0b\u7684\u5f97\u5206\u7ed3\u679c\uff0c\u964d\u4f4e\u8be5\u8fdb\u7a0b\u88ab OOM \u6740\u6b7b\u7684\u6982\u7387\u3002</li> <li>\u5982\u679c\u4f60\u60f3\u67d0\u4e2a\u8fdb\u7a0b\u65e0\u8bba\u5982\u4f55\u90fd\u4e0d\u80fd\u88ab\u6740\u6389\uff0c\u90a3\u4f60\u53ef\u4ee5\u5c06 oom_score_adj \u914d\u7f6e\u4e3a -1000\u3002</li> </ul> <p>\u6211\u4eec\u6700\u597d\u5c06\u4e00\u4e9b\u5f88\u91cd\u8981\u7684\u7cfb\u7edf\u670d\u52a1\u7684 oom_score_adj \u914d\u7f6e\u4e3a -1000\uff0c\u6bd4\u5982 sshd\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u7cfb\u7edf\u670d\u52a1\u4e00\u65e6\u88ab\u6740\u6389\uff0c\u6211\u4eec\u5c31\u5f88\u96be\u518d\u767b\u9646\u8fdb\u7cfb\u7edf\u4e86\u3002</p> <p>\u4f46\u662f\uff0c\u4e0d\u5efa\u8bae\u5c06\u6211\u4eec\u81ea\u5df1\u7684\u4e1a\u52a1\u7a0b\u5e8f\u7684 oom_score_adj \u8bbe\u7f6e\u4e3a -1000\uff0c\u56e0\u4e3a\u4e1a\u52a1\u7a0b\u5e8f\u4e00\u65e6\u53d1\u751f\u4e86\u5185\u5b58\u6cc4\u6f0f\uff0c\u800c\u5b83\u53c8\u4e0d\u80fd\u88ab\u6740\u6389\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u968f\u7740\u5b83\u7684\u5185\u5b58\u5f00\u9500\u53d8\u5927\uff0cOOM killer \u4e0d\u505c\u5730\u88ab\u5524\u9192\uff0c\u4ece\u800c\u628a\u5176\u4ed6\u8fdb\u7a0b\u4e00\u4e2a\u4e2a\u7ed9\u6740\u6389\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>https://time.geekbang.org/column/article/277358</li> <li>https://time.geekbang.org/column/article/75797</li> <li>https://www.jianshu.com/p/e40e8813842f</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/mem_reclaim/#_5","title":"\u603b\u7ed3","text":"<p>\u5185\u6838\u5728\u7ed9\u5e94\u7528\u7a0b\u5e8f\u5206\u914d\u7269\u7406\u5185\u5b58\u7684\u65f6\u5019\uff0c\u5982\u679c\u7a7a\u95f2\u7269\u7406\u5185\u5b58\u4e0d\u591f\uff0c\u90a3\u4e48\u5c31\u4f1a\u8fdb\u884c\u5185\u5b58\u56de\u6536\u7684\u5de5\u4f5c\uff0c\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>\u540e\u53f0\u5185\u5b58\u56de\u6536\uff1a\u5728\u7269\u7406\u5185\u5b58\u7d27\u5f20\u7684\u65f6\u5019\uff0c\u4f1a\u5524\u9192 kswapd \u5185\u6838\u7ebf\u7a0b\u6765\u56de\u6536\u5185\u5b58\uff0c\u8fd9\u4e2a\u56de\u6536\u5185\u5b58\u7684\u8fc7\u7a0b\u5f02\u6b65\u7684\uff0c\u4e0d\u4f1a\u963b\u585e\u8fdb\u7a0b\u7684\u6267\u884c\u3002</li> <li>\u76f4\u63a5\u5185\u5b58\u56de\u6536\uff1a\u5982\u679c\u540e\u53f0\u5f02\u6b65\u56de\u6536\u8ddf\u4e0d\u4e0a\u8fdb\u7a0b\u5185\u5b58\u7533\u8bf7\u7684\u901f\u5ea6\uff0c\u5c31\u4f1a\u5f00\u59cb\u76f4\u63a5\u56de\u6536\uff0c\u8fd9\u4e2a\u56de\u6536\u5185\u5b58\u7684\u8fc7\u7a0b\u662f\u540c\u6b65\u7684\uff0c\u4f1a\u963b\u585e\u8fdb\u7a0b\u7684\u6267\u884c\u3002</li> </ul> <p>\u53ef\u88ab\u56de\u6536\u7684\u5185\u5b58\u7c7b\u578b\u6709\u6587\u4ef6\u9875\u548c\u533f\u540d\u9875\uff1a</p> <ul> <li>\u6587\u4ef6\u9875\u7684\u56de\u6536\uff1a\u5bf9\u4e8e\u5e72\u51c0\u9875\u662f\u76f4\u63a5\u91ca\u653e\u5185\u5b58\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4e0d\u4f1a\u5f71\u54cd\u6027\u80fd\uff0c\u800c\u5bf9\u4e8e\u810f\u9875\u4f1a\u5148\u5199\u56de\u5230\u78c1\u76d8\u518d\u91ca\u653e\u5185\u5b58\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u53d1\u751f\u78c1\u76d8 I/O \u7684\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u4f1a\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u7684\u3002</li> <li>\u533f\u540d\u9875\u7684\u56de\u6536\uff1a\u5982\u679c\u5f00\u542f\u4e86 Swap \u673a\u5236\uff0c\u90a3\u4e48 Swap \u673a\u5236\u4f1a\u5c06\u4e0d\u5e38\u8bbf\u95ee\u7684\u533f\u540d\u9875\u6362\u51fa\u5230\u78c1\u76d8\u4e2d\uff0c\u4e0b\u6b21\u8bbf\u95ee\u65f6\uff0c\u518d\u4ece\u78c1\u76d8\u6362\u5165\u5230\u5185\u5b58\u4e2d\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u662f\u4f1a\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u7684\u3002</li> </ul> <p>\u6587\u4ef6\u9875\u548c\u533f\u540d\u9875\u7684\u56de\u6536\u90fd\u662f\u57fa\u4e8e LRU \u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\u4f18\u5148\u56de\u6536\u4e0d\u5e38\u8bbf\u95ee\u7684\u5185\u5b58\u3002\u56de\u6536\u5185\u5b58\u7684\u64cd\u4f5c\u57fa\u672c\u90fd\u4f1a\u53d1\u751f\u78c1\u76d8 I/O \u7684\uff0c\u5982\u679c\u56de\u6536\u5185\u5b58\u7684\u64cd\u4f5c\u5f88\u9891\u7e41\uff0c\u610f\u5473\u7740\u78c1\u76d8 I/O \u6b21\u6570\u4f1a\u5f88\u591a\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u52bf\u5fc5\u4f1a\u5f71\u54cd\u7cfb\u7edf\u7684\u6027\u80fd\u3002</p> <p>\u9488\u5bf9\u56de\u6536\u5185\u5b58\u5bfc\u81f4\u7684\u6027\u80fd\u5f71\u54cd\uff0c\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u5f0f\u3002</p> <ul> <li>\u8bbe\u7f6e /proc/sys/vm/swappiness\uff0c\u8c03\u6574\u6587\u4ef6\u9875\u548c\u533f\u540d\u9875\u7684\u56de\u6536\u503e\u5411\uff0c\u5c3d\u91cf\u503e\u5411\u4e8e\u56de\u6536\u6587\u4ef6\u9875\uff1b</li> <li>\u8bbe\u7f6e /proc/sys/vm/min_free_kbytes\uff0c\u8c03\u6574 kswapd \u5185\u6838\u7ebf\u7a0b\u5f02\u6b65\u56de\u6536\u5185\u5b58\u7684\u65f6\u673a\uff1b</li> <li>\u8bbe\u7f6e  /proc/sys/vm/zone_reclaim_mode\uff0c\u8c03\u6574 NUMA \u67b6\u6784\u4e0b\u5185\u5b58\u56de\u6536\u7b56\u7565\uff0c\u5efa\u8bae\u8bbe\u7f6e\u4e3a 0\uff0c\u8fd9\u6837\u5728\u56de\u6536\u672c\u5730\u5185\u5b58\u4e4b\u524d\uff0c\u4f1a\u5728\u5176\u4ed6 Node \u5bfb\u627e\u7a7a\u95f2\u5185\u5b58\uff0c\u4ece\u800c\u907f\u514d\u5728\u7cfb\u7edf\u8fd8\u6709\u5f88\u591a\u7a7a\u95f2\u5185\u5b58\u7684\u60c5\u51b5\u4e0b\uff0c\u56e0\u672c\u5730 Node \u7684\u672c\u5730\u5185\u5b58\u4e0d\u8db3\uff0c\u53d1\u751f\u9891\u7e41\u76f4\u63a5\u5185\u5b58\u56de\u6536\u5bfc\u81f4\u6027\u80fd\u4e0b\u964d\u7684\u95ee\u9898\uff1b</li> </ul> <p>\u5728\u7ecf\u5386\u5b8c\u76f4\u63a5\u5185\u5b58\u56de\u6536\u540e\uff0c\u7a7a\u95f2\u7684\u7269\u7406\u5185\u5b58\u5927\u5c0f\u4f9d\u7136\u4e0d\u591f\uff0c\u90a3\u4e48\u5c31\u4f1a\u89e6\u53d1 OOM \u673a\u5236\uff0cOOM killer \u5c31\u4f1a\u6839\u636e\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u5185\u5b58\u5360\u7528\u60c5\u51b5\u548c oom_score_adj \u7684\u503c\u8fdb\u884c\u6253\u5206\uff0c\u5f97\u5206\u6700\u9ad8\u7684\u8fdb\u7a0b\u5c31\u4f1a\u88ab\u9996\u5148\u6740\u6389\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8c03\u6574\u8fdb\u7a0b\u7684 /proc/[pid]/oom_score_adj \u503c\uff0c\u6765\u964d\u4f4e\u88ab OOM killer \u6740\u6389\u7684\u6982\u7387\u3002</p> <p>\u5b8c\uff01</p> <p>\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u4e86\u54e6\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/vmem/","title":"4.1 \u4e3a\u4ec0\u4e48\u8981\u6709\u865a\u62df\u5185\u5b58\uff1f","text":"<p>\u672c\u7bc7\u8ddf\u5927\u5bb6\u8bf4\u8bf4\u5185\u5b58\u7ba1\u7406\uff0c\u5185\u5b58\u7ba1\u7406\u8fd8\u662f\u6bd4\u8f83\u91cd\u8981\u7684\u4e00\u4e2a\u73af\u8282\uff0c\u7406\u89e3\u4e86\u5b83\uff0c\u81f3\u5c11\u5bf9\u6574\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u7684\u5de5\u4f5c\u4f1a\u6709\u4e00\u4e2a\u521d\u6b65\u7684\u8f6e\u5ed3\uff0c\u8fd9\u4e5f\u96be\u602a\u9762\u8bd5\u7684\u65f6\u5019\u5e38\u95ee\u5185\u5b58\u7ba1\u7406\u3002</p> <p>\u5e72\u5c31\u5b8c\u4e8b\uff0c\u672c\u6587\u7684\u63d0\u7eb2\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/vmem/#_1","title":"\u865a\u62df\u5185\u5b58","text":"<p>\u5982\u679c\u4f60\u662f\u7535\u5b50\u76f8\u5173\u4e13\u4e1a\u7684\uff0c\u80af\u5b9a\u5728\u5927\u5b66\u91cc\u6363\u9f13\u8fc7\u5355\u7247\u673a\u3002</p> <p>\u5355\u7247\u673a\u662f\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u7684\uff0c\u6240\u4ee5\u6bcf\u6b21\u5199\u5b8c\u4ee3\u7801\uff0c\u90fd\u9700\u8981\u501f\u52a9\u5de5\u5177\u628a\u7a0b\u5e8f\u70e7\u5f55\u8fdb\u53bb\uff0c\u8fd9\u6837\u7a0b\u5e8f\u624d\u80fd\u8dd1\u8d77\u6765\u3002</p> <p>\u53e6\u5916\uff0c\u5355\u7247\u673a\u7684 CPU \u662f\u76f4\u63a5\u64cd\u4f5c\u5185\u5b58\u7684\u300c\u7269\u7406\u5730\u5740\u300d\u3002</p> <p></p> <p>\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u8981\u60f3\u5728\u5185\u5b58\u4e2d\u540c\u65f6\u8fd0\u884c\u4e24\u4e2a\u7a0b\u5e8f\u662f\u4e0d\u53ef\u80fd\u7684\u3002\u5982\u679c\u7b2c\u4e00\u4e2a\u7a0b\u5e8f\u5728 2000 \u7684\u4f4d\u7f6e\u5199\u5165\u4e00\u4e2a\u65b0\u7684\u503c\uff0c\u5c06\u4f1a\u64e6\u6389\u7b2c\u4e8c\u4e2a\u7a0b\u5e8f\u5b58\u653e\u5728\u76f8\u540c\u4f4d\u7f6e\u4e0a\u7684\u6240\u6709\u5185\u5bb9\uff0c\u6240\u4ee5\u540c\u65f6\u8fd0\u884c\u4e24\u4e2a\u7a0b\u5e8f\u662f\u6839\u672c\u884c\u4e0d\u901a\u7684\uff0c\u8fd9\u4e24\u4e2a\u7a0b\u5e8f\u4f1a\u7acb\u523b\u5d29\u6e83\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u662f\u5982\u4f55\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f</p> <p>\u8fd9\u91cc\u5173\u952e\u7684\u95ee\u9898\u662f\u8fd9\u4e24\u4e2a\u7a0b\u5e8f\u90fd\u5f15\u7528\u4e86\u7edd\u5bf9\u7269\u7406\u5730\u5740\uff0c\u800c\u8fd9\u6b63\u662f\u6211\u4eec\u6700\u9700\u8981\u907f\u514d\u7684\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u628a\u8fdb\u7a0b\u6240\u4f7f\u7528\u7684\u5730\u5740\u300c\u9694\u79bb\u300d\u5f00\u6765\uff0c\u5373\u8ba9\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u5206\u914d\u72ec\u7acb\u7684\u4e00\u5957\u300c\u865a\u62df\u5730\u5740\u300d\uff0c\u4eba\u4eba\u90fd\u6709\uff0c\u5927\u5bb6\u81ea\u5df1\u73a9\u81ea\u5df1\u7684\u5730\u5740\u5c31\u884c\uff0c\u4e92\u4e0d\u5e72\u6d89\u3002\u4f46\u662f\u6709\u4e2a\u524d\u63d0\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u4e0d\u80fd\u8bbf\u95ee\u7269\u7406\u5730\u5740\uff0c\u81f3\u4e8e\u865a\u62df\u5730\u5740\u6700\u7ec8\u600e\u4e48\u843d\u5230\u7269\u7406\u5185\u5b58\u91cc\uff0c\u5bf9\u8fdb\u7a0b\u6765\u8bf4\u662f\u900f\u660e\u7684\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5df2\u7ecf\u628a\u8fd9\u4e9b\u90fd\u5b89\u6392\u7684\u660e\u660e\u767d\u767d\u4e86\u3002</p> <p></p> <p>\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u63d0\u4f9b\u4e00\u79cd\u673a\u5236\uff0c\u5c06\u4e0d\u540c\u8fdb\u7a0b\u7684\u865a\u62df\u5730\u5740\u548c\u4e0d\u540c\u5185\u5b58\u7684\u7269\u7406\u5730\u5740\u6620\u5c04\u8d77\u6765\u3002</p> <p>\u5982\u679c\u7a0b\u5e8f\u8981\u8bbf\u95ee\u865a\u62df\u5730\u5740\u7684\u65f6\u5019\uff0c\u7531\u64cd\u4f5c\u7cfb\u7edf\u8f6c\u6362\u6210\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740\uff0c\u8fd9\u6837\u4e0d\u540c\u7684\u8fdb\u7a0b\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u5199\u5165\u7684\u662f\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u51b2\u7a81\u4e86\u3002</p> <p>\u4e8e\u662f\uff0c\u8fd9\u91cc\u5c31\u5f15\u51fa\u4e86\u4e24\u79cd\u5730\u5740\u7684\u6982\u5ff5\uff1a</p> <ul> <li>\u6211\u4eec\u7a0b\u5e8f\u6240\u4f7f\u7528\u7684\u5185\u5b58\u5730\u5740\u53eb\u505a\u865a\u62df\u5185\u5b58\u5730\u5740\uff08Virtual Memory Address\uff09</li> <li>\u5b9e\u9645\u5b58\u5728\u786c\u4ef6\u91cc\u9762\u7684\u7a7a\u95f4\u5730\u5740\u53eb\u7269\u7406\u5185\u5b58\u5730\u5740\uff08Physical Memory Address\uff09\u3002</li> </ul> <p>\u64cd\u4f5c\u7cfb\u7edf\u5f15\u5165\u4e86\u865a\u62df\u5185\u5b58\uff0c\u8fdb\u7a0b\u6301\u6709\u7684\u865a\u62df\u5730\u5740\u4f1a\u901a\u8fc7 CPU \u82af\u7247\u4e2d\u7684\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08MMU\uff09\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u6765\u8f6c\u6362\u53d8\u6210\u7269\u7406\u5730\u5740\uff0c\u7136\u540e\u518d\u901a\u8fc7\u7269\u7406\u5730\u5740\u8bbf\u95ee\u5185\u5b58\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u64cd\u4f5c\u7cfb\u7edf\u662f\u5982\u4f55\u7ba1\u7406\u865a\u62df\u5730\u5740\u4e0e\u7269\u7406\u5730\u5740\u4e4b\u95f4\u7684\u5173\u7cfb\uff1f</p> <p>\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u5f0f\uff0c\u5206\u522b\u662f\u5185\u5b58\u5206\u6bb5\u548c\u5185\u5b58\u5206\u9875\uff0c\u5206\u6bb5\u662f\u6bd4\u8f83\u65e9\u63d0\u51fa\u7684\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u5185\u5b58\u5206\u6bb5\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/vmem/#_2","title":"\u5185\u5b58\u5206\u6bb5","text":"<p>\u7a0b\u5e8f\u662f\u7531\u82e5\u5e72\u4e2a\u903b\u8f91\u5206\u6bb5\u7ec4\u6210\u7684\uff0c\u5982\u53ef\u7531\u4ee3\u7801\u5206\u6bb5\u3001\u6570\u636e\u5206\u6bb5\u3001\u6808\u6bb5\u3001\u5806\u6bb5\u7ec4\u6210\u3002\u4e0d\u540c\u7684\u6bb5\u662f\u6709\u4e0d\u540c\u7684\u5c5e\u6027\u7684\uff0c\u6240\u4ee5\u5c31\u7528\u5206\u6bb5\uff08Segmentation\uff09\u7684\u5f62\u5f0f\u628a\u8fd9\u4e9b\u6bb5\u5206\u79bb\u51fa\u6765\u3002</p> <p>\u5206\u6bb5\u673a\u5236\u4e0b\uff0c\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u662f\u5982\u4f55\u6620\u5c04\u7684\uff1f</p> <p>\u5206\u6bb5\u673a\u5236\u4e0b\u7684\u865a\u62df\u5730\u5740\u7531\u4e24\u90e8\u5206\u7ec4\u6210\uff0c\u6bb5\u9009\u62e9\u56e0\u5b50\u548c\u6bb5\u5185\u504f\u79fb\u91cf\u3002</p> <p></p> <p>\u6bb5\u9009\u62e9\u56e0\u5b50\u548c\u6bb5\u5185\u504f\u79fb\u91cf\uff1a</p> <ul> <li> <p>\u6bb5\u9009\u62e9\u56e0\u5b50\u5c31\u4fdd\u5b58\u5728\u6bb5\u5bc4\u5b58\u5668\u91cc\u9762\u3002\u6bb5\u9009\u62e9\u56e0\u5b50\u91cc\u9762\u6700\u91cd\u8981\u7684\u662f\u6bb5\u53f7\uff0c\u7528\u4f5c\u6bb5\u8868\u7684\u7d22\u5f15\u3002\u6bb5\u8868\u91cc\u9762\u4fdd\u5b58\u7684\u662f\u8fd9\u4e2a\u6bb5\u7684\u57fa\u5730\u5740\u3001\u6bb5\u7684\u754c\u9650\u548c\u7279\u6743\u7b49\u7ea7\u7b49\u3002</p> </li> <li> <p>\u865a\u62df\u5730\u5740\u4e2d\u7684\u6bb5\u5185\u504f\u79fb\u91cf\u5e94\u8be5\u4f4d\u4e8e 0 \u548c\u6bb5\u754c\u9650\u4e4b\u95f4\uff0c\u5982\u679c\u6bb5\u5185\u504f\u79fb\u91cf\u662f\u5408\u6cd5\u7684\uff0c\u5c31\u5c06\u6bb5\u57fa\u5730\u5740\u52a0\u4e0a\u6bb5\u5185\u504f\u79fb\u91cf\u5f97\u5230\u7269\u7406\u5185\u5b58\u5730\u5740\u3002</p> </li> </ul> <p>\u5728\u4e0a\u9762\uff0c\u77e5\u9053\u4e86\u865a\u62df\u5730\u5740\u662f\u901a\u8fc7\u6bb5\u8868\u4e0e\u7269\u7406\u5730\u5740\u8fdb\u884c\u6620\u5c04\u7684\uff0c\u5206\u6bb5\u673a\u5236\u4f1a\u628a\u7a0b\u5e8f\u7684\u865a\u62df\u5730\u5740\u5206\u6210 4 \u4e2a\u6bb5\uff0c\u6bcf\u4e2a\u6bb5\u5728\u6bb5\u8868\u4e2d\u6709\u4e00\u4e2a\u9879\uff0c\u5728\u8fd9\u4e00\u9879\u627e\u5230\u6bb5\u7684\u57fa\u5730\u5740\uff0c\u518d\u52a0\u4e0a\u504f\u79fb\u91cf\uff0c\u4e8e\u662f\u5c31\u80fd\u627e\u5230\u7269\u7406\u5185\u5b58\u4e2d\u7684\u5730\u5740\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5982\u679c\u8981\u8bbf\u95ee\u6bb5 3 \u4e2d\u504f\u79fb\u91cf 500 \u7684\u865a\u62df\u5730\u5740\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba1\u7b97\u51fa\u7269\u7406\u5730\u5740\u4e3a\uff0c\u6bb5 3 \u57fa\u5730\u5740 7000 + \u504f\u79fb\u91cf 500 = 7500\u3002</p> <p>\u5206\u6bb5\u7684\u529e\u6cd5\u5f88\u597d\uff0c\u89e3\u51b3\u4e86\u7a0b\u5e8f\u672c\u8eab\u4e0d\u9700\u8981\u5173\u5fc3\u5177\u4f53\u7684\u7269\u7406\u5185\u5b58\u5730\u5740\u7684\u95ee\u9898\uff0c\u4f46\u5b83\u4e5f\u6709\u4e00\u4e9b\u4e0d\u8db3\u4e4b\u5904\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a\u5c31\u662f\u5185\u5b58\u788e\u7247\u7684\u95ee\u9898\u3002</li> <li>\u7b2c\u4e8c\u4e2a\u5c31\u662f\u5185\u5b58\u4ea4\u6362\u7684\u6548\u7387\u4f4e\u7684\u95ee\u9898\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u4f1a\u6709\u8fd9\u4e24\u4e2a\u95ee\u9898\u3002</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b\uff0c\u5206\u6bb5\u4e3a\u4ec0\u4e48\u4f1a\u4ea7\u751f\u5185\u5b58\u788e\u7247\u7684\u95ee\u9898\uff1f</p> <p>\u6211\u4eec\u6765\u770b\u770b\u8fd9\u6837\u4e00\u4e2a\u4f8b\u5b50\u3002\u5047\u8bbe\u6709 1G \u7684\u7269\u7406\u5185\u5b58\uff0c\u7528\u6237\u6267\u884c\u4e86\u591a\u4e2a\u7a0b\u5e8f\uff0c\u5176\u4e2d\uff1a</p> <ul> <li>\u6e38\u620f\u5360\u7528\u4e86 512MB \u5185\u5b58</li> <li>\u6d4f\u89c8\u5668\u5360\u7528\u4e86 128MB \u5185\u5b58</li> <li>\u97f3\u4e50\u5360\u7528\u4e86 256 MB \u5185\u5b58\u3002</li> </ul> <p>\u8fd9\u4e2a\u65f6\u5019\uff0c\u5982\u679c\u6211\u4eec\u5173\u95ed\u4e86\u6d4f\u89c8\u5668\uff0c\u5219\u7a7a\u95f2\u5185\u5b58\u8fd8\u6709 1024 - 512 - 256 = 256MB\u3002</p> <p>\u5982\u679c\u8fd9\u4e2a 256MB \u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u88ab\u5206\u6210\u4e86\u4e24\u6bb5 128 MB \u5185\u5b58\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u6ca1\u6709\u7a7a\u95f4\u518d\u6253\u5f00\u4e00\u4e2a 200MB \u7684\u7a0b\u5e8f\u3002</p> <p></p> <p>\u5185\u5b58\u5206\u6bb5\u4f1a\u51fa\u73b0\u5185\u5b58\u788e\u7247\u5417\uff1f</p> <p>\u5185\u5b58\u788e\u7247\u4e3b\u8981\u5206\u4e3a\uff0c\u5185\u90e8\u5185\u5b58\u788e\u7247\u548c\u5916\u90e8\u5185\u5b58\u788e\u7247\u3002</p> <p>\u5185\u5b58\u5206\u6bb5\u7ba1\u7406\u53ef\u4ee5\u505a\u5230\u6bb5\u6839\u636e\u5b9e\u9645\u9700\u6c42\u5206\u914d\u5185\u5b58\uff0c\u6240\u4ee5\u6709\u591a\u5c11\u9700\u6c42\u5c31\u5206\u914d\u591a\u5927\u7684\u6bb5\uff0c\u6240\u4ee5\u4e0d\u4f1a\u51fa\u73b0\u5185\u90e8\u5185\u5b58\u788e\u7247\u3002</p> <p>\u4f46\u662f\u7531\u4e8e\u6bcf\u4e2a\u6bb5\u7684\u957f\u5ea6\u4e0d\u56fa\u5b9a\uff0c\u6240\u4ee5\u591a\u4e2a\u6bb5\u672a\u5fc5\u80fd\u6070\u597d\u4f7f\u7528\u6240\u6709\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u4f1a\u4ea7\u751f\u4e86\u591a\u4e2a\u4e0d\u8fde\u7eed\u7684\u5c0f\u7269\u7406\u5185\u5b58\uff0c\u5bfc\u81f4\u65b0\u7684\u7a0b\u5e8f\u65e0\u6cd5\u88ab\u88c5\u8f7d\uff0c\u6240\u4ee5\u4f1a\u51fa\u73b0\u5916\u90e8\u5185\u5b58\u788e\u7247\u7684\u95ee\u9898\u3002</p> <p>\u89e3\u51b3\u300c\u5916\u90e8\u5185\u5b58\u788e\u7247\u300d\u7684\u95ee\u9898\u5c31\u662f\u5185\u5b58\u4ea4\u6362\u3002</p> <p>\u53ef\u4ee5\u628a\u97f3\u4e50\u7a0b\u5e8f\u5360\u7528\u7684\u90a3 256MB \u5185\u5b58\u5199\u5230\u786c\u76d8\u4e0a\uff0c\u7136\u540e\u518d\u4ece\u786c\u76d8\u4e0a\u8bfb\u56de\u6765\u5230\u5185\u5b58\u91cc\u3002\u4e0d\u8fc7\u518d\u8bfb\u56de\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e0d\u80fd\u88c5\u8f7d\u56de\u539f\u6765\u7684\u4f4d\u7f6e\uff0c\u800c\u662f\u7d27\u7d27\u8ddf\u7740\u90a3\u5df2\u7ecf\u88ab\u5360\u7528\u4e86\u7684 512MB \u5185\u5b58\u540e\u9762\u3002\u8fd9\u6837\u5c31\u80fd\u7a7a\u7f3a\u51fa\u8fde\u7eed\u7684 256MB \u7a7a\u95f4\uff0c\u4e8e\u662f\u65b0\u7684 200MB \u7a0b\u5e8f\u5c31\u53ef\u4ee5\u88c5\u8f7d\u8fdb\u6765\u3002</p> <p>\u8fd9\u4e2a\u5185\u5b58\u4ea4\u6362\u7a7a\u95f4\uff0c\u5728 Linux \u7cfb\u7edf\u91cc\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u770b\u5230\u7684 Swap \u7a7a\u95f4\uff0c\u8fd9\u5757\u7a7a\u95f4\u662f\u4ece\u786c\u76d8\u5212\u5206\u51fa\u6765\u7684\uff0c\u7528\u4e8e\u5185\u5b58\u4e0e\u786c\u76d8\u7684\u7a7a\u95f4\u4ea4\u6362\u3002</p> <p>\u518d\u6765\u770b\u770b\uff0c\u5206\u6bb5\u4e3a\u4ec0\u4e48\u4f1a\u5bfc\u81f4\u5185\u5b58\u4ea4\u6362\u6548\u7387\u4f4e\u7684\u95ee\u9898\uff1f</p> <p>\u5bf9\u4e8e\u591a\u8fdb\u7a0b\u7684\u7cfb\u7edf\u6765\u8bf4\uff0c\u7528\u5206\u6bb5\u7684\u65b9\u5f0f\uff0c\u5916\u90e8\u5185\u5b58\u788e\u7247\u662f\u5f88\u5bb9\u6613\u4ea7\u751f\u7684\uff0c\u4ea7\u751f\u4e86\u5916\u90e8\u5185\u5b58\u788e\u7247\uff0c\u90a3\u4e0d\u5f97\u4e0d\u91cd\u65b0 <code>Swap</code> \u5185\u5b58\u533a\u57df\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f1a\u4ea7\u751f\u6027\u80fd\u74f6\u9888\u3002</p> <p>\u56e0\u4e3a\u786c\u76d8\u7684\u8bbf\u95ee\u901f\u5ea6\u8981\u6bd4\u5185\u5b58\u6162\u592a\u591a\u4e86\uff0c\u6bcf\u4e00\u6b21\u5185\u5b58\u4ea4\u6362\uff0c\u6211\u4eec\u90fd\u9700\u8981\u628a\u4e00\u5927\u6bb5\u8fde\u7eed\u7684\u5185\u5b58\u6570\u636e\u5199\u5230\u786c\u76d8\u4e0a\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u5185\u5b58\u4ea4\u6362\u7684\u65f6\u5019\uff0c\u4ea4\u6362\u7684\u662f\u4e00\u4e2a\u5360\u5185\u5b58\u7a7a\u95f4\u5f88\u5927\u7684\u7a0b\u5e8f\uff0c\u8fd9\u6837\u6574\u4e2a\u673a\u5668\u90fd\u4f1a\u663e\u5f97\u5361\u987f\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u5185\u5b58\u5206\u6bb5\u7684\u300c\u5916\u90e8\u5185\u5b58\u788e\u7247\u548c\u5185\u5b58\u4ea4\u6362\u6548\u7387\u4f4e\u300d\u7684\u95ee\u9898\uff0c\u5c31\u51fa\u73b0\u4e86\u5185\u5b58\u5206\u9875\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/vmem/#_3","title":"\u5185\u5b58\u5206\u9875","text":"<p>\u5206\u6bb5\u7684\u597d\u5904\u5c31\u662f\u80fd\u4ea7\u751f\u8fde\u7eed\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u4f46\u662f\u4f1a\u51fa\u73b0\u300c\u5916\u90e8\u5185\u5b58\u788e\u7247\u548c\u5185\u5b58\u4ea4\u6362\u7684\u7a7a\u95f4\u592a\u5927\u300d\u7684\u95ee\u9898\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0c\u90a3\u4e48\u5c31\u8981\u60f3\u51fa\u80fd\u5c11\u51fa\u73b0\u4e00\u4e9b\u5185\u5b58\u788e\u7247\u7684\u529e\u6cd5\u3002\u53e6\u5916\uff0c\u5f53\u9700\u8981\u8fdb\u884c\u5185\u5b58\u4ea4\u6362\u7684\u65f6\u5019\uff0c\u8ba9\u9700\u8981\u4ea4\u6362\u5199\u5165\u6216\u8005\u4ece\u78c1\u76d8\u88c5\u8f7d\u7684\u6570\u636e\u66f4\u5c11\u4e00\u70b9\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u89e3\u51b3\u95ee\u9898\u4e86\u3002\u8fd9\u4e2a\u529e\u6cd5\uff0c\u4e5f\u5c31\u662f\u5185\u5b58\u5206\u9875\uff08Paging\uff09\u3002</p> <p>\u5206\u9875\u662f\u628a\u6574\u4e2a\u865a\u62df\u548c\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u5207\u6210\u4e00\u6bb5\u6bb5\u56fa\u5b9a\u5c3a\u5bf8\u7684\u5927\u5c0f\u3002\u8fd9\u6837\u4e00\u4e2a\u8fde\u7eed\u5e76\u4e14\u5c3a\u5bf8\u56fa\u5b9a\u7684\u5185\u5b58\u7a7a\u95f4\uff0c\u6211\u4eec\u53eb\u9875\uff08Page\uff09\u3002\u5728 Linux \u4e0b\uff0c\u6bcf\u4e00\u9875\u7684\u5927\u5c0f\u4e3a <code>4KB</code>\u3002</p> <p>\u865a\u62df\u5730\u5740\u4e0e\u7269\u7406\u5730\u5740\u4e4b\u95f4\u901a\u8fc7\u9875\u8868\u6765\u6620\u5c04\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u9875\u8868\u662f\u5b58\u50a8\u5728\u5185\u5b58\u91cc\u7684\uff0c\u5185\u5b58\u7ba1\u7406\u5355\u5143 \uff08MMU\uff09\u5c31\u505a\u5c06\u865a\u62df\u5185\u5b58\u5730\u5740\u8f6c\u6362\u6210\u7269\u7406\u5730\u5740\u7684\u5de5\u4f5c\u3002</p> <p>\u800c\u5f53\u8fdb\u7a0b\u8bbf\u95ee\u7684\u865a\u62df\u5730\u5740\u5728\u9875\u8868\u4e2d\u67e5\u4e0d\u5230\u65f6\uff0c\u7cfb\u7edf\u4f1a\u4ea7\u751f\u4e00\u4e2a\u7f3a\u9875\u5f02\u5e38\uff0c\u8fdb\u5165\u7cfb\u7edf\u5185\u6838\u7a7a\u95f4\u5206\u914d\u7269\u7406\u5185\u5b58\u3001\u66f4\u65b0\u8fdb\u7a0b\u9875\u8868\uff0c\u6700\u540e\u518d\u8fd4\u56de\u7528\u6237\u7a7a\u95f4\uff0c\u6062\u590d\u8fdb\u7a0b\u7684\u8fd0\u884c\u3002</p> <p>\u5206\u9875\u662f\u600e\u4e48\u89e3\u51b3\u5206\u6bb5\u7684\u300c\u5916\u90e8\u5185\u5b58\u788e\u7247\u548c\u5185\u5b58\u4ea4\u6362\u6548\u7387\u4f4e\u300d\u7684\u95ee\u9898\uff1f</p> <p>\u5185\u5b58\u5206\u9875\u7531\u4e8e\u5185\u5b58\u7a7a\u95f4\u90fd\u662f\u9884\u5148\u5212\u5206\u597d\u7684\uff0c\u4e5f\u5c31\u4e0d\u4f1a\u50cf\u5185\u5b58\u5206\u6bb5\u4e00\u6837\uff0c\u5728\u6bb5\u4e0e\u6bb5\u4e4b\u95f4\u4f1a\u4ea7\u751f\u95f4\u9699\u975e\u5e38\u5c0f\u7684\u5185\u5b58\uff0c\u8fd9\u6b63\u662f\u5206\u6bb5\u4f1a\u4ea7\u751f\u5916\u90e8\u5185\u5b58\u788e\u7247\u7684\u539f\u56e0\u3002\u800c\u91c7\u7528\u4e86\u5206\u9875\uff0c\u9875\u4e0e\u9875\u4e4b\u95f4\u662f\u7d27\u5bc6\u6392\u5217\u7684\uff0c\u6240\u4ee5\u4e0d\u4f1a\u6709\u5916\u90e8\u788e\u7247\u3002</p> <p>\u4f46\u662f\uff0c\u56e0\u4e3a\u5185\u5b58\u5206\u9875\u673a\u5236\u5206\u914d\u5185\u5b58\u7684\u6700\u5c0f\u5355\u4f4d\u662f\u4e00\u9875\uff0c\u5373\u4f7f\u7a0b\u5e8f\u4e0d\u8db3\u4e00\u9875\u5927\u5c0f\uff0c\u6211\u4eec\u6700\u5c11\u53ea\u80fd\u5206\u914d\u4e00\u4e2a\u9875\uff0c\u6240\u4ee5\u9875\u5185\u4f1a\u51fa\u73b0\u5185\u5b58\u6d6a\u8d39\uff0c\u6240\u4ee5\u9488\u5bf9\u5185\u5b58\u5206\u9875\u673a\u5236\u4f1a\u6709\u5185\u90e8\u5185\u5b58\u788e\u7247\u7684\u73b0\u8c61\u3002</p> <p>\u5982\u679c\u5185\u5b58\u7a7a\u95f4\u4e0d\u591f\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u628a\u5176\u4ed6\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u4e2d\u7684\u300c\u6700\u8fd1\u6ca1\u88ab\u4f7f\u7528\u300d\u7684\u5185\u5b58\u9875\u9762\u7ed9\u91ca\u653e\u6389\uff0c\u4e5f\u5c31\u662f\u6682\u65f6\u5199\u5728\u786c\u76d8\u4e0a\uff0c\u79f0\u4e3a\u6362\u51fa\uff08Swap Out\uff09\u3002\u4e00\u65e6\u9700\u8981\u7684\u65f6\u5019\uff0c\u518d\u52a0\u8f7d\u8fdb\u6765\uff0c\u79f0\u4e3a\u6362\u5165\uff08Swap In\uff09\u3002\u6240\u4ee5\uff0c\u4e00\u6b21\u6027\u5199\u5165\u78c1\u76d8\u7684\u4e5f\u53ea\u6709\u5c11\u6570\u7684\u4e00\u4e2a\u9875\u6216\u8005\u51e0\u4e2a\u9875\uff0c\u4e0d\u4f1a\u82b1\u592a\u591a\u65f6\u95f4\uff0c\u5185\u5b58\u4ea4\u6362\u7684\u6548\u7387\u5c31\u76f8\u5bf9\u6bd4\u8f83\u9ad8\u3002</p> <p></p> <p>\u66f4\u8fdb\u4e00\u6b65\u5730\uff0c\u5206\u9875\u7684\u65b9\u5f0f\u4f7f\u5f97\u6211\u4eec\u5728\u52a0\u8f7d\u7a0b\u5e8f\u7684\u65f6\u5019\uff0c\u4e0d\u518d\u9700\u8981\u4e00\u6b21\u6027\u90fd\u628a\u7a0b\u5e8f\u52a0\u8f7d\u5230\u7269\u7406\u5185\u5b58\u4e2d\u3002\u6211\u4eec\u5b8c\u5168\u53ef\u4ee5\u5728\u8fdb\u884c\u865a\u62df\u5185\u5b58\u548c\u7269\u7406\u5185\u5b58\u7684\u9875\u4e4b\u95f4\u7684\u6620\u5c04\u4e4b\u540e\uff0c\u5e76\u4e0d\u771f\u7684\u628a\u9875\u52a0\u8f7d\u5230\u7269\u7406\u5185\u5b58\u91cc\uff0c\u800c\u662f\u53ea\u6709\u5728\u7a0b\u5e8f\u8fd0\u884c\u4e2d\uff0c\u9700\u8981\u7528\u5230\u5bf9\u5e94\u865a\u62df\u5185\u5b58\u9875\u91cc\u9762\u7684\u6307\u4ee4\u548c\u6570\u636e\u65f6\uff0c\u518d\u52a0\u8f7d\u5230\u7269\u7406\u5185\u5b58\u91cc\u9762\u53bb\u3002</p> <p>\u5206\u9875\u673a\u5236\u4e0b\uff0c\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u662f\u5982\u4f55\u6620\u5c04\u7684\uff1f</p> <p>\u5728\u5206\u9875\u673a\u5236\u4e0b\uff0c\u865a\u62df\u5730\u5740\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u9875\u53f7\u548c\u9875\u5185\u504f\u79fb\u3002\u9875\u53f7\u4f5c\u4e3a\u9875\u8868\u7684\u7d22\u5f15\uff0c\u9875\u8868\u5305\u542b\u7269\u7406\u9875\u6bcf\u9875\u6240\u5728\u7269\u7406\u5185\u5b58\u7684\u57fa\u5730\u5740\uff0c\u8fd9\u4e2a\u57fa\u5730\u5740\u4e0e\u9875\u5185\u504f\u79fb\u7684\u7ec4\u5408\u5c31\u5f62\u6210\u4e86\u7269\u7406\u5185\u5b58\u5730\u5740\uff0c\u89c1\u4e0b\u56fe\u3002</p> <p></p> <p>\u603b\u7ed3\u4e00\u4e0b\uff0c\u5bf9\u4e8e\u4e00\u4e2a\u5185\u5b58\u5730\u5740\u8f6c\u6362\uff0c\u5176\u5b9e\u5c31\u662f\u8fd9\u6837\u4e09\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u628a\u865a\u62df\u5185\u5b58\u5730\u5740\uff0c\u5207\u5206\u6210\u9875\u53f7\u548c\u504f\u79fb\u91cf\uff1b</li> <li>\u6839\u636e\u9875\u53f7\uff0c\u4ece\u9875\u8868\u91cc\u9762\uff0c\u67e5\u8be2\u5bf9\u5e94\u7684\u7269\u7406\u9875\u53f7\uff1b</li> <li>\u76f4\u63a5\u62ff\u7269\u7406\u9875\u53f7\uff0c\u52a0\u4e0a\u524d\u9762\u7684\u504f\u79fb\u91cf\uff0c\u5c31\u5f97\u5230\u4e86\u7269\u7406\u5185\u5b58\u5730\u5740\u3002</li> </ul> <p>\u4e0b\u9762\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u865a\u62df\u5185\u5b58\u4e2d\u7684\u9875\u901a\u8fc7\u9875\u8868\u6620\u5c04\u4e3a\u4e86\u7269\u7406\u5185\u5b58\u4e2d\u7684\u9875\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u770b\u8d77\u6765\u4f3c\u4e4e\u6ca1\u4ec0\u4e48\u6bdb\u75c5\uff0c\u4f46\u662f\u653e\u5230\u5b9e\u9645\u4e2d\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd9\u79cd\u7b80\u5355\u7684\u5206\u9875\u662f\u80af\u5b9a\u662f\u4f1a\u6709\u95ee\u9898\u7684\u3002</p> <p>\u7b80\u5355\u7684\u5206\u9875\u6709\u4ec0\u4e48\u7f3a\u9677\u5417\uff1f</p> <p>\u6709\u7a7a\u95f4\u4e0a\u7684\u7f3a\u9677\u3002</p> <p>\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u662f\u53ef\u4ee5\u540c\u65f6\u8fd0\u884c\u975e\u5e38\u591a\u7684\u8fdb\u7a0b\u7684\uff0c\u90a3\u8fd9\u4e0d\u5c31\u610f\u5473\u7740\u9875\u8868\u4f1a\u975e\u5e38\u7684\u5e9e\u5927\u3002</p> <p>\u5728 32 \u4f4d\u7684\u73af\u5883\u4e0b\uff0c\u865a\u62df\u5730\u5740\u7a7a\u95f4\u5171\u6709 4GB\uff0c\u5047\u8bbe\u4e00\u4e2a\u9875\u7684\u5927\u5c0f\u662f 4KB\uff082^12\uff09\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5927\u7ea6 100 \u4e07\uff082^20\uff09\u4e2a\u9875\uff0c\u6bcf\u4e2a\u300c\u9875\u8868\u9879\u300d\u9700\u8981 4 \u4e2a\u5b57\u8282\u5927\u5c0f\u6765\u5b58\u50a8\uff0c\u90a3\u4e48\u6574\u4e2a 4GB \u7a7a\u95f4\u7684\u6620\u5c04\u5c31\u9700\u8981\u6709 <code>4MB</code> \u7684\u5185\u5b58\u6765\u5b58\u50a8\u9875\u8868\u3002</p> <p>\u8fd9 4MB \u5927\u5c0f\u7684\u9875\u8868\uff0c\u770b\u8d77\u6765\u4e5f\u4e0d\u662f\u5f88\u5927\u3002\u4f46\u662f\u8981\u77e5\u9053\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u662f\u6709\u81ea\u5df1\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\uff0c\u4e5f\u5c31\u8bf4\u90fd\u6709\u81ea\u5df1\u7684\u9875\u8868\u3002</p> <p>\u90a3\u4e48\uff0c<code>100</code> \u4e2a\u8fdb\u7a0b\u7684\u8bdd\uff0c\u5c31\u9700\u8981 <code>400MB</code> \u7684\u5185\u5b58\u6765\u5b58\u50a8\u9875\u8868\uff0c\u8fd9\u662f\u975e\u5e38\u5927\u7684\u5185\u5b58\u4e86\uff0c\u66f4\u522b\u8bf4 64 \u4f4d\u7684\u73af\u5883\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/vmem/#_4","title":"\u591a\u7ea7\u9875\u8868","text":"<p>\u8981\u89e3\u51b3\u4e0a\u9762\u7684\u95ee\u9898\uff0c\u5c31\u9700\u8981\u91c7\u7528\u4e00\u79cd\u53eb\u4f5c\u591a\u7ea7\u9875\u8868\uff08Multi-Level Page Table\uff09\u7684\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u5bf9\u4e8e\u5355\u9875\u8868\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5728 32 \u4f4d\u548c\u9875\u5927\u5c0f <code>4KB</code> \u7684\u73af\u5883\u4e0b\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u9875\u8868\u9700\u8981\u88c5\u4e0b 100 \u591a\u4e07\u4e2a\u300c\u9875\u8868\u9879\u300d\uff0c\u5e76\u4e14\u6bcf\u4e2a\u9875\u8868\u9879\u662f\u5360\u7528 4 \u5b57\u8282\u5927\u5c0f\u7684\uff0c\u4e8e\u662f\u76f8\u5f53\u4e8e\u6bcf\u4e2a\u9875\u8868\u9700\u5360\u7528 4MB \u5927\u5c0f\u7684\u7a7a\u95f4\u3002</p> <p>\u6211\u4eec\u628a\u8fd9\u4e2a 100 \u591a\u4e07\u4e2a\u300c\u9875\u8868\u9879\u300d\u7684\u5355\u7ea7\u9875\u8868\u518d\u5206\u9875\uff0c\u5c06\u9875\u8868\uff08\u4e00\u7ea7\u9875\u8868\uff09\u5206\u4e3a <code>1024</code> \u4e2a\u9875\u8868\uff08\u4e8c\u7ea7\u9875\u8868\uff09\uff0c\u6bcf\u4e2a\u8868\uff08\u4e8c\u7ea7\u9875\u8868\uff09\u4e2d\u5305\u542b <code>1024</code> \u4e2a\u300c\u9875\u8868\u9879\u300d\uff0c\u5f62\u6210\u4e8c\u7ea7\u5206\u9875\u3002\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4f60\u53ef\u80fd\u4f1a\u95ee\uff0c\u5206\u4e86\u4e8c\u7ea7\u8868\uff0c\u6620\u5c04 4GB \u5730\u5740\u7a7a\u95f4\u5c31\u9700\u8981 4KB\uff08\u4e00\u7ea7\u9875\u8868\uff09+ 4MB\uff08\u4e8c\u7ea7\u9875\u8868\uff09\u7684\u5185\u5b58\uff0c\u8fd9\u6837\u5360\u7528\u7a7a\u95f4\u4e0d\u662f\u66f4\u5927\u4e86\u5417\uff1f</p> <p>\u5f53\u7136\u5982\u679c 4GB \u7684\u865a\u62df\u5730\u5740\u5168\u90e8\u90fd\u6620\u5c04\u5230\u4e86\u7269\u7406\u5185\u5b58\u4e0a\u7684\u8bdd\uff0c\u4e8c\u7ea7\u5206\u9875\u5360\u7528\u7a7a\u95f4\u786e\u5b9e\u662f\u66f4\u5927\u4e86\uff0c\u4f46\u662f\uff0c\u6211\u4eec\u5f80\u5f80\u4e0d\u4f1a\u4e3a\u4e00\u4e2a\u8fdb\u7a0b\u5206\u914d\u90a3\u4e48\u591a\u5185\u5b58\u3002</p> <p>\u5176\u5b9e\u6211\u4eec\u5e94\u8be5\u6362\u4e2a\u89d2\u5ea6\u6765\u770b\u95ee\u9898\uff0c\u8fd8\u8bb0\u5f97\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u91cc\u9762\u65e0\u5904\u4e0d\u5728\u7684\u5c40\u90e8\u6027\u539f\u7406\u4e48\uff1f</p> <p>\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709 4GB \u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u800c\u663e\u7136\u5bf9\u4e8e\u5927\u591a\u6570\u7a0b\u5e8f\u6765\u8bf4\uff0c\u5176\u4f7f\u7528\u5230\u7684\u7a7a\u95f4\u8fdc\u672a\u8fbe\u5230 4GB\uff0c\u56e0\u4e3a\u4f1a\u5b58\u5728\u90e8\u5206\u5bf9\u5e94\u7684\u9875\u8868\u9879\u90fd\u662f\u7a7a\u7684\uff0c\u6839\u672c\u6ca1\u6709\u5206\u914d\uff0c\u5bf9\u4e8e\u5df2\u5206\u914d\u7684\u9875\u8868\u9879\uff0c\u5982\u679c\u5b58\u5728\u6700\u8fd1\u4e00\u5b9a\u65f6\u95f4\u672a\u8bbf\u95ee\u7684\u9875\u8868\uff0c\u5728\u7269\u7406\u5185\u5b58\u7d27\u5f20\u7684\u60c5\u51b5\u4e0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u5c06\u9875\u9762\u6362\u51fa\u5230\u786c\u76d8\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u4f1a\u5360\u7528\u7269\u7406\u5185\u5b58\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u4e86\u4e8c\u7ea7\u5206\u9875\uff0c\u4e00\u7ea7\u9875\u8868\u5c31\u53ef\u4ee5\u8986\u76d6\u6574\u4e2a 4GB \u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4f46\u5982\u679c\u67d0\u4e2a\u4e00\u7ea7\u9875\u8868\u7684\u9875\u8868\u9879\u6ca1\u6709\u88ab\u7528\u5230\uff0c\u4e5f\u5c31\u4e0d\u9700\u8981\u521b\u5efa\u8fd9\u4e2a\u9875\u8868\u9879\u5bf9\u5e94\u7684\u4e8c\u7ea7\u9875\u8868\u4e86\uff0c\u5373\u53ef\u4ee5\u5728\u9700\u8981\u65f6\u624d\u521b\u5efa\u4e8c\u7ea7\u9875\u8868\u3002\u505a\u4e2a\u7b80\u5355\u7684\u8ba1\u7b97\uff0c\u5047\u8bbe\u53ea\u6709 20% \u7684\u4e00\u7ea7\u9875\u8868\u9879\u88ab\u7528\u5230\u4e86\uff0c\u90a3\u4e48\u9875\u8868\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u5c31\u53ea\u6709 4KB\uff08\u4e00\u7ea7\u9875\u8868\uff09 + 20% * 4MB\uff08\u4e8c\u7ea7\u9875\u8868\uff09= <code>0.804MB</code>\uff0c\u8fd9\u5bf9\u6bd4\u5355\u7ea7\u9875\u8868\u7684 <code>4MB</code> \u662f\u4e0d\u662f\u4e00\u4e2a\u5de8\u5927\u7684\u8282\u7ea6\uff1f</p> <p>\u90a3\u4e48\u4e3a\u4ec0\u4e48\u4e0d\u5206\u7ea7\u7684\u9875\u8868\u5c31\u505a\u4e0d\u5230\u8fd9\u6837\u8282\u7ea6\u5185\u5b58\u5462\uff1f</p> <p>\u6211\u4eec\u4ece\u9875\u8868\u7684\u6027\u8d28\u6765\u770b\uff0c\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\u7684\u9875\u8868\u627f\u62c5\u7684\u804c\u8d23\u662f\u5c06\u865a\u62df\u5730\u5740\u7ffb\u8bd1\u6210\u7269\u7406\u5730\u5740\u3002\u5047\u5982\u865a\u62df\u5730\u5740\u5728\u9875\u8868\u4e2d\u627e\u4e0d\u5230\u5bf9\u5e94\u7684\u9875\u8868\u9879\uff0c\u8ba1\u7b97\u673a\u7cfb\u7edf\u5c31\u4e0d\u80fd\u5de5\u4f5c\u4e86\u3002\u6240\u4ee5\u9875\u8868\u4e00\u5b9a\u8981\u8986\u76d6\u5168\u90e8\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4e0d\u5206\u7ea7\u7684\u9875\u8868\u5c31\u9700\u8981\u6709 100 \u591a\u4e07\u4e2a\u9875\u8868\u9879\u6765\u6620\u5c04\uff0c\u800c\u4e8c\u7ea7\u5206\u9875\u5219\u53ea\u9700\u8981 1024 \u4e2a\u9875\u8868\u9879\uff08\u6b64\u65f6\u4e00\u7ea7\u9875\u8868\u8986\u76d6\u5230\u4e86\u5168\u90e8\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4e8c\u7ea7\u9875\u8868\u5728\u9700\u8981\u65f6\u521b\u5efa\uff09\u3002</p> <p>\u6211\u4eec\u628a\u4e8c\u7ea7\u5206\u9875\u518d\u63a8\u5e7f\u5230\u591a\u7ea7\u9875\u8868\uff0c\u5c31\u4f1a\u53d1\u73b0\u9875\u8868\u5360\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u66f4\u5c11\u4e86\uff0c\u8fd9\u4e00\u5207\u90fd\u8981\u5f52\u529f\u4e8e\u5bf9\u5c40\u90e8\u6027\u539f\u7406\u7684\u5145\u5206\u5e94\u7528\u3002</p> <p>\u5bf9\u4e8e 64 \u4f4d\u7684\u7cfb\u7edf\uff0c\u4e24\u7ea7\u5206\u9875\u80af\u5b9a\u4e0d\u591f\u4e86\uff0c\u5c31\u53d8\u6210\u4e86\u56db\u7ea7\u76ee\u5f55\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u5168\u5c40\u9875\u76ee\u5f55\u9879 PGD\uff08Page Global Directory\uff09\uff1b</li> <li>\u4e0a\u5c42\u9875\u76ee\u5f55\u9879 PUD\uff08Page Upper Directory\uff09\uff1b</li> <li>\u4e2d\u95f4\u9875\u76ee\u5f55\u9879 PMD\uff08Page Middle Directory\uff09\uff1b</li> <li>\u9875\u8868\u9879 PTE\uff08Page Table Entry\uff09\uff1b</li> </ul> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/vmem/#tlb","title":"TLB","text":"<p>\u591a\u7ea7\u9875\u8868\u867d\u7136\u89e3\u51b3\u4e86\u7a7a\u95f4\u4e0a\u7684\u95ee\u9898\uff0c\u4f46\u662f\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u8f6c\u6362\u5c31\u591a\u4e86\u51e0\u9053\u8f6c\u6362\u7684\u5de5\u5e8f\uff0c\u8fd9\u663e\u7136\u5c31\u964d\u4f4e\u4e86\u8fd9\u4fe9\u5730\u5740\u8f6c\u6362\u7684\u901f\u5ea6\uff0c\u4e5f\u5c31\u662f\u5e26\u6765\u4e86\u65f6\u95f4\u4e0a\u7684\u5f00\u9500\u3002</p> <p>\u7a0b\u5e8f\u662f\u6709\u5c40\u90e8\u6027\u7684\uff0c\u5373\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\uff0c\u6574\u4e2a\u7a0b\u5e8f\u7684\u6267\u884c\u4ec5\u9650\u4e8e\u7a0b\u5e8f\u4e2d\u7684\u67d0\u4e00\u90e8\u5206\u3002\u76f8\u5e94\u5730\uff0c\u6267\u884c\u6240\u8bbf\u95ee\u7684\u5b58\u50a8\u7a7a\u95f4\u4e5f\u5c40\u9650\u4e8e\u67d0\u4e2a\u5185\u5b58\u533a\u57df\u3002</p> <p></p> <p>\u6211\u4eec\u5c31\u53ef\u4ee5\u5229\u7528\u8fd9\u4e00\u7279\u6027\uff0c\u628a\u6700\u5e38\u8bbf\u95ee\u7684\u51e0\u4e2a\u9875\u8868\u9879\u5b58\u50a8\u5230\u8bbf\u95ee\u901f\u5ea6\u66f4\u5feb\u7684\u786c\u4ef6\uff0c\u4e8e\u662f\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6\u4eec\uff0c\u5c31\u5728 CPU \u82af\u7247\u4e2d\uff0c\u52a0\u5165\u4e86\u4e00\u4e2a\u4e13\u95e8\u5b58\u653e\u7a0b\u5e8f\u6700\u5e38\u8bbf\u95ee\u7684\u9875\u8868\u9879\u7684 Cache\uff0c\u8fd9\u4e2a Cache \u5c31\u662f TLB\uff08Translation Lookaside Buffer\uff09 \uff0c\u901a\u5e38\u79f0\u4e3a\u9875\u8868\u7f13\u5b58\u3001\u8f6c\u5740\u65c1\u8def\u7f13\u5b58\u3001\u5feb\u8868\u7b49\u3002</p> <p></p> <p>\u5728 CPU \u82af\u7247\u91cc\u9762\uff0c\u5c01\u88c5\u4e86\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08Memory Management Unit\uff09\u82af\u7247\uff0c\u5b83\u7528\u6765\u5b8c\u6210\u5730\u5740\u8f6c\u6362\u548c TLB \u7684\u8bbf\u95ee\u4e0e\u4ea4\u4e92\u3002</p> <p>\u6709\u4e86 TLB \u540e\uff0c\u90a3\u4e48 CPU \u5728\u5bfb\u5740\u65f6\uff0c\u4f1a\u5148\u67e5 TLB\uff0c\u5982\u679c\u6ca1\u627e\u5230\uff0c\u624d\u4f1a\u7ee7\u7eed\u67e5\u5e38\u89c4\u7684\u9875\u8868\u3002</p> <p>TLB \u7684\u547d\u4e2d\u7387\u5176\u5b9e\u662f\u5f88\u9ad8\u7684\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u6700\u5e38\u8bbf\u95ee\u7684\u9875\u5c31\u90a3\u4e48\u51e0\u4e2a\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/vmem/#_5","title":"\u6bb5\u9875\u5f0f\u5185\u5b58\u7ba1\u7406","text":"<p>\u5185\u5b58\u5206\u6bb5\u548c\u5185\u5b58\u5206\u9875\u5e76\u4e0d\u662f\u5bf9\u7acb\u7684\uff0c\u5b83\u4eec\u662f\u53ef\u4ee5\u7ec4\u5408\u8d77\u6765\u5728\u540c\u4e00\u4e2a\u7cfb\u7edf\u4e2d\u4f7f\u7528\u7684\uff0c\u90a3\u4e48\u7ec4\u5408\u8d77\u6765\u540e\uff0c\u901a\u5e38\u79f0\u4e3a\u6bb5\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u3002</p> <p></p> <p>\u6bb5\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u5b9e\u73b0\u7684\u65b9\u5f0f\uff1a</p> <ul> <li>\u5148\u5c06\u7a0b\u5e8f\u5212\u5206\u4e3a\u591a\u4e2a\u6709\u903b\u8f91\u610f\u4e49\u7684\u6bb5\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u63d0\u5230\u7684\u5206\u6bb5\u673a\u5236\uff1b</li> <li>\u63a5\u7740\u518d\u628a\u6bcf\u4e2a\u6bb5\u5212\u5206\u4e3a\u591a\u4e2a\u9875\uff0c\u4e5f\u5c31\u662f\u5bf9\u5206\u6bb5\u5212\u5206\u51fa\u6765\u7684\u8fde\u7eed\u7a7a\u95f4\uff0c\u518d\u5212\u5206\u56fa\u5b9a\u5927\u5c0f\u7684\u9875\uff1b</li> </ul> <p>\u8fd9\u6837\uff0c\u5730\u5740\u7ed3\u6784\u5c31\u7531\u6bb5\u53f7\u3001\u6bb5\u5185\u9875\u53f7\u548c\u9875\u5185\u4f4d\u79fb\u4e09\u90e8\u5206\u7ec4\u6210\u3002</p> <p>\u7528\u4e8e\u6bb5\u9875\u5f0f\u5730\u5740\u53d8\u6362\u7684\u6570\u636e\u7ed3\u6784\u662f\u6bcf\u4e00\u4e2a\u7a0b\u5e8f\u4e00\u5f20\u6bb5\u8868\uff0c\u6bcf\u4e2a\u6bb5\u53c8\u5efa\u7acb\u4e00\u5f20\u9875\u8868\uff0c\u6bb5\u8868\u4e2d\u7684\u5730\u5740\u662f\u9875\u8868\u7684\u8d77\u59cb\u5730\u5740\uff0c\u800c\u9875\u8868\u4e2d\u7684\u5730\u5740\u5219\u4e3a\u67d0\u9875\u7684\u7269\u7406\u9875\u53f7\uff0c\u5982\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6bb5\u9875\u5f0f\u5730\u5740\u53d8\u6362\u4e2d\u8981\u5f97\u5230\u7269\u7406\u5730\u5740\u987b\u7ecf\u8fc7\u4e09\u6b21\u5185\u5b58\u8bbf\u95ee\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b21\u8bbf\u95ee\u6bb5\u8868\uff0c\u5f97\u5230\u9875\u8868\u8d77\u59cb\u5730\u5740\uff1b</li> <li>\u7b2c\u4e8c\u6b21\u8bbf\u95ee\u9875\u8868\uff0c\u5f97\u5230\u7269\u7406\u9875\u53f7\uff1b</li> <li>\u7b2c\u4e09\u6b21\u5c06\u7269\u7406\u9875\u53f7\u4e0e\u9875\u5185\u4f4d\u79fb\u7ec4\u5408\uff0c\u5f97\u5230\u7269\u7406\u5730\u5740\u3002</li> </ul> <p>\u53ef\u7528\u8f6f\u3001\u786c\u4ef6\u76f8\u7ed3\u5408\u7684\u65b9\u6cd5\u5b9e\u73b0\u6bb5\u9875\u5f0f\u5730\u5740\u53d8\u6362\uff0c\u8fd9\u6837\u867d\u7136\u589e\u52a0\u4e86\u786c\u4ef6\u6210\u672c\u548c\u7cfb\u7edf\u5f00\u9500\uff0c\u4f46\u63d0\u9ad8\u4e86\u5185\u5b58\u7684\u5229\u7528\u7387\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/vmem/#linux","title":"Linux \u5185\u5b58\u7ba1\u7406","text":"<p>\u90a3\u4e48\uff0cLinux \u64cd\u4f5c\u7cfb\u7edf\u91c7\u7528\u4e86\u54ea\u79cd\u65b9\u5f0f\u6765\u7ba1\u7406\u5185\u5b58\u5462\uff1f</p> <p>\u5728\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u524d\uff0c\u6211\u4eec\u5f97\u5148\u770b\u770b Intel \u5904\u7406\u5668\u7684\u53d1\u5c55\u5386\u53f2\u3002</p> <p>\u65e9\u671f Intel \u7684\u5904\u7406\u5668\u4ece 80286 \u5f00\u59cb\u4f7f\u7528\u7684\u662f\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u3002\u4f46\u662f\u5f88\u5feb\u53d1\u73b0\uff0c\u5149\u6709\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u800c\u6ca1\u6709\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u662f\u4e0d\u591f\u7684\uff0c\u8fd9\u4f1a\u4f7f\u5b83\u7684 X86 \u7cfb\u5217\u4f1a\u5931\u53bb\u5e02\u573a\u7684\u7ade\u4e89\u529b\u3002\u56e0\u6b64\uff0c\u5728\u4e0d\u4e45\u4ee5\u540e\u7684 80386 \u4e2d\u5c31\u5b9e\u73b0\u4e86\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c80386 \u9664\u4e86\u5b8c\u6210\u5e76\u5b8c\u5584\u4ece 80286 \u5f00\u59cb\u7684\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u7684\u540c\u65f6\u8fd8\u5b9e\u73b0\u4e86\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u3002</p> <p>\u4f46\u662f\u8fd9\u4e2a 80386 \u7684\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u8bbe\u8ba1\u65f6\uff0c\u6ca1\u6709\u7ed5\u5f00\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\uff0c\u800c\u662f\u5efa\u7acb\u5728\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u7684\u57fa\u7840\u4e0a\uff0c\u8fd9\u5c31\u610f\u5473\u7740\uff0c\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u7684\u4f5c\u7528\u662f\u5728\u7531\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u6240\u6620\u5c04\u800c\u6210\u7684\u5730\u5740\u4e0a\u518d\u52a0\u4e0a\u4e00\u5c42\u5730\u5740\u6620\u5c04\u3002</p> <p>\u7531\u4e8e\u6b64\u65f6\u7531\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u6620\u5c04\u800c\u6210\u7684\u5730\u5740\u4e0d\u518d\u662f\u201c\u7269\u7406\u5730\u5740\u201d\u4e86\uff0cIntel \u5c31\u79f0\u4e4b\u4e3a\u201c\u7ebf\u6027\u5730\u5740\u201d\uff08\u4e5f\u79f0\u865a\u62df\u5730\u5740\uff09\u3002\u4e8e\u662f\uff0c\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u5148\u5c06\u903b\u8f91\u5730\u5740\u6620\u5c04\u6210\u7ebf\u6027\u5730\u5740\uff0c\u7136\u540e\u518d\u7531\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u5c06\u7ebf\u6027\u5730\u5740\u6620\u5c04\u6210\u7269\u7406\u5730\u5740\u3002</p> <p></p> <p>\u8fd9\u91cc\u8bf4\u660e\u4e0b\u903b\u8f91\u5730\u5740\u548c\u7ebf\u6027\u5730\u5740\uff1a</p> <ul> <li>\u7a0b\u5e8f\u6240\u4f7f\u7528\u7684\u5730\u5740\uff0c\u901a\u5e38\u662f\u6ca1\u88ab\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u6620\u5c04\u7684\u5730\u5740\uff0c\u79f0\u4e3a\u903b\u8f91\u5730\u5740\uff1b</li> <li>\u901a\u8fc7\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u6620\u5c04\u7684\u5730\u5740\uff0c\u79f0\u4e3a\u7ebf\u6027\u5730\u5740\uff0c\u4e5f\u53eb\u865a\u62df\u5730\u5740\uff1b</li> </ul> <p>\u903b\u8f91\u5730\u5740\u662f\u300c\u6bb5\u5f0f\u5185\u5b58\u7ba1\u7406\u300d\u8f6c\u6362\u524d\u7684\u5730\u5740\uff0c\u7ebf\u6027\u5730\u5740\u5219\u662f\u300c\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u300d\u8f6c\u6362\u524d\u7684\u5730\u5740\u3002</p> <p>\u4e86\u89e3\u5b8c Intel \u5904\u7406\u5668\u7684\u53d1\u5c55\u5386\u53f2\u540e\uff0c\u6211\u4eec\u518d\u6765\u8bf4\u8bf4 Linux \u91c7\u7528\u4e86\u4ec0\u4e48\u65b9\u5f0f\u7ba1\u7406\u5185\u5b58\uff1f</p> <p>Linux \u5185\u5b58\u4e3b\u8981\u91c7\u7528\u7684\u662f\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\uff0c\u4f46\u540c\u65f6\u4e5f\u4e0d\u53ef\u907f\u514d\u5730\u6d89\u53ca\u4e86\u6bb5\u673a\u5236\u3002</p> <p>\u8fd9\u4e3b\u8981\u662f\u4e0a\u9762 Intel \u5904\u7406\u5668\u53d1\u5c55\u5386\u53f2\u5bfc\u81f4\u7684\uff0c\u56e0\u4e3a Intel X86 CPU \u4e00\u5f8b\u5bf9\u7a0b\u5e8f\u4e2d\u4f7f\u7528\u7684\u5730\u5740\u5148\u8fdb\u884c\u6bb5\u5f0f\u6620\u5c04\uff0c\u7136\u540e\u624d\u80fd\u8fdb\u884c\u9875\u5f0f\u6620\u5c04\u3002\u65e2\u7136 CPU \u7684\u786c\u4ef6\u7ed3\u6784\u662f\u8fd9\u6837\uff0cLinux \u5185\u6838\u4e5f\u53ea\u597d\u670d\u4ece Intel \u7684\u9009\u62e9\u3002</p> <p>\u4f46\u662f\u4e8b\u5b9e\u4e0a\uff0cLinux \u5185\u6838\u6240\u91c7\u53d6\u7684\u529e\u6cd5\u662f\u4f7f\u6bb5\u5f0f\u6620\u5c04\u7684\u8fc7\u7a0b\u5b9e\u9645\u4e0a\u4e0d\u8d77\u4ec0\u4e48\u4f5c\u7528\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u201c\u4e0a\u6709\u653f\u7b56\uff0c\u4e0b\u6709\u5bf9\u7b56\u201d\uff0c\u82e5\u60f9\u4e0d\u8d77\u5c31\u8eb2\u7740\u8d70\u3002</p> <p>Linux \u7cfb\u7edf\u4e2d\u7684\u6bcf\u4e2a\u6bb5\u90fd\u662f\u4ece 0 \u5730\u5740\u5f00\u59cb\u7684\u6574\u4e2a 4GB \u865a\u62df\u7a7a\u95f4\uff0832 \u4f4d\u73af\u5883\u4e0b\uff09\uff0c\u4e5f\u5c31\u662f\u6240\u6709\u7684\u6bb5\u7684\u8d77\u59cb\u5730\u5740\u90fd\u662f\u4e00\u6837\u7684\u3002\u8fd9\u610f\u5473\u7740\uff0cLinux \u7cfb\u7edf\u4e2d\u7684\u4ee3\u7801\uff0c\u5305\u62ec\u64cd\u4f5c\u7cfb\u7edf\u672c\u8eab\u7684\u4ee3\u7801\u548c\u5e94\u7528\u7a0b\u5e8f\u4ee3\u7801\uff0c\u6240\u9762\u5bf9\u7684\u5730\u5740\u7a7a\u95f4\u90fd\u662f\u7ebf\u6027\u5730\u5740\u7a7a\u95f4\uff08\u865a\u62df\u5730\u5740\uff09\uff0c\u8fd9\u79cd\u505a\u6cd5\u76f8\u5f53\u4e8e\u5c4f\u853d\u4e86\u5904\u7406\u5668\u4e2d\u7684\u903b\u8f91\u5730\u5740\u6982\u5ff5\uff0c\u6bb5\u53ea\u88ab\u7528\u4e8e\u8bbf\u95ee\u63a7\u5236\u548c\u5185\u5b58\u4fdd\u62a4\u3002</p> <p>\u6211\u4eec\u518d\u6765\u77a7\u4e00\u77a7\uff0cLinux \u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u662f\u5982\u4f55\u5206\u5e03\u7684\uff1f</p> <p>\u5728 Linux \u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u5185\u90e8\u53c8\u88ab\u5206\u4e3a\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u4e24\u90e8\u5206\uff0c\u4e0d\u540c\u4f4d\u6570\u7684\u7cfb\u7edf\uff0c\u5730\u5740\u7a7a\u95f4\u7684\u8303\u56f4\u4e5f\u4e0d\u540c\u3002\u6bd4\u5982\u6700\u5e38\u89c1\u7684 32 \u4f4d\u548c 64 \u4f4d\u7cfb\u7edf\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\uff1a</p> <ul> <li><code>32</code> \u4f4d\u7cfb\u7edf\u7684\u5185\u6838\u7a7a\u95f4\u5360\u7528 <code>1G</code>\uff0c\u4f4d\u4e8e\u6700\u9ad8\u5904\uff0c\u5269\u4e0b\u7684 <code>3G</code> \u662f\u7528\u6237\u7a7a\u95f4\uff1b</li> <li><code>64</code> \u4f4d\u7cfb\u7edf\u7684\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u90fd\u662f <code>128T</code>\uff0c\u5206\u522b\u5360\u636e\u6574\u4e2a\u5185\u5b58\u7a7a\u95f4\u7684\u6700\u9ad8\u548c\u6700\u4f4e\u5904\uff0c\u5269\u4e0b\u7684\u4e2d\u95f4\u90e8\u5206\u662f\u672a\u5b9a\u4e49\u7684\u3002</li> </ul> <p>\u518d\u6765\u8bf4\u8bf4\uff0c\u5185\u6838\u7a7a\u95f4\u4e0e\u7528\u6237\u7a7a\u95f4\u7684\u533a\u522b\uff1a</p> <ul> <li>\u8fdb\u7a0b\u5728\u7528\u6237\u6001\u65f6\uff0c\u53ea\u80fd\u8bbf\u95ee\u7528\u6237\u7a7a\u95f4\u5185\u5b58\uff1b</li> <li>\u53ea\u6709\u8fdb\u5165\u5185\u6838\u6001\u540e\uff0c\u624d\u53ef\u4ee5\u8bbf\u95ee\u5185\u6838\u7a7a\u95f4\u7684\u5185\u5b58\uff1b</li> </ul> <p>\u867d\u7136\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u5404\u81ea\u6709\u72ec\u7acb\u7684\u865a\u62df\u5185\u5b58\uff0c\u4f46\u662f\u6bcf\u4e2a\u865a\u62df\u5185\u5b58\u4e2d\u7684\u5185\u6838\u5730\u5740\uff0c\u5176\u5b9e\u5173\u8054\u7684\u90fd\u662f\u76f8\u540c\u7684\u7269\u7406\u5185\u5b58\u3002\u8fd9\u6837\uff0c\u8fdb\u7a0b\u5207\u6362\u5230\u5185\u6838\u6001\u540e\uff0c\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u5730\u8bbf\u95ee\u5185\u6838\u7a7a\u95f4\u5185\u5b58\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u8fdb\u4e00\u6b65\u4e86\u89e3\u865a\u62df\u7a7a\u95f4\u7684\u5212\u5206\u60c5\u51b5\uff0c\u7528\u6237\u7a7a\u95f4\u548c\u5185\u6838\u7a7a\u95f4\u5212\u5206\u7684\u65b9\u5f0f\u662f\u4e0d\u540c\u7684\uff0c\u5185\u6838\u7a7a\u95f4\u7684\u5206\u5e03\u60c5\u51b5\u5c31\u4e0d\u591a\u8bf4\u4e86\u3002</p> <p>\u6211\u4eec\u770b\u770b\u7528\u6237\u7a7a\u95f4\u5206\u5e03\u7684\u60c5\u51b5\uff0c\u4ee5 32 \u4f4d\u7cfb\u7edf\u4e3a\u4f8b\uff0c\u6211\u753b\u4e86\u4e00\u5f20\u56fe\u6765\u8868\u793a\u5b83\u4eec\u7684\u5173\u7cfb\uff1a</p> <p></p> <p>\u901a\u8fc7\u8fd9\u5f20\u56fe\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u7528\u6237\u7a7a\u95f4\u5185\u5b58\uff0c\u4ece\u4f4e\u5230\u9ad8\u5206\u522b\u662f 6 \u79cd\u4e0d\u540c\u7684\u5185\u5b58\u6bb5\uff1a</p> <ul> <li>\u7a0b\u5e8f\u6587\u4ef6\u6bb5\uff08.text\uff09\uff0c\u5305\u62ec\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u4ee3\u7801\uff1b</li> <li>\u5df2\u521d\u59cb\u5316\u6570\u636e\u6bb5\uff08.data\uff09\uff0c\u5305\u62ec\u9759\u6001\u5e38\u91cf\uff1b</li> <li>\u672a\u521d\u59cb\u5316\u6570\u636e\u6bb5\uff08.bss\uff09\uff0c\u5305\u62ec\u672a\u521d\u59cb\u5316\u7684\u9759\u6001\u53d8\u91cf\uff1b</li> <li>\u5806\u6bb5\uff0c\u5305\u62ec\u52a8\u6001\u5206\u914d\u7684\u5185\u5b58\uff0c\u4ece\u4f4e\u5730\u5740\u5f00\u59cb\u5411\u4e0a\u589e\u957f\uff1b</li> <li>\u6587\u4ef6\u6620\u5c04\u6bb5\uff0c\u5305\u62ec\u52a8\u6001\u5e93\u3001\u5171\u4eab\u5185\u5b58\u7b49\uff0c\u4ece\u4f4e\u5730\u5740\u5f00\u59cb\u5411\u4e0a\u589e\u957f\uff08\u8ddf\u786c\u4ef6\u548c\u5185\u6838\u7248\u672c\u6709\u5173\uff09\uff1b</li> <li>\u6808\u6bb5\uff0c\u5305\u62ec\u5c40\u90e8\u53d8\u91cf\u548c\u51fd\u6570\u8c03\u7528\u7684\u4e0a\u4e0b\u6587\u7b49\u3002\u6808\u7684\u5927\u5c0f\u662f\u56fa\u5b9a\u7684\uff0c\u4e00\u822c\u662f <code>8 MB</code>\u3002\u5f53\u7136\u7cfb\u7edf\u4e5f\u63d0\u4f9b\u4e86\u53c2\u6570\uff0c\u4ee5\u4fbf\u6211\u4eec\u81ea\u5b9a\u4e49\u5927\u5c0f\uff1b</li> </ul> <p>\u5728\u8fd9 7 \u4e2a\u5185\u5b58\u6bb5\u4e2d\uff0c\u5806\u548c\u6587\u4ef6\u6620\u5c04\u6bb5\u7684\u5185\u5b58\u662f\u52a8\u6001\u5206\u914d\u7684\u3002\u6bd4\u5982\u8bf4\uff0c\u4f7f\u7528 C \u6807\u51c6\u5e93\u7684 <code>malloc()</code> \u6216\u8005 <code>mmap()</code> \uff0c\u5c31\u53ef\u4ee5\u5206\u522b\u5728\u5806\u548c\u6587\u4ef6\u6620\u5c04\u6bb5\u52a8\u6001\u5206\u914d\u5185\u5b58\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/3_memory/vmem/#_6","title":"\u603b\u7ed3","text":"<p>\u4e3a\u4e86\u5728\u591a\u8fdb\u7a0b\u73af\u5883\u4e0b\uff0c\u4f7f\u5f97\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5185\u5b58\u5730\u5740\u4e0d\u53d7\u5f71\u54cd\uff0c\u76f8\u4e92\u9694\u79bb\uff0c\u4e8e\u662f\u64cd\u4f5c\u7cfb\u7edf\u5c31\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u72ec\u7acb\u5206\u914d\u4e00\u5957\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u6bcf\u4e2a\u7a0b\u5e8f\u53ea\u5173\u5fc3\u81ea\u5df1\u7684\u865a\u62df\u5730\u5740\u5c31\u53ef\u4ee5\uff0c\u5b9e\u9645\u4e0a\u5927\u5bb6\u7684\u865a\u62df\u5730\u5740\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4f46\u5206\u5e03\u5230\u7269\u7406\u5730\u5740\u5185\u5b58\u662f\u4e0d\u4e00\u6837\u7684\u3002\u4f5c\u4e3a\u7a0b\u5e8f\uff0c\u4e5f\u4e0d\u7528\u5173\u5fc3\u7269\u7406\u5730\u5740\u7684\u4e8b\u60c5\u3002</p> <p>\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u865a\u62df\u7a7a\u95f4\uff0c\u800c\u7269\u7406\u5185\u5b58\u53ea\u6709\u4e00\u4e2a\uff0c\u6240\u4ee5\u5f53\u542f\u7528\u4e86\u5927\u91cf\u7684\u8fdb\u7a0b\uff0c\u7269\u7406\u5185\u5b58\u5fc5\u7136\u4f1a\u5f88\u7d27\u5f20\uff0c\u4e8e\u662f\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u901a\u8fc7\u5185\u5b58\u4ea4\u6362\u6280\u672f\uff0c\u628a\u4e0d\u5e38\u4f7f\u7528\u7684\u5185\u5b58\u6682\u65f6\u5b58\u653e\u5230\u786c\u76d8\uff08\u6362\u51fa\uff09\uff0c\u5728\u9700\u8981\u7684\u65f6\u5019\u518d\u88c5\u8f7d\u56de\u7269\u7406\u5185\u5b58\uff08\u6362\u5165\uff09\u3002</p> <p>\u90a3\u65e2\u7136\u6709\u4e86\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u90a3\u5fc5\u7136\u8981\u628a\u865a\u62df\u5730\u5740\u300c\u6620\u5c04\u300d\u5230\u7269\u7406\u5730\u5740\uff0c\u8fd9\u4e2a\u4e8b\u60c5\u901a\u5e38\u7531\u64cd\u4f5c\u7cfb\u7edf\u6765\u7ef4\u62a4\u3002</p> <p>\u90a3\u4e48\u5bf9\u4e8e\u865a\u62df\u5730\u5740\u4e0e\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u53ef\u4ee5\u6709\u5206\u6bb5\u548c\u5206\u9875\u7684\u65b9\u5f0f\uff0c\u540c\u65f6\u4e24\u8005\u7ed3\u5408\u90fd\u662f\u53ef\u4ee5\u7684\u3002</p> <p>\u5185\u5b58\u5206\u6bb5\u662f\u6839\u636e\u7a0b\u5e8f\u7684\u903b\u8f91\u89d2\u5ea6\uff0c\u5206\u6210\u4e86\u6808\u6bb5\u3001\u5806\u6bb5\u3001\u6570\u636e\u6bb5\u3001\u4ee3\u7801\u6bb5\u7b49\uff0c\u8fd9\u6837\u53ef\u4ee5\u5206\u79bb\u51fa\u4e0d\u540c\u5c5e\u6027\u7684\u6bb5\uff0c\u540c\u65f6\u662f\u4e00\u5757\u8fde\u7eed\u7684\u7a7a\u95f4\u3002\u4f46\u662f\u6bcf\u4e2a\u6bb5\u7684\u5927\u5c0f\u90fd\u4e0d\u662f\u7edf\u4e00\u7684\uff0c\u8fd9\u5c31\u4f1a\u5bfc\u81f4\u5916\u90e8\u5185\u5b58\u788e\u7247\u548c\u5185\u5b58\u4ea4\u6362\u6548\u7387\u4f4e\u7684\u95ee\u9898\u3002</p> <p>\u4e8e\u662f\uff0c\u5c31\u51fa\u73b0\u4e86\u5185\u5b58\u5206\u9875\uff0c\u628a\u865a\u62df\u7a7a\u95f4\u548c\u7269\u7406\u7a7a\u95f4\u5206\u6210\u5927\u5c0f\u56fa\u5b9a\u7684\u9875\uff0c\u5982\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u6bcf\u4e00\u9875\u7684\u5927\u5c0f\u4e3a <code>4KB</code>\u3002\u7531\u4e8e\u5206\u4e86\u9875\u540e\uff0c\u5c31\u4e0d\u4f1a\u4ea7\u751f\u7ec6\u5c0f\u7684\u5185\u5b58\u788e\u7247\uff0c\u89e3\u51b3\u4e86\u5185\u5b58\u5206\u6bb5\u7684\u5916\u90e8\u5185\u5b58\u788e\u7247\u95ee\u9898\u3002\u540c\u65f6\u5728\u5185\u5b58\u4ea4\u6362\u7684\u65f6\u5019\uff0c\u5199\u5165\u786c\u76d8\u4e5f\u5c31\u4e00\u4e2a\u9875\u6216\u51e0\u4e2a\u9875\uff0c\u8fd9\u5c31\u5927\u5927\u63d0\u9ad8\u4e86\u5185\u5b58\u4ea4\u6362\u7684\u6548\u7387\u3002</p> <p>\u518d\u6765\uff0c\u4e3a\u4e86\u89e3\u51b3\u7b80\u5355\u5206\u9875\u4ea7\u751f\u7684\u9875\u8868\u8fc7\u5927\u7684\u95ee\u9898\uff0c\u5c31\u6709\u4e86\u591a\u7ea7\u9875\u8868\uff0c\u5b83\u89e3\u51b3\u4e86\u7a7a\u95f4\u4e0a\u7684\u95ee\u9898\uff0c\u4f46\u8fd9\u5c31\u4f1a\u5bfc\u81f4 CPU \u5728\u5bfb\u5740\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9700\u8981\u6709\u5f88\u591a\u5c42\u8868\u53c2\u4e0e\uff0c\u52a0\u5927\u4e86\u65f6\u95f4\u4e0a\u7684\u5f00\u9500\u3002\u4e8e\u662f\u6839\u636e\u7a0b\u5e8f\u7684\u5c40\u90e8\u6027\u539f\u7406\uff0c\u5728 CPU \u82af\u7247\u4e2d\u52a0\u5165\u4e86 TLB\uff0c\u8d1f\u8d23\u7f13\u5b58\u6700\u8fd1\u5e38\u88ab\u8bbf\u95ee\u7684\u9875\u8868\u9879\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u5730\u5740\u7684\u8f6c\u6362\u901f\u5ea6\u3002</p> <p>Linux \u7cfb\u7edf\u4e3b\u8981\u91c7\u7528\u4e86\u5206\u9875\u7ba1\u7406\uff0c\u4f46\u662f\u7531\u4e8e Intel \u5904\u7406\u5668\u7684\u53d1\u5c55\u53f2\uff0cLinux \u7cfb\u7edf\u65e0\u6cd5\u907f\u514d\u5206\u6bb5\u7ba1\u7406\u3002\u4e8e\u662f Linux \u5c31\u628a\u6240\u6709\u6bb5\u7684\u57fa\u5730\u5740\u8bbe\u4e3a <code>0</code>\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u6240\u6709\u7a0b\u5e8f\u7684\u5730\u5740\u7a7a\u95f4\u90fd\u662f\u7ebf\u6027\u5730\u5740\u7a7a\u95f4\uff08\u865a\u62df\u5730\u5740\uff09\uff0c\u76f8\u5f53\u4e8e\u5c4f\u853d\u4e86 CPU \u903b\u8f91\u5730\u5740\u7684\u6982\u5ff5\uff0c\u6240\u4ee5\u6bb5\u53ea\u88ab\u7528\u4e8e\u8bbf\u95ee\u63a7\u5236\u548c\u5185\u5b58\u4fdd\u62a4\u3002</p> <p>\u53e6\u5916\uff0cLinux \u7cfb\u7edf\u4e2d\u865a\u62df\u7a7a\u95f4\u5206\u5e03\u53ef\u5206\u4e3a\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u4e24\u90e8\u5206\uff0c\u5176\u4e2d\u7528\u6237\u6001\u7684\u5206\u5e03\uff1a\u4ee3\u7801\u6bb5\u3001\u5168\u5c40\u53d8\u91cf\u3001BSS\u3001\u51fd\u6570\u6808\u3001\u5806\u5185\u5b58\u3001\u6620\u5c04\u533a\u3002</p> <p>\u6700\u540e\uff0c\u8bf4\u4e0b\u865a\u62df\u5185\u5b58\u6709\u4ec0\u4e48\u4f5c\u7528\uff1f</p> <ul> <li>\u7b2c\u4e00\uff0c\u865a\u62df\u5185\u5b58\u53ef\u4ee5\u4f7f\u5f97\u8fdb\u7a0b\u7684\u8fd0\u884c\u5185\u5b58\u8d85\u8fc7\u7269\u7406\u5185\u5b58\u5927\u5c0f\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u8fd0\u884c\u7b26\u5408\u5c40\u90e8\u6027\u539f\u7406\uff0cCPU \u8bbf\u95ee\u5185\u5b58\u4f1a\u6709\u5f88\u660e\u663e\u7684\u91cd\u590d\u8bbf\u95ee\u7684\u503e\u5411\u6027\uff0c\u5bf9\u4e8e\u90a3\u4e9b\u6ca1\u6709\u88ab\u7ecf\u5e38\u4f7f\u7528\u5230\u7684\u5185\u5b58\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u5b83\u6362\u51fa\u5230\u7269\u7406\u5185\u5b58\u4e4b\u5916\uff0c\u6bd4\u5982\u786c\u76d8\u4e0a\u7684 swap \u533a\u57df\u3002</li> <li>\u7b2c\u4e8c\uff0c\u7531\u4e8e\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u7684\u9875\u8868\uff0c\u6240\u4ee5\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5c31\u662f\u76f8\u4e92\u72ec\u7acb\u7684\u3002\u8fdb\u7a0b\u4e5f\u6ca1\u6709\u529e\u6cd5\u8bbf\u95ee\u5176\u4ed6\u8fdb\u7a0b\u7684\u9875\u8868\uff0c\u6240\u4ee5\u8fd9\u4e9b\u9875\u8868\u662f\u79c1\u6709\u7684\uff0c\u8fd9\u5c31\u89e3\u51b3\u4e86\u591a\u8fdb\u7a0b\u4e4b\u95f4\u5730\u5740\u51b2\u7a81\u7684\u95ee\u9898\u3002</li> <li>\u7b2c\u4e09\uff0c\u9875\u8868\u91cc\u7684\u9875\u8868\u9879\u4e2d\u9664\u4e86\u7269\u7406\u5730\u5740\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u6807\u8bb0\u5c5e\u6027\u7684\u6bd4\u7279\uff0c\u6bd4\u5982\u63a7\u5236\u4e00\u4e2a\u9875\u7684\u8bfb\u5199\u6743\u9650\uff0c\u6807\u8bb0\u8be5\u9875\u662f\u5426\u5b58\u5728\u7b49\u3002\u5728\u5185\u5b58\u8bbf\u95ee\u65b9\u9762\uff0c\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u66f4\u597d\u7684\u5b89\u5168\u6027\u3002</li> </ul> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/create_thread_max/","title":"5.6 \u4e00\u4e2a\u8fdb\u7a0b\u6700\u591a\u53ef\u4ee5\u521b\u5efa\u591a\u5c11\u4e2a\u7ebf\u7a0b\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6628\u5929\u6709\u4f4d\u8bfb\u8005\u95ee\u4e86\u6211\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a</p> <p> </p> <p>\u5927\u81f4\u610f\u601d\u5c31\u662f\uff0c\u4ed6\u770b\u4e86\u4e00\u4e2a\u9762\u7ecf\uff0c\u8bf4\u865a\u62df\u5185\u5b58\u662f 2G \u5927\u5c0f\uff0c\u7136\u540e\u4ed6\u770b\u4e86\u6211\u7684\u56fe\u89e3\u7cfb\u7edf PDF \u91cc\u8bf4\u865a\u62df\u5185\u5b58\u662f 4G\uff0c\u7136\u540e\u4ed6\u5c31\u61f5\u903c\u4e86\u3002</p> <p>\u5176\u5b9e\u4ed6\u770b\u8fd9\u4e2a\u9762\u7ecf\u5f88\u6709\u95ee\u9898\uff0c\u6ca1\u6709\u8bf4\u660e\u662f\u4ec0\u4e48\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4ee5\u53ca\u662f\u591a\u5c11\u4f4d\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u56e0\u4e3a\u4e0d\u540c\u7684\u64cd\u4f5c\u7cfb\u7edf\u548c\u4e0d\u540c\u4f4d\u6570\u7684\u64cd\u4f5c\u7cfb\u7edf\uff0c\u865a\u62df\u5185\u5b58\u53ef\u80fd\u662f\u4e0d\u4e00\u6837\u591a\u3002</p> <p>Windows \u7cfb\u7edf\u6211\u4e0d\u4e86\u89e3\uff0c\u6211\u5c31\u8bf4\u8bf4 Linux \u7cfb\u7edf\u3002 </p> <p>\u5728 Linux \u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u5185\u90e8\u53c8\u88ab\u5206\u4e3a\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u4e24\u90e8\u5206\uff0c\u4e0d\u540c\u4f4d\u6570\u7684\u7cfb\u7edf\uff0c\u5730\u5740 \u7a7a\u95f4\u7684\u8303\u56f4\u4e5f\u4e0d\u540c\u3002\u6bd4\u5982\u6700\u5e38\u2ec5\u7684 32 \u4f4d\u548c 64 \u4f4d\u7cfb\u7edf\uff0c\u5982\u4e0b\u6240\u793a\uff1a</p> <p></p> <p>\u901a\u8fc7\u8fd9\u91cc\u53ef\u4ee5\u770b\u51fa\uff1a - 32 \u4f4d\u7cfb\u7edf\u7684\u5185\u6838\u7a7a\u95f4\u5360\u7528 1G\uff0c\u4f4d\u4e8e\u6700\u9ad8\u5904\uff0c\u5269\u4e0b\u7684 3G \u662f\u7528\u6237\u7a7a\u95f4; - 64 \u4f4d\u7cfb\u7edf\u7684\u5185\u6838\u7a7a\u95f4\u548c\u7528\u6237\u7a7a\u95f4\u90fd\u662f 128T\uff0c\u5206\u522b\u5360\u636e\u6574\u4e2a\u5185\u5b58\u7a7a\u95f4\u7684\u6700\u9ad8\u548c\u6700\u4f4e\u5904\uff0c\u5269\u4e0b\u7684\u4e2d   \u95f4\u90e8\u5206\u662f\u672a\u5b9a\u4e49\u7684\u3002</p> <p>\u63a5\u7740\uff0c\u6765\u770b\u770b\u8bfb\u8005\u90a3\u4e2a\u9762\u7ecf\u9898\u76ee\uff1a\u4e00\u4e2a\u8fdb\u7a0b\u6700\u591a\u53ef\u4ee5\u521b\u5efa\u591a\u5c11\u4e2a\u7ebf\u7a0b\uff1f</p> <p>\u8fd9\u4e2a\u95ee\u9898\u8ddf\u4e24\u4e2a\u4e1c\u897f\u6709\u5173\u7cfb\uff1a - \u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u4e0a\u9650\uff0c\u56e0\u4e3a\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u4e3a\u5176\u5206\u914d\u4e00\u4e2a\u6808\u7a7a\u95f4\uff0c\u5982\u679c\u7ebf\u7a0b\u6570\u91cf\u8d8a\u591a\uff0c\u6240\u9700\u7684\u6808\u7a7a\u95f4\u5c31\u8981\u8d8a\u5927\uff0c\u90a3\u4e48\u865a\u62df\u5185\u5b58\u5c31\u4f1a\u5360\u7528\u7684\u8d8a\u591a\u3002 - \u7cfb\u7edf\u53c2\u6570\u9650\u5236\uff0c\u867d\u7136 Linux \u5e76\u6ca1\u6709\u5185\u6838\u53c2\u6570\u6765\u63a7\u5236\u5355\u4e2a\u8fdb\u7a0b\u521b\u5efa\u7684\u6700\u5927\u7ebf\u7a0b\u4e2a\u6570\uff0c\u4f46\u662f\u6709\u7cfb\u7edf\u7ea7\u522b\u7684\u53c2\u6570\u6765\u63a7\u5236\u6574\u4e2a\u7cfb\u7edf\u7684\u6700\u5927\u7ebf\u7a0b\u4e2a\u6570\u3002</p> <p>\u6211\u4eec\u5148\u770b\u770b\uff0c\u5728\u8fdb\u7a0b\u91cc\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u9700\u8981\u6d88\u8017\u591a\u5c11\u865a\u62df\u5185\u5b58\u5927\u5c0f\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u6267\u884c ulimit -a \u8fd9\u6761\u547d\u4ee4\uff0c\u67e5\u770b\u8fdb\u7a0b\u521b\u5efa\u7ebf\u7a0b\u65f6\u9ed8\u8ba4\u5206\u914d\u7684\u6808\u7a7a\u95f4\u5927\u5c0f\uff0c\u6bd4\u5982\u6211\u8fd9\u53f0\u670d\u52a1\u5668\u9ed8\u8ba4\u5206\u914d\u7ed9\u7ebf\u7a0b\u7684\u6808\u7a7a\u95f4\u5927\u5c0f\u4e3a 8M\u3002</p> <p></p> <p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\uff0c\u5728 32 \u4f4d Linux \u7cfb\u7edf\u91cc\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u7a7a\u95f4\u662f 4G\uff0c\u5185\u6838\u5206\u8d70\u4e86 1G\uff0c\u7559\u7ed9\u7528\u6237\u7528\u7684\u53ea\u6709 3G\u3002</p> <p>\u90a3\u4e48\u5047\u8bbe\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u9700\u8981\u5360\u7528 10M \u865a\u62df\u5185\u5b58\uff0c\u603b\u5171\u6709 3G \u865a\u62df\u5185\u5b58\u53ef\u4ee5\u4f7f\u7528\u3002\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u7b97\u51fa\uff0c\u6700\u591a\u53ef\u4ee5\u521b\u5efa\u5dee\u4e0d\u591a 300 \u4e2a\uff083G/10M\uff09\u5de6\u53f3\u7684\u7ebf\u7a0b\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u81ea\u5df1\u505a\u4e2a\u5b9e\u9a8c\uff0c\u4f60\u53ef\u4ee5\u627e\u53f0 32 \u4f4d\u7684 Linux \u7cfb\u7edf\u8fd0\u884c\u4e0b\u9762\u8fd9\u4e2a\u4ee3\u7801\uff1a</p> <p></p> <p>\u7531\u4e8e\u6211\u624b\u4e0a\u6ca1\u6709 32 \u4f4d\u7684\u7cfb\u7edf\uff0c\u6211\u8fd9\u91cc\u8d34\u4e00\u4e2a\u7f51\u4e0a\u522b\u4eba\u505a\u7684\u6d4b\u8bd5\u7ed3\u679c\uff1a</p> <p></p> <p>\u5982\u679c\u60f3\u4f7f\u5f97\u8fdb\u7a0b\u521b\u5efa\u4e0a\u5343\u4e2a\u7ebf\u7a0b\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u8c03\u6574\u521b\u5efa\u7ebf\u7a0b\u65f6\u5206\u914d\u7684\u6808\u7a7a\u95f4\u5927\u5c0f\uff0c\u6bd4\u5982\u8c03\u6574\u4e3a 512k\uff1a</p> Text Only<pre><code>$ ulimit -s 512\n</code></pre> <p>\u8bf4\u5b8c 32 \u4f4d\u7cfb\u7edf\u7684\u60c5\u51b5\uff0c\u6211\u4eec\u6765\u770b\u770b 64 \u4f4d\u7cfb\u7edf\u91cc\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u80fd\u521b\u5efa\u591a\u5c11\u7ebf\u7a0b\u5462\uff1f</p> <p>\u6211\u7684\u6d4b\u8bd5\u670d\u52a1\u5668\u7684\u914d\u7f6e\uff1a - 64 \u4f4d\u7cfb\u7edf\uff1b - 2G \u7269\u7406\u5185\u5b58\uff1b - \u5355\u6838 CPU\u3002</p> <p>64 \u4f4d\u7cfb\u7edf\u610f\u5473\u7740\u7528\u6237\u7a7a\u95f4\u7684\u865a\u62df\u5185\u5b58\u6700\u5927\u503c\u662f 128T\uff0c\u8fd9\u4e2a\u6570\u503c\u662f\u5f88\u5927\u7684\uff0c\u5982\u679c\u6309\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\u9700\u5360\u7528 10M \u6808\u7a7a\u95f4\u7684\u60c5\u51b5\u6765\u7b97\uff0c\u90a3\u4e48\u7406\u8bba\u4e0a\u53ef\u4ee5\u521b\u5efa 128T/10M \u4e2a\u7ebf\u7a0b\uff0c\u4e5f\u5c31\u662f 1000 \u591a\u4e07\u4e2a\u7ebf\u7a0b\uff0c\u6709\u70b9\u9b54\u5e7b\uff01</p> <p>\u6240\u4ee5\u6309 64 \u4f4d\u7cfb\u7edf\u7684\u865a\u62df\u5185\u5b58\u5927\u5c0f\uff0c\u7406\u8bba\u4e0a\u53ef\u4ee5\u521b\u5efa\u65e0\u6570\u4e2a\u7ebf\u7a0b\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u80af\u5b9a\u521b\u5efa\u4e0d\u4e86\u90a3\u4e48\u591a\u7ebf\u7a0b\uff0c\u9664\u4e86\u865a\u62df\u5185\u5b58\u7684\u9650\u5236\uff0c\u8fd8\u6709\u7cfb\u7edf\u7684\u9650\u5236\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u8fd9\u4e09\u4e2a\u5185\u6838\u53c2\u6570\u7684\u5927\u5c0f\uff0c\u90fd\u4f1a\u5f71\u54cd\u521b\u5efa\u7ebf\u7a0b\u7684\u4e0a\u9650\uff1a - /proc/sys/kernel/threads-max\uff0c\u8868\u793a\u7cfb\u7edf\u652f\u6301\u7684\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba4\u503c\u662f <code>14553</code>\uff1b -  /proc/sys/kernel/pid_max\uff0c\u8868\u793a\u7cfb\u7edf\u5168\u5c40\u7684 PID \u53f7\u6570\u503c\u7684\u9650\u5236\uff0c\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u90fd\u6709 ID\uff0cID \u7684\u503c\u8d85\u8fc7\u8fd9\u4e2a\u6570\uff0c\u8fdb\u7a0b\u6216\u7ebf\u7a0b\u5c31\u4f1a\u521b\u5efa\u5931\u8d25\uff0c\u9ed8\u8ba4\u503c\u662f <code>32768</code>\uff1b -  /proc/sys/vm/max_map_count\uff0c\u8868\u793a\u9650\u5236\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u62e5\u6709\u7684 VMA(\u865a\u62df\u5185\u5b58\u533a\u57df) \u7684\u6570\u91cf\uff0c\u5177\u4f53\u4ec0\u4e48\u610f\u601d\u6211\u4e5f\u6ca1\u641e\u6e05\u695a\uff0c\u53cd\u6b63\u5982\u679c\u5b83\u7684\u503c\u5f88\u5c0f\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u521b\u5efa\u7ebf\u7a0b\u5931\u8d25\uff0c\u9ed8\u8ba4\u503c\u662f <code>65530</code>\u3002</p> <p>\u90a3\u63a5\u4e0b\u9488\u5bf9\u6211\u7684\u6d4b\u8bd5\u670d\u52a1\u5668\u7684\u914d\u7f6e\uff0c\u770b\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u6700\u591a\u80fd\u521b\u5efa\u591a\u5c11\u4e2a\u7ebf\u7a0b\u5462\uff1f</p> <p>\u6211\u5728\u8fd9\u53f0\u670d\u52a1\u5668\u8dd1\u4e86\u524d\u9762\u7684\u7a0b\u5e8f\uff0c\u5176\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u521b\u5efa\u4e86 14374 \u4e2a\u7ebf\u7a0b\u540e\uff0c\u5c31\u65e0\u6cd5\u5728\u521b\u5efa\u4e86\uff0c\u800c\u4e14\u62a5\u9519\u662f\u56e0\u4e3a\u8d44\u6e90\u7684\u9650\u5236\u3002</p> <p>\u524d\u9762\u6211\u63d0\u5230\u7684 <code>threads-max</code> \u5185\u6838\u53c2\u6570\uff0c\u5b83\u662f\u9650\u5236\u7cfb\u7edf\u91cc\u6700\u5927\u7ebf\u7a0b\u6570\uff0c\u9ed8\u8ba4\u503c\u662f 14553\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u8fd0\u884c\u90a3\u4e2a\u6d4b\u8bd5\u7ebf\u7a0b\u6570\u7684\u7a0b\u5e8f\u540e\uff0c\u770b\u4e0b\u5f53\u524d\u7cfb\u7edf\u7684\u7ebf\u7a0b\u6570\u662f\u591a\u5c11\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>top -H</code> \u67e5\u770b\u3002</p> <p></p> <p>\u5de6\u4e0a\u89d2\u7684 Threads \u7684\u6570\u91cf\u663e\u793a\u662f 14553\uff0c\u4e0e <code>threads-max</code> \u5185\u6838\u53c2\u6570\u7684\u503c\u76f8\u540c\uff0c\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u8ba4\u4e3a\u662f\u56e0\u4e3a\u8fd9\u4e2a\u53c2\u6570\u5bfc\u81f4\u65e0\u6cd5\u7ee7\u7eed\u521b\u5efa\u7ebf\u7a0b\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u628a threads-max \u53c2\u6570\u8bbe\u7f6e\u6210 <code>99999</code>:</p> Text Only<pre><code>echo 99999 &gt; /proc/sys/kernel/threads-max\n</code></pre> <p>\u8bbe\u7f6e\u5b8c threads-max \u53c2\u6570\u540e\uff0c\u6211\u4eec\u91cd\u65b0\u8dd1\u6d4b\u8bd5\u7ebf\u7a0b\u6570\u7684\u7a0b\u5e8f\uff0c\u8fd0\u884c\u540e\u7ed3\u679c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u8fdb\u7a0b\u521b\u5efa\u4e86 32326 \u4e2a\u7ebf\u7a0b\u540e\uff0c\u5c31\u65e0\u6cd5\u7ee7\u7eed\u521b\u5efa\u91cc\uff0c\u4e14\u62a5\u9519\u662f\u65e0\u6cd5\u7ee7\u7eed\u7533\u8bf7\u5185\u5b58\u3002</p> <p>\u6b64\u65f6\u7684\u4e0a\u9650\u4e2a\u6570\u5f88\u63a5\u8fd1 <code>pid_max</code> \u5185\u6838\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\uff0832768\uff09\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u5c06\u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a 99999\uff1a</p> Text Only<pre><code>echo 99999 &gt; /proc/sys/kernel/pid_max\n</code></pre> <p>\u8bbe\u7f6e\u5b8c pid_max \u53c2\u6570\u540e\uff0c\u7ee7\u7eed\u8dd1\u6d4b\u8bd5\u7ebf\u7a0b\u6570\u7684\u7a0b\u5e8f\uff0c\u8fd0\u884c\u540e\u7ed3\u679c\u521b\u5efa\u7ebf\u7a0b\u7684\u4e2a\u6570\u8fd8\u662f\u4e00\u6837\u5361\u5728\u4e86 32768 \u4e86\u3002</p> <p>\u5f53\u65f6\u6211\u4e5f\u633a\u7591\u60d1\u7684\uff0c\u660e\u660e pid_max \u5df2\u7ecf\u8c03\u6574\u5927\u540e\uff0c\u4e3a\u4ec0\u4e48\u7ebf\u7a0b\u4e2a\u6570\u8fd8\u662f\u4e0a\u4e0d\u53bb\u5462\uff1f</p> <p>\u540e\u9762\u7ecf\u8fc7\u67e5\u9605\u8d44\u6599\u53d1\u73b0\uff0c<code>max_map_count</code> \u8fd9\u4e2a\u5185\u6838\u53c2\u6570\u4e5f\u662f\u9700\u8981\u8c03\u5927\u7684\uff0c\u4f46\u662f\u5b83\u7684\u6570\u503c\u4e0e\u6700\u5927\u7ebf\u7a0b\u6570\u4e4b\u95f4\u6709\u4ec0\u4e48\u5173\u7cfb\uff0c\u6211\u4e5f\u4e0d\u592a\u660e\u767d\uff0c\u53ea\u662f\u77e5\u9053\u5b83\u7684\u503c\u662f\u4f1a\u9650\u5236\u521b\u5efa\u7ebf\u7a0b\u4e2a\u6570\u7684\u4e0a\u9650\u3002</p> <p>\u7136\u540e\uff0c\u6211\u628a max_map_count \u5185\u6838\u53c2\u6570\u4e5f\u8bbe\u7f6e\u6210\u540e 99999\uff1a</p> Text Only<pre><code>echo 99999 &gt; /proc/sys/kernel/max_map_count \n</code></pre> <p>\u7ee7\u7eed\u8dd1\u6d4b\u8bd5\u7ebf\u7a0b\u6570\u7684\u7a0b\u5e8f\uff0c\u7ed3\u679c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5f53\u521b\u5efa\u5dee\u4e0d\u591a 5 \u4e07\u4e2a\u7ebf\u7a0b\u540e\uff0c\u6211\u7684\u670d\u52a1\u5668\u5c31\u5361\u4f4f\u4e0d\u52a8\u4e86\uff0cCPU \u90fd\u5df2\u7ecf\u88ab\u5360\u6ee1\u4e86\uff0c\u6bd5\u7adf\u8fd9\u4e2a\u662f\u5355\u6838 CPU\uff0c\u6240\u4ee5\u73b0\u5728\u662f CPU \u7684\u74f6\u9888\u4e86\u3002</p> <p>\u6211\u53ea\u6709\u8fd9\u53f0\u670d\u52a1\u5668\uff0c\u5982\u679c\u4f60\u4eec\u6709\u6027\u80fd\u66f4\u5f3a\u7684\u670d\u52a1\u5668\u6765\u6d4b\u8bd5\u7684\u8bdd\uff0c\u6709\u5174\u8da3\u7684\u5c0f\u4f19\u4f34\u53ef\u4ee5\u53bb\u6d4b\u8bd5\u4e0b\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6362\u4e2a\u601d\u8def\u6d4b\u8bd5\u4e0b\uff0c\u628a\u521b\u5efa\u7ebf\u7a0b\u65f6\u5206\u914d\u7684\u6808\u7a7a\u95f4\u8c03\u5927\uff0c\u6bd4\u5982\u8c03\u5927\u4e3a 1000M\uff0c\u5728\u5927\u5c31\u4f1a\u521b\u5efa\u7ebf\u7a0b\u5931\u8d25\u3002</p> Text Only<pre><code>ulimit -s 1024000\n</code></pre> <p>\u8bbe\u7f6e\u5b8c\u540e\uff0c\u8dd1\u6d4b\u8bd5\u7ebf\u7a0b\u7684\u7a0b\u5e8f\uff0c\u5176\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u603b\u5171\u521b\u5efa\u4e86 26390 \u4e2a\u7ebf\u7a0b\uff0c\u7136\u540e\u5c31\u65e0\u6cd5\u7ee7\u7eed\u521b\u5efa\u4e86\uff0c\u800c\u4e14\u8be5\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u5df2\u7ecf\u9ad8\u8fbe 25T\uff0c\u8981\u77e5\u9053\u8fd9\u53f0\u670d\u52a1\u5668\u7684\u7269\u7406\u5185\u5b58\u624d 2G\u3002</p> <p>\u4e3a\u4ec0\u4e48\u7269\u7406\u5185\u5b58\u53ea\u6709 2G\uff0c\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u5374\u53ef\u4ee5\u4f7f\u7528 25T \u5462\uff1f</p> <p>\u56e0\u4e3a\u865a\u62df\u5185\u5b58\u5e76\u4e0d\u662f\u5168\u90e8\u90fd\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\u7684\uff0c\u7a0b\u5e8f\u662f\u6709\u5c40\u90e8\u6027\u7684\u7279\u6027\uff0c\u4e5f\u5c31\u662f\u67d0\u4e00\u4e2a\u65f6\u95f4\u53ea\u4f1a\u6267\u884c\u90e8\u5206\u4ee3\u7801\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u6620\u5c04\u8fd9\u90e8\u5206\u7a0b\u5e8f\u5c31\u597d\u3002</p> <p>\u4f60\u53ef\u4ee5\u4ece\u4e0a\u9762\u90a3\u4e2a top \u7684\u622a\u56fe\u770b\u5230\uff0c\u867d\u7136\u8fdb\u7a0b\u865a\u62df\u7a7a\u95f4\u5f88\u5927\uff0c\u4f46\u662f\u7269\u7406\u5185\u5b58\uff08RES\uff09\u53ea\u6709\u4f7f\u7528\u4e86 400 \u591a M\u3002</p> <p>\u597d\u4e86\uff0c\u7b80\u5355\u603b\u7ed3\u4e0b\uff1a - 32 \u4f4d\u7cfb\u7edf\uff0c\u7528\u6237\u6001\u7684\u865a\u62df\u7a7a\u95f4\u53ea\u6709 3G\uff0c\u5982\u679c\u521b\u5efa\u7ebf\u7a0b\u65f6\u5206\u914d\u7684\u6808\u7a7a\u95f4\u662f 10M\uff0c\u90a3\u4e48\u4e00\u4e2a\u8fdb\u7a0b\u6700\u591a\u53ea\u80fd\u521b\u5efa 300 \u4e2a\u5de6\u53f3\u7684\u7ebf\u7a0b\u3002 - 64 \u4f4d\u7cfb\u7edf\uff0c\u7528\u6237\u6001\u7684\u865a\u62df\u7a7a\u95f4\u5927\u5230\u6709 128T\uff0c\u7406\u8bba\u4e0a\u4e0d\u4f1a\u53d7\u865a\u62df\u5185\u5b58\u5927\u5c0f\u7684\u9650\u5236\uff0c\u800c\u4f1a\u53d7\u7cfb\u7edf\u7684\u53c2\u6570\u6216\u6027\u80fd\u9650\u5236\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/","title":"5.4 \u600e\u4e48\u907f\u514d\u6b7b\u9501\uff1f","text":"<p>\u9762\u8bd5\u8fc7\u7a0b\u4e2d\uff0c\u6b7b\u9501\u4e5f\u662f\u9ad8\u9891\u7684\u8003\u70b9\uff0c\u56e0\u4e3a\u5982\u679c\u7ebf\u4e0a\u73af\u5883\u771f\u7684\u53d1\u751f\u4e86\u6b7b\u9501\uff0c\u90a3\u771f\u7684\u51fa\u5927\u4e8b\u4e86\u3002</p> <p>\u8fd9\u6b21\uff0c\u6211\u4eec\u5c31\u6765\u7cfb\u7edf\u5730\u804a\u804a\u6b7b\u9501\u7684\u95ee\u9898\u3002</p> <ul> <li>\u6b7b\u9501\u7684\u6982\u5ff5\uff1b</li> <li>\u6a21\u62df\u6b7b\u9501\u95ee\u9898\u7684\u4ea7\u751f\uff1b</li> <li>\u5229\u7528\u5de5\u5177\u6392\u67e5\u6b7b\u9501\u95ee\u9898\uff1b</li> <li>\u907f\u514d\u6b7b\u9501\u95ee\u9898\u7684\u53d1\u751f\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_1","title":"\u6b7b\u9501\u7684\u6982\u5ff5","text":"<p>\u5728\u591a\u7ebf\u7a0b\u7f16\u7a0b\u4e2d\uff0c\u6211\u4eec\u4e3a\u4e86\u9632\u6b62\u591a\u7ebf\u7a0b\u7ade\u4e89\u5171\u4eab\u8d44\u6e90\u800c\u5bfc\u81f4\u6570\u636e\u9519\u4e71\uff0c\u90fd\u4f1a\u5728\u64cd\u4f5c\u5171\u4eab\u8d44\u6e90\u4e4b\u524d\u52a0\u4e0a\u4e92\u65a5\u9501\uff0c\u53ea\u6709\u6210\u529f\u83b7\u5f97\u5230\u9501\u7684\u7ebf\u7a0b\uff0c\u624d\u80fd\u64cd\u4f5c\u5171\u4eab\u8d44\u6e90\uff0c\u83b7\u53d6\u4e0d\u5230\u9501\u7684\u7ebf\u7a0b\u5c31\u53ea\u80fd\u7b49\u5f85\uff0c\u76f4\u5230\u9501\u88ab\u91ca\u653e\u3002</p> <p>\u90a3\u4e48\uff0c\u5f53\u4e24\u4e2a\u7ebf\u7a0b\u4e3a\u4e86\u4fdd\u62a4\u4e24\u4e2a\u4e0d\u540c\u7684\u5171\u4eab\u8d44\u6e90\u800c\u4f7f\u7528\u4e86\u4e24\u4e2a\u4e92\u65a5\u9501\uff0c\u90a3\u4e48\u8fd9\u4e24\u4e2a\u4e92\u65a5\u9501\u5e94\u7528\u4e0d\u5f53\u7684\u65f6\u5019\uff0c\u53ef\u80fd\u4f1a\u9020\u6210\u4e24\u4e2a\u7ebf\u7a0b\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\uff0c\u5728\u6ca1\u6709\u5916\u529b\u7684\u4f5c\u7528\u4e0b\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u4f1a\u4e00\u76f4\u76f8\u4e92\u7b49\u5f85\uff0c\u5c31\u6ca1\u529e\u6cd5\u7ee7\u7eed\u8fd0\u884c\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u662f\u53d1\u751f\u4e86\u6b7b\u9501\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5c0f\u6797\u62ff\u4e86\u5c0f\u7f8e\u623f\u95f4\u7684\u94a5\u5319\uff0c\u800c\u5c0f\u6797\u5728\u81ea\u5df1\u7684\u623f\u95f4\u91cc\uff0c\u5c0f\u7f8e\u62ff\u4e86\u5c0f\u6797\u623f\u95f4\u7684\u94a5\u5319\uff0c\u800c\u5c0f\u7f8e\u4e5f\u5728\u81ea\u5df1\u7684\u623f\u95f4\u91cc\u3002\u5982\u679c\u5c0f\u6797\u8981\u4ece\u81ea\u5df1\u7684\u623f\u95f4\u91cc\u51fa\u53bb\uff0c\u5fc5\u987b\u62ff\u5230\u5c0f\u7f8e\u624b\u4e2d\u7684\u94a5\u5319\uff0c\u4f46\u662f\u5c0f\u7f8e\u8981\u51fa\u53bb\uff0c\u53c8\u5fc5\u987b\u62ff\u5230\u5c0f\u6797\u624b\u4e2d\u7684\u94a5\u5319\uff0c\u8fd9\u5c31\u5f62\u6210\u4e86\u6b7b\u9501\u3002</p> <p>\u6b7b\u9501\u53ea\u6709\u540c\u65f6\u6ee1\u8db3\u4ee5\u4e0b\u56db\u4e2a\u6761\u4ef6\u624d\u4f1a\u53d1\u751f\uff1a</p> <ul> <li>\u4e92\u65a5\u6761\u4ef6\uff1b</li> <li>\u6301\u6709\u5e76\u7b49\u5f85\u6761\u4ef6\uff1b</li> <li>\u4e0d\u53ef\u5265\u593a\u6761\u4ef6\uff1b</li> <li>\u73af\u8def\u7b49\u5f85\u6761\u4ef6\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_2","title":"\u4e92\u65a5\u6761\u4ef6","text":"<p>\u4e92\u65a5\u6761\u4ef6\u662f\u6307\u591a\u4e2a\u7ebf\u7a0b\u4e0d\u80fd\u540c\u65f6\u4f7f\u7528\u540c\u4e00\u4e2a\u8d44\u6e90\u3002</p> <p>\u6bd4\u5982\u4e0b\u56fe\uff0c\u5982\u679c\u7ebf\u7a0b A \u5df2\u7ecf\u6301\u6709\u7684\u8d44\u6e90\uff0c\u4e0d\u80fd\u518d\u540c\u65f6\u88ab\u7ebf\u7a0b B \u6301\u6709\uff0c\u5982\u679c\u7ebf\u7a0b B \u8bf7\u6c42\u83b7\u53d6\u7ebf\u7a0b A \u5df2\u7ecf\u5360\u7528\u7684\u8d44\u6e90\uff0c\u90a3\u7ebf\u7a0b B \u53ea\u80fd\u7b49\u5f85\uff0c\u76f4\u5230\u7ebf\u7a0b A \u91ca\u653e\u4e86\u8d44\u6e90\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_3","title":"\u6301\u6709\u5e76\u7b49\u5f85\u6761\u4ef6","text":"<p>\u6301\u6709\u5e76\u7b49\u5f85\u6761\u4ef6\u662f\u6307\uff0c\u5f53\u7ebf\u7a0b A \u5df2\u7ecf\u6301\u6709\u4e86\u8d44\u6e90 1\uff0c\u53c8\u60f3\u7533\u8bf7\u8d44\u6e90 2\uff0c\u800c\u8d44\u6e90 2 \u5df2\u7ecf\u88ab\u7ebf\u7a0b C \u6301\u6709\u4e86\uff0c\u6240\u4ee5\u7ebf\u7a0b  A \u5c31\u4f1a\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\uff0c\u4f46\u662f\u7ebf\u7a0b  A \u5728\u7b49\u5f85\u8d44\u6e90 2 \u7684\u540c\u65f6\u5e76\u4e0d\u4f1a\u91ca\u653e\u81ea\u5df1\u5df2\u7ecf\u6301\u6709\u7684\u8d44\u6e90 1\u3002 </p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_4","title":"\u4e0d\u53ef\u5265\u593a\u6761\u4ef6","text":"<p>\u4e0d\u53ef\u5265\u593a\u6761\u4ef6\u662f\u6307\uff0c\u5f53\u7ebf\u7a0b\u5df2\u7ecf\u6301\u6709\u4e86\u8d44\u6e90\uff0c\u5728\u81ea\u5df1\u4f7f\u7528\u5b8c\u4e4b\u524d\u4e0d\u80fd\u88ab\u5176\u4ed6\u7ebf\u7a0b\u83b7\u53d6\uff0c\u7ebf\u7a0b B \u5982\u679c\u4e5f\u60f3\u4f7f\u7528\u6b64\u8d44\u6e90\uff0c\u5219\u53ea\u80fd\u5728\u7ebf\u7a0b A \u4f7f\u7528\u5b8c\u5e76\u91ca\u653e\u540e\u624d\u80fd\u83b7\u53d6\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_5","title":"\u73af\u8def\u7b49\u5f85\u6761\u4ef6","text":"<p>\u73af\u8def\u7b49\u5f85\u6761\u4ef6\u6307\u7684\u662f\uff0c\u5728\u6b7b\u9501\u53d1\u751f\u7684\u65f6\u5019\uff0c\u4e24\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u8d44\u6e90\u7684\u987a\u5e8f\u6784\u6210\u4e86\u73af\u5f62\u94fe\u3002</p> <p>\u6bd4\u5982\uff0c\u7ebf\u7a0b A \u5df2\u7ecf\u6301\u6709\u8d44\u6e90 2\uff0c\u800c\u60f3\u8bf7\u6c42\u8d44\u6e90 1\uff0c\u7ebf\u7a0b B \u5df2\u7ecf\u83b7\u53d6\u4e86\u8d44\u6e90 1\uff0c\u800c\u60f3\u8bf7\u6c42\u8d44\u6e90 2\uff0c\u8fd9\u5c31\u5f62\u6210\u8d44\u6e90\u8bf7\u6c42\u7b49\u5f85\u7684\u73af\u5f62\u56fe\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_6","title":"\u6a21\u62df\u6b7b\u9501\u95ee\u9898\u7684\u4ea7\u751f","text":"<p>Talk is cheap. Show me the code.</p> <p>\u4e0b\u9762\uff0c\u6211\u4eec\u7528\u4ee3\u7801\u6765\u6a21\u62df\u6b7b\u9501\u95ee\u9898\u7684\u4ea7\u751f\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u5148\u521b\u5efa 2 \u4e2a\u7ebf\u7a0b\uff0c\u5206\u522b\u4e3a\u7ebf\u7a0b A \u548c \u7ebf\u7a0b B\uff0c\u7136\u540e\u6709\u4e24\u4e2a\u4e92\u65a5\u9501\uff0c\u5206\u522b\u662f mutex_A \u548c mutex_B\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> C<pre><code>pthread_mutex_t mutex_A = PTHREAD_MUTEX_INITIALIZER;\npthread_mutex_t mutex_B = PTHREAD_MUTEX_INITIALIZER;\n\nint main()\n{\n    pthread_t tidA, tidB;\n\n    //\u521b\u5efa\u4e24\u4e2a\u7ebf\u7a0b\n    pthread_create(&amp;tidA, NULL, threadA_proc, NULL);\n    pthread_create(&amp;tidB, NULL, threadB_proc, NULL);\n\n    pthread_join(tidA, NULL);\n    pthread_join(tidB, NULL);\n\n    printf(\"exit\\n\");\n\n    return 0;\n}\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u770b\u4e0b\u7ebf\u7a0b A \u51fd\u6570\u505a\u4e86\u4ec0\u4e48\u3002</p> C<pre><code>//\u7ebf\u7a0b\u51fd\u6570 A\nvoid *threadA_proc(void *data)\n{\n    printf(\"thread A waiting get ResourceA \\n\");\n    pthread_mutex_lock(&amp;mutex_A);\n    printf(\"thread A got ResourceA \\n\");\n\n    sleep(1);\n\n    printf(\"thread A waiting get ResourceB \\n\");\n    pthread_mutex_lock(&amp;mutex_B);\n    printf(\"thread A got ResourceB \\n\");\n\n    pthread_mutex_unlock(&amp;mutex_B);\n    pthread_mutex_unlock(&amp;mutex_A);\n    return (void *)0;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u7ebf\u7a0b A \u51fd\u6570\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5148\u83b7\u53d6\u4e92\u65a5\u9501 A\uff0c\u7136\u540e\u7761\u7720 1 \u79d2\uff1b</li> <li>\u518d\u83b7\u53d6\u4e92\u65a5\u9501 B\uff0c\u7136\u540e\u91ca\u653e\u4e92\u65a5\u9501 B\uff1b</li> <li>\u6700\u540e\u91ca\u653e\u4e92\u65a5\u9501 A\uff1b</li> </ul> C<pre><code>//\u7ebf\u7a0b\u51fd\u6570 B\nvoid *threadB_proc(void *data)\n{\n    printf(\"thread B waiting get ResourceB \\n\");\n    pthread_mutex_lock(&amp;mutex_B);\n    printf(\"thread B got ResourceB \\n\");\n\n    sleep(1);\n\n    printf(\"thread B waiting  get ResourceA \\n\");\n    pthread_mutex_lock(&amp;mutex_A);\n    printf(\"thread B got ResourceA \\n\");\n\n    pthread_mutex_unlock(&amp;mutex_A);\n    pthread_mutex_unlock(&amp;mutex_B);\n    return (void *)0;\n}\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u7ebf\u7a0b B \u51fd\u6570\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5148\u83b7\u53d6\u4e92\u65a5\u9501 B\uff0c\u7136\u540e\u7761\u7720 1 \u79d2\uff1b</li> <li>\u518d\u83b7\u53d6\u4e92\u65a5\u9501 A\uff0c\u7136\u540e\u91ca\u653e\u4e92\u65a5\u9501 A\uff1b</li> <li>\u6700\u540e\u91ca\u653e\u4e92\u65a5\u9501 B\uff1b</li> </ul> <p>\u7136\u540e\uff0c\u6211\u4eec\u8fd0\u884c\u8fd9\u4e2a\u7a0b\u5e8f\uff0c\u8fd0\u884c\u7ed3\u679c\u5982\u4e0b\uff1a</p> Bash<pre><code>thread B waiting get ResourceB \nthread B got ResourceB \nthread A waiting get ResourceA \nthread A got ResourceA \nthread B waiting get ResourceA \nthread A waiting get ResourceB \n// \u963b\u585e\u4e2d\u3002\u3002\u3002\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\u7ebf\u7a0b B \u5728\u7b49\u5f85\u4e92\u65a5\u9501 A \u7684\u91ca\u653e\uff0c\u7ebf\u7a0b A \u5728\u7b49\u5f85\u4e92\u65a5\u9501 B \u7684\u91ca\u653e\uff0c\u53cc\u65b9\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u8d44\u6e90\u7684\u91ca\u653e\uff0c\u5f88\u660e\u663e\uff0c\u4ea7\u751f\u4e86\u6b7b\u9501\u95ee\u9898\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_7","title":"\u5229\u7528\u5de5\u5177\u6392\u67e5\u6b7b\u9501\u95ee\u9898","text":"<p>\u5982\u679c\u4f60\u60f3\u6392\u67e5\u4f60\u7684 Java \u7a0b\u5e8f\u662f\u5426\u6b7b\u9501\uff0c\u5219\u53ef\u4ee5\u4f7f\u7528 <code>jstack</code> \u5de5\u5177\uff0c\u5b83\u662f jdk \u81ea\u5e26\u7684\u7ebf\u7a0b\u5806\u6808\u5206\u6790\u5de5\u5177\u3002</p> <p>\u7531\u4e8e\u5c0f\u6797\u7684\u6b7b\u9501\u4ee3\u7801\u4f8b\u5b50\u662f C \u5199\u7684\uff0c\u5728 Linux \u4e0b\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>pstack</code> + <code>gdb</code> \u5de5\u5177\u6765\u5b9a\u4f4d\u6b7b\u9501\u95ee\u9898\u3002</p> <p>pstack \u547d\u4ee4\u53ef\u4ee5\u663e\u793a\u6bcf\u4e2a\u7ebf\u7a0b\u7684\u6808\u8ddf\u8e2a\u4fe1\u606f\uff08\u51fd\u6570\u8c03\u7528\u8fc7\u7a0b\uff09\uff0c\u5b83\u7684\u4f7f\u7528\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u53ea\u9700\u8981 <code>pstack &lt;pid&gt;</code> \u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c\u5728\u5b9a\u4f4d\u6b7b\u9501\u95ee\u9898\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u591a\u6b21\u6267\u884c pstack \u547d\u4ee4\u67e5\u770b\u7ebf\u7a0b\u7684\u51fd\u6570\u8c03\u7528\u8fc7\u7a0b\uff0c\u591a\u6b21\u5bf9\u6bd4\u7ed3\u679c\uff0c\u786e\u8ba4\u54ea\u51e0\u4e2a\u7ebf\u7a0b\u4e00\u76f4\u6ca1\u6709\u53d8\u5316\uff0c\u4e14\u662f\u56e0\u4e3a\u5728\u7b49\u5f85\u9501\uff0c\u90a3\u4e48\u5927\u6982\u7387\u662f\u7531\u4e8e\u6b7b\u9501\u95ee\u9898\u5bfc\u81f4\u7684\u3002</p> <p>\u6211\u7528 pstack \u8f93\u51fa\u4e86\u6211\u524d\u9762\u6a21\u62df\u6b7b\u9501\u95ee\u9898\u7684\u8fdb\u7a0b\u7684\u6240\u6709\u7ebf\u7a0b\u7684\u60c5\u51b5\uff0c\u6211\u591a\u6b21\u6267\u884c\u547d\u4ee4\u540e\uff0c\u5176\u7ed3\u679c\u90fd\u4e00\u6837\uff0c\u5982\u4e0b\uff1a</p> Bash<pre><code>$ pstack 87746\nThread 3 (Thread 0x7f60a610a700 (LWP 87747)):\n#0  0x0000003720e0da1d in __lll_lock_wait () from /lib64/libpthread.so.0\n#1  0x0000003720e093ca in _L_lock_829 () from /lib64/libpthread.so.0\n#2  0x0000003720e09298 in pthread_mutex_lock () from /lib64/libpthread.so.0\n#3  0x0000000000400725 in threadA_proc ()\n#4  0x0000003720e07893 in start_thread () from /lib64/libpthread.so.0\n#5  0x00000037206f4bfd in clone () from /lib64/libc.so.6\nThread 2 (Thread 0x7f60a5709700 (LWP 87748)):\n#0  0x0000003720e0da1d in __lll_lock_wait () from /lib64/libpthread.so.0\n#1  0x0000003720e093ca in _L_lock_829 () from /lib64/libpthread.so.0\n#2  0x0000003720e09298 in pthread_mutex_lock () from /lib64/libpthread.so.0\n#3  0x0000000000400792 in threadB_proc ()\n#4  0x0000003720e07893 in start_thread () from /lib64/libpthread.so.0\n#5  0x00000037206f4bfd in clone () from /lib64/libc.so.6\nThread 1 (Thread 0x7f60a610c700 (LWP 87746)):\n#0  0x0000003720e080e5 in pthread_join () from /lib64/libpthread.so.0\n#1  0x0000000000400806 in main ()\n\n....\n\n$ pstack 87746\nThread 3 (Thread 0x7f60a610a700 (LWP 87747)):\n#0  0x0000003720e0da1d in __lll_lock_wait () from /lib64/libpthread.so.0\n#1  0x0000003720e093ca in _L_lock_829 () from /lib64/libpthread.so.0\n#2  0x0000003720e09298 in pthread_mutex_lock () from /lib64/libpthread.so.0\n#3  0x0000000000400725 in threadA_proc ()\n#4  0x0000003720e07893 in start_thread () from /lib64/libpthread.so.0\n#5  0x00000037206f4bfd in clone () from /lib64/libc.so.6\nThread 2 (Thread 0x7f60a5709700 (LWP 87748)):\n#0  0x0000003720e0da1d in __lll_lock_wait () from /lib64/libpthread.so.0\n#1  0x0000003720e093ca in _L_lock_829 () from /lib64/libpthread.so.0\n#2  0x0000003720e09298 in pthread_mutex_lock () from /lib64/libpthread.so.0\n#3  0x0000000000400792 in threadB_proc ()\n#4  0x0000003720e07893 in start_thread () from /lib64/libpthread.so.0\n#5  0x00000037206f4bfd in clone () from /lib64/libc.so.6\nThread 1 (Thread 0x7f60a610c700 (LWP 87746)):\n#0  0x0000003720e080e5 in pthread_join () from /lib64/libpthread.so.0\n#1  0x0000000000400806 in main ()\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0cThread 2 \u548c Thread 3 \u4e00\u76f4\u963b\u585e\u83b7\u53d6\u9501\uff08pthread_mutex_lock\uff09\u7684\u8fc7\u7a0b\uff0c\u800c\u4e14 pstack \u591a\u6b21\u8f93\u51fa\u4fe1\u606f\u90fd\u6ca1\u6709\u53d8\u5316\uff0c\u90a3\u4e48\u53ef\u80fd\u5927\u6982\u7387\u53d1\u751f\u4e86\u6b7b\u9501\u3002</p> <p>\u4f46\u662f\uff0c\u8fd8\u4e0d\u80fd\u591f\u786e\u8ba4\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u662f\u5728\u4e92\u76f8\u7b49\u5f85\u5bf9\u65b9\u7684\u9501\u7684\u91ca\u653e\uff0c\u56e0\u4e3a\u6211\u4eec\u770b\u4e0d\u5230\u5b83\u4eec\u662f\u7b49\u5728\u54ea\u4e2a\u9501\u5bf9\u8c61\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 gdb \u5de5\u5177\u8fdb\u4e00\u6b65\u786e\u8ba4\u3002</p> <p>\u6574\u4e2a gdb \u8c03\u8bd5\u8fc7\u7a0b\uff0c\u5982\u4e0b\uff1a</p> Bash<pre><code>// gdb \u547d\u4ee4\n$ gdb -p 87746\n\n// \u6253\u5370\u6240\u6709\u7684\u7ebf\u7a0b\u4fe1\u606f\n(gdb) info thread\n  3 Thread 0x7f60a610a700 (LWP 87747)  0x0000003720e0da1d in __lll_lock_wait () from /lib64/libpthread.so.0\n  2 Thread 0x7f60a5709700 (LWP 87748)  0x0000003720e0da1d in __lll_lock_wait () from /lib64/libpthread.so.0\n* 1 Thread 0x7f60a610c700 (LWP 87746)  0x0000003720e080e5 in pthread_join () from /lib64/libpthread.so.0\n//\u6700\u5de6\u8fb9\u7684 * \u8868\u793a gdb \u9501\u5b9a\u7684\u7ebf\u7a0b\uff0c\u5207\u6362\u5230\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u53bb\u67e5\u770b\n\n// \u5207\u6362\u5230\u7b2c2\u4e2a\u7ebf\u7a0b\n(gdb) thread 2\n[Switching to thread 2 (Thread 0x7f60a5709700 (LWP 87748))]#0  0x0000003720e0da1d in __lll_lock_wait () from /lib64/libpthread.so.0 \n\n// bt \u53ef\u4ee5\u6253\u5370\u51fd\u6570\u5806\u6808\uff0c\u5374\u65e0\u6cd5\u770b\u5230\u51fd\u6570\u53c2\u6570\uff0c\u8ddf pstack \u547d\u4ee4\u4e00\u6837 \n(gdb) bt\n#0  0x0000003720e0da1d in __lll_lock_wait () from /lib64/libpthread.so.0\n#1  0x0000003720e093ca in _L_lock_829 () from /lib64/libpthread.so.0\n#2  0x0000003720e09298 in pthread_mutex_lock () from /lib64/libpthread.so.0\n#3  0x0000000000400792 in threadB_proc (data=0x0) at dead_lock.c:25\n#4  0x0000003720e07893 in start_thread () from /lib64/libpthread.so.0\n#5  0x00000037206f4bfd in clone () from /lib64/libc.so.6\n\n// \u6253\u5370\u7b2c\u4e09\u5e27\u4fe1\u606f\uff0c\u6bcf\u6b21\u51fd\u6570\u8c03\u7528\u90fd\u4f1a\u6709\u538b\u6808\u7684\u8fc7\u7a0b\uff0c\u800c frame \u5219\u8bb0\u5f55\u6808\u4e2d\u7684\u5e27\u4fe1\u606f\n(gdb) frame 3\n#3  0x0000000000400792 in threadB_proc (data=0x0) at dead_lock.c:25\n27    printf(\"thread B waiting get ResourceA \\n\");\n28    pthread_mutex_lock(&amp;mutex_A);\n\n// \u6253\u5370mutex_A\u7684\u503c ,  __owner\u8868\u793agdb\u4e2d\u6807\u793a\u7ebf\u7a0b\u7684\u503c\uff0c\u5373LWP\n(gdb) p mutex_A\n$1 = {__data = {__lock = 2, __count = 0, __owner = 87747, __nusers = 1, __kind = 0, __spins = 0, __list = {__prev = 0x0, __next = 0x0}}, \n  __size = \"\\002\\000\\000\\000\\000\\000\\000\\000\\303V\\001\\000\\001\", '\\000' &lt;repeats 26 times&gt;, __align = 2}\n\n// \u6253\u5370mutex_B\u7684\u503c ,  __owner\u8868\u793agdb\u4e2d\u6807\u793a\u7ebf\u7a0b\u7684\u503c\uff0c\u5373LWP\n(gdb) p mutex_B\n$2 = {__data = {__lock = 2, __count = 0, __owner = 87748, __nusers = 1, __kind = 0, __spins = 0, __list = {__prev = 0x0, __next = 0x0}}, \n  __size = \"\\002\\000\\000\\000\\000\\000\\000\\000\\304V\\001\\000\\001\", '\\000' &lt;repeats 26 times&gt;, __align = 2}  \n</code></pre> <p>\u6211\u6765\u89e3\u91ca\u4e0b\uff0c\u4e0a\u9762\u7684\u8c03\u8bd5\u8fc7\u7a0b\uff1a</p> <ol> <li>\u901a\u8fc7 <code>info thread</code> \u6253\u5370\u4e86\u6240\u6709\u7684\u7ebf\u7a0b\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u6709 3 \u4e2a\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u662f\u4e3b\u7ebf\u7a0b\uff08LWP 87746\uff09\uff0c\u53e6\u5916\u4e24\u4e2a\u90fd\u662f\u6211\u4eec\u81ea\u5df1\u521b\u5efa\u7684\u7ebf\u7a0b\uff08LWP 87747 \u548c 87748\uff09\uff1b</li> <li>\u901a\u8fc7 <code>thread 2</code>\uff0c\u5c06\u5207\u6362\u5230\u7b2c 2 \u4e2a\u7ebf\u7a0b\uff08LWP 87748\uff09\uff1b</li> <li>\u901a\u8fc7 <code>bt</code>\uff0c\u6253\u5370\u7ebf\u7a0b\u7684\u8c03\u7528\u6808\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u6709 threadB_proc \u51fd\u6570\uff0c\u8bf4\u660e\u8fd9\u4e2a\u662f\u7ebf\u7a0b B \u51fd\u6570\uff0c\u4e5f\u5c31\u8bf4 LWP 87748 \u662f\u7ebf\u7a0b B;</li> <li>\u901a\u8fc7 <code>frame 3</code>\uff0c\u6253\u5370\u8c03\u7528\u6808\u4e2d\u7684\u7b2c\u4e09\u4e2a\u5e27\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u7ebf\u7a0b B \u51fd\u6570\uff0c\u5728\u83b7\u53d6\u4e92\u65a5\u9501 A \u7684\u65f6\u5019\u963b\u585e\u4e86\uff1b</li> <li>\u901a\u8fc7 <code>p mutex_A</code>\uff0c\u6253\u5370\u4e92\u65a5\u9501 A \u5bf9\u8c61\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u5b83\u88ab LWP \u4e3a 87747\uff08\u7ebf\u7a0b A\uff09\u7684\u7ebf\u7a0b\u6301\u6709\u7740\uff1b</li> <li>\u901a\u8fc7 <code>p mutex_B</code>\uff0c\u6253\u5370\u4e92\u65a5\u9501 B \u5bf9\u8c61\u4fe1\u606f\uff0c\u53ef\u4ee5\u770b\u5230\u4ed6\u88ab LWP \u4e3a 87748\uff08\u7ebf\u7a0b B\uff09\u7684\u7ebf\u7a0b\u6301\u6709\u7740\uff1b</li> </ol> <p>\u56e0\u4e3a\u7ebf\u7a0b B \u5728\u7b49\u5f85\u7ebf\u7a0b A \u6240\u6301\u6709\u7684 mutex_A, \u800c\u540c\u65f6\u7ebf\u7a0b A \u53c8\u5728\u7b49\u5f85\u7ebf\u7a0b B \u6240\u62e5\u6709\u7684 mutex_B, \u6240\u4ee5\u53ef\u4ee5\u65ad\u5b9a\u8be5\u7a0b\u5e8f\u53d1\u751f\u4e86\u6b7b\u9501\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_8","title":"\u907f\u514d\u6b7b\u9501\u95ee\u9898\u7684\u53d1\u751f","text":"<p>\u524d\u9762\u6211\u4eec\u63d0\u5230\uff0c\u4ea7\u751f\u6b7b\u9501\u7684\u56db\u4e2a\u5fc5\u8981\u6761\u4ef6\u662f\uff1a\u4e92\u65a5\u6761\u4ef6\u3001\u6301\u6709\u5e76\u7b49\u5f85\u6761\u4ef6\u3001\u4e0d\u53ef\u5265\u593a\u6761\u4ef6\u3001\u73af\u8def\u7b49\u5f85\u6761\u4ef6\u3002</p> <p>\u90a3\u4e48\u907f\u514d\u6b7b\u9501\u95ee\u9898\u5c31\u53ea\u9700\u8981\u7834\u73af\u5176\u4e2d\u4e00\u4e2a\u6761\u4ef6\u5c31\u53ef\u4ee5\uff0c\u6700\u5e38\u89c1\u7684\u5e76\u4e14\u53ef\u884c\u7684\u5c31\u662f\u4f7f\u7528\u8d44\u6e90\u6709\u5e8f\u5206\u914d\u6cd5\uff0c\u6765\u7834\u73af\u73af\u8def\u7b49\u5f85\u6761\u4ef6\u3002</p> <p>\u90a3\u4ec0\u4e48\u662f\u8d44\u6e90\u6709\u5e8f\u5206\u914d\u6cd5\u5462\uff1f</p> <p>\u7ebf\u7a0b A \u548c \u7ebf\u7a0b B \u83b7\u53d6\u8d44\u6e90\u7684\u987a\u5e8f\u8981\u4e00\u6837\uff0c\u5f53\u7ebf\u7a0b A \u662f\u5148\u5c1d\u8bd5\u83b7\u53d6\u8d44\u6e90 A\uff0c\u7136\u540e\u5c1d\u8bd5\u83b7\u53d6\u8d44\u6e90  B \u7684\u65f6\u5019\uff0c\u7ebf\u7a0b B \u540c\u6837\u4e5f\u662f\u5148\u5c1d\u8bd5\u83b7\u53d6\u8d44\u6e90 A\uff0c\u7136\u540e\u5c1d\u8bd5\u83b7\u53d6\u8d44\u6e90 B\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u7ebf\u7a0b A \u548c \u7ebf\u7a0b B \u603b\u662f\u4ee5\u76f8\u540c\u7684\u987a\u5e8f\u7533\u8bf7\u81ea\u5df1\u60f3\u8981\u7684\u8d44\u6e90\u3002</p> <p>\u6211\u4eec\u4f7f\u7528\u8d44\u6e90\u6709\u5e8f\u5206\u914d\u6cd5\u7684\u65b9\u5f0f\u6765\u4fee\u6539\u524d\u9762\u53d1\u751f\u6b7b\u9501\u7684\u4ee3\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u4e0d\u6539\u52a8\u7ebf\u7a0b A \u7684\u4ee3\u7801\u3002</p> <p>\u6211\u4eec\u5148\u8981\u6e05\u695a\u7ebf\u7a0b A \u83b7\u53d6\u8d44\u6e90\u7684\u987a\u5e8f\uff0c\u5b83\u662f\u5148\u83b7\u53d6\u4e92\u65a5\u9501 A\uff0c\u7136\u540e\u83b7\u53d6\u4e92\u65a5\u9501 B\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u53ea\u9700\u5c06\u7ebf\u7a0b B \u6539\u6210\u4ee5\u76f8\u540c\u987a\u5e8f\u7684\u83b7\u53d6\u8d44\u6e90\uff0c\u5c31\u53ef\u4ee5\u6253\u7834\u6b7b\u9501\u4e86\u3002</p> <p></p> <p>\u7ebf\u7a0b B \u51fd\u6570\u6539\u8fdb\u540e\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> C<pre><code>//\u7ebf\u7a0b B \u51fd\u6570\uff0c\u540c\u7ebf\u7a0b A \u4e00\u6837\uff0c\u5148\u83b7\u53d6\u4e92\u65a5\u9501 A\uff0c\u7136\u540e\u83b7\u53d6\u4e92\u65a5\u9501 B\nvoid *threadB_proc(void *data)\n{\n    printf(\"thread B waiting get ResourceA \\n\");\n    pthread_mutex_lock(&amp;mutex_A);\n    printf(\"thread B got ResourceA \\n\");\n\n    sleep(1);\n\n    printf(\"thread B waiting  get ResourceB \\n\");\n    pthread_mutex_lock(&amp;mutex_B);\n    printf(\"thread B got ResourceB \\n\");\n\n    pthread_mutex_unlock(&amp;mutex_B);\n    pthread_mutex_unlock(&amp;mutex_A);\n    return (void *)0;\n}\n</code></pre> <p>\u6267\u884c\u7ed3\u679c\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\uff0c\u6ca1\u6709\u53d1\u751f\u6b7b\u9501\u3002</p> Bash<pre><code>thread B waiting get ResourceA \nthread B got ResourceA \nthread A waiting get ResourceA \nthread B waiting  get ResourceB \nthread B got ResourceB \nthread A got ResourceA \nthread A waiting get ResourceB \nthread A got ResourceB\nexit\n</code></pre>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_9","title":"\u603b\u7ed3","text":"<p>\u7b80\u5355\u6765\u8bf4\uff0c\u6b7b\u9501\u95ee\u9898\u7684\u4ea7\u751f\u662f\u7531\u4e24\u4e2a\u6216\u8005\u4ee5\u4e0a\u7ebf\u7a0b\u5e76\u884c\u6267\u884c\u7684\u65f6\u5019\uff0c\u4e89\u593a\u8d44\u6e90\u800c\u4e92\u76f8\u7b49\u5f85\u9020\u6210\u7684\u3002</p> <p>\u6b7b\u9501\u53ea\u6709\u540c\u65f6\u6ee1\u8db3\u4e92\u65a5\u3001\u6301\u6709\u5e76\u7b49\u5f85\u3001\u4e0d\u53ef\u5265\u593a\u3001\u73af\u8def\u7b49\u5f85\u8fd9\u56db\u4e2a\u6761\u4ef6\u7684\u65f6\u5019\u624d\u4f1a\u53d1\u751f\u3002</p> <p>\u6240\u4ee5\u8981\u907f\u514d\u6b7b\u9501\u95ee\u9898\uff0c\u5c31\u662f\u8981\u7834\u574f\u5176\u4e2d\u4e00\u4e2a\u6761\u4ef6\u5373\u53ef\uff0c\u6700\u5e38\u7528\u7684\u65b9\u6cd5\u5c31\u662f\u4f7f\u7528\u8d44\u6e90\u6709\u5e8f\u5206\u914d\u6cd5\u6765\u7834\u574f\u73af\u8def\u7b49\u5f85\u6761\u4ef6\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/deadlock/#_10","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/","title":"5.3 \u591a\u7ebf\u7a0b\u51b2\u7a81\u4e86\u600e\u4e48\u529e\uff1f","text":"<p>\u5148\u6765\u770b\u770b\u865a\u6784\u7684\u5c0f\u6545\u4e8b</p> <p>\u5df2\u7ecf\u665a\u4e0a 11 \u70b9\u4e86\uff0c\u7a0b\u5e8f\u5458\u5c0f\u660e\u7684\u53cc\u624b\u8fd8\u5728\u952e\u76d8\u4e0a\u98de\u821e\u7740\uff0c\u773c\u795e\u4f9d\u7136\u6ce8\u89c6\u7740\u7684\u7535\u8111\u5c4f\u5e55\u3002</p> <p>\u6ca1\u529e\u6cd5\u8fd9\u6bb5\u65f6\u95f4\u516c\u53f8\u4e1a\u7ee9\u589e\u957f\u4e2d\uff0c\u9700\u6c42\u81ea\u7136\u4e5f\u591a\u4e86\u8d77\u6765\uff0c\u52a0\u73ed\u81ea\u7136\u4e5f\u5c11\u4e0d\u4e86\u3002</p> <p>\u5929\u6c14\u53d8\u5316\u83ab\u6d4b\uff0c\u8fd9\u65f6\u7a97\u5916\u4e0b\u8d77\u4e86\u84ec\u52c3\u5927\u96e8\uff0c\u540c\u65f6\u95ea\u7535\u8f70\u9e23\u3002</p> <p>\u4f46\u8fd9\u4e00\u4e1d\u90fd\u6ca1\u6709\u5f71\u54cd\u5230\u5c0f\u660e\uff0c\u59cb\u6599\u672a\u53ca\uff0c\u7a81\u7136\u4e00\u9053\u5de8\u5927\u7684\u96f7\u4e00\u95ea\u800c\u8fc7\uff0c\u529e\u516c\u697c\u5c31\u8fd9\u4e48\u505c\u7535\u4e86\uff0c\u968f\u540e\u6574\u680b\u697c\u90fd\u5728\u56de\u8361\u7740\u7684\u5c0f\u660e\u90a3\u4e00\u58f0\u6495\u5fc3\u88c2\u80ba\u7684\u300c\u5367\u69fd\u300d\u3002</p> <p>\u6b64\u65f6\uff0c\u6c42\u5c0f\u660e\u7684\u5fc3\u91cc\u9762\u79ef\u6709\u591a\u5927\uff1f</p> <p>\u7b49\u5c0f\u660e\u5fc3\u91cc\u5e73\u590d\u540e\uff0c\u7a81\u7136\u809a\u5b50\u975e\u5e38\u7684\u75db\uff0c\u60f3\u4e0a\u5395\u6240\uff0c\u5c0f\u660e\u5fc3\u60f3\u80af\u5b9a\u662f\u665a\u4e0a\u5403\u7684\u67d0\u5821\u738b\u6709\u95ee\u9898\u3002</p> <p>\u6574\u680b\u697c\u90fd\u505c\u4e86\u7535\uff0c\u5c0f\u660e\u4e24\u773c\u4e00\u62b9\u9ed1\uff0c\u5565\u90fd\u770b\u4e0d\u89c1\uff0c\u53ea\u80fd\u9760\u6478\u5899\u7684\u65b9\u6cd5\uff0c\u4e00\u6b65\u4e00\u6b65\u7684\u6765\u5230\u4e86\u5395\u6240\u95e8\u53e3\u3002</p> <p>\u5230\u4e86\u5395\u6240\uff08\u5171\u4eab\u8d44\u6e90\uff09\uff0c\u7531\u4e8e\u5b9e\u5728\u592a\u6025\uff0c\u5c0f\u660e\u76f4\u63a5\u51b2\u5165\u4e86\u5395\u6240\u91cc\uff0c\u7528\u624b\u6478\u7d22\u7740\u521a\u597d\u7b2c\u4e00\u4e2a\u95e8\u6ca1\u9501\u95e8\uff0c\u4fbf\u593a\u95e8\u800c\u5165\u3002</p> <p>\u8fd9\u5c31\u8352\u5510\u4e86\uff0c\u8fd9\u4e2a\u95e8\u91cc\u9762\u6b63\u597d\u5c0f\u7ea2\u5728\u4e0a\u7740\u5395\u6240\uff0c\u6b63\u597d\u8fd9\u4e2a\u5395\u6240\u95e8\u662f\u574f\u4e86\u7684\uff0c\u6ca1\u529e\u6cd5\u9501\u95e8\u3002</p> <p>\u9ed1\u6697\u4e2d\uff0c\u5c0f\u7ea2\u867d\u7136\u770b\u4e0d\u89c1\uff0c\u4f46\u9760\u7740\u58f0\u97f3\uff0c\u53d1\u73b0\u81ea\u5df1\u9762\u524d\u7684\u8fd9\u6247\u95e8\u6709\u52a8\u9759\uff0c\u89c9\u5f97\u4e0d\u5bf9\u52b2\uff0c\u4e8e\u662f\u94c6\u8db3\u4e86\u529b\u6c14\uff0c\u7528\u5979\u7a7f\u7740\u9ad8\u8ddf\u978b\u811a\uff0c\u7528\u529b\u5730\u4e00\u811a\u8e22\u4e86\u8fc7\u53bb\u3002</p> <p>\u5c0f\u660e\u5f88\u5e78\u8fd0\uff0c\u88ab\u8e22\u4e2d\u4e86\u300c\u547d\u6839\u5b50\u300d\uff0c\u6495\u5fc3\u88c2\u80ba\u5730\u558a\u51fa\u4e86\u4e00\u4e2a\u5b57\u300c\u75db\u300d\uff01</p> <p>\u6545\u4e8b\u8bf4\u5b8c\u4e86\uff0c\u626f\u4e86\u90a3\u4e48\u591a\uff0c\u5b9e\u9645\u4e0a\u662f\u4e3a\u4e86\u8bf4\u660e\uff0c\u5bf9\u4e8e\u5171\u4eab\u8d44\u6e90\uff0c\u5982\u679c\u6ca1\u6709\u4e0a\u9501\uff0c\u5728\u591a\u7ebf\u7a0b\u7684\u73af\u5883\u91cc\uff0c\u90a3\u4e48\u5c31\u53ef\u80fd\u4f1a\u53d1\u751f\u7ffb\u8f66\u73b0\u573a\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u7528 <code>30+</code> \u5f20\u56fe\uff0c\u5e26\u5927\u5bb6\u8d70\u8fdb\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u907f\u514d\u591a\u7ebf\u7a0b\u8d44\u6e90\u7ade\u4e89\u7684\u4e92\u65a5\u3001\u540c\u6b65\u7684\u65b9\u6cd5\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#_1","title":"\u7ade\u4e89\u4e0e\u534f\u4f5c","text":"<p>\u5728\u5355\u6838 CPU \u7cfb\u7edf\u91cc\uff0c\u4e3a\u4e86\u5b9e\u73b0\u591a\u4e2a\u7a0b\u5e8f\u540c\u65f6\u8fd0\u884c\u7684\u5047\u8c61\uff0c\u64cd\u4f5c\u7cfb\u7edf\u901a\u5e38\u4ee5\u65f6\u95f4\u7247\u8c03\u5ea6\u7684\u65b9\u5f0f\uff0c\u8ba9\u6bcf\u4e2a\u8fdb\u7a0b\u6267\u884c\u6bcf\u6b21\u6267\u884c\u4e00\u4e2a\u65f6\u95f4\u7247\uff0c\u65f6\u95f4\u7247\u7528\u5b8c\u4e86\uff0c\u5c31\u5207\u6362\u4e0b\u4e00\u4e2a\u8fdb\u7a0b\u8fd0\u884c\uff0c\u7531\u4e8e\u8fd9\u4e2a\u65f6\u95f4\u7247\u7684\u65f6\u95f4\u5f88\u77ed\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u4e86\u300c\u5e76\u53d1\u300d\u7684\u73b0\u8c61\u3002</p> <p></p> <p>\u53e6\u5916\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u521b\u5efa\u5de8\u5927\u3001\u79c1\u6709\u7684\u865a\u62df\u5185\u5b58\u7684\u5047\u8c61\uff0c\u8fd9\u79cd\u5730\u5740\u7a7a\u95f4\u7684\u62bd\u8c61\u8ba9\u6bcf\u4e2a\u7a0b\u5e8f\u597d\u50cf\u62e5\u6709\u81ea\u5df1\u7684\u5185\u5b58\uff0c\u800c\u5b9e\u9645\u4e0a\u64cd\u4f5c\u7cfb\u7edf\u5728\u80cc\u540e\u79d8\u5bc6\u5730\u8ba9\u591a\u4e2a\u5730\u5740\u7a7a\u95f4\u300c\u590d\u7528\u300d\u7269\u7406\u5185\u5b58\u6216\u8005\u78c1\u76d8\u3002</p> <p></p> <p>\u5982\u679c\u4e00\u4e2a\u7a0b\u5e8f\u53ea\u6709\u4e00\u4e2a\u6267\u884c\u6d41\u7a0b\uff0c\u4e5f\u4ee3\u8868\u5b83\u662f\u5355\u7ebf\u7a0b\u7684\u3002\u5f53\u7136\u4e00\u4e2a\u7a0b\u5e8f\u53ef\u4ee5\u6709\u591a\u4e2a\u6267\u884c\u6d41\u7a0b\uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684\u591a\u7ebf\u7a0b\u7a0b\u5e8f\uff0c\u7ebf\u7a0b\u662f\u8c03\u5ea6\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u8fdb\u7a0b\u5219\u662f\u8d44\u6e90\u5206\u914d\u7684\u57fa\u672c\u5355\u4f4d\u3002</p> <p>\u6240\u4ee5\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u662f\u53ef\u4ee5\u5171\u4eab\u8fdb\u7a0b\u7684\u8d44\u6e90\uff0c\u6bd4\u5982\u4ee3\u7801\u6bb5\u3001\u5806\u7a7a\u95f4\u3001\u6570\u636e\u6bb5\u3001\u6253\u5f00\u7684\u6587\u4ef6\u7b49\u8d44\u6e90\uff0c\u4f46\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u6808\u7a7a\u95f4\u3002</p> <p></p> <p>\u90a3\u4e48\u95ee\u9898\u5c31\u6765\u4e86\uff0c\u591a\u4e2a\u7ebf\u7a0b\u5982\u679c\u7ade\u4e89\u5171\u4eab\u8d44\u6e90\uff0c\u5982\u679c\u4e0d\u91c7\u53d6\u6709\u6548\u7684\u63aa\u65bd\uff0c\u5219\u4f1a\u9020\u6210\u5171\u4eab\u6570\u636e\u7684\u6df7\u4e71\u3002</p> <p>\u6211\u4eec\u505a\u4e2a\u5c0f\u5b9e\u9a8c\uff0c\u521b\u5efa\u4e24\u4e2a\u7ebf\u7a0b\uff0c\u5b83\u4eec\u5206\u522b\u5bf9\u5171\u4eab\u53d8\u91cf <code>i</code> \u81ea\u589e <code>1</code> \u6267\u884c <code>10000</code> \u6b21\uff0c\u5982\u4e0b\u4ee3\u7801\uff08\u867d\u7136\u8bf4\u662f C++ \u4ee3\u7801\uff0c\u4f46\u662f\u6ca1\u5b66\u8fc7 C++ \u7684\u540c\u5b66\u4e5f\u662f\u80fd\u770b\u61c2\u7684\uff09\uff1a</p> <p></p> <p>\u6309\u7406\u6765\u8bf4\uff0c<code>i</code> \u53d8\u91cf\u6700\u540e\u7684\u503c\u5e94\u8be5\u662f <code>20000</code>\uff0c\u4f46\u5f88\u4e0d\u5e78\uff0c\u5e76\u4e0d\u662f\u5982\u6b64\u3002\u6211\u4eec\u5bf9\u4e0a\u9762\u7684\u7a0b\u5e8f\u6267\u884c\u4e00\u4e0b\uff1a</p> <p></p> <p>\u8fd0\u884c\u4e86\u4e24\u6b21\uff0c\u53d1\u73b0\u51fa\u73b0\u4e86 <code>i</code> \u503c\u7684\u7ed3\u679c\u662f <code>15173</code>\uff0c\u4e5f\u4f1a\u51fa\u73b0 <code>20000</code> \u7684 i \u503c\u7ed3\u679c\u3002</p> <p>\u6bcf\u6b21\u8fd0\u884c\u4e0d\u4f46\u4f1a\u4ea7\u751f\u9519\u8bef\uff0c\u800c\u4e14\u5f97\u5230\u4e0d\u540c\u7684\u7ed3\u679c\u3002\u5728\u8ba1\u7b97\u673a\u91cc\u662f\u4e0d\u80fd\u5bb9\u5fcd\u7684\uff0c\u867d\u7136\u662f\u5c0f\u6982\u7387\u51fa\u73b0\u7684\u9519\u8bef\uff0c\u4f46\u662f\u5c0f\u6982\u7387\u4e8b\u4ef6\u5b83\u4e00\u5b9a\u662f\u4f1a\u53d1\u751f\u7684\uff0c\u300c\u58a8\u83f2\u5b9a\u5f8b\u300d\u5927\u5bb6\u90fd\u61c2\u5427\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff1f</p> <p>\u4e3a\u4e86\u7406\u89e3\u4e3a\u4ec0\u4e48\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u5fc5\u987b\u4e86\u89e3\u7f16\u8bd1\u5668\u4e3a\u66f4\u65b0\u8ba1\u6570\u5668 <code>i</code> \u53d8\u91cf\u751f\u6210\u7684\u4ee3\u7801\u5e8f\u5217\uff0c\u4e5f\u5c31\u662f\u8981\u4e86\u89e3\u6c47\u7f16\u6307\u4ee4\u7684\u6267\u884c\u987a\u5e8f\u3002</p> <p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ea\u662f\u60f3\u7ed9 <code>i</code> \u52a0\u4e0a\u6570\u5b57 1\uff0c\u90a3\u4e48\u5b83\u5bf9\u5e94\u7684\u6c47\u7f16\u6307\u4ee4\u6267\u884c\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u53ea\u662f\u5355\u7eaf\u7ed9 <code>i</code> \u52a0\u4e0a\u6570\u5b57 1\uff0c\u5728 CPU \u8fd0\u884c\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u8981\u6267\u884c <code>3</code> \u6761\u6307\u4ee4\u3002</p> <p>\u8bbe\u60f3\u6211\u4eec\u7684\u7ebf\u7a0b 1 \u8fdb\u5165\u8fd9\u4e2a\u4ee3\u7801\u533a\u57df\uff0c\u5b83\u5c06 i \u7684\u503c\uff08\u5047\u8bbe\u6b64\u65f6\u662f 50\uff09\u4ece\u5185\u5b58\u52a0\u8f7d\u5230\u5b83\u7684\u5bc4\u5b58\u5668\u4e2d\uff0c\u7136\u540e\u5b83\u5411\u5bc4\u5b58\u5668\u52a0 1\uff0c\u6b64\u65f6\u5728\u5bc4\u5b58\u5668\u4e2d\u7684 i \u503c\u662f 51\u3002</p> <p>\u73b0\u5728\uff0c\u4e00\u4ef6\u4e0d\u5e78\u7684\u4e8b\u60c5\u53d1\u751f\u4e86\uff1a\u65f6\u949f\u4e2d\u65ad\u53d1\u751f\u3002\u56e0\u6b64\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c06\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u7ebf\u7a0b\u7684\u72b6\u6001\u4fdd\u5b58\u5230\u7ebf\u7a0b\u7684\u7ebf\u7a0b\u63a7\u5236\u5757 TCB\u3002</p> <p>\u73b0\u5728\u66f4\u7cdf\u7684\u4e8b\u60c5\u53d1\u751f\u4e86\uff0c\u7ebf\u7a0b 2 \u88ab\u8c03\u5ea6\u8fd0\u884c\uff0c\u5e76\u8fdb\u5165\u540c\u4e00\u6bb5\u4ee3\u7801\u3002\u5b83\u4e5f\u6267\u884c\u4e86\u7b2c\u4e00\u6761\u6307\u4ee4\uff0c\u4ece\u5185\u5b58\u83b7\u53d6 i \u503c\u5e76\u5c06\u5176\u653e\u5165\u5230\u5bc4\u5b58\u5668\u4e2d\uff0c\u6b64\u65f6\u5185\u5b58\u4e2d i \u7684\u503c\u4ecd\u4e3a 50\uff0c\u56e0\u6b64\u7ebf\u7a0b 2 \u5bc4\u5b58\u5668\u4e2d\u7684 i \u503c\u4e5f\u662f 50\u3002\u5047\u8bbe\u7ebf\u7a0b 2 \u6267\u884c\u63a5\u4e0b\u6765\u7684\u4e24\u6761\u6307\u4ee4\uff0c\u5c06\u5bc4\u5b58\u5668\u4e2d\u7684 i \u503c + 1\uff0c\u7136\u540e\u5c06\u5bc4\u5b58\u5668\u4e2d\u7684 i \u503c\u4fdd\u5b58\u5230\u5185\u5b58\u4e2d\uff0c\u4e8e\u662f\u6b64\u65f6\u5168\u5c40\u53d8\u91cf i \u503c\u662f 51\u3002</p> <p>\u6700\u540e\uff0c\u53c8\u53d1\u751f\u4e00\u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u7ebf\u7a0b 1 \u6062\u590d\u6267\u884c\u3002\u8fd8\u8bb0\u5f97\u5b83\u5df2\u7ecf\u6267\u884c\u4e86\u4e24\u6761\u6c47\u7f16\u6307\u4ee4\uff0c\u73b0\u5728\u51c6\u5907\u6267\u884c\u6700\u540e\u4e00\u6761\u6307\u4ee4\u3002\u56de\u5fc6\u4e00\u4e0b\uff0c\u7ebf\u7a0b 1 \u5bc4\u5b58\u5668\u4e2d\u7684 i \u503c\u662f 51\uff0c\u56e0\u6b64\uff0c\u6267\u884c\u6700\u540e\u4e00\u6761\u6307\u4ee4\u540e\uff0c\u5c06\u503c\u4fdd\u5b58\u5230\u5185\u5b58\uff0c\u5168\u5c40\u53d8\u91cf i \u7684\u503c\u518d\u6b21\u88ab\u8bbe\u7f6e\u4e3a 51\u3002</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u589e\u52a0 i\uff08\u503c\u4e3a 50\uff09\u7684\u4ee3\u7801\u88ab\u8fd0\u884c\u4e24\u6b21\uff0c\u6309\u7406\u6765\u8bf4\uff0c\u6700\u540e\u7684 i \u503c\u5e94\u8be5\u662f 52\uff0c\u4f46\u662f\u7531\u4e8e\u4e0d\u53ef\u63a7\u7684\u8c03\u5ea6\uff0c\u5bfc\u81f4\u6700\u540e i \u503c\u5374\u662f 51\u3002</p> <p>\u9488\u5bf9\u4e0a\u9762\u7ebf\u7a0b 1 \u548c\u7ebf\u7a0b 2 \u7684\u6267\u884c\u8fc7\u7a0b\uff0c\u6211\u753b\u4e86\u4e00\u5f20\u6d41\u7a0b\u56fe\uff0c\u4f1a\u66f4\u660e\u786e\u4e00\u4e9b\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#_2","title":"\u4e92\u65a5\u7684\u6982\u5ff5","text":"<p>\u4e0a\u9762\u5c55\u793a\u7684\u60c5\u51b5\u79f0\u4e3a\u7ade\u4e89\u6761\u4ef6\uff08race condition\uff09\uff0c\u5f53\u591a\u7ebf\u7a0b\u76f8\u4e92\u7ade\u4e89\u64cd\u4f5c\u5171\u4eab\u53d8\u91cf\u65f6\uff0c\u7531\u4e8e\u8fd0\u6c14\u4e0d\u597d\uff0c\u5373\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\u53d1\u751f\u4e86\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u6211\u4eec\u5f97\u5230\u4e86\u9519\u8bef\u7684\u7ed3\u679c\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u6bcf\u6b21\u8fd0\u884c\u90fd\u53ef\u80fd\u5f97\u5230\u4e0d\u540c\u7684\u7ed3\u679c\uff0c\u56e0\u6b64\u8f93\u51fa\u7684\u7ed3\u679c\u5b58\u5728\u4e0d\u786e\u5b9a\u6027\uff08indeterminate\uff09\u3002</p> <p>\u7531\u4e8e\u591a\u7ebf\u7a0b\u6267\u884c\u64cd\u4f5c\u5171\u4eab\u53d8\u91cf\u7684\u8fd9\u6bb5\u4ee3\u7801\u53ef\u80fd\u4f1a\u5bfc\u81f4\u7ade\u4e89\u72b6\u6001\uff0c\u56e0\u6b64\u6211\u4eec\u5c06\u6b64\u6bb5\u4ee3\u7801\u79f0\u4e3a\u4e34\u754c\u533a\uff08critical section\uff09\uff0c\u5b83\u662f\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u4ee3\u7801\u7247\u6bb5\uff0c\u4e00\u5b9a\u4e0d\u80fd\u7ed9\u591a\u7ebf\u7a0b\u540c\u65f6\u6267\u884c\u3002</p> <p>\u6211\u4eec\u5e0c\u671b\u8fd9\u6bb5\u4ee3\u7801\u662f\u4e92\u65a5\uff08mutualexclusion\uff09\u7684\uff0c\u4e5f\u5c31\u8bf4\u4fdd\u8bc1\u4e00\u4e2a\u7ebf\u7a0b\u5728\u4e34\u754c\u533a\u6267\u884c\u65f6\uff0c\u5176\u4ed6\u7ebf\u7a0b\u5e94\u8be5\u88ab\u963b\u6b62\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u8fd9\u6bb5\u4ee3\u7801\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u6700\u591a\u53ea\u80fd\u51fa\u73b0\u4e00\u4e2a\u7ebf\u7a0b\u3002</p> <p></p> <p>\u53e6\u5916\uff0c\u8bf4\u4e00\u4e0b\u4e92\u65a5\u4e5f\u5e76\u4e0d\u662f\u53ea\u9488\u5bf9\u591a\u7ebf\u7a0b\u3002\u5728\u591a\u8fdb\u7a0b\u7ade\u4e89\u5171\u4eab\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u4e5f\u540c\u6837\u662f\u53ef\u4ee5\u4f7f\u7528\u4e92\u65a5\u7684\u65b9\u5f0f\u6765\u907f\u514d\u8d44\u6e90\u7ade\u4e89\u9020\u6210\u7684\u8d44\u6e90\u6df7\u4e71\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#_3","title":"\u540c\u6b65\u7684\u6982\u5ff5","text":"<p>\u4e92\u65a5\u89e3\u51b3\u4e86\u5e76\u53d1\u8fdb\u7a0b/\u7ebf\u7a0b\u5bf9\u4e34\u754c\u533a\u7684\u4f7f\u7528\u95ee\u9898\u3002\u8fd9\u79cd\u57fa\u4e8e\u4e34\u754c\u533a\u63a7\u5236\u7684\u4ea4\u4e92\u4f5c\u7528\u662f\u6bd4\u8f83\u7b80\u5355\u7684\uff0c\u53ea\u8981\u4e00\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u8fdb\u5165\u4e86\u4e34\u754c\u533a\uff0c\u5176\u4ed6\u8bd5\u56fe\u60f3\u8fdb\u5165\u4e34\u754c\u533a\u7684\u8fdb\u7a0b/\u7ebf\u7a0b\u90fd\u4f1a\u88ab\u963b\u585e\u7740\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u79bb\u5f00\u4e86\u4e34\u754c\u533a\u3002</p> <p>\u6211\u4eec\u90fd\u77e5\u9053\u5728\u591a\u7ebf\u7a0b\u91cc\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u5e76\u4e0d\u4e00\u5b9a\u662f\u987a\u5e8f\u6267\u884c\u7684\uff0c\u5b83\u4eec\u57fa\u672c\u662f\u4ee5\u5404\u81ea\u72ec\u7acb\u7684\u3001\u4e0d\u53ef\u9884\u77e5\u7684\u901f\u5ea6\u5411\u524d\u63a8\u8fdb\uff0c\u4f46\u6709\u65f6\u5019\u6211\u4eec\u53c8\u5e0c\u671b\u591a\u4e2a\u7ebf\u7a0b\u80fd\u5bc6\u5207\u5408\u4f5c\uff0c\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u5171\u540c\u7684\u4efb\u52a1\u3002</p> <p>\u4f8b\u5b50\uff0c\u7ebf\u7a0b 1 \u662f\u8d1f\u8d23\u8bfb\u5165\u6570\u636e\u7684\uff0c\u800c\u7ebf\u7a0b 2 \u662f\u8d1f\u8d23\u5904\u7406\u6570\u636e\u7684\uff0c\u8fd9\u4e24\u4e2a\u7ebf\u7a0b\u662f\u76f8\u4e92\u5408\u4f5c\u3001\u76f8\u4e92\u4f9d\u8d56\u7684\u3002\u7ebf\u7a0b 2 \u5728\u6ca1\u6709\u6536\u5230\u7ebf\u7a0b 1 \u7684\u5524\u9192\u901a\u77e5\u65f6\uff0c\u5c31\u4f1a\u4e00\u76f4\u963b\u585e\u7b49\u5f85\uff0c\u5f53\u7ebf\u7a0b 1 \u8bfb\u5b8c\u6570\u636e\u9700\u8981\u628a\u6570\u636e\u4f20\u7ed9\u7ebf\u7a0b 2 \u65f6\uff0c\u7ebf\u7a0b 1 \u4f1a\u5524\u9192\u7ebf\u7a0b 2\uff0c\u5e76\u628a\u6570\u636e\u4ea4\u7ed9\u7ebf\u7a0b 2 \u5904\u7406\u3002</p> <p>\u6240\u8c13\u540c\u6b65\uff0c\u5c31\u662f\u5e76\u53d1\u8fdb\u7a0b/\u7ebf\u7a0b\u5728\u4e00\u4e9b\u5173\u952e\u70b9\u4e0a\u53ef\u80fd\u9700\u8981\u4e92\u76f8\u7b49\u5f85\u4e0e\u4e92\u901a\u6d88\u606f\uff0c\u8fd9\u79cd\u76f8\u4e92\u5236\u7ea6\u7684\u7b49\u5f85\u4e0e\u4e92\u901a\u4fe1\u606f\u79f0\u4e3a\u8fdb\u7a0b/\u7ebf\u7a0b\u540c\u6b65\u3002</p> <p>\u4e3e\u4e2a\u751f\u6d3b\u7684\u540c\u6b65\u4f8b\u5b50\uff0c\u4f60\u809a\u5b50\u997f\u4e86\u60f3\u8981\u5403\u996d\uff0c\u4f60\u53eb\u5988\u5988\u65e9\u70b9\u505a\u83dc\uff0c\u5988\u5988\u542c\u5230\u540e\u5c31\u5f00\u59cb\u505a\u83dc\uff0c\u4f46\u662f\u5728\u5988\u5988\u6ca1\u6709\u505a\u5b8c\u996d\u4e4b\u524d\uff0c\u4f60\u5fc5\u987b\u963b\u585e\u7b49\u5f85\uff0c\u7b49\u5988\u5988\u505a\u5b8c\u996d\u540e\uff0c\u81ea\u7136\u4f1a\u901a\u77e5\u4f60\uff0c\u63a5\u7740\u4f60\u5403\u996d\u7684\u4e8b\u60c5\u5c31\u53ef\u4ee5\u8fdb\u884c\u4e86\u3002</p> <p></p> <p>\u6ce8\u610f\uff0c\u540c\u6b65\u4e0e\u4e92\u65a5\u662f\u4e24\u79cd\u4e0d\u540c\u7684\u6982\u5ff5\uff1a</p> <ul> <li>\u540c\u6b65\u5c31\u597d\u6bd4\uff1a\u300c\u64cd\u4f5c A \u5e94\u5728\u64cd\u4f5c B \u4e4b\u524d\u6267\u884c\u300d\uff0c\u300c\u64cd\u4f5c C \u5fc5\u987b\u5728\u64cd\u4f5c A \u548c\u64cd\u4f5c B \u90fd\u5b8c\u6210\u4e4b\u540e\u624d\u80fd\u6267\u884c\u300d\u7b49\uff1b</li> <li>\u4e92\u65a5\u5c31\u597d\u6bd4\uff1a\u300c\u64cd\u4f5c A \u548c\u64cd\u4f5c B \u4e0d\u80fd\u5728\u540c\u4e00\u65f6\u523b\u6267\u884c\u300d\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#_4","title":"\u4e92\u65a5\u4e0e\u540c\u6b65\u7684\u5b9e\u73b0\u548c\u4f7f\u7528","text":"<p>\u5728\u8fdb\u7a0b/\u7ebf\u7a0b\u5e76\u53d1\u6267\u884c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fdb\u7a0b/\u7ebf\u7a0b\u4e4b\u95f4\u5b58\u5728\u534f\u4f5c\u7684\u5173\u7cfb\uff0c\u4f8b\u5982\u6709\u4e92\u65a5\u3001\u540c\u6b65\u7684\u5173\u7cfb\u3002</p> <p>\u4e3a\u4e86\u5b9e\u73b0\u8fdb\u7a0b/\u7ebf\u7a0b\u95f4\u6b63\u786e\u7684\u534f\u4f5c\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5fc5\u987b\u63d0\u4f9b\u5b9e\u73b0\u8fdb\u7a0b\u534f\u4f5c\u7684\u63aa\u65bd\u548c\u65b9\u6cd5\uff0c\u4e3b\u8981\u7684\u65b9\u6cd5\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u9501\uff1a\u52a0\u9501\u3001\u89e3\u9501\u64cd\u4f5c\uff1b</li> <li>\u4fe1\u53f7\u91cf\uff1aP\u3001V \u64cd\u4f5c\uff1b</li> </ul> <p>\u8fd9\u4e24\u4e2a\u90fd\u53ef\u4ee5\u65b9\u4fbf\u5730\u5b9e\u73b0\u8fdb\u7a0b/\u7ebf\u7a0b\u4e92\u65a5\uff0c\u800c\u4fe1\u53f7\u91cf\u6bd4\u9501\u7684\u529f\u80fd\u66f4\u5f3a\u4e00\u4e9b\uff0c\u5b83\u8fd8\u53ef\u4ee5\u65b9\u4fbf\u5730\u5b9e\u73b0\u8fdb\u7a0b/\u7ebf\u7a0b\u540c\u6b65\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#_5","title":"\u9501","text":"<p>\u4f7f\u7528\u52a0\u9501\u64cd\u4f5c\u548c\u89e3\u9501\u64cd\u4f5c\u53ef\u4ee5\u89e3\u51b3\u5e76\u53d1\u7ebf\u7a0b/\u8fdb\u7a0b\u7684\u4e92\u65a5\u95ee\u9898\u3002</p> <p>\u4efb\u4f55\u60f3\u8fdb\u5165\u4e34\u754c\u533a\u7684\u7ebf\u7a0b\uff0c\u5fc5\u987b\u5148\u6267\u884c\u52a0\u9501\u64cd\u4f5c\u3002\u82e5\u52a0\u9501\u64cd\u4f5c\u987a\u5229\u901a\u8fc7\uff0c\u5219\u7ebf\u7a0b\u53ef\u8fdb\u5165\u4e34\u754c\u533a\uff1b\u5728\u5b8c\u6210\u5bf9\u4e34\u754c\u8d44\u6e90\u7684\u8bbf\u95ee\u540e\u518d\u6267\u884c\u89e3\u9501\u64cd\u4f5c\uff0c\u4ee5\u91ca\u653e\u8be5\u4e34\u754c\u8d44\u6e90\u3002</p> <p></p> <p>\u6839\u636e\u9501\u7684\u5b9e\u73b0\u4e0d\u540c\uff0c\u53ef\u4ee5\u5206\u4e3a\u300c\u5fd9\u7b49\u5f85\u9501\u300d\u548c\u300c\u65e0\u5fd9\u7b49\u5f85\u9501\u300d\u3002</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b\u300c\u5fd9\u7b49\u5f85\u9501\u300d\u7684\u5b9e\u73b0</p> <p>\u5728\u8bf4\u660e\u300c\u5fd9\u7b49\u5f85\u9501\u300d\u7684\u5b9e\u73b0\u4e4b\u524d\uff0c\u5148\u4ecb\u7ecd\u73b0\u4ee3 CPU \u4f53\u7cfb\u7ed3\u6784\u63d0\u4f9b\u7684\u7279\u6b8a\u539f\u5b50\u64cd\u4f5c\u6307\u4ee4 \u2014\u2014 \u6d4b\u8bd5\u548c\u7f6e\u4f4d\uff08Test-and-Set\uff09\u6307\u4ee4\u3002</p> <p>\u5982\u679c\u7528 C \u4ee3\u7801\u8868\u793a Test-and-Set \u6307\u4ee4\uff0c\u5f62\u5f0f\u5982\u4e0b\uff1a</p> <p></p> <p>\u6d4b\u8bd5\u5e76\u8bbe\u7f6e\u6307\u4ee4\u505a\u4e86\u4e0b\u8ff0\u4e8b\u60c5\uff1a</p> <ul> <li>\u628a <code>old_ptr</code> \u66f4\u65b0\u4e3a <code>new</code> \u7684\u65b0\u503c</li> <li>\u8fd4\u56de <code>old_ptr</code> \u7684\u65e7\u503c\uff1b</li> </ul> <p>\u5f53\u7136\uff0c\u5173\u952e\u662f\u8fd9\u4e9b\u4ee3\u7801\u662f\u539f\u5b50\u6267\u884c\u3002\u56e0\u4e3a\u65e2\u53ef\u4ee5\u6d4b\u8bd5\u65e7\u503c\uff0c\u53c8\u53ef\u4ee5\u8bbe\u7f6e\u65b0\u503c\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u8fd9\u6761\u6307\u4ee4\u53eb\u4f5c\u300c\u6d4b\u8bd5\u5e76\u8bbe\u7f6e\u300d\u3002</p> <p>\u90a3\u4ec0\u4e48\u662f\u539f\u5b50\u64cd\u4f5c\u5462\uff1f\u539f\u5b50\u64cd\u4f5c\u5c31\u662f\u8981\u4e48\u5168\u90e8\u6267\u884c\uff0c\u8981\u4e48\u90fd\u4e0d\u6267\u884c\uff0c\u4e0d\u80fd\u51fa\u73b0\u6267\u884c\u5230\u4e00\u534a\u7684\u4e2d\u95f4\u72b6\u6001</p> <p>\u6211\u4eec\u53ef\u4ee5\u8fd0\u7528 Test-and-Set \u6307\u4ee4\u6765\u5b9e\u73b0\u300c\u5fd9\u7b49\u5f85\u9501\u300d\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p></p> <p>\u6211\u4eec\u6765\u786e\u4fdd\u7406\u89e3\u4e3a\u4ec0\u4e48\u8fd9\u4e2a\u9501\u80fd\u5de5\u4f5c\uff1a</p> <ul> <li> <p>\u7b2c\u4e00\u4e2a\u573a\u666f\u662f\uff0c\u9996\u5148\u5047\u8bbe\u4e00\u4e2a\u7ebf\u7a0b\u5728\u8fd0\u884c\uff0c\u8c03\u7528 <code>lock()</code>\uff0c\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u6301\u6709\u9501\uff0c\u6240\u4ee5 <code>flag</code> \u662f 0\u3002\u5f53\u8c03\u7528 <code>TestAndSet(flag, 1)</code> \u65b9\u6cd5\uff0c\u8fd4\u56de 0\uff0c\u7ebf\u7a0b\u4f1a\u8df3\u51fa while \u5faa\u73af\uff0c\u83b7\u53d6\u9501\u3002\u540c\u65f6\u4e5f\u4f1a\u539f\u5b50\u7684\u8bbe\u7f6e flag \u4e3a 1\uff0c\u6807\u5fd7\u9501\u5df2\u7ecf\u88ab\u6301\u6709\u3002\u5f53\u7ebf\u7a0b\u79bb\u5f00\u4e34\u754c\u533a\uff0c\u8c03\u7528 <code>unlock()</code> \u5c06 <code>flag</code> \u6e05\u7406\u4e3a 0\u3002</p> </li> <li> <p>\u7b2c\u4e8c\u79cd\u573a\u666f\u662f\uff0c\u5f53\u67d0\u4e00\u4e2a\u7ebf\u7a0b\u5df2\u7ecf\u6301\u6709\u9501\uff08\u5373 <code>flag</code> \u4e3a 1\uff09\u3002\u672c\u7ebf\u7a0b\u8c03\u7528 <code>lock()</code>\uff0c\u7136\u540e\u8c03\u7528 <code>TestAndSet(flag, 1)</code>\uff0c\u8fd9\u4e00\u6b21\u8fd4\u56de 1\u3002\u53ea\u8981\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u4e00\u76f4\u6301\u6709\u9501\uff0c<code>TestAndSet()</code> \u4f1a\u91cd\u590d\u8fd4\u56de 1\uff0c\u672c\u7ebf\u7a0b\u4f1a\u4e00\u76f4\u5fd9\u7b49\u3002\u5f53 <code>flag</code> \u7ec8\u4e8e\u88ab\u6539\u4e3a 0\uff0c\u672c\u7ebf\u7a0b\u4f1a\u8c03\u7528 <code>TestAndSet()</code>\uff0c\u8fd4\u56de 0 \u5e76\u4e14\u539f\u5b50\u5730\u8bbe\u7f6e\u4e3a 1\uff0c\u4ece\u800c\u83b7\u5f97\u9501\uff0c\u8fdb\u5165\u4e34\u754c\u533a\u3002</p> </li> </ul> <p>\u5f88\u660e\u663e\uff0c\u5f53\u83b7\u53d6\u4e0d\u5230\u9501\u65f6\uff0c\u7ebf\u7a0b\u5c31\u4f1a\u4e00\u76f4 while \u5faa\u73af\uff0c\u4e0d\u505a\u4efb\u4f55\u4e8b\u60c5\uff0c\u6240\u4ee5\u5c31\u88ab\u79f0\u4e3a\u300c\u5fd9\u7b49\u5f85\u9501\u300d\uff0c\u4e5f\u88ab\u79f0\u4e3a\u81ea\u65cb\u9501\uff08spin lock\uff09\u3002</p> <p>\u8fd9\u662f\u6700\u7b80\u5355\u7684\u4e00\u79cd\u9501\uff0c\u4e00\u76f4\u81ea\u65cb\uff0c\u5229\u7528 CPU \u5468\u671f\uff0c\u76f4\u5230\u9501\u53ef\u7528\u3002\u5728\u5355\u5904\u7406\u5668\u4e0a\uff0c\u9700\u8981\u62a2\u5360\u5f0f\u7684\u8c03\u5ea6\u5668\uff08\u5373\u4e0d\u65ad\u901a\u8fc7\u65f6\u949f\u4e2d\u65ad\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u8fd0\u884c\u5176\u4ed6\u7ebf\u7a0b\uff09\u3002\u5426\u5219\uff0c\u81ea\u65cb\u9501\u5728\u5355 CPU \u4e0a\u65e0\u6cd5\u4f7f\u7528\uff0c\u56e0\u4e3a\u4e00\u4e2a\u81ea\u65cb\u7684\u7ebf\u7a0b\u6c38\u8fdc\u4e0d\u4f1a\u653e\u5f03 CPU\u3002</p> <p>\u518d\u6765\u770b\u770b\u300c\u65e0\u7b49\u5f85\u9501\u300d\u7684\u5b9e\u73b0</p> <p>\u65e0\u7b49\u5f85\u9501\u987e\u660e\u601d\u8bae\u5c31\u662f\u83b7\u53d6\u4e0d\u5230\u9501\u7684\u65f6\u5019\uff0c\u4e0d\u7528\u81ea\u65cb\u3002</p> <p>\u65e2\u7136\u4e0d\u60f3\u81ea\u65cb\uff0c\u90a3\u5f53\u6ca1\u83b7\u53d6\u5230\u9501\u7684\u65f6\u5019\uff0c\u5c31\u628a\u5f53\u524d\u7ebf\u7a0b\u653e\u5165\u5230\u9501\u7684\u7b49\u5f85\u961f\u5217\uff0c\u7136\u540e\u6267\u884c\u8c03\u5ea6\u7a0b\u5e8f\uff0c\u628a CPU \u8ba9\u7ed9\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u3002</p> <p></p> <p>\u672c\u6b21\u53ea\u662f\u63d0\u51fa\u4e86\u4e24\u79cd\u7b80\u5355\u9501\u7684\u5b9e\u73b0\u65b9\u5f0f\u3002\u5f53\u7136\uff0c\u5728\u5177\u4f53\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u4e2d\uff0c\u4f1a\u66f4\u590d\u6742\uff0c\u4f46\u4e5f\u79bb\u4e0d\u5f00\u672c\u4f8b\u5b50\u4e24\u4e2a\u57fa\u672c\u5143\u7d20\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u8981\u5bf9\u9501\u7684\u66f4\u8fdb\u4e00\u6b65\u7406\u89e3\uff0c\u63a8\u8350\u5927\u5bb6\u53ef\u4ee5\u770b\u300a\u64cd\u4f5c\u7cfb\u7edf\u5bfc\u8bba\u300b\u7b2c 28 \u7ae0\u9501\u7684\u5185\u5bb9\uff0c\u8fd9\u672c\u4e66\u5728\u300c\u5fae\u4fe1\u8bfb\u4e66\u300d\u5c31\u53ef\u4ee5\u514d\u8d39\u770b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#_6","title":"\u4fe1\u53f7\u91cf","text":"<p>\u4fe1\u53f7\u91cf\u662f\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u4e00\u79cd\u534f\u8c03\u5171\u4eab\u8d44\u6e90\u8bbf\u95ee\u7684\u65b9\u6cd5\u3002</p> <p>\u901a\u5e38\u4fe1\u53f7\u91cf\u8868\u793a\u8d44\u6e90\u7684\u6570\u91cf\uff0c\u5bf9\u5e94\u7684\u53d8\u91cf\u662f\u4e00\u4e2a\u6574\u578b\uff08<code>sem</code>\uff09\u53d8\u91cf\u3002</p> <p>\u53e6\u5916\uff0c\u8fd8\u6709\u4e24\u4e2a\u539f\u5b50\u64cd\u4f5c\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u6765\u63a7\u5236\u4fe1\u53f7\u91cf\u7684\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>P \u64cd\u4f5c\uff1a\u5c06 <code>sem</code> \u51cf <code>1</code>\uff0c\u76f8\u51cf\u540e\uff0c\u5982\u679c <code>sem &lt; 0</code>\uff0c\u5219\u8fdb\u7a0b/\u7ebf\u7a0b\u8fdb\u5165\u963b\u585e\u7b49\u5f85\uff0c\u5426\u5219\u7ee7\u7eed\uff0c\u8868\u660e P \u64cd\u4f5c\u53ef\u80fd\u4f1a\u963b\u585e\uff1b</li> <li>V \u64cd\u4f5c\uff1a\u5c06 <code>sem</code> \u52a0 <code>1</code>\uff0c\u76f8\u52a0\u540e\uff0c\u5982\u679c <code>sem &lt;= 0</code>\uff0c\u5524\u9192\u4e00\u4e2a\u7b49\u5f85\u4e2d\u7684\u8fdb\u7a0b/\u7ebf\u7a0b\uff0c\u8868\u660e V \u64cd\u4f5c\u4e0d\u4f1a\u963b\u585e\uff1b</li> </ul> <p>P \u64cd\u4f5c\u662f\u7528\u5728\u8fdb\u5165\u4e34\u754c\u533a\u4e4b\u524d\uff0cV \u64cd\u4f5c\u662f\u7528\u5728\u79bb\u5f00\u4e34\u754c\u533a\u4e4b\u540e\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u662f\u5fc5\u987b\u6210\u5bf9\u51fa\u73b0\u7684\u3002</p> <p>\u4e3e\u4e2a\u7c7b\u6bd4\uff0c2 \u4e2a\u8d44\u6e90\u7684\u4fe1\u53f7\u91cf\uff0c\u76f8\u5f53\u4e8e 2 \u6761\u706b\u8f66\u8f68\u9053\uff0cPV \u64cd\u4f5c\u5982\u4e0b\u56fe\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u64cd\u4f5c\u7cfb\u7edf\u662f\u5982\u4f55\u5b9e\u73b0 PV \u64cd\u4f5c\u7684\u5462\uff1f</p> <p>\u4fe1\u53f7\u91cf\u6570\u636e\u7ed3\u6784\u4e0e PV \u64cd\u4f5c\u7684\u7b97\u6cd5\u63cf\u8ff0\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>PV \u64cd\u4f5c\u7684\u51fd\u6570\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u548c\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5\u64cd\u4f5c\u7cfb\u7edf\u5df2\u7ecf\u4f7f\u5f97\u6267\u884c PV \u51fd\u6570\u65f6\u662f\u5177\u6709\u539f\u5b50\u6027\u7684\u3002</p> <p>PV \u64cd\u4f5c\u5982\u4f55\u4f7f\u7528\u7684\u5462\uff1f</p> <p>\u4fe1\u53f7\u91cf\u4e0d\u4ec5\u53ef\u4ee5\u5b9e\u73b0\u4e34\u754c\u533a\u7684\u4e92\u65a5\u8bbf\u95ee\u63a7\u5236\uff0c\u8fd8\u53ef\u4ee5\u7ebf\u7a0b\u95f4\u7684\u4e8b\u4ef6\u540c\u6b65\u3002</p> <p>\u6211\u4eec\u5148\u6765\u8bf4\u8bf4\u5982\u4f55\u4f7f\u7528\u4fe1\u53f7\u91cf\u5b9e\u73b0\u4e34\u754c\u533a\u7684\u4e92\u65a5\u8bbf\u95ee\u3002</p> <p>\u4e3a\u6bcf\u7c7b\u5171\u4eab\u8d44\u6e90\u8bbe\u7f6e\u4e00\u4e2a\u4fe1\u53f7\u91cf <code>s</code>\uff0c\u5176\u521d\u503c\u4e3a <code>1</code>\uff0c\u8868\u793a\u8be5\u4e34\u754c\u8d44\u6e90\u672a\u88ab\u5360\u7528\u3002</p> <p>\u53ea\u8981\u628a\u8fdb\u5165\u4e34\u754c\u533a\u7684\u64cd\u4f5c\u7f6e\u4e8e <code>P(s)</code> \u548c <code>V(s)</code> \u4e4b\u95f4\uff0c\u5373\u53ef\u5b9e\u73b0\u8fdb\u7a0b/\u7ebf\u7a0b\u4e92\u65a5\uff1a</p> <p></p> <p>\u6b64\u65f6\uff0c\u4efb\u4f55\u60f3\u8fdb\u5165\u4e34\u754c\u533a\u7684\u7ebf\u7a0b\uff0c\u5fc5\u5148\u5728\u4e92\u65a5\u4fe1\u53f7\u91cf\u4e0a\u6267\u884c P \u64cd\u4f5c\uff0c\u5728\u5b8c\u6210\u5bf9\u4e34\u754c\u8d44\u6e90\u7684\u8bbf\u95ee\u540e\u518d\u6267\u884c V \u64cd\u4f5c\u3002\u7531\u4e8e\u4e92\u65a5\u4fe1\u53f7\u91cf\u7684\u521d\u59cb\u503c\u4e3a 1\uff0c\u6545\u5728\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c P \u64cd\u4f5c\u540e s \u503c\u53d8\u4e3a 0\uff0c\u8868\u793a\u4e34\u754c\u8d44\u6e90\u4e3a\u7a7a\u95f2\uff0c\u53ef\u5206\u914d\u7ed9\u8be5\u7ebf\u7a0b\uff0c\u4f7f\u4e4b\u8fdb\u5165\u4e34\u754c\u533a\u3002</p> <p>\u82e5\u6b64\u65f6\u53c8\u6709\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u60f3\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u4e5f\u5e94\u5148\u6267\u884c P \u64cd\u4f5c\uff0c\u7ed3\u679c\u4f7f s \u53d8\u4e3a\u8d1f\u503c\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u4e34\u754c\u8d44\u6e90\u5df2\u88ab\u5360\u7528\uff0c\u56e0\u6b64\uff0c\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\u88ab\u963b\u585e\u3002</p> <p>\u5e76\u4e14\uff0c\u76f4\u5230\u7b2c\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c V \u64cd\u4f5c\uff0c\u91ca\u653e\u4e34\u754c\u8d44\u6e90\u800c\u6062\u590d s \u503c\u4e3a 0 \u540e\uff0c\u624d\u5524\u9192\u7b2c\u4e8c\u4e2a\u7ebf\u7a0b\uff0c\u4f7f\u4e4b\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u5f85\u5b83\u5b8c\u6210\u4e34\u754c\u8d44\u6e90\u7684\u8bbf\u95ee\u540e\uff0c\u53c8\u6267\u884c V \u64cd\u4f5c\uff0c\u4f7f s \u6062\u590d\u5230\u521d\u59cb\u503c 1\u3002</p> <p>\u5bf9\u4e8e\u4e24\u4e2a\u5e76\u53d1\u7ebf\u7a0b\uff0c\u4e92\u65a5\u4fe1\u53f7\u91cf\u7684\u503c\u4ec5\u53d6 1\u30010 \u548c -1 \u4e09\u4e2a\u503c\uff0c\u5206\u522b\u8868\u793a\uff1a</p> <ul> <li>\u5982\u679c\u4e92\u65a5\u4fe1\u53f7\u91cf\u4e3a 1\uff0c\u8868\u793a\u6ca1\u6709\u7ebf\u7a0b\u8fdb\u5165\u4e34\u754c\u533a\uff1b</li> <li>\u5982\u679c\u4e92\u65a5\u4fe1\u53f7\u91cf\u4e3a 0\uff0c\u8868\u793a\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u4e34\u754c\u533a\uff1b</li> <li>\u5982\u679c\u4e92\u65a5\u4fe1\u53f7\u91cf\u4e3a -1\uff0c\u8868\u793a\u4e00\u4e2a\u7ebf\u7a0b\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u7b49\u5f85\u8fdb\u5165\u3002</li> </ul> <p>\u901a\u8fc7\u4e92\u65a5\u4fe1\u53f7\u91cf\u7684\u65b9\u5f0f\uff0c\u5c31\u80fd\u4fdd\u8bc1\u4e34\u754c\u533a\u4efb\u4f55\u65f6\u523b\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5728\u6267\u884c\uff0c\u5c31\u8fbe\u5230\u4e86\u4e92\u65a5\u7684\u6548\u679c\u3002</p> <p>\u518d\u6765\uff0c\u6211\u4eec\u8bf4\u8bf4\u5982\u4f55\u4f7f\u7528\u4fe1\u53f7\u91cf\u5b9e\u73b0\u4e8b\u4ef6\u540c\u6b65\u3002</p> <p>\u540c\u6b65\u7684\u65b9\u5f0f\u662f\u8bbe\u7f6e\u4e00\u4e2a\u4fe1\u53f7\u91cf\uff0c\u5176\u521d\u503c\u4e3a <code>0</code>\u3002</p> <p>\u6211\u4eec\u628a\u524d\u9762\u7684\u300c\u5403\u996d - \u505a\u996d\u300d\u540c\u6b65\u7684\u4f8b\u5b50\uff0c\u7528\u4ee3\u7801\u7684\u65b9\u5f0f\u5b9e\u73b0\u4e00\u4e0b\uff1a</p> <p></p> <p>\u5988\u5988\u4e00\u5f00\u59cb\u8be2\u95ee\u513f\u5b50\u8981\u4e0d\u8981\u505a\u996d\u65f6\uff0c\u6267\u884c\u7684\u662f <code>P(s1)</code> \uff0c\u76f8\u5f53\u4e8e\u8be2\u95ee\u513f\u5b50\u9700\u4e0d\u9700\u8981\u5403\u996d\uff0c\u7531\u4e8e <code>s1</code> \u521d\u59cb\u503c\u4e3a 0\uff0c\u6b64\u65f6 <code>s1</code> \u53d8\u6210 -1\uff0c\u8868\u660e\u513f\u5b50\u4e0d\u9700\u8981\u5403\u996d\uff0c\u6240\u4ee5\u5988\u5988\u7ebf\u7a0b\u5c31\u8fdb\u5165\u7b49\u5f85\u72b6\u6001\u3002</p> <p>\u5f53\u513f\u5b50\u809a\u5b50\u997f\u65f6\uff0c\u6267\u884c\u4e86 <code>V(s1)</code>\uff0c\u4f7f\u5f97 <code>s1</code> \u4fe1\u53f7\u91cf\u4ece -1 \u53d8\u6210 0\uff0c\u8868\u660e\u6b64\u65f6\u513f\u5b50\u9700\u8981\u5403\u996d\u4e86\uff0c\u4e8e\u662f\u5c31\u5524\u9192\u4e86\u963b\u585e\u4e2d\u7684\u5988\u5988\u7ebf\u7a0b\uff0c\u5988\u5988\u7ebf\u7a0b\u5c31\u5f00\u59cb\u505a\u996d\u3002</p> <p>\u63a5\u7740\uff0c\u513f\u5b50\u7ebf\u7a0b\u6267\u884c\u4e86 <code>P(s2)</code>\uff0c\u76f8\u5f53\u4e8e\u8be2\u95ee\u5988\u5988\u996d\u505a\u5b8c\u4e86\u5417\uff0c\u7531\u4e8e <code>s2</code> \u521d\u59cb\u503c\u662f 0\uff0c\u5219\u6b64\u65f6 <code>s2</code> \u53d8\u6210 -1\uff0c\u8bf4\u660e\u5988\u5988\u8fd8\u6ca1\u505a\u5b8c\u996d\uff0c\u513f\u5b50\u7ebf\u7a0b\u5c31\u7b49\u5f85\u72b6\u6001\u3002</p> <p>\u6700\u540e\uff0c\u5988\u5988\u7ec8\u4e8e\u505a\u5b8c\u996d\u4e86\uff0c\u4e8e\u662f\u6267\u884c <code>V(s2)</code>\uff0c<code>s2</code> \u4fe1\u53f7\u91cf\u4ece -1 \u53d8\u56de\u4e86 0\uff0c\u4e8e\u662f\u5c31\u5524\u9192\u7b49\u5f85\u4e2d\u7684\u513f\u5b50\u7ebf\u7a0b\uff0c\u5524\u9192\u540e\uff0c\u513f\u5b50\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u8fdb\u884c\u5403\u996d\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#-","title":"\u751f\u4ea7\u8005 - \u6d88\u8d39\u8005\u95ee\u9898","text":"<p>\u751f\u4ea7\u8005 - \u6d88\u8d39\u8005\u95ee\u9898\u63cf\u8ff0\uff1a</p> <ul> <li>\u751f\u4ea7\u8005\u5728\u751f\u6210\u6570\u636e\u540e\uff0c\u653e\u5728\u4e00\u4e2a\u7f13\u51b2\u533a\u4e2d\uff1b</li> <li>\u6d88\u8d39\u8005\u4ece\u7f13\u51b2\u533a\u53d6\u51fa\u6570\u636e\u5904\u7406\uff1b</li> <li>\u4efb\u4f55\u65f6\u523b\uff0c\u53ea\u80fd\u6709\u4e00\u4e2a\u751f\u4ea7\u8005\u6216\u6d88\u8d39\u8005\u53ef\u4ee5\u8bbf\u95ee\u7f13\u51b2\u533a\uff1b</li> </ul> <p>\u6211\u4eec\u5bf9\u95ee\u9898\u5206\u6790\u53ef\u4ee5\u5f97\u51fa\uff1a</p> <ul> <li>\u4efb\u4f55\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u64cd\u4f5c\u7f13\u51b2\u533a\uff0c\u8bf4\u660e\u64cd\u4f5c\u7f13\u51b2\u533a\u662f\u4e34\u754c\u4ee3\u7801\uff0c\u9700\u8981\u4e92\u65a5\uff1b</li> <li>\u7f13\u51b2\u533a\u7a7a\u65f6\uff0c\u6d88\u8d39\u8005\u5fc5\u987b\u7b49\u5f85\u751f\u4ea7\u8005\u751f\u6210\u6570\u636e\uff1b\u7f13\u51b2\u533a\u6ee1\u65f6\uff0c\u751f\u4ea7\u8005\u5fc5\u987b\u7b49\u5f85\u6d88\u8d39\u8005\u53d6\u51fa\u6570\u636e\u3002\u8bf4\u660e\u751f\u4ea7\u8005\u548c\u6d88\u8d39\u8005\u9700\u8981\u540c\u6b65\u3002</li> </ul> <p>\u90a3\u4e48\u6211\u4eec\u9700\u8981\u4e09\u4e2a\u4fe1\u53f7\u91cf\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u4e92\u65a5\u4fe1\u53f7\u91cf <code>mutex</code>\uff1a\u7528\u4e8e\u4e92\u65a5\u8bbf\u95ee\u7f13\u51b2\u533a\uff0c\u521d\u59cb\u5316\u503c\u4e3a 1\uff1b</li> <li>\u8d44\u6e90\u4fe1\u53f7\u91cf <code>fullBuffers</code>\uff1a\u7528\u4e8e\u6d88\u8d39\u8005\u8be2\u95ee\u7f13\u51b2\u533a\u662f\u5426\u6709\u6570\u636e\uff0c\u6709\u6570\u636e\u5219\u8bfb\u53d6\u6570\u636e\uff0c\u521d\u59cb\u5316\u503c\u4e3a 0\uff08\u8868\u660e\u7f13\u51b2\u533a\u4e00\u5f00\u59cb\u4e3a\u7a7a\uff09\uff1b</li> <li>\u8d44\u6e90\u4fe1\u53f7\u91cf <code>emptyBuffers</code>\uff1a\u7528\u4e8e\u751f\u4ea7\u8005\u8be2\u95ee\u7f13\u51b2\u533a\u662f\u5426\u6709\u7a7a\u4f4d\uff0c\u6709\u7a7a\u4f4d\u5219\u751f\u6210\u6570\u636e\uff0c\u521d\u59cb\u5316\u503c\u4e3a n\uff08\u7f13\u51b2\u533a\u5927\u5c0f\uff09\uff1b</li> </ul> <p>\u5177\u4f53\u7684\u5b9e\u73b0\u4ee3\u7801\uff1a</p> <p></p> <p>\u5982\u679c\u6d88\u8d39\u8005\u7ebf\u7a0b\u4e00\u5f00\u59cb\u6267\u884c <code>P(fullBuffers)</code>\uff0c\u7531\u4e8e\u4fe1\u53f7\u91cf <code>fullBuffers</code> \u521d\u59cb\u503c\u4e3a 0\uff0c\u5219\u6b64\u65f6 <code>fullBuffers</code> \u7684\u503c\u4ece 0 \u53d8\u4e3a -1\uff0c\u8bf4\u660e\u7f13\u51b2\u533a\u91cc\u6ca1\u6709\u6570\u636e\uff0c\u6d88\u8d39\u8005\u53ea\u80fd\u7b49\u5f85\u3002</p> <p>\u63a5\u7740\uff0c\u8f6e\u5230\u751f\u4ea7\u8005\u6267\u884c <code>P(emptyBuffers)</code>\uff0c\u8868\u793a\u51cf\u5c11 1 \u4e2a\u7a7a\u69fd\uff0c\u5982\u679c\u5f53\u524d\u6ca1\u6709\u5176\u4ed6\u751f\u4ea7\u8005\u7ebf\u7a0b\u5728\u4e34\u754c\u533a\u6267\u884c\u4ee3\u7801\uff0c\u90a3\u4e48\u8be5\u751f\u4ea7\u8005\u7ebf\u7a0b\u5c31\u53ef\u4ee5\u628a\u6570\u636e\u653e\u5230\u7f13\u51b2\u533a\uff0c\u653e\u5b8c\u540e\uff0c\u6267\u884c <code>V(fullBuffers)</code> \uff0c\u4fe1\u53f7\u91cf <code>fullBuffers</code> \u4ece -1 \u53d8\u6210 0\uff0c\u8868\u660e\u6709\u300c\u6d88\u8d39\u8005\u300d\u7ebf\u7a0b\u6b63\u5728\u963b\u585e\u7b49\u5f85\u6570\u636e\uff0c\u4e8e\u662f\u963b\u585e\u7b49\u5f85\u7684\u6d88\u8d39\u8005\u7ebf\u7a0b\u4f1a\u88ab\u5524\u9192\u3002</p> <p>\u6d88\u8d39\u8005\u7ebf\u7a0b\u88ab\u5524\u9192\u540e\uff0c\u5982\u679c\u6b64\u65f6\u6ca1\u6709\u5176\u4ed6\u6d88\u8d39\u8005\u7ebf\u7a0b\u5728\u8bfb\u6570\u636e\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u76f4\u63a5\u8fdb\u5165\u4e34\u754c\u533a\uff0c\u4ece\u7f13\u51b2\u533a\u8bfb\u53d6\u6570\u636e\u3002\u6700\u540e\uff0c\u79bb\u5f00\u4e34\u754c\u533a\u540e\uff0c\u628a\u7a7a\u69fd\u7684\u4e2a\u6570 + 1\u3002 </p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#_7","title":"\u7ecf\u5178\u540c\u6b65\u95ee\u9898","text":""},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#_8","title":"\u54f2\u5b66\u5bb6\u5c31\u9910\u95ee\u9898","text":"<p>\u5f53\u521d\u6211\u5728\u6821\u62db\u7684\u65f6\u5019\uff0c\u9762\u8bd5\u5b98\u4e5f\u95ee\u8fc7\u300c\u54f2\u5b66\u5bb6\u5c31\u9910\u300d\u8fd9\u9053\u9898\u76ee\uff0c\u6211\u5f53\u65f6\u542c\u7684\u4e00\u8138\u61f5\u903c\uff0c\u65e0\u8bba\u9762\u8bd5\u5b98\u600e\u4e48\u8bb2\u8ff0\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4e5f\u59cb\u7ec8\u6ca1\u542c\u61c2\uff0c\u5c31\u83ab\u540d\u5176\u5999\u7684\u8bf4\u8fd9\u4e2a\u95ee\u9898\u4f1a\u300c\u6b7b\u9501\u300d\u3002</p> <p>\u5f53\u7136\uff0c\u6211\u8fd9\u56de\u7b54\u69fd\u900f\u4e86\uff0c\u6240\u4ee5\u5f53\u573a game over\uff0c\u6b8b\u9177\u53c8\u60b2\u60e8\u6545\u4e8b\uff0c\u5c31\u4e0d\u591a\u8bf4\u4e86\uff0c\u53cd\u6b63\u5f53\u65f6\u83dc\u5c31\u662f\u83dc\u3002</p> <p></p> <p>\u65f6\u81f3\u4eca\u65e5\uff0c\u770b\u6211\u6765\u56fe\u89e3\u8fd9\u9053\u9898\u3002</p> <p></p> <p>\u5148\u6765\u770b\u770b\u54f2\u5b66\u5bb6\u5c31\u9910\u7684\u95ee\u9898\u63cf\u8ff0\uff1a</p> <ul> <li><code>5</code> \u4e2a\u8001\u5927\u54e5\u54f2\u5b66\u5bb6\uff0c\u95f2\u7740\u6ca1\u4e8b\u505a\uff0c\u56f4\u7ed5\u7740\u4e00\u5f20\u5706\u684c\u5403\u9762\uff1b</li> <li>\u5de7\u5c31\u5de7\u5728\uff0c\u8fd9\u4e2a\u684c\u5b50\u53ea\u6709 <code>5</code> \u652f\u53c9\u5b50\uff0c\u6bcf\u4e24\u4e2a\u54f2\u5b66\u5bb6\u4e4b\u95f4\u653e\u4e00\u652f\u53c9\u5b50\uff1b</li> <li>\u54f2\u5b66\u5bb6\u56f4\u5728\u4e00\u8d77\u5148\u601d\u8003\uff0c\u601d\u8003\u4e2d\u9014\u997f\u4e86\u5c31\u4f1a\u60f3\u8fdb\u9910\uff1b</li> <li>\u5947\u8469\u7684\u662f\uff0c\u8fd9\u4e9b\u54f2\u5b66\u5bb6\u8981\u4e24\u652f\u53c9\u5b50\u624d\u613f\u610f\u5403\u9762\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u62ff\u5230\u5de6\u53f3\u4e24\u8fb9\u7684\u53c9\u5b50\u624d\u8fdb\u9910\uff1b</li> <li>\u5403\u5b8c\u540e\uff0c\u4f1a\u628a\u4e24\u652f\u53c9\u5b50\u653e\u56de\u539f\u5904\uff0c\u7ee7\u7eed\u601d\u8003\uff1b</li> </ul> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u5982\u4f55\u4fdd\u8bc1\u54f2    \u5b66\u5bb6\u4eec\u7684\u52a8\u4f5c\u6709\u5e8f\u8fdb\u884c\uff0c\u800c\u4e0d\u4f1a\u51fa\u73b0\u6709\u4eba\u6c38\u8fdc\u62ff\u4e0d\u5230\u53c9\u5b50\u5462\uff1f</p> <p>\u65b9\u6848\u4e00</p> <p>\u6211\u4eec\u7528\u4fe1\u53f7\u91cf\u7684\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f PV \u64cd\u4f5c\u6765\u5c1d\u8bd5\u89e3\u51b3\u5b83\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e0a\u9762\u7684\u7a0b\u5e8f\uff0c\u597d\u4f3c\u5f88\u81ea\u7136\u3002\u62ff\u8d77\u53c9\u5b50\u7528 P \u64cd\u4f5c\uff0c\u4ee3\u8868\u6709\u53c9\u5b50\u5c31\u76f4\u63a5\u7528\uff0c\u6ca1\u6709\u53c9\u5b50\u65f6\u5c31\u7b49\u5f85\u5176\u4ed6\u54f2\u5b66\u5bb6\u653e\u56de\u53c9\u5b50\u3002</p> <p></p> <p>\u4e0d\u8fc7\uff0c\u8fd9\u79cd\u89e3\u6cd5\u5b58\u5728\u4e00\u4e2a\u6781\u7aef\u7684\u95ee\u9898\uff1a\u5047\u8bbe\u4e94\u4f4d\u54f2\u5b66\u5bb6\u540c\u65f6\u62ff\u8d77\u5de6\u8fb9\u7684\u53c9\u5b50\uff0c\u684c\u9762\u4e0a\u5c31\u6ca1\u6709\u53c9\u5b50\u4e86\uff0c \u8fd9\u6837\u5c31\u6ca1\u6709\u4eba\u80fd\u591f\u62ff\u5230\u4ed6\u4eec\u53f3\u8fb9\u7684\u53c9\u5b50\uff0c\u4e5f\u5c31\u8bf4\u6bcf\u4e00\u4f4d\u54f2\u5b66\u5bb6\u90fd\u4f1a\u5728 <code>P(fork[(i + 1) % N ])</code> \u8fd9\u6761\u8bed\u53e5\u963b\u585e\u4e86\uff0c\u5f88\u660e\u663e\u8fd9\u53d1\u751f\u4e86\u6b7b\u9501\u7684\u73b0\u8c61\u3002</p> <p>\u65b9\u6848\u4e8c</p> <p>\u65e2\u7136\u300c\u65b9\u6848\u4e00\u300d\u4f1a\u53d1\u751f\u540c\u65f6\u7ade\u4e89\u5de6\u8fb9\u53c9\u5b50\u5bfc\u81f4\u6b7b\u9501\u7684\u73b0\u8c61\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u5728\u62ff\u53c9\u5b50\u524d\uff0c\u52a0\u4e2a\u4e92\u65a5\u4fe1\u53f7\u91cf\uff0c\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e0a\u9762\u7a0b\u5e8f\u4e2d\u7684\u4e92\u65a5\u4fe1\u53f7\u91cf\u7684\u4f5c\u7528\u5c31\u5728\u4e8e\uff0c\u53ea\u8981\u6709\u4e00\u4e2a\u54f2\u5b66\u5bb6\u8fdb\u5165\u4e86\u300c\u4e34\u754c\u533a\u300d\uff0c\u4e5f\u5c31\u662f\u51c6\u5907\u8981\u62ff\u53c9\u5b50\u65f6\uff0c\u5176\u4ed6\u54f2\u5b66\u5bb6\u90fd\u4e0d\u80fd\u52a8\uff0c\u53ea\u6709\u8fd9\u4f4d\u54f2\u5b66\u5bb6\u7528\u5b8c\u53c9\u5b50\u4e86\uff0c\u624d\u80fd\u8f6e\u5230\u4e0b\u4e00\u4e2a\u54f2\u5b66\u5bb6\u8fdb\u9910\u3002</p> <p></p> <p>\u65b9\u6848\u4e8c\u867d\u7136\u80fd\u8ba9\u54f2\u5b66\u5bb6\u4eec\u6309\u987a\u5e8f\u5403\u996d\uff0c\u4f46\u662f\u6bcf\u6b21\u8fdb\u9910\u53ea\u80fd\u6709\u4e00\u4f4d\u54f2\u5b66\u5bb6\uff0c\u800c\u684c\u9762\u4e0a\u662f\u6709 5 \u628a\u53c9\u5b50\uff0c\u6309\u9053\u7406\u662f\u80fd\u53ef\u4ee5\u6709\u4e24\u4e2a\u54f2\u5b66\u5bb6\u540c\u65f6\u8fdb\u9910\u7684\uff0c\u6240\u4ee5\u4ece\u6548\u7387\u89d2\u5ea6\u4e0a\uff0c\u8fd9\u4e0d\u662f\u6700\u597d\u7684\u89e3\u51b3\u65b9\u6848\u3002</p> <p>\u65b9\u6848\u4e09</p> <p>\u90a3\u65e2\u7136\u65b9\u6848\u4e8c\u4f7f\u7528\u4e92\u65a5\u4fe1\u53f7\u91cf\uff0c\u4f1a\u5bfc\u81f4\u53ea\u80fd\u5141\u8bb8\u4e00\u4e2a\u54f2\u5b66\u5bb6\u5c31\u9910\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u7528\u5b83\u3002</p> <p>\u53e6\u5916\uff0c\u65b9\u6848\u4e00\u7684\u95ee\u9898\u5728\u4e8e\uff0c\u4f1a\u51fa\u73b0\u6240\u6709\u54f2\u5b66\u5bb6\u540c\u65f6\u62ff\u5de6\u8fb9\u5200\u53c9\u7684\u53ef\u80fd\u6027\uff0c\u90a3\u6211\u4eec\u5c31\u907f\u514d\u54f2\u5b66\u5bb6\u53ef\u4ee5\u540c\u65f6\u62ff\u5de6\u8fb9\u7684\u5200\u53c9\uff0c\u91c7\u7528\u5206\u652f\u7ed3\u6784\uff0c\u6839\u636e\u54f2\u5b66\u5bb6\u7684\u7f16\u53f7\u7684\u4e0d\u540c\uff0c\u800c\u91c7\u53d6\u4e0d\u540c\u7684\u52a8\u4f5c\u3002</p> <p>\u5373\u8ba9\u5076\u6570\u7f16\u53f7\u7684\u54f2\u5b66\u5bb6\u300c\u5148\u62ff\u5de6\u8fb9\u7684\u53c9\u5b50\u540e\u62ff\u53f3\u8fb9\u7684\u53c9\u5b50\u300d\uff0c\u5947\u6570\u7f16\u53f7\u7684\u54f2\u5b66\u5bb6\u300c\u5148\u62ff\u53f3\u8fb9\u7684\u53c9\u5b50\u540e\u62ff\u5de6\u8fb9\u7684\u53c9\u5b50\u300d\u3002</p> <p></p> <p>\u4e0a\u9762\u7684\u7a0b\u5e8f\uff0c\u5728 P \u64cd\u4f5c\u65f6\uff0c\u6839\u636e\u54f2\u5b66\u5bb6\u7684\u7f16\u53f7\u4e0d\u540c\uff0c\u62ff\u8d77\u5de6\u53f3\u4e24\u8fb9\u53c9\u5b50\u7684\u987a\u5e8f\u4e0d\u540c\u3002\u53e6\u5916\uff0cV \u64cd\u4f5c\u662f\u4e0d\u9700\u8981\u5206\u652f\u7684\uff0c\u56e0\u4e3a V \u64cd\u4f5c\u662f\u4e0d\u4f1a\u963b\u585e\u7684\u3002</p> <p></p> <p>\u65b9\u6848\u4e09\u5373\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\uff0c\u4e5f\u53ef\u4ee5\u4e24\u4eba\u540c\u65f6\u8fdb\u9910\u3002</p> <p>\u65b9\u6848\u56db</p> <p>\u5728\u8fd9\u91cc\u518d\u63d0\u51fa\u53e6\u5916\u4e00\u79cd\u53ef\u884c\u7684\u89e3\u51b3\u65b9\u6848\uff0c\u6211\u4eec\u7528\u4e00\u4e2a\u6570\u7ec4 state \u6765\u8bb0\u5f55\u6bcf\u4e00\u4f4d\u54f2\u5b66\u5bb6\u7684\u4e09\u4e2a\u72b6\u6001\uff0c\u5206\u522b\u662f\u5728\u8fdb\u9910\u72b6\u6001\u3001\u601d\u8003\u72b6\u6001\u3001\u9965\u997f\u72b6\u6001\uff08\u6b63\u5728\u8bd5\u56fe\u62ff\u53c9\u5b50\uff09\u3002</p> <p>\u90a3\u4e48\uff0c\u4e00\u4e2a\u54f2\u5b66\u5bb6\u53ea\u6709\u5728\u4e24\u4e2a\u90bb\u5c45\u90fd\u6ca1\u6709\u8fdb\u9910\u65f6\uff0c\u624d\u53ef\u4ee5\u8fdb\u5165\u8fdb\u9910\u72b6\u6001\u3002</p> <p>\u7b2c <code>i</code> \u4e2a\u54f2\u5b66\u5bb6\u7684\u5de6\u90bb\u53f3\u820d\uff0c\u5219\u7531\u5b8f <code>LEFT</code> \u548c <code>RIGHT</code> \u5b9a\u4e49\uff1a</p> <ul> <li>LEFT : ( i + 5  - 1 ) % 5</li> <li>RIGHT : ( i + 1 ) % 5</li> </ul> <p>\u6bd4\u5982 i \u4e3a 2\uff0c\u5219 <code>LEFT</code> \u4e3a 1\uff0c<code>RIGHT</code> \u4e3a 3\u3002</p> <p>\u5177\u4f53\u4ee3\u7801\u5b9e\u73b0\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e0a\u9762\u7684\u7a0b\u5e8f\u4f7f\u7528\u4e86\u4e00\u4e2a\u4fe1\u53f7\u91cf\u6570\u7ec4\uff0c\u6bcf\u4e2a\u4fe1\u53f7\u91cf\u5bf9\u5e94\u4e00\u4f4d\u54f2\u5b66\u5bb6\uff0c\u8fd9\u6837\u5728\u6240\u9700\u7684\u53c9\u5b50\u88ab\u5360\u7528\u65f6\uff0c\u60f3\u8fdb\u9910\u7684\u54f2\u5b66\u5bb6\u5c31\u88ab\u963b\u585e\u3002</p> <p>\u6ce8\u610f\uff0c\u6bcf\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u5c06 <code>smart_person</code> \u51fd\u6570\u4f5c\u4e3a\u4e3b\u4ee3\u7801\u8fd0\u884c\uff0c\u800c\u5176\u4ed6 <code>take_forks</code>\u3001<code>put_forks</code> \u548c <code>test</code> \u53ea\u662f\u666e\u901a\u7684\u51fd\u6570\uff0c\u800c\u975e\u5355\u72ec\u7684\u8fdb\u7a0b/\u7ebf\u7a0b\u3002</p> <p></p> <p>\u65b9\u6848\u56db\u540c\u6837\u4e0d\u4f1a\u51fa\u73b0\u6b7b\u9501\uff0c\u4e5f\u53ef\u4ee5\u4e24\u4eba\u540c\u65f6\u8fdb\u9910\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#-_1","title":"\u8bfb\u8005 - \u5199\u8005\u95ee\u9898","text":"<p>\u524d\u9762\u7684\u300c\u54f2\u5b66\u5bb6\u8fdb\u9910\u95ee\u9898\u300d\u5bf9\u4e8e\u4e92\u65a5\u8bbf\u95ee\u6709\u9650\u7684\u7ade\u4e89\u95ee\u9898\uff08\u5982 I/O \u8bbe\u5907\uff09\u4e00\u7c7b\u7684\u5efa\u6a21\u8fc7\u7a0b\u5341\u5206\u6709\u7528\u3002</p> <p>\u53e6\u5916\uff0c\u8fd8\u6709\u4e2a\u8457\u540d\u7684\u95ee\u9898\u662f\u300c\u8bfb\u8005 - \u5199\u8005\u300d\uff0c\u5b83\u4e3a\u6570\u636e\u5e93\u8bbf\u95ee\u5efa\u7acb\u4e86\u4e00\u4e2a\u6a21\u578b\u3002</p> <p>\u8bfb\u8005\u53ea\u4f1a\u8bfb\u53d6\u6570\u636e\uff0c\u4e0d\u4f1a\u4fee\u6539\u6570\u636e\uff0c\u800c\u5199\u8005\u5373\u53ef\u4ee5\u8bfb\u4e5f\u53ef\u4ee5\u4fee\u6539\u6570\u636e\u3002</p> <p>\u8bfb\u8005 - \u5199\u8005\u7684\u95ee\u9898\u63cf\u8ff0\uff1a</p> <ul> <li>\u300c\u8bfb - \u8bfb\u300d\u5141\u8bb8\uff1a\u540c\u4e00\u65f6\u523b\uff0c\u5141\u8bb8\u591a\u4e2a\u8bfb\u8005\u540c\u65f6\u8bfb</li> <li>\u300c\u8bfb - \u5199\u300d\u4e92\u65a5\uff1a\u6ca1\u6709\u5199\u8005\u65f6\u8bfb\u8005\u624d\u80fd\u8bfb\uff0c\u6ca1\u6709\u8bfb\u8005\u65f6\u5199\u8005\u624d\u80fd\u5199</li> <li>\u300c\u5199 - \u5199\u300d\u4e92\u65a5\uff1a\u6ca1\u6709\u5176\u4ed6\u5199\u8005\u65f6\uff0c\u5199\u8005\u624d\u80fd\u5199</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u63d0\u51fa\u51e0\u4e2a\u89e3\u51b3\u65b9\u6848\u6765\u5206\u6790\u5206\u6790\u3002</p> <p>\u65b9\u6848\u4e00</p> <p>\u4f7f\u7528\u4fe1\u53f7\u91cf\u7684\u65b9\u5f0f\u6765\u5c1d\u8bd5\u89e3\u51b3\uff1a</p> <ul> <li>\u4fe1\u53f7\u91cf <code>wMutex</code>\uff1a\u63a7\u5236\u5199\u64cd\u4f5c\u7684\u4e92\u65a5\u4fe1\u53f7\u91cf\uff0c\u521d\u59cb\u503c\u4e3a 1\uff1b</li> <li>\u8bfb\u8005\u8ba1\u6570 <code>rCount</code>\uff1a\u6b63\u5728\u8fdb\u884c\u8bfb\u64cd\u4f5c\u7684\u8bfb\u8005\u4e2a\u6570\uff0c\u521d\u59cb\u5316\u4e3a 0\uff1b</li> <li>\u4fe1\u53f7\u91cf <code>rCountMutex</code>\uff1a\u63a7\u5236\u5bf9 rCount \u8bfb\u8005\u8ba1\u6570\u5668\u7684\u4e92\u65a5\u4fee\u6539\uff0c\u521d\u59cb\u503c\u4e3a 1\uff1b</li> </ul> <p>\u63a5\u4e0b\u6765\u770b\u770b\u4ee3\u7801\u7684\u5b9e\u73b0\uff1a</p> <p></p> <p>\u4e0a\u9762\u7684\u8fd9\u79cd\u5b9e\u73b0\uff0c\u662f\u8bfb\u8005\u4f18\u5148\u7684\u7b56\u7565\uff0c\u56e0\u4e3a\u53ea\u8981\u6709\u8bfb\u8005\u6b63\u5728\u8bfb\u7684\u72b6\u6001\uff0c\u540e\u6765\u7684\u8bfb\u8005\u90fd\u53ef\u4ee5\u76f4\u63a5\u8fdb\u5165\uff0c\u5982\u679c\u8bfb\u8005\u6301\u7eed\u4e0d\u65ad\u8fdb\u5165\uff0c\u5219\u5199\u8005\u4f1a\u5904\u4e8e\u9965\u997f\u72b6\u6001\u3002</p> <p>\u65b9\u6848\u4e8c</p> <p>\u90a3\u65e2\u7136\u6709\u8bfb\u8005\u4f18\u5148\u7b56\u7565\uff0c\u81ea\u7136\u4e5f\u6709\u5199\u8005\u4f18\u5148\u7b56\u7565\uff1a</p> <ul> <li>\u53ea\u8981\u6709\u5199\u8005\u51c6\u5907\u8981\u5199\u5165\uff0c\u5199\u8005\u5e94\u5c3d\u5feb\u6267\u884c\u5199\u64cd\u4f5c\uff0c\u540e\u6765\u7684\u8bfb\u8005\u5c31\u5fc5\u987b\u963b\u585e\uff1b</li> <li>\u5982\u679c\u6709\u5199\u8005\u6301\u7eed\u4e0d\u65ad\u5199\u5165\uff0c\u5219\u8bfb\u8005\u5c31\u5904\u4e8e\u9965\u997f\uff1b</li> </ul> <p>\u5728\u65b9\u6848\u4e00\u7684\u57fa\u7840\u4e0a\u65b0\u589e\u5982\u4e0b\u53d8\u91cf\uff1a</p> <ul> <li>\u4fe1\u53f7\u91cf <code>rMutex</code>\uff1a\u63a7\u5236\u8bfb\u8005\u8fdb\u5165\u7684\u4e92\u65a5\u4fe1\u53f7\u91cf\uff0c\u521d\u59cb\u503c\u4e3a 1\uff1b</li> <li>\u4fe1\u53f7\u91cf <code>wDataMutex</code>\uff1a\u63a7\u5236\u5199\u8005\u5199\u64cd\u4f5c\u7684\u4e92\u65a5\u4fe1\u53f7\u91cf\uff0c\u521d\u59cb\u503c\u4e3a 1\uff1b</li> <li>\u5199\u8005\u8ba1\u6570 <code>wCount</code>\uff1a\u8bb0\u5f55\u5199\u8005\u6570\u91cf\uff0c\u521d\u59cb\u503c\u4e3a 0\uff1b</li> <li>\u4fe1\u53f7\u91cf <code>wCountMutex</code>\uff1a\u63a7\u5236 wCount \u4e92\u65a5\u4fee\u6539\uff0c\u521d\u59cb\u503c\u4e3a 1\uff1b</li> </ul> <p>\u5177\u4f53\u5b9e\u73b0\u5982\u4e0b\u4ee3\u7801\uff1a</p> <p></p> <p>\u6ce8\u610f\uff0c\u8fd9\u91cc <code>rMutex</code> \u7684\u4f5c\u7528\uff0c\u5f00\u59cb\u6709\u591a\u4e2a\u8bfb\u8005\u8bfb\u6570\u636e\uff0c\u5b83\u4eec\u5168\u90e8\u8fdb\u5165\u8bfb\u8005\u961f\u5217\uff0c\u6b64\u65f6\u6765\u4e86\u4e00\u4e2a\u5199\u8005\uff0c\u6267\u884c\u4e86 <code>P(rMutex)</code> \u4e4b\u540e\uff0c\u540e\u7eed\u7684\u8bfb\u8005\u7531\u4e8e\u963b\u585e\u5728 <code>rMutex</code> \u4e0a\uff0c\u90fd\u4e0d\u80fd\u518d\u8fdb\u5165\u8bfb\u8005\u961f\u5217\uff0c\u800c\u5199\u8005\u5230\u6765\uff0c\u5219\u53ef\u4ee5\u5168\u90e8\u8fdb\u5165\u5199\u8005\u961f\u5217\uff0c\u56e0\u6b64\u4fdd\u8bc1\u4e86\u5199\u8005\u4f18\u5148\u3002</p> <p>\u540c\u65f6\uff0c\u7b2c\u4e00\u4e2a\u5199\u8005\u6267\u884c\u4e86 <code>P(rMutex)</code> \u4e4b\u540e\uff0c\u4e5f\u4e0d\u80fd\u9a6c\u4e0a\u5f00\u59cb\u5199\uff0c\u5fc5\u987b\u7b49\u5230\u6240\u6709\u8fdb\u5165\u8bfb\u8005\u961f\u5217\u7684\u8bfb\u8005\u90fd\u6267\u884c\u5b8c\u8bfb\u64cd\u4f5c\uff0c\u901a\u8fc7 <code>V(wDataMutex)</code> \u5524\u9192\u5199\u8005\u7684\u5199\u64cd\u4f5c\u3002 </p> <p>\u65b9\u6848\u4e09</p> <p>\u65e2\u7136\u8bfb\u8005\u4f18\u5148\u7b56\u7565\u548c\u5199\u8005\u4f18\u5148\u7b56\u7565\u90fd\u4f1a\u9020\u6210\u9965\u997f\u7684\u73b0\u8c61\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u6765\u5b9e\u73b0\u4e00\u4e0b\u516c\u5e73\u7b56\u7565\u3002</p> <p>\u516c\u5e73\u7b56\u7565\uff1a</p> <ul> <li>\u4f18\u5148\u7ea7\u76f8\u540c\uff1b</li> <li>\u5199\u8005\u3001\u8bfb\u8005\u4e92\u65a5\u8bbf\u95ee\uff1b</li> <li>\u53ea\u80fd\u4e00\u4e2a\u5199\u8005\u8bbf\u95ee\u4e34\u754c\u533a\uff1b</li> <li>\u53ef\u4ee5\u6709\u591a\u4e2a\u8bfb\u8005\u540c\u65f6\u8bbf\u95ee\u4e34\u754c\u8d44\u6e90\uff1b</li> </ul> <p>\u5177\u4f53\u4ee3\u7801\u5b9e\u73b0\uff1a</p> <p></p> <p>\u770b\u5b8c\u4ee3\u7801\u4e0d\u77e5\u4f60\u662f\u5426\u6709\u8fd9\u6837\u7684\u7591\u95ee\uff0c\u4e3a\u4ec0\u4e48\u52a0\u4e86\u4e00\u4e2a\u4fe1\u53f7\u91cf <code>flag</code>\uff0c\u5c31\u5b9e\u73b0\u4e86\u516c\u5e73\u7ade\u4e89\uff1f</p> <p>\u5bf9\u6bd4\u65b9\u6848\u4e00\u7684\u8bfb\u8005\u4f18\u5148\u7b56\u7565\uff0c\u53ef\u4ee5\u53d1\u73b0\uff0c\u8bfb\u8005\u4f18\u5148\u4e2d\u53ea\u8981\u540e\u7eed\u6709\u8bfb\u8005\u5230\u8fbe\uff0c\u8bfb\u8005\u5c31\u53ef\u4ee5\u8fdb\u5165\u8bfb\u8005\u961f\u5217\uff0c\u800c\u5199\u8005\u5fc5\u987b\u7b49\u5f85\uff0c\u76f4\u5230\u6ca1\u6709\u8bfb\u8005\u5230\u8fbe\u3002</p> <p>\u6ca1\u6709\u8bfb\u8005\u5230\u8fbe\u4f1a\u5bfc\u81f4\u8bfb\u8005\u961f\u5217\u4e3a\u7a7a\uff0c\u5373 <code>rCount==0</code>\uff0c\u6b64\u65f6\u5199\u8005\u624d\u53ef\u4ee5\u8fdb\u5165\u4e34\u754c\u533a\u6267\u884c\u5199\u64cd\u4f5c\u3002</p> <p>\u800c\u8fd9\u91cc <code>flag</code> \u7684\u4f5c\u7528\u5c31\u662f\u963b\u6b62\u8bfb\u8005\u7684\u8fd9\u79cd\u7279\u6b8a\u6743\u9650\uff08\u7279\u6b8a\u6743\u9650\u662f\u53ea\u8981\u8bfb\u8005\u5230\u8fbe\uff0c\u5c31\u53ef\u4ee5\u8fdb\u5165\u8bfb\u8005\u961f\u5217\uff09\u3002 </p> <p>\u6bd4\u5982\uff1a\u5f00\u59cb\u6765\u4e86\u4e00\u4e9b\u8bfb\u8005\u8bfb\u6570\u636e\uff0c\u5b83\u4eec\u5168\u90e8\u8fdb\u5165\u8bfb\u8005\u961f\u5217\uff0c\u6b64\u65f6\u6765\u4e86\u4e00\u4e2a\u5199\u8005\uff0c\u6267\u884c <code>P(flag)</code> \u64cd\u4f5c\uff0c\u4f7f\u5f97\u540e\u7eed\u5230\u6765\u7684\u8bfb\u8005\u90fd\u963b\u585e\u5728 <code>flag</code> \u4e0a\uff0c\u4e0d\u80fd\u8fdb\u5165\u8bfb\u8005\u961f\u5217\uff0c\u8fd9\u4f1a\u4f7f\u5f97\u8bfb\u8005\u961f\u5217\u9010\u6e10\u4e3a\u7a7a\uff0c\u5373 <code>rCount</code> \u51cf\u4e3a 0\u3002</p> <p>\u8fd9\u4e2a\u5199\u8005\u4e5f\u4e0d\u80fd\u7acb\u9a6c\u5f00\u59cb\u5199\uff08\u56e0\u4e3a\u6b64\u65f6\u8bfb\u8005\u961f\u5217\u4e0d\u4e3a\u7a7a\uff09\uff0c\u4f1a\u963b\u585e\u5728\u4fe1\u53f7\u91cf <code>wDataMutex</code> \u4e0a\uff0c\u8bfb\u8005\u961f\u5217\u4e2d\u7684\u8bfb\u8005\u5168\u90e8\u8bfb\u53d6\u7ed3\u675f\u540e\uff0c\u6700\u540e\u4e00\u4e2a\u8bfb\u8005\u8fdb\u7a0b\u6267\u884c <code>V(wDataMutex)</code>\uff0c\u5524\u9192\u521a\u624d\u7684\u5199\u8005\uff0c\u5199\u8005\u5219\u7ee7\u7eed\u5f00\u59cb\u8fdb\u884c\u5199\u64cd\u4f5c\u3002 </p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/multithread_sync/#_9","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u5c0f\u6797\u662f\u4e13\u4e3a\u5927\u5bb6\u56fe\u89e3\u7684\u5de5\u5177\u4eba\uff0cGoodbye\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/pessim_and_optimi_lock/","title":"5.5 \u4ec0\u4e48\u662f\u60b2\u89c2\u9501\u3001\u4e50\u89c2\u9501\uff1f","text":"<p>\u751f\u6d3b\u4e2d\u7528\u5230\u7684\u9501\uff0c\u7528\u9014\u90fd\u6bd4\u8f83\u7b80\u5355\u7c97\u66b4\uff0c\u4e0a\u9501\u57fa\u672c\u662f\u4e3a\u4e86\u9632\u6b62\u5916\u4eba\u8fdb\u6765\u3001\u7535\u52a8\u8f66\u88ab\u5077\u7b49\u7b49\u3002</p> <p>\u4f46\u751f\u6d3b\u4e2d\u4e5f\u4e0d\u662f\u6ca1\u6709 BUG \u7684\uff0c\u6bd4\u5982\u52a0\u9501\u7684\u7535\u52a8\u8f66\u5728\u300c\u5e7f\u897f - \u7a83\u00b7\u683c\u74e6\u62c9\u300d\u9762\u524d\uff0c\u9501\u5c31\u662f\u5f62\u540c\u865a\u8bbe\uff0c\u53ea\u8981\u4ed6\u613f\u610f\uff0c\u4ed6\u5c31\u53ef\u4ee5\u8f7b\u8f7b\u677e\u677e\u5730\u628a\u4f60\u7535\u52a8\u8f66\u7ed9\u300c\u987a\u8d70\u300d\uff0c\u4e0d\u7136\u6253\u5de5\u600e\u4e48\u4f1a\u662f\u4ed6\u8fd9\u8f88\u5b50\u4e0d\u53ef\u80fd\u7684\u4e8b\u60c5\u5462\uff1f\u725b\u903c\u4e4b\u4eba\uff0c\u5fc5\u6709\u725b\u903c\u4e4b\u5904\u3002</p> <p></p> <p>\u90a3\u5728\u7f16\u7a0b\u4e16\u754c\u91cc\uff0c\u300c\u9501\u300d\u66f4\u662f\u4e94\u82b1\u516b\u95e8\uff0c\u591a\u79cd\u591a\u6837\uff0c\u6bcf\u79cd\u9501\u7684\u52a0\u9501\u5f00\u9500\u4ee5\u53ca\u5e94\u7528\u573a\u666f\u4e5f\u53ef\u80fd\u4f1a\u4e0d\u540c\u3002</p> <p>\u5982\u4f55\u7528\u597d\u9501\uff0c\u4e5f\u662f\u7a0b\u5e8f\u5458\u7684\u57fa\u672c\u7d20\u517b\u4e4b\u4e00\u4e86\u3002</p> <p>\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u4e0b\uff0c\u5982\u679c\u9009\u5bf9\u4e86\u5408\u9002\u7684\u9501\uff0c\u5219\u4f1a\u5927\u5927\u63d0\u9ad8\u7cfb\u7edf\u7684\u6027\u80fd\uff0c\u5426\u5219\u6027\u80fd\u4f1a\u964d\u4f4e\u3002</p> <p>\u6240\u4ee5\uff0c\u77e5\u9053\u5404\u79cd\u9501\u7684\u5f00\u9500\uff0c\u4ee5\u53ca\u5e94\u7528\u573a\u666f\u662f\u5f88\u6709\u5fc5\u8981\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u8c08\u4e00\u8c08\u5e38\u89c1\u7684\u8fd9\u51e0\u79cd\u9501\uff1a</p> <p></p> <p>\u591a\u7ebf\u7a0b\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u907f\u514d\u4e0d\u4e86\u8d44\u6e90\u7ade\u4e89\u800c\u5bfc\u81f4\u6570\u636e\u9519\u4e71\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u6211\u4eec\u901a\u5e38\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u90fd\u4f1a\u5728\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u4e4b\u524d\u52a0\u9501\u3002</p> <p>\u6700\u5e38\u7528\u7684\u5c31\u662f\u4e92\u65a5\u9501\uff0c\u5f53\u7136\u8fd8\u6709\u5f88\u591a\u79cd\u4e0d\u540c\u7684\u9501\uff0c\u6bd4\u5982\u81ea\u65cb\u9501\u3001\u8bfb\u5199\u9501\u3001\u4e50\u89c2\u9501\u7b49\uff0c\u4e0d\u540c\u79cd\u7c7b\u7684\u9501\u81ea\u7136\u9002\u7528\u4e8e\u4e0d\u540c\u7684\u573a\u666f\u3002</p> <p>\u5982\u679c\u9009\u62e9\u4e86\u9519\u8bef\u7684\u9501\uff0c\u90a3\u4e48\u5728\u4e00\u4e9b\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u4e0b\uff0c\u53ef\u80fd\u4f1a\u964d\u4f4e\u7cfb\u7edf\u7684\u6027\u80fd\uff0c\u8fd9\u6837\u7528\u6237\u4f53\u9a8c\u5c31\u4f1a\u975e\u5e38\u5dee\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u9009\u62e9\u5408\u9002\u7684\u9501\uff0c\u6211\u4eec\u4e0d\u4ec5\u9700\u8981\u6e05\u695a\u77e5\u9053\u52a0\u9501\u7684\u6210\u672c\u5f00\u9500\u6709\u591a\u5927\uff0c\u8fd8\u9700\u8981\u5206\u6790\u4e1a\u52a1\u573a\u666f\u4e2d\u8bbf\u95ee\u7684\u5171\u4eab\u8d44\u6e90\u7684\u65b9\u5f0f\uff0c\u518d\u6765\u8fd8\u8981\u8003\u8651\u5e76\u53d1\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u65f6\u7684\u51b2\u7a81\u6982\u7387\u3002</p> <p>\u5bf9\u75c7\u4e0b\u836f\uff0c\u624d\u80fd\u51cf\u5c11\u9501\u5bf9\u9ad8\u5e76\u53d1\u6027\u80fd\u7684\u5f71\u54cd\u3002</p> <p>\u90a3\u63a5\u4e0b\u6765\uff0c\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u573a\u666f\uff0c\u8c08\u4e00\u8c08\u300c\u4e92\u65a5\u9501\u3001\u81ea\u65cb\u9501\u3001\u8bfb\u5199\u9501\u3001\u4e50\u89c2\u9501\u3001\u60b2\u89c2\u9501\u300d\u7684\u9009\u62e9\u548c\u4f7f\u7528\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/pessim_and_optimi_lock/#_1","title":"\u4e92\u65a5\u9501\u4e0e\u81ea\u65cb\u9501","text":"<p>\u6700\u5e95\u5c42\u7684\u4e24\u79cd\u5c31\u662f\u4f1a\u300c\u4e92\u65a5\u9501\u548c\u81ea\u65cb\u9501\u300d\uff0c\u6709\u5f88\u591a\u9ad8\u7ea7\u7684\u9501\u90fd\u662f\u57fa\u4e8e\u5b83\u4eec\u5b9e\u73b0\u7684\uff0c\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u5b83\u4eec\u662f\u5404\u79cd\u9501\u7684\u5730\u57fa\uff0c\u6240\u4ee5\u6211\u4eec\u5fc5\u987b\u6e05\u695a\u5b83\u4fe9\u4e4b\u95f4\u7684\u533a\u522b\u548c\u5e94\u7528\u3002</p> <p>\u52a0\u9501\u7684\u76ee\u7684\u5c31\u662f\u4fdd\u8bc1\u5171\u4eab\u8d44\u6e90\u5728\u4efb\u610f\u65f6\u95f4\u91cc\uff0c\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u591a\u7ebf\u7a0b\u5bfc\u81f4\u5171\u4eab\u6570\u636e\u9519\u4e71\u7684\u95ee\u9898\u3002</p> <p>\u5f53\u5df2\u7ecf\u6709\u4e00\u4e2a\u7ebf\u7a0b\u52a0\u9501\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u52a0\u9501\u5219\u5c31\u4f1a\u5931\u8d25\uff0c\u4e92\u65a5\u9501\u548c\u81ea\u65cb\u9501\u5bf9\u4e8e\u52a0\u9501\u5931\u8d25\u540e\u7684\u5904\u7406\u65b9\u5f0f\u662f\u4e0d\u4e00\u6837\u7684\uff1a</p> <ul> <li>\u4e92\u65a5\u9501\u52a0\u9501\u5931\u8d25\u540e\uff0c\u7ebf\u7a0b\u4f1a\u91ca\u653e CPU \uff0c\u7ed9\u5176\u4ed6\u7ebf\u7a0b\uff1b</li> <li>\u81ea\u65cb\u9501\u52a0\u9501\u5931\u8d25\u540e\uff0c\u7ebf\u7a0b\u4f1a\u5fd9\u7b49\u5f85\uff0c\u76f4\u5230\u5b83\u62ff\u5230\u9501\uff1b</li> </ul> <p>\u4e92\u65a5\u9501\u662f\u4e00\u79cd\u300c\u72ec\u5360\u9501\u300d\uff0c\u6bd4\u5982\u5f53\u7ebf\u7a0b A \u52a0\u9501\u6210\u529f\u540e\uff0c\u6b64\u65f6\u4e92\u65a5\u9501\u5df2\u7ecf\u88ab\u7ebf\u7a0b A \u72ec\u5360\u4e86\uff0c\u53ea\u8981\u7ebf\u7a0b A \u6ca1\u6709\u91ca\u653e\u624b\u4e2d\u7684\u9501\uff0c\u7ebf\u7a0b B \u52a0\u9501\u5c31\u4f1a\u5931\u8d25\uff0c\u4e8e\u662f\u5c31\u4f1a\u91ca\u653e CPU \u8ba9\u7ed9\u5176\u4ed6\u7ebf\u7a0b\uff0c\u65e2\u7136\u7ebf\u7a0b B \u91ca\u653e\u6389\u4e86 CPU\uff0c\u81ea\u7136\u7ebf\u7a0b B \u52a0\u9501\u7684\u4ee3\u7801\u5c31\u4f1a\u88ab\u963b\u585e\u3002</p> <p>\u5bf9\u4e8e\u4e92\u65a5\u9501\u52a0\u9501\u5931\u8d25\u800c\u963b\u585e\u7684\u73b0\u8c61\uff0c\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u5b9e\u73b0\u7684\u3002\u5f53\u52a0\u9501\u5931\u8d25\u65f6\uff0c\u5185\u6838\u4f1a\u5c06\u7ebf\u7a0b\u7f6e\u4e3a\u300c\u7761\u7720\u300d\u72b6\u6001\uff0c\u7b49\u5230\u9501\u88ab\u91ca\u653e\u540e\uff0c\u5185\u6838\u4f1a\u5728\u5408\u9002\u7684\u65f6\u673a\u5524\u9192\u7ebf\u7a0b\uff0c\u5f53\u8fd9\u4e2a\u7ebf\u7a0b\u6210\u529f\u83b7\u53d6\u5230\u9501\u540e\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u4e92\u65a5\u9501\u52a0\u9501\u5931\u8d25\u65f6\uff0c\u4f1a\u4ece\u7528\u6237\u6001\u9677\u5165\u5230\u5185\u6838\u6001\uff0c\u8ba9\u5185\u6838\u5e2e\u6211\u4eec\u5207\u6362\u7ebf\u7a0b\uff0c\u867d\u7136\u7b80\u5316\u4e86\u4f7f\u7528\u9501\u7684\u96be\u5ea6\uff0c\u4f46\u662f\u5b58\u5728\u4e00\u5b9a\u7684\u6027\u80fd\u5f00\u9500\u6210\u672c\u3002</p> <p>\u90a3\u8fd9\u4e2a\u5f00\u9500\u6210\u672c\u662f\u4ec0\u4e48\u5462\uff1f\u4f1a\u6709\u4e24\u6b21\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6210\u672c\uff1a</p> <ul> <li>\u5f53\u7ebf\u7a0b\u52a0\u9501\u5931\u8d25\u65f6\uff0c\u5185\u6838\u4f1a\u628a\u7ebf\u7a0b\u7684\u72b6\u6001\u4ece\u300c\u8fd0\u884c\u300d\u72b6\u6001\u8bbe\u7f6e\u4e3a\u300c\u7761\u7720\u300d\u72b6\u6001\uff0c\u7136\u540e\u628a CPU \u5207\u6362\u7ed9\u5176\u4ed6\u7ebf\u7a0b\u8fd0\u884c\uff1b</li> <li>\u63a5\u7740\uff0c\u5f53\u9501\u88ab\u91ca\u653e\u65f6\uff0c\u4e4b\u524d\u300c\u7761\u7720\u300d\u72b6\u6001\u7684\u7ebf\u7a0b\u4f1a\u53d8\u4e3a\u300c\u5c31\u7eea\u300d\u72b6\u6001\uff0c\u7136\u540e\u5185\u6838\u4f1a\u5728\u5408\u9002\u7684\u65f6\u95f4\uff0c\u628a CPU \u5207\u6362\u7ed9\u8be5\u7ebf\u7a0b\u8fd0\u884c\u3002</li> </ul> <p>\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u662f\u4ec0\u4e48\uff1f\u5f53\u4e24\u4e2a\u7ebf\u7a0b\u662f\u5c5e\u4e8e\u540c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u56e0\u4e3a\u865a\u62df\u5185\u5b58\u662f\u5171\u4eab\u7684\uff0c\u6240\u4ee5\u5728\u5207\u6362\u65f6\uff0c\u865a\u62df\u5185\u5b58\u8fd9\u4e9b\u8d44\u6e90\u5c31\u4fdd\u6301\u4e0d\u52a8\uff0c\u53ea\u9700\u8981\u5207\u6362\u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e\u3001\u5bc4\u5b58\u5668\u7b49\u4e0d\u5171\u4eab\u7684\u6570\u636e\u3002</p> <p>\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u8017\u65f6\u6709\u5927\u4f6c\u7edf\u8ba1\u8fc7\uff0c\u5927\u6982\u5728\u51e0\u5341\u7eb3\u79d2\u5230\u51e0\u5fae\u79d2\u4e4b\u95f4\uff0c\u5982\u679c\u4f60\u9501\u4f4f\u7684\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u6bd4\u8f83\u77ed\uff0c\u90a3\u53ef\u80fd\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u65f6\u95f4\u90fd\u6bd4\u4f60\u9501\u4f4f\u7684\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u8fd8\u8981\u957f\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u4f60\u80fd\u786e\u5b9a\u88ab\u9501\u4f4f\u7684\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u5f88\u77ed\uff0c\u5c31\u4e0d\u5e94\u8be5\u7528\u4e92\u65a5\u9501\uff0c\u800c\u5e94\u8be5\u9009\u7528\u81ea\u65cb\u9501\uff0c\u5426\u5219\u4f7f\u7528\u4e92\u65a5\u9501\u3002</p> <p>\u81ea\u65cb\u9501\u662f\u901a\u8fc7 CPU \u63d0\u4f9b\u7684 <code>CAS</code> \u51fd\u6570\uff08Compare And Swap\uff09\uff0c\u5728\u300c\u7528\u6237\u6001\u300d\u5b8c\u6210\u52a0\u9501\u548c\u89e3\u9501\u64cd\u4f5c\uff0c\u4e0d\u4f1a\u4e3b\u52a8\u4ea7\u751f\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u6240\u4ee5\u76f8\u6bd4\u4e92\u65a5\u9501\u6765\u8bf4\uff0c\u4f1a\u5feb\u4e00\u4e9b\uff0c\u5f00\u9500\u4e5f\u5c0f\u4e00\u4e9b\u3002</p> <p>\u4e00\u822c\u52a0\u9501\u7684\u8fc7\u7a0b\uff0c\u5305\u542b\u4e24\u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\uff0c\u67e5\u770b\u9501\u7684\u72b6\u6001\uff0c\u5982\u679c\u9501\u662f\u7a7a\u95f2\u7684\uff0c\u5219\u6267\u884c\u7b2c\u4e8c\u6b65\uff1b</li> <li>\u7b2c\u4e8c\u6b65\uff0c\u5c06\u9501\u8bbe\u7f6e\u4e3a\u5f53\u524d\u7ebf\u7a0b\u6301\u6709\uff1b</li> </ul> <p>CAS \u51fd\u6570\u5c31\u628a\u8fd9\u4e24\u4e2a\u6b65\u9aa4\u5408\u5e76\u6210\u4e00\u6761\u786c\u4ef6\u7ea7\u6307\u4ee4\uff0c\u5f62\u6210\u539f\u5b50\u6307\u4ee4\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u8fd9\u4e24\u4e2a\u6b65\u9aa4\u662f\u4e0d\u53ef\u5206\u5272\u7684\uff0c\u8981\u4e48\u4e00\u6b21\u6027\u6267\u884c\u5b8c\u4e24\u4e2a\u6b65\u9aa4\uff0c\u8981\u4e48\u4e24\u4e2a\u6b65\u9aa4\u90fd\u4e0d\u6267\u884c\u3002</p> <p>\u6bd4\u5982\uff0c\u8bbe\u9501\u4e3a\u53d8\u91cf lock\uff0c\u6574\u6570 0 \u8868\u793a\u9501\u662f\u7a7a\u95f2\u72b6\u6001\uff0c\u6574\u6570 pid \u8868\u793a\u7ebf\u7a0b ID\uff0c\u90a3\u4e48 CAS(lock, 0, pid) \u5c31\u8868\u793a\u81ea\u65cb\u9501\u7684\u52a0\u9501\u64cd\u4f5c\uff0cCAS(lock, pid, 0) \u5219\u8868\u793a\u89e3\u9501\u64cd\u4f5c\u3002</p> <p>\u4f7f\u7528\u81ea\u65cb\u9501\u7684\u65f6\u5019\uff0c\u5f53\u53d1\u751f\u591a\u7ebf\u7a0b\u7ade\u4e89\u9501\u7684\u60c5\u51b5\uff0c\u52a0\u9501\u5931\u8d25\u7684\u7ebf\u7a0b\u4f1a\u300c\u5fd9\u7b49\u5f85\u300d\uff0c\u76f4\u5230\u5b83\u62ff\u5230\u9501\u3002\u8fd9\u91cc\u7684\u300c\u5fd9\u7b49\u5f85\u300d\u53ef\u4ee5\u7528 <code>while</code> \u5faa\u73af\u7b49\u5f85\u5b9e\u73b0\uff0c\u4e0d\u8fc7\u6700\u597d\u662f\u4f7f\u7528 CPU \u63d0\u4f9b\u7684 <code>PAUSE</code> \u6307\u4ee4\u6765\u5b9e\u73b0\u300c\u5fd9\u7b49\u5f85\u300d\uff0c\u56e0\u4e3a\u53ef\u4ee5\u51cf\u5c11\u5faa\u73af\u7b49\u5f85\u65f6\u7684\u8017\u7535\u91cf\u3002</p> <p>\u81ea\u65cb\u9501\u662f\u6700\u7b80\u5355\u7684\u4e00\u79cd\u9501\uff0c\u4e00\u76f4\u81ea\u65cb\uff0c\u5229\u7528 CPU \u5468\u671f\uff0c\u76f4\u5230\u9501\u53ef\u7528\u3002\u9700\u8981\u6ce8\u610f\uff0c\u5728\u5355\u6838 CPU \u4e0a\uff0c\u9700\u8981\u62a2\u5360\u5f0f\u7684\u8c03\u5ea6\u5668\uff08\u5373\u4e0d\u65ad\u901a\u8fc7\u65f6\u949f\u4e2d\u65ad\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u8fd0\u884c\u5176\u4ed6\u7ebf\u7a0b\uff09\u3002\u5426\u5219\uff0c\u81ea\u65cb\u9501\u5728\u5355 CPU \u4e0a\u65e0\u6cd5\u4f7f\u7528\uff0c\u56e0\u4e3a\u4e00\u4e2a\u81ea\u65cb\u7684\u7ebf\u7a0b\u6c38\u8fdc\u4e0d\u4f1a\u653e\u5f03 CPU\u3002</p> <p>\u81ea\u65cb\u9501\u5f00\u9500\u5c11\uff0c\u5728\u591a\u6838\u7cfb\u7edf\u4e0b\u4e00\u822c\u4e0d\u4f1a\u4e3b\u52a8\u4ea7\u751f\u7ebf\u7a0b\u5207\u6362\uff0c\u9002\u5408\u5f02\u6b65\u3001\u534f\u7a0b\u7b49\u5728\u7528\u6237\u6001\u5207\u6362\u8bf7\u6c42\u7684\u7f16\u7a0b\u65b9\u5f0f\uff0c\u4f46\u5982\u679c\u88ab\u9501\u4f4f\u7684\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u8fc7\u957f\uff0c\u81ea\u65cb\u7684\u7ebf\u7a0b\u4f1a\u957f\u65f6\u95f4\u5360\u7528 CPU \u8d44\u6e90\uff0c\u6240\u4ee5\u81ea\u65cb\u7684\u65f6\u95f4\u548c\u88ab\u9501\u4f4f\u7684\u4ee3\u7801\u6267\u884c\u7684\u65f6\u95f4\u662f\u6210\u300c\u6b63\u6bd4\u300d\u7684\u5173\u7cfb\uff0c\u6211\u4eec\u9700\u8981\u6e05\u695a\u7684\u77e5\u9053\u8fd9\u4e00\u70b9\u3002</p> <p>\u81ea\u65cb\u9501\u4e0e\u4e92\u65a5\u9501\u4f7f\u7528\u5c42\u9762\u6bd4\u8f83\u76f8\u4f3c\uff0c\u4f46\u5b9e\u73b0\u5c42\u9762\u4e0a\u5b8c\u5168\u4e0d\u540c\uff1a\u5f53\u52a0\u9501\u5931\u8d25\u65f6\uff0c\u4e92\u65a5\u9501\u7528\u300c\u7ebf\u7a0b\u5207\u6362\u300d\u6765\u5e94\u5bf9\uff0c\u81ea\u65cb\u9501\u5219\u7528\u300c\u5fd9\u7b49\u5f85\u300d\u6765\u5e94\u5bf9\u3002</p> <p>\u5b83\u4fe9\u662f\u9501\u7684\u6700\u57fa\u672c\u5904\u7406\u65b9\u5f0f\uff0c\u66f4\u9ad8\u7ea7\u7684\u9501\u90fd\u4f1a\u9009\u62e9\u5176\u4e2d\u4e00\u4e2a\u6765\u5b9e\u73b0\uff0c\u6bd4\u5982\u8bfb\u5199\u9501\u65e2\u53ef\u4ee5\u9009\u62e9\u4e92\u65a5\u9501\u5b9e\u73b0\uff0c\u4e5f\u53ef\u4ee5\u57fa\u4e8e\u81ea\u65cb\u9501\u5b9e\u73b0\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/pessim_and_optimi_lock/#_2","title":"\u8bfb\u5199\u9501","text":"<p>\u8bfb\u5199\u9501\u4ece\u5b57\u9762\u610f\u601d\u6211\u4eec\u4e5f\u53ef\u4ee5\u77e5\u9053\uff0c\u5b83\u7531\u300c\u8bfb\u9501\u300d\u548c\u300c\u5199\u9501\u300d\u4e24\u90e8\u5206\u6784\u6210\uff0c\u5982\u679c\u53ea\u8bfb\u53d6\u5171\u4eab\u8d44\u6e90\u7528\u300c\u8bfb\u9501\u300d\u52a0\u9501\uff0c\u5982\u679c\u8981\u4fee\u6539\u5171\u4eab\u8d44\u6e90\u5219\u7528\u300c\u5199\u9501\u300d\u52a0\u9501\u3002</p> <p>\u6240\u4ee5\uff0c\u8bfb\u5199\u9501\u9002\u7528\u4e8e\u80fd\u660e\u786e\u533a\u5206\u8bfb\u64cd\u4f5c\u548c\u5199\u64cd\u4f5c\u7684\u573a\u666f\u3002</p> <p>\u8bfb\u5199\u9501\u7684\u5de5\u4f5c\u539f\u7406\u662f\uff1a</p> <ul> <li>\u5f53\u300c\u5199\u9501\u300d\u6ca1\u6709\u88ab\u7ebf\u7a0b\u6301\u6709\u65f6\uff0c\u591a\u4e2a\u7ebf\u7a0b\u80fd\u591f\u5e76\u53d1\u5730\u6301\u6709\u8bfb\u9501\uff0c\u8fd9\u5927\u5927\u63d0\u9ad8\u4e86\u5171\u4eab\u8d44\u6e90\u7684\u8bbf\u95ee\u6548\u7387\uff0c\u56e0\u4e3a\u300c\u8bfb\u9501\u300d\u662f\u7528\u4e8e\u8bfb\u53d6\u5171\u4eab\u8d44\u6e90\u7684\u573a\u666f\uff0c\u6240\u4ee5\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6301\u6709\u8bfb\u9501\u4e5f\u4e0d\u4f1a\u7834\u574f\u5171\u4eab\u8d44\u6e90\u7684\u6570\u636e\u3002</li> <li>\u4f46\u662f\uff0c\u4e00\u65e6\u300c\u5199\u9501\u300d\u88ab\u7ebf\u7a0b\u6301\u6709\u540e\uff0c\u8bfb\u7ebf\u7a0b\u7684\u83b7\u53d6\u8bfb\u9501\u7684\u64cd\u4f5c\u4f1a\u88ab\u963b\u585e\uff0c\u800c\u4e14\u5176\u4ed6\u5199\u7ebf\u7a0b\u7684\u83b7\u53d6\u5199\u9501\u7684\u64cd\u4f5c\u4e5f\u4f1a\u88ab\u963b\u585e\u3002</li> </ul> <p>\u6240\u4ee5\u8bf4\uff0c\u5199\u9501\u662f\u72ec\u5360\u9501\uff0c\u56e0\u4e3a\u4efb\u4f55\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u7ebf\u7a0b\u6301\u6709\u5199\u9501\uff0c\u7c7b\u4f3c\u4e92\u65a5\u9501\u548c\u81ea\u65cb\u9501\uff0c\u800c\u8bfb\u9501\u662f\u5171\u4eab\u9501\uff0c\u56e0\u4e3a\u8bfb\u9501\u53ef\u4ee5\u88ab\u591a\u4e2a\u7ebf\u7a0b\u540c\u65f6\u6301\u6709\u3002</p> <p>\u77e5\u9053\u4e86\u8bfb\u5199\u9501\u7684\u5de5\u4f5c\u539f\u7406\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u8bfb\u5199\u9501\u5728\u8bfb\u591a\u5199\u5c11\u7684\u573a\u666f\uff0c\u80fd\u53d1\u6325\u51fa\u4f18\u52bf\u3002</p> <p>\u53e6\u5916\uff0c\u6839\u636e\u5b9e\u73b0\u7684\u4e0d\u540c\uff0c\u8bfb\u5199\u9501\u53ef\u4ee5\u5206\u4e3a\u300c\u8bfb\u4f18\u5148\u9501\u300d\u548c\u300c\u5199\u4f18\u5148\u9501\u300d\u3002</p> <p>\u8bfb\u4f18\u5148\u9501\u671f\u671b\u7684\u662f\uff0c\u8bfb\u9501\u80fd\u88ab\u66f4\u591a\u7684\u7ebf\u7a0b\u6301\u6709\uff0c\u4ee5\u4fbf\u63d0\u9ad8\u8bfb\u7ebf\u7a0b\u7684\u5e76\u53d1\u6027\uff0c\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\uff1a\u5f53\u8bfb\u7ebf\u7a0b A \u5148\u6301\u6709\u4e86\u8bfb\u9501\uff0c\u5199\u7ebf\u7a0b B \u5728\u83b7\u53d6\u5199\u9501\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u963b\u585e\uff0c\u5e76\u4e14\u5728\u963b\u585e\u8fc7\u7a0b\u4e2d\uff0c\u540e\u7eed\u6765\u7684\u8bfb\u7ebf\u7a0b C \u4ecd\u7136\u53ef\u4ee5\u6210\u529f\u83b7\u53d6\u8bfb\u9501\uff0c\u6700\u540e\u76f4\u5230\u8bfb\u7ebf\u7a0b A \u548c C \u91ca\u653e\u8bfb\u9501\u540e\uff0c\u5199\u7ebf\u7a0b B \u624d\u53ef\u4ee5\u6210\u529f\u83b7\u53d6\u5199\u9501\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u800c\u300c\u5199\u4f18\u5148\u9501\u300d\u662f\u4f18\u5148\u670d\u52a1\u5199\u7ebf\u7a0b\uff0c\u5176\u5de5\u4f5c\u65b9\u5f0f\u662f\uff1a\u5f53\u8bfb\u7ebf\u7a0b A \u5148\u6301\u6709\u4e86\u8bfb\u9501\uff0c\u5199\u7ebf\u7a0b B \u5728\u83b7\u53d6\u5199\u9501\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u963b\u585e\uff0c\u5e76\u4e14\u5728\u963b\u585e\u8fc7\u7a0b\u4e2d\uff0c\u540e\u7eed\u6765\u7684\u8bfb\u7ebf\u7a0b C \u83b7\u53d6\u8bfb\u9501\u65f6\u4f1a\u5931\u8d25\uff0c\u4e8e\u662f\u8bfb\u7ebf\u7a0b C \u5c06\u88ab\u963b\u585e\u5728\u83b7\u53d6\u8bfb\u9501\u7684\u64cd\u4f5c\uff0c\u8fd9\u6837\u53ea\u8981\u8bfb\u7ebf\u7a0b A \u91ca\u653e\u8bfb\u9501\u540e\uff0c\u5199\u7ebf\u7a0b B \u5c31\u53ef\u4ee5\u6210\u529f\u83b7\u53d6\u5199\u9501\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8bfb\u4f18\u5148\u9501\u5bf9\u4e8e\u8bfb\u7ebf\u7a0b\u5e76\u53d1\u6027\u66f4\u597d\uff0c\u4f46\u4e5f\u4e0d\u662f\u6ca1\u6709\u95ee\u9898\u3002\u6211\u4eec\u8bd5\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u4e00\u76f4\u6709\u8bfb\u7ebf\u7a0b\u83b7\u53d6\u8bfb\u9501\uff0c\u90a3\u4e48\u5199\u7ebf\u7a0b\u5c06\u6c38\u8fdc\u83b7\u53d6\u4e0d\u5230\u5199\u9501\uff0c\u8fd9\u5c31\u9020\u6210\u4e86\u5199\u7ebf\u7a0b\u300c\u9965\u997f\u300d\u7684\u73b0\u8c61\u3002</p> <p>\u5199\u4f18\u5148\u9501\u53ef\u4ee5\u4fdd\u8bc1\u5199\u7ebf\u7a0b\u4e0d\u4f1a\u997f\u6b7b\uff0c\u4f46\u662f\u5982\u679c\u4e00\u76f4\u6709\u5199\u7ebf\u7a0b\u83b7\u53d6\u5199\u9501\uff0c\u8bfb\u7ebf\u7a0b\u4e5f\u4f1a\u88ab\u300c\u997f\u6b7b\u300d\u3002</p> <p>\u65e2\u7136\u4e0d\u7ba1\u4f18\u5148\u8bfb\u9501\u8fd8\u662f\u5199\u9501\uff0c\u5bf9\u65b9\u53ef\u80fd\u4f1a\u51fa\u73b0\u997f\u6b7b\u95ee\u9898\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u4e0d\u504f\u8892\u4efb\u4f55\u4e00\u65b9\uff0c\u641e\u4e2a\u300c\u516c\u5e73\u8bfb\u5199\u9501\u300d\u3002</p> <p>\u516c\u5e73\u8bfb\u5199\u9501\u6bd4\u8f83\u7b80\u5355\u7684\u4e00\u79cd\u65b9\u5f0f\u662f\uff1a\u7528\u961f\u5217\u628a\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u6392\u961f\uff0c\u4e0d\u7ba1\u662f\u5199\u7ebf\u7a0b\u8fd8\u662f\u8bfb\u7ebf\u7a0b\u90fd\u6309\u7167\u5148\u8fdb\u5148\u51fa\u7684\u539f\u5219\u52a0\u9501\u5373\u53ef\uff0c\u8fd9\u6837\u8bfb\u7ebf\u7a0b\u4ecd\u7136\u53ef\u4ee5\u5e76\u53d1\uff0c\u4e5f\u4e0d\u4f1a\u51fa\u73b0\u300c\u9965\u997f\u300d\u7684\u73b0\u8c61\u3002</p> <p>\u4e92\u65a5\u9501\u548c\u81ea\u65cb\u9501\u90fd\u662f\u6700\u57fa\u672c\u7684\u9501\uff0c\u8bfb\u5199\u9501\u53ef\u4ee5\u6839\u636e\u573a\u666f\u6765\u9009\u62e9\u8fd9\u4e24\u79cd\u9501\u5176\u4e2d\u7684\u4e00\u4e2a\u8fdb\u884c\u5b9e\u73b0\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/pessim_and_optimi_lock/#_3","title":"\u4e50\u89c2\u9501\u4e0e\u60b2\u89c2\u9501","text":"<p>\u524d\u9762\u63d0\u5230\u7684\u4e92\u65a5\u9501\u3001\u81ea\u65cb\u9501\u3001\u8bfb\u5199\u9501\uff0c\u90fd\u662f\u5c5e\u4e8e\u60b2\u89c2\u9501\u3002</p> <p>\u60b2\u89c2\u9501\u505a\u4e8b\u6bd4\u8f83\u60b2\u89c2\uff0c\u5b83\u8ba4\u4e3a\u591a\u7ebf\u7a0b\u540c\u65f6\u4fee\u6539\u5171\u4eab\u8d44\u6e90\u7684\u6982\u7387\u6bd4\u8f83\u9ad8\uff0c\u4e8e\u662f\u5f88\u5bb9\u6613\u51fa\u73b0\u51b2\u7a81\uff0c\u6240\u4ee5\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u524d\uff0c\u5148\u8981\u4e0a\u9501\u3002</p> <p>\u90a3\u76f8\u53cd\u7684\uff0c\u5982\u679c\u591a\u7ebf\u7a0b\u540c\u65f6\u4fee\u6539\u5171\u4eab\u8d44\u6e90\u7684\u6982\u7387\u6bd4\u8f83\u4f4e\uff0c\u5c31\u53ef\u4ee5\u91c7\u7528\u4e50\u89c2\u9501\u3002</p> <p>\u4e50\u89c2\u9501\u505a\u4e8b\u6bd4\u8f83\u4e50\u89c2\uff0c\u5b83\u5047\u5b9a\u51b2\u7a81\u7684\u6982\u7387\u5f88\u4f4e\uff0c\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\uff1a\u5148\u4fee\u6539\u5b8c\u5171\u4eab\u8d44\u6e90\uff0c\u518d\u9a8c\u8bc1\u8fd9\u6bb5\u65f6\u95f4\u5185\u6709\u6ca1\u6709\u53d1\u751f\u51b2\u7a81\uff0c\u5982\u679c\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u5728\u4fee\u6539\u8d44\u6e90\uff0c\u90a3\u4e48\u64cd\u4f5c\u5b8c\u6210\uff0c\u5982\u679c\u53d1\u73b0\u6709\u5176\u4ed6\u7ebf\u7a0b\u5df2\u7ecf\u4fee\u6539\u8fc7\u8fd9\u4e2a\u8d44\u6e90\uff0c\u5c31\u653e\u5f03\u672c\u6b21\u64cd\u4f5c\u3002</p> <p>\u653e\u5f03\u540e\u5982\u4f55\u91cd\u8bd5\uff0c\u8fd9\u8ddf\u4e1a\u52a1\u573a\u666f\u606f\u606f\u76f8\u5173\uff0c\u867d\u7136\u91cd\u8bd5\u7684\u6210\u672c\u5f88\u9ad8\uff0c\u4f46\u662f\u51b2\u7a81\u7684\u6982\u7387\u8db3\u591f\u4f4e\u7684\u8bdd\uff0c\u8fd8\u662f\u53ef\u4ee5\u63a5\u53d7\u7684\u3002</p> <p>\u53ef\u89c1\uff0c\u4e50\u89c2\u9501\u7684\u5fc3\u6001\u662f\uff0c\u4e0d\u7ba1\u4e09\u4e03\u4e8c\u5341\u4e00\uff0c\u5148\u6539\u4e86\u8d44\u6e90\u518d\u8bf4\u3002\u53e6\u5916\uff0c\u4f60\u4f1a\u53d1\u73b0\u4e50\u89c2\u9501\u5168\u7a0b\u5e76\u6ca1\u6709\u52a0\u9501\uff0c\u6240\u4ee5\u5b83\u4e5f\u53eb\u65e0\u9501\u7f16\u7a0b\u3002</p> <p>\u8fd9\u91cc\u4e3e\u4e00\u4e2a\u573a\u666f\u4f8b\u5b50\uff1a\u5728\u7ebf\u6587\u6863\u3002</p> <p>\u6211\u4eec\u90fd\u77e5\u9053\u5728\u7ebf\u6587\u6863\u53ef\u4ee5\u540c\u65f6\u591a\u4eba\u7f16\u8f91\u7684\uff0c\u5982\u679c\u4f7f\u7528\u4e86\u60b2\u89c2\u9501\uff0c\u90a3\u4e48\u53ea\u8981\u6709\u4e00\u4e2a\u7528\u6237\u6b63\u5728\u7f16\u8f91\u6587\u6863\uff0c\u6b64\u65f6\u5176\u4ed6\u7528\u6237\u5c31\u65e0\u6cd5\u6253\u5f00\u76f8\u540c\u7684\u6587\u6863\u4e86\uff0c\u8fd9\u7528\u6237\u4f53\u9a8c\u5f53\u7136\u4e0d\u597d\u4e86\u3002</p> <p>\u90a3\u5b9e\u73b0\u591a\u4eba\u540c\u65f6\u7f16\u8f91\uff0c\u5b9e\u9645\u4e0a\u662f\u7528\u4e86\u4e50\u89c2\u9501\uff0c\u5b83\u5141\u8bb8\u591a\u4e2a\u7528\u6237\u6253\u5f00\u540c\u4e00\u4e2a\u6587\u6863\u8fdb\u884c\u7f16\u8f91\uff0c\u7f16\u8f91\u5b8c\u63d0\u4ea4\u4e4b\u540e\u624d\u9a8c\u8bc1\u4fee\u6539\u7684\u5185\u5bb9\u662f\u5426\u6709\u51b2\u7a81\u3002</p> <p>\u600e\u4e48\u6837\u624d\u7b97\u53d1\u751f\u51b2\u7a81\uff1f\u8fd9\u91cc\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u7528\u6237 A \u5148\u5728\u6d4f\u89c8\u5668\u7f16\u8f91\u6587\u6863\uff0c\u4e4b\u540e\u7528\u6237 B \u5728\u6d4f\u89c8\u5668\u4e5f\u6253\u5f00\u4e86\u76f8\u540c\u7684\u6587\u6863\u8fdb\u884c\u7f16\u8f91\uff0c\u4f46\u662f\u7528\u6237 B \u6bd4\u7528\u6237 A \u63d0\u4ea4\u65e9\uff0c\u8fd9\u4e00\u8fc7\u7a0b\u7528\u6237 A \u662f\u4e0d\u77e5\u9053\u7684\uff0c\u5f53 A \u63d0\u4ea4\u4fee\u6539\u5b8c\u7684\u5185\u5bb9\u65f6\uff0c\u90a3\u4e48 A \u548c B \u4e4b\u95f4\u5e76\u884c\u4fee\u6539\u7684\u5730\u65b9\u5c31\u4f1a\u53d1\u751f\u51b2\u7a81\u3002</p> <p>\u670d\u52a1\u7aef\u8981\u600e\u4e48\u9a8c\u8bc1\u662f\u5426\u51b2\u7a81\u4e86\u5462\uff1f\u901a\u5e38\u65b9\u6848\u5982\u4e0b\uff1a</p> <ul> <li>\u7531\u4e8e\u53d1\u751f\u51b2\u7a81\u7684\u6982\u7387\u6bd4\u8f83\u4f4e\uff0c\u6240\u4ee5\u5148\u8ba9\u7528\u6237\u7f16\u8f91\u6587\u6863\uff0c\u4f46\u662f\u6d4f\u89c8\u5668\u5728\u4e0b\u8f7d\u6587\u6863\u65f6\u4f1a\u8bb0\u5f55\u4e0b\u670d\u52a1\u7aef\u8fd4\u56de\u7684\u6587\u6863\u7248\u672c\u53f7\uff1b</li> <li>\u5f53\u7528\u6237\u63d0\u4ea4\u4fee\u6539\u65f6\uff0c\u53d1\u7ed9\u670d\u52a1\u7aef\u7684\u8bf7\u6c42\u4f1a\u5e26\u4e0a\u539f\u59cb\u6587\u6863\u7248\u672c\u53f7\uff0c\u670d\u52a1\u5668\u6536\u5230\u540e\u5c06\u5b83\u4e0e\u5f53\u524d\u7248\u672c\u53f7\u8fdb\u884c\u6bd4\u8f83\uff0c\u5982\u679c\u7248\u672c\u53f7\u4e0d\u4e00\u81f4\u5219\u63d0\u4ea4\u5931\u8d25\uff0c\u5982\u679c\u7248\u672c\u53f7\u4e00\u81f4\u5219\u4fee\u6539\u6210\u529f\uff0c\u7136\u540e\u670d\u52a1\u7aef\u7248\u672c\u53f7\u66f4\u65b0\u5230\u6700\u65b0\u7684\u7248\u672c\u53f7\u3002</li> </ul> <p>\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u5e38\u89c1\u7684 SVN \u548c Git \u4e5f\u662f\u7528\u4e86\u4e50\u89c2\u9501\u7684\u601d\u60f3\uff0c\u5148\u8ba9\u7528\u6237\u7f16\u8f91\u4ee3\u7801\uff0c\u7136\u540e\u63d0\u4ea4\u7684\u65f6\u5019\uff0c\u901a\u8fc7\u7248\u672c\u53f7\u6765\u5224\u65ad\u662f\u5426\u4ea7\u751f\u4e86\u51b2\u7a81\uff0c\u53d1\u751f\u4e86\u51b2\u7a81\u7684\u5730\u65b9\uff0c\u9700\u8981\u6211\u4eec\u81ea\u5df1\u4fee\u6539\u540e\uff0c\u518d\u91cd\u65b0\u63d0\u4ea4\u3002</p> <p>\u4e50\u89c2\u9501\u867d\u7136\u53bb\u9664\u4e86\u52a0\u9501\u89e3\u9501\u7684\u64cd\u4f5c\uff0c\u4f46\u662f\u4e00\u65e6\u53d1\u751f\u51b2\u7a81\uff0c\u91cd\u8bd5\u7684\u6210\u672c\u975e\u5e38\u9ad8\uff0c\u6240\u4ee5\u53ea\u6709\u5728\u51b2\u7a81\u6982\u7387\u975e\u5e38\u4f4e\uff0c\u4e14\u52a0\u9501\u6210\u672c\u975e\u5e38\u9ad8\u7684\u573a\u666f\u65f6\uff0c\u624d\u8003\u8651\u4f7f\u7528\u4e50\u89c2\u9501\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/pessim_and_optimi_lock/#_4","title":"\u603b\u7ed3","text":"<p>\u5f00\u53d1\u8fc7\u7a0b\u4e2d\uff0c\u6700\u5e38\u89c1\u7684\u5c31\u662f\u4e92\u65a5\u9501\u7684\u4e86\uff0c\u4e92\u65a5\u9501\u52a0\u9501\u5931\u8d25\u65f6\uff0c\u4f1a\u7528\u300c\u7ebf\u7a0b\u5207\u6362\u300d\u6765\u5e94\u5bf9\uff0c\u5f53\u52a0\u9501\u5931\u8d25\u7684\u7ebf\u7a0b\u518d\u6b21\u52a0\u9501\u6210\u529f\u540e\u7684\u8fd9\u4e00\u8fc7\u7a0b\uff0c\u4f1a\u6709\u4e24\u6b21\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6210\u672c\uff0c\u6027\u80fd\u635f\u8017\u6bd4\u8f83\u5927\u3002</p> <p>\u5982\u679c\u6211\u4eec\u660e\u786e\u77e5\u9053\u88ab\u9501\u4f4f\u7684\u4ee3\u7801\u7684\u6267\u884c\u65f6\u95f4\u5f88\u77ed\uff0c\u90a3\u6211\u4eec\u5e94\u8be5\u9009\u62e9\u5f00\u9500\u6bd4\u8f83\u5c0f\u7684\u81ea\u65cb\u9501\uff0c\u56e0\u4e3a\u81ea\u65cb\u9501\u52a0\u9501\u5931\u8d25\u65f6\uff0c\u5e76\u4e0d\u4f1a\u4e3b\u52a8\u4ea7\u751f\u7ebf\u7a0b\u5207\u6362\uff0c\u800c\u662f\u4e00\u76f4\u5fd9\u7b49\u5f85\uff0c\u76f4\u5230\u83b7\u53d6\u5230\u9501\uff0c\u90a3\u4e48\u5982\u679c\u88ab\u9501\u4f4f\u7684\u4ee3\u7801\u6267\u884c\u65f6\u95f4\u5f88\u77ed\uff0c\u90a3\u8fd9\u4e2a\u5fd9\u7b49\u5f85\u7684\u65f6\u95f4\u76f8\u5bf9\u5e94\u4e5f\u5f88\u77ed\u3002</p> <p>\u5982\u679c\u80fd\u533a\u5206\u8bfb\u64cd\u4f5c\u548c\u5199\u64cd\u4f5c\u7684\u573a\u666f\uff0c\u90a3\u8bfb\u5199\u9501\u5c31\u66f4\u5408\u9002\u4e86\uff0c\u5b83\u5141\u8bb8\u591a\u4e2a\u8bfb\u7ebf\u7a0b\u53ef\u4ee5\u540c\u65f6\u6301\u6709\u8bfb\u9501\uff0c\u63d0\u9ad8\u4e86\u8bfb\u7684\u5e76\u53d1\u6027\u3002\u6839\u636e\u504f\u8892\u8bfb\u65b9\u8fd8\u662f\u5199\u65b9\uff0c\u53ef\u4ee5\u5206\u4e3a\u8bfb\u4f18\u5148\u9501\u548c\u5199\u4f18\u5148\u9501\uff0c\u8bfb\u4f18\u5148\u9501\u5e76\u53d1\u6027\u5f88\u5f3a\uff0c\u4f46\u662f\u5199\u7ebf\u7a0b\u4f1a\u88ab\u997f\u6b7b\uff0c\u800c\u5199\u4f18\u5148\u9501\u4f1a\u4f18\u5148\u670d\u52a1\u5199\u7ebf\u7a0b\uff0c\u8bfb\u7ebf\u7a0b\u4e5f\u53ef\u80fd\u4f1a\u88ab\u997f\u6b7b\uff0c\u90a3\u4e3a\u4e86\u907f\u514d\u9965\u997f\u7684\u95ee\u9898\uff0c\u4e8e\u662f\u5c31\u6709\u4e86\u516c\u5e73\u8bfb\u5199\u9501\uff0c\u5b83\u662f\u7528\u961f\u5217\u628a\u8bf7\u6c42\u9501\u7684\u7ebf\u7a0b\u6392\u961f\uff0c\u5e76\u4fdd\u8bc1\u5148\u5165\u5148\u51fa\u7684\u539f\u5219\u6765\u5bf9\u7ebf\u7a0b\u52a0\u9501\uff0c\u8fd9\u6837\u4fbf\u4fdd\u8bc1\u4e86\u67d0\u79cd\u7ebf\u7a0b\u4e0d\u4f1a\u88ab\u997f\u6b7b\uff0c\u901a\u7528\u6027\u4e5f\u66f4\u597d\u70b9\u3002</p> <p>\u4e92\u65a5\u9501\u548c\u81ea\u65cb\u9501\u90fd\u662f\u6700\u57fa\u672c\u7684\u9501\uff0c\u8bfb\u5199\u9501\u53ef\u4ee5\u6839\u636e\u573a\u666f\u6765\u9009\u62e9\u8fd9\u4e24\u79cd\u9501\u5176\u4e2d\u7684\u4e00\u4e2a\u8fdb\u884c\u5b9e\u73b0\u3002</p> <p>\u53e6\u5916\uff0c\u4e92\u65a5\u9501\u3001\u81ea\u65cb\u9501\u3001\u8bfb\u5199\u9501\u90fd\u5c5e\u4e8e\u60b2\u89c2\u9501\uff0c\u60b2\u89c2\u9501\u8ba4\u4e3a\u5e76\u53d1\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u65f6\uff0c\u51b2\u7a81\u6982\u7387\u53ef\u80fd\u975e\u5e38\u9ad8\uff0c\u6240\u4ee5\u5728\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u524d\uff0c\u90fd\u9700\u8981\u5148\u52a0\u9501\u3002</p> <p>\u76f8\u53cd\u7684\uff0c\u5982\u679c\u5e76\u53d1\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u65f6\uff0c\u51b2\u7a81\u6982\u7387\u975e\u5e38\u4f4e\u7684\u8bdd\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e50\u89c2\u9501\uff0c\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\uff0c\u5728\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\u65f6\uff0c\u4e0d\u7528\u5148\u52a0\u9501\uff0c\u4fee\u6539\u5b8c\u5171\u4eab\u8d44\u6e90\u540e\uff0c\u518d\u9a8c\u8bc1\u8fd9\u6bb5\u65f6\u95f4\u5185\u6709\u6ca1\u6709\u53d1\u751f\u51b2\u7a81\uff0c\u5982\u679c\u6ca1\u6709\u5176\u4ed6\u7ebf\u7a0b\u5728\u4fee\u6539\u8d44\u6e90\uff0c\u90a3\u4e48\u64cd\u4f5c\u5b8c\u6210\uff0c\u5982\u679c\u53d1\u73b0\u6709\u5176\u4ed6\u7ebf\u7a0b\u5df2\u7ecf\u4fee\u6539\u8fc7\u8fd9\u4e2a\u8d44\u6e90\uff0c\u5c31\u653e\u5f03\u672c\u6b21\u64cd\u4f5c\u3002</p> <p>\u4f46\u662f\uff0c\u4e00\u65e6\u51b2\u7a81\u6982\u7387\u4e0a\u5347\uff0c\u5c31\u4e0d\u9002\u5408\u4f7f\u7528\u4e50\u89c2\u9501\u4e86\uff0c\u56e0\u4e3a\u5b83\u89e3\u51b3\u51b2\u7a81\u7684\u91cd\u8bd5\u6210\u672c\u975e\u5e38\u9ad8\u3002</p> <p>\u4e0d\u7ba1\u4f7f\u7528\u7684\u54ea\u79cd\u9501\uff0c\u6211\u4eec\u7684\u52a0\u9501\u7684\u4ee3\u7801\u8303\u56f4\u5e94\u8be5\u5c3d\u53ef\u80fd\u7684\u5c0f\uff0c\u4e5f\u5c31\u662f\u52a0\u9501\u7684\u7c92\u5ea6\u8981\u5c0f\uff0c\u8fd9\u6837\u6267\u884c\u901f\u5ea6\u4f1a\u6bd4\u8f83\u5feb\u3002\u518d\u6765\uff0c\u4f7f\u7528\u4e0a\u4e86\u5408\u9002\u7684\u9501\uff0c\u5c31\u4f1a\u5feb\u4e0a\u52a0\u5feb\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/pessim_and_optimi_lock/#_5","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>CAS \u4e0d\u662f\u4e50\u89c2\u9501\u5417\uff0c\u4e3a\u4ec0\u4e48\u57fa\u4e8e CAS \u5b9e\u73b0\u7684\u81ea\u65cb\u9501\u662f\u60b2\u89c2\u9501\uff1f</p> <p>\u4e50\u89c2\u9501\u662f\u5148\u4fee\u6539\u540c\u6b65\u8d44\u6e90\uff0c\u518d\u9a8c\u8bc1\u6709\u6ca1\u6709\u53d1\u751f\u51b2\u7a81\u3002</p> <p>\u60b2\u89c2\u9501\u662f\u4fee\u6539\u5171\u4eab\u6570\u636e\u524d\uff0c\u90fd\u8981\u5148\u52a0\u9501\uff0c\u9632\u6b62\u7ade\u4e89\u3002</p> <p>CAS \u662f\u4e50\u89c2\u9501\u6ca1\u9519\uff0c\u4f46\u662f CAS \u548c\u81ea\u65cb\u9501\u4e0d\u540c\u4e4b\u5904\uff0c\u81ea\u65cb\u9501\u57fa\u4e8e CAS \u52a0\u4e86 while \u6216\u8005\u7761\u7720 CPU \u7684\u64cd\u4f5c\u800c\u4ea7\u751f\u81ea\u65cb\u7684\u6548\u679c\uff0c\u52a0\u9501\u5931\u8d25\u4f1a\u5fd9\u7b49\u5f85\u76f4\u5230\u62ff\u5230\u9501\uff0c\u81ea\u65cb\u9501\u662f\u8981\u9700\u8981\u4e8b\u5148\u62ff\u5230\u9501\u624d\u80fd\u4fee\u6539\u6570\u636e\u7684\uff0c\u6240\u4ee5\u7b97\u60b2\u89c2\u9501\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/pessim_and_optimi_lock/#_6","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u8fd9\u5468\u672b\u5fd9\u91cc\u5077\u95f2\u4e86\u4e0b\uff0c\u770b\u4e86\u4e09\u90e8\u7535\u5f71\uff0c\u7b80\u5355\u8bf4\u4e00\u4e0b\u611f\u53d7\u3002</p> <p>\u9996\u5148\u770b\u4e86\u300c\u5229\u5203\u51fa\u9798\u300d\uff0c\u8fd9\u90e8\u7535\u5f71\u662f\u60ac\u7591\u7c7b\u578b\uff0c\u4e5f\u662f\u8c46\u74e3\u9ad8\u5206\u7535\u5f71\uff0c\u7535\u5f71\u867d\u7136\u6ca1\u6709\u4ec0\u4e48\u5927\u573a\u9762\uff0c\u4f46\u662f\u5355\u7eaf\u9760\u7f1c\u5bc6\u7684\u5267\u60c5\u94fa\u8bbe\uff0c\u5168\u7a0b\u65e0\u5c3f\u70b9\uff0c\u7ed3\u5c3e\u4e5f\u5404\u79cd\u7ffb\u8f6c\uff0c\u5982\u679c\u559c\u6b22\u60ac\u7591\u7c7b\u7535\u5f71\u670b\u53cb\uff0c\u4e0d\u59a8\u62bd\u4e2a\u65f6\u95f4\u770b\u770b\u3002</p> <p>\u518d\u6765\uff0c\u770b\u4e86\u300c\u82b1\u6728\u5170\u300d\uff0c\u8fd9\u7535\u5f71\u6211\u7279\u55b5\u65e0\u6cd5\u53ef\u8bf4\uff0c\u70c2\u7247\u4e2d\u7684\u6218\u6597\u9e21\uff0c\u6f14\u5458\u90fd\u662f\u4e2d\u56fd\u4eba\u5374\u5168\u5728\u8bf4\u82f1\u6587\uff08\u5bfc\u6f14\u662f\u7f8e\u56fd\u8fea\u58eb\u5c3c\u7684\uff09\uff0c\u8fd9\u79cd\u611f\u89c9\u5c31\u5f88\u5947\u602a\u5f88\u522b\u626d\uff0c\u597d\u6bd4\u4f60\u770b\u897f\u6e38\u8bb0\u3001\u6c34\u6d52\u4f20\u82f1\u6587\u7248\u90a3\u6837\u7684\u522b\u626d\u3002\u522b\u626d\u4e5f\u5c31\u7b97\u4e86\uff0c\u5173\u952e\u5267\u60c5\u5e73\u6de1\u65e0\u5947\uff0c\u5404\u79cd\u65e0\u5398\u5934\u7684\u5730\u65b9\uff0c\u53cd\u6b63\u770b\u5b8c\u4e4b\u540e\uff0c\u6211\u975e\u5e38\u540e\u6094\u628a\u6211\u751f\u547d\u4e2d\u975e\u5e38\u73cd\u8d35\u7684 2 \u4e2a\u5c0f\u65f6\u732e\u7ed9\u4e86\u5b83\uff0c\u5982\u679c\u80fd\u91cd\u6765\uff0c\u6211\u9009\u62e9\u7528\u8fd9 2 \u5c0f\u65f6\u7761\u89c9\u3002</p> <p>\u6700\u540e\uff0c\u5f53\u7136\u770b\u4e86\u300c\u4fe1\u6761\u300d\uff0c\u8bfa\u5170\u7528\u5de8\u8d44\u62cd\u6444\u51fa\u6765\u7684\u7535\u5f71\uff0c\u82b1\u94b1\u4e70\u98de\u673a\u6765\u649e\uff0c\u753b\u9762\u975e\u5e38\u9707\u64bc\uff0c\u53ef\u4ee5\u8bf4\u975e\u5e38\u6709\u8bda\u610f\u4e86\u3002\u8bfa\u5170\u949f\u7231\u65f6\u95f4\u7684\u6982\u5ff5\uff0c\u8fd9\u6b21\u5219\u4ee5\u65f6\u95f4\u5012\u6d41\u65b9\u5f0f\u6765\u5448\u73b0\uff0c\u975e\u5e38\u7684\u70e7\u8111\uff0c\u53cd\u6b63\u6211\u770b\u5b8c\u540e\u8111\u888b\u61f5\u61f5\u7684\uff0c\u6211\u5c31\u662f\u8981\u8fd9\u79cd\u611f\u89c9\uff0c\u563b\u563b\u3002</p> <p></p> <p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u4e00\u4e2a\u4e13\u4e3a\u5927\u5bb6\u56fe\u89e3\u7684\u5de5\u5177\u4eba\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5206\u4eab\u7ed9\u4f60\u7684\u670b\u53cb\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/","title":"5.1 \u8fdb\u7a0b\u3001\u7ebf\u7a0b\u57fa\u7840\u77e5\u8bc6","text":"<p>\u5148\u6765\u770b\u770b\u4e00\u5219\u5c0f\u6545\u4e8b</p> <p>\u6211\u4eec\u5199\u597d\u7684\u4e00\u884c\u884c\u4ee3\u7801\uff0c\u4e3a\u4e86\u8ba9\u5176\u5de5\u4f5c\u8d77\u6765\uff0c\u6211\u4eec\u8fd8\u5f97\u628a\u5b83\u9001\u8fdb\u57ce\uff08\u8fdb\u7a0b\uff09\u91cc\uff0c\u90a3\u65e2\u7136\u8fdb\u4e86\u57ce\u91cc\uff0c\u90a3\u80af\u5b9a\u4e0d\u80fd\u80e1\u4f5c\u975e\u4e3a\u4e86\u3002</p> <p>\u57ce\u91cc\u4eba\u6709\u57ce\u91cc\u4eba\u7684\u89c4\u77e9\uff0c\u57ce\u4e2d\u6709\u4e2a\u4e13\u95e8\u7ba1\u8f96\u4f60\u4eec\u7684\u57ce\u7ba1\uff08\u64cd\u4f5c\u7cfb\u7edf\uff09\uff0c\u4eba\u5bb6\u8ba9\u4f60\u4f11\u606f\u5c31\u4f11\u606f\uff0c\u8ba9\u4f60\u5de5\u4f5c\u5c31\u5de5\u4f5c\uff0c\u6bd5\u7adf\u644a\u4f4d\u4e0d\u591a\uff0c\u6bcf\u4e2a\u4eba\u90fd\u8981\u5360\u8fd9\u4e2a\u644a\u4f4d\u6765\u5de5\u4f5c\uff0c\u57ce\u91cc\u8981\u5de5\u4f5c\u7684\u4eba\u591a\u7740\u53bb\u4e86\u3002</p> <p>\u6240\u4ee5\u57ce\u7ba1\u4e3a\u4e86\u516c\u5e73\u8d77\u89c1\uff0c\u5b83\u4f7f\u7528\u4e00\u79cd\u7b56\u7565\uff08\u8c03\u5ea6\uff09\u65b9\u5f0f\uff0c\u7ed9\u6bcf\u4e2a\u4eba\u4e00\u4e2a\u56fa\u5b9a\u7684\u5de5\u4f5c\u65f6\u95f4\uff08\u65f6\u95f4\u7247\uff09\uff0c\u65f6\u95f4\u5230\u4e86\u5c31\u4f1a\u901a\u77e5\u4f60\u53bb\u4f11\u606f\u800c\u6362\u53e6\u5916\u4e00\u4e2a\u4eba\u4e0a\u573a\u5de5\u4f5c\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u4f11\u606f\u65f6\u5019\u4f60\u4e5f\u4e0d\u80fd\u5077\u61d2\uff0c\u8981\u8bb0\u4f4f\u5de5\u4f5c\u5230\u54ea\u4e86\uff0c\u4e0d\u7136\u4e0b\u6b21\u5230\u4f60\u5de5\u4f5c\u4e86\uff0c\u4f60\u5fd8\u8bb0\u5de5\u4f5c\u5230\u54ea\u4e86\uff0c\u90a3\u8fd8\u600e\u4e48\u7ee7\u7eed\uff1f</p> <p>\u6709\u7684\u4eba\uff0c\u53ef\u80fd\u8fd8\u8fdb\u5165\u4e86\u53bf\u57ce\uff08\u7ebf\u7a0b\uff09\u5de5\u4f5c\uff0c\u8fd9\u91cc\u76f8\u5bf9\u8f7b\u677e\u4e00\u4e9b\uff0c\u5728\u4f11\u606f\u7684\u65f6\u5019\uff0c\u8981\u8bb0\u4f4f\u7684\u4e1c\u897f\u76f8\u5bf9\u8f83\u5c11\uff0c\u800c\u4e14\u8fd8\u80fd\u5171\u4eab\u57ce\u91cc\u7684\u8d44\u6e90\u3002</p> <p>\u201c\u54ce\u54df\uff0c\u96be\u9053\u672c\u6587\u5185\u5bb9\u662f\u8fdb\u7a0b\u548c\u7ebf\u7a0b\uff1f\u201d</p> <p>\u53ef\u4ee5\uff0c\u806a\u660e\u7684\u4f60\u731c\u51fa\u6765\u4e86\uff0c\u4e5f\u4e0d\u6789\u8d39\u6211\u778e\u7f16\u4e71\u9020\u7684\u6545\u4e8b\u4e86\u3002</p> <p></p> <p>\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u5bf9\u4e8e\u5199\u4ee3\u7801\u7684\u6211\u4eec\uff0c\u771f\u7684\u5929\u5929\u89c1\u3001\u65e5\u65e5\u89c1\u4e86\uff0c\u4f46\u89c1\u7684\u591a\u4e0d\u4ee3\u8868\u4f60\u5c31\u719f\u6089\u5b83\u4eec\uff0c\u6bd4\u5982\u7b80\u5355\u95ee\u4f60\u4e00\u53e5\uff0c\u4f60\u77e5\u9053\u5b83\u4eec\u7684\u5de5\u4f5c\u539f\u7406\u548c\u533a\u522b\u5417\uff1f</p> <p>\u4e0d\u77e5\u9053\u6ca1\u5173\u7cfb\uff0c\u4eca\u5929\u5c31\u8981\u8ddf\u5927\u5bb6\u8ba8\u8bba\u64cd\u4f5c\u7cfb\u7edf\u7684\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u3002</p> <p></p> <p>::: tip</p> <p>\u5148\u5f3a\u8c03\u4e00\u4e0b\uff0c\u6211\u4eec\u672c\u7bc7\u8bb2\u7684\u4e3b\u8981\u90fd\u662f\u64cd\u4f5c\u7cfb\u7edf\u7406\u8bba\u77e5\u8bc6\uff0c\u504f\u5927\u5b66\u8ba1\u7b97\u673a\u4e13\u4e1a\u8bfe\u4e0a\u7684\u90a3\u79cd\uff0c\u5e76\u4e0d\u662f\u8bb2\u89e3 Linux \u6216 Windows \u64cd\u4f5c\u7cfb\u7edf\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u6240\u4ee5\u5927\u5bb6\u8981\u533a\u522b\u4e00\u4e0b\u3002</p> <p>\u60f3\u8ba9\u4e86\u89e3 Linux \u6216 Windows \u64cd\u4f5c\u7cfb\u7edf\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u5f97\u53bb\u770b\u8fd9\u4e9b\u64cd\u4f5c\u7cfb\u7edf\u7684\u5b9e\u73b0\u539f\u7406\u6216\u8005\u6e90\u7801\u4e66\u7c4d\u3002</p> <p>:::</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_1","title":"\u8fdb\u7a0b","text":"<p>\u6211\u4eec\u7f16\u5199\u7684\u4ee3\u7801\u53ea\u662f\u4e00\u4e2a\u5b58\u50a8\u5728\u786c\u76d8\u7684\u9759\u6001\u6587\u4ef6\uff0c\u901a\u8fc7\u7f16\u8bd1\u540e\u5c31\u4f1a\u751f\u6210\u4e8c\u8fdb\u5236\u53ef\u6267\u884c\u6587\u4ef6\uff0c\u5f53\u6211\u4eec\u8fd0\u884c\u8fd9\u4e2a\u53ef\u6267\u884c\u6587\u4ef6\u540e\uff0c\u5b83\u4f1a\u88ab\u88c5\u8f7d\u5230\u5185\u5b58\u4e2d\uff0c\u63a5\u7740 CPU \u4f1a\u6267\u884c\u7a0b\u5e8f\u4e2d\u7684\u6bcf\u4e00\u6761\u6307\u4ee4\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8fd0\u884c\u4e2d\u7684\u7a0b\u5e8f\uff0c\u5c31\u88ab\u79f0\u4e3a\u300c\u8fdb\u7a0b\u300d\uff08Process\uff09\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u8003\u8651\u6709\u4e00\u4e2a\u4f1a\u8bfb\u53d6\u786c\u76d8\u6587\u4ef6\u6570\u636e\u7684\u7a0b\u5e8f\u88ab\u6267\u884c\u4e86\uff0c\u90a3\u4e48\u5f53\u8fd0\u884c\u5230\u8bfb\u53d6\u6587\u4ef6\u7684\u6307\u4ee4\u65f6\uff0c\u5c31\u4f1a\u53bb\u4ece\u786c\u76d8\u8bfb\u53d6\u6570\u636e\uff0c\u4f46\u662f\u786c\u76d8\u7684\u8bfb\u5199\u901f\u5ea6\u662f\u975e\u5e38\u6162\u7684\uff0c\u90a3\u4e48\u5728\u8fd9\u4e2a\u65f6\u5019\uff0c\u5982\u679c CPU \u50bb\u50bb\u7684\u7b49\u786c\u76d8\u8fd4\u56de\u6570\u636e\u7684\u8bdd\uff0c\u90a3 CPU \u7684\u5229\u7528\u7387\u662f\u975e\u5e38\u4f4e\u7684\u3002</p> <p>\u505a\u4e2a\u7c7b\u6bd4\uff0c\u4f60\u53bb\u716e\u5f00\u6c34\u65f6\uff0c\u4f60\u4f1a\u50bb\u50bb\u7684\u7b49\u6c34\u58f6\u70e7\u5f00\u5417\uff1f\u5f88\u660e\u663e\uff0c\u5c0f\u5b69\u4e5f\u4e0d\u4f1a\u50bb\u7b49\u3002\u6211\u4eec\u53ef\u4ee5\u5728\u6c34\u58f6\u70e7\u5f00\u4e4b\u524d\u53bb\u505a\u5176\u4ed6\u4e8b\u60c5\u3002\u5f53\u6c34\u58f6\u70e7\u5f00\u4e86\uff0c\u6211\u4eec\u81ea\u7136\u5c31\u4f1a\u542c\u5230\u201c\u5600\u5600\u5600\u201d\u7684\u58f0\u97f3\uff0c\u4e8e\u662f\u518d\u628a\u70e7\u5f00\u7684\u6c34\u5012\u5165\u5230\u6c34\u676f\u91cc\u5c31\u597d\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u5f53\u8fdb\u7a0b\u8981\u4ece\u786c\u76d8\u8bfb\u53d6\u6570\u636e\u65f6\uff0cCPU \u4e0d\u9700\u8981\u963b\u585e\u7b49\u5f85\u6570\u636e\u7684\u8fd4\u56de\uff0c\u800c\u662f\u53bb\u6267\u884c\u53e6\u5916\u7684\u8fdb\u7a0b\u3002\u5f53\u786c\u76d8\u6570\u636e\u8fd4\u56de\u65f6\uff0cCPU \u4f1a\u6536\u5230\u4e2a\u4e2d\u65ad\uff0c\u4e8e\u662f CPU \u518d\u7ee7\u7eed\u8fd0\u884c\u8fd9\u4e2a\u8fdb\u7a0b\u3002</p> <p></p> <p>\u8fd9\u79cd\u591a\u4e2a\u7a0b\u5e8f\u3001\u4ea4\u66ff\u6267\u884c\u7684\u601d\u60f3\uff0c\u5c31\u6709 CPU \u7ba1\u7406\u591a\u4e2a\u8fdb\u7a0b\u7684\u521d\u6b65\u60f3\u6cd5\u3002</p> <p>\u5bf9\u4e8e\u4e00\u4e2a\u652f\u6301\u591a\u8fdb\u7a0b\u7684\u7cfb\u7edf\uff0cCPU \u4f1a\u4ece\u4e00\u4e2a\u8fdb\u7a0b\u5feb\u901f\u5207\u6362\u81f3\u53e6\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5176\u95f4\u6bcf\u4e2a\u8fdb\u7a0b\u5404\u8fd0\u884c\u51e0\u5341\u6216\u51e0\u767e\u4e2a\u6beb\u79d2\u3002</p> <p>\u867d\u7136\u5355\u6838\u7684 CPU \u5728\u67d0\u4e00\u4e2a\u77ac\u95f4\uff0c\u53ea\u80fd\u8fd0\u884c\u4e00\u4e2a\u8fdb\u7a0b\u3002\u4f46\u5728 1 \u79d2\u949f\u671f\u95f4\uff0c\u5b83\u53ef\u80fd\u4f1a\u8fd0\u884c\u591a\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u6837\u5c31\u4ea7\u751f\u5e76\u884c\u7684\u9519\u89c9\uff0c\u5b9e\u9645\u4e0a\u8fd9\u662f\u5e76\u53d1\u3002</p> <p>\u5e76\u53d1\u548c\u5e76\u884c\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>\u4e00\u56fe\u80dc\u5343\u8a00\u3002</p> <p></p> <p>\u8fdb\u7a0b\u4e0e\u7a0b\u5e8f\u7684\u5173\u7cfb\u7684\u7c7b\u6bd4</p> <p>\u5230\u4e86\u665a\u996d\u65f6\u95f4\uff0c\u4e00\u5bf9\u5c0f\u60c5\u4fa3\u809a\u5b50\u90fd\u5495\u5495\u53eb\u4e86\uff0c\u4e8e\u662f\u7537\u751f\u89c1\u673a\u884c\u4e8b\uff0c\u5c31\u60f3\u7ed9\u5973\u751f\u505a\u665a\u996d\uff0c\u6240\u4ee5\u4ed6\u5c31\u5728\u7f51\u4e0a\u627e\u4e86\u8fa3\u5b50\u9e21\u7684\u83dc\u8c31\uff0c\u63a5\u7740\u4e70\u4e86\u4e00\u4e9b\u9e21\u8089\u3001\u8fa3\u6912\u3001\u9999\u6599\u7b49\u6750\u6599\uff0c\u7136\u540e\u8fb9\u770b\u8fb9\u5b66\u8fb9\u505a\u8fd9\u9053\u83dc\u3002</p> <p></p> <p>\u7a81\u7136\uff0c\u5973\u751f\u8bf4\u5979\u60f3\u559d\u53ef\u4e50\uff0c\u90a3\u4e48\u7537\u751f\u53ea\u597d\u628a\u505a\u83dc\u7684\u4e8b\u60c5\u6682\u505c\u4e00\u4e0b\uff0c\u5e76\u5728\u624b\u673a\u83dc\u8c31\u6807\u8bb0\u505a\u5230\u54ea\u4e00\u4e2a\u6b65\u9aa4\uff0c\u628a\u72b6\u6001\u4fe1\u606f\u8bb0\u5f55\u4e86\u4e0b\u6765\u3002</p> <p>\u7136\u540e\u7537\u751f\u542c\u4ece\u5973\u751f\u7684\u6307\u4ee4\uff0c\u8dd1\u53bb\u4e0b\u697c\u4e70\u4e86\u4e00\u74f6\u51b0\u53ef\u4e50\u540e\uff0c\u53c8\u56de\u5230\u53a8\u623f\u7ee7\u7eed\u505a\u83dc\u3002</p> <p>\u8fd9\u4f53\u73b0\u4e86\uff0cCPU \u53ef\u4ee5\u4ece\u4e00\u4e2a\u8fdb\u7a0b\uff08\u505a\u83dc\uff09\u5207\u6362\u5230\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\uff08\u4e70\u53ef\u4e50\uff09\uff0c\u5728\u5207\u6362\u524d\u5fc5\u987b\u8981\u8bb0\u5f55\u5f53\u524d\u8fdb\u7a0b\u4e2d\u8fd0\u884c\u7684\u72b6\u6001\u4fe1\u606f\uff0c\u4ee5\u5907\u4e0b\u6b21\u5207\u6362\u56de\u6765\u7684\u65f6\u5019\u53ef\u4ee5\u6062\u590d\u6267\u884c\u3002</p> <p>\u6240\u4ee5\uff0c\u53ef\u4ee5\u53d1\u73b0\u8fdb\u7a0b\u6709\u7740\u300c\u8fd0\u884c - \u6682\u505c - \u8fd0\u884c\u300d\u7684\u6d3b\u52a8\u89c4\u5f8b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_2","title":"\u8fdb\u7a0b\u7684\u72b6\u6001","text":"<p>\u5728\u4e0a\u9762\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u8fdb\u7a0b\u6709\u7740\u300c\u8fd0\u884c - \u6682\u505c - \u8fd0\u884c\u300d\u7684\u6d3b\u52a8\u89c4\u5f8b\u3002\u4e00\u822c\u8bf4\u6765\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u5e76\u4e0d\u662f\u81ea\u59cb\u81f3\u7ec8\u8fde\u7eed\u4e0d\u505c\u5730\u8fd0\u884c\u7684\uff0c\u5b83\u4e0e\u5e76\u53d1\u6267\u884c\u4e2d\u7684\u5176\u4ed6\u8fdb\u7a0b\u7684\u6267\u884c\u662f\u76f8\u4e92\u5236\u7ea6\u7684\u3002</p> <p>\u5b83\u6709\u65f6\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\uff0c\u6709\u65f6\u53c8\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\u800c\u6682\u505c\u8fd0\u884c\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\uff0c\u5f53\u4f7f\u5b83\u6682\u505c\u7684\u539f\u56e0\u6d88\u5931\u540e\uff0c\u5b83\u53c8\u8fdb\u5165\u51c6\u5907\u8fd0\u884c\u72b6\u6001\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u4e00\u4e2a\u8fdb\u7a0b\u7684\u6d3b\u52a8\u671f\u95f4\u81f3\u5c11\u5177\u5907\u4e09\u79cd\u57fa\u672c\u72b6\u6001\uff0c\u5373\u8fd0\u884c\u72b6\u6001\u3001\u5c31\u7eea\u72b6\u6001\u3001\u963b\u585e\u72b6\u6001\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u5404\u4e2a\u72b6\u6001\u7684\u610f\u4e49\uff1a</p> <ul> <li>\u8fd0\u884c\u72b6\u6001\uff08Running\uff09\uff1a\u8be5\u65f6\u523b\u8fdb\u7a0b\u5360\u7528 CPU\uff1b</li> <li>\u5c31\u7eea\u72b6\u6001\uff08Ready\uff09\uff1a\u53ef\u8fd0\u884c\uff0c\u7531\u4e8e\u5176\u4ed6\u8fdb\u7a0b\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u800c\u6682\u65f6\u505c\u6b62\u8fd0\u884c\uff1b</li> <li>\u963b\u585e\u72b6\u6001\uff08Blocked\uff09\uff1a\u8be5\u8fdb\u7a0b\u6b63\u5728\u7b49\u5f85\u67d0\u4e00\u4e8b\u4ef6\u53d1\u751f\uff08\u5982\u7b49\u5f85\u8f93\u5165/\u8f93\u51fa\u64cd\u4f5c\u7684\u5b8c\u6210\uff09\u800c\u6682\u65f6\u505c\u6b62\u8fd0\u884c\uff0c\u8fd9\u65f6\uff0c\u5373\u4f7f\u7ed9\u5b83 CPU \u63a7\u5236\u6743\uff0c\u5b83\u4e5f\u65e0\u6cd5\u8fd0\u884c\uff1b</li> </ul> <p>\u5f53\u7136\uff0c\u8fdb\u7a0b\u8fd8\u6709\u53e6\u5916\u4e24\u4e2a\u57fa\u672c\u72b6\u6001\uff1a</p> <ul> <li>\u521b\u5efa\u72b6\u6001\uff08new\uff09\uff1a\u8fdb\u7a0b\u6b63\u5728\u88ab\u521b\u5efa\u65f6\u7684\u72b6\u6001\uff1b</li> <li>\u7ed3\u675f\u72b6\u6001\uff08Exit\uff09\uff1a\u8fdb\u7a0b\u6b63\u5728\u4ece\u7cfb\u7edf\u4e2d\u6d88\u5931\u65f6\u7684\u72b6\u6001\uff1b</li> </ul> <p>\u4e8e\u662f\uff0c\u4e00\u4e2a\u5b8c\u6574\u7684\u8fdb\u7a0b\u72b6\u6001\u7684\u53d8\u8fc1\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u518d\u6765\u8be6\u7ec6\u8bf4\u660e\u4e00\u4e0b\u8fdb\u7a0b\u7684\u72b6\u6001\u53d8\u8fc1\uff1a</p> <ul> <li>NULL -&gt; \u521b\u5efa\u72b6\u6001\uff1a\u4e00\u4e2a\u65b0\u8fdb\u7a0b\u88ab\u521b\u5efa\u65f6\u7684\u7b2c\u4e00\u4e2a\u72b6\u6001\uff1b</li> <li>\u521b\u5efa\u72b6\u6001 -&gt; \u5c31\u7eea\u72b6\u6001\uff1a\u5f53\u8fdb\u7a0b\u88ab\u521b\u5efa\u5b8c\u6210\u5e76\u521d\u59cb\u5316\u540e\uff0c\u4e00\u5207\u5c31\u7eea\u51c6\u5907\u8fd0\u884c\u65f6\uff0c\u53d8\u4e3a\u5c31\u7eea\u72b6\u6001\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5f88\u5feb\u7684\uff1b</li> <li>\u5c31\u7eea\u6001 -&gt; \u8fd0\u884c\u72b6\u6001\uff1a\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\u7684\u8fdb\u7a0b\u88ab\u64cd\u4f5c\u7cfb\u7edf\u7684\u8fdb\u7a0b\u8c03\u5ea6\u5668\u9009\u4e2d\u540e\uff0c\u5c31\u5206\u914d\u7ed9 CPU \u6b63\u5f0f\u8fd0\u884c\u8be5\u8fdb\u7a0b\uff1b</li> <li>\u8fd0\u884c\u72b6\u6001 -&gt; \u7ed3\u675f\u72b6\u6001\uff1a\u5f53\u8fdb\u7a0b\u5df2\u7ecf\u8fd0\u884c\u5b8c\u6210\u6216\u51fa\u9519\u65f6\uff0c\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u4f5c\u7ed3\u675f\u72b6\u6001\u5904\u7406\uff1b</li> <li>\u8fd0\u884c\u72b6\u6001 -&gt; \u5c31\u7eea\u72b6\u6001\uff1a\u5904\u4e8e\u8fd0\u884c\u72b6\u6001\u7684\u8fdb\u7a0b\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u7531\u4e8e\u5206\u914d\u7ed9\u5b83\u7684\u8fd0\u884c\u65f6\u95f4\u7247\u7528\u5b8c\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u628a\u8be5\u8fdb\u7a0b\u53d8\u4e3a\u5c31\u7eea\u6001\uff0c\u63a5\u7740\u4ece\u5c31\u7eea\u6001\u9009\u4e2d\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u8fd0\u884c\uff1b</li> <li>\u8fd0\u884c\u72b6\u6001 -&gt; \u963b\u585e\u72b6\u6001\uff1a\u5f53\u8fdb\u7a0b\u8bf7\u6c42\u67d0\u4e2a\u4e8b\u4ef6\u4e14\u5fc5\u987b\u7b49\u5f85\u65f6\uff0c\u4f8b\u5982\u8bf7\u6c42 I/O \u4e8b\u4ef6\uff1b</li> <li>\u963b\u585e\u72b6\u6001 -&gt; \u5c31\u7eea\u72b6\u6001\uff1a\u5f53\u8fdb\u7a0b\u8981\u7b49\u5f85\u7684\u4e8b\u4ef6\u5b8c\u6210\u65f6\uff0c\u5b83\u4ece\u963b\u585e\u72b6\u6001\u53d8\u5230\u5c31\u7eea\u72b6\u6001\uff1b</li> </ul> <p>\u5982\u679c\u6709\u5927\u91cf\u5904\u4e8e\u963b\u585e\u72b6\u6001\u7684\u8fdb\u7a0b\uff0c\u8fdb\u7a0b\u53ef\u80fd\u4f1a\u5360\u7528\u7740\u7269\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u663e\u7136\u4e0d\u662f\u6211\u4eec\u6240\u5e0c\u671b\u7684\uff0c\u6bd5\u7adf\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u662f\u6709\u9650\u7684\uff0c\u88ab\u963b\u585e\u72b6\u6001\u7684\u8fdb\u7a0b\u5360\u7528\u7740\u7269\u7406\u5185\u5b58\u5c31\u662f\u4e00\u79cd\u6d6a\u8d39\u7269\u7406\u5185\u5b58\u7684\u884c\u4e3a\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u865a\u62df\u5185\u5b58\u7ba1\u7406\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u901a\u5e38\u4f1a\u628a\u963b\u585e\u72b6\u6001\u7684\u8fdb\u7a0b\u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u6362\u51fa\u5230\u786c\u76d8\uff0c\u7b49\u9700\u8981\u518d\u6b21\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u518d\u4ece\u786c\u76d8\u6362\u5165\u5230\u7269\u7406\u5185\u5b58\u3002</p> <p></p> <p>\u90a3\u4e48\uff0c\u5c31\u9700\u8981\u4e00\u4e2a\u65b0\u7684\u72b6\u6001\uff0c\u6765\u63cf\u8ff0\u8fdb\u7a0b\u6ca1\u6709\u5360\u7528\u5b9e\u9645\u7684\u7269\u7406\u5185\u5b58\u7a7a\u95f4\u7684\u60c5\u51b5\uff0c\u8fd9\u4e2a\u72b6\u6001\u5c31\u662f\u6302\u8d77\u72b6\u6001\u3002\u8fd9\u8ddf\u963b\u585e\u72b6\u6001\u662f\u4e0d\u4e00\u6837\uff0c\u963b\u585e\u72b6\u6001\u662f\u7b49\u5f85\u67d0\u4e2a\u4e8b\u4ef6\u7684\u8fd4\u56de\u3002</p> <p>\u53e6\u5916\uff0c\u6302\u8d77\u72b6\u6001\u53ef\u4ee5\u5206\u4e3a\u4e24\u79cd\uff1a</p> <ul> <li>\u963b\u585e\u6302\u8d77\u72b6\u6001\uff1a\u8fdb\u7a0b\u5728\u5916\u5b58\uff08\u786c\u76d8\uff09\u5e76\u7b49\u5f85\u67d0\u4e2a\u4e8b\u4ef6\u7684\u51fa\u73b0\uff1b</li> <li>\u5c31\u7eea\u6302\u8d77\u72b6\u6001\uff1a\u8fdb\u7a0b\u5728\u5916\u5b58\uff08\u786c\u76d8\uff09\uff0c\u4f46\u53ea\u8981\u8fdb\u5165\u5185\u5b58\uff0c\u5373\u523b\u7acb\u523b\u8fd0\u884c\uff1b</li> </ul> <p>\u8fd9\u4e24\u79cd\u6302\u8d77\u72b6\u6001\u52a0\u4e0a\u524d\u9762\u7684\u4e94\u79cd\u72b6\u6001\uff0c\u5c31\u53d8\u6210\u4e86\u4e03\u79cd\u72b6\u6001\u53d8\u8fc1\uff08\u7559\u7ed9\u6211\u7684\u989c\u8272\u4e0d\u591a\u4e86\uff09\uff0c\u89c1\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5bfc\u81f4\u8fdb\u7a0b\u6302\u8d77\u7684\u539f\u56e0\u4e0d\u53ea\u662f\u56e0\u4e3a\u8fdb\u7a0b\u6240\u4f7f\u7528\u7684\u5185\u5b58\u7a7a\u95f4\u4e0d\u5728\u7269\u7406\u5185\u5b58\uff0c\u8fd8\u5305\u62ec\u5982\u4e0b\u60c5\u51b5\uff1a</p> <ul> <li>\u901a\u8fc7 sleep \u8ba9\u8fdb\u7a0b\u95f4\u6b47\u6027\u6302\u8d77\uff0c\u5176\u5de5\u4f5c\u539f\u7406\u662f\u8bbe\u7f6e\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5230\u671f\u540e\u5524\u9192\u8fdb\u7a0b\u3002</li> <li>\u7528\u6237\u5e0c\u671b\u6302\u8d77\u4e00\u4e2a\u7a0b\u5e8f\u7684\u6267\u884c\uff0c\u6bd4\u5982\u5728 Linux \u4e2d\u7528 <code>Ctrl+Z</code> \u6302\u8d77\u8fdb\u7a0b\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_3","title":"\u8fdb\u7a0b\u7684\u63a7\u5236\u7ed3\u6784","text":"<p>\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u662f\u7528\u8fdb\u7a0b\u63a7\u5236\u5757\uff08process control block\uff0cPCB\uff09\u6570\u636e\u7ed3\u6784\u6765\u63cf\u8ff0\u8fdb\u7a0b\u7684\u3002</p> <p>\u90a3 PCB \u662f\u4ec0\u4e48\u5462\uff1f\u6253\u5f00\u77e5\u4e4e\u641c\u7d22\u4f60\u5c31\u4f1a\u53d1\u73b0\u8fd9\u4e2a\u4e1c\u897f\u5e76\u4e0d\u662f\u90a3\u4e48\u7b80\u5355\u3002</p> <p></p> <p>\u6253\u4f4f\u6253\u4f4f\uff0c\u6211\u4eec\u662f\u4e2a\u6b63\u7ecf\u7684\u4eba\uff0c\u600e\u4e48\u4f1a\u53bb\u770b\u90a3\u4e9b\u95ee\u9898\u5462\uff1f\u662f\u5427\uff0c\u56de\u6765\u56de\u6765\u3002</p> <p>PCB \u662f\u8fdb\u7a0b\u5b58\u5728\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u8fd9\u610f\u5473\u7740\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5b58\u5728\uff0c\u5fc5\u7136\u4f1a\u6709\u4e00\u4e2a PCB\uff0c\u5982\u679c\u8fdb\u7a0b\u6d88\u5931\u4e86\uff0c\u90a3\u4e48 PCB \u4e5f\u4f1a\u968f\u4e4b\u6d88\u5931\u3002</p> <p>PCB \u5177\u4f53\u5305\u542b\u4ec0\u4e48\u4fe1\u606f\u5462\uff1f</p> <p>\u8fdb\u7a0b\u63cf\u8ff0\u4fe1\u606f\uff1a</p> <ul> <li>\u8fdb\u7a0b\u6807\u8bc6\u7b26\uff1a\u6807\u8bc6\u5404\u4e2a\u8fdb\u7a0b\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a\u5e76\u4e14\u552f\u4e00\u7684\u6807\u8bc6\u7b26\uff1b</li> <li>\u7528\u6237\u6807\u8bc6\u7b26\uff1a\u8fdb\u7a0b\u5f52\u5c5e\u7684\u7528\u6237\uff0c\u7528\u6237\u6807\u8bc6\u7b26\u4e3b\u8981\u4e3a\u5171\u4eab\u548c\u4fdd\u62a4\u670d\u52a1\uff1b</li> </ul> <p>\u8fdb\u7a0b\u63a7\u5236\u548c\u7ba1\u7406\u4fe1\u606f\uff1a</p> <ul> <li>\u8fdb\u7a0b\u5f53\u524d\u72b6\u6001\uff0c\u5982 new\u3001ready\u3001running\u3001waiting \u6216 blocked \u7b49\uff1b</li> <li>\u8fdb\u7a0b\u4f18\u5148\u7ea7\uff1a\u8fdb\u7a0b\u62a2\u5360 CPU \u65f6\u7684\u4f18\u5148\u7ea7\uff1b</li> </ul> <p>\u8d44\u6e90\u5206\u914d\u6e05\u5355\uff1a</p> <ul> <li>\u6709\u5173\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u6216\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u4fe1\u606f\uff0c\u6240\u6253\u5f00\u6587\u4ef6\u7684\u5217\u8868\u548c\u6240\u4f7f\u7528\u7684 I/O \u8bbe\u5907\u4fe1\u606f\u3002</li> </ul> <p>CPU \u76f8\u5173\u4fe1\u606f\uff1a</p> <ul> <li>CPU \u4e2d\u5404\u4e2a\u5bc4\u5b58\u5668\u7684\u503c\uff0c\u5f53\u8fdb\u7a0b\u88ab\u5207\u6362\u65f6\uff0cCPU \u7684\u72b6\u6001\u4fe1\u606f\u90fd\u4f1a\u88ab\u4fdd\u5b58\u5728\u76f8\u5e94\u7684 PCB \u4e2d\uff0c\u4ee5\u4fbf\u8fdb\u7a0b\u91cd\u65b0\u6267\u884c\u65f6\uff0c\u80fd\u4ece\u65ad\u70b9\u5904\u7ee7\u7eed\u6267\u884c\u3002</li> </ul> <p>\u53ef\u89c1\uff0cPCB \u5305\u542b\u4fe1\u606f\u8fd8\u662f\u6bd4\u8f83\u591a\u7684\u3002</p> <p>\u6bcf\u4e2a PCB \u662f\u5982\u4f55\u7ec4\u7ec7\u7684\u5462\uff1f</p> <p>\u901a\u5e38\u662f\u901a\u8fc7\u94fe\u8868\u7684\u65b9\u5f0f\u8fdb\u884c\u7ec4\u7ec7\uff0c\u628a\u5177\u6709\u76f8\u540c\u72b6\u6001\u7684\u8fdb\u7a0b\u94fe\u5728\u4e00\u8d77\uff0c\u7ec4\u6210\u5404\u79cd\u961f\u5217\u3002\u6bd4\u5982\uff1a</p> <ul> <li>\u5c06\u6240\u6709\u5904\u4e8e\u5c31\u7eea\u72b6\u6001\u7684\u8fdb\u7a0b\u94fe\u5728\u4e00\u8d77\uff0c\u79f0\u4e3a\u5c31\u7eea\u961f\u5217\uff1b</li> <li>\u628a\u6240\u6709\u56e0\u7b49\u5f85\u67d0\u4e8b\u4ef6\u800c\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u7684\u8fdb\u7a0b\u94fe\u5728\u4e00\u8d77\u5c31\u7ec4\u6210\u5404\u79cd\u963b\u585e\u961f\u5217\uff1b</li> <li>\u53e6\u5916\uff0c\u5bf9\u4e8e\u8fd0\u884c\u961f\u5217\u5728\u5355\u6838 CPU \u7cfb\u7edf\u4e2d\u5219\u53ea\u6709\u4e00\u4e2a\u8fd0\u884c\u6307\u9488\u4e86\uff0c\u56e0\u4e3a\u5355\u6838 CPU \u5728\u67d0\u4e2a\u65f6\u95f4\uff0c\u53ea\u80fd\u8fd0\u884c\u4e00\u4e2a\u7a0b\u5e8f\u3002</li> </ul> <p>\u90a3\u4e48\uff0c\u5c31\u7eea\u961f\u5217\u548c\u963b\u585e\u961f\u5217\u94fe\u8868\u7684\u7ec4\u7ec7\u5f62\u5f0f\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u9664\u4e86\u94fe\u63a5\u7684\u7ec4\u7ec7\u65b9\u5f0f\uff0c\u8fd8\u6709\u7d22\u5f15\u65b9\u5f0f\uff0c\u5b83\u7684\u5de5\u4f5c\u539f\u7406\uff1a\u5c06\u540c\u4e00\u72b6\u6001\u7684\u8fdb\u7a0b\u7ec4\u7ec7\u5728\u4e00\u4e2a\u7d22\u5f15\u8868\u4e2d\uff0c\u7d22\u5f15\u8868\u9879\u6307\u5411\u76f8\u5e94\u7684 PCB\uff0c\u4e0d\u540c\u72b6\u6001\u5bf9\u5e94\u4e0d\u540c\u7684\u7d22\u5f15\u8868\u3002</p> <p>\u4e00\u822c\u4f1a\u9009\u62e9\u94fe\u8868\uff0c\u56e0\u4e3a\u53ef\u80fd\u9762\u4e34\u8fdb\u7a0b\u521b\u5efa\uff0c\u9500\u6bc1\u7b49\u8c03\u5ea6\u5bfc\u81f4\u8fdb\u7a0b\u72b6\u6001\u53d1\u751f\u53d8\u5316\uff0c\u6240\u4ee5\u94fe\u8868\u80fd\u591f\u66f4\u52a0\u7075\u6d3b\u7684\u63d2\u5165\u548c\u5220\u9664\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_4","title":"\u8fdb\u7a0b\u7684\u63a7\u5236","text":"<p>\u6211\u4eec\u719f\u77e5\u4e86\u8fdb\u7a0b\u7684\u72b6\u6001\u53d8\u8fc1\u548c\u8fdb\u7a0b\u7684\u6570\u636e\u7ed3\u6784 PCB \u540e\uff0c\u518d\u6765\u770b\u770b\u8fdb\u7a0b\u7684\u521b\u5efa\u3001\u7ec8\u6b62\u3001\u963b\u585e\u3001\u5524\u9192\u7684\u8fc7\u7a0b\uff0c\u8fd9\u4e9b\u8fc7\u7a0b\u4e5f\u5c31\u662f\u8fdb\u7a0b\u7684\u63a7\u5236\u3002</p> <p>01 \u521b\u5efa\u8fdb\u7a0b</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u5141\u8bb8\u4e00\u4e2a\u8fdb\u7a0b\u521b\u5efa\u53e6\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u800c\u4e14\u5141\u8bb8\u5b50\u8fdb\u7a0b\u7ee7\u627f\u7236\u8fdb\u7a0b\u6240\u62e5\u6709\u7684\u8d44\u6e90\u3002</p> <p>\u521b\u5efa\u8fdb\u7a0b\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u7533\u8bf7\u4e00\u4e2a\u7a7a\u767d\u7684 PCB\uff0c\u5e76\u5411 PCB \u4e2d\u586b\u5199\u4e00\u4e9b\u63a7\u5236\u548c\u7ba1\u7406\u8fdb\u7a0b\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u8fdb\u7a0b\u7684\u552f\u4e00\u6807\u8bc6\u7b49\uff1b</li> <li>\u4e3a\u8be5\u8fdb\u7a0b\u5206\u914d\u8fd0\u884c\u65f6\u6240\u5fc5\u9700\u7684\u8d44\u6e90\uff0c\u6bd4\u5982\u5185\u5b58\u8d44\u6e90\uff1b</li> <li>\u5c06 PCB \u63d2\u5165\u5230\u5c31\u7eea\u961f\u5217\uff0c\u7b49\u5f85\u88ab\u8c03\u5ea6\u8fd0\u884c\uff1b</li> </ul> <p>02 \u7ec8\u6b62\u8fdb\u7a0b</p> <p>\u8fdb\u7a0b\u53ef\u4ee5\u6709 3 \u79cd\u7ec8\u6b62\u65b9\u5f0f\uff1a\u6b63\u5e38\u7ed3\u675f\u3001\u5f02\u5e38\u7ed3\u675f\u4ee5\u53ca\u5916\u754c\u5e72\u9884\uff08\u4fe1\u53f7 <code>kill</code> \u6389\uff09\u3002</p> <p>\u5f53\u5b50\u8fdb\u7a0b\u88ab\u7ec8\u6b62\u65f6\uff0c\u5176\u5728\u7236\u8fdb\u7a0b\u5904\u7ee7\u627f\u7684\u8d44\u6e90\u5e94\u5f53\u8fd8\u7ed9\u7236\u8fdb\u7a0b\u3002\u800c\u5f53\u7236\u8fdb\u7a0b\u88ab\u7ec8\u6b62\u65f6\uff0c\u8be5\u7236\u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b\u5c31\u53d8\u4e3a\u5b64\u513f\u8fdb\u7a0b\uff0c\u4f1a\u88ab 1 \u53f7\u8fdb\u7a0b\u6536\u517b\uff0c\u5e76\u7531 1 \u53f7\u8fdb\u7a0b\u5bf9\u5b83\u4eec\u5b8c\u6210\u72b6\u6001\u6536\u96c6\u5de5\u4f5c\u3002</p> <p>\u7ec8\u6b62\u8fdb\u7a0b\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u67e5\u627e\u9700\u8981\u7ec8\u6b62\u7684\u8fdb\u7a0b\u7684 PCB\uff1b</li> <li>\u5982\u679c\u5904\u4e8e\u6267\u884c\u72b6\u6001\uff0c\u5219\u7acb\u5373\u7ec8\u6b62\u8be5\u8fdb\u7a0b\u7684\u6267\u884c\uff0c\u7136\u540e\u5c06 CPU \u8d44\u6e90\u5206\u914d\u7ed9\u5176\u4ed6\u8fdb\u7a0b\uff1b</li> <li>\u5982\u679c\u5176\u8fd8\u6709\u5b50\u8fdb\u7a0b\uff0c\u5219\u5e94\u5c06\u8be5\u8fdb\u7a0b\u7684\u5b50\u8fdb\u7a0b\u4ea4\u7ed9 1 \u53f7\u8fdb\u7a0b\u63a5\u7ba1\uff1b</li> <li>\u5c06\u8be5\u8fdb\u7a0b\u6240\u62e5\u6709\u7684\u5168\u90e8\u8d44\u6e90\u90fd\u5f52\u8fd8\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff1b</li> <li>\u5c06\u5176\u4ece PCB \u6240\u5728\u961f\u5217\u4e2d\u5220\u9664\uff1b</li> </ul> <p>03 \u963b\u585e\u8fdb\u7a0b</p> <p>\u5f53\u8fdb\u7a0b\u9700\u8981\u7b49\u5f85\u67d0\u4e00\u4e8b\u4ef6\u5b8c\u6210\u65f6\uff0c\u5b83\u53ef\u4ee5\u8c03\u7528\u963b\u585e\u8bed\u53e5\u628a\u81ea\u5df1\u963b\u585e\u7b49\u5f85\u3002\u800c\u4e00\u65e6\u88ab\u963b\u585e\u7b49\u5f85\uff0c\u5b83\u53ea\u80fd\u7531\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u5524\u9192\u3002</p> <p>\u963b\u585e\u8fdb\u7a0b\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u627e\u5230\u5c06\u8981\u88ab\u963b\u585e\u8fdb\u7a0b\u6807\u8bc6\u53f7\u5bf9\u5e94\u7684 PCB\uff1b</li> <li>\u5982\u679c\u8be5\u8fdb\u7a0b\u4e3a\u8fd0\u884c\u72b6\u6001\uff0c\u5219\u4fdd\u62a4\u5176\u73b0\u573a\uff0c\u5c06\u5176\u72b6\u6001\u8f6c\u4e3a\u963b\u585e\u72b6\u6001\uff0c\u505c\u6b62\u8fd0\u884c\uff1b</li> <li>\u5c06\u8be5 PCB \u63d2\u5165\u5230\u963b\u585e\u961f\u5217\u4e2d\u53bb\uff1b</li> </ul> <p>04 \u5524\u9192\u8fdb\u7a0b</p> <p>\u8fdb\u7a0b\u7531\u300c\u8fd0\u884c\u300d\u8f6c\u53d8\u4e3a\u300c\u963b\u585e\u300d\u72b6\u6001\u662f\u7531\u4e8e\u8fdb\u7a0b\u5fc5\u987b\u7b49\u5f85\u67d0\u4e00\u4e8b\u4ef6\u7684\u5b8c\u6210\uff0c\u6240\u4ee5\u5904\u4e8e\u963b\u585e\u72b6\u6001\u7684\u8fdb\u7a0b\u662f\u7edd\u5bf9\u4e0d\u53ef\u80fd\u53eb\u9192\u81ea\u5df1\u7684\u3002</p> <p>\u5982\u679c\u67d0\u8fdb\u7a0b\u6b63\u5728\u7b49\u5f85 I/O \u4e8b\u4ef6\uff0c\u9700\u7531\u522b\u7684\u8fdb\u7a0b\u53d1\u6d88\u606f\u7ed9\u5b83\uff0c\u5219\u53ea\u6709\u5f53\u8be5\u8fdb\u7a0b\u6240\u671f\u5f85\u7684\u4e8b\u4ef6\u51fa\u73b0\u65f6\uff0c\u624d\u7531\u53d1\u73b0\u8005\u8fdb\u7a0b\u7528\u5524\u9192\u8bed\u53e5\u53eb\u9192\u5b83\u3002</p> <p>\u5524\u9192\u8fdb\u7a0b\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5728\u8be5\u4e8b\u4ef6\u7684\u963b\u585e\u961f\u5217\u4e2d\u627e\u5230\u76f8\u5e94\u8fdb\u7a0b\u7684 PCB\uff1b</li> <li>\u5c06\u5176\u4ece\u963b\u585e\u961f\u5217\u4e2d\u79fb\u51fa\uff0c\u5e76\u7f6e\u5176\u72b6\u6001\u4e3a\u5c31\u7eea\u72b6\u6001\uff1b</li> <li>\u628a\u8be5 PCB \u63d2\u5165\u5230\u5c31\u7eea\u961f\u5217\u4e2d\uff0c\u7b49\u5f85\u8c03\u5ea6\u7a0b\u5e8f\u8c03\u5ea6\uff1b</li> </ul> <p>\u8fdb\u7a0b\u7684\u963b\u585e\u548c\u5524\u9192\u662f\u4e00\u5bf9\u529f\u80fd\u76f8\u53cd\u7684\u8bed\u53e5\uff0c\u5982\u679c\u67d0\u4e2a\u8fdb\u7a0b\u8c03\u7528\u4e86\u963b\u585e\u8bed\u53e5\uff0c\u5219\u5fc5\u6709\u4e00\u4e2a\u4e0e\u4e4b\u5bf9\u5e94\u7684\u5524\u9192\u8bed\u53e5\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_5","title":"\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362","text":"<p>\u5404\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u662f\u5171\u4eab CPU \u8d44\u6e90\u7684\uff0c\u5728\u4e0d\u540c\u7684\u65f6\u5019\u8fdb\u7a0b\u4e4b\u95f4\u9700\u8981\u5207\u6362\uff0c\u8ba9\u4e0d\u540c\u7684\u8fdb\u7a0b\u53ef\u4ee5\u5728 CPU \u6267\u884c\uff0c\u90a3\u4e48\u8fd9\u4e2a\u4e00\u4e2a\u8fdb\u7a0b\u5207\u6362\u5230\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u8fd0\u884c\uff0c\u79f0\u4e3a\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u5728\u8be6\u7ec6\u8bf4\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b CPU \u4e0a\u4e0b\u6587\u5207\u6362</p> <p>\u5927\u591a\u6570\u64cd\u4f5c\u7cfb\u7edf\u90fd\u662f\u591a\u4efb\u52a1\uff0c\u901a\u5e38\u652f\u6301\u5927\u4e8e CPU \u6570\u91cf\u7684\u4efb\u52a1\u540c\u65f6\u8fd0\u884c\u3002\u5b9e\u9645\u4e0a\uff0c\u8fd9\u4e9b\u4efb\u52a1\u5e76\u4e0d\u662f\u540c\u65f6\u8fd0\u884c\u7684\uff0c\u53ea\u662f\u56e0\u4e3a\u7cfb\u7edf\u5728\u5f88\u77ed\u7684\u65f6\u95f4\u5185\uff0c\u8ba9\u5404\u4e2a\u4efb\u52a1\u5206\u522b\u5728 CPU \u8fd0\u884c\uff0c\u4e8e\u662f\u5c31\u9020\u6210\u540c\u65f6\u8fd0\u884c\u7684\u9519\u89c9\u3002</p> <p>\u4efb\u52a1\u662f\u4ea4\u7ed9 CPU \u8fd0\u884c\u7684\uff0c\u90a3\u4e48\u5728\u6bcf\u4e2a\u4efb\u52a1\u8fd0\u884c\u524d\uff0cCPU \u9700\u8981\u77e5\u9053\u4efb\u52a1\u4ece\u54ea\u91cc\u52a0\u8f7d\uff0c\u53c8\u4ece\u54ea\u91cc\u5f00\u59cb\u8fd0\u884c\u3002</p> <p>\u6240\u4ee5\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u4e8b\u5148\u5e2e CPU \u8bbe\u7f6e\u597d CPU \u5bc4\u5b58\u5668\u548c\u7a0b\u5e8f\u8ba1\u6570\u5668\u3002</p> <p>CPU \u5bc4\u5b58\u5668\u662f CPU \u5185\u90e8\u4e00\u4e2a\u5bb9\u91cf\u5c0f\uff0c\u4f46\u662f\u901f\u5ea6\u6781\u5feb\u7684\u5185\u5b58\uff08\u7f13\u5b58\uff09\u3002\u6211\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5bc4\u5b58\u5668\u50cf\u662f\u4f60\u7684\u53e3\u888b\uff0c\u5185\u5b58\u50cf\u4f60\u7684\u4e66\u5305\uff0c\u786c\u76d8\u5219\u662f\u4f60\u5bb6\u91cc\u7684\u67dc\u5b50\uff0c\u5982\u679c\u4f60\u7684\u4e1c\u897f\u5b58\u653e\u5230\u53e3\u888b\uff0c\u90a3\u80af\u5b9a\u662f\u6bd4\u4f60\u4ece\u4e66\u5305\u6216\u5bb6\u91cc\u67dc\u5b50\u53d6\u51fa\u6765\u8981\u5feb\u7684\u591a\u3002</p> <p>\u518d\u6765\uff0c\u7a0b\u5e8f\u8ba1\u6570\u5668\u5219\u662f\u7528\u6765\u5b58\u50a8 CPU \u6b63\u5728\u6267\u884c\u7684\u6307\u4ee4\u4f4d\u7f6e\u3001\u6216\u8005\u5373\u5c06\u6267\u884c\u7684\u4e0b\u4e00\u6761\u6307\u4ee4\u4f4d\u7f6e\u3002</p> <p>\u6240\u4ee5\u8bf4\uff0cCPU \u5bc4\u5b58\u5668\u548c\u7a0b\u5e8f\u8ba1\u6570\u662f CPU \u5728\u8fd0\u884c\u4efb\u4f55\u4efb\u52a1\u524d\uff0c\u6240\u5fc5\u987b\u4f9d\u8d56\u7684\u73af\u5883\uff0c\u8fd9\u4e9b\u73af\u5883\u5c31\u53eb\u505a CPU \u4e0a\u4e0b\u6587\u3002</p> <p>\u65e2\u7136\u77e5\u9053\u4e86\u4ec0\u4e48\u662f CPU \u4e0a\u4e0b\u6587\uff0c\u90a3\u7406\u89e3 CPU \u4e0a\u4e0b\u6587\u5207\u6362\u5c31\u4e0d\u96be\u4e86\u3002</p> <p>CPU \u4e0a\u4e0b\u6587\u5207\u6362\u5c31\u662f\u5148\u628a\u524d\u4e00\u4e2a\u4efb\u52a1\u7684 CPU \u4e0a\u4e0b\u6587\uff08CPU \u5bc4\u5b58\u5668\u548c\u7a0b\u5e8f\u8ba1\u6570\u5668\uff09\u4fdd\u5b58\u8d77\u6765\uff0c\u7136\u540e\u52a0\u8f7d\u65b0\u4efb\u52a1\u7684\u4e0a\u4e0b\u6587\u5230\u8fd9\u4e9b\u5bc4\u5b58\u5668\u548c\u7a0b\u5e8f\u8ba1\u6570\u5668\uff0c\u6700\u540e\u518d\u8df3\u8f6c\u5230\u7a0b\u5e8f\u8ba1\u6570\u5668\u6240\u6307\u7684\u65b0\u4f4d\u7f6e\uff0c\u8fd0\u884c\u65b0\u4efb\u52a1\u3002</p> <p>\u7cfb\u7edf\u5185\u6838\u4f1a\u5b58\u50a8\u4fdd\u6301\u4e0b\u6765\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u5f53\u6b64\u4efb\u52a1\u518d\u6b21\u88ab\u5206\u914d\u7ed9 CPU \u8fd0\u884c\u65f6\uff0cCPU \u4f1a\u91cd\u65b0\u52a0\u8f7d\u8fd9\u4e9b\u4e0a\u4e0b\u6587\uff0c\u8fd9\u6837\u5c31\u80fd\u4fdd\u8bc1\u4efb\u52a1\u539f\u6765\u7684\u72b6\u6001\u4e0d\u53d7\u5f71\u54cd\uff0c\u8ba9\u4efb\u52a1\u770b\u8d77\u6765\u8fd8\u662f\u8fde\u7eed\u8fd0\u884c\u3002</p> <p>\u4e0a\u9762\u8bf4\u5230\u6240\u8c13\u7684\u300c\u4efb\u52a1\u300d\uff0c\u4e3b\u8981\u5305\u542b\u8fdb\u7a0b\u3001\u7ebf\u7a0b\u548c\u4e2d\u65ad\u3002\u6240\u4ee5\uff0c\u53ef\u4ee5\u6839\u636e\u4efb\u52a1\u7684\u4e0d\u540c\uff0c\u628a CPU \u4e0a\u4e0b\u6587\u5207\u6362\u5206\u6210\uff1a\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u3001\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u4e2d\u65ad\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u5230\u5e95\u662f\u5207\u6362\u4ec0\u4e48\u5462\uff1f</p> <p>\u8fdb\u7a0b\u662f\u7531\u5185\u6838\u7ba1\u7406\u548c\u8c03\u5ea6\u7684\uff0c\u6240\u4ee5\u8fdb\u7a0b\u7684\u5207\u6362\u53ea\u80fd\u53d1\u751f\u5728\u5185\u6838\u6001\u3002</p> <p>\u6240\u4ee5\uff0c\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u4e0d\u4ec5\u5305\u542b\u4e86\u865a\u62df\u5185\u5b58\u3001\u6808\u3001\u5168\u5c40\u53d8\u91cf\u7b49\u7528\u6237\u7a7a\u95f4\u7684\u8d44\u6e90\uff0c\u8fd8\u5305\u62ec\u4e86\u5185\u6838\u5806\u6808\u3001\u5bc4\u5b58\u5668\u7b49\u5185\u6838\u7a7a\u95f4\u7684\u8d44\u6e90\u3002</p> <p>\u901a\u5e38\uff0c\u4f1a\u628a\u4ea4\u6362\u7684\u4fe1\u606f\u4fdd\u5b58\u5728\u8fdb\u7a0b\u7684 PCB\uff0c\u5f53\u8981\u8fd0\u884c\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u4ece\u8fd9\u4e2a\u8fdb\u7a0b\u7684 PCB \u53d6\u51fa\u4e0a\u4e0b\u6587\uff0c\u7136\u540e\u6062\u590d\u5230 CPU \u4e2d\uff0c\u8fd9\u4f7f\u5f97\u8fd9\u4e2a\u8fdb\u7a0b\u53ef\u4ee5\u7ee7\u7eed\u6267\u884c\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5927\u5bb6\u9700\u8981\u6ce8\u610f\uff0c\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5f00\u9500\u662f\u5f88\u5173\u952e\u7684\uff0c\u6211\u4eec\u5e0c\u671b\u5b83\u7684\u5f00\u9500\u8d8a\u5c0f\u8d8a\u597d\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u8fdb\u7a0b\u53ef\u4ee5\u628a\u66f4\u591a\u65f6\u95f4\u82b1\u8d39\u5728\u6267\u884c\u7a0b\u5e8f\u4e0a\uff0c\u800c\u4e0d\u662f\u8017\u8d39\u5728\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u53d1\u751f\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u6709\u54ea\u4e9b\u573a\u666f\uff1f</p> <ul> <li>\u4e3a\u4e86\u4fdd\u8bc1\u6240\u6709\u8fdb\u7a0b\u53ef\u4ee5\u5f97\u5230\u516c\u5e73\u8c03\u5ea6\uff0cCPU \u65f6\u95f4\u88ab\u5212\u5206\u4e3a\u4e00\u6bb5\u6bb5\u7684\u65f6\u95f4\u7247\uff0c\u8fd9\u4e9b\u65f6\u95f4\u7247\u518d\u88ab\u8f6e\u6d41\u5206\u914d\u7ed9\u5404\u4e2a\u8fdb\u7a0b\u3002\u8fd9\u6837\uff0c\u5f53\u67d0\u4e2a\u8fdb\u7a0b\u7684\u65f6\u95f4\u7247\u8017\u5c3d\u4e86\uff0c\u8fdb\u7a0b\u5c31\u4ece\u8fd0\u884c\u72b6\u6001\u53d8\u4e3a\u5c31\u7eea\u72b6\u6001\uff0c\u7cfb\u7edf\u4ece\u5c31\u7eea\u961f\u5217\u9009\u62e9\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u8fd0\u884c\uff1b</li> <li>\u8fdb\u7a0b\u5728\u7cfb\u7edf\u8d44\u6e90\u4e0d\u8db3\uff08\u6bd4\u5982\u5185\u5b58\u4e0d\u8db3\uff09\u65f6\uff0c\u8981\u7b49\u5230\u8d44\u6e90\u6ee1\u8db3\u540e\u624d\u53ef\u4ee5\u8fd0\u884c\uff0c\u8fd9\u4e2a\u65f6\u5019\u8fdb\u7a0b\u4e5f\u4f1a\u88ab\u6302\u8d77\uff0c\u5e76\u7531\u7cfb\u7edf\u8c03\u5ea6\u5176\u4ed6\u8fdb\u7a0b\u8fd0\u884c\uff1b</li> <li>\u5f53\u8fdb\u7a0b\u901a\u8fc7\u7761\u7720\u51fd\u6570 sleep \u8fd9\u6837\u7684\u65b9\u6cd5\u5c06\u81ea\u5df1\u4e3b\u52a8\u6302\u8d77\u65f6\uff0c\u81ea\u7136\u4e5f\u4f1a\u91cd\u65b0\u8c03\u5ea6\uff1b</li> <li>\u5f53\u6709\u4f18\u5148\u7ea7\u66f4\u9ad8\u7684\u8fdb\u7a0b\u8fd0\u884c\u65f6\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u9ad8\u4f18\u5148\u7ea7\u8fdb\u7a0b\u7684\u8fd0\u884c\uff0c\u5f53\u524d\u8fdb\u7a0b\u4f1a\u88ab\u6302\u8d77\uff0c\u7531\u9ad8\u4f18\u5148\u7ea7\u8fdb\u7a0b\u6765\u8fd0\u884c\uff1b</li> <li>\u53d1\u751f\u786c\u4ef6\u4e2d\u65ad\u65f6\uff0cCPU \u4e0a\u7684\u8fdb\u7a0b\u4f1a\u88ab\u4e2d\u65ad\u6302\u8d77\uff0c\u8f6c\u800c\u6267\u884c\u5185\u6838\u4e2d\u7684\u4e2d\u65ad\u670d\u52a1\u7a0b\u5e8f\uff1b</li> </ul> <p>\u4ee5\u4e0a\uff0c\u5c31\u662f\u53d1\u751f\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5e38\u89c1\u573a\u666f\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_6","title":"\u7ebf\u7a0b","text":"<p>\u5728\u65e9\u671f\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u90fd\u662f\u4ee5\u8fdb\u7a0b\u4f5c\u4e3a\u72ec\u7acb\u8fd0\u884c\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u76f4\u5230\u540e\u9762\uff0c\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6\u4eec\u53c8\u63d0\u51fa\u4e86\u66f4\u5c0f\u7684\u80fd\u72ec\u7acb\u8fd0\u884c\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u4e5f\u5c31\u662f\u7ebf\u7a0b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_7","title":"\u4e3a\u4ec0\u4e48\u4f7f\u7528\u7ebf\u7a0b\uff1f","text":"<p>\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4f60\u8981\u7f16\u5199\u4e00\u4e2a\u89c6\u9891\u64ad\u653e\u5668\u8f6f\u4ef6\uff0c\u90a3\u4e48\u8be5\u8f6f\u4ef6\u529f\u80fd\u7684\u6838\u5fc3\u6a21\u5757\u6709\u4e09\u4e2a\uff1a</p> <ul> <li>\u4ece\u89c6\u9891\u6587\u4ef6\u5f53\u4e2d\u8bfb\u53d6\u6570\u636e\uff1b</li> <li>\u5bf9\u8bfb\u53d6\u7684\u6570\u636e\u8fdb\u884c\u89e3\u538b\u7f29\uff1b</li> <li>\u628a\u89e3\u538b\u7f29\u540e\u7684\u89c6\u9891\u6570\u636e\u64ad\u653e\u51fa\u6765\uff1b</li> </ul> <p>\u5bf9\u4e8e\u5355\u8fdb\u7a0b\u7684\u5b9e\u73b0\u65b9\u5f0f\uff0c\u6211\u60f3\u5927\u5bb6\u90fd\u4f1a\u662f\u4ee5\u4e0b\u8fd9\u4e2a\u65b9\u5f0f\uff1a</p> <p></p> <p>\u5bf9\u4e8e\u5355\u8fdb\u7a0b\u7684\u8fd9\u79cd\u65b9\u5f0f\uff0c\u5b58\u5728\u4ee5\u4e0b\u95ee\u9898\uff1a</p> <ul> <li>\u64ad\u653e\u51fa\u6765\u7684\u753b\u9762\u548c\u58f0\u97f3\u4f1a\u4e0d\u8fde\u8d2f\uff0c\u56e0\u4e3a\u5f53 CPU \u80fd\u529b\u4e0d\u591f\u5f3a\u7684\u65f6\u5019\uff0c<code>Read</code>  \u7684\u65f6\u5019\u53ef\u80fd\u8fdb\u7a0b\u5c31\u7b49\u5728\u8fd9\u4e86\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u7b49\u534a\u5929\u624d\u8fdb\u884c\u6570\u636e\u89e3\u538b\u548c\u64ad\u653e\uff1b</li> <li>\u5404\u4e2a\u51fd\u6570\u4e4b\u95f4\u4e0d\u662f\u5e76\u53d1\u6267\u884c\uff0c\u5f71\u54cd\u8d44\u6e90\u7684\u4f7f\u7528\u6548\u7387\uff1b</li> </ul> <p>\u90a3\u6539\u8fdb\u6210\u591a\u8fdb\u7a0b\u7684\u65b9\u5f0f\uff1a</p> <p></p> <p>\u5bf9\u4e8e\u591a\u8fdb\u7a0b\u7684\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4f9d\u7136\u4f1a\u5b58\u5728\u95ee\u9898\uff1a</p> <ul> <li>\u8fdb\u7a0b\u4e4b\u95f4\u5982\u4f55\u901a\u4fe1\uff0c\u5171\u4eab\u6570\u636e\uff1f</li> <li>\u7ef4\u62a4\u8fdb\u7a0b\u7684\u7cfb\u7edf\u5f00\u9500\u8f83\u5927\uff0c\u5982\u521b\u5efa\u8fdb\u7a0b\u65f6\uff0c\u5206\u914d\u8d44\u6e90\u3001\u5efa\u7acb PCB\uff1b\u7ec8\u6b62\u8fdb\u7a0b\u65f6\uff0c\u56de\u6536\u8d44\u6e90\u3001\u64a4\u9500 PCB\uff1b\u8fdb\u7a0b\u5207\u6362\u65f6\uff0c\u4fdd\u5b58\u5f53\u524d\u8fdb\u7a0b\u7684\u72b6\u6001\u4fe1\u606f\uff1b</li> </ul> <p>\u90a3\u5230\u5e95\u5982\u4f55\u89e3\u51b3\u5462\uff1f\u9700\u8981\u6709\u4e00\u79cd\u65b0\u7684\u5b9e\u4f53\uff0c\u6ee1\u8db3\u4ee5\u4e0b\u7279\u6027\uff1a</p> <ul> <li>\u5b9e\u4f53\u4e4b\u95f4\u53ef\u4ee5\u5e76\u53d1\u8fd0\u884c\uff1b</li> <li>\u5b9e\u4f53\u4e4b\u95f4\u5171\u4eab\u76f8\u540c\u7684\u5730\u5740\u7a7a\u95f4\uff1b</li> </ul> <p>\u8fd9\u4e2a\u65b0\u7684\u5b9e\u4f53\uff0c\u5c31\u662f\u7ebf\u7a0b ( Thread )\uff0c\u7ebf\u7a0b\u4e4b\u95f4\u53ef\u4ee5\u5e76\u53d1\u8fd0\u884c\u4e14\u5171\u4eab\u76f8\u540c\u7684\u5730\u5740\u7a7a\u95f4\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_8","title":"\u4ec0\u4e48\u662f\u7ebf\u7a0b\uff1f","text":"<p>\u7ebf\u7a0b\u662f\u8fdb\u7a0b\u5f53\u4e2d\u7684\u4e00\u6761\u6267\u884c\u6d41\u7a0b\u3002</p> <p>\u540c\u4e00\u4e2a\u8fdb\u7a0b\u5185\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u53ef\u4ee5\u5171\u4eab\u4ee3\u7801\u6bb5\u3001\u6570\u636e\u6bb5\u3001\u6253\u5f00\u7684\u6587\u4ef6\u7b49\u8d44\u6e90\uff0c\u4f46\u6bcf\u4e2a\u7ebf\u7a0b\u5404\u81ea\u90fd\u6709\u4e00\u5957\u72ec\u7acb\u7684\u5bc4\u5b58\u5668\u548c\u6808\uff0c\u8fd9\u6837\u53ef\u4ee5\u786e\u4fdd\u7ebf\u7a0b\u7684\u63a7\u5236\u6d41\u662f\u76f8\u5bf9\u72ec\u7acb\u7684\u3002</p> <p></p> <p>\u7ebf\u7a0b\u7684\u4f18\u7f3a\u70b9\uff1f</p> <p>\u7ebf\u7a0b\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u4e00\u4e2a\u8fdb\u7a0b\u4e2d\u53ef\u4ee5\u540c\u65f6\u5b58\u5728\u591a\u4e2a\u7ebf\u7a0b\uff1b</li> <li>\u5404\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u53ef\u4ee5\u5e76\u53d1\u6267\u884c\uff1b</li> <li>\u5404\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u53ef\u4ee5\u5171\u4eab\u5730\u5740\u7a7a\u95f4\u548c\u6587\u4ef6\u7b49\u8d44\u6e90\uff1b</li> </ul> <p>\u7ebf\u7a0b\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u5f53\u8fdb\u7a0b\u4e2d\u7684\u4e00\u4e2a\u7ebf\u7a0b\u5d29\u6e83\u65f6\uff0c\u4f1a\u5bfc\u81f4\u5176\u6240\u5c5e\u8fdb\u7a0b\u7684\u6240\u6709\u7ebf\u7a0b\u5d29\u6e83\uff08\u8fd9\u91cc\u662f\u9488\u5bf9 C/C++ \u8bed\u8a00\uff0cJava \u8bed\u8a00\u4e2d\u7684\u7ebf\u7a0b\u5954\u6e83\u4e0d\u4f1a\u9020\u6210\u8fdb\u7a0b\u5d29\u6e83\uff0c\u5177\u4f53\u5206\u6790\u539f\u56e0\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u7ebf\u7a0b\u5d29\u6e83\u4e86\uff0c\u8fdb\u7a0b\u4e5f\u4f1a\u5d29\u6e83\u5417\uff1f\uff09\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5bf9\u4e8e\u6e38\u620f\u7684\u7528\u6237\u8bbe\u8ba1\uff0c\u5219\u4e0d\u5e94\u8be5\u4f7f\u7528\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\uff0c\u5426\u5219\u4e00\u4e2a\u7528\u6237\u6302\u4e86\uff0c\u4f1a\u5f71\u54cd\u5176\u4ed6\u540c\u4e2a\u8fdb\u7a0b\u7684\u7ebf\u7a0b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_9","title":"\u7ebf\u7a0b\u4e0e\u8fdb\u7a0b\u7684\u6bd4\u8f83","text":"<p>\u7ebf\u7a0b\u4e0e\u8fdb\u7a0b\u7684\u6bd4\u8f83\u5982\u4e0b\uff1a</p> <ul> <li>\u8fdb\u7a0b\u662f\u8d44\u6e90\uff08\u5305\u62ec\u5185\u5b58\u3001\u6253\u5f00\u7684\u6587\u4ef6\u7b49\uff09\u5206\u914d\u7684\u5355\u4f4d\uff0c\u7ebf\u7a0b\u662f CPU \u8c03\u5ea6\u7684\u5355\u4f4d\uff1b</li> <li>\u8fdb\u7a0b\u62e5\u6709\u4e00\u4e2a\u5b8c\u6574\u7684\u8d44\u6e90\u5e73\u53f0\uff0c\u800c\u7ebf\u7a0b\u53ea\u72ec\u4eab\u5fc5\u4e0d\u53ef\u5c11\u7684\u8d44\u6e90\uff0c\u5982\u5bc4\u5b58\u5668\u548c\u6808\uff1b</li> <li>\u7ebf\u7a0b\u540c\u6837\u5177\u6709\u5c31\u7eea\u3001\u963b\u585e\u3001\u6267\u884c\u4e09\u79cd\u57fa\u672c\u72b6\u6001\uff0c\u540c\u6837\u5177\u6709\u72b6\u6001\u4e4b\u95f4\u7684\u8f6c\u6362\u5173\u7cfb\uff1b</li> <li>\u7ebf\u7a0b\u80fd\u51cf\u5c11\u5e76\u53d1\u6267\u884c\u7684\u65f6\u95f4\u548c\u7a7a\u95f4\u5f00\u9500\uff1b</li> </ul> <p>\u5bf9\u4e8e\uff0c\u7ebf\u7a0b\u76f8\u6bd4\u8fdb\u7a0b\u80fd\u51cf\u5c11\u5f00\u9500\uff0c\u4f53\u73b0\u5728\uff1a</p> <ul> <li>\u7ebf\u7a0b\u7684\u521b\u5efa\u65f6\u95f4\u6bd4\u8fdb\u7a0b\u5feb\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u5728\u521b\u5efa\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fd8\u9700\u8981\u8d44\u6e90\u7ba1\u7406\u4fe1\u606f\uff0c\u6bd4\u5982\u5185\u5b58\u7ba1\u7406\u4fe1\u606f\u3001\u6587\u4ef6\u7ba1\u7406\u4fe1\u606f\uff0c\u800c\u7ebf\u7a0b\u5728\u521b\u5efa\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4e0d\u4f1a\u6d89\u53ca\u8fd9\u4e9b\u8d44\u6e90\u7ba1\u7406\u4fe1\u606f\uff0c\u800c\u662f\u5171\u4eab\u5b83\u4eec\uff1b</li> <li>\u7ebf\u7a0b\u7684\u7ec8\u6b62\u65f6\u95f4\u6bd4\u8fdb\u7a0b\u5feb\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u91ca\u653e\u7684\u8d44\u6e90\u76f8\u6bd4\u8fdb\u7a0b\u5c11\u5f88\u591a\uff1b</li> <li>\u540c\u4e00\u4e2a\u8fdb\u7a0b\u5185\u7684\u7ebf\u7a0b\u5207\u6362\u6bd4\u8fdb\u7a0b\u5207\u6362\u5feb\uff0c\u56e0\u4e3a\u7ebf\u7a0b\u5177\u6709\u76f8\u540c\u7684\u5730\u5740\u7a7a\u95f4\uff08\u865a\u62df\u5185\u5b58\u5171\u4eab\uff09\uff0c\u8fd9\u610f\u5473\u7740\u540c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u7ebf\u7a0b\u90fd\u5177\u6709\u540c\u4e00\u4e2a\u9875\u8868\uff0c\u90a3\u4e48\u5728\u5207\u6362\u7684\u65f6\u5019\u4e0d\u9700\u8981\u5207\u6362\u9875\u8868\u3002\u800c\u5bf9\u4e8e\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5207\u6362\uff0c\u5207\u6362\u7684\u65f6\u5019\u8981\u628a\u9875\u8868\u7ed9\u5207\u6362\u6389\uff0c\u800c\u9875\u8868\u7684\u5207\u6362\u8fc7\u7a0b\u5f00\u9500\u662f\u6bd4\u8f83\u5927\u7684\uff1b</li> <li>\u7531\u4e8e\u540c\u4e00\u8fdb\u7a0b\u7684\u5404\u7ebf\u7a0b\u95f4\u5171\u4eab\u5185\u5b58\u548c\u6587\u4ef6\u8d44\u6e90\uff0c\u90a3\u4e48\u5728\u7ebf\u7a0b\u4e4b\u95f4\u6570\u636e\u4f20\u9012\u7684\u65f6\u5019\uff0c\u5c31\u4e0d\u9700\u8981\u7ecf\u8fc7\u5185\u6838\u4e86\uff0c\u8fd9\u5c31\u4f7f\u5f97\u7ebf\u7a0b\u4e4b\u95f4\u7684\u6570\u636e\u4ea4\u4e92\u6548\u7387\u66f4\u9ad8\u4e86\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u4e0d\u7ba1\u662f\u65f6\u95f4\u6548\u7387\uff0c\u8fd8\u662f\u7a7a\u95f4\u6548\u7387\u7ebf\u7a0b\u6bd4\u8fdb\u7a0b\u90fd\u8981\u9ad8\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_10","title":"\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362","text":"<p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u7ebf\u7a0b\u4e0e\u8fdb\u7a0b\u6700\u5927\u7684\u533a\u522b\u5728\u4e8e\uff1a\u7ebf\u7a0b\u662f\u8c03\u5ea6\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u800c\u8fdb\u7a0b\u5219\u662f\u8d44\u6e90\u62e5\u6709\u7684\u57fa\u672c\u5355\u4f4d\u3002</p> <p>\u6240\u4ee5\uff0c\u6240\u8c13\u64cd\u4f5c\u7cfb\u7edf\u7684\u4efb\u52a1\u8c03\u5ea6\uff0c\u5b9e\u9645\u4e0a\u7684\u8c03\u5ea6\u5bf9\u8c61\u662f\u7ebf\u7a0b\uff0c\u800c\u8fdb\u7a0b\u53ea\u662f\u7ed9\u7ebf\u7a0b\u63d0\u4f9b\u4e86\u865a\u62df\u5185\u5b58\u3001\u5168\u5c40\u53d8\u91cf\u7b49\u8d44\u6e90\u3002</p> <p>\u5bf9\u4e8e\u7ebf\u7a0b\u548c\u8fdb\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\uff1a</p> <ul> <li>\u5f53\u8fdb\u7a0b\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u65f6\uff0c\u53ef\u4ee5\u8ba4\u4e3a\u8fdb\u7a0b\u5c31\u7b49\u4e8e\u7ebf\u7a0b\uff1b</li> <li>\u5f53\u8fdb\u7a0b\u62e5\u6709\u591a\u4e2a\u7ebf\u7a0b\u65f6\uff0c\u8fd9\u4e9b\u7ebf\u7a0b\u4f1a\u5171\u4eab\u76f8\u540c\u7684\u865a\u62df\u5185\u5b58\u548c\u5168\u5c40\u53d8\u91cf\u7b49\u8d44\u6e90\uff0c\u8fd9\u4e9b\u8d44\u6e90\u5728\u4e0a\u4e0b\u6587\u5207\u6362\u65f6\u662f\u4e0d\u9700\u8981\u4fee\u6539\u7684\uff1b</li> </ul> <p>\u53e6\u5916\uff0c\u7ebf\u7a0b\u4e5f\u6709\u81ea\u5df1\u7684\u79c1\u6709\u6570\u636e\uff0c\u6bd4\u5982\u6808\u548c\u5bc4\u5b58\u5668\u7b49\uff0c\u8fd9\u4e9b\u5728\u4e0a\u4e0b\u6587\u5207\u6362\u65f6\u4e5f\u662f\u9700\u8981\u4fdd\u5b58\u7684\u3002</p> <p>\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u662f\u4ec0\u4e48\uff1f</p> <p>\u8fd9\u8fd8\u5f97\u770b\u7ebf\u7a0b\u662f\u4e0d\u662f\u5c5e\u4e8e\u540c\u4e00\u4e2a\u8fdb\u7a0b\uff1a</p> <ul> <li>\u5f53\u4e24\u4e2a\u7ebf\u7a0b\u4e0d\u662f\u5c5e\u4e8e\u540c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5219\u5207\u6362\u7684\u8fc7\u7a0b\u5c31\u8ddf\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u4e00\u6837\uff1b</li> <li>\u5f53\u4e24\u4e2a\u7ebf\u7a0b\u662f\u5c5e\u4e8e\u540c\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u56e0\u4e3a\u865a\u62df\u5185\u5b58\u662f\u5171\u4eab\u7684\uff0c\u6240\u4ee5\u5728\u5207\u6362\u65f6\uff0c\u865a\u62df\u5185\u5b58\u8fd9\u4e9b\u8d44\u6e90\u5c31\u4fdd\u6301\u4e0d\u52a8\uff0c\u53ea\u9700\u8981\u5207\u6362\u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e\u3001\u5bc4\u5b58\u5668\u7b49\u4e0d\u5171\u4eab\u7684\u6570\u636e\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u76f8\u6bd4\u8fdb\u7a0b\uff0c\u5f00\u9500\u8981\u5c0f\u5f88\u591a\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_11","title":"\u7ebf\u7a0b\u7684\u5b9e\u73b0","text":"<p>\u4e3b\u8981\u6709\u4e09\u79cd\u7ebf\u7a0b\u7684\u5b9e\u73b0\u65b9\u5f0f\uff1a</p> <ul> <li>\u7528\u6237\u7ebf\u7a0b\uff08User Thread\uff09\uff1a\u5728\u7528\u6237\u7a7a\u95f4\u5b9e\u73b0\u7684\u7ebf\u7a0b\uff0c\u4e0d\u662f\u7531\u5185\u6838\u7ba1\u7406\u7684\u7ebf\u7a0b\uff0c\u662f\u7531\u7528\u6237\u6001\u7684\u7ebf\u7a0b\u5e93\u6765\u5b8c\u6210\u7ebf\u7a0b\u7684\u7ba1\u7406\uff1b</li> <li>\u5185\u6838\u7ebf\u7a0b\uff08Kernel Thread\uff09\uff1a\u5728\u5185\u6838\u4e2d\u5b9e\u73b0\u7684\u7ebf\u7a0b\uff0c\u662f\u7531\u5185\u6838\u7ba1\u7406\u7684\u7ebf\u7a0b\uff1b</li> <li>\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff08LightWeight Process\uff09\uff1a\u5728\u5185\u6838\u4e2d\u6765\u652f\u6301\u7528\u6237\u7ebf\u7a0b\uff1b</li> </ul> <p>\u90a3\u4e48\uff0c\u8fd9\u8fd8\u9700\u8981\u8003\u8651\u4e00\u4e2a\u95ee\u9898\uff0c\u7528\u6237\u7ebf\u7a0b\u548c\u5185\u6838\u7ebf\u7a0b\u7684\u5bf9\u5e94\u5173\u7cfb\u3002</p> <p>\u9996\u5148\uff0c\u7b2c\u4e00\u79cd\u5173\u7cfb\u662f\u591a\u5bf9\u4e00\u7684\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u591a\u4e2a\u7528\u6237\u7ebf\u7a0b\u5bf9\u5e94\u540c\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\uff1a</p> <p></p> <p>\u7b2c\u4e8c\u79cd\u662f\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u7528\u6237\u7ebf\u7a0b\u5bf9\u5e94\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\uff1a</p> <p></p> <p>\u7b2c\u4e09\u79cd\u662f\u591a\u5bf9\u591a\u7684\u5173\u7cfb\uff0c\u4e5f\u5c31\u662f\u591a\u4e2a\u7528\u6237\u7ebf\u7a0b\u5bf9\u5e94\u5230\u591a\u4e2a\u5185\u6838\u7ebf\u7a0b\uff1a</p> <p></p> <p>\u7528\u6237\u7ebf\u7a0b\u5982\u4f55\u7406\u89e3\uff1f\u5b58\u5728\u4ec0\u4e48\u4f18\u52bf\u548c\u7f3a\u9677\uff1f</p> <p>\u7528\u6237\u7ebf\u7a0b\u662f\u57fa\u4e8e\u7528\u6237\u6001\u7684\u7ebf\u7a0b\u7ba1\u7406\u5e93\u6765\u5b9e\u73b0\u7684\uff0c\u90a3\u4e48\u7ebf\u7a0b\u63a7\u5236\u5757\uff08Thread Control Block, TCB\uff09 \u4e5f\u662f\u5728\u5e93\u91cc\u9762\u6765\u5b9e\u73b0\u7684\uff0c\u5bf9\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u800c\u8a00\u662f\u770b\u4e0d\u5230\u8fd9\u4e2a TCB \u7684\uff0c\u5b83\u53ea\u80fd\u770b\u5230\u6574\u4e2a\u8fdb\u7a0b\u7684 PCB\u3002</p> <p>\u6240\u4ee5\uff0c\u7528\u6237\u7ebf\u7a0b\u7684\u6574\u4e2a\u7ebf\u7a0b\u7ba1\u7406\u548c\u8c03\u5ea6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u662f\u4e0d\u76f4\u63a5\u53c2\u4e0e\u7684\uff0c\u800c\u662f\u7531\u7528\u6237\u7ea7\u7ebf\u7a0b\u5e93\u51fd\u6570\u6765\u5b8c\u6210\u7ebf\u7a0b\u7684\u7ba1\u7406\uff0c\u5305\u62ec\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u7ec8\u6b62\u3001\u540c\u6b65\u548c\u8c03\u5ea6\u7b49\u3002</p> <p>\u7528\u6237\u7ea7\u7ebf\u7a0b\u7684\u6a21\u578b\uff0c\u4e5f\u5c31\u7c7b\u4f3c\u524d\u9762\u63d0\u5230\u7684\u591a\u5bf9\u4e00\u7684\u5173\u7cfb\uff0c\u5373\u591a\u4e2a\u7528\u6237\u7ebf\u7a0b\u5bf9\u5e94\u540c\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u7528\u6237\u7ebf\u7a0b\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u9700\u8981\u6709\u5b83\u79c1\u6709\u7684\u7ebf\u7a0b\u63a7\u5236\u5757\uff08TCB\uff09\u5217\u8868\uff0c\u7528\u6765\u8ddf\u8e2a\u8bb0\u5f55\u5b83\u5404\u4e2a\u7ebf\u7a0b\u72b6\u6001\u4fe1\u606f\uff08PC\u3001\u6808\u6307\u9488\u3001\u5bc4\u5b58\u5668\uff09\uff0cTCB \u7531\u7528\u6237\u7ea7\u7ebf\u7a0b\u5e93\u51fd\u6570\u6765\u7ef4\u62a4\uff0c\u53ef\u7528\u4e8e\u4e0d\u652f\u6301\u7ebf\u7a0b\u6280\u672f\u7684\u64cd\u4f5c\u7cfb\u7edf\uff1b</li> <li>\u7528\u6237\u7ebf\u7a0b\u7684\u5207\u6362\u4e5f\u662f\u7531\u7ebf\u7a0b\u5e93\u51fd\u6570\u6765\u5b8c\u6210\u7684\uff0c\u65e0\u9700\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u7684\u5207\u6362\uff0c\u6240\u4ee5\u901f\u5ea6\u7279\u522b\u5feb\uff1b</li> </ul> <p>\u7528\u6237\u7ebf\u7a0b\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u7531\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u53c2\u4e0e\u7ebf\u7a0b\u7684\u8c03\u5ea6\uff0c\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u53d1\u8d77\u4e86\u7cfb\u7edf\u8c03\u7528\u800c\u963b\u585e\uff0c\u90a3\u8fdb\u7a0b\u6240\u5305\u542b\u7684\u7528\u6237\u7ebf\u7a0b\u90fd\u4e0d\u80fd\u6267\u884c\u4e86\u3002</li> <li>\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u5f00\u59cb\u8fd0\u884c\u540e\uff0c\u9664\u975e\u5b83\u4e3b\u52a8\u5730\u4ea4\u51fa CPU \u7684\u4f7f\u7528\u6743\uff0c\u5426\u5219\u5b83\u6240\u5728\u7684\u8fdb\u7a0b\u5f53\u4e2d\u7684\u5176\u4ed6\u7ebf\u7a0b\u65e0\u6cd5\u8fd0\u884c\uff0c\u56e0\u4e3a\u7528\u6237\u6001\u7684\u7ebf\u7a0b\u6ca1\u6cd5\u6253\u65ad\u5f53\u524d\u8fd0\u884c\u4e2d\u7684\u7ebf\u7a0b\uff0c\u5b83\u6ca1\u6709\u8fd9\u4e2a\u7279\u6743\uff0c\u53ea\u6709\u64cd\u4f5c\u7cfb\u7edf\u624d\u6709\uff0c\u4f46\u662f\u7528\u6237\u7ebf\u7a0b\u4e0d\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u7684\u3002</li> <li>\u7531\u4e8e\u65f6\u95f4\u7247\u5206\u914d\u7ed9\u8fdb\u7a0b\uff0c\u6545\u4e0e\u5176\u4ed6\u8fdb\u7a0b\u6bd4\uff0c\u5728\u591a\u7ebf\u7a0b\u6267\u884c\u65f6\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u5f97\u5230\u7684\u65f6\u95f4\u7247\u8f83\u5c11\uff0c\u6267\u884c\u4f1a\u6bd4\u8f83\u6162\uff1b</li> </ul> <p>\u4ee5\u4e0a\uff0c\u5c31\u662f\u7528\u6237\u7ebf\u7a0b\u7684\u4f18\u7f3a\u70b9\u4e86\u3002</p> <p>\u90a3\u5185\u6838\u7ebf\u7a0b\u5982\u4f55\u7406\u89e3\uff1f\u5b58\u5728\u4ec0\u4e48\u4f18\u52bf\u548c\u7f3a\u9677\uff1f</p> <p>\u5185\u6838\u7ebf\u7a0b\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u7684\uff0c\u7ebf\u7a0b\u5bf9\u5e94\u7684 TCB \u81ea\u7136\u662f\u653e\u5728\u64cd\u4f5c\u7cfb\u7edf\u91cc\u7684\uff0c\u8fd9\u6837\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u7ec8\u6b62\u548c\u7ba1\u7406\u90fd\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u8d1f\u8d23\u3002</p> <p>\u5185\u6838\u7ebf\u7a0b\u7684\u6a21\u578b\uff0c\u4e5f\u5c31\u7c7b\u4f3c\u524d\u9762\u63d0\u5230\u7684\u4e00\u5bf9\u4e00\u7684\u5173\u7cfb\uff0c\u5373\u4e00\u4e2a\u7528\u6237\u7ebf\u7a0b\u5bf9\u5e94\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u5185\u6838\u7ebf\u7a0b\u7684\u4f18\u70b9\uff1a</p> <ul> <li>\u5728\u4e00\u4e2a\u8fdb\u7a0b\u5f53\u4e2d\uff0c\u5982\u679c\u67d0\u4e2a\u5185\u6838\u7ebf\u7a0b\u53d1\u8d77\u7cfb\u7edf\u8c03\u7528\u800c\u88ab\u963b\u585e\uff0c\u5e76\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6\u5185\u6838\u7ebf\u7a0b\u7684\u8fd0\u884c\uff1b</li> <li>\u5206\u914d\u7ed9\u7ebf\u7a0b\uff0c\u591a\u7ebf\u7a0b\u7684\u8fdb\u7a0b\u83b7\u5f97\u66f4\u591a\u7684 CPU \u8fd0\u884c\u65f6\u95f4\uff1b</li> </ul> <p>\u5185\u6838\u7ebf\u7a0b\u7684\u7f3a\u70b9\uff1a</p> <ul> <li>\u5728\u652f\u6301\u5185\u6838\u7ebf\u7a0b\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u7531\u5185\u6838\u6765\u7ef4\u62a4\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u4e0a\u4e0b\u6587\u4fe1\u606f\uff0c\u5982 PCB \u548c TCB\uff1b</li> <li>\u7ebf\u7a0b\u7684\u521b\u5efa\u3001\u7ec8\u6b62\u548c\u5207\u6362\u90fd\u662f\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u7684\u65b9\u5f0f\u6765\u8fdb\u884c\uff0c\u56e0\u6b64\u5bf9\u4e8e\u7cfb\u7edf\u6765\u8bf4\uff0c\u7cfb\u7edf\u5f00\u9500\u6bd4\u8f83\u5927\uff1b</li> </ul> <p>\u4ee5\u4e0a\uff0c\u5c31\u662f\u5185\u6838\u7ebf\u7a0b\u7684\u4f18\u7f3a\u70b9\u4e86\u3002</p> <p>\u6700\u540e\u7684\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\u5982\u4f55\u7406\u89e3\uff1f</p> <p>\u8f7b\u91cf\u7ea7\u8fdb\u7a0b\uff08Light-weight process\uff0cLWP\uff09\u662f\u5185\u6838\u652f\u6301\u7684\u7528\u6237\u7ebf\u7a0b\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u53ef\u6709\u4e00\u4e2a\u6216\u591a\u4e2a LWP\uff0c\u6bcf\u4e2a LWP \u662f\u8ddf\u5185\u6838\u7ebf\u7a0b\u4e00\u5bf9\u4e00\u6620\u5c04\u7684\uff0c\u4e5f\u5c31\u662f LWP \u90fd\u662f\u7531\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\u652f\u6301\uff0c\u800c\u4e14 LWP \u662f\u7531\u5185\u6838\u7ba1\u7406\u5e76\u50cf\u666e\u901a\u8fdb\u7a0b\u4e00\u6837\u88ab\u8c03\u5ea6\u3002</p> <p>\u5728\u5927\u591a\u6570\u7cfb\u7edf\u4e2d\uff0cLWP \u4e0e\u666e\u901a\u8fdb\u7a0b\u7684\u533a\u522b\u4e5f\u5c31\u5728\u4e8e\u5b83\u53ea\u6709\u4e00\u4e2a\u6700\u5c0f\u7684\u6267\u884c\u4e0a\u4e0b\u6587\u548c\u8c03\u5ea6\u7a0b\u5e8f\u6240\u9700\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\u4e00\u822c\u6765\u8bf4\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u4ee3\u8868\u7a0b\u5e8f\u7684\u4e00\u4e2a\u5b9e\u4f8b\uff0c\u800c LWP \u4ee3\u8868\u7a0b\u5e8f\u7684\u6267\u884c\u7ebf\u7a0b\uff0c\u56e0\u4e3a\u4e00\u4e2a\u6267\u884c\u7ebf\u7a0b\u4e0d\u50cf\u8fdb\u7a0b\u90a3\u6837\u9700\u8981\u90a3\u4e48\u591a\u72b6\u6001\u4fe1\u606f\uff0c\u6240\u4ee5 LWP \u4e5f\u4e0d\u5e26\u6709\u8fd9\u6837\u7684\u4fe1\u606f\u3002</p> <p>\u5728 LWP \u4e4b\u4e0a\u4e5f\u662f\u53ef\u4ee5\u4f7f\u7528\u7528\u6237\u7ebf\u7a0b\u7684\uff0c\u90a3\u4e48 LWP \u4e0e\u7528\u6237\u7ebf\u7a0b\u7684\u5bf9\u5e94\u5173\u7cfb\u5c31\u6709\u4e09\u79cd\uff1a</p> <ul> <li><code>1 : 1</code>\uff0c\u5373\u4e00\u4e2a LWP \u5bf9\u5e94 \u4e00\u4e2a\u7528\u6237\u7ebf\u7a0b\uff1b</li> <li><code>N : 1</code>\uff0c\u5373\u4e00\u4e2a LWP \u5bf9\u5e94\u591a\u4e2a\u7528\u6237\u7ebf\u7a0b\uff1b</li> <li><code>M : N</code>\uff0c\u5373\u591a\u4e2a LWP \u5bf9\u5e94\u591a\u4e2a\u7528\u6237\u7ebf\u7a0b\uff1b</li> </ul> <p>\u63a5\u4e0b\u6765\u9488\u5bf9\u4e0a\u9762\u8fd9\u4e09\u79cd\u5bf9\u5e94\u5173\u7cfb\u8bf4\u660e\u5b83\u4eec\u4f18\u7f3a\u70b9\u3002\u5148\u770b\u4e0b\u56fe\u7684 LWP \u6a21\u578b\uff1a</p> <p></p> <p>1 : 1 \u6a21\u5f0f</p> <p>\u4e00\u4e2a\u7ebf\u7a0b\u5bf9\u5e94\u5230\u4e00\u4e2a LWP \u518d\u5bf9\u5e94\u5230\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\uff0c\u5982\u4e0a\u56fe\u7684\u8fdb\u7a0b 4\uff0c\u5c5e\u4e8e\u6b64\u6a21\u578b\u3002</p> <ul> <li>\u4f18\u70b9\uff1a\u5b9e\u73b0\u5e76\u884c\uff0c\u5f53\u4e00\u4e2a LWP \u963b\u585e\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6 LWP\uff1b</li> <li>\u7f3a\u70b9\uff1a\u6bcf\u4e00\u4e2a\u7528\u6237\u7ebf\u7a0b\uff0c\u5c31\u4ea7\u751f\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\uff0c\u521b\u5efa\u7ebf\u7a0b\u7684\u5f00\u9500\u8f83\u5927\u3002</li> </ul> <p>N : 1 \u6a21\u5f0f</p> <p>\u591a\u4e2a\u7528\u6237\u7ebf\u7a0b\u5bf9\u5e94\u4e00\u4e2a LWP \u518d\u5bf9\u5e94\u4e00\u4e2a\u5185\u6838\u7ebf\u7a0b\uff0c\u5982\u4e0a\u56fe\u7684\u8fdb\u7a0b 2\uff0c\u7ebf\u7a0b\u7ba1\u7406\u662f\u5728\u7528\u6237\u7a7a\u95f4\u5b8c\u6210\u7684\uff0c\u6b64\u6a21\u5f0f\u4e2d\u7528\u6237\u7684\u7ebf\u7a0b\u5bf9\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u53ef\u89c1\u3002</p> <ul> <li>\u4f18\u70b9\uff1a\u7528\u6237\u7ebf\u7a0b\u8981\u5f00\u51e0\u4e2a\u90fd\u6ca1\u95ee\u9898\uff0c\u4e14\u4e0a\u4e0b\u6587\u5207\u6362\u53d1\u751f\u5728\u7528\u6237\u7a7a\u95f4\uff0c\u5207\u6362\u7684\u6548\u7387\u8f83\u9ad8\uff1b</li> <li>\u7f3a\u70b9\uff1a\u4e00\u4e2a\u7528\u6237\u7ebf\u7a0b\u5982\u679c\u963b\u585e\u4e86\uff0c\u5219\u6574\u4e2a\u8fdb\u7a0b\u90fd\u5c06\u4f1a\u963b\u585e\uff0c\u53e6\u5916\u5728\u591a\u6838 CPU  \u4e2d\uff0c\u662f\u6ca1\u529e\u6cd5\u5145\u5206\u5229\u7528 CPU \u7684\u3002</li> </ul> <p>M : N \u6a21\u5f0f</p> <p>\u6839\u636e\u524d\u9762\u7684\u4e24\u4e2a\u6a21\u578b\u6df7\u642d\u4e00\u8d77\uff0c\u5c31\u5f62\u6210 <code>M:N</code> \u6a21\u578b\uff0c\u8be5\u6a21\u578b\u63d0\u4f9b\u4e86\u4e24\u7ea7\u63a7\u5236\uff0c\u9996\u5148\u591a\u4e2a\u7528\u6237\u7ebf\u7a0b\u5bf9\u5e94\u5230\u591a\u4e2a LWP\uff0cLWP \u518d\u4e00\u4e00\u5bf9\u5e94\u5230\u5185\u6838\u7ebf\u7a0b\uff0c\u5982\u4e0a\u56fe\u7684\u8fdb\u7a0b 3\u3002</p> <ul> <li>\u4f18\u70b9\uff1a\u7efc\u5408\u4e86\u524d\u4e24\u79cd\u4f18\u70b9\uff0c\u5927\u90e8\u5206\u7684\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u53d1\u751f\u5728\u7528\u6237\u7a7a\u95f4\uff0c\u4e14\u591a\u4e2a\u7ebf\u7a0b\u53c8\u53ef\u4ee5\u5145\u5206\u5229\u7528\u591a\u6838 CPU \u7684\u8d44\u6e90\u3002</li> </ul> <p>\u7ec4\u5408\u6a21\u5f0f</p> <p>\u5982\u4e0a\u56fe\u7684\u8fdb\u7a0b 5\uff0c\u6b64\u8fdb\u7a0b\u7ed3\u5408 <code>1:1</code> \u6a21\u578b\u548c <code>M:N</code> \u6a21\u578b\u3002\u5f00\u53d1\u4eba\u5458\u53ef\u4ee5\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u7279\u70b9\u8c03\u8282\u5185\u6838\u7ebf\u7a0b\u7684\u6570\u76ee\u6765\u8fbe\u5230\u7269\u7406\u5e76\u884c\u6027\u548c\u903b\u8f91\u5e76\u884c\u6027\u7684\u6700\u4f73\u65b9\u6848\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_12","title":"\u8c03\u5ea6","text":"<p>\u8fdb\u7a0b\u90fd\u5e0c\u671b\u81ea\u5df1\u80fd\u591f\u5360\u7528 CPU \u8fdb\u884c\u5de5\u4f5c\uff0c\u90a3\u4e48\u8fd9\u6d89\u53ca\u5230\u524d\u9762\u8bf4\u8fc7\u7684\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u3002</p> <p>\u4e00\u65e6\u64cd\u4f5c\u7cfb\u7edf\u628a\u8fdb\u7a0b\u5207\u6362\u5230\u8fd0\u884c\u72b6\u6001\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u8be5\u8fdb\u7a0b\u5360\u7528\u7740 CPU \u5728\u6267\u884c\uff0c\u4f46\u662f\u5f53\u64cd\u4f5c\u7cfb\u7edf\u628a\u8fdb\u7a0b\u5207\u6362\u5230\u5176\u4ed6\u72b6\u6001\u65f6\uff0c\u90a3\u5c31\u4e0d\u80fd\u5728 CPU \u4e2d\u6267\u884c\u4e86\uff0c\u4e8e\u662f\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u9009\u62e9\u4e0b\u4e00\u4e2a\u8981\u8fd0\u884c\u7684\u8fdb\u7a0b\u3002</p> <p>\u9009\u62e9\u4e00\u4e2a\u8fdb\u7a0b\u8fd0\u884c\u8fd9\u4e00\u529f\u80fd\u662f\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5b8c\u6210\u7684\uff0c\u901a\u5e38\u79f0\u4e3a\u8c03\u5ea6\u7a0b\u5e8f\uff08scheduler\uff09\u3002</p> <p>\u90a3\u5230\u5e95\u4ec0\u4e48\u65f6\u5019\u8c03\u5ea6\u8fdb\u7a0b\uff0c\u6216\u4ee5\u4ec0\u4e48\u539f\u5219\u6765\u8c03\u5ea6\u8fdb\u7a0b\u5462\uff1f</p> <p>::: tip</p> <p>\u6211\u77e5\u9053\u5f88\u591a\u4eba\u4f1a\u95ee\uff0c\u7ebf\u7a0b\u4e0d\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u8c03\u5ea6\u5355\u4f4d\u5417\uff1f\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u53c2\u4e0e\u8c03\u5ea6\u7684\u662f\u8fdb\u7a0b\uff1f</p> <p>\u5148\u63d0\u524d\u8bf4\u660e\uff0c\u8fd9\u91cc\u7684\u8fdb\u7a0b\u6307\u53ea\u6709\u4e3b\u7ebf\u7a0b\u7684\u8fdb\u7a0b\uff0c\u6240\u4ee5\u8c03\u5ea6\u4e3b\u7ebf\u7a0b\u5c31\u7b49\u4e8e\u8c03\u5ea6\u4e86\u6574\u4e2a\u8fdb\u7a0b\u3002</p> <p>\u90a3\u4e3a\u4ec0\u4e48\u5e72\u8106\u4e0d\u76f4\u63a5\u53d6\u540d\u7ebf\u7a0b\u8c03\u5ea6\uff1f\u4e3b\u8981\u662f\u64cd\u4f5c\u7cfb\u7edf\u76f8\u5173\u4e66\u7c4d\uff0c\u90fd\u662f\u7528\u8fdb\u7a0b\u8c03\u5ea6\u8fd9\u4e2a\u540d\u5b57\uff0c\u6240\u4ee5\u6211\u4e5f\u6cbf\u7528\u4e86\u8fd9\u4e2a\u540d\u5b57\u3002</p> <p>:::</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_13","title":"\u8c03\u5ea6\u65f6\u673a","text":"<p>\u5728\u8fdb\u7a0b\u7684\u751f\u547d\u5468\u671f\u4e2d\uff0c\u5f53\u8fdb\u7a0b\u4ece\u4e00\u4e2a\u8fd0\u884c\u72b6\u6001\u5230\u53e6\u5916\u4e00\u72b6\u6001\u53d8\u5316\u7684\u65f6\u5019\uff0c\u5176\u5b9e\u4f1a\u89e6\u53d1\u4e00\u6b21\u8c03\u5ea6\u3002</p> <p>\u6bd4\u5982\uff0c\u4ee5\u4e0b\u72b6\u6001\u7684\u53d8\u5316\u90fd\u4f1a\u89e6\u53d1\u64cd\u4f5c\u7cfb\u7edf\u7684\u8c03\u5ea6\uff1a</p> <ul> <li>\u4ece\u5c31\u7eea\u6001 -&gt; \u8fd0\u884c\u6001\uff1a\u5f53\u8fdb\u7a0b\u88ab\u521b\u5efa\u65f6\uff0c\u4f1a\u8fdb\u5165\u5230\u5c31\u7eea\u961f\u5217\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4ece\u5c31\u7eea\u961f\u5217\u9009\u62e9\u4e00\u4e2a\u8fdb\u7a0b\u8fd0\u884c\uff1b</li> <li>\u4ece\u8fd0\u884c\u6001 -&gt; \u963b\u585e\u6001\uff1a\u5f53\u8fdb\u7a0b\u53d1\u751f I/O \u4e8b\u4ef6\u800c\u963b\u585e\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5fc5\u987b\u9009\u62e9\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u8fd0\u884c\uff1b</li> <li>\u4ece\u8fd0\u884c\u6001 -&gt; \u7ed3\u675f\u6001\uff1a\u5f53\u8fdb\u7a0b\u9000\u51fa\u7ed3\u675f\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5f97\u4ece\u5c31\u7eea\u961f\u5217\u9009\u62e9\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u8fd0\u884c\uff1b</li> </ul> <p>\u56e0\u4e3a\uff0c\u8fd9\u4e9b\u72b6\u6001\u53d8\u5316\u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7cfb\u7edf\u9700\u8981\u8003\u8651\u662f\u5426\u8981\u8ba9\u65b0\u7684\u8fdb\u7a0b\u7ed9 CPU \u8fd0\u884c\uff0c\u6216\u8005\u662f\u5426\u8ba9\u5f53\u524d\u8fdb\u7a0b\u4ece CPU \u4e0a\u9000\u51fa\u6765\u800c\u6362\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u8fd0\u884c\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c\u786c\u4ef6\u65f6\u949f\u63d0\u4f9b\u67d0\u4e2a\u9891\u7387\u7684\u5468\u671f\u6027\u4e2d\u65ad\uff0c\u90a3\u4e48\u53ef\u4ee5\u6839\u636e\u5982\u4f55\u5904\u7406\u65f6\u949f\u4e2d\u65ad \uff0c\u628a\u8c03\u5ea6\u7b97\u6cd5\u5206\u4e3a\u4e24\u7c7b\uff1a</p> <ul> <li>\u975e\u62a2\u5360\u5f0f\u8c03\u5ea6\u7b97\u6cd5\u6311\u9009\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7136\u540e\u8ba9\u8be5\u8fdb\u7a0b\u8fd0\u884c\u76f4\u5230\u88ab\u963b\u585e\uff0c\u6216\u8005\u76f4\u5230\u8be5\u8fdb\u7a0b\u9000\u51fa\uff0c\u624d\u4f1a\u8c03\u7528\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u4f1a\u7406\u65f6\u949f\u4e2d\u65ad\u8fd9\u4e2a\u4e8b\u60c5\u3002</li> <li>\u62a2\u5360\u5f0f\u8c03\u5ea6\u7b97\u6cd5\u6311\u9009\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u7136\u540e\u8ba9\u8be5\u8fdb\u7a0b\u53ea\u8fd0\u884c\u67d0\u6bb5\u65f6\u95f4\uff0c\u5982\u679c\u5728\u8be5\u65f6\u6bb5\u7ed3\u675f\u65f6\uff0c\u8be5\u8fdb\u7a0b\u4ecd\u7136\u5728\u8fd0\u884c\u65f6\uff0c\u5219\u4f1a\u628a\u5b83\u6302\u8d77\uff0c\u63a5\u7740\u8c03\u5ea6\u7a0b\u5e8f\u4ece\u5c31\u7eea\u961f\u5217\u6311\u9009\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u3002\u8fd9\u79cd\u62a2\u5360\u5f0f\u8c03\u5ea6\u5904\u7406\uff0c\u9700\u8981\u5728\u65f6\u95f4\u95f4\u9694\u7684\u672b\u7aef\u53d1\u751f\u65f6\u949f\u4e2d\u65ad\uff0c\u4ee5\u4fbf\u628a CPU \u63a7\u5236\u8fd4\u56de\u7ed9\u8c03\u5ea6\u7a0b\u5e8f\u8fdb\u884c\u8c03\u5ea6\uff0c\u4e5f\u5c31\u662f\u5e38\u8bf4\u7684\u65f6\u95f4\u7247\u673a\u5236\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_14","title":"\u8c03\u5ea6\u539f\u5219","text":"<p>\u539f\u5219\u4e00\uff1a\u5982\u679c\u8fd0\u884c\u7684\u7a0b\u5e8f\uff0c\u53d1\u751f\u4e86 I/O \u4e8b\u4ef6\u7684\u8bf7\u6c42\uff0c\u90a3 CPU \u4f7f\u7528\u7387\u5fc5\u7136\u4f1a\u5f88\u4f4e\uff0c\u56e0\u4e3a\u6b64\u65f6\u8fdb\u7a0b\u5728\u963b\u585e\u7b49\u5f85\u786c\u76d8\u7684\u6570\u636e\u8fd4\u56de\u3002\u8fd9\u6837\u7684\u8fc7\u7a0b\uff0c\u52bf\u5fc5\u4f1a\u9020\u6210 CPU \u7a81\u7136\u7684\u7a7a\u95f2\u3002\u6240\u4ee5\uff0c\u4e3a\u4e86\u63d0\u9ad8 CPU \u5229\u7528\u7387\uff0c\u5728\u8fd9\u79cd\u53d1\u9001 I/O \u4e8b\u4ef6\u81f4\u4f7f CPU \u7a7a\u95f2\u7684\u60c5\u51b5\u4e0b\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u9700\u8981\u4ece\u5c31\u7eea\u961f\u5217\u4e2d\u9009\u62e9\u4e00\u4e2a\u8fdb\u7a0b\u6765\u8fd0\u884c\u3002</p> <p>\u539f\u5219\u4e8c\uff1a\u6709\u7684\u7a0b\u5e8f\u6267\u884c\u67d0\u4e2a\u4efb\u52a1\u82b1\u8d39\u7684\u65f6\u95f4\u4f1a\u6bd4\u8f83\u957f\uff0c\u5982\u679c\u8fd9\u4e2a\u7a0b\u5e8f\u4e00\u76f4\u5360\u7528\u7740 CPU\uff0c\u4f1a\u9020\u6210\u7cfb\u7edf\u541e\u5410\u91cf\uff08CPU \u5728\u5355\u4f4d\u65f6\u95f4\u5185\u5b8c\u6210\u7684\u8fdb\u7a0b\u6570\u91cf\uff09\u7684\u964d\u4f4e\u3002\u6240\u4ee5\uff0c\u8981\u63d0\u9ad8\u7cfb\u7edf\u7684\u541e\u5410\u7387\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u8981\u6743\u8861\u957f\u4efb\u52a1\u548c\u77ed\u4efb\u52a1\u8fdb\u7a0b\u7684\u8fd0\u884c\u5b8c\u6210\u6570\u91cf\u3002</p> <p>\u539f\u5219\u4e09\uff1a\u4ece\u8fdb\u7a0b\u5f00\u59cb\u5230\u7ed3\u675f\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5b9e\u9645\u4e0a\u662f\u5305\u542b\u4e24\u4e2a\u65f6\u95f4\uff0c\u5206\u522b\u662f\u8fdb\u7a0b\u8fd0\u884c\u65f6\u95f4\u548c\u8fdb\u7a0b\u7b49\u5f85\u65f6\u95f4\uff0c\u8fd9\u4e24\u4e2a\u65f6\u95f4\u603b\u548c\u5c31\u79f0\u4e3a\u5468\u8f6c\u65f6\u95f4\u3002\u8fdb\u7a0b\u7684\u5468\u8f6c\u65f6\u95f4\u8d8a\u5c0f\u8d8a\u597d\uff0c\u5982\u679c\u8fdb\u7a0b\u7684\u7b49\u5f85\u65f6\u95f4\u5f88\u957f\u800c\u8fd0\u884c\u65f6\u95f4\u5f88\u77ed\uff0c\u90a3\u5468\u8f6c\u65f6\u95f4\u5c31\u5f88\u957f\uff0c\u8fd9\u4e0d\u662f\u6211\u4eec\u6240\u671f\u671b\u7684\uff0c\u8c03\u5ea6\u7a0b\u5e8f\u5e94\u8be5\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\u3002</p> <p>\u539f\u5219\u56db\uff1a\u5904\u4e8e\u5c31\u7eea\u961f\u5217\u7684\u8fdb\u7a0b\uff0c\u4e5f\u4e0d\u80fd\u7b49\u592a\u4e45\uff0c\u5f53\u7136\u5e0c\u671b\u8fd9\u4e2a\u7b49\u5f85\u7684\u65f6\u95f4\u8d8a\u77ed\u8d8a\u597d\uff0c\u8fd9\u6837\u53ef\u4ee5\u4f7f\u5f97\u8fdb\u7a0b\u66f4\u5feb\u7684\u5728 CPU \u4e2d\u6267\u884c\u3002\u6240\u4ee5\uff0c\u5c31\u7eea\u961f\u5217\u4e2d\u8fdb\u7a0b\u7684\u7b49\u5f85\u65f6\u95f4\u4e5f\u662f\u8c03\u5ea6\u7a0b\u5e8f\u6240\u9700\u8981\u8003\u8651\u7684\u539f\u5219\u3002</p> <p>\u539f\u5219\u4e94\uff1a\u5bf9\u4e8e\u9f20\u6807\u3001\u952e\u76d8\u8fd9\u79cd\u4ea4\u4e92\u5f0f\u6bd4\u8f83\u5f3a\u7684\u5e94\u7528\uff0c\u6211\u4eec\u5f53\u7136\u5e0c\u671b\u5b83\u7684\u54cd\u5e94\u65f6\u95f4\u8d8a\u5feb\u8d8a\u597d\uff0c\u5426\u5219\u5c31\u4f1a\u5f71\u54cd\u7528\u6237\u4f53\u9a8c\u4e86\u3002\u6240\u4ee5\uff0c\u5bf9\u4e8e\u4ea4\u4e92\u5f0f\u6bd4\u8f83\u5f3a\u7684\u5e94\u7528\uff0c\u54cd\u5e94\u65f6\u95f4\u4e5f\u662f\u8c03\u5ea6\u7a0b\u5e8f\u9700\u8981\u8003\u8651\u7684\u539f\u5219\u3002</p> <p></p> <p>\u9488\u5bf9\u4e0a\u9762\u7684\u4e94\u79cd\u8c03\u5ea6\u539f\u5219\uff0c\u603b\u7ed3\u6210\u5982\u4e0b\uff1a</p> <ul> <li>CPU \u5229\u7528\u7387\uff1a\u8c03\u5ea6\u7a0b\u5e8f\u5e94\u786e\u4fdd CPU \u662f\u59cb\u7ec8\u5306\u5fd9\u7684\u72b6\u6001\uff0c\u8fd9\u53ef\u63d0\u9ad8 CPU \u7684\u5229\u7528\u7387\uff1b</li> <li>\u7cfb\u7edf\u541e\u5410\u91cf\uff1a\u541e\u5410\u91cf\u8868\u793a\u7684\u662f\u5355\u4f4d\u65f6\u95f4\u5185 CPU \u5b8c\u6210\u8fdb\u7a0b\u7684\u6570\u91cf\uff0c\u957f\u4f5c\u4e1a\u7684\u8fdb\u7a0b\u4f1a\u5360\u7528\u8f83\u957f\u7684 CPU \u8d44\u6e90\uff0c\u56e0\u6b64\u4f1a\u964d\u4f4e\u541e\u5410\u91cf\uff0c\u76f8\u53cd\uff0c\u77ed\u4f5c\u4e1a\u7684\u8fdb\u7a0b\u4f1a\u63d0\u5347\u7cfb\u7edf\u541e\u5410\u91cf\uff1b</li> <li>\u5468\u8f6c\u65f6\u95f4\uff1a\u5468\u8f6c\u65f6\u95f4\u662f\u8fdb\u7a0b\u8fd0\u884c + \u963b\u585e\u65f6\u95f4 + \u7b49\u5f85\u65f6\u95f4\u7684\u603b\u548c\uff0c\u4e00\u4e2a\u8fdb\u7a0b\u7684\u5468\u8f6c\u65f6\u95f4\u8d8a\u5c0f\u8d8a\u597d\uff1b</li> <li>\u7b49\u5f85\u65f6\u95f4\uff1a\u8fd9\u4e2a\u7b49\u5f85\u65f6\u95f4\u4e0d\u662f\u963b\u585e\u72b6\u6001\u7684\u65f6\u95f4\uff0c\u800c\u662f\u8fdb\u7a0b\u5904\u4e8e\u5c31\u7eea\u961f\u5217\u7684\u65f6\u95f4\uff0c\u7b49\u5f85\u7684\u65f6\u95f4\u8d8a\u957f\uff0c\u7528\u6237\u8d8a\u4e0d\u6ee1\u610f\uff1b</li> <li>\u54cd\u5e94\u65f6\u95f4\uff1a\u7528\u6237\u63d0\u4ea4\u8bf7\u6c42\u5230\u7cfb\u7edf\u7b2c\u4e00\u6b21\u4ea7\u751f\u54cd\u5e94\u6240\u82b1\u8d39\u7684\u65f6\u95f4\uff0c\u5728\u4ea4\u4e92\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u54cd\u5e94\u65f6\u95f4\u662f\u8861\u91cf\u8c03\u5ea6\u7b97\u6cd5\u597d\u574f\u7684\u4e3b\u8981\u6807\u51c6\u3002</li> </ul> <p>\u8bf4\u767d\u4e86\uff0c\u8fd9\u4e48\u591a\u8c03\u5ea6\u539f\u5219\uff0c\u76ee\u7684\u5c31\u662f\u8981\u4f7f\u5f97\u8fdb\u7a0b\u8981\u300c\u5feb\u300d\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_15","title":"\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u4e0d\u540c\u7684\u8c03\u5ea6\u7b97\u6cd5\u9002\u7528\u7684\u573a\u666f\u4e5f\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8bf4\u8bf4\u5728\u5355\u6838 CPU \u7cfb\u7edf\u4e2d\u5e38\u89c1\u7684\u8c03\u5ea6\u7b97\u6cd5\u3002</p> <p>01 \u5148\u6765\u5148\u670d\u52a1\u8c03\u5ea6\u7b97\u6cd5</p> <p>\u6700\u7b80\u5355\u7684\u4e00\u4e2a\u8c03\u5ea6\u7b97\u6cd5\uff0c\u5c31\u662f\u975e\u62a2\u5360\u5f0f\u7684\u5148\u6765\u5148\u670d\u52a1\uff08First Come First Serve, FCFS\uff09\u7b97\u6cd5\u4e86\u3002</p> <p></p> <p>\u987e\u540d\u601d\u4e49\uff0c\u5148\u6765\u540e\u5230\uff0c\u6bcf\u6b21\u4ece\u5c31\u7eea\u961f\u5217\u9009\u62e9\u6700\u5148\u8fdb\u5165\u961f\u5217\u7684\u8fdb\u7a0b\uff0c\u7136\u540e\u4e00\u76f4\u8fd0\u884c\uff0c\u76f4\u5230\u8fdb\u7a0b\u9000\u51fa\u6216\u88ab\u963b\u585e\uff0c\u624d\u4f1a\u7ee7\u7eed\u4ece\u961f\u5217\u4e2d\u9009\u62e9\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u63a5\u7740\u8fd0\u884c\u3002</p> <p>\u8fd9\u4f3c\u4e4e\u5f88\u516c\u5e73\uff0c\u4f46\u662f\u5f53\u4e00\u4e2a\u957f\u4f5c\u4e1a\u5148\u8fd0\u884c\u4e86\uff0c\u90a3\u4e48\u540e\u9762\u7684\u77ed\u4f5c\u4e1a\u7b49\u5f85\u7684\u65f6\u95f4\u5c31\u4f1a\u5f88\u957f\uff0c\u4e0d\u5229\u4e8e\u77ed\u4f5c\u4e1a\u3002</p> <p>FCFS \u5bf9\u957f\u4f5c\u4e1a\u6709\u5229\uff0c\u9002\u7528\u4e8e CPU \u7e41\u5fd9\u578b\u4f5c\u4e1a\u7684\u7cfb\u7edf\uff0c\u800c\u4e0d\u9002\u7528\u4e8e I/O \u7e41\u5fd9\u578b\u4f5c\u4e1a\u7684\u7cfb\u7edf\u3002</p> <p>02 \u6700\u77ed\u4f5c\u4e1a\u4f18\u5148\u8c03\u5ea6\u7b97\u6cd5</p> <p>\u6700\u77ed\u4f5c\u4e1a\u4f18\u5148\uff08Shortest Job First, SJF\uff09\u8c03\u5ea6\u7b97\u6cd5\u540c\u6837\u4e5f\u662f\u987e\u540d\u601d\u4e49\uff0c\u5b83\u4f1a\u4f18\u5148\u9009\u62e9\u8fd0\u884c\u65f6\u95f4\u6700\u77ed\u7684\u8fdb\u7a0b\u6765\u8fd0\u884c\uff0c\u8fd9\u6709\u52a9\u4e8e\u63d0\u9ad8\u7cfb\u7edf\u7684\u541e\u5410\u91cf\u3002</p> <p></p> <p>\u8fd9\u663e\u7136\u5bf9\u957f\u4f5c\u4e1a\u4e0d\u5229\uff0c\u5f88\u5bb9\u6613\u9020\u6210\u4e00\u79cd\u6781\u7aef\u73b0\u8c61\u3002</p> <p>\u6bd4\u5982\uff0c\u4e00\u4e2a\u957f\u4f5c\u4e1a\u5728\u5c31\u7eea\u961f\u5217\u7b49\u5f85\u8fd0\u884c\uff0c\u800c\u8fd9\u4e2a\u5c31\u7eea\u961f\u5217\u6709\u975e\u5e38\u591a\u7684\u77ed\u4f5c\u4e1a\uff0c\u90a3\u4e48\u5c31\u4f1a\u4f7f\u5f97\u957f\u4f5c\u4e1a\u4e0d\u65ad\u7684\u5f80\u540e\u63a8\uff0c\u5468\u8f6c\u65f6\u95f4\u53d8\u957f\uff0c\u81f4\u4f7f\u957f\u4f5c\u4e1a\u957f\u671f\u4e0d\u4f1a\u88ab\u8fd0\u884c\u3002</p> <p>03 \u9ad8\u54cd\u5e94\u6bd4\u4f18\u5148\u8c03\u5ea6\u7b97\u6cd5</p> <p>\u524d\u9762\u7684\u300c\u5148\u6765\u5148\u670d\u52a1\u8c03\u5ea6\u7b97\u6cd5\u300d\u548c\u300c\u6700\u77ed\u4f5c\u4e1a\u4f18\u5148\u8c03\u5ea6\u7b97\u6cd5\u300d\u90fd\u6ca1\u6709\u5f88\u597d\u7684\u6743\u8861\u77ed\u4f5c\u4e1a\u548c\u957f\u4f5c\u4e1a\u3002</p> <p>\u90a3\u4e48\uff0c\u9ad8\u54cd\u5e94\u6bd4\u4f18\u5148 \uff08Highest Response Ratio Next, HRRN\uff09\u8c03\u5ea6\u7b97\u6cd5\u4e3b\u8981\u662f\u6743\u8861\u4e86\u77ed\u4f5c\u4e1a\u548c\u957f\u4f5c\u4e1a\u3002</p> <p>\u6bcf\u6b21\u8fdb\u884c\u8fdb\u7a0b\u8c03\u5ea6\u65f6\uff0c\u5148\u8ba1\u7b97\u300c\u54cd\u5e94\u6bd4\u4f18\u5148\u7ea7\u300d\uff0c\u7136\u540e\u628a\u300c\u54cd\u5e94\u6bd4\u4f18\u5148\u7ea7\u300d\u6700\u9ad8\u7684\u8fdb\u7a0b\u6295\u5165\u8fd0\u884c\uff0c\u300c\u54cd\u5e94\u6bd4\u4f18\u5148\u7ea7\u300d\u7684\u8ba1\u7b97\u516c\u5f0f\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684\u516c\u5f0f\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a</p> <ul> <li>\u5982\u679c\u4e24\u4e2a\u8fdb\u7a0b\u7684\u300c\u7b49\u5f85\u65f6\u95f4\u300d\u76f8\u540c\u65f6\uff0c\u300c\u8981\u6c42\u7684\u670d\u52a1\u65f6\u95f4\u300d\u8d8a\u77ed\uff0c\u300c\u54cd\u5e94\u6bd4\u300d\u5c31\u8d8a\u9ad8\uff0c\u8fd9\u6837\u77ed\u4f5c\u4e1a\u7684\u8fdb\u7a0b\u5bb9\u6613\u88ab\u9009\u4e2d\u8fd0\u884c\uff1b</li> <li>\u5982\u679c\u4e24\u4e2a\u8fdb\u7a0b\u300c\u8981\u6c42\u7684\u670d\u52a1\u65f6\u95f4\u300d\u76f8\u540c\u65f6\uff0c\u300c\u7b49\u5f85\u65f6\u95f4\u300d\u8d8a\u957f\uff0c\u300c\u54cd\u5e94\u6bd4\u300d\u5c31\u8d8a\u9ad8\uff0c\u8fd9\u5c31\u517c\u987e\u5230\u4e86\u957f\u4f5c\u4e1a\u8fdb\u7a0b\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u7684\u54cd\u5e94\u6bd4\u53ef\u4ee5\u968f\u65f6\u95f4\u7b49\u5f85\u7684\u589e\u52a0\u800c\u63d0\u9ad8\uff0c\u5f53\u5176\u7b49\u5f85\u65f6\u95f4\u8db3\u591f\u957f\u65f6\uff0c\u5176\u54cd\u5e94\u6bd4\u4fbf\u53ef\u4ee5\u5347\u5230\u5f88\u9ad8\uff0c\u4ece\u800c\u83b7\u5f97\u8fd0\u884c\u7684\u673a\u4f1a\uff1b</li> </ul> <p>::: tip</p> <p>\u5f88\u591a\u4eba\u95ee\u600e\u4e48\u624d\u80fd\u77e5\u9053\u4e00\u4e2a\u8fdb\u7a0b\u8981\u6c42\u670d\u52a1\u7684\u65f6\u95f4\uff1f\u8fd9\u4e0d\u662f\u4e0d\u53ef\u9884\u77e5\u7684\u5417\uff1f</p> <p>\u5bf9\u7684\uff0c\u8fd9\u662f\u4e0d\u53ef\u9884\u4f30\u7684\u3002\u6240\u4ee5\uff0c\u9ad8\u54cd\u5e94\u6bd4\u4f18\u5148\u8c03\u5ea6\u7b97\u6cd5\u662f\u300c\u7406\u60f3\u578b\u300d\u7684\u8c03\u5ea6\u7b97\u6cd5\uff0c\u73b0\u5b9e\u4e2d\u662f\u5b9e\u73b0\u4e0d\u4e86\u7684\u3002</p> <p>:::</p> <p>04 \u65f6\u95f4\u7247\u8f6e\u8f6c\u8c03\u5ea6\u7b97\u6cd5</p> <p>\u6700\u53e4\u8001\u3001\u6700\u7b80\u5355\u3001\u6700\u516c\u5e73\u4e14\u4f7f\u7528\u6700\u5e7f\u7684\u7b97\u6cd5\u5c31\u662f\u65f6\u95f4\u7247\u8f6e\u8f6c\uff08Round Robin, RR\uff09\u8c03\u5ea6\u7b97\u6cd5\u3002</p> <p></p> <p>\u6bcf\u4e2a\u8fdb\u7a0b\u88ab\u5206\u914d\u4e00\u4e2a\u65f6\u95f4\u6bb5\uff0c\u79f0\u4e3a\u65f6\u95f4\u7247\uff08Quantum\uff09\uff0c\u5373\u5141\u8bb8\u8be5\u8fdb\u7a0b\u5728\u8be5\u65f6\u95f4\u6bb5\u4e2d\u8fd0\u884c\u3002</p> <ul> <li>\u5982\u679c\u65f6\u95f4\u7247\u7528\u5b8c\uff0c\u8fdb\u7a0b\u8fd8\u5728\u8fd0\u884c\uff0c\u90a3\u4e48\u5c06\u4f1a\u628a\u6b64\u8fdb\u7a0b\u4ece CPU \u91ca\u653e\u51fa\u6765\uff0c\u5e76\u628a CPU \u5206\u914d\u7ed9\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\uff1b</li> <li>\u5982\u679c\u8be5\u8fdb\u7a0b\u5728\u65f6\u95f4\u7247\u7ed3\u675f\u524d\u963b\u585e\u6216\u7ed3\u675f\uff0c\u5219 CPU \u7acb\u5373\u8fdb\u884c\u5207\u6362\uff1b</li> </ul> <p>\u53e6\u5916\uff0c\u65f6\u95f4\u7247\u7684\u957f\u5ea6\u5c31\u662f\u4e00\u4e2a\u5f88\u5173\u952e\u7684\u70b9\uff1a</p> <ul> <li>\u5982\u679c\u65f6\u95f4\u7247\u8bbe\u5f97\u592a\u77ed\u4f1a\u5bfc\u81f4\u8fc7\u591a\u7684\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u964d\u4f4e\u4e86 CPU \u6548\u7387\uff1b</li> <li>\u5982\u679c\u65f6\u95f4\u7247\u8bbe\u5f97\u592a\u957f\u53c8\u53ef\u80fd\u5f15\u8d77\u77ed\u4f5c\u4e1a\u8fdb\u7a0b\u7684\u54cd\u5e94\u65f6\u95f4\u53d8\u957f\uff0c\u4e0d\u5229\u4e8e\u77ed\u4f5c\u4e1a\u3002</li> </ul> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u65f6\u95f4\u7247\u8bbe\u4e3a <code>20ms~50ms</code> \u901a\u5e38\u662f\u4e00\u4e2a\u6bd4\u8f83\u5408\u7406\u7684\u6298\u4e2d\u503c\u3002</p> <p>05 \u6700\u9ad8\u4f18\u5148\u7ea7\u8c03\u5ea6\u7b97\u6cd5</p> <p>\u524d\u9762\u7684\u300c\u65f6\u95f4\u7247\u8f6e\u8f6c\u7b97\u6cd5\u300d\u505a\u4e86\u4e2a\u5047\u8bbe\uff0c\u5373\u8ba9\u6240\u6709\u7684\u8fdb\u7a0b\u540c\u7b49\u91cd\u8981\uff0c\u4e5f\u4e0d\u504f\u8892\u8c01\uff0c\u5927\u5bb6\u7684\u8fd0\u884c\u65f6\u95f4\u90fd\u4e00\u6837\u3002</p> <p>\u4f46\u662f\uff0c\u5bf9\u4e8e\u591a\u7528\u6237\u8ba1\u7b97\u673a\u7cfb\u7edf\u5c31\u6709\u4e0d\u540c\u7684\u770b\u6cd5\u4e86\uff0c\u5b83\u4eec\u5e0c\u671b\u8c03\u5ea6\u662f\u6709\u4f18\u5148\u7ea7\u7684\uff0c\u5373\u5e0c\u671b\u8c03\u5ea6\u7a0b\u5e8f\u80fd\u4ece\u5c31\u7eea\u961f\u5217\u4e2d\u9009\u62e9\u6700\u9ad8\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u8fdb\u884c\u8fd0\u884c\uff0c\u8fd9\u79f0\u4e3a\u6700\u9ad8\u4f18\u5148\u7ea7\uff08Highest Priority First\uff0cHPF\uff09\u8c03\u5ea6\u7b97\u6cd5\u3002</p> <p>\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u53ef\u4ee5\u5206\u4e3a\uff0c\u9759\u6001\u4f18\u5148\u7ea7\u548c\u52a8\u6001\u4f18\u5148\u7ea7\uff1a</p> <ul> <li>\u9759\u6001\u4f18\u5148\u7ea7\uff1a\u521b\u5efa\u8fdb\u7a0b\u65f6\u5019\uff0c\u5c31\u5df2\u7ecf\u786e\u5b9a\u4e86\u4f18\u5148\u7ea7\u4e86\uff0c\u7136\u540e\u6574\u4e2a\u8fd0\u884c\u65f6\u95f4\u4f18\u5148\u7ea7\u90fd\u4e0d\u4f1a\u53d8\u5316\uff1b</li> <li>\u52a8\u6001\u4f18\u5148\u7ea7\uff1a\u6839\u636e\u8fdb\u7a0b\u7684\u52a8\u6001\u53d8\u5316\u8c03\u6574\u4f18\u5148\u7ea7\uff0c\u6bd4\u5982\u5982\u679c\u8fdb\u7a0b\u8fd0\u884c\u65f6\u95f4\u589e\u52a0\uff0c\u5219\u964d\u4f4e\u5176\u4f18\u5148\u7ea7\uff0c\u5982\u679c\u8fdb\u7a0b\u7b49\u5f85\u65f6\u95f4\uff08\u5c31\u7eea\u961f\u5217\u7684\u7b49\u5f85\u65f6\u95f4\uff09\u589e\u52a0\uff0c\u5219\u5347\u9ad8\u5176\u4f18\u5148\u7ea7\uff0c\u4e5f\u5c31\u662f\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u589e\u52a0\u7b49\u5f85\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u3002</li> </ul> <p>\u8be5\u7b97\u6cd5\u4e5f\u6709\u4e24\u79cd\u5904\u7406\u4f18\u5148\u7ea7\u9ad8\u7684\u65b9\u6cd5\uff0c\u975e\u62a2\u5360\u5f0f\u548c\u62a2\u5360\u5f0f\uff1a</p> <ul> <li>\u975e\u62a2\u5360\u5f0f\uff1a\u5f53\u5c31\u7eea\u961f\u5217\u4e2d\u51fa\u73b0\u4f18\u5148\u7ea7\u9ad8\u7684\u8fdb\u7a0b\uff0c\u8fd0\u884c\u5b8c\u5f53\u524d\u8fdb\u7a0b\uff0c\u518d\u9009\u62e9\u4f18\u5148\u7ea7\u9ad8\u7684\u8fdb\u7a0b\u3002</li> <li>\u62a2\u5360\u5f0f\uff1a\u5f53\u5c31\u7eea\u961f\u5217\u4e2d\u51fa\u73b0\u4f18\u5148\u7ea7\u9ad8\u7684\u8fdb\u7a0b\uff0c\u5f53\u524d\u8fdb\u7a0b\u6302\u8d77\uff0c\u8c03\u5ea6\u4f18\u5148\u7ea7\u9ad8\u7684\u8fdb\u7a0b\u8fd0\u884c\u3002</li> </ul> <p>\u4f46\u662f\u4f9d\u7136\u6709\u7f3a\u70b9\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4f4e\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u6c38\u8fdc\u4e0d\u4f1a\u8fd0\u884c\u3002</p> <p>06 \u591a\u7ea7\u53cd\u9988\u961f\u5217\u8c03\u5ea6\u7b97\u6cd5</p> <p>\u591a\u7ea7\u53cd\u9988\u961f\u5217\uff08Multilevel Feedback Queue\uff09\u8c03\u5ea6\u7b97\u6cd5\u662f\u300c\u65f6\u95f4\u7247\u8f6e\u8f6c\u7b97\u6cd5\u300d\u548c\u300c\u6700\u9ad8\u4f18\u5148\u7ea7\u7b97\u6cd5\u300d\u7684\u7efc\u5408\u548c\u53d1\u5c55\u3002</p> <p>\u987e\u540d\u601d\u4e49\uff1a</p> <ul> <li>\u300c\u591a\u7ea7\u300d\u8868\u793a\u6709\u591a\u4e2a\u961f\u5217\uff0c\u6bcf\u4e2a\u961f\u5217\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u4f4e\uff0c\u540c\u65f6\u4f18\u5148\u7ea7\u8d8a\u9ad8\u65f6\u95f4\u7247\u8d8a\u77ed\u3002</li> <li>\u300c\u53cd\u9988\u300d\u8868\u793a\u5982\u679c\u6709\u65b0\u7684\u8fdb\u7a0b\u52a0\u5165\u4f18\u5148\u7ea7\u9ad8\u7684\u961f\u5217\u65f6\uff0c\u7acb\u523b\u505c\u6b62\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u8f6c\u800c\u53bb\u8fd0\u884c\u4f18\u5148\u7ea7\u9ad8\u7684\u961f\u5217\uff1b</li> </ul> <p></p> <p>\u6765\u770b\u770b\uff0c\u5b83\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1a</p> <ul> <li>\u8bbe\u7f6e\u4e86\u591a\u4e2a\u961f\u5217\uff0c\u8d4b\u4e88\u6bcf\u4e2a\u961f\u5217\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\uff0c\u6bcf\u4e2a\u961f\u5217\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u4f4e\uff0c\u540c\u65f6\u4f18\u5148\u7ea7\u8d8a\u9ad8\u65f6\u95f4\u7247\u8d8a\u77ed\uff1b</li> <li>\u65b0\u7684\u8fdb\u7a0b\u4f1a\u88ab\u653e\u5165\u5230\u7b2c\u4e00\u7ea7\u961f\u5217\u7684\u672b\u5c3e\uff0c\u6309\u5148\u6765\u5148\u670d\u52a1\u7684\u539f\u5219\u6392\u961f\u7b49\u5f85\u88ab\u8c03\u5ea6\uff0c\u5982\u679c\u5728\u7b2c\u4e00\u7ea7\u961f\u5217\u89c4\u5b9a\u7684\u65f6\u95f4\u7247\u6ca1\u8fd0\u884c\u5b8c\u6210\uff0c\u5219\u5c06\u5176\u8f6c\u5165\u5230\u7b2c\u4e8c\u7ea7\u961f\u5217\u7684\u672b\u5c3e\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u76f4\u81f3\u5b8c\u6210\uff1b</li> <li>\u5f53\u8f83\u9ad8\u4f18\u5148\u7ea7\u7684\u961f\u5217\u4e3a\u7a7a\uff0c\u624d\u8c03\u5ea6\u8f83\u4f4e\u4f18\u5148\u7ea7\u7684\u961f\u5217\u4e2d\u7684\u8fdb\u7a0b\u8fd0\u884c\u3002\u5982\u679c\u8fdb\u7a0b\u8fd0\u884c\u65f6\uff0c\u6709\u65b0\u8fdb\u7a0b\u8fdb\u5165\u8f83\u9ad8\u4f18\u5148\u7ea7\u7684\u961f\u5217\uff0c\u5219\u505c\u6b62\u5f53\u524d\u8fd0\u884c\u7684\u8fdb\u7a0b\u5e76\u5c06\u5176\u79fb\u5165\u5230\u539f\u961f\u5217\u672b\u5c3e\uff0c\u63a5\u7740\u8ba9\u8f83\u9ad8\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u8fd0\u884c\uff1b</li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u77ed\u4f5c\u4e1a\u53ef\u80fd\u53ef\u4ee5\u5728\u7b2c\u4e00\u7ea7\u961f\u5217\u5f88\u5feb\u88ab\u5904\u7406\u5b8c\u3002\u5bf9\u4e8e\u957f\u4f5c\u4e1a\uff0c\u5982\u679c\u5728\u7b2c\u4e00\u7ea7\u961f\u5217\u5904\u7406\u4e0d\u5b8c\uff0c\u53ef\u4ee5\u79fb\u5165\u4e0b\u6b21\u961f\u5217\u7b49\u5f85\u88ab\u6267\u884c\uff0c\u867d\u7136\u7b49\u5f85\u7684\u65f6\u95f4\u53d8\u957f\u4e86\uff0c\u4f46\u662f\u8fd0\u884c\u65f6\u95f4\u4e5f\u53d8\u66f4\u957f\u4e86\uff0c\u6240\u4ee5\u8be5\u7b97\u6cd5\u5f88\u597d\u7684\u517c\u987e\u4e86\u957f\u77ed\u4f5c\u4e1a\uff0c\u540c\u65f6\u6709\u8f83\u597d\u7684\u54cd\u5e94\u65f6\u95f4\u3002</p> <p>\u770b\u7684\u8ff7\u8ff7\u7cca\u7cca\uff1f\u90a3\u6211\u62ff\u53bb\u94f6\u884c\u529e\u4e1a\u52a1\u7684\u4f8b\u5b50\uff0c\u628a\u4e0a\u9762\u7684\u8c03\u5ea6\u7b97\u6cd5\u4e32\u8d77\u6765\uff0c\u4f60\u8fd8\u4e0d\u61c2\uff0c\u4f60\u9524\u6211\uff01</p> <p>\u529e\u7406\u4e1a\u52a1\u7684\u5ba2\u6237\u76f8\u5f53\u4e8e\u8fdb\u7a0b\uff0c\u94f6\u884c\u7a97\u53e3\u5de5\u4f5c\u4eba\u5458\u76f8\u5f53\u4e8e CPU\u3002</p> <p>\u73b0\u5728\uff0c\u5047\u8bbe\u8fd9\u4e2a\u94f6\u884c\u53ea\u6709\u4e00\u4e2a\u7a97\u53e3\uff08\u5355\u6838 CPU\uff09\uff0c\u90a3\u4e48\u5de5\u4f5c\u4eba\u5458\u4e00\u6b21\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u4e1a\u52a1\u3002</p> <p></p> <p>\u90a3\u4e48\u6700\u7b80\u5355\u7684\u5904\u7406\u65b9\u5f0f\uff0c\u5c31\u662f\u5148\u6765\u7684\u5148\u5904\u7406\uff0c\u540e\u9762\u6765\u7684\u5c31\u4e56\u4e56\u6392\u961f\uff0c\u8fd9\u5c31\u662f\u5148\u6765\u5148\u670d\u52a1\uff08FCFS\uff09\u8c03\u5ea6\u7b97\u6cd5\u3002\u4f46\u662f\u4e07\u4e00\u5148\u6765\u7684\u8fd9\u4f4d\u8001\u54e5\u662f\u6765\u8d37\u6b3e\u7684\uff0c\u8fd9\u4e00\u8c08\u5c31\u597d\u51e0\u4e2a\u5c0f\u65f6\uff0c\u4e00\u76f4\u5360\u7528\u7740\u7a97\u53e3\uff0c\u8fd9\u6837\u540e\u9762\u7684\u4eba\u53ea\u80fd\u5e72\u7b49\uff0c\u6216\u8bb8\u540e\u9762\u7684\u4eba\u53ea\u662f\u60f3\u7b80\u5355\u7684\u53d6\u4e2a\u94b1\uff0c\u51e0\u5206\u949f\u5c31\u80fd\u641e\u5b9a\uff0c\u5374\u56e0\u4e3a\u524d\u9762\u8001\u54e5\u529e\u957f\u4e1a\u52a1\u800c\u8981\u7b49\u51e0\u4e2a\u5c0f\u65f6\uff0c\u4f60\u8bf4\u6c14\u4e0d\u6c14\u4eba\uff1f</p> <p></p> <p>\u6709\u5ba2\u6237\u62b1\u6028\u4e86\uff0c\u90a3\u6211\u4eec\u5c31\u8981\u6539\u8fdb\uff0c\u6211\u4eec\u5e72\u8106\u4f18\u5148\u7ed9\u90a3\u4e9b\u51e0\u5206\u949f\u5c31\u80fd\u641e\u5b9a\u7684\u4eba\u529e\u7406\u4e1a\u52a1\uff0c\u8fd9\u5c31\u662f\u77ed\u4f5c\u4e1a\u4f18\u5148\uff08SJF\uff09\u8c03\u5ea6\u7b97\u6cd5\u3002\u542c\u8d77\u6765\u4e0d\u9519\uff0c\u4f46\u662f\u4f9d\u7136\u8fd8\u662f\u6709\u4e2a\u6781\u7aef\u60c5\u51b5\uff0c\u4e07\u4e00\u529e\u7406\u77ed\u4e1a\u52a1\u7684\u4eba\u975e\u5e38\u7684\u591a\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u957f\u4e1a\u52a1\u7684\u4eba\u4e00\u76f4\u5f97\u4e0d\u5230\u670d\u52a1\uff0c\u4e07\u4e00\u8fd9\u4e2a\u957f\u4e1a\u52a1\u662f\u4e2a\u5927\u5ba2\u6237\uff0c\u90a3\u4e0d\u5c31\u6361\u4e86\u829d\u9ebb\u4e22\u4e86\u897f\u74dc</p> <p></p> <p>\u90a3\u5c31\u516c\u5e73\u8d77\u89c1\uff0c\u73b0\u5728\u7a97\u53e3\u5de5\u4f5c\u4eba\u5458\u89c4\u5b9a\uff0c\u6bcf\u4e2a\u4eba\u6211\u53ea\u5904\u7406 10 \u5206\u949f\u3002\u5982\u679c 10 \u5206\u949f\u4e4b\u5185\u5904\u7406\u5b8c\uff0c\u5c31\u9a6c\u4e0a\u6362\u4e0b\u4e00\u4e2a\u4eba\u3002\u5982\u679c\u6ca1\u5904\u7406\u5b8c\uff0c\u4f9d\u7136\u6362\u4e0b\u4e00\u4e2a\u4eba\uff0c\u4f46\u662f\u5ba2\u6237\u81ea\u5df1\u5f97\u8bb0\u4f4f\u529e\u7406\u5230\u54ea\u4e2a\u6b65\u9aa4\u4e86\u3002\u8fd9\u4e2a\u4e5f\u5c31\u662f\u65f6\u95f4\u7247\u8f6e\u8f6c\uff08RR\uff09\u8c03\u5ea6\u7b97\u6cd5\u3002\u4f46\u662f\u5982\u679c\u65f6\u95f4\u7247\u8bbe\u7f6e\u8fc7\u77ed\uff0c\u90a3\u4e48\u5c31\u4f1a\u9020\u6210\u5927\u91cf\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u589e\u5927\u4e86\u7cfb\u7edf\u5f00\u9500\u3002\u5982\u679c\u65f6\u95f4\u7247\u8fc7\u957f\uff0c\u76f8\u5f53\u4e8e\u9000\u5316\u6210 FCFS \u7b97\u6cd5\u4e86\u3002</p> <p></p> <p>\u65e2\u7136\u516c\u5e73\u4e5f\u53ef\u80fd\u5b58\u5728\u95ee\u9898\uff0c\u90a3\u94f6\u884c\u5c31\u5bf9\u5ba2\u6237\u5206\u7b49\u7ea7\uff0c\u5206\u4e3a\u666e\u901a\u5ba2\u6237\u3001VIP \u5ba2\u6237\u3001SVIP \u5ba2\u6237\u3002\u53ea\u8981\u9ad8\u4f18\u5148\u7ea7\u7684\u5ba2\u6237\u4e00\u6765\uff0c\u5c31\u7b2c\u4e00\u65f6\u95f4\u5904\u7406\u8fd9\u4e2a\u5ba2\u6237\uff0c\u8fd9\u5c31\u662f\u6700\u9ad8\u4f18\u5148\u7ea7\uff08HPF\uff09\u8c03\u5ea6\u7b97\u6cd5\u3002\u4f46\u4f9d\u7136\u4e5f\u4f1a\u6709\u6781\u7aef\u7684\u95ee\u9898\uff0c\u4e07\u4e00\u5f53\u5929\u6765\u7684\u5168\u662f\u9ad8\u7ea7\u5ba2\u6237\uff0c\u90a3\u666e\u901a\u5ba2\u6237\u4e0d\u662f\u6ca1\u6709\u88ab\u670d\u52a1\u7684\u673a\u4f1a\uff0c\u4e0d\u628a\u666e\u901a\u5ba2\u6237\u5f53\u4eba\u662f\u5417\uff1f\u90a3\u6211\u4eec\u628a\u4f18\u5148\u7ea7\u6539\u6210\u52a8\u6001\u7684\uff0c\u5982\u679c\u5ba2\u6237\u529e\u7406\u4e1a\u52a1\u65f6\u95f4\u589e\u52a0\uff0c\u5219\u964d\u4f4e\u5176\u4f18\u5148\u7ea7\uff0c\u5982\u679c\u5ba2\u6237\u7b49\u5f85\u65f6\u95f4\u589e\u52a0\uff0c\u5219\u5347\u9ad8\u5176\u4f18\u5148\u7ea7\u3002</p> <p></p> <p>\u90a3\u6709\u6ca1\u6709\u517c\u987e\u5230\u516c\u5e73\u548c\u6548\u7387\u7684\u65b9\u5f0f\u5462\uff1f\u8fd9\u91cc\u4ecb\u7ecd\u4e00\u79cd\u7b97\u6cd5\uff0c\u8003\u8651\u7684\u8fd8\u7b97\u5145\u5206\u7684\uff0c\u591a\u7ea7\u53cd\u9988\u961f\u5217\uff08MFQ\uff09\u8c03\u5ea6\u7b97\u6cd5\uff0c\u5b83\u662f\u65f6\u95f4\u7247\u8f6e\u8f6c\u7b97\u6cd5\u548c\u4f18\u5148\u7ea7\u7b97\u6cd5\u7684\u7efc\u5408\u548c\u53d1\u5c55\u3002\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\uff1a</p> <p></p> <ul> <li>\u94f6\u884c\u8bbe\u7f6e\u4e86\u591a\u4e2a\u6392\u961f\uff08\u5c31\u7eea\uff09\u961f\u5217\uff0c\u6bcf\u4e2a\u961f\u5217\u90fd\u6709\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\uff0c\u5404\u4e2a\u961f\u5217\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u4f4e\uff0c\u540c\u65f6\u6bcf\u4e2a\u961f\u5217\u6267\u884c\u65f6\u95f4\u7247\u7684\u957f\u5ea6\u4e5f\u4e0d\u540c\uff0c\u4f18\u5148\u7ea7\u8d8a\u9ad8\u7684\u65f6\u95f4\u7247\u8d8a\u77ed\u3002</li> <li>\u65b0\u5ba2\u6237\uff08\u8fdb\u7a0b\uff09\u6765\u4e86\uff0c\u5148\u8fdb\u5165\u7b2c\u4e00\u7ea7\u961f\u5217\u7684\u672b\u5c3e\uff0c\u6309\u5148\u6765\u5148\u670d\u52a1\u539f\u5219\u6392\u961f\u7b49\u5f85\u88ab\u53eb\u53f7\uff08\u8fd0\u884c\uff09\u3002\u5982\u679c\u65f6\u95f4\u7247\u7528\u5b8c\u5ba2\u6237\u7684\u4e1a\u52a1\u8fd8\u6ca1\u529e\u7406\u5b8c\u6210\uff0c\u5219\u8ba9\u5ba2\u6237\u8fdb\u5165\u5230\u4e0b\u4e00\u7ea7\u961f\u5217\u7684\u672b\u5c3e\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u76f4\u81f3\u5ba2\u6237\u4e1a\u52a1\u529e\u7406\u5b8c\u6210\u3002</li> <li>\u5f53\u7b2c\u4e00\u7ea7\u961f\u5217\u6ca1\u4eba\u6392\u961f\u65f6\uff0c\u5c31\u4f1a\u53eb\u53f7\u4e8c\u7ea7\u961f\u5217\u7684\u5ba2\u6237\u3002\u5982\u679c\u5ba2\u6237\u529e\u7406\u4e1a\u52a1\u8fc7\u7a0b\u4e2d\uff0c\u6709\u65b0\u7684\u5ba2\u6237\u52a0\u5165\u5230\u8f83\u9ad8\u4f18\u5148\u7ea7\u7684\u961f\u5217\uff0c\u90a3\u4e48\u6b64\u65f6\u529e\u7406\u4e2d\u7684\u5ba2\u6237\u9700\u8981\u505c\u6b62\u529e\u7406\uff0c\u56de\u5230\u539f\u961f\u5217\u7684\u672b\u5c3e\u7b49\u5f85\u518d\u6b21\u53eb\u53f7\uff0c\u56e0\u4e3a\u8981\u628a\u7a97\u53e3\u8ba9\u7ed9\u521a\u8fdb\u5165\u8f83\u9ad8\u4f18\u5148\u7ea7\u961f\u5217\u7684\u5ba2\u6237\u3002</li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u8981\u529e\u7406\u77ed\u4e1a\u52a1\u7684\u5ba2\u6237\u6765\u8bf4\uff0c\u53ef\u4ee5\u5f88\u5feb\u7684\u8f6e\u5230\u5e76\u89e3\u51b3\u3002\u5bf9\u4e8e\u8981\u529e\u7406\u957f\u4e1a\u52a1\u7684\u5ba2\u6237\uff0c\u4e00\u4e0b\u5b50\u89e3\u51b3\u4e0d\u4e86\uff0c\u5c31\u53ef\u4ee5\u653e\u5230\u4e0b\u4e00\u4e2a\u961f\u5217\uff0c\u867d\u7136\u7b49\u5f85\u7684\u65f6\u95f4\u7a0d\u5fae\u53d8\u957f\u4e86\uff0c\u4f46\u662f\u8f6e\u5230\u81ea\u5df1\u7684\u529e\u7406\u65f6\u95f4\u4e5f\u53d8\u957f\u4e86\uff0c\u4e5f\u53ef\u4ee5\u63a5\u53d7\uff0c\u4e0d\u4f1a\u9020\u6210\u6781\u7aef\u7684\u73b0\u8c61\uff0c\u53ef\u4ee5\u8bf4\u662f\u7efc\u5408\u4e0a\u9762\u51e0\u79cd\u7b97\u6cd5\u7684\u4f18\u70b9\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_base/#_16","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_commu/","title":"5.2 \u8fdb\u7a0b\u95f4\u6709\u54ea\u4e9b\u901a\u4fe1\u65b9\u5f0f\uff1f","text":"<p>\u76f4\u63a5\u5f00\u8bb2\uff01</p> <p></p> <p>\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u7528\u6237\u5730\u5740\u7a7a\u95f4\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u4e00\u822c\u800c\u8a00\u662f\u4e0d\u80fd\u4e92\u76f8\u8bbf\u95ee\u7684\uff0c\u4f46\u5185\u6838\u7a7a\u95f4\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u5171\u4eab\u7684\uff0c\u6240\u4ee5\u8fdb\u7a0b\u4e4b\u95f4\u8981\u901a\u4fe1\u5fc5\u987b\u901a\u8fc7\u5185\u6838\u3002</p> <p></p> <p>Linux \u5185\u6838\u63d0\u4f9b\u4e86\u4e0d\u5c11\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u673a\u5236\uff0c\u6211\u4eec\u6765\u4e00\u8d77\u77a7\u77a7\u6709\u54ea\u4e9b\uff1f</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_commu/#_1","title":"\u7ba1\u9053","text":"<p>\u5982\u679c\u4f60\u5b66\u8fc7 Linux \u547d\u4ee4\uff0c\u90a3\u4f60\u80af\u5b9a\u5f88\u719f\u6089\u300c<code>|</code>\u300d\u8fd9\u4e2a\u7ad6\u7ebf\u3002</p> Bash<pre><code>$ ps auxf | grep mysql\n</code></pre> <p>\u4e0a\u9762\u547d\u4ee4\u884c\u91cc\u7684\u300c<code>|</code>\u300d\u7ad6\u7ebf\u5c31\u662f\u4e00\u4e2a\u7ba1\u9053\uff0c\u5b83\u7684\u529f\u80fd\u662f\u5c06\u524d\u4e00\u4e2a\u547d\u4ee4\uff08<code>ps auxf</code>\uff09\u7684\u8f93\u51fa\uff0c\u4f5c\u4e3a\u540e\u4e00\u4e2a\u547d\u4ee4\uff08<code>grep mysql</code>\uff09\u7684\u8f93\u5165\uff0c\u4ece\u8fd9\u529f\u80fd\u63cf\u8ff0\uff0c\u53ef\u4ee5\u770b\u51fa\u7ba1\u9053\u4f20\u8f93\u6570\u636e\u662f\u5355\u5411\u7684\uff0c\u5982\u679c\u60f3\u76f8\u4e92\u901a\u4fe1\uff0c\u6211\u4eec\u9700\u8981\u521b\u5efa\u4e24\u4e2a\u7ba1\u9053\u624d\u884c\u3002</p> <p>\u540c\u65f6\uff0c\u6211\u4eec\u5f97\u77e5\u4e0a\u9762\u8fd9\u79cd\u7ba1\u9053\u662f\u6ca1\u6709\u540d\u5b57\uff0c\u6240\u4ee5\u300c<code>|</code>\u300d\u8868\u793a\u7684\u7ba1\u9053\u79f0\u4e3a\u533f\u540d\u7ba1\u9053\uff0c\u7528\u5b8c\u4e86\u5c31\u9500\u6bc1\u3002</p> <p>\u7ba1\u9053\u8fd8\u6709\u53e6\u5916\u4e00\u4e2a\u7c7b\u578b\u662f\u547d\u540d\u7ba1\u9053\uff0c\u4e5f\u88ab\u53eb\u505a <code>FIFO</code>\uff0c\u56e0\u4e3a\u6570\u636e\u662f\u5148\u8fdb\u5148\u51fa\u7684\u4f20\u8f93\u65b9\u5f0f\u3002</p> <p>\u5728\u4f7f\u7528\u547d\u540d\u7ba1\u9053\u524d\uff0c\u5148\u9700\u8981\u901a\u8fc7 <code>mkfifo</code> \u547d\u4ee4\u6765\u521b\u5efa\uff0c\u5e76\u4e14\u6307\u5b9a\u7ba1\u9053\u540d\u5b57\uff1a</p> Bash<pre><code>$ mkfifo myPipe\n</code></pre> <p>myPipe \u5c31\u662f\u8fd9\u4e2a\u7ba1\u9053\u7684\u540d\u79f0\uff0c\u57fa\u4e8e Linux \u4e00\u5207\u7686\u6587\u4ef6\u7684\u7406\u5ff5\uff0c\u6240\u4ee5\u7ba1\u9053\u4e5f\u662f\u4ee5\u6587\u4ef6\u7684\u65b9\u5f0f\u5b58\u5728\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 ls \u770b\u4e00\u4e0b\uff0c\u8fd9\u4e2a\u6587\u4ef6\u7684\u7c7b\u578b\u662f p\uff0c\u4e5f\u5c31\u662f pipe\uff08\u7ba1\u9053\uff09\u7684\u610f\u601d\uff1a</p> Bash<pre><code>$ ls -l\nprw-r--r--. 1 root    root         0 Jul 17 02:45 myPipe\n</code></pre> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5f80 myPipe \u8fd9\u4e2a\u7ba1\u9053\u5199\u5165\u6570\u636e\uff1a</p> Bash<pre><code>$ echo \"hello\" &gt; myPipe  // \u5c06\u6570\u636e\u5199\u8fdb\u7ba1\u9053\n                         // \u505c\u4f4f\u4e86 ...\n</code></pre> <p>\u4f60\u64cd\u4f5c\u4e86\u540e\uff0c\u4f60\u4f1a\u53d1\u73b0\u547d\u4ee4\u6267\u884c\u540e\u5c31\u505c\u5728\u8fd9\u4e86\uff0c\u8fd9\u662f\u56e0\u4e3a\u7ba1\u9053\u91cc\u7684\u5185\u5bb9\u6ca1\u6709\u88ab\u8bfb\u53d6\uff0c\u53ea\u6709\u5f53\u7ba1\u9053\u91cc\u7684\u6570\u636e\u88ab\u8bfb\u5b8c\u540e\uff0c\u547d\u4ee4\u624d\u53ef\u4ee5\u6b63\u5e38\u9000\u51fa\u3002</p> <p>\u4e8e\u662f\uff0c\u6211\u4eec\u6267\u884c\u53e6\u5916\u4e00\u4e2a\u547d\u4ee4\u6765\u8bfb\u53d6\u8fd9\u4e2a\u7ba1\u9053\u91cc\u7684\u6570\u636e\uff1a</p> Bash<pre><code>$ cat &lt; myPipe  // \u8bfb\u53d6\u7ba1\u9053\u91cc\u7684\u6570\u636e\nhello\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u7ba1\u9053\u91cc\u7684\u5185\u5bb9\u88ab\u8bfb\u53d6\u51fa\u6765\u4e86\uff0c\u5e76\u6253\u5370\u5728\u4e86\u7ec8\u7aef\u4e0a\uff0c\u53e6\u5916\u4e00\u65b9\u9762\uff0cecho \u90a3\u4e2a\u547d\u4ee4\u4e5f\u6b63\u5e38\u9000\u51fa\u4e86\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u770b\u51fa\uff0c\u7ba1\u9053\u8fd9\u79cd\u901a\u4fe1\u65b9\u5f0f\u6548\u7387\u4f4e\uff0c\u4e0d\u9002\u5408\u8fdb\u7a0b\u95f4\u9891\u7e41\u5730\u4ea4\u6362\u6570\u636e\u3002\u5f53\u7136\uff0c\u5b83\u7684\u597d\u5904\uff0c\u81ea\u7136\u5c31\u662f\u7b80\u5355\uff0c\u540c\u65f6\u4e5f\u6211\u4eec\u5f88\u5bb9\u6613\u5f97\u77e5\u7ba1\u9053\u91cc\u7684\u6570\u636e\u5df2\u7ecf\u88ab\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u8bfb\u53d6\u4e86\u3002</p> <p>\u90a3\u7ba1\u9053\u5982\u4f55\u521b\u5efa\u5462\uff0c\u80cc\u540e\u539f\u7406\u662f\u4ec0\u4e48\uff1f</p> <p>\u533f\u540d\u7ba1\u9053\u7684\u521b\u5efa\uff0c\u9700\u8981\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\uff1a</p> C<pre><code>int pipe(int fd[2])\n</code></pre> <p>\u8fd9\u91cc\u8868\u793a\u521b\u5efa\u4e00\u4e2a\u533f\u540d\u7ba1\u9053\uff0c\u5e76\u8fd4\u56de\u4e86\u4e24\u4e2a\u63cf\u8ff0\u7b26\uff0c\u4e00\u4e2a\u662f\u7ba1\u9053\u7684\u8bfb\u53d6\u7aef\u63cf\u8ff0\u7b26 <code>fd[0]</code>\uff0c\u53e6\u4e00\u4e2a\u662f\u7ba1\u9053\u7684\u5199\u5165\u7aef\u63cf\u8ff0\u7b26 <code>fd[1]</code>\u3002\u6ce8\u610f\uff0c\u8fd9\u4e2a\u533f\u540d\u7ba1\u9053\u662f\u7279\u6b8a\u7684\u6587\u4ef6\uff0c\u53ea\u5b58\u5728\u4e8e\u5185\u5b58\uff0c\u4e0d\u5b58\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d\u3002</p> <p></p> <p>\u5176\u5b9e\uff0c\u6240\u8c13\u7684\u7ba1\u9053\uff0c\u5c31\u662f\u5185\u6838\u91cc\u9762\u7684\u4e00\u4e32\u7f13\u5b58\u3002\u4ece\u7ba1\u9053\u7684\u4e00\u7aef\u5199\u5165\u7684\u6570\u636e\uff0c\u5b9e\u9645\u4e0a\u662f\u7f13\u5b58\u5728\u5185\u6838\u4e2d\u7684\uff0c\u53e6\u4e00\u7aef\u8bfb\u53d6\uff0c\u4e5f\u5c31\u662f\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u8fd9\u6bb5\u6570\u636e\u3002\u53e6\u5916\uff0c\u7ba1\u9053\u4f20\u8f93\u7684\u6570\u636e\u662f\u65e0\u683c\u5f0f\u7684\u6d41\u4e14\u5927\u5c0f\u53d7\u9650\u3002</p> <p>\u770b\u5230\u8fd9\uff0c\u4f60\u53ef\u80fd\u4f1a\u6709\u7591\u95ee\u4e86\uff0c\u8fd9\u4e24\u4e2a\u63cf\u8ff0\u7b26\u90fd\u662f\u5728\u4e00\u4e2a\u8fdb\u7a0b\u91cc\u9762\uff0c\u5e76\u6ca1\u6709\u8d77\u5230\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u4f5c\u7528\uff0c\u600e\u4e48\u6837\u624d\u80fd\u4f7f\u5f97\u7ba1\u9053\u662f\u8de8\u8fc7\u4e24\u4e2a\u8fdb\u7a0b\u7684\u5462\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>fork</code> \u521b\u5efa\u5b50\u8fdb\u7a0b\uff0c\u521b\u5efa\u7684\u5b50\u8fdb\u7a0b\u4f1a\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u8fd9\u6837\u5c31\u505a\u5230\u4e86\u4e24\u4e2a\u8fdb\u7a0b\u5404\u6709\u4e24\u4e2a\u300c <code>fd[0]</code> \u4e0e <code>fd[1]</code>\u300d\uff0c\u4e24\u4e2a\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u901a\u8fc7\u5404\u81ea\u7684 fd \u5199\u5165\u548c\u8bfb\u53d6\u540c\u4e00\u4e2a\u7ba1\u9053\u6587\u4ef6\u5b9e\u73b0\u8de8\u8fdb\u7a0b\u901a\u4fe1\u4e86\u3002</p> <p></p> <p>\u7ba1\u9053\u53ea\u80fd\u4e00\u7aef\u5199\u5165\uff0c\u53e6\u4e00\u7aef\u8bfb\u51fa\uff0c\u6240\u4ee5\u4e0a\u9762\u8fd9\u79cd\u6a21\u5f0f\u5bb9\u6613\u9020\u6210\u6df7\u4e71\uff0c\u56e0\u4e3a\u7236\u8fdb\u7a0b\u548c\u5b50\u8fdb\u7a0b\u90fd\u53ef\u4ee5\u540c\u65f6\u5199\u5165\uff0c\u4e5f\u90fd\u53ef\u4ee5\u8bfb\u51fa\u3002\u90a3\u4e48\uff0c\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u901a\u5e38\u7684\u505a\u6cd5\u662f\uff1a</p> <ul> <li>\u7236\u8fdb\u7a0b\u5173\u95ed\u8bfb\u53d6\u7684 fd[0]\uff0c\u53ea\u4fdd\u7559\u5199\u5165\u7684 fd[1]\uff1b</li> <li>\u5b50\u8fdb\u7a0b\u5173\u95ed\u5199\u5165\u7684 fd[1]\uff0c\u53ea\u4fdd\u7559\u8bfb\u53d6\u7684 fd[0]\uff1b</li> </ul> <p></p> <p>\u6240\u4ee5\u8bf4\u5982\u679c\u9700\u8981\u53cc\u5411\u901a\u4fe1\uff0c\u5219\u5e94\u8be5\u521b\u5efa\u4e24\u4e2a\u7ba1\u9053\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u4ec5\u4ec5\u89e3\u6790\u4e86\u4f7f\u7528\u7ba1\u9053\u8fdb\u884c\u7236\u8fdb\u7a0b\u4e0e\u5b50\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4f46\u662f\u5728\u6211\u4eec shell \u91cc\u9762\u5e76\u4e0d\u662f\u8fd9\u6837\u7684\u3002</p> <p>\u5728 shell \u91cc\u9762\u6267\u884c <code>A | B</code>\u547d\u4ee4\u7684\u65f6\u5019\uff0cA \u8fdb\u7a0b\u548c B \u8fdb\u7a0b\u90fd\u662f shell \u521b\u5efa\u51fa\u6765\u7684\u5b50\u8fdb\u7a0b\uff0cA \u548c B \u4e4b\u95f4\u4e0d\u5b58\u5728\u7236\u5b50\u5173\u7cfb\uff0c\u5b83\u4fe9\u7684\u7236\u8fdb\u7a0b\u90fd\u662f shell\u3002</p> <p></p> <p>\u6240\u4ee5\u8bf4\uff0c\u5728 shell \u91cc\u901a\u8fc7\u300c<code>|</code>\u300d\u533f\u540d\u7ba1\u9053\u5c06\u591a\u4e2a\u547d\u4ee4\u8fde\u63a5\u5728\u4e00\u8d77\uff0c\u5b9e\u9645\u4e0a\u4e5f\u5c31\u662f\u521b\u5efa\u4e86\u591a\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u90a3\u4e48\u5728\u6211\u4eec\u7f16\u5199 shell \u811a\u672c\u65f6\uff0c\u80fd\u4f7f\u7528\u4e00\u4e2a\u7ba1\u9053\u641e\u5b9a\u7684\u4e8b\u60c5\uff0c\u5c31\u4e0d\u8981\u591a\u7528\u4e00\u4e2a\u7ba1\u9053\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u521b\u5efa\u5b50\u8fdb\u7a0b\u7684\u7cfb\u7edf\u5f00\u9500\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\uff0c\u5bf9\u4e8e\u533f\u540d\u7ba1\u9053\uff0c\u5b83\u7684\u901a\u4fe1\u8303\u56f4\u662f\u5b58\u5728\u7236\u5b50\u5173\u7cfb\u7684\u8fdb\u7a0b\u3002\u56e0\u4e3a\u7ba1\u9053\u6ca1\u6709\u5b9e\u4f53\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709\u7ba1\u9053\u6587\u4ef6\uff0c\u53ea\u80fd\u901a\u8fc7 fork \u6765\u590d\u5236\u7236\u8fdb\u7a0b fd \u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u6765\u8fbe\u5230\u901a\u4fe1\u7684\u76ee\u7684\u3002</p> <p>\u53e6\u5916\uff0c\u5bf9\u4e8e\u547d\u540d\u7ba1\u9053\uff0c\u5b83\u53ef\u4ee5\u5728\u4e0d\u76f8\u5173\u7684\u8fdb\u7a0b\u95f4\u4e5f\u80fd\u76f8\u4e92\u901a\u4fe1\u3002\u56e0\u4e3a\u547d\u4ee4\u7ba1\u9053\uff0c\u63d0\u524d\u521b\u5efa\u4e86\u4e00\u4e2a\u7c7b\u578b\u4e3a\u7ba1\u9053\u7684\u8bbe\u5907\u6587\u4ef6\uff0c\u5728\u8fdb\u7a0b\u91cc\u53ea\u8981\u4f7f\u7528\u8fd9\u4e2a\u8bbe\u5907\u6587\u4ef6\uff0c\u5c31\u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\u3002</p> <p>\u4e0d\u7ba1\u662f\u533f\u540d\u7ba1\u9053\u8fd8\u662f\u547d\u540d\u7ba1\u9053\uff0c\u8fdb\u7a0b\u5199\u5165\u7684\u6570\u636e\u90fd\u662f\u7f13\u5b58\u5728\u5185\u6838\u4e2d\uff0c\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u8bfb\u53d6\u6570\u636e\u65f6\u5019\u81ea\u7136\u4e5f\u662f\u4ece\u5185\u6838\u4e2d\u83b7\u53d6\uff0c\u540c\u65f6\u901a\u4fe1\u6570\u636e\u90fd\u9075\u5faa\u5148\u8fdb\u5148\u51fa\u539f\u5219\uff0c\u4e0d\u652f\u6301 lseek \u4e4b\u7c7b\u7684\u6587\u4ef6\u5b9a\u4f4d\u64cd\u4f5c\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_commu/#_2","title":"\u6d88\u606f\u961f\u5217","text":"<p>\u524d\u9762\u8bf4\u5230\u7ba1\u9053\u7684\u901a\u4fe1\u65b9\u5f0f\u662f\u6548\u7387\u4f4e\u7684\uff0c\u56e0\u6b64\u7ba1\u9053\u4e0d\u9002\u5408\u8fdb\u7a0b\u95f4\u9891\u7e41\u5730\u4ea4\u6362\u6570\u636e\u3002</p> <p>\u5bf9\u4e8e\u8fd9\u4e2a\u95ee\u9898\uff0c\u6d88\u606f\u961f\u5217\u7684\u901a\u4fe1\u6a21\u5f0f\u5c31\u53ef\u4ee5\u89e3\u51b3\u3002\u6bd4\u5982\uff0cA \u8fdb\u7a0b\u8981\u7ed9 B \u8fdb\u7a0b\u53d1\u9001\u6d88\u606f\uff0cA \u8fdb\u7a0b\u628a\u6570\u636e\u653e\u5728\u5bf9\u5e94\u7684\u6d88\u606f\u961f\u5217\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u8fd4\u56de\u4e86\uff0cB \u8fdb\u7a0b\u9700\u8981\u7684\u65f6\u5019\u518d\u53bb\u8bfb\u53d6\u6570\u636e\u5c31\u53ef\u4ee5\u4e86\u3002\u540c\u7406\uff0cB \u8fdb\u7a0b\u8981\u7ed9 A \u8fdb\u7a0b\u53d1\u9001\u6d88\u606f\u4e5f\u662f\u5982\u6b64\u3002</p> <p>\u518d\u6765\uff0c\u6d88\u606f\u961f\u5217\u662f\u4fdd\u5b58\u5728\u5185\u6838\u4e2d\u7684\u6d88\u606f\u94fe\u8868\uff0c\u5728\u53d1\u9001\u6570\u636e\u65f6\uff0c\u4f1a\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u72ec\u7acb\u7684\u6570\u636e\u5355\u5143\uff0c\u4e5f\u5c31\u662f\u6d88\u606f\u4f53\uff08\u6570\u636e\u5757\uff09\uff0c\u6d88\u606f\u4f53\u662f\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6d88\u606f\u7684\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u8981\u7ea6\u5b9a\u597d\u6d88\u606f\u4f53\u7684\u6570\u636e\u7c7b\u578b\uff0c\u6240\u4ee5\u6bcf\u4e2a\u6d88\u606f\u4f53\u90fd\u662f\u56fa\u5b9a\u5927\u5c0f\u7684\u5b58\u50a8\u5757\uff0c\u4e0d\u50cf\u7ba1\u9053\u662f\u65e0\u683c\u5f0f\u7684\u5b57\u8282\u6d41\u6570\u636e\u3002\u5982\u679c\u8fdb\u7a0b\u4ece\u6d88\u606f\u961f\u5217\u4e2d\u8bfb\u53d6\u4e86\u6d88\u606f\u4f53\uff0c\u5185\u6838\u5c31\u4f1a\u628a\u8fd9\u4e2a\u6d88\u606f\u4f53\u5220\u9664\u3002</p> <p>\u6d88\u606f\u961f\u5217\u751f\u547d\u5468\u671f\u968f\u5185\u6838\uff0c\u5982\u679c\u6ca1\u6709\u91ca\u653e\u6d88\u606f\u961f\u5217\u6216\u8005\u6ca1\u6709\u5173\u95ed\u64cd\u4f5c\u7cfb\u7edf\uff0c\u6d88\u606f\u961f\u5217\u4f1a\u4e00\u76f4\u5b58\u5728\uff0c\u800c\u524d\u9762\u63d0\u5230\u7684\u533f\u540d\u7ba1\u9053\u7684\u751f\u547d\u5468\u671f\uff0c\u662f\u968f\u8fdb\u7a0b\u7684\u521b\u5efa\u800c\u5efa\u7acb\uff0c\u968f\u8fdb\u7a0b\u7684\u7ed3\u675f\u800c\u9500\u6bc1\u3002</p> <p>\u6d88\u606f\u8fd9\u79cd\u6a21\u578b\uff0c\u4e24\u4e2a\u8fdb\u7a0b\u4e4b\u95f4\u7684\u901a\u4fe1\u5c31\u50cf\u5e73\u65f6\u53d1\u90ae\u4ef6\u4e00\u6837\uff0c\u4f60\u6765\u4e00\u5c01\uff0c\u6211\u56de\u4e00\u5c01\uff0c\u53ef\u4ee5\u9891\u7e41\u6c9f\u901a\u4e86\u3002</p> <p>\u4f46\u90ae\u4ef6\u7684\u901a\u4fe1\u65b9\u5f0f\u5b58\u5728\u4e0d\u8db3\u7684\u5730\u65b9\u6709\u4e24\u70b9\uff0c\u4e00\u662f\u901a\u4fe1\u4e0d\u53ca\u65f6\uff0c\u4e8c\u662f\u9644\u4ef6\u4e5f\u6709\u5927\u5c0f\u9650\u5236\uff0c\u8fd9\u540c\u6837\u4e5f\u662f\u6d88\u606f\u961f\u5217\u901a\u4fe1\u4e0d\u8db3\u7684\u70b9\u3002</p> <p>\u6d88\u606f\u961f\u5217\u4e0d\u9002\u5408\u6bd4\u8f83\u5927\u6570\u636e\u7684\u4f20\u8f93\uff0c\u56e0\u4e3a\u5728\u5185\u6838\u4e2d\u6bcf\u4e2a\u6d88\u606f\u4f53\u90fd\u6709\u4e00\u4e2a\u6700\u5927\u957f\u5ea6\u7684\u9650\u5236\uff0c\u540c\u65f6\u6240\u6709\u961f\u5217\u6240\u5305\u542b\u7684\u5168\u90e8\u6d88\u606f\u4f53\u7684\u603b\u957f\u5ea6\u4e5f\u662f\u6709\u4e0a\u9650\u3002\u5728 Linux \u5185\u6838\u4e2d\uff0c\u4f1a\u6709\u4e24\u4e2a\u5b8f\u5b9a\u4e49 <code>MSGMAX</code> \u548c <code>MSGMNB</code>\uff0c\u5b83\u4eec\u4ee5\u5b57\u8282\u4e3a\u5355\u4f4d\uff0c\u5206\u522b\u5b9a\u4e49\u4e86\u4e00\u6761\u6d88\u606f\u7684\u6700\u5927\u957f\u5ea6\u548c\u4e00\u4e2a\u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\u3002</p> <p>\u6d88\u606f\u961f\u5217\u901a\u4fe1\u8fc7\u7a0b\u4e2d\uff0c\u5b58\u5728\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u4e4b\u95f4\u7684\u6570\u636e\u62f7\u8d1d\u5f00\u9500\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u5199\u5165\u6570\u636e\u5230\u5185\u6838\u4e2d\u7684\u6d88\u606f\u961f\u5217\u65f6\uff0c\u4f1a\u53d1\u751f\u4ece\u7528\u6237\u6001\u62f7\u8d1d\u6570\u636e\u5230\u5185\u6838\u6001\u7684\u8fc7\u7a0b\uff0c\u540c\u7406\u53e6\u4e00\u8fdb\u7a0b\u8bfb\u53d6\u5185\u6838\u4e2d\u7684\u6d88\u606f\u6570\u636e\u65f6\uff0c\u4f1a\u53d1\u751f\u4ece\u5185\u6838\u6001\u62f7\u8d1d\u6570\u636e\u5230\u7528\u6237\u6001\u7684\u8fc7\u7a0b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_commu/#_3","title":"\u5171\u4eab\u5185\u5b58","text":"<p>\u6d88\u606f\u961f\u5217\u7684\u8bfb\u53d6\u548c\u5199\u5165\u7684\u8fc7\u7a0b\uff0c\u90fd\u4f1a\u6709\u53d1\u751f\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u4e4b\u95f4\u7684\u6d88\u606f\u62f7\u8d1d\u8fc7\u7a0b\u3002\u90a3\u5171\u4eab\u5185\u5b58\u7684\u65b9\u5f0f\uff0c\u5c31\u5f88\u597d\u7684\u89e3\u51b3\u4e86\u8fd9\u4e00\u95ee\u9898\u3002</p> <p>\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\uff0c\u5bf9\u4e8e\u5185\u5b58\u7ba1\u7406\uff0c\u91c7\u7528\u7684\u662f\u865a\u62df\u5185\u5b58\u6280\u672f\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u6709\u81ea\u5df1\u72ec\u7acb\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\uff0c\u4e0d\u540c\u8fdb\u7a0b\u7684\u865a\u62df\u5185\u5b58\u6620\u5c04\u5230\u4e0d\u540c\u7684\u7269\u7406\u5185\u5b58\u4e2d\u3002\u6240\u4ee5\uff0c\u5373\u4f7f\u8fdb\u7a0b A \u548c \u8fdb\u7a0b B \u7684\u865a\u62df\u5730\u5740\u662f\u4e00\u6837\u7684\uff0c\u5176\u5b9e\u8bbf\u95ee\u7684\u662f\u4e0d\u540c\u7684\u7269\u7406\u5185\u5b58\u5730\u5740\uff0c\u5bf9\u4e8e\u6570\u636e\u7684\u589e\u5220\u67e5\u6539\u4e92\u4e0d\u5f71\u54cd\u3002</p> <p>\u5171\u4eab\u5185\u5b58\u7684\u673a\u5236\uff0c\u5c31\u662f\u62ff\u51fa\u4e00\u5757\u865a\u62df\u5730\u5740\u7a7a\u95f4\u6765\uff0c\u6620\u5c04\u5230\u76f8\u540c\u7684\u7269\u7406\u5185\u5b58\u4e2d\u3002\u8fd9\u6837\u8fd9\u4e2a\u8fdb\u7a0b\u5199\u5165\u7684\u4e1c\u897f\uff0c\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\u9a6c\u4e0a\u5c31\u80fd\u770b\u5230\u4e86\uff0c\u90fd\u4e0d\u9700\u8981\u62f7\u8d1d\u6765\u62f7\u8d1d\u53bb\uff0c\u4f20\u6765\u4f20\u53bb\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u901f\u5ea6\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_commu/#_4","title":"\u4fe1\u53f7\u91cf","text":"<p>\u7528\u4e86\u5171\u4eab\u5185\u5b58\u901a\u4fe1\u65b9\u5f0f\uff0c\u5e26\u6765\u65b0\u7684\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u5982\u679c\u591a\u4e2a\u8fdb\u7a0b\u540c\u65f6\u4fee\u6539\u540c\u4e00\u4e2a\u5171\u4eab\u5185\u5b58\uff0c\u5f88\u6709\u53ef\u80fd\u5c31\u51b2\u7a81\u4e86\u3002\u4f8b\u5982\u4e24\u4e2a\u8fdb\u7a0b\u90fd\u540c\u65f6\u5199\u4e00\u4e2a\u5730\u5740\uff0c\u90a3\u5148\u5199\u7684\u90a3\u4e2a\u8fdb\u7a0b\u4f1a\u53d1\u73b0\u5185\u5bb9\u88ab\u522b\u4eba\u8986\u76d6\u4e86\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u591a\u8fdb\u7a0b\u7ade\u4e89\u5171\u4eab\u8d44\u6e90\uff0c\u800c\u9020\u6210\u7684\u6570\u636e\u9519\u4e71\uff0c\u6240\u4ee5\u9700\u8981\u4fdd\u62a4\u673a\u5236\uff0c\u4f7f\u5f97\u5171\u4eab\u7684\u8d44\u6e90\uff0c\u5728\u4efb\u610f\u65f6\u523b\u53ea\u80fd\u88ab\u4e00\u4e2a\u8fdb\u7a0b\u8bbf\u95ee\u3002\u6b63\u597d\uff0c\u4fe1\u53f7\u91cf\u5c31\u5b9e\u73b0\u4e86\u8fd9\u4e00\u4fdd\u62a4\u673a\u5236\u3002</p> <p>\u4fe1\u53f7\u91cf\u5176\u5b9e\u662f\u4e00\u4e2a\u6574\u578b\u7684\u8ba1\u6570\u5668\uff0c\u4e3b\u8981\u7528\u4e8e\u5b9e\u73b0\u8fdb\u7a0b\u95f4\u7684\u4e92\u65a5\u4e0e\u540c\u6b65\uff0c\u800c\u4e0d\u662f\u7528\u4e8e\u7f13\u5b58\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u6570\u636e\u3002</p> <p>\u4fe1\u53f7\u91cf\u8868\u793a\u8d44\u6e90\u7684\u6570\u91cf\uff0c\u63a7\u5236\u4fe1\u53f7\u91cf\u7684\u65b9\u5f0f\u6709\u4e24\u79cd\u539f\u5b50\u64cd\u4f5c\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f P \u64cd\u4f5c\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u628a\u4fe1\u53f7\u91cf\u51cf\u53bb 1\uff0c\u76f8\u51cf\u540e\u5982\u679c\u4fe1\u53f7\u91cf &lt; 0\uff0c\u5219\u8868\u660e\u8d44\u6e90\u5df2\u88ab\u5360\u7528\uff0c\u8fdb\u7a0b\u9700\u963b\u585e\u7b49\u5f85\uff1b\u76f8\u51cf\u540e\u5982\u679c\u4fe1\u53f7\u91cf &gt;= 0\uff0c\u5219\u8868\u660e\u8fd8\u6709\u8d44\u6e90\u53ef\u4f7f\u7528\uff0c\u8fdb\u7a0b\u53ef\u6b63\u5e38\u7ee7\u7eed\u6267\u884c\u3002</li> <li>\u53e6\u4e00\u4e2a\u662f V \u64cd\u4f5c\uff0c\u8fd9\u4e2a\u64cd\u4f5c\u4f1a\u628a\u4fe1\u53f7\u91cf\u52a0\u4e0a 1\uff0c\u76f8\u52a0\u540e\u5982\u679c\u4fe1\u53f7\u91cf &lt;= 0\uff0c\u5219\u8868\u660e\u5f53\u524d\u6709\u963b\u585e\u4e2d\u7684\u8fdb\u7a0b\uff0c\u4e8e\u662f\u4f1a\u5c06\u8be5\u8fdb\u7a0b\u5524\u9192\u8fd0\u884c\uff1b\u76f8\u52a0\u540e\u5982\u679c\u4fe1\u53f7\u91cf &gt; 0\uff0c\u5219\u8868\u660e\u5f53\u524d\u6ca1\u6709\u963b\u585e\u4e2d\u7684\u8fdb\u7a0b\uff1b</li> </ul> <p>P \u64cd\u4f5c\u662f\u7528\u5728\u8fdb\u5165\u5171\u4eab\u8d44\u6e90\u4e4b\u524d\uff0cV \u64cd\u4f5c\u662f\u7528\u5728\u79bb\u5f00\u5171\u4eab\u8d44\u6e90\u4e4b\u540e\uff0c\u8fd9\u4e24\u4e2a\u64cd\u4f5c\u662f\u5fc5\u987b\u6210\u5bf9\u51fa\u73b0\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u8981\u4f7f\u5f97\u4e24\u4e2a\u8fdb\u7a0b\u4e92\u65a5\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\uff0c\u6211\u4eec\u53ef\u4ee5\u521d\u59cb\u5316\u4fe1\u53f7\u91cf\u4e3a <code>1</code>\u3002</p> <p></p> <p>\u5177\u4f53\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u8fdb\u7a0b A \u5728\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\u524d\uff0c\u5148\u6267\u884c\u4e86 P \u64cd\u4f5c\uff0c\u7531\u4e8e\u4fe1\u53f7\u91cf\u7684\u521d\u59cb\u503c\u4e3a 1\uff0c\u6545\u5728\u8fdb\u7a0b A \u6267\u884c P \u64cd\u4f5c\u540e\u4fe1\u53f7\u91cf\u53d8\u4e3a 0\uff0c\u8868\u793a\u5171\u4eab\u8d44\u6e90\u53ef\u7528\uff0c\u4e8e\u662f\u8fdb\u7a0b A \u5c31\u53ef\u4ee5\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\u3002</li> <li>\u82e5\u6b64\u65f6\uff0c\u8fdb\u7a0b B \u4e5f\u60f3\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\uff0c\u6267\u884c\u4e86 P \u64cd\u4f5c\uff0c\u7ed3\u679c\u4fe1\u53f7\u91cf\u53d8\u4e3a\u4e86 -1\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u4e34\u754c\u8d44\u6e90\u5df2\u88ab\u5360\u7528\uff0c\u56e0\u6b64\u8fdb\u7a0b B \u88ab\u963b\u585e\u3002</li> <li>\u76f4\u5230\u8fdb\u7a0b A \u8bbf\u95ee\u5b8c\u5171\u4eab\u5185\u5b58\uff0c\u624d\u4f1a\u6267\u884c V \u64cd\u4f5c\uff0c\u4f7f\u5f97\u4fe1\u53f7\u91cf\u6062\u590d\u4e3a 0\uff0c\u63a5\u7740\u5c31\u4f1a\u5524\u9192\u963b\u585e\u4e2d\u7684\u7ebf\u7a0b B\uff0c\u4f7f\u5f97\u8fdb\u7a0b B \u53ef\u4ee5\u8bbf\u95ee\u5171\u4eab\u5185\u5b58\uff0c\u6700\u540e\u5b8c\u6210\u5171\u4eab\u5185\u5b58\u7684\u8bbf\u95ee\u540e\uff0c\u6267\u884c V \u64cd\u4f5c\uff0c\u4f7f\u4fe1\u53f7\u91cf\u6062\u590d\u5230\u521d\u59cb\u503c 1\u3002</li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u4fe1\u53f7\u521d\u59cb\u5316\u4e3a <code>1</code>\uff0c\u5c31\u4ee3\u8868\u7740\u662f\u4e92\u65a5\u4fe1\u53f7\u91cf\uff0c\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u5171\u4eab\u5185\u5b58\u5728\u4efb\u4f55\u65f6\u523b\u53ea\u6709\u4e00\u4e2a\u8fdb\u7a0b\u5728\u8bbf\u95ee\uff0c\u8fd9\u5c31\u5f88\u597d\u7684\u4fdd\u62a4\u4e86\u5171\u4eab\u5185\u5b58\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u591a\u8fdb\u7a0b\u91cc\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u5e76\u4e0d\u4e00\u5b9a\u662f\u987a\u5e8f\u6267\u884c\u7684\uff0c\u5b83\u4eec\u57fa\u672c\u662f\u4ee5\u5404\u81ea\u72ec\u7acb\u7684\u3001\u4e0d\u53ef\u9884\u77e5\u7684\u901f\u5ea6\u5411\u524d\u63a8\u8fdb\uff0c\u4f46\u6709\u65f6\u5019\u6211\u4eec\u53c8\u5e0c\u671b\u591a\u4e2a\u8fdb\u7a0b\u80fd\u5bc6\u5207\u5408\u4f5c\uff0c\u4ee5\u5b9e\u73b0\u4e00\u4e2a\u5171\u540c\u7684\u4efb\u52a1\u3002</p> <p>\u4f8b\u5982\uff0c\u8fdb\u7a0b A \u662f\u8d1f\u8d23\u751f\u4ea7\u6570\u636e\uff0c\u800c\u8fdb\u7a0b B \u662f\u8d1f\u8d23\u8bfb\u53d6\u6570\u636e\uff0c\u8fd9\u4e24\u4e2a\u8fdb\u7a0b\u662f\u76f8\u4e92\u5408\u4f5c\u3001\u76f8\u4e92\u4f9d\u8d56\u7684\uff0c\u8fdb\u7a0b A \u5fc5\u987b\u5148\u751f\u4ea7\u4e86\u6570\u636e\uff0c\u8fdb\u7a0b B \u624d\u80fd\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u6240\u4ee5\u6267\u884c\u662f\u6709\u524d\u540e\u987a\u5e8f\u7684\u3002</p> <p>\u90a3\u4e48\u8fd9\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u7528\u4fe1\u53f7\u91cf\u6765\u5b9e\u73b0\u591a\u8fdb\u7a0b\u540c\u6b65\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u53ef\u4ee5\u521d\u59cb\u5316\u4fe1\u53f7\u91cf\u4e3a <code>0</code>\u3002</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5982\u679c\u8fdb\u7a0b B \u6bd4\u8fdb\u7a0b A \u5148\u6267\u884c\u4e86\uff0c\u90a3\u4e48\u6267\u884c\u5230 P \u64cd\u4f5c\u65f6\uff0c\u7531\u4e8e\u4fe1\u53f7\u91cf\u521d\u59cb\u503c\u4e3a 0\uff0c\u6545\u4fe1\u53f7\u91cf\u4f1a\u53d8\u4e3a -1\uff0c\u8868\u793a\u8fdb\u7a0b A \u8fd8\u6ca1\u751f\u4ea7\u6570\u636e\uff0c\u4e8e\u662f\u8fdb\u7a0b B \u5c31\u963b\u585e\u7b49\u5f85\uff1b</li> <li>\u63a5\u7740\uff0c\u5f53\u8fdb\u7a0b A \u751f\u4ea7\u5b8c\u6570\u636e\u540e\uff0c\u6267\u884c\u4e86 V \u64cd\u4f5c\uff0c\u5c31\u4f1a\u4f7f\u5f97\u4fe1\u53f7\u91cf\u53d8\u4e3a 0\uff0c\u4e8e\u662f\u5c31\u4f1a\u5524\u9192\u963b\u585e\u5728 P \u64cd\u4f5c\u7684\u8fdb\u7a0b B\uff1b</li> <li>\u6700\u540e\uff0c\u8fdb\u7a0b B \u88ab\u5524\u9192\u540e\uff0c\u610f\u5473\u7740\u8fdb\u7a0b A \u5df2\u7ecf\u751f\u4ea7\u4e86\u6570\u636e\uff0c\u4e8e\u662f\u8fdb\u7a0b B \u5c31\u53ef\u4ee5\u6b63\u5e38\u8bfb\u53d6\u6570\u636e\u4e86\u3002</li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u4fe1\u53f7\u521d\u59cb\u5316\u4e3a <code>0</code>\uff0c\u5c31\u4ee3\u8868\u7740\u662f\u540c\u6b65\u4fe1\u53f7\u91cf\uff0c\u5b83\u53ef\u4ee5\u4fdd\u8bc1\u8fdb\u7a0b A \u5e94\u5728\u8fdb\u7a0b B \u4e4b\u524d\u6267\u884c\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_commu/#_5","title":"\u4fe1\u53f7","text":"<p>\u4e0a\u9762\u8bf4\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u90fd\u662f\u5e38\u89c4\u72b6\u6001\u4e0b\u7684\u5de5\u4f5c\u6a21\u5f0f\u3002\u5bf9\u4e8e\u5f02\u5e38\u60c5\u51b5\u4e0b\u7684\u5de5\u4f5c\u6a21\u5f0f\uff0c\u5c31\u9700\u8981\u7528\u300c\u4fe1\u53f7\u300d\u7684\u65b9\u5f0f\u6765\u901a\u77e5\u8fdb\u7a0b\u3002</p> <p>\u4fe1\u53f7\u8ddf\u4fe1\u53f7\u91cf\u867d\u7136\u540d\u5b57\u76f8\u4f3c\u5ea6 66.66%\uff0c\u4f46\u4e24\u8005\u7528\u9014\u5b8c\u5168\u4e0d\u4e00\u6837\uff0c\u5c31\u597d\u50cf Java \u548c JavaScript \u7684\u533a\u522b\u3002</p> <p>\u5728 Linux \u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u4e3a\u4e86\u54cd\u5e94\u5404\u79cd\u5404\u6837\u7684\u4e8b\u4ef6\uff0c\u63d0\u4f9b\u4e86\u51e0\u5341\u79cd\u4fe1\u53f7\uff0c\u5206\u522b\u4ee3\u8868\u4e0d\u540c\u7684\u610f\u4e49\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 <code>kill -l</code> \u547d\u4ee4\uff0c\u67e5\u770b\u6240\u6709\u7684\u4fe1\u53f7\uff1a</p> Bash<pre><code>$ kill -l\n 1) SIGHUP       2) SIGINT       3) SIGQUIT      4) SIGILL       5) SIGTRAP\n 6) SIGABRT      7) SIGBUS       8) SIGFPE       9) SIGKILL     10) SIGUSR1\n11) SIGSEGV     12) SIGUSR2     13) SIGPIPE     14) SIGALRM     15) SIGTERM\n16) SIGSTKFLT   17) SIGCHLD     18) SIGCONT     19) SIGSTOP     20) SIGTSTP\n21) SIGTTIN     22) SIGTTOU     23) SIGURG      24) SIGXCPU     25) SIGXFSZ\n26) SIGVTALRM   27) SIGPROF     28) SIGWINCH    29) SIGIO       30) SIGPWR\n31) SIGSYS      34) SIGRTMIN    35) SIGRTMIN+1  36) SIGRTMIN+2  37) SIGRTMIN+3\n38) SIGRTMIN+4  39) SIGRTMIN+5  40) SIGRTMIN+6  41) SIGRTMIN+7  42) SIGRTMIN+8\n43) SIGRTMIN+9  44) SIGRTMIN+10 45) SIGRTMIN+11 46) SIGRTMIN+12 47) SIGRTMIN+13\n48) SIGRTMIN+14 49) SIGRTMIN+15 50) SIGRTMAX-14 51) SIGRTMAX-13 52) SIGRTMAX-12\n53) SIGRTMAX-11 54) SIGRTMAX-10 55) SIGRTMAX-9  56) SIGRTMAX-8  57) SIGRTMAX-7\n58) SIGRTMAX-6  59) SIGRTMAX-5  60) SIGRTMAX-4  61) SIGRTMAX-3  62) SIGRTMAX-2\n63) SIGRTMAX-1  64) SIGRTMAX\n</code></pre> <p>\u8fd0\u884c\u5728 shell \u7ec8\u7aef\u7684\u8fdb\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u952e\u76d8\u8f93\u5165\u67d0\u4e9b\u7ec4\u5408\u952e\u7684\u65f6\u5019\uff0c\u7ed9\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\u3002\u4f8b\u5982</p> <ul> <li>Ctrl+C \u4ea7\u751f <code>SIGINT</code> \u4fe1\u53f7\uff0c\u8868\u793a\u7ec8\u6b62\u8be5\u8fdb\u7a0b\uff1b</li> <li>Ctrl+Z \u4ea7\u751f <code>SIGTSTP</code> \u4fe1\u53f7\uff0c\u8868\u793a\u505c\u6b62\u8be5\u8fdb\u7a0b\uff0c\u4f46\u8fd8\u672a\u7ed3\u675f\uff1b</li> </ul> <p>\u5982\u679c\u8fdb\u7a0b\u5728\u540e\u53f0\u8fd0\u884c\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>kill</code> \u547d\u4ee4\u7684\u65b9\u5f0f\u7ed9\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\uff0c\u4f46\u524d\u63d0\u9700\u8981\u77e5\u9053\u8fd0\u884c\u4e2d\u7684\u8fdb\u7a0b PID \u53f7\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>kill -9 1050\uff0c\u8868\u793a\u7ed9 PID \u4e3a 1050 \u7684\u8fdb\u7a0b\u53d1\u9001 <code>SIGKILL</code> \u4fe1\u53f7\uff0c\u7528\u6765\u7acb\u5373\u7ed3\u675f\u8be5\u8fdb\u7a0b\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u4fe1\u53f7\u4e8b\u4ef6\u7684\u6765\u6e90\u4e3b\u8981\u6709\u786c\u4ef6\u6765\u6e90\uff08\u5982\u952e\u76d8 Cltr+C\uff09\u548c\u8f6f\u4ef6\u6765\u6e90\uff08\u5982 kill \u547d\u4ee4\uff09\u3002</p> <p>\u4fe1\u53f7\u662f\u8fdb\u7a0b\u95f4\u901a\u4fe1\u673a\u5236\u4e2d\u552f\u4e00\u7684\u5f02\u6b65\u901a\u4fe1\u673a\u5236\uff0c\u56e0\u4e3a\u53ef\u4ee5\u5728\u4efb\u4f55\u65f6\u5019\u53d1\u9001\u4fe1\u53f7\u7ed9\u67d0\u4e00\u8fdb\u7a0b\uff0c\u4e00\u65e6\u6709\u4fe1\u53f7\u4ea7\u751f\uff0c\u6211\u4eec\u5c31\u6709\u4e0b\u9762\u8fd9\u51e0\u79cd\uff0c\u7528\u6237\u8fdb\u7a0b\u5bf9\u4fe1\u53f7\u7684\u5904\u7406\u65b9\u5f0f\u3002</p> <p>1.\u6267\u884c\u9ed8\u8ba4\u64cd\u4f5c\u3002Linux \u5bf9\u6bcf\u79cd\u4fe1\u53f7\u90fd\u89c4\u5b9a\u4e86\u9ed8\u8ba4\u64cd\u4f5c\uff0c\u4f8b\u5982\uff0c\u4e0a\u9762\u5217\u8868\u4e2d\u7684 SIGTERM \u4fe1\u53f7\uff0c\u5c31\u662f\u7ec8\u6b62\u8fdb\u7a0b\u7684\u610f\u601d\u3002</p> <p>2.\u6355\u6349\u4fe1\u53f7\u3002\u6211\u4eec\u53ef\u4ee5\u4e3a\u4fe1\u53f7\u5b9a\u4e49\u4e00\u4e2a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002\u5f53\u4fe1\u53f7\u53d1\u751f\u65f6\uff0c\u6211\u4eec\u5c31\u6267\u884c\u76f8\u5e94\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u3002</p> <p>3.\u5ffd\u7565\u4fe1\u53f7\u3002\u5f53\u6211\u4eec\u4e0d\u5e0c\u671b\u5904\u7406\u67d0\u4e9b\u4fe1\u53f7\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u5ffd\u7565\u8be5\u4fe1\u53f7\uff0c\u4e0d\u505a\u4efb\u4f55\u5904\u7406\u3002\u6709\u4e24\u4e2a\u4fe1\u53f7\u662f\u5e94\u7528\u8fdb\u7a0b\u65e0\u6cd5\u6355\u6349\u548c\u5ffd\u7565\u7684\uff0c\u5373 <code>SIGKILL</code> \u548c <code>SIGSTOP</code>\uff0c\u5b83\u4eec\u7528\u4e8e\u5728\u4efb\u4f55\u65f6\u5019\u4e2d\u65ad\u6216\u7ed3\u675f\u67d0\u4e00\u8fdb\u7a0b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_commu/#socket","title":"Socket","text":"<p>\u524d\u9762\u63d0\u5230\u7684\u7ba1\u9053\u3001\u6d88\u606f\u961f\u5217\u3001\u5171\u4eab\u5185\u5b58\u3001\u4fe1\u53f7\u91cf\u548c\u4fe1\u53f7\u90fd\u662f\u5728\u540c\u4e00\u53f0\u4e3b\u673a\u4e0a\u8fdb\u884c\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u90a3\u8981\u60f3\u8de8\u7f51\u7edc\u4e0e\u4e0d\u540c\u4e3b\u673a\u4e0a\u7684\u8fdb\u7a0b\u4e4b\u95f4\u901a\u4fe1\uff0c\u5c31\u9700\u8981 Socket \u901a\u4fe1\u4e86\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cSocket \u901a\u4fe1\u4e0d\u4ec5\u53ef\u4ee5\u8de8\u7f51\u7edc\u4e0e\u4e0d\u540c\u4e3b\u673a\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u8fd8\u53ef\u4ee5\u5728\u540c\u4e3b\u673a\u4e0a\u8fdb\u7a0b\u95f4\u901a\u4fe1\u3002</p> <p>\u6211\u4eec\u6765\u770b\u770b\u521b\u5efa socket \u7684\u7cfb\u7edf\u8c03\u7528\uff1a</p> C<pre><code>int socket(int domain, int type, int protocol)\n</code></pre> <p>\u4e09\u4e2a\u53c2\u6570\u5206\u522b\u4ee3\u8868\uff1a</p> <ul> <li>domain \u53c2\u6570\u7528\u6765\u6307\u5b9a\u534f\u8bae\u65cf\uff0c\u6bd4\u5982 AF_INET \u7528\u4e8e IPV4\u3001AF_INET6 \u7528\u4e8e IPV6\u3001AF_LOCAL/AF_UNIX \u7528\u4e8e\u672c\u673a\uff1b</li> <li>type \u53c2\u6570\u7528\u6765\u6307\u5b9a\u901a\u4fe1\u7279\u6027\uff0c\u6bd4\u5982 SOCK_STREAM \u8868\u793a\u7684\u662f\u5b57\u8282\u6d41\uff0c\u5bf9\u5e94 TCP\u3001SOCK_DGRAM  \u8868\u793a\u7684\u662f\u6570\u636e\u62a5\uff0c\u5bf9\u5e94 UDP\u3001SOCK_RAW \u8868\u793a\u7684\u662f\u539f\u59cb\u5957\u63a5\u5b57\uff1b</li> <li>protocol \u53c2\u6570\u539f\u672c\u662f\u7528\u6765\u6307\u5b9a\u901a\u4fe1\u534f\u8bae\u7684\uff0c\u4f46\u73b0\u5728\u57fa\u672c\u5e9f\u5f03\u3002\u56e0\u4e3a\u534f\u8bae\u5df2\u7ecf\u901a\u8fc7\u524d\u9762\u4e24\u4e2a\u53c2\u6570\u6307\u5b9a\u5b8c\u6210\uff0cprotocol \u76ee\u524d\u4e00\u822c\u5199\u6210 0 \u5373\u53ef\uff1b</li> </ul> <p>\u6839\u636e\u521b\u5efa socket \u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u901a\u4fe1\u7684\u65b9\u5f0f\u4e5f\u5c31\u4e0d\u540c\uff1a</p> <ul> <li>\u5b9e\u73b0 TCP \u5b57\u8282\u6d41\u901a\u4fe1\uff1asocket \u7c7b\u578b\u662f AF_INET \u548c SOCK_STREAM\uff1b</li> <li>\u5b9e\u73b0 UDP \u6570\u636e\u62a5\u901a\u4fe1\uff1asocket \u7c7b\u578b\u662f AF_INET \u548c SOCK_DGRAM\uff1b</li> <li>\u5b9e\u73b0\u672c\u5730\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff1a \u300c\u672c\u5730\u5b57\u8282\u6d41 socket\u300d\u7c7b\u578b\u662f AF_LOCAL \u548c SOCK_STREAM\uff0c\u300c\u672c\u5730\u6570\u636e\u62a5 socket\u300d\u7c7b\u578b\u662f AF_LOCAL \u548c SOCK_DGRAM\u3002\u53e6\u5916\uff0cAF_UNIX \u548c AF_LOCAL \u662f\u7b49\u4ef7\u7684\uff0c\u6240\u4ee5 AF_UNIX \u4e5f\u5c5e\u4e8e\u672c\u5730 socket\uff1b</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u7b80\u5355\u8bf4\u4e00\u4e0b\u8fd9\u4e09\u79cd\u901a\u4fe1\u7684\u7f16\u7a0b\u6a21\u5f0f\u3002</p> <p>\u9488\u5bf9 TCP \u534f\u8bae\u901a\u4fe1\u7684 socket \u7f16\u7a0b\u6a21\u578b</p> <p></p> <ul> <li>\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u521d\u59cb\u5316 <code>socket</code>\uff0c\u5f97\u5230\u6587\u4ef6\u63cf\u8ff0\u7b26\uff1b</li> <li>\u670d\u52a1\u7aef\u8c03\u7528 <code>bind</code>\uff0c\u5c06\u7ed1\u5b9a\u5728 IP \u5730\u5740\u548c\u7aef\u53e3;</li> <li>\u670d\u52a1\u7aef\u8c03\u7528 <code>listen</code>\uff0c\u8fdb\u884c\u76d1\u542c\uff1b</li> <li>\u670d\u52a1\u7aef\u8c03\u7528 <code>accept</code>\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u8fde\u63a5\uff1b</li> <li>\u5ba2\u6237\u7aef\u8c03\u7528 <code>connect</code>\uff0c\u5411\u670d\u52a1\u5668\u7aef\u7684\u5730\u5740\u548c\u7aef\u53e3\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\uff1b</li> <li>\u670d\u52a1\u7aef <code>accept</code> \u8fd4\u56de\u7528\u4e8e\u4f20\u8f93\u7684 <code>socket</code> \u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff1b</li> <li>\u5ba2\u6237\u7aef\u8c03\u7528 <code>write</code> \u5199\u5165\u6570\u636e\uff1b\u670d\u52a1\u7aef\u8c03\u7528 <code>read</code> \u8bfb\u53d6\u6570\u636e\uff1b</li> <li>\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\u65f6\uff0c\u4f1a\u8c03\u7528 <code>close</code>\uff0c\u90a3\u4e48\u670d\u52a1\u7aef <code>read</code> \u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8bfb\u53d6\u5230\u4e86 <code>EOF</code>\uff0c\u5f85\u5904\u7406\u5b8c\u6570\u636e\u540e\uff0c\u670d\u52a1\u7aef\u8c03\u7528 <code>close</code>\uff0c\u8868\u793a\u8fde\u63a5\u5173\u95ed\u3002</li> </ul> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u670d\u52a1\u7aef\u8c03\u7528 <code>accept</code> \u65f6\uff0c\u8fde\u63a5\u6210\u529f\u4e86\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5df2\u5b8c\u6210\u8fde\u63a5\u7684 socket\uff0c\u540e\u7eed\u7528\u6765\u4f20\u8f93\u6570\u636e\u3002</p> <p>\u6240\u4ee5\uff0c\u76d1\u542c\u7684 socket \u548c\u771f\u6b63\u7528\u6765\u4f20\u9001\u6570\u636e\u7684 socket\uff0c\u662f\u300c\u4e24\u4e2a\u300dsocket\uff0c\u4e00\u4e2a\u53eb\u4f5c\u76d1\u542c socket\uff0c\u4e00\u4e2a\u53eb\u4f5c\u5df2\u5b8c\u6210\u8fde\u63a5 socket\u3002</p> <p>\u6210\u529f\u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0c\u53cc\u65b9\u5f00\u59cb\u901a\u8fc7 read \u548c write \u51fd\u6570\u6765\u8bfb\u5199\u6570\u636e\uff0c\u5c31\u50cf\u5f80\u4e00\u4e2a\u6587\u4ef6\u6d41\u91cc\u9762\u5199\u4e1c\u897f\u4e00\u6837\u3002</p> <p>\u9488\u5bf9 UDP \u534f\u8bae\u901a\u4fe1\u7684 socket \u7f16\u7a0b\u6a21\u578b</p> <p></p> <p>UDP \u662f\u6ca1\u6709\u8fde\u63a5\u7684\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u4e09\u6b21\u63e1\u624b\uff0c\u4e5f\u5c31\u4e0d\u9700\u8981\u50cf TCP \u8c03\u7528 listen \u548c connect\uff0c\u4f46\u662f UDP \u7684\u4ea4\u4e92\u4ecd\u7136\u9700\u8981 IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\uff0c\u56e0\u6b64\u4e5f\u9700\u8981 bind\u3002</p> <p>\u5bf9\u4e8e UDP \u6765\u8bf4\uff0c\u4e0d\u9700\u8981\u8981\u7ef4\u62a4\u8fde\u63a5\uff0c\u90a3\u4e48\u4e5f\u5c31\u6ca1\u6709\u6240\u8c13\u7684\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\uff0c\u751a\u81f3\u90fd\u4e0d\u5b58\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u6982\u5ff5\uff0c\u53ea\u8981\u6709\u4e00\u4e2a socket \u591a\u53f0\u673a\u5668\u5c31\u53ef\u4ee5\u4efb\u610f\u901a\u4fe1\uff0c\u56e0\u6b64\u6bcf\u4e00\u4e2a UDP \u7684 socket \u90fd\u9700\u8981 bind\u3002</p> <p>\u53e6\u5916\uff0c\u6bcf\u6b21\u901a\u4fe1\u65f6\uff0c\u8c03\u7528 sendto \u548c recvfrom\uff0c\u90fd\u8981\u4f20\u5165\u76ee\u6807\u4e3b\u673a\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u3002</p> <p>\u9488\u5bf9\u672c\u5730\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684 socket \u7f16\u7a0b\u6a21\u578b</p> <p>\u672c\u5730 socket  \u88ab\u7528\u4e8e\u5728\u540c\u4e00\u53f0\u4e3b\u673a\u4e0a\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u573a\u666f\uff1a</p> <ul> <li>\u672c\u5730 socket \u7684\u7f16\u7a0b\u63a5\u53e3\u548c IPv4\u3001IPv6 \u5957\u63a5\u5b57\u7f16\u7a0b\u63a5\u53e3\u662f\u4e00\u81f4\u7684\uff0c\u53ef\u4ee5\u652f\u6301\u300c\u5b57\u8282\u6d41\u300d\u548c\u300c\u6570\u636e\u62a5\u300d\u4e24\u79cd\u534f\u8bae\uff1b</li> <li>\u672c\u5730 socket \u7684\u5b9e\u73b0\u6548\u7387\u5927\u5927\u9ad8\u4e8e IPv4 \u548c IPv6 \u7684\u5b57\u8282\u6d41\u3001\u6570\u636e\u62a5 socket \u5b9e\u73b0\uff1b</li> </ul> <p>\u5bf9\u4e8e\u672c\u5730\u5b57\u8282\u6d41 socket\uff0c\u5176 socket \u7c7b\u578b\u662f AF_LOCAL \u548c SOCK_STREAM\u3002</p> <p>\u5bf9\u4e8e\u672c\u5730\u6570\u636e\u62a5 socket\uff0c\u5176 socket \u7c7b\u578b\u662f AF_LOCAL \u548c SOCK_DGRAM\u3002</p> <p>\u672c\u5730\u5b57\u8282\u6d41 socket \u548c \u672c\u5730\u6570\u636e\u62a5 socket \u5728 bind \u7684\u65f6\u5019\uff0c\u4e0d\u50cf TCP \u548c UDP \u8981\u7ed1\u5b9a IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u800c\u662f\u7ed1\u5b9a\u4e00\u4e2a\u672c\u5730\u6587\u4ef6\uff0c\u8fd9\u4e5f\u5c31\u662f\u5b83\u4eec\u4e4b\u95f4\u7684\u6700\u5927\u533a\u522b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_commu/#_6","title":"\u603b\u7ed3","text":"<p>\u7531\u4e8e\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u7528\u6237\u7a7a\u95f4\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u4e0d\u80fd\u76f8\u4e92\u8bbf\u95ee\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u501f\u52a9\u5185\u6838\u7a7a\u95f4\u6765\u5b9e\u73b0\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u539f\u56e0\u5f88\u7b80\u5355\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u662f\u5171\u4eab\u4e00\u4e2a\u5185\u6838\u7a7a\u95f4\u3002</p> <p>Linux \u5185\u6838\u63d0\u4f9b\u4e86\u4e0d\u5c11\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u65b9\u5f0f\uff0c\u5176\u4e2d\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u5c31\u662f\u7ba1\u9053\uff0c\u7ba1\u9053\u5206\u4e3a\u300c\u533f\u540d\u7ba1\u9053\u300d\u548c\u300c\u547d\u540d\u7ba1\u9053\u300d\u3002</p> <p>\u533f\u540d\u7ba1\u9053\u987e\u540d\u601d\u4e49\uff0c\u5b83\u6ca1\u6709\u540d\u5b57\u6807\u8bc6\uff0c\u533f\u540d\u7ba1\u9053\u662f\u7279\u6b8a\u6587\u4ef6\u53ea\u5b58\u5728\u4e8e\u5185\u5b58\uff0c\u6ca1\u6709\u5b58\u5728\u4e8e\u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0cshell \u547d\u4ee4\u4e2d\u7684\u300c<code>|</code>\u300d\u7ad6\u7ebf\u5c31\u662f\u533f\u540d\u7ba1\u9053\uff0c\u901a\u4fe1\u7684\u6570\u636e\u662f\u65e0\u683c\u5f0f\u7684\u6d41\u5e76\u4e14\u5927\u5c0f\u53d7\u9650\uff0c\u901a\u4fe1\u7684\u65b9\u5f0f\u662f\u5355\u5411\u7684\uff0c\u6570\u636e\u53ea\u80fd\u5728\u4e00\u4e2a\u65b9\u5411\u4e0a\u6d41\u52a8\uff0c\u5982\u679c\u8981\u53cc\u5411\u901a\u4fe1\uff0c\u9700\u8981\u521b\u5efa\u4e24\u4e2a\u7ba1\u9053\uff0c\u518d\u6765\u533f\u540d\u7ba1\u9053\u662f\u53ea\u80fd\u7528\u4e8e\u5b58\u5728\u7236\u5b50\u5173\u7cfb\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u533f\u540d\u7ba1\u9053\u7684\u751f\u547d\u5468\u671f\u968f\u7740\u8fdb\u7a0b\u521b\u5efa\u800c\u5efa\u7acb\uff0c\u968f\u7740\u8fdb\u7a0b\u7ec8\u6b62\u800c\u6d88\u5931\u3002</p> <p>\u547d\u540d\u7ba1\u9053\u7a81\u7834\u4e86\u533f\u540d\u7ba1\u9053\u53ea\u80fd\u5728\u4eb2\u7f18\u5173\u7cfb\u8fdb\u7a0b\u95f4\u7684\u901a\u4fe1\u9650\u5236\uff0c\u56e0\u4e3a\u4f7f\u7528\u547d\u540d\u7ba1\u9053\u7684\u524d\u63d0\uff0c\u9700\u8981\u5728\u6587\u4ef6\u7cfb\u7edf\u521b\u5efa\u4e00\u4e2a\u7c7b\u578b\u4e3a p \u7684\u8bbe\u5907\u6587\u4ef6\uff0c\u90a3\u4e48\u6beb\u65e0\u5173\u7cfb\u7684\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u8bbe\u5907\u6587\u4ef6\u8fdb\u884c\u901a\u4fe1\u3002\u53e6\u5916\uff0c\u4e0d\u7ba1\u662f\u533f\u540d\u7ba1\u9053\u8fd8\u662f\u547d\u540d\u7ba1\u9053\uff0c\u8fdb\u7a0b\u5199\u5165\u7684\u6570\u636e\u90fd\u662f\u7f13\u5b58\u5728\u5185\u6838\u4e2d\uff0c\u53e6\u4e00\u4e2a\u8fdb\u7a0b\u8bfb\u53d6\u6570\u636e\u65f6\u5019\u81ea\u7136\u4e5f\u662f\u4ece\u5185\u6838\u4e2d\u83b7\u53d6\uff0c\u540c\u65f6\u901a\u4fe1\u6570\u636e\u90fd\u9075\u5faa\u5148\u8fdb\u5148\u51fa\u539f\u5219\uff0c\u4e0d\u652f\u6301 lseek \u4e4b\u7c7b\u7684\u6587\u4ef6\u5b9a\u4f4d\u64cd\u4f5c\u3002</p> <p>\u6d88\u606f\u961f\u5217\u514b\u670d\u4e86\u7ba1\u9053\u901a\u4fe1\u7684\u6570\u636e\u662f\u65e0\u683c\u5f0f\u7684\u5b57\u8282\u6d41\u7684\u95ee\u9898\uff0c\u6d88\u606f\u961f\u5217\u5b9e\u9645\u4e0a\u662f\u4fdd\u5b58\u5728\u5185\u6838\u7684\u300c\u6d88\u606f\u94fe\u8868\u300d\uff0c\u6d88\u606f\u961f\u5217\u7684\u6d88\u606f\u4f53\u662f\u53ef\u4ee5\u7528\u6237\u81ea\u5b9a\u4e49\u7684\u6570\u636e\u7c7b\u578b\uff0c\u53d1\u9001\u6570\u636e\u65f6\uff0c\u4f1a\u88ab\u5206\u6210\u4e00\u4e2a\u4e00\u4e2a\u72ec\u7acb\u7684\u6d88\u606f\u4f53\uff0c\u5f53\u7136\u63a5\u6536\u6570\u636e\u65f6\uff0c\u4e5f\u8981\u4e0e\u53d1\u9001\u65b9\u53d1\u9001\u7684\u6d88\u606f\u4f53\u7684\u6570\u636e\u7c7b\u578b\u4fdd\u6301\u4e00\u81f4\uff0c\u8fd9\u6837\u624d\u80fd\u4fdd\u8bc1\u8bfb\u53d6\u7684\u6570\u636e\u662f\u6b63\u786e\u7684\u3002\u6d88\u606f\u961f\u5217\u901a\u4fe1\u7684\u901f\u5ea6\u4e0d\u662f\u6700\u53ca\u65f6\u7684\uff0c\u6bd5\u7adf\u6bcf\u6b21\u6570\u636e\u7684\u5199\u5165\u548c\u8bfb\u53d6\u90fd\u9700\u8981\u7ecf\u8fc7\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u4e4b\u95f4\u7684\u62f7\u8d1d\u8fc7\u7a0b\u3002</p> <p>\u5171\u4eab\u5185\u5b58\u53ef\u4ee5\u89e3\u51b3\u6d88\u606f\u961f\u5217\u901a\u4fe1\u4e2d\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u4e4b\u95f4\u6570\u636e\u62f7\u8d1d\u8fc7\u7a0b\u5e26\u6765\u7684\u5f00\u9500\uff0c\u5b83\u76f4\u63a5\u5206\u914d\u4e00\u4e2a\u5171\u4eab\u7a7a\u95f4\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\uff0c\u5c31\u50cf\u8bbf\u95ee\u8fdb\u7a0b\u81ea\u5df1\u7684\u7a7a\u95f4\u4e00\u6837\u5feb\u6377\u65b9\u4fbf\uff0c\u4e0d\u9700\u8981\u9677\u5165\u5185\u6838\u6001\u6216\u8005\u7cfb\u7edf\u8c03\u7528\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u901a\u4fe1\u7684\u901f\u5ea6\uff0c\u4eab\u6709\u6700\u5feb\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f\u4e4b\u540d\u3002\u4f46\u662f\u4fbf\u6377\u9ad8\u6548\u7684\u5171\u4eab\u5185\u5b58\u901a\u4fe1\uff0c\u5e26\u6765\u65b0\u7684\u95ee\u9898\uff0c\u591a\u8fdb\u7a0b\u7ade\u4e89\u540c\u4e2a\u5171\u4eab\u8d44\u6e90\u4f1a\u9020\u6210\u6570\u636e\u7684\u9519\u4e71\u3002</p> <p>\u90a3\u4e48\uff0c\u5c31\u9700\u8981\u4fe1\u53f7\u91cf\u6765\u4fdd\u62a4\u5171\u4eab\u8d44\u6e90\uff0c\u4ee5\u786e\u4fdd\u4efb\u4f55\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u8fdb\u7a0b\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5c31\u662f\u4e92\u65a5\u8bbf\u95ee\u3002\u4fe1\u53f7\u91cf\u4e0d\u4ec5\u53ef\u4ee5\u5b9e\u73b0\u8bbf\u95ee\u7684\u4e92\u65a5\u6027\uff0c\u8fd8\u53ef\u4ee5\u5b9e\u73b0\u8fdb\u7a0b\u95f4\u7684\u540c\u6b65\uff0c\u4fe1\u53f7\u91cf\u5176\u5b9e\u662f\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u8868\u793a\u7684\u662f\u8d44\u6e90\u4e2a\u6570\uff0c\u5176\u503c\u53ef\u4ee5\u901a\u8fc7\u4e24\u4e2a\u539f\u5b50\u64cd\u4f5c\u6765\u63a7\u5236\uff0c\u5206\u522b\u662f P \u64cd\u4f5c\u548c V \u64cd\u4f5c\u3002</p> <p>\u4e0e\u4fe1\u53f7\u91cf\u540d\u5b57\u5f88\u76f8\u4f3c\u7684\u53eb\u4fe1\u53f7\uff0c\u5b83\u4fe9\u540d\u5b57\u867d\u7136\u76f8\u4f3c\uff0c\u4f46\u529f\u80fd\u4e00\u70b9\u513f\u90fd\u4e0d\u4e00\u6837\u3002\u4fe1\u53f7\u662f\u5f02\u6b65\u901a\u4fe1\u673a\u5236\uff0c\u4fe1\u53f7\u53ef\u4ee5\u5728\u5e94\u7528\u8fdb\u7a0b\u548c\u5185\u6838\u4e4b\u95f4\u76f4\u63a5\u4ea4\u4e92\uff0c\u5185\u6838\u4e5f\u53ef\u4ee5\u5229\u7528\u4fe1\u53f7\u6765\u901a\u77e5\u7528\u6237\u7a7a\u95f4\u7684\u8fdb\u7a0b\u53d1\u751f\u4e86\u54ea\u4e9b\u7cfb\u7edf\u4e8b\u4ef6\uff0c\u4fe1\u53f7\u4e8b\u4ef6\u7684\u6765\u6e90\u4e3b\u8981\u6709\u786c\u4ef6\u6765\u6e90\uff08\u5982\u952e\u76d8 Cltr+C\uff09\u548c\u8f6f\u4ef6\u6765\u6e90\uff08\u5982 kill \u547d\u4ee4\uff09\uff0c\u4e00\u65e6\u6709\u4fe1\u53f7\u53d1\u751f\uff0c\u8fdb\u7a0b\u6709\u4e09\u79cd\u65b9\u5f0f\u54cd\u5e94\u4fe1\u53f7 1. \u6267\u884c\u9ed8\u8ba4\u64cd\u4f5c\u30012. \u6355\u6349\u4fe1\u53f7\u30013. \u5ffd\u7565\u4fe1\u53f7\u3002\u6709\u4e24\u4e2a\u4fe1\u53f7\u662f\u5e94\u7528\u8fdb\u7a0b\u65e0\u6cd5\u6355\u6349\u548c\u5ffd\u7565\u7684\uff0c\u5373 <code>SIGKILL</code> \u548c <code>SIGSTOP</code>\uff0c\u8fd9\u662f\u4e3a\u4e86\u65b9\u4fbf\u6211\u4eec\u80fd\u5728\u4efb\u4f55\u65f6\u5019\u7ed3\u675f\u6216\u505c\u6b62\u67d0\u4e2a\u8fdb\u7a0b\u3002</p> <p>\u524d\u9762\u8bf4\u5230\u7684\u901a\u4fe1\u673a\u5236\uff0c\u90fd\u662f\u5de5\u4f5c\u4e8e\u540c\u4e00\u53f0\u4e3b\u673a\uff0c\u5982\u679c\u8981\u4e0e\u4e0d\u540c\u4e3b\u673a\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u90a3\u4e48\u5c31\u9700\u8981 Socket \u901a\u4fe1\u4e86\u3002Socket \u5b9e\u9645\u4e0a\u4e0d\u4ec5\u7528\u4e8e\u4e0d\u540c\u7684\u4e3b\u673a\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u8fd8\u53ef\u4ee5\u7528\u4e8e\u672c\u5730\u4e3b\u673a\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u53ef\u6839\u636e\u521b\u5efa Socket \u7684\u7c7b\u578b\u4e0d\u540c\uff0c\u5206\u4e3a\u4e09\u79cd\u5e38\u89c1\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u4e00\u4e2a\u662f\u57fa\u4e8e TCP \u534f\u8bae\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u4e00\u4e2a\u662f\u57fa\u4e8e UDP \u534f\u8bae\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u4e00\u4e2a\u662f\u672c\u5730\u8fdb\u7a0b\u95f4\u901a\u4fe1\u65b9\u5f0f\u3002</p> <p>\u4ee5\u4e0a\uff0c\u5c31\u662f\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u4e3b\u8981\u673a\u5236\u4e86\u3002\u4f60\u53ef\u80fd\u4f1a\u95ee\u4e86\uff0c\u90a3\u7ebf\u7a0b\u901a\u4fe1\u95f4\u7684\u65b9\u5f0f\u5462\uff1f</p> <p>\u540c\u4e2a\u8fdb\u7a0b\u4e0b\u7684\u7ebf\u7a0b\u4e4b\u95f4\u90fd\u662f\u5171\u4eab\u8fdb\u7a0b\u7684\u8d44\u6e90\uff0c\u53ea\u8981\u662f\u5171\u4eab\u53d8\u91cf\u90fd\u53ef\u4ee5\u505a\u5230\u7ebf\u7a0b\u95f4\u901a\u4fe1\uff0c\u6bd4\u5982\u5168\u5c40\u53d8\u91cf\uff0c\u6240\u4ee5\u5bf9\u4e8e\u7ebf\u7a0b\u95f4\u5173\u6ce8\u7684\u4e0d\u662f\u901a\u4fe1\u65b9\u5f0f\uff0c\u800c\u662f\u5173\u6ce8\u591a\u7ebf\u7a0b\u7ade\u4e89\u5171\u4eab\u8d44\u6e90\u7684\u95ee\u9898\uff0c\u4fe1\u53f7\u91cf\u4e5f\u540c\u6837\u53ef\u4ee5\u5728\u7ebf\u7a0b\u95f4\u5b9e\u73b0\u4e92\u65a5\u4e0e\u540c\u6b65\uff1a</p> <ul> <li>\u4e92\u65a5\u7684\u65b9\u5f0f\uff0c\u53ef\u4fdd\u8bc1\u4efb\u610f\u65f6\u523b\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u8bbf\u95ee\u5171\u4eab\u8d44\u6e90\uff1b</li> <li>\u540c\u6b65\u7684\u65b9\u5f0f\uff0c\u53ef\u4fdd\u8bc1\u7ebf\u7a0b A \u5e94\u5728\u7ebf\u7a0b B \u4e4b\u524d\u6267\u884c\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/process_commu/#_7","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/thread_crash/","title":"5.7 \u7ebf\u7a0b\u5d29\u6e83\u4e86\uff0c\u8fdb\u7a0b\u4e5f\u4f1a\u5d29\u6e83\u5417\uff1f","text":"<p>\u6765\u6e90\uff1a\u516c\u4f17\u53f7@\u7801\u6d77</p> <p>\u539f\u6587\u5730\u5740\uff1a\u7f8e\u56e2\u4e00\u9762\uff1a\u7ebf\u7a0b\u5d29\u6e83\u4e86\uff0c\u8fdb\u7a0b\u4e5f\u4f1a\u5d29\u6e83\u5417\uff1f</p> <p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e4b\u524d\u5206\u4eab\u8fd9\u7bc7\u6587\u7ae0\u7684\u65f6\u5019\uff1a\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u57fa\u7840\u77e5\u8bc6\u5168\u5bb6\u6876\uff0c30 \u5f20\u56fe\u4e00\u5957\u5e26\u8d70\uff0c\u63d0\u5230\u8bf4\u7ebf\u7a0b\u7684\u4e00\u4e2a\u7f3a\u70b9\uff1a</p> <p></p> <p>\u5f88\u591a\u540c\u5b66\u5c31\u597d\u5947\uff0c\u4e3a\u4ec0\u4e48 C/C++ \u8bed\u8a00\u91cc\uff0c\u7ebf\u7a0b\u5d29\u6e83\u540e\uff0c\u8fdb\u7a0b\u4e5f\u4f1a\u5d29\u6e83\uff0c\u800c Java \u8bed\u8a00\u91cc\u5374\u4e0d\u4f1a\u5462\uff1f</p> <p>\u521a\u597d\u770b\u5230\u670b\u53cb\uff08\u516c\u4f17\u53f7\uff1a\u7801\u6d77\uff09\u5199\u4e86\u4e00\u7bc7\uff1a\u300c\u7f8e\u56e2\u9762\u8bd5\u9898\uff1a\u4e3a\u4ec0\u4e48\u7ebf\u7a0b\u5d29\u6e83\u5d29\u6e83\u4e0d\u4f1a\u5bfc\u81f4 JVM \u5d29\u6e83\uff1f\u300d</p> <p>\u6211\u89c9\u5f97\u5199\u7684\u5f88\u597d\uff0c\u6240\u4ee5\u5206\u4eab\u7ed9\u5927\u5bb6\u4e00\u8d77\u62dc\u8bfb\u62dc\u8bfb\uff0c\u672c\u6587\u5206\u4ee5\u4e0b\u51e0\u8282\u6765\u63a2\u8ba8\uff1a</p> <ol> <li>\u7ebf\u7a0b\u5d29\u6e83\uff0c\u8fdb\u7a0b\u4e00\u5b9a\u4f1a\u5d29\u6e83\u5417</li> <li>\u8fdb\u7a0b\u662f\u5982\u4f55\u5d29\u6e83\u7684 - \u4fe1\u53f7\u673a\u5236\u7b80\u4ecb</li> <li>\u4e3a\u4ec0\u4e48\u5728 JVM \u4e2d\u7ebf\u7a0b\u5d29\u6e83\u4e0d\u4f1a\u5bfc\u81f4 JVM \u8fdb\u7a0b\u5d29\u6e83</li> <li>openJDK \u6e90\u7801\u89e3\u6790</li> </ol>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/thread_crash/#_1","title":"\u7ebf\u7a0b\u5d29\u6e83\uff0c\u8fdb\u7a0b\u4e00\u5b9a\u4f1a\u5d29\u6e83\u5417","text":"<p>\u4e00\u822c\u6765\u8bf4\u5982\u679c\u7ebf\u7a0b\u662f\u56e0\u4e3a\u975e\u6cd5\u8bbf\u95ee\u5185\u5b58\u5f15\u8d77\u7684\u5d29\u6e83\uff0c\u90a3\u4e48\u8fdb\u7a0b\u80af\u5b9a\u4f1a\u5d29\u6e83\uff0c\u4e3a\u4ec0\u4e48\u7cfb\u7edf\u8981\u8ba9\u8fdb\u7a0b\u5d29\u6e83\u5462\uff0c\u8fd9\u4e3b\u8981\u662f\u56e0\u4e3a\u5728\u8fdb\u7a0b\u4e2d\uff0c\u5404\u4e2a\u7ebf\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u662f\u5171\u4eab\u7684\uff0c\u65e2\u7136\u662f\u5171\u4eab\uff0c\u90a3\u4e48\u67d0\u4e2a\u7ebf\u7a0b\u5bf9\u5730\u5740\u7684\u975e\u6cd5\u8bbf\u95ee\u5c31\u4f1a\u5bfc\u81f4\u5185\u5b58\u7684\u4e0d\u786e\u5b9a\u6027\uff0c\u8fdb\u800c\u53ef\u80fd\u4f1a\u5f71\u54cd\u5230\u5176\u4ed6\u7ebf\u7a0b\uff0c\u8fd9\u79cd\u64cd\u4f5c\u662f\u5371\u9669\u7684\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u8ba4\u4e3a\u8fd9\u5f88\u53ef\u80fd\u5bfc\u81f4\u4e00\u7cfb\u5217\u4e25\u91cd\u7684\u540e\u679c\uff0c\u4e8e\u662f\u5e72\u8106\u8ba9\u6574\u4e2a\u8fdb\u7a0b\u5d29\u6e83</p> <p></p> <p>\u7ebf\u7a0b\u5171\u4eab\u4ee3\u7801\u6bb5\uff0c\u6570\u636e\u6bb5\uff0c\u5730\u5740\u7a7a\u95f4\uff0c\u6587\u4ef6\u975e\u6cd5\u8bbf\u95ee\u5185\u5b58\u6709\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u4ee5 C \u8bed\u8a00\u4e3e\u4f8b\u6765\u770b\u770b\u3002</p> <p>1.\u3001\u9488\u5bf9\u53ea\u8bfb\u5185\u5b58\u5199\u5165\u6570\u636e</p> C<pre><code>   #include &lt;stdio.h&gt;\n   #include &lt;stdlib.h&gt;\n\n   int main() {\n      char *s = \"hello world\";\n      // \u5411\u53ea\u8bfb\u5185\u5b58\u5199\u5165\u6570\u636e\uff0c\u5d29\u6e83\n      s[1] = 'H'; \n   }\n</code></pre> <p>2\u3001\u8bbf\u95ee\u4e86\u8fdb\u7a0b\u6ca1\u6709\u6743\u9650\u8bbf\u95ee\u7684\u5730\u5740\u7a7a\u95f4\uff08\u6bd4\u5982\u5185\u6838\u7a7a\u95f4\uff09</p> C<pre><code>   #include &lt;stdio.h&gt;\n   #include &lt;stdlib.h&gt;\n\n   int main() {\n      int *p = (int *)0xC0000fff;\n      // \u9488\u5bf9\u8fdb\u7a0b\u7684\u5185\u6838\u7a7a\u95f4\u5199\u5165\u6570\u636e\uff0c\u5d29\u6e83\n      *p = 10; \n   }\n</code></pre> <p>\u5728 32 \u4f4d\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\uff0cp \u6307\u5411\u7684\u662f\u5185\u6838\u7a7a\u95f4\uff0c\u663e\u7136\u4e0d\u5177\u6709\u5199\u5165\u6743\u9650\uff0c\u6240\u4ee5\u4e0a\u8ff0\u8d4b\u503c\u64cd\u4f5c\u4f1a\u5bfc\u81f4\u5d29\u6e83</p> <p>3\u3001\u8bbf\u95ee\u4e86\u4e0d\u5b58\u5728\u7684\u5185\u5b58\uff0c\u6bd4\u5982\uff1a</p> C<pre><code>   #include &lt;stdio.h&gt;\n   #include &lt;stdlib.h&gt;\n\n   int main() {\n      int *a = NULL;\n      *a = 1;     \n   }\n</code></pre> <p>\u4ee5\u4e0a\u9519\u8bef\u90fd\u662f\u8bbf\u95ee\u5185\u5b58\u65f6\u7684\u9519\u8bef\uff0c\u6240\u4ee5\u7edf\u4e00\u4f1a\u62a5 Segment Fault \u9519\u8bef\uff08\u5373\u6bb5\u9519\u8bef\uff09\uff0c\u8fd9\u4e9b\u90fd\u4f1a\u5bfc\u81f4\u8fdb\u7a0b\u5d29\u6e83</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/thread_crash/#-","title":"\u8fdb\u7a0b\u662f\u5982\u4f55\u5d29\u6e83\u7684 - \u4fe1\u53f7\u673a\u5236\u7b80\u4ecb","text":"<p>\u90a3\u4e48\u7ebf\u7a0b\u5d29\u6e83\u540e\uff0c\u8fdb\u7a0b\u662f\u5982\u4f55\u5d29\u6e83\u7684\u5462\uff0c\u8fd9\u80cc\u540e\u7684\u673a\u5236\u5230\u5e95\u662f\u600e\u6837\u7684\uff0c\u7b54\u6848\u662f\u4fe1\u53f7\u3002</p> <p>\u5927\u5bb6\u60f3\u60f3\u8981\u5e72\u6389\u4e00\u4e2a\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\u662f\u4e0d\u662f\u7ecf\u5e38\u7528 kill -9 pid \u8fd9\u6837\u7684\u547d\u4ee4\uff0c\u8fd9\u91cc\u7684 kill \u5176\u5b9e\u5c31\u662f\u7ed9\u6307\u5b9a pid \u53d1\u9001\u7ec8\u6b62\u4fe1\u53f7\u7684\u610f\u601d\uff0c\u5176\u4e2d\u7684 9 \u5c31\u662f\u4fe1\u53f7\u3002</p> <p>\u5176\u5b9e\u4fe1\u53f7\u6709\u5f88\u591a\u7c7b\u578b\u7684\uff0c\u5728 Linux \u4e2d\u53ef\u4ee5\u901a\u8fc7 <code>kill -l</code>\u67e5\u770b\u6240\u6709\u53ef\u7528\u7684\u4fe1\u53f7\uff1a</p> <p></p> <p>\u5f53\u7136\u4e86\u53d1 kill \u4fe1\u53f7\u5fc5\u987b\u5177\u6709\u4e00\u5b9a\u7684\u6743\u9650\uff0c\u5426\u5219\u4efb\u610f\u8fdb\u7a0b\u90fd\u53ef\u4ee5\u901a\u8fc7\u53d1\u4fe1\u53f7\u6765\u7ec8\u6b62\u5176\u4ed6\u8fdb\u7a0b\uff0c\u90a3\u663e\u7136\u662f\u4e0d\u5408\u7406\u7684\uff0c\u5b9e\u9645\u4e0a kill \u6267\u884c\u7684\u662f\u7cfb\u7edf\u8c03\u7528\uff0c\u5c06\u63a7\u5236\u6743\u8f6c\u79fb\u7ed9\u4e86\u5185\u6838\uff08\u64cd\u4f5c\u7cfb\u7edf\uff09\uff0c\u7531\u5185\u6838\u6765\u7ed9\u6307\u5b9a\u7684\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7</p> <p>\u90a3\u4e48\u53d1\u4e2a\u4fe1\u53f7\u8fdb\u7a0b\u600e\u4e48\u5c31\u5d29\u6e83\u4e86\u5462\uff0c\u8fd9\u80cc\u540e\u7684\u539f\u7406\u5230\u5e95\u662f\u600e\u6837\u7684\uff1f</p> <p>\u5176\u80cc\u540e\u7684\u673a\u5236\u5982\u4e0b</p> <ol> <li>CPU \u6267\u884c\u6b63\u5e38\u7684\u8fdb\u7a0b\u6307\u4ee4</li> <li>\u8c03\u7528 kill \u7cfb\u7edf\u8c03\u7528\u5411\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7</li> <li>\u8fdb\u7a0b\u6536\u5230\u64cd\u4f5c\u7cfb\u7edf\u53d1\u7684\u4fe1\u53f7\uff0cCPU \u6682\u505c\u5f53\u524d\u7a0b\u5e8f\u8fd0\u884c\uff0c\u5e76\u5c06\u63a7\u5236\u6743\u8f6c\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf</li> <li>\u8c03\u7528 kill \u7cfb\u7edf\u8c03\u7528\u5411\u8fdb\u7a0b\u53d1\u9001\u4fe1\u53f7\uff08\u5047\u8bbe\u4e3a 11\uff0c\u5373 SIGSEGV\uff0c\u4e00\u822c\u975e\u6cd5\u8bbf\u95ee\u5185\u5b58\u62a5\u7684\u90fd\u662f\u8fd9\u4e2a\u9519\u8bef\uff09</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u6839\u636e\u60c5\u51b5\u6267\u884c\u76f8\u5e94\u7684\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\uff08\u51fd\u6570\uff09\uff0c\u4e00\u822c\u6267\u884c\u5b8c\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\u903b\u8f91\u540e\u4f1a\u8ba9\u8fdb\u7a0b\u9000\u51fa</li> </ol> <p>\u6ce8\u610f\u4e0a\u9762\u7684\u7b2c\u4e94\u6b65\uff0c\u5982\u679c\u8fdb\u7a0b\u6ca1\u6709\u6ce8\u518c\u81ea\u5df1\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u90a3\u4e48\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6267\u884c\u9ed8\u8ba4\u7684\u4fe1\u53f7\u5904\u7406\u7a0b\u5e8f\uff08\u4e00\u822c\u6700\u540e\u4f1a\u8ba9\u8fdb\u7a0b\u9000\u51fa\uff09\uff0c\u4f46\u5982\u679c\u6ce8\u518c\u4e86\uff0c\u5219\u4f1a\u6267\u884c\u81ea\u5df1\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u8fd9\u6837\u7684\u8bdd\u5c31\u7ed9\u4e86\u8fdb\u7a0b\u4e00\u4e2a\u5782\u6b7b\u6323\u624e\u7684\u673a\u4f1a\uff0c\u5b83\u6536\u5230 kill \u4fe1\u53f7\u540e\uff0c\u53ef\u4ee5\u8c03\u7528 exit() \u6765\u9000\u51fa\uff0c\u4f46\u4e5f\u53ef\u4ee5\u4f7f\u7528 sigsetjmp\uff0csiglongjmp \u8fd9\u4e24\u4e2a\u51fd\u6570\u6765\u6062\u590d\u8fdb\u7a0b\u7684\u6267\u884c</p> C<pre><code>// \u81ea\u5b9a\u4e49\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u793a\u4f8b\n\n#include &lt;stdio.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;stdlib.h&gt;\n// \u81ea\u5b9a\u4e49\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u5904\u7406\u81ea\u5b9a\u4e49\u903b\u8f91\u540e\u518d\u8c03\u7528 exit \u9000\u51fa\nvoid sigHandler(int sig) {\n  printf(\"Signal %d catched!\\n\", sig);\n  exit(sig);\n}\nint main(void) {\n  signal(SIGSEGV, sigHandler);\n  int *p = (int *)0xC0000fff;\n  *p = 10; // \u9488\u5bf9\u4e0d\u5c5e\u4e8e\u8fdb\u7a0b\u7684\u5185\u6838\u7a7a\u95f4\u5199\u5165\u6570\u636e\uff0c\u5d29\u6e83\n}\n\n// \u4ee5\u4e0a\u7ed3\u679c\u8f93\u51fa\uff1aSignal 11 catched!\n</code></pre> <p>\u5982\u4ee3\u7801\u6240\u793a\uff1a\u6ce8\u518c\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u540e\uff0c\u5f53\u6536\u5230 SIGSEGV \u4fe1\u53f7\u540e\uff0c\u5148\u6267\u884c\u76f8\u5173\u7684\u903b\u8f91\u518d\u9000\u51fa</p> <p>\u53e6\u5916\u5f53\u8fdb\u7a0b\u63a5\u6536\u4fe1\u53f7\u4e4b\u540e\u4e5f\u53ef\u4ee5\u4e0d\u5b9a\u4e49\u81ea\u5df1\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u800c\u662f\u9009\u62e9\u5ffd\u7565\u4fe1\u53f7\uff0c\u5982\u4e0b</p> C<pre><code>#include &lt;stdio.h&gt;\n#include &lt;signal.h&gt;\n#include &lt;stdlib.h&gt;\n\nint main(void) {\n  // \u5ffd\u7565\u4fe1\u53f7\n  signal(SIGSEGV, SIG_IGN);\n\n  // \u4ea7\u751f\u4e00\u4e2a SIGSEGV \u4fe1\u53f7\n  raise(SIGSEGV);\n\n  printf(\"\u6b63\u5e38\u7ed3\u675f\");\n}\n</code></pre> <p>\u4e5f\u5c31\u662f\u8bf4\u867d\u7136\u7ed9\u8fdb\u7a0b\u53d1\u9001\u4e86 kill \u4fe1\u53f7\uff0c\u4f46\u5982\u679c\u8fdb\u7a0b\u81ea\u5df1\u5b9a\u4e49\u4e86\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u6216\u8005\u65e0\u89c6\u4fe1\u53f7\u5c31\u6709\u673a\u4f1a\u9003\u51fa\u751f\u5929\uff0c\u5f53\u7136\u4e86 kill -9 \u547d\u4ee4\u4f8b\u5916\uff0c\u4e0d\u7ba1\u8fdb\u7a0b\u662f\u5426\u5b9a\u4e49\u4e86\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u90fd\u4f1a\u9a6c\u4e0a\u88ab\u5e72\u6389\u3002</p> <p>\u8bf4\u5230\u8fd9\u5927\u5bb6\u662f\u5426\u60f3\u8d77\u4e86\u4e00\u9053\u7ecf\u5178\u9762\u8bd5\u9898\uff1a\u5982\u4f55\u8ba9\u6b63\u5728\u8fd0\u884c\u7684 Java \u5de5\u7a0b\u7684\u4f18\u96c5\u505c\u673a\uff1f</p> <p>\u901a\u8fc7\u4e0a\u9762\u7684\u4ecb\u7ecd\u5927\u5bb6\u4e0d\u96be\u53d1\u73b0\uff0c\u5176\u5b9e\u662f JVM \u81ea\u5df1\u5b9a\u4e49\u4e86\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u8fd9\u6837\u5f53\u53d1\u9001 kill pid \u547d\u4ee4\uff08\u9ed8\u8ba4\u4f1a\u4f20 15 \u4e5f\u5c31\u662f SIGTERM\uff09\u540e\uff0cJVM \u5c31\u53ef\u4ee5\u5728\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u4e2d\u6267\u884c\u4e00\u4e9b\u8d44\u6e90\u6e05\u7406\u4e4b\u540e\u518d\u8c03\u7528 exit \u9000\u51fa\u3002</p> <p>\u8fd9\u79cd\u573a\u666f\u663e\u7136\u4e0d\u80fd\u7528 kill -9\uff0c\u4e0d\u7136\u4e00\u4e0b\u628a\u8fdb\u7a0b\u5e72\u6389\u4e86\u8d44\u6e90\u5c31\u6765\u4e0d\u53ca\u6e05\u9664\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/thread_crash/#jvm","title":"\u4e3a\u4ec0\u4e48\u7ebf\u7a0b\u5d29\u6e83\u4e0d\u4f1a\u5bfc\u81f4 JVM \u8fdb\u7a0b\u5d29\u6e83","text":"<p>\u73b0\u5728\u6211\u4eec\u518d\u6765\u770b\u770b\u5f00\u5934\u8fd9\u4e2a\u95ee\u9898\uff0c\u76f8\u4fe1\u4f60\u591a\u5c11\u4f1a\u5fc3\u4e2d\u6709\u6570\uff0c\u60f3\u60f3\u770b\u5728 Java \u4e2d\u6709\u54ea\u4e9b\u662f\u5e38\u89c1\u7684\u7531\u4e8e\u975e\u6cd5\u8bbf\u95ee\u5185\u5b58\u800c\u4ea7\u751f\u7684 Exception \u6216 error \u5462\uff0c\u5e38\u89c1\u7684\u662f\u5927\u5bb6\u719f\u6089\u7684 StackoverflowError \u6216\u8005 NPE\uff08NullPointerException\uff09,NPE \u6211\u4eec\u90fd\u4e86\u89e3\uff0c\u5c5e\u4e8e\u662f\u8bbf\u95ee\u4e86\u4e0d\u5b58\u5728\u7684\u5185\u5b58\u3002</p> <p>\u4f46\u4e3a\u4ec0\u4e48\u6808\u6ea2\u51fa\uff08Stackoverflow\uff09\u4e5f\u5c5e\u4e8e\u975e\u6cd5\u8bbf\u95ee\u5185\u5b58\u5462\uff0c\u8fd9\u5f97\u7b80\u5355\u804a\u4e00\u4e0b\u8fdb\u7a0b\u7684\u865a\u62df\u7a7a\u95f4\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u63d0\u5230\u7684\u5171\u4eab\u5730\u5740\u7a7a\u95f4\u3002</p> <p>\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u4e86\u4fdd\u62a4\u8fdb\u7a0b\u4e4b\u95f4\u4e0d\u53d7\u5f71\u54cd\uff0c\u6240\u4ee5\u4f7f\u7528\u4e86\u865a\u62df\u5730\u5740\u7a7a\u95f4\u6765\u9694\u79bb\u8fdb\u7a0b\uff0c\u8fdb\u7a0b\u7684\u5bfb\u5740\u90fd\u662f\u9488\u5bf9\u865a\u62df\u5730\u5740\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u865a\u62df\u7a7a\u95f4\u90fd\u662f\u4e00\u6837\u7684\uff0c\u800c\u7ebf\u7a0b\u4f1a\u5171\u7528\u8fdb\u7a0b\u7684\u5730\u5740\u7a7a\u95f4\u3002</p> <p>\u4ee5 32 \u4f4d\u865a\u62df\u7a7a\u95f4\uff0c\u8fdb\u7a0b\u7684\u865a\u62df\u7a7a\u95f4\u5206\u5e03\u5982\u4e0b\uff1a</p> <p></p> <p>\u90a3\u4e48 stackoverflow \u662f\u600e\u4e48\u53d1\u751f\u7684\u5462\uff1f</p> <p>\u8fdb\u7a0b\u6bcf\u8c03\u7528\u4e00\u4e2a\u51fd\u6570\uff0c\u90fd\u4f1a\u5206\u914d\u4e00\u4e2a\u6808\u5e27\uff0c\u7136\u540e\u5728\u6808\u5e27\u91cc\u4f1a\u5206\u914d\u51fd\u6570\u91cc\u5b9a\u4e49\u7684\u5404\u79cd\u5c40\u90e8\u53d8\u91cf\u3002</p> <p>\u5047\u8bbe\u73b0\u5728\u8c03\u7528\u4e86\u4e00\u4e2a\u65e0\u9650\u9012\u5f52\u7684\u51fd\u6570\uff0c\u90a3\u5c31\u4f1a\u6301\u7eed\u5206\u914d\u6808\u5e27\uff0c\u4f46 stack \u7684\u5927\u5c0f\u662f\u6709\u9650\u7684\uff08Linux \u4e2d\u9ed8\u8ba4\u4e3a 8 M\uff0c\u53ef\u4ee5\u901a\u8fc7 ulimit -a \u67e5\u770b\uff09\uff0c\u5982\u679c\u65e0\u9650\u9012\u5f52\u5f88\u5feb\u6808\u5c31\u4f1a\u5206\u914d\u5b8c\u4e86\uff0c\u6b64\u65f6\u518d\u8c03\u7528\u51fd\u6570\u8bd5\u56fe\u5206\u914d\u8d85\u51fa\u6808\u7684\u5927\u5c0f\u5185\u5b58\uff0c\u5c31\u4f1a\u53d1\u751f\u6bb5\u9519\u8bef\uff0c\u4e5f\u5c31\u662f stackoverflowError\u3002</p> <p></p> <p>\u597d\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u77e5\u9053\u4e86 StackoverflowError \u600e\u4e48\u4ea7\u751f\u7684\u3002</p> <p>\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u65e2\u7136 StackoverflowError \u6216\u8005 NPE \u90fd\u5c5e\u4e8e\u975e\u6cd5\u8bbf\u95ee\u5185\u5b58\uff0cJVM \u4e3a\u4ec0\u4e48\u4e0d\u4f1a\u5d29\u6e83\u5462\uff1f</p> <p>\u6709\u4e86\u4e0a\u4e00\u8282\u7684\u94fa\u57ab\uff0c\u76f8\u4fe1\u4f60\u4e0d\u96be\u56de\u7b54\uff0c\u5176\u5b9e\u5c31\u662f\u56e0\u4e3a JVM \u81ea\u5b9a\u4e49\u4e86\u81ea\u5df1\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u62e6\u622a\u4e86 SIGSEGV \u4fe1\u53f7\uff0c\u9488\u5bf9\u8fd9\u4e24\u8005\u4e0d\u8ba9\u5b83\u4eec\u5d29\u6e83\u3002</p> <p>\u600e\u4e48\u8bc1\u660e\u8fd9\u4e2a\u63a8\u6d4b\u5462\uff0c\u6211\u4eec\u6765\u770b\u4e0b JVM \u7684\u6e90\u7801\u6765\u4e00\u63a2\u7a76\u7adf</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/thread_crash/#openjdk","title":"openJDK \u6e90\u7801\u89e3\u6790","text":"<p>HotSpot \u865a\u62df\u673a\u76ee\u524d\u4f7f\u7528\u8303\u56f4\u6700\u5e7f\u7684 Java \u865a\u62df\u673a\uff0c\u636e R \u5927\u6240\u8ff0\uff0cOracle JDK \u4e0e OpenJDK \u91cc\u7684 JVM \u90fd\u662f HotSpot VM\uff0c\u4ece\u6e90\u7801\u5c42\u9762\u8bf4\uff0c\u4e24\u8005\u57fa\u672c\u4e0a\u662f\u540c\u4e00\u4e2a\u4e1c\u897f\u3002</p> <p>OpenJDK \u662f\u5f00\u6e90\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u4e3b\u8981\u7814\u7a76\u4e0b Java 8 \u7684 OpenJDK \u5373\u53ef\uff0c\u5730\u5740\u5982\u4e0b\uff1ahttps://github.com/AdoptOpenJDK/openjdk-jdk8u\uff0c\u6709\u5174\u8da3\u7684\u53ef\u4ee5\u4e0b\u8f7d\u6765\u770b\u770b\u3002</p> <p>\u6211\u4eec\u53ea\u8981\u7814\u7a76 Linux \u4e0b\u7684 JVM\uff0c\u4e3a\u4e86\u4fbf\u4e8e\u8bf4\u660e\uff0c\u4e5f\u65b9\u4fbf\u5927\u5bb6\u67e5\u9605\uff0c\u6211\u628a\u5176\u4e2d\u5173\u4e8e\u4fe1\u53f7\u5904\u7406\u7684\u5173\u952e\u6d41\u7a0b\u6574\u7406\u4e86\u4e0b\uff08\u5ffd\u7565\u5176\u4e2d\u7684\u6b21\u8981\u4ee3\u7801\uff09\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u542f\u52a8 JVM \u7684\u65f6\u5019\uff0c\u4e5f\u8bbe\u7f6e\u4e86\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u6536\u5230 SIGSEGV\uff0cSIGPIPE \u7b49\u4fe1\u53f7\u540e\u6700\u7ec8\u4f1a\u8c03\u7528 JVM_handle_linux_signal \u8fd9\u4e2a\u81ea\u5b9a\u4e49\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u518d\u6765\u770b\u4e0b\u8fd9\u4e2a\u51fd\u6570\u7684\u4e3b\u8981\u903b\u8f91\u3002</p> Java<pre><code>JVM_handle_linux_signal(int sig,\n                        siginfo_t* info,\n                        void* ucVoid,\n                        int abort_if_unrecognized) {\n\n   // Must do this before SignalHandlerMark, if crash protection installed we will longjmp away\n  // \u8fd9\u6bb5\u4ee3\u7801\u91cc\u4f1a\u8c03\u7528 siglongjmp\uff0c\u4e3b\u8981\u505a\u7ebf\u7a0b\u6062\u590d\u4e4b\u7528\n  os::ThreadCrashProtection::check_crash_protection(sig, t);\n\n  if (info != NULL &amp;&amp; uc != NULL &amp;&amp; thread != NULL) {\n    pc = (address) os::Linux::ucontext_get_pc(uc);\n\n    // Handle ALL stack overflow variations here\n    if (sig == SIGSEGV) {\n      // Si_addr may not be valid due to a bug in the linux-ppc64 kernel (see\n      // comment below). Use get_stack_bang_address instead of si_addr.\n      address addr = ((NativeInstruction*)pc)-&gt;get_stack_bang_address(uc);\n\n      // \u5224\u65ad\u662f\u5426\u6808\u6ea2\u51fa\u4e86\n      if (addr &lt; thread-&gt;stack_base() &amp;&amp;\n          addr &gt;= thread-&gt;stack_base() - thread-&gt;stack_size()) {\n        if (thread-&gt;thread_state() == _thread_in_Java) {            // \u9488\u5bf9\u6808\u6ea2\u51fa JVM \u7684\u5185\u90e8\u5904\u7406\n            stub = SharedRuntime::continuation_for_implicit_exception(thread, pc, SharedRuntime::STACK_OVERFLOW);\n        }\n      }\n    }\n  }\n\n  if (sig == SIGSEGV &amp;&amp;\n               !MacroAssembler::needs_explicit_null_check((intptr_t)info-&gt;si_addr)) {\n         // \u6b64\u5904\u4f1a\u505a\u7a7a\u6307\u9488\u68c0\u67e5\n      stub = SharedRuntime::continuation_for_implicit_exception(thread, pc, SharedRuntime::IMPLICIT_NULL);\n  }\n\n\n  // \u5982\u679c\u662f\u6808\u6ea2\u51fa\u6216\u8005\u7a7a\u6307\u9488\u6700\u7ec8\u4f1a\u8fd4\u56de true\uff0c\u4e0d\u4f1a\u8d70\u6700\u540e\u7684 report_and_die\uff0c\u6240\u4ee5 JVM \u4e0d\u4f1a\u9000\u51fa\n  if (stub != NULL) {\n    // save all thread context in case we need to restore it\n    if (thread != NULL) thread-&gt;set_saved_exception_pc(pc);\n\n    uc-&gt;uc_mcontext.gregs[REG_PC] = (greg_t)stub;\n    // \u8fd4\u56de true \u4ee3\u8868 JVM \u8fdb\u7a0b\u4e0d\u4f1a\u9000\u51fa\n    return true;\n  }\n\n  VMError err(t, sig, pc, info, ucVoid);\n  // \u751f\u6210 hs_err_pid_xxx.log \u6587\u4ef6\u5e76\u9000\u51fa\n  err.report_and_die();\n\n  ShouldNotReachHere();\n  return true; // Mute compiler\n\n}\n</code></pre> <p>\u4ece\u4ee5\u4e0a\u4ee3\u7801\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\u4ee5\u4e0b\u4fe1\u606f\uff1a</p> <ol> <li>\u53d1\u751f stackoverflow \u8fd8\u6709\u7a7a\u6307\u9488\u9519\u8bef\uff0c\u786e\u5b9e\u90fd\u53d1\u9001\u4e86 SIGSEGV\uff0c\u53ea\u662f\u865a\u62df\u673a\u4e0d\u9009\u62e9\u9000\u51fa\uff0c\u800c\u662f\u81ea\u5df1\u5185\u90e8\u4f5c\u4e86\u989d\u5916\u7684\u5904\u7406\uff0c\u5176\u5b9e\u662f\u6062\u590d\u4e86\u7ebf\u7a0b\u7684\u6267\u884c\uff0c\u5e76\u629b\u51fa StackoverflowError \u548c NPE\uff0c\u8fd9\u5c31\u662f\u4e3a\u4ec0\u4e48 JVM \u4e0d\u4f1a\u5d29\u6e83\u4e14\u6211\u4eec\u80fd\u6355\u83b7\u8fd9\u4e24\u4e2a\u9519\u8bef/\u5f02\u5e38\u7684\u539f\u56e0</li> <li>\u5982\u679c\u9488\u5bf9 SIGSEGV \u7b49\u4fe1\u53f7\uff0c\u5728\u4ee5\u4e0a\u7684\u51fd\u6570\u4e2d JVM \u6ca1\u6709\u505a\u989d\u5916\u7684\u5904\u7406\uff0c\u90a3\u4e48\u6700\u7ec8\u4f1a\u8d70\u5230 report_and_die \u8fd9\u4e2a\u65b9\u6cd5\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u4e3b\u8981\u505a\u7684\u4e8b\u60c5\u662f\u751f\u6210 hs_err_pid_xxx.log crash \u6587\u4ef6\uff08\u8bb0\u5f55\u4e86\u4e00\u4e9b\u5806\u6808\u4fe1\u606f\u6216\u9519\u8bef\uff09\uff0c\u7136\u540e\u9000\u51fa</li> </ol> <p>\u81f3\u6b64\u6211\u76f8\u4fe1\u5927\u5bb6\u660e\u767d\u4e86\u4e3a\u4ec0\u4e48\u53d1\u751f\u4e86 StackoverflowError \u548c NPE \u8fd9\u4e24\u4e2a\u975e\u6cd5\u8bbf\u95ee\u5185\u5b58\u7684\u9519\u8bef\uff0cJVM \u5374\u6ca1\u6709\u5d29\u6e83\u3002</p> <p>\u539f\u56e0\u5176\u5b9e\u5c31\u662f\u865a\u62df\u673a\u5185\u90e8\u5b9a\u4e49\u4e86\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u800c\u5728\u4fe1\u53f7\u5904\u7406\u51fd\u6570\u4e2d\u5bf9\u8fd9\u4e24\u8005\u505a\u4e86\u989d\u5916\u7684\u5904\u7406\u4ee5\u8ba9 JVM \u4e0d\u5d29\u6e83\uff0c\u53e6\u4e00\u65b9\u9762\u4e5f\u53ef\u4ee5\u770b\u51fa\u5982\u679c JVM \u4e0d\u5bf9\u4fe1\u53f7\u505a\u989d\u5916\u7684\u5904\u7406\uff0c\u6700\u540e\u4f1a\u81ea\u5df1\u9000\u51fa\u5e76\u4ea7\u751f crash \u6587\u4ef6 hs_err_pid_xxx.log\uff08\u53ef\u4ee5\u901a\u8fc7 -XX:ErrorFile=/var/log/hs_err.log \u8fd9\u6837\u7684\u65b9\u5f0f\u6307\u5b9a\uff09\uff0c\u8fd9\u4e2a\u6587\u4ef6\u8bb0\u5f55\u4e86\u865a\u62df\u673a\u5d29\u6e83\u7684\u91cd\u8981\u539f\u56e0\u3002</p> <p>\u6240\u4ee5\u4e5f\u53ef\u4ee5\u8bf4\uff0c\u865a\u62df\u673a\u662f\u5426\u5d29\u6e83\u53ea\u8981\u770b\u5b83\u662f\u5426\u4f1a\u4ea7\u751f\u6b64\u5d29\u6e83\u65e5\u5fd7\u6587\u4ef6</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/4_process/thread_crash/#_2","title":"\u603b\u7ed3","text":"<p>\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u4e86\u4fdd\u8bc1\u7cfb\u7edf\u5b89\u5168\uff0c\u6240\u4ee5\u9488\u5bf9\u975e\u6cd5\u5185\u5b58\u8bbf\u95ee\u4f1a\u53d1\u9001\u4e00\u4e2a SIGSEGV \u4fe1\u53f7\uff0c\u800c\u64cd\u4f5c\u7cfb\u7edf\u4e00\u822c\u4f1a\u8c03\u7528\u9ed8\u8ba4\u7684\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff08\u4e00\u822c\u4f1a\u8ba9\u76f8\u5173\u7684\u8fdb\u7a0b\u5d29\u6e83\uff09\u3002</p> <p>\u4f46\u5982\u679c\u8fdb\u7a0b\u89c9\u5f97\"\u7f6a\u4e0d\u81f4\u6b7b\"\uff0c\u90a3\u4e48\u5b83\u4e5f\u53ef\u4ee5\u9009\u62e9\u81ea\u5b9a\u4e49\u4e00\u4e2a\u4fe1\u53f7\u5904\u7406\u51fd\u6570\uff0c\u8fd9\u6837\u7684\u8bdd\u5b83\u5c31\u53ef\u4ee5\u505a\u4e00\u4e9b\u81ea\u5b9a\u4e49\u7684\u903b\u8f91\uff0c\u6bd4\u5982\u8bb0\u5f55 crash \u4fe1\u606f\u7b49\u6709\u610f\u4e49\u7684\u4e8b\u3002</p> <p>\u56de\u8fc7\u5934\u6765\u770b\u4e3a\u4ec0\u4e48\u865a\u62df\u673a\u4f1a\u9488\u5bf9 StackoverflowError \u548c NullPointerException \u505a\u989d\u5916\u5904\u7406\u8ba9\u7ebf\u7a0b\u6062\u590d\u5462\uff0c\u9488\u5bf9 stackoverflow \u5176\u5b9e\u5b83\u91c7\u7528\u4e86\u4e00\u79cd\u6808\u56de\u6eaf\u7684\u65b9\u6cd5\u4fdd\u8bc1\u7ebf\u7a0b\u53ef\u4ee5\u4e00\u76f4\u6267\u884c\u4e0b\u53bb\uff0c\u800c\u6355\u83b7\u7a7a\u6307\u9488\u9519\u8bef\u4e3b\u8981\u662f\u8fd9\u4e2a\u9519\u8bef\u5b9e\u5728\u592a\u666e\u904d\u4e86\u3002</p> <p>\u4e3a\u4e86\u8fd9\u4e00\u4e2a\u5f88\u5e38\u89c1\u7684\u9519\u8bef\u800c\u8ba9 JVM \u5d29\u6e83\u90a3\u7ebf\u4e0a\u7684 JVM \u8981\u5b95\u673a\u591a\u5c11\u6b21\uff0c\u6240\u4ee5\u51fa\u4e8e\u5de5\u7a0b\u5065\u58ee\u6027\u7684\u8003\u8651\uff0c\u4e0e\u5176\u76f4\u63a5\u8ba9 JVM \u5d29\u6e83\u5012\u4e0d\u5982\u8ba9\u7ebf\u7a0b\u8d77\u6b7b\u56de\u751f\uff0c\u5e76\u4e14\u5c06\u8fd9\u4e24\u4e2a\u9519\u8bef/\u5f02\u5e38\u629b\u7ed9\u7528\u6237\u6765\u5904\u7406\u3002</p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/","title":"6.1 \u8fdb\u7a0b\u8c03\u5ea6/\u9875\u9762\u7f6e\u6362/\u78c1\u76d8\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u6700\u8fd1\uff0c\u6211\u5077\u5077\u6f5c\u4f0f\u5728\u5404\u5927\u6280\u672f\u7fa4\uff0c\u56e0\u4e3a\u79cb\u62db\u5728\u5373\uff0c\u770b\u5230\u4e0d\u5c11\u5c0f\u4f19\u4f34\u5206\u4eab\u7684\u5927\u5382\u9762\u7ecf\u3002</p> <p>\u7136\u540e\u53d1\u73b0\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u77e5\u8bc6\u70b9\u8003\u5bdf\u8fd8\u662f\u6bd4\u8f83\u591a\u7684\uff0c\u5927\u5382\u5c31\u662f\u5927\u5382\u5c31\u7231\u95ee\u57fa\u7840\u77e5\u8bc6\u3002\u5176\u4e2d\uff0c\u5173\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u300c\u8c03\u5ea6\u7b97\u6cd5\u300d\u8003\u5bdf\u4e5f\u7b97\u6bd4\u8f83\u9891\u7e41\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u8fd9\u8fb9\u603b\u7ed3\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e09\u5927\u8c03\u5ea6\u673a\u5236\uff0c\u5206\u522b\u662f\u300c\u8fdb\u7a0b\u8c03\u5ea6/\u9875\u9762\u7f6e\u6362/\u78c1\u76d8\u8c03\u5ea6\u7b97\u6cd5\u300d\uff0c\u4f9b\u5927\u5bb6\u590d\u4e60\uff0c\u5e0c\u671b\u5927\u5bb6\u5728\u79cb\u62db\u80fd\u65a9\u83b7\u81ea\u5df1\u5fc3\u610f\u7684 offer\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_1","title":"\u8fdb\u7a0b\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u8fdb\u7a0b\u8c03\u5ea6\u7b97\u6cd5\u4e5f\u79f0 CPU \u8c03\u5ea6\u7b97\u6cd5\uff0c\u6bd5\u7adf\u8fdb\u7a0b\u662f\u7531 CPU \u8c03\u5ea6\u7684\u3002</p> <p>\u5f53 CPU \u7a7a\u95f2\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u9009\u62e9\u5185\u5b58\u4e2d\u7684\u67d0\u4e2a\u300c\u5c31\u7eea\u72b6\u6001\u300d\u7684\u8fdb\u7a0b\uff0c\u5e76\u7ed9\u5176\u5206\u914d CPU\u3002</p> <p>\u4ec0\u4e48\u65f6\u5019\u4f1a\u53d1\u751f CPU \u8c03\u5ea6\u5462\uff1f\u901a\u5e38\u6709\u4ee5\u4e0b\u60c5\u51b5\uff1a</p> <ol> <li>\u5f53\u8fdb\u7a0b\u4ece\u8fd0\u884c\u72b6\u6001\u8f6c\u5230\u7b49\u5f85\u72b6\u6001\uff1b</li> <li>\u5f53\u8fdb\u7a0b\u4ece\u8fd0\u884c\u72b6\u6001\u8f6c\u5230\u5c31\u7eea\u72b6\u6001\uff1b</li> <li>\u5f53\u8fdb\u7a0b\u4ece\u7b49\u5f85\u72b6\u6001\u8f6c\u5230\u5c31\u7eea\u72b6\u6001\uff1b</li> <li>\u5f53\u8fdb\u7a0b\u4ece\u8fd0\u884c\u72b6\u6001\u8f6c\u5230\u7ec8\u6b62\u72b6\u6001\uff1b</li> </ol> <p>\u5176\u4e2d\u53d1\u751f\u5728 1 \u548c 4 \u4e24\u79cd\u60c5\u51b5\u4e0b\u7684\u8c03\u5ea6\u79f0\u4e3a\u300c\u975e\u62a2\u5360\u5f0f\u8c03\u5ea6\u300d\uff0c2 \u548c 3 \u4e24\u79cd\u60c5\u51b5\u4e0b\u53d1\u751f\u7684\u8c03\u5ea6\u79f0\u4e3a\u300c\u62a2\u5360\u5f0f\u8c03\u5ea6\u300d\u3002</p> <p>\u975e\u62a2\u5360\u5f0f\u7684\u610f\u601d\u5c31\u662f\uff0c\u5f53\u8fdb\u7a0b\u6b63\u5728\u8fd0\u884c\u65f6\uff0c\u5b83\u5c31\u4f1a\u4e00\u76f4\u8fd0\u884c\uff0c\u76f4\u5230\u8be5\u8fdb\u7a0b\u5b8c\u6210\u6216\u53d1\u751f\u67d0\u4e2a\u4e8b\u4ef6\u800c\u88ab\u963b\u585e\u65f6\uff0c\u624d\u4f1a\u628a CPU \u8ba9\u7ed9\u5176\u4ed6\u8fdb\u7a0b\u3002</p> <p>\u800c\u62a2\u5360\u5f0f\u8c03\u5ea6\uff0c\u987e\u540d\u601d\u4e49\u5c31\u662f\u8fdb\u7a0b\u6b63\u5728\u8fd0\u884c\u7684\u65f6\uff0c\u53ef\u4ee5\u88ab\u6253\u65ad\uff0c\u4f7f\u5176\u628a CPU \u8ba9\u7ed9\u5176\u4ed6\u8fdb\u7a0b\u3002\u90a3\u62a2\u5360\u7684\u539f\u5219\u4e00\u822c\u6709\u4e09\u79cd\uff0c\u5206\u522b\u662f\u65f6\u95f4\u7247\u539f\u5219\u3001\u4f18\u5148\u6743\u539f\u5219\u3001\u77ed\u4f5c\u4e1a\u4f18\u5148\u539f\u5219\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u597d\u5947\u4e3a\u4ec0\u4e48\u7b2c 3 \u79cd\u60c5\u51b5\u4e5f\u4f1a\u53d1\u751f CPU \u8c03\u5ea6\u5462\uff1f\u5047\u8bbe\u6709\u4e00\u4e2a\u8fdb\u7a0b\u662f\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u7684\uff0c\u4f46\u662f\u5b83\u7684\u4f18\u5148\u7ea7\u6bd4\u8f83\u9ad8\uff0c\u5982\u679c\u8be5\u8fdb\u7a0b\u7b49\u5f85\u7684\u4e8b\u4ef6\u53d1\u751f\u4e86\uff0c\u5b83\u5c31\u4f1a\u8f6c\u5230\u5c31\u7eea\u72b6\u6001\uff0c\u4e00\u65e6\u5b83\u8f6c\u5230\u5c31\u7eea\u72b6\u6001\uff0c\u5982\u679c\u6211\u4eec\u7684\u8c03\u5ea6\u7b97\u6cd5\u662f\u4ee5\u4f18\u5148\u7ea7\u6765\u8fdb\u884c\u8c03\u5ea6\u7684\uff0c\u90a3\u4e48\u5b83\u5c31\u4f1a\u7acb\u9a6c\u62a2\u5360\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u5c31\u4f1a\u53d1\u751f CPU \u8c03\u5ea6\u3002</p> <p>\u90a3\u7b2c 2 \u79cd\u72b6\u6001\u901a\u5e38\u662f\u65f6\u95f4\u7247\u5230\u7684\u60c5\u51b5\uff0c\u56e0\u4e3a\u65f6\u95f4\u7247\u5230\u4e86\u5c31\u4f1a\u53d1\u751f\u4e2d\u65ad\uff0c\u4e8e\u662f\u5c31\u4f1a\u62a2\u5360\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u4ece\u800c\u5360\u7528 CPU\u3002</p> <p>\u8c03\u5ea6\u7b97\u6cd5\u5f71\u54cd\u7684\u662f\u7b49\u5f85\u65f6\u95f4\uff08\u8fdb\u7a0b\u5728\u5c31\u7eea\u961f\u5217\u4e2d\u7b49\u5f85\u8c03\u5ea6\u7684\u65f6\u95f4\u603b\u548c\uff09\uff0c\u800c\u4e0d\u80fd\u5f71\u54cd\u8fdb\u7a0b\u771f\u5728\u4f7f\u7528 CPU \u7684\u65f6\u95f4\u548c I/O \u65f6\u95f4\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8bf4\u8bf4\u5e38\u89c1\u7684\u8c03\u5ea6\u7b97\u6cd5\uff1a</p> <ul> <li>\u5148\u6765\u5148\u670d\u52a1\u8c03\u5ea6\u7b97\u6cd5</li> <li>\u6700\u77ed\u4f5c\u4e1a\u4f18\u5148\u8c03\u5ea6\u7b97\u6cd5</li> <li>\u9ad8\u54cd\u5e94\u6bd4\u4f18\u5148\u8c03\u5ea6\u7b97\u6cd5</li> <li>\u65f6\u95f4\u7247\u8f6e\u8f6c\u8c03\u5ea6\u7b97\u6cd5</li> <li>\u6700\u9ad8\u4f18\u5148\u7ea7\u8c03\u5ea6\u7b97\u6cd5</li> <li>\u591a\u7ea7\u53cd\u9988\u961f\u5217\u8c03\u5ea6\u7b97\u6cd5</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_2","title":"\u5148\u6765\u5148\u670d\u52a1\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u6700\u7b80\u5355\u7684\u4e00\u4e2a\u8c03\u5ea6\u7b97\u6cd5\uff0c\u5c31\u662f\u975e\u62a2\u5360\u5f0f\u7684\u5148\u6765\u5148\u670d\u52a1\uff08First Come First Severd, FCFS\uff09\u7b97\u6cd5\u4e86\u3002</p> <p></p> <p>\u987e\u540d\u601d\u4e49\uff0c\u5148\u6765\u540e\u5230\uff0c\u6bcf\u6b21\u4ece\u5c31\u7eea\u961f\u5217\u9009\u62e9\u6700\u5148\u8fdb\u5165\u961f\u5217\u7684\u8fdb\u7a0b\uff0c\u7136\u540e\u4e00\u76f4\u8fd0\u884c\uff0c\u76f4\u5230\u8fdb\u7a0b\u9000\u51fa\u6216\u88ab\u963b\u585e\uff0c\u624d\u4f1a\u7ee7\u7eed\u4ece\u961f\u5217\u4e2d\u9009\u62e9\u7b2c\u4e00\u4e2a\u8fdb\u7a0b\u63a5\u7740\u8fd0\u884c\u3002</p> <p>\u8fd9\u4f3c\u4e4e\u5f88\u516c\u5e73\uff0c\u4f46\u662f\u5f53\u4e00\u4e2a\u957f\u4f5c\u4e1a\u5148\u8fd0\u884c\u4e86\uff0c\u90a3\u4e48\u540e\u9762\u7684\u77ed\u4f5c\u4e1a\u7b49\u5f85\u7684\u65f6\u95f4\u5c31\u4f1a\u5f88\u957f\uff0c\u4e0d\u5229\u4e8e\u77ed\u4f5c\u4e1a\u3002</p> <p>FCFS \u5bf9\u957f\u4f5c\u4e1a\u6709\u5229\uff0c\u9002\u7528\u4e8e CPU \u7e41\u5fd9\u578b\u4f5c\u4e1a\u7684\u7cfb\u7edf\uff0c\u800c\u4e0d\u9002\u7528\u4e8e I/O \u7e41\u5fd9\u578b\u4f5c\u4e1a\u7684\u7cfb\u7edf\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_3","title":"\u6700\u77ed\u4f5c\u4e1a\u4f18\u5148\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u6700\u77ed\u4f5c\u4e1a\u4f18\u5148\uff08Shortest Job First, SJF\uff09\u8c03\u5ea6\u7b97\u6cd5\u540c\u6837\u4e5f\u662f\u987e\u540d\u601d\u4e49\uff0c\u5b83\u4f1a\u4f18\u5148\u9009\u62e9\u8fd0\u884c\u65f6\u95f4\u6700\u77ed\u7684\u8fdb\u7a0b\u6765\u8fd0\u884c\uff0c\u8fd9\u6709\u52a9\u4e8e\u63d0\u9ad8\u7cfb\u7edf\u7684\u541e\u5410\u91cf\u3002</p> <p></p> <p>\u8fd9\u663e\u7136\u5bf9\u957f\u4f5c\u4e1a\u4e0d\u5229\uff0c\u5f88\u5bb9\u6613\u9020\u6210\u4e00\u79cd\u6781\u7aef\u73b0\u8c61\u3002</p> <p>\u6bd4\u5982\uff0c\u4e00\u4e2a\u957f\u4f5c\u4e1a\u5728\u5c31\u7eea\u961f\u5217\u7b49\u5f85\u8fd0\u884c\uff0c\u800c\u8fd9\u4e2a\u5c31\u7eea\u961f\u5217\u6709\u975e\u5e38\u591a\u7684\u77ed\u4f5c\u4e1a\uff0c\u90a3\u4e48\u5c31\u4f1a\u4f7f\u5f97\u957f\u4f5c\u4e1a\u4e0d\u65ad\u7684\u5f80\u540e\u63a8\uff0c\u5468\u8f6c\u65f6\u95f4\u53d8\u957f\uff0c\u81f4\u4f7f\u957f\u4f5c\u4e1a\u957f\u671f\u4e0d\u4f1a\u88ab\u8fd0\u884c\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_4","title":"\u9ad8\u54cd\u5e94\u6bd4\u4f18\u5148\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u524d\u9762\u7684\u300c\u5148\u6765\u5148\u670d\u52a1\u8c03\u5ea6\u7b97\u6cd5\u300d\u548c\u300c\u6700\u77ed\u4f5c\u4e1a\u4f18\u5148\u8c03\u5ea6\u7b97\u6cd5\u300d\u90fd\u6ca1\u6709\u5f88\u597d\u7684\u6743\u8861\u77ed\u4f5c\u4e1a\u548c\u957f\u4f5c\u4e1a\u3002</p> <p>\u90a3\u4e48\uff0c\u9ad8\u54cd\u5e94\u6bd4\u4f18\u5148 \uff08Highest Response Ratio Next, HRRN\uff09\u8c03\u5ea6\u7b97\u6cd5\u4e3b\u8981\u662f\u6743\u8861\u4e86\u77ed\u4f5c\u4e1a\u548c\u957f\u4f5c\u4e1a\u3002</p> <p>\u6bcf\u6b21\u8fdb\u884c\u8fdb\u7a0b\u8c03\u5ea6\u65f6\uff0c\u5148\u8ba1\u7b97\u300c\u54cd\u5e94\u6bd4\u4f18\u5148\u7ea7\u300d\uff0c\u7136\u540e\u628a\u300c\u54cd\u5e94\u6bd4\u4f18\u5148\u7ea7\u300d\u6700\u9ad8\u7684\u8fdb\u7a0b\u6295\u5165\u8fd0\u884c\uff0c\u300c\u54cd\u5e94\u6bd4\u4f18\u5148\u7ea7\u300d\u7684\u8ba1\u7b97\u516c\u5f0f\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684\u516c\u5f0f\uff0c\u53ef\u4ee5\u53d1\u73b0\uff1a</p> <ul> <li>\u5982\u679c\u4e24\u4e2a\u8fdb\u7a0b\u7684\u300c\u7b49\u5f85\u65f6\u95f4\u300d\u76f8\u540c\u65f6\uff0c\u300c\u8981\u6c42\u7684\u670d\u52a1\u65f6\u95f4\u300d\u8d8a\u77ed\uff0c\u300c\u54cd\u5e94\u6bd4\u300d\u5c31\u8d8a\u9ad8\uff0c\u8fd9\u6837\u77ed\u4f5c\u4e1a\u7684\u8fdb\u7a0b\u5bb9\u6613\u88ab\u9009\u4e2d\u8fd0\u884c\uff1b</li> <li>\u5982\u679c\u4e24\u4e2a\u8fdb\u7a0b\u300c\u8981\u6c42\u7684\u670d\u52a1\u65f6\u95f4\u300d\u76f8\u540c\u65f6\uff0c\u300c\u7b49\u5f85\u65f6\u95f4\u300d\u8d8a\u957f\uff0c\u300c\u54cd\u5e94\u6bd4\u300d\u5c31\u8d8a\u9ad8\uff0c\u8fd9\u5c31\u517c\u987e\u5230\u4e86\u957f\u4f5c\u4e1a\u8fdb\u7a0b\uff0c\u56e0\u4e3a\u8fdb\u7a0b\u7684\u54cd\u5e94\u6bd4\u53ef\u4ee5\u968f\u65f6\u95f4\u7b49\u5f85\u7684\u589e\u52a0\u800c\u63d0\u9ad8\uff0c\u5f53\u5176\u7b49\u5f85\u65f6\u95f4\u8db3\u591f\u957f\u65f6\uff0c\u5176\u54cd\u5e94\u6bd4\u4fbf\u53ef\u4ee5\u5347\u5230\u5f88\u9ad8\uff0c\u4ece\u800c\u83b7\u5f97\u8fd0\u884c\u7684\u673a\u4f1a\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_5","title":"\u65f6\u95f4\u7247\u8f6e\u8f6c\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u6700\u53e4\u8001\u3001\u6700\u7b80\u5355\u3001\u6700\u516c\u5e73\u4e14\u4f7f\u7528\u6700\u5e7f\u7684\u7b97\u6cd5\u5c31\u662f\u65f6\u95f4\u7247\u8f6e\u8f6c\uff08Round Robin, RR\uff09\u8c03\u5ea6\u7b97\u6cd5\u3002 \u3002</p> <p></p> <p>\u6bcf\u4e2a\u8fdb\u7a0b\u88ab\u5206\u914d\u4e00\u4e2a\u65f6\u95f4\u6bb5\uff0c\u79f0\u4e3a\u65f6\u95f4\u7247\uff08Quantum\uff09\uff0c\u5373\u5141\u8bb8\u8be5\u8fdb\u7a0b\u5728\u8be5\u65f6\u95f4\u6bb5\u4e2d\u8fd0\u884c\u3002</p> <ul> <li>\u5982\u679c\u65f6\u95f4\u7247\u7528\u5b8c\uff0c\u8fdb\u7a0b\u8fd8\u5728\u8fd0\u884c\uff0c\u90a3\u4e48\u5c06\u4f1a\u628a\u6b64\u8fdb\u7a0b\u4ece CPU \u91ca\u653e\u51fa\u6765\uff0c\u5e76\u628a CPU \u5206\u914d\u53e6\u5916\u4e00\u4e2a\u8fdb\u7a0b\uff1b</li> <li>\u5982\u679c\u8be5\u8fdb\u7a0b\u5728\u65f6\u95f4\u7247\u7ed3\u675f\u524d\u963b\u585e\u6216\u7ed3\u675f\uff0c\u5219 CPU \u7acb\u5373\u8fdb\u884c\u5207\u6362\uff1b</li> </ul> <p>\u53e6\u5916\uff0c\u65f6\u95f4\u7247\u7684\u957f\u5ea6\u5c31\u662f\u4e00\u4e2a\u5f88\u5173\u952e\u7684\u70b9\uff1a</p> <ul> <li>\u5982\u679c\u65f6\u95f4\u7247\u8bbe\u5f97\u592a\u77ed\u4f1a\u5bfc\u81f4\u8fc7\u591a\u7684\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u964d\u4f4e\u4e86 CPU \u6548\u7387\uff1b</li> <li>\u5982\u679c\u65f6\u95f4\u7247\u8bbe\u5f97\u592a\u957f\u53c8\u53ef\u80fd\u5f15\u8d77\u77ed\u4f5c\u4e1a\u8fdb\u7a0b\u7684\u54cd\u5e94\u65f6\u95f4\u53d8\u957f\uff0c\u4e0d\u5229\u4e8e\u77ed\u4f5c\u4e1a\u3002</li> </ul> <p>\u901a\u5e38\u65f6\u95f4\u7247\u8bbe\u4e3a <code>20ms~50ms</code> \u901a\u5e38\u662f\u4e00\u4e2a\u6bd4\u8f83\u5408\u7406\u7684\u6298\u4e2d\u503c\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_6","title":"\u6700\u9ad8\u4f18\u5148\u7ea7\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u524d\u9762\u7684\u300c\u65f6\u95f4\u7247\u8f6e\u8f6c\u7b97\u6cd5\u300d\u505a\u4e86\u4e2a\u5047\u8bbe\uff0c\u5373\u8ba9\u6240\u6709\u7684\u8fdb\u7a0b\u540c\u7b49\u91cd\u8981\uff0c\u4e5f\u4e0d\u504f\u8892\u8c01\uff0c\u5927\u5bb6\u7684\u8fd0\u884c\u65f6\u95f4\u90fd\u4e00\u6837\u3002</p> <p>\u4f46\u662f\uff0c\u5bf9\u4e8e\u591a\u7528\u6237\u8ba1\u7b97\u673a\u7cfb\u7edf\u5c31\u6709\u4e0d\u540c\u7684\u770b\u6cd5\u4e86\uff0c\u5b83\u4eec\u5e0c\u671b\u8c03\u5ea6\u662f\u6709\u4f18\u5148\u7ea7\u7684\uff0c\u5373\u5e0c\u671b\u8c03\u5ea6\u7a0b\u5e8f\u80fd\u4ece\u5c31\u7eea\u961f\u5217\u4e2d\u9009\u62e9\u6700\u9ad8\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u8fdb\u884c\u8fd0\u884c\uff0c\u8fd9\u79f0\u4e3a\u6700\u9ad8\u4f18\u5148\u7ea7\uff08Highest Priority First\uff0cHPF\uff09\u8c03\u5ea6\u7b97\u6cd5\u3002</p> <p>\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u53ef\u4ee5\u5206\u4e3a\uff0c\u9759\u6001\u4f18\u5148\u7ea7\u6216\u52a8\u6001\u4f18\u5148\u7ea7\uff1a</p> <ul> <li>\u9759\u6001\u4f18\u5148\u7ea7\uff1a\u521b\u5efa\u8fdb\u7a0b\u65f6\u5019\uff0c\u5c31\u5df2\u7ecf\u786e\u5b9a\u4e86\u4f18\u5148\u7ea7\u4e86\uff0c\u7136\u540e\u6574\u4e2a\u8fd0\u884c\u65f6\u95f4\u4f18\u5148\u7ea7\u90fd\u4e0d\u4f1a\u53d8\u5316\uff1b</li> <li>\u52a8\u6001\u4f18\u5148\u7ea7\uff1a\u6839\u636e\u8fdb\u7a0b\u7684\u52a8\u6001\u53d8\u5316\u8c03\u6574\u4f18\u5148\u7ea7\uff0c\u6bd4\u5982\u5982\u679c\u8fdb\u7a0b\u8fd0\u884c\u65f6\u95f4\u589e\u52a0\uff0c\u5219\u964d\u4f4e\u5176\u4f18\u5148\u7ea7\uff0c\u5982\u679c\u8fdb\u7a0b\u7b49\u5f85\u65f6\u95f4\uff08\u5c31\u7eea\u961f\u5217\u7684\u7b49\u5f85\u65f6\u95f4\uff09\u589e\u52a0\uff0c\u5219\u5347\u9ad8\u5176\u4f18\u5148\u7ea7\uff0c\u4e5f\u5c31\u662f\u968f\u7740\u65f6\u95f4\u7684\u63a8\u79fb\u589e\u52a0\u7b49\u5f85\u8fdb\u7a0b\u7684\u4f18\u5148\u7ea7\u3002</li> </ul> <p>\u8be5\u7b97\u6cd5\u4e5f\u6709\u4e24\u79cd\u5904\u7406\u4f18\u5148\u7ea7\u9ad8\u7684\u65b9\u6cd5\uff0c\u975e\u62a2\u5360\u5f0f\u548c\u62a2\u5360\u5f0f\uff1a</p> <ul> <li>\u975e\u62a2\u5360\u5f0f\uff1a\u5f53\u5c31\u7eea\u961f\u5217\u4e2d\u51fa\u73b0\u4f18\u5148\u7ea7\u9ad8\u7684\u8fdb\u7a0b\uff0c\u8fd0\u884c\u5b8c\u5f53\u524d\u8fdb\u7a0b\uff0c\u518d\u9009\u62e9\u4f18\u5148\u7ea7\u9ad8\u7684\u8fdb\u7a0b\u3002</li> <li>\u62a2\u5360\u5f0f\uff1a\u5f53\u5c31\u7eea\u961f\u5217\u4e2d\u51fa\u73b0\u4f18\u5148\u7ea7\u9ad8\u7684\u8fdb\u7a0b\uff0c\u5f53\u524d\u8fdb\u7a0b\u6302\u8d77\uff0c\u8c03\u5ea6\u4f18\u5148\u7ea7\u9ad8\u7684\u8fdb\u7a0b\u8fd0\u884c\u3002</li> </ul> <p>\u4f46\u662f\u4f9d\u7136\u6709\u7f3a\u70b9\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4f4e\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u6c38\u8fdc\u4e0d\u4f1a\u8fd0\u884c\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_7","title":"\u591a\u7ea7\u53cd\u9988\u961f\u5217\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u591a\u7ea7\u53cd\u9988\u961f\u5217\uff08Multilevel Feedback Queue\uff09\u8c03\u5ea6\u7b97\u6cd5\u662f\u300c\u65f6\u95f4\u7247\u8f6e\u8f6c\u7b97\u6cd5\u300d\u548c\u300c\u6700\u9ad8\u4f18\u5148\u7ea7\u7b97\u6cd5\u300d\u7684\u7efc\u5408\u548c\u53d1\u5c55\u3002</p> <p>\u987e\u540d\u601d\u4e49\uff1a</p> <ul> <li>\u300c\u591a\u7ea7\u300d\u8868\u793a\u6709\u591a\u4e2a\u961f\u5217\uff0c\u6bcf\u4e2a\u961f\u5217\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u4f4e\uff0c\u540c\u65f6\u4f18\u5148\u7ea7\u8d8a\u9ad8\u65f6\u95f4\u7247\u8d8a\u77ed\u3002</li> <li>\u300c\u53cd\u9988\u300d\u8868\u793a\u5982\u679c\u6709\u65b0\u7684\u8fdb\u7a0b\u52a0\u5165\u4f18\u5148\u7ea7\u9ad8\u7684\u961f\u5217\u65f6\uff0c\u7acb\u523b\u505c\u6b62\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u8fdb\u7a0b\uff0c\u8f6c\u800c\u53bb\u8fd0\u884c\u4f18\u5148\u7ea7\u9ad8\u7684\u961f\u5217\uff1b</li> </ul> <p></p> <p>\u6765\u770b\u770b\uff0c\u5b83\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1a</p> <ul> <li>\u8bbe\u7f6e\u4e86\u591a\u4e2a\u961f\u5217\uff0c\u8d4b\u4e88\u6bcf\u4e2a\u961f\u5217\u4e0d\u540c\u7684\u4f18\u5148\u7ea7\uff0c\u6bcf\u4e2a\u961f\u5217\u4f18\u5148\u7ea7\u4ece\u9ad8\u5230\u4f4e\uff0c\u540c\u65f6\u4f18\u5148\u7ea7\u8d8a\u9ad8\u65f6\u95f4\u7247\u8d8a\u77ed\uff1b</li> <li>\u65b0\u7684\u8fdb\u7a0b\u4f1a\u88ab\u653e\u5165\u5230\u7b2c\u4e00\u7ea7\u961f\u5217\u7684\u672b\u5c3e\uff0c\u6309\u5148\u6765\u5148\u670d\u52a1\u7684\u539f\u5219\u6392\u961f\u7b49\u5f85\u88ab\u8c03\u5ea6\uff0c\u5982\u679c\u5728\u7b2c\u4e00\u7ea7\u961f\u5217\u89c4\u5b9a\u7684\u65f6\u95f4\u7247\u6ca1\u8fd0\u884c\u5b8c\u6210\uff0c\u5219\u5c06\u5176\u8f6c\u5165\u5230\u7b2c\u4e8c\u7ea7\u961f\u5217\u7684\u672b\u5c3e\uff0c\u4ee5\u6b64\u7c7b\u63a8\uff0c\u76f4\u81f3\u5b8c\u6210\uff1b</li> <li>\u5f53\u8f83\u9ad8\u4f18\u5148\u7ea7\u7684\u961f\u5217\u4e3a\u7a7a\uff0c\u624d\u8c03\u5ea6\u8f83\u4f4e\u4f18\u5148\u7ea7\u7684\u961f\u5217\u4e2d\u7684\u8fdb\u7a0b\u8fd0\u884c\u3002\u5982\u679c\u8fdb\u7a0b\u8fd0\u884c\u65f6\uff0c\u6709\u65b0\u8fdb\u7a0b\u8fdb\u5165\u8f83\u9ad8\u4f18\u5148\u7ea7\u7684\u961f\u5217\uff0c\u5219\u505c\u6b62\u5f53\u524d\u8fd0\u884c\u7684\u8fdb\u7a0b\u5e76\u5c06\u5176\u79fb\u5165\u5230\u539f\u961f\u5217\u672b\u5c3e\uff0c\u63a5\u7740\u8ba9\u8f83\u9ad8\u4f18\u5148\u7ea7\u7684\u8fdb\u7a0b\u8fd0\u884c\uff1b</li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u5bf9\u4e8e\u77ed\u4f5c\u4e1a\u53ef\u80fd\u53ef\u4ee5\u5728\u7b2c\u4e00\u7ea7\u961f\u5217\u5f88\u5feb\u88ab\u5904\u7406\u5b8c\u3002\u5bf9\u4e8e\u957f\u4f5c\u4e1a\uff0c\u5982\u679c\u5728\u7b2c\u4e00\u7ea7\u961f\u5217\u5904\u7406\u4e0d\u5b8c\uff0c\u53ef\u4ee5\u79fb\u5165\u4e0b\u6b21\u961f\u5217\u7b49\u5f85\u88ab\u6267\u884c\uff0c\u867d\u7136\u7b49\u5f85\u7684\u65f6\u95f4\u53d8\u957f\u4e86\uff0c\u4f46\u662f\u8fd0\u884c\u65f6\u95f4\u4e5f\u4f1a\u66f4\u957f\u4e86\uff0c\u6240\u4ee5\u8be5\u7b97\u6cd5\u5f88\u597d\u7684\u517c\u987e\u4e86\u957f\u77ed\u4f5c\u4e1a\uff0c\u540c\u65f6\u6709\u8f83\u597d\u7684\u54cd\u5e94\u65f6\u95f4\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_8","title":"\u5185\u5b58\u9875\u9762\u7f6e\u6362\u7b97\u6cd5","text":"<p>\u5728\u4e86\u89e3\u5185\u5b58\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u524d\uff0c\u6211\u4eec\u5f97\u5148\u8c08\u4e00\u4e0b\u7f3a\u9875\u5f02\u5e38\uff08\u7f3a\u9875\u4e2d\u65ad\uff09\u3002</p> <p>\u5f53 CPU \u8bbf\u95ee\u7684\u9875\u9762\u4e0d\u5728\u7269\u7406\u5185\u5b58\u65f6\uff0c\u4fbf\u4f1a\u4ea7\u751f\u4e00\u4e2a\u7f3a\u9875\u4e2d\u65ad\uff0c\u8bf7\u6c42\u64cd\u4f5c\u7cfb\u7edf\u5c06\u6240\u7f3a\u9875\u8c03\u5165\u5230\u7269\u7406\u5185\u5b58\u3002\u90a3\u5b83\u4e0e\u4e00\u822c\u4e2d\u65ad\u7684\u4e3b\u8981\u533a\u522b\u5728\u4e8e\uff1a</p> <ul> <li>\u7f3a\u9875\u4e2d\u65ad\u5728\u6307\u4ee4\u6267\u884c\u300c\u671f\u95f4\u300d\u4ea7\u751f\u548c\u5904\u7406\u4e2d\u65ad\u4fe1\u53f7\uff0c\u800c\u4e00\u822c\u4e2d\u65ad\u5728\u4e00\u6761\u6307\u4ee4\u6267\u884c\u300c\u5b8c\u6210\u300d\u540e\u68c0\u67e5\u548c\u5904\u7406\u4e2d\u65ad\u4fe1\u53f7\u3002</li> <li>\u7f3a\u9875\u4e2d\u65ad\u8fd4\u56de\u5230\u8be5\u6307\u4ee4\u7684\u5f00\u59cb\u91cd\u65b0\u6267\u884c\u300c\u8be5\u6307\u4ee4\u300d\uff0c\u800c\u4e00\u822c\u4e2d\u65ad\u8fd4\u56de\u56de\u5230\u8be5\u6307\u4ee4\u7684\u300c\u4e0b\u4e00\u4e2a\u6307\u4ee4\u300d\u6267\u884c\u3002</li> </ul> <p>\u6211\u4eec\u6765\u770b\u4e00\u4e0b\u7f3a\u9875\u4e2d\u65ad\u7684\u5904\u7406\u6d41\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <ol> <li>\u5728 CPU \u91cc\u8bbf\u95ee\u4e00\u6761 Load M \u6307\u4ee4\uff0c\u7136\u540e CPU \u4f1a\u53bb\u627e M \u6240\u5bf9\u5e94\u7684\u9875\u8868\u9879\u3002</li> <li>\u5982\u679c\u8be5\u9875\u8868\u9879\u7684\u72b6\u6001\u4f4d\u662f\u300c\u6709\u6548\u7684\u300d\uff0c\u90a3 CPU \u5c31\u53ef\u4ee5\u76f4\u63a5\u53bb\u8bbf\u95ee\u7269\u7406\u5185\u5b58\u4e86\uff0c\u5982\u679c\u72b6\u6001\u4f4d\u662f\u300c\u65e0\u6548\u7684\u300d\uff0c\u5219 CPU \u5219\u4f1a\u53d1\u9001\u7f3a\u9875\u4e2d\u65ad\u8bf7\u6c42\u3002</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u6536\u5230\u4e86\u7f3a\u9875\u4e2d\u65ad\uff0c\u5219\u4f1a\u6267\u884c\u7f3a\u9875\u4e2d\u65ad\u5904\u7406\u51fd\u6570\uff0c\u5148\u4f1a\u67e5\u627e\u8be5\u9875\u9762\u5728\u78c1\u76d8\u4e2d\u7684\u9875\u9762\u7684\u4f4d\u7f6e\u3002</li> <li>\u627e\u5230\u78c1\u76d8\u4e2d\u5bf9\u5e94\u7684\u9875\u9762\u540e\uff0c\u9700\u8981\u628a\u8be5\u9875\u9762\u6362\u5165\u5230\u7269\u7406\u5185\u5b58\u4e2d\uff0c\u4f46\u662f\u5728\u6362\u5165\u524d\uff0c\u9700\u8981\u5728\u7269\u7406\u5185\u5b58\u4e2d\u627e\u7a7a\u95f2\u9875\uff0c\u5982\u679c\u627e\u5230\u7a7a\u95f2\u9875\uff0c\u5c31\u628a\u9875\u9762\u6362\u5165\u5230\u7269\u7406\u5185\u5b58\u4e2d\u3002</li> <li>\u9875\u9762\u4ece\u78c1\u76d8\u6362\u5165\u5230\u7269\u7406\u5185\u5b58\u5b8c\u6210\u540e\uff0c\u5219\u628a\u9875\u8868\u9879\u4e2d\u7684\u72b6\u6001\u4f4d\u4fee\u6539\u4e3a\u300c\u6709\u6548\u7684\u300d\u3002</li> <li>\u6700\u540e\uff0cCPU \u91cd\u65b0\u6267\u884c\u5bfc\u81f4\u7f3a\u9875\u5f02\u5e38\u7684\u6307\u4ee4\u3002</li> </ol> <p>\u4e0a\u9762\u6240\u8bf4\u7684\u8fc7\u7a0b\uff0c\u7b2c 4 \u6b65\u662f\u80fd\u5728\u7269\u7406\u5185\u5b58\u627e\u5230\u7a7a\u95f2\u9875\u7684\u60c5\u51b5\uff0c\u90a3\u5982\u679c\u627e\u4e0d\u5230\u5462\uff1f</p> <p>\u627e\u4e0d\u5230\u7a7a\u95f2\u9875\u7684\u8bdd\uff0c\u5c31\u8bf4\u660e\u6b64\u65f6\u5185\u5b58\u5df2\u6ee1\u4e86\uff0c\u8fd9\u65f6\u5019\uff0c\u5c31\u9700\u8981\u300c\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u300d\u9009\u62e9\u4e00\u4e2a\u7269\u7406\u9875\uff0c\u5982\u679c\u8be5\u7269\u7406\u9875\u6709\u88ab\u4fee\u6539\u8fc7\uff08\u810f\u9875\uff09\uff0c\u5219\u628a\u5b83\u6362\u51fa\u5230\u78c1\u76d8\uff0c\u7136\u540e\u628a\u8be5\u88ab\u7f6e\u6362\u51fa\u53bb\u7684\u9875\u8868\u9879\u7684\u72b6\u6001\u6539\u6210\u300c\u65e0\u6548\u7684\u300d\uff0c\u6700\u540e\u628a\u6b63\u5728\u8bbf\u95ee\u7684\u9875\u9762\u88c5\u5165\u5230\u8fd9\u4e2a\u7269\u7406\u9875\u4e2d\u3002</p> <p>\u8fd9\u91cc\u63d0\u4e00\u4e0b\uff0c\u9875\u8868\u9879\u901a\u5e38\u6709\u5982\u4e0b\u56fe\u7684\u5b57\u6bb5\uff1a</p> <p></p> <p>\u90a3\u5176\u4e2d\uff1a</p> <ul> <li>\u72b6\u6001\u4f4d\uff1a\u7528\u4e8e\u8868\u793a\u8be5\u9875\u662f\u5426\u6709\u6548\uff0c\u4e5f\u5c31\u662f\u8bf4\u662f\u5426\u5728\u7269\u7406\u5185\u5b58\u4e2d\uff0c\u4f9b\u7a0b\u5e8f\u8bbf\u95ee\u65f6\u53c2\u8003\u3002</li> <li>\u8bbf\u95ee\u5b57\u6bb5\uff1a\u7528\u4e8e\u8bb0\u5f55\u8be5\u9875\u5728\u4e00\u6bb5\u65f6\u95f4\u88ab\u8bbf\u95ee\u7684\u6b21\u6570\uff0c\u4f9b\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u9009\u62e9\u51fa\u9875\u9762\u65f6\u53c2\u8003\u3002</li> <li>\u4fee\u6539\u4f4d\uff1a\u8868\u793a\u8be5\u9875\u5728\u8c03\u5165\u5185\u5b58\u540e\u662f\u5426\u6709\u88ab\u4fee\u6539\u8fc7\uff0c\u7531\u4e8e\u5185\u5b58\u4e2d\u7684\u6bcf\u4e00\u9875\u90fd\u5728\u78c1\u76d8\u4e0a\u4fdd\u7559\u4e00\u4efd\u526f\u672c\uff0c\u56e0\u6b64\uff0c\u5982\u679c\u6ca1\u6709\u4fee\u6539\uff0c\u5728\u7f6e\u6362\u8be5\u9875\u65f6\u5c31\u4e0d\u9700\u8981\u5c06\u8be5\u9875\u5199\u56de\u5230\u78c1\u76d8\u4e0a\uff0c\u4ee5\u51cf\u5c11\u7cfb\u7edf\u7684\u5f00\u9500\uff1b\u5982\u679c\u5df2\u7ecf\u88ab\u4fee\u6539\uff0c\u5219\u5c06\u8be5\u9875\u91cd\u5199\u5230\u78c1\u76d8\u4e0a\uff0c\u4ee5\u4fdd\u8bc1\u78c1\u76d8\u4e2d\u6240\u4fdd\u7559\u7684\u59cb\u7ec8\u662f\u6700\u65b0\u7684\u526f\u672c\u3002</li> <li>\u786c\u76d8\u5730\u5740\uff1a\u7528\u4e8e\u6307\u51fa\u8be5\u9875\u5728\u786c\u76d8\u4e0a\u7684\u5730\u5740\uff0c\u901a\u5e38\u662f\u7269\u7406\u5757\u53f7\uff0c\u4f9b\u8c03\u5165\u8be5\u9875\u65f6\u4f7f\u7528\u3002</li> </ul> <p>\u8fd9\u91cc\u6211\u6574\u7406\u4e86\u865a\u62df\u5185\u5b58\u7684\u7ba1\u7406\u6574\u4e2a\u6d41\u7a0b\uff0c\u4f60\u53ef\u4ee5\u4ece\u4e0b\u9762\u8fd9\u5f20\u56fe\u770b\u5230\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u7684\u529f\u80fd\u662f\uff0c\u5f53\u51fa\u73b0\u7f3a\u9875\u5f02\u5e38\uff0c\u9700\u8c03\u5165\u65b0\u9875\u9762\u800c\u5185\u5b58\u5df2\u6ee1\u65f6\uff0c\u9009\u62e9\u88ab\u7f6e\u6362\u7684\u7269\u7406\u9875\u9762\uff0c\u4e5f\u5c31\u662f\u8bf4\u9009\u62e9\u4e00\u4e2a\u7269\u7406\u9875\u9762\u6362\u51fa\u5230\u78c1\u76d8\uff0c\u7136\u540e\u628a\u9700\u8981\u8bbf\u95ee\u7684\u9875\u9762\u6362\u5165\u5230\u7269\u7406\u9875\u3002</p> <p>\u90a3\u5176\u7b97\u6cd5\u76ee\u6807\u5219\u662f\uff0c\u5c3d\u53ef\u80fd\u51cf\u5c11\u9875\u9762\u7684\u6362\u5165\u6362\u51fa\u7684\u6b21\u6570\uff0c\u5e38\u89c1\u7684\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u6709\u5982\u4e0b\u51e0\u79cd\uff1a</p> <ul> <li>\u6700\u4f73\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\uff08OPT\uff09</li> <li>\u5148\u8fdb\u5148\u51fa\u7f6e\u6362\u7b97\u6cd5\uff08FIFO\uff09</li> <li>\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u7f6e\u6362\u7b97\u6cd5\uff08LRU\uff09</li> <li>\u65f6\u949f\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\uff08Lock\uff09</li> <li>\u6700\u4e0d\u5e38\u7528\u7f6e\u6362\u7b97\u6cd5\uff08LFU\uff09</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_9","title":"\u6700\u4f73\u9875\u9762\u7f6e\u6362\u7b97\u6cd5","text":"<p>\u6700\u4f73\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u57fa\u672c\u601d\u8def\u662f\uff0c\u7f6e\u6362\u5728\u300c\u672a\u6765\u300d\u6700\u957f\u65f6\u95f4\u4e0d\u8bbf\u95ee\u7684\u9875\u9762\u3002</p> <p>\u6240\u4ee5\uff0c\u8be5\u7b97\u6cd5\u5b9e\u73b0\u9700\u8981\u8ba1\u7b97\u5185\u5b58\u4e2d\u6bcf\u4e2a\u903b\u8f91\u9875\u9762\u7684\u300c\u4e0b\u4e00\u6b21\u300d\u8bbf\u95ee\u65f6\u95f4\uff0c\u7136\u540e\u6bd4\u8f83\uff0c\u9009\u62e9\u672a\u6765\u6700\u957f\u65f6\u95f4\u4e0d\u8bbf\u95ee\u7684\u9875\u9762\u3002</p> <p>\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4e00\u5f00\u59cb\u6709 3 \u4e2a\u7a7a\u95f2\u7684\u7269\u7406\u9875\uff0c\u7136\u540e\u6709\u8bf7\u6c42\u7684\u9875\u9762\u5e8f\u5217\uff0c\u90a3\u5b83\u7684\u7f6e\u6362\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5728\u8fd9\u4e2a\u8bf7\u6c42\u7684\u9875\u9762\u5e8f\u5217\u4e2d\uff0c\u7f3a\u9875\u5171\u53d1\u751f\u4e86 <code>7</code> \u6b21\uff08\u7a7a\u95f2\u9875\u6362\u5165 3 \u6b21 + \u6700\u4f18\u9875\u9762\u7f6e\u6362 4 \u6b21\uff09\uff0c\u9875\u9762\u7f6e\u6362\u5171\u53d1\u751f\u4e86 <code>4</code> \u6b21\u3002</p> <p>\u8fd9\u5f88\u7406\u60f3\uff0c\u4f46\u662f\u5b9e\u9645\u7cfb\u7edf\u4e2d\u65e0\u6cd5\u5b9e\u73b0\uff0c\u56e0\u4e3a\u7a0b\u5e8f\u8bbf\u95ee\u9875\u9762\u65f6\u662f\u52a8\u6001\u7684\uff0c\u6211\u4eec\u662f\u65e0\u6cd5\u9884\u77e5\u6bcf\u4e2a\u9875\u9762\u5728\u300c\u4e0b\u4e00\u6b21\u300d\u8bbf\u95ee\u524d\u7684\u7b49\u5f85\u65f6\u95f4\u3002</p> <p>\u6240\u4ee5\uff0c\u6700\u4f73\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u4f5c\u7528\u662f\u4e3a\u4e86\u8861\u91cf\u4f60\u7684\u7b97\u6cd5\u7684\u6548\u7387\uff0c\u4f60\u7684\u7b97\u6cd5\u6548\u7387\u8d8a\u63a5\u8fd1\u8be5\u7b97\u6cd5\u7684\u6548\u7387\uff0c\u90a3\u4e48\u8bf4\u660e\u4f60\u7684\u7b97\u6cd5\u662f\u9ad8\u6548\u7684\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_10","title":"\u5148\u8fdb\u5148\u51fa\u7f6e\u6362\u7b97\u6cd5","text":"<p>\u65e2\u7136\u6211\u4eec\u65e0\u6cd5\u9884\u77e5\u9875\u9762\u5728\u4e0b\u4e00\u6b21\u8bbf\u95ee\u524d\u6240\u9700\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u90a3\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u5728\u5185\u5b58\u9a7b\u7559\u65f6\u95f4\u5f88\u957f\u7684\u9875\u9762\u8fdb\u884c\u4e2d\u7f6e\u6362\uff0c\u8fd9\u4e2a\u5c31\u662f\u300c\u5148\u8fdb\u5148\u51fa\u7f6e\u6362\u300d\u7b97\u6cd5\u7684\u601d\u60f3\u3002</p> <p>\u8fd8\u662f\u4ee5\u524d\u9762\u7684\u8bf7\u6c42\u7684\u9875\u9762\u5e8f\u5217\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4f7f\u7528\u5148\u8fdb\u5148\u51fa\u7f6e\u6362\u7b97\u6cd5\uff0c\u5219\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5728\u8fd9\u4e2a\u8bf7\u6c42\u7684\u9875\u9762\u5e8f\u5217\u4e2d\uff0c\u7f3a\u9875\u5171\u53d1\u751f\u4e86 <code>10</code> \u6b21\uff0c\u9875\u9762\u7f6e\u6362\u5171\u53d1\u751f\u4e86 <code>7</code> \u6b21\uff0c\u8ddf\u6700\u4f73\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u6bd4\u8f83\u8d77\u6765\uff0c\u6027\u80fd\u660e\u663e\u5dee\u4e86\u5f88\u591a\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_11","title":"\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u7f6e\u6362\u7b97\u6cd5","text":"<p>\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\uff08LRU\uff09\u7684\u7f6e\u6362\u7b97\u6cd5\u7684\u57fa\u672c\u601d\u8def\u662f\uff0c\u53d1\u751f\u7f3a\u9875\u65f6\uff0c\u9009\u62e9\u6700\u957f\u65f6\u95f4\u6ca1\u6709\u88ab\u8bbf\u95ee\u7684\u9875\u9762\u8fdb\u884c\u7f6e\u6362\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8be5\u7b97\u6cd5\u5047\u8bbe\u5df2\u7ecf\u5f88\u4e45\u6ca1\u6709\u4f7f\u7528\u7684\u9875\u9762\u5f88\u6709\u53ef\u80fd\u5728\u672a\u6765\u8f83\u957f\u7684\u4e00\u6bb5\u65f6\u95f4\u5185\u4ecd\u7136\u4e0d\u4f1a\u88ab\u4f7f\u7528\u3002</p> <p>\u8fd9\u79cd\u7b97\u6cd5\u8fd1\u4f3c\u6700\u4f18\u7f6e\u6362\u7b97\u6cd5\uff0c\u6700\u4f18\u7f6e\u6362\u7b97\u6cd5\u662f\u901a\u8fc7\u300c\u672a\u6765\u300d\u7684\u4f7f\u7528\u60c5\u51b5\u6765\u63a8\u6d4b\u8981\u6dd8\u6c70\u7684\u9875\u9762\uff0c\u800c LRU \u5219\u662f\u901a\u8fc7\u300c\u5386\u53f2\u300d\u7684\u4f7f\u7528\u60c5\u51b5\u6765\u63a8\u6d4b\u8981\u6dd8\u6c70\u7684\u9875\u9762\u3002</p> <p>\u8fd8\u662f\u4ee5\u524d\u9762\u7684\u8bf7\u6c42\u7684\u9875\u9762\u5e8f\u5217\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u5047\u8bbe\u4f7f\u7528\u6700\u8fd1\u6700\u4e45\u672a\u4f7f\u7528\u7684\u7f6e\u6362\u7b97\u6cd5\uff0c\u5219\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5728\u8fd9\u4e2a\u8bf7\u6c42\u7684\u9875\u9762\u5e8f\u5217\u4e2d\uff0c\u7f3a\u9875\u5171\u53d1\u751f\u4e86 <code>9</code> \u6b21\uff0c\u9875\u9762\u7f6e\u6362\u5171\u53d1\u751f\u4e86 <code>6</code> \u6b21\uff0c\u8ddf\u5148\u8fdb\u5148\u51fa\u7f6e\u6362\u7b97\u6cd5\u6bd4\u8f83\u8d77\u6765\uff0c\u6027\u80fd\u63d0\u9ad8\u4e86\u4e00\u4e9b\u3002</p> <p>\u867d\u7136 LRU \u5728\u7406\u8bba\u4e0a\u662f\u53ef\u4ee5\u5b9e\u73b0\u7684\uff0c\u4f46\u4ee3\u4ef7\u5f88\u9ad8\u3002\u4e3a\u4e86\u5b8c\u5168\u5b9e\u73b0 LRU\uff0c\u9700\u8981\u5728\u5185\u5b58\u4e2d\u7ef4\u62a4\u4e00\u4e2a\u6240\u6709\u9875\u9762\u7684\u94fe\u8868\uff0c\u6700\u8fd1\u6700\u591a\u4f7f\u7528\u7684\u9875\u9762\u5728\u8868\u5934\uff0c\u6700\u8fd1\u6700\u5c11\u4f7f\u7528\u7684\u9875\u9762\u5728\u8868\u5c3e\u3002</p> <p>\u56f0\u96be\u7684\u662f\uff0c\u5728\u6bcf\u6b21\u8bbf\u95ee\u5185\u5b58\u65f6\u90fd\u5fc5\u987b\u8981\u66f4\u65b0\u300c\u6574\u4e2a\u94fe\u8868\u300d\u3002\u5728\u94fe\u8868\u4e2d\u627e\u5230\u4e00\u4e2a\u9875\u9762\uff0c\u5220\u9664\u5b83\uff0c\u7136\u540e\u628a\u5b83\u79fb\u52a8\u5230\u8868\u5934\u662f\u4e00\u4e2a\u975e\u5e38\u8d39\u65f6\u7684\u64cd\u4f5c\u3002</p> <p>\u6240\u4ee5\uff0cLRU \u867d\u7136\u770b\u4e0a\u53bb\u4e0d\u9519\uff0c\u4f46\u662f\u7531\u4e8e\u5f00\u9500\u6bd4\u8f83\u5927\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\u6bd4\u8f83\u5c11\u4f7f\u7528\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_12","title":"\u65f6\u949f\u9875\u9762\u7f6e\u6362\u7b97\u6cd5","text":"<p>\u90a3\u6709\u6ca1\u6709\u4e00\u79cd\u5373\u80fd\u4f18\u5316\u7f6e\u6362\u7684\u6b21\u6570\uff0c\u4e5f\u80fd\u65b9\u4fbf\u5b9e\u73b0\u7684\u7b97\u6cd5\u5462\uff1f</p> <p>\u65f6\u949f\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u5c31\u53ef\u4ee5\u4e24\u8005\u517c\u5f97\uff0c\u5b83\u8ddf LRU \u8fd1\u4f3c\uff0c\u53c8\u662f\u5bf9 FIFO \u7684\u4e00\u79cd\u6539\u8fdb\u3002</p> <p>\u8be5\u7b97\u6cd5\u7684\u601d\u8def\u662f\uff0c\u628a\u6240\u6709\u7684\u9875\u9762\u90fd\u4fdd\u5b58\u5728\u4e00\u4e2a\u7c7b\u4f3c\u949f\u9762\u7684\u300c\u73af\u5f62\u94fe\u8868\u300d\u4e2d\uff0c\u4e00\u4e2a\u8868\u9488\u6307\u5411\u6700\u8001\u7684\u9875\u9762\u3002</p> <p>\u5f53\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\u65f6\uff0c\u7b97\u6cd5\u9996\u5148\u68c0\u67e5\u8868\u9488\u6307\u5411\u7684\u9875\u9762\uff1a</p> <ul> <li>\u5982\u679c\u5b83\u7684\u8bbf\u95ee\u4f4d\u4f4d\u662f 0 \u5c31\u6dd8\u6c70\u8be5\u9875\u9762\uff0c\u5e76\u628a\u65b0\u7684\u9875\u9762\u63d2\u5165\u8fd9\u4e2a\u4f4d\u7f6e\uff0c\u7136\u540e\u628a\u8868\u9488\u524d\u79fb\u4e00\u4e2a\u4f4d\u7f6e\uff1b</li> <li>\u5982\u679c\u8bbf\u95ee\u4f4d\u662f 1 \u5c31\u6e05\u9664\u8bbf\u95ee\u4f4d\uff0c\u5e76\u628a\u8868\u9488\u524d\u79fb\u4e00\u4e2a\u4f4d\u7f6e\uff0c\u91cd\u590d\u8fd9\u4e2a\u8fc7\u7a0b\u76f4\u5230\u627e\u5230\u4e86\u4e00\u4e2a\u8bbf\u95ee\u4f4d\u4e3a 0 \u7684\u9875\u9762\u4e3a\u6b62\uff1b</li> </ul> <p>\u6211\u753b\u4e86\u4e00\u526f\u65f6\u949f\u9875\u9762\u7f6e\u6362\u7b97\u6cd5\u7684\u5de5\u4f5c\u6d41\u7a0b\u56fe\uff0c\u4f60\u53ef\u4ee5\u5728\u4e0b\u65b9\u770b\u5230\uff1a</p> <p></p> <p>\u4e86\u89e3\u4e86\u8fd9\u4e2a\u7b97\u6cd5\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u5c31\u660e\u767d\u4e3a\u4ec0\u4e48\u5b83\u88ab\u79f0\u4e3a\u65f6\u949f\uff08Clock\uff09\u7b97\u6cd5\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_13","title":"\u6700\u4e0d\u5e38\u7528\u7b97\u6cd5","text":"<p>\u6700\u4e0d\u5e38\u7528\uff08LFU\uff09\u7b97\u6cd5\uff0c\u8fd9\u540d\u5b57\u542c\u8d77\u6765\u5f88\u8c03\u76ae\uff0c\u4f46\u662f\u5b83\u7684\u610f\u601d\u4e0d\u662f\u6307\u8fd9\u4e2a\u7b97\u6cd5\u4e0d\u5e38\u7528\uff0c\u800c\u662f\u5f53\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\u65f6\uff0c\u9009\u62e9\u300c\u8bbf\u95ee\u6b21\u6570\u300d\u6700\u5c11\u7684\u90a3\u4e2a\u9875\u9762\uff0c\u5e76\u5c06\u5176\u6dd8\u6c70\u3002</p> <p>\u5b83\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\uff0c\u5bf9\u6bcf\u4e2a\u9875\u9762\u8bbe\u7f6e\u4e00\u4e2a\u300c\u8bbf\u95ee\u8ba1\u6570\u5668\u300d\uff0c\u6bcf\u5f53\u4e00\u4e2a\u9875\u9762\u88ab\u8bbf\u95ee\u65f6\uff0c\u8be5\u9875\u9762\u7684\u8bbf\u95ee\u8ba1\u6570\u5668\u5c31\u7d2f\u52a0 1\u3002\u5728\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\u65f6\uff0c\u6dd8\u6c70\u8ba1\u6570\u5668\u503c\u6700\u5c0f\u7684\u90a3\u4e2a\u9875\u9762\u3002</p> <p>\u770b\u8d77\u6765\u5f88\u7b80\u5355\uff0c\u6bcf\u4e2a\u9875\u9762\u52a0\u4e00\u4e2a\u8ba1\u6570\u5668\u5c31\u53ef\u4ee5\u5b9e\u73b0\u4e86\uff0c\u4f46\u662f\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u5b9e\u73b0\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u8003\u8651\u6548\u7387\u548c\u786c\u4ef6\u6210\u672c\u7684\u3002</p> <p>\u8981\u589e\u52a0\u4e00\u4e2a\u8ba1\u6570\u5668\u6765\u5b9e\u73b0\uff0c\u8fd9\u4e2a\u786c\u4ef6\u6210\u672c\u662f\u6bd4\u8f83\u9ad8\u7684\uff0c\u53e6\u5916\u5982\u679c\u8981\u5bf9\u8fd9\u4e2a\u8ba1\u6570\u5668\u67e5\u627e\u54ea\u4e2a\u9875\u9762\u8bbf\u95ee\u6b21\u6570\u6700\u5c0f\uff0c\u67e5\u627e\u94fe\u8868\u672c\u8eab\uff0c\u5982\u679c\u94fe\u8868\u957f\u5ea6\u5f88\u5927\uff0c\u662f\u975e\u5e38\u8017\u65f6\u7684\uff0c\u6548\u7387\u4e0d\u9ad8\u3002</p> <p>\u4f46\u8fd8\u6709\u4e2a\u95ee\u9898\uff0cLFU \u7b97\u6cd5\u53ea\u8003\u8651\u4e86\u9891\u7387\u95ee\u9898\uff0c\u6ca1\u8003\u8651\u65f6\u95f4\u7684\u95ee\u9898\uff0c\u6bd4\u5982\u6709\u4e9b\u9875\u9762\u5728\u8fc7\u53bb\u65f6\u95f4\u91cc\u8bbf\u95ee\u7684\u9891\u7387\u5f88\u9ad8\uff0c\u4f46\u662f\u73b0\u5728\u5df2\u7ecf\u6ca1\u6709\u8bbf\u95ee\u4e86\uff0c\u800c\u5f53\u524d\u9891\u7e41\u8bbf\u95ee\u7684\u9875\u9762\u7531\u4e8e\u6ca1\u6709\u8fd9\u4e9b\u9875\u9762\u8bbf\u95ee\u7684\u6b21\u6570\u9ad8\uff0c\u5728\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\u65f6\uff0c\u5c31\u4f1a\u53ef\u80fd\u4f1a\u8bef\u4f24\u5f53\u524d\u521a\u5f00\u59cb\u9891\u7e41\u8bbf\u95ee\uff0c\u4f46\u8bbf\u95ee\u6b21\u6570\u8fd8\u4e0d\u9ad8\u7684\u9875\u9762\u3002</p> <p>\u90a3\u8fd9\u4e2a\u95ee\u9898\u7684\u89e3\u51b3\u7684\u529e\u6cd5\u8fd8\u662f\u6709\u7684\uff0c\u53ef\u4ee5\u5b9a\u671f\u51cf\u5c11\u8bbf\u95ee\u7684\u6b21\u6570\uff0c\u6bd4\u5982\u5f53\u53d1\u751f\u65f6\u95f4\u4e2d\u65ad\u65f6\uff0c\u628a\u8fc7\u53bb\u65f6\u95f4\u8bbf\u95ee\u7684\u9875\u9762\u7684\u8bbf\u95ee\u6b21\u6570\u9664\u4ee5 2\uff0c\u4e5f\u5c31\u8bf4\uff0c\u968f\u7740\u65f6\u95f4\u7684\u6d41\u5931\uff0c\u4ee5\u524d\u7684\u9ad8\u8bbf\u95ee\u6b21\u6570\u7684\u9875\u9762\u4f1a\u6162\u6162\u51cf\u5c11\uff0c\u76f8\u5f53\u4e8e\u52a0\u5927\u4e86\u88ab\u7f6e\u6362\u7684\u6982\u7387\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_14","title":"\u78c1\u76d8\u8c03\u5ea6\u7b97\u6cd5","text":"<p>\u6211\u4eec\u6765\u770b\u770b\u78c1\u76d8\u7684\u7ed3\u6784\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5e38\u89c1\u7684\u673a\u68b0\u78c1\u76d8\u662f\u4e0a\u56fe\u5de6\u8fb9\u7684\u6837\u5b50\uff0c\u4e2d\u95f4\u5706\u7684\u90e8\u5206\u662f\u78c1\u76d8\u7684\u76d8\u7247\uff0c\u4e00\u822c\u4f1a\u6709\u591a\u4e2a\u76d8\u7247\uff0c\u6bcf\u4e2a\u76d8\u9762\u90fd\u6709\u81ea\u5df1\u7684\u78c1\u5934\u3002\u53f3\u8fb9\u7684\u56fe\u5c31\u662f\u4e00\u4e2a\u76d8\u7247\u7684\u7ed3\u6784\uff0c\u76d8\u7247\u4e2d\u7684\u6bcf\u4e00\u5c42\u5206\u4e3a\u591a\u4e2a\u78c1\u9053\uff0c\u6bcf\u4e2a\u78c1\u9053\u5206\u591a\u4e2a\u6247\u533a\uff0c\u6bcf\u4e2a\u6247\u533a\u662f <code>512</code> \u5b57\u8282\u3002\u90a3\u4e48\uff0c\u591a\u4e2a\u5177\u6709\u76f8\u540c\u7f16\u53f7\u7684\u78c1\u9053\u5f62\u6210\u4e00\u4e2a\u5706\u67f1\uff0c\u79f0\u4e4b\u4e3a\u78c1\u76d8\u7684\u67f1\u9762\uff0c\u5982\u4e0a\u56fe\u91cc\u4e2d\u95f4\u7684\u6837\u5b50\u3002</p> <p>\u78c1\u76d8\u8c03\u5ea6\u7b97\u6cd5\u7684\u76ee\u7684\u5f88\u7b80\u5355\uff0c\u5c31\u662f\u4e3a\u4e86\u63d0\u9ad8\u78c1\u76d8\u7684\u8bbf\u95ee\u6027\u80fd\uff0c\u4e00\u822c\u662f\u901a\u8fc7\u4f18\u5316\u78c1\u76d8\u7684\u8bbf\u95ee\u8bf7\u6c42\u987a\u5e8f\u6765\u505a\u5230\u7684\u3002</p> <p>\u5bfb\u9053\u7684\u65f6\u95f4\u662f\u78c1\u76d8\u8bbf\u95ee\u6700\u8017\u65f6\u7684\u90e8\u5206\uff0c\u5982\u679c\u8bf7\u6c42\u987a\u5e8f\u4f18\u5316\u7684\u5f97\u5f53\uff0c\u5fc5\u7136\u53ef\u4ee5\u8282\u7701\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u5bfb\u9053\u65f6\u95f4\uff0c\u4ece\u800c\u63d0\u9ad8\u78c1\u76d8\u7684\u8bbf\u95ee\u6027\u80fd\u3002</p> <p>\u5047\u8bbe\u6709\u4e0b\u9762\u4e00\u4e2a\u8bf7\u6c42\u5e8f\u5217\uff0c\u6bcf\u4e2a\u6570\u5b57\u4ee3\u8868\u78c1\u9053\u7684\u4f4d\u7f6e\uff1a</p> <p>98\uff0c183\uff0c37\uff0c122\uff0c14\uff0c124\uff0c65\uff0c67</p> <p>\u521d\u59cb\u78c1\u5934\u5f53\u524d\u7684\u4f4d\u7f6e\u662f\u5728\u7b2c <code>53</code> \u78c1\u9053\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u522b\u5bf9\u4ee5\u4e0a\u7684\u5e8f\u5217\uff0c\u4f5c\u4e3a\u6bcf\u4e2a\u8c03\u5ea6\u7b97\u6cd5\u7684\u4f8b\u5b50\uff0c\u90a3\u5e38\u89c1\u7684\u78c1\u76d8\u8c03\u5ea6\u7b97\u6cd5\u6709\uff1a</p> <ul> <li>\u5148\u6765\u5148\u670d\u52a1\u7b97\u6cd5</li> <li>\u6700\u77ed\u5bfb\u9053\u65f6\u95f4\u4f18\u5148\u7b97\u6cd5</li> <li>\u626b\u63cf\u7b97\u6cd5\u7b97\u6cd5</li> <li>\u5faa\u73af\u626b\u63cf\u7b97\u6cd5</li> <li>LOOK \u4e0e C-LOOK \u7b97\u6cd5</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_15","title":"\u5148\u6765\u5148\u670d\u52a1","text":"<p>\u5148\u6765\u5148\u670d\u52a1\uff08First-Come\uff0cFirst-Served\uff0cFCFS\uff09\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5148\u5230\u6765\u7684\u8bf7\u6c42\uff0c\u5148\u88ab\u670d\u52a1\u3002</p> <p>\u90a3\u6309\u7167\u8fd9\u4e2a\u5e8f\u5217\u7684\u8bdd\uff1a</p> <p>98\uff0c183\uff0c37\uff0c122\uff0c14\uff0c124\uff0c65\uff0c67</p> <p>\u90a3\u4e48\uff0c\u78c1\u76d8\u7684\u5199\u5165\u987a\u5e8f\u662f\u4ece\u5de6\u5230\u53f3\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5148\u6765\u5148\u670d\u52a1\u7b97\u6cd5\u603b\u5171\u79fb\u52a8\u4e86 <code>640</code> \u4e2a\u78c1\u9053\u7684\u8ddd\u79bb\uff0c\u8fd9\u4e48\u4e00\u770b\u8fd9\u79cd\u7b97\u6cd5\uff0c\u6bd4\u8f83\u7b80\u5355\u7c97\u66b4\uff0c\u4f46\u662f\u5982\u679c\u5927\u91cf\u8fdb\u7a0b\u7ade\u4e89\u4f7f\u7528\u78c1\u76d8\uff0c\u8bf7\u6c42\u8bbf\u95ee\u7684\u78c1\u9053\u53ef\u80fd\u4f1a\u5f88\u5206\u6563\uff0c\u90a3\u5148\u6765\u5148\u670d\u52a1\u7b97\u6cd5\u5728\u6027\u80fd\u4e0a\u5c31\u4f1a\u663e\u5f97\u5f88\u5dee\uff0c\u56e0\u4e3a\u5bfb\u9053\u65f6\u95f4\u8fc7\u957f\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_16","title":"\u6700\u77ed\u5bfb\u9053\u65f6\u95f4\u4f18\u5148","text":"<p>\u6700\u77ed\u5bfb\u9053\u65f6\u95f4\u4f18\u5148\uff08Shortest Seek First\uff0cSSF\uff09\u7b97\u6cd5\u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\uff0c\u4f18\u5148\u9009\u62e9\u4ece\u5f53\u524d\u78c1\u5934\u4f4d\u7f6e\u6240\u9700\u5bfb\u9053\u65f6\u95f4\u6700\u77ed\u7684\u8bf7\u6c42\uff0c\u8fd8\u662f\u4ee5\u8fd9\u4e2a\u5e8f\u5217\u4e3a\u4f8b\u5b50\uff1a</p> <p>98\uff0c183\uff0c37\uff0c122\uff0c14\uff0c124\uff0c65\uff0c67</p> <p>\u90a3\u4e48\uff0c\u90a3\u4e48\u6839\u636e\u8ddd\u79bb\u78c1\u5934\uff0853 \u4f4d\u7f6e\uff09\u6700\u8fd1\u7684\u8bf7\u6c42\u7684\u7b97\u6cd5\uff0c\u5177\u4f53\u7684\u8bf7\u6c42\u5219\u4f1a\u662f\u4e0b\u5217\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\uff1a</p> <p>65\uff0c67\uff0c37\uff0c14\uff0c98\uff0c122\uff0c124\uff0c183</p> <p></p> <p>\u78c1\u5934\u79fb\u52a8\u7684\u603b\u8ddd\u79bb\u662f <code>236</code> \u78c1\u9053\uff0c\u76f8\u6bd4\u5148\u6765\u5148\u670d\u52a1\u6027\u80fd\u63d0\u9ad8\u4e86\u4e0d\u5c11\u3002</p> <p>\u4f46\u8fd9\u4e2a\u7b97\u6cd5\u53ef\u80fd\u5b58\u5728\u67d0\u4e9b\u8bf7\u6c42\u7684\u9965\u997f\uff0c\u56e0\u4e3a\u672c\u6b21\u4f8b\u5b50\u6211\u4eec\u662f\u9759\u6001\u7684\u5e8f\u5217\uff0c\u770b\u4e0d\u51fa\u95ee\u9898\uff0c\u5047\u8bbe\u662f\u4e00\u4e2a\u52a8\u6001\u7684\u8bf7\u6c42\uff0c\u5982\u679c\u540e\u7eed\u6765\u7684\u8bf7\u6c42\u90fd\u662f\u5c0f\u4e8e 183  \u78c1\u9053\u7684\uff0c\u90a3\u4e48 183 \u78c1\u9053\u53ef\u80fd\u6c38\u8fdc\u4e0d\u4f1a\u88ab\u54cd\u5e94\uff0c\u4e8e\u662f\u5c31\u4ea7\u751f\u4e86\u9965\u997f\u73b0\u8c61\uff0c\u8fd9\u91cc\u4ea7\u751f\u9965\u997f\u7684\u539f\u56e0\u662f\u78c1\u5934\u5728\u4e00\u5c0f\u5757\u533a\u57df\u6765\u56de\u79fb\u52a8\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_17","title":"\u626b\u63cf\u7b97\u6cd5","text":"<p>\u6700\u77ed\u5bfb\u9053\u65f6\u95f4\u4f18\u5148\u7b97\u6cd5\u4f1a\u4ea7\u751f\u9965\u997f\u7684\u539f\u56e0\u5728\u4e8e\uff1a\u78c1\u5934\u6709\u53ef\u80fd\u518d\u4e00\u4e2a\u5c0f\u533a\u57df\u5185\u6765\u56de\u5f97\u79fb\u52a8\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u89c4\u5b9a\uff1a\u78c1\u5934\u5728\u4e00\u4e2a\u65b9\u5411\u4e0a\u79fb\u52a8\uff0c\u8bbf\u95ee\u6240\u6709\u672a\u5b8c\u6210\u7684\u8bf7\u6c42\uff0c\u76f4\u5230\u78c1\u5934\u5230\u8fbe\u8be5\u65b9\u5411\u4e0a\u7684\u6700\u540e\u7684\u78c1\u9053\uff0c\u624d\u8c03\u6362\u65b9\u5411\uff0c\u8fd9\u5c31\u662f\u626b\u63cf\uff08Scan\uff09\u7b97\u6cd5\u3002</p> <p>\u8fd9\u79cd\u7b97\u6cd5\u4e5f\u53eb\u505a\u7535\u68af\u7b97\u6cd5\uff0c\u6bd4\u5982\u7535\u68af\u4fdd\u6301\u6309\u4e00\u4e2a\u65b9\u5411\u79fb\u52a8\uff0c\u76f4\u5230\u5728\u90a3\u4e2a\u65b9\u5411\u4e0a\u6ca1\u6709\u8bf7\u6c42\u4e3a\u6b62\uff0c\u7136\u540e\u6539\u53d8\u65b9\u5411\u3002</p> <p>\u8fd8\u662f\u4ee5\u8fd9\u4e2a\u5e8f\u5217\u4e3a\u4f8b\u5b50\uff0c\u78c1\u5934\u7684\u521d\u59cb\u4f4d\u7f6e\u662f 53\uff1a</p> <p>98\uff0c183\uff0c37\uff0c122\uff0c14\uff0c124\uff0c65\uff0c67</p> <p>\u90a3\u4e48\uff0c\u5047\u8bbe\u626b\u63cf\u8c03\u5ea6\u7b97\u5148\u671d\u78c1\u9053\u53f7\u51cf\u5c11\u7684\u65b9\u5411\u79fb\u52a8\uff0c\u5177\u4f53\u8bf7\u6c42\u5219\u4f1a\u662f\u4e0b\u5217\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\uff1a</p> <p>37\uff0c14\uff0c<code>0</code>\uff0c65\uff0c67\uff0c98\uff0c122\uff0c124\uff0c183</p> <p></p> <p>\u78c1\u5934\u5148\u54cd\u5e94\u5de6\u8fb9\u7684\u8bf7\u6c42\uff0c\u76f4\u5230\u5230\u8fbe\u6700\u5de6\u7aef\uff080 \u78c1\u9053\uff09\u540e\uff0c\u624d\u5f00\u59cb\u53cd\u5411\u79fb\u52a8\uff0c\u54cd\u5e94\u53f3\u8fb9\u7684\u8bf7\u6c42\u3002</p> <p>\u626b\u63cf\u8c03\u5ea6\u7b97\u6cd5\u6027\u80fd\u8f83\u597d\uff0c\u4e0d\u4f1a\u4ea7\u751f\u9965\u997f\u73b0\u8c61\uff0c\u4f46\u662f\u5b58\u5728\u8fd9\u6837\u7684\u95ee\u9898\uff0c\u4e2d\u95f4\u90e8\u5206\u7684\u78c1\u9053\u4f1a\u6bd4\u8f83\u5360\u4fbf\u5b9c\uff0c\u4e2d\u95f4\u90e8\u5206\u76f8\u6bd4\u5176\u4ed6\u90e8\u5206\u54cd\u5e94\u7684\u9891\u7387\u4f1a\u6bd4\u8f83\u591a\uff0c\u4e5f\u5c31\u662f\u8bf4\u6bcf\u4e2a\u78c1\u9053\u7684\u54cd\u5e94\u9891\u7387\u5b58\u5728\u5dee\u5f02\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_18","title":"\u5faa\u73af\u626b\u63cf\u7b97\u6cd5","text":"<p>\u626b\u63cf\u7b97\u6cd5\u4f7f\u5f97\u6bcf\u4e2a\u78c1\u9053\u54cd\u5e94\u7684\u9891\u7387\u5b58\u5728\u5dee\u5f02\uff0c\u90a3\u4e48\u8981\u4f18\u5316\u8fd9\u4e2a\u95ee\u9898\u7684\u8bdd\uff0c\u53ef\u4ee5\u603b\u662f\u6309\u76f8\u540c\u7684\u65b9\u5411\u8fdb\u884c\u626b\u63cf\uff0c\u4f7f\u5f97\u6bcf\u4e2a\u78c1\u9053\u7684\u54cd\u5e94\u9891\u7387\u57fa\u672c\u4e00\u81f4\u3002</p> <p>\u5faa\u73af\u626b\u63cf\uff08Circular Scan, CSCAN \uff09\u89c4\u5b9a\uff1a\u53ea\u6709\u78c1\u5934\u671d\u67d0\u4e2a\u7279\u5b9a\u65b9\u5411\u79fb\u52a8\u65f6\uff0c\u624d\u5904\u7406\u78c1\u9053\u8bbf\u95ee\u8bf7\u6c42\uff0c\u800c\u8fd4\u56de\u65f6\u76f4\u63a5\u5feb\u901f\u79fb\u52a8\u81f3\u6700\u9760\u8fb9\u7f18\u7684\u78c1\u9053\uff0c\u4e5f\u5c31\u662f\u590d\u4f4d\u78c1\u5934\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u5f88\u5feb\u7684\uff0c\u5e76\u4e14\u8fd4\u56de\u4e2d\u9014\u4e0d\u5904\u7406\u4efb\u4f55\u8bf7\u6c42\uff0c\u8be5\u7b97\u6cd5\u7684\u7279\u70b9\uff0c\u5c31\u662f\u78c1\u9053\u53ea\u54cd\u5e94\u4e00\u4e2a\u65b9\u5411\u4e0a\u7684\u8bf7\u6c42\u3002</p> <p>\u8fd8\u662f\u4ee5\u8fd9\u4e2a\u5e8f\u5217\u4e3a\u4f8b\u5b50\uff0c\u78c1\u5934\u7684\u521d\u59cb\u4f4d\u7f6e\u662f 53\uff1a</p> <p>98\uff0c183\uff0c37\uff0c122\uff0c14\uff0c124\uff0c65\uff0c67</p> <p>\u90a3\u4e48\uff0c\u5047\u8bbe\u5faa\u73af\u626b\u63cf\u8c03\u5ea6\u7b97\u5148\u671d\u78c1\u9053\u589e\u52a0\u7684\u65b9\u5411\u79fb\u52a8\uff0c\u5177\u4f53\u8bf7\u6c42\u4f1a\u662f\u4e0b\u5217\u4ece\u5de6\u5230\u53f3\u7684\u987a\u5e8f\uff1a</p> <p>65\uff0c67\uff0c98\uff0c122\uff0c124\uff0c183\uff0c<code>199</code>\uff0c<code>0</code>\uff0c14\uff0c37</p> <p></p> <p>\u78c1\u5934\u5148\u54cd\u5e94\u4e86\u53f3\u8fb9\u7684\u8bf7\u6c42\uff0c\u76f4\u5230\u78b0\u5230\u4e86\u6700\u53f3\u7aef\u7684\u78c1\u9053 199\uff0c\u5c31\u7acb\u5373\u56de\u5230\u78c1\u76d8\u7684\u5f00\u59cb\u5904\uff08\u78c1\u9053 0\uff09\uff0c\u4f46\u8fd9\u4e2a\u8fd4\u56de\u7684\u9014\u4e2d\u662f\u4e0d\u54cd\u5e94\u4efb\u4f55\u8bf7\u6c42\u7684\uff0c\u76f4\u5230\u5230\u8fbe\u6700\u5f00\u59cb\u7684\u78c1\u9053\u540e\uff0c\u624d\u7ee7\u7eed\u987a\u5e8f\u54cd\u5e94\u53f3\u8fb9\u7684\u8bf7\u6c42\u3002</p> <p>\u5faa\u73af\u626b\u63cf\u7b97\u6cd5\u76f8\u6bd4\u4e8e\u626b\u63cf\u7b97\u6cd5\uff0c\u5bf9\u4e8e\u5404\u4e2a\u4f4d\u7f6e\u78c1\u9053\u54cd\u5e94\u9891\u7387\u76f8\u5bf9\u6bd4\u8f83\u5e73\u5747\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#look-c-look","title":"LOOK \u4e0e C-LOOK \u7b97\u6cd5","text":"<p>\u6211\u4eec\u524d\u9762\u8bf4\u5230\u7684\u626b\u63cf\u7b97\u6cd5\u548c\u5faa\u73af\u626b\u63cf\u7b97\u6cd5\uff0c\u90fd\u662f\u78c1\u5934\u79fb\u52a8\u5230\u78c1\u76d8\u300c\u6700\u59cb\u7aef\u6216\u6700\u672b\u7aef\u300d\u624d\u5f00\u59cb\u8c03\u6362\u65b9\u5411\u3002</p> <p>\u90a3\u8fd9\u5176\u5b9e\u662f\u53ef\u4ee5\u4f18\u5316\u7684\uff0c\u4f18\u5316\u7684\u601d\u8def\u5c31\u662f\u78c1\u5934\u5728\u79fb\u52a8\u5230\u300c\u6700\u8fdc\u7684\u8bf7\u6c42\u300d\u4f4d\u7f6e\uff0c\u7136\u540e\u7acb\u5373\u53cd\u5411\u79fb\u52a8\u3002</p> <p>\u90a3\u9488\u5bf9 SCAN \u7b97\u6cd5\u7684\u4f18\u5316\u5219\u53eb LOOK \u7b97\u6cd5\uff0c\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u78c1\u5934\u5728\u6bcf\u4e2a\u65b9\u5411\u4e0a\u4ec5\u4ec5\u79fb\u52a8\u5230\u6700\u8fdc\u7684\u8bf7\u6c42\u4f4d\u7f6e\uff0c\u7136\u540e\u7acb\u5373\u53cd\u5411\u79fb\u52a8\uff0c\u800c\u4e0d\u9700\u8981\u79fb\u52a8\u5230\u78c1\u76d8\u7684\u6700\u59cb\u7aef\u6216\u6700\u672b\u7aef\uff0c\u53cd\u5411\u79fb\u52a8\u7684\u9014\u4e2d\u4f1a\u54cd\u5e94\u8bf7\u6c42\u3002</p> <p></p> <p>\u800c\u9488\u5bf9 C-SCAN \u7b97\u6cd5\u7684\u4f18\u5316\u5219\u53eb C-LOOK\uff0c\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u78c1\u5934\u5728\u6bcf\u4e2a\u65b9\u5411\u4e0a\u4ec5\u4ec5\u79fb\u52a8\u5230\u6700\u8fdc\u7684\u8bf7\u6c42\u4f4d\u7f6e\uff0c\u7136\u540e\u7acb\u5373\u53cd\u5411\u79fb\u52a8\uff0c\u800c\u4e0d\u9700\u8981\u79fb\u52a8\u5230\u78c1\u76d8\u7684\u6700\u59cb\u7aef\u6216\u6700\u672b\u7aef\uff0c\u53cd\u5411\u79fb\u52a8\u7684\u9014\u4e2d\u4e0d\u4f1a\u54cd\u5e94\u8bf7\u6c42\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/5_schedule/schedule/#_19","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/","title":"7.1 \u6587\u4ef6\u7cfb\u7edf\u5168\u5bb6\u6876","text":"<p>\u4e0d\u591a BB\uff0c\u76f4\u63a5\u4e0a\u300c\u786c\u83dc\u300d\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_1","title":"\u6587\u4ef6\u7cfb\u7edf\u7684\u57fa\u672c\u7ec4\u6210","text":"<p>\u6587\u4ef6\u7cfb\u7edf\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u8d1f\u8d23\u7ba1\u7406\u6301\u4e45\u6570\u636e\u7684\u5b50\u7cfb\u7edf\uff0c\u8bf4\u7b80\u5355\u70b9\uff0c\u5c31\u662f\u8d1f\u8d23\u628a\u7528\u6237\u7684\u6587\u4ef6\u5b58\u5230\u78c1\u76d8\u786c\u4ef6\u4e2d\uff0c\u56e0\u4e3a\u5373\u4f7f\u8ba1\u7b97\u673a\u65ad\u7535\u4e86\uff0c\u78c1\u76d8\u91cc\u7684\u6570\u636e\u5e76\u4e0d\u4f1a\u4e22\u5931\uff0c\u6240\u4ee5\u53ef\u4ee5\u6301\u4e45\u5316\u7684\u4fdd\u5b58\u6587\u4ef6\u3002</p> <p>\u6587\u4ef6\u7cfb\u7edf\u7684\u57fa\u672c\u6570\u636e\u5355\u4f4d\u662f\u6587\u4ef6\uff0c\u5b83\u7684\u76ee\u7684\u662f\u5bf9\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6\u8fdb\u884c\u7ec4\u7ec7\u7ba1\u7406\uff0c\u90a3\u7ec4\u7ec7\u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u5c31\u4f1a\u5f62\u6210\u4e0d\u540c\u7684\u6587\u4ef6\u7cfb\u7edf\u3002</p> <p>Linux \u6700\u7ecf\u5178\u7684\u4e00\u53e5\u8bdd\u662f\uff1a\u300c\u4e00\u5207\u7686\u6587\u4ef6\u300d\uff0c\u4e0d\u4ec5\u666e\u901a\u7684\u6587\u4ef6\u548c\u76ee\u5f55\uff0c\u5c31\u8fde\u5757\u8bbe\u5907\u3001\u7ba1\u9053\u3001socket \u7b49\uff0c\u4e5f\u90fd\u662f\u7edf\u4e00\u4ea4\u7ed9\u6587\u4ef6\u7cfb\u7edf\u7ba1\u7406\u7684\u3002</p> <p>Linux \u6587\u4ef6\u7cfb\u7edf\u4f1a\u4e3a\u6bcf\u4e2a\u6587\u4ef6\u5206\u914d\u4e24\u4e2a\u6570\u636e\u7ed3\u6784\uff1a\u7d22\u5f15\u8282\u70b9\uff08index node\uff09\u548c\u76ee\u5f55\u9879\uff08directory entry\uff09\uff0c\u5b83\u4eec\u4e3b\u8981\u7528\u6765\u8bb0\u5f55\u6587\u4ef6\u7684\u5143\u4fe1\u606f\u548c\u76ee\u5f55\u5c42\u6b21\u7ed3\u6784\u3002</p> <ul> <li>\u7d22\u5f15\u8282\u70b9\uff0c\u4e5f\u5c31\u662f inode\uff0c\u7528\u6765\u8bb0\u5f55\u6587\u4ef6\u7684\u5143\u4fe1\u606f\uff0c\u6bd4\u5982 inode \u7f16\u53f7\u3001\u6587\u4ef6\u5927\u5c0f\u3001\u8bbf\u95ee\u6743\u9650\u3001\u521b\u5efa\u65f6\u95f4\u3001\u4fee\u6539\u65f6\u95f4\u3001\u6570\u636e\u5728\u78c1\u76d8\u7684\u4f4d\u7f6e\u7b49\u7b49\u3002\u7d22\u5f15\u8282\u70b9\u662f\u6587\u4ef6\u7684\u552f\u4e00\u6807\u8bc6\uff0c\u5b83\u4eec\u4e4b\u95f4\u4e00\u4e00\u5bf9\u5e94\uff0c\u4e5f\u540c\u6837\u90fd\u4f1a\u88ab\u5b58\u50a8\u5728\u786c\u76d8\u4e2d\uff0c\u6240\u4ee5\u7d22\u5f15\u8282\u70b9\u540c\u6837\u5360\u7528\u78c1\u76d8\u7a7a\u95f4\u3002</li> <li>\u76ee\u5f55\u9879\uff0c\u4e5f\u5c31\u662f dentry\uff0c\u7528\u6765\u8bb0\u5f55\u6587\u4ef6\u7684\u540d\u5b57\u3001\u7d22\u5f15\u8282\u70b9\u6307\u9488\u4ee5\u53ca\u4e0e\u5176\u4ed6\u76ee\u5f55\u9879\u7684\u5c42\u7ea7\u5173\u8054\u5173\u7cfb\u3002\u591a\u4e2a\u76ee\u5f55\u9879\u5173\u8054\u8d77\u6765\uff0c\u5c31\u4f1a\u5f62\u6210\u76ee\u5f55\u7ed3\u6784\uff0c\u4f46\u5b83\u4e0e\u7d22\u5f15\u8282\u70b9\u4e0d\u540c\u7684\u662f\uff0c\u76ee\u5f55\u9879\u662f\u7531\u5185\u6838\u7ef4\u62a4\u7684\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u4e0d\u5b58\u653e\u4e8e\u78c1\u76d8\uff0c\u800c\u662f\u7f13\u5b58\u5728\u5185\u5b58\u3002</li> </ul> <p>\u7531\u4e8e\u7d22\u5f15\u8282\u70b9\u552f\u4e00\u6807\u8bc6\u4e00\u4e2a\u6587\u4ef6\uff0c\u800c\u76ee\u5f55\u9879\u8bb0\u5f55\u7740\u6587\u4ef6\u7684\u540d\u5b57\uff0c\u6240\u4ee5\u76ee\u5f55\u9879\u548c\u7d22\u5f15\u8282\u70b9\u7684\u5173\u7cfb\u662f\u591a\u5bf9\u4e00\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u4e00\u4e2a\u6587\u4ef6\u53ef\u4ee5\u6709\u591a\u4e2a\u522b\u540d\u3002\u6bd4\u5982\uff0c\u786c\u94fe\u63a5\u7684\u5b9e\u73b0\u5c31\u662f\u591a\u4e2a\u76ee\u5f55\u9879\u4e2d\u7684\u7d22\u5f15\u8282\u70b9\u6307\u5411\u540c\u4e00\u4e2a\u6587\u4ef6\u3002</p> <p>\u6ce8\u610f\uff0c\u76ee\u5f55\u4e5f\u662f\u6587\u4ef6\uff0c\u4e5f\u662f\u7528\u7d22\u5f15\u8282\u70b9\u552f\u4e00\u6807\u8bc6\uff0c\u548c\u666e\u901a\u6587\u4ef6\u4e0d\u540c\u7684\u662f\uff0c\u666e\u901a\u6587\u4ef6\u5728\u78c1\u76d8\u91cc\u9762\u4fdd\u5b58\u7684\u662f\u6587\u4ef6\u6570\u636e\uff0c\u800c\u76ee\u5f55\u6587\u4ef6\u5728\u78c1\u76d8\u91cc\u9762\u4fdd\u5b58\u5b50\u76ee\u5f55\u6216\u6587\u4ef6\u3002</p> <p>\u76ee\u5f55\u9879\u548c\u76ee\u5f55\u662f\u4e00\u4e2a\u4e1c\u897f\u5417\uff1f</p> <p>\u867d\u7136\u540d\u5b57\u5f88\u76f8\u8fd1\uff0c\u4f46\u662f\u5b83\u4eec\u4e0d\u662f\u4e00\u4e2a\u4e1c\u897f\uff0c\u76ee\u5f55\u662f\u4e2a\u6587\u4ef6\uff0c\u6301\u4e45\u5316\u5b58\u50a8\u5728\u78c1\u76d8\uff0c\u800c\u76ee\u5f55\u9879\u662f\u5185\u6838\u4e00\u4e2a\u6570\u636e\u7ed3\u6784\uff0c\u7f13\u5b58\u5728\u5185\u5b58\u3002</p> <p>\u5982\u679c\u67e5\u8be2\u76ee\u5f55\u9891\u7e41\u4ece\u78c1\u76d8\u8bfb\uff0c\u6548\u7387\u4f1a\u5f88\u4f4e\uff0c\u6240\u4ee5\u5185\u6838\u4f1a\u628a\u5df2\u7ecf\u8bfb\u8fc7\u7684\u76ee\u5f55\u7528\u76ee\u5f55\u9879\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u7f13\u5b58\u5728\u5185\u5b58\uff0c\u4e0b\u6b21\u518d\u6b21\u8bfb\u5230\u76f8\u540c\u7684\u76ee\u5f55\u65f6\uff0c\u53ea\u9700\u4ece\u5185\u5b58\u8bfb\u5c31\u53ef\u4ee5\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u6587\u4ef6\u7cfb\u7edf\u7684\u6548\u7387\u3002</p> <p>\u6ce8\u610f\uff0c\u76ee\u5f55\u9879\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u4e0d\u53ea\u662f\u8868\u793a\u76ee\u5f55\uff0c\u4e5f\u662f\u53ef\u4ee5\u8868\u793a\u6587\u4ef6\u7684\u3002</p> <p>\u90a3\u6587\u4ef6\u6570\u636e\u662f\u5982\u4f55\u5b58\u50a8\u5728\u78c1\u76d8\u7684\u5462\uff1f</p> <p>\u78c1\u76d8\u8bfb\u5199\u7684\u6700\u5c0f\u5355\u4f4d\u662f\u6247\u533a\uff0c\u6247\u533a\u7684\u5927\u5c0f\u53ea\u6709 <code>512B</code> \u5927\u5c0f\uff0c\u5f88\u660e\u663e\uff0c\u5982\u679c\u6bcf\u6b21\u8bfb\u5199\u90fd\u4ee5\u8fd9\u4e48\u5c0f\u4e3a\u5355\u4f4d\uff0c\u90a3\u8fd9\u8bfb\u5199\u7684\u6548\u7387\u4f1a\u975e\u5e38\u4f4e\u3002</p> <p>\u6240\u4ee5\uff0c\u6587\u4ef6\u7cfb\u7edf\u628a\u591a\u4e2a\u6247\u533a\u7ec4\u6210\u4e86\u4e00\u4e2a\u903b\u8f91\u5757\uff0c\u6bcf\u6b21\u8bfb\u5199\u7684\u6700\u5c0f\u5355\u4f4d\u5c31\u662f\u903b\u8f91\u5757\uff08\u6570\u636e\u5757\uff09\uff0cLinux \u4e2d\u7684\u903b\u8f91\u5757\u5927\u5c0f\u4e3a <code>4KB</code>\uff0c\u4e5f\u5c31\u662f\u4e00\u6b21\u6027\u8bfb\u5199 8 \u4e2a\u6247\u533a\uff0c\u8fd9\u5c06\u5927\u5927\u63d0\u9ad8\u4e86\u78c1\u76d8\u7684\u8bfb\u5199\u7684\u6548\u7387\u3002</p> <p>\u4ee5\u4e0a\u5c31\u662f\u7d22\u5f15\u8282\u70b9\u3001\u76ee\u5f55\u9879\u4ee5\u53ca\u6587\u4ef6\u6570\u636e\u7684\u5173\u7cfb\uff0c\u4e0b\u9762\u8fd9\u4e2a\u56fe\u5c31\u5f88\u597d\u7684\u5c55\u793a\u4e86\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\uff1a</p> <p></p> <p>\u7d22\u5f15\u8282\u70b9\u662f\u5b58\u50a8\u5728\u786c\u76d8\u4e0a\u7684\u6570\u636e\uff0c\u90a3\u4e48\u4e3a\u4e86\u52a0\u901f\u6587\u4ef6\u7684\u8bbf\u95ee\uff0c\u901a\u5e38\u4f1a\u628a\u7d22\u5f15\u8282\u70b9\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002</p> <p>\u53e6\u5916\uff0c\u78c1\u76d8\u8fdb\u884c\u683c\u5f0f\u5316\u7684\u65f6\u5019\uff0c\u4f1a\u88ab\u5206\u6210\u4e09\u4e2a\u5b58\u50a8\u533a\u57df\uff0c\u5206\u522b\u662f\u8d85\u7ea7\u5757\u3001\u7d22\u5f15\u8282\u70b9\u533a\u548c\u6570\u636e\u5757\u533a\u3002</p> <ul> <li>\u8d85\u7ea7\u5757\uff0c\u7528\u6765\u5b58\u50a8\u6587\u4ef6\u7cfb\u7edf\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u6bd4\u5982\u5757\u4e2a\u6570\u3001\u5757\u5927\u5c0f\u3001\u7a7a\u95f2\u5757\u7b49\u7b49\u3002</li> <li>\u7d22\u5f15\u8282\u70b9\u533a\uff0c\u7528\u6765\u5b58\u50a8\u7d22\u5f15\u8282\u70b9\uff1b</li> <li>\u6570\u636e\u5757\u533a\uff0c\u7528\u6765\u5b58\u50a8\u6587\u4ef6\u6216\u76ee\u5f55\u6570\u636e\uff1b</li> </ul> <p>\u6211\u4eec\u4e0d\u53ef\u80fd\u628a\u8d85\u7ea7\u5757\u548c\u7d22\u5f15\u8282\u70b9\u533a\u5168\u90e8\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u8fd9\u6837\u5185\u5b58\u80af\u5b9a\u6491\u4e0d\u4f4f\uff0c\u6240\u4ee5\u53ea\u6709\u5f53\u9700\u8981\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u624d\u5c06\u5176\u52a0\u8f7d\u8fdb\u5185\u5b58\uff0c\u5b83\u4eec\u52a0\u8f7d\u8fdb\u5185\u5b58\u7684\u65f6\u673a\u662f\u4e0d\u540c\u7684\uff1a</p> <ul> <li>\u8d85\u7ea7\u5757\uff1a\u5f53\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u65f6\u8fdb\u5165\u5185\u5b58\uff1b</li> <li>\u7d22\u5f15\u8282\u70b9\u533a\uff1a\u5f53\u6587\u4ef6\u88ab\u8bbf\u95ee\u65f6\u8fdb\u5165\u5185\u5b58\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_2","title":"\u865a\u62df\u6587\u4ef6\u7cfb\u7edf","text":"<p>\u6587\u4ef6\u7cfb\u7edf\u7684\u79cd\u7c7b\u4f17\u591a\uff0c\u800c\u64cd\u4f5c\u7cfb\u7edf\u5e0c\u671b\u5bf9\u7528\u6237\u63d0\u4f9b\u4e00\u4e2a\u7edf\u4e00\u7684\u63a5\u53e3\uff0c\u4e8e\u662f\u5728\u7528\u6237\u5c42\u4e0e\u6587\u4ef6\u7cfb\u7edf\u5c42\u5f15\u5165\u4e86\u4e2d\u95f4\u5c42\uff0c\u8fd9\u4e2a\u4e2d\u95f4\u5c42\u5c31\u79f0\u4e3a\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\uff08Virtual File System\uff0cVFS\uff09\u3002</p> <p>VFS \u5b9a\u4e49\u4e86\u4e00\u7ec4\u6240\u6709\u6587\u4ef6\u7cfb\u7edf\u90fd\u652f\u6301\u7684\u6570\u636e\u7ed3\u6784\u548c\u6807\u51c6\u63a5\u53e3\uff0c\u8fd9\u6837\u7a0b\u5e8f\u5458\u4e0d\u9700\u8981\u4e86\u89e3\u6587\u4ef6\u7cfb\u7edf\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u53ea\u9700\u8981\u4e86\u89e3 VFS \u63d0\u4f9b\u7684\u7edf\u4e00\u63a5\u53e3\u5373\u53ef\u3002</p> <p>\u5728 Linux \u6587\u4ef6\u7cfb\u7edf\u4e2d\uff0c\u7528\u6237\u7a7a\u95f4\u3001\u7cfb\u7edf\u8c03\u7528\u3001\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u3001\u7f13\u5b58\u3001\u6587\u4ef6\u7cfb\u7edf\u4ee5\u53ca\u5b58\u50a8\u4e4b\u95f4\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>Linux \u652f\u6301\u7684\u6587\u4ef6\u7cfb\u7edf\u4e5f\u4e0d\u5c11\uff0c\u6839\u636e\u5b58\u50a8\u4f4d\u7f6e\u7684\u4e0d\u540c\uff0c\u53ef\u4ee5\u628a\u6587\u4ef6\u7cfb\u7edf\u5206\u4e3a\u4e09\u7c7b\uff1a</p> <ul> <li>\u78c1\u76d8\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b83\u662f\u76f4\u63a5\u628a\u6570\u636e\u5b58\u50a8\u5728\u78c1\u76d8\u4e2d\uff0c\u6bd4\u5982 Ext 2/3/4\u3001XFS \u7b49\u90fd\u662f\u8fd9\u7c7b\u6587\u4ef6\u7cfb\u7edf\u3002</li> <li>\u5185\u5b58\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u8fd9\u7c7b\u6587\u4ef6\u7cfb\u7edf\u7684\u6570\u636e\u4e0d\u662f\u5b58\u50a8\u5728\u786c\u76d8\u7684\uff0c\u800c\u662f\u5360\u7528\u5185\u5b58\u7a7a\u95f4\uff0c\u6211\u4eec\u7ecf\u5e38\u7528\u5230\u7684 <code>/proc</code> \u548c <code>/sys</code> \u6587\u4ef6\u7cfb\u7edf\u90fd\u5c5e\u4e8e\u8fd9\u4e00\u7c7b\uff0c\u8bfb\u5199\u8fd9\u7c7b\u6587\u4ef6\uff0c\u5b9e\u9645\u4e0a\u662f\u8bfb\u5199\u5185\u6838\u4e2d\u76f8\u5173\u7684\u6570\u636e\u3002</li> <li>\u7f51\u7edc\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u7528\u6765\u8bbf\u95ee\u5176\u4ed6\u8ba1\u7b97\u673a\u4e3b\u673a\u6570\u636e\u7684\u6587\u4ef6\u7cfb\u7edf\uff0c\u6bd4\u5982 NFS\u3001SMB \u7b49\u7b49\u3002</li> </ul> <p>\u6587\u4ef6\u7cfb\u7edf\u9996\u5148\u8981\u5148\u6302\u8f7d\u5230\u67d0\u4e2a\u76ee\u5f55\u624d\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\uff0c\u6bd4\u5982 Linux \u7cfb\u7edf\u5728\u542f\u52a8\u65f6\uff0c\u4f1a\u628a\u6587\u4ef6\u7cfb\u7edf\u6302\u8f7d\u5230\u6839\u76ee\u5f55\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_3","title":"\u6587\u4ef6\u7684\u4f7f\u7528","text":"<p>\u6211\u4eec\u4ece\u7528\u6237\u89d2\u5ea6\u6765\u770b\u6587\u4ef6\u7684\u8bdd\uff0c\u5c31\u662f\u6211\u4eec\u8981\u600e\u4e48\u4f7f\u7528\u6587\u4ef6\uff1f\u9996\u5148\uff0c\u6211\u4eec\u5f97\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u6765\u6253\u5f00\u4e00\u4e2a\u6587\u4ef6\u3002</p> <p></p> C<pre><code>fd = open(name, flag); # \u6253\u5f00\u6587\u4ef6\n...\nwrite(fd,...);         # \u5199\u6570\u636e\n...\nclose(fd);             # \u5173\u95ed\u6587\u4ef6\n</code></pre> <p>\u4e0a\u9762\u7b80\u5355\u7684\u4ee3\u7801\u662f\u8bfb\u53d6\u4e00\u4e2a\u6587\u4ef6\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u9996\u5148\u7528 <code>open</code> \u7cfb\u7edf\u8c03\u7528\u6253\u5f00\u6587\u4ef6\uff0c<code>open</code> \u7684\u53c2\u6570\u4e2d\u5305\u542b\u6587\u4ef6\u7684\u8def\u5f84\u540d\u548c\u6587\u4ef6\u540d\u3002</li> <li>\u4f7f\u7528 <code>write</code> \u5199\u6570\u636e\uff0c\u5176\u4e2d <code>write</code> \u4f7f\u7528 <code>open</code> \u6240\u8fd4\u56de\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u5e76\u4e0d\u4f7f\u7528\u6587\u4ef6\u540d\u4f5c\u4e3a\u53c2\u6570\u3002</li> <li>\u4f7f\u7528\u5b8c\u6587\u4ef6\u540e\uff0c\u8981\u7528 <code>close</code> \u7cfb\u7edf\u8c03\u7528\u5173\u95ed\u6587\u4ef6\uff0c\u907f\u514d\u8d44\u6e90\u7684\u6cc4\u9732\u3002</li> </ul> <p>\u6211\u4eec\u6253\u5f00\u4e86\u4e00\u4e2a\u6587\u4ef6\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u8ddf\u8e2a\u8fdb\u7a0b\u6253\u5f00\u7684\u6240\u6709\u6587\u4ef6\uff0c\u6240\u8c13\u7684\u8ddf\u8e2a\u5462\uff0c\u5c31\u662f\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u7ef4\u62a4\u4e00\u4e2a\u6253\u5f00\u6587\u4ef6\u8868\uff0c\u6587\u4ef6\u8868\u91cc\u7684\u6bcf\u4e00\u9879\u4ee3\u8868\u300c\u6587\u4ef6\u63cf\u8ff0\u7b26\u300d\uff0c\u6240\u4ee5\u8bf4\u6587\u4ef6\u63cf\u8ff0\u7b26\u662f\u6253\u5f00\u6587\u4ef6\u7684\u6807\u8bc6\u3002</p> <p></p> <p>\u64cd\u4f5c\u7cfb\u7edf\u5728\u6253\u5f00\u6587\u4ef6\u8868\u4e2d\u7ef4\u62a4\u7740\u6253\u5f00\u6587\u4ef6\u7684\u72b6\u6001\u548c\u4fe1\u606f\uff1a</p> <ul> <li>\u6587\u4ef6\u6307\u9488\uff1a\u7cfb\u7edf\u8ddf\u8e2a\u4e0a\u6b21\u8bfb\u5199\u4f4d\u7f6e\u4f5c\u4e3a\u5f53\u524d\u6587\u4ef6\u4f4d\u7f6e\u6307\u9488\uff0c\u8fd9\u79cd\u6307\u9488\u5bf9\u6253\u5f00\u6587\u4ef6\u7684\u67d0\u4e2a\u8fdb\u7a0b\u6765\u8bf4\u662f\u552f\u4e00\u7684\uff1b</li> <li>\u6587\u4ef6\u6253\u5f00\u8ba1\u6570\u5668\uff1a\u6587\u4ef6\u5173\u95ed\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5fc5\u987b\u91cd\u7528\u5176\u6253\u5f00\u6587\u4ef6\u8868\u6761\u76ee\uff0c\u5426\u5219\u8868\u5185\u7a7a\u95f4\u4e0d\u591f\u7528\u3002\u56e0\u4e3a\u591a\u4e2a\u8fdb\u7a0b\u53ef\u80fd\u6253\u5f00\u540c\u4e00\u4e2a\u6587\u4ef6\uff0c\u6240\u4ee5\u7cfb\u7edf\u5728\u5220\u9664\u6253\u5f00\u6587\u4ef6\u6761\u76ee\u4e4b\u524d\uff0c\u5fc5\u987b\u7b49\u5f85\u6700\u540e\u4e00\u4e2a\u8fdb\u7a0b\u5173\u95ed\u6587\u4ef6\uff0c\u8be5\u8ba1\u6570\u5668\u8ddf\u8e2a\u6253\u5f00\u548c\u5173\u95ed\u7684\u6570\u91cf\uff0c\u5f53\u8be5\u8ba1\u6570\u4e3a 0 \u65f6\uff0c\u7cfb\u7edf\u5173\u95ed\u6587\u4ef6\uff0c\u5220\u9664\u8be5\u6761\u76ee\uff1b</li> <li>\u6587\u4ef6\u78c1\u76d8\u4f4d\u7f6e\uff1a\u7edd\u5927\u591a\u6570\u6587\u4ef6\u64cd\u4f5c\u90fd\u8981\u6c42\u7cfb\u7edf\u4fee\u6539\u6587\u4ef6\u6570\u636e\uff0c\u8be5\u4fe1\u606f\u4fdd\u5b58\u5728\u5185\u5b58\u4e2d\uff0c\u4ee5\u514d\u6bcf\u4e2a\u64cd\u4f5c\u90fd\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6\uff1b</li> <li>\u8bbf\u95ee\u6743\u9650\uff1a\u6bcf\u4e2a\u8fdb\u7a0b\u6253\u5f00\u6587\u4ef6\u90fd\u9700\u8981\u6709\u4e00\u4e2a\u8bbf\u95ee\u6a21\u5f0f\uff08\u521b\u5efa\u3001\u53ea\u8bfb\u3001\u8bfb\u5199\u3001\u6dfb\u52a0\u7b49\uff09\uff0c\u8be5\u4fe1\u606f\u4fdd\u5b58\u5728\u8fdb\u7a0b\u7684\u6253\u5f00\u6587\u4ef6\u8868\u4e2d\uff0c\u4ee5\u4fbf\u64cd\u4f5c\u7cfb\u7edf\u80fd\u5141\u8bb8\u6216\u62d2\u7edd\u4e4b\u540e\u7684 I/O \u8bf7\u6c42\uff1b</li> </ul> <p>\u5728\u7528\u6237\u89c6\u89d2\u91cc\uff0c\u6587\u4ef6\u5c31\u662f\u4e00\u4e2a\u6301\u4e45\u5316\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4f46\u64cd\u4f5c\u7cfb\u7edf\u5e76\u4e0d\u4f1a\u5173\u5fc3\u4f60\u60f3\u5b58\u5728\u78c1\u76d8\u4e0a\u7684\u4efb\u4f55\u7684\u6570\u636e\u7ed3\u6784\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u89c6\u89d2\u662f\u5982\u4f55\u628a\u6587\u4ef6\u6570\u636e\u548c\u78c1\u76d8\u5757\u5bf9\u5e94\u8d77\u6765\u3002</p> <p>\u6240\u4ee5\uff0c\u7528\u6237\u548c\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u6587\u4ef6\u7684\u8bfb\u5199\u64cd\u4f5c\u662f\u6709\u5dee\u5f02\u7684\uff0c\u7528\u6237\u4e60\u60ef\u4ee5\u5b57\u8282\u7684\u65b9\u5f0f\u8bfb\u5199\u6587\u4ef6\uff0c\u800c\u64cd\u4f5c\u7cfb\u7edf\u5219\u662f\u4ee5\u6570\u636e\u5757\u6765\u8bfb\u5199\u6587\u4ef6\uff0c\u90a3\u5c4f\u853d\u6389\u8fd9\u79cd\u5dee\u5f02\u7684\u5de5\u4f5c\u5c31\u662f\u6587\u4ef6\u7cfb\u7edf\u4e86\u3002</p> <p>\u6211\u4eec\u6765\u5206\u522b\u770b\u4e00\u4e0b\uff0c\u8bfb\u6587\u4ef6\u548c\u5199\u6587\u4ef6\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u7528\u6237\u8fdb\u7a0b\u4ece\u6587\u4ef6\u8bfb\u53d6 1 \u4e2a\u5b57\u8282\u5927\u5c0f\u7684\u6570\u636e\u65f6\uff0c\u6587\u4ef6\u7cfb\u7edf\u5219\u9700\u8981\u83b7\u53d6\u5b57\u8282\u6240\u5728\u7684\u6570\u636e\u5757\uff0c\u518d\u8fd4\u56de\u6570\u636e\u5757\u5bf9\u5e94\u7684\u7528\u6237\u8fdb\u7a0b\u6240\u9700\u7684\u6570\u636e\u90e8\u5206\u3002</li> <li>\u5f53\u7528\u6237\u8fdb\u7a0b\u628a 1 \u4e2a\u5b57\u8282\u5927\u5c0f\u7684\u6570\u636e\u5199\u8fdb\u6587\u4ef6\u65f6\uff0c\u6587\u4ef6\u7cfb\u7edf\u5219\u627e\u5230\u9700\u8981\u5199\u5165\u6570\u636e\u7684\u6570\u636e\u5757\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u4fee\u6539\u6570\u636e\u5757\u4e2d\u5bf9\u5e94\u7684\u90e8\u5206\uff0c\u6700\u540e\u518d\u628a\u6570\u636e\u5757\u5199\u56de\u78c1\u76d8\u3002</li> </ul> <p>\u6240\u4ee5\u8bf4\uff0c\u6587\u4ef6\u7cfb\u7edf\u7684\u57fa\u672c\u64cd\u4f5c\u5355\u4f4d\u662f\u6570\u636e\u5757\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_4","title":"\u6587\u4ef6\u7684\u5b58\u50a8","text":"<p>\u6587\u4ef6\u7684\u6570\u636e\u662f\u8981\u5b58\u50a8\u5728\u786c\u76d8\u4e0a\u9762\u7684\uff0c\u6570\u636e\u5728\u78c1\u76d8\u4e0a\u7684\u5b58\u653e\u65b9\u5f0f\uff0c\u5c31\u50cf\u7a0b\u5e8f\u5728\u5185\u5b58\u4e2d\u5b58\u653e\u7684\u65b9\u5f0f\u90a3\u6837\uff0c\u6709\u4ee5\u4e0b\u4e24\u79cd\uff1a</p> <ul> <li>\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u65b9\u5f0f</li> <li>\u975e\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u65b9\u5f0f</li> </ul> <p>\u5176\u4e2d\uff0c\u975e\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u65b9\u5f0f\u53c8\u53ef\u4ee5\u5206\u4e3a\u300c\u94fe\u8868\u65b9\u5f0f\u300d\u548c\u300c\u7d22\u5f15\u65b9\u5f0f\u300d\u3002</p> <p>\u4e0d\u540c\u7684\u5b58\u50a8\u65b9\u5f0f\uff0c\u6709\u5404\u81ea\u7684\u7279\u70b9\uff0c\u91cd\u70b9\u662f\u8981\u5206\u6790\u5b83\u4eec\u7684\u5b58\u50a8\u6548\u7387\u548c\u8bfb\u5199\u6027\u80fd\uff0c\u63a5\u4e0b\u6765\u5206\u522b\u5bf9\u6bcf\u79cd\u5b58\u50a8\u65b9\u5f0f\u8bf4\u4e00\u4e0b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_5","title":"\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u65b9\u5f0f","text":"<p>\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u65b9\u5f0f\u987e\u540d\u601d\u4e49\uff0c\u6587\u4ef6\u5b58\u653e\u5728\u78c1\u76d8\u300c\u8fde\u7eed\u7684\u300d\u7269\u7406\u7a7a\u95f4\u4e2d\u3002\u8fd9\u79cd\u6a21\u5f0f\u4e0b\uff0c\u6587\u4ef6\u7684\u6570\u636e\u90fd\u662f\u7d27\u5bc6\u76f8\u8fde\uff0c\u8bfb\u5199\u6548\u7387\u5f88\u9ad8\uff0c\u56e0\u4e3a\u4e00\u6b21\u78c1\u76d8\u5bfb\u9053\u5c31\u53ef\u4ee5\u8bfb\u51fa\u6574\u4e2a\u6587\u4ef6\u3002</p> <p>\u4f7f\u7528\u8fde\u7eed\u5b58\u653e\u7684\u65b9\u5f0f\u6709\u4e00\u4e2a\u524d\u63d0\uff0c\u5fc5\u987b\u5148\u77e5\u9053\u4e00\u4e2a\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u8fd9\u6837\u6587\u4ef6\u7cfb\u7edf\u624d\u4f1a\u6839\u636e\u6587\u4ef6\u7684\u5927\u5c0f\u5728\u78c1\u76d8\u4e0a\u627e\u5230\u4e00\u5757\u8fde\u7eed\u7684\u7a7a\u95f4\u5206\u914d\u7ed9\u6587\u4ef6\u3002</p> <p>\u6240\u4ee5\uff0c\u6587\u4ef6\u5934\u91cc\u9700\u8981\u6307\u5b9a\u300c\u8d77\u59cb\u5757\u7684\u4f4d\u7f6e\u300d\u548c\u300c\u957f\u5ea6\u300d\uff0c\u6709\u4e86\u8fd9\u4e24\u4e2a\u4fe1\u606f\u5c31\u53ef\u4ee5\u5f88\u597d\u7684\u8868\u793a\u6587\u4ef6\u5b58\u653e\u65b9\u5f0f\u662f\u4e00\u5757\u8fde\u7eed\u7684\u78c1\u76d8\u7a7a\u95f4\u3002</p> <p>\u6ce8\u610f\uff0c\u6b64\u5904\u8bf4\u7684\u6587\u4ef6\u5934\uff0c\u5c31\u7c7b\u4f3c\u4e8e Linux \u7684 inode\u3002</p> <p></p> <p>\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u7684\u65b9\u5f0f\u867d\u7136\u8bfb\u5199\u6548\u7387\u9ad8\uff0c\u4f46\u662f\u6709\u300c\u78c1\u76d8\u7a7a\u95f4\u788e\u7247\u300d\u548c\u300c\u6587\u4ef6\u957f\u5ea6\u4e0d\u6613\u6269\u5c55\u300d\u7684\u7f3a\u9677\u3002</p> <p>\u5982\u4e0b\u56fe\uff0c\u5982\u679c\u6587\u4ef6 B \u88ab\u5220\u9664\uff0c\u78c1\u76d8\u4e0a\u5c31\u7559\u4e0b\u4e00\u5757\u7a7a\u7f3a\uff0c\u8fd9\u65f6\uff0c\u5982\u679c\u65b0\u6765\u7684\u6587\u4ef6\u5c0f\u4e8e\u5176\u4e2d\u7684\u4e00\u4e2a\u7a7a\u7f3a\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u5c06\u5176\u653e\u5728\u76f8\u5e94\u7a7a\u7f3a\u91cc\u3002\u4f46\u5982\u679c\u8be5\u6587\u4ef6\u7684\u5927\u5c0f\u5927\u4e8e\u6240\u6709\u7684\u7a7a\u7f3a\uff0c\u4f46\u5374\u5c0f\u4e8e\u7a7a\u7f3a\u5927\u5c0f\u4e4b\u548c\uff0c\u5219\u867d\u7136\u78c1\u76d8\u4e0a\u6709\u8db3\u591f\u7684\u7a7a\u7f3a\uff0c\u4f46\u8be5\u6587\u4ef6\u8fd8\u662f\u4e0d\u80fd\u5b58\u653e\u3002\u5f53\u7136\u4e86\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5c06\u73b0\u6709\u6587\u4ef6\u8fdb\u884c\u632a\u52a8\u6765\u817e\u51fa\u7a7a\u95f4\u4ee5\u5bb9\u7eb3\u65b0\u7684\u6587\u4ef6\uff0c\u4f46\u662f\u8fd9\u4e2a\u5728\u78c1\u76d8\u632a\u52a8\u6587\u4ef6\u662f\u975e\u5e38\u8017\u65f6\uff0c\u6240\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u592a\u73b0\u5b9e\u3002</p> <p></p> <p>\u53e6\u5916\u4e00\u4e2a\u7f3a\u9677\u662f\u6587\u4ef6\u957f\u5ea6\u6269\u5c55\u4e0d\u65b9\u4fbf\uff0c\u4f8b\u5982\u4e0a\u56fe\u4e2d\u7684\u6587\u4ef6 A \u8981\u60f3\u6269\u5927\u4e00\u4e0b\uff0c\u9700\u8981\u66f4\u591a\u7684\u78c1\u76d8\u7a7a\u95f4\uff0c\u552f\u4e00\u7684\u529e\u6cd5\u5c31\u53ea\u80fd\u662f\u632a\u52a8\u7684\u65b9\u5f0f\uff0c\u524d\u9762\u4e5f\u8bf4\u4e86\uff0c\u8fd9\u79cd\u65b9\u5f0f\u6548\u7387\u662f\u975e\u5e38\u4f4e\u7684\u3002</p> <p>\u90a3\u4e48\u6709\u6ca1\u6709\u66f4\u597d\u7684\u65b9\u5f0f\u6765\u89e3\u51b3\u4e0a\u9762\u7684\u95ee\u9898\u5462\uff1f\u7b54\u6848\u5f53\u7136\u6709\uff0c\u65e2\u7136\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u7684\u65b9\u5f0f\u4e0d\u592a\u884c\uff0c\u90a3\u4e48\u6211\u4eec\u5c31\u6539\u53d8\u5b58\u653e\u7684\u65b9\u5f0f\uff0c\u4f7f\u7528\u975e\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u65b9\u5f0f\u6765\u89e3\u51b3\u8fd9\u4e9b\u7f3a\u9677\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_6","title":"\u975e\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u65b9\u5f0f","text":"<p>\u975e\u8fde\u7eed\u7a7a\u95f4\u5b58\u653e\u65b9\u5f0f\u5206\u4e3a\u300c\u94fe\u8868\u65b9\u5f0f\u300d\u548c\u300c\u7d22\u5f15\u65b9\u5f0f\u300d\u3002</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b\u94fe\u8868\u7684\u65b9\u5f0f\u3002</p> <p>\u94fe\u8868\u7684\u65b9\u5f0f\u5b58\u653e\u662f\u79bb\u6563\u7684\uff0c\u4e0d\u7528\u8fde\u7eed\u7684\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u6d88\u9664\u78c1\u76d8\u788e\u7247\uff0c\u53ef\u5927\u5927\u63d0\u9ad8\u78c1\u76d8\u7a7a\u95f4\u7684\u5229\u7528\u7387\uff0c\u540c\u65f6\u6587\u4ef6\u7684\u957f\u5ea6\u53ef\u4ee5\u52a8\u6001\u6269\u5c55\u3002\u6839\u636e\u5b9e\u73b0\u7684\u65b9\u5f0f\u7684\u4e0d\u540c\uff0c\u94fe\u8868\u53ef\u5206\u4e3a\u300c\u9690\u5f0f\u94fe\u8868\u300d\u548c\u300c\u663e\u5f0f\u94fe\u63a5\u300d\u4e24\u79cd\u5f62\u5f0f\u3002</p> <p>\u6587\u4ef6\u8981\u4ee5\u300c\u9690\u5f0f\u94fe\u8868\u300d\u7684\u65b9\u5f0f\u5b58\u653e\u7684\u8bdd\uff0c\u5b9e\u73b0\u7684\u65b9\u5f0f\u662f\u6587\u4ef6\u5934\u8981\u5305\u542b\u300c\u7b2c\u4e00\u5757\u300d\u548c\u300c\u6700\u540e\u4e00\u5757\u300d\u7684\u4f4d\u7f6e\uff0c\u5e76\u4e14\u6bcf\u4e2a\u6570\u636e\u5757\u91cc\u9762\u7559\u51fa\u4e00\u4e2a\u6307\u9488\u7a7a\u95f4\uff0c\u7528\u6765\u5b58\u653e\u4e0b\u4e00\u4e2a\u6570\u636e\u5757\u7684\u4f4d\u7f6e\uff0c\u8fd9\u6837\u4e00\u4e2a\u6570\u636e\u5757\u8fde\u7740\u4e00\u4e2a\u6570\u636e\u5757\uff0c\u4ece\u94fe\u5934\u5f00\u59cb\u5c31\u53ef\u4ee5\u987a\u7740\u6307\u9488\u627e\u5230\u6240\u6709\u7684\u6570\u636e\u5757\uff0c\u6240\u4ee5\u5b58\u653e\u7684\u65b9\u5f0f\u53ef\u4ee5\u662f\u4e0d\u8fde\u7eed\u7684\u3002</p> <p></p> <p>\u9690\u5f0f\u94fe\u8868\u7684\u5b58\u653e\u65b9\u5f0f\u7684\u7f3a\u70b9\u5728\u4e8e\u65e0\u6cd5\u76f4\u63a5\u8bbf\u95ee\u6570\u636e\u5757\uff0c\u53ea\u80fd\u901a\u8fc7\u6307\u9488\u987a\u5e8f\u8bbf\u95ee\u6587\u4ef6\uff0c\u4ee5\u53ca\u6570\u636e\u5757\u6307\u9488\u6d88\u8017\u4e86\u4e00\u5b9a\u7684\u5b58\u50a8\u7a7a\u95f4\u3002\u9690\u5f0f\u94fe\u63a5\u5206\u914d\u7684\u7a33\u5b9a\u6027\u8f83\u5dee\uff0c\u7cfb\u7edf\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7531\u4e8e\u8f6f\u4ef6\u6216\u8005\u786c\u4ef6\u9519\u8bef\u5bfc\u81f4\u94fe\u8868\u4e2d\u7684\u6307\u9488\u4e22\u5931\u6216\u635f\u574f\uff0c\u4f1a\u5bfc\u81f4\u6587\u4ef6\u6570\u636e\u7684\u4e22\u5931\u3002</p> <p>\u5982\u679c\u53d6\u51fa\u6bcf\u4e2a\u78c1\u76d8\u5757\u7684\u6307\u9488\uff0c\u628a\u5b83\u653e\u5728\u5185\u5b58\u7684\u4e00\u4e2a\u8868\u4e2d\uff0c\u5c31\u53ef\u4ee5\u89e3\u51b3\u4e0a\u8ff0\u9690\u5f0f\u94fe\u8868\u7684\u4e24\u4e2a\u4e0d\u8db3\u3002\u90a3\u4e48\uff0c\u8fd9\u79cd\u5b9e\u73b0\u65b9\u5f0f\u662f\u300c\u663e\u5f0f\u94fe\u63a5\u300d\uff0c\u5b83\u6307\u628a\u7528\u4e8e\u94fe\u63a5\u6587\u4ef6\u5404\u6570\u636e\u5757\u7684\u6307\u9488\uff0c\u663e\u5f0f\u5730\u5b58\u653e\u5728\u5185\u5b58\u7684\u4e00\u5f20\u94fe\u63a5\u8868\u4e2d\uff0c\u8be5\u8868\u5728\u6574\u4e2a\u78c1\u76d8\u4ec5\u8bbe\u7f6e\u4e00\u5f20\uff0c\u6bcf\u4e2a\u8868\u9879\u4e2d\u5b58\u653e\u94fe\u63a5\u6307\u9488\uff0c\u6307\u5411\u4e0b\u4e00\u4e2a\u6570\u636e\u5757\u53f7\u3002</p> <p>\u5bf9\u4e8e\u663e\u5f0f\u94fe\u63a5\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u6211\u4eec\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6587\u4ef6 A \u4f9d\u6b21\u4f7f\u7528\u4e86\u78c1\u76d8\u5757 4\u30017\u30012\u300110 \u548c 12\uff0c\u6587\u4ef6 B \u4f9d\u6b21\u4f7f\u7528\u4e86\u78c1\u76d8\u5757 6\u30013\u300111 \u548c 14\u3002\u5229\u7528\u4e0b\u56fe\u4e2d\u7684\u8868\uff0c\u53ef\u4ee5\u4ece\u7b2c 4 \u5757\u5f00\u59cb\uff0c\u987a\u7740\u94fe\u8d70\u5230\u6700\u540e\uff0c\u627e\u5230\u6587\u4ef6 A \u7684\u5168\u90e8\u78c1\u76d8\u5757\u3002\u540c\u6837\uff0c\u4ece\u7b2c 6 \u5757\u5f00\u59cb\uff0c\u987a\u7740\u94fe\u8d70\u5230\u6700\u540e\uff0c\u4e5f\u80fd\u591f\u627e\u51fa\u6587\u4ef6 B \u7684\u5168\u90e8\u78c1\u76d8\u5757\u3002\u6700\u540e\uff0c\u8fd9\u4e24\u4e2a\u94fe\u90fd\u4ee5\u4e00\u4e2a\u4e0d\u5c5e\u4e8e\u6709\u6548\u78c1\u76d8\u7f16\u53f7\u7684\u7279\u6b8a\u6807\u8bb0\uff08\u5982 -1\uff09\u7ed3\u675f\u3002\u5185\u5b58\u4e2d\u7684\u8fd9\u6837\u4e00\u4e2a\u8868\u683c\u79f0\u4e3a\u6587\u4ef6\u5206\u914d\u8868\uff08File Allocation Table\uff0cFAT\uff09\u3002</p> <p></p> <p>\u7531\u4e8e\u67e5\u627e\u8bb0\u5f55\u7684\u8fc7\u7a0b\u662f\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u7684\uff0c\u56e0\u800c\u4e0d\u4ec5\u663e\u8457\u5730\u63d0\u9ad8\u4e86\u68c0\u7d22\u901f\u5ea6\uff0c\u800c\u4e14\u5927\u5927\u51cf\u5c11\u4e86\u8bbf\u95ee\u78c1\u76d8\u7684\u6b21\u6570\u3002\u4f46\u4e5f\u6b63\u662f\u6574\u4e2a\u8868\u90fd\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u7684\u5173\u7cfb\uff0c\u5b83\u7684\u4e3b\u8981\u7684\u7f3a\u70b9\u662f\u4e0d\u9002\u7528\u4e8e\u5927\u78c1\u76d8\u3002</p> <p>\u6bd4\u5982\uff0c\u5bf9\u4e8e 200GB \u7684\u78c1\u76d8\u548c 1KB \u5927\u5c0f\u7684\u5757\uff0c\u8fd9\u5f20\u8868\u9700\u8981\u6709 2 \u4ebf\u9879\uff0c\u6bcf\u4e00\u9879\u5bf9\u5e94\u4e8e\u8fd9 2 \u4ebf\u4e2a\u78c1\u76d8\u5757\u4e2d\u7684\u4e00\u4e2a\u5757\uff0c\u6bcf\u9879\u5982\u679c\u9700\u8981 4 \u4e2a\u5b57\u8282\uff0c\u90a3\u8fd9\u5f20\u8868\u8981\u5360\u7528 800MB \u5185\u5b58\uff0c\u5f88\u663e\u7136 FAT \u65b9\u6848\u5bf9\u4e8e\u5927\u78c1\u76d8\u800c\u8a00\u4e0d\u592a\u5408\u9002\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u770b\u770b\u7d22\u5f15\u7684\u65b9\u5f0f\u3002</p> <p>\u94fe\u8868\u7684\u65b9\u5f0f\u89e3\u51b3\u4e86\u8fde\u7eed\u5206\u914d\u7684\u78c1\u76d8\u788e\u7247\u548c\u6587\u4ef6\u52a8\u6001\u6269\u5c55\u7684\u95ee\u9898\uff0c\u4f46\u662f\u4e0d\u80fd\u6709\u6548\u652f\u6301\u76f4\u63a5\u8bbf\u95ee\uff08FAT \u9664\u5916\uff09\uff0c\u7d22\u5f15\u7684\u65b9\u5f0f\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u7d22\u5f15\u7684\u5b9e\u73b0\u662f\u4e3a\u6bcf\u4e2a\u6587\u4ef6\u521b\u5efa\u4e00\u4e2a\u300c\u7d22\u5f15\u6570\u636e\u5757\u300d\uff0c\u91cc\u9762\u5b58\u653e\u7684\u662f\u6307\u5411\u6587\u4ef6\u6570\u636e\u5757\u7684\u6307\u9488\u5217\u8868\uff0c\u8bf4\u767d\u4e86\u5c31\u50cf\u4e66\u7684\u76ee\u5f55\u4e00\u6837\uff0c\u8981\u627e\u54ea\u4e2a\u7ae0\u8282\u7684\u5185\u5bb9\uff0c\u770b\u76ee\u5f55\u67e5\u5c31\u53ef\u4ee5\u3002</p> <p>\u53e6\u5916\uff0c\u6587\u4ef6\u5934\u9700\u8981\u5305\u542b\u6307\u5411\u300c\u7d22\u5f15\u6570\u636e\u5757\u300d\u7684\u6307\u9488\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u901a\u8fc7\u6587\u4ef6\u5934\u77e5\u9053\u7d22\u5f15\u6570\u636e\u5757\u7684\u4f4d\u7f6e\uff0c\u518d\u901a\u8fc7\u7d22\u5f15\u6570\u636e\u5757\u91cc\u7684\u7d22\u5f15\u4fe1\u606f\u627e\u5230\u5bf9\u5e94\u7684\u6570\u636e\u5757\u3002</p> <p>\u521b\u5efa\u6587\u4ef6\u65f6\uff0c\u7d22\u5f15\u5757\u7684\u6240\u6709\u6307\u9488\u90fd\u8bbe\u4e3a\u7a7a\u3002\u5f53\u9996\u6b21\u5199\u5165\u7b2c i \u5757\u65f6\uff0c\u5148\u4ece\u7a7a\u95f2\u7a7a\u95f4\u4e2d\u53d6\u5f97\u4e00\u4e2a\u5757\uff0c\u518d\u5c06\u5176\u5730\u5740\u5199\u5230\u7d22\u5f15\u5757\u7684\u7b2c i \u4e2a\u6761\u76ee\u3002</p> <p></p> <p>\u7d22\u5f15\u7684\u65b9\u5f0f\u4f18\u70b9\u5728\u4e8e\uff1a</p> <ul> <li>\u6587\u4ef6\u7684\u521b\u5efa\u3001\u589e\u5927\u3001\u7f29\u5c0f\u5f88\u65b9\u4fbf\uff1b</li> <li>\u4e0d\u4f1a\u6709\u788e\u7247\u7684\u95ee\u9898\uff1b</li> <li>\u652f\u6301\u987a\u5e8f\u8bfb\u5199\u548c\u968f\u673a\u8bfb\u5199\uff1b</li> </ul> <p>\u7531\u4e8e\u7d22\u5f15\u6570\u636e\u4e5f\u662f\u5b58\u653e\u5728\u78c1\u76d8\u5757\u7684\uff0c\u5982\u679c\u6587\u4ef6\u5f88\u5c0f\uff0c\u660e\u660e\u53ea\u9700\u4e00\u5757\u5c31\u53ef\u4ee5\u5b58\u653e\u7684\u4e0b\uff0c\u4f46\u8fd8\u662f\u9700\u8981\u989d\u5916\u5206\u914d\u4e00\u5757\u6765\u5b58\u653e\u7d22\u5f15\u6570\u636e\uff0c\u6240\u4ee5\u7f3a\u9677\u4e4b\u4e00\u5c31\u662f\u5b58\u50a8\u7d22\u5f15\u5e26\u6765\u7684\u5f00\u9500\u3002</p> <p>\u5982\u679c\u6587\u4ef6\u5f88\u5927\uff0c\u5927\u5230\u4e00\u4e2a\u7d22\u5f15\u6570\u636e\u5757\u653e\u4e0d\u4e0b\u7d22\u5f15\u4fe1\u606f\uff0c\u8fd9\u65f6\u53c8\u8981\u5982\u4f55\u5904\u7406\u5927\u6587\u4ef6\u7684\u5b58\u653e\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u7ec4\u5408\u7684\u65b9\u5f0f\uff0c\u6765\u5904\u7406\u5927\u6587\u4ef6\u7684\u5b58\u3002</p> <p>\u5148\u6765\u770b\u770b\u94fe\u8868 + \u7d22\u5f15\u7684\u7ec4\u5408\uff0c\u8fd9\u79cd\u7ec4\u5408\u79f0\u4e3a\u300c\u94fe\u5f0f\u7d22\u5f15\u5757\u300d\uff0c\u5b83\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u5728\u7d22\u5f15\u6570\u636e\u5757\u7559\u51fa\u4e00\u4e2a\u5b58\u653e\u4e0b\u4e00\u4e2a\u7d22\u5f15\u6570\u636e\u5757\u7684\u6307\u9488\uff0c\u4e8e\u662f\u5f53\u4e00\u4e2a\u7d22\u5f15\u6570\u636e\u5757\u7684\u7d22\u5f15\u4fe1\u606f\u7528\u5b8c\u4e86\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u6307\u9488\u7684\u65b9\u5f0f\uff0c\u627e\u5230\u4e0b\u4e00\u4e2a\u7d22\u5f15\u6570\u636e\u5757\u7684\u4fe1\u606f\u3002\u90a3\u8fd9\u79cd\u65b9\u5f0f\u4e5f\u4f1a\u51fa\u73b0\u524d\u9762\u63d0\u5230\u7684\u94fe\u8868\u65b9\u5f0f\u7684\u95ee\u9898\uff0c\u4e07\u4e00\u67d0\u4e2a\u6307\u9488\u635f\u574f\u4e86\uff0c\u540e\u9762\u7684\u6570\u636e\u4e5f\u5c31\u4f1a\u65e0\u6cd5\u8bfb\u53d6\u4e86\u3002</p> <p></p> <p>\u8fd8\u6709\u53e6\u5916\u4e00\u79cd\u7ec4\u5408\u65b9\u5f0f\u662f\u7d22\u5f15 + \u7d22\u5f15\u7684\u65b9\u5f0f\uff0c\u8fd9\u79cd\u7ec4\u5408\u79f0\u4e3a\u300c\u591a\u7ea7\u7d22\u5f15\u5757\u300d\uff0c\u5b9e\u73b0\u65b9\u5f0f\u662f\u901a\u8fc7\u4e00\u4e2a\u7d22\u5f15\u5757\u6765\u5b58\u653e\u591a\u4e2a\u7d22\u5f15\u6570\u636e\u5757\uff0c\u4e00\u5c42\u5957\u4e00\u5c42\u7d22\u5f15\uff0c\u50cf\u6781\u4e86\u4fc4\u7f57\u65af\u5957\u5a03\u662f\u5427\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#unix","title":"Unix \u6587\u4ef6\u7684\u5b9e\u73b0\u65b9\u5f0f","text":"<p>\u6211\u4eec\u5148\u628a\u524d\u9762\u63d0\u5230\u7684\u6587\u4ef6\u5b9e\u73b0\u65b9\u5f0f\uff0c\u505a\u4e2a\u6bd4\u8f83\uff1a</p> <p></p> <p>\u90a3\u65e9\u671f Unix \u6587\u4ef6\u7cfb\u7edf\u662f\u7ec4\u5408\u4e86\u524d\u9762\u7684\u6587\u4ef6\u5b58\u653e\u65b9\u5f0f\u7684\u4f18\u70b9\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5b83\u662f\u6839\u636e\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u5b58\u653e\u7684\u65b9\u5f0f\u4f1a\u6709\u6240\u53d8\u5316\uff1a</p> <ul> <li>\u5982\u679c\u5b58\u653e\u6587\u4ef6\u6240\u9700\u7684\u6570\u636e\u5757\u5c0f\u4e8e 10 \u5757\uff0c\u5219\u91c7\u7528\u76f4\u63a5\u67e5\u627e\u7684\u65b9\u5f0f\uff1b</li> <li>\u5982\u679c\u5b58\u653e\u6587\u4ef6\u6240\u9700\u7684\u6570\u636e\u5757\u8d85\u8fc7 10 \u5757\uff0c\u5219\u91c7\u7528\u4e00\u7ea7\u95f4\u63a5\u7d22\u5f15\u65b9\u5f0f\uff1b</li> <li>\u5982\u679c\u524d\u9762\u4e24\u79cd\u65b9\u5f0f\u90fd\u4e0d\u591f\u5b58\u653e\u5927\u6587\u4ef6\uff0c\u5219\u91c7\u7528\u4e8c\u7ea7\u95f4\u63a5\u7d22\u5f15\u65b9\u5f0f\uff1b</li> <li>\u5982\u679c\u4e8c\u7ea7\u95f4\u63a5\u7d22\u5f15\u4e5f\u4e0d\u591f\u5b58\u653e\u5927\u6587\u4ef6\uff0c\u8fd9\u91c7\u7528\u4e09\u7ea7\u95f4\u63a5\u7d22\u5f15\u65b9\u5f0f\uff1b</li> </ul> <p>\u90a3\u4e48\uff0c\u6587\u4ef6\u5934\uff08Inode\uff09\u5c31\u9700\u8981\u5305\u542b 13 \u4e2a\u6307\u9488\uff1a</p> <ul> <li>10 \u4e2a\u6307\u5411\u6570\u636e\u5757\u7684\u6307\u9488\uff1b</li> <li>\u7b2c 11 \u4e2a\u6307\u5411\u7d22\u5f15\u5757\u7684\u6307\u9488\uff1b</li> <li>\u7b2c 12 \u4e2a\u6307\u5411\u4e8c\u7ea7\u7d22\u5f15\u5757\u7684\u6307\u9488\uff1b</li> <li>\u7b2c 13 \u4e2a\u6307\u5411\u4e09\u7ea7\u7d22\u5f15\u5757\u7684\u6307\u9488\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u8fd9\u79cd\u65b9\u5f0f\u80fd\u5f88\u7075\u6d3b\u5730\u652f\u6301\u5c0f\u6587\u4ef6\u548c\u5927\u6587\u4ef6\u7684\u5b58\u653e\uff1a</p> <ul> <li>\u5bf9\u4e8e\u5c0f\u6587\u4ef6\u4f7f\u7528\u76f4\u63a5\u67e5\u627e\u7684\u65b9\u5f0f\u53ef\u51cf\u5c11\u7d22\u5f15\u6570\u636e\u5757\u7684\u5f00\u9500\uff1b</li> <li>\u5bf9\u4e8e\u5927\u6587\u4ef6\u5219\u4ee5\u591a\u7ea7\u7d22\u5f15\u7684\u65b9\u5f0f\u6765\u652f\u6301\uff0c\u6240\u4ee5\u5927\u6587\u4ef6\u5728\u8bbf\u95ee\u6570\u636e\u5757\u65f6\u9700\u8981\u5927\u91cf\u67e5\u8be2\uff1b</li> </ul> <p>\u8fd9\u4e2a\u65b9\u6848\u5c31\u7528\u5728\u4e86 Linux Ext 2/3 \u6587\u4ef6\u7cfb\u7edf\u91cc\uff0c\u867d\u7136\u89e3\u51b3\u5927\u6587\u4ef6\u7684\u5b58\u50a8\uff0c\u4f46\u662f\u5bf9\u4e8e\u5927\u6587\u4ef6\u7684\u8bbf\u95ee\uff0c\u9700\u8981\u5927\u91cf\u7684\u67e5\u8be2\uff0c\u6548\u7387\u6bd4\u8f83\u4f4e\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cExt 4 \u505a\u4e86\u4e00\u5b9a\u7684\u6539\u53d8\uff0c\u5177\u4f53\u600e\u4e48\u89e3\u51b3\u7684\uff0c\u672c\u6587\u5c31\u4e0d\u5c55\u5f00\u4e86\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_7","title":"\u7a7a\u95f2\u7a7a\u95f4\u7ba1\u7406","text":"<p>\u524d\u9762\u8bf4\u5230\u7684\u6587\u4ef6\u7684\u5b58\u50a8\u662f\u9488\u5bf9\u5df2\u7ecf\u88ab\u5360\u7528\u7684\u6570\u636e\u5757\u7ec4\u7ec7\u548c\u7ba1\u7406\uff0c\u63a5\u4e0b\u6765\u7684\u95ee\u9898\u662f\uff0c\u5982\u679c\u6211\u8981\u4fdd\u5b58\u4e00\u4e2a\u6570\u636e\u5757\uff0c\u6211\u5e94\u8be5\u653e\u5728\u786c\u76d8\u4e0a\u7684\u54ea\u4e2a\u4f4d\u7f6e\u5462\uff1f\u96be\u9053\u9700\u8981\u5c06\u6240\u6709\u7684\u5757\u626b\u63cf\u4e00\u904d\uff0c\u627e\u4e2a\u7a7a\u7684\u5730\u65b9\u968f\u4fbf\u653e\u5417\uff1f</p> <p>\u90a3\u8fd9\u79cd\u65b9\u5f0f\u6548\u7387\u5c31\u592a\u4f4e\u4e86\uff0c\u6240\u4ee5\u9488\u5bf9\u78c1\u76d8\u7684\u7a7a\u95f2\u7a7a\u95f4\u4e5f\u662f\u8981\u5f15\u5165\u7ba1\u7406\u7684\u673a\u5236\uff0c\u63a5\u4e0b\u6765\u4ecb\u7ecd\u51e0\u79cd\u5e38\u89c1\u7684\u65b9\u6cd5\uff1a</p> <ul> <li>\u7a7a\u95f2\u8868\u6cd5</li> <li>\u7a7a\u95f2\u94fe\u8868\u6cd5</li> <li>\u4f4d\u56fe\u6cd5</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_8","title":"\u7a7a\u95f2\u8868\u6cd5","text":"<p>\u7a7a\u95f2\u8868\u6cd5\u5c31\u662f\u4e3a\u6240\u6709\u7a7a\u95f2\u7a7a\u95f4\u5efa\u7acb\u4e00\u5f20\u8868\uff0c\u8868\u5185\u5bb9\u5305\u62ec\u7a7a\u95f2\u533a\u7684\u7b2c\u4e00\u4e2a\u5757\u53f7\u548c\u8be5\u7a7a\u95f2\u533a\u7684\u5757\u4e2a\u6570\uff0c\u6ce8\u610f\uff0c\u8fd9\u4e2a\u65b9\u5f0f\u662f\u8fde\u7eed\u5206\u914d\u7684\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5f53\u8bf7\u6c42\u5206\u914d\u78c1\u76d8\u7a7a\u95f4\u65f6\uff0c\u7cfb\u7edf\u4f9d\u6b21\u626b\u63cf\u7a7a\u95f2\u8868\u91cc\u7684\u5185\u5bb9\uff0c\u76f4\u5230\u627e\u5230\u4e00\u4e2a\u5408\u9002\u7684\u7a7a\u95f2\u533a\u57df\u4e3a\u6b62\u3002\u5f53\u7528\u6237\u64a4\u9500\u4e00\u4e2a\u6587\u4ef6\u65f6\uff0c\u7cfb\u7edf\u56de\u6536\u6587\u4ef6\u7a7a\u95f4\u3002\u8fd9\u65f6\uff0c\u4e5f\u9700\u987a\u5e8f\u626b\u63cf\u7a7a\u95f2\u8868\uff0c\u5bfb\u627e\u4e00\u4e2a\u7a7a\u95f2\u8868\u6761\u76ee\u5e76\u5c06\u91ca\u653e\u7a7a\u95f4\u7684\u7b2c\u4e00\u4e2a\u7269\u7406\u5757\u53f7\u53ca\u5b83\u5360\u7528\u7684\u5757\u6570\u586b\u5230\u8fd9\u4e2a\u6761\u76ee\u4e2d\u3002</p> <p>\u8fd9\u79cd\u65b9\u6cd5\u4ec5\u5f53\u6709\u5c11\u91cf\u7684\u7a7a\u95f2\u533a\u65f6\u624d\u6709\u8f83\u597d\u7684\u6548\u679c\u3002\u56e0\u4e3a\uff0c\u5982\u679c\u5b58\u50a8\u7a7a\u95f4\u4e2d\u6709\u7740\u5927\u91cf\u7684\u5c0f\u7684\u7a7a\u95f2\u533a\uff0c\u5219\u7a7a\u95f2\u8868\u53d8\u5f97\u5f88\u5927\uff0c\u8fd9\u6837\u67e5\u8be2\u6548\u7387\u4f1a\u5f88\u4f4e\u3002\u53e6\u5916\uff0c\u8fd9\u79cd\u5206\u914d\u6280\u672f\u9002\u7528\u4e8e\u5efa\u7acb\u8fde\u7eed\u6587\u4ef6\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_9","title":"\u7a7a\u95f2\u94fe\u8868\u6cd5","text":"<p>\u6211\u4eec\u4e5f\u53ef\u4ee5\u4f7f\u7528\u300c\u94fe\u8868\u300d\u7684\u65b9\u5f0f\u6765\u7ba1\u7406\u7a7a\u95f2\u7a7a\u95f4\uff0c\u6bcf\u4e00\u4e2a\u7a7a\u95f2\u5757\u91cc\u6709\u4e00\u4e2a\u6307\u9488\u6307\u5411\u4e0b\u4e00\u4e2a\u7a7a\u95f2\u5757\uff0c\u8fd9\u6837\u4e5f\u80fd\u5f88\u65b9\u4fbf\u7684\u627e\u5230\u7a7a\u95f2\u5757\u5e76\u7ba1\u7406\u8d77\u6765\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5f53\u521b\u5efa\u6587\u4ef6\u9700\u8981\u4e00\u5757\u6216\u51e0\u5757\u65f6\uff0c\u5c31\u4ece\u94fe\u5934\u4e0a\u4f9d\u6b21\u53d6\u4e0b\u4e00\u5757\u6216\u51e0\u5757\u3002\u53cd\u4e4b\uff0c\u5f53\u56de\u6536\u7a7a\u95f4\u65f6\uff0c\u628a\u8fd9\u4e9b\u7a7a\u95f2\u5757\u4f9d\u6b21\u63a5\u5230\u94fe\u5934\u4e0a\u3002</p> <p>\u8fd9\u79cd\u6280\u672f\u53ea\u8981\u5728\u4e3b\u5b58\u4e2d\u4fdd\u5b58\u4e00\u4e2a\u6307\u9488\uff0c\u4ee4\u5b83\u6307\u5411\u7b2c\u4e00\u4e2a\u7a7a\u95f2\u5757\u3002\u5176\u7279\u70b9\u662f\u7b80\u5355\uff0c\u4f46\u4e0d\u80fd\u968f\u673a\u8bbf\u95ee\uff0c\u5de5\u4f5c\u6548\u7387\u4f4e\uff0c\u56e0\u4e3a\u6bcf\u5f53\u5728\u94fe\u4e0a\u589e\u52a0\u6216\u79fb\u52a8\u7a7a\u95f2\u5757\u65f6\u9700\u8981\u505a\u5f88\u591a I/O \u64cd\u4f5c\uff0c\u540c\u65f6\u6570\u636e\u5757\u7684\u6307\u9488\u6d88\u8017\u4e86\u4e00\u5b9a\u7684\u5b58\u50a8\u7a7a\u95f4\u3002</p> <p>\u7a7a\u95f2\u8868\u6cd5\u548c\u7a7a\u95f2\u94fe\u8868\u6cd5\u90fd\u4e0d\u9002\u5408\u7528\u4e8e\u5927\u578b\u6587\u4ef6\u7cfb\u7edf\uff0c\u56e0\u4e3a\u8fd9\u4f1a\u4f7f\u7a7a\u95f2\u8868\u6216\u7a7a\u95f2\u94fe\u8868\u592a\u5927\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_10","title":"\u4f4d\u56fe\u6cd5","text":"<p>\u4f4d\u56fe\u662f\u5229\u7528\u4e8c\u8fdb\u5236\u7684\u4e00\u4f4d\u6765\u8868\u793a\u78c1\u76d8\u4e2d\u4e00\u4e2a\u76d8\u5757\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u78c1\u76d8\u4e0a\u6240\u6709\u7684\u76d8\u5757\u90fd\u6709\u4e00\u4e2a\u4e8c\u8fdb\u5236\u4f4d\u4e0e\u4e4b\u5bf9\u5e94\u3002</p> <p>\u5f53\u503c\u4e3a 0 \u65f6\uff0c\u8868\u793a\u5bf9\u5e94\u7684\u76d8\u5757\u7a7a\u95f2\uff0c\u503c\u4e3a 1 \u65f6\uff0c\u8868\u793a\u5bf9\u5e94\u7684\u76d8\u5757\u5df2\u5206\u914d\u3002\u5b83\u5f62\u5f0f\u5982\u4e0b\uff1a</p> Text Only<pre><code>1111110011111110001110110111111100111 ...\n</code></pre> <p>\u5728 Linux \u6587\u4ef6\u7cfb\u7edf\u5c31\u91c7\u7528\u4e86\u4f4d\u56fe\u7684\u65b9\u5f0f\u6765\u7ba1\u7406\u7a7a\u95f2\u7a7a\u95f4\uff0c\u4e0d\u4ec5\u7528\u4e8e\u6570\u636e\u7a7a\u95f2\u5757\u7684\u7ba1\u7406\uff0c\u8fd8\u7528\u4e8e inode \u7a7a\u95f2\u5757\u7684\u7ba1\u7406\uff0c\u56e0\u4e3a inode \u4e5f\u662f\u5b58\u50a8\u5728\u78c1\u76d8\u7684\uff0c\u81ea\u7136\u4e5f\u8981\u6709\u5bf9\u5176\u7ba1\u7406\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_11","title":"\u6587\u4ef6\u7cfb\u7edf\u7684\u7ed3\u6784","text":"<p>\u524d\u9762\u63d0\u5230 Linux \u662f\u7528\u4f4d\u56fe\u7684\u65b9\u5f0f\u7ba1\u7406\u7a7a\u95f2\u7a7a\u95f4\uff0c\u7528\u6237\u5728\u521b\u5efa\u4e00\u4e2a\u65b0\u6587\u4ef6\u65f6\uff0cLinux \u5185\u6838\u4f1a\u901a\u8fc7 inode \u7684\u4f4d\u56fe\u627e\u5230\u7a7a\u95f2\u53ef\u7528\u7684 inode\uff0c\u5e76\u8fdb\u884c\u5206\u914d\u3002\u8981\u5b58\u50a8\u6570\u636e\u65f6\uff0c\u4f1a\u901a\u8fc7\u5757\u7684\u4f4d\u56fe\u627e\u5230\u7a7a\u95f2\u7684\u5757\uff0c\u5e76\u5206\u914d\uff0c\u4f46\u4ed4\u7ec6\u8ba1\u7b97\u4e00\u4e0b\u8fd8\u662f\u6709\u95ee\u9898\u7684\u3002</p> <p>\u6570\u636e\u5757\u7684\u4f4d\u56fe\u662f\u653e\u5728\u78c1\u76d8\u5757\u91cc\u7684\uff0c\u5047\u8bbe\u662f\u653e\u5728\u4e00\u4e2a\u5757\u91cc\uff0c\u4e00\u4e2a\u5757 4K\uff0c\u6bcf\u4f4d\u8868\u793a\u4e00\u4e2a\u6570\u636e\u5757\uff0c\u5171\u53ef\u4ee5\u8868\u793a <code>4 * 1024 * 8 = 2^15</code> \u4e2a\u7a7a\u95f2\u5757\uff0c\u7531\u4e8e 1 \u4e2a\u6570\u636e\u5757\u662f 4K \u5927\u5c0f\uff0c\u90a3\u4e48\u6700\u5927\u53ef\u4ee5\u8868\u793a\u7684\u7a7a\u95f4\u4e3a <code>2^15 * 4 * 1024 = 2^27</code> \u4e2a byte\uff0c\u4e5f\u5c31\u662f 128M\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u6309\u7167\u4e0a\u9762\u7684\u7ed3\u6784\uff0c\u5982\u679c\u91c7\u7528\u300c\u4e00\u4e2a\u5757\u7684\u4f4d\u56fe + \u4e00\u7cfb\u5217\u7684\u5757\u300d\uff0c\u5916\u52a0\u300c\u4e00\u4e2a\u5757\u7684 inode \u7684\u4f4d\u56fe + \u4e00\u7cfb\u5217\u7684 inode \u7684\u7ed3\u6784\u300d\u80fd\u8868\u793a\u7684\u6700\u5927\u7a7a\u95f4\u4e5f\u5c31 128M\uff0c\u8fd9\u592a\u5c11\u4e86\uff0c\u73b0\u5728\u5f88\u591a\u6587\u4ef6\u90fd\u6bd4\u8fd9\u4e2a\u5927\u3002</p> <p>\u5728 Linux \u6587\u4ef6\u7cfb\u7edf\uff0c\u628a\u8fd9\u4e2a\u7ed3\u6784\u79f0\u4e3a\u4e00\u4e2a\u5757\u7ec4\uff0c\u90a3\u4e48\u6709 N \u591a\u7684\u5757\u7ec4\uff0c\u5c31\u80fd\u591f\u8868\u793a N \u5927\u7684\u6587\u4ef6\u3002</p> <p>\u4e0b\u56fe\u7ed9\u51fa\u4e86 Linux Ext2 \u6574\u4e2a\u6587\u4ef6\u7cfb\u7edf\u7684\u7ed3\u6784\u548c\u5757\u7ec4\u7684\u5185\u5bb9\uff0c\u6587\u4ef6\u7cfb\u7edf\u90fd\u7531\u5927\u91cf\u5757\u7ec4\u7ec4\u6210\uff0c\u5728\u786c\u76d8\u4e0a\u76f8\u7ee7\u6392\u5e03\uff1a</p> <p></p> <p>\u6700\u524d\u9762\u7684\u7b2c\u4e00\u4e2a\u5757\u662f\u5f15\u5bfc\u5757\uff0c\u5728\u7cfb\u7edf\u542f\u52a8\u65f6\u7528\u4e8e\u542f\u7528\u5f15\u5bfc\uff0c\u63a5\u7740\u540e\u9762\u5c31\u662f\u4e00\u4e2a\u4e00\u4e2a\u8fde\u7eed\u7684\u5757\u7ec4\u4e86\uff0c\u5757\u7ec4\u7684\u5185\u5bb9\u5982\u4e0b\uff1a</p> <ul> <li>\u8d85\u7ea7\u5757\uff0c\u5305\u542b\u7684\u662f\u6587\u4ef6\u7cfb\u7edf\u7684\u91cd\u8981\u4fe1\u606f\uff0c\u6bd4\u5982 inode \u603b\u4e2a\u6570\u3001\u5757\u603b\u4e2a\u6570\u3001\u6bcf\u4e2a\u5757\u7ec4\u7684 inode \u4e2a\u6570\u3001\u6bcf\u4e2a\u5757\u7ec4\u7684\u5757\u4e2a\u6570\u7b49\u7b49\u3002</li> <li>\u5757\u7ec4\u63cf\u8ff0\u7b26\uff0c\u5305\u542b\u6587\u4ef6\u7cfb\u7edf\u4e2d\u5404\u4e2a\u5757\u7ec4\u7684\u72b6\u6001\uff0c\u6bd4\u5982\u5757\u7ec4\u4e2d\u7a7a\u95f2\u5757\u548c inode \u7684\u6570\u76ee\u7b49\uff0c\u6bcf\u4e2a\u5757\u7ec4\u90fd\u5305\u542b\u4e86\u6587\u4ef6\u7cfb\u7edf\u4e2d\u300c\u6240\u6709\u5757\u7ec4\u7684\u7ec4\u63cf\u8ff0\u7b26\u4fe1\u606f\u300d\u3002</li> <li>\u6570\u636e\u4f4d\u56fe\u548c inode \u4f4d\u56fe\uff0c\u7528\u4e8e\u8868\u793a\u5bf9\u5e94\u7684\u6570\u636e\u5757\u6216 inode \u662f\u7a7a\u95f2\u7684\uff0c\u8fd8\u662f\u88ab\u4f7f\u7528\u4e2d\u3002</li> <li>inode \u5217\u8868\uff0c\u5305\u542b\u4e86\u5757\u7ec4\u4e2d\u6240\u6709\u7684 inode\uff0cinode \u7528\u4e8e\u4fdd\u5b58\u6587\u4ef6\u7cfb\u7edf\u4e2d\u4e0e\u5404\u4e2a\u6587\u4ef6\u548c\u76ee\u5f55\u76f8\u5173\u7684\u6240\u6709\u5143\u6570\u636e\u3002</li> <li>\u6570\u636e\u5757\uff0c\u5305\u542b\u6587\u4ef6\u7684\u6709\u7528\u6570\u636e\u3002</li> </ul> <p>\u4f60\u53ef\u4ee5\u4f1a\u53d1\u73b0\u6bcf\u4e2a\u5757\u7ec4\u91cc\u6709\u5f88\u591a\u91cd\u590d\u7684\u4fe1\u606f\uff0c\u6bd4\u5982\u8d85\u7ea7\u5757\u548c\u5757\u7ec4\u63cf\u8ff0\u7b26\u8868\uff0c\u8fd9\u4e24\u4e2a\u90fd\u662f\u5168\u5c40\u4fe1\u606f\uff0c\u800c\u4e14\u975e\u5e38\u7684\u91cd\u8981\uff0c\u8fd9\u4e48\u505a\u662f\u6709\u4e24\u4e2a\u539f\u56e0\uff1a</p> <ul> <li>\u5982\u679c\u7cfb\u7edf\u5d29\u6e83\u7834\u574f\u4e86\u8d85\u7ea7\u5757\u6216\u5757\u7ec4\u63cf\u8ff0\u7b26\uff0c\u6709\u5173\u6587\u4ef6\u7cfb\u7edf\u7ed3\u6784\u548c\u5185\u5bb9\u7684\u6240\u6709\u4fe1\u606f\u90fd\u4f1a\u4e22\u5931\u3002\u5982\u679c\u6709\u5197\u4f59\u7684\u526f\u672c\uff0c\u8be5\u4fe1\u606f\u662f\u53ef\u80fd\u6062\u590d\u7684\u3002</li> <li>\u901a\u8fc7\u4f7f\u6587\u4ef6\u548c\u7ba1\u7406\u6570\u636e\u5c3d\u53ef\u80fd\u63a5\u8fd1\uff0c\u51cf\u5c11\u4e86\u78c1\u5934\u5bfb\u9053\u548c\u65cb\u8f6c\uff0c\u8fd9\u53ef\u4ee5\u63d0\u9ad8\u6587\u4ef6\u7cfb\u7edf\u7684\u6027\u80fd\u3002</li> </ul> <p>\u4e0d\u8fc7\uff0cExt2 \u7684\u540e\u7eed\u7248\u672c\u91c7\u7528\u4e86\u7a00\u758f\u6280\u672f\u3002\u8be5\u505a\u6cd5\u662f\uff0c\u8d85\u7ea7\u5757\u548c\u5757\u7ec4\u63cf\u8ff0\u7b26\u8868\u4e0d\u518d\u5b58\u50a8\u5230\u6587\u4ef6\u7cfb\u7edf\u7684\u6bcf\u4e2a\u5757\u7ec4\u4e2d\uff0c\u800c\u662f\u53ea\u5199\u5165\u5230\u5757\u7ec4 0\u3001\u5757\u7ec4 1 \u548c\u5176\u4ed6 ID \u53ef\u4ee5\u8868\u793a\u4e3a 3\u30015\u30017 \u7684\u5e42\u7684\u5757\u7ec4\u4e2d\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_12","title":"\u76ee\u5f55\u7684\u5b58\u50a8","text":"<p>\u5728\u524d\u9762\uff0c\u6211\u4eec\u77e5\u9053\u4e86\u4e00\u4e2a\u666e\u901a\u6587\u4ef6\u662f\u5982\u4f55\u5b58\u50a8\u7684\uff0c\u4f46\u8fd8\u6709\u4e00\u4e2a\u7279\u6b8a\u7684\u6587\u4ef6\uff0c\u7ecf\u5e38\u7528\u5230\u7684\u76ee\u5f55\uff0c\u5b83\u662f\u5982\u4f55\u4fdd\u5b58\u7684\u5462\uff1f</p> <p>\u57fa\u4e8e Linux \u4e00\u5207\u7686\u6587\u4ef6\u7684\u8bbe\u8ba1\u601d\u60f3\uff0c\u76ee\u5f55\u5176\u5b9e\u4e5f\u662f\u4e2a\u6587\u4ef6\uff0c\u4f60\u751a\u81f3\u53ef\u4ee5\u901a\u8fc7 <code>vim</code> \u6253\u5f00\u5b83\uff0c\u5b83\u4e5f\u6709 inode\uff0cinode \u91cc\u9762\u4e5f\u662f\u6307\u5411\u4e00\u4e9b\u5757\u3002</p> <p>\u548c\u666e\u901a\u6587\u4ef6\u4e0d\u540c\u7684\u662f\uff0c\u666e\u901a\u6587\u4ef6\u7684\u5757\u91cc\u9762\u4fdd\u5b58\u7684\u662f\u6587\u4ef6\u6570\u636e\uff0c\u800c\u76ee\u5f55\u6587\u4ef6\u7684\u5757\u91cc\u9762\u4fdd\u5b58\u7684\u662f\u76ee\u5f55\u91cc\u9762\u4e00\u9879\u4e00\u9879\u7684\u6587\u4ef6\u4fe1\u606f\u3002</p> <p>\u5728\u76ee\u5f55\u6587\u4ef6\u7684\u5757\u4e2d\uff0c\u6700\u7b80\u5355\u7684\u4fdd\u5b58\u683c\u5f0f\u5c31\u662f\u5217\u8868\uff0c\u5c31\u662f\u4e00\u9879\u4e00\u9879\u5730\u5c06\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u4fe1\u606f\uff08\u5982\u6587\u4ef6\u540d\u3001\u6587\u4ef6 inode\u3001\u6587\u4ef6\u7c7b\u578b\u7b49\uff09\u5217\u5728\u8868\u91cc\u3002</p> <p>\u5217\u8868\u4e2d\u6bcf\u4e00\u9879\u5c31\u4ee3\u8868\u8be5\u76ee\u5f55\u4e0b\u7684\u6587\u4ef6\u7684\u6587\u4ef6\u540d\u548c\u5bf9\u5e94\u7684 inode\uff0c\u901a\u8fc7\u8fd9\u4e2a inode\uff0c\u5c31\u53ef\u4ee5\u627e\u5230\u771f\u6b63\u7684\u6587\u4ef6\u3002</p> <p></p> <p>\u901a\u5e38\uff0c\u7b2c\u4e00\u9879\u662f\u300c<code>.</code>\u300d\uff0c\u8868\u793a\u5f53\u524d\u76ee\u5f55\uff0c\u7b2c\u4e8c\u9879\u662f\u300c<code>..</code>\u300d\uff0c\u8868\u793a\u4e0a\u4e00\u7ea7\u76ee\u5f55\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u4e00\u9879\u4e00\u9879\u7684\u6587\u4ef6\u540d\u548c inode\u3002</p> <p>\u5982\u679c\u4e00\u4e2a\u76ee\u5f55\u6709\u8d85\u7ea7\u591a\u7684\u6587\u4ef6\uff0c\u6211\u4eec\u8981\u60f3\u5728\u8fd9\u4e2a\u76ee\u5f55\u4e0b\u627e\u6587\u4ef6\uff0c\u6309\u7167\u5217\u8868\u4e00\u9879\u4e00\u9879\u7684\u627e\uff0c\u6548\u7387\u5c31\u4e0d\u9ad8\u4e86\u3002</p> <p>\u4e8e\u662f\uff0c\u4fdd\u5b58\u76ee\u5f55\u7684\u683c\u5f0f\u6539\u6210\u54c8\u5e0c\u8868\uff0c\u5bf9\u6587\u4ef6\u540d\u8fdb\u884c\u54c8\u5e0c\u8ba1\u7b97\uff0c\u628a\u54c8\u5e0c\u503c\u4fdd\u5b58\u8d77\u6765\uff0c\u5982\u679c\u6211\u4eec\u8981\u67e5\u627e\u4e00\u4e2a\u76ee\u5f55\u4e0b\u9762\u7684\u6587\u4ef6\u540d\uff0c\u53ef\u4ee5\u901a\u8fc7\u540d\u79f0\u53d6\u54c8\u5e0c\u3002\u5982\u679c\u54c8\u5e0c\u80fd\u591f\u5339\u914d\u4e0a\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e2a\u6587\u4ef6\u7684\u4fe1\u606f\u5728\u76f8\u5e94\u7684\u5757\u91cc\u9762\u3002</p> <p>Linux \u7cfb\u7edf\u7684 ext \u6587\u4ef6\u7cfb\u7edf\u5c31\u662f\u91c7\u7528\u4e86\u54c8\u5e0c\u8868\uff0c\u6765\u4fdd\u5b58\u76ee\u5f55\u7684\u5185\u5bb9\uff0c\u8fd9\u79cd\u65b9\u6cd5\u7684\u4f18\u70b9\u662f\u67e5\u627e\u975e\u5e38\u8fc5\u901f\uff0c\u63d2\u5165\u548c\u5220\u9664\u4e5f\u8f83\u7b80\u5355\uff0c\u4e0d\u8fc7\u9700\u8981\u4e00\u4e9b\u9884\u5907\u63aa\u65bd\u6765\u907f\u514d\u54c8\u5e0c\u51b2\u7a81\u3002</p> <p>\u76ee\u5f55\u67e5\u8be2\u662f\u901a\u8fc7\u5728\u78c1\u76d8\u4e0a\u53cd\u590d\u641c\u7d22\u5b8c\u6210\uff0c\u9700\u8981\u4e0d\u65ad\u5730\u8fdb\u884c I/O \u64cd\u4f5c\uff0c\u5f00\u9500\u8f83\u5927\u3002\u6240\u4ee5\uff0c\u4e3a\u4e86\u51cf\u5c11 I/O \u64cd\u4f5c\uff0c\u628a\u5f53\u524d\u4f7f\u7528\u7684\u6587\u4ef6\u76ee\u5f55\u7f13\u5b58\u5728\u5185\u5b58\uff0c\u4ee5\u540e\u8981\u4f7f\u7528\u8be5\u6587\u4ef6\u65f6\u53ea\u8981\u5728\u5185\u5b58\u4e2d\u64cd\u4f5c\uff0c\u4ece\u800c\u964d\u4f4e\u4e86\u78c1\u76d8\u64cd\u4f5c\u6b21\u6570\uff0c\u63d0\u9ad8\u4e86\u6587\u4ef6\u7cfb\u7edf\u7684\u8bbf\u95ee\u901f\u5ea6\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_13","title":"\u8f6f\u94fe\u63a5\u548c\u786c\u94fe\u63a5","text":"<p>\u6709\u65f6\u5019\u6211\u4eec\u5e0c\u671b\u7ed9\u67d0\u4e2a\u6587\u4ef6\u53d6\u4e2a\u522b\u540d\uff0c\u90a3\u4e48\u5728 Linux \u4e2d\u53ef\u4ee5\u901a\u8fc7\u786c\u94fe\u63a5\uff08Hard Link\uff09 \u548c\u8f6f\u94fe\u63a5\uff08Symbolic Link\uff09 \u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\uff0c\u5b83\u4eec\u90fd\u662f\u6bd4\u8f83\u7279\u6b8a\u7684\u6587\u4ef6\uff0c\u4f46\u662f\u5b9e\u73b0\u65b9\u5f0f\u4e5f\u662f\u4e0d\u76f8\u540c\u7684\u3002</p> <p>\u786c\u94fe\u63a5\u662f\u591a\u4e2a\u76ee\u5f55\u9879\u4e2d\u7684\u300c\u7d22\u5f15\u8282\u70b9\u300d\u6307\u5411\u4e00\u4e2a\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f\u6307\u5411\u540c\u4e00\u4e2a inode\uff0c\u4f46\u662f inode \u662f\u4e0d\u53ef\u80fd\u8de8\u8d8a\u6587\u4ef6\u7cfb\u7edf\u7684\uff0c\u6bcf\u4e2a\u6587\u4ef6\u7cfb\u7edf\u90fd\u6709\u5404\u81ea\u7684 inode \u6570\u636e\u7ed3\u6784\u548c\u5217\u8868\uff0c\u6240\u4ee5\u786c\u94fe\u63a5\u662f\u4e0d\u53ef\u7528\u4e8e\u8de8\u6587\u4ef6\u7cfb\u7edf\u7684\u3002\u7531\u4e8e\u591a\u4e2a\u76ee\u5f55\u9879\u90fd\u662f\u6307\u5411\u4e00\u4e2a inode\uff0c\u90a3\u4e48\u53ea\u6709\u5220\u9664\u6587\u4ef6\u7684\u6240\u6709\u786c\u94fe\u63a5\u4ee5\u53ca\u6e90\u6587\u4ef6\u65f6\uff0c\u7cfb\u7edf\u624d\u4f1a\u5f7b\u5e95\u5220\u9664\u8be5\u6587\u4ef6\u3002</p> <p></p> <p>\u8f6f\u94fe\u63a5\u76f8\u5f53\u4e8e\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u6587\u4ef6\uff0c\u8fd9\u4e2a\u6587\u4ef6\u6709\u72ec\u7acb\u7684 inode\uff0c\u4f46\u662f\u8fd9\u4e2a\u6587\u4ef6\u7684\u5185\u5bb9\u662f\u53e6\u5916\u4e00\u4e2a\u6587\u4ef6\u7684\u8def\u5f84\uff0c\u6240\u4ee5\u8bbf\u95ee\u8f6f\u94fe\u63a5\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u76f8\u5f53\u4e8e\u8bbf\u95ee\u5230\u4e86\u53e6\u5916\u4e00\u4e2a\u6587\u4ef6\uff0c\u6240\u4ee5\u8f6f\u94fe\u63a5\u662f\u53ef\u4ee5\u8de8\u6587\u4ef6\u7cfb\u7edf\u7684\uff0c\u751a\u81f3\u76ee\u6807\u6587\u4ef6\u88ab\u5220\u9664\u4e86\uff0c\u94fe\u63a5\u6587\u4ef6\u8fd8\u662f\u5728\u7684\uff0c\u53ea\u4e0d\u8fc7\u6307\u5411\u7684\u6587\u4ef6\u627e\u4e0d\u5230\u4e86\u800c\u5df2\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#io","title":"\u6587\u4ef6 I/O","text":"<p>\u6587\u4ef6\u7684\u8bfb\u5199\u65b9\u5f0f\u5404\u6709\u5343\u79cb\uff0c\u5bf9\u4e8e\u6587\u4ef6\u7684 I/O \u5206\u7c7b\u4e5f\u975e\u5e38\u591a\uff0c\u5e38\u89c1\u7684\u6709</p> <ul> <li>\u7f13\u51b2\u4e0e\u975e\u7f13\u51b2 I/O</li> <li>\u76f4\u63a5\u4e0e\u975e\u76f4\u63a5 I/O</li> <li>\u963b\u585e\u4e0e\u975e\u963b\u585e I/O VS \u540c\u6b65\u4e0e\u5f02\u6b65 I/O</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u522b\u5bf9\u8fd9\u4e9b\u5206\u7c7b\u8ba8\u8bba\u8ba8\u8bba\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#io_1","title":"\u7f13\u51b2\u4e0e\u975e\u7f13\u51b2 I/O","text":"<p>\u6587\u4ef6\u64cd\u4f5c\u7684\u6807\u51c6\u5e93\u662f\u53ef\u4ee5\u5b9e\u73b0\u6570\u636e\u7684\u7f13\u5b58\uff0c\u90a3\u4e48\u6839\u636e\u300c\u662f\u5426\u5229\u7528\u6807\u51c6\u5e93\u7f13\u51b2\u300d\uff0c\u53ef\u4ee5\u628a\u6587\u4ef6 I/O \u5206\u4e3a\u7f13\u51b2 I/O \u548c\u975e\u7f13\u51b2 I/O\uff1a</p> <ul> <li>\u7f13\u51b2 I/O\uff0c\u5229\u7528\u7684\u662f\u6807\u51c6\u5e93\u7684\u7f13\u5b58\u5b9e\u73b0\u6587\u4ef6\u7684\u52a0\u901f\u8bbf\u95ee\uff0c\u800c\u6807\u51c6\u5e93\u518d\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8bbf\u95ee\u6587\u4ef6\u3002</li> <li>\u975e\u7f13\u51b2 I/O\uff0c\u76f4\u63a5\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u8bbf\u95ee\u6587\u4ef6\uff0c\u4e0d\u7ecf\u8fc7\u6807\u51c6\u5e93\u7f13\u5b58\u3002</li> </ul> <p>\u8fd9\u91cc\u6240\u8bf4\u7684\u300c\u7f13\u51b2\u300d\u7279\u6307\u6807\u51c6\u5e93\u5185\u90e8\u5b9e\u73b0\u7684\u7f13\u51b2\u3002</p> <p>\u6bd4\u65b9\u8bf4\uff0c\u5f88\u591a\u7a0b\u5e8f\u9047\u5230\u6362\u884c\u65f6\u624d\u771f\u6b63\u8f93\u51fa\uff0c\u800c\u6362\u884c\u524d\u7684\u5185\u5bb9\uff0c\u5176\u5b9e\u5c31\u662f\u88ab\u6807\u51c6\u5e93\u6682\u65f6\u7f13\u5b58\u4e86\u8d77\u6765\uff0c\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\uff0c\u51cf\u5c11\u7cfb\u7edf\u8c03\u7528\u7684\u6b21\u6570\uff0c\u6bd5\u7adf\u7cfb\u7edf\u8c03\u7528\u662f\u6709 CPU \u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5f00\u9500\u7684\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#io_2","title":"\u76f4\u63a5\u4e0e\u975e\u76f4\u63a5 I/O","text":"<p>\u6211\u4eec\u90fd\u77e5\u9053\u78c1\u76d8 I/O \u662f\u975e\u5e38\u6162\u7684\uff0c\u6240\u4ee5 Linux \u5185\u6838\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8 I/O \u6b21\u6570\uff0c\u5728\u7cfb\u7edf\u8c03\u7528\u540e\uff0c\u4f1a\u628a\u7528\u6237\u6570\u636e\u62f7\u8d1d\u5230\u5185\u6838\u4e2d\u7f13\u5b58\u8d77\u6765\uff0c\u8fd9\u4e2a\u5185\u6838\u7f13\u5b58\u7a7a\u95f4\u4e5f\u5c31\u662f\u300c\u9875\u7f13\u5b58\u300d\uff0c\u53ea\u6709\u5f53\u7f13\u5b58\u6ee1\u8db3\u67d0\u4e9b\u6761\u4ef6\u7684\u65f6\u5019\uff0c\u624d\u53d1\u8d77\u78c1\u76d8 I/O \u7684\u8bf7\u6c42\u3002</p> <p>\u90a3\u4e48\uff0c\u6839\u636e\u662f\u300c\u5426\u5229\u7528\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u5b58\u300d\uff0c\u53ef\u4ee5\u628a\u6587\u4ef6 I/O \u5206\u4e3a\u76f4\u63a5 I/O \u4e0e\u975e\u76f4\u63a5 I/O\uff1a</p> <ul> <li>\u76f4\u63a5 I/O\uff0c\u4e0d\u4f1a\u53d1\u751f\u5185\u6838\u7f13\u5b58\u548c\u7528\u6237\u7a0b\u5e8f\u4e4b\u95f4\u6570\u636e\u590d\u5236\uff0c\u800c\u662f\u76f4\u63a5\u7ecf\u8fc7\u6587\u4ef6\u7cfb\u7edf\u8bbf\u95ee\u78c1\u76d8\u3002</li> <li>\u975e\u76f4\u63a5 I/O\uff0c\u8bfb\u64cd\u4f5c\u65f6\uff0c\u6570\u636e\u4ece\u5185\u6838\u7f13\u5b58\u4e2d\u62f7\u8d1d\u7ed9\u7528\u6237\u7a0b\u5e8f\uff0c\u5199\u64cd\u4f5c\u65f6\uff0c\u6570\u636e\u4ece\u7528\u6237\u7a0b\u5e8f\u62f7\u8d1d\u7ed9\u5185\u6838\u7f13\u5b58\uff0c\u518d\u7531\u5185\u6838\u51b3\u5b9a\u4ec0\u4e48\u65f6\u5019\u5199\u5165\u6570\u636e\u5230\u78c1\u76d8\u3002</li> </ul> <p>\u5982\u679c\u4f60\u5728\u4f7f\u7528\u6587\u4ef6\u64cd\u4f5c\u7c7b\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u65f6\uff0c\u6307\u5b9a\u4e86 <code>O_DIRECT</code> \u6807\u5fd7\uff0c\u5219\u8868\u793a\u4f7f\u7528\u76f4\u63a5 I/O\u3002\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\u8fc7\uff0c\u9ed8\u8ba4\u4f7f\u7528\u7684\u662f\u975e\u76f4\u63a5 I/O\u3002</p> <p>\u5982\u679c\u7528\u4e86\u975e\u76f4\u63a5 I/O \u8fdb\u884c\u5199\u6570\u636e\u64cd\u4f5c\uff0c\u5185\u6838\u4ec0\u4e48\u60c5\u51b5\u4e0b\u624d\u4f1a\u628a\u7f13\u5b58\u6570\u636e\u5199\u5165\u5230\u78c1\u76d8\uff1f</p> <p>\u4ee5\u4e0b\u51e0\u79cd\u573a\u666f\u4f1a\u89e6\u53d1\u5185\u6838\u7f13\u5b58\u7684\u6570\u636e\u5199\u5165\u78c1\u76d8\uff1a</p> <ul> <li>\u5728\u8c03\u7528 <code>write</code> \u7684\u6700\u540e\uff0c\u5f53\u53d1\u73b0\u5185\u6838\u7f13\u5b58\u7684\u6570\u636e\u592a\u591a\u7684\u65f6\u5019\uff0c\u5185\u6838\u4f1a\u628a\u6570\u636e\u5199\u5230\u78c1\u76d8\u4e0a\uff1b</li> <li>\u7528\u6237\u4e3b\u52a8\u8c03\u7528 <code>sync</code>\uff0c\u5185\u6838\u7f13\u5b58\u4f1a\u5237\u5230\u78c1\u76d8\u4e0a\uff1b</li> <li>\u5f53\u5185\u5b58\u5341\u5206\u7d27\u5f20\uff0c\u65e0\u6cd5\u518d\u5206\u914d\u9875\u9762\u65f6\uff0c\u4e5f\u4f1a\u628a\u5185\u6838\u7f13\u5b58\u7684\u6570\u636e\u5237\u5230\u78c1\u76d8\u4e0a\uff1b</li> <li>\u5185\u6838\u7f13\u5b58\u7684\u6570\u636e\u7684\u7f13\u5b58\u65f6\u95f4\u8d85\u8fc7\u67d0\u4e2a\u65f6\u95f4\u65f6\uff0c\u4e5f\u4f1a\u628a\u6570\u636e\u5237\u5230\u78c1\u76d8\u4e0a\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#io-vs-io","title":"\u963b\u585e\u4e0e\u975e\u963b\u585e I/O VS \u540c\u6b65\u4e0e\u5f02\u6b65 I/O","text":"<p>\u4e3a\u4ec0\u4e48\u628a\u963b\u585e / \u975e\u963b\u585e\u4e0e\u540c\u6b65\u4e0e\u5f02\u6b65\u653e\u4e00\u8d77\u8bf4\u7684\u5462\uff1f\u56e0\u4e3a\u5b83\u4eec\u786e\u5b9e\u975e\u5e38\u76f8\u4f3c\uff0c\u4e5f\u975e\u5e38\u5bb9\u6613\u6df7\u6dc6\uff0c\u4e0d\u8fc7\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u8fd8\u662f\u6709\u70b9\u5fae\u5999\u7684\u3002</p> <p>\u5148\u6765\u770b\u770b\u963b\u585e I/O\uff0c\u5f53\u7528\u6237\u7a0b\u5e8f\u6267\u884c <code>read</code> \uff0c\u7ebf\u7a0b\u4f1a\u88ab\u963b\u585e\uff0c\u4e00\u76f4\u7b49\u5230\u5185\u6838\u6570\u636e\u51c6\u5907\u597d\uff0c\u5e76\u628a\u6570\u636e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u5e94\u7528\u7a0b\u5e8f\u7684\u7f13\u51b2\u533a\u4e2d\uff0c\u5f53\u62f7\u8d1d\u8fc7\u7a0b\u5b8c\u6210\uff0c<code>read</code> \u624d\u4f1a\u8fd4\u56de\u3002</p> <p>\u6ce8\u610f\uff0c\u963b\u585e\u7b49\u5f85\u7684\u662f\u300c\u5185\u6838\u6570\u636e\u51c6\u5907\u597d\u300d\u548c\u300c\u6570\u636e\u4ece\u5185\u6838\u6001\u62f7\u8d1d\u5230\u7528\u6237\u6001\u300d\u8fd9\u4e24\u4e2a\u8fc7\u7a0b\u3002\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u77e5\u9053\u4e86\u963b\u585e I/O\uff0c\u6765\u770b\u770b\u975e\u963b\u585e I/O\uff0c\u975e\u963b\u585e\u7684 read \u8bf7\u6c42\u5728\u6570\u636e\u672a\u51c6\u5907\u597d\u7684\u60c5\u51b5\u4e0b\u7acb\u5373\u8fd4\u56de\uff0c\u53ef\u4ee5\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\uff0c\u6b64\u65f6\u5e94\u7528\u7a0b\u5e8f\u4e0d\u65ad\u8f6e\u8be2\u5185\u6838\uff0c\u76f4\u5230\u6570\u636e\u51c6\u5907\u597d\uff0c\u5185\u6838\u5c06\u6570\u636e\u62f7\u8d1d\u5230\u5e94\u7528\u7a0b\u5e8f\u7f13\u51b2\u533a\uff0c<code>read</code> \u8c03\u7528\u624d\u53ef\u4ee5\u83b7\u53d6\u5230\u7ed3\u679c\u3002\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6ce8\u610f\uff0c\u8fd9\u91cc\u6700\u540e\u4e00\u6b21 read \u8c03\u7528\uff0c\u83b7\u53d6\u6570\u636e\u7684\u8fc7\u7a0b\uff0c\u662f\u4e00\u4e2a\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u662f\u9700\u8981\u7b49\u5f85\u7684\u8fc7\u7a0b\u3002\u8fd9\u91cc\u7684\u540c\u6b65\u6307\u7684\u662f\u5185\u6838\u6001\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u7a0b\u5e8f\u7684\u7f13\u5b58\u533a\u8fd9\u4e2a\u8fc7\u7a0b\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u8bbf\u95ee\u7ba1\u9053\u6216 socket \u65f6\uff0c\u5982\u679c\u8bbe\u7f6e\u4e86 <code>O_NONBLOCK</code> \u6807\u5fd7\uff0c\u90a3\u4e48\u5c31\u8868\u793a\u4f7f\u7528\u7684\u662f\u975e\u963b\u585e I/O \u7684\u65b9\u5f0f\u8bbf\u95ee\uff0c\u800c\u4e0d\u505a\u4efb\u4f55\u8bbe\u7f6e\u7684\u8bdd\uff0c\u9ed8\u8ba4\u662f\u963b\u585e I/O\u3002</p> <p>\u5e94\u7528\u7a0b\u5e8f\u6bcf\u6b21\u8f6e\u8be2\u5185\u6838\u7684 I/O \u662f\u5426\u51c6\u5907\u597d\uff0c\u611f\u89c9\u6709\u70b9\u50bb\u4e4e\u4e4e\uff0c\u56e0\u4e3a\u8f6e\u8be2\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u5565\u4e5f\u505a\u4e0d\u4e86\uff0c\u53ea\u662f\u5728\u5faa\u73af\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u79cd\u50bb\u4e4e\u4e4e\u8f6e\u8be2\u65b9\u5f0f\uff0c\u4e8e\u662f I/O \u591a\u8def\u590d\u7528\u6280\u672f\u5c31\u51fa\u6765\u4e86\uff0c\u5982 select\u3001poll\uff0c\u5b83\u662f\u901a\u8fc7 I/O \u4e8b\u4ef6\u5206\u53d1\uff0c\u5f53\u5185\u6838\u6570\u636e\u51c6\u5907\u597d\u65f6\uff0c\u518d\u4ee5\u4e8b\u4ef6\u901a\u77e5\u5e94\u7528\u7a0b\u5e8f\u8fdb\u884c\u64cd\u4f5c\u3002</p> <p>\u8fd9\u4e2a\u505a\u6cd5\u5927\u5927\u6539\u5584\u4e86 CPU \u7684\u5229\u7528\u7387\uff0c\u56e0\u4e3a\u5f53\u8c03\u7528\u4e86 I/O \u591a\u8def\u590d\u7528\u63a5\u53e3\uff0c\u5982\u679c\u6ca1\u6709\u4e8b\u4ef6\u53d1\u751f\uff0c\u90a3\u4e48\u5f53\u524d\u7ebf\u7a0b\u5c31\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u8fd9\u65f6 CPU \u4f1a\u5207\u6362\u5176\u4ed6\u7ebf\u7a0b\u6267\u884c\u4efb\u52a1\uff0c\u7b49\u5185\u6838\u53d1\u73b0\u6709\u4e8b\u4ef6\u5230\u6765\u7684\u65f6\u5019\uff0c\u4f1a\u5524\u9192\u963b\u585e\u5728 I/O \u591a\u8def\u590d\u7528\u63a5\u53e3\u7684\u7ebf\u7a0b\uff0c\u7136\u540e\u7528\u6237\u53ef\u4ee5\u8fdb\u884c\u540e\u7eed\u7684\u4e8b\u4ef6\u5904\u7406\u3002</p> <p>\u6574\u4e2a\u6d41\u7a0b\u8981\u6bd4\u963b\u585e IO \u8981\u590d\u6742\uff0c\u4f3c\u4e4e\u4e5f\u66f4\u6d6a\u8d39\u6027\u80fd\u3002\u4f46 I/O \u591a\u8def\u590d\u7528\u63a5\u53e3\u6700\u5927\u7684\u4f18\u52bf\u5728\u4e8e\uff0c\u7528\u6237\u53ef\u4ee5\u5728\u4e00\u4e2a\u7ebf\u7a0b\u5185\u540c\u65f6\u5904\u7406\u591a\u4e2a socket \u7684 IO \u8bf7\u6c42\uff08\u53c2\u89c1\uff1aI/O \u591a\u8def\u590d\u7528\uff1aselect/poll/epoll\uff09\u3002\u7528\u6237\u53ef\u4ee5\u6ce8\u518c\u591a\u4e2a socket\uff0c\u7136\u540e\u4e0d\u65ad\u5730\u8c03\u7528  I/O \u591a\u8def\u590d\u7528\u63a5\u53e3\u8bfb\u53d6\u88ab\u6fc0\u6d3b\u7684 socket\uff0c\u5373\u53ef\u8fbe\u5230\u5728\u540c\u4e00\u4e2a\u7ebf\u7a0b\u5185\u540c\u65f6\u5904\u7406\u591a\u4e2a IO \u8bf7\u6c42\u7684\u76ee\u7684\u3002\u800c\u5728\u540c\u6b65\u963b\u585e\u6a21\u578b\u4e2d\uff0c\u5fc5\u987b\u901a\u8fc7\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u624d\u80fd\u8fbe\u5230\u8fd9\u4e2a\u76ee\u7684\u3002</p> <p>\u4e0b\u56fe\u662f\u4f7f\u7528 select I/O \u591a\u8def\u590d\u7528\u8fc7\u7a0b\u3002\u6ce8\u610f\uff0c<code>read</code> \u83b7\u53d6\u6570\u636e\u7684\u8fc7\u7a0b\uff08\u6570\u636e\u4ece\u5185\u6838\u6001\u62f7\u8d1d\u5230\u7528\u6237\u6001\u7684\u8fc7\u7a0b\uff09\uff0c\u4e5f\u662f\u4e00\u4e2a\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u9700\u8981\u7b49\u5f85\uff1a</p> <p></p> <p>\u5b9e\u9645\u4e0a\uff0c\u65e0\u8bba\u662f\u963b\u585e I/O\u3001\u975e\u963b\u585e I/O\uff0c\u8fd8\u662f\u57fa\u4e8e\u975e\u963b\u585e I/O \u7684\u591a\u8def\u590d\u7528\u90fd\u662f\u540c\u6b65\u8c03\u7528\u3002\u56e0\u4e3a\u5b83\u4eec\u5728 read \u8c03\u7528\u65f6\uff0c\u5185\u6838\u5c06\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u5e94\u7528\u7a0b\u5e8f\u7a7a\u95f4\uff0c\u8fc7\u7a0b\u90fd\u662f\u9700\u8981\u7b49\u5f85\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u540c\u6b65\u7684\uff0c\u5982\u679c\u5185\u6838\u5b9e\u73b0\u7684\u62f7\u8d1d\u6548\u7387\u4e0d\u9ad8\uff0cread \u8c03\u7528\u5c31\u4f1a\u5728\u8fd9\u4e2a\u540c\u6b65\u8fc7\u7a0b\u4e2d\u7b49\u5f85\u6bd4\u8f83\u957f\u7684\u65f6\u95f4\u3002</p> <p>\u800c\u771f\u6b63\u7684\u5f02\u6b65 I/O \u662f\u300c\u5185\u6838\u6570\u636e\u51c6\u5907\u597d\u300d\u548c\u300c\u6570\u636e\u4ece\u5185\u6838\u6001\u62f7\u8d1d\u5230\u7528\u6237\u6001\u300d\u8fd9\u4e24\u4e2a\u8fc7\u7a0b\u90fd\u4e0d\u7528\u7b49\u5f85\u3002</p> <p>\u5f53\u6211\u4eec\u53d1\u8d77 <code>aio_read</code> \u4e4b\u540e\uff0c\u5c31\u7acb\u5373\u8fd4\u56de\uff0c\u5185\u6838\u81ea\u52a8\u5c06\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u5e94\u7528\u7a0b\u5e8f\u7a7a\u95f4\uff0c\u8fd9\u4e2a\u62f7\u8d1d\u8fc7\u7a0b\u540c\u6837\u662f\u5f02\u6b65\u7684\uff0c\u5185\u6838\u81ea\u52a8\u5b8c\u6210\u7684\uff0c\u548c\u524d\u9762\u7684\u540c\u6b65\u64cd\u4f5c\u4e0d\u4e00\u6837\uff0c\u5e94\u7528\u7a0b\u5e8f\u5e76\u4e0d\u9700\u8981\u4e3b\u52a8\u53d1\u8d77\u62f7\u8d1d\u52a8\u4f5c\u3002\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0b\u9762\u8fd9\u5f20\u56fe\uff0c\u603b\u7ed3\u4e86\u4ee5\u4e0a\u51e0\u79cd I/O \u6a21\u578b\uff1a</p> <p></p> <p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\uff0cI/O \u662f\u5206\u4e3a\u4e24\u4e2a\u8fc7\u7a0b\u7684\uff1a</p> <ol> <li>\u6570\u636e\u51c6\u5907\u7684\u8fc7\u7a0b</li> <li>\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u7528\u6237\u8fdb\u7a0b\u7f13\u51b2\u533a\u7684\u8fc7\u7a0b</li> </ol> <p>\u963b\u585e I/O \u4f1a\u963b\u585e\u5728\u300c\u8fc7\u7a0b 1\u300d\u548c\u300c\u8fc7\u7a0b 2\u300d\uff0c\u800c\u975e\u963b\u585e I/O \u548c\u57fa\u4e8e\u975e\u963b\u585e I/O \u7684\u591a\u8def\u590d\u7528\u53ea\u4f1a\u963b\u585e\u5728\u300c\u8fc7\u7a0b 2\u300d\uff0c\u6240\u4ee5\u8fd9\u4e09\u4e2a\u90fd\u53ef\u4ee5\u8ba4\u4e3a\u662f\u540c\u6b65 I/O\u3002</p> <p>\u5f02\u6b65 I/O \u5219\u4e0d\u540c\uff0c\u300c\u8fc7\u7a0b 1\u300d\u548c\u300c\u8fc7\u7a0b 2\u300d\u90fd\u4e0d\u4f1a\u963b\u585e\u3002</p> <p>\u7528\u6545\u4e8b\u53bb\u7406\u89e3\u8fd9\u51e0\u79cd I/O \u6a21\u578b</p> <p>\u4e3e\u4e2a\u4f60\u53bb\u996d\u5802\u5403\u996d\u7684\u4f8b\u5b50\uff0c\u4f60\u597d\u6bd4\u7528\u6237\u7a0b\u5e8f\uff0c\u996d\u5802\u597d\u6bd4\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u963b\u585e I/O \u597d\u6bd4\uff0c\u4f60\u53bb\u996d\u5802\u5403\u996d\uff0c\u4f46\u662f\u996d\u5802\u7684\u83dc\u8fd8\u6ca1\u505a\u597d\uff0c\u7136\u540e\u4f60\u5c31\u4e00\u76f4\u5728\u90a3\u91cc\u7b49\u554a\u7b49\uff0c\u7b49\u4e86\u597d\u957f\u4e00\u6bb5\u65f6\u95f4\u7ec8\u4e8e\u7b49\u5230\u996d\u5802\u963f\u59e8\u628a\u83dc\u7aef\u4e86\u51fa\u6765\uff08\u6570\u636e\u51c6\u5907\u7684\u8fc7\u7a0b\uff09\uff0c\u4f46\u662f\u4f60\u8fd8\u5f97\u7ee7\u7eed\u7b49\u963f\u59e8\u628a\u83dc\uff08\u5185\u6838\u7a7a\u95f4\uff09\u6253\u5230\u4f60\u7684\u996d\u76d2\u91cc\uff08\u7528\u6237\u7a7a\u95f4\uff09\uff0c\u7ecf\u5386\u5b8c\u8fd9\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u4f60\u624d\u53ef\u4ee5\u79bb\u5f00\u3002</p> <p>\u975e\u963b\u585e I/O \u597d\u6bd4\uff0c\u4f60\u53bb\u4e86\u996d\u5802\uff0c\u95ee\u963f\u59e8\u83dc\u505a\u597d\u4e86\u6ca1\u6709\uff0c\u963f\u59e8\u544a\u8bc9\u4f60\u6ca1\uff0c\u4f60\u5c31\u79bb\u5f00\u4e86\uff0c\u8fc7\u51e0\u5341\u5206\u949f\uff0c\u4f60\u53c8\u6765\u996d\u5802\u95ee\u963f\u59e8\uff0c\u963f\u59e8\u8bf4\u505a\u597d\u4e86\uff0c\u4e8e\u662f\u963f\u59e8\u5e2e\u4f60\u628a\u83dc\u6253\u5230\u4f60\u7684\u996d\u76d2\u91cc\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f60\u662f\u5f97\u7b49\u5f85\u7684\u3002</p> <p>\u57fa\u4e8e\u975e\u963b\u585e\u7684 I/O \u591a\u8def\u590d\u7528\u597d\u6bd4\uff0c\u4f60\u53bb\u996d\u5802\u5403\u996d\uff0c\u53d1\u73b0\u6709\u4e00\u6392\u7a97\u53e3\uff0c\u996d\u5802\u963f\u59e8\u544a\u8bc9\u4f60\u8fd9\u4e9b\u7a97\u53e3\u90fd\u8fd8\u6ca1\u505a\u597d\u83dc\uff0c\u7b49\u505a\u597d\u4e86\u518d\u901a\u77e5\u4f60\uff0c\u4e8e\u662f\u7b49\u554a\u7b49\uff08<code>select</code> \u8c03\u7528\u4e2d\uff09\uff0c\u8fc7\u4e86\u4e00\u4f1a\u963f\u59e8\u901a\u77e5\u4f60\u83dc\u505a\u597d\u4e86\uff0c\u4f46\u662f\u4e0d\u77e5\u9053\u54ea\u4e2a\u7a97\u53e3\u7684\u83dc\u505a\u597d\u4e86\uff0c\u4f60\u81ea\u5df1\u770b\u5427\u3002\u4e8e\u662f\u4f60\u53ea\u80fd\u4e00\u4e2a\u4e00\u4e2a\u7a97\u53e3\u53bb\u786e\u8ba4\uff0c\u540e\u9762\u53d1\u73b0 5 \u53f7\u7a97\u53e3\u83dc\u505a\u597d\u4e86\uff0c\u4e8e\u662f\u4f60\u8ba9 5 \u53f7\u7a97\u53e3\u7684\u963f\u59e8\u5e2e\u4f60\u6253\u83dc\u5230\u996d\u76d2\u91cc\uff0c\u8fd9\u4e2a\u6253\u83dc\u7684\u8fc7\u7a0b\u4f60\u662f\u8981\u7b49\u5f85\u7684\uff0c\u867d\u7136\u65f6\u95f4\u4e0d\u957f\u3002\u6253\u5b8c\u83dc\u540e\uff0c\u4f60\u81ea\u7136\u5c31\u53ef\u4ee5\u79bb\u5f00\u4e86\u3002</p> <p>\u5f02\u6b65 I/O \u597d\u6bd4\uff0c\u4f60\u8ba9\u996d\u5802\u963f\u59e8\u5c06\u83dc\u505a\u597d\u5e76\u628a\u83dc\u6253\u5230\u996d\u76d2\u91cc\u540e\uff0c\u628a\u996d\u76d2\u9001\u5230\u4f60\u9762\u524d\uff0c\u6574\u4e2a\u8fc7\u7a0b\u4f60\u90fd\u4e0d\u9700\u8981\u4efb\u4f55\u7b49\u5f85\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/file_system/#_14","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/","title":"7.2 \u8fdb\u7a0b\u5199\u6587\u4ef6\u65f6\uff0c\u8fdb\u7a0b\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u5df2\u5199\u5165\u7684\u6570\u636e\u4f1a\u4e22\u5931\u5417\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u524d\u51e0\u5929\uff0c\u6709\u4f4d\u8bfb\u8005\u95ee\u4e86\u6211\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a</p> <p></p> <p>\u5927\u6982\u5c31\u662f\uff0c\u8fdb\u7a0b\u5199\u6587\u4ef6\uff08\u4f7f\u7528\u7f13\u51b2 IO\uff09\u8fc7\u7a0b\u4e2d\uff0c\u5199\u4e00\u534a\u7684\u65f6\u5019\uff0c\u8fdb\u7a0b\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u5df2\u5199\u5165\u7684\u6570\u636e\u4f1a\u4e22\u5931\u5417\uff1f</p> <p>\u7b54\u6848\uff0c\u662f\u4e0d\u4f1a\u7684\u3002</p> <p></p> <p>\u56e0\u4e3a\u8fdb\u7a0b\u5728\u6267\u884c write\uff08\u4f7f\u7528\u7f13\u51b2 IO\uff09\u7cfb\u7edf\u8c03\u7528\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u662f\u5c06\u6587\u4ef6\u6570\u636e\u5199\u5230\u4e86\u5185\u6838\u7684 page cache\uff0c\u5b83\u662f\u6587\u4ef6\u7cfb\u7edf\u4e2d\u7528\u4e8e\u7f13\u5b58\u6587\u4ef6\u6570\u636e\u7684\u7f13\u51b2\uff0c\u6240\u4ee5\u5373\u4f7f\u8fdb\u7a0b\u5d29\u6e83\u4e86\uff0c\u6587\u4ef6\u6570\u636e\u8fd8\u662f\u4fdd\u7559\u5728\u5185\u6838\u7684 page cache\uff0c\u6211\u4eec\u8bfb\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u4ece\u5185\u6838\u7684 page cache \u8bfb\u53d6\uff0c\u56e0\u6b64\u8fd8\u662f\u4f9d\u7136\u8bfb\u7684\u8fdb\u7a0b\u5d29\u6e83\u524d\u5199\u5165\u7684\u6570\u636e\u3002</p> <p>\u5185\u6838\u4f1a\u627e\u4e2a\u5408\u9002\u7684\u65f6\u673a\uff0c\u5c06  page cache \u4e2d\u7684\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002\u4f46\u662f\u5982\u679c page cache \u91cc\u7684\u6587\u4ef6\u6570\u636e\uff0c\u5728\u6301\u4e45\u5316\u5230\u78c1\u76d8\u5316\u5230\u78c1\u76d8\u4e4b\u524d\uff0c\u7cfb\u7edf\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u90a3\u8fd9\u90e8\u5206\u6570\u636e\u5c31\u4f1a\u4e22\u5931\u4e86\u3002</p> <p>\u5f53\u7136\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u5728\u7a0b\u5e8f\u91cc\u8c03\u7528 fsync \u51fd\u6570\uff0c\u5728\u5199\u6587\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u7acb\u523b\u5c06\u6587\u4ef6\u6570\u636e\u6301\u4e45\u5316\u5230\u78c1\u76d8\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u89e3\u51b3\u7cfb\u7edf\u5d29\u6e83\u5bfc\u81f4\u7684\u6587\u4ef6\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u3002</p> <p>\u6211\u5728\u7f51\u4e0a\u770b\u5230\u4e00\u7bc7\u4ecb\u7ecd page cache \u5f88\u597d\u7684\u6587\u7ae0\uff0c\u5206\u4eab\u7ed9\u5927\u5bb6\u4e00\u8d77\u5b66\u4e60\u3002</p> <p>\u4f5c\u8005\uff1aspongecaptain</p> <p>\u539f\u6587\u5730\u5740\uff1aLinux \u7684 Page Cache</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-cache","title":"Page Cache","text":""},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-cache_1","title":"Page Cache \u662f\u4ec0\u4e48\uff1f","text":"<p>\u4e3a\u4e86\u7406\u89e3 Page Cache\uff0c\u6211\u4eec\u4e0d\u59a8\u5148\u770b\u4e00\u4e0b Linux \u7684\u6587\u4ef6 I/O \u7cfb\u7edf\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u7ea2\u8272\u90e8\u5206\u4e3a Page Cache\u3002\u53ef\u89c1 Page Cache \u7684\u672c\u8d28\u662f\u7531 Linux \u5185\u6838\u7ba1\u7406\u7684\u5185\u5b58\u533a\u57df\u3002\u6211\u4eec\u901a\u8fc7 mmap \u4ee5\u53ca buffered I/O \u5c06\u6587\u4ef6\u8bfb\u53d6\u5230\u5185\u5b58\u7a7a\u95f4\u5b9e\u9645\u4e0a\u90fd\u662f\u8bfb\u53d6\u5230 Page Cache \u4e2d\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-cache_2","title":"\u5982\u4f55\u67e5\u770b\u7cfb\u7edf\u7684 Page Cache\uff1f","text":"<p>\u901a\u8fc7\u8bfb\u53d6 <code>/proc/meminfo</code> \u6587\u4ef6\uff0c\u80fd\u591f\u5b9e\u65f6\u83b7\u53d6\u7cfb\u7edf\u5185\u5b58\u60c5\u51b5\uff1a</p> Bash<pre><code>$ cat /proc/meminfo\n...\nBuffers:            1224 kB\nCached:           111472 kB\nSwapCached:        36364 kB\nActive:          6224232 kB\nInactive:         979432 kB\nActive(anon):    6173036 kB\nInactive(anon):   927932 kB\nActive(file):      51196 kB\nInactive(file):    51500 kB\n...\nShmem:             10000 kB\n...\nSReclaimable:      43532 kB\n...\n</code></pre> <p>\u6839\u636e\u4e0a\u9762\u7684\u6570\u636e\uff0c\u4f60\u53ef\u4ee5\u7b80\u5355\u5f97\u51fa\u8fd9\u6837\u7684\u516c\u5f0f\uff08\u7b49\u5f0f\u4e24\u8fb9\u4e4b\u548c\u90fd\u662f 112696 KB\uff09\uff1a</p> Text Only<pre><code>Buffers + Cached + SwapCached = Active(file) + Inactive(file) + Shmem + SwapCached\n</code></pre> <p>\u4e24\u8fb9\u7b49\u5f0f\u90fd\u662f Page Cache\uff0c\u5373\uff1a</p> Text Only<pre><code>Page Cache = Buffers + Cached + SwapCached\n</code></pre> <p>\u901a\u8fc7\u9605\u8bfb\u4e0b\u9762\u7684\u5c0f\u8282\uff0c\u5c31\u80fd\u591f\u7406\u89e3\u4e3a\u4ec0\u4e48 SwapCached \u4e0e Buffers \u4e5f\u662f Page Cache \u7684\u4e00\u90e8\u5206\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-page-cache","title":"page \u4e0e Page Cache","text":"<p>page \u662f\u5185\u5b58\u7ba1\u7406\u5206\u914d\u7684\u57fa\u672c\u5355\u4f4d\uff0cPage Cache \u7531\u591a\u4e2a page \u6784\u6210\u3002page \u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u901a\u5e38\u4e3a 4KB \u5927\u5c0f\uff0832bits/64bits\uff09\uff0c\u800c Page Cache \u7684\u5927\u5c0f\u5219\u4e3a 4KB \u7684\u6574\u6570\u500d\u3002</p> <p>\u53e6\u4e00\u65b9\u9762\uff0c\u5e76\u4e0d\u662f\u6240\u6709 page \u90fd\u88ab\u7ec4\u7ec7\u4e3a Page Cache\u3002</p> <p>Linux \u7cfb\u7edf\u4e0a\u4f9b\u7528\u6237\u53ef\u8bbf\u95ee\u7684\u5185\u5b58\u5206\u4e3a\u4e24\u4e2a\u7c7b\u578b\uff0c\u5373\uff1a</p> <ul> <li>File-backed pages\uff1a\u6587\u4ef6\u5907\u4efd\u9875\u4e5f\u5c31\u662f Page Cache \u4e2d\u7684 page\uff0c\u5bf9\u5e94\u4e8e\u78c1\u76d8\u4e0a\u7684\u82e5\u5e72\u6570\u636e\u5757\uff1b\u5bf9\u4e8e\u8fd9\u4e9b\u9875\u6700\u5927\u7684\u95ee\u9898\u662f\u810f\u9875\u56de\u76d8\uff1b</li> <li>Anonymous pages\uff1a\u533f\u540d\u9875\u4e0d\u5bf9\u5e94\u78c1\u76d8\u4e0a\u7684\u4efb\u4f55\u78c1\u76d8\u6570\u636e\u5757\uff0c\u5b83\u4eec\u662f\u8fdb\u7a0b\u7684\u8fd0\u884c\u65f6\u5185\u5b58\u7a7a\u95f4\uff08\u4f8b\u5982\u65b9\u6cd5\u6808\u3001\u5c40\u90e8\u53d8\u91cf\u8868\u7b49\u5c5e\u6027\uff09\uff1b</li> </ul> <p>\u4e3a\u4ec0\u4e48 Linux \u4e0d\u628a Page Cache \u79f0\u4e3a block cache\uff0c\u8fd9\u4e0d\u662f\u66f4\u597d\u5417\uff1f</p> <p>\u8fd9\u662f\u56e0\u4e3a\u4ece\u78c1\u76d8\u4e2d\u52a0\u8f7d\u5230\u5185\u5b58\u7684\u6570\u636e\u4e0d\u4ec5\u4ec5\u653e\u5728 Page Cache \u4e2d\uff0c\u8fd8\u653e\u5728 buffer cache \u4e2d\u3002</p> <p>\u4f8b\u5982\u901a\u8fc7 Direct I/O \u6280\u672f\u7684\u78c1\u76d8\u6587\u4ef6\u5c31\u4e0d\u4f1a\u8fdb\u5165 Page Cache \u4e2d\u3002\u5f53\u7136\uff0c\u8fd9\u4e2a\u95ee\u9898\u4e5f\u6709 Linux \u5386\u53f2\u8bbe\u8ba1\u7684\u539f\u56e0\uff0c\u6bd5\u7adf\u8fd9\u53ea\u662f\u4e00\u4e2a\u79f0\u547c\uff0c\u542b\u4e49\u968f\u7740 Linux \u7cfb\u7edf\u7684\u6f14\u8fdb\u4e5f\u9010\u6e10\u4e0d\u540c\u3002</p> <p>\u4e0b\u9762\u6bd4\u8f83\u4e00\u4e0b File-backed pages \u4e0e Anonymous pages \u5728 Swap \u673a\u5236\u4e0b\u7684\u6027\u80fd\u3002</p> <p>\u5185\u5b58\u662f\u4e00\u79cd\u73cd\u60dc\u8d44\u6e90\uff0c\u5f53\u5185\u5b58\u4e0d\u591f\u7528\u65f6\uff0c\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08Memory Mangament Unit\uff09\u9700\u8981\u63d0\u4f9b\u8c03\u5ea6\u7b97\u6cd5\u6765\u56de\u6536\u76f8\u5173\u5185\u5b58\u7a7a\u95f4\u3002\u5185\u5b58\u7a7a\u95f4\u56de\u6536\u7684\u65b9\u5f0f\u901a\u5e38\u5c31\u662f swap\uff0c\u5373\u4ea4\u6362\u5230\u6301\u4e45\u5316\u5b58\u50a8\u8bbe\u5907\u4e0a\u3002</p> <p>File-backed pages\uff08Page Cache\uff09\u7684\u5185\u5b58\u56de\u6536\u4ee3\u4ef7\u8f83\u4f4e\u3002Page Cache \u901a\u5e38\u5bf9\u5e94\u4e8e\u4e00\u4e2a\u6587\u4ef6\u4e0a\u7684\u82e5\u5e72\u987a\u5e8f\u5757\uff0c\u56e0\u6b64\u53ef\u4ee5\u901a\u8fc7\u987a\u5e8f I/O \u7684\u65b9\u5f0f\u843d\u76d8\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u5982\u679c Page Cache \u4e0a\u6ca1\u6709\u8fdb\u884c\u5199\u64cd\u4f5c\uff08\u6240\u8c13\u7684\u6ca1\u6709\u810f\u9875\uff09\uff0c\u751a\u81f3\u4e0d\u4f1a\u5c06 Page Cache \u56de\u76d8\uff0c\u56e0\u4e3a\u6570\u636e\u7684\u5185\u5bb9\u5b8c\u5168\u53ef\u4ee5\u901a\u8fc7\u518d\u6b21\u8bfb\u53d6\u78c1\u76d8\u6587\u4ef6\u5f97\u5230\u3002</p> <p>Page Cache \u7684\u4e3b\u8981\u96be\u70b9\u5728\u4e8e\u810f\u9875\u56de\u76d8\uff0c\u8fd9\u4e2a\u5185\u5bb9\u4f1a\u5728\u540e\u9762\u8fdb\u884c\u8be6\u7ec6\u8bf4\u660e\u3002</p> <p>Anonymous pages \u7684\u5185\u5b58\u56de\u6536\u4ee3\u4ef7\u8f83\u9ad8\u3002\u8fd9\u662f\u56e0\u4e3a Anonymous pages \u901a\u5e38\u968f\u673a\u5730\u5199\u5165\u6301\u4e45\u5316\u4ea4\u6362\u8bbe\u5907\u3002\u53e6\u4e00\u65b9\u9762\uff0c\u65e0\u8bba\u662f\u5426\u6709\u5199\u64cd\u4f5c\uff0c\u4e3a\u4e86\u786e\u4fdd\u6570\u636e\u4e0d\u4e22\u5931\uff0cAnonymous pages \u5728 swap \u65f6\u5fc5\u987b\u6301\u4e45\u5316\u5230\u78c1\u76d8\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#swap","title":"Swap \u4e0e\u7f3a\u9875\u4e2d\u65ad","text":"<p>Swap \u673a\u5236\u6307\u7684\u662f\u5f53\u7269\u7406\u5185\u5b58\u4e0d\u591f\u7528\uff0c\u5185\u5b58\u7ba1\u7406\u5355\u5143\uff08Memory Mangament Unit\uff0cMMU\uff09\u9700\u8981\u63d0\u4f9b\u8c03\u5ea6\u7b97\u6cd5\u6765\u56de\u6536\u76f8\u5173\u5185\u5b58\u7a7a\u95f4\uff0c\u7136\u540e\u5c06\u6e05\u7406\u51fa\u6765\u7684\u5185\u5b58\u7a7a\u95f4\u7ed9\u5f53\u524d\u5185\u5b58\u7533\u8bf7\u65b9\u3002</p> <p>Swap \u673a\u5236\u5b58\u5728\u7684\u672c\u8d28\u539f\u56e0\u662f Linux \u7cfb\u7edf\u63d0\u4f9b\u4e86\u865a\u62df\u5185\u5b58\u7ba1\u7406\u673a\u5236\uff0c\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u8ba4\u4e3a\u5176\u72ec\u5360\u5185\u5b58\u7a7a\u95f4\uff0c\u56e0\u6b64\u6240\u6709\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u4e4b\u548c\u8fdc\u8fdc\u5927\u4e8e\u7269\u7406\u5185\u5b58\u3002\u6240\u6709\u8fdb\u7a0b\u7684\u5185\u5b58\u7a7a\u95f4\u4e4b\u548c\u8d85\u8fc7\u7269\u7406\u5185\u5b58\u7684\u90e8\u5206\u5c31\u9700\u8981\u4ea4\u6362\u5230\u78c1\u76d8\u4e0a\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u4ee5 page \u4e3a\u5355\u4f4d\u7ba1\u7406\u5185\u5b58\uff0c\u5f53\u8fdb\u7a0b\u53d1\u73b0\u9700\u8981\u8bbf\u95ee\u7684\u6570\u636e\u4e0d\u5728\u5185\u5b58\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u4f1a\u5c06\u6570\u636e\u4ee5\u9875\u7684\u65b9\u5f0f\u52a0\u8f7d\u5230\u5185\u5b58\u4e2d\u3002\u4e0a\u8ff0\u8fc7\u7a0b\u88ab\u79f0\u4e3a\u7f3a\u9875\u4e2d\u65ad\uff0c\u5f53\u64cd\u4f5c\u7cfb\u7edf\u53d1\u751f\u7f3a\u9875\u4e2d\u65ad\u65f6\uff0c\u5c31\u4f1a\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u5c06 page \u518d\u6b21\u8bfb\u5230\u5185\u5b58\u4e2d\u3002</p> <p>\u4f46\u4e3b\u5185\u5b58\u7684\u7a7a\u95f4\u662f\u6709\u9650\u7684\uff0c\u5f53\u4e3b\u5185\u5b58\u4e2d\u4e0d\u5305\u542b\u53ef\u4ee5\u4f7f\u7528\u7684\u7a7a\u95f4\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4ece\u9009\u62e9\u5408\u9002\u7684\u7269\u7406\u5185\u5b58\u9875\u9a71\u9010\u56de\u78c1\u76d8\uff0c\u4e3a\u65b0\u7684\u5185\u5b58\u9875\u8ba9\u51fa\u4f4d\u7f6e\uff0c\u9009\u62e9\u5f85\u9a71\u9010\u9875\u7684\u8fc7\u7a0b\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u53eb\u505a\u9875\u9762\u66ff\u6362\uff08Page Replacement\uff09\uff0c\u66ff\u6362\u64cd\u4f5c\u53c8\u4f1a\u89e6\u53d1 swap \u673a\u5236\u3002</p> <p>\u5982\u679c\u7269\u7406\u5185\u5b58\u8db3\u591f\u5927\uff0c\u90a3\u4e48\u53ef\u80fd\u4e0d\u9700\u8981 Swap \u673a\u5236\uff0c\u4f46\u662f Swap \u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8fd8\u662f\u6709\u4e00\u5b9a\u4f18\u52bf\uff1a\u5bf9\u4e8e\u6709\u53d1\u751f\u5185\u5b58\u6cc4\u6f0f\u51e0\u7387\u7684\u5e94\u7528\u7a0b\u5e8f\uff08\u8fdb\u7a0b\uff09\uff0cSwap \u4ea4\u6362\u5206\u533a\u66f4\u662f\u91cd\u8981\uff0c\u8fd9\u53ef\u4ee5\u786e\u4fdd\u5185\u5b58\u6cc4\u9732\u4e0d\u81f3\u4e8e\u5bfc\u81f4\u7269\u7406\u5185\u5b58\u4e0d\u591f\u7528\uff0c\u6700\u7ec8\u5bfc\u81f4\u7cfb\u7edf\u5d29\u6e83\u3002\u4f46\u5185\u5b58\u6cc4\u9732\u4f1a\u5f15\u8d77\u9891\u7e41\u7684 swap\uff0c\u6b64\u65f6\u975e\u5e38\u5f71\u54cd\u64cd\u4f5c\u7cfb\u7edf\u7684\u6027\u80fd\u3002</p> <p>Linux \u901a\u8fc7\u4e00\u4e2a swappiness \u53c2\u6570\u6765\u63a7\u5236 Swap \u673a\u5236\uff1a\u8fd9\u4e2a\u53c2\u6570\u503c\u53ef\u4e3a 0-100\uff0c\u63a7\u5236\u7cfb\u7edf swap \u7684\u4f18\u5148\u7ea7\uff1a</p> <ul> <li>\u9ad8\u6570\u503c\uff1a\u8f83\u9ad8\u9891\u7387\u7684 swap\uff0c\u8fdb\u7a0b\u4e0d\u6d3b\u8dc3\u65f6\u4e3b\u52a8\u5c06\u5176\u8f6c\u6362\u51fa\u7269\u7406\u5185\u5b58\u3002</li> <li>\u4f4e\u6570\u503c\uff1a\u8f83\u4f4e\u9891\u7387\u7684 swap\uff0c\u8fd9\u53ef\u4ee5\u786e\u4fdd\u4ea4\u4e92\u5f0f\u4e0d\u56e0\u4e3a\u5185\u5b58\u7a7a\u95f4\u9891\u7e41\u5730\u4ea4\u6362\u5230\u78c1\u76d8\u800c\u63d0\u9ad8\u54cd\u5e94\u5ef6\u8fdf\u3002</li> </ul> <p>\u6700\u540e\uff0c\u4e3a\u4ec0\u4e48 SwapCached \u4e5f\u662f Page Cache \u7684\u4e00\u90e8\u5206\uff1f</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5f53\u533f\u540d\u9875\uff08Inactive(anon) \u4ee5\u53ca Active(anon)\uff09\u5148\u88ab\u4ea4\u6362\uff08swap out\uff09\u5230\u78c1\u76d8\u4e0a\u540e\uff0c\u7136\u540e\u518d\u52a0\u8f7d\u56de\uff08swap in\uff09\u5185\u5b58\u4e2d\uff0c\u7531\u4e8e\u8bfb\u5165\u5230\u5185\u5b58\u540e\u539f\u6765\u7684 Swap File \u8fd8\u5728\uff0c\u6240\u4ee5 SwapCached \u4e5f\u53ef\u4ee5\u8ba4\u4e3a\u662f File-backed page\uff0c\u5373\u5c5e\u4e8e Page Cache\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-cache-buffer-cache","title":"Page Cache \u4e0e buffer cache","text":"<p>\u6267\u884c free \u547d\u4ee4\uff0c\u6ce8\u610f\u5230\u4f1a\u6709\u4e24\u5217\u540d\u4e3a buffers \u548c cached\uff0c\u4e5f\u6709\u4e00\u884c\u540d\u4e3a\u201c-/+ buffers/cache\u201d\u3002</p> Text Only<pre><code>~ free -m\n             total       used       free     shared    buffers     cached\nMem:        128956      96440      32515          0       5368      39900\n-/+ buffers/cache:      51172      77784\nSwap:        16002          0      16001\n</code></pre> <p>\u5176\u4e2d\uff0ccached \u5217\u8868\u793a\u5f53\u524d\u7684\u9875\u7f13\u5b58\uff08Page Cache\uff09\u5360\u7528\u91cf\uff0cbuffers \u5217\u8868\u793a\u5f53\u524d\u7684\u5757\u7f13\u5b58\uff08buffer cache\uff09\u5360\u7528\u91cf\u3002</p> <p>\u7528\u4e00\u53e5\u8bdd\u6765\u89e3\u91ca\uff1aPage Cache \u7528\u4e8e\u7f13\u5b58\u6587\u4ef6\u7684\u9875\u6570\u636e\uff0cbuffer cache \u7528\u4e8e\u7f13\u5b58\u5757\u8bbe\u5907\uff08\u5982\u78c1\u76d8\uff09\u7684\u5757\u6570\u636e\u3002</p> <ul> <li>\u9875\u662f\u903b\u8f91\u4e0a\u7684\u6982\u5ff5\uff0c\u56e0\u6b64 Page Cache \u662f\u4e0e\u6587\u4ef6\u7cfb\u7edf\u540c\u7ea7\u7684\uff1b</li> <li>\u5757\u662f\u7269\u7406\u4e0a\u7684\u6982\u5ff5\uff0c\u56e0\u6b64 buffer cache \u662f\u4e0e\u5757\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u540c\u7ea7\u7684\u3002</li> </ul> <p>Page Cache \u4e0e buffer cache \u7684\u5171\u540c\u76ee\u7684\u90fd\u662f\u52a0\u901f\u6570\u636e I/O\uff1a</p> <ul> <li>\u5199\u6570\u636e\u65f6\u9996\u5148\u5199\u5230\u7f13\u5b58\uff0c\u5c06\u5199\u5165\u7684\u9875\u6807\u8bb0\u4e3a dirty\uff0c\u7136\u540e\u5411\u5916\u90e8\u5b58\u50a8 flush\uff0c\u4e5f\u5c31\u662f\u7f13\u5b58\u5199\u673a\u5236\u4e2d\u7684 write-back\uff08\u53e6\u4e00\u79cd\u662f write-through\uff0cLinux \u9ed8\u8ba4\u60c5\u51b5\u4e0b\u4e0d\u91c7\u7528\uff09\uff1b</li> <li>\u8bfb\u6570\u636e\u65f6\u9996\u5148\u8bfb\u53d6\u7f13\u5b58\uff0c\u5982\u679c\u672a\u547d\u4e2d\uff0c\u518d\u53bb\u5916\u90e8\u5b58\u50a8\u8bfb\u53d6\uff0c\u5e76\u4e14\u5c06\u8bfb\u53d6\u6765\u7684\u6570\u636e\u4e5f\u52a0\u5165\u7f13\u5b58\u3002\u64cd\u4f5c\u7cfb\u7edf\u603b\u662f\u79ef\u6781\u5730\u5c06\u6240\u6709\u7a7a\u95f2\u5185\u5b58\u90fd\u7528\u4f5c Page Cache \u548c buffer cache\uff0c\u5f53\u5185\u5b58\u4e0d\u591f\u7528\u65f6\u4e5f\u4f1a\u7528 LRU \u7b49\u7b97\u6cd5\u6dd8\u6c70\u7f13\u5b58\u9875\u3002</li> </ul> <p>\u5728 Linux 2.4 \u7248\u672c\u7684\u5185\u6838\u4e4b\u524d\uff0cPage Cache \u4e0e buffer cache \u662f\u5b8c\u5168\u5206\u79bb\u7684\u3002\u4f46\u662f\uff0c\u5757\u8bbe\u5907\u5927\u591a\u662f\u78c1\u76d8\uff0c\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u53c8\u5927\u591a\u901a\u8fc7\u6587\u4ef6\u7cfb\u7edf\u6765\u7ec4\u7ec7\uff0c\u8fd9\u79cd\u8bbe\u8ba1\u5bfc\u81f4\u5f88\u591a\u6570\u636e\u88ab\u7f13\u5b58\u4e86\u4e24\u6b21\uff0c\u6d6a\u8d39\u5185\u5b58\u3002</p> <p>\u6240\u4ee5\u5728 2.4 \u7248\u672c\u5185\u6838\u4e4b\u540e\uff0c\u4e24\u5757\u7f13\u5b58\u8fd1\u4f3c\u878d\u5408\u5728\u4e86\u4e00\u8d77\uff1a\u5982\u679c\u4e00\u4e2a\u6587\u4ef6\u7684\u9875\u52a0\u8f7d\u5230\u4e86 Page Cache\uff0c\u90a3\u4e48\u540c\u65f6 buffer cache \u53ea\u9700\u8981\u7ef4\u62a4\u5757\u6307\u5411\u9875\u7684\u6307\u9488\u5c31\u53ef\u4ee5\u4e86\u3002\u53ea\u6709\u90a3\u4e9b\u6ca1\u6709\u6587\u4ef6\u8868\u793a\u7684\u5757\uff0c\u6216\u8005\u7ed5\u8fc7\u4e86\u6587\u4ef6\u7cfb\u7edf\u76f4\u63a5\u64cd\u4f5c\uff08\u5982 dd \u547d\u4ee4\uff09\u7684\u5757\uff0c\u624d\u4f1a\u771f\u6b63\u653e\u5230 buffer cache \u91cc\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u73b0\u5728\u63d0\u8d77 Page Cache\uff0c\u57fa\u672c\u4e0a\u90fd\u540c\u65f6\u6307 Page Cache \u548c buffer cache \u4e24\u8005\uff0c\u672c\u6587\u4e4b\u540e\u4e5f\u4e0d\u518d\u533a\u5206\uff0c\u76f4\u63a5\u7edf\u79f0\u4e3a Page Cache\u3002</p> <p>\u4e0b\u56fe\u8fd1\u4f3c\u5730\u793a\u51fa 32-bit Linux \u7cfb\u7edf\u4e2d\u53ef\u80fd\u7684\u4e00\u79cd Page Cache \u7ed3\u6784\uff0c\u5176\u4e2d block size \u5927\u5c0f\u4e3a 1KB\uff0cpage size \u5927\u5c0f\u4e3a 4KB\u3002</p> <p></p> <p>Page Cache \u4e2d\u7684\u6bcf\u4e2a\u6587\u4ef6\u90fd\u662f\u4e00\u68f5\u57fa\u6570\u6811\uff08radix tree\uff0c\u672c\u8d28\u4e0a\u662f\u591a\u53c9\u641c\u7d22\u6811\uff09\uff0c\u6811\u7684\u6bcf\u4e2a\u8282\u70b9\u90fd\u662f\u4e00\u4e2a\u9875\u3002\u6839\u636e\u6587\u4ef6\u5185\u7684\u504f\u79fb\u91cf\u5c31\u53ef\u4ee5\u5feb\u901f\u5b9a\u4f4d\u5230\u6240\u5728\u7684\u9875\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002\u5173\u4e8e\u57fa\u6570\u6811\u7684\u539f\u7406\u53ef\u4ee5\u53c2\u89c1\u82f1\u6587\u7ef4\u57fa\uff0c\u8fd9\u91cc\u5c31\u4e0d\u7ec6\u8bf4\u4e86\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-cache_3","title":"Page Cache \u4e0e\u9884\u8bfb","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u4e3a\u57fa\u4e8e Page Cache \u7684\u8bfb\u7f13\u5b58\u673a\u5236\u63d0\u4f9b\u9884\u8bfb\u673a\u5236\uff08PAGE_READAHEAD\uff09\uff0c\u4e00\u4e2a\u4f8b\u5b50\u662f\uff1a</p> <ul> <li>\u7528\u6237\u7ebf\u7a0b\u4ec5\u4ec5\u8bf7\u6c42\u8bfb\u53d6\u78c1\u76d8\u4e0a\u6587\u4ef6 A \u7684 offset \u4e3a 0-3KB \u8303\u56f4\u5185\u7684\u6570\u636e\uff0c\u7531\u4e8e\u78c1\u76d8\u7684\u57fa\u672c\u8bfb\u5199\u5355\u4f4d\u4e3a block\uff084KB\uff09\uff0c\u4e8e\u662f\u64cd\u4f5c\u7cfb\u7edf\u81f3\u5c11\u4f1a\u8bfb 0-4KB \u7684\u5185\u5bb9\uff0c\u8fd9\u6070\u597d\u53ef\u4ee5\u5728\u4e00\u4e2a page \u4e2d\u88c5\u4e0b\u3002</li> <li>\u4f46\u662f\u64cd\u4f5c\u7cfb\u7edf\u51fa\u4e8e\u5c40\u90e8\u6027\u539f\u7406\u4f1a\u9009\u62e9\u5c06\u78c1\u76d8\u5757 offset [4KB,8KB)\u3001[8KB,12KB) \u4ee5\u53ca [12KB,16KB) \u90fd\u52a0\u8f7d\u5230\u5185\u5b58\uff0c\u4e8e\u662f\u989d\u5916\u5728\u5185\u5b58\u4e2d\u7533\u8bf7\u4e86 3 \u4e2a page\uff1b</li> </ul> <p>\u4e0b\u56fe\u4ee3\u8868\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u9884\u8bfb\u673a\u5236\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u5229\u7528 read \u7cfb\u7edf\u8c03\u52a8\u8bfb\u53d6 4KB \u6570\u636e\uff0c\u5b9e\u9645\u4e0a\u5185\u6838\u4f7f\u7528 readahead \u673a\u5236\u5b8c\u6210\u4e86 16KB \u6570\u636e\u7684\u8bfb\u53d6\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-cache_4","title":"Page Cache \u4e0e\u6587\u4ef6\u6301\u4e45\u5316\u7684\u4e00\u81f4\u6027&amp;\u53ef\u9760\u6027","text":"<p>\u73b0\u4ee3 Linux \u7684 Page Cache \u6b63\u5982\u5176\u540d\uff0c\u662f\u5bf9\u78c1\u76d8\u4e0a page\uff08\u9875\uff09\u7684\u5185\u5b58\u7f13\u5b58\uff0c\u540c\u65f6\u53ef\u4ee5\u7528\u4e8e\u8bfb/\u5199\u64cd\u4f5c\u3002</p> <p>\u4efb\u4f55\u7cfb\u7edf\u5f15\u5165\u7f13\u5b58\uff0c\u5c31\u4f1a\u5f15\u53d1\u4e00\u81f4\u6027\u95ee\u9898\uff1a\u5185\u5b58\u4e2d\u7684\u6570\u636e\u4e0e\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u4e0d\u4e00\u81f4\uff0c\u4f8b\u5982\u5e38\u89c1\u540e\u7aef\u67b6\u6784\u4e2d\u7684 Redis \u7f13\u5b58\u4e0e MySQL \u6570\u636e\u5e93\u5c31\u5b58\u5728\u4e00\u81f4\u6027\u95ee\u9898\u3002</p> <p>Linux \u63d0\u4f9b\u591a\u79cd\u673a\u5236\u6765\u4fdd\u8bc1\u6570\u636e\u4e00\u81f4\u6027\uff0c\u4f46\u65e0\u8bba\u662f\u5355\u673a\u4e0a\u7684\u5185\u5b58\u4e0e\u78c1\u76d8\u4e00\u81f4\u6027\uff0c\u8fd8\u662f\u5206\u5e03\u5f0f\u7ec4\u4ef6\u4e2d\u8282\u70b9 1 \u4e0e\u8282\u70b9 2\u3001\u8282\u70b9 3 \u7684\u6570\u636e\u4e00\u81f4\u6027\u95ee\u9898\uff0c\u7406\u89e3\u7684\u5173\u952e\u662f trade-off\uff1a\u541e\u5410\u91cf\u4e0e\u6570\u636e\u4e00\u81f4\u6027\u4fdd\u8bc1\u662f\u4e00\u5bf9\u77db\u76fe\u3002</p> <p>\u9996\u5148\uff0c\u9700\u8981\u6211\u4eec\u7406\u89e3\u4e00\u4e0b\u6587\u4ef6\u7684\u6570\u636e\u3002\u6587\u4ef6 = \u6570\u636e + \u5143\u6570\u636e\u3002\u5143\u6570\u636e\u7528\u6765\u63cf\u8ff0\u6587\u4ef6\u7684\u5404\u79cd\u5c5e\u6027\uff0c\u4e5f\u5fc5\u987b\u5b58\u50a8\u5728\u78c1\u76d8\u4e0a\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u8bf4\u4fdd\u8bc1\u6587\u4ef6\u4e00\u81f4\u6027\u5176\u5b9e\u5305\u542b\u4e86\u4e24\u4e2a\u65b9\u9762\uff1a\u6570\u636e\u4e00\u81f4 + \u5143\u6570\u636e\u4e00\u81f4\u3002</p> <p>\u6587\u4ef6\u7684\u5143\u6570\u636e\u5305\u62ec\uff1a\u6587\u4ef6\u5927\u5c0f\u3001\u521b\u5efa\u65f6\u95f4\u3001\u8bbf\u95ee\u65f6\u95f4\u3001\u5c5e\u4e3b\u5c5e\u7ec4\u7b49\u4fe1\u606f\u3002</p> <p>\u6211\u4eec\u8003\u8651\u5982\u4e0b\u4e00\u81f4\u6027\u95ee\u9898\uff1a\u5982\u679c\u53d1\u751f\u5199\u64cd\u4f5c\u5e76\u4e14\u5bf9\u5e94\u7684\u6570\u636e\u5728 Page Cache \u4e2d\uff0c\u90a3\u4e48\u5199\u64cd\u4f5c\u5c31\u4f1a\u76f4\u63a5\u4f5c\u7528\u4e8e Page Cache \u4e2d\uff0c\u6b64\u65f6\u5982\u679c\u6570\u636e\u8fd8\u6ca1\u5237\u65b0\u5230\u78c1\u76d8\uff0c\u90a3\u4e48\u5185\u5b58\u4e2d\u7684\u6570\u636e\u5c31\u9886\u5148\u4e8e\u78c1\u76d8\uff0c\u6b64\u65f6\u5bf9\u5e94 page \u5c31\u88ab\u79f0\u4e3a Dirty page\u3002</p> <p>\u5f53\u524d Linux \u4e0b\u4ee5\u4e24\u79cd\u65b9\u5f0f\u5b9e\u73b0\u6587\u4ef6\u4e00\u81f4\u6027\uff1a</p> <ol> <li>Write Through\uff08\u5199\u7a7f\uff09\uff1a\u5411\u7528\u6237\u5c42\u63d0\u4f9b\u7279\u5b9a\u63a5\u53e3\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4e3b\u52a8\u8c03\u7528\u63a5\u53e3\u6765\u4fdd\u8bc1\u6587\u4ef6\u4e00\u81f4\u6027\uff1b</li> <li>Write back\uff08\u5199\u56de\uff09\uff1a\u7cfb\u7edf\u4e2d\u5b58\u5728\u5b9a\u671f\u4efb\u52a1\uff08\u8868\u73b0\u5f62\u5f0f\u4e3a\u5185\u6838\u7ebf\u7a0b\uff09\uff0c\u5468\u671f\u6027\u5730\u540c\u6b65\u6587\u4ef6\u7cfb\u7edf\u4e2d\u6587\u4ef6\u810f\u6570\u636e\u5757\uff0c\u8fd9\u662f\u9ed8\u8ba4\u7684 Linux \u4e00\u81f4\u6027\u65b9\u6848\uff1b</li> </ol> <p>\u4e0a\u8ff0\u4e24\u79cd\u65b9\u5f0f\u6700\u7ec8\u90fd\u4f9d\u8d56\u4e8e\u7cfb\u7edf\u8c03\u7528\uff0c\u4e3b\u8981\u5206\u4e3a\u5982\u4e0b\u4e09\u79cd\u7cfb\u7edf\u8c03\u7528\uff1a</p> \u65b9\u6cd5 \u542b\u4e49 fsync(intfd) fsync(fd)\uff1a\u5c06 fd \u4ee3\u8868\u7684\u6587\u4ef6\u7684\u810f\u6570\u636e\u548c\u810f\u5143\u6570\u636e\u5168\u90e8\u5237\u65b0\u81f3\u78c1\u76d8\u4e2d\u3002 fdatasync(int fd) fdatasync(fd)\uff1a\u5c06 fd \u4ee3\u8868\u7684\u6587\u4ef6\u7684\u810f\u6570\u636e\u5237\u65b0\u81f3\u78c1\u76d8\uff0c\u540c\u65f6\u5bf9\u5fc5\u8981\u7684\u5143\u6570\u636e\u5237\u65b0\u81f3\u78c1\u76d8\u4e2d\uff0c\u8fd9\u91cc\u6240\u8bf4\u7684\u5fc5\u8981\u7684\u6982\u5ff5\u662f\u6307\uff1a\u5bf9\u63a5\u4e0b\u6765\u8bbf\u95ee\u6587\u4ef6\u6709\u5173\u952e\u4f5c\u7528\u7684\u4fe1\u606f\uff0c\u5982\u6587\u4ef6\u5927\u5c0f\uff0c\u800c\u6587\u4ef6\u4fee\u6539\u65f6\u95f4\u7b49\u4e0d\u5c5e\u4e8e\u5fc5\u8981\u4fe1\u606f sync() sync()\uff1a\u5219\u662f\u5bf9\u7cfb\u7edf\u4e2d\u6240\u6709\u7684\u810f\u7684\u6587\u4ef6\u6570\u636e\u5143\u6570\u636e\u5237\u65b0\u81f3\u78c1\u76d8\u4e2d <p>\u4e0a\u8ff0\u4e09\u79cd\u7cfb\u7edf\u8c03\u7528\u53ef\u4ee5\u5206\u522b\u7531\u7528\u6237\u8fdb\u7a0b\u4e0e\u5185\u6838\u8fdb\u7a0b\u53d1\u8d77\u3002\u4e0b\u9762\u6211\u4eec\u7814\u7a76\u4e00\u4e0b\u5185\u6838\u7ebf\u7a0b\u7684\u76f8\u5173\u7279\u6027\u3002</p> <ol> <li> <p>\u521b\u5efa\u7684\u9488\u5bf9\u56de\u5199\u4efb\u52a1\u7684\u5185\u6838\u7ebf\u7a0b\u6570\u7531\u7cfb\u7edf\u4e2d\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u51b3\u5b9a\uff0c\u4e3a\u6bcf\u4e2a\u5b58\u50a8\u8bbe\u5907\u521b\u5efa\u5355\u72ec\u7684\u5237\u65b0\u7ebf\u7a0b\uff1b</p> </li> <li> <p>\u5173\u4e8e\u591a\u7ebf\u7a0b\u7684\u67b6\u6784\u95ee\u9898\uff0cLinux \u5185\u6838\u91c7\u53d6\u4e86 Lighthttp \u7684\u505a\u6cd5\uff0c\u5373\u7cfb\u7edf\u4e2d\u5b58\u5728\u4e00\u4e2a\u7ba1\u7406\u7ebf\u7a0b\u548c\u591a\u4e2a\u5237\u65b0\u7ebf\u7a0b\uff08\u6bcf\u4e2a\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u5bf9\u5e94\u4e00\u4e2a\u5237\u65b0\u7ebf\u7a0b\uff09\u3002\u7ba1\u7406\u7ebf\u7a0b\u76d1\u63a7\u8bbe\u5907\u4e0a\u7684\u810f\u9875\u9762\u60c5\u51b5\uff0c\u82e5\u8bbe\u5907\u4e00\u6bb5\u65f6\u95f4\u5185\u6ca1\u6709\u4ea7\u751f\u810f\u9875\u9762\uff0c\u5c31\u9500\u6bc1\u8bbe\u5907\u4e0a\u7684\u5237\u65b0\u7ebf\u7a0b\uff1b\u82e5\u76d1\u6d4b\u5230\u8bbe\u5907\u4e0a\u6709\u810f\u9875\u9762\u9700\u8981\u56de\u5199\u4e14\u5c1a\u672a\u4e3a\u8be5\u8bbe\u5907\u521b\u5efa\u5237\u65b0\u7ebf\u7a0b\uff0c\u90a3\u4e48\u521b\u5efa\u5237\u65b0\u7ebf\u7a0b\u5904\u7406\u810f\u9875\u9762\u56de\u5199\u3002\u800c\u5237\u65b0\u7ebf\u7a0b\u7684\u4efb\u52a1\u8f83\u4e3a\u5355\u8c03\uff0c\u53ea\u8d1f\u8d23\u5c06\u8bbe\u5907\u4e2d\u7684\u810f\u9875\u9762\u56de\u5199\u81f3\u6301\u4e45\u5b58\u50a8\u8bbe\u5907\u4e2d\u3002</p> </li> <li> <p>\u5237\u65b0\u7ebf\u7a0b\u5237\u65b0\u8bbe\u5907\u4e0a\u810f\u9875\u9762\u5927\u81f4\u8bbe\u8ba1\u5982\u4e0b\uff1a</p> </li> <li>\u6bcf\u4e2a\u8bbe\u5907\u4fdd\u5b58\u810f\u6587\u4ef6\u94fe\u8868\uff0c\u4fdd\u5b58\u7684\u662f\u8be5\u8bbe\u5907\u4e0a\u5b58\u50a8\u7684\u810f\u6587\u4ef6\u7684 inode \u8282\u70b9\u3002\u6240\u8c13\u7684\u56de\u5199\u6587\u4ef6\u810f\u9875\u9762\u5373\u56de\u5199\u8be5 inode \u94fe\u8868\u4e0a\u7684\u67d0\u4e9b\u6587\u4ef6\u7684\u810f\u9875\u9762\uff1b<ul> <li>\u7cfb\u7edf\u4e2d\u5b58\u5728\u591a\u4e2a\u56de\u5199\u65f6\u673a\uff0c\u7b2c\u4e00\u662f\u5e94\u7528\u7a0b\u5e8f\u4e3b\u52a8\u8c03\u7528\u56de\u5199\u63a5\u53e3\uff08fsync\uff0cfdatasync \u4ee5\u53ca sync \u7b49\uff09\uff0c\u7b2c\u4e8c\u7ba1\u7406\u7ebf\u7a0b\u5468\u671f\u6027\u5730\u5524\u9192\u8bbe\u5907\u4e0a\u7684\u56de\u5199\u7ebf\u7a0b\u8fdb\u884c\u56de\u5199\uff0c\u7b2c\u4e09\u662f\u67d0\u4e9b\u5e94\u7528\u7a0b\u5e8f/\u5185\u6838\u4efb\u52a1\u53d1\u73b0\u5185\u5b58\u4e0d\u8db3\u65f6\u8981\u56de\u6536\u90e8\u5206\u7f13\u5b58\u9875\u9762\u800c\u4e8b\u5148\u8fdb\u884c\u810f\u9875\u9762\u56de\u5199\uff0c\u8bbe\u8ba1\u4e00\u4e2a\u7edf\u4e00\u7684\u6846\u67b6\u6765\u7ba1\u7406\u8fd9\u4e9b\u56de\u5199\u4efb\u52a1\u975e\u5e38\u6709\u5fc5\u8981\u3002</li> </ul> </li> </ol> <p>Write Through \u4e0e Write back \u5728\u6301\u4e45\u5316\u7684\u53ef\u9760\u6027\u4e0a\u6709\u6240\u4e0d\u540c\uff1a</p> <ul> <li>Write Through \u4ee5\u727a\u7272\u7cfb\u7edf I/O \u541e\u5410\u91cf\u4f5c\u4e3a\u4ee3\u4ef7\uff0c\u5411\u4e0a\u5c42\u5e94\u7528\u786e\u4fdd\u4e00\u65e6\u5199\u5165\uff0c\u6570\u636e\u5c31\u5df2\u7ecf\u843d\u76d8\uff0c\u4e0d\u4f1a\u4e22\u5931\uff1b</li> <li>Write back \u5728\u7cfb\u7edf\u53d1\u751f\u5b95\u673a\u7684\u60c5\u51b5\u4e0b\u65e0\u6cd5\u786e\u4fdd\u6570\u636e\u5df2\u7ecf\u843d\u76d8\uff0c\u56e0\u6b64\u5b58\u5728\u6570\u636e\u4e22\u5931\u7684\u95ee\u9898\u3002\u4e0d\u8fc7\uff0c\u5728\u7a0b\u5e8f\u6302\u4e86\uff0c\u4f8b\u5982\u88ab kill -9\uff0cPage Cache \u4e2d\u7684\u6570\u636e\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u662f\u4f1a\u786e\u4fdd\u843d\u76d8\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-cache_5","title":"Page Cache \u7684\u4f18\u52a3\u52bf","text":""},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-cache_6","title":"Page Cache \u7684\u4f18\u52bf","text":"<p>1.\u52a0\u5feb\u6570\u636e\u8bbf\u95ee</p> <p>\u5982\u679c\u6570\u636e\u80fd\u591f\u5728\u5185\u5b58\u4e2d\u8fdb\u884c\u7f13\u5b58\uff0c\u90a3\u4e48\u4e0b\u4e00\u6b21\u8bbf\u95ee\u5c31\u4e0d\u9700\u8981\u901a\u8fc7\u78c1\u76d8 I/O \u4e86\uff0c\u76f4\u63a5\u547d\u4e2d\u5185\u5b58\u7f13\u5b58\u5373\u53ef\u3002</p> <p>\u7531\u4e8e\u5185\u5b58\u8bbf\u95ee\u6bd4\u78c1\u76d8\u8bbf\u95ee\u5feb\u5f88\u591a\uff0c\u56e0\u6b64\u52a0\u5feb\u6570\u636e\u8bbf\u95ee\u662f Page Cache \u7684\u4e00\u5927\u4f18\u52bf\u3002</p> <p>2.\u51cf\u5c11 I/O \u6b21\u6570\uff0c\u63d0\u9ad8\u7cfb\u7edf\u78c1\u76d8 I/O \u541e\u5410\u91cf</p> <p>\u5f97\u76ca\u4e8e Page Cache \u7684\u7f13\u5b58\u4ee5\u53ca\u9884\u8bfb\u80fd\u529b\uff0c\u800c\u7a0b\u5e8f\u53c8\u5f80\u5f80\u7b26\u5408\u5c40\u90e8\u6027\u539f\u7406\uff0c\u56e0\u6b64\u901a\u8fc7\u4e00\u6b21 I/O \u5c06\u591a\u4e2a page \u88c5\u5165 Page Cache \u80fd\u591f\u51cf\u5c11\u78c1\u76d8 I/O \u6b21\u6570\uff0c\u8fdb\u800c\u63d0\u9ad8\u7cfb\u7edf\u78c1\u76d8 I/O \u541e\u5410\u91cf\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/6_file_system/pagecache/#page-cache_7","title":"Page Cache \u7684\u52a3\u52bf","text":"<p>page cache \u4e5f\u6709\u5176\u52a3\u52bf\uff0c\u6700\u76f4\u63a5\u7684\u7f3a\u70b9\u662f\u9700\u8981\u5360\u7528\u989d\u5916\u7269\u7406\u5185\u5b58\u7a7a\u95f4\uff0c\u7269\u7406\u5185\u5b58\u5728\u6bd4\u8f83\u7d27\u4fcf\u7684\u65f6\u5019\u53ef\u80fd\u4f1a\u5bfc\u81f4\u9891\u7e41\u7684 swap \u64cd\u4f5c\uff0c\u6700\u7ec8\u5bfc\u81f4\u7cfb\u7edf\u7684\u78c1\u76d8 I/O \u8d1f\u8f7d\u7684\u4e0a\u5347\u3002</p> <p>Page Cache \u7684\u53e6\u4e00\u4e2a\u7f3a\u9677\u662f\u5bf9\u5e94\u7528\u5c42\u5e76\u6ca1\u6709\u63d0\u4f9b\u5f88\u597d\u7684\u7ba1\u7406 API\uff0c\u51e0\u4e4e\u662f\u900f\u660e\u7ba1\u7406\u3002\u5e94\u7528\u5c42\u5373\u4f7f\u60f3\u4f18\u5316 Page Cache \u7684\u4f7f\u7528\u7b56\u7565\u4e5f\u5f88\u96be\u8fdb\u884c\u3002\u56e0\u6b64\u4e00\u4e9b\u5e94\u7528\u9009\u62e9\u5728\u7528\u6237\u7a7a\u95f4\u5b9e\u73b0\u81ea\u5df1\u7684 page \u7ba1\u7406\uff0c\u800c\u4e0d\u4f7f\u7528 page cache\uff0c\u4f8b\u5982 MySQL InnoDB \u5b58\u50a8\u5f15\u64ce\u4ee5 16KB \u7684\u9875\u8fdb\u884c\u7ba1\u7406\u3002</p> <p>Page Cache \u6700\u540e\u4e00\u4e2a\u7f3a\u9677\u662f\u5728\u67d0\u4e9b\u5e94\u7528\u573a\u666f\u4e0b\u6bd4 Direct I/O \u591a\u4e00\u6b21\u78c1\u76d8\u8bfb I/O \u4ee5\u53ca\u78c1\u76d8\u5199 I/O\u3002</p> <p>Direct I/O \u5373\u76f4\u63a5 I/O\u3002\u5176\u540d\u5b57\u4e2d\u7684\u201d\u76f4\u63a5\u201d\u4e8c\u5b57\u7528\u4e8e\u533a\u5206\u4f7f\u7528 page cache \u673a\u5236\u7684\u7f13\u5b58 I/O\u3002</p> <ul> <li>\u7f13\u5b58\u6587\u4ef6 I/O\uff1a\u7528\u6237\u7a7a\u95f4\u8981\u8bfb\u5199\u4e00\u4e2a\u6587\u4ef6\u5e76\u4e0d\u76f4\u63a5\u4e0e\u78c1\u76d8\u4ea4\u4e92\uff0c\u800c\u662f\u4e2d\u95f4\u5939\u4e86\u4e00\u5c42\u7f13\u5b58\uff0c\u5373 page cache\uff1b</li> <li>\u76f4\u63a5\u6587\u4ef6 I/O\uff1a\u7528\u6237\u7a7a\u95f4\u8bfb\u53d6\u7684\u6587\u4ef6\u76f4\u63a5\u4e0e\u78c1\u76d8\u4ea4\u4e92\uff0c\u6ca1\u6709\u4e2d\u95f4 page cache \u5c42\uff1b</li> </ul> <p>\u201c\u76f4\u63a5\u201d\u5728\u8fd9\u91cc\u8fd8\u6709\u53e6\u4e00\u5c42\u8bed\u4e49\uff1a\u5176\u4ed6\u6240\u6709\u6280\u672f\u4e2d\uff0c\u6570\u636e\u81f3\u5c11\u9700\u8981\u5728\u5185\u6838\u7a7a\u95f4\u5b58\u50a8\u4e00\u4efd\uff0c\u4f46\u662f\u5728 Direct I/O \u6280\u672f\u4e2d\uff0c\u6570\u636e\u76f4\u63a5\u5b58\u50a8\u5728\u7528\u6237\u7a7a\u95f4\u4e2d\uff0c\u7ed5\u8fc7\u4e86\u5185\u6838\u3002</p> <p>Direct I/O \u6a21\u5f0f\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6b64\u65f6\u7528\u6237\u7a7a\u95f4\u76f4\u63a5\u901a\u8fc7 DMA \u7684\u65b9\u5f0f\u4e0e\u78c1\u76d8\u4ee5\u53ca\u7f51\u5361\u8fdb\u884c\u6570\u636e\u62f7\u8d1d\u3002</p> <p>Direct I/O \u7684\u8bfb\u5199\u975e\u5e38\u6709\u7279\u70b9\uff1a</p> <ul> <li>Write \u64cd\u4f5c\uff1a\u7531\u4e8e\u5176\u4e0d\u4f7f\u7528 page cache\uff0c\u6240\u4ee5\u5176\u8fdb\u884c\u5199\u6587\u4ef6\uff0c\u5982\u679c\u8fd4\u56de\u6210\u529f\uff0c\u6570\u636e\u5c31\u771f\u7684\u843d\u76d8\u4e86\uff08\u4e0d\u8003\u8651\u78c1\u76d8\u81ea\u5e26\u7684\u7f13\u5b58\uff09\uff1b</li> <li>Read \u64cd\u4f5c\uff1a\u7531\u4e8e\u5176\u4e0d\u4f7f\u7528 page cache\uff0c\u6bcf\u6b21\u8bfb\u64cd\u4f5c\u662f\u771f\u7684\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6\uff0c\u4e0d\u4f1a\u4ece\u6587\u4ef6\u7cfb\u7edf\u7684\u7f13\u5b58\u4e2d\u8bfb\u53d6\u3002</li> </ul> <p>\u53c2\u8003\u8d44\u6599</p> <ul> <li>Linux \u5185\u6838\u6280\u672f\u5b9e\u6218\u8bfe</li> <li>Reconsidering swapping</li> <li>\u8bbf\u95ee\u5c40\u90e8\u6027</li> <li>DMA \u4e0e\u96f6\u62f7\u8d1d\u6280\u672f</li> </ul> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/7_device/device/","title":"8.1 \u952e\u76d8\u6572\u5165 A \u5b57\u6bcd\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f","text":"<p>\u952e\u76d8\u53ef\u4ee5\u8bf4\u662f\u6211\u4eec\u6700\u5e38\u4f7f\u7528\u7684\u8f93\u5165\u786c\u4ef6\u8bbe\u5907\u4e86\uff0c\u4f46\u8eab\u4e3a\u7a0b\u5e8f\u5458\u7684\u4f60\uff0c\u4f60\u77e5\u9053\u300c\u952e\u76d8\u6572\u5165 A \u5b57\u6bcd\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\u5417\u300d\uff1f</p> <p>\u90a3\u8981\u60f3\u77e5\u9053\u8fd9\u4e2a\u53d1\u751f\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u5f97\u5148\u4e86\u89e3\u4e86\u89e3\u300c\u64cd\u4f5c\u7cfb\u7edf\u662f\u5982\u4f55\u7ba1\u7406\u591a\u79cd\u591a\u6837\u7684\u7684\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u300d\u7684\uff0c\u7b49\u4e86\u89e3\u5b8c\u8fd9\u4e2a\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f60\u5c31\u4f1a\u53d1\u73b0\u95ee\u9898\u5df2\u7ecf\u88ab\u8fce\u5203\u800c\u89e3\u4e86\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/7_device/device/#_1","title":"\u8bbe\u5907\u63a7\u5236\u5668","text":"<p>\u6211\u4eec\u7684\u7535\u8111\u8bbe\u5907\u53ef\u4ee5\u63a5\u975e\u5e38\u591a\u7684\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\uff0c\u6bd4\u5982\u952e\u76d8\u3001\u9f20\u6807\u3001\u663e\u793a\u5668\u3001\u7f51\u5361\u3001\u786c\u76d8\u3001\u6253\u5370\u673a\u3001\u97f3\u54cd\u7b49\u7b49\uff0c\u6bcf\u4e2a\u8bbe\u5907\u7684\u7528\u6cd5\u548c\u529f\u80fd\u90fd\u4e0d\u540c\uff0c\u90a3\u64cd\u4f5c\u7cfb\u7edf\u662f\u5982\u4f55\u628a\u8fd9\u4e9b\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7edf\u4e00\u7ba1\u7406\u7684\u5462\uff1f</p> <p>\u4e3a\u4e86\u5c4f\u853d\u8bbe\u5907\u4e4b\u95f4\u7684\u5dee\u5f02\uff0c\u6bcf\u4e2a\u8bbe\u5907\u90fd\u6709\u4e00\u4e2a\u53eb\u8bbe\u5907\u63a7\u5236\u5668\uff08Device Control\uff09 \u7684\u7ec4\u4ef6\uff0c\u6bd4\u5982\u786c\u76d8\u6709\u786c\u76d8\u63a7\u5236\u5668\u3001\u663e\u793a\u5668\u6709\u89c6\u9891\u63a7\u5236\u5668\u7b49\u3002</p> <p></p> <p>\u56e0\u4e3a\u8fd9\u4e9b\u63a7\u5236\u5668\u90fd\u5f88\u6e05\u695a\u7684\u77e5\u9053\u5bf9\u5e94\u8bbe\u5907\u7684\u7528\u6cd5\u548c\u529f\u80fd\uff0c\u6240\u4ee5 CPU \u662f\u901a\u8fc7\u8bbe\u5907\u63a7\u5236\u5668\u6765\u548c\u8bbe\u5907\u6253\u4ea4\u9053\u7684\u3002</p> <p>\u8bbe\u5907\u63a7\u5236\u5668\u91cc\u6709\u82af\u7247\uff0c\u5b83\u53ef\u6267\u884c\u81ea\u5df1\u7684\u903b\u8f91\uff0c\u4e5f\u6709\u81ea\u5df1\u7684\u5bc4\u5b58\u5668\uff0c\u7528\u6765\u4e0e CPU \u8fdb\u884c\u901a\u4fe1\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u901a\u8fc7\u5199\u5165\u8fd9\u4e9b\u5bc4\u5b58\u5668\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u547d\u4ee4\u8bbe\u5907\u53d1\u9001\u6570\u636e\u3001\u63a5\u6536\u6570\u636e\u3001\u5f00\u542f\u6216\u5173\u95ed\uff0c\u6216\u8005\u6267\u884c\u67d0\u4e9b\u5176\u4ed6\u64cd\u4f5c\u3002</li> <li>\u901a\u8fc7\u8bfb\u53d6\u8fd9\u4e9b\u5bc4\u5b58\u5668\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u4ee5\u4e86\u89e3\u8bbe\u5907\u7684\u72b6\u6001\uff0c\u662f\u5426\u51c6\u5907\u597d\u63a5\u6536\u4e00\u4e2a\u65b0\u7684\u547d\u4ee4\u7b49\u3002</li> </ul> <p>\u5b9e\u9645\u4e0a\uff0c\u63a7\u5236\u5668\u662f\u6709\u4e09\u7c7b\u5bc4\u5b58\u5668\uff0c\u5b83\u4eec\u5206\u522b\u662f\u72b6\u6001\u5bc4\u5b58\u5668\uff08Status Register\uff09\u3001 \u547d\u4ee4\u5bc4\u5b58\u5668\uff08Command Register\uff09\u4ee5\u53ca\u6570\u636e\u5bc4\u5b58\u5668\uff08Data Register\uff09\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u4e09\u4e2a\u5bc4\u5b58\u5668\u7684\u4f5c\u7528\uff1a</p> <ul> <li>\u6570\u636e\u5bc4\u5b58\u5668\uff0cCPU \u5411 I/O \u8bbe\u5907\u5199\u5165\u9700\u8981\u4f20\u8f93\u7684\u6570\u636e\uff0c\u6bd4\u5982\u8981\u6253\u5370\u7684\u5185\u5bb9\u662f\u300cHello\u300d\uff0cCPU \u5c31\u8981\u5148\u53d1\u9001\u4e00\u4e2a H \u5b57\u7b26\u7ed9\u5230\u5bf9\u5e94\u7684 I/O \u8bbe\u5907\u3002</li> <li>\u547d\u4ee4\u5bc4\u5b58\u5668\uff0cCPU \u53d1\u9001\u4e00\u4e2a\u547d\u4ee4\uff0c\u544a\u8bc9 I/O \u8bbe\u5907\uff0c\u8981\u8fdb\u884c\u8f93\u5165/\u8f93\u51fa\u64cd\u4f5c\uff0c\u4e8e\u662f\u5c31\u4f1a\u4ea4\u7ed9 I/O \u8bbe\u5907\u53bb\u5de5\u4f5c\uff0c\u4efb\u52a1\u5b8c\u6210\u540e\uff0c\u4f1a\u628a\u72b6\u6001\u5bc4\u5b58\u5668\u91cc\u9762\u7684\u72b6\u6001\u6807\u8bb0\u4e3a\u5b8c\u6210\u3002</li> <li>\u72b6\u6001\u5bc4\u5b58\u5668\uff0c\u76ee\u7684\u662f\u544a\u8bc9 CPU\uff0c\u73b0\u5728\u5df2\u7ecf\u5728\u5de5\u4f5c\u6216\u5de5\u4f5c\u5df2\u7ecf\u5b8c\u6210\uff0c\u5982\u679c\u5df2\u7ecf\u5728\u5de5\u4f5c\u72b6\u6001\uff0cCPU \u518d\u53d1\u9001\u6570\u636e\u6216\u8005\u547d\u4ee4\u8fc7\u6765\uff0c\u90fd\u662f\u6ca1\u6709\u7528\u7684\uff0c\u76f4\u5230\u524d\u9762\u7684\u5de5\u4f5c\u5df2\u7ecf\u5b8c\u6210\uff0c\u72b6\u6001\u5bc4\u5b58\u6807\u8bb0\u6210\u5df2\u5b8c\u6210\uff0cCPU \u624d\u80fd\u53d1\u9001\u4e0b\u4e00\u4e2a\u5b57\u7b26\u548c\u547d\u4ee4\u3002</li> </ul> <p>CPU \u901a\u8fc7\u8bfb\u5199\u8bbe\u5907\u63a7\u5236\u5668\u4e2d\u7684\u5bc4\u5b58\u5668\u63a7\u5236\u8bbe\u5907\uff0c\u8fd9\u53ef\u6bd4 CPU \u76f4\u63a5\u63a7\u5236\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\uff0c\u8981\u65b9\u4fbf\u548c\u6807\u51c6\u5f88\u591a\u3002</p> <p>\u53e6\u5916\uff0c\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u53ef\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a\u5757\u8bbe\u5907\uff08Block Device\uff09\u548c\u5b57\u7b26\u8bbe\u5907\uff08Character Device\uff09\u3002</p> <ul> <li>\u5757\u8bbe\u5907\uff0c\u628a\u6570\u636e\u5b58\u50a8\u5728\u56fa\u5b9a\u5927\u5c0f\u7684\u5757\u4e2d\uff0c\u6bcf\u4e2a\u5757\u6709\u81ea\u5df1\u7684\u5730\u5740\uff0c\u786c\u76d8\u3001USB \u662f\u5e38\u89c1\u7684\u5757\u8bbe\u5907\u3002</li> <li>\u5b57\u7b26\u8bbe\u5907\uff0c\u4ee5\u5b57\u7b26\u4e3a\u5355\u4f4d\u53d1\u9001\u6216\u63a5\u6536\u4e00\u4e2a\u5b57\u7b26\u6d41\uff0c\u5b57\u7b26\u8bbe\u5907\u662f\u4e0d\u53ef\u5bfb\u5740\u7684\uff0c\u4e5f\u6ca1\u6709\u4efb\u4f55\u5bfb\u9053\u64cd\u4f5c\uff0c\u9f20\u6807\u662f\u5e38\u89c1\u7684\u5b57\u7b26\u8bbe\u5907\u3002</li> </ul> <p>\u5757\u8bbe\u5907\u901a\u5e38\u4f20\u8f93\u7684\u6570\u636e\u91cf\u4f1a\u975e\u5e38\u5927\uff0c\u4e8e\u662f\u63a7\u5236\u5668\u8bbe\u7acb\u4e86\u4e00\u4e2a\u53ef\u8bfb\u5199\u7684\u6570\u636e\u7f13\u51b2\u533a\u3002</p> <ul> <li>CPU \u5199\u5165\u6570\u636e\u5230\u63a7\u5236\u5668\u7684\u7f13\u51b2\u533a\u65f6\uff0c\u5f53\u7f13\u51b2\u533a\u7684\u6570\u636e\u56e4\u591f\u4e86\u4e00\u90e8\u5206\uff0c\u624d\u4f1a\u53d1\u7ed9\u8bbe\u5907\u3002</li> <li>CPU \u4ece\u63a7\u5236\u5668\u7684\u7f13\u51b2\u533a\u8bfb\u53d6\u6570\u636e\u65f6\uff0c\u4e5f\u9700\u8981\u7f13\u51b2\u533a\u56e4\u591f\u4e86\u4e00\u90e8\u5206\uff0c\u624d\u62f7\u8d1d\u5230\u5185\u5b58\u3002</li> </ul> <p>\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\uff0c\u51cf\u5c11\u5bf9\u8bbe\u5907\u7684\u9891\u7e41\u64cd\u4f5c\u3002</p> <p>\u90a3 CPU \u662f\u5982\u4f55\u4e0e\u8bbe\u5907\u7684\u63a7\u5236\u5bc4\u5b58\u5668\u548c\u6570\u636e\u7f13\u51b2\u533a\u8fdb\u884c\u901a\u4fe1\u7684\uff1f\u5b58\u5728\u4e24\u4e2a\u65b9\u6cd5\uff1a</p> <ul> <li>\u7aef\u53e3 I/O\uff0c\u6bcf\u4e2a\u63a7\u5236\u5bc4\u5b58\u5668\u88ab\u5206\u914d\u4e00\u4e2a I/O \u7aef\u53e3\uff0c\u53ef\u4ee5\u901a\u8fc7\u7279\u6b8a\u7684\u6c47\u7f16\u6307\u4ee4\u64cd\u4f5c\u8fd9\u4e9b\u5bc4\u5b58\u5668\uff0c\u6bd4\u5982 <code>in/out</code> \u7c7b\u4f3c\u7684\u6307\u4ee4\u3002</li> <li>\u5185\u5b58\u6620\u5c04 I/O\uff0c\u5c06\u6240\u6709\u63a7\u5236\u5bc4\u5b58\u5668\u6620\u5c04\u5230\u5185\u5b58\u7a7a\u95f4\u4e2d\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u50cf\u8bfb\u5199\u5185\u5b58\u4e00\u6837\u8bfb\u5199\u6570\u636e\u7f13\u51b2\u533a\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/7_device/device/#io","title":"I/O \u63a7\u5236\u65b9\u5f0f","text":"<p>\u5728\u524d\u9762\u6211\u77e5\u9053\uff0c\u6bcf\u79cd\u8bbe\u5907\u90fd\u6709\u4e00\u4e2a\u8bbe\u5907\u63a7\u5236\u5668\uff0c\u63a7\u5236\u5668\u76f8\u5f53\u4e8e\u4e00\u4e2a\u5c0f CPU\uff0c\u5b83\u53ef\u4ee5\u81ea\u5df1\u5904\u7406\u4e00\u4e9b\u4e8b\u60c5\uff0c\u4f46\u6709\u4e2a\u95ee\u9898\u662f\uff0c\u5f53 CPU \u7ed9\u8bbe\u5907\u53d1\u9001\u4e86\u4e00\u4e2a\u6307\u4ee4\uff0c\u8ba9\u8bbe\u5907\u63a7\u5236\u5668\u53bb\u8bfb\u8bbe\u5907\u7684\u6570\u636e\uff0c\u5b83\u8bfb\u5b8c\u7684\u65f6\u5019\uff0c\u8981\u600e\u4e48\u901a\u77e5 CPU \u5462\uff1f</p> <p>\u63a7\u5236\u5668\u7684\u5bc4\u5b58\u5668\u4e00\u822c\u4f1a\u6709\u72b6\u6001\u6807\u8bb0\u4f4d\uff0c\u7528\u6765\u6807\u8bc6\u8f93\u5165\u6216\u8f93\u51fa\u64cd\u4f5c\u662f\u5426\u5b8c\u6210\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u60f3\u5230\u7b2c\u4e00\u79cd\u8f6e\u8be2\u7b49\u5f85\u7684\u65b9\u6cd5\uff0c\u8ba9 CPU \u4e00\u76f4\u67e5\u5bc4\u5b58\u5668\u7684\u72b6\u6001\uff0c\u76f4\u5230\u72b6\u6001\u6807\u8bb0\u4e3a\u5b8c\u6210\uff0c\u5f88\u660e\u663e\uff0c\u8fd9\u79cd\u65b9\u5f0f\u975e\u5e38\u7684\u50bb\u74dc\uff0c\u5b83\u4f1a\u5360\u7528 CPU \u7684\u5168\u90e8\u65f6\u95f4\u3002</p> <p>\u90a3\u6211\u4eec\u5c31\u60f3\u5230\u7b2c\u4e8c\u79cd\u65b9\u6cd5 \u2014\u2014 \u4e2d\u65ad\uff0c\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\u6570\u636e\u5df2\u7ecf\u51c6\u5907\u597d\u4e86\u3002\u6211\u4eec\u4e00\u822c\u4f1a\u6709\u4e00\u4e2a\u786c\u4ef6\u7684\u4e2d\u65ad\u63a7\u5236\u5668\uff0c\u5f53\u8bbe\u5907\u5b8c\u6210\u4efb\u52a1\u540e\u89e6\u53d1\u4e2d\u65ad\u5230\u4e2d\u65ad\u63a7\u5236\u5668\uff0c\u4e2d\u65ad\u63a7\u5236\u5668\u5c31\u901a\u77e5 CPU\uff0c\u4e00\u4e2a\u4e2d\u65ad\u4ea7\u751f\u4e86\uff0cCPU \u9700\u8981\u505c\u4e0b\u5f53\u524d\u624b\u91cc\u7684\u4e8b\u60c5\u6765\u5904\u7406\u4e2d\u65ad\u3002</p> <p>\u53e6\u5916\uff0c\u4e2d\u65ad\u6709\u4e24\u79cd\uff0c\u4e00\u79cd\u8f6f\u4e2d\u65ad\uff0c\u4f8b\u5982\u4ee3\u7801\u8c03\u7528 <code>INT</code> \u6307\u4ee4\u89e6\u53d1\uff0c\u4e00\u79cd\u662f\u786c\u4ef6\u4e2d\u65ad\uff0c\u5c31\u662f\u786c\u4ef6\u901a\u8fc7\u4e2d\u65ad\u63a7\u5236\u5668\u89e6\u53d1\u7684\u3002</p> <p>\u4f46\u4e2d\u65ad\u7684\u65b9\u5f0f\u5bf9\u4e8e\u9891\u7e41\u8bfb\u5199\u6570\u636e\u7684\u78c1\u76d8\uff0c\u5e76\u4e0d\u53cb\u597d\uff0c\u8fd9\u6837 CPU \u5bb9\u6613\u7ecf\u5e38\u88ab\u6253\u65ad\uff0c\u4f1a\u5360\u7528 CPU \u5927\u91cf\u7684\u65f6\u95f4\u3002\u5bf9\u4e8e\u8fd9\u4e00\u7c7b\u8bbe\u5907\u7684\u95ee\u9898\u7684\u89e3\u51b3\u65b9\u6cd5\u662f\u4f7f\u7528 DMA\uff08Direct Memory Access\uff09 \u529f\u80fd\uff0c\u5b83\u53ef\u4ee5\u4f7f\u5f97\u8bbe\u5907\u5728 CPU \u4e0d\u53c2\u4e0e\u7684\u60c5\u51b5\u4e0b\uff0c\u80fd\u591f\u81ea\u884c\u5b8c\u6210\u628a\u8bbe\u5907 I/O \u6570\u636e\u653e\u5165\u5230\u5185\u5b58\u3002\u90a3\u8981\u5b9e\u73b0 DMA \u529f\u80fd\u8981\u6709\u300cDMA \u63a7\u5236\u5668\u300d\u786c\u4ef6\u7684\u652f\u6301\u3002</p> <p></p> <p>DMA \u7684\u5de5\u4f5c\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <ul> <li>CPU \u9700\u5bf9 DMA \u63a7\u5236\u5668\u4e0b\u53d1\u6307\u4ee4\uff0c\u544a\u8bc9\u5b83\u60f3\u8bfb\u53d6\u591a\u5c11\u6570\u636e\uff0c\u8bfb\u5b8c\u7684\u6570\u636e\u653e\u5728\u5185\u5b58\u7684\u67d0\u4e2a\u5730\u65b9\u5c31\u53ef\u4ee5\u4e86\uff1b</li> <li>\u63a5\u4e0b\u6765\uff0cDMA \u63a7\u5236\u5668\u4f1a\u5411\u78c1\u76d8\u63a7\u5236\u5668\u53d1\u51fa\u6307\u4ee4\uff0c\u901a\u77e5\u5b83\u4ece\u78c1\u76d8\u8bfb\u6570\u636e\u5230\u5176\u5185\u90e8\u7684\u7f13\u51b2\u533a\u4e2d\uff0c\u63a5\u7740\u78c1\u76d8\u63a7\u5236\u5668\u5c06\u7f13\u51b2\u533a\u7684\u6570\u636e\u4f20\u8f93\u5230\u5185\u5b58\uff1b</li> <li>\u5f53\u78c1\u76d8\u63a7\u5236\u5668\u628a\u6570\u636e\u4f20\u8f93\u5230\u5185\u5b58\u7684\u64cd\u4f5c\u5b8c\u6210\u540e\uff0c\u78c1\u76d8\u63a7\u5236\u5668\u5728\u603b\u7ebf\u4e0a\u53d1\u51fa\u4e00\u4e2a\u786e\u8ba4\u6210\u529f\u7684\u4fe1\u53f7\u5230 DMA \u63a7\u5236\u5668\uff1b</li> <li>DMA \u63a7\u5236\u5668\u6536\u5230\u4fe1\u53f7\u540e\uff0cDMA \u63a7\u5236\u5668\u53d1\u4e2d\u65ad\u901a\u77e5 CPU \u6307\u4ee4\u5b8c\u6210\uff0cCPU \u5c31\u53ef\u4ee5\u76f4\u63a5\u7528\u5185\u5b58\u91cc\u9762\u73b0\u6210\u7684\u6570\u636e\u4e86\uff1b</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0cCPU \u5f53\u8981\u8bfb\u53d6\u78c1\u76d8\u6570\u636e\u7684\u65f6\u5019\uff0c\u53ea\u9700\u7ed9 DMA \u63a7\u5236\u5668\u53d1\u9001\u6307\u4ee4\uff0c\u7136\u540e\u8fd4\u56de\u53bb\u505a\u5176\u4ed6\u4e8b\u60c5\uff0c\u5f53\u78c1\u76d8\u6570\u636e\u62f7\u8d1d\u5230\u5185\u5b58\u540e\uff0cDMA \u63a7\u5236\u673a\u5668\u901a\u8fc7\u4e2d\u65ad\u7684\u65b9\u5f0f\uff0c\u544a\u8bc9 CPU \u6570\u636e\u5df2\u7ecf\u51c6\u5907\u597d\u4e86\uff0c\u53ef\u4ee5\u4ece\u5185\u5b58\u8bfb\u6570\u636e\u4e86\u3002\u4ec5\u4ec5\u5728\u4f20\u9001\u5f00\u59cb\u548c\u7ed3\u675f\u65f6\u9700\u8981 CPU \u5e72\u9884\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/7_device/device/#_2","title":"\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f","text":"<p>\u867d\u7136\u8bbe\u5907\u63a7\u5236\u5668\u5c4f\u853d\u4e86\u8bbe\u5907\u7684\u4f17\u591a\u7ec6\u8282\uff0c\u4f46\u6bcf\u79cd\u8bbe\u5907\u7684\u63a7\u5236\u5668\u7684\u5bc4\u5b58\u5668\u3001\u7f13\u51b2\u533a\u7b49\u4f7f\u7528\u6a21\u5f0f\u90fd\u662f\u4e0d\u540c\u7684\uff0c\u6240\u4ee5\u4e3a\u4e86\u5c4f\u853d\u300c\u8bbe\u5907\u63a7\u5236\u5668\u300d\u7684\u5dee\u5f02\uff0c\u5f15\u5165\u4e86\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u3002</p> <p></p> <p>\u8bbe\u5907\u63a7\u5236\u5668\u4e0d\u5c5e\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u8303\u7574\uff0c\u5b83\u662f\u5c5e\u4e8e\u786c\u4ef6\uff0c\u800c\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u5c5e\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u7684\u4e00\u90e8\u5206\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u6838\u4ee3\u7801\u53ef\u4ee5\u50cf\u672c\u5730\u8c03\u7528\u4ee3\u7801\u4e00\u6837\u4f7f\u7528\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u7684\u63a5\u53e3\uff0c\u800c\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u662f\u9762\u5411\u8bbe\u5907\u63a7\u5236\u5668\u7684\u4ee3\u7801\uff0c\u5b83\u53d1\u51fa\u64cd\u63a7\u8bbe\u5907\u63a7\u5236\u5668\u7684\u6307\u4ee4\u540e\uff0c\u624d\u53ef\u4ee5\u64cd\u4f5c\u8bbe\u5907\u63a7\u5236\u5668\u3002</p> <p>\u4e0d\u540c\u7684\u8bbe\u5907\u63a7\u5236\u5668\u867d\u7136\u529f\u80fd\u4e0d\u540c\uff0c\u4f46\u662f\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u4f1a\u63d0\u4f9b\u7edf\u4e00\u7684\u63a5\u53e3\u7ed9\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd9\u6837\u4e0d\u540c\u7684\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5c31\u53ef\u4ee5\u4ee5\u76f8\u540c\u7684\u65b9\u5f0f\u63a5\u5165\u64cd\u4f5c\u7cfb\u7edf\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u524d\u9762\u63d0\u5230\u4e86\u4e0d\u5c11\u5173\u4e8e\u4e2d\u65ad\u7684\u4e8b\u60c5\uff0c\u8bbe\u5907\u5b8c\u6210\u4e86\u4e8b\u60c5\uff0c\u5219\u4f1a\u53d1\u9001\u4e2d\u65ad\u6765\u901a\u77e5\u64cd\u4f5c\u7cfb\u7edf\u3002\u90a3\u64cd\u4f5c\u7cfb\u7edf\u5c31\u9700\u8981\u6709\u4e00\u4e2a\u5730\u65b9\u6765\u5904\u7406\u8fd9\u4e2a\u4e2d\u65ad\uff0c\u8fd9\u4e2a\u5730\u65b9\u4e5f\u5c31\u662f\u5728\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u91cc\uff0c\u5b83\u4f1a\u53ca\u65f6\u54cd\u5e94\u63a7\u5236\u5668\u53d1\u6765\u7684\u4e2d\u65ad\u8bf7\u6c42\uff0c\u5e76\u6839\u636e\u8fd9\u4e2a\u4e2d\u65ad\u7684\u7c7b\u578b\u8c03\u7528\u54cd\u5e94\u7684\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u8fdb\u884c\u5904\u7406\u3002</p> <p>\u901a\u5e38\uff0c\u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u521d\u59cb\u5316\u7684\u65f6\u5019\uff0c\u8981\u5148\u6ce8\u518c\u4e00\u4e2a\u8be5\u8bbe\u5907\u7684\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u3002</p> <p></p> <p>\u6211\u4eec\u6765\u770b\u770b\uff0c\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u7684\u5904\u7406\u6d41\u7a0b\uff1a</p> <ol> <li>\u5728 I/O \u65f6\uff0c\u8bbe\u5907\u63a7\u5236\u5668\u5982\u679c\u5df2\u7ecf\u51c6\u5907\u597d\u6570\u636e\uff0c\u5219\u4f1a\u901a\u8fc7\u4e2d\u65ad\u63a7\u5236\u5668\u5411 CPU \u53d1\u9001\u4e2d\u65ad\u8bf7\u6c42\uff1b</li> <li>\u4fdd\u62a4\u88ab\u4e2d\u65ad\u8fdb\u7a0b\u7684 CPU \u4e0a\u4e0b\u6587\uff1b</li> <li>\u8f6c\u5165\u76f8\u5e94\u7684\u8bbe\u5907\u4e2d\u65ad\u5904\u7406\u51fd\u6570\uff1b</li> <li>\u8fdb\u884c\u4e2d\u65ad\u5904\u7406\uff1b</li> <li>\u6062\u590d\u88ab\u4e2d\u65ad\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\uff1b</li> </ol>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/7_device/device/#_3","title":"\u901a\u7528\u5757\u5c42","text":"<p>\u5bf9\u4e8e\u5757\u8bbe\u5907\uff0c\u4e3a\u4e86\u51cf\u5c11\u4e0d\u540c\u5757\u8bbe\u5907\u7684\u5dee\u5f02\u5e26\u6765\u7684\u5f71\u54cd\uff0cLinux \u901a\u8fc7\u4e00\u4e2a\u7edf\u4e00\u7684\u901a\u7528\u5757\u5c42\uff0c\u6765\u7ba1\u7406\u4e0d\u540c\u7684\u5757\u8bbe\u5907\u3002</p> <p>\u901a\u7528\u5757\u5c42\u662f\u5904\u4e8e\u6587\u4ef6\u7cfb\u7edf\u548c\u78c1\u76d8\u9a71\u52a8\u4e2d\u95f4\u7684\u4e00\u4e2a\u5757\u8bbe\u5907\u62bd\u8c61\u5c42\uff0c\u5b83\u4e3b\u8981\u6709\u4e24\u4e2a\u529f\u80fd\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a\u529f\u80fd\uff0c\u5411\u4e0a\u4e3a\u6587\u4ef6\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\uff0c\u63d0\u4f9b\u8bbf\u95ee\u5757\u8bbe\u5907\u7684\u6807\u51c6\u63a5\u53e3\uff0c\u5411\u4e0b\u628a\u5404\u79cd\u4e0d\u540c\u7684\u78c1\u76d8\u8bbe\u5907\u62bd\u8c61\u4e3a\u7edf\u4e00\u7684\u5757\u8bbe\u5907\uff0c\u5e76\u5728\u5185\u6838\u5c42\u9762\uff0c\u63d0\u4f9b\u4e00\u4e2a\u6846\u67b6\u6765\u7ba1\u7406\u8fd9\u4e9b\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f\uff1b</li> <li>\u7b2c\u4e8c\u529f\u80fd\uff0c\u901a\u7528\u5c42\u8fd8\u4f1a\u7ed9\u6587\u4ef6\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\u53d1\u6765\u7684 I/O \u8bf7\u6c42\u6392\u961f\uff0c\u63a5\u7740\u4f1a\u5bf9\u961f\u5217\u91cd\u65b0\u6392\u5e8f\u3001\u8bf7\u6c42\u5408\u5e76\u7b49\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f I/O \u8c03\u5ea6\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u63d0\u9ad8\u78c1\u76d8\u8bfb\u5199\u7684\u6548\u7387\u3002</li> </ul> <p>Linux \u5185\u5b58\u652f\u6301 5 \u79cd I/O \u8c03\u5ea6\u7b97\u6cd5\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u6ca1\u6709\u8c03\u5ea6\u7b97\u6cd5</li> <li>\u5148\u5165\u5148\u51fa\u8c03\u5ea6\u7b97\u6cd5</li> <li>\u5b8c\u5168\u516c\u5e73\u8c03\u5ea6\u7b97\u6cd5</li> <li>\u4f18\u5148\u7ea7\u8c03\u5ea6</li> <li>\u6700\u7ec8\u671f\u9650\u8c03\u5ea6\u7b97\u6cd5</li> </ul> <p>\u7b2c\u4e00\u79cd\uff0c\u6ca1\u6709\u8c03\u5ea6\u7b97\u6cd5\uff0c\u662f\u7684\uff0c\u4f60\u6ca1\u542c\u9519\uff0c\u5b83\u4e0d\u5bf9\u6587\u4ef6\u7cfb\u7edf\u548c\u5e94\u7528\u7a0b\u5e8f\u7684 I/O \u505a\u4efb\u4f55\u5904\u7406\uff0c\u8fd9\u79cd\u7b97\u6cd5\u5e38\u7528\u5728\u865a\u62df\u673a I/O \u4e2d\uff0c\u6b64\u65f6\u78c1\u76d8 I/O \u8c03\u5ea6\u7b97\u6cd5\u4ea4\u7531\u7269\u7406\u673a\u7cfb\u7edf\u8d1f\u8d23\u3002</p> <p>\u7b2c\u4e8c\u79cd\uff0c\u5148\u5165\u5148\u51fa\u8c03\u5ea6\u7b97\u6cd5\uff0c\u8fd9\u662f\u6700\u7b80\u5355\u7684 I/O \u8c03\u5ea6\u7b97\u6cd5\uff0c\u5148\u8fdb\u5165 I/O \u8c03\u5ea6\u961f\u5217\u7684 I/O \u8bf7\u6c42\u5148\u53d1\u751f\u3002</p> <p>\u7b2c\u4e09\u79cd\uff0c\u5b8c\u5168\u516c\u5e73\u8c03\u5ea6\u7b97\u6cd5\uff0c\u5927\u90e8\u5206\u7cfb\u7edf\u90fd\u628a\u8fd9\u4e2a\u7b97\u6cd5\u4f5c\u4e3a\u9ed8\u8ba4\u7684 I/O \u8c03\u5ea6\u5668\uff0c\u5b83\u4e3a\u6bcf\u4e2a\u8fdb\u7a0b\u7ef4\u62a4\u4e86\u4e00\u4e2a I/O \u8c03\u5ea6\u961f\u5217\uff0c\u5e76\u6309\u7167\u65f6\u95f4\u7247\u6765\u5747\u5300\u5206\u5e03\u6bcf\u4e2a\u8fdb\u7a0b\u7684 I/O \u8bf7\u6c42\u3002</p> <p>\u7b2c\u56db\u79cd\uff0c\u4f18\u5148\u7ea7\u8c03\u5ea6\u7b97\u6cd5\uff0c\u987e\u540d\u601d\u4e49\uff0c\u4f18\u5148\u7ea7\u9ad8\u7684 I/O \u8bf7\u6c42\u5148\u53d1\u751f\uff0c\u5b83\u9002\u7528\u4e8e\u8fd0\u884c\u5927\u91cf\u8fdb\u7a0b\u7684\u7cfb\u7edf\uff0c\u50cf\u662f\u684c\u9762\u73af\u5883\u3001\u591a\u5a92\u4f53\u5e94\u7528\u7b49\u3002</p> <p>\u7b2c\u4e94\u79cd\uff0c\u6700\u7ec8\u671f\u9650\u8c03\u5ea6\u7b97\u6cd5\uff0c\u5206\u522b\u4e3a\u8bfb\u3001\u5199\u8bf7\u6c42\u521b\u5efa\u4e86\u4e0d\u540c\u7684 I/O \u961f\u5217\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u673a\u68b0\u78c1\u76d8\u7684\u541e\u5410\u91cf\uff0c\u5e76\u786e\u4fdd\u8fbe\u5230\u6700\u7ec8\u671f\u9650\u7684\u8bf7\u6c42\u88ab\u4f18\u5148\u5904\u7406\uff0c\u9002\u7528\u4e8e\u5728 I/O \u538b\u529b\u6bd4\u8f83\u5927\u7684\u573a\u666f\uff0c\u6bd4\u5982\u6570\u636e\u5e93\u7b49\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/7_device/device/#io_1","title":"\u5b58\u50a8\u7cfb\u7edf I/O \u8f6f\u4ef6\u5206\u5c42","text":"<p>\u524d\u9762\u8bf4\u5230\u4e86\u4e0d\u5c11\u4e1c\u897f\uff0c\u8bbe\u5907\u3001\u8bbe\u5907\u63a7\u5236\u5668\u3001\u9a71\u52a8\u7a0b\u5e8f\u3001\u901a\u7528\u5757\u5c42\uff0c\u73b0\u5728\u518d\u7ed3\u5408\u6587\u4ef6\u7cfb\u7edf\u539f\u7406\uff0c\u6211\u4eec\u6765\u770b\u770b Linux \u5b58\u50a8\u7cfb\u7edf\u7684 I/O \u8f6f\u4ef6\u5206\u5c42\u3002</p> <p>\u53ef\u4ee5\u628a Linux \u5b58\u50a8\u7cfb\u7edf\u7684 I/O \u7531\u4e0a\u5230\u4e0b\u53ef\u4ee5\u5206\u4e3a\u4e09\u4e2a\u5c42\u6b21\uff0c\u5206\u522b\u662f\u6587\u4ef6\u7cfb\u7edf\u5c42\u3001\u901a\u7528\u5757\u5c42\u3001\u8bbe\u5907\u5c42\u3002\u4ed6\u4eec\u6574\u4e2a\u7684\u5c42\u6b21\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u4e09\u4e2a\u5c42\u6b21\u7684\u4f5c\u7528\u662f\uff1a</p> <ul> <li>\u6587\u4ef6\u7cfb\u7edf\u5c42\uff0c\u5305\u62ec\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\u548c\u5176\u4ed6\u6587\u4ef6\u7cfb\u7edf\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u5b83\u5411\u4e0a\u4e3a\u5e94\u7528\u7a0b\u5e8f\u7edf\u4e00\u63d0\u4f9b\u4e86\u6807\u51c6\u7684\u6587\u4ef6\u8bbf\u95ee\u63a5\u53e3\uff0c\u5411\u4e0b\u4f1a\u901a\u8fc7\u901a\u7528\u5757\u5c42\u6765\u5b58\u50a8\u548c\u7ba1\u7406\u78c1\u76d8\u6570\u636e\u3002</li> <li>\u901a\u7528\u5757\u5c42\uff0c\u5305\u62ec\u5757\u8bbe\u5907\u7684 I/O \u961f\u5217\u548c I/O \u8c03\u5ea6\u5668\uff0c\u5b83\u4f1a\u5bf9\u6587\u4ef6\u7cfb\u7edf\u7684 I/O \u8bf7\u6c42\u8fdb\u884c\u6392\u961f\uff0c\u518d\u901a\u8fc7 I/O \u8c03\u5ea6\u5668\uff0c\u9009\u62e9\u4e00\u4e2a I/O \u53d1\u7ed9\u4e0b\u4e00\u5c42\u7684\u8bbe\u5907\u5c42\u3002</li> <li>\u8bbe\u5907\u5c42\uff0c\u5305\u62ec\u786c\u4ef6\u8bbe\u5907\u3001\u8bbe\u5907\u63a7\u5236\u5668\u548c\u9a71\u52a8\u7a0b\u5e8f\uff0c\u8d1f\u8d23\u6700\u7ec8\u7269\u7406\u8bbe\u5907\u7684 I/O \u64cd\u4f5c\u3002</li> </ul> <p>\u6709\u4e86\u6587\u4ef6\u7cfb\u7edf\u63a5\u53e3\u4e4b\u540e\uff0c\u4e0d\u4f46\u53ef\u4ee5\u901a\u8fc7\u6587\u4ef6\u7cfb\u7edf\u7684\u547d\u4ee4\u884c\u64cd\u4f5c\u8bbe\u5907\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5e94\u7528\u7a0b\u5e8f\uff0c\u8c03\u7528 <code>read</code>\u3001<code>write</code> \u51fd\u6570\uff0c\u5c31\u50cf\u8bfb\u5199\u6587\u4ef6\u4e00\u6837\u64cd\u4f5c\u8bbe\u5907\uff0c\u6240\u4ee5\u8bf4\u8bbe\u5907\u5728 Linux \u4e0b\uff0c\u4e5f\u53ea\u662f\u4e00\u4e2a\u7279\u6b8a\u7684\u6587\u4ef6\u3002</p> <p>\u4f46\u662f\uff0c\u9664\u4e86\u8bfb\u5199\u64cd\u4f5c\uff0c\u8fd8\u9700\u8981\u6709\u68c0\u67e5\u7279\u5b9a\u4e8e\u8bbe\u5907\u7684\u529f\u80fd\u548c\u5c5e\u6027\u3002\u4e8e\u662f\uff0c\u9700\u8981 <code>ioctl</code> \u63a5\u53e3\uff0c\u5b83\u8868\u793a\u8f93\u5165\u8f93\u51fa\u63a7\u5236\u63a5\u53e3\uff0c\u662f\u7528\u4e8e\u914d\u7f6e\u548c\u4fee\u6539\u7279\u5b9a\u8bbe\u5907\u5c5e\u6027\u7684\u901a\u7528\u63a5\u53e3\u3002</p> <p>\u53e6\u5916\uff0c\u5b58\u50a8\u7cfb\u7edf\u7684 I/O \u662f\u6574\u4e2a\u7cfb\u7edf\u6700\u6162\u7684\u4e00\u4e2a\u73af\u8282\uff0c\u6240\u4ee5 Linux \u63d0\u4f9b\u4e86\u4e0d\u5c11\u7f13\u5b58\u673a\u5236\u6765\u63d0\u9ad8 I/O \u7684\u6548\u7387\u3002</p> <ul> <li>\u4e3a\u4e86\u63d0\u9ad8\u6587\u4ef6\u8bbf\u95ee\u7684\u6548\u7387\uff0c\u4f1a\u4f7f\u7528\u9875\u7f13\u5b58\u3001\u7d22\u5f15\u8282\u70b9\u7f13\u5b58\u3001\u76ee\u5f55\u9879\u7f13\u5b58\u7b49\u591a\u79cd\u7f13\u5b58\u673a\u5236\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u51cf\u5c11\u5bf9\u5757\u8bbe\u5907\u7684\u76f4\u63a5\u8c03\u7528\u3002</li> <li>\u4e3a\u4e86\u63d0\u9ad8\u5757\u8bbe\u5907\u7684\u8bbf\u95ee\u6548\u7387\uff0c\u4f1a\u4f7f\u7528\u7f13\u51b2\u533a\uff0c\u6765\u7f13\u5b58\u5757\u8bbe\u5907\u7684\u6570\u636e\u3002</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/7_device/device/#_4","title":"\u952e\u76d8\u6572\u5165\u5b57\u6bcd\u65f6\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f","text":"<p>\u770b\u5b8c\u524d\u9762\u7684\u5185\u5bb9\uff0c\u76f8\u4fe1\u4f60\u5bf9\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7684\u7ba1\u7406\u6709\u4e86\u4e00\u5b9a\u7684\u8ba4\u8bc6\uff0c\u90a3\u63a5\u4e0b\u6765\u5c31\u4ece\u64cd\u4f5c\u7cfb\u7edf\u7684\u89d2\u5ea6\u56de\u7b54\u5f00\u5934\u7684\u95ee\u9898\u300c\u952e\u76d8\u6572\u5165\u5b57\u6bcd\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f\u300d</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b CPU \u7684\u786c\u4ef6\u67b6\u6784\u56fe\uff1a</p> <p></p> <p>CPU \u91cc\u9762\u7684\u5185\u5b58\u63a5\u53e3\uff0c\u76f4\u63a5\u548c\u7cfb\u7edf\u603b\u7ebf\u901a\u4fe1\uff0c\u7136\u540e\u7cfb\u7edf\u603b\u7ebf\u518d\u63a5\u5165\u4e00\u4e2a I/O \u6865\u63a5\u5668\uff0c\u8fd9\u4e2a I/O \u6865\u63a5\u5668\uff0c\u53e6\u4e00\u8fb9\u63a5\u5165\u4e86\u5185\u5b58\u603b\u7ebf\uff0c\u4f7f\u5f97 CPU \u548c\u5185\u5b58\u901a\u4fe1\u3002\u518d\u53e6\u4e00\u8fb9\uff0c\u53c8\u63a5\u5165\u4e86\u4e00\u4e2a I/O \u603b\u7ebf\uff0c\u7528\u6765\u8fde\u63a5 I/O \u8bbe\u5907\uff0c\u6bd4\u5982\u952e\u76d8\u3001\u663e\u793a\u5668\u7b49\u3002</p> <p>\u90a3\u5f53\u7528\u6237\u8f93\u5165\u4e86\u952e\u76d8\u5b57\u7b26\uff0c\u952e\u76d8\u63a7\u5236\u5668\u5c31\u4f1a\u4ea7\u751f\u626b\u63cf\u7801\u6570\u636e\uff0c\u5e76\u5c06\u5176\u7f13\u51b2\u5728\u952e\u76d8\u63a7\u5236\u5668\u7684\u5bc4\u5b58\u5668\u4e2d\uff0c\u7d27\u63a5\u7740\u952e\u76d8\u63a7\u5236\u5668\u901a\u8fc7\u603b\u7ebf\u7ed9 CPU \u53d1\u9001\u4e2d\u65ad\u8bf7\u6c42\u3002</p> <p>CPU \u6536\u5230\u4e2d\u65ad\u8bf7\u6c42\u540e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4fdd\u5b58\u88ab\u4e2d\u65ad\u8fdb\u7a0b\u7684 CPU \u4e0a\u4e0b\u6587\uff0c\u7136\u540e\u8c03\u7528\u952e\u76d8\u7684\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u3002</p> <p>\u952e\u76d8\u7684\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u662f\u5728\u952e\u76d8\u9a71\u52a8\u7a0b\u5e8f\u521d\u59cb\u5316\u65f6\u6ce8\u518c\u7684\uff0c\u90a3\u952e\u76d8\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u7684\u529f\u80fd\u5c31\u662f\u4ece\u952e\u76d8\u63a7\u5236\u5668\u7684\u5bc4\u5b58\u5668\u7684\u7f13\u51b2\u533a\u8bfb\u53d6\u626b\u63cf\u7801\uff0c\u518d\u6839\u636e\u626b\u63cf\u7801\u627e\u5230\u7528\u6237\u5728\u952e\u76d8\u8f93\u5165\u7684\u5b57\u7b26\uff0c\u5982\u679c\u8f93\u5165\u7684\u5b57\u7b26\u662f\u663e\u793a\u5b57\u7b26\uff0c\u90a3\u5c31\u4f1a\u628a\u626b\u63cf\u7801\u7ffb\u8bd1\u6210\u5bf9\u5e94\u663e\u793a\u5b57\u7b26\u7684  ASCII \u7801\uff0c\u6bd4\u5982\u7528\u6237\u5728\u952e\u76d8\u8f93\u5165\u7684\u662f\u5b57\u6bcd A\uff0c\u662f\u663e\u793a\u5b57\u7b26\uff0c\u4e8e\u662f\u5c31\u4f1a\u628a\u626b\u63cf\u7801\u7ffb\u8bd1\u6210 A \u5b57\u7b26\u7684 ASCII \u7801\u3002</p> <p>\u5f97\u5230\u4e86\u663e\u793a\u5b57\u7b26\u7684 ASCII \u7801\u540e\uff0c\u5c31\u4f1a\u628a ASCII \u7801\u653e\u5230\u300c\u8bfb\u7f13\u51b2\u533a\u961f\u5217\u300d\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u8981\u628a\u663e\u793a\u5b57\u7b26\u663e\u793a\u5c4f\u5e55\u4e86\uff0c\u663e\u793a\u8bbe\u5907\u7684\u9a71\u52a8\u7a0b\u5e8f\u4f1a\u5b9a\u65f6\u4ece\u300c\u8bfb\u7f13\u51b2\u533a\u961f\u5217\u300d\u8bfb\u53d6\u6570\u636e\u653e\u5230\u300c\u5199\u7f13\u51b2\u533a\u961f\u5217\u300d\uff0c\u6700\u540e\u628a\u300c\u5199\u7f13\u51b2\u533a\u961f\u5217\u300d\u7684\u6570\u636e\u4e00\u4e2a\u4e00\u4e2a\u5199\u5165\u5230\u663e\u793a\u8bbe\u5907\u7684\u63a7\u5236\u5668\u7684\u5bc4\u5b58\u5668\u4e2d\u7684\u6570\u636e\u7f13\u51b2\u533a\uff0c\u6700\u540e\u5c06\u8fd9\u4e9b\u6570\u636e\u663e\u793a\u5728\u5c4f\u5e55\u91cc\u3002</p> <p>\u663e\u793a\u51fa\u7ed3\u679c\u540e\uff0c\u6062\u590d\u88ab\u4e2d\u65ad\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/7_device/device/#_5","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/hash/","title":"9.4 \u4ec0\u4e48\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u5728\u901b\u725b\u5ba2\u7f51\u7684\u9762\u7ecf\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u6709\u4f4d\u540c\u5b66\u5728\u9762\u5fae\u4fe1\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\u8fd9\u4e2a\u95ee\u9898\uff1a</p> <p></p> <p>\u7b2c\u4e00\u4e2a\u95ee\u9898\u5c31\u662f\uff1a\u4e00\u81f4\u6027\u54c8\u5e0c\u662f\u4ec0\u4e48\uff0c\u4f7f\u7528\u573a\u666f\uff0c\u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898\uff1f</p> <p>\u8fd9\u4e2a\u95ee\u9898\u8fd8\u633a\u6709\u610f\u601d\u7684\uff0c\u6240\u4ee5\u4eca\u5929\u5c31\u6765\u804a\u804a\u8fd9\u4e2a\u3002</p> <p>\u53d1\u8f66\uff01</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/hash/#_1","title":"\u5982\u4f55\u5206\u914d\u8bf7\u6c42\uff1f","text":"<p>\u5927\u591a\u6570\u7f51\u7ad9\u80cc\u540e\u80af\u5b9a\u4e0d\u662f\u53ea\u6709\u4e00\u53f0\u670d\u52a1\u5668\u63d0\u4f9b\u670d\u52a1\uff0c\u56e0\u4e3a\u5355\u673a\u7684\u5e76\u53d1\u91cf\u548c\u6570\u636e\u91cf\u90fd\u662f\u6709\u9650\u7684\uff0c\u6240\u4ee5\u90fd\u4f1a\u7528\u591a\u53f0\u670d\u52a1\u5668\u6784\u6210\u96c6\u7fa4\u6765\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002</p> <p>\u4f46\u662f\u95ee\u9898\u6765\u4e86\uff0c\u73b0\u5728\u6709\u90a3\u4e48\u591a\u4e2a\u8282\u70b9\uff08\u540e\u9762\u7edf\u79f0\u670d\u52a1\u5668\u4e3a\u8282\u70b9\uff0c\u56e0\u4e3a\u5c11\u4e00\u4e2a\u5b57\uff09\uff0c\u8981\u5982\u4f55\u5206\u914d\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5462\uff1f</p> <p></p> <p>\u5176\u5b9e\u8fd9\u4e2a\u95ee\u9898\u5c31\u662f\u300c\u8d1f\u8f7d\u5747\u8861\u95ee\u9898\u300d\u3002\u89e3\u51b3\u8d1f\u8f7d\u5747\u8861\u95ee\u9898\u7684\u7b97\u6cd5\u5f88\u591a\uff0c\u4e0d\u540c\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\uff0c\u5bf9\u5e94\u7684\u5c31\u662f\u4e0d\u540c\u7684\u5206\u914d\u7b56\u7565\uff0c\u9002\u5e94\u7684\u4e1a\u52a1\u573a\u666f\u4e5f\u4e0d\u540c\u3002</p> <p>\u6700\u7b80\u5355\u7684\u65b9\u5f0f\uff0c\u5f15\u5165\u4e00\u4e2a\u4e2d\u95f4\u7684\u8d1f\u8f7d\u5747\u8861\u5c42\uff0c\u8ba9\u5b83\u5c06\u5916\u754c\u7684\u8bf7\u6c42\u300c\u8f6e\u6d41\u300d\u7684\u8f6c\u53d1\u7ed9\u5185\u90e8\u7684\u96c6\u7fa4\u3002\u6bd4\u5982\u96c6\u7fa4\u6709 3 \u4e2a\u8282\u70b9\uff0c\u5916\u754c\u8bf7\u6c42\u6709 3 \u4e2a\uff0c\u90a3\u4e48\u6bcf\u4e2a\u8282\u70b9\u90fd\u4f1a\u5904\u7406 1 \u4e2a\u8bf7\u6c42\uff0c\u8fbe\u5230\u4e86\u5206\u914d\u8bf7\u6c42\u7684\u76ee\u7684\u3002</p> <p></p> <p>\u8003\u8651\u5230\u6bcf\u4e2a\u8282\u70b9\u7684\u786c\u4ef6\u914d\u7f6e\u6709\u6240\u533a\u522b\uff0c\u6211\u4eec\u53ef\u4ee5\u5f15\u5165\u6743\u91cd\u503c\uff0c\u5c06\u786c\u4ef6\u914d\u7f6e\u66f4\u597d\u7684\u8282\u70b9\u7684\u6743\u91cd\u503c\u8bbe\u9ad8\uff0c\u7136\u540e\u6839\u636e\u5404\u4e2a\u8282\u70b9\u7684\u6743\u91cd\u503c\uff0c\u6309\u7167\u4e00\u5b9a\u6bd4\u91cd\u5206\u914d\u5728\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\uff0c\u8ba9\u786c\u4ef6\u914d\u7f6e\u66f4\u597d\u7684\u8282\u70b9\u627f\u62c5\u66f4\u591a\u7684\u8bf7\u6c42\uff0c\u8fd9\u79cd\u7b97\u6cd5\u53eb\u505a\u52a0\u6743\u8f6e\u8be2\u3002</p> <p>\u52a0\u6743\u8f6e\u8be2\u7b97\u6cd5\u4f7f\u7528\u573a\u666f\u662f\u5efa\u7acb\u5728\u6bcf\u4e2a\u8282\u70b9\u5b58\u50a8\u7684\u6570\u636e\u90fd\u662f\u76f8\u540c\u7684\u524d\u63d0\u3002\u6240\u4ee5\uff0c\u6bcf\u6b21\u8bfb\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u8bbf\u95ee\u4efb\u610f\u4e00\u4e2a\u8282\u70b9\u90fd\u80fd\u5f97\u5230\u7ed3\u679c\u3002</p> <p>\u4f46\u662f\uff0c\u52a0\u6743\u8f6e\u8be2\u7b97\u6cd5\u662f\u65e0\u6cd5\u5e94\u5bf9\u300c\u5206\u5e03\u5f0f\u7cfb\u7edf\u300d\u7684\uff0c\u56e0\u4e3a\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\uff0c\u6bcf\u4e2a\u8282\u70b9\u5b58\u50a8\u7684\u6570\u636e\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u5f53\u6211\u4eec\u60f3\u63d0\u9ad8\u7cfb\u7edf\u7684\u5bb9\u91cf\uff0c\u5c31\u4f1a\u5c06\u6570\u636e\u6c34\u5e73\u5207\u5206\u5230\u4e0d\u540c\u7684\u8282\u70b9\u6765\u5b58\u50a8\uff0c\u4e5f\u5c31\u662f\u5c06\u6570\u636e\u5206\u5e03\u5230\u4e86\u4e0d\u540c\u7684\u8282\u70b9\u3002\u6bd4\u5982\u4e00\u4e2a\u5206\u5e03\u5f0f KV\uff08key-value\uff09\u7f13\u5b58\u7cfb\u7edf\uff0c\u67d0\u4e2a key \u5e94\u8be5\u5230\u54ea\u4e2a\u6216\u8005\u54ea\u4e9b\u8282\u70b9\u4e0a\u83b7\u5f97\uff0c\u5e94\u8be5\u662f\u786e\u5b9a\u7684\uff0c\u4e0d\u662f\u8bf4\u4efb\u610f\u8bbf\u95ee\u4e00\u4e2a\u8282\u70b9\u90fd\u53ef\u4ee5\u5f97\u5230\u7f13\u5b58\u7ed3\u679c\u7684\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u8981\u60f3\u4e00\u4e2a\u80fd\u5e94\u5bf9\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/hash/#_2","title":"\u4f7f\u7528\u54c8\u5e0c\u7b97\u6cd5\u6709\u4ec0\u4e48\u95ee\u9898\uff1f","text":"<p>\u6709\u7684\u540c\u5b66\u53ef\u80fd\u5f88\u5feb\u5c31\u60f3\u5230\u4e86\uff1a\u54c8\u5e0c\u7b97\u6cd5\u3002\u56e0\u4e3a\u5bf9\u540c\u4e00\u4e2a\u5173\u952e\u5b57\u8fdb\u884c\u54c8\u5e0c\u8ba1\u7b97\uff0c\u6bcf\u6b21\u8ba1\u7b97\u90fd\u662f\u76f8\u540c\u7684\u503c\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c06\u67d0\u4e2a key \u786e\u5b9a\u5230\u4e00\u4e2a\u8282\u70b9\u4e86\uff0c\u53ef\u4ee5\u6ee1\u8db3\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u8d1f\u8f7d\u5747\u8861\u9700\u6c42\u3002</p> <p>\u54c8\u5e0c\u7b97\u6cd5\u6700\u7b80\u5355\u7684\u505a\u6cd5\u5c31\u662f\u8fdb\u884c\u53d6\u6a21\u8fd0\u7b97\uff0c\u6bd4\u5982\u5206\u5e03\u5f0f\u7cfb\u7edf\u4e2d\u6709 3 \u4e2a\u8282\u70b9\uff0c\u57fa\u4e8e <code>hash(key) % 3</code> \u516c\u5f0f\u5bf9\u6570\u636e\u8fdb\u884c\u4e86\u6620\u5c04\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u8981\u83b7\u53d6\u6307\u5b9a key \u7684\u6570\u636e\uff0c\u901a\u8fc7\u4e0b\u9762\u7684\u516c\u5f0f\u53ef\u4ee5\u5b9a\u4f4d\u8282\u70b9\uff1a</p> Text Only<pre><code>hash(key) % 3\n</code></pre> <p>\u5982\u679c\u7ecf\u8fc7\u4e0a\u9762\u8fd9\u4e2a\u516c\u5f0f\u8ba1\u7b97\u540e\u5f97\u5230\u7684\u503c\u662f 0\uff0c\u5c31\u8bf4\u660e\u8be5 key \u9700\u8981\u53bb\u7b2c\u4e00\u4e2a\u8282\u70b9\u83b7\u53d6\u3002</p> <p>\u4f46\u662f\u6709\u4e00\u4e2a\u5f88\u81f4\u547d\u7684\u95ee\u9898\uff0c\u5982\u679c\u8282\u70b9\u6570\u91cf\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u4e5f\u5c31\u662f\u5728\u5bf9\u7cfb\u7edf\u505a\u6269\u5bb9\u6216\u8005\u7f29\u5bb9\u65f6\uff0c\u5fc5\u987b\u8fc1\u79fb\u6539\u53d8\u4e86\u6620\u5c04\u5173\u7cfb\u7684\u6570\u636e\uff0c\u5426\u5219\u4f1a\u51fa\u73b0\u67e5\u8be2\u4e0d\u5230\u6570\u636e\u7684\u95ee\u9898\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u6211\u4eec\u6709\u4e00\u4e2a\u7531 A\u3001B\u3001C \u4e09\u4e2a\u8282\u70b9\u7ec4\u6210\u5206\u5e03\u5f0f KV \u7f13\u5b58\u7cfb\u7edf\uff0c\u57fa\u4e8e\u8ba1\u7b97\u516c\u5f0f <code>hash(key) % 3</code> \u5c06\u6570\u636e\u8fdb\u884c\u4e86\u6620\u5c04\uff0c\u6bcf\u4e2a\u8282\u70b9\u5b58\u50a8\u4e86\u4e0d\u540c\u7684\u6570\u636e\uff1a</p> <p></p> <p>\u73b0\u5728\u6709 3 \u4e2a\u67e5\u8be2 key \u7684\u8bf7\u6c42\uff0c\u5206\u522b\u67e5\u8be2 key-01\uff0ckey-02\uff0ckey-03 \u7684\u6570\u636e\uff0c\u8fd9\u4e09\u4e2a key \u5206\u522b\u7ecf\u8fc7 hash() \u51fd\u6570\u8ba1\u7b97\u540e\u7684\u503c\u4e3a hash( key-01) = 6\u3001hash( key-02) = 7\u3001hash(key-03) = 8\uff0c\u7136\u540e\u518d\u5bf9\u8fd9\u4e9b\u503c\u8fdb\u884c\u53d6\u6a21\u8fd0\u7b97\u3002</p> <p>\u901a\u8fc7\u8fd9\u6837\u7684\u54c8\u5e0c\u7b97\u6cd5\uff0c\u6bcf\u4e2a key \u90fd\u53ef\u4ee5\u5b9a\u4f4d\u5230\u5bf9\u5e94\u7684\u8282\u70b9\u3002</p> <p></p> <p>\u5f53 3 \u4e2a\u8282\u70b9\u4e0d\u80fd\u6ee1\u8db3\u4e1a\u52a1\u9700\u6c42\u4e86\uff0c\u8fd9\u65f6\u6211\u4eec\u589e\u52a0\u4e86\u4e00\u4e2a\u8282\u70b9\uff0c\u8282\u70b9\u7684\u6570\u91cf\u4ece 3 \u53d8\u5316\u4e3a 4\uff0c\u610f\u5473\u53d6\u6a21\u54c8\u5e0c\u51fd\u6570\u4e2d\u57fa\u6570\u7684\u53d8\u5316\uff0c\u8fd9\u6837\u4f1a\u5bfc\u81f4\u5927\u90e8\u5206\u6620\u5c04\u5173\u7cfb\u6539\u53d8\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6bd4\u5982\uff0c\u4e4b\u524d\u7684 hash(key-01) % <code>3</code> = 0\uff0c\u5c31\u53d8\u6210\u4e86 hash(key-01) % <code>4</code> = 2\uff0c\u67e5\u8be2 key-01 \u6570\u636e\u65f6\uff0c\u5bfb\u5740\u5230\u4e86\u8282\u70b9 C\uff0c\u800c key-01 \u7684\u6570\u636e\u662f\u5b58\u50a8\u5728\u8282\u70b9 A \u4e0a\u7684\uff0c\u4e0d\u662f\u5728\u8282\u70b9 C\uff0c\u6240\u4ee5\u4f1a\u67e5\u8be2\u4e0d\u5230\u6570\u636e\u3002</p> <p>\u540c\u6837\u7684\u9053\u7406\uff0c\u5982\u679c\u6211\u4eec\u5bf9\u5206\u5e03\u5f0f\u7cfb\u7edf\u8fdb\u884c\u7f29\u5bb9\uff0c\u6bd4\u5982\u79fb\u9664\u4e00\u4e2a\u8282\u70b9\uff0c\u4e5f\u4f1a\u56e0\u4e3a\u53d6\u6a21\u54c8\u5e0c\u51fd\u6570\u4e2d\u57fa\u6570\u7684\u53d8\u5316\uff0c\u53ef\u80fd\u51fa\u73b0\u67e5\u8be2\u4e0d\u5230\u6570\u636e\u7684\u95ee\u9898\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u7684\u529e\u6cd5\uff0c\u5c31\u9700\u8981\u6211\u4eec\u8fdb\u884c\u8fc1\u79fb\u6570\u636e\uff0c\u6bd4\u5982\u8282\u70b9\u7684\u6570\u91cf\u4ece 3 \u53d8\u5316\u4e3a 4 \u65f6\uff0c\u8981\u57fa\u4e8e\u65b0\u7684\u8ba1\u7b97\u516c\u5f0f hash(key) % 4\uff0c\u91cd\u65b0\u5bf9\u6570\u636e\u548c\u8282\u70b9\u505a\u6620\u5c04\u3002</p> <p>\u5047\u8bbe\u603b\u6570\u636e\u6761\u6570\u4e3a M\uff0c\u54c8\u5e0c\u7b97\u6cd5\u5728\u9762\u5bf9\u8282\u70b9\u6570\u91cf\u53d8\u5316\u65f6\uff0c\u6700\u574f\u60c5\u51b5\u4e0b\u6240\u6709\u6570\u636e\u90fd\u9700\u8981\u8fc1\u79fb\uff0c\u6240\u4ee5\u5b83\u7684\u6570\u636e\u8fc1\u79fb\u89c4\u6a21\u662f O(M)\uff0c\u8fd9\u6837\u6570\u636e\u7684\u8fc1\u79fb\u6210\u672c\u592a\u9ad8\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u5e94\u8be5\u8981\u91cd\u65b0\u60f3\u4e00\u4e2a\u65b0\u7684\u7b97\u6cd5\uff0c\u6765\u907f\u514d\u5206\u5e03\u5f0f\u7cfb\u7edf\u5728\u6269\u5bb9\u6216\u8005\u7f29\u5bb9\u65f6\uff0c\u53d1\u751f\u8fc7\u591a\u7684\u6570\u636e\u8fc1\u79fb\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/hash/#_3","title":"\u4f7f\u7528\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u6709\u4ec0\u4e48\u95ee\u9898\uff1f","text":"<p>\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u5c31\u5f88\u597d\u5730\u89e3\u51b3\u4e86\u5206\u5e03\u5f0f\u7cfb\u7edf\u5728\u6269\u5bb9\u6216\u8005\u7f29\u5bb9\u65f6\uff0c\u53d1\u751f\u8fc7\u591a\u7684\u6570\u636e\u8fc1\u79fb\u7684\u95ee\u9898\u3002</p> <p>\u4e00\u81f4\u54c8\u5e0c\u7b97\u6cd5\u4e5f\u7528\u4e86\u53d6\u6a21\u8fd0\u7b97\uff0c\u4f46\u4e0e\u54c8\u5e0c\u7b97\u6cd5\u4e0d\u540c\u7684\u662f\uff0c\u54c8\u5e0c\u7b97\u6cd5\u662f\u5bf9\u8282\u70b9\u7684\u6570\u91cf\u8fdb\u884c\u53d6\u6a21\u8fd0\u7b97\uff0c\u800c\u4e00\u81f4\u54c8\u5e0c\u7b97\u6cd5\u662f\u5bf9 2^32 \u8fdb\u884c\u53d6\u6a21\u8fd0\u7b97\uff0c\u662f\u4e00\u4e2a\u56fa\u5b9a\u7684\u503c\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u628a\u4e00\u81f4\u54c8\u5e0c\u7b97\u6cd5\u662f\u5bf9 2^32 \u8fdb\u884c\u53d6\u6a21\u8fd0\u7b97\u7684\u7ed3\u679c\u503c\u7ec4\u7ec7\u6210\u4e00\u4e2a\u5706\u73af\uff0c\u5c31\u50cf\u949f\u8868\u4e00\u6837\uff0c\u949f\u8868\u7684\u5706\u53ef\u4ee5\u7406\u89e3\u6210\u7531 60 \u4e2a\u70b9\u7ec4\u6210\u7684\u5706\uff0c\u800c\u6b64\u5904\u6211\u4eec\u628a\u8fd9\u4e2a\u5706\u60f3\u8c61\u6210\u7531 2^32 \u4e2a\u70b9\u7ec4\u6210\u7684\u5706\uff0c\u8fd9\u4e2a\u5706\u73af\u88ab\u79f0\u4e3a\u54c8\u5e0c\u73af\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e00\u81f4\u6027\u54c8\u5e0c\u8981\u8fdb\u884c\u4e24\u6b65\u54c8\u5e0c\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\uff1a\u5bf9\u5b58\u50a8\u8282\u70b9\u8fdb\u884c\u54c8\u5e0c\u8ba1\u7b97\uff0c\u4e5f\u5c31\u662f\u5bf9\u5b58\u50a8\u8282\u70b9\u505a\u54c8\u5e0c\u6620\u5c04\uff0c\u6bd4\u5982\u6839\u636e\u8282\u70b9\u7684 IP \u5730\u5740\u8fdb\u884c\u54c8\u5e0c\uff1b</li> <li>\u7b2c\u4e8c\u6b65\uff1a\u5f53\u5bf9\u6570\u636e\u8fdb\u884c\u5b58\u50a8\u6216\u8bbf\u95ee\u65f6\uff0c\u5bf9\u6570\u636e\u8fdb\u884c\u54c8\u5e0c\u6620\u5c04\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u4e00\u81f4\u6027\u54c8\u5e0c\u662f\u6307\u5c06\u300c\u5b58\u50a8\u8282\u70b9\u300d\u548c\u300c\u6570\u636e\u300d\u90fd\u6620\u5c04\u5230\u4e00\u4e2a\u9996\u5c3e\u76f8\u8fde\u7684\u54c8\u5e0c\u73af\u4e0a\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u5bf9\u300c\u6570\u636e\u300d\u8fdb\u884c\u54c8\u5e0c\u6620\u5c04\u5f97\u5230\u4e00\u4e2a\u7ed3\u679c\u8981\u600e\u4e48\u627e\u5230\u5b58\u50a8\u8be5\u6570\u636e\u7684\u8282\u70b9\u5462\uff1f</p> <p>\u7b54\u6848\u662f\uff0c\u6620\u5c04\u7684\u7ed3\u679c\u503c\u5f80\u987a\u65f6\u9488\u7684\u65b9\u5411\u7684\u627e\u5230\u7b2c\u4e00\u4e2a\u8282\u70b9\uff0c\u5c31\u662f\u5b58\u50a8\u8be5\u6570\u636e\u7684\u8282\u70b9\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6709 3 \u4e2a\u8282\u70b9\u7ecf\u8fc7\u54c8\u5e0c\u8ba1\u7b97\uff0c\u6620\u5c04\u5230\u4e86\u5982\u4e0b\u56fe\u7684\u4f4d\u7f6e\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u5bf9\u8981\u67e5\u8be2\u7684 key-01 \u8fdb\u884c\u54c8\u5e0c\u8ba1\u7b97\uff0c\u786e\u5b9a\u6b64 key-01 \u6620\u5c04\u5728\u54c8\u5e0c\u73af\u7684\u4f4d\u7f6e\uff0c\u7136\u540e\u4ece\u8fd9\u4e2a\u4f4d\u7f6e\u5f80\u987a\u65f6\u9488\u7684\u65b9\u5411\u627e\u5230\u7b2c\u4e00\u4e2a\u8282\u70b9\uff0c\u5c31\u662f\u5b58\u50a8\u8be5 key-01 \u6570\u636e\u7684\u8282\u70b9\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u56fe\u4e2d\u7684 key-01 \u6620\u5c04\u7684\u4f4d\u7f6e\uff0c\u5f80\u987a\u65f6\u9488\u7684\u65b9\u5411\u627e\u5230\u7b2c\u4e00\u4e2a\u8282\u70b9\u5c31\u662f\u8282\u70b9 A\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u5f53\u9700\u8981\u5bf9\u6307\u5b9a key \u7684\u503c\u8fdb\u884c\u8bfb\u5199\u7684\u65f6\u5019\uff0c\u8981\u901a\u8fc7\u4e0b\u9762 2 \u6b65\u8fdb\u884c\u5bfb\u5740\uff1a</p> <ul> <li>\u9996\u5148\uff0c\u5bf9 key \u8fdb\u884c\u54c8\u5e0c\u8ba1\u7b97\uff0c\u786e\u5b9a\u6b64 key \u5728\u73af\u4e0a\u7684\u4f4d\u7f6e\uff1b</li> <li>\u7136\u540e\uff0c\u4ece\u8fd9\u4e2a\u4f4d\u7f6e\u6cbf\u7740\u987a\u65f6\u9488\u65b9\u5411\u8d70\uff0c\u9047\u5230\u7684\u7b2c\u4e00\u8282\u70b9\u5c31\u662f\u5b58\u50a8 key \u7684\u8282\u70b9\u3002</li> </ul> <p>\u77e5\u9053\u4e86\u4e00\u81f4\u54c8\u5e0c\u5bfb\u5740\u7684\u65b9\u5f0f\uff0c\u6211\u4eec\u6765\u770b\u770b\uff0c\u5982\u679c\u589e\u52a0\u4e00\u4e2a\u8282\u70b9\u6216\u8005\u51cf\u5c11\u4e00\u4e2a\u8282\u70b9\u4f1a\u53d1\u751f\u5927\u91cf\u7684\u6570\u636e\u8fc1\u79fb\u5417\uff1f</p> <p>\u5047\u8bbe\u8282\u70b9\u6570\u91cf\u4ece 3 \u589e\u52a0\u5230\u4e86 4\uff0c\u65b0\u7684\u8282\u70b9 D \u7ecf\u8fc7\u54c8\u5e0c\u8ba1\u7b97\u540e\u6620\u5c04\u5230\u4e86\u4e0b\u56fe\u4e2d\u7684\u4f4d\u7f6e\uff1a</p> <p></p> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0ckey-01\u3001key-03 \u90fd\u4e0d\u53d7\u5f71\u54cd\uff0c\u53ea\u6709 key-02 \u9700\u8981\u88ab\u8fc1\u79fb\u8282\u70b9 D\u3002</p> <p>\u5047\u8bbe\u8282\u70b9\u6570\u91cf\u4ece 3 \u51cf\u5c11\u5230\u4e86 2\uff0c\u6bd4\u5982\u5c06\u8282\u70b9 A \u79fb\u9664\uff1a</p> <p></p> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0ckey-02 \u548c key-03 \u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u53ea\u6709 key-01 \u9700\u8981\u88ab\u8fc1\u79fb\u8282\u70b9 B\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u4e00\u81f4\u54c8\u5e0c\u7b97\u6cd5\u4e2d\uff0c\u5982\u679c\u589e\u52a0\u6216\u8005\u79fb\u9664\u4e00\u4e2a\u8282\u70b9\uff0c\u4ec5\u5f71\u54cd\u8be5\u8282\u70b9\u5728\u54c8\u5e0c\u73af\u4e0a\u987a\u65f6\u9488\u76f8\u90bb\u7684\u540e\u7ee7\u8282\u70b9\uff0c\u5176\u5b83\u6570\u636e\u4e5f\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\u3002</p> <p>\u4e0a\u9762\u8fd9\u4e9b\u56fe\u4e2d 3 \u4e2a\u8282\u70b9\u6620\u5c04\u5728\u54c8\u5e0c\u73af\u8fd8\u662f\u6bd4\u8f83\u5206\u6563\u7684\uff0c\u6240\u4ee5\u770b\u8d77\u6765\u8bf7\u6c42\u90fd\u4f1a\u300c\u5747\u8861\u300d\u5230\u6bcf\u4e2a\u8282\u70b9\u3002</p> <p>\u4f46\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u5e76\u4e0d\u4fdd\u8bc1\u8282\u70b9\u80fd\u591f\u5728\u54c8\u5e0c\u73af\u4e0a\u5206\u5e03\u5747\u5300\uff0c\u8fd9\u6837\u5c31\u4f1a\u5e26\u6765\u4e00\u4e2a\u95ee\u9898\uff0c\u4f1a\u6709\u5927\u91cf\u7684\u8bf7\u6c42\u96c6\u4e2d\u5728\u4e00\u4e2a\u8282\u70b9\u4e0a\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u56fe\u4e2d 3 \u4e2a\u8282\u70b9\u7684\u6620\u5c04\u4f4d\u7f6e\u90fd\u5728\u54c8\u5e0c\u73af\u7684\u53f3\u534a\u8fb9\uff1a</p> <p></p> <p>\u8fd9\u65f6\u5019\u6709\u4e00\u534a\u4ee5\u4e0a\u7684\u6570\u636e\u7684\u5bfb\u5740\u90fd\u4f1a\u627e\u8282\u70b9 A\uff0c\u4e5f\u5c31\u662f\u8bbf\u95ee\u8bf7\u6c42\u4e3b\u8981\u96c6\u4e2d\u7684\u8282\u70b9 A \u4e0a\uff0c\u8fd9\u80af\u5b9a\u4e0d\u884c\u7684\u5440\uff0c\u8bf4\u597d\u7684\u8d1f\u8f7d\u5747\u8861\u5462\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e00\u70b9\u90fd\u4e0d\u5747\u8861\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u8fd9\u79cd\u8282\u70b9\u5206\u5e03\u4e0d\u5747\u5300\u7684\u60c5\u51b5\u4e0b\uff0c\u8fdb\u884c\u5bb9\u707e\u4e0e\u6269\u5bb9\u65f6\uff0c\u54c8\u5e0c\u73af\u4e0a\u7684\u76f8\u90bb\u8282\u70b9\u5bb9\u6613\u53d7\u5230\u8fc7\u5927\u5f71\u54cd\uff0c\u5bb9\u6613\u53d1\u751f\u96ea\u5d29\u5f0f\u7684\u8fde\u9501\u53cd\u5e94\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0a\u56fe\u4e2d\u5982\u679c\u8282\u70b9 A \u88ab\u79fb\u9664\u4e86\uff0c\u5f53\u8282\u70b9 A \u5b95\u673a\u540e\uff0c\u6839\u636e\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u7684\u89c4\u5219\uff0c\u5176\u4e0a\u6570\u636e\u5e94\u8be5\u5168\u90e8\u8fc1\u79fb\u5230\u76f8\u90bb\u7684\u8282\u70b9 B \u4e0a\uff0c\u8fd9\u6837\uff0c\u8282\u70b9 B \u7684\u6570\u636e\u91cf\u3001\u8bbf\u95ee\u91cf\u90fd\u4f1a\u8fc5\u901f\u589e\u52a0\u5f88\u591a\u500d\uff0c\u4e00\u65e6\u65b0\u589e\u7684\u538b\u529b\u8d85\u8fc7\u4e86\u8282\u70b9 B \u7684\u5904\u7406\u80fd\u529b\u4e0a\u9650\uff0c\u5c31\u4f1a\u5bfc\u81f4\u8282\u70b9 B \u5d29\u6e83\uff0c\u8fdb\u800c\u5f62\u6210\u96ea\u5d29\u5f0f\u7684\u8fde\u9501\u53cd\u5e94\u3002</p> <p>\u6240\u4ee5\uff0c\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u867d\u7136\u51cf\u5c11\u4e86\u6570\u636e\u8fc1\u79fb\u91cf\uff0c\u4f46\u662f\u5b58\u5728\u8282\u70b9\u5206\u5e03\u4e0d\u5747\u5300\u7684\u95ee\u9898\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/hash/#_4","title":"\u5982\u4f55\u901a\u8fc7\u865a\u62df\u8282\u70b9\u63d0\u9ad8\u5747\u8861\u5ea6\uff1f","text":"<p>\u8981\u60f3\u89e3\u51b3\u8282\u70b9\u80fd\u5728\u54c8\u5e0c\u73af\u4e0a\u5206\u914d\u4e0d\u5747\u5300\u7684\u95ee\u9898\uff0c\u5c31\u662f\u8981\u6709\u5927\u91cf\u7684\u8282\u70b9\uff0c\u8282\u70b9\u6570\u8d8a\u591a\uff0c\u54c8\u5e0c\u73af\u4e0a\u7684\u8282\u70b9\u5206\u5e03\u7684\u5c31\u8d8a\u5747\u5300\u3002</p> <p>\u4f46\u95ee\u9898\u662f\uff0c\u5b9e\u9645\u4e2d\u6211\u4eec\u6ca1\u6709\u90a3\u4e48\u591a\u8282\u70b9\u3002\u6240\u4ee5\u8fd9\u4e2a\u65f6\u5019\u6211\u4eec\u5c31\u52a0\u5165\u865a\u62df\u8282\u70b9\uff0c\u4e5f\u5c31\u662f\u5bf9\u4e00\u4e2a\u771f\u5b9e\u8282\u70b9\u505a\u591a\u4e2a\u526f\u672c\u3002</p> <p>\u5177\u4f53\u505a\u6cd5\u662f\uff0c\u4e0d\u518d\u5c06\u771f\u5b9e\u8282\u70b9\u6620\u5c04\u5230\u54c8\u5e0c\u73af\u4e0a\uff0c\u800c\u662f\u5c06\u865a\u62df\u8282\u70b9\u6620\u5c04\u5230\u54c8\u5e0c\u73af\u4e0a\uff0c\u5e76\u5c06\u865a\u62df\u8282\u70b9\u6620\u5c04\u5230\u5b9e\u9645\u8282\u70b9\uff0c\u6240\u4ee5\u8fd9\u91cc\u6709\u300c\u4e24\u5c42\u300d\u6620\u5c04\u5173\u7cfb\u3002</p> <p>\u6bd4\u5982\u5bf9\u6bcf\u4e2a\u8282\u70b9\u5206\u522b\u8bbe\u7f6e 3 \u4e2a\u865a\u62df\u8282\u70b9\uff1a</p> <ul> <li>\u5bf9\u8282\u70b9 A \u52a0\u4e0a\u7f16\u53f7\u6765\u4f5c\u4e3a\u865a\u62df\u8282\u70b9\uff1aA-01\u3001A-02\u3001A-03</li> <li>\u5bf9\u8282\u70b9 B \u52a0\u4e0a\u7f16\u53f7\u6765\u4f5c\u4e3a\u865a\u62df\u8282\u70b9\uff1aB-01\u3001B-02\u3001B-03</li> <li>\u5bf9\u8282\u70b9 C \u52a0\u4e0a\u7f16\u53f7\u6765\u4f5c\u4e3a\u865a\u62df\u8282\u70b9\uff1aC-01\u3001C-02\u3001C-03</li> </ul> <p>\u5f15\u5165\u865a\u62df\u8282\u70b9\u540e\uff0c\u539f\u672c\u54c8\u5e0c\u73af\u4e0a\u53ea\u6709 3 \u4e2a\u8282\u70b9\u7684\u60c5\u51b5\uff0c\u5c31\u4f1a\u53d8\u6210\u6709 9 \u4e2a\u865a\u62df\u8282\u70b9\u6620\u5c04\u5230\u54c8\u5e0c\u73af\u4e0a\uff0c\u54c8\u5e0c\u73af\u4e0a\u7684\u8282\u70b9\u6570\u91cf\u591a\u4e86 3 \u500d\u3002</p> <p></p> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u8282\u70b9\u6570\u91cf\u591a\u4e86\u540e\uff0c\u8282\u70b9\u5728\u54c8\u5e0c\u73af\u4e0a\u7684\u5206\u5e03\u5c31\u76f8\u5bf9\u5747\u5300\u4e86\u3002\u8fd9\u65f6\u5019\uff0c\u5982\u679c\u6709\u8bbf\u95ee\u8bf7\u6c42\u5bfb\u5740\u5230\u300cA-01\u300d\u8fd9\u4e2a\u865a\u62df\u8282\u70b9\uff0c\u63a5\u7740\u518d\u901a\u8fc7\u300cA-01\u300d\u865a\u62df\u8282\u70b9\u627e\u5230\u771f\u5b9e\u8282\u70b9 A\uff0c\u8fd9\u6837\u8bf7\u6c42\u5c31\u80fd\u8bbf\u95ee\u5230\u771f\u5b9e\u8282\u70b9 A \u4e86\u3002</p> <p>\u4e0a\u9762\u4e3a\u4e86\u65b9\u4fbf\u4f60\u7406\u89e3\uff0c\u6bcf\u4e2a\u771f\u5b9e\u8282\u70b9\u4ec5\u5305\u542b 3 \u4e2a\u865a\u62df\u8282\u70b9\uff0c\u8fd9\u6837\u80fd\u8d77\u5230\u7684\u5747\u8861\u6548\u679c\u5176\u5b9e\u5f88\u6709\u9650\u3002\u800c\u5728\u5b9e\u9645\u7684\u5de5\u7a0b\u4e2d\uff0c\u865a\u62df\u8282\u70b9\u7684\u6570\u91cf\u4f1a\u5927\u5f88\u591a\uff0c\u6bd4\u5982 Nginx \u7684\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\uff0c\u6bcf\u4e2a\u6743\u91cd\u4e3a 1 \u7684\u771f\u5b9e\u8282\u70b9\u5c31\u542b\u6709 160 \u4e2a\u865a\u62df\u8282\u70b9\u3002</p> <p>\u53e6\u5916\uff0c\u865a\u62df\u8282\u70b9\u9664\u4e86\u4f1a\u63d0\u9ad8\u8282\u70b9\u7684\u5747\u8861\u5ea6\uff0c\u8fd8\u4f1a\u63d0\u9ad8\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u3002\u5f53\u8282\u70b9\u53d8\u5316\u65f6\uff0c\u4f1a\u6709\u4e0d\u540c\u7684\u8282\u70b9\u5171\u540c\u5206\u62c5\u7cfb\u7edf\u7684\u53d8\u5316\uff0c\u56e0\u6b64\u7a33\u5b9a\u6027\u66f4\u9ad8\u3002</p> <p>\u6bd4\u5982\uff0c\u5f53\u67d0\u4e2a\u8282\u70b9\u88ab\u79fb\u9664\u65f6\uff0c\u5bf9\u5e94\u8be5\u8282\u70b9\u7684\u591a\u4e2a\u865a\u62df\u8282\u70b9\u5747\u4f1a\u79fb\u9664\uff0c\u800c\u8fd9\u4e9b\u865a\u62df\u8282\u70b9\u6309\u987a\u65f6\u9488\u65b9\u5411\u7684\u4e0b\u4e00\u4e2a\u865a\u62df\u8282\u70b9\uff0c\u53ef\u80fd\u4f1a\u5bf9\u5e94\u4e0d\u540c\u7684\u771f\u5b9e\u8282\u70b9\uff0c\u5373\u8fd9\u4e9b\u4e0d\u540c\u7684\u771f\u5b9e\u8282\u70b9\u5171\u540c\u5206\u62c5\u4e86\u8282\u70b9\u53d8\u5316\u5bfc\u81f4\u7684\u538b\u529b\u3002</p> <p>\u800c\u4e14\uff0c\u6709\u4e86\u865a\u62df\u8282\u70b9\u540e\uff0c\u8fd8\u53ef\u4ee5\u4e3a\u786c\u4ef6\u914d\u7f6e\u66f4\u597d\u7684\u8282\u70b9\u589e\u52a0\u6743\u91cd\uff0c\u6bd4\u5982\u5bf9\u6743\u91cd\u66f4\u9ad8\u7684\u8282\u70b9\u589e\u52a0\u66f4\u591a\u7684\u865a\u62df\u673a\u8282\u70b9\u5373\u53ef\u3002</p> <p>\u56e0\u6b64\uff0c\u5e26\u865a\u62df\u8282\u70b9\u7684\u4e00\u81f4\u6027\u54c8\u5e0c\u65b9\u6cd5\u4e0d\u4ec5\u9002\u5408\u786c\u4ef6\u914d\u7f6e\u4e0d\u540c\u7684\u8282\u70b9\u7684\u573a\u666f\uff0c\u800c\u4e14\u9002\u5408\u8282\u70b9\u89c4\u6a21\u4f1a\u53d1\u751f\u53d8\u5316\u7684\u573a\u666f\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/hash/#_5","title":"\u603b\u7ed3","text":"<p>\u4e0d\u540c\u7684\u8d1f\u8f7d\u5747\u8861\u7b97\u6cd5\u9002\u7528\u7684\u4e1a\u52a1\u573a\u666f\u4e5f\u4e0d\u540c\u7684\u3002</p> <p>\u8f6e\u8be2\u8fd9\u7c7b\u7684\u7b56\u7565\u53ea\u80fd\u9002\u7528\u4e0e\u6bcf\u4e2a\u8282\u70b9\u7684\u6570\u636e\u90fd\u662f\u76f8\u540c\u7684\u573a\u666f\uff0c\u8bbf\u95ee\u4efb\u610f\u8282\u70b9\u90fd\u80fd\u8bf7\u6c42\u5230\u6570\u636e\u3002\u4f46\u662f\u4e0d\u9002\u7528\u5206\u5e03\u5f0f\u7cfb\u7edf\uff0c\u56e0\u4e3a\u5206\u5e03\u5f0f\u7cfb\u7edf\u610f\u5473\u7740\u6570\u636e\u6c34\u5e73\u5207\u5206\u5230\u4e86\u4e0d\u540c\u7684\u8282\u70b9\u4e0a\uff0c\u8bbf\u95ee\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e00\u5b9a\u8981\u5bfb\u5740\u5b58\u50a8\u8be5\u6570\u636e\u7684\u8282\u70b9\u3002</p> <p>\u54c8\u5e0c\u7b97\u6cd5\u867d\u7136\u80fd\u5efa\u7acb\u6570\u636e\u548c\u8282\u70b9\u7684\u6620\u5c04\u5173\u7cfb\uff0c\u4f46\u662f\u6bcf\u6b21\u5728\u8282\u70b9\u6570\u91cf\u53d1\u751f\u53d8\u5316\u7684\u65f6\u5019\uff0c\u6700\u574f\u60c5\u51b5\u4e0b\u6240\u6709\u6570\u636e\u90fd\u9700\u8981\u8fc1\u79fb\uff0c\u8fd9\u6837\u592a\u9ebb\u70e6\u4e86\uff0c\u6240\u4ee5\u4e0d\u9002\u7528\u8282\u70b9\u6570\u91cf\u53d8\u5316\u7684\u573a\u666f\u3002</p> <p>\u4e3a\u4e86\u51cf\u5c11\u8fc1\u79fb\u7684\u6570\u636e\u91cf\uff0c\u5c31\u51fa\u73b0\u4e86\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u3002</p> <p>\u4e00\u81f4\u6027\u54c8\u5e0c\u662f\u6307\u5c06\u300c\u5b58\u50a8\u8282\u70b9\u300d\u548c\u300c\u6570\u636e\u300d\u90fd\u6620\u5c04\u5230\u4e00\u4e2a\u9996\u5c3e\u76f8\u8fde\u7684\u54c8\u5e0c\u73af\u4e0a\uff0c\u5982\u679c\u589e\u52a0\u6216\u8005\u79fb\u9664\u4e00\u4e2a\u8282\u70b9\uff0c\u4ec5\u5f71\u54cd\u8be5\u8282\u70b9\u5728\u54c8\u5e0c\u73af\u4e0a\u987a\u65f6\u9488\u76f8\u90bb\u7684\u540e\u7ee7\u8282\u70b9\uff0c\u5176\u5b83\u6570\u636e\u4e5f\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\u3002</p> <p>\u4f46\u662f\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u4e0d\u80fd\u591f\u5747\u5300\u7684\u5206\u5e03\u8282\u70b9\uff0c\u4f1a\u51fa\u73b0\u5927\u91cf\u8bf7\u6c42\u90fd\u96c6\u4e2d\u5728\u4e00\u4e2a\u8282\u70b9\u7684\u60c5\u51b5\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u8fdb\u884c\u5bb9\u707e\u4e0e\u6269\u5bb9\u65f6\uff0c\u5bb9\u6613\u51fa\u73b0\u96ea\u5d29\u7684\u8fde\u9501\u53cd\u5e94\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4e00\u81f4\u6027\u54c8\u5e0c\u7b97\u6cd5\u4e0d\u80fd\u591f\u5747\u5300\u7684\u5206\u5e03\u8282\u70b9\u7684\u95ee\u9898\uff0c\u5c31\u9700\u8981\u5f15\u5165\u865a\u62df\u8282\u70b9\uff0c\u5bf9\u4e00\u4e2a\u771f\u5b9e\u8282\u70b9\u505a\u591a\u4e2a\u526f\u672c\u3002\u4e0d\u518d\u5c06\u771f\u5b9e\u8282\u70b9\u6620\u5c04\u5230\u54c8\u5e0c\u73af\u4e0a\uff0c\u800c\u662f\u5c06\u865a\u62df\u8282\u70b9\u6620\u5c04\u5230\u54c8\u5e0c\u73af\u4e0a\uff0c\u5e76\u5c06\u865a\u62df\u8282\u70b9\u6620\u5c04\u5230\u5b9e\u9645\u8282\u70b9\uff0c\u6240\u4ee5\u8fd9\u91cc\u6709\u300c\u4e24\u5c42\u300d\u6620\u5c04\u5173\u7cfb\u3002</p> <p>\u5f15\u5165\u865a\u62df\u8282\u70b9\u540e\uff0c\u4f1a\u63d0\u9ad8\u8282\u70b9\u7684\u5747\u8861\u5ea6\uff0c\u8fd8\u4f1a\u63d0\u9ad8\u7cfb\u7edf\u7684\u7a33\u5b9a\u6027\u3002\u6240\u4ee5\uff0c\u5e26\u865a\u62df\u8282\u70b9\u7684\u4e00\u81f4\u6027\u54c8\u5e0c\u65b9\u6cd5\u4e0d\u4ec5\u9002\u5408\u786c\u4ef6\u914d\u7f6e\u4e0d\u540c\u7684\u8282\u70b9\u7684\u573a\u666f\uff0c\u800c\u4e14\u9002\u5408\u8282\u70b9\u89c4\u6a21\u4f1a\u53d1\u751f\u53d8\u5316\u7684\u573a\u666f\u3002</p> <p>\u5b8c\uff01</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/hash/#_6","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/reactor/","title":"9.3 \u9ad8\u6027\u80fd\u7f51\u7edc\u6a21\u5f0f\uff1aReactor \u548c Proactor","text":"<p>\u5c0f\u6797\uff0c\u6765\u4e86\u3002</p> <p>\u8fd9\u6b21\u5c31\u6765\u56fe\u89e3 Reactor \u548c Proactor \u8fd9\u4e24\u4e2a\u9ad8\u6027\u80fd\u7f51\u7edc\u6a21\u5f0f\u3002</p> <p>\u522b\u5c0f\u770b\u8fd9\u4e24\u4e2a\u4e1c\u897f\uff0c\u7279\u522b\u662f Reactor \u6a21\u5f0f\uff0c\u5e02\u9762\u4e0a\u5e38\u89c1\u7684\u5f00\u6e90\u8f6f\u4ef6\u5f88\u591a\u90fd\u91c7\u7528\u4e86\u8fd9\u4e2a\u65b9\u6848\uff0c\u6bd4\u5982 Redis\u3001Nginx\u3001Netty \u7b49\u7b49\uff0c\u6240\u4ee5\u5b66\u597d\u8fd9\u4e2a\u6a21\u5f0f\u8bbe\u8ba1\u7684\u601d\u60f3\uff0c\u4e0d\u4ec5\u6709\u52a9\u4e8e\u6211\u4eec\u7406\u89e3\u5f88\u591a\u5f00\u6e90\u8f6f\u4ef6\uff0c\u800c\u4e14\u4e5f\u80fd\u5728\u9762\u8bd5\u65f6\u5439\u903c\u3002</p> <p>\u53d1\u8f66\uff01</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/reactor/#_1","title":"\u6f14\u8fdb","text":"<p>\u5982\u679c\u8981\u8ba9\u670d\u52a1\u5668\u670d\u52a1\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u90a3\u4e48\u6700\u76f4\u63a5\u7684\u65b9\u5f0f\u5c31\u662f\u4e3a\u6bcf\u4e00\u6761\u8fde\u63a5\u521b\u5efa\u7ebf\u7a0b\u3002</p> <p>\u5176\u5b9e\u521b\u5efa\u8fdb\u7a0b\u4e5f\u662f\u53ef\u4ee5\u7684\uff0c\u539f\u7406\u662f\u4e00\u6837\u7684\uff0c\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u533a\u522b\u5728\u4e8e\u7ebf\u7a0b\u6bd4\u8f83\u8f7b\u91cf\u7ea7\u4e9b\uff0c\u7ebf\u7a0b\u7684\u521b\u5efa\u548c\u7ebf\u7a0b\u95f4\u5207\u6362\u7684\u6210\u672c\u8981\u5c0f\u4e9b\uff0c\u4e3a\u4e86\u63cf\u8ff0\u7b80\u8ff0\uff0c\u540e\u9762\u90fd\u4ee5\u7ebf\u7a0b\u4e3a\u4f8b\u3002</p> <p>\u5904\u7406\u5b8c\u4e1a\u52a1\u903b\u8f91\u540e\uff0c\u968f\u7740\u8fde\u63a5\u5173\u95ed\u540e\u7ebf\u7a0b\u4e5f\u540c\u6837\u8981\u9500\u6bc1\u4e86\uff0c\u4f46\u662f\u8fd9\u6837\u4e0d\u505c\u5730\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\uff0c\u4e0d\u4ec5\u4f1a\u5e26\u6765\u6027\u80fd\u5f00\u9500\uff0c\u4e5f\u4f1a\u9020\u6210\u6d6a\u8d39\u8d44\u6e90\uff0c\u800c\u4e14\u5982\u679c\u8981\u8fde\u63a5\u51e0\u4e07\u6761\u8fde\u63a5\uff0c\u521b\u5efa\u51e0\u4e07\u4e2a\u7ebf\u7a0b\u53bb\u5e94\u5bf9\u4e5f\u662f\u4e0d\u73b0\u5b9e\u7684\u3002</p> <p>\u8981\u8fd9\u4e48\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u5462\uff1f\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u300c\u8d44\u6e90\u590d\u7528\u300d\u7684\u65b9\u5f0f\u3002</p> <p>\u4e5f\u5c31\u662f\u4e0d\u7528\u518d\u4e3a\u6bcf\u4e2a\u8fde\u63a5\u521b\u5efa\u7ebf\u7a0b\uff0c\u800c\u662f\u521b\u5efa\u4e00\u4e2a\u300c\u7ebf\u7a0b\u6c60\u300d\uff0c\u5c06\u8fde\u63a5\u5206\u914d\u7ed9\u7ebf\u7a0b\uff0c\u7136\u540e\u4e00\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u5904\u7406\u591a\u4e2a\u8fde\u63a5\u7684\u4e1a\u52a1\u3002</p> <p>\u4e0d\u8fc7\uff0c\u8fd9\u6837\u53c8\u5f15\u6765\u4e00\u4e2a\u65b0\u7684\u95ee\u9898\uff0c\u7ebf\u7a0b\u600e\u6837\u624d\u80fd\u9ad8\u6548\u5730\u5904\u7406\u591a\u4e2a\u8fde\u63a5\u7684\u4e1a\u52a1\uff1f</p> <p>\u5f53\u4e00\u4e2a\u8fde\u63a5\u5bf9\u5e94\u4e00\u4e2a\u7ebf\u7a0b\u65f6\uff0c\u7ebf\u7a0b\u4e00\u822c\u91c7\u7528\u300cread -&gt; \u4e1a\u52a1\u5904\u7406 -&gt; send\u300d\u7684\u5904\u7406\u6d41\u7a0b\uff0c\u5982\u679c\u5f53\u524d\u8fde\u63a5\u6ca1\u6709\u6570\u636e\u53ef\u8bfb\uff0c\u90a3\u4e48\u7ebf\u7a0b\u4f1a\u963b\u585e\u5728 <code>read</code> \u64cd\u4f5c\u4e0a\uff08socket \u9ed8\u8ba4\u60c5\u51b5\u662f\u963b\u585e I/O\uff09\uff0c\u4e0d\u8fc7\u8fd9\u79cd\u963b\u585e\u65b9\u5f0f\u5e76\u4e0d\u5f71\u54cd\u5176\u4ed6\u7ebf\u7a0b\u3002</p> <p>\u4f46\u662f\u5f15\u5165\u4e86\u7ebf\u7a0b\u6c60\uff0c\u90a3\u4e48\u4e00\u4e2a\u7ebf\u7a0b\u8981\u5904\u7406\u591a\u4e2a\u8fde\u63a5\u7684\u4e1a\u52a1\uff0c\u7ebf\u7a0b\u5728\u5904\u7406\u67d0\u4e2a\u8fde\u63a5\u7684 <code>read</code> \u64cd\u4f5c\u65f6\uff0c\u5982\u679c\u9047\u5230\u6ca1\u6709\u6570\u636e\u53ef\u8bfb\uff0c\u5c31\u4f1a\u53d1\u751f\u963b\u585e\uff0c\u90a3\u4e48\u7ebf\u7a0b\u5c31\u6ca1\u529e\u6cd5\u7ee7\u7eed\u5904\u7406\u5176\u4ed6\u8fde\u63a5\u7684\u4e1a\u52a1\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e00\u4e2a\u95ee\u9898\uff0c\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u5c31\u662f\u5c06 socket \u6539\u6210\u975e\u963b\u585e\uff0c\u7136\u540e\u7ebf\u7a0b\u4e0d\u65ad\u5730\u8f6e\u8be2\u8c03\u7528 <code>read</code> \u64cd\u4f5c\u6765\u5224\u65ad\u662f\u5426\u6709\u6570\u636e\uff0c\u8fd9\u79cd\u65b9\u5f0f\u867d\u7136\u8be5\u80fd\u591f\u89e3\u51b3\u963b\u585e\u7684\u95ee\u9898\uff0c\u4f46\u662f\u89e3\u51b3\u7684\u65b9\u5f0f\u6bd4\u8f83\u7c97\u66b4\uff0c\u56e0\u4e3a\u8f6e\u8be2\u662f\u8981\u6d88\u8017 CPU \u7684\uff0c\u800c\u4e14\u968f\u7740\u4e00\u4e2a\u7ebf\u7a0b\u5904\u7406\u7684\u8fde\u63a5\u8d8a\u591a\uff0c\u8f6e\u8be2\u7684\u6548\u7387\u5c31\u4f1a\u8d8a\u4f4e\u3002</p> <p>\u4e0a\u9762\u7684\u95ee\u9898\u5728\u4e8e\uff0c\u7ebf\u7a0b\u5e76\u4e0d\u77e5\u9053\u5f53\u524d\u8fde\u63a5\u662f\u5426\u6709\u6570\u636e\u53ef\u8bfb\uff0c\u4ece\u800c\u9700\u8981\u6bcf\u6b21\u901a\u8fc7 <code>read</code> \u53bb\u8bd5\u63a2\u3002</p> <p>\u90a3\u6709\u6ca1\u6709\u529e\u6cd5\u5728\u53ea\u6709\u5f53\u8fde\u63a5\u4e0a\u6709\u6570\u636e\u7684\u65f6\u5019\uff0c\u7ebf\u7a0b\u624d\u53bb\u53d1\u8d77\u8bfb\u8bf7\u6c42\u5462\uff1f\u7b54\u6848\u662f\u6709\u7684\uff0c\u5b9e\u73b0\u8fd9\u4e00\u6280\u672f\u7684\u5c31\u662f I/O \u591a\u8def\u590d\u7528\u3002</p> <p>I/O \u591a\u8def\u590d\u7528\u6280\u672f\u4f1a\u7528\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u6765\u76d1\u542c\u6211\u4eec\u6240\u6709\u5173\u5fc3\u7684\u8fde\u63a5\uff0c\u4e5f\u5c31\u8bf4\u53ef\u4ee5\u5728\u4e00\u4e2a\u76d1\u63a7\u7ebf\u7a0b\u91cc\u9762\u76d1\u63a7\u5f88\u591a\u7684\u8fde\u63a5\u3002</p> <p></p> <p>\u6211\u4eec\u719f\u6089\u7684 select/poll/epoll \u5c31\u662f\u5185\u6838\u63d0\u4f9b\u7ed9\u7528\u6237\u6001\u7684\u591a\u8def\u590d\u7528\u7cfb\u7edf\u8c03\u7528\uff0c\u7ebf\u7a0b\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u4ece\u5185\u6838\u4e2d\u83b7\u53d6\u591a\u4e2a\u4e8b\u4ef6\u3002</p> <p>PS\uff1a\u5982\u679c\u60f3\u77e5\u9053 select/poll/epoll \u7684\u533a\u522b\uff0c\u53ef\u4ee5\u770b\u770b\u5c0f\u6797\u4e4b\u524d\u5199\u7684\u8fd9\u7bc7\u6587\u7ae0\uff1a\u8fd9\u6b21\u7b54\u5e94\u6211\uff0c\u4e00\u4e3e\u62ff\u4e0b I/O \u591a\u8def\u590d\u7528\uff01</p> <p>select/poll/epoll \u662f\u5982\u4f55\u83b7\u53d6\u7f51\u7edc\u4e8b\u4ef6\u7684\u5462\uff1f</p> <p>\u5728\u83b7\u53d6\u4e8b\u4ef6\u65f6\uff0c\u5148\u628a\u6211\u4eec\u8981\u5173\u5fc3\u7684\u8fde\u63a5\u4f20\u7ed9\u5185\u6838\uff0c\u518d\u7531\u5185\u6838\u68c0\u6d4b\uff1a</p> <ul> <li>\u5982\u679c\u6ca1\u6709\u4e8b\u4ef6\u53d1\u751f\uff0c\u7ebf\u7a0b\u53ea\u9700\u963b\u585e\u5728\u8fd9\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u800c\u65e0\u9700\u50cf\u524d\u9762\u7684\u7ebf\u7a0b\u6c60\u65b9\u6848\u90a3\u6837\u8f6e\u8be2\u8c03\u7528 read \u64cd\u4f5c\u6765\u5224\u65ad\u662f\u5426\u6709\u6570\u636e\u3002</li> <li>\u5982\u679c\u6709\u4e8b\u4ef6\u53d1\u751f\uff0c\u5185\u6838\u4f1a\u8fd4\u56de\u4ea7\u751f\u4e86\u4e8b\u4ef6\u7684\u8fde\u63a5\uff0c\u7ebf\u7a0b\u5c31\u4f1a\u4ece\u963b\u585e\u72b6\u6001\u8fd4\u56de\uff0c\u7136\u540e\u5728\u7528\u6237\u6001\u4e2d\u518d\u5904\u7406\u8fd9\u4e9b\u8fde\u63a5\u5bf9\u5e94\u7684\u4e1a\u52a1\u5373\u53ef\u3002</li> </ul> <p>\u5f53\u4e0b\u5f00\u6e90\u8f6f\u4ef6\u80fd\u505a\u5230\u7f51\u7edc\u9ad8\u6027\u80fd\u7684\u539f\u56e0\u5c31\u662f I/O \u591a\u8def\u590d\u7528\u5417\uff1f</p> <p>\u662f\u7684\uff0c\u57fa\u672c\u662f\u57fa\u4e8e I/O \u591a\u8def\u590d\u7528\uff0c\u7528\u8fc7 I/O \u591a\u8def\u590d\u7528\u63a5\u53e3\u5199\u7f51\u7edc\u7a0b\u5e8f\u7684\u540c\u5b66\uff0c\u80af\u5b9a\u77e5\u9053\u662f\u9762\u5411\u8fc7\u7a0b\u7684\u65b9\u5f0f\u5199\u4ee3\u7801\u7684\uff0c\u8fd9\u6837\u7684\u5f00\u53d1\u7684\u6548\u7387\u4e0d\u9ad8\u3002</p> <p>\u4e8e\u662f\uff0c\u5927\u4f6c\u4eec\u57fa\u4e8e\u9762\u5411\u5bf9\u8c61\u7684\u601d\u60f3\uff0c\u5bf9 I/O \u591a\u8def\u590d\u7528\u4f5c\u4e86\u4e00\u5c42\u5c01\u88c5\uff0c\u8ba9\u4f7f\u7528\u8005\u4e0d\u7528\u8003\u8651\u5e95\u5c42\u7f51\u7edc API \u7684\u7ec6\u8282\uff0c\u53ea\u9700\u8981\u5173\u6ce8\u5e94\u7528\u4ee3\u7801\u7684\u7f16\u5199\u3002</p> <p>\u5927\u4f6c\u4eec\u8fd8\u4e3a\u8fd9\u79cd\u6a21\u5f0f\u53d6\u4e86\u4e2a\u8ba9\u4eba\u7b2c\u4e00\u65f6\u95f4\u96be\u4ee5\u7406\u89e3\u7684\u540d\u5b57\uff1aReactor \u6a21\u5f0f\u3002</p> <p>Reactor \u7ffb\u8bd1\u8fc7\u6765\u7684\u610f\u601d\u662f\u300c\u53cd\u5e94\u5806\u300d\uff0c\u53ef\u80fd\u5927\u5bb6\u4f1a\u8054\u60f3\u5230\u7269\u7406\u5b66\u91cc\u7684\u6838\u53cd\u5e94\u5806\uff0c\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u7684\u8fd9\u4e2a\u610f\u601d\u3002</p> <p>\u8fd9\u91cc\u7684\u53cd\u5e94\u6307\u7684\u662f\u300c\u5bf9\u4e8b\u4ef6\u53cd\u5e94\u300d\uff0c\u4e5f\u5c31\u662f\u6765\u4e86\u4e00\u4e2a\u4e8b\u4ef6\uff0cReactor \u5c31\u6709\u76f8\u5bf9\u5e94\u7684\u53cd\u5e94/\u54cd\u5e94\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0cReactor \u6a21\u5f0f\u4e5f\u53eb <code>Dispatcher</code> \u6a21\u5f0f\uff0c\u6211\u89c9\u5f97\u8fd9\u4e2a\u540d\u5b57\u66f4\u8d34\u5408\u8be5\u6a21\u5f0f\u7684\u542b\u4e49\uff0c\u5373 I/O \u591a\u8def\u590d\u7528\u76d1\u542c\u4e8b\u4ef6\uff0c\u6536\u5230\u4e8b\u4ef6\u540e\uff0c\u6839\u636e\u4e8b\u4ef6\u7c7b\u578b\u5206\u914d\uff08Dispatch\uff09\u7ed9\u67d0\u4e2a\u8fdb\u7a0b / \u7ebf\u7a0b\u3002</p> <p>Reactor \u6a21\u5f0f\u4e3b\u8981\u7531 Reactor \u548c\u5904\u7406\u8d44\u6e90\u6c60\u8fd9\u4e24\u4e2a\u6838\u5fc3\u90e8\u5206\u7ec4\u6210\uff0c\u5b83\u4fe9\u8d1f\u8d23\u7684\u4e8b\u60c5\u5982\u4e0b\uff1a</p> <ul> <li>Reactor \u8d1f\u8d23\u76d1\u542c\u548c\u5206\u53d1\u4e8b\u4ef6\uff0c\u4e8b\u4ef6\u7c7b\u578b\u5305\u542b\u8fde\u63a5\u4e8b\u4ef6\u3001\u8bfb\u5199\u4e8b\u4ef6\uff1b</li> <li>\u5904\u7406\u8d44\u6e90\u6c60\u8d1f\u8d23\u5904\u7406\u4e8b\u4ef6\uff0c\u5982 read -&gt; \u4e1a\u52a1\u903b\u8f91 -&gt; send\uff1b</li> </ul> <p>Reactor \u6a21\u5f0f\u662f\u7075\u6d3b\u591a\u53d8\u7684\uff0c\u53ef\u4ee5\u5e94\u5bf9\u4e0d\u540c\u7684\u4e1a\u52a1\u573a\u666f\uff0c\u7075\u6d3b\u5728\u4e8e\uff1a</p> <ul> <li>Reactor \u7684\u6570\u91cf\u53ef\u4ee5\u53ea\u6709\u4e00\u4e2a\uff0c\u4e5f\u53ef\u4ee5\u6709\u591a\u4e2a\uff1b</li> <li>\u5904\u7406\u8d44\u6e90\u6c60\u53ef\u4ee5\u662f\u5355\u4e2a\u8fdb\u7a0b / \u7ebf\u7a0b\uff0c\u4e5f\u53ef\u4ee5\u662f\u591a\u4e2a\u8fdb\u7a0b /\u7ebf\u7a0b\uff1b</li> </ul> <p>\u5c06\u4e0a\u9762\u7684\u4e24\u4e2a\u56e0\u7d20\u6392\u5217\u7ec4\u8bbe\u4e00\u4e0b\uff0c\u7406\u8bba\u4e0a\u5c31\u53ef\u4ee5\u6709 4 \u79cd\u65b9\u6848\u9009\u62e9\uff1a</p> <ul> <li>\u5355 Reactor \u5355\u8fdb\u7a0b / \u7ebf\u7a0b\uff1b</li> <li>\u5355 Reactor \u591a\u8fdb\u7a0b / \u7ebf\u7a0b\uff1b</li> <li>\u591a Reactor \u5355\u8fdb\u7a0b / \u7ebf\u7a0b\uff1b</li> <li>\u591a Reactor \u591a\u8fdb\u7a0b / \u7ebf\u7a0b\uff1b</li> </ul> <p>\u5176\u4e2d\uff0c\u300c\u591a Reactor \u5355\u8fdb\u7a0b / \u7ebf\u7a0b\u300d\u5b9e\u73b0\u65b9\u6848\u76f8\u6bd4\u300c\u5355 Reactor \u5355\u8fdb\u7a0b / \u7ebf\u7a0b\u300d\u65b9\u6848\uff0c\u4e0d\u4ec5\u590d\u6742\u800c\u4e14\u4e5f\u6ca1\u6709\u6027\u80fd\u4f18\u52bf\uff0c\u56e0\u6b64\u5b9e\u9645\u4e2d\u5e76\u6ca1\u6709\u5e94\u7528\u3002</p> <p>\u5269\u4e0b\u7684 3 \u4e2a\u65b9\u6848\u90fd\u662f\u6bd4\u8f83\u7ecf\u5178\u7684\uff0c\u4e14\u90fd\u6709\u5e94\u7528\u5728\u5b9e\u9645\u7684\u9879\u76ee\u4e2d\uff1a</p> <ul> <li>\u5355 Reactor \u5355\u8fdb\u7a0b / \u7ebf\u7a0b\uff1b</li> <li>\u5355 Reactor \u591a\u7ebf\u7a0b / \u8fdb\u7a0b\uff1b</li> <li>\u591a Reactor \u591a\u8fdb\u7a0b / \u7ebf\u7a0b\uff1b</li> </ul> <p>\u65b9\u6848\u5177\u4f53\u4f7f\u7528\u8fdb\u7a0b\u8fd8\u662f\u7ebf\u7a0b\uff0c\u8981\u770b\u4f7f\u7528\u7684\u7f16\u7a0b\u8bed\u8a00\u4ee5\u53ca\u5e73\u53f0\u6709\u5173\uff1a</p> <ul> <li>Java \u8bed\u8a00\u4e00\u822c\u4f7f\u7528\u7ebf\u7a0b\uff0c\u6bd4\u5982 Netty;</li> <li>C \u8bed\u8a00\u4f7f\u7528\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u90fd\u53ef\u4ee5\uff0c\u4f8b\u5982 Nginx \u4f7f\u7528\u7684\u662f\u8fdb\u7a0b\uff0cMemcache \u4f7f\u7528\u7684\u662f\u7ebf\u7a0b\u3002</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u522b\u4ecb\u7ecd\u8fd9\u4e09\u4e2a\u7ecf\u5178\u7684 Reactor \u65b9\u6848\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/reactor/#reactor","title":"Reactor","text":""},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/reactor/#reactor_1","title":"\u5355 Reactor \u5355\u8fdb\u7a0b / \u7ebf\u7a0b","text":"<p>\u4e00\u822c\u6765\u8bf4\uff0cC \u8bed\u8a00\u5b9e\u73b0\u7684\u662f\u300c\u5355 Reactor \u5355\u8fdb\u7a0b\u300d\u7684\u65b9\u6848\uff0c\u56e0\u4e3a C \u8bed\u8a00\u7f16\u5199\u5b8c\u7684\u7a0b\u5e8f\uff0c\u8fd0\u884c\u540e\u5c31\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0c\u4e0d\u9700\u8981\u5728\u8fdb\u7a0b\u4e2d\u518d\u521b\u5efa\u7ebf\u7a0b\u3002</p> <p>\u800c Java \u8bed\u8a00\u5b9e\u73b0\u7684\u662f\u300c\u5355 Reactor \u5355\u7ebf\u7a0b\u300d\u7684\u65b9\u6848\uff0c\u56e0\u4e3a Java \u7a0b\u5e8f\u662f\u8dd1\u5728 Java \u865a\u62df\u673a\u8fd9\u4e2a\u8fdb\u7a0b\u4e0a\u9762\u7684\uff0c\u865a\u62df\u673a\u4e2d\u6709\u5f88\u591a\u7ebf\u7a0b\uff0c\u6211\u4eec\u5199\u7684 Java \u7a0b\u5e8f\u53ea\u662f\u5176\u4e2d\u7684\u4e00\u4e2a\u7ebf\u7a0b\u800c\u5df2\u3002</p> <p>\u6211\u4eec\u6765\u770b\u770b\u300c\u5355 Reactor \u5355\u8fdb\u7a0b\u300d\u7684\u65b9\u6848\u793a\u610f\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8fdb\u7a0b\u91cc\u6709 Reactor\u3001Acceptor\u3001Handler \u8fd9\u4e09\u4e2a\u5bf9\u8c61\uff1a</p> <ul> <li>Reactor \u5bf9\u8c61\u7684\u4f5c\u7528\u662f\u76d1\u542c\u548c\u5206\u53d1\u4e8b\u4ef6\uff1b</li> <li>Acceptor \u5bf9\u8c61\u7684\u4f5c\u7528\u662f\u83b7\u53d6\u8fde\u63a5\uff1b</li> <li>Handler \u5bf9\u8c61\u7684\u4f5c\u7528\u662f\u5904\u7406\u4e1a\u52a1\uff1b</li> </ul> <p>\u5bf9\u8c61\u91cc\u7684 select\u3001accept\u3001read\u3001send \u662f\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\uff0cdispatch \u548c\u300c\u4e1a\u52a1\u5904\u7406\u300d\u662f\u9700\u8981\u5b8c\u6210\u7684\u64cd\u4f5c\uff0c\u5176\u4e2d dispatch \u662f\u5206\u53d1\u4e8b\u4ef6\u64cd\u4f5c\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u4ecb\u7ecd\u4e0b\u300c\u5355 Reactor \u5355\u8fdb\u7a0b\u300d\u8fd9\u4e2a\u65b9\u6848\uff1a</p> <ul> <li>Reactor \u5bf9\u8c61\u901a\u8fc7 select\uff08IO \u591a\u8def\u590d\u7528\u63a5\u53e3\uff09\u76d1\u542c\u4e8b\u4ef6\uff0c\u6536\u5230\u4e8b\u4ef6\u540e\u901a\u8fc7 dispatch \u8fdb\u884c\u5206\u53d1\uff0c\u5177\u4f53\u5206\u53d1\u7ed9 Acceptor \u5bf9\u8c61\u8fd8\u662f Handler \u5bf9\u8c61\uff0c\u8fd8\u8981\u770b\u6536\u5230\u7684\u4e8b\u4ef6\u7c7b\u578b\uff1b</li> <li>\u5982\u679c\u662f\u8fde\u63a5\u5efa\u7acb\u7684\u4e8b\u4ef6\uff0c\u5219\u4ea4\u7531 Acceptor \u5bf9\u8c61\u8fdb\u884c\u5904\u7406\uff0cAcceptor \u5bf9\u8c61\u4f1a\u901a\u8fc7 accept \u65b9\u6cd5 \u83b7\u53d6\u8fde\u63a5\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a Handler \u5bf9\u8c61\u6765\u5904\u7406\u540e\u7eed\u7684\u54cd\u5e94\u4e8b\u4ef6\uff1b</li> <li>\u5982\u679c\u4e0d\u662f\u8fde\u63a5\u5efa\u7acb\u4e8b\u4ef6\uff0c\u5219\u4ea4\u7531\u5f53\u524d\u8fde\u63a5\u5bf9\u5e94\u7684 Handler \u5bf9\u8c61\u6765\u8fdb\u884c\u54cd\u5e94\uff1b</li> <li>Handler \u5bf9\u8c61\u901a\u8fc7 read -&gt; \u4e1a\u52a1\u5904\u7406 -&gt; send \u7684\u6d41\u7a0b\u6765\u5b8c\u6210\u5b8c\u6574\u7684\u4e1a\u52a1\u6d41\u7a0b\u3002</li> </ul> <p>\u5355 Reactor \u5355\u8fdb\u7a0b\u7684\u65b9\u6848\u56e0\u4e3a\u5168\u90e8\u5de5\u4f5c\u90fd\u5728\u540c\u4e00\u4e2a\u8fdb\u7a0b\u5185\u5b8c\u6210\uff0c\u6240\u4ee5\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\uff0c\u4e0d\u9700\u8981\u8003\u8651\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u4e5f\u4e0d\u7528\u62c5\u5fc3\u591a\u8fdb\u7a0b\u7ade\u4e89\u3002</p> <p>\u4f46\u662f\uff0c\u8fd9\u79cd\u65b9\u6848\u5b58\u5728 2 \u4e2a\u7f3a\u70b9\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a\u7f3a\u70b9\uff0c\u56e0\u4e3a\u53ea\u6709\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u65e0\u6cd5\u5145\u5206\u5229\u7528 \u591a\u6838 CPU \u7684\u6027\u80fd\uff1b</li> <li>\u7b2c\u4e8c\u4e2a\u7f3a\u70b9\uff0cHandler \u5bf9\u8c61\u5728\u4e1a\u52a1\u5904\u7406\u65f6\uff0c\u6574\u4e2a\u8fdb\u7a0b\u662f\u65e0\u6cd5\u5904\u7406\u5176\u4ed6\u8fde\u63a5\u7684\u4e8b\u4ef6\u7684\uff0c\u5982\u679c\u4e1a\u52a1\u5904\u7406\u8017\u65f6\u6bd4\u8f83\u957f\uff0c\u90a3\u4e48\u5c31\u9020\u6210\u54cd\u5e94\u7684\u5ef6\u8fdf\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u5355 Reactor \u5355\u8fdb\u7a0b\u7684\u65b9\u6848\u4e0d\u9002\u7528\u8ba1\u7b97\u5bc6\u96c6\u578b\u7684\u573a\u666f\uff0c\u53ea\u9002\u7528\u4e8e\u4e1a\u52a1\u5904\u7406\u975e\u5e38\u5feb\u901f\u7684\u573a\u666f\u3002</p> <p>Redis \u662f\u7531 C \u8bed\u8a00\u5b9e\u73b0\u7684\uff0c\u5b83\u91c7\u7528\u7684\u6b63\u662f\u300c\u5355 Reactor \u5355\u8fdb\u7a0b\u300d\u7684\u65b9\u6848\uff0c\u56e0\u4e3a Redis \u4e1a\u52a1\u5904\u7406\u4e3b\u8981\u662f\u5728\u5185\u5b58\u4e2d\u5b8c\u6210\uff0c\u64cd\u4f5c\u7684\u901f\u5ea6\u662f\u5f88\u5feb\u7684\uff0c\u6027\u80fd\u74f6\u9888\u4e0d\u5728 CPU \u4e0a\uff0c\u6240\u4ee5 Redis \u5bf9\u4e8e\u547d\u4ee4\u7684\u5904\u7406\u662f\u5355\u8fdb\u7a0b\u7684\u65b9\u6848\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/reactor/#reactor_2","title":"\u5355 Reactor \u591a\u7ebf\u7a0b / \u591a\u8fdb\u7a0b","text":"<p>\u5982\u679c\u8981\u514b\u670d\u300c\u5355 Reactor \u5355\u7ebf\u7a0b / \u8fdb\u7a0b\u300d\u65b9\u6848\u7684\u7f3a\u70b9\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u5f15\u5165\u591a\u7ebf\u7a0b / \u591a\u8fdb\u7a0b\uff0c\u8fd9\u6837\u5c31\u4ea7\u751f\u4e86\u5355 Reactor \u591a\u7ebf\u7a0b / \u591a\u8fdb\u7a0b\u7684\u65b9\u6848\u3002</p> <p>\u95fb\u5176\u540d\u4e0d\u5982\u770b\u5176\u56fe\uff0c\u5148\u6765\u770b\u770b\u300c\u5355 Reactor \u591a\u7ebf\u7a0b\u300d\u65b9\u6848\u7684\u793a\u610f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u8be6\u7ec6\u8bf4\u4e00\u4e0b\u8fd9\u4e2a\u65b9\u6848\uff1a</p> <ul> <li>Reactor \u5bf9\u8c61\u901a\u8fc7 select\uff08IO \u591a\u8def\u590d\u7528\u63a5\u53e3\uff09\u76d1\u542c\u4e8b\u4ef6\uff0c\u6536\u5230\u4e8b\u4ef6\u540e\u901a\u8fc7 dispatch \u8fdb\u884c\u5206\u53d1\uff0c\u5177\u4f53\u5206\u53d1\u7ed9 Acceptor \u5bf9\u8c61\u8fd8\u662f Handler \u5bf9\u8c61\uff0c\u8fd8\u8981\u770b\u6536\u5230\u7684\u4e8b\u4ef6\u7c7b\u578b\uff1b</li> <li>\u5982\u679c\u662f\u8fde\u63a5\u5efa\u7acb\u7684\u4e8b\u4ef6\uff0c\u5219\u4ea4\u7531 Acceptor \u5bf9\u8c61\u8fdb\u884c\u5904\u7406\uff0cAcceptor \u5bf9\u8c61\u4f1a\u901a\u8fc7 accept \u65b9\u6cd5 \u83b7\u53d6\u8fde\u63a5\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a Handler \u5bf9\u8c61\u6765\u5904\u7406\u540e\u7eed\u7684\u54cd\u5e94\u4e8b\u4ef6\uff1b</li> <li>\u5982\u679c\u4e0d\u662f\u8fde\u63a5\u5efa\u7acb\u4e8b\u4ef6\uff0c\u5219\u4ea4\u7531\u5f53\u524d\u8fde\u63a5\u5bf9\u5e94\u7684 Handler \u5bf9\u8c61\u6765\u8fdb\u884c\u54cd\u5e94\uff1b</li> </ul> <p>\u4e0a\u9762\u7684\u4e09\u4e2a\u6b65\u9aa4\u548c\u5355 Reactor \u5355\u7ebf\u7a0b\u65b9\u6848\u662f\u4e00\u6837\u7684\uff0c\u63a5\u4e0b\u6765\u7684\u6b65\u9aa4\u5c31\u5f00\u59cb\u4e0d\u4e00\u6837\u4e86\uff1a</p> <ul> <li>Handler \u5bf9\u8c61\u4e0d\u518d\u8d1f\u8d23\u4e1a\u52a1\u5904\u7406\uff0c\u53ea\u8d1f\u8d23\u6570\u636e\u7684\u63a5\u6536\u548c\u53d1\u9001\uff0cHandler \u5bf9\u8c61\u901a\u8fc7 read \u8bfb\u53d6\u5230\u6570\u636e\u540e\uff0c\u4f1a\u5c06\u6570\u636e\u53d1\u7ed9\u5b50\u7ebf\u7a0b\u91cc\u7684 Processor \u5bf9\u8c61\u8fdb\u884c\u4e1a\u52a1\u5904\u7406\uff1b</li> <li>\u5b50\u7ebf\u7a0b\u91cc\u7684 Processor \u5bf9\u8c61\u5c31\u8fdb\u884c\u4e1a\u52a1\u5904\u7406\uff0c\u5904\u7406\u5b8c\u540e\uff0c\u5c06\u7ed3\u679c\u53d1\u7ed9\u4e3b\u7ebf\u7a0b\u4e2d\u7684 Handler \u5bf9\u8c61\uff0c\u63a5\u7740\u7531 Handler \u901a\u8fc7 send \u65b9\u6cd5\u5c06\u54cd\u5e94\u7ed3\u679c\u53d1\u9001\u7ed9 client\uff1b</li> </ul> <p>\u5355 Reator \u591a\u7ebf\u7a0b\u7684\u65b9\u6848\u4f18\u52bf\u5728\u4e8e\u80fd\u591f\u5145\u5206\u5229\u7528\u591a\u6838 CPU \u7684\u6027\u80fd\uff0c\u90a3\u65e2\u7136\u5f15\u5165\u591a\u7ebf\u7a0b\uff0c\u90a3\u4e48\u81ea\u7136\u5c31\u5e26\u6765\u4e86\u591a\u7ebf\u7a0b\u7ade\u4e89\u8d44\u6e90\u7684\u95ee\u9898\u3002</p> <p>\u4f8b\u5982\uff0c\u5b50\u7ebf\u7a0b\u5b8c\u6210\u4e1a\u52a1\u5904\u7406\u540e\uff0c\u8981\u628a\u7ed3\u679c\u4f20\u9012\u7ed9\u4e3b\u7ebf\u7a0b\u7684 Reactor \u8fdb\u884c\u53d1\u9001\uff0c\u8fd9\u91cc\u6d89\u53ca\u5171\u4eab\u6570\u636e\u7684\u7ade\u4e89\u3002</p> <p>\u8981\u907f\u514d\u591a\u7ebf\u7a0b\u7531\u4e8e\u7ade\u4e89\u5171\u4eab\u8d44\u6e90\u800c\u5bfc\u81f4\u6570\u636e\u9519\u4e71\u7684\u95ee\u9898\uff0c\u5c31\u9700\u8981\u5728\u64cd\u4f5c\u5171\u4eab\u8d44\u6e90\u524d\u52a0\u4e0a\u4e92\u65a5\u9501\uff0c\u4ee5\u4fdd\u8bc1\u4efb\u610f\u65f6\u95f4\u91cc\u53ea\u6709\u4e00\u4e2a\u7ebf\u7a0b\u5728\u64cd\u4f5c\u5171\u4eab\u8d44\u6e90\uff0c\u5f85\u8be5\u7ebf\u7a0b\u64cd\u4f5c\u5b8c\u91ca\u653e\u4e92\u65a5\u9501\u540e\uff0c\u5176\u4ed6\u7ebf\u7a0b\u624d\u6709\u673a\u4f1a\u64cd\u4f5c\u5171\u4eab\u6570\u636e\u3002</p> <p>\u804a\u5b8c\u5355 Reactor \u591a\u7ebf\u7a0b\u7684\u65b9\u6848\uff0c\u63a5\u7740\u6765\u770b\u770b\u5355 Reactor \u591a\u8fdb\u7a0b\u7684\u65b9\u6848\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u5355 Reactor \u591a\u8fdb\u7a0b\u76f8\u6bd4\u5355 Reactor \u591a\u7ebf\u7a0b\u5b9e\u73b0\u8d77\u6765\u5f88\u9ebb\u70e6\uff0c\u4e3b\u8981\u56e0\u4e3a\u8981\u8003\u8651\u5b50\u8fdb\u7a0b &lt;-&gt; \u7236\u8fdb\u7a0b\u7684\u53cc\u5411\u901a\u4fe1\uff0c\u5e76\u4e14\u7236\u8fdb\u7a0b\u8fd8\u5f97\u77e5\u9053\u5b50\u8fdb\u7a0b\u8981\u5c06\u6570\u636e\u53d1\u9001\u7ed9\u54ea\u4e2a\u5ba2\u6237\u7aef\u3002</p> <p>\u800c\u591a\u7ebf\u7a0b\u95f4\u53ef\u4ee5\u5171\u4eab\u6570\u636e\uff0c\u867d\u7136\u8981\u989d\u5916\u8003\u8651\u5e76\u53d1\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u8fdc\u6bd4\u8fdb\u7a0b\u95f4\u901a\u4fe1\u7684\u590d\u6742\u5ea6\u4f4e\u5f97\u591a\uff0c\u56e0\u6b64\u5b9e\u9645\u5e94\u7528\u4e2d\u4e5f\u770b\u4e0d\u5230\u5355 Reactor \u591a\u8fdb\u7a0b\u7684\u6a21\u5f0f\u3002</p> <p>\u53e6\u5916\uff0c\u300c\u5355 Reactor\u300d\u7684\u6a21\u5f0f\u8fd8\u6709\u4e2a\u95ee\u9898\uff0c\u56e0\u4e3a\u4e00\u4e2a Reactor \u5bf9\u8c61\u627f\u62c5\u6240\u6709\u4e8b\u4ef6\u7684\u76d1\u542c\u548c\u54cd\u5e94\uff0c\u800c\u4e14\u53ea\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u8fd0\u884c\uff0c\u5728\u9762\u5bf9\u77ac\u95f4\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u65f6\uff0c\u5bb9\u6613\u6210\u4e3a\u6027\u80fd\u7684\u74f6\u9888\u7684\u5730\u65b9\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/reactor/#reactor_3","title":"\u591a Reactor \u591a\u8fdb\u7a0b / \u7ebf\u7a0b","text":"<p>\u8981\u89e3\u51b3\u300c\u5355 Reactor\u300d\u7684\u95ee\u9898\uff0c\u5c31\u662f\u5c06\u300c\u5355 Reactor\u300d\u5b9e\u73b0\u6210\u300c\u591a Reactor\u300d\uff0c\u8fd9\u6837\u5c31\u4ea7\u751f\u4e86\u7b2c \u591a Reactor \u591a\u8fdb\u7a0b / \u7ebf\u7a0b\u7684\u65b9\u6848\u3002</p> <p>\u8001\u89c4\u77e9\uff0c\u95fb\u5176\u540d\u4e0d\u5982\u770b\u5176\u56fe\u3002\u591a Reactor \u591a\u8fdb\u7a0b / \u7ebf\u7a0b\u65b9\u6848\u7684\u793a\u610f\u56fe\u5982\u4e0b\uff08\u4ee5\u7ebf\u7a0b\u4e3a\u4f8b\uff09\uff1a</p> <p></p> <p>\u65b9\u6848\u8be6\u7ec6\u8bf4\u660e\u5982\u4e0b\uff1a</p> <ul> <li>\u4e3b\u7ebf\u7a0b\u4e2d\u7684 MainReactor \u5bf9\u8c61\u901a\u8fc7 select \u76d1\u63a7\u8fde\u63a5\u5efa\u7acb\u4e8b\u4ef6\uff0c\u6536\u5230\u4e8b\u4ef6\u540e\u901a\u8fc7 Acceptor \u5bf9\u8c61\u4e2d\u7684 accept \u83b7\u53d6\u8fde\u63a5\uff0c\u5c06\u65b0\u7684\u8fde\u63a5\u5206\u914d\u7ed9\u67d0\u4e2a\u5b50\u7ebf\u7a0b\uff1b</li> <li>\u5b50\u7ebf\u7a0b\u4e2d\u7684 SubReactor \u5bf9\u8c61\u5c06 MainReactor \u5bf9\u8c61\u5206\u914d\u7684\u8fde\u63a5\u52a0\u5165 select \u7ee7\u7eed\u8fdb\u884c\u76d1\u542c\uff0c\u5e76\u521b\u5efa\u4e00\u4e2a Handler \u7528\u4e8e\u5904\u7406\u8fde\u63a5\u7684\u54cd\u5e94\u4e8b\u4ef6\u3002</li> <li>\u5982\u679c\u6709\u65b0\u7684\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0cSubReactor \u5bf9\u8c61\u4f1a\u8c03\u7528\u5f53\u524d\u8fde\u63a5\u5bf9\u5e94\u7684 Handler \u5bf9\u8c61\u6765\u8fdb\u884c\u54cd\u5e94\u3002</li> <li>Handler \u5bf9\u8c61\u901a\u8fc7 read -&gt; \u4e1a\u52a1\u5904\u7406 -&gt; send \u7684\u6d41\u7a0b\u6765\u5b8c\u6210\u5b8c\u6574\u7684\u4e1a\u52a1\u6d41\u7a0b\u3002</li> </ul> <p>\u591a Reactor \u591a\u7ebf\u7a0b\u7684\u65b9\u6848\u867d\u7136\u770b\u8d77\u6765\u590d\u6742\u7684\uff0c\u4f46\u662f\u5b9e\u9645\u5b9e\u73b0\u65f6\u6bd4\u5355 Reactor \u591a\u7ebf\u7a0b\u7684\u65b9\u6848\u8981\u7b80\u5355\u7684\u591a\uff0c\u539f\u56e0\u5982\u4e0b\uff1a</p> <ul> <li>\u4e3b\u7ebf\u7a0b\u548c\u5b50\u7ebf\u7a0b\u5206\u5de5\u660e\u786e\uff0c\u4e3b\u7ebf\u7a0b\u53ea\u8d1f\u8d23\u63a5\u6536\u65b0\u8fde\u63a5\uff0c\u5b50\u7ebf\u7a0b\u8d1f\u8d23\u5b8c\u6210\u540e\u7eed\u7684\u4e1a\u52a1\u5904\u7406\u3002</li> <li>\u4e3b\u7ebf\u7a0b\u548c\u5b50\u7ebf\u7a0b\u7684\u4ea4\u4e92\u5f88\u7b80\u5355\uff0c\u4e3b\u7ebf\u7a0b\u53ea\u9700\u8981\u628a\u65b0\u8fde\u63a5\u4f20\u7ed9\u5b50\u7ebf\u7a0b\uff0c\u5b50\u7ebf\u7a0b\u65e0\u987b\u8fd4\u56de\u6570\u636e\uff0c\u76f4\u63a5\u5c31\u53ef\u4ee5\u5728\u5b50\u7ebf\u7a0b\u5c06\u5904\u7406\u7ed3\u679c\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ul> <p>\u5927\u540d\u9f0e\u9f0e\u7684\u4e24\u4e2a\u5f00\u6e90\u8f6f\u4ef6 Netty \u548c Memcache \u90fd\u91c7\u7528\u4e86\u300c\u591a Reactor \u591a\u7ebf\u7a0b\u300d\u7684\u65b9\u6848\u3002</p> <p>\u91c7\u7528\u4e86\u300c\u591a Reactor \u591a\u8fdb\u7a0b\u300d\u65b9\u6848\u7684\u5f00\u6e90\u8f6f\u4ef6\u662f Nginx\uff0c\u4e0d\u8fc7\u65b9\u6848\u4e0e\u6807\u51c6\u7684\u591a Reactor \u591a\u8fdb\u7a0b\u6709\u4e9b\u5dee\u5f02\u3002</p> <p>\u5177\u4f53\u5dee\u5f02\u8868\u73b0\u5728\u4e3b\u8fdb\u7a0b\u4e2d\u4ec5\u4ec5\u7528\u6765\u521d\u59cb\u5316 socket\uff0c\u5e76\u6ca1\u6709\u521b\u5efa mainReactor \u6765 accept \u8fde\u63a5\uff0c\u800c\u662f\u7531\u5b50\u8fdb\u7a0b\u7684 Reactor \u6765 accept \u8fde\u63a5\uff0c\u901a\u8fc7\u9501\u6765\u63a7\u5236\u4e00\u6b21\u53ea\u6709\u4e00\u4e2a\u5b50\u8fdb\u7a0b\u8fdb\u884c accept\uff08\u9632\u6b62\u51fa\u73b0\u60ca\u7fa4\u73b0\u8c61\uff09\uff0c\u5b50\u8fdb\u7a0b accept \u65b0\u8fde\u63a5\u540e\u5c31\u653e\u5230\u81ea\u5df1\u7684 Reactor \u8fdb\u884c\u5904\u7406\uff0c\u4e0d\u4f1a\u518d\u5206\u914d\u7ed9\u5176\u4ed6\u5b50\u8fdb\u7a0b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/reactor/#proactor","title":"Proactor","text":"<p>\u524d\u9762\u63d0\u5230\u7684 Reactor \u662f\u975e\u963b\u585e\u540c\u6b65\u7f51\u7edc\u6a21\u5f0f\uff0c\u800c Proactor \u662f\u5f02\u6b65\u7f51\u7edc\u6a21\u5f0f\u3002</p> <p>\u8fd9\u91cc\u5148\u7ed9\u5927\u5bb6\u590d\u4e60\u4e0b\u963b\u585e\u3001\u975e\u963b\u585e\u3001\u540c\u6b65\u3001\u5f02\u6b65 I/O \u7684\u6982\u5ff5\u3002</p> <p>\u5148\u6765\u770b\u770b\u963b\u585e I/O\uff0c\u5f53\u7528\u6237\u7a0b\u5e8f\u6267\u884c <code>read</code> \uff0c\u7ebf\u7a0b\u4f1a\u88ab\u963b\u585e\uff0c\u4e00\u76f4\u7b49\u5230\u5185\u6838\u6570\u636e\u51c6\u5907\u597d\uff0c\u5e76\u628a\u6570\u636e\u4ece\u5185\u6838\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u5e94\u7528\u7a0b\u5e8f\u7684\u7f13\u51b2\u533a\u4e2d\uff0c\u5f53\u62f7\u8d1d\u8fc7\u7a0b\u5b8c\u6210\uff0c<code>read</code> \u624d\u4f1a\u8fd4\u56de\u3002</p> <p>\u6ce8\u610f\uff0c\u963b\u585e\u7b49\u5f85\u7684\u662f\u300c\u5185\u6838\u6570\u636e\u51c6\u5907\u597d\u300d\u548c\u300c\u6570\u636e\u4ece\u5185\u6838\u6001\u62f7\u8d1d\u5230\u7528\u6237\u6001\u300d\u8fd9\u4e24\u4e2a\u8fc7\u7a0b\u3002\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u77e5\u9053\u4e86\u963b\u585e I/O\uff0c\u6765\u770b\u770b\u975e\u963b\u585e I/O\uff0c\u975e\u963b\u585e\u7684 read \u8bf7\u6c42\u5728\u6570\u636e\u672a\u51c6\u5907\u597d\u7684\u60c5\u51b5\u4e0b\u7acb\u5373\u8fd4\u56de\uff0c\u53ef\u4ee5\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\uff0c\u6b64\u65f6\u5e94\u7528\u7a0b\u5e8f\u4e0d\u65ad\u8f6e\u8be2\u5185\u6838\uff0c\u76f4\u5230\u6570\u636e\u51c6\u5907\u597d\uff0c\u5185\u6838\u5c06\u6570\u636e\u62f7\u8d1d\u5230\u5e94\u7528\u7a0b\u5e8f\u7f13\u51b2\u533a\uff0c<code>read</code> \u8c03\u7528\u624d\u53ef\u4ee5\u83b7\u53d6\u5230\u7ed3\u679c\u3002\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6ce8\u610f\uff0c\u8fd9\u91cc\u6700\u540e\u4e00\u6b21 read \u8c03\u7528\uff0c\u83b7\u53d6\u6570\u636e\u7684\u8fc7\u7a0b\uff0c\u662f\u4e00\u4e2a\u540c\u6b65\u7684\u8fc7\u7a0b\uff0c\u662f\u9700\u8981\u7b49\u5f85\u7684\u8fc7\u7a0b\u3002\u8fd9\u91cc\u7684\u540c\u6b65\u6307\u7684\u662f\u5185\u6838\u6001\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u7a0b\u5e8f\u7684\u7f13\u5b58\u533a\u8fd9\u4e2a\u8fc7\u7a0b\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c socket \u8bbe\u7f6e\u4e86 <code>O_NONBLOCK</code> \u6807\u5fd7\uff0c\u90a3\u4e48\u5c31\u8868\u793a\u4f7f\u7528\u7684\u662f\u975e\u963b\u585e I/O \u7684\u65b9\u5f0f\u8bbf\u95ee\uff0c\u800c\u4e0d\u505a\u4efb\u4f55\u8bbe\u7f6e\u7684\u8bdd\uff0c\u9ed8\u8ba4\u662f\u963b\u585e I/O\u3002</p> <p>\u56e0\u6b64\uff0c\u65e0\u8bba read \u548c send \u662f\u963b\u585e I/O\uff0c\u8fd8\u662f\u975e\u963b\u585e I/O \u90fd\u662f\u540c\u6b65\u8c03\u7528\u3002\u56e0\u4e3a\u5728 read \u8c03\u7528\u65f6\uff0c\u5185\u6838\u5c06\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\u7684\u8fc7\u7a0b\u90fd\u662f\u9700\u8981\u7b49\u5f85\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u540c\u6b65\u7684\uff0c\u5982\u679c\u5185\u6838\u5b9e\u73b0\u7684\u62f7\u8d1d\u6548\u7387\u4e0d\u9ad8\uff0cread \u8c03\u7528\u5c31\u4f1a\u5728\u8fd9\u4e2a\u540c\u6b65\u8fc7\u7a0b\u4e2d\u7b49\u5f85\u6bd4\u8f83\u957f\u7684\u65f6\u95f4\u3002</p> <p>\u800c\u771f\u6b63\u7684\u5f02\u6b65 I/O \u662f\u300c\u5185\u6838\u6570\u636e\u51c6\u5907\u597d\u300d\u548c\u300c\u6570\u636e\u4ece\u5185\u6838\u6001\u62f7\u8d1d\u5230\u7528\u6237\u6001\u300d\u8fd9\u4e24\u4e2a\u8fc7\u7a0b\u90fd\u4e0d\u7528\u7b49\u5f85\u3002</p> <p>\u5f53\u6211\u4eec\u53d1\u8d77 <code>aio_read</code> \uff08\u5f02\u6b65 I/O\uff09\u4e4b\u540e\uff0c\u5c31\u7acb\u5373\u8fd4\u56de\uff0c\u5185\u6838\u81ea\u52a8\u5c06\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u8fd9\u4e2a\u62f7\u8d1d\u8fc7\u7a0b\u540c\u6837\u662f\u5f02\u6b65\u7684\uff0c\u5185\u6838\u81ea\u52a8\u5b8c\u6210\u7684\uff0c\u548c\u524d\u9762\u7684\u540c\u6b65\u64cd\u4f5c\u4e0d\u4e00\u6837\uff0c\u5e94\u7528\u7a0b\u5e8f\u5e76\u4e0d\u9700\u8981\u4e3b\u52a8\u53d1\u8d77\u62f7\u8d1d\u52a8\u4f5c\u3002\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e3e\u4e2a\u4f60\u53bb\u996d\u5802\u5403\u996d\u7684\u4f8b\u5b50\uff0c\u4f60\u597d\u6bd4\u5e94\u7528\u7a0b\u5e8f\uff0c\u996d\u5802\u597d\u6bd4\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u963b\u585e I/O \u597d\u6bd4\uff0c\u4f60\u53bb\u996d\u5802\u5403\u996d\uff0c\u4f46\u662f\u996d\u5802\u7684\u83dc\u8fd8\u6ca1\u505a\u597d\uff0c\u7136\u540e\u4f60\u5c31\u4e00\u76f4\u5728\u90a3\u91cc\u7b49\u554a\u7b49\uff0c\u7b49\u4e86\u597d\u957f\u4e00\u6bb5\u65f6\u95f4\u7ec8\u4e8e\u7b49\u5230\u996d\u5802\u963f\u59e8\u628a\u83dc\u7aef\u4e86\u51fa\u6765\uff08\u6570\u636e\u51c6\u5907\u7684\u8fc7\u7a0b\uff09\uff0c\u4f46\u662f\u4f60\u8fd8\u5f97\u7ee7\u7eed\u7b49\u963f\u59e8\u628a\u83dc\uff08\u5185\u6838\u7a7a\u95f4\uff09\u6253\u5230\u4f60\u7684\u996d\u76d2\u91cc\uff08\u7528\u6237\u7a7a\u95f4\uff09\uff0c\u7ecf\u5386\u5b8c\u8fd9\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u4f60\u624d\u53ef\u4ee5\u79bb\u5f00\u3002</p> <p>\u975e\u963b\u585e I/O \u597d\u6bd4\uff0c\u4f60\u53bb\u4e86\u996d\u5802\uff0c\u95ee\u963f\u59e8\u83dc\u505a\u597d\u4e86\u6ca1\u6709\uff0c\u963f\u59e8\u544a\u8bc9\u4f60\u6ca1\uff0c\u4f60\u5c31\u79bb\u5f00\u4e86\uff0c\u8fc7\u51e0\u5341\u5206\u949f\uff0c\u4f60\u53c8\u6765\u996d\u5802\u95ee\u963f\u59e8\uff0c\u963f\u59e8\u8bf4\u505a\u597d\u4e86\uff0c\u4e8e\u662f\u963f\u59e8\u5e2e\u4f60\u628a\u83dc\u6253\u5230\u4f60\u7684\u996d\u76d2\u91cc\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f60\u662f\u5f97\u7b49\u5f85\u7684\u3002</p> <p>\u5f02\u6b65 I/O \u597d\u6bd4\uff0c\u4f60\u8ba9\u996d\u5802\u963f\u59e8\u5c06\u83dc\u505a\u597d\u5e76\u628a\u83dc\u6253\u5230\u996d\u76d2\u91cc\u540e\uff0c\u628a\u996d\u76d2\u9001\u5230\u4f60\u9762\u524d\uff0c\u6574\u4e2a\u8fc7\u7a0b\u4f60\u90fd\u4e0d\u9700\u8981\u4efb\u4f55\u7b49\u5f85\u3002</p> <p>\u5f88\u660e\u663e\uff0c\u5f02\u6b65 I/O \u6bd4\u540c\u6b65 I/O \u6027\u80fd\u66f4\u597d\uff0c\u56e0\u4e3a\u5f02\u6b65 I/O \u5728\u300c\u5185\u6838\u6570\u636e\u51c6\u5907\u597d\u300d\u548c\u300c\u6570\u636e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\u300d\u8fd9\u4e24\u4e2a\u8fc7\u7a0b\u90fd\u4e0d\u7528\u7b49\u5f85\u3002</p> <p>Proactor \u6b63\u662f\u91c7\u7528\u4e86\u5f02\u6b65 I/O \u6280\u672f\uff0c\u6240\u4ee5\u88ab\u79f0\u4e3a\u5f02\u6b65\u7f51\u7edc\u6a21\u578b\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u518d\u6765\u7406\u89e3 Reactor \u548c Proactor \u7684\u533a\u522b\uff0c\u5c31\u6bd4\u8f83\u6e05\u6670\u4e86\u3002</p> <ul> <li>Reactor \u662f\u975e\u963b\u585e\u540c\u6b65\u7f51\u7edc\u6a21\u5f0f\uff0c\u611f\u77e5\u7684\u662f\u5c31\u7eea\u53ef\u8bfb\u5199\u4e8b\u4ef6\u3002\u5728\u6bcf\u6b21\u611f\u77e5\u5230\u6709\u4e8b\u4ef6\u53d1\u751f\uff08\u6bd4\u5982\u53ef\u8bfb\u5c31\u7eea\u4e8b\u4ef6\uff09\u540e\uff0c\u5c31\u9700\u8981\u5e94\u7528\u8fdb\u7a0b\u4e3b\u52a8\u8c03\u7528 read \u65b9\u6cd5\u6765\u5b8c\u6210\u6570\u636e\u7684\u8bfb\u53d6\uff0c\u4e5f\u5c31\u662f\u8981\u5e94\u7528\u8fdb\u7a0b\u4e3b\u52a8\u5c06 socket \u63a5\u6536\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u8bfb\u5230\u5e94\u7528\u8fdb\u7a0b\u5185\u5b58\u4e2d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u540c\u6b65\u7684\uff0c\u8bfb\u53d6\u5b8c\u6570\u636e\u540e\u5e94\u7528\u8fdb\u7a0b\u624d\u80fd\u5904\u7406\u6570\u636e\u3002</li> <li>Proactor \u662f\u5f02\u6b65\u7f51\u7edc\u6a21\u5f0f\uff0c\u611f\u77e5\u7684\u662f\u5df2\u5b8c\u6210\u7684\u8bfb\u5199\u4e8b\u4ef6\u3002\u5728\u53d1\u8d77\u5f02\u6b65\u8bfb\u5199\u8bf7\u6c42\u65f6\uff0c\u9700\u8981\u4f20\u5165\u6570\u636e\u7f13\u51b2\u533a\u7684\u5730\u5740\uff08\u7528\u6765\u5b58\u653e\u7ed3\u679c\u6570\u636e\uff09\u7b49\u4fe1\u606f\uff0c\u8fd9\u6837\u7cfb\u7edf\u5185\u6838\u624d\u53ef\u4ee5\u81ea\u52a8\u5e2e\u6211\u4eec\u628a\u6570\u636e\u7684\u8bfb\u5199\u5de5\u4f5c\u5b8c\u6210\uff0c\u8fd9\u91cc\u7684\u8bfb\u5199\u5de5\u4f5c\u5168\u7a0b\u7531\u64cd\u4f5c\u7cfb\u7edf\u6765\u505a\uff0c\u5e76\u4e0d\u9700\u8981\u50cf Reactor \u90a3\u6837\u8fd8\u9700\u8981\u5e94\u7528\u8fdb\u7a0b\u4e3b\u52a8\u53d1\u8d77 read/write \u6765\u8bfb\u5199\u6570\u636e\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5b8c\u6210\u8bfb\u5199\u5de5\u4f5c\u540e\uff0c\u5c31\u4f1a\u901a\u77e5\u5e94\u7528\u8fdb\u7a0b\u76f4\u63a5\u5904\u7406\u6570\u636e\u3002</li> </ul> <p>\u56e0\u6b64\uff0cReactor \u53ef\u4ee5\u7406\u89e3\u4e3a\u300c\u6765\u4e86\u4e8b\u4ef6\u64cd\u4f5c\u7cfb\u7edf\u901a\u77e5\u5e94\u7528\u8fdb\u7a0b\uff0c\u8ba9\u5e94\u7528\u8fdb\u7a0b\u6765\u5904\u7406\u300d\uff0c\u800c Proactor \u53ef\u4ee5\u7406\u89e3\u4e3a\u300c\u6765\u4e86\u4e8b\u4ef6\u64cd\u4f5c\u7cfb\u7edf\u6765\u5904\u7406\uff0c\u5904\u7406\u5b8c\u518d\u901a\u77e5\u5e94\u7528\u8fdb\u7a0b\u300d\u3002\u8fd9\u91cc\u7684\u300c\u4e8b\u4ef6\u300d\u5c31\u662f\u6709\u65b0\u8fde\u63a5\u3001\u6709\u6570\u636e\u53ef\u8bfb\u3001\u6709\u6570\u636e\u53ef\u5199\u7684\u8fd9\u4e9b I/O \u4e8b\u4ef6\uff0c\u8fd9\u91cc\u7684\u300c\u5904\u7406\u300d\u5305\u542b\u4ece\u9a71\u52a8\u8bfb\u53d6\u5230\u5185\u6838\u4ee5\u53ca\u4ece\u5185\u6838\u8bfb\u53d6\u5230\u7528\u6237\u7a7a\u95f4\u3002</p> <p>\u4e3e\u4e2a\u5b9e\u9645\u751f\u6d3b\u4e2d\u7684\u4f8b\u5b50\uff0cReactor \u6a21\u5f0f\u5c31\u662f\u5feb\u9012\u5458\u5728\u697c\u4e0b\uff0c\u7ed9\u4f60\u6253\u7535\u8bdd\u544a\u8bc9\u4f60\u5feb\u9012\u5230\u4f60\u5bb6\u5c0f\u533a\u4e86\uff0c\u4f60\u9700\u8981\u81ea\u5df1\u4e0b\u697c\u6765\u62ff\u5feb\u9012\u3002\u800c\u5728 Proactor \u6a21\u5f0f\u4e0b\uff0c\u5feb\u9012\u5458\u76f4\u63a5\u5c06\u5feb\u9012\u9001\u5230\u4f60\u5bb6\u95e8\u53e3\uff0c\u7136\u540e\u901a\u77e5\u4f60\u3002</p> <p>\u65e0\u8bba\u662f Reactor\uff0c\u8fd8\u662f Proactor\uff0c\u90fd\u662f\u4e00\u79cd\u57fa\u4e8e\u300c\u4e8b\u4ef6\u5206\u53d1\u300d\u7684\u7f51\u7edc\u7f16\u7a0b\u6a21\u5f0f\uff0c\u533a\u522b\u5728\u4e8e Reactor \u6a21\u5f0f\u662f\u57fa\u4e8e\u300c\u5f85\u5b8c\u6210\u300d\u7684 I/O \u4e8b\u4ef6\uff0c\u800c Proactor \u6a21\u5f0f\u5219\u662f\u57fa\u4e8e\u300c\u5df2\u5b8c\u6210\u300d\u7684 I/O \u4e8b\u4ef6\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u4e00\u8d77\u770b\u770b Proactor \u6a21\u5f0f\u7684\u793a\u610f\u56fe\uff1a</p> <p></p> <p>\u4ecb\u7ecd\u4e00\u4e0b Proactor \u6a21\u5f0f\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <ul> <li>Proactor Initiator \u8d1f\u8d23\u521b\u5efa Proactor \u548c Handler \u5bf9\u8c61\uff0c\u5e76\u5c06 Proactor \u548c Handler \u90fd\u901a\u8fc7    Asynchronous Operation Processor \u6ce8\u518c\u5230\u5185\u6838\uff1b</li> <li>Asynchronous Operation Processor \u8d1f\u8d23\u5904\u7406\u6ce8\u518c\u8bf7\u6c42\uff0c\u5e76\u5904\u7406 I/O \u64cd\u4f5c\uff1b</li> <li>Asynchronous Operation Processor \u5b8c\u6210 I/O \u64cd\u4f5c\u540e\u901a\u77e5 Proactor\uff1b</li> <li>Proactor \u6839\u636e\u4e0d\u540c\u7684\u4e8b\u4ef6\u7c7b\u578b\u56de\u8c03\u4e0d\u540c\u7684 Handler \u8fdb\u884c\u4e1a\u52a1\u5904\u7406\uff1b</li> <li>Handler \u5b8c\u6210\u4e1a\u52a1\u5904\u7406\uff1b</li> </ul> <p>\u53ef\u60dc\u7684\u662f\uff0c\u5728 Linux \u4e0b\u7684\u5f02\u6b65 I/O \u662f\u4e0d\u5b8c\u5584\u7684\uff0c <code>aio</code> \u7cfb\u5217\u51fd\u6570\u662f\u7531 POSIX \u5b9a\u4e49\u7684\u5f02\u6b65\u64cd\u4f5c\u63a5\u53e3\uff0c\u4e0d\u662f\u771f\u6b63\u7684\u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u652f\u6301\u7684\uff0c\u800c\u662f\u5728\u7528\u6237\u7a7a\u95f4\u6a21\u62df\u51fa\u6765\u7684\u5f02\u6b65\uff0c\u5e76\u4e14\u4ec5\u4ec5\u652f\u6301\u57fa\u4e8e\u672c\u5730\u6587\u4ef6\u7684 aio \u5f02\u6b65\u64cd\u4f5c\uff0c\u7f51\u7edc\u7f16\u7a0b\u4e2d\u7684 socket \u662f\u4e0d\u652f\u6301\u7684\uff0c\u8fd9\u4e5f\u4f7f\u5f97\u57fa\u4e8e Linux \u7684\u9ad8\u6027\u80fd\u7f51\u7edc\u7a0b\u5e8f\u90fd\u662f\u4f7f\u7528 Reactor \u65b9\u6848\u3002</p> <p>\u800c Windows \u91cc\u5b9e\u73b0\u4e86\u4e00\u5957\u5b8c\u6574\u7684\u652f\u6301 socket \u7684\u5f02\u6b65\u7f16\u7a0b\u63a5\u53e3\uff0c\u8fd9\u5957\u63a5\u53e3\u5c31\u662f <code>IOCP</code>\uff0c\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u7ea7\u522b\u5b9e\u73b0\u7684\u5f02\u6b65 I/O\uff0c\u771f\u6b63\u610f\u4e49\u4e0a\u5f02\u6b65 I/O\uff0c\u56e0\u6b64\u5728 Windows \u91cc\u5b9e\u73b0\u9ad8\u6027\u80fd\u7f51\u7edc\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528\u6548\u7387\u66f4\u9ad8\u7684 Proactor \u65b9\u6848\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/reactor/#_2","title":"\u603b\u7ed3","text":"<p>\u5e38\u89c1\u7684 Reactor \u5b9e\u73b0\u65b9\u6848\u6709\u4e09\u79cd\u3002</p> <p>\u7b2c\u4e00\u79cd\u65b9\u6848\u5355 Reactor \u5355\u8fdb\u7a0b / \u7ebf\u7a0b\uff0c\u4e0d\u7528\u8003\u8651\u8fdb\u7a0b\u95f4\u901a\u4fe1\u4ee5\u53ca\u6570\u636e\u540c\u6b65\u7684\u95ee\u9898\uff0c\u56e0\u6b64\u5b9e\u73b0\u8d77\u6765\u6bd4\u8f83\u7b80\u5355\uff0c\u8fd9\u79cd\u65b9\u6848\u7684\u7f3a\u9677\u5728\u4e8e\u65e0\u6cd5\u5145\u5206\u5229\u7528\u591a\u6838 CPU\uff0c\u800c\u4e14\u5904\u7406\u4e1a\u52a1\u903b\u8f91\u7684\u65f6\u95f4\u4e0d\u80fd\u592a\u957f\uff0c\u5426\u5219\u4f1a\u5ef6\u8fdf\u54cd\u5e94\uff0c\u6240\u4ee5\u4e0d\u9002\u7528\u4e8e\u8ba1\u7b97\u673a\u5bc6\u96c6\u578b\u7684\u573a\u666f\uff0c\u9002\u7528\u4e8e\u4e1a\u52a1\u5904\u7406\u5feb\u901f\u7684\u573a\u666f\uff0c\u6bd4\u5982 Redis \u91c7\u7528\u7684\u662f\u5355 Reactor \u5355\u8fdb\u7a0b\u7684\u65b9\u6848\u3002</p> <p>\u7b2c\u4e8c\u79cd\u65b9\u6848\u5355 Reactor \u591a\u7ebf\u7a0b\uff0c\u901a\u8fc7\u591a\u7ebf\u7a0b\u7684\u65b9\u5f0f\u89e3\u51b3\u4e86\u65b9\u6848\u4e00\u7684\u7f3a\u9677\uff0c\u4f46\u5b83\u79bb\u9ad8\u5e76\u53d1\u8fd8\u5dee\u4e00\u70b9\u8ddd\u79bb\uff0c\u5dee\u5728\u53ea\u6709\u4e00\u4e2a Reactor \u5bf9\u8c61\u6765\u627f\u62c5\u6240\u6709\u4e8b\u4ef6\u7684\u76d1\u542c\u548c\u54cd\u5e94\uff0c\u800c\u4e14\u53ea\u5728\u4e3b\u7ebf\u7a0b\u4e2d\u8fd0\u884c\uff0c\u5728\u9762\u5bf9\u77ac\u95f4\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u65f6\uff0c\u5bb9\u6613\u6210\u4e3a\u6027\u80fd\u7684\u74f6\u9888\u7684\u5730\u65b9\u3002</p> <p>\u7b2c\u4e09\u79cd\u65b9\u6848\u591a Reactor \u591a\u8fdb\u7a0b / \u7ebf\u7a0b\uff0c\u901a\u8fc7\u591a\u4e2a Reactor \u6765\u89e3\u51b3\u4e86\u65b9\u6848\u4e8c\u7684\u7f3a\u9677\uff0c\u4e3b Reactor \u53ea\u8d1f\u8d23\u76d1\u542c\u4e8b\u4ef6\uff0c\u54cd\u5e94\u4e8b\u4ef6\u7684\u5de5\u4f5c\u4ea4\u7ed9\u4e86\u4ece Reactor\uff0cNetty \u548c Memcache \u90fd\u91c7\u7528\u4e86\u300c\u591a Reactor \u591a\u7ebf\u7a0b\u300d\u7684\u65b9\u6848\uff0cNginx \u5219\u91c7\u7528\u4e86\u7c7b\u4f3c\u4e8e\u300c\u591a Reactor \u591a\u8fdb\u7a0b\u300d\u7684\u65b9\u6848\u3002</p> <p>Reactor \u53ef\u4ee5\u7406\u89e3\u4e3a\u300c\u6765\u4e86\u4e8b\u4ef6\u64cd\u4f5c\u7cfb\u7edf\u901a\u77e5\u5e94\u7528\u8fdb\u7a0b\uff0c\u8ba9\u5e94\u7528\u8fdb\u7a0b\u6765\u5904\u7406\u300d\uff0c\u800c Proactor \u53ef\u4ee5\u7406\u89e3\u4e3a\u300c\u6765\u4e86\u4e8b\u4ef6\u64cd\u4f5c\u7cfb\u7edf\u6765\u5904\u7406\uff0c\u5904\u7406\u5b8c\u518d\u901a\u77e5\u5e94\u7528\u8fdb\u7a0b\u300d\u3002</p> <p>\u56e0\u6b64\uff0c\u771f\u6b63\u7684\u5927\u6740\u5668\u8fd8\u662f Proactor\uff0c\u5b83\u662f\u91c7\u7528\u5f02\u6b65 I/O \u5b9e\u73b0\u7684\u5f02\u6b65\u7f51\u7edc\u6a21\u578b\uff0c\u611f\u77e5\u7684\u662f\u5df2\u5b8c\u6210\u7684\u8bfb\u5199\u4e8b\u4ef6\uff0c\u800c\u4e0d\u9700\u8981\u50cf Reactor \u611f\u77e5\u5230\u4e8b\u4ef6\u540e\uff0c\u8fd8\u9700\u8981\u8c03\u7528 read \u6765\u4ece\u5185\u6838\u4e2d\u83b7\u53d6\u6570\u636e\u3002</p> <p>\u4e0d\u8fc7\uff0c\u65e0\u8bba\u662f Reactor\uff0c\u8fd8\u662f Proactor\uff0c\u90fd\u662f\u4e00\u79cd\u57fa\u4e8e\u300c\u4e8b\u4ef6\u5206\u53d1\u300d\u7684\u7f51\u7edc\u7f16\u7a0b\u6a21\u5f0f\uff0c\u533a\u522b\u5728\u4e8e Reactor \u6a21\u5f0f\u662f\u57fa\u4e8e\u300c\u5f85\u5b8c\u6210\u300d\u7684 I/O \u4e8b\u4ef6\uff0c\u800c Proactor \u6a21\u5f0f\u5219\u662f\u57fa\u4e8e\u300c\u5df2\u5b8c\u6210\u300d\u7684 I/O \u4e8b\u4ef6\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/reactor/#_3","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/","title":"9.2 I/O \u591a\u8def\u590d\u7528\uff1aselect/poll/epoll","text":"<p>\u6211\u4eec\u4ee5\u6700\u7b80\u5355 socket \u7f51\u7edc\u6a21\u578b\uff0c\u4e00\u6b65\u4e00\u6b65\u7684\u8fc7\u6e21\u5230 I/O \u591a\u8def\u590d\u7528\u3002</p> <p>\u4f46\u6211\u4e0d\u4f1a\u5177\u4f53\u7ec6\u8282\u8bf4\u5230\u6bcf\u4e2a\u7cfb\u7edf\u8c03\u7528\u7684\u53c2\u6570\uff0c\u8fd9\u65b9\u9762\u4e66\u4e0a\u80af\u5b9a\u6bd4\u6211\u8bf4\u7684\u8be6\u7ec6\u3002</p> <p>\u597d\u4e86\uff0c\u53d1\u8f66\uff01</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/#socket","title":"\u6700\u57fa\u672c\u7684 Socket \u6a21\u578b","text":"<p>\u8981\u60f3\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u80fd\u5728\u7f51\u7edc\u4e2d\u901a\u4fe1\uff0c\u90a3\u5fc5\u987b\u5f97\u4f7f\u7528 Socket \u7f16\u7a0b\uff0c\u5b83\u662f\u8fdb\u7a0b\u95f4\u901a\u4fe1\u91cc\u6bd4\u8f83\u7279\u522b\u7684\u65b9\u5f0f\uff0c\u7279\u522b\u4e4b\u5904\u5728\u4e8e\u5b83\u662f\u53ef\u4ee5\u8de8\u4e3b\u673a\u95f4\u901a\u4fe1\u3002</p> <p>Socket \u7684\u4e2d\u6587\u540d\u53eb\u4f5c\u63d2\u53e3\uff0c\u4e4d\u4e00\u770b\u8fd8\u633a\u8ff7\u60d1\u7684\u3002\u4e8b\u5b9e\u4e0a\uff0c\u53cc\u65b9\u8981\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\u524d\uff0c\u5404\u81ea\u5f97\u521b\u5efa\u4e00\u4e2a Socket\uff0c\u8fd9\u76f8\u5f53\u4e8e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u90fd\u5f00\u4e86\u4e00\u4e2a\u201c\u53e3\u5b50\u201d\uff0c\u53cc\u65b9\u8bfb\u53d6\u548c\u53d1\u9001\u6570\u636e\u7684\u65f6\u5019\uff0c\u90fd\u901a\u8fc7\u8fd9\u4e2a\u201c\u53e3\u5b50\u201d\u3002\u8fd9\u6837\u4e00\u770b\uff0c\u662f\u4e0d\u662f\u89c9\u5f97\u5f88\u50cf\u5f04\u4e86\u4e00\u6839\u7f51\u7ebf\uff0c\u4e00\u5934\u63d2\u5728\u5ba2\u6237\u7aef\uff0c\u4e00\u5934\u63d2\u5728\u670d\u52a1\u7aef\uff0c\u7136\u540e\u8fdb\u884c\u901a\u4fe1\u3002</p> <p>\u521b\u5efa Socket \u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6307\u5b9a\u7f51\u7edc\u5c42\u4f7f\u7528\u7684\u662f IPv4 \u8fd8\u662f IPv6\uff0c\u4f20\u8f93\u5c42\u4f7f\u7528\u7684\u662f TCP \u8fd8\u662f UDP\u3002</p> <p>UDP \u7684 Socket \u7f16\u7a0b\u76f8\u5bf9\u7b80\u5355\u4e9b\uff0c\u8fd9\u91cc\u6211\u4eec\u53ea\u4ecb\u7ecd\u57fa\u4e8e TCP \u7684 Socket \u7f16\u7a0b\u3002</p> <p>\u670d\u52a1\u5668\u7684\u7a0b\u5e8f\u8981\u5148\u8dd1\u8d77\u6765\uff0c\u7136\u540e\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u548c\u6570\u636e\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u670d\u52a1\u7aef\u7684 Socket \u7f16\u7a0b\u8fc7\u7a0b\u662f\u600e\u6837\u7684\u3002</p> <p>\u670d\u52a1\u7aef\u9996\u5148\u8c03\u7528 <code>socket()</code> \u51fd\u6570\uff0c\u521b\u5efa\u7f51\u7edc\u534f\u8bae\u4e3a IPv4\uff0c\u4ee5\u53ca\u4f20\u8f93\u534f\u8bae\u4e3a TCP \u7684 Socket\uff0c\u63a5\u7740\u8c03\u7528 <code>bind()</code> \u51fd\u6570\uff0c\u7ed9\u8fd9\u4e2a Socket \u7ed1\u5b9a\u4e00\u4e2a IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u7ed1\u5b9a\u8fd9\u4e24\u4e2a\u7684\u76ee\u7684\u662f\u4ec0\u4e48\uff1f</p> <ul> <li>\u7ed1\u5b9a\u7aef\u53e3\u7684\u76ee\u7684\uff1a\u5f53\u5185\u6838\u6536\u5230 TCP \u62a5\u6587\uff0c\u901a\u8fc7 TCP \u5934\u91cc\u9762\u7684\u7aef\u53e3\u53f7\uff0c\u6765\u627e\u5230\u6211\u4eec\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u7136\u540e\u628a\u6570\u636e\u4f20\u9012\u7ed9\u6211\u4eec\u3002</li> <li>\u7ed1\u5b9a IP \u5730\u5740\u7684\u76ee\u7684\uff1a\u4e00\u53f0\u673a\u5668\u662f\u53ef\u4ee5\u6709\u591a\u4e2a\u7f51\u5361\u7684\uff0c\u6bcf\u4e2a\u7f51\u5361\u90fd\u6709\u5bf9\u5e94\u7684 IP \u5730\u5740\uff0c\u5f53\u7ed1\u5b9a\u4e00\u4e2a\u7f51\u5361\u65f6\uff0c\u5185\u6838\u5728\u6536\u5230\u8be5\u7f51\u5361\u4e0a\u7684\u5305\uff0c\u624d\u4f1a\u53d1\u7ed9\u6211\u4eec\uff1b</li> </ul> <p>\u7ed1\u5b9a\u5b8c IP \u5730\u5740\u548c\u7aef\u53e3\u540e\uff0c\u5c31\u53ef\u4ee5\u8c03\u7528 <code>listen()</code> \u51fd\u6570\u8fdb\u884c\u76d1\u542c\uff0c\u6b64\u65f6\u5bf9\u5e94 TCP \u72b6\u6001\u56fe\u4e2d\u7684 <code>listen</code>\uff0c\u5982\u679c\u6211\u4eec\u8981\u5224\u65ad\u670d\u52a1\u5668\u4e2d\u4e00\u4e2a\u7f51\u7edc\u7a0b\u5e8f\u6709\u6ca1\u6709\u542f\u52a8\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>netstat</code> \u547d\u4ee4\u67e5\u770b\u5bf9\u5e94\u7684\u7aef\u53e3\u53f7\u662f\u5426\u6709\u88ab\u76d1\u542c\u3002</p> <p>\u670d\u52a1\u7aef\u8fdb\u5165\u4e86\u76d1\u542c\u72b6\u6001\u540e\uff0c\u901a\u8fc7\u8c03\u7528 <code>accept()</code> \u51fd\u6570\uff0c\u6765\u4ece\u5185\u6838\u83b7\u53d6\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\uff0c\u5982\u679c\u6ca1\u6709\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u5219\u4f1a\u963b\u585e\u7b49\u5f85\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u5230\u6765\u3002</p> <p>\u90a3\u5ba2\u6237\u7aef\u662f\u600e\u4e48\u53d1\u8d77\u8fde\u63a5\u7684\u5462\uff1f\u5ba2\u6237\u7aef\u5728\u521b\u5efa\u597d Socket \u540e\uff0c\u8c03\u7528 <code>connect()</code> \u51fd\u6570\u53d1\u8d77\u8fde\u63a5\uff0c\u8be5\u51fd\u6570\u7684\u53c2\u6570\u8981\u6307\u660e\u670d\u52a1\u7aef\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\uff0c\u7136\u540e\u4e07\u4f17\u671f\u5f85\u7684 TCP \u4e09\u6b21\u63e1\u624b\u5c31\u5f00\u59cb\u4e86\u3002</p> <p>\u5728 TCP \u8fde\u63a5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u670d\u52a1\u5668\u7684\u5185\u6838\u5b9e\u9645\u4e0a\u4e3a\u6bcf\u4e2a Socket \u7ef4\u62a4\u4e86\u4e24\u4e2a\u961f\u5217\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f\u8fd8\u6ca1\u5b8c\u5168\u5efa\u7acb\u8fde\u63a5\u7684\u961f\u5217\uff0c\u79f0\u4e3a TCP \u534a\u8fde\u63a5\u961f\u5217\uff0c\u8fd9\u4e2a\u961f\u5217\u90fd\u662f\u6ca1\u6709\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\u7684\u8fde\u63a5\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u5904\u4e8e <code>syn_rcvd</code> \u7684\u72b6\u6001\uff1b</li> <li>\u4e00\u4e2a\u662f\u4e00\u4ef6\u5efa\u7acb\u8fde\u63a5\u7684\u961f\u5217\uff0c\u79f0\u4e3a TCP \u5168\u8fde\u63a5\u961f\u5217\uff0c\u8fd9\u4e2a\u961f\u5217\u90fd\u662f\u5b8c\u6210\u4e86\u4e09\u6b21\u63e1\u624b\u7684\u8fde\u63a5\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u5904\u4e8e <code>established</code> \u72b6\u6001\uff1b</li> </ul> <p>\u5f53 TCP \u5168\u8fde\u63a5\u961f\u5217\u4e0d\u4e3a\u7a7a\u540e\uff0c\u670d\u52a1\u7aef\u7684 <code>accept()</code> \u51fd\u6570\uff0c\u5c31\u4f1a\u4ece\u5185\u6838\u4e2d\u7684 TCP \u5168\u8fde\u63a5\u961f\u5217\u91cc\u62ff\u51fa\u4e00\u4e2a\u5df2\u7ecf\u5b8c\u6210\u8fde\u63a5\u7684 Socket \u8fd4\u56de\u5e94\u7528\u7a0b\u5e8f\uff0c\u540e\u7eed\u6570\u636e\u4f20\u8f93\u90fd\u7528\u8fd9\u4e2a Socket\u3002</p> <p>\u6ce8\u610f\uff0c\u76d1\u542c\u7684 Socket \u548c\u771f\u6b63\u7528\u6765\u4f20\u6570\u636e\u7684 Socket \u662f\u4e24\u4e2a\uff1a</p> <ul> <li>\u4e00\u4e2a\u53eb\u4f5c\u76d1\u542c Socket\uff1b</li> <li>\u4e00\u4e2a\u53eb\u4f5c\u5df2\u8fde\u63a5 Socket\uff1b</li> </ul> <p>\u8fde\u63a5\u5efa\u7acb\u540e\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5c31\u5f00\u59cb\u76f8\u4e92\u4f20\u8f93\u6570\u636e\u4e86\uff0c\u53cc\u65b9\u90fd\u53ef\u4ee5\u901a\u8fc7 <code>read()</code> \u548c <code>write()</code> \u51fd\u6570\u6765\u8bfb\u5199\u6570\u636e\u3002</p> <p>\u81f3\u6b64\uff0cTCP \u534f\u8bae\u7684 Socket \u7a0b\u5e8f\u7684\u8c03\u7528\u8fc7\u7a0b\u5c31\u7ed3\u675f\u4e86\uff0c\u6574\u4e2a\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u770b\u5230\u8fd9\uff0c\u4e0d\u77e5\u9053\u4f60\u6709\u6ca1\u6709\u89c9\u5f97\u8bfb\u5199 Socket \u7684\u65b9\u5f0f\uff0c\u597d\u50cf\u8bfb\u5199\u6587\u4ef6\u4e00\u6837\u3002</p> <p>\u662f\u7684\uff0c\u57fa\u4e8e Linux \u4e00\u5207\u7686\u6587\u4ef6\u7684\u7406\u5ff5\uff0c\u5728\u5185\u6838\u4e2d Socket \u4e5f\u662f\u4ee5\u300c\u6587\u4ef6\u300d\u7684\u5f62\u5f0f\u5b58\u5728\u7684\uff0c\u4e5f\u662f\u6709\u5bf9\u5e94\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002</p> <p>PS : \u4e0b\u9762\u4f1a\u8bf4\u5230\u5185\u6838\u91cc\u7684\u6570\u636e\u7ed3\u6784\uff0c\u4e0d\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u8df3\u8fc7\u8fd9\u4e00\u90e8\u5206\uff0c\u4e0d\u4f1a\u5bf9\u540e\u7eed\u7684\u5185\u5bb9\u6709\u5f71\u54cd\u3002</p> <p>\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u4f5c\u7528\u662f\u4ec0\u4e48\uff1f\u6bcf\u4e00\u4e2a\u8fdb\u7a0b\u90fd\u6709\u4e00\u4e2a\u6570\u636e\u7ed3\u6784 <code>task_struct</code>\uff0c\u8be5\u7ed3\u6784\u4f53\u91cc\u6709\u4e00\u4e2a\u6307\u5411\u300c\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u7ec4\u300d\u7684\u6210\u5458\u6307\u9488\u3002\u8be5\u6570\u7ec4\u91cc\u5217\u51fa\u8fd9\u4e2a\u8fdb\u7a0b\u6253\u5f00\u7684\u6240\u6709\u6587\u4ef6\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u6570\u7ec4\u7684\u4e0b\u6807\u662f\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u662f\u4e00\u4e2a\u6574\u6570\uff0c\u800c\u6570\u7ec4\u7684\u5185\u5bb9\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u6307\u5411\u5185\u6838\u4e2d\u6240\u6709\u6253\u5f00\u7684\u6587\u4ef6\u7684\u5217\u8868\uff0c\u4e5f\u5c31\u662f\u8bf4\u5185\u6838\u53ef\u4ee5\u901a\u8fc7\u6587\u4ef6\u63cf\u8ff0\u7b26\u627e\u5230\u5bf9\u5e94\u6253\u5f00\u7684\u6587\u4ef6\u3002</p> <p>\u7136\u540e\u6bcf\u4e2a\u6587\u4ef6\u90fd\u6709\u4e00\u4e2a inode\uff0cSocket \u6587\u4ef6\u7684 inode \u6307\u5411\u4e86\u5185\u6838\u4e2d\u7684 Socket \u7ed3\u6784\uff0c\u5728\u8fd9\u4e2a\u7ed3\u6784\u4f53\u91cc\u6709\u4e24\u4e2a\u961f\u5217\uff0c\u5206\u522b\u662f\u53d1\u9001\u961f\u5217\u548c\u63a5\u6536\u961f\u5217\uff0c\u8fd9\u4e2a\u4e24\u4e2a\u961f\u5217\u91cc\u9762\u4fdd\u5b58\u7684\u662f\u4e00\u4e2a\u4e2a <code>struct sk_buff</code>\uff0c\u7528\u94fe\u8868\u7684\u7ec4\u7ec7\u5f62\u5f0f\u4e32\u8d77\u6765\u3002</p> <p>sk_buff \u53ef\u4ee5\u8868\u793a\u5404\u4e2a\u5c42\u7684\u6570\u636e\u5305\uff0c\u5728\u5e94\u7528\u5c42\u6570\u636e\u5305\u53eb data\uff0c\u5728 TCP \u5c42\u6211\u4eec\u79f0\u4e3a segment\uff0c\u5728 IP \u5c42\u6211\u4eec\u53eb packet\uff0c\u5728\u6570\u636e\u94fe\u8def\u5c42\u79f0\u4e3a frame\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u597d\u5947\uff0c\u4e3a\u4ec0\u4e48\u5168\u90e8\u6570\u636e\u5305\u53ea\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53\u6765\u63cf\u8ff0\u5462\uff1f\u534f\u8bae\u6808\u91c7\u7528\u7684\u662f\u5206\u5c42\u7ed3\u6784\uff0c\u4e0a\u5c42\u5411\u4e0b\u5c42\u4f20\u9012\u6570\u636e\u65f6\u9700\u8981\u589e\u52a0\u5305\u5934\uff0c\u4e0b\u5c42\u5411\u4e0a\u5c42\u6570\u636e\u65f6\u53c8\u9700\u8981\u53bb\u6389\u5305\u5934\uff0c\u5982\u679c\u6bcf\u4e00\u5c42\u90fd\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u90a3\u5728\u5c42\u4e4b\u95f4\u4f20\u9012\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u8981\u53d1\u751f\u591a\u6b21\u62f7\u8d1d\uff0c\u8fd9\u5c06\u5927\u5927\u964d\u4f4e CPU \u6548\u7387\u3002</p> <p>\u4e8e\u662f\uff0c\u4e3a\u4e86\u5728\u5c42\u7ea7\u4e4b\u95f4\u4f20\u9012\u6570\u636e\u65f6\uff0c\u4e0d\u53d1\u751f\u62f7\u8d1d\uff0c\u53ea\u7528 sk_buff \u4e00\u4e2a\u7ed3\u6784\u4f53\u6765\u63cf\u8ff0\u6240\u6709\u7684\u7f51\u7edc\u5305\uff0c\u90a3\u5b83\u662f\u5982\u4f55\u505a\u5230\u7684\u5462\uff1f\u662f\u901a\u8fc7\u8c03\u6574 sk_buff \u4e2d <code>data</code> \u7684\u6307\u9488\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5f53\u63a5\u6536\u62a5\u6587\u65f6\uff0c\u4ece\u7f51\u5361\u9a71\u52a8\u5f00\u59cb\uff0c\u901a\u8fc7\u534f\u8bae\u6808\u5c42\u5c42\u5f80\u4e0a\u4f20\u9001\u6570\u636e\u62a5\uff0c\u901a\u8fc7\u589e\u52a0 skb-&gt;data \u7684\u503c\uff0c\u6765\u9010\u6b65\u5265\u79bb\u534f\u8bae\u9996\u90e8\u3002</li> <li>\u5f53\u8981\u53d1\u9001\u62a5\u6587\u65f6\uff0c\u521b\u5efa sk_buff \u7ed3\u6784\u4f53\uff0c\u6570\u636e\u7f13\u5b58\u533a\u7684\u5934\u90e8\u9884\u7559\u8db3\u591f\u7684\u7a7a\u95f4\uff0c\u7528\u6765\u586b\u5145\u5404\u5c42\u9996\u90e8\uff0c\u5728\u7ecf\u8fc7\u5404\u4e0b\u5c42\u534f\u8bae\u65f6\uff0c\u901a\u8fc7\u51cf\u5c11 skb-&gt;data \u7684\u503c\u6765\u589e\u52a0\u534f\u8bae\u9996\u90e8\u3002</li> </ul> <p>\u4f60\u53ef\u4ee5\u4ece\u4e0b\u9762\u8fd9\u5f20\u56fe\u770b\u5230\uff0c\u5f53\u53d1\u9001\u62a5\u6587\u65f6\uff0cdata \u6307\u9488\u7684\u79fb\u52a8\u8fc7\u7a0b\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/#_1","title":"\u5982\u4f55\u670d\u52a1\u66f4\u591a\u7684\u7528\u6237\uff1f","text":"<p>\u524d\u9762\u63d0\u5230\u7684 TCP Socket \u8c03\u7528\u6d41\u7a0b\u662f\u6700\u7b80\u5355\u3001\u6700\u57fa\u672c\u7684\uff0c\u5b83\u57fa\u672c\u53ea\u80fd\u4e00\u5bf9\u4e00\u901a\u4fe1\uff0c\u56e0\u4e3a\u4f7f\u7528\u7684\u662f\u540c\u6b65\u963b\u585e\u7684\u65b9\u5f0f\uff0c\u5f53\u670d\u52a1\u7aef\u5728\u8fd8\u6ca1\u5904\u7406\u5b8c\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u7f51\u7edc I/O \u65f6\uff0c\u6216\u8005 \u8bfb\u5199\u64cd\u4f5c\u53d1\u751f\u963b\u585e\u65f6\uff0c\u5176\u4ed6\u5ba2\u6237\u7aef\u662f\u65e0\u6cd5\u4e0e\u670d\u52a1\u7aef\u8fde\u63a5\u7684\u3002</p> <p>\u53ef\u5982\u679c\u6211\u4eec\u670d\u52a1\u5668\u53ea\u80fd\u670d\u52a1\u4e00\u4e2a\u5ba2\u6237\uff0c\u90a3\u8fd9\u6837\u5c31\u592a\u6d6a\u8d39\u8d44\u6e90\u4e86\uff0c\u4e8e\u662f\u6211\u4eec\u8981\u6539\u8fdb\u8fd9\u4e2a\u7f51\u7edc I/O \u6a21\u578b\uff0c\u4ee5\u652f\u6301\u66f4\u591a\u7684\u5ba2\u6237\u7aef\u3002</p> <p>\u5728\u6539\u8fdb\u7f51\u7edc I/O \u6a21\u578b\u524d\uff0c\u6211\u5148\u6765\u63d0\u4e00\u4e2a\u95ee\u9898\uff0c\u4f60\u77e5\u9053\u670d\u52a1\u5668\u5355\u673a\u7406\u8bba\u6700\u5927\u80fd\u8fde\u63a5\u591a\u5c11\u4e2a\u5ba2\u6237\u7aef\uff1f</p> <p>\u76f8\u4fe1\u4f60\u77e5\u9053 TCP \u8fde\u63a5\u662f\u7531\u56db\u5143\u7ec4\u552f\u4e00\u786e\u8ba4\u7684\uff0c\u8fd9\u4e2a\u56db\u5143\u7ec4\u5c31\u662f\uff1a\u672c\u673a IP, \u672c\u673a\u7aef\u53e3\uff0c\u5bf9\u7aef IP, \u5bf9\u7aef\u7aef\u53e3\u3002</p> <p>\u670d\u52a1\u5668\u4f5c\u4e3a\u670d\u52a1\u65b9\uff0c\u901a\u5e38\u4f1a\u5728\u672c\u5730\u56fa\u5b9a\u76d1\u542c\u4e00\u4e2a\u7aef\u53e3\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002\u56e0\u6b64\u670d\u52a1\u5668\u7684\u672c\u5730 IP \u548c\u7aef\u53e3\u662f\u56fa\u5b9a\u7684\uff0c\u4e8e\u662f\u5bf9\u4e8e\u670d\u52a1\u7aef TCP \u8fde\u63a5\u7684\u56db\u5143\u7ec4\u53ea\u6709\u5bf9\u7aef IP \u548c\u7aef\u53e3\u662f\u4f1a\u53d8\u5316\u7684\uff0c\u6240\u4ee5\u6700\u5927 TCP \u8fde\u63a5\u6570 = \u5ba2\u6237\u7aef IP \u6570 \u00d7 \u5ba2\u6237\u7aef\u7aef\u53e3\u6570\u3002</p> <p>\u5bf9\u4e8e IPv4\uff0c\u5ba2\u6237\u7aef\u7684 IP \u6570\u6700\u591a\u4e3a 2 \u7684 32 \u6b21\u65b9\uff0c\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u6570\u6700\u591a\u4e3a 2 \u7684 16 \u6b21\u65b9\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u7aef\u5355\u673a\u6700\u5927 TCP \u8fde\u63a5\u6570\u7ea6\u4e3a 2 \u7684 48 \u6b21\u65b9\u3002</p> <p>\u8fd9\u4e2a\u7406\u8bba\u503c\u76f8\u5f53\u201c\u4e30\u6ee1\u201d\uff0c\u4f46\u662f\u670d\u52a1\u5668\u80af\u5b9a\u627f\u8f7d\u4e0d\u4e86\u90a3\u4e48\u5927\u7684\u8fde\u63a5\u6570\uff0c\u4e3b\u8981\u4f1a\u53d7\u4e24\u4e2a\u65b9\u9762\u7684\u9650\u5236\uff1a</p> <ul> <li>\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0cSocket \u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u4e5f\u5c31\u4f1a\u5bf9\u5e94\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002\u5728 Linux \u4e0b\uff0c\u5355\u4e2a\u8fdb\u7a0b\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u662f\u6709\u9650\u5236\u7684\uff0c\u6ca1\u6709\u7ecf\u8fc7\u4fee\u6539\u7684\u503c\u4e00\u822c\u90fd\u662f 1024\uff0c\u4e0d\u8fc7\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ulimit \u589e\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u6570\u76ee\uff1b</li> <li>\u7cfb\u7edf\u5185\u5b58\uff0c\u6bcf\u4e2a TCP \u8fde\u63a5\u5728\u5185\u6838\u4e2d\u90fd\u6709\u5bf9\u5e94\u7684\u6570\u636e\u7ed3\u6784\uff0c\u610f\u5473\u7740\u6bcf\u4e2a\u8fde\u63a5\u90fd\u662f\u4f1a\u5360\u7528\u4e00\u5b9a\u5185\u5b58\u7684\uff1b</li> </ul> <p>\u90a3\u5982\u679c\u670d\u52a1\u5668\u7684\u5185\u5b58\u53ea\u6709 2 GB\uff0c\u7f51\u5361\u662f\u5343\u5146\u7684\uff0c\u80fd\u652f\u6301\u5e76\u53d1 1 \u4e07\u8bf7\u6c42\u5417\uff1f</p> <p>\u5e76\u53d1 1 \u4e07\u8bf7\u6c42\uff0c\u4e5f\u5c31\u662f\u7ecf\u5178\u7684 C10K \u95ee\u9898\uff0cC \u662f Client \u5355\u8bcd\u9996\u5b57\u6bcd\u7f29\u5199\uff0cC10K \u5c31\u662f\u5355\u673a\u540c\u65f6\u5904\u7406 1 \u4e07\u4e2a\u8bf7\u6c42\u7684\u95ee\u9898\u3002</p> <p>\u4ece\u786c\u4ef6\u8d44\u6e90\u89d2\u5ea6\u770b\uff0c\u5bf9\u4e8e 2GB \u5185\u5b58\u5343\u5146\u7f51\u5361\u7684\u670d\u52a1\u5668\uff0c\u5982\u679c\u6bcf\u4e2a\u8bf7\u6c42\u5904\u7406\u5360\u7528\u4e0d\u5230 200KB \u7684\u5185\u5b58\u548c 100Kbit \u7684\u7f51\u7edc\u5e26\u5bbd\u5c31\u53ef\u4ee5\u6ee1\u8db3\u5e76\u53d1 1 \u4e07\u4e2a\u8bf7\u6c42\u3002</p> <p>\u4e0d\u8fc7\uff0c\u8981\u60f3\u771f\u6b63\u5b9e\u73b0 C10K \u7684\u670d\u52a1\u5668\uff0c\u8981\u8003\u8651\u7684\u5730\u65b9\u5728\u4e8e\u670d\u52a1\u5668\u7684\u7f51\u7edc I/O \u6a21\u578b\uff0c\u6548\u7387\u4f4e\u7684\u6a21\u578b\uff0c\u4f1a\u52a0\u91cd\u7cfb\u7edf\u5f00\u9500\uff0c\u4ece\u800c\u4f1a\u79bb C10K \u7684\u76ee\u6807\u8d8a\u6765\u8d8a\u8fdc\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/#_2","title":"\u591a\u8fdb\u7a0b\u6a21\u578b","text":"<p>\u57fa\u4e8e\u6700\u539f\u59cb\u7684\u963b\u585e\u7f51\u7edc I/O\uff0c\u5982\u679c\u670d\u52a1\u5668\u8981\u652f\u6301\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u5176\u4e2d\u6bd4\u8f83\u4f20\u7edf\u7684\u65b9\u5f0f\uff0c\u5c31\u662f\u4f7f\u7528\u591a\u8fdb\u7a0b\u6a21\u578b\uff0c\u4e5f\u5c31\u662f\u4e3a\u6bcf\u4e2a\u5ba2\u6237\u7aef\u5206\u914d\u4e00\u4e2a\u8fdb\u7a0b\u6765\u5904\u7406\u8bf7\u6c42\u3002</p> <p>\u670d\u52a1\u5668\u7684\u4e3b\u8fdb\u7a0b\u8d1f\u8d23\u76d1\u542c\u5ba2\u6237\u7684\u8fde\u63a5\uff0c\u4e00\u65e6\u4e0e\u5ba2\u6237\u7aef\u8fde\u63a5\u5b8c\u6210\uff0c<code>accept()</code> \u51fd\u6570\u5c31\u4f1a\u8fd4\u56de\u4e00\u4e2a\u300c\u5df2\u8fde\u63a5 Socket\u300d\uff0c\u8fd9\u65f6\u5c31\u901a\u8fc7 <code>fork()</code> \u51fd\u6570\u521b\u5efa\u4e00\u4e2a\u5b50\u8fdb\u7a0b\uff0c\u5b9e\u9645\u4e0a\u5c31\u628a\u7236\u8fdb\u7a0b\u6240\u6709\u76f8\u5173\u7684\u4e1c\u897f\u90fd\u590d\u5236\u4e00\u4efd\uff0c\u5305\u62ec\u6587\u4ef6\u63cf\u8ff0\u7b26\u3001\u5185\u5b58\u5730\u5740\u7a7a\u95f4\u3001\u7a0b\u5e8f\u8ba1\u6570\u5668\u3001\u6267\u884c\u7684\u4ee3\u7801\u7b49\u3002</p> <p>\u8fd9\u4e24\u4e2a\u8fdb\u7a0b\u521a\u590d\u5236\u5b8c\u7684\u65f6\u5019\uff0c\u51e0\u4e4e\u4e00\u6a21\u4e00\u6837\u3002\u4e0d\u8fc7\uff0c\u4f1a\u6839\u636e\u8fd4\u56de\u503c\u6765\u533a\u5206\u662f\u7236\u8fdb\u7a0b\u8fd8\u662f\u5b50\u8fdb\u7a0b\uff0c\u5982\u679c\u8fd4\u56de\u503c\u662f 0\uff0c\u5219\u662f\u5b50\u8fdb\u7a0b\uff1b\u5982\u679c\u8fd4\u56de\u503c\u662f\u5176\u4ed6\u7684\u6574\u6570\uff0c\u5c31\u662f\u7236\u8fdb\u7a0b\u3002</p> <p>\u6b63\u56e0\u4e3a\u5b50\u8fdb\u7a0b\u4f1a\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u300c\u5df2\u8fde\u63a5 Socket\u300d\u548c\u5ba2\u6237\u7aef\u901a\u4fe1\u4e86\uff0c</p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u5b50\u8fdb\u7a0b\u4e0d\u9700\u8981\u5173\u5fc3\u300c\u76d1\u542c Socket\u300d\uff0c\u53ea\u9700\u8981\u5173\u5fc3\u300c\u5df2\u8fde\u63a5 Socket\u300d\uff1b\u7236\u8fdb\u7a0b\u5219\u76f8\u53cd\uff0c\u5c06\u5ba2\u6237\u670d\u52a1\u4ea4\u7ed9\u5b50\u8fdb\u7a0b\u6765\u5904\u7406\uff0c\u56e0\u6b64\u7236\u8fdb\u7a0b\u4e0d\u9700\u8981\u5173\u5fc3\u300c\u5df2\u8fde\u63a5 Socket\u300d\uff0c\u53ea\u9700\u8981\u5173\u5fc3\u300c\u76d1\u542c Socket\u300d\u3002</p> <p>\u4e0b\u9762\u8fd9\u5f20\u56fe\u63cf\u8ff0\u4e86\u4ece\u8fde\u63a5\u8bf7\u6c42\u5230\u8fde\u63a5\u5efa\u7acb\uff0c\u7236\u8fdb\u7a0b\u521b\u5efa\u751f\u5b50\u8fdb\u7a0b\u4e3a\u5ba2\u6237\u670d\u52a1\u3002</p> <p></p> <p>\u53e6\u5916\uff0c\u5f53\u300c\u5b50\u8fdb\u7a0b\u300d\u9000\u51fa\u65f6\uff0c\u5b9e\u9645\u4e0a\u5185\u6838\u91cc\u8fd8\u4f1a\u4fdd\u7559\u8be5\u8fdb\u7a0b\u7684\u4e00\u4e9b\u4fe1\u606f\uff0c\u4e5f\u662f\u4f1a\u5360\u7528\u5185\u5b58\u7684\uff0c\u5982\u679c\u4e0d\u505a\u597d\u201c\u56de\u6536\u201d\u5de5\u4f5c\uff0c\u5c31\u4f1a\u53d8\u6210\u50f5\u5c38\u8fdb\u7a0b\uff0c\u968f\u7740\u50f5\u5c38\u8fdb\u7a0b\u8d8a\u591a\uff0c\u4f1a\u6162\u6162\u8017\u5c3d\u6211\u4eec\u7684\u7cfb\u7edf\u8d44\u6e90\u3002</p> <p>\u56e0\u6b64\uff0c\u7236\u8fdb\u7a0b\u8981\u201c\u5584\u540e\u201d\u597d\u81ea\u5df1\u7684\u5b69\u5b50\uff0c\u600e\u4e48\u5584\u540e\u5462\uff1f\u90a3\u4e48\u6709\u4e24\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5728\u5b50\u8fdb\u7a0b\u9000\u51fa\u540e\u56de\u6536\u8d44\u6e90\uff0c\u5206\u522b\u662f\u8c03\u7528 <code>wait()</code> \u548c <code>waitpid()</code> \u51fd\u6570\u3002</p> <p>\u8fd9\u79cd\u7528\u591a\u4e2a\u8fdb\u7a0b\u6765\u5e94\u4ed8\u591a\u4e2a\u5ba2\u6237\u7aef\u7684\u65b9\u5f0f\uff0c\u5728\u5e94\u5bf9 100 \u4e2a\u5ba2\u6237\u7aef\u8fd8\u662f\u53ef\u884c\u7684\uff0c\u4f46\u662f\u5f53\u5ba2\u6237\u7aef\u6570\u91cf\u9ad8\u8fbe\u4e00\u4e07\u65f6\uff0c\u80af\u5b9a\u625b\u4e0d\u4f4f\u7684\uff0c\u56e0\u4e3a\u6bcf\u4ea7\u751f\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u5fc5\u4f1a\u5360\u636e\u4e00\u5b9a\u7684\u7cfb\u7edf\u8d44\u6e90\uff0c\u800c\u4e14\u8fdb\u7a0b\u95f4\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u201c\u5305\u88b1\u201d\u662f\u5f88\u91cd\u7684\uff0c\u6027\u80fd\u4f1a\u5927\u6253\u6298\u6263\u3002</p> <p>\u8fdb\u7a0b\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u4e0d\u4ec5\u5305\u542b\u4e86\u865a\u62df\u5185\u5b58\u3001\u6808\u3001\u5168\u5c40\u53d8\u91cf\u7b49\u7528\u6237\u7a7a\u95f4\u7684\u8d44\u6e90\uff0c\u8fd8\u5305\u62ec\u4e86\u5185\u6838\u5806\u6808\u3001\u5bc4\u5b58\u5668\u7b49\u5185\u6838\u7a7a\u95f4\u7684\u8d44\u6e90\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/#_3","title":"\u591a\u7ebf\u7a0b\u6a21\u578b","text":"<p>\u65e2\u7136\u8fdb\u7a0b\u95f4\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u201c\u5305\u88b1\u201d\u5f88\u91cd\uff0c\u90a3\u6211\u4eec\u5c31\u641e\u4e2a\u6bd4\u8f83\u8f7b\u91cf\u7ea7\u7684\u6a21\u578b\u6765\u5e94\u5bf9\u591a\u7528\u6237\u7684\u8bf7\u6c42 \u2014\u2014 \u591a\u7ebf\u7a0b\u6a21\u578b\u3002</p> <p>\u7ebf\u7a0b\u662f\u8fd0\u884c\u5728\u8fdb\u7a0b\u4e2d\u7684\u4e00\u4e2a\u201c\u903b\u8f91\u6d41\u201d\uff0c\u5355\u8fdb\u7a0b\u4e2d\u53ef\u4ee5\u8fd0\u884c\u591a\u4e2a\u7ebf\u7a0b\uff0c\u540c\u8fdb\u7a0b\u91cc\u7684\u7ebf\u7a0b\u53ef\u4ee5\u5171\u4eab\u8fdb\u7a0b\u7684\u90e8\u5206\u8d44\u6e90\uff0c\u6bd4\u5982\u6587\u4ef6\u63cf\u8ff0\u7b26\u5217\u8868\u3001\u8fdb\u7a0b\u7a7a\u95f4\u3001\u4ee3\u7801\u3001\u5168\u5c40\u6570\u636e\u3001\u5806\u3001\u5171\u4eab\u5e93\u7b49\uff0c\u8fd9\u4e9b\u5171\u4eab\u4e9b\u8d44\u6e90\u5728\u4e0a\u4e0b\u6587\u5207\u6362\u65f6\u4e0d\u9700\u8981\u5207\u6362\uff0c\u800c\u53ea\u9700\u8981\u5207\u6362\u7ebf\u7a0b\u7684\u79c1\u6709\u6570\u636e\u3001\u5bc4\u5b58\u5668\u7b49\u4e0d\u5171\u4eab\u7684\u6570\u636e\uff0c\u56e0\u6b64\u540c\u4e00\u4e2a\u8fdb\u7a0b\u4e0b\u7684\u7ebf\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5f00\u9500\u8981\u6bd4\u8fdb\u7a0b\u5c0f\u5f97\u591a\u3002</p> <p>\u5f53\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef TCP \u5b8c\u6210\u8fde\u63a5\u540e\uff0c\u901a\u8fc7 <code>pthread_create()</code> \u51fd\u6570\u521b\u5efa\u7ebf\u7a0b\uff0c\u7136\u540e\u5c06\u300c\u5df2\u8fde\u63a5 Socket\u300d\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u4f20\u9012\u7ed9\u7ebf\u7a0b\u51fd\u6570\uff0c\u63a5\u7740\u5728\u7ebf\u7a0b\u91cc\u548c\u5ba2\u6237\u7aef\u8fdb\u884c\u901a\u4fe1\uff0c\u4ece\u800c\u8fbe\u5230\u5e76\u53d1\u5904\u7406\u7684\u76ee\u7684\u3002</p> <p>\u5982\u679c\u6bcf\u6765\u4e00\u4e2a\u8fde\u63a5\u5c31\u521b\u5efa\u4e00\u4e2a\u7ebf\u7a0b\uff0c\u7ebf\u7a0b\u8fd0\u884c\u5b8c\u540e\uff0c\u8fd8\u5f97\u64cd\u4f5c\u7cfb\u7edf\u8fd8\u5f97\u9500\u6bc1\u7ebf\u7a0b\uff0c\u867d\u8bf4\u7ebf\u7a0b\u5207\u6362\u7684\u4e0a\u4e0b\u6587\u5f00\u9500\u4e0d\u5927\uff0c\u4f46\u662f\u5982\u679c\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\u7ebf\u7a0b\uff0c\u7cfb\u7edf\u5f00\u9500\u4e5f\u662f\u4e0d\u5c0f\u7684\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u7ebf\u7a0b\u6c60\u7684\u65b9\u5f0f\u6765\u907f\u514d\u7ebf\u7a0b\u7684\u9891\u7e41\u521b\u5efa\u548c\u9500\u6bc1\uff0c\u6240\u8c13\u7684\u7ebf\u7a0b\u6c60\uff0c\u5c31\u662f\u63d0\u524d\u521b\u5efa\u82e5\u5e72\u4e2a\u7ebf\u7a0b\uff0c\u8fd9\u6837\u5f53\u7531\u65b0\u8fde\u63a5\u5efa\u7acb\u65f6\uff0c\u5c06\u8fd9\u4e2a\u5df2\u8fde\u63a5\u7684 Socket \u653e\u5165\u5230\u4e00\u4e2a\u961f\u5217\u91cc\uff0c\u7136\u540e\u7ebf\u7a0b\u6c60\u91cc\u7684\u7ebf\u7a0b\u8d1f\u8d23\u4ece\u961f\u5217\u4e2d\u53d6\u51fa\u5df2\u8fde\u63a5 Socket \u8fdb\u7a0b\u5904\u7406\u3002</p> <p></p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u8fd9\u4e2a\u961f\u5217\u662f\u5168\u5c40\u7684\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u4f1a\u64cd\u4f5c\uff0c\u4e3a\u4e86\u907f\u514d\u591a\u7ebf\u7a0b\u7ade\u4e89\uff0c\u7ebf\u7a0b\u5728\u64cd\u4f5c\u8fd9\u4e2a\u961f\u5217\u524d\u8981\u52a0\u9501\u3002</p> <p>\u4e0a\u9762\u57fa\u4e8e\u8fdb\u7a0b\u6216\u8005\u7ebf\u7a0b\u6a21\u578b\u7684\uff0c\u5176\u5b9e\u8fd8\u662f\u6709\u95ee\u9898\u7684\u3002\u65b0\u5230\u6765\u4e00\u4e2a TCP \u8fde\u63a5\uff0c\u5c31\u9700\u8981\u5206\u914d\u4e00\u4e2a\u8fdb\u7a0b\u6216\u8005\u7ebf\u7a0b\uff0c\u90a3\u4e48\u5982\u679c\u8981\u8fbe\u5230 C10K\uff0c\u610f\u5473\u7740\u8981\u4e00\u53f0\u673a\u5668\u7ef4\u62a4 1 \u4e07\u4e2a\u8fde\u63a5\uff0c\u76f8\u5f53\u4e8e\u8981\u7ef4\u62a4 1 \u4e07\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5c31\u7b97\u6b7b\u625b\u4e5f\u662f\u625b\u4e0d\u4f4f\u7684\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/#io","title":"I/O \u591a\u8def\u590d\u7528","text":"<p>\u65e2\u7136\u4e3a\u6bcf\u4e2a\u8bf7\u6c42\u5206\u914d\u4e00\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u7684\u65b9\u5f0f\u4e0d\u5408\u9002\uff0c\u90a3\u6709\u6ca1\u6709\u53ef\u80fd\u53ea\u4f7f\u7528\u4e00\u4e2a\u8fdb\u7a0b\u6765\u7ef4\u62a4\u591a\u4e2a Socket \u5462\uff1f\u7b54\u6848\u662f\u6709\u7684\uff0c\u90a3\u5c31\u662f I/O \u591a\u8def\u590d\u7528\u6280\u672f\u3002</p> <p></p> <p>\u4e00\u4e2a\u8fdb\u7a0b\u867d\u7136\u4efb\u610f\u65f6\u523b\u53ea\u80fd\u5904\u7406\u4e00\u4e2a\u8bf7\u6c42\uff0c\u4f46\u662f\u5904\u7406\u6bcf\u4e2a\u8bf7\u6c42\u7684\u4e8b\u4ef6\u65f6\uff0c\u8017\u65f6\u63a7\u5236\u5728 1 \u6beb\u79d2\u4ee5\u5185\uff0c\u8fd9\u6837 1 \u79d2\u5185\u5c31\u53ef\u4ee5\u5904\u7406\u4e0a\u5343\u4e2a\u8bf7\u6c42\uff0c\u628a\u65f6\u95f4\u62c9\u957f\u6765\u770b\uff0c\u591a\u4e2a\u8bf7\u6c42\u590d\u7528\u4e86\u4e00\u4e2a\u8fdb\u7a0b\uff0c\u8fd9\u5c31\u662f\u591a\u8def\u590d\u7528\uff0c\u8fd9\u79cd\u601d\u60f3\u5f88\u7c7b\u4f3c\u4e00\u4e2a CPU \u5e76\u53d1\u591a\u4e2a\u8fdb\u7a0b\uff0c\u6240\u4ee5\u4e5f\u53eb\u505a\u65f6\u5206\u591a\u8def\u590d\u7528\u3002</p> <p>\u6211\u4eec\u719f\u6089\u7684 select/poll/epoll \u662f\u5185\u6838\u63d0\u4f9b\u7ed9\u7528\u6237\u6001\u7684\u591a\u8def\u590d\u7528\u7cfb\u7edf\u8c03\u7528\uff0c\u8fdb\u7a0b\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e2a\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u4ece\u5185\u6838\u4e2d\u83b7\u53d6\u591a\u4e2a\u4e8b\u4ef6\u3002</p> <p>select/poll/epoll \u662f\u5982\u4f55\u83b7\u53d6\u7f51\u7edc\u4e8b\u4ef6\u7684\u5462\uff1f\u5728\u83b7\u53d6\u4e8b\u4ef6\u65f6\uff0c\u5148\u628a\u6240\u6709\u8fde\u63a5\uff08\u6587\u4ef6\u63cf\u8ff0\u7b26\uff09\u4f20\u7ed9\u5185\u6838\uff0c\u518d\u7531\u5185\u6838\u8fd4\u56de\u4ea7\u751f\u4e86\u4e8b\u4ef6\u7684\u8fde\u63a5\uff0c\u7136\u540e\u5728\u7528\u6237\u6001\u4e2d\u518d\u5904\u7406\u8fd9\u4e9b\u8fde\u63a5\u5bf9\u5e94\u7684\u8bf7\u6c42\u5373\u53ef\u3002</p> <p>select/poll/epoll \u8fd9\u662f\u4e09\u4e2a\u591a\u8def\u590d\u7528\u63a5\u53e3\uff0c\u90fd\u80fd\u5b9e\u73b0 C10K \u5417\uff1f\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5206\u522b\u8bf4\u8bf4\u5b83\u4eec\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/#selectpoll","title":"select/poll","text":"<p>select \u5b9e\u73b0\u591a\u8def\u590d\u7528\u7684\u65b9\u5f0f\u662f\uff0c\u5c06\u5df2\u8fde\u63a5\u7684 Socket \u90fd\u653e\u5230\u4e00\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\uff0c\u7136\u540e\u8c03\u7528 <code>select()</code> \u51fd\u6570\u5c06\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u62f7\u8d1d\u5230\u5185\u6838\u91cc\uff0c\u8ba9\u5185\u6838\u6765\u68c0\u67e5\u662f\u5426\u6709\u7f51\u7edc\u4e8b\u4ef6\u4ea7\u751f\uff0c\u68c0\u67e5\u7684\u65b9\u5f0f\u5f88\u7c97\u66b4\uff0c\u5c31\u662f\u901a\u8fc7\u904d\u5386\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u7684\u65b9\u5f0f\uff0c\u5f53\u68c0\u67e5\u5230\u6709\u4e8b\u4ef6\u4ea7\u751f\u540e\uff0c\u5c06\u6b64 Socket \u6807\u8bb0\u4e3a\u53ef\u8bfb\u6216\u53ef\u5199\uff0c\u63a5\u7740\u518d\u628a\u6574\u4e2a\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u62f7\u8d1d\u56de\u7528\u6237\u6001\u91cc\uff0c\u7136\u540e\u7528\u6237\u6001\u8fd8\u9700\u8981\u518d\u901a\u8fc7\u904d\u5386\u7684\u65b9\u6cd5\u627e\u5230\u53ef\u8bfb\u6216\u53ef\u5199\u7684 Socket\uff0c\u7136\u540e\u518d\u5bf9\u5176\u5904\u7406\u3002</p> <p>\u6240\u4ee5\uff0c\u5bf9\u4e8e select \u8fd9\u79cd\u65b9\u5f0f\uff0c\u9700\u8981\u8fdb\u884c 2 \u6b21\u300c\u904d\u5386\u300d\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\uff0c\u4e00\u6b21\u662f\u5728\u5185\u6838\u6001\u91cc\uff0c\u4e00\u6b21\u662f\u5728\u7528\u6237\u6001\u91cc\uff0c\u800c\u4e14\u8fd8\u4f1a\u53d1\u751f 2 \u6b21\u300c\u62f7\u8d1d\u300d\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\uff0c\u5148\u4ece\u7528\u6237\u7a7a\u95f4\u4f20\u5165\u5185\u6838\u7a7a\u95f4\uff0c\u7531\u5185\u6838\u4fee\u6539\u540e\uff0c\u518d\u4f20\u51fa\u5230\u7528\u6237\u7a7a\u95f4\u4e2d\u3002</p> <p>select \u4f7f\u7528\u56fa\u5b9a\u957f\u5ea6\u7684 BitsMap\uff0c\u8868\u793a\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\uff0c\u800c\u4e14\u6240\u652f\u6301\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u4e2a\u6570\u662f\u6709\u9650\u5236\u7684\uff0c\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u7531\u5185\u6838\u4e2d\u7684 FD_SETSIZE \u9650\u5236\uff0c\u9ed8\u8ba4\u6700\u5927\u503c\u4e3a <code>1024</code>\uff0c\u53ea\u80fd\u76d1\u542c 0~1023 \u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u3002</p> <p>poll \u4e0d\u518d\u7528 BitsMap \u6765\u5b58\u50a8\u6240\u5173\u6ce8\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u53d6\u800c\u4ee3\u4e4b\u7528\u52a8\u6001\u6570\u7ec4\uff0c\u4ee5\u94fe\u8868\u5f62\u5f0f\u6765\u7ec4\u7ec7\uff0c\u7a81\u7834\u4e86 select \u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e2a\u6570\u9650\u5236\uff0c\u5f53\u7136\u8fd8\u4f1a\u53d7\u5230\u7cfb\u7edf\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236\u3002</p> <p>\u4f46\u662f poll \u548c select \u5e76\u6ca1\u6709\u592a\u5927\u7684\u672c\u8d28\u533a\u522b\uff0c\u90fd\u662f\u4f7f\u7528\u300c\u7ebf\u6027\u7ed3\u6784\u300d\u5b58\u50a8\u8fdb\u7a0b\u5173\u6ce8\u7684 Socket \u96c6\u5408\uff0c\u56e0\u6b64\u90fd\u9700\u8981\u904d\u5386\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\u6765\u627e\u5230\u53ef\u8bfb\u6216\u53ef\u5199\u7684 Socket\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u4e3a O(n)\uff0c\u800c\u4e14\u4e5f\u9700\u8981\u5728\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u4e4b\u95f4\u62f7\u8d1d\u6587\u4ef6\u63cf\u8ff0\u7b26\u96c6\u5408\uff0c\u8fd9\u79cd\u65b9\u5f0f\u968f\u7740\u5e76\u53d1\u6570\u4e0a\u6765\uff0c\u6027\u80fd\u7684\u635f\u8017\u4f1a\u5448\u6307\u6570\u7ea7\u589e\u957f\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/#epoll","title":"epoll","text":"<p>epoll \u901a\u8fc7\u4e24\u4e2a\u65b9\u9762\uff0c\u5f88\u597d\u89e3\u51b3\u4e86 select/poll \u7684\u95ee\u9898\u3002</p> <p>\u7b2c\u4e00\u70b9\uff0cepoll \u5728\u5185\u6838\u91cc\u4f7f\u7528\u7ea2\u9ed1\u6811\u6765\u8ddf\u8e2a\u8fdb\u7a0b\u6240\u6709\u5f85\u68c0\u6d4b\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u628a\u9700\u8981\u76d1\u63a7\u7684 socket \u901a\u8fc7 <code>epoll_ctl()</code> \u51fd\u6570\u52a0\u5165\u5185\u6838\u4e2d\u7684\u7ea2\u9ed1\u6811\u91cc\uff0c\u7ea2\u9ed1\u6811\u662f\u4e2a\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784\uff0c\u589e\u5220\u67e5\u4e00\u822c\u65f6\u95f4\u590d\u6742\u5ea6\u662f <code>O(logn)</code>\uff0c\u901a\u8fc7\u5bf9\u8fd9\u68f5\u7ea2\u9ed1\u6811\u8fdb\u884c\u64cd\u4f5c\uff0c\u8fd9\u6837\u5c31\u4e0d\u9700\u8981\u50cf select/poll \u6bcf\u6b21\u64cd\u4f5c\u65f6\u90fd\u4f20\u5165\u6574\u4e2a socket \u96c6\u5408\uff0c\u53ea\u9700\u8981\u4f20\u5165\u4e00\u4e2a\u5f85\u68c0\u6d4b\u7684 socket\uff0c\u51cf\u5c11\u4e86\u5185\u6838\u548c\u7528\u6237\u7a7a\u95f4\u5927\u91cf\u7684\u6570\u636e\u62f7\u8d1d\u548c\u5185\u5b58\u5206\u914d\u3002</p> <p>\u7b2c\u4e8c\u70b9\uff0cepoll \u4f7f\u7528\u4e8b\u4ef6\u9a71\u52a8\u7684\u673a\u5236\uff0c\u5185\u6838\u91cc\u7ef4\u62a4\u4e86\u4e00\u4e2a\u94fe\u8868\u6765\u8bb0\u5f55\u5c31\u7eea\u4e8b\u4ef6\uff0c\u5f53\u67d0\u4e2a socket \u6709\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u901a\u8fc7\u56de\u8c03\u51fd\u6570\u5185\u6838\u4f1a\u5c06\u5176\u52a0\u5165\u5230\u8fd9\u4e2a\u5c31\u7eea\u4e8b\u4ef6\u5217\u8868\u4e2d\uff0c\u5f53\u7528\u6237\u8c03\u7528 <code>epoll_wait()</code> \u51fd\u6570\u65f6\uff0c\u53ea\u4f1a\u8fd4\u56de\u6709\u4e8b\u4ef6\u53d1\u751f\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u4e2a\u6570\uff0c\u4e0d\u9700\u8981\u50cf select/poll \u90a3\u6837\u8f6e\u8be2\u626b\u63cf\u6574\u4e2a socket \u96c6\u5408\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u68c0\u6d4b\u7684\u6548\u7387\u3002</p> <p>\u4ece\u4e0b\u56fe\u4f60\u53ef\u4ee5\u770b\u5230 epoll \u76f8\u5173\u7684\u63a5\u53e3\u4f5c\u7528\uff1a</p> <p></p> <p>epoll \u7684\u65b9\u5f0f\u5373\u4f7f\u76d1\u542c\u7684 Socket \u6570\u91cf\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u6548\u7387\u4e0d\u4f1a\u5927\u5e45\u5ea6\u964d\u4f4e\uff0c\u80fd\u591f\u540c\u65f6\u76d1\u542c\u7684 Socket \u7684\u6570\u76ee\u4e5f\u975e\u5e38\u7684\u591a\u4e86\uff0c\u4e0a\u9650\u5c31\u4e3a\u7cfb\u7edf\u5b9a\u4e49\u7684\u8fdb\u7a0b\u6253\u5f00\u7684\u6700\u5927\u6587\u4ef6\u63cf\u8ff0\u7b26\u4e2a\u6570\u3002\u56e0\u800c\uff0cepoll \u88ab\u79f0\u4e3a\u89e3\u51b3 C10K \u95ee\u9898\u7684\u5229\u5668\u3002</p> <p>\u63d2\u4e2a\u9898\u5916\u8bdd\uff0c\u7f51\u4e0a\u6587\u7ae0\u4e0d\u5c11\u8bf4\uff0c<code>epoll_wait</code> \u8fd4\u56de\u65f6\uff0c\u5bf9\u4e8e\u5c31\u7eea\u7684\u4e8b\u4ef6\uff0cepoll \u4f7f\u7528\u7684\u662f\u5171\u4eab\u5185\u5b58\u7684\u65b9\u5f0f\uff0c\u5373\u7528\u6237\u6001\u548c\u5185\u6838\u6001\u90fd\u6307\u5411\u4e86\u5c31\u7eea\u94fe\u8868\uff0c\u6240\u4ee5\u5c31\u907f\u514d\u4e86\u5185\u5b58\u62f7\u8d1d\u6d88\u8017\u3002</p> <p>\u8fd9\u662f\u9519\u7684\uff01\u770b\u8fc7 epoll \u5185\u6838\u6e90\u7801\u7684\u90fd\u77e5\u9053\uff0c\u538b\u6839\u5c31\u6ca1\u6709\u4f7f\u7528\u5171\u4eab\u5185\u5b58\u8fd9\u4e2a\u73a9\u610f\u3002\u4f60\u53ef\u4ee5\u4ece\u4e0b\u9762\u8fd9\u4efd\u4ee3\u7801\u770b\u5230\uff0c <code>epoll_wait</code> \u5b9e\u73b0\u7684\u5185\u6838\u4ee3\u7801\u4e2d\u8c03\u7528\u4e86 <code>__put_user</code> \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u5c31\u662f\u5c06\u6570\u636e\u4ece\u5185\u6838\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\u3002</p> <p></p> <p>\u597d\u4e86\uff0c\u8fd9\u4e2a\u9898\u5916\u8bdd\u5c31\u8bf4\u5230\u8fd9\u4e86\uff0c\u6211\u4eec\u7ee7\u7eed\uff01</p> <p>epoll \u652f\u6301\u4e24\u79cd\u4e8b\u4ef6\u89e6\u53d1\u6a21\u5f0f\uff0c\u5206\u522b\u662f\u8fb9\u7f18\u89e6\u53d1\uff08edge-triggered\uff0cET\uff09\u548c\u6c34\u5e73\u89e6\u53d1\uff08level-triggered\uff0cLT\uff09\u3002</p> <p>\u8fd9\u4e24\u4e2a\u672f\u8bed\u8fd8\u633a\u62bd\u8c61\u7684\uff0c\u5176\u5b9e\u5b83\u4eec\u7684\u533a\u522b\u8fd8\u662f\u5f88\u597d\u7406\u89e3\u7684\u3002</p> <ul> <li>\u4f7f\u7528\u8fb9\u7f18\u89e6\u53d1\u6a21\u5f0f\u65f6\uff0c\u5f53\u88ab\u76d1\u63a7\u7684 Socket \u63cf\u8ff0\u7b26\u4e0a\u6709\u53ef\u8bfb\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u670d\u52a1\u5668\u7aef\u53ea\u4f1a\u4ece epoll_wait \u4e2d\u82cf\u9192\u4e00\u6b21\uff0c\u5373\u4f7f\u8fdb\u7a0b\u6ca1\u6709\u8c03\u7528 read \u51fd\u6570\u4ece\u5185\u6838\u8bfb\u53d6\u6570\u636e\uff0c\u4e5f\u4f9d\u7136\u53ea\u82cf\u9192\u4e00\u6b21\uff0c\u56e0\u6b64\u6211\u4eec\u7a0b\u5e8f\u8981\u4fdd\u8bc1\u4e00\u6b21\u6027\u5c06\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u8bfb\u53d6\u5b8c\uff1b</li> <li>\u4f7f\u7528\u6c34\u5e73\u89e6\u53d1\u6a21\u5f0f\u65f6\uff0c\u5f53\u88ab\u76d1\u63a7\u7684 Socket \u4e0a\u6709\u53ef\u8bfb\u4e8b\u4ef6\u53d1\u751f\u65f6\uff0c\u670d\u52a1\u5668\u7aef\u4e0d\u65ad\u5730\u4ece epoll_wait \u4e2d\u82cf\u9192\uff0c\u76f4\u5230\u5185\u6838\u7f13\u51b2\u533a\u6570\u636e\u88ab read \u51fd\u6570\u8bfb\u5b8c\u624d\u7ed3\u675f\uff0c\u76ee\u7684\u662f\u544a\u8bc9\u6211\u4eec\u6709\u6570\u636e\u9700\u8981\u8bfb\u53d6\uff1b</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u7684\u5feb\u9012\u88ab\u653e\u5230\u4e86\u4e00\u4e2a\u5feb\u9012\u7bb1\u91cc\uff0c\u5982\u679c\u5feb\u9012\u7bb1\u53ea\u4f1a\u901a\u8fc7\u77ed\u4fe1\u901a\u77e5\u4f60\u4e00\u6b21\uff0c\u5373\u4f7f\u4f60\u4e00\u76f4\u6ca1\u6709\u53bb\u53d6\uff0c\u5b83\u4e5f\u4e0d\u4f1a\u518d\u53d1\u9001\u7b2c\u4e8c\u6761\u77ed\u4fe1\u63d0\u9192\u4f60\uff0c\u8fd9\u4e2a\u65b9\u5f0f\u5c31\u662f\u8fb9\u7f18\u89e6\u53d1\uff1b\u5982\u679c\u5feb\u9012\u7bb1\u53d1\u73b0\u4f60\u7684\u5feb\u9012\u6ca1\u6709\u88ab\u53d6\u51fa\uff0c\u5b83\u5c31\u4f1a\u4e0d\u505c\u5730\u53d1\u77ed\u4fe1\u901a\u77e5\u4f60\uff0c\u76f4\u5230\u4f60\u53d6\u51fa\u4e86\u5feb\u9012\uff0c\u5b83\u624d\u6d88\u505c\uff0c\u8fd9\u4e2a\u5c31\u662f\u6c34\u5e73\u89e6\u53d1\u7684\u65b9\u5f0f\u3002</p> <p>\u8fd9\u5c31\u662f\u4e24\u8005\u7684\u533a\u522b\uff0c\u6c34\u5e73\u89e6\u53d1\u7684\u610f\u601d\u662f\u53ea\u8981\u6ee1\u8db3\u4e8b\u4ef6\u7684\u6761\u4ef6\uff0c\u6bd4\u5982\u5185\u6838\u4e2d\u6709\u6570\u636e\u9700\u8981\u8bfb\uff0c\u5c31\u4e00\u76f4\u4e0d\u65ad\u5730\u628a\u8fd9\u4e2a\u4e8b\u4ef6\u4f20\u9012\u7ed9\u7528\u6237\uff1b\u800c\u8fb9\u7f18\u89e6\u53d1\u7684\u610f\u601d\u662f\u53ea\u6709\u7b2c\u4e00\u6b21\u6ee1\u8db3\u6761\u4ef6\u7684\u65f6\u5019\u624d\u89e6\u53d1\uff0c\u4e4b\u540e\u5c31\u4e0d\u4f1a\u518d\u4f20\u9012\u540c\u6837\u7684\u4e8b\u4ef6\u4e86\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u6c34\u5e73\u89e6\u53d1\u6a21\u5f0f\uff0c\u5f53\u5185\u6838\u901a\u77e5\u6587\u4ef6\u63cf\u8ff0\u7b26\u53ef\u8bfb\u5199\u65f6\uff0c\u63a5\u4e0b\u6765\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u53bb\u68c0\u6d4b\u5b83\u7684\u72b6\u6001\uff0c\u770b\u5b83\u662f\u5426\u4f9d\u7136\u53ef\u8bfb\u6216\u53ef\u5199\u3002\u6240\u4ee5\u5728\u6536\u5230\u901a\u77e5\u540e\uff0c\u6ca1\u5fc5\u8981\u4e00\u6b21\u6267\u884c\u5c3d\u53ef\u80fd\u591a\u7684\u8bfb\u5199\u64cd\u4f5c\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u8fb9\u7f18\u89e6\u53d1\u6a21\u5f0f\uff0cI/O \u4e8b\u4ef6\u53d1\u751f\u65f6\u53ea\u4f1a\u901a\u77e5\u4e00\u6b21\uff0c\u800c\u4e14\u6211\u4eec\u4e0d\u77e5\u9053\u5230\u5e95\u80fd\u8bfb\u5199\u591a\u5c11\u6570\u636e\uff0c\u6240\u4ee5\u5728\u6536\u5230\u901a\u77e5\u540e\u5e94\u5c3d\u53ef\u80fd\u5730\u8bfb\u5199\u6570\u636e\uff0c\u4ee5\u514d\u9519\u5931\u8bfb\u5199\u7684\u673a\u4f1a\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u4f1a\u5faa\u73af\u4ece\u6587\u4ef6\u63cf\u8ff0\u7b26\u8bfb\u5199\u6570\u636e\uff0c\u90a3\u4e48\u5982\u679c\u6587\u4ef6\u63cf\u8ff0\u7b26\u662f\u963b\u585e\u7684\uff0c\u6ca1\u6709\u6570\u636e\u53ef\u8bfb\u5199\u65f6\uff0c\u8fdb\u7a0b\u4f1a\u963b\u585e\u5728\u8bfb\u5199\u51fd\u6570\u90a3\u91cc\uff0c\u7a0b\u5e8f\u5c31\u6ca1\u529e\u6cd5\u7ee7\u7eed\u5f80\u4e0b\u6267\u884c\u3002\u6240\u4ee5\uff0c\u8fb9\u7f18\u89e6\u53d1\u6a21\u5f0f\u4e00\u822c\u548c\u975e\u963b\u585e I/O \u642d\u914d\u4f7f\u7528\uff0c\u7a0b\u5e8f\u4f1a\u4e00\u76f4\u6267\u884c I/O \u64cd\u4f5c\uff0c\u76f4\u5230\u7cfb\u7edf\u8c03\u7528\uff08\u5982 <code>read</code> \u548c <code>write</code>\uff09\u8fd4\u56de\u9519\u8bef\uff0c\u9519\u8bef\u7c7b\u578b\u4e3a <code>EAGAIN</code> \u6216 <code>EWOULDBLOCK</code>\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u8fb9\u7f18\u89e6\u53d1\u7684\u6548\u7387\u6bd4\u6c34\u5e73\u89e6\u53d1\u7684\u6548\u7387\u8981\u9ad8\uff0c\u56e0\u4e3a\u8fb9\u7f18\u89e6\u53d1\u53ef\u4ee5\u51cf\u5c11 epoll_wait \u7684\u7cfb\u7edf\u8c03\u7528\u6b21\u6570\uff0c\u7cfb\u7edf\u8c03\u7528\u4e5f\u662f\u6709\u4e00\u5b9a\u7684\u5f00\u9500\u7684\u7684\uff0c\u6bd5\u7adf\u4e5f\u5b58\u5728\u4e0a\u4e0b\u6587\u7684\u5207\u6362\u3002</p> <p>select/poll \u53ea\u6709\u6c34\u5e73\u89e6\u53d1\u6a21\u5f0f\uff0cepoll \u9ed8\u8ba4\u7684\u89e6\u53d1\u6a21\u5f0f\u662f\u6c34\u5e73\u89e6\u53d1\uff0c\u4f46\u662f\u53ef\u4ee5\u6839\u636e\u5e94\u7528\u573a\u666f\u8bbe\u7f6e\u4e3a\u8fb9\u7f18\u89e6\u53d1\u6a21\u5f0f\u3002</p> <p>\u53e6\u5916\uff0c\u4f7f\u7528 I/O \u591a\u8def\u590d\u7528\u65f6\uff0c\u6700\u597d\u642d\u914d\u975e\u963b\u585e I/O \u4e00\u8d77\u4f7f\u7528\uff0cLinux \u624b\u518c\u5173\u4e8e select \u7684\u5185\u5bb9\u4e2d\u6709\u5982\u4e0b\u8bf4\u660e\uff1a</p> <p>Under Linux, select() may report a socket file descriptor as \"ready for reading\", while nevertheless a subsequent read blocks. This could for example happen when data has arrived but upon examination has wrong checksum and is discarded. There may be other circumstances in which a file descriptor is spuriously reported as ready. Thus it may be safer to use O_NONBLOCK on sockets that should not block.</p> <p>\u6211\u8c37\u6b4c\u7ffb\u8bd1\u7684\u7ed3\u679c\uff1a</p> <p>\u5728 Linux \u4e0b\uff0cselect() \u53ef\u80fd\u4f1a\u5c06\u4e00\u4e2a socket \u6587\u4ef6\u63cf\u8ff0\u7b26\u62a5\u544a\u4e3a \"\u51c6\u5907\u8bfb\u53d6\"\uff0c\u800c\u540e\u7eed\u7684\u8bfb\u53d6\u5757\u5374\u6ca1\u6709\u3002\u4f8b\u5982\uff0c\u5f53\u6570\u636e\u5df2\u7ecf\u5230\u8fbe\uff0c\u4f46\u7ecf\u68c0\u67e5\u540e\u53d1\u73b0\u6709\u9519\u8bef\u7684\u6821\u9a8c\u548c\u800c\u88ab\u4e22\u5f03\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u3002\u4e5f\u6709\u53ef\u80fd\u5728\u5176\u4ed6\u60c5\u51b5\u4e0b\uff0c\u6587\u4ef6\u63cf\u8ff0\u7b26\u88ab\u9519\u8bef\u5730\u62a5\u544a\u4e3a\u5c31\u7eea\u3002\u56e0\u6b64\uff0c\u5728\u4e0d\u5e94\u8be5\u963b\u585e\u7684 socket \u4e0a\u4f7f\u7528 O_NONBLOCK \u53ef\u80fd\u66f4\u5b89\u5168\u3002</p> <p>\u7b80\u5355\u70b9\u7406\u89e3\uff0c\u5c31\u662f\u591a\u8def\u590d\u7528 API \u8fd4\u56de\u7684\u4e8b\u4ef6\u5e76\u4e0d\u4e00\u5b9a\u53ef\u8bfb\u5199\u7684\uff0c\u5982\u679c\u4f7f\u7528\u963b\u585e I/O\uff0c\u90a3\u4e48\u5728\u8c03\u7528 read/write \u65f6\u5219\u4f1a\u53d1\u751f\u7a0b\u5e8f\u963b\u585e\uff0c\u56e0\u6b64\u6700\u597d\u642d\u914d\u975e\u963b\u585e I/O\uff0c\u4ee5\u4fbf\u5e94\u5bf9\u6781\u5c11\u6570\u7684\u7279\u6b8a\u60c5\u51b5\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/#_4","title":"\u603b\u7ed3","text":"<p>\u6700\u57fa\u7840\u7684 TCP \u7684 Socket \u7f16\u7a0b\uff0c\u5b83\u662f\u963b\u585e I/O \u6a21\u578b\uff0c\u57fa\u672c\u4e0a\u53ea\u80fd\u4e00\u5bf9\u4e00\u901a\u4fe1\uff0c\u90a3\u4e3a\u4e86\u670d\u52a1\u66f4\u591a\u7684\u5ba2\u6237\u7aef\uff0c\u6211\u4eec\u9700\u8981\u6539\u8fdb\u7f51\u7edc I/O \u6a21\u578b\u3002</p> <p>\u6bd4\u8f83\u4f20\u7edf\u7684\u65b9\u5f0f\u662f\u4f7f\u7528\u591a\u8fdb\u7a0b/\u7ebf\u7a0b\u6a21\u578b\uff0c\u6bcf\u6765\u4e00\u4e2a\u5ba2\u6237\u7aef\u8fde\u63a5\uff0c\u5c31\u5206\u914d\u4e00\u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\uff0c\u7136\u540e\u540e\u7eed\u7684\u8bfb\u5199\u90fd\u5728\u5bf9\u5e94\u7684\u8fdb\u7a0b/\u7ebf\u7a0b\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5904\u7406 100 \u4e2a\u5ba2\u6237\u7aef\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u5f53\u5ba2\u6237\u7aef\u589e\u5927\u5230 10000 \u4e2a\u65f6\uff0c10000 \u4e2a\u8fdb\u7a0b/\u7ebf\u7a0b\u7684\u8c03\u5ea6\u3001\u4e0a\u4e0b\u6587\u5207\u6362\u4ee5\u53ca\u5b83\u4eec\u5360\u7528\u7684\u5185\u5b58\uff0c\u90fd\u4f1a\u6210\u4e3a\u74f6\u9888\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4e0a\u9762\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u51fa\u73b0\u4e86 I/O \u7684\u591a\u8def\u590d\u7528\uff0c\u53ef\u4ee5\u53ea\u5728\u4e00\u4e2a\u8fdb\u7a0b\u91cc\u5904\u7406\u591a\u4e2a\u6587\u4ef6\u7684 I/O\uff0cLinux \u4e0b\u6709\u4e09\u79cd\u63d0\u4f9b I/O \u591a\u8def\u590d\u7528\u7684 API\uff0c\u5206\u522b\u662f\uff1aselect\u3001poll\u3001epoll\u3002</p> <p>select \u548c poll \u5e76\u6ca1\u6709\u672c\u8d28\u533a\u522b\uff0c\u5b83\u4eec\u5185\u90e8\u90fd\u662f\u4f7f\u7528\u300c\u7ebf\u6027\u7ed3\u6784\u300d\u6765\u5b58\u50a8\u8fdb\u7a0b\u5173\u6ce8\u7684 Socket \u96c6\u5408\u3002</p> <p>\u5728\u4f7f\u7528\u7684\u65f6\u5019\uff0c\u9996\u5148\u9700\u8981\u628a\u5173\u6ce8\u7684 Socket \u96c6\u5408\u901a\u8fc7 select/poll \u7cfb\u7edf\u8c03\u7528\u4ece\u7528\u6237\u6001\u62f7\u8d1d\u5230\u5185\u6838\u6001\uff0c\u7136\u540e\u7531\u5185\u6838\u68c0\u6d4b\u4e8b\u4ef6\uff0c\u5f53\u6709\u7f51\u7edc\u4e8b\u4ef6\u4ea7\u751f\u65f6\uff0c\u5185\u6838\u9700\u8981\u904d\u5386\u8fdb\u7a0b\u5173\u6ce8 Socket \u96c6\u5408\uff0c\u627e\u5230\u5bf9\u5e94\u7684 Socket\uff0c\u5e76\u8bbe\u7f6e\u5176\u72b6\u6001\u4e3a\u53ef\u8bfb/\u53ef\u5199\uff0c\u7136\u540e\u628a\u6574\u4e2a Socket \u96c6\u5408\u4ece\u5185\u6838\u6001\u62f7\u8d1d\u5230\u7528\u6237\u6001\uff0c\u7528\u6237\u6001\u8fd8\u8981\u7ee7\u7eed\u904d\u5386\u6574\u4e2a Socket \u96c6\u5408\u627e\u5230\u53ef\u8bfb/\u53ef\u5199\u7684 Socket\uff0c\u7136\u540e\u5bf9\u5176\u5904\u7406\u3002</p> <p>\u5f88\u660e\u663e\u53d1\u73b0\uff0cselect \u548c poll \u7684\u7f3a\u9677\u5728\u4e8e\uff0c\u5f53\u5ba2\u6237\u7aef\u8d8a\u591a\uff0c\u4e5f\u5c31\u662f Socket \u96c6\u5408\u8d8a\u5927\uff0cSocket \u96c6\u5408\u7684\u904d\u5386\u548c\u62f7\u8d1d\u4f1a\u5e26\u6765\u5f88\u5927\u7684\u5f00\u9500\uff0c\u56e0\u6b64\u4e5f\u5f88\u96be\u5e94\u5bf9 C10K\u3002</p> <p>epoll \u662f\u89e3\u51b3 C10K \u95ee\u9898\u7684\u5229\u5668\uff0c\u901a\u8fc7\u4e24\u4e2a\u65b9\u9762\u89e3\u51b3\u4e86 select/poll \u7684\u95ee\u9898\u3002</p> <ul> <li>epoll \u5728\u5185\u6838\u91cc\u4f7f\u7528\u300c\u7ea2\u9ed1\u6811\u300d\u6765\u5173\u6ce8\u8fdb\u7a0b\u6240\u6709\u5f85\u68c0\u6d4b\u7684 Socket\uff0c\u7ea2\u9ed1\u6811\u662f\u4e2a\u9ad8\u6548\u7684\u6570\u636e\u7ed3\u6784\uff0c\u589e\u5220\u67e5\u4e00\u822c\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(logn)\uff0c\u901a\u8fc7\u5bf9\u8fd9\u68f5\u9ed1\u7ea2\u6811\u7684\u7ba1\u7406\uff0c\u4e0d\u9700\u8981\u50cf select/poll \u5728\u6bcf\u6b21\u64cd\u4f5c\u65f6\u90fd\u4f20\u5165\u6574\u4e2a Socket \u96c6\u5408\uff0c\u51cf\u5c11\u4e86\u5185\u6838\u548c\u7528\u6237\u7a7a\u95f4\u5927\u91cf\u7684\u6570\u636e\u62f7\u8d1d\u548c\u5185\u5b58\u5206\u914d\u3002</li> <li>epoll \u4f7f\u7528\u4e8b\u4ef6\u9a71\u52a8\u7684\u673a\u5236\uff0c\u5185\u6838\u91cc\u7ef4\u62a4\u4e86\u4e00\u4e2a\u300c\u94fe\u8868\u300d\u6765\u8bb0\u5f55\u5c31\u7eea\u4e8b\u4ef6\uff0c\u53ea\u5c06\u6709\u4e8b\u4ef6\u53d1\u751f\u7684 Socket \u96c6\u5408\u4f20\u9012\u7ed9\u5e94\u7528\u7a0b\u5e8f\uff0c\u4e0d\u9700\u8981\u50cf select/poll \u90a3\u6837\u8f6e\u8be2\u626b\u63cf\u6574\u4e2a\u96c6\u5408\uff08\u5305\u542b\u6709\u548c\u65e0\u4e8b\u4ef6\u7684 Socket\uff09\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u68c0\u6d4b\u7684\u6548\u7387\u3002</li> </ul> <p>\u800c\u4e14\uff0cepoll \u652f\u6301\u8fb9\u7f18\u89e6\u53d1\u548c\u6c34\u5e73\u89e6\u53d1\u7684\u65b9\u5f0f\uff0c\u800c select/poll \u53ea\u652f\u6301\u6c34\u5e73\u89e6\u53d1\uff0c\u4e00\u822c\u800c\u8a00\uff0c\u8fb9\u7f18\u89e6\u53d1\u7684\u65b9\u5f0f\u4f1a\u6bd4\u6c34\u5e73\u89e6\u53d1\u7684\u6548\u7387\u9ad8\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/selete_poll_epoll/#_5","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/","title":"9.1 \u4ec0\u4e48\u662f\u96f6\u62f7\u8d1d\uff1f","text":"<p>\u78c1\u76d8\u53ef\u4ee5\u8bf4\u662f\u8ba1\u7b97\u673a\u7cfb\u7edf\u6700\u6162\u7684\u786c\u4ef6\u4e4b\u4e00\uff0c\u8bfb\u5199\u901f\u5ea6\u76f8\u5dee\u5185\u5b58 10 \u500d\u4ee5\u4e0a\uff0c\u6240\u4ee5\u9488\u5bf9\u4f18\u5316\u78c1\u76d8\u7684\u6280\u672f\u975e\u5e38\u7684\u591a\uff0c\u6bd4\u5982\u96f6\u62f7\u8d1d\u3001\u76f4\u63a5 I/O\u3001\u5f02\u6b65 I/O \u7b49\u7b49\uff0c\u8fd9\u4e9b\u4f18\u5316\u7684\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u63d0\u9ad8\u7cfb\u7edf\u7684\u541e\u5410\u91cf\uff0c\u53e6\u5916\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4e2d\u7684\u78c1\u76d8\u9ad8\u901f\u7f13\u5b58\u533a\uff0c\u53ef\u4ee5\u6709\u6548\u7684\u51cf\u5c11\u78c1\u76d8\u7684\u8bbf\u95ee\u6b21\u6570\u3002</p> <p>\u8fd9\u6b21\uff0c\u6211\u4eec\u5c31\u4ee5\u300c\u6587\u4ef6\u4f20\u8f93\u300d\u4f5c\u4e3a\u5207\u5165\u70b9\uff0c\u6765\u5206\u6790 I/O \u5de5\u4f5c\u65b9\u5f0f\uff0c\u4ee5\u53ca\u5982\u4f55\u4f18\u5316\u4f20\u8f93\u6587\u4ef6\u7684\u6027\u80fd\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#dma","title":"\u4e3a\u4ec0\u4e48\u8981\u6709 DMA \u6280\u672f\uff1f","text":"<p>\u5728\u6ca1\u6709 DMA \u6280\u672f\u524d\uff0cI/O \u7684\u8fc7\u7a0b\u662f\u8fd9\u6837\u7684\uff1a</p> <ul> <li>CPU \u53d1\u51fa\u5bf9\u5e94\u7684\u6307\u4ee4\u7ed9\u78c1\u76d8\u63a7\u5236\u5668\uff0c\u7136\u540e\u8fd4\u56de\uff1b</li> <li>\u78c1\u76d8\u63a7\u5236\u5668\u6536\u5230\u6307\u4ee4\u540e\uff0c\u4e8e\u662f\u5c31\u5f00\u59cb\u51c6\u5907\u6570\u636e\uff0c\u4f1a\u628a\u6570\u636e\u653e\u5165\u5230\u78c1\u76d8\u63a7\u5236\u5668\u7684\u5185\u90e8\u7f13\u51b2\u533a\u4e2d\uff0c\u7136\u540e\u4ea7\u751f\u4e00\u4e2a\u4e2d\u65ad\uff1b</li> <li>CPU \u6536\u5230\u4e2d\u65ad\u4fe1\u53f7\u540e\uff0c\u505c\u4e0b\u624b\u5934\u7684\u5de5\u4f5c\uff0c\u63a5\u7740\u628a\u78c1\u76d8\u63a7\u5236\u5668\u7684\u7f13\u51b2\u533a\u7684\u6570\u636e\u4e00\u6b21\u4e00\u4e2a\u5b57\u8282\u5730\u8bfb\u8fdb\u81ea\u5df1\u7684\u5bc4\u5b58\u5668\uff0c\u7136\u540e\u518d\u628a\u5bc4\u5b58\u5668\u91cc\u7684\u6570\u636e\u5199\u5165\u5230\u5185\u5b58\uff0c\u800c\u5728\u6570\u636e\u4f20\u8f93\u7684\u671f\u95f4 CPU \u662f\u65e0\u6cd5\u6267\u884c\u5176\u4ed6\u4efb\u52a1\u7684\u3002</li> </ul> <p>\u4e3a\u4e86\u65b9\u4fbf\u4f60\u7406\u89e3\uff0c\u6211\u753b\u4e86\u4e00\u526f\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4e2a\u6570\u636e\u7684\u4f20\u8f93\u8fc7\u7a0b\uff0c\u90fd\u8981\u9700\u8981 CPU \u4eb2\u81ea\u53c2\u4e0e\u642c\u8fd0\u6570\u636e\u7684\u8fc7\u7a0b\uff0c\u800c\u4e14\u8fd9\u4e2a\u8fc7\u7a0b\uff0cCPU \u662f\u4e0d\u80fd\u505a\u5176\u4ed6\u4e8b\u60c5\u7684\u3002</p> <p>\u7b80\u5355\u7684\u642c\u8fd0\u51e0\u4e2a\u5b57\u7b26\u6570\u636e\u90a3\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u5982\u679c\u6211\u4eec\u7528\u5343\u5146\u7f51\u5361\u6216\u8005\u786c\u76d8\u4f20\u8f93\u5927\u91cf\u6570\u636e\u7684\u65f6\u5019\uff0c\u90fd\u7528 CPU \u6765\u642c\u8fd0\u7684\u8bdd\uff0c\u80af\u5b9a\u5fd9\u4e0d\u8fc7\u6765\u3002</p> <p>\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6\u4eec\u53d1\u73b0\u4e86\u4e8b\u60c5\u7684\u4e25\u91cd\u6027\u540e\uff0c\u4e8e\u662f\u5c31\u53d1\u660e\u4e86 DMA \u6280\u672f\uff0c\u4e5f\u5c31\u662f\u76f4\u63a5\u5185\u5b58\u8bbf\u95ee\uff08Direct Memory Access\uff09 \u6280\u672f\u3002</p> <p>\u4ec0\u4e48\u662f DMA \u6280\u672f\uff1f\u7b80\u5355\u7406\u89e3\u5c31\u662f\uff0c\u5728\u8fdb\u884c I/O \u8bbe\u5907\u548c\u5185\u5b58\u7684\u6570\u636e\u4f20\u8f93\u7684\u65f6\u5019\uff0c\u6570\u636e\u642c\u8fd0\u7684\u5de5\u4f5c\u5168\u90e8\u4ea4\u7ed9 DMA \u63a7\u5236\u5668\uff0c\u800c CPU \u4e0d\u518d\u53c2\u4e0e\u4efb\u4f55\u4e0e\u6570\u636e\u642c\u8fd0\u76f8\u5173\u7684\u4e8b\u60c5\uff0c\u8fd9\u6837 CPU \u5c31\u53ef\u4ee5\u53bb\u5904\u7406\u522b\u7684\u4e8b\u52a1\u3002</p> <p>\u90a3\u4f7f\u7528 DMA \u63a7\u5236\u5668\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u7684\u8fc7\u7a0b\u7a76\u7adf\u662f\u4ec0\u4e48\u6837\u7684\u5462\uff1f\u4e0b\u9762\u6211\u4eec\u6765\u5177\u4f53\u770b\u770b\u3002</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u7528\u6237\u8fdb\u7a0b\u8c03\u7528 read \u65b9\u6cd5\uff0c\u5411\u64cd\u4f5c\u7cfb\u7edf\u53d1\u51fa I/O \u8bf7\u6c42\uff0c\u8bf7\u6c42\u8bfb\u53d6\u6570\u636e\u5230\u81ea\u5df1\u7684\u5185\u5b58\u7f13\u51b2\u533a\u4e2d\uff0c\u8fdb\u7a0b\u8fdb\u5165\u963b\u585e\u72b6\u6001\uff1b</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u8fdb\u4e00\u6b65\u5c06 I/O \u8bf7\u6c42\u53d1\u9001 DMA\uff0c\u7136\u540e\u8ba9 CPU \u6267\u884c\u5176\u4ed6\u4efb\u52a1\uff1b</li> <li>DMA \u8fdb\u4e00\u6b65\u5c06 I/O \u8bf7\u6c42\u53d1\u9001\u7ed9\u78c1\u76d8\uff1b</li> <li>\u78c1\u76d8\u6536\u5230 DMA \u7684 I/O \u8bf7\u6c42\uff0c\u628a\u6570\u636e\u4ece\u78c1\u76d8\u8bfb\u53d6\u5230\u78c1\u76d8\u63a7\u5236\u5668\u7684\u7f13\u51b2\u533a\u4e2d\uff0c\u5f53\u78c1\u76d8\u63a7\u5236\u5668\u7684\u7f13\u51b2\u533a\u88ab\u8bfb\u6ee1\u540e\uff0c\u5411 DMA \u53d1\u8d77\u4e2d\u65ad\u4fe1\u53f7\uff0c\u544a\u77e5\u81ea\u5df1\u7f13\u51b2\u533a\u5df2\u6ee1\uff1b</li> <li>DMA \u6536\u5230\u78c1\u76d8\u7684\u4fe1\u53f7\uff0c\u5c06\u78c1\u76d8\u63a7\u5236\u5668\u7f13\u51b2\u533a\u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\u4e2d\uff0c\u6b64\u65f6\u4e0d\u5360\u7528 CPU\uff0cCPU \u53ef\u4ee5\u6267\u884c\u5176\u4ed6\u4efb\u52a1\uff1b</li> <li>\u5f53 DMA \u8bfb\u53d6\u4e86\u8db3\u591f\u591a\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u53d1\u9001\u4e2d\u65ad\u4fe1\u53f7\u7ed9 CPU\uff1b</li> <li>CPU \u6536\u5230 DMA \u7684\u4fe1\u53f7\uff0c\u77e5\u9053\u6570\u636e\u5df2\u7ecf\u51c6\u5907\u597d\uff0c\u4e8e\u662f\u5c06\u6570\u636e\u4ece\u5185\u6838\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u7cfb\u7edf\u8c03\u7528\u8fd4\u56de\uff1b</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4e2a\u6570\u636e\u4f20\u8f93\u7684\u8fc7\u7a0b\uff0cCPU \u4e0d\u518d\u53c2\u4e0e\u6570\u636e\u642c\u8fd0\u7684\u5de5\u4f5c\uff0c\u800c\u662f\u5168\u7a0b\u7531 DMA \u5b8c\u6210\uff0c\u4f46\u662f CPU \u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u4e5f\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\uff0c\u56e0\u4e3a\u4f20\u8f93\u4ec0\u4e48\u6570\u636e\uff0c\u4ece\u54ea\u91cc\u4f20\u8f93\u5230\u54ea\u91cc\uff0c\u90fd\u9700\u8981 CPU \u6765\u544a\u8bc9 DMA \u63a7\u5236\u5668\u3002</p> <p>\u65e9\u671f DMA \u53ea\u5b58\u5728\u5728\u4e3b\u677f\u4e0a\uff0c\u5982\u4eca\u7531\u4e8e I/O \u8bbe\u5907\u8d8a\u6765\u8d8a\u591a\uff0c\u6570\u636e\u4f20\u8f93\u7684\u9700\u6c42\u4e5f\u4e0d\u5c3d\u76f8\u540c\uff0c\u6240\u4ee5\u6bcf\u4e2a I/O \u8bbe\u5907\u91cc\u9762\u90fd\u6709\u81ea\u5df1\u7684 DMA \u63a7\u5236\u5668\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#_1","title":"\u4f20\u7edf\u7684\u6587\u4ef6\u4f20\u8f93\u6709\u591a\u7cdf\u7cd5\uff1f","text":"<p>\u5982\u679c\u670d\u52a1\u7aef\u8981\u63d0\u4f9b\u6587\u4ef6\u4f20\u8f93\u7684\u529f\u80fd\uff0c\u6211\u4eec\u80fd\u60f3\u5230\u7684\u6700\u7b80\u5355\u7684\u65b9\u5f0f\u662f\uff1a\u5c06\u78c1\u76d8\u4e0a\u7684\u6587\u4ef6\u8bfb\u53d6\u51fa\u6765\uff0c\u7136\u540e\u901a\u8fc7\u7f51\u7edc\u534f\u8bae\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>\u4f20\u7edf I/O \u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\uff0c\u6570\u636e\u8bfb\u53d6\u548c\u5199\u5165\u662f\u4ece\u7528\u6237\u7a7a\u95f4\u5230\u5185\u6838\u7a7a\u95f4\u6765\u56de\u590d\u5236\uff0c\u800c\u5185\u6838\u7a7a\u95f4\u7684\u6570\u636e\u662f\u901a\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u5c42\u9762\u7684 I/O \u63a5\u53e3\u4ece\u78c1\u76d8\u8bfb\u53d6\u6216\u5199\u5165\u3002</p> <p>\u4ee3\u7801\u901a\u5e38\u5982\u4e0b\uff0c\u4e00\u822c\u4f1a\u9700\u8981\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\uff1a</p> C<pre><code>read(file, tmp_buf, len);\nwrite(socket, tmp_buf, len);\n</code></pre> <p>\u4ee3\u7801\u5f88\u7b80\u5355\uff0c\u867d\u7136\u5c31\u4e24\u884c\u4ee3\u7801\uff0c\u4f46\u662f\u8fd9\u91cc\u9762\u53d1\u751f\u4e86\u4e0d\u5c11\u7684\u4e8b\u60c5\u3002</p> <p></p> <p>\u9996\u5148\uff0c\u671f\u95f4\u5171\u53d1\u751f\u4e86 4 \u6b21\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u7684\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u56e0\u4e3a\u53d1\u751f\u4e86\u4e24\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u4e00\u6b21\u662f <code>read()</code> \uff0c\u4e00\u6b21\u662f <code>write()</code>\uff0c\u6bcf\u6b21\u7cfb\u7edf\u8c03\u7528\u90fd\u5f97\u5148\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u7b49\u5185\u6838\u5b8c\u6210\u4efb\u52a1\u540e\uff0c\u518d\u4ece\u5185\u6838\u6001\u5207\u6362\u56de\u7528\u6237\u6001\u3002</p> <p>\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6210\u672c\u5e76\u4e0d\u5c0f\uff0c\u4e00\u6b21\u5207\u6362\u9700\u8981\u8017\u65f6\u51e0\u5341\u7eb3\u79d2\u5230\u51e0\u5fae\u79d2\uff0c\u867d\u7136\u65f6\u95f4\u770b\u4e0a\u53bb\u5f88\u77ed\uff0c\u4f46\u662f\u5728\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u4e0b\uff0c\u8fd9\u7c7b\u65f6\u95f4\u5bb9\u6613\u88ab\u7d2f\u79ef\u548c\u653e\u5927\uff0c\u4ece\u800c\u5f71\u54cd\u7cfb\u7edf\u7684\u6027\u80fd\u3002</p> <p>\u5176\u6b21\uff0c\u8fd8\u53d1\u751f\u4e86 4 \u6b21\u6570\u636e\u62f7\u8d1d\uff0c\u5176\u4e2d\u4e24\u6b21\u662f DMA \u7684\u62f7\u8d1d\uff0c\u53e6\u5916\u4e24\u6b21\u5219\u662f\u901a\u8fc7 CPU \u62f7\u8d1d\u7684\uff0c\u4e0b\u9762\u8bf4\u4e00\u4e0b\u8fd9\u4e2a\u8fc7\u7a0b\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b21\u62f7\u8d1d\uff0c\u628a\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u62f7\u8d1d\u5230\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7684\u7f13\u51b2\u533a\u91cc\uff0c\u8fd9\u4e2a\u62f7\u8d1d\u7684\u8fc7\u7a0b\u662f\u901a\u8fc7 DMA \u642c\u8fd0\u7684\u3002</li> <li>\u7b2c\u4e8c\u6b21\u62f7\u8d1d\uff0c\u628a\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u7684\u7f13\u51b2\u533a\u91cc\uff0c\u4e8e\u662f\u6211\u4eec\u5e94\u7528\u7a0b\u5e8f\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd9\u90e8\u5206\u6570\u636e\u4e86\uff0c\u8fd9\u4e2a\u62f7\u8d1d\u5230\u8fc7\u7a0b\u662f\u7531 CPU \u5b8c\u6210\u7684\u3002</li> <li>\u7b2c\u4e09\u6b21\u62f7\u8d1d\uff0c\u628a\u521a\u624d\u62f7\u8d1d\u5230\u7528\u6237\u7684\u7f13\u51b2\u533a\u91cc\u7684\u6570\u636e\uff0c\u518d\u62f7\u8d1d\u5230\u5185\u6838\u7684 socket \u7684\u7f13\u51b2\u533a\u91cc\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4f9d\u7136\u8fd8\u662f\u7531 CPU \u642c\u8fd0\u7684\u3002</li> <li>\u7b2c\u56db\u6b21\u62f7\u8d1d\uff0c\u628a\u5185\u6838\u7684 socket \u7f13\u51b2\u533a\u91cc\u7684\u6570\u636e\uff0c\u62f7\u8d1d\u5230\u7f51\u5361\u7684\u7f13\u51b2\u533a\u91cc\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u53c8\u662f\u7531 DMA \u642c\u8fd0\u7684\u3002</li> </ul> <p>\u6211\u4eec\u56de\u8fc7\u5934\u770b\u8fd9\u4e2a\u6587\u4ef6\u4f20\u8f93\u7684\u8fc7\u7a0b\uff0c\u6211\u4eec\u53ea\u662f\u642c\u8fd0\u4e00\u4efd\u6570\u636e\uff0c\u7ed3\u679c\u5374\u642c\u8fd0\u4e86 4 \u6b21\uff0c\u8fc7\u591a\u7684\u6570\u636e\u62f7\u8d1d\u65e0\u7591\u4f1a\u6d88\u8017 CPU \u8d44\u6e90\uff0c\u5927\u5927\u964d\u4f4e\u4e86\u7cfb\u7edf\u6027\u80fd\u3002</p> <p>\u8fd9\u79cd\u7b80\u5355\u53c8\u4f20\u7edf\u7684\u6587\u4ef6\u4f20\u8f93\u65b9\u5f0f\uff0c\u5b58\u5728\u5197\u4f59\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u6570\u636e\u62f7\u8d1d\uff0c\u5728\u9ad8\u5e76\u53d1\u7cfb\u7edf\u91cc\u662f\u975e\u5e38\u7cdf\u7cd5\u7684\uff0c\u591a\u4e86\u5f88\u591a\u4e0d\u5fc5\u8981\u7684\u5f00\u9500\uff0c\u4f1a\u4e25\u91cd\u5f71\u54cd\u7cfb\u7edf\u6027\u80fd\u3002</p> <p>\u6240\u4ee5\uff0c\u8981\u60f3\u63d0\u9ad8\u6587\u4ef6\u4f20\u8f93\u7684\u6027\u80fd\uff0c\u5c31\u9700\u8981\u51cf\u5c11\u300c\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u300d\u548c\u300c\u5185\u5b58\u62f7\u8d1d\u300d\u7684\u6b21\u6570\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#_2","title":"\u5982\u4f55\u4f18\u5316\u6587\u4ef6\u4f20\u8f93\u7684\u6027\u80fd\uff1f","text":"<p>\u5148\u6765\u770b\u770b\uff0c\u5982\u4f55\u51cf\u5c11\u300c\u7528\u6237\u6001\u4e0e\u5185\u6838\u6001\u7684\u4e0a\u4e0b\u6587\u5207\u6362\u300d\u7684\u6b21\u6570\u5462\uff1f</p> <p>\u8bfb\u53d6\u78c1\u76d8\u6570\u636e\u7684\u65f6\u5019\uff0c\u4e4b\u6240\u4ee5\u8981\u53d1\u751f\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u8fd9\u662f\u56e0\u4e3a\u7528\u6237\u7a7a\u95f4\u6ca1\u6709\u6743\u9650\u64cd\u4f5c\u78c1\u76d8\u6216\u7f51\u5361\uff0c\u5185\u6838\u7684\u6743\u9650\u6700\u9ad8\uff0c\u8fd9\u4e9b\u64cd\u4f5c\u8bbe\u5907\u7684\u8fc7\u7a0b\u90fd\u9700\u8981\u4ea4\u7531\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u6765\u5b8c\u6210\uff0c\u6240\u4ee5\u4e00\u822c\u8981\u901a\u8fc7\u5185\u6838\u53bb\u5b8c\u6210\u67d0\u4e9b\u4efb\u52a1\u7684\u65f6\u5019\uff0c\u5c31\u9700\u8981\u4f7f\u7528\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002</p> <p>\u800c\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\u5fc5\u7136\u4f1a\u53d1\u751f 2 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff1a\u9996\u5148\u4ece\u7528\u6237\u6001\u5207\u6362\u5230\u5185\u6838\u6001\uff0c\u5f53\u5185\u6838\u6267\u884c\u5b8c\u4efb\u52a1\u540e\uff0c\u518d\u5207\u6362\u56de\u7528\u6237\u6001\u4ea4\u7531\u8fdb\u7a0b\u4ee3\u7801\u6267\u884c\u3002</p> <p>\u6240\u4ee5\uff0c\u8981\u60f3\u51cf\u5c11\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6b21\u6570\uff0c\u5c31\u8981\u51cf\u5c11\u7cfb\u7edf\u8c03\u7528\u7684\u6b21\u6570\u3002</p> <p>\u518d\u6765\u770b\u770b\uff0c\u5982\u4f55\u51cf\u5c11\u300c\u6570\u636e\u62f7\u8d1d\u300d\u7684\u6b21\u6570\uff1f</p> <p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u4f20\u7edf\u7684\u6587\u4ef6\u4f20\u8f93\u65b9\u5f0f\u4f1a\u5386\u7ecf 4 \u6b21\u6570\u636e\u62f7\u8d1d\uff0c\u800c\u4e14\u8fd9\u91cc\u9762\uff0c\u300c\u4ece\u5185\u6838\u7684\u8bfb\u7f13\u51b2\u533a\u62f7\u8d1d\u5230\u7528\u6237\u7684\u7f13\u51b2\u533a\u91cc\uff0c\u518d\u4ece\u7528\u6237\u7684\u7f13\u51b2\u533a\u91cc\u62f7\u8d1d\u5230 socket \u7684\u7f13\u51b2\u533a\u91cc\u300d\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u6ca1\u6709\u5fc5\u8981\u7684\u3002</p> <p>\u56e0\u4e3a\u6587\u4ef6\u4f20\u8f93\u7684\u5e94\u7528\u573a\u666f\u4e2d\uff0c\u5728\u7528\u6237\u7a7a\u95f4\u6211\u4eec\u5e76\u4e0d\u4f1a\u5bf9\u6570\u636e\u300c\u518d\u52a0\u5de5\u300d\uff0c\u6240\u4ee5\u6570\u636e\u5b9e\u9645\u4e0a\u53ef\u4ee5\u4e0d\u7528\u642c\u8fd0\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u56e0\u6b64\u7528\u6237\u7684\u7f13\u51b2\u533a\u662f\u6ca1\u6709\u5fc5\u8981\u5b58\u5728\u7684\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#_3","title":"\u5982\u4f55\u5b9e\u73b0\u96f6\u62f7\u8d1d\uff1f","text":"<p>\u96f6\u62f7\u8d1d\u6280\u672f\u5b9e\u73b0\u7684\u65b9\u5f0f\u901a\u5e38\u6709 2 \u79cd\uff1a</p> <ul> <li>mmap + write</li> <li>sendfile</li> </ul> <p>\u4e0b\u9762\u5c31\u8c08\u4e00\u8c08\uff0c\u5b83\u4eec\u662f\u5982\u4f55\u51cf\u5c11\u300c\u4e0a\u4e0b\u6587\u5207\u6362\u300d\u548c\u300c\u6570\u636e\u62f7\u8d1d\u300d\u7684\u6b21\u6570\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#mmap-write","title":"mmap + write","text":"<p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\uff0c<code>read()</code> \u7cfb\u7edf\u8c03\u7528\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u628a\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u7684\u7f13\u51b2\u533a\u91cc\uff0c\u4e8e\u662f\u4e3a\u4e86\u51cf\u5c11\u8fd9\u4e00\u6b65\u5f00\u9500\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 <code>mmap()</code> \u66ff\u6362 <code>read()</code> \u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002</p> C<pre><code>buf = mmap(file, len);\nwrite(sockfd, buf, len);\n</code></pre> <p><code>mmap()</code> \u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u4f1a\u76f4\u63a5\u628a\u5185\u6838\u7f13\u51b2\u533a\u91cc\u7684\u6570\u636e\u300c\u6620\u5c04\u300d\u5230\u7528\u6237\u7a7a\u95f4\uff0c\u8fd9\u6837\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u4e0e\u7528\u6237\u7a7a\u95f4\u5c31\u4e0d\u9700\u8981\u518d\u8fdb\u884c\u4efb\u4f55\u7684\u6570\u636e\u62f7\u8d1d\u64cd\u4f5c\u3002</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5e94\u7528\u8fdb\u7a0b\u8c03\u7528\u4e86 <code>mmap()</code> \u540e\uff0cDMA \u4f1a\u628a\u78c1\u76d8\u7684\u6570\u636e\u62f7\u8d1d\u5230\u5185\u6838\u7684\u7f13\u51b2\u533a\u91cc\u3002\u63a5\u7740\uff0c\u5e94\u7528\u8fdb\u7a0b\u8ddf\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u300c\u5171\u4eab\u300d\u8fd9\u4e2a\u7f13\u51b2\u533a\uff1b</li> <li>\u5e94\u7528\u8fdb\u7a0b\u518d\u8c03\u7528 <code>write()</code>\uff0c\u64cd\u4f5c\u7cfb\u7edf\u76f4\u63a5\u5c06\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u62f7\u8d1d\u5230 socket \u7f13\u51b2\u533a\u4e2d\uff0c\u8fd9\u4e00\u5207\u90fd\u53d1\u751f\u5728\u5185\u6838\u6001\uff0c\u7531 CPU \u6765\u642c\u8fd0\u6570\u636e\uff1b</li> <li>\u6700\u540e\uff0c\u628a\u5185\u6838\u7684 socket \u7f13\u51b2\u533a\u91cc\u7684\u6570\u636e\uff0c\u62f7\u8d1d\u5230\u7f51\u5361\u7684\u7f13\u51b2\u533a\u91cc\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u7531 DMA \u642c\u8fd0\u7684\u3002</li> </ul> <p>\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\uff0c\u901a\u8fc7\u4f7f\u7528 <code>mmap()</code> \u6765\u4ee3\u66ff <code>read()</code>\uff0c\u53ef\u4ee5\u51cf\u5c11\u4e00\u6b21\u6570\u636e\u62f7\u8d1d\u7684\u8fc7\u7a0b\u3002</p> <p>\u4f46\u8fd9\u8fd8\u4e0d\u662f\u6700\u7406\u60f3\u7684\u96f6\u62f7\u8d1d\uff0c\u56e0\u4e3a\u4ecd\u7136\u9700\u8981\u901a\u8fc7 CPU \u628a\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u62f7\u8d1d\u5230 socket \u7f13\u51b2\u533a\u91cc\uff0c\u800c\u4e14\u4ecd\u7136\u9700\u8981 4 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u56e0\u4e3a\u7cfb\u7edf\u8c03\u7528\u8fd8\u662f 2 \u6b21\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#sendfile","title":"sendfile","text":"<p>\u5728 Linux \u5185\u6838\u7248\u672c 2.1 \u4e2d\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u4e13\u95e8\u53d1\u9001\u6587\u4ef6\u7684\u7cfb\u7edf\u8c03\u7528\u51fd\u6570 <code>sendfile()</code>\uff0c\u51fd\u6570\u5f62\u5f0f\u5982\u4e0b\uff1a</p> C<pre><code>#include &lt;sys/socket.h&gt;\nssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count);\n</code></pre> <p>\u5b83\u7684\u524d\u4e24\u4e2a\u53c2\u6570\u5206\u522b\u662f\u76ee\u7684\u7aef\u548c\u6e90\u7aef\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff0c\u540e\u9762\u4e24\u4e2a\u53c2\u6570\u662f\u6e90\u7aef\u7684\u504f\u79fb\u91cf\u548c\u590d\u5236\u6570\u636e\u7684\u957f\u5ea6\uff0c\u8fd4\u56de\u503c\u662f\u5b9e\u9645\u590d\u5236\u6570\u636e\u7684\u957f\u5ea6\u3002</p> <p>\u9996\u5148\uff0c\u5b83\u53ef\u4ee5\u66ff\u4ee3\u524d\u9762\u7684 <code>read()</code> \u548c <code>write()</code> \u8fd9\u4e24\u4e2a\u7cfb\u7edf\u8c03\u7528\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\uff0c\u4e5f\u5c31\u51cf\u5c11\u4e86 2 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u5f00\u9500\u3002</p> <p>\u5176\u6b21\uff0c\u8be5\u7cfb\u7edf\u8c03\u7528\uff0c\u53ef\u4ee5\u76f4\u63a5\u628a\u5185\u6838\u7f13\u51b2\u533a\u91cc\u7684\u6570\u636e\u62f7\u8d1d\u5230 socket \u7f13\u51b2\u533a\u91cc\uff0c\u4e0d\u518d\u62f7\u8d1d\u5230\u7528\u6237\u6001\uff0c\u8fd9\u6837\u5c31\u53ea\u6709 2 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u548c 3 \u6b21\u6570\u636e\u62f7\u8d1d\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4f46\u662f\u8fd9\u8fd8\u4e0d\u662f\u771f\u6b63\u7684\u96f6\u62f7\u8d1d\u6280\u672f\uff0c\u5982\u679c\u7f51\u5361\u652f\u6301 SG-DMA\uff08The Scatter-Gather Direct Memory Access\uff09\u6280\u672f\uff08\u548c\u666e\u901a\u7684 DMA \u6709\u6240\u4e0d\u540c\uff09\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u51cf\u5c11\u901a\u8fc7 CPU \u628a\u5185\u6838\u7f13\u51b2\u533a\u91cc\u7684\u6570\u636e\u62f7\u8d1d\u5230 socket \u7f13\u51b2\u533a\u7684\u8fc7\u7a0b\u3002</p> <p>\u4f60\u53ef\u4ee5\u5728\u4f60\u7684 Linux \u7cfb\u7edf\u901a\u8fc7\u4e0b\u9762\u8fd9\u4e2a\u547d\u4ee4\uff0c\u67e5\u770b\u7f51\u5361\u662f\u5426\u652f\u6301 scatter-gather \u7279\u6027\uff1a</p> Bash<pre><code>$ ethtool -k eth0 | grep scatter-gather\nscatter-gather: on\n</code></pre> <p>\u4e8e\u662f\uff0c\u4ece Linux \u5185\u6838 <code>2.4</code> \u7248\u672c\u5f00\u59cb\u8d77\uff0c\u5bf9\u4e8e\u652f\u6301 SG-DMA \u6280\u672f\u7684\u7f51\u5361\uff0c <code>sendfile()</code> \u7cfb\u7edf\u8c03\u7528\u7684\u8fc7\u7a0b\u53d1\u751f\u4e86\u70b9\u53d8\u5316\uff0c\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b65\uff0c\u901a\u8fc7 DMA \u5c06\u78c1\u76d8\u4e0a\u7684\u6570\u636e\u62f7\u8d1d\u5230\u5185\u6838\u7f13\u51b2\u533a\u91cc\uff1b</li> <li>\u7b2c\u4e8c\u6b65\uff0c\u7f13\u51b2\u533a\u63cf\u8ff0\u7b26\u548c\u6570\u636e\u957f\u5ea6\u4f20\u5230 socket \u7f13\u51b2\u533a\uff0c\u8fd9\u6837\u7f51\u5361\u7684 SG-DMA \u63a7\u5236\u5668\u5c31\u53ef\u4ee5\u76f4\u63a5\u5c06\u5185\u6838\u7f13\u5b58\u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7f51\u5361\u7684\u7f13\u51b2\u533a\u91cc\uff0c\u6b64\u8fc7\u7a0b\u4e0d\u9700\u8981\u5c06\u6570\u636e\u4ece\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u7f13\u51b2\u533a\u62f7\u8d1d\u5230 socket \u7f13\u51b2\u533a\u4e2d\uff0c\u8fd9\u6837\u5c31\u51cf\u5c11\u4e86\u4e00\u6b21\u6570\u636e\u62f7\u8d1d\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u4e4b\u4e2d\uff0c\u53ea\u8fdb\u884c\u4e86 2 \u6b21\u6570\u636e\u62f7\u8d1d\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u96f6\u62f7\u8d1d\uff08Zero-copy\uff09\u6280\u672f\uff0c\u56e0\u4e3a\u6211\u4eec\u6ca1\u6709\u5728\u5185\u5b58\u5c42\u9762\u53bb\u62f7\u8d1d\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u8bf4\u5168\u7a0b\u6ca1\u6709\u901a\u8fc7 CPU \u6765\u642c\u8fd0\u6570\u636e\uff0c\u6240\u6709\u7684\u6570\u636e\u90fd\u662f\u901a\u8fc7 DMA \u6765\u8fdb\u884c\u4f20\u8f93\u7684\u3002</p> <p>\u96f6\u62f7\u8d1d\u6280\u672f\u7684\u6587\u4ef6\u4f20\u8f93\u65b9\u5f0f\u76f8\u6bd4\u4f20\u7edf\u6587\u4ef6\u4f20\u8f93\u7684\u65b9\u5f0f\uff0c\u51cf\u5c11\u4e86 2 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u6570\u636e\u62f7\u8d1d\u6b21\u6570\uff0c\u53ea\u9700\u8981 2 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\u548c\u6570\u636e\u62f7\u8d1d\u6b21\u6570\uff0c\u5c31\u53ef\u4ee5\u5b8c\u6210\u6587\u4ef6\u7684\u4f20\u8f93\uff0c\u800c\u4e14 2 \u6b21\u7684\u6570\u636e\u62f7\u8d1d\u8fc7\u7a0b\uff0c\u90fd\u4e0d\u9700\u8981\u901a\u8fc7 CPU\uff0c2 \u6b21\u90fd\u662f\u7531 DMA \u6765\u642c\u8fd0\u3002</p> <p>\u6240\u4ee5\uff0c\u603b\u4f53\u6765\u770b\uff0c\u96f6\u62f7\u8d1d\u6280\u672f\u53ef\u4ee5\u628a\u6587\u4ef6\u4f20\u8f93\u7684\u6027\u80fd\u63d0\u9ad8\u81f3\u5c11\u4e00\u500d\u4ee5\u4e0a\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#_4","title":"\u4f7f\u7528\u96f6\u62f7\u8d1d\u6280\u672f\u7684\u9879\u76ee","text":"<p>\u4e8b\u5b9e\u4e0a\uff0cKafka \u8fd9\u4e2a\u5f00\u6e90\u9879\u76ee\uff0c\u5c31\u5229\u7528\u4e86\u300c\u96f6\u62f7\u8d1d\u300d\u6280\u672f\uff0c\u4ece\u800c\u5927\u5e45\u63d0\u5347\u4e86 I/O \u7684\u541e\u5410\u7387\uff0c\u8fd9\u4e5f\u662f Kafka \u5728\u5904\u7406\u6d77\u91cf\u6570\u636e\u4e3a\u4ec0\u4e48\u8fd9\u4e48\u5feb\u7684\u539f\u56e0\u4e4b\u4e00\u3002</p> <p>\u5982\u679c\u4f60\u8ffd\u6eaf Kafka \u6587\u4ef6\u4f20\u8f93\u7684\u4ee3\u7801\uff0c\u4f60\u4f1a\u53d1\u73b0\uff0c\u6700\u7ec8\u5b83\u8c03\u7528\u4e86 Java NIO \u5e93\u91cc\u7684 <code>transferTo</code> \u65b9\u6cd5\uff1a</p> Java<pre><code>@Override\npublic long transferFrom(FileChannel fileChannel, long position, long count) throws IOException { \n    return fileChannel.transferTo(position, count, socketChannel);\n}\n</code></pre> <p>\u5982\u679c Linux \u7cfb\u7edf\u652f\u6301 <code>sendfile()</code> \u7cfb\u7edf\u8c03\u7528\uff0c\u90a3\u4e48 <code>transferTo()</code> \u5b9e\u9645\u4e0a\u6700\u540e\u5c31\u4f1a\u4f7f\u7528\u5230 <code>sendfile()</code> \u7cfb\u7edf\u8c03\u7528\u51fd\u6570\u3002</p> <p>\u66fe\u7ecf\u6709\u5927\u4f6c\u4e13\u95e8\u5199\u8fc7\u7a0b\u5e8f\u6d4b\u8bd5\u8fc7\uff0c\u5728\u540c\u6837\u7684\u786c\u4ef6\u6761\u4ef6\u4e0b\uff0c\u4f20\u7edf\u6587\u4ef6\u4f20\u8f93\u548c\u96f6\u62f7\u62f7\u8d1d\u6587\u4ef6\u4f20\u8f93\u7684\u6027\u80fd\u5dee\u5f02\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u4e0b\u9762\u8fd9\u5f20\u6d4b\u8bd5\u6570\u636e\u56fe\uff0c\u4f7f\u7528\u4e86\u96f6\u62f7\u8d1d\u80fd\u591f\u7f29\u77ed <code>65%</code> \u7684\u65f6\u95f4\uff0c\u5927\u5e45\u5ea6\u63d0\u5347\u4e86\u673a\u5668\u4f20\u8f93\u6570\u636e\u7684\u541e\u5410\u91cf\u3002</p> <p></p> <p>\u53e6\u5916\uff0cNginx \u4e5f\u652f\u6301\u96f6\u62f7\u8d1d\u6280\u672f\uff0c\u4e00\u822c\u9ed8\u8ba4\u662f\u5f00\u542f\u96f6\u62f7\u8d1d\u6280\u672f\uff0c\u8fd9\u6837\u6709\u5229\u4e8e\u63d0\u9ad8\u6587\u4ef6\u4f20\u8f93\u7684\u6548\u7387\uff0c\u662f\u5426\u5f00\u542f\u96f6\u62f7\u8d1d\u6280\u672f\u7684\u914d\u7f6e\u5982\u4e0b\uff1a</p> Text Only<pre><code>http {\n...\n    sendfile on\n...\n}\n</code></pre> <p>sendfile \u914d\u7f6e\u7684\u5177\u4f53\u610f\u601d\uff1a</p> <ul> <li>\u8bbe\u7f6e\u4e3a on \u8868\u793a\uff0c\u4f7f\u7528\u96f6\u62f7\u8d1d\u6280\u672f\u6765\u4f20\u8f93\u6587\u4ef6\uff1asendfile\uff0c\u8fd9\u6837\u53ea\u9700\u8981 2 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u548c 2 \u6b21\u6570\u636e\u62f7\u8d1d\u3002</li> <li>\u8bbe\u7f6e\u4e3a off \u8868\u793a\uff0c\u4f7f\u7528\u4f20\u7edf\u7684\u6587\u4ef6\u4f20\u8f93\u6280\u672f\uff1aread + write\uff0c\u8fd9\u65f6\u5c31\u9700\u8981 4 \u6b21\u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u548c 4 \u6b21\u6570\u636e\u62f7\u8d1d\u3002</li> </ul> <p>\u5f53\u7136\uff0c\u8981\u4f7f\u7528 sendfile\uff0cLinux \u5185\u6838\u7248\u672c\u5fc5\u987b\u8981 2.1 \u4ee5\u4e0a\u7684\u7248\u672c\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#pagecache","title":"PageCache \u6709\u4ec0\u4e48\u4f5c\u7528\uff1f","text":"<p>\u56de\u987e\u524d\u9762\u8bf4\u9053\u6587\u4ef6\u4f20\u8f93\u8fc7\u7a0b\uff0c\u5176\u4e2d\u7b2c\u4e00\u6b65\u90fd\u662f\u5148\u9700\u8981\u5148\u628a\u78c1\u76d8\u6587\u4ef6\u6570\u636e\u62f7\u8d1d\u300c\u5185\u6838\u7f13\u51b2\u533a\u300d\u91cc\uff0c\u8fd9\u4e2a\u300c\u5185\u6838\u7f13\u51b2\u533a\u300d\u5b9e\u9645\u4e0a\u662f\u78c1\u76d8\u9ad8\u901f\u7f13\u5b58\uff08PageCache\uff09\u3002</p> <p>\u7531\u4e8e\u96f6\u62f7\u8d1d\u4f7f\u7528\u4e86 PageCache \u6280\u672f\uff0c\u53ef\u4ee5\u4f7f\u5f97\u96f6\u62f7\u8d1d\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u6027\u80fd\uff0c\u6211\u4eec\u63a5\u4e0b\u6765\u770b\u770b PageCache \u662f\u5982\u4f55\u505a\u5230\u8fd9\u4e00\u70b9\u7684\u3002</p> <p>\u8bfb\u5199\u78c1\u76d8\u76f8\u6bd4\u8bfb\u5199\u5185\u5b58\u7684\u901f\u5ea6\u6162\u592a\u591a\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5e94\u8be5\u60f3\u529e\u6cd5\u628a\u300c\u8bfb\u5199\u78c1\u76d8\u300d\u66ff\u6362\u6210\u300c\u8bfb\u5199\u5185\u5b58\u300d\u3002\u4e8e\u662f\uff0c\u6211\u4eec\u4f1a\u901a\u8fc7 DMA \u628a\u78c1\u76d8\u91cc\u7684\u6570\u636e\u642c\u8fd0\u5230\u5185\u5b58\u91cc\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u7528\u8bfb\u5185\u5b58\u66ff\u6362\u8bfb\u78c1\u76d8\u3002</p> <p>\u4f46\u662f\uff0c\u5185\u5b58\u7a7a\u95f4\u8fdc\u6bd4\u78c1\u76d8\u8981\u5c0f\uff0c\u5185\u5b58\u6ce8\u5b9a\u53ea\u80fd\u62f7\u8d1d\u78c1\u76d8\u91cc\u7684\u4e00\u5c0f\u90e8\u5206\u6570\u636e\u3002</p> <p>\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u9009\u62e9\u54ea\u4e9b\u78c1\u76d8\u6570\u636e\u62f7\u8d1d\u5230\u5185\u5b58\u5462\uff1f</p> <p>\u6211\u4eec\u90fd\u77e5\u9053\u7a0b\u5e8f\u8fd0\u884c\u7684\u65f6\u5019\uff0c\u5177\u6709\u300c\u5c40\u90e8\u6027\u300d\uff0c\u6240\u4ee5\u901a\u5e38\uff0c\u521a\u88ab\u8bbf\u95ee\u7684\u6570\u636e\u5728\u77ed\u65f6\u95f4\u5185\u518d\u6b21\u88ab\u8bbf\u95ee\u7684\u6982\u7387\u5f88\u9ad8\uff0c\u4e8e\u662f\u6211\u4eec\u53ef\u4ee5\u7528 PageCache \u6765\u7f13\u5b58\u6700\u8fd1\u88ab\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u5f53\u7a7a\u95f4\u4e0d\u8db3\u65f6\u6dd8\u6c70\u6700\u4e45\u672a\u88ab\u8bbf\u95ee\u7684\u7f13\u5b58\u3002</p> <p>\u6240\u4ee5\uff0c\u8bfb\u78c1\u76d8\u6570\u636e\u7684\u65f6\u5019\uff0c\u4f18\u5148\u5728 PageCache \u627e\uff0c\u5982\u679c\u6570\u636e\u5b58\u5728\u5219\u53ef\u4ee5\u76f4\u63a5\u8fd4\u56de\uff1b\u5982\u679c\u6ca1\u6709\uff0c\u5219\u4ece\u78c1\u76d8\u4e2d\u8bfb\u53d6\uff0c\u7136\u540e\u7f13\u5b58\u5230 PageCache \u4e2d\u3002</p> <p>\u8fd8\u6709\u4e00\u70b9\uff0c\u8bfb\u53d6\u78c1\u76d8\u6570\u636e\u7684\u65f6\u5019\uff0c\u9700\u8981\u627e\u5230\u6570\u636e\u6240\u5728\u7684\u4f4d\u7f6e\uff0c\u4f46\u662f\u5bf9\u4e8e\u673a\u68b0\u78c1\u76d8\u6765\u8bf4\uff0c\u5c31\u662f\u901a\u8fc7\u78c1\u5934\u65cb\u8f6c\u5230\u6570\u636e\u6240\u5728\u7684\u6247\u533a\uff0c\u518d\u5f00\u59cb\u300c\u987a\u5e8f\u300d\u8bfb\u53d6\u6570\u636e\uff0c\u4f46\u662f\u65cb\u8f6c\u78c1\u5934\u8fd9\u4e2a\u7269\u7406\u52a8\u4f5c\u662f\u975e\u5e38\u8017\u65f6\u7684\uff0c\u4e3a\u4e86\u964d\u4f4e\u5b83\u7684\u5f71\u54cd\uff0cPageCache \u4f7f\u7528\u4e86\u300c\u9884\u8bfb\u529f\u80fd\u300d\u3002</p> <p>\u6bd4\u5982\uff0c\u5047\u8bbe read \u65b9\u6cd5\u6bcf\u6b21\u53ea\u4f1a\u8bfb <code>32 KB</code> \u7684\u5b57\u8282\uff0c\u867d\u7136 read \u521a\u5f00\u59cb\u53ea\u4f1a\u8bfb 0 \uff5e 32 KB \u7684\u5b57\u8282\uff0c\u4f46\u5185\u6838\u4f1a\u628a\u5176\u540e\u9762\u7684 32\uff5e64 KB \u4e5f\u8bfb\u53d6\u5230 PageCache\uff0c\u8fd9\u6837\u540e\u9762\u8bfb\u53d6 32\uff5e64 KB \u7684\u6210\u672c\u5c31\u5f88\u4f4e\uff0c\u5982\u679c\u5728 32\uff5e64 KB \u6dd8\u6c70\u51fa PageCache \u524d\uff0c\u8fdb\u7a0b\u8bfb\u53d6\u5230\u5b83\u4e86\uff0c\u6536\u76ca\u5c31\u975e\u5e38\u5927\u3002</p> <p>\u6240\u4ee5\uff0cPageCache \u7684\u4f18\u70b9\u4e3b\u8981\u662f\u4e24\u4e2a\uff1a</p> <ul> <li>\u7f13\u5b58\u6700\u8fd1\u88ab\u8bbf\u95ee\u7684\u6570\u636e\uff1b</li> <li>\u9884\u8bfb\u529f\u80fd\uff1b</li> </ul> <p>\u8fd9\u4e24\u4e2a\u505a\u6cd5\uff0c\u5c06\u5927\u5927\u63d0\u9ad8\u8bfb\u5199\u78c1\u76d8\u7684\u6027\u80fd\u3002</p> <p>\u4f46\u662f\uff0c\u5728\u4f20\u8f93\u5927\u6587\u4ef6\uff08GB \u7ea7\u522b\u7684\u6587\u4ef6\uff09\u7684\u65f6\u5019\uff0cPageCache \u4f1a\u4e0d\u8d77\u4f5c\u7528\uff0c\u90a3\u5c31\u767d\u767d\u6d6a\u8d39 DMA \u591a\u505a\u7684\u4e00\u6b21\u6570\u636e\u62f7\u8d1d\uff0c\u9020\u6210\u6027\u80fd\u7684\u964d\u4f4e\uff0c\u5373\u4f7f\u4f7f\u7528\u4e86 PageCache \u7684\u96f6\u62f7\u8d1d\u4e5f\u4f1a\u635f\u5931\u6027\u80fd</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5982\u679c\u4f60\u6709\u5f88\u591a GB \u7ea7\u522b\u6587\u4ef6\u9700\u8981\u4f20\u8f93\uff0c\u6bcf\u5f53\u7528\u6237\u8bbf\u95ee\u8fd9\u4e9b\u5927\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u5185\u6838\u5c31\u4f1a\u628a\u5b83\u4eec\u8f7d\u5165 PageCache \u4e2d\uff0c\u4e8e\u662f PageCache \u7a7a\u95f4\u5f88\u5feb\u88ab\u8fd9\u4e9b\u5927\u6587\u4ef6\u5360\u6ee1\u3002</p> <p>\u53e6\u5916\uff0c\u7531\u4e8e\u6587\u4ef6\u592a\u5927\uff0c\u53ef\u80fd\u67d0\u4e9b\u90e8\u5206\u7684\u6587\u4ef6\u6570\u636e\u88ab\u518d\u6b21\u8bbf\u95ee\u7684\u6982\u7387\u6bd4\u8f83\u4f4e\uff0c\u8fd9\u6837\u5c31\u4f1a\u5e26\u6765 2 \u4e2a\u95ee\u9898\uff1a</p> <ul> <li>PageCache \u7531\u4e8e\u957f\u65f6\u95f4\u88ab\u5927\u6587\u4ef6\u5360\u636e\uff0c\u5176\u4ed6\u300c\u70ed\u70b9\u300d\u7684\u5c0f\u6587\u4ef6\u53ef\u80fd\u5c31\u65e0\u6cd5\u5145\u5206\u4f7f\u7528\u5230 PageCache\uff0c\u4e8e\u662f\u8fd9\u6837\u78c1\u76d8\u8bfb\u5199\u7684\u6027\u80fd\u5c31\u4f1a\u4e0b\u964d\u4e86\uff1b</li> <li>PageCache \u4e2d\u7684\u5927\u6587\u4ef6\u6570\u636e\uff0c\u7531\u4e8e\u6ca1\u6709\u4eab\u53d7\u5230\u7f13\u5b58\u5e26\u6765\u7684\u597d\u5904\uff0c\u4f46\u5374\u8017\u8d39 DMA \u591a\u62f7\u8d1d\u5230 PageCache \u4e00\u6b21\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u9488\u5bf9\u5927\u6587\u4ef6\u7684\u4f20\u8f93\uff0c\u4e0d\u5e94\u8be5\u4f7f\u7528 PageCache\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e0d\u5e94\u8be5\u4f7f\u7528\u96f6\u62f7\u8d1d\u6280\u672f\uff0c\u56e0\u4e3a\u53ef\u80fd\u7531\u4e8e PageCache \u88ab\u5927\u6587\u4ef6\u5360\u636e\uff0c\u800c\u5bfc\u81f4\u300c\u70ed\u70b9\u300d\u5c0f\u6587\u4ef6\u65e0\u6cd5\u5229\u7528\u5230 PageCache\uff0c\u8fd9\u6837\u5728\u9ad8\u5e76\u53d1\u7684\u73af\u5883\u4e0b\uff0c\u4f1a\u5e26\u6765\u4e25\u91cd\u7684\u6027\u80fd\u95ee\u9898\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#_5","title":"\u5927\u6587\u4ef6\u4f20\u8f93\u7528\u4ec0\u4e48\u65b9\u5f0f\u5b9e\u73b0\uff1f","text":"<p>\u90a3\u9488\u5bf9\u5927\u6587\u4ef6\u7684\u4f20\u8f93\uff0c\u6211\u4eec\u5e94\u8be5\u4f7f\u7528\u4ec0\u4e48\u65b9\u5f0f\u5462\uff1f</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b\u6700\u521d\u7684\u4f8b\u5b50\uff0c\u5f53\u8c03\u7528 read \u65b9\u6cd5\u8bfb\u53d6\u6587\u4ef6\u65f6\uff0c\u8fdb\u7a0b\u5b9e\u9645\u4e0a\u4f1a\u963b\u585e\u5728 read \u65b9\u6cd5\u8c03\u7528\uff0c\u56e0\u4e3a\u8981\u7b49\u5f85\u78c1\u76d8\u6570\u636e\u7684\u8fd4\u56de\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u8c03\u7528 read \u65b9\u6cd5\u65f6\uff0c\u4f1a\u963b\u585e\u7740\uff0c\u6b64\u65f6\u5185\u6838\u4f1a\u5411\u78c1\u76d8\u53d1\u8d77 I/O \u8bf7\u6c42\uff0c\u78c1\u76d8\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4fbf\u4f1a\u5bfb\u5740\uff0c\u5f53\u78c1\u76d8\u6570\u636e\u51c6\u5907\u597d\u540e\uff0c\u5c31\u4f1a\u5411\u5185\u6838\u53d1\u8d77 I/O \u4e2d\u65ad\uff0c\u544a\u77e5\u5185\u6838\u78c1\u76d8\u6570\u636e\u5df2\u7ecf\u51c6\u5907\u597d\uff1b</li> <li>\u5185\u6838\u6536\u5230 I/O \u4e2d\u65ad\u540e\uff0c\u5c31\u5c06\u6570\u636e\u4ece\u78c1\u76d8\u63a7\u5236\u5668\u7f13\u51b2\u533a\u62f7\u8d1d\u5230 PageCache \u91cc\uff1b</li> <li>\u6700\u540e\uff0c\u5185\u6838\u518d\u628a PageCache \u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230\u7528\u6237\u7f13\u51b2\u533a\uff0c\u4e8e\u662f read \u8c03\u7528\u5c31\u6b63\u5e38\u8fd4\u56de\u4e86\u3002</li> </ul> <p>\u5bf9\u4e8e\u963b\u585e\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u7528\u5f02\u6b65 I/O \u6765\u89e3\u51b3\uff0c\u5b83\u5de5\u4f5c\u65b9\u5f0f\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5b83\u628a\u8bfb\u64cd\u4f5c\u5206\u4e3a\u4e24\u90e8\u5206\uff1a</p> <ul> <li>\u524d\u534a\u90e8\u5206\uff0c\u5185\u6838\u5411\u78c1\u76d8\u53d1\u8d77\u8bfb\u8bf7\u6c42\uff0c\u4f46\u662f\u53ef\u4ee5\u4e0d\u7b49\u5f85\u6570\u636e\u5c31\u4f4d\u5c31\u53ef\u4ee5\u8fd4\u56de\uff0c\u4e8e\u662f\u8fdb\u7a0b\u6b64\u65f6\u53ef\u4ee5\u5904\u7406\u5176\u4ed6\u4efb\u52a1\uff1b</li> <li>\u540e\u534a\u90e8\u5206\uff0c\u5f53\u5185\u6838\u5c06\u78c1\u76d8\u4e2d\u7684\u6570\u636e\u62f7\u8d1d\u5230\u8fdb\u7a0b\u7f13\u51b2\u533a\u540e\uff0c\u8fdb\u7a0b\u5c06\u63a5\u6536\u5230\u5185\u6838\u7684\u901a\u77e5\uff0c\u518d\u53bb\u5904\u7406\u6570\u636e\uff1b</li> </ul> <p>\u800c\u4e14\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f02\u6b65 I/O \u5e76\u6ca1\u6709\u6d89\u53ca\u5230 PageCache\uff0c\u6240\u4ee5\u4f7f\u7528\u5f02\u6b65 I/O \u5c31\u610f\u5473\u7740\u8981\u7ed5\u5f00 PageCache\u3002</p> <p>\u7ed5\u5f00 PageCache \u7684 I/O \u53eb\u76f4\u63a5 I/O\uff0c\u4f7f\u7528 PageCache \u7684 I/O \u5219\u53eb\u7f13\u5b58 I/O\u3002\u901a\u5e38\uff0c\u5bf9\u4e8e\u78c1\u76d8\uff0c\u5f02\u6b65 I/O \u53ea\u652f\u6301\u76f4\u63a5 I/O\u3002</p> <p>\u524d\u9762\u4e5f\u63d0\u5230\uff0c\u5927\u6587\u4ef6\u7684\u4f20\u8f93\u4e0d\u5e94\u8be5\u4f7f\u7528 PageCache\uff0c\u56e0\u4e3a\u53ef\u80fd\u7531\u4e8e PageCache \u88ab\u5927\u6587\u4ef6\u5360\u636e\uff0c\u800c\u5bfc\u81f4\u300c\u70ed\u70b9\u300d\u5c0f\u6587\u4ef6\u65e0\u6cd5\u5229\u7528\u5230 PageCache\u3002</p> <p>\u4e8e\u662f\uff0c\u5728\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u4e0b\uff0c\u9488\u5bf9\u5927\u6587\u4ef6\u7684\u4f20\u8f93\u7684\u65b9\u5f0f\uff0c\u5e94\u8be5\u4f7f\u7528\u300c\u5f02\u6b65 I/O + \u76f4\u63a5 I/O\u300d\u6765\u66ff\u4ee3\u96f6\u62f7\u8d1d\u6280\u672f\u3002</p> <p>\u76f4\u63a5 I/O \u5e94\u7528\u573a\u666f\u5e38\u89c1\u7684\u4e24\u79cd\uff1a</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f\u5df2\u7ecf\u5b9e\u73b0\u4e86\u78c1\u76d8\u6570\u636e\u7684\u7f13\u5b58\uff0c\u90a3\u4e48\u53ef\u4ee5\u4e0d\u9700\u8981 PageCache \u518d\u6b21\u7f13\u5b58\uff0c\u51cf\u5c11\u989d\u5916\u7684\u6027\u80fd\u635f\u8017\u3002\u5728 MySQL \u6570\u636e\u5e93\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u53c2\u6570\u8bbe\u7f6e\u5f00\u542f\u76f4\u63a5 I/O\uff0c\u9ed8\u8ba4\u662f\u4e0d\u5f00\u542f\uff1b</li> <li>\u4f20\u8f93\u5927\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u5927\u6587\u4ef6\u96be\u4ee5\u547d\u4e2d PageCache \u7f13\u5b58\uff0c\u800c\u4e14\u4f1a\u5360\u6ee1 PageCache \u5bfc\u81f4\u300c\u70ed\u70b9\u300d\u6587\u4ef6\u65e0\u6cd5\u5145\u5206\u5229\u7528\u7f13\u5b58\uff0c\u4ece\u800c\u589e\u5927\u4e86\u6027\u80fd\u5f00\u9500\uff0c\u56e0\u6b64\uff0c\u8fd9\u65f6\u5e94\u8be5\u4f7f\u7528\u76f4\u63a5 I/O\u3002</li> </ul> <p>\u53e6\u5916\uff0c\u7531\u4e8e\u76f4\u63a5 I/O \u7ed5\u8fc7\u4e86 PageCache\uff0c\u5c31\u65e0\u6cd5\u4eab\u53d7\u5185\u6838\u7684\u8fd9\u4e24\u70b9\u7684\u4f18\u5316\uff1a</p> <ul> <li>\u5185\u6838\u7684 I/O \u8c03\u5ea6\u7b97\u6cd5\u4f1a\u7f13\u5b58\u5c3d\u53ef\u80fd\u591a\u7684 I/O \u8bf7\u6c42\u5728 PageCache \u4e2d\uff0c\u6700\u540e\u300c\u5408\u5e76\u300d\u6210\u4e00\u4e2a\u66f4\u5927\u7684 I/O \u8bf7\u6c42\u518d\u53d1\u7ed9\u78c1\u76d8\uff0c\u8fd9\u6837\u505a\u662f\u4e3a\u4e86\u51cf\u5c11\u78c1\u76d8\u7684\u5bfb\u5740\u64cd\u4f5c\uff1b</li> <li>\u5185\u6838\u4e5f\u4f1a\u300c\u9884\u8bfb\u300d\u540e\u7eed\u7684 I/O \u8bf7\u6c42\u653e\u5728 PageCache \u4e2d\uff0c\u4e00\u6837\u662f\u4e3a\u4e86\u51cf\u5c11\u5bf9\u78c1\u76d8\u7684\u64cd\u4f5c\uff1b</li> </ul> <p>\u4e8e\u662f\uff0c\u4f20\u8f93\u5927\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u300c\u5f02\u6b65 I/O + \u76f4\u63a5 I/O\u300d\u4e86\uff0c\u5c31\u53ef\u4ee5\u65e0\u963b\u585e\u5730\u8bfb\u53d6\u6587\u4ef6\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u4f20\u8f93\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u6211\u4eec\u8981\u6839\u636e\u6587\u4ef6\u7684\u5927\u5c0f\u6765\u4f7f\u7528\u4e0d\u540c\u7684\u65b9\u5f0f\uff1a</p> <ul> <li>\u4f20\u8f93\u5927\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u300c\u5f02\u6b65 I/O + \u76f4\u63a5 I/O\u300d\uff1b</li> <li>\u4f20\u8f93\u5c0f\u6587\u4ef6\u7684\u65f6\u5019\uff0c\u5219\u4f7f\u7528\u300c\u96f6\u62f7\u8d1d\u6280\u672f\u300d\uff1b</li> </ul> <p>\u5728 nginx \u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u7528\u5982\u4e0b\u914d\u7f6e\uff0c\u6765\u6839\u636e\u6587\u4ef6\u7684\u5927\u5c0f\u6765\u4f7f\u7528\u4e0d\u540c\u7684\u65b9\u5f0f\uff1a</p> Text Only<pre><code>location /video/ { \n    sendfile on; \n    aio on; \n    directio 1024m; \n}\n</code></pre> <p>\u5f53\u6587\u4ef6\u5927\u5c0f\u5927\u4e8e <code>directio</code> \u503c\u540e\uff0c\u4f7f\u7528\u300c\u5f02\u6b65 I/O + \u76f4\u63a5 I/O\u300d\uff0c\u5426\u5219\u4f7f\u7528\u300c\u96f6\u62f7\u8d1d\u6280\u672f\u300d\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/8_network_system/zero_copy/#_6","title":"\u603b\u7ed3","text":"<p>\u65e9\u671f I/O \u64cd\u4f5c\uff0c\u5185\u5b58\u4e0e\u78c1\u76d8\u7684\u6570\u636e\u4f20\u8f93\u7684\u5de5\u4f5c\u90fd\u662f\u7531 CPU \u5b8c\u6210\u7684\uff0c\u800c\u6b64\u65f6 CPU \u4e0d\u80fd\u6267\u884c\u5176\u4ed6\u4efb\u52a1\uff0c\u4f1a\u7279\u522b\u6d6a\u8d39 CPU \u8d44\u6e90\u3002</p> <p>\u4e8e\u662f\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0cDMA \u6280\u672f\u5c31\u51fa\u73b0\u4e86\uff0c\u6bcf\u4e2a I/O \u8bbe\u5907\u90fd\u6709\u81ea\u5df1\u7684 DMA \u63a7\u5236\u5668\uff0c\u901a\u8fc7\u8fd9\u4e2a DMA \u63a7\u5236\u5668\uff0cCPU \u53ea\u9700\u8981\u544a\u8bc9 DMA \u63a7\u5236\u5668\uff0c\u6211\u4eec\u8981\u4f20\u8f93\u4ec0\u4e48\u6570\u636e\uff0c\u4ece\u54ea\u91cc\u6765\uff0c\u5230\u54ea\u91cc\u53bb\uff0c\u5c31\u53ef\u4ee5\u653e\u5fc3\u79bb\u5f00\u4e86\u3002\u540e\u7eed\u7684\u5b9e\u9645\u6570\u636e\u4f20\u8f93\u5de5\u4f5c\uff0c\u90fd\u4f1a\u7531 DMA \u63a7\u5236\u5668\u6765\u5b8c\u6210\uff0cCPU \u4e0d\u9700\u8981\u53c2\u4e0e\u6570\u636e\u4f20\u8f93\u7684\u5de5\u4f5c\u3002</p> <p>\u4f20\u7edf IO \u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u4ece\u786c\u76d8\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u518d\u901a\u8fc7\u7f51\u5361\u5411\u5916\u53d1\u9001\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u884c 4 \u4e0a\u4e0b\u6587\u5207\u6362\uff0c\u548c 4 \u6b21\u6570\u636e\u62f7\u8d1d\uff0c\u5176\u4e2d 2 \u6b21\u6570\u636e\u62f7\u8d1d\u53d1\u751f\u5728\u5185\u5b58\u91cc\u7684\u7f13\u51b2\u533a\u548c\u5bf9\u5e94\u7684\u786c\u4ef6\u8bbe\u5907\u4e4b\u95f4\uff0c\u8fd9\u4e2a\u662f\u7531 DMA \u5b8c\u6210\uff0c\u53e6\u5916 2 \u6b21\u5219\u53d1\u751f\u5728\u5185\u6838\u6001\u548c\u7528\u6237\u6001\u4e4b\u95f4\uff0c\u8fd9\u4e2a\u6570\u636e\u642c\u79fb\u5de5\u4f5c\u662f\u7531 CPU \u5b8c\u6210\u7684\u3002</p> <p>\u4e3a\u4e86\u63d0\u9ad8\u6587\u4ef6\u4f20\u8f93\u7684\u6027\u80fd\uff0c\u4e8e\u662f\u5c31\u51fa\u73b0\u4e86\u96f6\u62f7\u8d1d\u6280\u672f\uff0c\u5b83\u901a\u8fc7\u4e00\u6b21\u7cfb\u7edf\u8c03\u7528\uff08<code>sendfile</code> \u65b9\u6cd5\uff09\u5408\u5e76\u4e86\u78c1\u76d8\u8bfb\u53d6\u4e0e\u7f51\u7edc\u53d1\u9001\u4e24\u4e2a\u64cd\u4f5c\uff0c\u964d\u4f4e\u4e86\u4e0a\u4e0b\u6587\u5207\u6362\u6b21\u6570\u3002\u53e6\u5916\uff0c\u62f7\u8d1d\u6570\u636e\u90fd\u662f\u53d1\u751f\u5728\u5185\u6838\u4e2d\u7684\uff0c\u5929\u7136\u5c31\u964d\u4f4e\u4e86\u6570\u636e\u62f7\u8d1d\u7684\u6b21\u6570\u3002</p> <p>Kafka \u548c Nginx \u90fd\u6709\u5b9e\u73b0\u96f6\u62f7\u8d1d\u6280\u672f\uff0c\u8fd9\u5c06\u5927\u5927\u63d0\u9ad8\u6587\u4ef6\u4f20\u8f93\u7684\u6027\u80fd\u3002</p> <p>\u96f6\u62f7\u8d1d\u6280\u672f\u662f\u57fa\u4e8e PageCache \u7684\uff0cPageCache \u4f1a\u7f13\u5b58\u6700\u8fd1\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u63d0\u5347\u4e86\u8bbf\u95ee\u7f13\u5b58\u6570\u636e\u7684\u6027\u80fd\uff0c\u540c\u65f6\uff0c\u4e3a\u4e86\u89e3\u51b3\u673a\u68b0\u786c\u76d8\u5bfb\u5740\u6162\u7684\u95ee\u9898\uff0c\u5b83\u8fd8\u534f\u52a9 I/O \u8c03\u5ea6\u7b97\u6cd5\u5b9e\u73b0\u4e86 IO \u5408\u5e76\u4e0e\u9884\u8bfb\uff0c\u8fd9\u4e5f\u662f\u987a\u5e8f\u8bfb\u6bd4\u968f\u673a\u8bfb\u6027\u80fd\u597d\u7684\u539f\u56e0\u3002\u8fd9\u4e9b\u4f18\u52bf\uff0c\u8fdb\u4e00\u6b65\u63d0\u5347\u4e86\u96f6\u62f7\u8d1d\u7684\u6027\u80fd\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u96f6\u62f7\u8d1d\u6280\u672f\u662f\u4e0d\u5141\u8bb8\u8fdb\u7a0b\u5bf9\u6587\u4ef6\u5185\u5bb9\u4f5c\u8fdb\u4e00\u6b65\u7684\u52a0\u5de5\u7684\uff0c\u6bd4\u5982\u538b\u7f29\u6570\u636e\u518d\u53d1\u9001\u3002</p> <p>\u53e6\u5916\uff0c\u5f53\u4f20\u8f93\u5927\u6587\u4ef6\u65f6\uff0c\u4e0d\u80fd\u4f7f\u7528\u96f6\u62f7\u8d1d\uff0c\u56e0\u4e3a\u53ef\u80fd\u7531\u4e8e PageCache \u88ab\u5927\u6587\u4ef6\u5360\u636e\uff0c\u800c\u5bfc\u81f4\u300c\u70ed\u70b9\u300d\u5c0f\u6587\u4ef6\u65e0\u6cd5\u5229\u7528\u5230 PageCache\uff0c\u5e76\u4e14\u5927\u6587\u4ef6\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u4e0d\u9ad8\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u4f7f\u7528\u300c\u5f02\u6b65 IO + \u76f4\u63a5 IO\u300d\u7684\u65b9\u5f0f\u3002</p> <p>\u5728 Nginx \u91cc\uff0c\u53ef\u4ee5\u901a\u8fc7\u914d\u7f6e\uff0c\u8bbe\u5b9a\u4e00\u4e2a\u6587\u4ef6\u5927\u5c0f\u9608\u503c\uff0c\u9488\u5bf9\u5927\u6587\u4ef6\u4f7f\u7528\u5f02\u6b65 IO \u548c\u76f4\u63a5 IO\uff0c\u800c\u5bf9\u5c0f\u6587\u4ef6\u4f7f\u7528\u96f6\u62f7\u8d1d\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/linux_network/","title":"10.1 \u5982\u4f55\u67e5\u770b\u7f51\u7edc\u7684\u6027\u80fd\u6307\u6807\uff1f","text":"<p>Linux \u7f51\u7edc\u534f\u8bae\u6808\u662f\u6839\u636e TCP/IP \u6a21\u578b\u6765\u5b9e\u73b0\u7684\uff0cTCP/IP \u6a21\u578b\u7531\u5e94\u7528\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u548c\u7f51\u7edc\u63a5\u53e3\u5c42\uff0c\u5171\u56db\u5c42\u7ec4\u6210\uff0c\u6bcf\u4e00\u5c42\u90fd\u6709\u5404\u81ea\u7684\u804c\u8d23\u3002</p> <p></p> <p>\u5e94\u7528\u7a0b\u5e8f\u8981\u53d1\u9001\u6570\u636e\u5305\u65f6\uff0c\u901a\u5e38\u662f\u901a\u8fc7 socket \u63a5\u53e3\uff0c\u4e8e\u662f\u5c31\u4f1a\u53d1\u751f\u7cfb\u7edf\u8c03\u7528\uff0c\u628a\u5e94\u7528\u5c42\u7684\u6570\u636e\u62f7\u8d1d\u5230\u5185\u6838\u91cc\u7684 socket \u5c42\uff0c\u63a5\u7740\u7531\u7f51\u7edc\u534f\u8bae\u6808\u4ece\u4e0a\u5230\u4e0b\u9010\u5c42\u5904\u7406\u540e\uff0c\u6700\u540e\u624d\u4f1a\u9001\u5230\u7f51\u5361\u53d1\u9001\u51fa\u53bb\u3002</p> <p>\u800c\u5bf9\u4e8e\u63a5\u6536\u7f51\u7edc\u5305\u65f6\uff0c\u540c\u6837\u4e5f\u8981\u7ecf\u8fc7\u7f51\u7edc\u534f\u8bae\u9010\u5c42\u5904\u7406\uff0c\u4e0d\u8fc7\u5904\u7406\u7684\u65b9\u5411\u4e0e\u53d1\u9001\u6570\u636e\u65f6\u662f\u76f8\u53cd\u7684\uff0c\u4e5f\u5c31\u662f\u4ece\u4e0b\u5230\u4e0a\u7684\u9010\u5c42\u5904\u7406\uff0c\u6700\u540e\u624d\u9001\u5230\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u7f51\u7edc\u7684\u901f\u5ea6\u5f80\u5f80\u8ddf\u7528\u6237\u4f53\u9a8c\u662f\u6302\u94a9\u7684\uff0c\u90a3\u6211\u4eec\u53c8\u8be5\u7528\u4ec0\u4e48\u6307\u6807\u6765\u8861\u91cf Linux \u7684\u7f51\u7edc\u6027\u80fd\u5462\uff1f\u4ee5\u53ca\u5982\u4f55\u5206\u6790\u7f51\u7edc\u95ee\u9898\u5462\uff1f</p> <p>\u8fd9\u6b21\uff0c\u6211\u4eec\u5c31\u6765\u8bf4\u8fd9\u4e9b\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/linux_network/#_1","title":"\u6027\u80fd\u6307\u6807\u6709\u54ea\u4e9b\uff1f","text":"<p>\u901a\u5e38\u662f\u4ee5 4 \u4e2a\u6307\u6807\u6765\u8861\u91cf\u7f51\u7edc\u7684\u6027\u80fd\uff0c\u5206\u522b\u662f\u5e26\u5bbd\u3001\u5ef6\u65f6\u3001\u541e\u5410\u7387\u3001PPS\uff08Packet Per Second\uff09\uff0c\u5b83\u4eec\u8868\u793a\u7684\u610f\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>\u5e26\u5bbd\uff0c\u8868\u793a\u94fe\u8def\u7684\u6700\u5927\u4f20\u8f93\u901f\u7387\uff0c\u5355\u4f4d\u662f b/s\uff08\u6bd4\u7279 / \u79d2\uff09\uff0c\u5e26\u5bbd\u8d8a\u5927\uff0c\u5176\u4f20\u8f93\u80fd\u529b\u5c31\u8d8a\u5f3a\u3002</li> <li>\u5ef6\u65f6\uff0c\u8868\u793a\u8bf7\u6c42\u6570\u636e\u5305\u53d1\u9001\u540e\uff0c\u6536\u5230\u5bf9\u7aef\u54cd\u5e94\uff0c\u6240\u9700\u8981\u7684\u65f6\u95f4\u5ef6\u8fdf\u3002\u4e0d\u540c\u7684\u573a\u666f\u6709\u7740\u4e0d\u540c\u7684\u542b\u4e49\uff0c\u6bd4\u5982\u53ef\u4ee5\u8868\u793a\u5efa\u7acb TCP \u8fde\u63a5\u6240\u9700\u7684\u65f6\u95f4\u5ef6\u8fdf\uff0c\u6216\u4e00\u4e2a\u6570\u636e\u5305\u5f80\u8fd4\u6240\u9700\u7684\u65f6\u95f4\u5ef6\u8fdf\u3002</li> <li>\u541e\u5410\u7387\uff0c\u8868\u793a\u5355\u4f4d\u65f6\u95f4\u5185\u6210\u529f\u4f20\u8f93\u7684\u6570\u636e\u91cf\uff0c\u5355\u4f4d\u662f b/s\uff08\u6bd4\u7279 / \u79d2\uff09\u6216\u8005 B/s\uff08\u5b57\u8282 / \u79d2\uff09\uff0c\u541e\u5410\u53d7\u5e26\u5bbd\u9650\u5236\uff0c\u5e26\u5bbd\u8d8a\u5927\uff0c\u541e\u5410\u7387\u7684\u4e0a\u9650\u624d\u53ef\u80fd\u8d8a\u9ad8\u3002</li> <li>PPS\uff0c\u5168\u79f0\u662f Packet Per Second\uff08\u5305 / \u79d2\uff09\uff0c\u8868\u793a\u4ee5\u7f51\u7edc\u5305\u4e3a\u5355\u4f4d\u7684\u4f20\u8f93\u901f\u7387\uff0c\u4e00\u822c\u7528\u6765\u8bc4\u4f30\u7cfb\u7edf\u5bf9\u4e8e\u7f51\u7edc\u7684\u8f6c\u53d1\u80fd\u529b\u3002</li> </ul> <p>\u5f53\u7136\uff0c\u9664\u4e86\u4ee5\u4e0a\u8fd9\u56db\u79cd\u57fa\u672c\u7684\u6307\u6807\uff0c\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u5e38\u7528\u7684\u6027\u80fd\u6307\u6807\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u7f51\u7edc\u7684\u53ef\u7528\u6027\uff0c\u8868\u793a\u7f51\u7edc\u80fd\u5426\u6b63\u5e38\u901a\u4fe1\uff1b</li> <li>\u5e76\u53d1\u8fde\u63a5\u6570\uff0c\u8868\u793a TCP \u8fde\u63a5\u6570\u91cf\uff1b</li> <li>\u4e22\u5305\u7387\uff0c\u8868\u793a\u6240\u4e22\u5931\u6570\u636e\u5305\u6570\u91cf\u5360\u6240\u53d1\u9001\u6570\u636e\u7ec4\u7684\u6bd4\u7387\uff1b</li> <li>\u91cd\u4f20\u7387\uff0c\u8868\u793a\u91cd\u4f20\u7f51\u7edc\u5305\u7684\u6bd4\u4f8b\uff1b</li> </ul> <p>\u4f60\u53ef\u80fd\u4f1a\u95ee\u4e86\uff0c\u5982\u4f55\u89c2\u6d4b\u8fd9\u4e9b\u6027\u80fd\u6307\u6807\u5462\uff1f\u4e0d\u6025\uff0c\u7ee7\u7eed\u5f80\u4e0b\u770b\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/linux_network/#_2","title":"\u7f51\u7edc\u914d\u7f6e\u5982\u4f55\u770b\uff1f","text":"<p>\u8981\u60f3\u77e5\u9053\u7f51\u7edc\u7684\u914d\u7f6e\u548c\u72b6\u6001\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>ifconfig</code> \u6216\u8005 <code>ip</code> \u547d\u4ee4\u6765\u67e5\u770b\u3002</p> <p>\u8fd9\u4e24\u4e2a\u547d\u4ee4\u529f\u80fd\u90fd\u5dee\u4e0d\u591a\uff0c\u4e0d\u8fc7\u5b83\u4eec\u5c5e\u4e8e\u4e0d\u540c\u7684\u8f6f\u4ef6\u5305\uff0c<code>ifconfig</code> \u5c5e\u4e8e <code>net-tools</code> \u8f6f\u4ef6\u5305\uff0c<code>ip</code> \u5c5e\u4e8e <code>iproute2</code> \u8f6f\u4ef6\u5305\uff0c\u6211\u7684\u5370\u8c61\u4e2d <code>net-tools</code> \u8f6f\u4ef6\u5305\u6ca1\u6709\u4eba\u7ee7\u7eed\u7ef4\u62a4\u4e86\uff0c\u800c <code>iproute2</code> \u8f6f\u4ef6\u5305\u662f\u6709\u5f00\u53d1\u8005\u4f9d\u7136\u5728\u7ef4\u62a4\uff0c\u6240\u4ee5\u66f4\u63a8\u8350\u4f60\u4f7f\u7528 <code>ip</code> \u5de5\u5177\u3002</p> <p>\u5b66\u4ee5\u81f4\u7528\uff0c\u90a3\u5c31\u6765\u4f7f\u7528\u8fd9\u4e24\u4e2a\u547d\u4ee4\uff0c\u6765\u67e5\u770b\u7f51\u53e3 <code>eth0</code> \u7684\u914d\u7f6e\u7b49\u4fe1\u606f\uff1a</p> <p></p> <p>\u867d\u7136\u8fd9\u4e24\u4e2a\u547d\u4ee4\u8f93\u51fa\u7684\u683c\u5f0f\u4e0d\u5c3d\u76f8\u540c\uff0c\u4f46\u662f\u8f93\u51fa\u7684\u5185\u5bb9\u57fa\u672c\u76f8\u540c\uff0c\u6bd4\u5982\u90fd\u5305\u542b\u4e86 IP \u5730\u5740\u3001\u5b50\u7f51\u63a9\u7801\u3001MAC \u5730\u5740\u3001\u7f51\u5173\u5730\u5740\u3001MTU \u5927\u5c0f\u3001\u7f51\u53e3\u7684\u72b6\u6001\u4ee5\u53ca\u7f51\u8def\u5305\u6536\u53d1\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u4e0b\u9762\u5c31\u6765\u8bf4\u8bf4\u8fd9\u4e9b\u4fe1\u606f\uff0c\u5b83\u4eec\u90fd\u4e0e\u7f51\u7edc\u6027\u80fd\u6709\u4e00\u5b9a\u7684\u5173\u7cfb\u3002</p> <p>\u7b2c\u4e00\uff0c\u7f51\u53e3\u7684\u8fde\u63a5\u72b6\u6001\u6807\u5fd7\u3002\u5176\u5b9e\u4e5f\u5c31\u662f\u8868\u793a\u5bf9\u5e94\u7684\u7f51\u53e3\u662f\u5426\u8fde\u63a5\u5230\u4ea4\u6362\u673a\u6216\u8def\u7531\u5668\u7b49\u8bbe\u5907\uff0c\u5982\u679c <code>ifconfig</code> \u8f93\u51fa\u4e2d\u770b\u5230\u6709 <code>RUNNING</code>\uff0c\u6216\u8005 <code>ip</code> \u8f93\u51fa\u4e2d\u6709 <code>LOWER_UP</code>\uff0c\u5219\u8bf4\u660e\u7269\u7406\u7f51\u8def\u662f\u8fde\u901a\u7684\uff0c\u5982\u679c\u770b\u4e0d\u5230\uff0c\u5219\u8868\u793a\u7f51\u53e3\u6ca1\u6709\u63a5\u7f51\u7ebf\u3002</p> <p>\u7b2c\u4e8c\uff0cMTU \u5927\u5c0f\u3002\u9ed8\u8ba4\u503c\u662f <code>1500</code> \u5b57\u8282\uff0c\u5176\u4f5c\u7528\u4e3b\u8981\u662f\u9650\u5236\u7f51\u7edc\u5305\u7684\u5927\u5c0f\uff0c\u5982\u679c IP \u5c42\u6709\u4e00\u4e2a\u6570\u636e\u62a5\u8981\u4f20\uff0c\u800c\u4e14\u6570\u636e\u5e27\u7684\u957f\u5ea6\u6bd4\u94fe\u8def\u5c42\u7684 MTU \u8fd8\u5927\uff0c\u90a3\u4e48 IP \u5c42\u5c31\u9700\u8981\u8fdb\u884c\u5206\u7247\uff0c\u5373\u628a\u6570\u636e\u62a5\u5206\u6210\u82e5\u5e72\u7247\uff0c\u8fd9\u6837\u6bcf\u4e00\u7247\u5c31\u90fd\u5c0f\u4e8e MTU\u3002\u4e8b\u5b9e\u4e0a\uff0c\u6bcf\u4e2a\u7f51\u7edc\u7684\u94fe\u8def\u5c42 MTU \u53ef\u80fd\u4f1a\u4e0d\u4e00\u6837\uff0c\u6240\u4ee5\u4f60\u53ef\u80fd\u9700\u8981\u8c03\u5927\u6216\u8005\u8c03\u5c0f MTU \u7684\u6570\u503c\u3002</p> <p>\u7b2c\u4e09\uff0c\u7f51\u53e3\u7684 IP \u5730\u5740\u3001\u5b50\u7f51\u63a9\u7801\u3001MAC \u5730\u5740\u3001\u7f51\u5173\u5730\u5740\u3002\u8fd9\u4e9b\u4fe1\u606f\u5fc5\u987b\u8981\u914d\u7f6e\u6b63\u786e\uff0c\u7f51\u7edc\u529f\u80fd\u624d\u80fd\u6b63\u5e38\u5de5\u4f5c\u3002</p> <p>\u7b2c\u56db\uff0c\u7f51\u8def\u5305\u6536\u53d1\u7684\u7edf\u8ba1\u4fe1\u606f\u3002\u901a\u5e38\u6709\u7f51\u7edc\u6536\u53d1\u7684\u5b57\u8282\u6570\u3001\u5305\u6570\u3001\u9519\u8bef\u6570\u4ee5\u53ca\u4e22\u5305\u60c5\u51b5\u7684\u4fe1\u606f\uff0c\u5982\u679c <code>TX</code>\uff08\u53d1\u9001\uff09\u548c <code>RX</code>\uff08\u63a5\u6536\uff09\u90e8\u5206\u4e2d errors\u3001dropped\u3001overruns\u3001carrier \u4ee5\u53ca collisions \u7b49\u6307\u6807\u4e0d\u4e3a 0 \u65f6\uff0c\u5219\u8bf4\u660e\u7f51\u7edc\u53d1\u9001\u6216\u8005\u63a5\u6536\u51fa\u95ee\u9898\u4e86\uff0c\u8fd9\u4e9b\u51fa\u9519\u7edf\u8ba1\u4fe1\u606f\u7684\u6307\u6807\u610f\u4e49\u5982\u4e0b\uff1a</p> <ul> <li>errors \u8868\u793a\u53d1\u751f\u9519\u8bef\u7684\u6570\u636e\u5305\u6570\uff0c\u6bd4\u5982\u6821\u9a8c\u9519\u8bef\u3001\u5e27\u540c\u6b65\u9519\u8bef\u7b49\uff1b</li> <li>dropped \u8868\u793a\u4e22\u5f03\u7684\u6570\u636e\u5305\u6570\uff0c\u5373\u6570\u636e\u5305\u5df2\u7ecf\u6536\u5230\u4e86 Ring Buffer\uff08\u8fd9\u4e2a\u7f13\u51b2\u533a\u662f\u5728\u5185\u6838\u5185\u5b58\u4e2d\uff0c\u66f4\u5177\u4f53\u4e00\u70b9\u662f\u5728\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f\u91cc\uff09\uff0c\u4f46\u56e0\u4e3a\u7cfb\u7edf\u5185\u5b58\u4e0d\u8db3\u7b49\u539f\u56e0\u800c\u53d1\u751f\u7684\u4e22\u5305\uff1b</li> <li>overruns \u8868\u793a\u8d85\u9650\u6570\u636e\u5305\u6570\uff0c\u5373\u7f51\u7edc\u63a5\u6536/\u53d1\u9001\u901f\u5ea6\u8fc7\u5feb\uff0c\u5bfc\u81f4 Ring Buffer \u4e2d\u7684\u6570\u636e\u5305\u6765\u4e0d\u53ca\u5904\u7406\uff0c\u800c\u5bfc\u81f4\u7684\u4e22\u5305\uff0c\u56e0\u4e3a\u8fc7\u591a\u7684\u6570\u636e\u5305\u6324\u538b\u5728 Ring Buffer\uff0c\u8fd9\u6837 Ring Buffer \u5f88\u5bb9\u6613\u5c31\u6ea2\u51fa\u4e86\uff1b</li> <li>carrier \u8868\u793a\u53d1\u751f carrirer \u9519\u8bef\u7684\u6570\u636e\u5305\u6570\uff0c\u6bd4\u5982\u53cc\u5de5\u6a21\u5f0f\u4e0d\u5339\u914d\u3001\u7269\u7406\u7535\u7f06\u51fa\u73b0\u95ee\u9898\u7b49\uff1b</li> <li>collisions \u8868\u793a\u51b2\u7a81\u3001\u78b0\u649e\u6570\u636e\u5305\u6570\uff1b</li> </ul> <p><code>ifconfig</code> \u548c <code>ip</code> \u547d\u4ee4\u53ea\u663e\u793a\u7684\u662f\u7f51\u53e3\u7684\u914d\u7f6e\u4ee5\u53ca\u6536\u53d1\u6570\u636e\u5305\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u800c\u770b\u4e0d\u5230\u534f\u8bae\u6808\u91cc\u7684\u4fe1\u606f\uff0c\u90a3\u63a5\u4e0b\u6765\u5c31\u6765\u770b\u770b\u5982\u4f55\u67e5\u770b\u534f\u8bae\u6808\u91cc\u7684\u4fe1\u606f\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/linux_network/#socket","title":"socket \u4fe1\u606f\u5982\u4f55\u67e5\u770b\uff1f","text":"<p>\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>netstat</code> \u6216\u8005 <code>ss</code>\uff0c\u8fd9\u4e24\u4e2a\u547d\u4ee4\u67e5\u770b socket\u3001\u7f51\u7edc\u534f\u8bae\u6808\u3001\u7f51\u53e3\u4ee5\u53ca\u8def\u7531\u8868\u7684\u4fe1\u606f\u3002</p> <p>\u867d\u7136 <code>netstat</code> \u4e0e <code>ss</code> \u547d\u4ee4\u67e5\u770b\u7684\u4fe1\u606f\u90fd\u5dee\u4e0d\u591a\uff0c\u4f46\u662f\u5982\u679c\u5728\u751f\u4ea7\u73af\u5883\u4e2d\u8981\u67e5\u770b\u8fd9\u7c7b\u4fe1\u606f\u7684\u65f6\u5019\uff0c\u5c3d\u91cf\u4e0d\u8981\u4f7f\u7528 <code>netstat</code> \u547d\u4ee4\uff0c\u56e0\u4e3a\u5b83\u7684\u6027\u80fd\u4e0d\u597d\uff0c\u5728\u7cfb\u7edf\u6bd4\u8f83\u7e41\u5fd9\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u9891\u7e41\u4f7f\u7528 <code>netstat</code> \u547d\u4ee4\u5219\u4f1a\u5bf9\u6027\u80fd\u7684\u5f00\u9500\u96ea\u4e0a\u52a0\u971c\uff0c\u6240\u4ee5\u66f4\u63a8\u8350\u4f60\u4f7f\u7528\u6027\u80fd\u66f4\u597d\u7684 <code>ss</code> \u547d\u4ee4\u3002</p> <p>\u4ece\u4e0b\u9762\u8fd9\u5f20\u56fe\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u8fd9\u4e24\u4e2a\u547d\u4ee4\u7684\u8f93\u51fa\u5185\u5bb9\uff1a</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u8f93\u51fa\u7684\u5185\u5bb9\u90fd\u5dee\u4e0d\u591a\uff0c\u6bd4\u5982\u90fd\u5305\u542b\u4e86 socket \u7684\u72b6\u6001\uff08State\uff09\u3001\u63a5\u6536\u961f\u5217\uff08Recv-Q\uff09\u3001\u53d1\u9001\u961f\u5217\uff08Send-Q\uff09\u3001\u672c\u5730\u5730\u5740\uff08Local Address\uff09\u3001\u8fdc\u7aef\u5730\u5740\uff08Foreign Address\uff09\u3001\u8fdb\u7a0b PID \u548c\u8fdb\u7a0b\u540d\u79f0\uff08PID/Program name\uff09\u7b49\u3002</p> <p>\u63a5\u6536\u961f\u5217\uff08Recv-Q\uff09\u548c\u53d1\u9001\u961f\u5217\uff08Send-Q\uff09\u6bd4\u8f83\u7279\u6b8a\uff0c\u5728\u4e0d\u540c\u7684 socket \u72b6\u6001\u3002\u5b83\u4eec\u8868\u793a\u7684\u542b\u4e49\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u5f53 socket \u72b6\u6001\u5904\u4e8e <code>Established</code>\u65f6\uff1a</p> <ul> <li>Recv-Q \u8868\u793a socket \u7f13\u51b2\u533a\u4e2d\u8fd8\u6ca1\u6709\u88ab\u5e94\u7528\u7a0b\u5e8f\u8bfb\u53d6\u7684\u5b57\u8282\u6570\uff1b</li> <li>Send-Q \u8868\u793a socket \u7f13\u51b2\u533a\u4e2d\u8fd8\u6ca1\u6709\u88ab\u8fdc\u7aef\u4e3b\u673a\u786e\u8ba4\u7684\u5b57\u8282\u6570\uff1b</li> </ul> <p>\u800c\u5f53 socket \u72b6\u6001\u5904\u4e8e <code>Listen</code> \u65f6\uff1a</p> <ul> <li>Recv-Q \u8868\u793a\u5168\u8fde\u63a5\u961f\u5217\u7684\u957f\u5ea6\uff1b</li> <li>Send-Q \u8868\u793a\u5168\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\uff1b</li> </ul> <p>\u5728 TCP \u4e09\u6b21\u63e1\u624b\u8fc7\u7a0b\u4e2d\uff0c\u5f53\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u7684 SYN \u5305\u540e\uff0c\u5185\u6838\u4f1a\u628a\u8be5\u8fde\u63a5\u5b58\u50a8\u5230\u534a\u8fde\u63a5\u961f\u5217\uff0c\u7136\u540e\u518d\u5411\u5ba2\u6237\u7aef\u53d1\u9001 SYN+ACK \u5305\uff0c\u63a5\u7740\u5ba2\u6237\u7aef\u4f1a\u8fd4\u56de ACK\uff0c\u670d\u52a1\u7aef\u6536\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\u7684 ACK \u540e\uff0c\u5185\u6838\u4f1a\u628a\u8fde\u63a5\u4ece\u534a\u8fde\u63a5\u961f\u5217\u79fb\u9664\uff0c\u7136\u540e\u521b\u5efa\u65b0\u7684\u5b8c\u5168\u7684\u8fde\u63a5\uff0c\u5e76\u5c06\u5176\u589e\u52a0\u5230\u5168\u8fde\u63a5\u961f\u5217\uff0c\u7b49\u5f85\u8fdb\u7a0b\u8c03\u7528 <code>accept()</code> \u51fd\u6570\u65f6\u628a\u8fde\u63a5\u53d6\u51fa\u6765\u3002</p> <p></p> <p>\u4e5f\u5c31\u8bf4\uff0c\u5168\u8fde\u63a5\u961f\u5217\u6307\u7684\u662f\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u5b8c\u4e86 TCP \u4e09\u6b21\u63e1\u624b\u540e\uff0c\u8fd8\u6ca1\u6709\u88ab <code>accept()</code> \u7cfb\u7edf\u8c03\u7528\u53d6\u8d70\u8fde\u63a5\u7684\u961f\u5217\u3002</p> <p>\u90a3\u5bf9\u4e8e\u534f\u8bae\u6808\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u4f9d\u7136\u8fd8\u662f\u4f7f\u7528 <code>netstat</code> \u6216 <code>ss</code>\uff0c\u5b83\u4eec\u67e5\u770b\u7edf\u8ba1\u4fe1\u606f\u7684\u547d\u4ee4\u5982\u4e0b\uff1a</p> <p></p> <p><code>ss</code> \u547d\u4ee4\u8f93\u51fa\u7684\u7edf\u8ba1\u4fe1\u606f\u76f8\u6bd4 <code>netsat</code> \u6bd4\u8f83\u5c11\uff0c<code>ss</code> \u53ea\u663e\u793a\u5df2\u7ecf\u8fde\u63a5\uff08estab\uff09\u3001\u5173\u95ed\uff08closed\uff09\u3001\u5b64\u513f\uff08orphaned\uff09socket \u7b49\u7b80\u8981\u7edf\u8ba1\u3002</p> <p>\u800c <code>netstat</code> \u5219\u6709\u66f4\u8be6\u7ec6\u7684\u7f51\u7edc\u534f\u8bae\u6808\u4fe1\u606f\uff0c\u6bd4\u5982\u4e0a\u9762\u663e\u793a\u4e86 TCP \u534f\u8bae\u7684\u4e3b\u52a8\u8fde\u63a5\uff08active connections openings\uff09\u3001\u88ab\u52a8\u8fde\u63a5\uff08passive connection openings\uff09\u3001\u5931\u8d25\u91cd\u8bd5\uff08failed connection attempts\uff09\u3001\u53d1\u9001\uff08segments send out\uff09\u548c\u63a5\u6536\uff08segments received\uff09\u7684\u5206\u6bb5\u6570\u91cf\u7b49\u5404\u79cd\u4fe1\u606f\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/linux_network/#pps","title":"\u7f51\u7edc\u541e\u5410\u7387\u548c PPS \u5982\u4f55\u67e5\u770b\uff1f","text":"<p>\u53ef\u4ee5\u4f7f\u7528 <code>sar</code> \u547d\u4ee4\u5f53\u524d\u7f51\u7edc\u7684\u541e\u5410\u7387\u548c PPS\uff0c\u7528\u6cd5\u662f\u7ed9 <code>sar</code> \u589e\u52a0 <code>-n</code> \u53c2\u6570\u5c31\u53ef\u4ee5\u67e5\u770b\u7f51\u7edc\u7684\u7edf\u8ba1\u4fe1\u606f\uff0c\u6bd4\u5982</p> <ul> <li>sar -n DEV\uff0c\u663e\u793a\u7f51\u53e3\u7684\u7edf\u8ba1\u6570\u636e\uff1b</li> <li>sar -n EDEV\uff0c\u663e\u793a\u5173\u4e8e\u7f51\u7edc\u9519\u8bef\u7684\u7edf\u8ba1\u6570\u636e\uff1b</li> <li>sar -n TCP\uff0c\u663e\u793a TCP \u7684\u7edf\u8ba1\u6570\u636e</li> </ul> <p>\u6bd4\u5982\uff0c\u6211\u901a\u8fc7 <code>sar</code> \u547d\u4ee4\u83b7\u53d6\u4e86\u7f51\u53e3\u7684\u7edf\u8ba1\u4fe1\u606f\uff1a</p> <p></p> <p>\u5b83\u4eec\u7684\u542b\u4e49\uff1a</p> <ul> <li><code>rxpck/s</code> \u548c <code>txpck/s</code> \u5206\u522b\u662f\u63a5\u6536\u548c\u53d1\u9001\u7684 PPS\uff0c\u5355\u4f4d\u4e3a\u5305 / \u79d2\u3002</li> <li><code>rxkB/s</code> \u548c <code>txkB/s</code> \u5206\u522b\u662f\u63a5\u6536\u548c\u53d1\u9001\u7684\u541e\u5410\u7387\uff0c\u5355\u4f4d\u662f KB/ \u79d2\u3002</li> <li><code>rxcmp/s</code> \u548c <code>txcmp/s</code> \u5206\u522b\u662f\u63a5\u6536\u548c\u53d1\u9001\u7684\u538b\u7f29\u6570\u636e\u5305\u6570\uff0c\u5355\u4f4d\u662f\u5305 / \u79d2\u3002</li> </ul> <p>\u5bf9\u4e8e\u5e26\u5bbd\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>ethtool</code> \u547d\u4ee4\u6765\u67e5\u8be2\uff0c\u5b83\u7684\u5355\u4f4d\u901a\u5e38\u662f <code>Gb/s</code> \u6216\u8005 <code>Mb/s</code>\uff0c\u4e0d\u8fc7\u6ce8\u610f\u8fd9\u91cc\u5c0f\u5199\u5b57\u6bcd <code>b</code> \uff0c\u8868\u793a\u6bd4\u7279\u800c\u4e0d\u662f\u5b57\u8282\u3002\u6211\u4eec\u901a\u5e38\u63d0\u5230\u7684\u5343\u5146\u7f51\u5361\u3001\u4e07\u5146\u7f51\u5361\u7b49\uff0c\u5355\u4f4d\u4e5f\u90fd\u662f\u6bd4\u7279\uff08bit\uff09\u3002\u5982\u4e0b\u4f60\u53ef\u4ee5\u770b\u5230\uff0ceth0 \u7f51\u5361\u5c31\u662f\u4e00\u4e2a\u5343\u5146\u7f51\u5361\uff1a</p> Bash<pre><code>$ ethtool eth0 | grep Speed\n  Speed: 1000Mb/s\n</code></pre>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/linux_network/#_3","title":"\u8fde\u901a\u6027\u548c\u5ef6\u65f6\u5982\u4f55\u67e5\u770b\uff1f","text":"<p>\u8981\u6d4b\u8bd5\u672c\u673a\u4e0e\u8fdc\u7a0b\u4e3b\u673a\u7684\u8fde\u901a\u6027\u548c\u5ef6\u65f6\uff0c\u901a\u5e38\u662f\u4f7f\u7528 <code>ping</code> \u547d\u4ee4\uff0c\u5b83\u662f\u57fa\u4e8e ICMP \u534f\u8bae\u7684\uff0c\u5de5\u4f5c\u5728\u7f51\u7edc\u5c42\u3002</p> <p>\u6bd4\u5982\uff0c\u5982\u679c\u8981\u6d4b\u8bd5\u672c\u673a\u5230 <code>192.168.12.20</code> IP \u5730\u5740\u7684\u8fde\u901a\u6027\u548c\u5ef6\u65f6\uff1a</p> <p></p> <p>\u663e\u793a\u7684\u5185\u5bb9\u4e3b\u8981\u5305\u542b  <code>icmp_seq</code>\uff08ICMP \u5e8f\u5217\u53f7\uff09\u3001<code>TTL</code>\uff08\u751f\u5b58\u65f6\u95f4\uff0c\u6216\u8005\u8df3\u6570\uff09\u4ee5\u53ca <code>time</code> \uff08\u5f80\u8fd4\u5ef6\u65f6\uff09\uff0c\u800c\u4e14\u6700\u540e\u4f1a\u6c47\u603b\u672c\u6b21\u6d4b\u8bd5\u7684\u60c5\u51b5\uff0c\u5982\u679c\u7f51\u7edc\u6ca1\u6709\u4e22\u5305\uff0c<code>packet loss</code> \u7684\u767e\u5206\u6bd4\u5c31\u662f 0\u3002</p> <p>\u4e0d\u8fc7\uff0c\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c<code>ping</code> \u4e0d\u901a\u670d\u52a1\u5668\u5e76\u4e0d\u4ee3\u8868 HTTP \u8bf7\u6c42\u4e5f\u4e0d\u901a\uff0c\u56e0\u4e3a\u6709\u7684\u670d\u52a1\u5668\u7684\u9632\u706b\u5899\u662f\u4f1a\u7981\u7528 ICMP \u534f\u8bae\u7684\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/linux_network/#_4","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/","title":"10.2  \u5982\u4f55\u4ece\u65e5\u5fd7\u5206\u6790 PV\u3001UV\uff1f","text":"<p>\u5f88\u591a\u65f6\u5019\uff0c\u6211\u4eec\u89c2\u5bdf\u7a0b\u5e8f\u662f\u5426\u5982\u671f\u8fd0\u884c\uff0c\u6216\u8005\u662f\u5426\u6709\u9519\u8bef\uff0c\u6700\u76f4\u63a5\u7684\u65b9\u5f0f\u5c31\u662f\u770b\u8fd0\u884c\u65e5\u5fd7\uff0c\u5f53\u7136\u8981\u60f3\u4ece\u65e5\u5fd7\u5feb\u901f\u67e5\u5230\u6211\u4eec\u60f3\u8981\u7684\u4fe1\u606f\uff0c\u524d\u63d0\u662f\u7a0b\u5e8f\u6253\u5370\u7684\u65e5\u5fd7\u8981\u7cbe\u70bc\u3001\u7cbe\u51c6\u3002</p> <p>\u4f46\u65e5\u5fd7\u6db5\u76d6\u7684\u4fe1\u606f\u8fdc\u4e0d\u6b62\u4e8e\u6b64\uff0c\u6bd4\u5982\u5bf9\u4e8e nginx \u7684 access.log \u65e5\u5fd7\uff0c\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u65e5\u5fd7\u4fe1\u606f\u5206\u6790\u7528\u6237\u884c\u4e3a\u3002</p> <p>\u4ec0\u4e48\u7528\u6237\u884c\u4e3a\u5462\uff1f\u6bd4\u5982\u5206\u6790\u51fa\u54ea\u4e2a\u9875\u9762\u8bbf\u95ee\u6b21\u6570\uff08PV\uff09\u6700\u591a\uff0c\u8bbf\u95ee\u4eba\u6570\uff08UV\uff09\u6700\u591a\uff0c\u4ee5\u53ca\u54ea\u5929\u8bbf\u95ee\u91cf\u6700\u591a\uff0c\u54ea\u4e2a\u8bf7\u6c42\u8bbf\u95ee\u6700\u591a\u7b49\u7b49\u3002</p> <p>\u8fd9\u6b21\uff0c\u5c06\u7528\u4e00\u4e2a\u5927\u6982\u51e0\u4e07\u6761\u8bb0\u5f55\u7684 nginx \u65e5\u5fd7\u6587\u4ef6\u4f5c\u4e3a\u6848\u4f8b\uff0c\u4e00\u8d77\u6765\u770b\u770b\u5982\u4f55\u5206\u6790\u51fa\u300c\u7528\u6237\u4fe1\u606f\u300d\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/#_1","title":"\u522b\u6025\u7740\u5f00\u59cb","text":"<p>\u5f53\u6211\u4eec\u8981\u5206\u6790\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u5148\u7528 <code>ls -lh</code> \u547d\u4ee4\u67e5\u770b\u65e5\u5fd7\u6587\u4ef6\u7684\u5927\u5c0f\uff0c\u5982\u679c\u65e5\u5fd7\u6587\u4ef6\u5927\u5c0f\u975e\u5e38\u5927\uff0c\u6700\u597d\u4e0d\u8981\u5728\u7ebf\u4e0a\u73af\u5883\u505a\u3002</p> <p>\u6bd4\u5982\u6211\u4e0b\u9762\u8fd9\u4e2a\u65e5\u5fd7\u5c31 6.5M\uff0c\u4e0d\u7b97\u5927\uff0c\u5728\u7ebf\u4e0a\u73af\u5883\u5206\u6790\u95ee\u9898\u4e0d\u5927\u3002</p> <p></p> <p>\u5982\u679c\u65e5\u5fd7\u6587\u4ef6\u6570\u636e\u91cf\u592a\u5927\uff0c\u4f60\u76f4\u63a5\u4e00\u4e2a <code>cat</code> \u547d\u4ee4\u4e00\u6267\u884c\uff0c\u662f\u4f1a\u5f71\u54cd\u7ebf\u4e0a\u73af\u5883\uff0c\u52a0\u91cd\u670d\u52a1\u5668\u7684\u8d1f\u8f7d\uff0c\u4e25\u91cd\u7684\u8bdd\uff0c\u53ef\u80fd\u5bfc\u81f4\u670d\u52a1\u5668\u65e0\u54cd\u5e94\u3002</p> <p>\u5f53\u53d1\u73b0\u65e5\u5fd7\u5f88\u5927\u7684\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>scp</code> \u547d\u4ee4\u5c06\u6587\u4ef6\u4f20\u8f93\u5230\u95f2\u7f6e\u7684\u670d\u52a1\u5668\u518d\u5206\u6790\uff0cscp \u547d\u4ee4\u4f7f\u7528\u65b9\u5f0f\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/#cat","title":"\u614e\u7528 cat","text":"<p>\u5927\u5bb6\u90fd\u77e5\u9053 <code>cat</code> \u547d\u4ee4\u662f\u7528\u6765\u67e5\u770b\u6587\u4ef6\u5185\u5bb9\u7684\uff0c\u4f46\u662f\u65e5\u5fd7\u6587\u4ef6\u6570\u636e\u91cf\u6709\u591a\u5c11\uff0c\u5b83\u5c31\u8bfb\u591a\u5c11\uff0c\u5f88\u663e\u7136\u4e0d\u9002\u7528\u5927\u6587\u4ef6\u3002</p> <p>\u5bf9\u4e8e\u5927\u6587\u4ef6\uff0c\u6211\u4eec\u5e94\u8be5\u517b\u6210\u597d\u4e60\u60ef\uff0c\u7528 <code>less</code> \u547d\u4ee4\u53bb\u8bfb\u6587\u4ef6\u91cc\u7684\u5185\u5bb9\uff0c\u56e0\u4e3a less \u5e76\u4e0d\u4f1a\u52a0\u8f7d\u6574\u4e2a\u6587\u4ef6\uff0c\u800c\u662f\u6309\u9700\u52a0\u8f7d\uff0c\u5148\u662f\u8f93\u51fa\u4e00\u5c0f\u9875\u7684\u5185\u5bb9\uff0c\u5f53\u4f60\u8981\u5f80\u4e0b\u770b\u7684\u65f6\u5019\uff0c\u624d\u4f1a\u7ee7\u7eed\u52a0\u8f7d\u3002</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0cnginx \u7684 access.log \u65e5\u5fd7\u6bcf\u4e00\u884c\u662f\u4e00\u6b21\u7528\u6237\u8bbf\u95ee\u7684\u8bb0\u5f55\uff0c\u4ece\u5de6\u5230\u53f3\u5206\u522b\u5305\u542b\u5982\u4e0b\u4fe1\u606f\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u7684 IP \u5730\u5740\uff1b</li> <li>\u8bbf\u95ee\u65f6\u95f4\uff1b</li> <li>HTTP \u8bf7\u6c42\u7684\u65b9\u6cd5\u3001\u8def\u5f84\u3001\u534f\u8bae\u7248\u672c\u3001\u534f\u8bae\u7248\u672c\u3001\u8fd4\u56de\u7684\u72b6\u6001\u7801\uff1b</li> <li>User Agent\uff0c\u4e00\u822c\u662f\u5ba2\u6237\u7aef\u4f7f\u7528\u7684\u64cd\u4f5c\u7cfb\u7edf\u4ee5\u53ca\u7248\u672c\u3001\u6d4f\u89c8\u5668\u53ca\u7248\u672c\u7b49\uff1b</li> </ul> <p>\u4e0d\u8fc7\uff0c\u6709\u65f6\u5019\u6211\u4eec\u60f3\u770b\u65e5\u5fd7\u6700\u65b0\u90e8\u5206\u7684\u5185\u5bb9\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>tail</code> \u547d\u4ee4\uff0c\u6bd4\u5982\u5f53\u4f60\u60f3\u67e5\u770b\u5012\u6570 5 \u884c\u7684\u5185\u5bb9\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528\u8fd9\u6837\u7684\u547d\u4ee4\uff1a</p> <p></p> <p>\u5982\u679c\u4f60\u60f3\u5b9e\u65f6\u770b\u65e5\u5fd7\u6253\u5370\u7684\u5185\u5bb9\uff0c\u4f60\u53ef\u4ee5\u4f7f\u7528 <code>tail -f</code> \u547d\u4ee4\uff0c\u8fd9\u6837\u4f60\u770b\u65e5\u5fd7\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u662f\u963b\u585e\u72b6\u6001\uff0c\u6709\u65b0\u65e5\u5fd7\u8f93\u51fa\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5b9e\u65f6\u663e\u793a\u51fa\u6765\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/#pv","title":"PV  \u5206\u6790","text":"<p>PV \u7684\u5168\u79f0\u53eb Page View\uff0c\u7528\u6237\u8bbf\u95ee\u4e00\u4e2a\u9875\u9762\u5c31\u662f\u4e00\u6b21 PV\uff0c\u6bd4\u5982\u5927\u591a\u6570\u535a\u5ba2\u5e73\u53f0\uff0c\u70b9\u51fb\u4e00\u6b21\u9875\u9762\uff0c\u9605\u8bfb\u91cf\u5c31\u52a0 1\uff0c\u6240\u4ee5\u8bf4 PV \u7684\u6570\u91cf\u5e76\u4e0d\u4ee3\u8868\u771f\u5b9e\u7684\u7528\u6237\u6570\u91cf\uff0c\u53ea\u662f\u4e2a\u70b9\u51fb\u91cf\u3002</p> <p>\u5bf9\u4e8e nginx \u7684 <code>acess.log</code> \u65e5\u5fd7\u6587\u4ef6\u6765\u8bf4\uff0c\u5206\u6790 PV \u8fd8\u662f\u6bd4\u8f83\u5bb9\u6613\u7684\uff0c\u65e2\u7136\u65e5\u5fd7\u91cc\u7684\u5185\u5bb9\u662f\u8bbf\u95ee\u8bb0\u5f55\uff0c\u90a3\u6709\u591a\u5c11\u6761\u65e5\u5fd7\u8bb0\u5f55\u5c31\u6709\u591a\u5c11 PV\u3002</p> <p>\u6211\u4eec\u76f4\u63a5\u4f7f\u7528 <code>wc -l</code> \u547d\u4ee4\uff0c\u5c31\u53ef\u4ee5\u67e5\u770b\u6574\u4f53\u7684 PV \u4e86\uff0c\u5982\u4e0b\u56fe\u4e00\u5171\u6709 49903 \u6761 PV\u3002</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/#pv_1","title":"PV \u5206\u7ec4","text":"<p>nginx \u7684 <code>acess.log</code> \u65e5\u5fd7\u6587\u4ef6\u6709\u8bbf\u95ee\u65f6\u95f4\u7684\u4fe1\u606f\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u6839\u636e\u8bbf\u95ee\u65f6\u95f4\u8fdb\u884c\u5206\u7ec4\uff0c\u6bd4\u5982\u6309\u5929\u5206\u7ec4\uff0c\u67e5\u770b\u6bcf\u5929\u7684\u603b PV\uff0c\u8fd9\u6837\u53ef\u4ee5\u5f97\u5230\u66f4\u52a0\u76f4\u89c2\u7684\u6570\u636e\u3002</p> <p>\u8981\u6309\u65f6\u95f4\u5206\u7ec4\uff0c\u9996\u5148\u6211\u4eec\u5148\u300c\u8bbf\u95ee\u65f6\u95f4\u300d\u8fc7\u6ee4\u51fa\u6765\uff0c\u8fd9\u91cc\u53ef\u4ee5\u4f7f\u7528 awk \u547d\u4ee4\u6765\u5904\u7406\uff0cawk \u662f\u4e00\u4e2a\u5904\u7406\u6587\u672c\u7684\u5229\u5668\u3002</p> <p>awk \u547d\u4ee4\u9ed8\u8ba4\u662f\u4ee5\u300c\u7a7a\u683c\u300d\u4e3a\u5206\u9694\u7b26\uff0c\u7531\u4e8e\u8bbf\u95ee\u65f6\u95f4\u5728\u65e5\u5fd7\u91cc\u7684\u7b2c 4 \u5217\uff0c\u56e0\u6b64\u53ef\u4ee5\u4f7f\u7528 <code>awk '{print $4}' access.log</code> \u547d\u4ee4\u628a\u8bbf\u95ee\u65f6\u95f4\u7684\u4fe1\u606f\u8fc7\u6ee4\u51fa\u6765\uff0c\u7ed3\u679c\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e0a\u9762\u7684\u4fe1\u606f\u8fd8\u5305\u542b\u4e86\u65f6\u5206\u79d2\uff0c\u5982\u679c\u53ea\u60f3\u663e\u793a\u5e74\u6708\u65e5\u7684\u4fe1\u606f\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>awk</code> \u7684 <code>substr</code> \u51fd\u6570\uff0c\u4ece\u7b2c 2 \u4e2a\u5b57\u7b26\u5f00\u59cb\uff0c\u622a\u53d6 11 \u4e2a\u5b57\u7b26\u3002</p> <p></p> <p>\u63a5\u7740\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>sort</code> \u5bf9\u65e5\u671f\u8fdb\u884c\u6392\u5e8f\uff0c\u7136\u540e\u4f7f\u7528 <code>uniq -c</code> \u8fdb\u884c\u7edf\u8ba1\uff0c\u4e8e\u662f\u6309\u5929\u5206\u7ec4\u7684 PV \u5c31\u51fa\u6765\u4e86\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u5929\u7684 PV \u91cf\u5927\u6982\u5728 2000-2800\uff1a</p> <p></p> <p>\u6ce8\u610f\uff0c\u4f7f\u7528 <code>uniq -c</code> \u547d\u4ee4\u524d\uff0c\u5148\u8981\u8fdb\u884c <code>sort</code> \u6392\u5e8f\uff0c\u56e0\u4e3a uniq \u53bb\u91cd\u7684\u539f\u7406\u662f\u6bd4\u8f83\u76f8\u90bb\u7684\u884c\uff0c\u7136\u540e\u9664\u53bb\u7b2c\u4e8c\u884c\u548c\u8be5\u884c\u7684\u540e\u7eed\u526f\u672c\uff0c\u56e0\u6b64\u5728\u4f7f\u7528 uniq \u547d\u4ee4\u4e4b\u524d\uff0c\u8bf7\u4f7f\u7528 sort \u547d\u4ee4\u4f7f\u6240\u6709\u91cd\u590d\u884c\u76f8\u90bb\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/#uv","title":"UV \u5206\u6790","text":"<p>UV \u7684\u5168\u79f0\u662f Uniq Visitor\uff0c\u5b83\u4ee3\u8868\u8bbf\u95ee\u4eba\u6570\uff0c\u6bd4\u5982\u516c\u4f17\u53f7\u7684\u9605\u8bfb\u91cf\u5c31\u662f\u4ee5 UV \u7edf\u8ba1\u7684\uff0c\u4e0d\u7ba1\u5355\u4e2a\u7528\u6237\u70b9\u51fb\u4e86\u591a\u5c11\u6b21\uff0c\u6700\u7ec8\u53ea\u7b97 1 \u6b21\u9605\u8bfb\u91cf\u3002</p> <p>access.log \u65e5\u5fd7\u91cc\u867d\u7136\u6ca1\u6709\u7528\u6237\u7684\u8eab\u4efd\u4fe1\u606f\uff0c\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u7528\u300c\u5ba2\u6237\u7aef IP \u5730\u5740\u300d\u6765\u8fd1\u4f3c\u7edf\u8ba1 UV\u3002</p> <p></p> <p>\u8be5\u547d\u4ee4\u7684\u8f93\u51fa\u7ed3\u679c\u662f 2589\uff0c\u4e5f\u5c31\u8bf4\u660e UV \u7684\u91cf\u4e3a 2589\u3002\u4e0a\u56fe\u4e2d\uff0c\u4ece\u5de6\u5230\u53f3\u7684\u547d\u4ee4\u610f\u601d\u5982\u4e0b\uff1a</p> <ul> <li><code>awk '{print $1}' access.log</code>\uff0c\u53d6\u65e5\u5fd7\u7684\u7b2c 1 \u5217\u5185\u5bb9\uff0c\u5ba2\u6237\u7aef\u7684 IP \u5730\u5740\u6b63\u662f\u7b2c 1 \u5217\uff1b</li> <li><code>sort</code>\uff0c\u5bf9\u4fe1\u606f\u6392\u5e8f\uff1b</li> <li><code>uniq</code>\uff0c\u53bb\u9664\u91cd\u590d\u7684\u8bb0\u5f55\uff1b</li> <li><code>wc -l</code>\uff0c\u67e5\u770b\u8bb0\u5f55\u6761\u6570\uff1b</li> </ul>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/#uv_1","title":"UV \u5206\u7ec4","text":"<p>\u5047\u8bbe\u6211\u4eec\u6309\u5929\u6765\u5206\u7ec4\u5206\u6790\u6bcf\u5929\u7684 UV \u6570\u91cf\uff0c\u8fd9\u79cd\u60c5\u51b5\u5c31\u7a0d\u5fae\u6bd4\u8f83\u590d\u6742\uff0c\u9700\u8981\u6bd4\u8f83\u591a\u7684\u547d\u4ee4\u6765\u5b9e\u73b0\u3002</p> <p>\u65e2\u7136\u8981\u6309\u5929\u7edf\u8ba1 UV\uff0c\u90a3\u5c31\u5f97\u628a\u300c\u65e5\u671f + IP \u5730\u5740\u300d\u8fc7\u6ee4\u51fa\u6765\uff0c\u5e76\u53bb\u91cd\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> <p></p> <p>\u5177\u4f53\u5206\u6790\u5982\u4e0b\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b21 <code>ack</code> \u662f\u5c06\u7b2c 4 \u5217\u7684\u65e5\u671f\u548c\u7b2c 1 \u5217\u7684\u5ba2\u6237\u7aef IP \u5730\u5740\u8fc7\u6ee4\u51fa\u6765\uff0c\u5e76\u7528\u7a7a\u683c\u62fc\u63a5\u8d77\u6765\uff1b</li> <li>\u7136\u540e <code>sort</code> \u5bf9\u7b2c\u4e00\u6b21 ack \u8f93\u51fa\u7684\u5185\u5bb9\u8fdb\u884c\u6392\u5e8f\uff1b</li> <li>\u63a5\u7740\u7528 <code>uniq</code> \u53bb\u9664\u91cd\u590d\u7684\u8bb0\u5f55\uff0c\u4e5f\u5c31\u8bf4\u65e5\u671f +IP \u76f8\u540c\u7684\u884c\u5c31\u53ea\u4fdd\u7559\u4e00\u4e2a\uff1b</li> </ul> <p>\u4e0a\u9762\u53ea\u662f\u628a UV \u7684\u6570\u636e\u5217\u4e86\u51fa\u6765\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u7edf\u8ba1\u51fa\u6b21\u6570\u3002</p> <p>\u5982\u679c\u9700\u8981\u5bf9\u5f53\u5929\u7684 UV \u7edf\u8ba1\uff0c\u5728\u4e0a\u9762\u7684\u547d\u4ee4\u518d\u62fc\u63a5 <code>awk '{uv[$1]++;next}END{for (ip in uv) print ip, uv[ip]}'</code> \u547d\u4ee4\u5c31\u53ef\u4ee5\u4e86\uff0c\u7ed3\u679c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>awk \u672c\u8eab\u662f\u300c\u9010\u884c\u300d\u8fdb\u884c\u5904\u7406\u7684\uff0c\u5f53\u6267\u884c\u5b8c\u4e00\u884c\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 <code>next</code> \u5173\u952e\u5b57\u6765\u544a\u8bc9 awk \u8df3\u8f6c\u5230\u4e0b\u4e00\u884c\uff0c\u628a\u4e0b\u4e00\u884c\u4f5c\u4e3a\u8f93\u5165\u3002</p> <p>\u5bf9\u6bcf\u4e00\u884c\u8f93\u5165\uff0cawk \u4f1a\u6839\u636e\u7b2c 1 \u5217\u7684\u5b57\u7b26\u4e32\uff08\u4e5f\u5c31\u662f\u65e5\u671f\uff09\u8fdb\u884c\u7d2f\u52a0\uff0c\u8fd9\u6837\u76f8\u540c\u65e5\u671f\u7684 ip \u5730\u5740\uff0c\u5c31\u4f1a\u7d2f\u52a0\u8d77\u6765\uff0c\u4f5c\u4e3a\u5f53\u5929\u7684 uv \u6570\u91cf\u3002</p> <p>\u4e4b\u540e\u7684 <code>END</code> \u5173\u952e\u5b57\u4ee3\u8868\u4e00\u4e2a\u89e6\u53d1\u5668\uff0c\u5c31\u662f\u5f53\u524d\u9762\u7684\u8f93\u5165\u5168\u90e8\u5b8c\u6210\u540e\uff0c\u624d\u4f1a\u6267\u884c END {} \u4e2d\u7684\u8bed\u53e5\uff0cEND \u7684\u8bed\u53e5\u662f\u901a\u8fc7 foreach \u904d\u5386 uv \u4e2d\u6240\u6709\u7684 key\uff0c\u6253\u5370\u51fa\u6309\u5929\u5206\u7ec4\u7684 uv \u6570\u91cf\u3002</p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/#_2","title":"\u7ec8\u7aef\u5206\u6790","text":"<p>nginx \u7684 access.log \u65e5\u5fd7\u6700\u672b\u5c3e\u5173\u4e8e User Agent \u7684\u4fe1\u606f\uff0c\u4e3b\u8981\u662f\u5ba2\u6237\u7aef\u8bbf\u95ee\u670d\u52a1\u5668\u4f7f\u7528\u7684\u5de5\u5177\uff0c\u53ef\u80fd\u662f\u624b\u673a\u3001\u6d4f\u89c8\u5668\u7b49\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5229\u7528\u8fd9\u4e00\u4fe1\u606f\u6765\u5206\u6790\u6709\u54ea\u4e9b\u7ec8\u7aef\u8bbf\u95ee\u4e86\u670d\u52a1\u5668\u3002</p> <p>User Agent \u7684\u4fe1\u606f\u5728\u65e5\u5fd7\u91cc\u7684\u7b2c 12 \u5217\uff0c\u56e0\u6b64\u6211\u4eec\u5148\u4f7f\u7528 <code>awk</code> \u8fc7\u6ee4\u51fa\u7b2c 12 \u5217\u7684\u5185\u5bb9\u540e\uff0c\u8fdb\u884c <code>sort</code> \u6392\u5e8f\uff0c\u518d\u7528 <code>uniq -c</code> \u53bb\u91cd\u5e76\u7edf\u8ba1\uff0c\u6700\u540e\u518d\u4f7f\u7528 <code>sort -rn</code>\uff08r \u8868\u793a\u9006\u5411\u6392\u5e8f\uff0cn \u8868\u793a\u6309\u6570\u503c\u6392\u5e8f\uff09\u5bf9\u7edf\u8ba1\u7684\u7ed3\u679c\u6392\u5e8f\uff0c\u7ed3\u679c\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/#top3","title":"\u5206\u6790 TOP3 \u7684\u8bf7\u6c42","text":"<p>access.log \u65e5\u5fd7\u4e2d\uff0c\u7b2c 7 \u5217\u662f\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u8def\u5f84\uff0c\u5148\u4f7f\u7528 <code>awk</code> \u8fc7\u6ee4\u51fa\u7b2c 7 \u5217\u7684\u5185\u5bb9\u540e\uff0c\u8fdb\u884c <code>sort</code> \u6392\u5e8f\uff0c\u518d\u7528 <code>uniq -c</code> \u53bb\u91cd\u5e76\u7edf\u8ba1\uff0c\u7136\u540e\u518d\u4f7f\u7528 <code>sort -rn</code> \u5bf9\u7edf\u8ba1\u7684\u7ed3\u679c\u6392\u5e8f\uff0c\u6700\u540e\u4f7f\u7528 <code>head -n 3</code> \u5206\u6790 TOP3 \u7684\u8bf7\u6c42\uff0c\u7ed3\u679c\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/9_linux_cmd/pv_uv/#_3","title":"\u5173\u6ce8\u4f5c\u8005","text":"<p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u540e\uff0c\u56de\u590d\u300c\u7f51\u7edc\u300d\u518d\u9001\u4f60\u56fe\u89e3\u7f51\u7edc PDF</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/","title":"\u4ecb\u7ecd","text":"<p>\u672c\u7cfb\u5217\u662f\u5c0f\u6797\u7684\u4e2a\u4eba\u7684\u5b66\u4e60\u5fc3\u5f97\uff0c\u5e0c\u671b\u5bf9\u5927\u5bb6\u6709\u542f\u53d1:muscle:\u3002</p> <ul> <li>\u5b66\u4e60\u8ba1\u7b97\u673a\u57fa\u7840\u6709\u4ec0\u4e48\u63a8\u8350\u7684\u4e66\uff1f</li> <li>\u770b\u4e66\u7684\u4e00\u70b9\u5c0f\u5efa\u8bae</li> <li>\u5982\u4f55\u5c06\u8ba1\u7b97\u673a\u7f51\u7edc\u3001\u64cd\u4f5c\u7cfb\u7edf\u3001\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u3001\u8ba1\u7b97\u7ec4\u6210\u878d\u4f1a\u8d2f\u901a\uff1f</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/","title":"\u5b66\u4e60\u8ba1\u7b97\u673a\u57fa\u7840\u6709\u4ec0\u4e48\u63a8\u8350\u7684\u4e66\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e4b\u524d\u6709\u8bfb\u8005\u95ee\u6211\uff0c\u5b66\u4e60\u8ba1\u7b97\u673a\u57fa\u7840\u6709\u4ec0\u4e48\u63a8\u8350\u7684\u4e66\uff1f</p> <p>\u8fd9\u4e00\u4e2a\u6211\u5c31\u5f88\u6709\u5fc3\u5f97\u4e86\uff0c\u56e0\u4e3a\u6211\u5927\u5b66\u7684\u4e13\u4e1a\u5e76\u4e0d\u662f\u8ba1\u7b97\u673a\u4e13\u4e1a\u7684\uff0c\u662f\u7535\u6c14\u81ea\u52a8\u5316\u4e13\u4e1a\u7684\uff0c\u6240\u4ee5\u5b66\u6821\u7684\u8bfe\u7a0b\u5e76\u6ca1\u6709\u64cd\u4f5c\u7cfb\u7edf\u3001\u8ba1\u7b97\u673a\u7f51\u7edc\u3001\u8ba1\u7b97\u673a\u7ec4\u6210\u3001\u6570\u636e\u5e93\u8fd9\u7c7b\u8bfe\u7a0b\uff0c\u4f46\u662f\u8fd8\u662f\u4f1a\u6709\u7f16\u7a0b\u8bfe\u3002</p> <p>\u6240\u4ee5\uff0c\u8ba1\u7b97\u673a\u57fa\u7840\u8fd9\u4e9b\u8bfe\u7a0b\u90fd\u662f\u6211\u81ea\u5b66\u8fc7\u6765\u7684\uff0c\u671f\u95f4\u770b\u8fc7\u4e86\u5f88\u591a\u7684\u4e66\uff0c\u4e5f\u5728\u4e2d\u56fd\u6155\u8bfe\u548c B \u7ad9\u5237\u8fc7\u5f88\u591a\u89c6\u9891\uff0c\u8e29\u8fc7\u4e0d\u5c11\u7684\u5751\u3002</p> <p>\u5176\u5b9e\u5728\u81ea\u5b66\u8fc7\u7a0b\u4e2d\uff0c\u6700\u5bb9\u6613\u8e29\u5751\u7684\u5730\u65b9\u5c31\u662f\u4e0d\u770b\u81ea\u5df1\u5f53\u524d\u6c34\u5e73\uff0c\u76f2\u76ee\u8ddf\u98ce\u4e70\u90a3\u4e9b\u8c46\u74e3\u9ad8\u5206\u7684\u5927\u800c\u5168\u7684\u8ba1\u7b97\u673a\u9ed1\u76ae\u7cfb\u5217\u7684\u4e66\uff0c\u7136\u540e\u5b66\u51e0\u5929\uff0c\u5c31\u653e\u5f03\u4e86\u3002</p> <p>\u8fd9\u4e9b\u5927\u800c\u5168\u7684\u8ba1\u7b97\u673a\u9ed1\u76ae\u4e66\u5f53\u7136\u5f88\u7ecf\u5178\uff0c\u4f46\u662f\u5b83\u4eec\u5e76\u4e0d\u9002\u5408\u65b0\u4eba\u5165\u95e8\u5b66\u4e60\uff0c\u56e0\u4e3a\u8fd9\u7c7b\u4e66\u7c4d\u7684\u5185\u5bb9\u90fd\u5145\u6ee1\u5927\u91cf\u7684\u4e13\u4e1a\u672f\u8bed\uff0c\u6211\u4eec\u4eba\u5728\u770b\u5230\u964c\u751f\u53c8\u96be\u4ee5\u7406\u89e3\u7684\u8bcd\u6c47\u65f6\uff0c\u5c31\u4f1a\u611f\u89c9\u5f88\u5403\u529b\uff0c\u8111\u5b50\u770b\u7740\u5c31\u4f1a\u5f88\u7d2f\uff0c\u5c31\u4f1a\u9a71\u4f7f\u4f60\u505a\u7b80\u5355\u548c\u5feb\u4e50\u7684\u4e8b\u60c5\uff0c\u6bd4\u5982\u7761\u89c9\u3001\u5237\u77ed\u89c6\u9891\u3001\u73a9\u6e38\u620f\u3002\u3002\u3002</p> <p>\u4e0d\u8981\u95ee\u6211\uff0c\u4e3a\u4ec0\u4e48\u77e5\u9053\u7684\u90a3\u4e48\u6e05\u695a\uff0c\u56e0\u4e3a\u6211\u5c31\u662f\u8fd9\u4e48\u8e29\u5751\u8fc7\u6765\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u8ba4\u4e3a\u5b66\u4e60\u4e00\u95e8\u5b66\u79d1\u7684\u65f6\u5019\uff0c\u8981\u4ece\u6700\u57fa\u7840\u7684\u4e66\u5f00\u59cb\u5b66\u8d77\uff0c\u63a5\u7740\u642d\u914d\u89c6\u9891\u5feb\u901f\u5165\u95e8\uff0c\u7136\u540e\u518d\u6e10\u6e10\u6b65\u5165\u5230\u8fd9\u4e9b\u5927\u800c\u5168\u7684\u8ba1\u7b97\u673a\u9ed1\u76ae\u4e66\u3002</p> <p>\u5173\u952e\u7684\u95ee\u9898\u6765\u4e86\uff0c\u8ba1\u7b97\u673a\u57fa\u7840\u6709\u54ea\u4e9b\u5165\u95e8\u7684\u57fa\u7840\u4e66\u548c\u89c6\u9891\u5462\uff1f</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u5c31\u8ddf\u5927\u5bb6\u5206\u4eab\u4e0b\uff0c\u6211\u770b\u8fc7\u7684\u4e66\u548c\u89c6\u9891\uff0c\u90fd\u662f\u4ece\u5165\u95e8\u518d\u5230\u8fdb\u9636\u7684\u8def\u7ebf\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_2","title":"\u4e00\u3001\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5","text":"<p>\u5f88\u591a\u4eba\u540c\u5b66\u5728\u5927\u4e00\u7684\u65f6\u5019\uff0c\u5c31\u5b66\u4f1a\u4e86\u4e00\u95e8\u7f16\u7a0b\u8bed\u8a00\uff0c\u5927\u6982\u7387\u90fd\u662f C \u8bed\u8a00\uff0c\u6709\u4e86\u4e00\u5b9a\u7684\u7f16\u7a0b\u80fd\u529b\uff0c\u5c31\u53ef\u4ee5\u5f00\u59cb\u5b66\u4e60\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u3002</p> <p>\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u8fd9\u65b9\u9762\u7684\u8bdd\u662f\u975e\u5e38\u975e\u5e38\u975e\u5e38\u91cd\u8981\u7684\uff0c\u60f3\u8981\u51b2\u5927\u5382\u7684\u540c\u5b66\u4eec\u5982\u679c\u8fd9\u65b9\u9762\u4e0d\u8fc7\u5173\u53ef\u80fd\u8fde\u7b14\u8bd5\u90fd\u8fc7\u4e0d\u53bb\uff0c\u66f4\u522b\u8c08\u9762\u8bd5\u7684\u624b\u6495\u7b97\u6cd5\u4e86\u3002</p> <ul> <li>\u7b97\u6cd5\uff1a \u52a8\u6001\u89c4\u5212\u3001\u56de\u6eaf\u7b97\u6cd5\u3001\u67e5\u627e\u7b97\u6cd5\u3001\u641c\u7d22\u7b97\u6cd5\u3001\u8d2a\u5fc3\u7b97\u6cd5\u3001\u5206\u6cbb\u7b97\u6cd5\u3001\u4f4d\u8fd0\u7b97\u3001\u53cc\u6307\u9488\u3001\u6392\u5e8f\u3001\u6a21\u62df\u3001\u6570\u5b66\u3001\u2026\u2026</li> <li>\u6570\u636e\u7ed3\u6784\uff1a \u6570\u7ec4\u3001\u6808\u3001\u961f\u5217\u3001\u5b57\u7b26\u4e32\u3001\u94fe\u8868\u3001\u6811\u3001\u56fe\u3001\u5806\u3001\u54c8\u5e0c\u8868\u3001\u2026\u2026</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_3","title":"\u6570\u636e\u7ed3\u6784\u5b66\u4e60","text":"<p>\u9996\u5148\u63a8\u8350\u300a\u5927\u8bdd\u6570\u636e\u7ed3\u6784\u300b\u8fd9\u672c\u5165\u95e8\u7ea7\u522b\u7684\u4e66\uff0c\u56e0\u4e3a\u4e66\u91cc\u7684\u5185\u5bb9\u90fd\u662f\u5927\u767d\u8bdd\uff0c\u800c\u4e14\u8fd8\u56fe\u6587\u5e76\u8302\uff0c\u8bfb\u8d77\u6765\u8fd8\u662f\u5f88\u987a\u7545\u7684\u3002</p> <p>\u7136\u540e\u89c6\u9891\u63a8\u8350\u300a\u6d59\u6c5f\u5927\u5b66\u7684\u6570\u636e\u7ed3\u6784\u300b\u8bfe\u7a0b\uff0c\u5728 B \u7ad9\u5c31\u80fd\u641c\u7d22\u5230\uff0c\u8bfe\u7a0b\u662f\u8001\u5e08\u5e26\u5927\u5bb6\u7528 C \u8bed\u8a00\u6765\u5b9e\u73b0\u5404\u79cd\u5e38\u89c1\u7684\u6570\u636e\u7ed3\u6784\u3002</p> <p></p> <p>\u73b0\u5728\u5927\u591a\u6570\u9ad8\u7ea7\u8bed\u8a00\u90fd\u4f1a\u6709\u5bb9\u5668\uff0c\u5c31\u662f\u628a\u4e00\u4e9b\u5e38\u89c1\u7684\u6570\u636e\u7ed3\u6784\u5c01\u88c5\u6210\u4e86\u5bb9\u5668\uff0c\u7136\u540e\u4f7f\u7528\u8d77\u6765\u5c31\u6bd4\u8f83\u65b9\u4fbf\uff0c\u4f46\u662f\u4e0d\u5229\u4e8e\u6211\u4eec\u7406\u89e3\u5e95\u5c42\u7684\u6570\u636e\u7ed3\u6784\u662f\u600e\u4e48\u53d8\u6362\u548c\u64cd\u4f5c\u7684\uff0c\u6240\u4ee5\u8fd9\u95e8\u8bfe\u8fd8\u662f\u5f88\u6709\u610f\u4e49\u7684\u3002</p> <p>\u5982\u679c\u60f3\u8981\u5b9e\u6218\u7684\u8bdd\uff0c\u53ef\u4ee5\u53bb Leetcode \u5b98\u65b9\u51fa\u54c1\u7684\u514d\u8d39\u6559\u7a0b Leetbook\uff0c\u7f51\u7ad9\u5f88\u7ec6\u5fc3\u7684\u6309\u7167\u5404\u4e2a\u77e5\u8bc6\u70b9\u5faa\u5e8f\u6e10\u8fdb\u5730\u7f57\u5217\u4e86\u51fa\u6765\u3002\u8bb2\u89e3\u77e5\u8bc6 + \u5b9e\u6218\u6f14\u7ec3\uff0c\u5b66\u4e60\u8d77\u6765\u4f1a\u6bd4\u770b\u4e66\u6548\u7387\u9ad8\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_4","title":"\u7b97\u6cd5\u5b66\u4e60","text":"<p>\u4e4b\u524d\u6709\u4f4d\u6821\u62db\u53bb\u5b57\u8282\u7684\u8bfb\u8005\u5206\u4eab\u8fc7\u4ed6\u7684\u7b97\u6cd5\u5b66\u4e60\u5fc3\u5f97\uff0c\u6211\u89c9\u5f97\u5199\u7684\u4e0d\u9519\uff0c\u8fd9\u91cc\u6211\u5c31\u76f4\u63a5\u8d34\u51fa\u6765\u3002</p> <p>\u5728\u6211\u770b\u6765\uff0c\u7b14\u8bd5\u80fd\u529b\u5728\u6821\u62db\u4e2d\u8981\u5360\u636e 60% \u7684\u91cd\u8981\u7a0b\u5ea6\u3002</p> <p>\u9996\u5148\u7b14\u8bd5\u4e0d\u8fc7\uff0c\u4f60\u6839\u672c\u6ca1\u6709\u9762\u8bd5\u7684\u5c55\u793a\u673a\u4f1a\u3002\u5176\u6b21\u9762\u8bd5\u4e2d\u4e5f\u4f1a\u53cd\u590d\u8ba9\u4f60\u624b\u5199\u4ee3\u7801\uff0c\u4ee5\u5b57\u8282\u4e3a\u4f8b\uff0c\u6bcf\u4e00\u8f6e\u9762\u8bd5\u90fd\u662f 1-2 \u9053\u7f16\u7a0b\u9898\uff0c\u6709\u65f6\u5019\u4e0d\u600e\u4e48\u804a\u7b80\u5386\uff1b\u767e\u5ea6\u6bcf\u4e00\u8f6e\u9762\u8bd5\u6709\u4e00\u9053\u7f16\u7a0b\u9898\u3002\u73b0\u5728\u516c\u53f8\u7684\u9762\u8bd5\u6a21\u5f0f\u5c31\u662f\u8fd9\u6837\uff0c\u5982\u679c\u4ee3\u7801\u6ca1\u641e\u51fa\u6765\uff0c\u5927\u6982\u7387\u4f1a\u88ab\u6dd8\u6c70\u3002</p> <p>\u5e76\u4e14\u6700\u7a92\u606f\u7684\u662f\u8fd9\u4e9b\u4ee3\u7801\u9898\u90fd\u4e0d\u7b80\u5355\uff0c\u4e00\u822c\u90fd\u662f leetcode \u4e2d\u7b49\u5230 hard \u96be\u5ea6\u3002</p> <p>\u5237\u9898\u4e3b\u8981\u53ef\u4ece\u4ee5\u4e0b\u4e09\u4e2a\u6e20\u9053\u3002</p> <p>\u7b2c\u4e00\u4e2a\uff0c\u5251\u6307 offer\uff1a</p> <p>https://www.nowcoder.com/ta/coding-interviews</p> <p></p> <p>\u7b2c\u4e8c\u4e2a\uff0cleetcode: </p> <p>https://leetcode-cn.com/problemset/algorithms/</p> <p></p> <p>\u7b2c\u4e09\u4e2a\uff0c\u8fd1\u671f\u9762\u8bd5\u4e2d\u5e38\u8003\u9898\uff1a</p> <p>https://www.nowcoder.com/activity/oj</p> <p></p> <p>\u300a\u5251\u6307 offer\u300b\u4f5c\u4e3a\u5927\u7ecf\u5178\uff0c\u662f\u4e00\u5b9a\u8981\u5237\u4e24\u904d\u4ee5\u4e0a\u7684\uff0c\u5f88\u591a\u9898\u90fd\u662f\u9762\u8bd5\u65f6\u7684\u539f\u9898\uff0c\u91cc\u9762\u5305\u542b\u4e86\u5f88\u591a\u7b14\u8bd5\u5e38\u7528\u7684\u601d\u60f3\u65b9\u6cd5\uff0c\u53cd\u590d\u770b\uff0c\u53cd\u590d\u7814\u3002</p> <p>\u6211\u4e00\u5f00\u59cb\u6bcf\u5929 10 \u9898\uff0c\u8fc7\u4e24\u904d\u4ee5\u540e\uff0c\u8981\u6c42\u81ea\u5df1\u6bcf\u5929\u5feb\u901f\u8fc7\u5251\u6307\u4e00\u904d\u3002</p> <p>leetcode \u7531\u4e8e\u9898\u76ee\u5341\u5206\u4e4b\u591a\uff0c\u5237\u5b8c\u662f\u4e0d\u53ef\u80fd\u7684\u3002\u6211\u7684\u610f\u89c1\u662f leetcode \u4f5c\u4e3a\u4f60\u5f31\u9879\u7684\u4e13\u9879\u7ec3\u4e60\u3002</p> <p>leetcode \u53f3\u4fa7\u6709\u6807\u7b7e\u5206\u7c7b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u53e6\u5916\u5728\u5de9\u56fa\u5b8c\u5f31\u9879\u7684\u60c5\u51b5\u4e0b\uff0c\u5efa\u8bae\u5c06 leetcode \u524d 300 \u9898\u5237\u719f\u7ec3\uff0c\u636e\u6211\u4e2a\u4eba\u9762\u8bd5\u7ecf\u5386\uff0c\u56fd\u5185\u5927\u5382\u9762\u8bd5\u51fa\u7684\u4ee3\u7801\u9898 80% \u90fd\u662f\u8fd9\u4e2a\u8303\u56f4\u5185\u7684\u3002</p> <p>\u53e6\u5916\uff0c\u6211\u5728\u5237\u9898\u7684\u65f6\u5019\u770b\u4e86 labuladong \u603b\u7ed3\u7684\u7b97\u6cd5\u5c0f\u6284\uff0c\u5bf9\u7b97\u6cd5\u7684\u7406\u89e3\u5f88\u6709\u5e2e\u52a9\u3002</p> <p>\u6700\u540e\u6839\u636e\u6211\u7684\u9762\u8bd5\u7ecf\u5386\uff0c\u6839\u636e\u4e2a\u4eba\u611f\u89c9\uff0c\u516c\u53f8\u5e38\u8003\u9898\u6709\uff1a</p> <ul> <li>\u94fe\u8868\u7c7b\uff08\u94fe\u8868\u53cd\u8f6c\u7c7b\u9898\u76ee\uff09</li> <li>\u4e8c\u53c9\u6811\u7c7b\uff08\u4e8c\u53c9\u6811\u7684\u904d\u5386\u7c7b\u578b\u9898\uff0c\u6700\u5927\u516c\u7956\u5148\u7c7b\u9898\u76ee\uff09</li> <li>\u5b57\u7b26\u4e32\u64cd\u4f5c\u9898\u76ee</li> <li>dfs/bfs</li> <li>\u52a8\u6001\u89c4\u5212\uff08\u8fd9\u4e2a\u8003\u7684\u57fa\u672c\u90fd\u662f leetcode \u4e0a\u7684\u6216\u8005\u662f\u80cc\u5305\u95ee\u9898\uff0c\u5bf9\u4e8e\u52a8\u6001\u89c4\u5212\u95ee\u9898\u5176\u5b9e\u6709\u5f88\u591a\u79cd\u7c7b\uff0c\u6bd4\u8f83\u89c1\u5230\u7684\u5c31\u662f\u4e00\u7ef4\u52a8\u6001\u548c\u4e8c\u7ef4\u52a8\u6001\uff09\uff0c\u53e6\u5916\u8fd8\u6709\u533a\u95f4\u8c03\u5ea6\u7c7b\u578b\u7684\u9898\u76ee\uff08\u8d2a\u5fc3\u7b97\u6cd5\uff0c\u4e5f\u5c5e\u4e8e\u52a8\u6001\u89c4\u5212\u7684\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\u3002</li> </ul> <p>\u5176\u5b9e\u4e5f\u6ca1\u6709\u4ec0\u4e48\u6280\u5de7\uff0c\u591a\u5237\u9898\uff0c\u591a\u7406\u89e3\u5c31\u597d\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_5","title":"\u4e8c\u3001\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406","text":"<p>\u8ba1\u7b97\u7ec4\u6210\u539f\u7406\u786e\u5b9e\u662f\u5206\u4e3a\u4e24\u4e2a\u65b9\u5411\uff0c\u4e00\u4e2a\u662f\u786c\u4ef6\u7535\u8def\u7684\uff0c\u4e00\u4e2a\u662f\u8f6f\u4ef6\u7a0b\u5e8f\u7684\u3002</p> <p>\u6211\u81ea\u5df1\u672c\u8eab\u662f\u5e72\u5f00\u53d1\u7684\uff0c\u6240\u4ee5\u6211\u8fd9\u6b21\u5206\u4eab\u7684\u673a\u7ec4\u8d44\u6599\u662f\u8ddf\u8f6f\u5316\u7a0b\u5e8f\u6709\u5173\u7684\uff0c\u4e5f\u5c31\u662f\u4e0d\u4f1a\u6d89\u53ca\u5230\u786c\u4ef6\u7535\u8def\u7684\u4e1c\u897f\uff0c\u5373\u4f7f\u4f60\u4e0d\u4f1a\u6570\u5b57\u7535\u8def\u3001\u5fae\u673a\u539f\u7406\u4e5f\u662f\u53ef\u4ee5\u76f4\u63a5\u5b66\u4e60\u7684\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_6","title":"\u5165\u95e8\u5b66\u4e60","text":"<p>\u5148\u6781\u529b\u63a8\u8350 b \u7ad9\u7684\u300a\u8ba1\u7b97\u673a\u79d1\u5b66\u901f\u6210\u8bfe\u300b\uff0c\u8fd9\u4e2a\u8bfe\u7a0b\u662f\u56fd\u5916\u5f55\u5236\u7684\uff0c\u5185\u5bb9\u771f\u7684\u662f\u597d\uff0c\u89c6\u9891\u7684\u52a8\u753b\u5f88\u7cbe\u7f8e\uff0c\u8bb2\u8bfe\u7684\u65f6\u5019\u4e0d\u4f1a\u5f88\u6b7b\u677f\uff0c\u53cd\u6b63\u5c31\u662f\u4e0d\u770b\u540e\u6094\u3001\u76f8\u89c1\u5f88\u665a\u7cfb\u5217\u3002</p> <p></p> <p>\u5bf9\u4e8e\u5165\u95e8\u8ba1\u7b97\u673a\u7ec4\u6210\uff0c\u53ef\u4ee5\u5148\u770b\u524d 10 \u4e2a\u89c6\u9891\uff0c\u770b\u5b8c\u8fd9 10 \u4e2a\u89c6\u9891\u4e5f\u5c31\u4e0d\u5230 2 \u4e2a\u5c0f\u65f6\uff0c\u770b\u5b8c\u524d 10 \u4e2a\u89c6\u9891\u5bf9\u8ba1\u7b97\u673a\u7684\u5de5\u4f5c\u65b9\u5f0f\u5c31\u6709\u4e00\u4e2a\u57fa\u672c\u7684\u4e86\u89e3\u4e86\u3002</p> <p>\u770b\u5b8c\u524d 10 \u4e2a\u89c6\u9891\u5c31\u53ef\u4ee5\u5f00\u59cb\u770b\u4e66\u4e86\u3002</p> <p>\u8bb2\u771f\uff0c\u4e0d\u592a\u5efa\u8bae\u5c0f\u767d\u4e00\u4e0a\u6765\u5c31\u770b\u90a3\u4e9b\u539a\u7684\u4e0d\u884c\u7684\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u7684\u9ed1\u76ae\u4e66\uff0c\u8fd9\u4e9b\u4e66\u662f\u7ecf\u5178\u7684\u6ca1\u9519\uff0c\u4e5f\u6b63\u662f\u7531\u4e8e\u5b83\u4eec\u662f\u7ecf\u5178\u7684\uff0c\u6240\u4ee5\u8fd9\u4e9b\u4e66\u7684\u77e5\u8bc6\u4f53\u7cfb\u5f88\u5168\u3001\u5f88\u591a\u3001\u5f88\u539a\u3002</p> <p>\u4f46\u662f\u8fd9\u6837\u5f88\u5bb9\u6613\u8ba9\u521d\u5b66\u8005\u8ff7\u5931\u5728\u91cc\u5934\uff0c\u53ef\u80fd\u521a\u5174\u81f4\u52c3\u52c3\u770b\u51e0\u5341\u9875\u5c31\u653e\u5f03\u4e86\uff0c\u4e8e\u662f\u8fd9\u4e9b\u539a\u7684\u4e0d\u884c\u7684\u4e66\u5c31\u6210\u4e3a\u4e86\u4f60\u4eec\u7684\u57ab\u4e66\u795e\u5668\uff0c\u77e5\u8bc6\u6ca1\u5b66\u591a\u5c11\uff0c\u9888\u690e\u75c5\u5012\u662f\u6cbb\u597d\u4e86\u3002</p> <p>\u5bf9\u4e8e\u521d\u5b66\u8005\uff0c\u6211\u63a8\u8350\u4e24\u672c\u4e66\u300a\u8ba1\u7b97\u673a\u662f\u600e\u4e48\u6837\u8dd1\u8d77\u6765\u300b\u548c\u300a\u7a0b\u5e8f\u662f\u600e\u4e48\u8dd1\u8d77\u6765\u7684\u300b\uff0c\u8fd9\u4e24\u672c\u5f88\u8584\u800c\u4e14\u56fe\u6587\u5e76\u8302\uff0c\u4f5c\u8005\u90fd\u662f\u7528\u5927\u767d\u8bdd\u7684\u65b9\u5f0f\u6765\u9610\u8ff0\u77e5\u8bc6\uff0c\u8fd9\u70b9\u5bf9\u521d\u5b66\u8005\u975e\u5e38\u53cb\u597d\u3002</p> <p>\u8fd9\u4e24\u672c\u4e0d\u7528 1 \u4e2a\u6708\u5c31\u80fd\u770b\u5b8c\uff0c\u56e0\u4e3a\u5728\u770b\u8fd9\u4e24\u672c\u4e66\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u770b\u7684\u5f88\u987a\u7545\uff0c\u76f8\u6bd4\u5b66\u4e60\u7684\u5fc3\u6001\uff0c\u4f60\u66f4\u591a\u7684\u662f\u4f1a\u5e26\u7740\u300c\u597d\u5947\u5fc3\u300d\u7684\u5fc3\u6001\u53bb\u8bfb\u3002</p> <p>\u5176\u4e2d \u300a\u7a0b\u5e8f\u662f\u600e\u4e48\u8dd1\u8d77\u6765\u7684\u300b\u662f\u4e00\u4e2a\u300c\u5fae\u7f29\u7248\u672c\u300d\u7684\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\uff0c\u4f60\u53ef\u4ee5\u53ea\u9009\u62e9\u770b\u8fd9\u4e00\u672c\uff0c\u4ece\u8fd9\u672c\u4e66\u7684\u540d\u5b57\u4e5f\u53ef\u4ee5\u77e5\u9053\uff0c\u5b83\u662f\u4ece\u8ba1\u7b97\u673a\u662f\u600e\u4e48\u8fd0\u884c\u7a0b\u5e8f\u7684\u89c6\u89d2\u6765\u8bb2\u7684\uff0c\u7136\u540e\u628a\u6d89\u53ca\u5230\u7684\u8ba1\u7b97\u673a\u786c\u4ef6\u548c\u5b83\u4eec\u4e4b\u95f4\u662f\u5982\u4f55\u534f\u4f5c\u7684\u4e00\u70b9\u4e00\u70b9\u7684\u7ed9\u5927\u5bb6\u5e26\u51fa\u6765\uff0c\u8ba9\u5927\u5bb6\u80fd\u77ac\u95f4\u660e\u767d\u8fd9\u4e9b\u8ba1\u7b97\u673a\u786c\u4ef6\u7684\u4f5c\u7528\u3002</p> <p>\u8fd9\u672c\u4ec5\u4ec5\u662f\u5165\u95e8\u7ea7\u522b\uff0c\u4e3b\u8981\u7684\u4f5c\u7528\u662f\u8ba9\u521d\u5b66\u8005\u660e\u767d\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u8fd9\u95e8\u8bfe\u662f\u5b66\u4ec0\u4e48\u7684\uff0c\u4ee5\u53ca\u68b3\u7406\u4e3b\u8981\u7684\u77e5\u8bc6\u4f53\u7cfb\uff0c\u6709\u4e86\u8fd9\u672c\u4e66\u7684\u6982\u5ff5\u540e\uff0c\u518d\u53bb\u6df1\u5165\u8ba1\u7b97\u673a\u7ec4\u6210\u7684\u65f6\u5019\uff0c\u5c31\u4e0d\u4f1a\u96e8\u91cc\u96fe\u91cc\u7684\u3002</p> <p>\u53e6\u5916\uff0c\u300a\u7f16\u7801\uff1a\u9690\u533f\u5728\u8ba1\u7b97\u673a\u8f6f\u786c\u4ef6\u80cc\u540e\u7684\u8bed\u8a00\u300b\u8fd9\u672c\u4e66\u4e5f\u5f88\u4e0d\u9519\uff0c\u662f\u672c\u79d1\u666e\u7c7b\u7684\u4e66\uff0c\u975e\u5e38\u9002\u5408\u975e\u79d1\u73ed\u7684\u540c\u5b66\uff0c\u4e3b\u8981\u8bb2\u662f\u8ba1\u7b97\u673a\u5de5\u4f5c\u7684\u539f\u7406\uff08\u4e8c\u8fdb\u5236\u7f16\u7801\u3001\u52a0\u51cf\u6cd5\u8fd0\u7b97\u3001\u8ba1\u7b97\u673a\u90e8\u4ef6\u3001\u6d6e\u70b9\u6570\u5b9a\u70b9\u6570\u3001\u5904\u7406\u5668\u7b49\uff09\uff0c\u4e5f\u5c31\u662f\u8ddf\u8ba1\u7ec4\u606f\u606f\u76f8\u5173\u7684\u77e5\u8bc6\uff0c\u5b83\u7684\u5185\u5bb9\u5f88\u6709\u8da3\u5473\u6027\uff0c\u5e76\u4e0d\u50cf\u6559\u79d1\u4e66\u90a3\u6837\u6666\u6da9\u96be\u61c2\uff0c\u4e1d\u6beb\u4e0d\u4f1a\u8ba9\u4f60\u611f\u5230\u751f\u786c\uff0c\u8bfb\u8d77\u6765\u5f88\u7545\u5feb\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_7","title":"\u6df1\u5165\u5b66\u4e60","text":"<p>\u60f3\u8981\u6df1\u5165\u5b66\u4e60\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u7684\u540c\u5b66\uff0c\u6211\u9996\u5148\u63a8\u8350\u300a\u8ba1\u7b97\u673a\u7ec4\u6210\u4e0e\u8bbe\u8ba1\uff1a\u786c\u4ef6 / \u8f6f\u4ef6\u63a5\u53e3\u300b\u8fd9\u672c\u4e66\uff0c</p> <p>\u8fd9\u672c\u4e66\u786e\u5b9e\u5f88\u539a\uff0c\u5dee\u4e0d\u591a 500 \u591a\u9875\uff0c\u4f46\u662f\u4e66\u4ece\u6765\u6ca1\u6709\u4eba\u89c4\u5b9a\u4e00\u5b9a\u8981\u4ece\u5934\u8bfb\u5230\u5c3e\uff0c\u4e00\u9875\u9875\u7684\u8bfb\u7684\u3002 \u91cd\u8981\u7684\u4e0d\u662f\u770b\u5b8c\u4e00\u672c\u4e66\uff0c\u800c\u662f\u4ece\u4e66\u4e0a\u5b66\u5230\u591a\u5c11\uff0c\u89e3\u51b3\u4e86\u4ec0\u4e48\u95ee\u9898\u3002</p> <p>\u5927\u5bb6\u53ef\u4ee5\u6311\u8fd9\u51e0\u4e2a\u7ae0\u8282\u770b\uff0c\u8ddf\u5f00\u53d1\u8005\u5173\u7cfb\u6bd4\u8f83\u5927\u7684\u7ae0\u8282\uff1a</p> <ul> <li>\u7b2c\u4e00\u7ae0\uff1a\u8ba1\u7b97\u673a\u62bd\u8c61\u4ee5\u53ca\u76f8\u5173\u6280\u672f\uff0c\u8fd9\u4e2a\u7ae0\u8282\u4e3b\u8981\u662f\u4ecb\u7ecd\u4e86\u8ba1\u7b97\u673a\u7ec4\u6210\u7684\u601d\u60f3\uff0c\u53ef\u4ee5\u7b80\u5355\u5feb\u8bfb\u770b\uff0c\u4e0d\u7528\u91cd\u70b9\u8bfb\uff1b</li> <li>\u7b2c\u4e8c\u7ae0\uff1a\u6307\u4ee4\uff0c\u5927\u4f53\u4e0a\u8bb2\u7684\u662f\u8ba1\u7b97\u673a\u662f\u5982\u679c\u8bc6\u522b\u548c\u8fd0\u884c\u6307\u4ee4\u7684\uff0c\u4ee5\u53ca\u4ee3\u7801\u5230\u6307\u4ee4\u7684\u8fc7\u7a0b\uff1b</li> <li>\u7b2c\u4e09\u7ae0\uff1a\u8ba1\u7b97\u673a\u7684\u7b97\u6570\u8fd0\u7b97\uff0c\u4ecb\u7ecd\u7684\u662f\u8ba1\u7b97\u673a\u662f\u5982\u4f55\u8fdb\u884c\u52a0\u51cf\u4e58\u9664\u6cd5\u7684\uff0c\u4ee5\u53ca\u6d6e\u70b9\u6570\u7684\u8fd0\u7b97\uff1b</li> <li>\u7b2c\u4e94\u7ae0\uff1a\u5c42\u6b21\u5316\u5b58\u50a8\uff0c\u8bb2\u7684\u662f\u8ba1\u7b97\u673a\u7684\u5b58\u50a8\u5c42\u6b21\u7ed3\u6784\uff0c\u800c\u4e14\u91cd\u70b9\u8bb2\u7684\u662f CPU Cahe\u3002</li> </ul> <p>\u770b\u4e66\u89c9\u5f97\u5f88\u7d2f\uff0c\u4e5f\u53ef\u4ee5\u7ed3\u5408\u89c6\u9891\u4e00\u8d77\u770b\uff0c\u8fd9\u91cc\u63a8\u8350\u54c8\u5de5\u5927\u7684\u300a\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u300b\u89c6\u9891\uff0c\u5728 b \u7ad9\u5c31\u53ef\u4ee5\u76f4\u63a5\u770b\uff0c\u5927\u5bb6\u81ea\u5df1\u53bb\u641c\u7d22\u5c31\u53ef\u4ee5\u3002</p> <p>\u770b\u4e66\u548c\u770b\u89c6\u9891\u53ef\u4ee5\u76f8\u4e92\u7ed3\u5408\u7684\uff0c\u6bd4\u5982\u4f60\u770b\u89c6\u9891\u770b\u4e86\u8ba1\u7b97\u673a\u6307\u4ee4\u7684\u5185\u5bb9\uff0c\u7136\u540e\u4f60\u53ef\u4ee5\u4e0d\u7528\u7ee7\u7eed\u5f80\u4e0b\u770b\uff0c\u53ef\u4ee5\u56de\u5230\u4e00\u672c\u4e66\u4e0a\uff0c\u770b\u4e66\u4e0a\u5bf9\u5e94\u8fd9\u4e2a\u7ae0\u8282\u7684\u5185\u5bb9\uff0c\u8fd9\u662f\u4e2a\u5f88\u597d\u7684\u5b66\u4e60\u65b9\u6cd5\uff0c\u89c6\u9891\u548c\u4e66\u7c4d\u76f8\u8f85\u76f8\u6210\u3002</p> <p>\u4f60\u8981\u662f\u89c9\u5f97\u54c8\u5de5\u5927\u7684\u8ba1\u7ec4\u8bfe\u7a0b\u592a\u96be\uff0c\u4f60\u53ef\u4ee5\u770b\u738b\u9053\u8003\u7814\u7684\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u7684\u89c6\u9891\u8bfe\u7a0b\uff0c\u540c\u6837 b \u7ad9\u5c31\u53ef\u4ee5\u770b\u3002</p> <p>\u8fd9\u4e2a\u89c6\u9891\u867d\u7136\u662f\u9488\u5bf9\u8003\u7814\u7684\uff0c\u4f46\u662f\u4e5f\u662f\u53ef\u4ee5\u4f5c\u4e3a\u5b66\u4e60\u8ba1\u7ec4\u7684\u8d44\u6599\uff0c\u8bb2\u7684\u5185\u5bb9\u4e0d\u4f1a\u592a\u6df1\uff0c\u9002\u5408\u4f60\u5feb\u901f\u5efa\u7acb\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u4f53\u7cfb\uff0c\u548c\u68b3\u7406\u8ba1\u7ec4\u77e5\u8bc6\u7684\u8109\u7edc\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u63a8\u8350\u4e00\u672c\u300a\u6df1\u5165\u7406\u89e3\u8ba1\u7b97\u7cfb\u7edf\u300b\u8fd9\u672c\u4e66\uff0c\u4eba\u79f0 CSAPP\u3002</p> <p>\u53ef\u80fd\u5927\u5bb6\u4ee5\u4e3a\u8fd9\u672c\u4e66\u662f\u8bb2\u64cd\u4f5c\u7cfb\u7edf\u7684\uff0c\u6211\u6700\u5f00\u59cb\u4e5f\u4ee5\u4e3a\u662f\u8fd9\u6837\u3002\u540e\u9762\u5f53\u6211\u5f00\u59cb\u5543\u8fd9\u672c\u4e66\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u6211\u5927\u9519\u7279\u9519\uff0c\u5b83\u8fdc\u4e0d\u6b62\u6211\u60f3\u7684\u90a3\u6837\u3002</p> <p>\u8fd9\u672c\u4e66\u662f\u4ece\u7a0b\u5e8f\u5458\u7684\u89d2\u5ea6\u5b66\u4e60\u8ba1\u7b97\u673a\u7cfb\u7edf\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff0c\u901a\u8fc7\u63cf\u8ff0\u7a0b\u5e8f\u662f\u5982\u4f55\u6620\u5c04\u5230\u8ba1\u7b97\u673a\u7cfb\u7edf\u4e0a\uff0c\u7a0b\u5e8f\u662f\u5982\u4f55\u6267\u884c\u7684\uff0c\u4ee5\u53ca\u7a0b\u5e8f\u6548\u7387\u4f4e\u4e0b\u7684\u539f\u56e0\uff0c\u8fd9\u6837\u7684\u65b9\u5f0f\u53ef\u4ee5\u8ba9\u5927\u5bb6\u80fd\u66f4\u597d\u7684\u77e5\u9053\u300c\u7a0b\u5e8f\u4e0e\u8ba1\u7b97\u673a\u7cfb\u7edf\u300d\u7684\u5173\u7cfb\u3002</p> <p>CSAPP \u6db5\u76d6\u7684\u5185\u5bb9\u975e\u5e38\u591a\uff0c\u6709\u8ba1\u7b97\u673a\u7ec4\u6210 + \u64cd\u4f5c\u7cfb\u7edf + \u6c47\u7f16 + C \u8bed\u8a00 + Linux \u7cfb\u7edf\u7f16\u7a0b\uff0c\u6d89\u730e\u7684\u9886\u57df\u6bd4\u8f83\u591a\uff0c\u662f\u4e00\u672c\u7efc\u5408\u6027\u7684\u4e66\uff0c\u66f4\u662f\u4e00\u672c\u7a0b\u5e8f\u5458\u4fee\u70bc\u5185\u529f\u7684\u6307\u5f15\u4e66\u3002</p> <p>CSAPP \u4e3b\u8981\u5305\u62ec\u4ee5\u4e0b\u5185\u5bb9\uff1a</p> <ul> <li>\u4fe1\u606f\u8868\u793a\uff08\u5982\u4f55\u4f7f\u7528\u4e8c\u8fdb\u5236\u8868\u793a\u6574\u578b\u3001\u6d6e\u70b9\u6570\u7b49\uff09\uff1b</li> <li>C \u548c\u6c47\u7f16\u8bed\u8a00\u7684\u5b66\u4e60\uff08\u901a\u8fc7\u6c47\u7f16\u8bed\u8a00\u66f4\u6df1\u5165\u5730\u7406\u89e3 C \u8bed\u8a00\u662f\u4ec0\u4e48\uff09\uff1b</li> <li>\u8ba1\u7b97\u673a\u4f53\u7cfb\u7ed3\u6784\uff08\u5b58\u50a8\u5c42\u6b21\u7ed3\u6784\u3001\u5c40\u90e8\u6027\u539f\u7406\u3001\u5904\u7406\u5668\u4f53\u7cfb\u7ed3\u6784\uff09\uff1b</li> <li>\u7f16\u8bd1\u94fe\u63a5\uff08C \u8bed\u8a00\u5982\u4f55\u4ece\u6587\u672c\u53d8\u6210\u53ef\u6267\u884c\u6587\u4ef6\u3001\u9759\u6001\u94fe\u63a5\u3001\u52a8\u6001\u94fe\u63a5\uff09\uff1b</li> <li>\u64cd\u4f5c\u7cfb\u7edf\u7684\u4f7f\u7528\uff08\u5f02\u5e38\u63a7\u5236\u6d41\u3001\u865a\u62df\u5185\u5b58\u3001\u591a\u4e2a\u7cfb\u7edf\u8c03\u7528\u4ecb\u7ecd\uff09\uff1b</li> <li>\u7f51\u7edc\u53ca\u5e76\u53d1\u7f16\u7a0b\uff08\u5e76\u53d1\u7684\u57fa\u672c\u6982\u5ff5\u3001\u7f51\u7edc\u76f8\u5173\u7684\u7cfb\u7edf\u8c03\u7528\u7684\u4ecb\u7ecd\uff09\u3002</li> </ul> <p>\u4f60\u4f1a\u53d1\u73b0\u6709\u90e8\u5206\u5185\u5bb9\u548c\u300a\u8ba1\u7b97\u673a\u7ec4\u6210\u4e0e\u8bbe\u8ba1\uff1a\u786c\u4ef6 / \u8f6f\u4ef6\u63a5\u53e3\u300b\u8fd9\u672c\u4e66\u91cd\u5408\u4e86\uff0c\u91cd\u5408\u7684\u90e8\u5206\u5c31\u662f\u91cd\u4e2d\u4e4b\u91cd\u7684\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u77e5\u8bc6\u4e86\uff0c\u800c\u4e14\u5185\u5bb9\u90fd\u662f\u5dee\u4e0d\u591a\u7684\uff0c\u4f60\u53ef\u4ee5\u770b\u5b8c\u4e00\u672c\u4e66\u7684\u5185\u5bb9\uff0c\u7136\u540e\u8df3\u5230\u53e6\u5916\u4e00\u672c\u770b\u76f8\u540c\u7ae0\u8282\u7684\u5185\u5bb9\uff0c\u591a\u672c\u4e66\u7684\u7ed3\u5408\u53ef\u4ee5\u8ba9\u6211\u4eec\u66f4\u52a0\u5bb9\u6613\u7406\u89e3\u3002</p> <p>\u8fd9\u4e24\u672c\u4e66\u6709\u4e2a\u533a\u522b\uff1a</p> <ul> <li>\u300a\u8ba1\u7b97\u673a\u7ec4\u6210\u4e0e\u8bbe\u8ba1\uff1a\u786c\u4ef6 / \u8f6f\u4ef6\u63a5\u53e3\u300b\u8bb2\u7684\u6307\u4ee4\u683c\u5f0f\u662f RISC \u7684\uff1b</li> <li>\u300a\u6df1\u5165\u7406\u89e3\u8ba1\u7b97\u7cfb\u7edf\u300b\u8bb2\u7684\u6307\u4ee4\u683c\u5f0f\u662f x86 \u7684\uff1b</li> </ul> <p>\u5176\u4ed6\u91cd\u5408\u7684\u8ba1\u7ec4\u77e5\u8bc6\u90fd\u5927\u540c\u5c0f\u5f02\u3002</p> <p>CSAPP \u7684\u89c6\u9891\u8bfe\u7a0b\u662f\u56fd\u5916\u8001\u5e08\u5f55\u5236\u7684\uff0c\u4f46\u662f\u5728 b \u7ad9\u5df2\u7ecf\u6709\u597d\u4eba\u5e2e\u6211\u4eec\u505a\u4e86\u4e2d\u6587\u5b57\u5e55\uff0c\u770b\u4e86\u8fd9\u89c6\u9891\uff0c\u76f8\u5f53\u4e8e\u5728\u56fd\u5916\u4e0a\u4e86\u4e00\u95e8\u8ba1\u7b97\u673a\u8bfe\u7684\u611f\u89c9\u3002</p> <p>B \u7ad9\u5730\u5740\uff1ahttps://www.bilibili.com/video/BV1iW411d7hd</p> <p></p> <p>\u5982\u679c\u4f60\u662f\u5728\u6821\u751f\uff0c\u6709\u4e86\u4e00\u5b9a C \u8bed\u8a00\u57fa\u7840\u540e\uff0c\u975e\u5e38\u5efa\u8bae\u4f60\u5c31\u5f00\u59cb\u770b\u8fd9\u672c\u4e66\uff0c\u6709\u7cbe\u529b\u4e5f\u53ef\u4ee5\u505a\u505a CSAPP \u7684 lab\u3002\u8d8a\u65e9\u5f00\u59cb\u770b\uff0c\u4f60\u7684\u6536\u76ca\u5c31\u8d8a\u5927\uff0c\u56e0\u4e3a\u5f53\u8ba1\u7b97\u673a\u4f53\u7cfb\u642d\u5efa\u8d77\u6765\u540e\uff0c\u4f60\u540e\u9762\u518d\u6df1\u5165\u6bcf\u4e00\u4e2a\u8bfe\u7a0b\u7684\u65f6\u5019\uff0c\u4f60\u4f1a\u53d1\u73b0\u5b66\u8d77\u6765\u4f1a\u6bd4\u8f83\u8f7b\u677e\u4e9b\u3002</p> <p>\u5bf9\u4e8e\u5df2\u7ecf\u5de5\u4f5c\u4e86\uff0c\u4f46\u662f\u8ba1\u7b97\u673a\u7cfb\u7edf\u6ca1\u6709\u4e00\u4e2a\u6e05\u6670\u8ba4\u8bc6\u7684\u8bfb\u8005\uff0c\u4e5f\u53ef\u4ee5\u4ece\u8fd9\u672c\u4e66\u5f00\u59cb\u4e00\u70b9\u4e00\u70b9\u5b66\u8d77\u6765\uff0c\u8fd9\u672c\u4e66\u662f\u5f88\u539a\uff0c\u4f46\u662f\u5e76\u4e0d\u4e00\u5b9a\u8981\u628a\u4e66\u5b8c\u5b8c\u770b\u5b8c\uff0c\u6bcf\u4e2a\u7ae0\u8282\u7684\u77e5\u8bc6\u70b9\u8fd8\u662f\u6bd4\u8f83\u72ec\u7acb\u7684\uff0c\u6709\u5173\u786c\u4ef6\u7684\u7ae0\u8282\u6211\u4eec\u53ef\u4ee5\u9009\u62e9\u8df3\u8fc7\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_8","title":"\u4e09\u3001\u64cd\u4f5c\u7cfb\u7edf","text":"<p>\u64cd\u4f5c\u7cfb\u7edf\u771f\u7684\u53ef\u4ee5\u8bf4\u662f <code>Super Man</code>\uff0c\u5b83\u4e3a\u4e86\u6211\u4eec\u505a\u4e86\u975e\u5e38\u5389\u5bb3\u7684\u4e8b\u60c5\uff0c\u4ee5\u81f3\u4e8e\u6211\u4eec\u6839\u672c\u5bdf\u89c9\u4e0d\u5230\uff0c\u53ea\u6709\u901a\u8fc7\u5b66\u4e60\u5b83\uff0c\u6211\u4eec\u624d\u80fd\u6df1\u523b\u4f53\u4f1a\u5230\u5b83\u7684\u7cbe\u5999\u4e4b\u5904\uff0c\u751a\u81f3\u4f1a\u88ab\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6\u8bbe\u8ba1\u601d\u60f3\u6240\u9707\u64bc\uff0c\u6709\u4e9b\u601d\u60f3\u5b9e\u9645\u4e0a\u4e5f\u662f\u53ef\u4ee5\u5e94\u7528\u4e8e\u6211\u4eec\u5de5\u4f5c\u5f00\u53d1\u4e2d\u3002</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u6bd4\u8f83\u91cd\u8981\u7684\u56db\u5927\u6a21\u5757\uff0c\u5206\u522b\u662f\u5185\u5b58\u7ba1\u7406\u3001\u8fdb\u7a0b\u7ba1\u7406\u3001\u6587\u4ef6\u7cfb\u7edf\u7ba1\u7406\u3001\u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7ba1\u7406\u3002\u8fd9\u662f\u6211\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\u7684\u987a\u5e8f\uff0c\u4e5f\u662f\u6211\u63a8\u8350\u7ed9\u5927\u5bb6\u7684\u5b66\u4e60\u987a\u5e8f\uff0c\u56e0\u4e3a\u5185\u5b58\u7ba1\u7406\u4e0d\u4ec5\u662f\u6700\u91cd\u8981\u3001\u6700\u96be\u7684\u6a21\u5757\uff0c\u4e5f\u662f\u548c\u5176\u4ed6\u6a21\u5757\u5173\u8054\u6027\u6700\u5927\u7684\u6a21\u5757\uff0c\u5148\u628a\u5b83\u641e\u5b9a\uff0c\u540e\u7eed\u7684\u6a21\u5757\u5b66\u8d77\u6765\u6211\u8ba4\u4e3a\u4f1a\u76f8\u5bf9\u8f7b\u677e\u4e00\u4e9b\u3002</p> <p>\u5b66\u4e60\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4f60\u53ef\u80fd\u4f1a\u9047\u5230\u5f88\u591a\u300c\u865a\u62df\u300d\u7684\u6982\u5ff5\uff0c\u6bd4\u5982\u865a\u62df\u5185\u5b58\u3001\u865a\u62df\u6587\u4ef6\u7cfb\u7edf\uff0c\u5b9e\u9645\u4e0a\u5b83\u4eec\u7684\u672c\u8d28\u4e0a\u90fd\u662f\u4e00\u6837\u7684\uff0c\u90fd\u662f\u5411\u4e0b\u5c4f\u853d\u5dee\u5f02\uff0c\u5411\u4e0a\u63d0\u4f9b\u7edf\u4e00\u7684\u4e1c\u897f\uff0c\u4ee5\u65b9\u4fbf\u6211\u4eec\u7a0b\u5e8f\u5458\u4f7f\u7528\u3002</p> <p>\u8fd8\u6709\uff0c\u4f60\u4e5f\u9047\u5230\u5404\u79cd\u5404\u6837\u7684\u8c03\u5ea6\u7b97\u6cd5\uff0c\u5728\u8fd9\u91cc\u4f60\u53ef\u4ee5\u770b\u5230\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u7684\u9b45\u529b\uff0c\u91cd\u8981\u7684\u662f\u6211\u4eec\u8981\u7406\u89e3\u4e3a\u4ec0\u4e48\u8981\u63d0\u51fa\u90a3\u4e48\u591a\u8c03\u5ea6\u7b97\u6cd5\uff0c\u4f60\u5f53\u7136\u53ef\u4ee5\u8bf4\u662f\u4e3a\u4e86\u66f4\u5feb\u66f4\u6709\u6548\u7387\uff0c\u4f46\u662f\u56e0\u4ec0\u4e48\u95ee\u9898\u800c\u56e0\u6b64\u5f15\u5165\u65b0\u7b97\u6cd5\u7684\u8fd9\u4e2a\u8fc7\u7a0b\uff0c\u66f4\u662f\u6211\u4eec\u91cd\u70b9\u5b66\u4e60\u7684\u5730\u65b9\u3002</p> <p>\u4f60\u4e5f\u4f1a\u5f00\u59cb\u660e\u767d\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b\u6700\u5927\u7684\u533a\u522b\u5728\u4e8e\u4e0a\u4e0b\u6587\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u7ebf\u7a0b\u4e0d\u7528\u5207\u6362\u865a\u62df\u5185\u5b58\uff0c\u56e0\u4e3a\u540c\u4e00\u4e2a\u8fdb\u7a0b\u5185\u7684\u7ebf\u7a0b\u90fd\u662f\u5171\u4eab\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u7684\uff0c\u7ebf\u7a0b\u5c31\u5355\u8fd9\u4e00\u70b9\u4e0d\u7528\u5207\u6362\uff0c\u5c31\u76f8\u6bd4\u8fdb\u7a0b\u4e0a\u4e0b\u6587\u5207\u6362\u7684\u6027\u80fd\u5f00\u9500\u51cf\u5c11\u4e86\u5f88\u591a\u3002\u7531\u4e8e\u865a\u62df\u5185\u5b58\u4e0e\u7269\u7406\u5185\u5b58\u7684\u6620\u5c04\u5173\u7cfb\u9700\u8981\u67e5\u8be2\u9875\u8868\uff0c\u9875\u8868\u7684\u67e5\u8be2\u662f\u5f88\u6162\u7684\u8fc7\u7a0b\uff0c\u56e0\u6b64\u4f1a\u628a\u5e38\u7528\u7684\u5730\u5740\u6620\u5c04\u5173\u7cfb\u7f13\u5b58\u5728 TLB \u91cc\u7684\uff0c\u8fd9\u6837\u4fbf\u53ef\u4ee5\u63d0\u9ad8\u9875\u8868\u7684\u67e5\u8be2\u901f\u5ea6\uff0c\u5982\u679c\u53d1\u751f\u4e86\u8fdb\u7a0b\u5207\u6362\uff0c\u90a3 TLB \u7f13\u5b58\u7684\u5730\u5740\u6620\u5c04\u5173\u7cfb\u5c31\u4f1a\u5931\u6548\uff0c\u7f13\u5b58\u5931\u6548\u5c31\u610f\u5473\u7740\u547d\u4e2d\u7387\u964d\u4f4e\uff0c\u4e8e\u662f\u865a\u62df\u5730\u5740\u8f6c\u4e3a\u7269\u7406\u5730\u5740\u8fd9\u4e00\u8fc7\u7a0b\u5c31\u4f1a\u5f88\u6162\u3002</p> <p>\u4f60\u4e5f\u5f00\u59cb\u4e0d\u4f1a\u50bb\u50bb\u7684\u8ba4\u4e3a read \u6216 write \u4e4b\u540e\u6570\u636e\u5c31\u76f4\u63a5\u5199\u5230\u786c\u76d8\u4e86\uff0c\u66f4\u4e0d\u4f1a\u89c9\u5f97\u591a\u6b21\u64cd\u4f5c read \u6216 write \u65b9\u6cd5\u6027\u80fd\u4f1a\u5f88\u4f4e\uff0c\u56e0\u4e3a\u4f60\u53d1\u73b0\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u6709\u4e2a\u300c\u78c1\u76d8\u9ad8\u901f\u7f13\u51b2\u533a\u300d\uff0c\u5b83\u5df2\u7ecf\u5e2e\u6211\u4eec\u505a\u4e86\u7f13\u5b58\u7684\u5de5\u4f5c\uff0c\u5b83\u4f1a\u9884\u8bfb\u6570\u636e\u3001\u7f13\u5b58\u6700\u8fd1\u8bbf\u95ee\u7684\u6570\u636e\uff0c\u4ee5\u53ca\u4f7f\u7528 I/O \u8c03\u5ea6\u7b97\u6cd5\u6765\u5408\u5e76\u548c\u6392\u961f\u78c1\u76d8\u8c03\u5ea6 I/O\uff0c\u8fd9\u4e9b\u90fd\u662f\u4e3a\u4e86\u51cf\u5c11\u64cd\u4f5c\u7cfb\u7edf\u5bf9\u78c1\u76d8\u7684\u8bbf\u95ee\u9891\u7387\u3002</p> <p>\u2026\u2026</p> <p>\u8fd8\u6709\u592a\u591a\u592a\u591a\u4e86\uff0c\u6211\u5728\u8fd9\u91cc\u5c31\u4e0d\u8d58\u8ff0\u4e86\uff0c\u5269\u4e0b\u7684\u5c31\u4ea4\u7ed9\u4f60\u4eec\u5728\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\u7684\u9014\u4e2d\u53bb\u63a2\u7d22\u548c\u53d1\u73b0\u4e86\u3002</p> <p>\u8fd8\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\uff0c\u5b66\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u5019\uff0c\u4e0d\u8981\u8bef\u4ee5\u4e3a\u5b83\u662f\u5728\u8bf4 Linux \u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd9\u4e5f\u662f\u6211\u521d\u5b66\u7684\u65f6\u5019\u72af\u7684\u4e00\u4e2a\u9519\u8bef\uff0c\u64cd\u4f5c\u7cfb\u7edf\u662f\u96c6\u5408\u5927\u591a\u6570\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\u7684\u601d\u60f3\uff0c\u8ddf\u5b9e\u9645\u5177\u4f53\u5b9e\u73b0\u7684 Linux \u64cd\u4f5c\u7cfb\u7edf\u591a\u5c11\u90fd\u4f1a\u6709\u70b9\u5dee\u522b\uff0c\u5982\u679c\u8981\u60f3 Linux \u64cd\u4f5c\u7cfb\u7edf\u7684\u5177\u4f53\u5b9e\u73b0\u65b9\u5f0f\uff0c\u53ef\u4ee5\u9009\u62e9\u770b Linux \u5185\u6838\u76f8\u5173\u7684\u8d44\u6599\uff0c\u4f46\u662f\u5728\u8fd9\u4e4b\u524d\u4f60\u5148\u638c\u63e1\u4e86\u64cd\u4f5c\u7cfb\u7edf\u7684\u57fa\u672c\u77e5\u8bc6\uff0c\u8fd9\u6837\u5b66\u8d77\u6765\u624d\u80fd\u4e8b\u534a\u529f\u500d\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_9","title":"\u5165\u95e8\u7cfb\u5217","text":"<p>\u5bf9\u4e8e\u6ca1\u5b66\u8fc7\u64cd\u4f5c\u7cfb\u7edf\u7684\u5c0f\u767d\uff0c\u6211\u5efa\u8bae\u5b66\u7684\u65f6\u5019\uff0c\u4e0d\u8981\u76f4\u63a5\u95f7\u5934\u770b\u4e66\u3002</p> <p>\u76f8\u4fe1\u6211\uff0c\u4f60\u4e0d\u7528\u51e0\u5206\u949f\u5c31\u4f1a\u6253\u9000\u5802\u9f13\uff0c\u7136\u540e\u5c31\u628a\u539a\u539a\u7684\u4e66\u62ff\u53bb\u57ab\u663e\u793a\u5668\u4e86\uff0c\u4ece\u6b64\u518d\u65e0\u540e\u7eed\uff0c\u6bd5\u7adf\u76f4\u63a5\u770b\u4e66\u592a\u7279\u55b5\u7684\u67af\u71e5\u4e86\uff0c\u5f53\u7136\u4e0d\u5982\u7528\u6765\u57ab\u663e\u793a\u5668\u73a9\u6e38\u620f\u6765\u7740\u9999\u3002</p> <p>B \u7ad9\u5173\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u7a0b\u8d44\u6e90\u5f88\u591a\uff0c\u6211\u5728\u91cc\u9762\u4e5f\u770b\u4e86\u4e0d\u540c\u8001\u5e08\u8bb2\u7684\u8bfe\u7a0b\uff0c\u89c9\u5f97\u6bd4\u8f83\u597d\u7684\u5165\u95e8\u7ea7\u8bfe\u7a0b\u662f\u300a\u64cd\u4f5c\u7cfb\u7edf - \u6e05\u534e\u5927\u5b66\u300b\uff0c\u8be5\u8bfe\u7a0b\u7531\u6e05\u534e\u5927\u5b66\u8001\u5e08\u5411\u52c7\u548c\u9648\u6e1d\u6388\u8bfe\uff0c\u867d\u7136\u6211\u4eec\u4e0a\u4e0d\u4e86\u6e05\u534e\u5927\u5b66\uff0c\u4f46\u662f\u81f3\u5c11\u6211\u4eec\u53ef\u4ee5\u5728\u7f51\u4e0a\u9009\u62e9\u542c\u6e05\u534e\u5927\u5b66\u7684\u8bfe\u561b\u3002\u8bfe\u7a0b\u6388\u8bfe\u7684\u987a\u5e8f\uff0c\u5c31\u5982\u6211\u524d\u9762\u63a8\u8350\u7684\u5b66\u4e60\u987a\u5e8f\uff1a\u300c\u5185\u5b58\u7ba1\u7406 -&gt; \u8fdb\u7a0b\u7ba1\u7406 -&gt; \u6587\u4ef6\u7cfb\u7edf\u7ba1\u7406 -&gt; \u8f93\u5165\u8f93\u51fa\u8bbe\u5907\u7ba1\u7406\u300d\u3002</p> <p></p> <p>\u300a\u64cd\u4f5c\u7cfb\u7edf - \u6e05\u534e\u5927\u5b66\u300b</p> <p>\u8be5\u6e05\u534e\u5927\u5b66\u7684\u89c6\u9891\u6559\u5b66\u642d\u914d\u7684\u4e66\u5e94\u8be5\u662f\u300a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u300b\uff0c\u4f60\u53ef\u4ee5\u89c6\u9891\u548c\u4e66\u7c4d\u4e24\u8005\u7ed3\u5408\u4e00\u8d77\u5b66\uff0c\u6bd4\u5982\u770b\u5b8c\u89c6\u9891\u7684\u5185\u5b58\u7ba1\u7406\uff0c\u7136\u540e\u5c31\u770b\u4e66\u4e0a\u5bf9\u5e94\u7684\u7ae0\u8282\uff0c\u8fd9\u6837\u76f8\u6bd4\u76f4\u63a5\u5543\u4e66\u76f8\u5bf9\u4f1a\u6bd4\u8f83\u597d\u3002</p> <p>\u6e05\u534e\u5927\u5b66\u7684\u64cd\u4f5c\u7cfb\u7edf\u89c6\u9891\u8bfe\u8bb2\u7684\u6bd4\u8f83\u7cbe\u70bc\uff0c\u6d89\u53ca\u5230\u7684\u5185\u5bb9\u6ca1\u6709\u90a3\u4e48\u7ec6\uff0c\u300a\u64cd\u4f5c\u7cfb\u7edf - \u54c8\u5de5\u5927\u300b\u674e\u6cbb\u519b\u8001\u5e08\u6388\u8bfe\u7684\u89c6\u9891\u8bfe\u7a0b\u76f8\u5bf9\u5c31\u4f1a\u6bd4\u8f83\u7ec6\u8282\uff0c\u8001\u5e08\u4f1a\u7528 Linux \u5185\u6838\u4ee3\u7801\u7684\u89d2\u5ea6\u5e26\u4f60\u8fdb\u4e00\u6b65\u7406\u89e3\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e5f\u4f1a\u7528\u751f\u6d3b\u5c0f\u4f8b\u5b50\u5e2e\u52a9\u4f60\u7406\u89e3\u3002</p> <p></p> <p>\u300a\u64cd\u4f5c\u7cfb\u7edf - \u54c8\u5de5\u5927\u300b</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_10","title":"\u6df1\u5165\u7cfb\u5217","text":"<p>\u300a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u300b\u8fd9\u672c\u4e66\u6211\u611f\u89c9\u7f3a\u5c11\u6bd4\u8f83\u591a\u7ec6\u8282\uff0c\u8bf4\u7684\u8fd8\u662f\u6bd4\u8f83\u7b3c\u7edf\uff0c\u800c\u4e14\u4e66\u4e5f\u597d\u65e0\u804a\u3002</p> <p>\u63a8\u8350\u4e00\u4e2a\u8bf4\u7684\u66f4\u7ec6\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e66 \u2014\u2014 \u300a\u64cd\u4f5c\u7cfb\u7edf\u5bfc\u8bba\u300b\uff0c\u8fd9\u672c\u4e66\u4e0d\u4ec5\u544a\u8bc9\u4f60 What\uff0c\u8fd8\u4f1a\u544a\u8bc9\u4f60 How\uff0c\u4e66\u7684\u5185\u5bb9\u90fd\u662f\u5faa\u5e8f\u6e10\u8fdb\uff0c\u5c42\u5c42\u9012\u8fdb\u7684\uff0c\u9605\u8bfb\u8d77\u6765\u8fd8\u662f\u89c9\u5f97\u633a\u6709\u610f\u601d\u7684\uff0c\u8fd9\u672c\u4e66\u7684\u5185\u5b58\u7ba1\u7406\u548c\u5e76\u53d1\u8fd9\u4e24\u4e2a\u90e8\u5206\u8bf4\u7684\u5f88\u68d2\u3002</p> <p>\u53bb\u5e74\u56fd\u5185\u4e5f\u51fa\u4e86\u4e00\u672c\u4e0d\u9519\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e66\u300a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf - \u539f\u7406\u4e0e\u5b9e\u73b0\u300b\uff0c\u8fd9\u672c\u4e66\u4e0d\u600e\u4e48\u539a\uff0c\u628a\u64cd\u4f5c\u7cfb\u7edf\u91cd\u8981\u7684\u77e5\u8bc6\u90fd\u8bb2\u4e86\u4e00\u904d\uff0c\u662f\u6211\u770b\u8fc7\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e66\u91cc\u914d\u56fe\u6bd4\u8f83\u591a\u7684\u4e66\u4e86\uff0c\u5b66\u8d77\u6765\u4e0d\u4f1a\u592a\u8d39\u89e3\u3002</p> <p>\u5f53\u7136\uff0c\u5c11\u4e0d\u4e86\u8fd9\u672c\u88ab\u79f0\u4e3a\u795e\u4e66\u7684\u300a\u6df1\u5165\u7406\u89e3\u8ba1\u7b97\u673a\u7cfb\u7edf\u300b\uff0c\u8c46\u74e3\u8bc4\u5206\u9ad8\u8fbe <code>9.8</code> \u5206\uff0c\u8fd9\u672c\u4e66\u4e25\u683c\u6765\u8bf4\u4e0d\u7b97\u64cd\u4f5c\u7cfb\u7edf\u4e66\uff0c\u5b83\u662f\u4ee5\u7a0b\u5e8f\u5458\u89c6\u89d2\u7406\u89e3\u8ba1\u7b97\u673a\u7cfb\u7edf\uff0c\u4e0d\u53ea\u662f\u6d89\u53ca\u5230\u64cd\u4f5c\u7cfb\u7edf\uff0c\u8fd8\u6d89\u53ca\u5230\u4e86\u8ba1\u7b97\u673a\u7ec4\u6210\u3001C \u8bed\u8a00\u3001\u6c47\u7f16\u8bed\u8a00\u7b49\u77e5\u8bc6\uff0c\u662f\u4e00\u672c\u7efc\u5408\u6027\u6bd4\u8f83\u5f3a\u7684\u4e66\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_11","title":"\u56db\u3001\u8ba1\u7b97\u673a\u7f51\u7edc","text":"<p>\u8ba1\u7b97\u673a\u7f51\u7edc\u76f8\u6bd4\u64cd\u4f5c\u7cfb\u7edf\u597d\u5b66\u975e\u5e38\u591a\uff0c\u56e0\u4e3a\u8ba1\u7b97\u673a\u7f51\u7edc\u4e0d\u62bd\u8c61\uff0c\u4f60\u8981\u60f3\u77e5\u9053\u7f51\u7edc\u4e2d\u7684\u7ec6\u8282\uff0c\u4f60\u90fd\u53ef\u4ee5\u901a\u8fc7\u6293\u5305\u6765\u5206\u6790\uff0c\u800c\u4e14\u4e0d\u7ba1\u662f\u624b\u673a\u3001\u4e2a\u4eba\u7535\u8111\u548c\u670d\u52a1\u5668\uff0c\u5b83\u4eec\u6240\u4f7f\u7528\u7684\u8ba1\u7b97\u7f51\u7edc\u534f\u8bae\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8ba1\u7b97\u673a\u7f51\u7edc\u4e0d\u4f1a\u56e0\u4e3a\u8bbe\u5907\u7684\u4e0d\u540c\u800c\u4e0d\u540c\uff0c\u5927\u5bb6\u90fd\u9075\u5faa\u8fd9\u4e00\u5957\u300c\u89c4\u5219\u300d\u6765\u76f8\u4e92\u901a\u4fe1\uff0c\u8fd9\u5957\u89c4\u5219\u5c31\u662f TCP/IP \u7f51\u7edc\u6a21\u578b\u3002</p> <p></p> <p>OSI \u53c2\u8003\u6a21\u578b\u4e0e TCP/IP \u7684\u5173\u7cfb</p> <p>TCP/IP \u7f51\u7edc\u53c2\u8003\u6a21\u578b\u5171\u6709 <code>4</code> \u5c42\uff0c\u5176\u4e2d\u9700\u8981\u6211\u4eec\u719f\u7ec3\u638c\u63e1\u7684\u662f\u5e94\u7528\u5c42\u3001\u4f20\u8f93\u5c42\u548c\u7f51\u7edc\u5c42\uff0c\u81f3\u4e8e\u7f51\u7edc\u63a5\u53e3\u5c42\uff08\u6570\u636e\u94fe\u8def\u5c42\u548c\u7269\u7406\u5c42\uff09\u6211\u4eec\u53ea\u9700\u8981\u505a\u7b80\u5355\u7684\u4e86\u89e3\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u5bf9\u4e8e\u5e94\u7528\u5c42\uff0c\u5f53\u7136\u91cd\u70b9\u8981\u719f\u6089\u6700\u5e38\u89c1\u7684 HTTP \u548c HTTPS\uff0c\u4f20\u8f93\u5c42 TCP \u548c UDP \u90fd\u8981\u719f\u6089\uff0c\u7f51\u7edc\u5c42\u8981\u719f\u6089 IPv4\uff0cIPv6 \u53ef\u4ee5\u505a\u7b80\u5355\u70b9\u4e86\u89e3\u3002</p> <p>\u6211\u89c9\u5f97\u5b66\u4e60\u4e00\u4e2a\u4e1c\u897f\uff0c\u5c31\u4ece\u6211\u4eec\u5e38\u89c1\u7684\u4e8b\u60c5\u5f00\u59cb\u7740\u624b\u3002</p> <p>\u6bd4\u5982\uff0cping \u547d\u4ee4\u53ef\u4ee5\u8bf4\u5728\u6211\u4eec\u5224\u65ad\u7f51\u7edc\u73af\u5883\u7684\u65f6\u5019\uff0c\u6700\u5e38\u4f7f\u7528\u7684\u4e86\uff0c\u4f60\u53ef\u4ee5\u5148\u628a\u4f60\u7535\u8111 ping \u4f60\u820d\u53cb\u6216\u540c\u4e8b\u7684\u7535\u8111\u7684\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u4e8b\u60c5\u90fd\u641e\u660e\u767d\uff0c\u8fd9\u6837\u5c31\u57fa\u672c\u77e5\u9053\u4e00\u4e2a\u6570\u636e\u5305\u662f\u600e\u4e48\u8f6c\u53d1\u7684\u4e86\uff0c\u4e8e\u662f\u4f60\u5c31\u77e5\u9053\u4e86\u7f51\u7edc\u5c42\u3001\u6570\u636e\u94fe\u8def\u5c42\u548c\u7269\u7406\u5c42\u4e4b\u95f4\u662f\u5982\u4f55\u5de5\u4f5c\uff0c\u5982\u4f55\u76f8\u4e92\u914d\u5408\u7684\u4e86\u3002</p> <p>\u641e\u660e\u767d\u4e86 ping \u8fc7\u7a0b\uff0c\u5c31\u660e\u767d\u4e86\u4e24\u4e2a\u8ba1\u7b97\u673a\u662f\u600e\u4e48\u901a\u4fe1\u7684\u4e86\uff0c\u7136\u540e\u4f60\u5b66\u8d77 HTTP \u8bf7\u6c42\u8fc7\u7a0b\u7684\u65f6\u5019\uff0c\u4f1a\u5f88\u5feb\u5c31\u80fd\u638c\u63e1\u4e86\uff0c\u56e0\u4e3a\u7f51\u7edc\u5c42\u4ee5\u4e0b\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u4f60\u5728\u5b66\u4e60 ping \u7684\u65f6\u5019\u5c31\u5df2\u7ecf\u660e\u767d\u4e86\uff0c\u8fd9\u65f6\u5c31\u53ea\u9700\u8981\u8ba4\u771f\u638c\u63e1\u4f20\u8f93\u5c42\u4e2d\u7684 TCP \u548c\u5e94\u7528\u5c42\u4e2d\u7684 HTTP \u534f\u8bae\uff0c\u5c31\u80fd\u641e\u660e\u767d\u8bbf\u95ee\u7f51\u9875\u7684\u6574\u4e2a\u8fc7\u7a0b\u4e86\uff0c\u8fd9\u4e5f\u662f\u9762\u8bd5\u5e38\u89c1\u7684\u9898\u76ee\u4e86\uff0c\u6bd5\u7adf\u5b83\u80fd\u8003\u5bdf\u4f60\u7f51\u7edc\u77e5\u8bc6\u7684\u5168\u9762\u6027\u3002</p> <p>\u91cd\u4e2d\u4e4b\u91cd\u7684\u77e5\u8bc6\u5c31\u662f TCP \u4e86\uff0cTCP \u4e0d\u7ba1\u662f\u5efa\u7acb\u8fde\u63a5\u3001\u65ad\u5f00\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u8fd8\u662f\u6570\u636e\u4f20\u8f93\u7684\u8fc7\u7a0b\uff0c\u90fd\u4e0d\u80fd\u653e\u8fc7\uff0c\u9488\u5bf9\u6570\u636e\u53ef\u9760\u4f20\u8f93\u7684\u7279\u6027\uff0c\u53c8\u53ef\u4ee5\u62c6\u89e3\u4e3a\u8d85\u65f6\u91cd\u65b0\u3001\u6d41\u91cf\u63a7\u5236\u3001\u6ed1\u52a8\u7a97\u53e3\u3001\u62e5\u585e\u63a7\u5236\u7b49\u7b49\u77e5\u8bc6\u70b9\uff0c\u5b66\u5b8c\u8fd9\u4e9b\u53ea\u80fd\u7b97\u5bf9 TCP \u6709\u4e2a\u300c\u611f\u6027\u300d\u7684\u8ba4\u8bc6\uff0c\u53e6\u5916\u6211\u4eec\u8fd8\u5f97\u77e5\u9053 Linux \u63d0\u4f9b\u7684 TCP \u5185\u6838\u7684\u53c2\u6570\u7684\u4f5c\u7528\uff0c\u8fd9\u6837\u624d\u80fd\u4ece\u5bb9\u5730\u5e94\u5bf9\u5de5\u4f5c\u4e2d\u9047\u5230\u7684\u95ee\u9898\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u63a8\u8350\u6211\u770b\u8fc7\u5e76\u89c9\u5f97\u4e0d\u9519\u7684\u8ba1\u7b97\u673a\u7f51\u7edc\u76f8\u5173\u7684\u4e66\u7c4d\u548c\u89c6\u9891\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_12","title":"\u5165\u95e8\u7cfb\u5217","text":"<p>\u6b64\u7cfb\u5217\u9488\u5bf9\u6ca1\u6709\u4efb\u4f55\u8ba1\u7b97\u673a\u57fa\u7840\u7684\u670b\u53cb\uff0c\u5982\u679c\u5df2\u7ecf\u5bf9\u8ba1\u7b97\u673a\u8f7b\u8f66\u719f\u8def\u7684\u5927\u4f6c\uff0c\u4e5f\u4e0d\u8981\u5ffd\u7565\uff0c\u4e0d\u59a8\u770b\u770b\u6211\u63a8\u8350\u7684\u6b63\u786e\u5417\u3002</p> <p>\u5982\u679c\u4f60\u8981\u5165\u95e8 HTTP\uff0c\u9996\u5148\u6700\u597d\u4e66\u7c4d\u5c31\u662f\u300a\u56fe\u89e3 HTTP\u300b\u4e86\uff0c\u4f5c\u8005\u771f\u7684\u505a\u5230\u5b8c\u5b8c\u5168\u5168\u7684\u300c\u56fe\u89e3\u300d\uff0c\u5c0f\u6797\u7684\u56fe\u89e3\u529f\u592b\u8fd8\u662f\u4ece\u8fd9\u91cc\u5077\u5b66\u5230\u4e0d\u5c11\uff0c\u4e66\u7c4d\u4e0d\u539a\uff0c\u76f8\u4fe1\u4f18\u79c0\u7684\u4f60\uff0c\u51e0\u5929\u5c31\u53ef\u4ee5\u770b\u5b8c\u4e86\u3002</p> <p>\u5982\u679c\u8981\u5165\u95e8 TCP/IP \u7f51\u7edc\u6a21\u578b\uff0c\u6211\u63a8\u8350\u7684\u662f\u300a\u56fe\u89e3 TCP/IP\u300b\uff0c\u8fd9\u672c\u4e66\u4e5f\u662f\u4ee5\u5927\u91cf\u7684\u56fe\u6587\u6765\u4ecb\u7ecd\u4e86 TCP/IP \u7f51\u7edc\u6a21\u5f0f\u7684\u6bcf\u4e00\u5c42\uff0c\u4f46\u662f\u8fd9\u4e2a\u4e66\u7c4d\u7684\u987a\u5e8f\u4e0d\u662f\u4ece\u300c\u5e94\u7528\u5c42 \u2014&gt; \u7269\u7406\u5c42\u300d\uff0c\u800c\u662f\u4ece\u300c\u7269\u7406\u5c42 -&gt; \u5e94\u7528\u5c42\u300d\u987a\u5e8f\u5f00\u59cb\u8bb2\u7684\uff0c\u8fd9\u4e00\u70b9\u6211\u89c9\u5f97\u4e0d\u592a\u597d\uff0c\u8fd9\u6837\u4e00\u4e0a\u6765\u5c31\u628a\u6700\u67af\u71e5\u7684\u90e8\u5206\u8bb2\u4e86\uff0c\u5f88\u5bb9\u6613\u5c31\u88ab\u529d\u9000\u4e86\uff0c\u6240\u4ee5\u6211\u5efa\u8bae\u5148\u8df3\u8fc7\u524d\u9762\u51e0\u4e2a\u7ae0\u8282\uff0c\u5148\u770b\u7f51\u7edc\u5c42\u548c\u4f20\u8f93\u5c42\u7684\u7ae0\u8282\uff0c\u7136\u540e\u518d\u56de\u5934\u770b\u524d\u9762\u7684\u8fd9\u51e0\u4e2a\u7ae0\u8282\u3002</p> <p>\u53e6\u5916\uff0c\u4f60\u60f3\u4e86\u89e3\u7f51\u7edc\u662f\u600e\u4e48\u4f20\u8f93\uff0c\u90a3\u6211\u63a8\u8350\u300a\u7f51\u7edc\u662f\u600e\u6837\u8fde\u63a5\u7684\u300b\uff0c\u8fd9\u672c\u4e66\u76f8\u5bf9\u6bd4\u8f83\u5168\u9762\u7684\u628a\u8bbf\u95ee\u4e00\u4e2a\u7f51\u9875\u7684\u53d1\u751f\u7684\u8fc7\u7a0b\u8bb2\u89e3\u4e86\u4e00\u904d\uff0c\u5176\u4e2d\u5173\u4e8e\u7535\u4fe1\u7b49\u8fd0\u8425\u5546\u662f\u600e\u4e48\u4f20\u8f93\u7684\uff0c\u8fd9\u90e8\u5206\u4f60\u53ef\u4ee5\u8df3\u8fc7\uff0c\u5f53\u7136\u4f60\u611f\u5174\u8da3\u4e5f\u53ef\u4ee5\u770b\uff0c\u53ea\u662f\u6211\u89c9\u5f97\u6ca1\u5fc5\u8981\u770b\u3002</p> <p>\u5982\u679c\u4f60\u89c9\u5f97\u4e66\u7c4d\u8fc7\u4e8e\u67af\u71e5\uff0c\u4f60\u53ef\u4ee5\u7ed3\u5408 B \u7ad9\u300a\u8ba1\u7b97\u673a\u7f51\u7edc\u5fae\u8bfe\u5802\u300b\u89c6\u9891\u4e00\u8d77\u5b66\u4e60\uff0c\u8fd9\u4e2a\u89c6\u9891\u662f\u6e56\u5357\u79d1\u6280\u5927\u5b66\u8001\u5e08\u5236\u4f5c\u7684\uff0cPPT \u7684\u52a8\u56fe\u662f\u6211\u89c1\u8fc7\u505a\u7684\u6700\u7528\u5fc3\u7684\u4e86\uff0c\u4e00\u770b\u5c31\u61c2\u7684\u4f73\u4f5c\u3002</p> <p></p> <p>\u300a\u8ba1\u7b97\u673a\u7f51\u7edc\u5fae\u8bfe\u5802\u300b</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_13","title":"\u6df1\u5165\u5b66\u4e60","text":"<p>\u770b\u5b8c\u5165\u95e8\u7cfb\u5217\uff0c\u76f8\u4fe1\u4f60\u5bf9\u8ba1\u7b97\u673a\u7f51\u7edc\u5df2\u7ecf\u6709\u4e2a\u5927\u4f53\u7684\u8ba4\u8bc6\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4e5f\u4e0d\u80fd\u653e\u6162\u811a\u6b65\uff0c\u5feb\u9a6c\u52a0\u97ad\uff0c\u501f\u6b64\u673a\u4f1a\u7ee7\u7eed\u6df1\u5165\u5b66\u4e60\uff0c\u56e0\u4e3a\u9690\u85cf\u5728\u80cc\u540e\u7684\u7ec6\u8282\u8fd8\u662f\u5f88\u591a\u7684\u3002</p> <p>\u5bf9\u4e8e TCP/IP \u7f51\u7edc\u6a21\u578b\u6df1\u5165\u5b66\u4e60\u7684\u8bdd\uff0c\u63a8\u8350\u300a\u8ba1\u7b97\u673a\u7f51\u7edc - \u81ea\u9876\u5411\u4e0b\u65b9\u6cd5\u300b\uff0c\u8fd9\u672c\u4e66\u662f\u4ece\u6211\u4eec\u6700\u719f\u6089 HTTP \u5f00\u59cb\u8bf4\u8d77\uff0c\u4e00\u5c42\u4e00\u5c42\u7684\u8bf4\u5230\u6700\u540e\u7269\u7406\u5c42\u7684\uff0c\u6709\u79cd\u6316\u5730\u6d1e\u7684\u611f\u89c9\uff0c\u8fd9\u6837\u7684\u5185\u5bb9\u7f16\u6392\u987a\u5e8f\u76f8\u5bf9\u662f\u6bd4\u8f83\u5408\u7406\u7684\u3002</p> <p>\u4f46\u5982\u679c\u8981\u6df1\u5165 TCP\uff0c\u524d\u9762\u7684\u8fd9\u4e9b\u4e66\u8fd8\u8fdc\u8fdc\u4e0d\u591f\uff0c\u8d4b\u6709\u8ba1\u7b97\u673a\u7f51\u7edc\u5723\u7ecf\u7684\u4e4b\u8bf4\u7684\u300aTCP/IP \u8be6\u89e3 \u5377\u4e00\uff1a\u534f\u8bae\u300b\u8fd9\u672c\u4e66\uff0c\u662f\u8fdb\u4e00\u6b65\u6df1\u5165\u5b66\u4e60\u7684\u597d\u8d44\u6599\uff0c\u8fd9\u672c\u4e66\u7684\u4f5c\u8005\u7528\u5404\u79cd\u5b9e\u9a8c\u7684\u65b9\u5f0f\u6765\u7ec6\u8bf4\u5404\u79cd\u534f\u8bae\uff0c\u4f46\u4e0d\u5f97\u4e0d\u8bf4\uff0c\u8fd9\u672c\u4e66\u771f\u7684\u5f88\u67af\u71e5\uff0c\u5f53\u65f6\u6211\u4e5f\u5543\u7684\u5f88\u96be\u53d7\uff0c\u4f46\u662f\u5b83\u8d28\u91cf\u662f\u771f\u7684\u5f88\u9ad8\uff0c\u8fd9\u672c\u4e66\u6211\u53ea\u770b\u4e86 TCP \u90e8\u5206\uff0c\u5176\u4ed6\u90e8\u5206\u4f60\u53ef\u4ee5\u9009\u62e9\u6027\u770b\uff0c\u4f46\u662f\u4f60\u4e00\u5b9a\u8981\u8fc7\u51e0\u904d\u8fd9\u672c\u4e66\u7684 TCP \u90e8\u5206\uff0c\u6db5\u76d6\u7684\u5185\u5bb9\u975e\u5e38\u5168\u4e14\u7ec6\u3002</p> <p>\u8981\u8bf4\u6211\u770b\u8fc7\u6700\u597d\u7684 TCP \u8d44\u6599\uff0c\u90a3\u5fc5\u5b9a\u662f\u300aThe TCP/IP GUIDE\u300b\u8fd9\u672c\u4e66\u4e86\uff0c\u76ee\u524d\u53ea\u6709\u82f1\u6587\u7248\u672c\u7684\uff0c\u800c\u4e14\u6709\u4e2a\u4e13\u95e8\u7684\u7f51\u5740\u53ef\u4ee5\u767d\u5ad6\u770b\u8fd9\u672c\u4e66\u7684\u5185\u5bb9\uff0c\u56fe\u7247\u90fd\u662f\u5f69\u8272\uff0c\u770b\u8d77\u6765\u5f88\u8212\u670d\u5f88\u9c9c\u660e\uff0c\u5c0f\u6797\u4e4b\u524d\u5199\u7684 TCP \u6587\u7ae0\u4e0d\u5c11\u6848\u4f8b\u548c\u56fe\u7247\u90fd\u662f\u53c2\u8003\u8fd9\u91cc\u7684\uff0c\u8fd9\u672c\u4e66\u7cbe\u534e\u90e8\u5206\u5c31\u662f\u628a TCP \u6ed1\u52a8\u7a97\u53e3\u548c\u6d41\u91cf\u63a7\u5236\u8bf4\u7684\u8d85\u7ea7\u660e\u767d\uff0c\u5f88\u53ef\u60dc\u62e5\u585e\u63a7\u5236\u90e8\u5206\u8bf4\u7684\u4e0d\u591a\u3002</p> <p></p> <p>\u300aThe TCP/IP GUIDE\u300b</p> <p>\u767d\u5ad6\u7ad9\u70b9\uff1ahttp://www.tcpipguide.com/free/t_TCPSlidingWindowAcknowledgmentSystemForDataTranspo-6.htm</p> <p>\u5f53\u7136\uff0c\u8ba1\u7b97\u673a\u7f51\u7edc\u6700\u725b\u903c\u7684\u8d44\u6599\uff0c\u90a3\u5fc5\u5b9a RFC \u6587\u6863\uff0c\u5b83\u53ef\u4ee5\u79f0\u4e3a\u8ba1\u7b97\u673a\u7f51\u7edc\u4e16\u754c\u7684\u300c\u6cd5\u89c4\u300d\uff0c\u4e5f\u662f\u6700\u65b0\u3001\u6700\u6743\u5a01\u548c\u6700\u6b63\u786e\u7684\u5730\u65b9\u4e86\uff0c\u56f0\u60d1\u5927\u5bb6\u7684 TCP \u4e3a\u4ec0\u4e48\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\uff0c\u5176\u5b9e\u5728 RFC \u6587\u6863\u51e0\u53e5\u8bdd\u5c31\u8bf4\u660e\u767d\u4e86\u3002</p> <p>TCP \u534f\u8bae\u7684 RFC \u6587\u6863\uff1ahttps://datatracker.ietf.org/doc/rfc1644/</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_14","title":"\u5b9e\u6218\u7cfb\u5217","text":"<p>\u5728\u5b66\u4e60\u4e66\u7c4d\u8d44\u6599\u7684\u65f6\u5019\uff0c\u4e0d\u7ba1\u662f TCP\u3001UDP\u3001ICMP\u3001DNS\u3001HTTP\u3001HTTPS \u7b49\u534f\u8bae\uff0c\u6700\u597d\u90fd\u53ef\u4ee5\u4eb2\u624b\u5c1d\u8bd5\u6293\u6570\u636e\u62a5\uff0c\u63a5\u7740\u53ef\u4ee5\u7528 Wireshark \u5de5\u5177\u770b\u6bcf\u4e00\u4e2a\u6570\u636e\u62a5\u6587\u7684\u4fe1\u606f\uff0c\u8fd9\u6837\u4f60\u4f1a\u89c9\u5f97\u8ba1\u7b97\u673a\u7f51\u7edc\u6ca1\u6709\u60f3\u8c61\u4e2d\u90a3\u4e48\u62bd\u8c61\u4e86\uff0c\u56e0\u4e3a\u5b83\u4eec\u88ab\u4f60\u300c\u6293\u300d\u51fa\u6765\u4e86\uff0c\u5e76\u6beb\u65e0\u4fdd\u7559\u5730\u663e\u73b0\u5728\u4f60\u9762\u524d\u4e86\uff0c\u4e8e\u662f\u4f60\u5c31\u53ef\u4ee5\u8086\u65e0\u5fcc\u60ee\u5730\u300c\u6252\u5f00\u300d\u5b83\u4eec\uff0c\u770b\u6e05\u5b83\u4eec\u6bcf\u4e00\u4e2a\u5934\u4fe1\u606f\u3002</p> <p>\u90a3\u5728\u8fd9\u91cc\uff0c\u6211\u4e5f\u7ed9\u4f60\u63a8\u8350 2 \u672c\u5173\u4e8e Wireshark \u7f51\u7edc\u5206\u6790\u7684\u4e66\uff1a\u300aWireshark \u7f51\u7edc\u5206\u6790\u5c31\u8fd9\u4e48\u7b80\u5355\u300b\u4e0e\u300aWireshark \u7f51\u7edc\u5206\u6790\u7684\u827a\u672f\u300b\u3002</p> <p>\u8fd9\u4e24\u672c\u4e66\u90fd\u662f\u540c\u4e00\u4e2a\u4f5c\u8005\uff0c\u4e66\u4e2d\u7684\u6848\u4f8b\u90fd\u662f\u6e90\u4e8e\u4f5c\u8005\u5de5\u4f5c\u4e2d\u7684\u5b9e\u9645\u7684\u6848\u4f8b\uff0c\u4f5c\u8005\u7684\u6587\u7b14\u76f8\u5f53\u6709\u8da3\uff0c\u770b\u8d77\u6765\u582a\u6bd4\u5c0f\u8bf4\u4e00\u6837\u723d\uff0c\u76f8\u4fe1\u4f60\u4e0d\u7528\u4e00\u4e2a\u661f\u671f 2 \u672c\u90fd\u80fd\u770b\u5b8c\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#mysql","title":"\u4e94\u3001MySQL","text":"<p>MySQL \u5165\u95e8\u7684\u8bdd\u662f\u4e86\u89e3 SQL \u8bed\u6cd5\uff0c\u8fdb\u9636\u7684\u8bdd\u662f\u6df1\u5165\u5e95\u5c42\u5b9e\u73b0\u539f\u7406\u3002</p> <p>\u5343\u4e07\u4e0d\u8981\u4e00\u4e0a\u6765\u5c31\u770b\u300a\u9ad8\u6027\u80fd MySQL\u300b\uff0c\u6211\u66fe\u7ecf\u5148\u8bfb\u300a\u9ad8\u6027\u80fd MySQL\u300b\u7136\u540e\u4e00\u8def\u66b4\u96f7\u2026\u2026 \u56e0\u4e3a\u8fd9\u672c\u4e0d\u662f\u5165\u95e8\u7684\u4e66\u7c4d\uff01</p> <p>\u6211\u5148\u4ecb\u7ecd\u4e0b MySQL \u7684\u91cd\u70b9\u77e5\u8bc6\uff0c\u4e5f\u662f\u9762\u8bd5\u5e38\u9762\u7684\u77e5\u8bc6\u70b9\uff1a</p> <ul> <li>\u57fa\u672c\u8bed\u6cd5\uff1aselect/delete/insert/update\u3001limit\u3001join \u7b49</li> <li>\u7d22\u5f15\uff1aB+\u6811\uff0c\u805a\u65cf\u7d22\u5f15\uff0c\u4e8c\u7ea7\u7d22\u5f15\uff0c\u7ec4\u5408\u7d22\u5f15\uff0c\u6700\u5de6\u5339\u914d\u539f\u5219\uff0c\u7d22\u5f15\u5931\u6548\u3001\u6162\u67e5\u8be2</li> <li>\u4e8b\u52a1\uff1a\u4e8b\u52a1\u56db\u5927\u7279\u6027 ACID\uff0c\u4e8b\u52a1\u9694\u79bb\u7ea7\u522b\uff0cMVCC</li> <li>\u9501\uff1a\u5168\u5c40\u9501\u3001\u8868\u7ea7\u9501\u3001\u884c\u7ea7\u9501\u3001\u5feb\u7167\u8bfb\u3001\u5f53\u524d\u8bfb\u3001\u4e50\u89c2\u9501\u3001\u60b2\u89c2\u9501\u3001\u6b7b\u9501</li> <li>\u65e5\u5fd7\uff1a\u91cd\u505a\u65e5\u5fd7 (redo log)\u3001\u56de\u6eda\u65e5\u5fd7 (undo log)\u3001\u4e8c\u8fdb\u5236\u65e5\u5fd7 (binlog)</li> <li>\u67b6\u6784\uff1a\u8bfb\u5199\u5206\u79bb\u3001\u4e3b\u4ece\u67b6\u6784\u3001\u5206\u5e93\u5206\u8868\u3001\u6570\u636e\u5e93\u548c\u7f13\u5b58\u53cc\u5199\u4e00\u81f4\u6027</li> </ul> <p>MySQL \u5165\u95e8\u63a8\u8350\u300aSQL \u5fc5\u77e5\u5fc5\u4f1a\u300b\uff0c\u8fd9\u4e00\u672c\u5f88\u8584\u7684\u4e66\uff0c\u4e3b\u8981\u662f\u8bb2\u6570\u636e\u5e93\u589e\u5220\u67e5\u6539\u7684 SQL \u8bed\u6cd5\u3002</p> <p>\u5b66\u5b8c SQL \u8bed\u6cd5\uff0c\u6211\u4eec\u4e0d\u80fd\u6b62\u6b65\uff0c\u8981\u6df1\u5165\u53bb\u4e86\u89e3 MySQL \u5e95\u5c42\u77e5\u8bc6\u3002</p> <p>\u8fd9\u91cc\u5efa\u8bae\u5148\u770b\u300aMySQL \u662f\u600e\u4e48\u8fd0\u884c\u7684\u300b\uff0c\u8fd9\u672c\u4e66\u542b\u6709\u5f88\u591a\u56fe\uff0c\u662f\u5c0f\u767d\u5b66\u4e60 MySQL \u5e95\u5c42\u77e5\u8bc6\u7684\u6700\u4f73\u4e66\u7c4d\uff0c\u770b\u4e86\u4e0b\u4f5c\u8005\u7b80\u4ecb\uff0c\u4ed6\u662f\u88f8\u8f9e\u4e00\u5e74\u5728\u5bb6\u91cc\u5199\u51fa\u6765\u7684\u8fd9\u672c\u4e66\uff0c\u770b\u7684\u51fa\u6765\u975e\u5e38\u7528\u5fc3\u7684\u4e86\u3002</p> <p>MySQL \u7528\u7684\u6700\u591a\u7684\u5c31\u662f InnoDB \u5f15\u64ce\u4e86\uff0c\u6240\u4ee5\u8fdb\u4e00\u6b65\u5b66\u4e60 InnoDB \u662f\u5f88\u6709\u5fc5\u8981\u7684\uff0c\u8fd9\u91cc\u63a8\u8350\u300aMySQL \u6280\u672f\u5185\u5e55\u300b\uff0c\u8fd9\u672c\u4e66\u53ef\u4ee5\u7ed3\u5408\u300aMySQL \u662f\u600e\u4e48\u6837\u8fd0\u884c\u7684\u300b\u4e00\u8d77\u770b\u3002</p> <p>\u597d\u4e86\uff0c\u770b\u5b8c\u4e0a\u9762\u7684\uff0c\u4f60\u5bf9 MySQL \u5df2\u7ecf\u6709\u76f8\u5f53\u591a\u7684\u8ba4\u8bc6\u4e86\uff0cMySQL \u8fd8\u6709\u4e00\u672c\u9ad8\u6027\u80fd\u7684\u4e66\u300a\u9ad8\u6027\u80fd MySQL\u300b\uff0c\u975e\u5e38\u7684\u7ecf\u5178\uff0c\u8fd9\u672c\u4e66\u6bd4\u8f83\u539a\uff0c\u5927\u5bb6\u53ef\u4ee5\u5f53\u4f5c\u5b57\u5178\uff0c\u7d22\u5f15\u7ae0\u8282\u5927\u5bb6\u53ef\u4ee5\u53bb\u770b\u770b\uff0c\u770b\u5b8c\u540e\u4f60\u5bf9\u7d22\u5f15\u7684\u8ba4\u8bc6\u53c8\u4f1a\u5237\u65b0\u4e00\u904d\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#redis","title":"\u516d\u3001Redis","text":"<p>\u8981\u5165\u95e8 Redis\uff0c\u5c31\u8981\u5148\u77e5\u9053\u8fd9\u4e1c\u897f\u600e\u4e48\u7528\uff0c\u8bf4\u767d\u4e86\uff0c\u6700\u5f00\u59cb\u5c31\u662f\u5148\u5b66\u4e60\u64cd\u4f5c Reids \u7684\u76f8\u5173\u547d\u4ee4\uff0c\u5c31\u50cf\u6211\u4eec\u5165\u95e8 MySQL \u7684\u65f6\u5019\uff0c\u90fd\u662f\u5148\u5b66\u4e60 SQL \u8bed\u8a00\u3002</p> <p>\u5165\u95e8 Redis \u547d\u4ee4\u8fd9\u4e00\u5757\u6211\u5f53\u65f6\u6ca1\u6709\u53bb\u4e13\u95e8\u4e70\u4e66\u770b\uff0c\u800c\u662f\u76f4\u63a5\u770b\u89c6\u9891\uff0c\u56e0\u4e3a\u6211\u89c9\u5f97\u547d\u4ee4\u7684\u4f7f\u7528\u5b9e\u64cd\u6027\u8fd8\u662f\u6bd4\u8f83\u5f3a\u7684\uff0c\u8ddf\u7740\u8001\u5e08\u6572\u547d\u4ee4\u5b66\u4e60\u4f1a\u6bd4\u8f83\u5feb\u4e00\u4e9b\u3002</p> <p>\u8fd9\u91cc\u6211\u63a8\u8350\u4e0b\u5c1a\u7845\u8c37 Redis \u89c6\u9891\u8bfe\uff0c\u5728 B \u7ad9\u5c31\u53ef\u4ee5\u770b\uff0c\u8bb2\u7684\u8fd8\u662f\u633a\u6e05\u6670\u7684\uff0c\u4e5f\u628a Redis \u5f88\u591a\u91cd\u70b9\u77e5\u8bc6\u4e5f\u8bb2\u4e86\uff0c\u6bd4\u5982 Redis \u57fa\u672c\u6570\u636e\u7ed3\u6784\u3001\u6301\u4e45\u5316\u6280\u672f\u3001\u4e3b\u4ece\u590d\u5236\u3001\u54e8\u5175\u3001\u96c6\u7fa4\u7b49\u7b49\uff0c\u4e00\u5957\u8fde\u62db\u4e0b\u6765\uff0c\u5c31\u57fa\u672c\u5165\u95e8\u4e86\u3002</p> <p></p> <p>Redis \u5b98\u7f51\u4e5f\u6709\u4e00\u6574\u5957\u7684\u547d\u4ee4\u8be6\u89e3\uff0c\u9047\u5230\u9700\u8981\u6216\u8005\u4e0d\u4f1a\u7684\u5730\u65b9\u53ef\u4ee5\u67e5\u4e00\u4e0b\uff1ahttp://doc.redisfans.com</p> <p></p> <p>\u89c6\u9891\u662f\u5e2e\u52a9\u6211\u4eec\u5feb\u901f\u5165\u95e8\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u6b62\u4e8e\u89c6\u9891\uff0c\u56e0\u4e3a\u4e00\u4e9b\u7ec6\u8282\u7684\u77e5\u8bc6\u70b9\u89c6\u9891\u4e0a\u5e76\u6ca1\u6709\u63d0\u53ca\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u5c31\u8981\u56de\u5f52\u4e66\u672c\u3002</p> <p>\u8fd9\u91cc\u63a8\u8350\u5b66\u4e60 Redis \u7684\u5723\u7ecf\u7ea7\u522b\u7684\u4e66\u2014\u2014\u300aRedis \u8bbe\u8ba1\u4e0e\u5b9e\u73b0\u300b\uff0c\u56e0\u4e3a\u5b83\u592a\u7ecf\u5178\u4e86\uff01</p> <p>\u8fd9\u672c\u4e66\u4e0d\u662f\u6559\u4f60\u5982\u4f55\u4f7f\u7528 Redis\uff0c\u800c\u662f\u8ddf\u4f60\u8bb2\u89e3 Redis \u662f\u600e\u4e48\u5b9e\u73b0\uff0c\u600e\u4e48\u8bbe\u8ba1\u7684\uff0c\u4e5f\u5c31\u8bf4\u6e90\u7801\u7ea7\u522b\u7684\u5b66\u4e60\uff0c\u4f46\u662f\u4e66\u4e0a\u5e76\u6ca1\u6709\u5927\u6bb5\u8d34\u4ee3\u7801\uff0c\u4f5c\u8005\u662f\u7528\u4f2a\u4ee3\u7801\u7684\u65b9\u5f0f\u6765\u8bb2\u89e3\uff0c\u6240\u4ee5\u8bfb\u8d77\u6765\u4e0d\u4f1a\u592a\u96be\u7684\u3002</p> <p>\u4e66\u672c\u4e0a\u4e3b\u8981\u56f4\u7ed5\u8fd9\u51e0\u5927\u77e5\u8bc6\u70b9\uff1a\u6570\u636e\u7ed3\u6784\u3001AOF \u548c RDB \u6301\u4e45\u5316\u6280\u672f\u3001\u7f51\u7edc\u8f93\u5165\u8f93\u51fa\u7cfb\u7edf\u3001\u4e3b\u4ece\u590d\u5236\u3001\u54e8\u5175\u6a21\u5f0f\u3001\u96c6\u7fa4\u6a21\u5f0f\u3002</p> <p>\u5230\u8fd9\u91cc\u4f60\u5df2\u7ecf\u662f\u5165\u95e8 Redis \u4e86\uff0c\u4e0d\u4ec5\u4f1a\u4e86 Redis \u57fa\u672c\u547d\u4ee4\uff0c\u8fd8\u61c2 Redis \u7684\u5b9e\u73b0\uff0c\u5269\u4e0b\u7684\u5c31\u662f\u5b66\u4e60\u5982\u4f55\u5728\u5b9e\u6218\u4e2d\u8fd0\u7528 Redis\u3002</p> <p>\u8fd9\u91cc\u63a8\u8350\u300aRedis \u5b9e\u6218\u300b\u8fd9\u672c\u4e66\uff0c\u8be5\u4e66\u901a\u8fc7\u5b9e\u9645\u7684\u4f8b\u5b50\uff0c\u5c55\u793a\u4e86\u4f7f\u7528 Redis \u6784\u5efa\u591a\u79cd\u4e0d\u540c\u7684\u5e94\u7528\u7a0b\u5e8f\u7684\u65b9\u6cd5\u3002</p> <p>\u5904\u4e8e\u8fdb\u9636\u9636\u6bb5\u7684 Redis \u5b66\u4e60\u8005\u53ef\u4ee5\u901a\u8fc7\u9605\u8bfb\u8be5\u4e66\u6765\u5b66\u4e60\u5982\u4f55\u4f7f\u7528 Redis \u53bb\u6784\u5efa\u5b9e\u9645\u7684\u5e94\u7528\uff0c\u7136\u540e\u4e3e\u4e00\u53cd\u4e09\uff0c\u628a\u4e66\u4e2d\u4ecb\u7ecd\u7684\u7a0b\u5e8f\u548c\u65b9\u6cd5\u5e94\u7528\u5230\u81ea\u5df1\u9047\u5230\u7684\u95ee\u9898\u4e0a\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_15","title":"\u4e03\u3001\u770b\u4e66\u5fc3\u5f97","text":"<p>\u6ca1\u6709\u4eba\u89c4\u5b9a\u770b\u4e66\u4e00\u5b9a\u8981\u4e00\u9875\u4e00\u9875\u7684\u5168\u90e8\u770b\u5b8c\uff0c\u6211\u4eec\u8981\u77e5\u9053\u770b\u4e66\u7684\u76ee\u7684\u662f\u4ec0\u4e48\uff1f</p> <p>\u65e0\u975e\u4e0d\u5c31\u662f\u6536\u83b7\u77e5\u8bc6\uff0c\u548c\u89e3\u51b3\u95ee\u9898\u561b\u3002</p> <p>\u6240\u4ee5\u6700\u597d\u7684\u770b\u4e66\u65b9\u5f0f\u662f\u5e26\u7740\u95ee\u9898\u53bb\u7ffb\u9605\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5e26\u7740\u7a0b\u5e8f\u662f\u5982\u4f55\u5728\u8ba1\u7b97\u673a\u91cc\u8dd1\u8d77\u6765\u7684\u95ee\u9898\uff0c\u53bb\u5b66\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\uff1b</li> <li>\u5e26\u7740\u8f93\u5165\u4e00\u6761 url \u5230\u7f51\u9875\u663e\u793a\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\u7684\u95ee\u9898\uff0c\u53bb\u5b66\u4e60\u8ba1\u7b97\u673a\u7f51\u7edc\uff1b</li> <li>\u5e26\u7740\u8fdb\u7a0b\u3001\u5185\u5b58\u3001\u78c1\u76d8\u662f\u5982\u4f55\u88ab\u64cd\u4f5c\u7cfb\u7edf\u7ba1\u7406\u70b9\uff0c\u53bb\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\uff1b</li> <li>\u5e26\u7740\u5982\u4f55\u5b9e\u73b0\u4e00\u4e2a\u9ad8\u5e76\u53d1\u7f51\u7edc\u6a21\u578b\uff0c\u53bb\u5b66\u4e60\u7f51\u7edc\u7f16\u7a0b\uff1b</li> <li>\u2026\u2026</li> </ul> <p>\u6211\u4e4b\u524d\u4e5f\u5199\u8fc7\u4e00\u7bc7\u6211\u7684\u770b\u4e66\u5fc3\u5f97\uff0c\u5e2e\u52a9\u5230\u4e86\u5f88\u591a\u540c\u5b66\uff0c\u5efa\u8bae\u6ca1\u770b\u8fc7\u7684\u540c\u5b66\uff0c\u53bb\u770b\u770b\uff1b \u770b\u4e66\u7684\u4e00\u70b9\u5c0f\u5efa\u8bae</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/cs_learn/#_16","title":"\u516b\u3001\u878d\u6c47\u8d2f\u901a","text":"<p>\u770b\u5230\u8fd9\uff0c\u5f88\u591a\u5c0f\u4f19\u4f34\u4f1a\u8bf4\u4e86\uff0c\u5b66\u4e86\u8fd9\u4e48\u591a\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u600e\u4e48\u5c06\u8fd9\u4e9b\u77e5\u8bc6\u70b9\u878d\u4f1a\u8d2f\u901a\u5462\uff1f</p> <p>\u6211\u4e4b\u524d\u5199\u8fc7\u4e00\u7bc7\u6587\u7ae0\uff0c\u7528\u4e00\u4e2a\u6848\u4f8b\u628a\u8ba1\u7b97\u673a\u539f\u7406 + \u64cd\u4f5c\u7cfb\u7edf + \u6570\u636e\u7ed3\u6784 + \u8ba1\u7b97\u673a\u7f51\u7edc\u878d\u4f1a\u8d2f\u901a\uff0c\u5e26\u5927\u5bb6\u611f\u53d7\u4e0b\u611f\u53d7\u8ba1\u7b97\u57fa\u7840\u4e4b\u7f8e\uff1a\u5982\u4f55\u5c06\u8ba1\u7b97\u673a\u7ec4\u6210\u3001\u64cd\u4f5c\u7cfb\u7edf\u3001\u8ba1\u7b97\u673a\u7f51\u7edc\u3001\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u878d\u4f1a\u8d2f\u901a\uff1f</p> <p>\u8fd9\u6b21\u5206\u4eab\u5c31\u5230\u8fd9\u5566\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/","title":"\u5982\u4f55\u5c06\u8ba1\u7b97\u673a\u7f51\u7edc\u3001\u64cd\u4f5c\u7cfb\u7edf\u3001\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u3001\u8ba1\u7b97\u7ec4\u6210\u878d\u4f1a\u8d2f\u901a\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6709\u4f4d\u5173\u6ce8\u6211\u4e00\u5e74\u7684\u8bfb\u8005\u627e\u6211\uff0c\u4ed6\u53bb\u5e74\u5173\u6ce8\u6211\u516c\u4f17\u540e\uff0c\u5f00\u59cb\u81ea\u5b66 CS\uff0c\u4e3b\u8981\u662f\u8ba1\u7b97\u673a\u57fa\u7840\u8fd9\u4e00\u5757\u3002</p> <p></p> <p>\u4ed6\u4ece\u90a3\u65f6\u8d77\uff0c\u5c31\u65e5\u590d\u4e00\u65e5\u7684\u5b66\u4e60\uff0c\u5e76\u5728 Github \u6709\u505a\u7b14\u8bb0\u7684\u4e60\u60ef\uff0c\u4f60\u770b\u4ed6\u7684\u63d0\u4ea4\u8bb0\u5f55\uff0c\u6bcf\u5929\u90fd\u6709\uff0c\u4e00\u5929\u90fd\u6ca1\u62c9\u4e0b\uff0c\u5c31\u8fd9\u6837\u575a\u6301\u4e86\u4e00\u5e74\u3002</p> <p>\u8fd9\u4e2a\u4e00\u5e74\u6ca1\u6709\u95f4\u65ad\u8fc7\u7684\u575a\u6301\uff0c\u6211\u662f\u771f\u7684\u88ab\u9707\u64bc\u5230\uff0c\u867d\u7136\u6211\u4e5f\u7ecf\u5e38\u809d\u6587\u7ae0\uff0c\u4f46\u662f\u6211\u4e5f\u505a\u4e0d\u5230\u6bcf\u5929\u90fd\u662f\u5b66\u4e60\u7684\u72b6\u6001\uff0c\u603b\u4f1a\u60f3\u5077\u61d2\u51e0\u5929\uff0c\u6bd5\u7adf\u5b66\u4e60\u771f\u7684\u662f\u53cd\u4eba\u6027\u7684\u54c8\u54c8\u3002</p> <p>\u8fd9\u4f4d\u8bfb\u8005\u53bb\u5e74\u7684\u65f6\u5019\uff0c\u4e5f\u53ea\u662f\u4f1a\u7528 python \u8f93\u51fa hello world \u521d\u5b66\u8005\uff0c\u800c\u5982\u4eca\u80fd\u5f00\u59cb\u5543 Redis \u6e90\u7801\u4e86\uff0c\u5e76\u4e14\u8fd8\u8bb0\u5f55\u4e86\u5b66\u4e60 Redis \u6570\u636e\u7ed3\u6784\u7684\u6e90\u7801\u7b14\u8bb0\u3002</p> <p></p> <p>\u6211\u4e5f\u8ddf\u4ed6\u8ba8\u8bba\u4e86\u6211\u5b66\u8ba1\u7b97\u57fa\u7840\u7684\u611f\u53d7\uff0c\u4ed6\u4e5f\u6709\u76f8\u540c\u7684\u611f\u53d7\uff0c\u770b\u6765\u662f\u540c\u9053\u4e2d\u4eba\u3002</p> <p></p> <p>\u4e4b\u524d\u6709\u5f88\u591a\u8bfb\u8005\u95ee\u6211\u5b66\u8ba1\u7b97\u673a\u57fa\u7840\u6709\u5565\u7528\uff1f\u4e0d\u61c2\u7b97\u6cd5\u3001\u8ba1\u7b97\u673a\u7f51\u7edc\u3001\u64cd\u4f5c\u7cfb\u7edf\u8fd9\u4e9b\u4e1c\u897f\uff0c\u4e5f\u53ef\u4ee5\u5b8c\u6210\u5de5\u4f5c\u4e0a\u7684 CRUD \u4e1a\u52a1\u5f00\u53d1\uff0c\u90a3\u4e3a\u4ec0\u4e48\u8981\u82b1\u65f6\u95f4\u53bb\u5b66\uff1f</p> <p>\u662f\u7684\uff0c\u4e0d\u61c2\u8fd9\u4e9b\uff0c\u786e\u5b9e\u4e0d\u4f1a\u5f71\u54cd CRUD \u4e1a\u52a1\u5f00\u53d1\uff0c\u5bf9\u4e8e\u8fd9\u7c7b\u4e1a\u52a1\u5f00\u53d1\u7684\u5de5\u4f5c\uff0c\u96be\u70b9\u662f\u5728\u4e8e\u5bf9\u4e1a\u52a1\u7684\u7406\u89e3\uff0c\u4f46\u662f\u95e8\u69db\u5e76\u4e0d\u9ad8\uff0c\u627e\u4e2a\u521a\u6bd5\u4e1a\u4eba\uff0c\u8ba9\u4ed6\u82b1\u51e0\u4e2a\u6708\u65f6\u95f4\u719f\u6089\u4e1a\u52a1\u548c\u4ee3\u7801\uff0c\u4ed6\u4e00\u6837\u53ef\u4ee5\u4e0a\u624b\u5f00\u53d1\u4e86\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u5355\u7eaf\u7684 CRUD \u4e1a\u5f00\u53d1\u5de5\u4f5c\u5f88\u5feb\u5c31\u4f1a\u88ab\u4f53\u529b\u66f4\u597d\u7684\u65b0\u4eba\u53d6\u4ee3\u7684\u3002</p> <p>\u53e6\u5916\uff0c\u5728\u9762\u5bf9\u4e00\u4e9b\u6027\u80fd\u95ee\u9898\uff0c\u5982\u679c\u6ca1\u6709\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u6211\u4eec\u662f\u65e0\u4ece\u4e0b\u624b\u7684\uff0c\u8fd9\u65f6\u5019\u7a0b\u5e8f\u5458\u4e4b\u95f4\u7684\u5206\u6c34\u5cad\u5c31\u51fa\u6765\u4e86\u3002</p> <p>\u4eca\u5929\uff0c\u6211\u4e0d\u8bb2\u865a\u7684\u4e1c\u897f\u3002</p> <p>\u6211\u4ee5\u5982\u4f55\u8bbe\u8ba1\u4e00\u4e2a\u300c*\u9ad8\u6027\u80fd\u7684\u5355\u673a\u7ba1\u7406\u4e3b\u673a\u7684\u5fc3\u8df3\u670d\u52a1*\u300d\u7684\u65b9\u5f0f\uff0c\u8ba9\u5927\u5bb6\u611f\u53d7\u8ba1\u7b97\u57fa\u7840\u4e4b\u7f8e\uff0c\u8fd9\u91cc\u4f1a\u6d89\u53ca\u5230\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5 + \u64cd\u4f5c\u7cfb\u7edf + \u8ba1\u7b97\u673a\u7ec4\u6210 + \u8ba1\u7b97\u673a\u7f51\u7edc\u8fd9\u4e9b\u77e5\u8bc6\u3002</p> <p></p> <p>\u5927\u5bb6\u8010\u5fc3\u770b\u4e0b\u53bb\uff0c\u4f60\u4f1a\u53d1\u73b0\u539f\u6765\u8ba1\u7b97\u673a\u57fa\u7840\u77e5\u8bc6\u7684\u7528\u5904\uff0c\u76f8\u4fe1\u6211\uff0c\u4f60\u4f1a\u611f\u89e6\u5f88\u6df1\u523b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#_2","title":"\u6848\u4f8b\u9700\u6c42","text":"<p>\u540e\u53f0\u901a\u5e38\u662f\u7531\u591a\u53f0\u670d\u52a1\u5668\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u7684\uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684\u96c6\u7fa4\u3002</p> <p></p> <p>\u5982\u679c\u96c6\u7fa4\u4e2d\u7684\u67d0\u4e00\u53f0\u4e3b\u673a\u5b95\u673a\u4e86\uff0c\u6211\u4eec\u5fc5\u987b\u8981\u611f\u77e5\u5230\u8fd9\u53f0\u4e3b\u673a\u5b95\u673a\u4e86\uff0c\u8fd9\u6837\u624d\u505a\u5bb9\u707e\u5904\u7406\uff0c\u6bd4\u5982\u8be5\u5b95\u673a\u7684\u4e3b\u673a\u7684\u4e1a\u52a1\u8fc1\u79fb\u5230\u53e6\u5916\u4e00\u53f0\u4e3b\u673a\u7b49\u7b49\u3002</p> <p>\u90a3\u5982\u4f55\u611f\u77e5\u5462\uff1f\u90a3\u5c31\u9700\u8981\u5fc3\u8df3\u670d\u52a1\u4e86\u3002</p> <p></p> <p>\u8981\u6c42\u6bcf\u53f0\u4e3b\u673a\u90fd\u8981\u5411\u4e00\u53f0\u4e3b\u673a\u4e0a\u62a5\u5fc3\u8df3\u5305\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u80fd\u5728\u8fd9\u53f0\u4e3b\u673a\u4e0a\u770b\u5230\u6bcf\u53f0\u4e3b\u673a\u7684\u5728\u7ebf\u60c5\u51b5\u4e86\u3002</p> <p>\u5fc3\u8df3\u670d\u52a1\u4e3b\u8981\u505a\u4e24\u4ef6\u4e8b\u60c5\uff1a</p> <ul> <li>\u53d1\u73b0\u5b95\u673a\u7684\u4e3b\u673a\uff1b</li> <li>\u53d1\u73b0\u4e0a\u7ebf\u7684\u4e3b\u673a\u3002</li> </ul> <p>\u770b\u4e0a\u53bb\u611f\u89c9\u5f88\u7b80\u5355\uff0c\u4f46\u662f\u5f53\u96c6\u7fa4\u8fbe\u5230\u5341\u4e07\uff0c\u751a\u81f3\u767e\u4e07\u53f0\u7684\u65f6\u5019\uff0c\u8981\u5b9e\u73b0\u4e00\u4e2a\u53ef\u4ee5\u80fd\u7ba1\u7406\u8fd9\u6837\u89c4\u6a21\u7684\u96c6\u7fa4\u7684\u5fc3\u8df3\u670d\u52a1\u8fdb\u7a0b\uff0c\u6ca1\u70b9\u5e95\u5c42\u77e5\u8bc6\u662f\u65e0\u6cd5\u505a\u5230\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c06\u4ece\u4e09\u4e2a\u7ef4\u5ea6\u6765\u8bbe\u8ba1\u8fd9\u4e2a\u5fc3\u8df3\u670d\u52a1\uff1a</p> <ul> <li>\u5b95\u673a\u5224\u65ad\u7b97\u6cd5\u7684\u8bbe\u8ba1</li> <li>\u9ad8\u5e76\u53d1\u67b6\u6784\u7684\u8bbe\u8ba1</li> <li>\u4f20\u8f93\u5c42\u534f\u8bae\u7684\u9009\u62e9</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#_3","title":"\u5b95\u673a\u5224\u65ad\u7b97\u6cd5\u7684\u8bbe\u8ba1","text":"<p>\u8fd9\u4e2a\u5fc3\u8df3\u670d\u52a1\u6700\u5173\u952e\u662f\u5224\u65ad\u5b95\u673a\u7684\u7b97\u6cd5\u3002</p> <p>\u5982\u679c\u91c7\u7528\u66b4\u529b\u904d\u5386\u6240\u6709\u4e3b\u673a\u7684\u65b9\u5f0f\u6765\u627e\u5230\u8d85\u65f6\u7684\u4e3b\u673a\uff0c\u5728\u9762\u5bf9\u53ea\u6709\u51e0\u767e\u53f0\u4e3b\u673a\u7684\u573a\u666f\u662f\u6ca1\u95ee\u9898\uff0c\u4f46\u662f\u8fd9\u4e2a\u7b97\u6cd5\u4f1a\u968f\u7740\u4e3b\u673a\u8d8a\u591a\uff0c\u7b97\u6cd5\u590d\u6742\u5ea6\u4e5f\u4f1a\u4e0a\u5347\uff0c\u7a0b\u5e8f\u7684\u6027\u80fd\u4e5f\u5c31\u4f1a\u6025\u5267\u4e0b\u964d\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u5e94\u8be5\u8bbe\u8ba1\u4e00\u4e2a\u53ef\u4ee5\u5e94\u5bf9\u8d85\u5927\u96c6\u7fa4\u89c4\u6a21\u7684\u5b95\u673a\u5224\u65ad\u7b97\u6cd5\u3002</p> <p>\u6211\u4eec\u5148\u6765\u601d\u8003\u4e0b\uff0c\u5fc3\u8df3\u5305\u5e94\u8be5\u6709\u4ec0\u4e48\u6570\u636e\u7ed3\u6784\u6765\u7ba1\u7406\uff1f</p> <p>\u5fc3\u8df3\u5305\u91cc\u7684\u5185\u5bb9\u662f\u6709\u4e3b\u673a\u4e0a\u62a5\u7684\u65f6\u95f4\u4fe1\u606f\u7684\uff0c\u4e5f\u5c31\u662f\u6709\u65f6\u95f4\u5173\u7cfb\u7684\uff0c\u90a3\u4e48\u53ef\u4ee5\u7528\u300c\u53cc\u5411\u94fe\u8868\u300d\u6784\u6210\u5148\u5165\u5148\u51fa\u7684\u961f\u5217\uff0c\u8fd9\u6837\u5c31\u4fdd\u5b58\u4e86\u5fc3\u8df3\u5305\u7684\u65f6\u5e8f\u5173\u7cfb\u3002</p> <p></p> <p>\u7531\u4e8e\u91c7\u7528\u7684\u6570\u636e\u7ed3\u6784\u662f\u53cc\u5411\u94fe\u8868\uff0c\u6240\u4ee5\u961f\u5c3e\u63d2\u5165\u548c\u961f\u5934\u5220\u9664\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u662f O(1)\u3002</p> <p>\u5982\u679c\u6709\u65b0\u7684\u5fc3\u8df3\u5305\uff0c\u5219\u5c06\u5176\u63d2\u5165\u5230\u53cc\u5411\u94fe\u8868\u7684\u5c3e\u90e8\uff0c\u90a3\u4e48\u6700\u8001\u7684\u5fc3\u8df3\u5305\u5c31\u662f\u5728\u53cc\u5411\u94fe\u8868\u7684\u5934\u90e8\uff0c\u8fd9\u6837\u5728\u5bfb\u627e\u5b95\u673a\u7684\u4e3b\u673a\u65f6\uff0c\u53ea\u8981\u770b\u53cc\u5411\u94fe\u8868\u5934\u90e8\u6700\u8001\u7684\u5fc3\u8df3\u5305\uff0c\u8ddd\u73b0\u5728\u662f\u5426\u8d85\u8fc7 5 \u79d2\uff0c\u5982\u679c\u8d85\u8fc7 5 \u79d2 \u5219\u8ba4\u4e3a\u8be5\u4e3b\u673a\u5b95\u673a\uff0c\u7136\u540e\u5c06\u5176\u4ece\u53cc\u5411\u94fe\u8868\u4e2d\u5220\u9664\u3002</p> <p>\u7ec6\u5fc3\u7684\u540c\u5b66\u80af\u5b9a\u53d1\u73b0\u4e86\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u5982\u679c\u4e00\u4e2a\u4e3b\u673a\u7684\u5fc3\u8df3\u5305\u5df2\u7ecf\u5728\u961f\u5217\u4e2d\uff0c\u90a3\u4e48\u4e0b\u6b21\u8be5\u4e3b\u673a\u7684\u5fc3\u8df3\u5305\u8981\u600e\u4e48\u5904\u7406\u5462\uff1f</p> <p>\u4e3a\u4e86\u7ef4\u6301\u961f\u5217\u91cc\u7684\u5fc3\u8df3\u5305\u662f\u4e3b\u673a\u6700\u65b0\u4e0a\u62a5\u7684\uff0c\u6240\u4ee5\u8981\u5148\u627e\u5230\u8be5\u4e3b\u673a\u65e7\u7684\u5fc3\u8df3\u5305\uff0c\u7136\u540e\u5c06\u5176\u5220\u9664\uff0c\u518d\u628a\u65b0\u7684\u5fc3\u8df3\u5305\u63d2\u5165\u5230\u53cc\u5411\u94fe\u8868\u7684\u961f\u5c3e\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u5728\u961f\u5217\u627e\u5230\u8be5\u4e3b\u673a\u65e7\u7684\u5fc3\u8df3\u5305\uff0c\u7531\u4e8e\u6570\u636e\u7ed3\u6784\u662f\u53cc\u5411\u94fe\u8868\uff0c\u6240\u4ee5\u8fd9\u4e2a\u67e5\u8be2\u8fc7\u7a0b\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u65f6 O(N)\uff0c\u4e5f\u5c31\u662f\u8bf4\u968f\u7740\u961f\u5217\u91cc\u7684\u5143\u7d20\u8d8a\u591a\uff0c\u4f1a\u8d8a\u5f71\u54cd\u7a0b\u5e8f\u7684\u6027\u80fd\uff0c\u8fd9\u4e00\u70b9\u6211\u4eec\u5fc5\u987b\u4f18\u5316\u3002</p> <p>\u67e5\u8be2\u6548\u7387\u6700\u597d\u7684\u6570\u636e\u7ed3\u6784\u5c31\u662f\u300c\u54c8\u5e0c\u8868\u300d\u4e86\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u53ea\u6709 O(1)\uff0c\u56e0\u6b64\u6211\u4eec\u53ef\u4ee5\u52a0\u5165\u8fd9\u4e2a\u6570\u636e\u7ed3\u6784\u6765\u4f18\u5316\u3002</p> <p>\u54c8\u5e0c\u8868\u7684 Key \u662f\u4e3b\u673a\u7684 IP \u5730\u5740\uff0cValue \u5305\u542b\u4e3b\u673a\u5728\u53cc\u5411\u94fe\u8868\u91cc\u7684\u8282\u70b9\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7\u54c8\u5e0c\u8868\u8f7b\u677e\u627e\u5230\u8be5\u4e3b\u673a\u5728\u53cc\u5411\u94fe\u8868\u4e2d\u7684\u4f4d\u7f6e\u3002</p> <p></p> <p>\u8fd9\u6837\uff0c\u6bcf\u5f53\u6536\u5230\u5fc3\u8df3\u5305\u65f6\uff0c\u5148\u5224\u65ad\u5176\u5728\u4e0d\u5728\u54c8\u5e0c\u8868\u91cc\u3002</p> <ul> <li>\u5982\u679c\u4e0d\u5b58\u5728\u54c8\u5e0c\u8868\u91cc\uff0c\u8bf4\u660e\u662f\u65b0\u4e3b\u673a\u4e0a\u7ebf\uff0c\u5148\u5c06\u5176\u63d2\u5165\u5230\u53cc\u5411\u94fe\u8868\u7684\u5c3e\u90e8\uff0c\u7136\u540e\u5c06\u8be5\u4e3b\u673a\u7684 IP \u4f5c\u4e3a Key\uff0c\u4e3b\u673a\u5728\u53cc\u5411\u94fe\u8868\u7684\u8282\u70b9\u4f5c\u4e3a Value \u63d2\u5165\u5230\u54c8\u5e0c\u8868\u3002</li> <li>\u5982\u679c\u5b58\u5728\u54c8\u5e0c\u8868\u91cc\uff0c\u8bf4\u660e\u4e3b\u673a\u5df2\u7ecf\u4e0a\u7ebf\u8fc7\uff0c\u5148\u901a\u8fc7\u67e5\u8be2\u54c8\u5e0c\u8868\uff0c\u627e\u5230\u8be5\u4e3b\u673a\u5728\u53cc\u5411\u94fe\u8868\u91cc\u65e7\u7684\u5fc3\u8df3\u5305\u7684\u8282\u70b9\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7\u8be5\u8282\u70b9\u5c06\u5176\u4ece\u53cc\u5411\u94fe\u8868\u4e2d\u5220\u9664\uff0c\u6700\u540e\u5c06\u65b0\u7684\u5fc3\u8df3\u5305\u63d2\u5165\u5230\u53cc\u5411\u94fe\u8868\u7684\u961f\u5c3e\uff0c\u540c\u65f6\u66f4\u65b0\u54c8\u5e0c\u8868\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0a\u9762\u8fd9\u4e9b\u64cd\u4f5c\u5168\u90fd\u662f O(1)\uff0c\u4e0d\u7ba1\u96c6\u7fa4\u89c4\u6a21\u591a\u5927\uff0c\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u4e0d\u4f1a\u589e\u52a0\uff0c\u4f46\u662f\u4ee3\u4ef7\u5c31\u662f\u5185\u5b58\u5360\u7528\u4f1a\u8d8a\u591a\uff0c\u8fd9\u4e2a\u5c31\u662f\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u65b9\u5f0f\u3002</p> <p>\u6709\u4e2a\u7ec6\u8282\u7684\u95ee\u9898\uff0c\u4e0d\u77e5\u9053\u5927\u5bb6\u53d1\u73b0\u4e86\u6ca1\u6709\uff0c\u5c31\u662f\u4e3a\u4ec0\u4e48\u961f\u5217\u7684\u6570\u636e\u7ed3\u6784\u91c7\u7528\u53cc\u5411\u94fe\u8868\uff0c\u800c\u4e0d\u662f\u5355\u5411\u94fe\u8868\uff1f</p> <p>\u56e0\u4e3a\u53cc\u5411\u94fe\u8868\u6bd4\u5355\u5411\u94fe\u8868\u591a\u4e86\u4e2a pre \u7684\u6307\u9488\uff0c\u53ef\u4ee5\u901a\u8fc7\u5176\u627e\u5230\u4e0a\u4e00\u4e2a\u8282\u70b9\uff0c\u90a3\u4e48\u5728\u5220\u9664\u4e2d\u95f4\u8282\u70b9\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u5220\u9664\uff0c\u800c\u5982\u679c\u662f\u5355\u5411\u94fe\u8868\u5728\u5220\u9664\u4e2d\u95f4\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5f97\u5148\u901a\u8fc7\u904d\u5386\u627e\u5230\u9700\u88ab\u5220\u9664\u8282\u70b9\u7684\u4e0a\u4e00\u4e2a\u8282\u70b9\uff0c\u624d\u80fd\u5b8c\u6210\u5220\u9664\u64cd\u4f5c\uff0c\u8fd9\u91cc\u4e2d\u95f4\u591a\u4e86\u4e2a\u904d\u5386\u64cd\u4f5c\u3002</p> <p>\u65e2\u7136\u5f15\u5165\u54c8\u5e0c\u8868\uff0c\u90a3\u6211\u4eec\u5728\u5224\u65ad\u51fa\u6709\u4e3b\u673a\u5b95\u673a\u4e86\uff08\u68c0\u67e5\u53cc\u5411\u94fe\u8868\u961f\u5934\u7684\u4e3b\u673a\u662f\u5426\u8d85\u65f6\uff09\uff0c\u9664\u4e86\u8981\u5c06\u5176\u4ece\u53cc\u5411\u94fe\u8868\u4e2d\u5220\u9664\uff0c\u4e5f\u8981\u4ece\u54c8\u5e0c\u8868\u4e2d\u5220\u9664\u3002\u8981\u5c06\u4e3b\u673a\u4ece\u54c8\u5e0c\u8868\u5220\u9664\uff0c\u9996\u5148\u6211\u4eec\u8981\u77e5\u9053\u4e3b\u673a\u7684 IP\uff0c\u56e0\u4e3a\u8fd9\u662f\u54c8\u5e0c\u8868\u7684 Key\u3002</p> <p>\u53cc\u5411\u94fe\u8868\u5b58\u50a8\u7684\u5185\u5bb9\u5fc5\u987b\u5305\u542b\u4e3b\u673a\u7684 IP \u4fe1\u606f\uff0c\u90a3\u4e3a\u4e86\u66f4\u5feb\u67e5\u8be2\u5230\u4e3b\u673a\u7684 IP\uff0c\u53cc\u5411\u94fe\u8868\u5b58\u50a8\u7684\u5185\u5bb9\u53ef\u4ee5\u662f\u4e00\u4e2a\u952e\u503c\u5bf9\uff08Key-Value\uff09\uff0c\u5176 Key \u5c31\u662f\u4e3b\u673a\u7684 IP\uff0cValue \u5c31\u662f\u4e3b\u673a\u7684\u4fe1\u606f\u3002</p> <p></p> <p>\u8fd9\u6837\uff0c\u5728\u53d1\u73b0\u53cc\u5411\u94fe\u8868\u4e2d\u5934\u90e8\u7684\u8282\u70b9\u8d85\u65f6\u4e86\uff0c\u7531\u4e8e\u8282\u70b9\u7684\u5185\u5bb9\u662f\u952e\u503c\u5bf9\uff0c\u4e8e\u662f\u5c31\u80fd\u5feb\u901f\u5730\u4ece\u8be5\u8282\u70b9\u83b7\u53d6\u4e3b\u673a\u7684 IP\uff0c\u77e5\u9053\u4e86\u4e3b\u673a\u7684 IP \u4fe1\u606f\uff0c\u5c31\u80fd\u628a\u54c8\u5e0c\u8868\u4e2d\u8be5\u4e3b\u673a\u4fe1\u606f\u5220\u9664\u3002</p> <p>\u81f3\u6b64\uff0c\u5c31\u8bbe\u8ba1\u51fa\u4e86\u4e00\u4e2a\u9ad8\u6027\u80fd\u7684\u5b95\u673a\u5224\u65ad\u7b97\u6cd5\uff0c\u4e3b\u8981\u7528\u4e86\u6570\u636e\u7ed3\u6784\uff1a\u54c8\u5e0c\u8868 + \u53cc\u5411\u94fe\u8868\uff0c\u901a\u8fc7\u8fd9\u4e2a\u7ec4\u5408\uff0c\u67e5\u8be2 + \u5220\u9664 + \u63d2\u5165\u64cd\u4f5c\u7684\u65f6\u95f4\u590d\u6742\u5ea6\u90fd\u662f O(1)\uff0c\u4ee5\u7a7a\u95f4\u6362\u65f6\u95f4\u7684\u601d\u60f3\uff0c\u8fd9\u5c31\u662f\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\u4e4b\u7f8e\uff01</p> <p>\u719f\u6089\u7b97\u6cd5\u7684\u540c\u5b66\u5e94\u8be5\u611f\u53d7\u51fa\u6765\u4e86\uff0c\u4e0a\u9762\u8fd9\u4e2a\u7b97\u6cd5\u5c31\u662f\u7c7b LRU \u7b97\u6cd5\uff0c\u7528\u4e8e\u6dd8\u6c70\u6700\u8fd1\u6700\u4e45\u4f7f\u7528\u7684\u5143\u7d20\u7684\u573a\u666f\uff0c\u8be5\u7b97\u6cd5\u5e94\u7528\u8303\u56f4\u5f88\u5e7f\u7684\uff0c\u64cd\u4f5c\u7cfb\u7edf\u3001Redis\u3001MySQL \u90fd\u6709\u4f7f\u7528\u8be5\u7b97\u6cd5\u3002</p> <p>\u5728\u5f88\u591a\u5927\u5382\u9762\u8bd5\u7684\u65f6\u5019\uff0c\u7ecf\u5e38\u4f1a\u8003\u5bdf LRU \u7b97\u6cd5\uff0c\u751a\u81f3\u4f1a\u8981\u6c42\u624b\u5199\u51fa\u6765\uff0c\u540e\u9762\u6211\u5728\u5199\u4e00\u7bc7 LRU \u7b97\u6cd5\u5b9e\u73b0\u7684\u6587\u7ae0\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#_4","title":"\u9ad8\u5e76\u53d1\u67b6\u6784\u7684\u8bbe\u8ba1","text":"<p>\u8bbe\u8ba1\u5b8c\u9ad8\u6548\u7684\u5b95\u673a\u5224\u65ad\u7b97\u6cd5\u540e\uff0c\u6211\u4eec\u6765\u8bbe\u8ba1\u4e2a\u80fd\u5145\u5206\u5229\u7528\u670d\u52a1\u5668\u8d44\u6e90\u7684\u67b6\u6784\uff0c\u4ee5\u5e94\u5bf9\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u3002</p> <p>\u9996\u5148\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u9009\u7528\u5355\u7ebf\u7a0b\u8fd8\u662f\u591a\u7ebf\u7a0b\u6a21\u5f0f\uff1f</p> <p>\u9009\u7528\u5355\u7ebf\u7a0b\u7684\u8bdd\uff0c\u610f\u5473\u7740\u7a0b\u5e8f\u53ea\u80fd\u5229\u7528\u4e00\u4e2a CPU \u7684\u7b97\u529b\uff0c\u5982\u679c CPU \u662f\u4e00\u9897 1GHZ \u4e3b\u9891\u7684 CPU\uff0c\u610f\u5473\u7740\u4e00\u79d2\u949f\u53ea\u6709 10 \u4ebf\u4e2a\u65f6\u949f\u5468\u671f\u53ef\u4ee5\u5de5\u4f5c\uff0c\u5982\u679c\u8981\u8ba9\u5fc3\u8df3\u670d\u52a1\u7a0b\u5e8f\u6bcf\u79d2\u63a5\u6536\u5230 100 \u4e07\u5fc3\u8df3\u5305\uff0c\u90a3\u4e48\u5c31\u8981\u6c42\u5b83\u5fc5\u987b\u5728 1000 \u4e2a\u65f6\u65f6\u949f\u5468\u671f\u5185\u5904\u7406\u5b8c\u4e00\u4e2a\u5fc3\u8df3\u5305\u3002</p> <p>\u8fd9\u662f\u65e0\u6cd5\u505a\u5230\u7684\uff0c\u56e0\u4e3a\u4e00\u4e2a\u6c47\u7f16\u6307\u4ee4\u7684\u6267\u884c\u9700\u8981\u591a\u4e2a\u65f6\u949f\u5468\u671f\uff0c\u66f4\u4f55\u51b5\u9ad8\u7ea7\u8bed\u8a00\u7684\u4e00\u6761\u8bed\u53e5\u662f\u7531\u591a\u4e2a\u6c47\u7f16\u6307\u4ee4\u6784\u6210\u7684\uff0c\u800c\u4e14\u8fd9\u4e2a 1000 \u4e2a\u65f6\u949f\u5468\u671f\u8fd8\u8981\u5305\u542b\u5185\u6838\u4ece\u7f51\u5361\u4e0a\u8bfb\u53d6\u62a5\u6587\uff0c\u4ee5\u53ca\u534f\u8bae\u6808\u7684\u62a5\u6587\u5206\u6790\u3002</p> <p>\u56e0\u6b64\uff0c\u91c7\u7528\u5355\u7ebf\u7a0b\u6a21\u5f0f\u4f1a\u51fa\u73b0\u7b97\u529b\u4e0d\u8db3\u7684\u60c5\u51b5\uff0c\u610f\u5473\u7740\u5728\u767e\u4e07\u7ea7\u7684\u5fc3\u8df3\u573a\u666f\u4e0b\uff0c\u5bb9\u6613\u51fa\u73b0\u5185\u6838\u7f13\u51b2\u533a\u7684\u6570\u636e\u65e0\u6cd5\u88ab\u5373\u4f7f\u53d6\u51fa\u800c\u5bfc\u81f4\u6ea2\u51fa\u7684\u73b0\u8c61\uff0c\u7136\u540e\u5c31\u4f1a\u51fa\u73b0\u5927\u91cf\u7684\u4e22\u5305\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u9009\u62e9\u591a\u8fdb\u7a0b\u6216\u8005\u591a\u7ebf\u7a0b\u7684\u6a21\u5f0f\uff0c\u6765\u5145\u5206\u5229\u7528\u591a\u6838\u7684 CPU \u8d44\u6e90\u3002\u591a\u8fdb\u7a0b\u7684\u4f18\u52bf\u662f\u8fdb\u7a0b\u95f4\u4e92\u4e0d\u5e72\u6270\uff0c\u4f46\u662f\u5185\u5b58\u4e0d\u5171\u4eab\uff0c\u8fdb\u7a0b\u95f4\u901a\u4fe1\u6bd4\u8f83\u9ebb\u70e6\uff0c\u56e0\u6b64\u91c7\u7528\u591a\u7ebf\u7a0b\u6a21\u5f0f\u5f00\u53d1\u4f1a\u66f4\u597d\u4e00\u4e9b\uff0c\u591a\u7ebf\u7a0b\u95f4\u53ef\u4ee5\u5171\u4eab\u6570\u636e\u3002</p> <p>\u591a\u7ebf\u7a0b\u4f53\u73b0\u5728\u300c\u5206\u53d1\u7ebf\u7a0b\u662f\u591a\u7ebf\u7a0b\u548c\u5de5\u4f5c\u7ebf\u7a0b\u662f\u591a\u7ebf\u7a0b\u300d\uff0c\u51b3\u5b9a\u4e86\u591a\u7ebf\u7a0b\u5f00\u53d1\u6a21\u5f0f\u540e\uff0c\u6211\u4eec\u8fd8\u9700\u8981\u89e3\u51b3\u4e94\u4e2a\u95ee\u9898\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#_5","title":"\u7b2c\u4e00\u4e2a\u591a\u8def\u590d\u7528","text":"<p>\u6211\u4eec\u5e94\u8be5\u4f7f\u7528\u591a\u8def\u590d\u7528\u6280\u672f\u6765\u670d\u52a1\u591a\u4e2a\u5ba2\u6237\u7aef\uff0c\u800c\u4e14\u662f\u8981\u4f7f\u7528 epoll\u3002</p> <p>\u56e0\u4e3a select \u548c poll \u7684\u7f3a\u9677\u5728\u4e8e\uff0c\u5f53\u5ba2\u6237\u7aef\u8d8a\u591a\uff0c\u4e5f\u5c31\u662f Socket \u96c6\u5408\u8d8a\u5927\uff0cSocket \u96c6\u5408\u7684\u904d\u5386\u548c\u62f7\u8d1d\u4f1a\u5e26\u6765\u5f88\u5927\u7684\u5f00\u9500\uff1b</p> <p>\u800c epoll \u7684\u65b9\u5f0f\u5373\u4f7f\u76d1\u542c\u7684 Socket \u6570\u91cf\u8d8a\u591a\u7684\u65f6\u5019\uff0c\u6548\u7387\u4e0d\u4f1a\u5927\u5e45\u5ea6\u964d\u4f4e\uff0c\u80fd\u591f\u540c\u65f6\u76d1\u542c\u7684 Socket \u7684\u6570\u76ee\u4e5f\u975e\u5e38\u7684\u591a\u4e86\u3002</p> <p>\u591a\u8def\u590d\u7528\u66f4\u8be6\u7ec6\u7684\u4ecb\u7ecd\uff0c\u53ef\u4ee5\u770b\u4e4b\u524d\u8fd9\u7bc7\u6587\u7ae0\uff1a\u8fd9\u6b21\u7b54\u5e94\u6211\uff0c\u4e00\u4e3e\u62ff\u4e0b I/O \u591a\u8def\u590d\u7528\uff01</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#_6","title":"\u7b2c\u4e8c\u4e2a\u8d1f\u8f7d\u5747\u8861","text":"<p>\u5728\u6536\u5230\u5fc3\u8df3\u5305\u540e\uff0c\u6211\u4eec\u5e94\u8be5\u8981\u5c06\u5fc3\u8df3\u5305\u5747\u5300\u5206\u53d1\u5230\u4e0d\u540c\u7684\u5de5\u4f5c\u7ebf\u7a0b\u4e0a\u5904\u7406\u3002</p> <p>\u5206\u53d1\u7684\u89c4\u5219\u53ef\u4ee5\u7528\u54c8\u5e0c\u51fd\u6570\uff0c\u8fd9\u6837\u5728\u63a5\u6536\u5230\u5fc3\u8df3\u5305\u540e\uff0c\u89e3\u6790\u51fa\u4e3b\u673a\u7684 IP \u5730\u5740\uff0c\u7136\u540e\u901a\u8fc7\u54c8\u5e0c\u51fd\u6570\u5206\u53d1\u7ed9\u5de5\u4f5c\u7ebf\u7a0b\u5904\u7406\u3002</p> <p></p> <p>\u4e8e\u662f\u6bcf\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u53ea\u4f1a\u5904\u7406\u7279\u5b9a\u4e3b\u673a\u7684\u5fc3\u8df3\u5305\uff0c\u591a\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u95f4\u4e92\u4e0d\u5e72\u6270\uff0c\u4e0d\u7528\u5728\u591a\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u95f4\u52a0\u9501\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u65e0\u9501\u7f16\u7a0b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#_7","title":"\u7b2c\u4e09\u4e2a\u591a\u7ebf\u7a0b\u540c\u6b65","text":"<p>\u5206\u53d1\u7ebf\u7a0b\u548c\u5de5\u4f5c\u7ebf\u7a0b\u4e4b\u95f4\u53ef\u4ee5\u52a0\u4e2a\u6d88\u606f\u961f\u5217\uff0c\u5f62\u6210\u300c\u751f\u4ea7\u8005 - \u6d88\u8d39\u8005\u300d\u6a21\u578b\u3002</p> <p>\u5206\u53d1\u7ebf\u7a0b\u8d1f\u8d23\u5c06\u63a5\u6536\u5230\u7684\u5fc3\u8df3\u5305\u52a0\u5165\u5230\u961f\u5217\u91cc\uff0c\u5de5\u4f5c\u7ebf\u7a0b\u8d1f\u8d23\u4ece\u961f\u5217\u53d6\u51fa\u5fc3\u8df3\u5305\u505a\u8fdb\u4e00\u6b65\u7684\u5904\u7406\u3002</p> <p>\u9664\u6b64\u4e4b\u5916\uff0c\u8fd8\u9700\u8981\u505a\u5982\u4e0b\u4e24\u70b9\u3002</p> <p>\u7b2c\u4e00\u70b9\uff0c\u5de5\u4f5c\u7ebf\u7a0b\u4e00\u822c\u662f\u591a\u4e8e\u5206\u53d1\u7ebf\u7a0b\uff0c\u7ed9\u6bcf\u4e00\u4e2a\u5de5\u4f5c\u7ebf\u7a0b\u90fd\u521b\u5efa\u72ec\u7acb\u7684\u7f13\u51b2\u961f\u5217\u3002</p> <p>\u7b2c\u4e8c\u70b9\uff0c\u7f13\u51b2\u961f\u5217\u662f\u4f1a\u88ab\u5206\u53d1\u7ebf\u7a0b\u548c\u5de5\u4f5c\u7ebf\u7a0b\u540c\u65f6\u64cd\u4f5c\uff0c\u6240\u4ee5\u5728\u64cd\u4f5c\u8be5\u961f\u5217\u8981\u52a0\u9501\uff0c\u4e3a\u4e86\u907f\u514d\u7ebf\u7a0b\u83b7\u53d6\u9501\u5931\u800c\u4e3b\u52a8\u653e\u5f03 CPU\uff0c\u53ef\u4ee5\u9009\u62e9\u81ea\u65cb\u9501\uff0c\u56e0\u4e3a\u81ea\u65cb\u9501\u5728\u83b7\u53d6\u9501\u5931\u8d25\u540e\uff0cCPU \u8fd8\u5728\u6267\u884c\u8be5\u7ebf\u7a0b\uff0c\u53ea\u4e0d\u8fc7 CPU \u5728\u7a7a\u8f6c\uff0c\u6548\u7387\u6bd4\u4e92\u65a5\u9501\u9ad8\u3002</p> <p></p> <p>\u66f4\u591a\u5173\u4e8e\u9501\u7684\u8bb2\u89e3\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u300c\u4e92\u65a5\u9501\u3001\u81ea\u65cb\u9501\u3001\u8bfb\u5199\u9501\u3001\u60b2\u89c2\u9501\u3001\u4e50\u89c2\u9501\u7684\u5e94\u7528\u573a\u666f\u300d</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#cpu","title":"\u7b2c\u56db\u4e2a\u7ebf\u7a0b\u7ed1\u5b9a CPU","text":"<p>\u73b0\u4ee3 CPU \u90fd\u662f\u591a\u6838\u5fc3\u7684\uff0c\u7ebf\u7a0b\u53ef\u80fd\u5728\u4e0d\u540c CPU \u6838\u5fc3\u6765\u56de\u5207\u6362\u6267\u884c\uff0c\u8fd9\u5bf9 CPU Cache \u4e0d\u662f\u6709\u5229\u7684\uff0c\u867d\u7136 L3 Cache \u662f\u591a\u6838\u5fc3\u4e4b\u95f4\u5171\u4eab\u7684\uff0c\u4f46\u662f L1 \u548c L2 Cache \u90fd\u662f\u6bcf\u4e2a\u6838\u5fc3\u72ec\u6709\u7684\u3002</p> <p>\u5982\u679c\u4e00\u4e2a\u7ebf\u7a0b\u5728\u4e0d\u540c\u6838\u5fc3\u6765\u56de\u5207\u6362\uff0c\u5404\u4e2a\u6838\u5fc3\u7684\u7f13\u5b58\u547d\u4e2d\u7387\u5c31\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u76f8\u53cd\u5982\u679c\u7ebf\u7a0b\u90fd\u5728\u540c\u4e00\u4e2a\u6838\u5fc3\u4e0a\u6267\u884c\uff0c\u90a3\u4e48\u5176\u6570\u636e\u7684 L1 \u548c L2 Cache \u7684\u7f13\u5b58\u547d\u4e2d\u7387\u53ef\u4ee5\u5f97\u5230\u6709\u6548\u63d0\u9ad8\uff0c\u7f13\u5b58\u547d\u4e2d\u7387\u9ad8\u5c31\u610f\u5473\u7740 CPU \u53ef\u4ee5\u51cf\u5c11\u8bbf\u95ee \u5185\u5b58\u7684\u9891\u7387\u3002</p> <p>\u5f53\u6709\u591a\u4e2a\u540c\u65f6\u6267\u884c\u300c\u8ba1\u7b97\u5bc6\u96c6\u578b\u300d\u7684\u7ebf\u7a0b\uff0c\u4e3a\u4e86\u9632\u6b62\u56e0\u4e3a\u5207\u6362\u5230\u4e0d\u540c\u7684\u6838\u5fc3\uff0c\u800c\u5bfc\u81f4\u7f13\u5b58\u547d\u4e2d\u7387\u4e0b\u964d\u7684\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u7ebf\u7a0b\u7ed1\u5b9a\u5728\u67d0\u4e00\u4e2a CPU \u6838\u5fc3\u4e0a\uff0c\u8fd9\u6837\u6027\u80fd\u53ef\u4ee5\u5f97\u5230\u975e\u5e38\u53ef\u89c2\u7684\u63d0\u5347\u3002</p> <p>\u5728 Linux \u4e0a\u63d0\u4f9b\u4e86 <code>sched_setaffinity</code> \u65b9\u6cd5\uff0c\u6765\u5b9e\u73b0\u5c06\u7ebf\u7a0b\u7ed1\u5b9a\u5230\u67d0\u4e2a CPU \u6838\u5fc3\u8fd9\u4e00\u529f\u80fd\u3002</p> <p></p> <p>\u66f4\u591a\u5173\u4e8e CPU Cache \u7684\u4ecb\u7ecd\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u300c\u5982\u4f55\u5199\u51fa\u8ba9 CPU \u8dd1\u5f97\u66f4\u5feb\u7684\u4ee3\u7801\uff1f\u300d</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#_8","title":"\u7b2c\u4e94\u4e2a\u5185\u5b58\u5206\u914d\u5668","text":"<p>Linux \u9ed8\u8ba4\u7684\u5185\u5b58\u5206\u914d\u5668\u662f PtMalloc2\uff0c\u5b83\u6709\u4e00\u4e2a\u7f3a\u70b9\u5728\u7533\u8bf7\u5c0f\u5185\u5b58\u548c\u591a\u7ebf\u7a0b\u7684\u60c5\u51b5\u4e0b\uff0c\u7533\u8bf7\u5185\u5b58\u7684\u6548\u7387\u5e76\u4e0d\u9ad8\u3002</p> <p>\u540e\u6765\uff0cGoogle \u5f00\u53d1\u7684 TCMalloc \u5185\u5b58\u5206\u914d\u5668\u5c31\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5b83\u5728\u591a\u7ebf\u7a0b\u4e0b\u5206\u914d\u5c0f\u5185\u5b58\u7684\u901f\u5ea6\u8981\u5feb\u5f88\u591a\uff0c\u6240\u4ee5\u5bf9\u4e8e\u5fc3\u8df3\u670d\u52a1\u5e94\u5f53\u6539\u7528 TCMalloc \u7533\u8bf7\u5185\u5b58\u3002</p> <p>\u4e0b\u56fe\u662f TCMalloc \u4f5c\u8005\u7ed9\u51fa\u7684\u6027\u80fd\u6d4b\u8bd5\u6570\u636e\uff0c\u53ef\u4ee5\u770b\u5230\u7ebf\u7a0b\u6570\u8d8a\u591a\uff0c\u4e8c\u8005\u7684\u901f\u5ea6\u5dee\u8ddd\u8d8a\u5927\uff0c\u663e\u7136 TCMalloc \u66f4\u5177\u6709\u4f18\u52bf\u3002</p> <p></p> <p>\u6211\u6682\u65f6\u5c31\u60f3\u5230\u8fd9\u4e48\u591a\u4e86\uff0c\u8fd9\u91cc\u6bcf\u4e00\u4e2a\u70b9\u90fd\u8ddf\u300c\u8ba1\u7b97\u673a\u7ec4\u6210\u548c\u64cd\u4f5c\u7cfb\u7edf\u300d\u77e5\u8bc6\u5bc6\u5207\u76f8\u5173\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#_9","title":"\u4f20\u8f93\u5c42\u534f\u8bae\u7684\u9009\u62e9","text":"<p>\u5fc3\u8df3\u5305\u7684\u4f20\u8f93\u5c42\u534f\u8bae\u5e94\u8be5\u662f\u9009 TCP \u548c UDP \u5462\uff1f</p> <p>\u5bf9\u4e8e\u4f20\u8f93\u5c42\u534f\u8bae\u7684\u9009\u62e9\uff0c\u6211\u4eec\u8981\u770b\u5fc3\u8df3\u5305\u7684\u957f\u5ea6\u5927\u5c0f\u3002</p> <p>\u5982\u679c\u957f\u5ea6\u5c0f\u4e8e MTU\uff0c\u90a3\u4e48\u53ef\u4ee5\u9009\u62e9 UDP \u534f\u8bae\uff0c\u56e0\u4e3a UDP \u534f\u8bae\u6ca1\u90a3\u4e48\u590d\u6742\uff0c\u800c\u4e14\u5fc3\u8df3\u5305\u4e5f\u4e0d\u662f\u4e00\u5b9a\u8981\u5b8c\u5168\u53ef\u9760\u4f20\u8f93\uff0c\u5982\u679c\u4e2d\u9014\u53d1\u751f\u4e22\u5305\uff0c\u4e0b\u4e00\u6b21\u5fc3\u8df3\u5305\u80fd\u6536\u5230\u5c31\u884c\u3002</p> <p>\u5982\u679c\u957f\u5ea6\u5927\u4e8e MTU\uff0c\u5c31\u8981\u9009\u62e9 TCP \u4e86\uff0c\u56e0\u4e3a UDP \u5728\u4f20\u9001\u5927\u4e8e 1500 \u5b57\u8282\u7684\u62a5\u6587\uff0cIP \u534f\u8bae\u5c31\u4f1a\u628a\u62a5\u6587\u62c6\u5305\u540e\u518d\u53d1\u5230\u7f51\u7edc\u4e2d\uff0c\u5e76\u5728\u63a5\u6536\u65b9\u7ec4\u88c5\u56de\u539f\u6765\u7684\u62a5\u6587\uff0c\u7136\u800c\uff0cIP \u534f\u8bae\u5e76\u4e0d\u64c5\u957f\u505a\u8fd9\u4ef6\u4e8b\uff0c\u62c6\u5305\u7ec4\u5305\u7684\u6548\u7387\u5f88\u4f4e\u3002</p> <p>\u6240\u4ee5\uff0cTCP \u534f\u8bae\u5c31\u9009\u62e9\u81ea\u5df1\u505a\u62c6\u5305\u7ec4\u5305\u7684\u4e8b\u60c5\uff0c\u5f53\u5fc3\u8df3\u5305\u7684\u957f\u5ea6\u5927\u4e8e MSS \u65f6\u5c31\u4f1a\u5728 TCP \u5c42\u62c6\u5305\uff0c\u4e14\u4fdd\u8bc1 TCP \u5c42\u62c6\u5305\u7684\u62a5\u6587\u957f\u5ea6\u4e0d\u4f1a MTU\u3002</p> <p>MTU \u4e0e MSS</p> <p>\u9009\u62e9\u4e86 TCP \u534f\u8bae\u540e\uff0c\u6211\u4eec\u8fd8\u8981\u89e3\u51b3\u4e00\u4e9b\u4e8b\u60c5\uff0c\u56e0\u4e3a TCP \u534f\u8bae\u662f\u590d\u6742\u7684\u3002</p> <p>\u9996\u5148\uff0c\u8981\u8ba9\u670d\u52a1\u5668\u80fd\u652f\u6301\u66f4\u591a\u7684 TCP \u8fde\u63a5\uff0cTCP \u8fde\u63a5\u662f\u901a\u8fc7\u56db\u5143\u7ec4\u552f\u4e00\u786e\u8ba4\u7684\uff0c\u4e5f\u5c31\u662f\u300c\u6e90 IP\u3001\u76ee\u7684 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684\u7aef\u53e3\u300d\u3002</p> <p>\u90a3\u4e48\u5f53\u670d\u52a1\u5668 IP \u5730\u5740\uff08\u76ee\u7684 IP\uff09\u548c\u76d1\u542c\u7aef\u53e3\uff08\u76ee\u6807\u7aef\u53e3\uff09\u56fa\u5b9a\u65f6\uff0c\u53d8\u5316\u7684\u53ea\u6709\u6e90 IP\uff082^32\uff09\u548c\u6e90\u7aef\u53e3\uff082^16\uff09\uff0c\u56e0\u6b64\u7406\u8bba\u4e0a\u670d\u52a1\u5668\u6700\u5927\u80fd\u8fde\u63a5 <code>2^(32+16)</code> \u4e2a\u5ba2\u6237\u7aef\u3002</p> <p>\u8fd9\u53ea\u662f\u7406\u8bba\u503c\uff0c\u5b9e\u9645\u4e0a\u670d\u52a1\u5668\u7684\u8d44\u6e90\u80af\u5b9a\u8fbe\u4e0d\u5230\u90a3\u4e48\u591a\u8fde\u63a5\u3002Linux \u7cfb\u7edf\u4e00\u5207\u7686\u6587\u4ef6\uff0c\u6240\u4ee5 TCP \u8fde\u63a5\u4e5f\u662f\u6587\u4ef6\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u8981\u589e\u5927\u4e0b\u9762\u8fd9\u4e24\u4e2a\u5730\u65b9\u7684\u6700\u5927\u6587\u4ef6\u53e5\u67c4\u6570\uff1a</p> <ul> <li>\u901a\u8fc7 <code>ulimit</code> \u547d\u4ee4\u589e\u5927\u5355\u8fdb\u7a0b\u5141\u8bb8\u6700\u5927\u6587\u4ef6\u53e5\u67c4\u6570\uff1b</li> <li>\u901a\u8fc7 <code>/proc/sys/fs/file-nr</code> \u589e\u5927\u7cfb\u7edf\u5141\u8bb8\u6700\u5927\u6587\u4ef6\u53e5\u67c4\u6570\u3002</li> </ul> <p>\u53e6\u5916\uff0cTCP \u534f\u8bae\u7684\u9ed8\u8ba4\u5185\u6838\u53c2\u6570\u5e76\u4e0d\u9002\u5e94\u9ad8\u5e76\u53d1\u7684\u573a\u666f\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u5f97\u5728\u4e0b\u9762\u8fd9\u56db\u4e2a\u65b9\u5411\u901a\u8fc7\u8c03\u6574\u5185\u6838\u53c2\u6570\u6765\u4f18\u5316 TCP \u534f\u8bae\uff1a</p> <ul> <li>\u4e09\u6b21\u63e1\u624b\u8fc7\u7a0b\u9700\u8981\u4f18\u5316\uff1b</li> <li>\u56db\u6b21\u6325\u624b\u8fc7\u7a0b\u9700\u8981\u4f18\u5316\uff1a</li> <li>TCP \u7f13\u51b2\u533a\u8981\u6839\u636e\u7f51\u7edc\u5e26\u5bbd\u65f6\u5ef6\u79ef\u8bbe\u7f6e\uff1b</li> <li>\u9700\u8981\u4f18\u5316\uff1b</li> </ul> <p>\u524d\u4e09\u4e2a\u7684\u4f18\u5316\u7684\u601d\u8def\uff0c\u6211\u5728\u4e4b\u524d\u7684\u6587\u7ae0\u5199\u8fc7\uff0c\u8be6\u89c1\uff1a\u300c\u9762\u8bd5\u5b98\uff1a\u6362\u4eba\uff01\u4ed6\u8fde TCP \u8fd9\u51e0\u4e2a\u53c2\u6570\u90fd\u4e0d\u61c2\u300d</p> <p>\u8fd9\u91cc\u7b80\u5355\u8bf4\u4e00\u4e0b\u4f18\u5316\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u7684\u601d\u8def\u3002</p> <p>\u4f20\u7edf\u7684\u62e5\u585e\u63a7\u5236\u5206\u4e3a\u56db\u4e2a\u90e8\u5206\uff1a\u6162\u542f\u52a8\u3001\u62e5\u585e\u907f\u514d\u3001\u5feb\u901f\u91cd\u4f20\u3001\u5feb\u901f\u6062\u590d\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p>TCP \u62e5\u585e\u63a7\u5236</p> <p>\u5f53 TCP \u8fde\u63a5\u5efa\u7acb\u6210\u529f\u540e\uff0c\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u5c31\u4f1a\u53d1\u751f\u4f5c\u7528\uff0c\u9996\u5148\u8fdb\u5165\u6162\u542f\u52a8\u9636\u6bb5\u3002\u51b3\u5b9a\u8fde\u63a5\u6b64\u65f6\u7f51\u901f\u7684\u662f\u521d\u59cb\u62e5\u585e\u7a97\u53e3\uff0c\u9ed8\u8ba4\u503c\u662f <code>10 MSS</code>\u3002</p> <p>\u5728\u5e26\u5bbd\u65f6\u5ef6\u79ef\u8f83\u5927\u7684\u7f51\u7edc\u4e2d\uff0c\u5e94\u5f53\u8c03\u9ad8\u521d\u59cb\u62e5\u585e\u7a97\u53e3\uff0c\u6bd4\u5982 <code>20 MSS</code> \u6216 <code>30 MSS</code>\uff0cLinux \u4e0a\u53ef\u4ee5\u901a\u8fc7 <code>route ip change</code> \u547d\u4ee4\u4fee\u6539\u5b83\u3002</p> <p>\u4f20\u7edf\u7684\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u662f\u57fa\u4e8e\u4e22\u5305\u4f5c\u4e3a\u5224\u65ad\u62e5\u585e\u7684\u4f9d\u636e\u3002\u4e0d\u8fc7\u5b9e\u9645\u4e0a\uff0c\u7f51\u7edc\u521a\u51fa\u73b0\u62e5\u585e\u65f6\u5e76\u4e0d\u4f1a\u4e22\u5305\uff0c\u800c\u771f\u7684\u51fa\u73b0\u4e22\u5305\u65f6\uff0c\u62e5\u585e\u5df2\u7ecf\u975e\u5e38\u4e25\u91cd\u4e86\uff0c\u6bd4\u5982\u50cf\u7406\u7531\u5668\u91cc\u90fd\u6709\u7f13\u51b2\u961f\u5217\u5e94\u5bf9\u7a81\u53d1\u6d41\u91cf\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u4e09\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u5f53\u7f13\u51b2\u961f\u5217\u4e3a\u7a7a\u65f6\uff0c\u4f20\u8f93\u901f\u5ea6\u6700\u5feb\uff1b</li> <li>\u5f53\u7f13\u51b2\u961f\u5217\u5f00\u59cb\u6709\u62a5\u6587\u6324\u538b\uff0c\u90a3\u4e48\u7f51\u901f\u5c31\u5f00\u59cb\u53d8\u6162\u4e86\uff0c\u4e5f\u5c31\u662f\u7f51\u7edc\u5ef6\u65f6\u53d8\u9ad8\u4e86\uff1b</li> <li>\u5f53\u7f13\u51b2\u961f\u5217\u6ea2\u51fa\u65f6\uff0c\u5c31\u51fa\u73b0\u4e86\u4e22\u5305\u73b0\u8c61\u3002</li> </ul> <p>\u4f20\u7edf\u7684\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u5c31\u662f\u5728\u7b2c\u4e09\u6b65\u8fd9\u4e2a\u65f6\u95f4\u70b9\u8fdb\u5165\u62e5\u585e\u907f\u514d\u9636\u6bb5\uff0c\u663e\u7136\u5df2\u7ecf\u5f88\u665a\u4e86\u3002</p> <p>\u5176\u5b9e\u8fdb\u884c\u62e5\u585e\u63a7\u5236\u7684\u6700\u4f73\u65f6\u95f4\u70b9\uff0c\u662f\u7f13\u51b2\u961f\u5217\u521a\u51fa\u73b0\u79ef\u538b\u7684\u65f6\u523b\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e8c\u6b65\u3002</p> <p>Google \u63a8\u51fa\u7684 BBR \u7b97\u6cd5\u662f\u4ee5\u6d4b\u91cf\u5e26\u5bbd\u3001\u65f6\u5ef6\u6765\u786e\u5b9a\u62e5\u585e\u7684\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\uff0c\u80fd\u63d0\u9ad8\u7f51\u7edc\u73af\u5883\u7684\u8d28\u91cf\uff0c\u51cf\u5c11\u7f51\u7edc\u5ef6\u8fdf\u548c\u964d\u4f4e\u4e22\u5305\u7387\u3002</p> <p>Linux 4.9 \u7248\u672c\u4e4b\u540e\u90fd\u652f\u6301 BBR \u7b97\u6cd5\uff0c\u5f00\u542f BBR \u7b97\u6cd5\u7684\u65b9\u5f0f\uff1a</p> Text Only<pre><code>net.ipv4.tcp_congestion_control=bbr\n</code></pre> <p>\u8fd9\u91cc\u7684\u6bcf\u4e00\u4e2a\u77e5\u8bc6\u90fd\u6d89\u53ca\u5230\u4e86\u8ba1\u7b97\u673a\u7f51\u7edc\uff0c\u8fd9\u5c31\u662f\u8ba1\u7b97\u673a\u7f51\u7edc\u4e4b\u7f8e\uff01</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/feel_cs/#_10","title":"\u603b\u7ed3","text":"<p>\u638c\u63e1\u597d\u6570\u636e\u7ed3\u6784\u4e0e\u7b97\u6cd5\uff0c\u624d\u80fd\u8bbe\u8ba1\u51fa\u9ad8\u6548\u7684\u5b95\u673a\u5224\u65ad\u7b97\u6cd5\uff0c\u672c\u6587\u6211\u4eec\u91c7\u7528\u54c8\u5e0c\u8868 + \u53cc\u5411\u94fe\u8868\u5b9e\u73b0\u4e86\u7c7b LRU \u7b97\u6cd5\u3002</p> <p>\u638c\u63e1\u597d\u8ba1\u7b97\u7ec4\u6210 + \u64cd\u4f5c\u7cfb\u7edf\uff0c\u624d\u80fd\u8bbe\u8ba1\u51fa\u9ad8\u6027\u80fd\u7684\u67b6\u6784\uff0c\u672c\u6587\u6211\u4eec\u91c7\u7528\u591a\u7ebf\u7a0b\u6a21\u5f0f\u6765\u5145\u5206\u5229\u7528 CPU \u8d44\u6e90\uff0c\u8fd8\u9700\u8981\u8003\u8651 IO \u591a\u8def\u670d\u7528\u7684\u9009\u62e9\uff0c\u9501\u7684\u9009\u62e9\uff0c\u6d88\u606f\u961f\u5217\u7684\u5f15\u5165\uff0c\u5185\u5b58\u5206\u914d\u5668\u7684\u9009\u62e9\u7b49\u7b49\u3002</p> <p>\u638c\u63e1\u597d\u8ba1\u7b97\u673a\u7f51\u7edc\uff0c\u624d\u80fd\u9009\u62e9\u5951\u5408\u573a\u666f\u7684\u4f20\u8f93\u534f\u8bae\uff0c\u5982\u679c\u5fc3\u8df3\u5305\u957f\u5ea6\u5927\u4e8e MTU\uff0c\u90a3\u4e48\u9009\u62e9 TCP \u66f4\u6709\u5229\uff0c\u4f46\u662f TCP \u662f\u4e2a\u590d\u6742\u7684\u534f\u8bae\uff0c\u5728\u9ad8\u5e76\u53d1\u7684\u573a\u666f\u4e0b\uff0c\u9700\u8981\u5bf9 TCP \u7684\u6bcf\u4e00\u4e2a\u9636\u6bb5\u9700\u8981\u4f18\u5316\u3002\u5982\u679c\u5982\u679c\u5fc3\u8df3\u5305\u957f\u5ea6\u5c0f\u4e8e MTU\uff0c\u4e14\u4e0d\u8981\u6c42\u53ef\u9760\u4f20\u8f93\u65f6\uff0cUDP \u534f\u8bae\u662f\u66f4\u597d\u7684\u9009\u62e9\u3002</p> <p>\u600e\u4e48\u6837\uff1f</p> <p>\u662f\u4e0d\u662f\u611f\u52a8\u5230\u4e86\u8ba1\u7b97\u673a\u57fa\u7840\u4e4b\u7f8e\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/look_book/","title":"\u770b\u4e66\u7684\u4e00\u70b9\u5c0f\u5efa\u8bae","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6628\u5929\u770b\u5230\u5c0f\u5317\u5199\u4e86\u7bc7\u300c\u770b\u4e66\u7684\u4e00\u70b9\u5c0f\u5efa\u8bae\u300d\uff0c\u5199\u7684\u5f88\u4e0d\u9519\uff0c\u4eca\u5929\u6211\u4e5f\u6839\u636e\u81ea\u5df1\u7ecf\u5386\uff0c\u5206\u4eab\u4e0b\u770b\u8ba1\u7b97\u673a\u57fa\u7840\u7c7b\u4e66\u7684\u5fc3\u5f97\u3002</p> <p>\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\uff0c\u90fd\u6709\u4e9b\u8bfb\u8005\u8dd1\u6765\u8bf7\u6559\u6211\u5b66\u4e60\u7684\u5fc3\u5f97\u3002</p> <p></p> <p></p> <p>\u4ed6\u4eec\u7684\u56f0\u60d1\u53ef\u4ee5\u5f52\u7c7b\u8fd9\u51e0\u70b9\uff1a</p> <ul> <li>\u4e66\u770b\u4e0d\u61c2\uff0c\u5bb9\u6613\u653e\u5f03\uff0c\u600e\u4e48\u529e\uff1f</li> <li>\u770b\u4e66\u7684\u6548\u7387\u5f88\u4f4e\uff0c\u600e\u4e48\u529e\uff1f</li> <li>\u505a\u4e86\u5f88\u591a\u7b14\u8bb0\uff0c\u4f9d\u7136\u8fc7\u4f1a\u5c31\u5fd8\u8bb0\uff0c\u600e\u4e48\u529e\uff1f</li> </ul> <p>\u8fd9\u4e9b\u56f0\u60d1\u6211\u66fe\u7ecf\u4e5f\u7ecf\u5386\u8fc7\uff0c\u4e2d\u9014\u4e5f\u8e29\u8fc7\u5f88\u591a\u5751\uff0c\u6d6a\u8d39\u4e86\u5f88\u591a\u7684\u65f6\u95f4\uff0c\u597d\u5728\u53ca\u65f6\u53cd\u601d\uff0c\u8c03\u6574\u4e86\u770b\u4e66\u7684\u65b9\u6cd5\uff0c\u540e\u9762\u5b66\u4e60\u7684\u6548\u7387\u7acb\u7aff\u89c1\u5f71\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/look_book/#_2","title":"\u4e0d\u8981\u76f4\u63a5\u9009\u62e9\u56f0\u96be\u6a21\u5f0f","text":"<p>\u5927\u5bb6\u5e94\u8be5\u77e5\u9053\u8ba1\u7b97\u673a\u4e66\u91cc\u6709\u4e2a\u9ed1\u76ae\u7cfb\u5217\u7684\u4e66\uff0c\u9ed1\u76ae\u7cfb\u5217\u7684\u4e66\u6709\u4e00\u4e2a\u5171\u540c\u7684\u7279\u70b9\u5c31\u662f\u539a\u91cd\uff01</p> <p>\u6211\u76f8\u4fe1\u4e0d\u5c11\u5c0f\u4f19\u4f34\u5728\u60f3\u8981\u5b66\u4e60\u8ba1\u7b97\u673a\u57fa\u7840\u7c7b\u77e5\u8bc6\u7684\u65f6\u5019\uff0c\u5c31\u4e70\u4e86\u8fd9\u7c7b\u9ed1\u76ae\u4e66\uff0c\u4e66\u5230\u8d27\u540e\uff0c\u6211\u4eec\u6ee1\u6000\u4fe1\u5fc3\uff0c\u4e3e\u7740\u539a\u91cd\u7684\u9ed1\u76ae\u4e66\uff0c\u4e0b\u51b3\u5fc3\u8981\u628a\u8fd9\u4e9b\u9ed1\u76ae\u4e66\u4e00\u9875\u4e00\u9875\u5730\u653b\u8bfb\u4e0b\u6765\uff0c\u7ed3\u679c\u4e0d\u8fc7\u51e0\u5929\u5c31\u88ab\u529d\u9000\u4e86\uff0c\u7136\u540e\u5c31\u53ea\u6709\u524d\u51e0\u9875\u662f\u6709\u7ffb\u9605\u7684\u75d5\u8ff9\uff0c\u5269\u4e0b\u7684\u51e0\u767e\u9875\u90fd\u5b8c\u5168\u662f\u65b0\u7684\uff0c\u6700\u7ec8\u8fd9\u4e9b\u539a\u539a\u7684\u9ed1\u76ae\u4e66\u5c31\u6210\u4e86\u57ab\u663e\u793a\u5668\u7684\u795e\u5668\u3002</p> <p></p> <p>\u9ed1\u76ae\u7cfb\u5217\u7684\u4e66\u786e\u5b9e\u90fd\u662f\u7ecf\u5178\u4e66\uff0c\u8c46\u74e3\u8bc4\u5206\u90fd\u5f88\u9ad8\uff0c\u77e5\u8bc6\u70b9\u5f88\u5168\u9762\uff0c\u662f\u597d\u4e66\u65e0\u7591\u3002\u4f46\u662f\u8fd9\u7c7b\u4e66\u5e76\u4e0d\u9002\u5408\u65b0\u624b\u5165\u95e8\uff0c\u4f60\u60f3\u60f3\u6211\u4eec\u5b66\u4e60\u4e2d\u6587\u7684\u65f6\u5019\uff0c\u4f60\u662f\u62ff\u7740\u65b0\u534e\u5b57\u5178\u5b66\u7684\u5417\uff1f\u5f88\u663e\u7136\u4e0d\u662f\u3002</p> <p>\u9ed1\u76ae\u4e66\u5c31\u597d\u50cf\u6e38\u620f\u91cc\u300c\u56f0\u96be\u6a21\u5f0f\u300d\uff0c\u65b0\u4eba\u4e00\u4e0a\u6765\u5c31\u73a9\u8fd9\u4e2a\u6a21\u5f0f\uff0c\u6839\u672c\u5c31\u4f53\u4f1a\u4e0d\u5230\u6e38\u620f\u7684\u4e50\u8da3\u4e86\uff0c\u5378\u8f7d\u4e86\u6e38\u620f\u90a3\u8fd8\u662f\u5c0f\u4e8b\uff0c\u5982\u679c\u7559\u4e0b\u5fc3\u91cc\u9634\u5f71\uff0c\u9020\u6210\u4e0d\u53ef\u9006\u7684\u4f24\u5bb3\uff0c\u8fd9\u5c31\u975e\u5e38\u4e0d\u597d\u4e86\u3002</p> <p>\u8bf4\u767d\u4e86\uff0c\u8fd9\u4e9b\u539a\u7684\u4e0d\u884c\u7684\u8ba1\u7b97\u673a\u4e66\u4e0d\u9002\u5408\u5165\u95e8\uff0c\u6211\u4eec\u5e94\u8be5\u5148\u4ece\u300c\u7b80\u5355\u6a21\u5f0f\u300d\u6162\u6162\u8fc7\u6e21\uff0c\u8981\u5c60\u9f99\uff0c\u5f97\u5148\u4ece\u65b0\u624b\u6751\u8d77\u6b65\u3002</p> <p>\u5c31\u62ff\u6211\u4eb2\u8eab\u7ecf\u5386\u4e3e\u4f8b\u3002</p> <p>\u5f53\u521d\u5728\u5b66\u4e60\u8ba1\u7b97\u673a\u7f51\u7edc\u7684\u65f6\u5019\uff0c\u770b\u89c1\u5927\u5bb6\u90fd\u8bf4\u300a\u8ba1\u7b97\u673a\u7f51\u7edc - \u81ea\u9876\u5411\u4e0b\u300b\u548c\u300aTCP/IP \u8be6\u89e3\u300b\u8fd9\u4e24\u672c\u4e66\u597d\uff0c\u6211\u7acb\u9a6c\u4e70\u4e86\u5b66\u4e60\uff0c\u8fd9\u672c\u4e5f\u662f\u9ed1\u76ae\u7cfb\u5217\u5927\u539a\u4e66\uff0c\u5948\u4f55\u5c0f\u6797\u5f53\u65f6\u592a\u83dc\uff0c\u6839\u672c\u5c31\u780d\u4e0d\u52a8\u8fd9\u672c\u4e66\uff0c\u780d\u4e24\u4e0b\uff0c\u5200\u949d\u4e86\uff0c\u5c31\u60f3\u7761\u89c9\u3002</p> <p>\u540e\u9762\u53c8\u627e\u4e86\u4e00\u6ce2\u4e66\uff0c\u53d1\u73b0\u300a\u56fe\u89e3 TCP/IP\u300b\u3001 \u300a\u56fe\u89e3 HTTP\u300b\u3001\u300a\u7f51\u7edc\u662f\u600e\u4e48\u8fde\u63a5\u7684\u300b\u8fd9\u51e0\u672c\u4e66\u90fd\u4e0d\u539a\uff0c\u800c\u4e14\u642d\u914d\u4e86\u5f88\u591a\u56fe\uff0c\u6211\u53c8\u7acb\u9a6c\u4e70\u56de\u6765\u5b66\u4e60\u3002</p> <p>\u8fd9\u51e0\u672c\u4e66\u8bfb\u8d77\u6765\u4e0d\u4f1a\u592a\u56f0\u96be\uff0c\u4e0d\u51fa\u4e00\u4e2a\u6708\uff0c\u6211\u5c31\u628a\u8fd9\u4e09\u672c\u4e66\u770b\u5b8c\u4e86\uff0c\u7acb\u9a6c\u5bf9\u8ba1\u7b97\u673a\u7f51\u7edc\u6709\u4e86\u4e2a\u6574\u4f53\u4e14\u6e05\u6670\u7684\u8ba4\u8bc6\uff0c\u7ec8\u4e8e\u77e5\u9053\u4e86\u7f51\u7edc\u4e03\u5c42\u6a21\u578b\u662f\u4ec0\u4e48\uff0c\u4e5f\u77e5\u9053\u4e86\u4e24\u53f0\u7535\u8111\u662f\u5982\u4f55\u901a\u8fc7\u7f51\u7edc\u8fdb\u884c\u76f8\u4e92\u901a\u4fe1\u7684\uff0c\u4e5f\u77e5\u9053 HTTP\u3001DNS\u3001TCP\u3001UDP\u3001IP\u3001ICMP\u3001DHCP\u3001ARP \u8fd9\u4e9b\u5e38\u89c1\u7684\u534f\u8bae\u662f\u7528\u6765\u5e72\u561b\u7684\u4e86\uff0c\u6210\u529f\u7a81\u7834\u4e86\u65b0\u624b\u6751\u3002</p> <p>\u867d\u7136\u7a81\u7834\u4e86\u65b0\u624b\u6751\uff0c\u4f46\u662f\u5b66\u7684\u77e5\u8bc6\u8fd8\u4e0d\u591f\u6df1\u5165\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u540e\u9762\u56de\u6765\u770b\u300a\u8ba1\u7b97\u673a\u7f51\u7edc - \u81ea\u9876\u5411\u4e0b\u300b\u548c\u300aTCP/IP \u8be6\u89e3\u300b\u8fd9\u4e24\u672c\u539a\u539a\u7684\u4e66\uff0c\u4e0d\u8fc7\u8fd9\u6b21\u5c31\u4e0d\u4f1a\u90a3\u4e48\u5403\u529b\u4e86\u3002</p> <p>\u540e\u9762\u56de\u770b\u8fd9\u4e24\u672c\u4e66\u65f6\uff0c\u6211\u4e5f\u6ca1\u6709\u9009\u62e9\u4ece\u5934\u770b\u5230\u5c3e\uff0c\u56e0\u4e3a\u6709\u4e9b\u5185\u5bb9\u548c\u5728\u65b0\u624b\u6751\u770b\u7684\u4e66\u7684\u5185\u5bb9\u91cd\u53e0\u4e86\uff0c\u800c\u4e14\u7531\u4e8e\u5728\u65b0\u624b\u6751\u91cc\u77e5\u9053\u4e86\u54ea\u51e0\u4e2a\u534f\u8bae\u662f\u5e38\u89c1\u7684\uff0c\u4e8e\u662f\u5c31\u9009\u62e9\u4e86\u8fd9\u51e0\u4e2a\u534f\u8bae\u7684\u7ae0\u8282\u8fdb\u884c\u6df1\u5165\u5b66\u4e60\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u6211\u60f3\u8fdb\u4e00\u6b65\u5b66\u4e60 TCP \u534f\u8bae\u7684\u7279\u6027\uff0c\u4e8e\u662f\u5c31\u8df3\u5230\u300aTCP/IP \u8be6\u89e3\u300b\u4e66\u91cc\u8bb2 TCP \u534f\u8bae\u7684\u51e0\u4e2a\u7ae0\u8282\uff0c\u6211\u5c31\u4ece\u4e2d\u5b66\u5230\u4e86 TCP \u6d41\u91cf\u63a7\u5236\u3001\u8d85\u65f6\u91cd\u4f20\u3001\u62e5\u585e\u63a7\u5236\u7b49\u7b49\u3002</li> <li>\u6211\u60f3\u8fdb\u4e00\u6b65\u5b66\u4e60 IP \u534f\u8bae\uff0c\u4e8e\u662f\u5c31\u8df3\u5230\u300a\u8ba1\u7b97\u673a\u7f51\u7edc - \u81ea\u9876\u5411\u4e0b\u300b\u4e66\u91cc\u8bb2 IP \u534f\u8bae\u7684\u7ae0\u8282\uff0c\u6211\u5c31\u4ece\u4e2d\u5b66\u5230\u4e86 IP \u534f\u8bae\u66f4\u591a\u7684\u7ec6\u8282\uff0cIP \u5305\u5934\u7684\u5404\u4e2a\u5b57\u6bb5\u7528\u9014\u3001\u5bfb\u5740\u3001\u8def\u7531\u8f6c\u53d1\u7684\u539f\u7406\u7b49\u7b49\u3002</li> </ul> <p>\u770b\u4e86\u9ed1\u76ae\u4e66\uff0c\u6211\u4e5f\u6df1\u523b\u611f\u53d7\u5230\u9ed1\u76ae\u7cfb\u5217\u7684\u4e66\u786e\u5b9e\u7ecf\u5178\uff0c\u77e5\u8bc6\u4f53\u7cfb\u5f88\u5168\u9762\uff0c\u4e5f\u5f88\u7ec6\u8282\u3002</p> <p>\u4f46\u662f\u8fd9\u79cd\u5927\u4e14\u5168\u7684\u4e66\u5e76\u4e0d\u610f\u5473\u7740\u9002\u5408\u5165\u95e8\uff0c\u65b0\u624b\u5f88\u5bb9\u6613\u5c31\u5728\u5404\u79cd\u7ec6\u8282\u4e2d\u8ff7\u5931\uff0c\u800c\u4e14\u4e66\u4e0a\u6709\u4e9b\u4e0d\u5e38\u7528\u7684\u534f\u8bae\u6211\u4eec\u662f\u53ef\u4ee5\u9009\u62e9\u4e0d\u770b\u7684\uff0c\u5982\u679c\u4e0d\u77e5\u9053\u91cd\u70b9\u5f88\u5bb9\u6613\u5c31\u628a\u65f6\u95f4\u6d6a\u8d39\u5728\u8fd9\u4e9b\u5730\u65b9\uff0c\u5f97\u4e0d\u507f\u5931\u3002</p> <p>\u6211\u662f\u5728\u65b0\u624b\u6751\u5b66\u4e60\u91cc\u6293\u5230\u5b66\u4e60\u8ba1\u7b97\u673a\u7f51\u7edc\u7684\u65b9\u5411\uff0c\u4e5f\u5c31\u662f\u628a\u300c\u952e\u5165\u7f51\u5740\uff0c\u5230\u7f51\u9875\u663e\u793a\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f\u300d\u8fd9\u4e2a\u95ee\u9898\u6240\u6d89\u53ca\u5230\u7684\u534f\u8bae\u90fd\u8981\u638c\u63e1\uff0c\u6bd4\u5982 HTTP\u3001DNS\u3001TCP\u3001UDP\u3001IP\u3001ARP\u3001MAC \u7b49\u7b49\uff0c\u7136\u540e\u518d\u67e5\u9ed1\u76ae\u4e66\u5bf9\u5e94\u7684\u7ae0\u8282\u6765\u6df1\u5165\u5b66\u4e60\u5bf9\u5e94\u7684\u534f\u8bae\u3002</p> <p>\u4e0d\u4ec5\u4ec5\u662f\u8ba1\u7b97\u673a\u7f51\u7edc\uff0c\u6211\u5728\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\u3001\u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406\u3001\u7f51\u7edc\u7f16\u7a0b\u7b49\u7b49\u4e5f\u662f\u7528\u8fd9\u5957\u65b9\u6cd5\uff0c\u90fd\u662f\u5148\u770b\u65b0\u624b\u6751\u7684\u4e66\uff0c\u5f97\u77e5\u4e86\u54ea\u4e9b\u662f\u91cd\u70b9\u77e5\u8bc6\u540e\uff0c\u518d\u8df3\u5230\u9ed1\u76ae\u4e66\u91cc\u5bf9\u5e94\u8be5\u77e5\u8bc6\u7684\u7ae0\u8282\u8fdb\u884c\u6df1\u5165\u5b66\u4e60\u3002</p> <p>\u5f53\u521d\u5728\u5b66\u7f51\u7edc\u7f16\u7a0b\u7684\u65f6\u5019\uff0c\u770b\u89c1\u7f51\u4e0a\u7684\u4eba\u90fd\u8bf4 UNP\uff08Unix \u7f51\u7edc\u7f16\u7a0b\uff09\u3001APUE\uff08Unix \u9ad8\u7ea7\u73af\u5883\u7f16\u7a0b\uff09\u8fd9\u4e24\u672c\u4e66\u662f\u7f51\u7edc\u7f16\u7a0b\u5723\u7ecf\u7684\u4e66\uff0c\u90a3\u4e48\u597d\u5b66\u7684\u5c0f\u6797\uff0c\u90a3\u80af\u5b9a\u6beb\u65e0\u72b9\u8c6b\u4e70\u4e86\u3002</p> <p>\u4e66\u5230\u8d27\u540e\uff0c\u6211\u77ac\u95f4\u5c31\u61f5\u903c\u4e86\uff0c\u8fd9\u4e24\u672c\u4e66\u662f\u6211\u4e70\u8fc7\u6700\u539a\u7684\u4e66\uff0c\u8fd9\u5c3c\u739b\u600e\u4e48\u5b66\uff1f</p> <p>\u8ddf\u7740\u4e66\u672c\u7684\u8282\u594f\uff0c\u5b66\u4e86\u4e00\u6bb5\u7684\u65f6\u95f4\uff0c\u662f\u61c2\u4e86\u4e9b Linux \u7f51\u7edc\u548c\u7cfb\u7edf API \u7684\u7528\u6cd5\uff0c\u6478\u7d22\u6765\u6478\u7d22\u53bb\u90fd\u662f\u5404\u4e2a API \u7684\u7ec6\u8282\uff0c\u59cb\u7ec8\u4e0d\u77e5\u9053\u9ad8\u5e76\u53d1\u7f51\u7edc\u6846\u67b6\u662f\u5982\u4f55\u5b9e\u73b0\u7684\u3002</p> <p></p> <p>\u540e\u9762\u6211\u53c8\u91cd\u65b0\u627e\u4e86\u4e00\u6ce2\u5173\u4e8e\u7f51\u7edc\u7f16\u7a0b\u7684\u4e66\uff0c\u627e\u5230\u4e86\u8fd9\u4e24\u672c\uff1a\u300aTCP/IP \u7f51\u7edc\u7f16\u7a0b\u300b\u548c\u300aLinux \u9ad8\u6027\u80fd\u670d\u52a1\u5668\u7f16\u7a0b\u300b\u3002</p> <ul> <li>\u300aTCP/IP \u7f51\u7edc\u7f16\u7a0b\u300b\u7edd\u5bf9\u662f\u65b0\u624b\u6751\u7ea7\u522b\u7684\u4e66\uff0c\u4e66\u91cc\u7684\u5185\u5bb9\u4e0d\u4f1a\u6709\u8fc7\u591a\u7684\u672f\u8bed\uff0c\u4f5c\u8005\u90fd\u7528\u5927\u767d\u8bdd\u6765\u8868\u8fbe\uff0c\u914d\u56fe\u4e5f\u5f88\u6e05\u6670\uff0c\u4e5f\u6709\u4ecb\u7ecd\u6211\u60f3\u77e5\u9053\u7684\u7f51\u7edc\u6846\u67b6\uff0c\u867d\u7136\u662f\u6bd4\u8f83\u57fa\u7840\u7684\u591a\u8fdb\u7a0b\u670d\u52a1\u7aef\u6a21\u578b\u3001\u591a\u7ebf\u7a0b\u670d\u52a1\u7aef\u6a21\u578b\u3001\u5f02\u6b65 IO \u6a21\u578b\u3002\u800c\u4e14\u6700\u540e\u4e00\u7ae0\u5b9e\u73b0\u4e86\u7b80\u5355\u7684 HTTP \u670d\u52a1\u7aef\uff0c\u8ba9\u6211\u77e5\u9053\u4e86\u4ece\u4ee3\u7801\u89d2\u5ea6\u662f\u600e\u4e48\u89e3\u6790 HTTP \u62a5\u6587\u7684\uff0c\u4ee5\u53ca\u72b6\u6001\u673a\u662f\u5982\u4f55\u5b9e\u73b0\u548c\u8fd0\u8f6c\u7684\u3002</li> <li>\u300aLinux \u9ad8\u6027\u80fd\u670d\u52a1\u5668\u7f16\u7a0b\u300b\u8fd9\u672c\u4e66\u4e3b\u8981\u662f\u7f51\u7edc\u6846\u67b6\u4e3a\u4e3b\uff0c\u524d\u51e0\u7ae0\u5173\u4e8e\u7f51\u7edc\u57fa\u7840\u77e5\u8bc6\u5bf9\u4e8e\u638c\u63e1\u4e86\u8ba1\u7b97\u673a\u7f51\u7edc\u77e5\u8bc6\u7684\u540c\u5b66\u53ef\u4ee5\u76f4\u63a5\u8df3\u8fc7\u7684\uff0c\u4f60\u770b\uff0c\u5f88\u591a\u77e5\u8bc6\u662f\u60f3\u901a\u7684\uff0c\u5f53\u6211\u4eec\u77e5\u9053\u638c\u63e1\u4e86\u8fd9\u5757\u77e5\u8bc6\u540e\uff0c\u5728\u5b66\u4e60\u65b0\u4e00\u672c\u4e66\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u8df3\u8fc7\u91cd\u53e0\u7684\u5185\u5bb9\u3002\u5728\u8fd9\u672c\u4e66\u6211\u5b66\u5230\u4e86\uff0cReactor\u3001Proactor\u3001\u4fe1\u53f7\u3001\u5b9a\u65f6\u5668\u3001\u591a\u8fdb\u7a0b\u7f16\u7a0b\u3001\u591a\u7ebf\u7a0b\u7f16\u7a0b\u3001\u8fdb\u7a0b\u6c60\u548c\u7ebf\u7a0b\u6c60\u7b49\u3002</li> </ul> <p>\u8fd9\u4e24\u672c\u4e66\u8ba9\u6211\u5927\u6982\u77e5\u9053\u4e86\u5982\u679c\u4e00\u4e2a\u670d\u52a1\u7aef\u8981\u670d\u52a1\u591a\u4e2a\u5ba2\u6237\u7aef\u65f6\uff0c\u4e0d\u662f\u5c31\u7b80\u5355\u5199\u4e2a socket \u7f16\u7a0b\u5c31\u5b8c\u4e8b\uff0c\u800c\u662f\u8fd8\u8981\u7ed3\u5408 IO \u591a\u8def\u590d\u7528 + \u591a\u7ebf\u7a0b\u7684\u601d\u60f3\uff0c\u4e5f\u5c31\u662f Reactor \u7684\u8bbe\u8ba1\u7406\u5ff5\uff0c\u77e5\u9053\u4e86\u8fd9\u4e9b\u4e8b\u60c5\u540e\uff0c\u540e\u9762\u6211\u5728\u770b\u5f88\u591a\u5f00\u6e90\u6846\u67b6\u7684\u7f51\u7edc\u6a21\u578b\u65f6\u5019\uff0c\u53d1\u73b0\u5927\u591a\u6570\u57fa\u4e8e Reactor \u7684\u601d\u60f3\u6765\u5b9e\u73b0\u7684\u3002</p> <p>\u6709\u4e86\u7f51\u7edc\u7f16\u7a0b\u603b\u4f53\u7684\u89c6\u89d2\u540e\uff0c\u5728\u9700\u8981\u6df1\u5165\u7406\u89e3 socket api \u4e2d\u5404\u79cd\u5c5e\u6027\u8bbe\u7f6e\uff08\u8d85\u65f6\u3001\u975e\u963b\u585e IO\u3001\u963b\u585e IO \u7b49\uff09\u548c\u5f02\u5e38\u5904\u7406\u5c31\u8981\u56de\u5f52 APUE \u8fd9\u672c\u4e66\u3002</p> <p>\u5230\u8fd9\u91cc\u6211\u624d\u77e5\u9053 UNP \u548c APUE \u4e3a\u4ec0\u4e48\u4f1a\u88ab\u79f0\u4e3a\u7f51\u7edc\u7f16\u7a0b\u5723\u7ecf\u7ea7\u522b\u7684\u4e66\uff0c\u539f\u56e0\u662f\u4e66\u91cc\u5404\u79cd\u7ec6\u8282\u548c\u5f02\u5e38\u90fd\u5199\u7684\u5f88\u5168\uff0c\u4e5f\u5f88\u7ec6\u81f4\uff0c\u53ef\u4ee5\u5e94\u5bf9\u5de5\u4f5c\u4e2d\u5f88\u591a\u95ee\u9898\u3002</p> <p>\u4f46\u662f\u4e8b\u5b9e\u8bc1\u660e\uff0c\u5b83\u5e76\u4e0d\u662f\u4e2a\u5165\u95e8\u7ea7\u7684\u4e66\uff0c\u6240\u4ee5 UNP \u548c APUE \u7684\u7528\u9014\u6bd4\u8f83\u50cf\u5b57\u5178\uff0c\u5728\u9700\u8981\u7684\u65f6\u5019\u53bb\u67e5\u9605\u5c31\u597d\u3002</p> <p>\u5b66\u4e60\u7b97\u673a\u7ec4\u6210\u4e5f\u4e00\u6837\uff0c\u6211\u5148\u770b\u300a\u7a0b\u5e8f\u662f\u600e\u4e48\u6837\u8dd1\u8d77\u6765\u7684\u300b\u8fd9\u672c\u4e66\uff0c\u77e5\u9053\u4e86\u7a0b\u5e8f\u8dd1\u8d77\u6765\u7684\u5927\u6982\u8fc7\u7a0b\u4ee5\u53ca\u6d89\u53ca\u5230\u7684\u77e5\u8bc6\u70b9\uff0c\u7136\u540e\u5e26\u7740\u8fd9\u4e2a\u95ee\u9898\uff0c\u4ece\u300a\u8ba1\u7b97\u673a\u7ec4\u6210\u4e0e\u8bbe\u8ba1\u300b\u8fd9\u672c\u9ed1\u76ae\u4e66\u627e\u5230\u6bcf\u4e00\u90e8\u5206\u7684\u7ec6\u8282\uff0c\u901a\u8fc7\u8fdb\u4e00\u6b65\u5b66\u4e60\uff0c\u77e5\u9053\u4e86\u7a0b\u5e8f\u7f16\u8bd1\u8fc7\u7a0b\uff0c\u77e5\u9053\u4e86 Intel x86 \u7684\u6307\u4ee4\u7ed3\u6784\uff0c\u77e5\u9053\u4e86\u8ba1\u7b97\u673a\u662f\u5982\u4f55\u5b58\u50a8\u5e76\u8ba1\u7b97\u6d6e\u70b9\u6570\u7684\uff0c\u77e5\u9053\u4e86 CPU \u6267\u884c\u7a0b\u5e8f\u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u77e5\u9053\u4e86\u8ba1\u7b97\u673a\u5b58\u50a8\u7ed3\u6784\u91d1\u5b57\u5854\u6a21\u578b\u7b49\u7b49\u3002</p> <p>\u6240\u4ee5\uff0c\u5927\u5bb6\u5728\u5b66\u4e60\u7684\u65f6\u5019\uff0c\u5e94\u8be5\u907f\u514d\u76f4\u63a5\u5b66\u5927\u800c\u5168\u7684\u4e66\uff0c\u6211\u4eec\u8981\u5148\u4ece\u5165\u95e8\u7ea7\u522b\u7684\u4e66\u770b\u8d77\uff0c\u6293\u4f4f\u4e86\u4e3b\u7ebf\u91cd\u70b9\u77e5\u8bc6\u540e\uff0c\u518d\u901a\u8fc7\u67e5\u9605\u8fd9\u7c7b\u5927\u800c\u5168\u7684\u4e66\u6765\u8fdb\u884c\u6df1\u5165\u5b66\u4e60\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/look_book/#_3","title":"\u4e0d\u8981\u53ea\u5c40\u9650\u5b66\u4e00\u672c\u4e66","text":"<p>\u6211\u5728\u5b66\u4e60\u7684\u65f6\u5019\uff0c\u6709\u4e2a\u4e60\u60ef\uff0c\u559c\u6b22\u627e\u540c\u7c7b\u578b\u7684\u4e66\u4e00\u8d77\u5b66\uff0c\u5c31\u4e0d\u4f1a\u8bf4\u5b66\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u5019\uff0c\u5c31\u53ea\u770b\u4e00\u672c\u7406\u8bba\u4e66\uff0c\u800c\u662f\u7ed3\u5408 Linux \u7cfb\u7edf\u7f16\u7a0b\u548c\u5185\u6838\u5206\u6790\u7684\u4e66\u4e00\u8d77\u770b\uff0c\u4e00\u5c42\u5c42\u7684\u6df1\u5165\u4e00\u4e2a\u77e5\u8bc6\u70b9\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u5728\u5b66\u4e60\u64cd\u4f5c\u7cfb\u7edf\u7684\u65f6\u5019\uff0c\u5728\u300a\u73b0\u4ee3\u64cd\u4f5c\u7cfb\u7edf\u300b\u5b66\u4e86\u300c\u8fdb\u7a0b\u4e0e\u7ebf\u7a0b\u300d\u7684\u5185\u5bb9\uff0c\u800c\u8fd9\u672c\u4e66\u4ecb\u7ecd\u7684\u5185\u5bb9\u6bd4\u8f83\u6982\u5ff5\u6027\u7684\uff0c\u77e5\u8bc6\u70b9\u4e5f\u6bd4\u8f83\u7b3c\u7edf\uff0c\u4e0d\u591f\u5177\u4f53\u3002</p> <p>\u7136\u540e\u6211\u5c31\u4f1a\u53bb\u5b66\u300aUnix \u9ad8\u7ea7\u73af\u5883\u7f16\u7a0b\u300b\u7b2c 7 \u7ae0\u300c\u8fdb\u7a0b\u73af\u5883\u300d\u3001\u7b2c 8 \u7ae0\u300c\u8fdb\u7a0b\u63a7\u5236\u300d\u3001\u7b2c 11 \u7ae0\u300c\u7ebf\u7a0b\u300d\u3001\u7b2c 12 \u7ae0\u300c\u7ebf\u7a0b\u63a7\u5236\u300d\u3001\u7b2c 15 \u7ae0\u300c\u8fdb\u7a0b\u95f4\u901a\u4fe1\u300d\uff0c\u8fd9\u4e00\u7cfb\u5217\u7ae0\u8282\u770b\u5b8c\u540e\uff0c\u5c31\u77e5\u9053\u4e86 Linux \u662f\u5982\u679c\u901a\u8fc7\u521b\u5efa\u8fdb\u7a0b\u548c\u7ebf\u7a0b\uff0c\u4e0d\u53ea\u5c40\u9650\u4e8e\u7406\u8bba\u4e86\uff0c\u8fd8\u5b66\u4f1a\u4e86\u5e94\u7528\u3002</p> <p>\u5f53\u7136\u8fd9\u8fd8\u4e0d\u591f\uff0c\u6211\u8fd8\u4f1a\u53bb\u5b66\u300a\u6df1\u5165 Linux \u5185\u6838\u67b6\u6784\u300b\u7b2c 2 \u7ae0\u5173\u4e8e\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684 Linux \u6e90\u7801\u5206\u6790\uff0c\u53d1\u73b0 Linux \u4e2d\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u5b9e\u9645\u4e0a\u90fd\u662f\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53 <code>task_struct</code> \u6765\u8868\u793a\u7684\u3002\u8ba9\u6211\u5f88\u60ca\u53f9\u7684\u662f\uff0cLinux \u64cd\u4f5c\u7cfb\u7edf\u5bf9\u4e8e\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u521b\u5efa\uff0c\u90fd\u662f\u8c03\u7528 <code>do_fork</code> \u51fd\u6570\u5b9e\u73b0\u7684\u3002</p> <p></p> <p>\u53ea\u4e0d\u8fc7\u4f20\u9012\u7684\u53c2\u6570\u4e0d\u540c\uff0c\u901a\u8fc7\u53c2\u6570\u7684\u4e0d\u540c\u6765\u63a7\u5236\u662f\u590d\u5236\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\uff08\u5185\u5b58\u3001\u6587\u4ef6\u63cf\u8ff0\u3001\u4fe1\u53f7\u91cf\u7b49\uff09\uff0c\u8fd8\u662f\u5f15\u7528\u7236\u8fdb\u7a0b\u7684\u8d44\u6e90\uff0c\u8fd9\u6837\u4f1a\u66f4\u52a0\u6df1\u523b\u77e5\u9053\u8fdb\u7a0b\u548c\u7ebf\u7a0b\u7684\u533a\u522b\u3002</p> <p>\u518d\u6bd4\u5982\uff0c\u6211\u5728\u5b66\u4e60\u8ba1\u7b97\u673a\u7f51\u7edc\u7684\u65f6\u5019\uff0c\u5728\u300a\u56fe\u89e3 TCP/IP\u300b\u5b66\u5230\u4e86\u7b2c\u516d\u7ae0\u5173\u4e8e TCP \u8d85\u65f6\u91cd\u4f20\u3001\u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236\u7b49\u5185\u5bb9\uff0c\u8fd9\u672c\u4e66\u8bb2\u7684\u6bd4\u8f83\u6d45\u3002</p> <p>\u4e3a\u4e86\u66f4\u6df1\u5165\u7406\u89e3 TCP\uff0c\u6211\u5c31\u4f1a\u53bb\u770b\u300aTCP/IP \u8be6\u89e3\u300b\u7b2c 17 \u5230 24 \u7ae0\uff0c\u8fd9\u51e0\u7ae0\u90fd\u662f\u8be6\u7ec6\u4ecb\u7ecd\u4e86 TCP\uff0c\u5728\u8fd9\u91cc\u4f1a\u5b66\u5230\u66f4\u5168\u9762\u7684 TCP\uff0c\u6bd4\u5982 \u540c\u65f6\u6253\u5f00\u6216\u5173\u95ed\u3001negle \u7b97\u6cd5\u3001\u5f80\u8fd4\u65f6\u95f4 RTT \u7684\u8ba1\u7b97\u3001\u8fd8\u6709\u62e5\u585e\u63a7\u5236\u3001\u5feb\u901f\u91cd\u4f20\u3001\u5feb\u901f\u6062\u590d\u3001\u6162\u542f\u52a8\u8fd9\u4e9b\u8fc7\u7a0b\u4e2d\u7684\u62e5\u585e\u7a97\u53e3\u662f\u600e\u4e48\u53d8\u5316\u7684\u7b49\u7b49\u3002</p> <p>\u4f46\u662f\u6211\u5728\u5b66\u300aTCP/IP \u8be6\u89e3\u300b\u9047\u5230\u4e86\u70b9\u56f0\u96be\uff0c\u56e0\u4e3a\u4e66\u91cc\u7684\u6848\u4f8b\u6709\u4e9b\u5730\u65b9\u770b\u7684\u4e0d\u6e05\u6670\uff0c\u4e5f\u4e0d\u5bb9\u6613\u61c2\uff0c\u7279\u522b\u662f\u90a3\u4e9b TCP \u6293\u5305\u56fe\uff0c\u770b\u5230\u778e\u773c\u3002</p> <p>\u540e\u9762\u6211\u627e\u5230\u4e86\u672c\u795e\u4e66\uff1a\u300aTCP/IP Guide\u300b\uff0c\u5f88\u53ef\u60dc\u53ea\u6709\u82f1\u6587\u7684\uff0c\u6211\u53ea\u770b\u4e86\u8fd9\u672c\u4e66\u8bb2\u6ed1\u52a8\u7a97\u53e3\u548c\u6d41\u91cf\u63a7\u5236\u7684\u7ae0\u8282\uff0c\u56e0\u4e3a\u8fd9\u672c\u4e66\u7684\u7cbe\u534e\u5c31\u662f\u8fd9\u4e24\u4e2a\uff0c\u5176\u4ed6\u7684\u4e00\u822c\u822c\uff0c\u8fd9\u4e24\u4e2a\u7ae0\u8282\u7684\u914d\u56fe\u7279\u522b\u591a\uff0c\u4e5f\u5f88\u6e05\u6670\u3002</p> <p></p> <p>\u6211\u5c31\u5728\u8fd9\u77e5\u9053\u4e86\u53d1\u9001\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\u7684\u5de5\u4f5c\u8fc7\u7a0b\uff0c\u4e5f\u77e5\u9053\u4e86\u6ed1\u52a8\u7a97\u53e3\u5bf9\u6d41\u91cf\u7684\u5f71\u54cd\uff0c\u4e5f\u77e5\u9053\u4e86\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u7d27\u5f20\u7684\u65f6\u5019\uff0c\u4e5f\u4f1a\u5f71\u54cd\u6ed1\u52a8\u7a97\u53e3\uff0c\u4ee5\u53ca\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u75c7\u7b49\u7b49\u3002</p> <p>\u6240\u4ee5\u5728\u5b66\u4e60\u4e00\u4e2a\u77e5\u8bc6\u7684\u65f6\u5019\uff0c\u5927\u5bb6\u4e0d\u4e00\u5b9a\u8981\u628a\u4e00\u672c\u4e66\u4ece\u5934\u770b\u5230\u5c3e\u540e\uff0c\u624d\u53bb\u5b66\u53e6\u5916\u4e00\u672c\u4e66\u3002</p> <p>\u6700\u597d\u7684\u65b9\u5f0f\u662f\u5728\u4e00\u672c\u4e66\u770b\u5b8c\u67d0\u4e2a\u7ae0\u8282\u7684\u77e5\u8bc6\u70b9\u540e\uff0c\u9a6c\u4e0a\u53bb\u5b66\u53e6\u5916\u4e00\u672c\u76f8\u5bf9\u6bd4\u8f83\u6df1\u5165\u7684\u4e66\u7684\u5bf9\u5e94\u7ae0\u8282\u7684\u5185\u5bb9\uff0c\u8fd9\u6837\u4e00\u5c42\u4e00\u5c42\u7684\u6df1\u5165\u4e0b\u53bb\uff0c\u4f60\u5bf9\u8fd9\u4e2a\u77e5\u8bc6\u70b9\u7684\u638c\u63e1\u5c31\u4f1a\u5f88\u6df1\u523b\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/look_book/#_4","title":"\u4e0d\u8981\u53ea\u770b\u4e0d\u52a8\u624b","text":"<p>\u8ba1\u7b97\u673a\u7c7b\u7684\u77e5\u8bc6\u90fd\u6bd4\u8f83\u5e9e\u5927\uff0c\u5355\u7eaf\u53ea\u770b\u5f88\u5bb9\u6613\u5c31\u5fd8\u8bb0\u7684\u4e86\uff0c\u5f53\u7136\u5373\u4f7f\u505a\u4e86\u7b14\u8bb0\u4e5f\u4f1a\u5fd8\u8bb0\u3002</p> <p>\u5c31\u50cf\u5c0f\u6797\u5199\u4e86\u5f88\u591a\u6587\u7ae0\uff0c\u6bcf\u7bc7\u6587\u7ae0\u7684\u5185\u5bb9\u6211\u4e5f\u4e0d\u4e00\u5b9a\u90fd\u8bb0\u5f97\u4f4f\uff0c\u4f46\u662f\u5f53\u6211\u56de\u770b\u6587\u7ae0\u540e\uff0c\u77e5\u8bc6\u70b9\u5f88\u5feb\u4f1a\u88ab\u5524\u9192\u8d77\u6765\u3002</p> <p>\u6240\u4ee5\u8bb0\u7b14\u8bb0\u7684\u597d\u5904\u5728\u4e8e\u540e\u9762\u590d\u4e60\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u5f88\u5feb\u5c31\u80fd\u56de\u60f3\u8d77\u6765\u3002</p> <p>\u8bb0\u7b14\u8bb0\u7684\u65b9\u5f0f\u6709\u5f88\u591a\u79cd\uff0c\u624b\u5199\u5728\u7b14\u8bb0\u672c\u3001\u5728\u4e66\u4e0a\u6807\u6ce8\u3001\u5728 world \u6587\u6863\u8bb0\u5f55\u7b49\u7b49\uff0c\u4f46\u8fd9\u4e9b\u6211\u89c9\u5f97\u90fd\u4e0d\u662f\u597d\u7684\u65b9\u5f0f\u3002</p> <p>\u6211\u89c9\u5f97\u6bd4\u8f83\u597d\u7684\u65b9\u5f0f\u662f\u601d\u7ef4\u5bfc\u56fe\uff0c\u628a\u601d\u7ef4\u5bfc\u56fe\u5f53\u4f5c\u4e00\u8bfe\u81ea\u5df1\u7684\u77e5\u8bc6\u6811\uff0c\u6bcf\u6df1\u5165\u5b66\u4e00\u4e2a\u77e5\u8bc6\u70b9\u7684\u65f6\u5019\uff0c\u5c31\u5f00\u4e00\u4e2a\u5206\u652f\u53bb\u8bb0\u5f55\uff0c\u8bb0\u5f55\u7684\u5185\u5bb9\u6700\u597d\u662f\u7528\u81ea\u5df1\u7684\u8bdd\u6765\u63cf\u8ff0\uff0c\u800c\u4e0d\u662f\u590d\u5236\u4e66\u4e0a\u7684\u5185\u5bb9\uff0c\u8fd9\u6837\u53ea\u662f\u5355\u7eaf\u7684 copy\uff0c\u6700\u597d\u7ecf\u8fc7\u81ea\u5df1\u5927\u8111\u7684\u601d\u8003\uff0c\u7528\u81ea\u5df1\u7684\u8bdd\u505a\u4e2a\u5c0f\u603b\u7ed3\uff0c\u8fd9\u6837\u7684\u77e5\u8bc6\u70b9\u4e0d\u5bb9\u6613\u5fd8\u3002</p> <p>\u8fd8\u6709\u5f88\u591a\u77e5\u8bc6\u5176\u5b9e\u53ef\u4ee5\u7ed3\u5408\u751f\u6d3b\u4e2d\u7684\u573a\u666f\u6765\u8bb0\u5fc6\uff0c\u8fd9\u6837\u60f3\u5fd8\u8bb0\u90fd\u96be\uff0c\u6bd4\u5982\u963b\u585e IO\u3001\u975e\u963b\u585e IO\u3001\u540c\u6b65 IO \u548c\u5f02\u6b65 IO\uff0c\u6211\u4e4b\u524d\u6587\u7ae0\u7528\u53bb\u996d\u5802\u6253\u83dc\u7684\u573a\u666f\u6765\u4ecb\u7ecd\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\u3002</p> <p></p> <p>\u518d\u6bd4\u5982\u4ecb\u7ecd\u5404\u79cd\u8fdb\u7a0b\u8c03\u5ea6\u7b97\u6cd5\uff0c\u6211\u4e4b\u524d\u6587\u7ae0\u7528\u94f6\u884c\u4e1a\u52a1\u529e\u7406\u7684\u573a\u666f\u6765\u4ecb\u7ecd\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%AD%A6%E4%B9%A0/look_book/#_5","title":"\u603b\u7ed3","text":"<p>\u6700\u540e\u505a\u4e2a\u603b\u7ed3\uff0c\u56de\u7b54\u5f00\u5934\u7684\u95ee\u9898\u3002</p> <p>\u4e66\u770b\u4e0d\u61c2\uff0c\u5bb9\u6613\u653e\u5f03\uff0c\u600e\u4e48\u529e\uff1f</p> <p>\u4e0d\u8981\u4e00\u5f00\u59cb\u9009\u62e9\u56f0\u96be\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u4e0d\u8981\u4e00\u5f00\u59cb\u9009\u62e9\u5927\u800c\u5168\u7684\u4e66\uff0c\u8fd9\u7c7b\u4e66\u4e00\u822c\u4e0d\u9002\u5408\u5165\u95e8\u5b66\u4e60\u3002</p> <p>\u6211\u4eec\u5148\u8981\u627e\u65b0\u624b\u6751\u7ea7\u522b\u7684\u4e66\u6765\u5165\u95e8\uff0c\u65b0\u624b\u6751\u7684\u4e66\u4e00\u822c\u5f88\u5feb\u5c31\u770b\u5b8c\u7684\uff0c\u770b\u5b8c\u540e\u6211\u4eec\u5927\u6982\u5c31\u77e5\u9053\u8fd9\u7c7b\u4e66\u7c4d\u7684\u91cd\u70b9\u77e5\u8bc6\uff0c\u7136\u540e\u518d\u901a\u8fc7\u67e5\u9605\u8fd9\u4e9b\u5927\u800c\u5168\u7684\u4e66\u7684\u76ee\u5f55\u6765\u5b66\u4e60\u5bf9\u5e94\u7ae0\u8282\u7684\u5185\u5bb9\u3002</p> <p>\u770b\u4e66\u7684\u6548\u7387\u5f88\u4f4e\uff0c\u600e\u4e48\u529e\uff1f</p> <p>\u5176\u5b9e\u4e66\u5e76\u4e0d\u4e00\u5b9a\u8981\u5168\u90e8\u4ece\u5934\u770b\u5b8c\u7684\uff0c\u800c\u4e14\u4e5f\u4e0d\u8981\u56fa\u6267\u5230\u4e00\u76f4\u53ea\u770b\u4e00\u672c\u4e66\u3002</p> <p>\u6700\u597d\u5728\u5b66\u4e60\u67d0\u4e2a\u77e5\u8bc6\u70b9\u7684\u65f6\u5019\uff0c\u901a\u8fc7\u770b\u591a\u672c\u4e66\u6765\u4e00\u5c42\u5c42\u7684\u5b66\u4e60\u8fd9\u4e2a\u77e5\u8bc6\u70b9\uff0c\u8fd9\u6837\u4f60\u5b66\u8d77\u6765\u7684\u77e5\u8bc6\u70b9\u4f1a\u6bd4\u8f83\u5168\u9762\uff0c\u4e5f\u66f4\u52a0\u6df1\u5165\u3002</p> <p>\u6309\u8fd9\u79cd\u65b9\u5f0f\u5b66\uff0c\u4f60\u4f1a\u53d1\u73b0\u5f88\u591a\u4e66\u90fd\u88ab\u4f60\u4e0d\u7ecf\u610f\u95f4\u770b\u4e86 7788 \u7684\u3002</p> <p>\u505a\u4e86\u5f88\u591a\u7b14\u8bb0\uff0c\u4f9d\u7136\u8fc7\u4f1a\u5c31\u5fd8\u8bb0\uff0c\u600e\u4e48\u529e\uff1f</p> <p>\u505a\u7b14\u8bb0\u5efa\u8bae\u4f7f\u7528\u601d\u7ef4\u5bfc\u56fe\uff0c\u628a\u601d\u7ef4\u5bfc\u56fe\u5f53\u4f5c\u4e00\u8bfe\u81ea\u5df1\u7684\u77e5\u8bc6\u6811\uff0c\u6bcf\u6df1\u5165\u5b66\u4e00\u4e2a\u77e5\u8bc6\u70b9\u7684\u65f6\u5019\uff0c\u5c31\u5f00\u4e00\u4e2a\u5206\u652f\u53bb\u8bb0\u5f55\u3002</p> <p>\u5728\u8bb0\u5f55\u7b14\u8bb0\u7684\u65f6\u5019\uff0c\u5c3d\u91cf\u5c11 copy \u4e66\u4e0a\u7684\u5185\u5bb9\uff0c\u6700\u597d\u8fd8\u662f\u7ecf\u8fc7\u81ea\u5df1\u601d\u8003\u540e\u7528\u81ea\u5df1\u7684\u8bdd\u8f93\u51fa\u7684\u7b14\u8bb0\uff0c\u800c\u4e14\u53ef\u4ee5\u642d\u914d\u751f\u6d3b\u573a\u666f\u6765\u52a0\u6df1\u8bb0\u5fc6\u70b9\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/","title":"\u56fe\u89e3\u7f51\u7edc\u4ecb\u7ecd","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u662f\u300a\u56fe\u89e3\u7f51\u7edc\u300b\u7684\u4f5c\u8005\uff0c\u672c\u7ad9\u7684\u5185\u5bb9\u90fd\u662f\u6574\u7406\u4e8e\u6211\u516c\u4f17\u53f7\u91cc\u7684\u56fe\u89e3\u6587\u7ae0\u3002</p> <p>\u8fd8\u6ca1\u5173\u6ce8\u7684\u670b\u53cb\uff0c\u53ef\u4ee5\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\uff0c\u5173\u6ce8\u6211\u7684\u516c\u4f17\u53f7\uff0c\u540e\u7eed\u6700\u65b0\u7248\u672c\u7684 PDF \u4f1a\u5728\u6211\u7684\u516c\u4f17\u53f7\u7b2c\u4e00\u65f6\u95f4\u53d1\u5e03\uff0c\u800c\u4e14\u4f1a\u6709\u66f4\u591a\u5176\u4ed6\u7cfb\u5217\u7684\u56fe\u89e3\u6587\u7ae0\uff0c\u6bd4\u5982\u64cd\u4f5c\u7cfb\u7edf\u3001\u8ba1\u7b97\u673a\u7ec4\u6210\u3001\u6570\u636e\u5e93\u3001\u7b97\u6cd5\u7b49\u7b49\u3002</p> <p>\u7b80\u5355\u4ecb\u7ecd\u4e0b\u300a\u56fe\u89e3\u7f51\u7edc\u300b\uff0c\u6574\u4e2a\u5185\u5bb9\u5171\u6709 <code>20W</code> \u5b57 + <code>500</code> \u5f20\u56fe\uff0c\u6bcf\u4e00\u7bc7\u90fd\u81ea\u5df1\u624b\u7ed8\u4e86\u5f88\u591a\u56fe\uff0c\u76ee\u7684\u4e5f\u5f88\u7b80\u5355\uff0c\u51fb\u7834\u5927\u5bb6\u5bf9\u4e8e\u300c\u516b\u80a1\u6587\u300d\u7684\u6050\u60e7\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#_2","title":"\u9002\u5408\u4ec0\u4e48\u7fa4\u4f53\uff1f","text":"<p>\u300a\u56fe\u89e3\u7f51\u7edc\u300b\u5199\u7684\u7f51\u7edc\u77e5\u8bc6\u4e3b\u8981\u662f\u9762\u5411\u7a0b\u5e8f\u5458\u7684\uff0c\u56e0\u4e3a\u5c0f\u6797\u672c\u8eab\u4e5f\u662f\u4e2a\u7a0b\u5e8f\u5458\uff0c\u6240\u4ee5\u6d89\u53ca\u5230\u7684\u77e5\u8bc6\u4e3b\u8981\u662f\u5173\u4e8e\u7a0b\u5e8f\u5458\u65e5\u5e38\u5de5\u4f5c\u6216\u8005\u9762\u8bd5\u7684\u7f51\u7edc\u77e5\u8bc6\u3002</p> <p>\u975e\u5e38\u9002\u5408\u6709\u4e00\u70b9\u7f51\u7edc\u57fa\u7840\uff0c\u4f46\u662f\u53c8\u4e0d\u600e\u4e48\u624e\u5b9e\uff0c\u6216\u8005\u77e5\u8bc6\u70b9\u4e32\u4e0d\u8d77\u6765\u7684\u540c\u5b66\uff0c\u8bf4\u767d\u8fd9\u672c\u56fe\u89e3\u7f51\u7edc\u5c31\u662f\u4e3a\u4e86\u62ef\u6551\u534a\u6876\u6c34\u7684\u540c\u5b66\u800c\u51fa\u6765\u7684\u3002</p> <p>\u56e0\u4e3a\u5c0f\u6797\u5199\u7684\u56fe\u89e3\u7f51\u7edc\u5c31\u56db\u4e2a\u5b57\uff0c\u901a\u4fd7\u6613\u61c2\uff01</p> <p>\u76f8\u4fe1\u4f60\u5728\u770b\u8fd9\u672c\u56fe\u89e3\u7f51\u7edc\u7684\u65f6\u5019\uff0c\u4f60\u5fc3\u91cc\u7684\u611f\u53d7\u4f1a\u662f\uff1a</p> <ul> <li>\u300c\u5367\u69fd\uff0c\u539f\u6765\u662f\u8fd9\u6837\uff0c\u5927\u5b66\u8001\u5e08\u6559\u77e5\u8bc6\u539f\u6765\u662f\u8fd9\u4e48\u7406\u89e3\u300d</li> <li>\u300c\u5367\u69fd\uff0c\u6211\u7684\u7f51\u7edc\u77e5\u8bc6\u4e32\u8d77\u6765\u4e86\u300d</li> <li>\u300c\u5367\u69fd\uff0c\u6211\u611f\u89c9\u9762\u8bd5\u7a33\u4e86\u300d</li> <li>\u300c\u5367\u69fd\uff0c\u76f8\u89c1\u6068\u665a\u300d</li> </ul> <p>\u5f53\u7136\uff0c\u4e5f\u9002\u5408\u9762\u8bd5\u7a81\u51fb\u7f51\u7edc\u77e5\u8bc6\u65f6\u62ff\u6765\u770b\u3002\u56fe\u89e3\u7f51\u7edc\u91cc\u7684\u5185\u5bb9\u57fa\u672c\u662f\u9762\u8bd5\u5e38\u89c1\u7684\u534f\u8bae\uff0c\u6bd4\u5982 HTTP\u3001HTTPS\u3001TCP\u3001UDP\u3001IP \u7b49\u7b49\uff0c\u4e5f\u6709\u5f88\u591a\u9762\u8bd5\u5e38\u95ee\u7684\u95ee\u9898\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>TCP \u4e3a\u4ec0\u4e48\u4e09\u6b21\u63e1\u624b\uff1f\u56db\u6b21\u6325\u624b\uff1f</li> <li>TCP \u4e3a\u4ec0\u4e48\u8981\u6709 TIME_WAIT \u72b6\u6001\uff1f</li> <li>TCP \u4e3a\u4ec0\u4e48\u662f\u53ef\u9760\u4f20\u8f93\u534f\u8bae\uff0c\u800c UDP \u4e0d\u662f\uff1f</li> <li>\u952e\u5165\u7f51\u5740\u5230\u7f51\u9875\u663e\u793a\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</li> <li>HTTPS \u63e1\u624b\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f</li> <li>\u2026\u2026.</li> </ul> <p>\u4e0d\u6562\u8bf4 100 % \u6db5\u76d6\u4e86\u9762\u8bd5\u7684\u7f51\u7edc\u95ee\u9898\uff0c\u4f46\u662f\u81f3\u5c11 90% \u662f\u6709\u7684\uff0c\u800c\u4e14\u5185\u5bb9\u7684\u6df1\u5ea6\u5e94\u5bf9\u5927\u5382\u4e5f\u662f\u7ef0\u7ef0\u6709\u4f59\uff0c\u6709\u975e\u5e38\u591a\u7684\u8bfb\u8005\u8dd1\u6765\u611f\u6fc0\u5c0f\u6797\u7684\u56fe\u89e3\u7f51\u7edc\uff0c\u5e2e\u52a9\u4ed6\u4eec\u62ff\u5230\u4e86\u56fd\u5185\u5f88\u591a\u4e00\u7ebf\u5927\u5382\u7684 offer\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#_3","title":"\u8981\u600e\u4e48\u9605\u8bfb\uff1f","text":"<p>\u5f88\u8bda\u6073\u7684\u544a\u8bc9\u4f60\uff0c\u300a\u56fe\u89e3\u7f51\u7edc\u300b\u4e0d\u662f\u6559\u79d1\u4e66\uff0c\u800c\u662f\u6211\u5199\u7684\u56fe\u89e3\u7f51\u7edc\u6587\u7ae0\u7684\u6574\u5408\uff0c\u6240\u4ee5\u80af\u5b9a\u662f\u6ca1\u6709\u6559\u79d1\u4e66\u90a3\u4e48\u7ec6\u81f4\u548c\u5168\u9762\uff0c\u5f53\u7136\u4e5f\u5c31\u4e0d\u4f1a\u6709\u5f88\u591a\u5e9f\u8bdd\uff0c\u90fd\u662f\u76f4\u51fb\u91cd\u70b9\uff0c\u4e0d\u7ed5\u5f2f\uff0c\u800c\u4e14\u6709\u7684\u77e5\u8bc6\u70b9\u4e66\u4e0a\u770b\u4e0d\u5230\u3002</p> <p>\u9605\u8bfb\u7684\u987a\u5e8f\u53ef\u4ee5\u4e0d\u7528\u4ece\u5934\u8bfb\u5230\u5c3e\uff0c\u4f60\u53ef\u4ee5\u6839\u636e\u4f60\u60f3\u8981\u4e86\u89e3\u7684\u77e5\u8bc6\u70b9\uff0c\u901a\u8fc7\u672c\u7ad9\u7684\u641c\u7d22\u529f\u80fd\uff0c\u53bb\u770b\u54ea\u4e2a\u7ae0\u8282\u7684\u5185\u5bb9\u5c31\u597d\uff0c\u53ef\u4ee5\u968f\u610f\u9605\u8bfb\u4efb\u4f55\u7ae0\u8282\u3002</p> <p>\u672c\u7ad9\u7684\u5de6\u4fa7\u8fb9\u62e6\u5c31\u662f\u300a\u56fe\u89e3\u7f51\u7edc\u300b\u7684\u76ee\u5f55\u7ed3\u6784\uff08\u522b\u770b\u7bc7\u7ae0\u4e0d\u591a\uff0c\u6bcf\u4e00\u7ae0\u90fd\u662f\u5f88\u957f\u5f88\u957f\u7684\u6587\u7ae0\u54e6 :laughing:\uff09\uff1a</p> <ul> <li>\u7f51\u7edc\u57fa\u7840\u7bc7 :point_down:</li> <li>TCP/IP \u7f51\u7edc\u6a21\u578b\u6709\u54ea\u51e0\u5c42\uff1f </li> <li>\u952e\u5165\u7f51\u5740\u5230\u7f51\u9875\u663e\u793a\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f </li> <li>Linux \u7cfb\u7edf\u662f\u5982\u4f55\u6536\u53d1\u7f51\u7edc\u5305\u7684\uff1f </li> <li>HTTP \u7bc7 :point_down:<ul> <li>HTTP \u5e38\u89c1\u9762\u8bd5\u9898 </li> <li>HTTP/1.1 \u5982\u4f55\u4f18\u5316\uff1f </li> <li>HTTPS RSA \u63e1\u624b\u89e3\u6790 </li> <li>HTTPS ECDHE \u63e1\u624b\u89e3\u6790 </li> <li>HTTPS \u5982\u4f55\u4f18\u5316\uff1f </li> <li>HTTP/2 \u725b\u903c\u5728\u54ea\uff1f </li> <li>HTTP/3 \u5f3a\u52bf\u6765\u88ad </li> <li>\u65e2\u7136\u6709 HTTP \u534f\u8bae\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 RPC\uff1f </li> <li>\u65e2\u7136\u6709 HTTP \u534f\u8bae\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 websocket\uff1f </li> </ul> </li> <li>TCP \u7bc7 :point_down:<ul> <li>TCP \u4e09\u6b21\u63e1\u624b\u4e0e\u56db\u6b21\u6325\u624b\u9762\u8bd5\u9898 </li> <li>TCP \u91cd\u4f20\u3001\u6ed1\u52a8\u7a97\u53e3\u3001\u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236 </li> <li>TCP \u5b9e\u6218\u6293\u5305\u5206\u6790 </li> <li>TCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217 </li> <li>\u5982\u4f55\u4f18\u5316 TCP? </li> <li>\u5982\u4f55\u7406\u89e3\u662f TCP \u9762\u5411\u5b57\u8282\u6d41\u534f\u8bae\uff1f </li> <li>\u4e3a\u4ec0\u4e48 TCP \u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u8981\u4e0d\u4e00\u6837\u5462\uff1f </li> <li>SYN \u62a5\u6587\u4ec0\u4e48\u65f6\u5019\u60c5\u51b5\u4e0b\u4f1a\u88ab\u4e22\u5f03\uff1f </li> <li>\u56db\u6b21\u6325\u624b\u4e2d\u6536\u5230\u4e71\u5e8f\u7684 FIN \u5305\u4f1a\u5982\u4f55\u5904\u7406\uff1f </li> <li>\u5728 TIME_WAIT \u72b6\u6001\u7684 TCP \u8fde\u63a5\uff0c\u6536\u5230 SYN \u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f </li> <li>TCP \u8fde\u63a5\uff0c\u4e00\u7aef\u65ad\u7535\u548c\u8fdb\u7a0b\u5d29\u6e83\u6709\u4ec0\u4e48\u533a\u522b\uff1f </li> <li>\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u539f\u672c\u7684 TCP \u8fde\u63a5\u8fd8\u5b58\u5728\u5417\uff1f </li> <li>tcp_tw_reuse \u4e3a\u4ec0\u4e48\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff1f </li> <li>HTTPS \u4e2d TLS \u548c TCP \u80fd\u540c\u65f6\u63e1\u624b\u5417\uff1f </li> <li>TCP Keepalive \u548c HTTP Keep-Alive \u662f\u4e00\u4e2a\u4e1c\u897f\u5417\uff1f </li> <li>TCP \u6709\u4ec0\u4e48\u7f3a\u9677\uff1f</li> <li>\u5982\u4f55\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\uff1f</li> <li>TCP \u548c UDP \u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f</li> <li>\u670d\u52a1\u7aef\u6ca1\u6709 listen\uff0c\u5ba2\u6237\u7aef\u53d1\u8d77\u8fde\u63a5\u5efa\u7acb\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</li> <li>\u6ca1\u6709 accept\uff0c\u53ef\u4ee5\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f</li> <li>\u7528\u4e86 TCP \u534f\u8bae\uff0c\u6570\u636e\u4e00\u5b9a\u4e0d\u4f1a\u4e22\u5417\uff1f</li> <li>TCP \u56db\u6b21\u6325\u624b\uff0c\u53ef\u4ee5\u53d8\u6210\u4e09\u6b21\u5417\uff1f</li> </ul> </li> <li>IP \u7bc7 :point_down:<ul> <li>IP \u57fa\u7840\u77e5\u8bc6\u5168\u5bb6\u6876 </li> <li>ping \u7684\u5de5\u4f5c\u539f\u7406 </li> <li>\u65ad\u7f51\u4e86\uff0c\u8fd8\u80fd ping \u901a 127.0.0.1 \u5417\uff1f</li> </ul> </li> <li>\u5b66\u4e60\u5fc3\u5f97 :point_down:<ul> <li>\u8ba1\u7b97\u673a\u7f51\u7edc\u600e\u4e48\u5b66\uff1f </li> </ul> </li> <li>\u753b\u56fe\u7ecf\u9a8c\u5206\u4eab </li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#_4","title":"\u8d28\u91cf\u5982\u4f55\uff1f","text":"<p>\u56fe\u89e3\u7f51\u7edc\u7684\u8d28\u91cf\u5c0f\u6797\u8bf4\u7684\u4e0d\u7b97\uff0c\u8bfb\u8005\u8bf4\u7684\u7b97\uff01</p> <p>\u56fe\u89e3\u7f51\u7edc\u7684\u7b2c\u4e00\u4e2a\u7248\u672c\u81ea\u53bb\u5e74\u53d1\u5e03\u4ee5\u6765\uff0c\u6bcf\u9694\u4e00\u6bb5\u65f6\u95f4\uff0c\u5c31\u4f1a\u6709\u4e0d\u5c11\u7684\u8bfb\u8005\u8dd1\u6765\u611f\u6fc0\u5c0f\u6797\u3002</p> <p>\u4ed6\u4eec\u8bf4\u770b\u4e86\u6211\u7684\u56fe\u89e3\u7f51\u7edc\uff0c\u8f7b\u677e\u5e94\u5bf9\u5927\u5382\u7684\u7f51\u7edc\u9762\u8bd5\u9898\uff0c\u800c\u4e14\u6bcf\u6b21\u9762\u8bd5\u65f6\u95ee\u5230\u7f51\u7edc\u95ee\u9898\uff0c\u4ed6\u4eec\u4e00\u70b9\u90fd\u4e0d\u614c\uff0c\u751a\u81f3\u6697\u6697\u7a83\u559c\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/#_5","title":"\u6709\u9519\u8bef\u600e\u4e48\u529e\uff1f","text":"<p>\u5c0f\u6797\u662f\u4e2a\u624b\u6b8b\u515a\uff0c\u65f6\u5e38\u5199\u51fa\u9519\u522b\u5b57\u3002</p> <p>\u5982\u679c\u4f60\u5728\u5b66\u4e60\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u4f60\u53d1\u73b0\u6709\u4efb\u4f55\u9519\u8bef\u6216\u8005\u7591\u60d1\u7684\u5730\u65b9\uff0c\u6b22\u8fce\u4f60\u901a\u8fc7\u90ae\u7bb1\u6216\u8005\u5e95\u90e8\u7559\u8a00\u7ed9\u5c0f\u6797\uff0c\u52d8\u8bef\u90ae\u7bb1\uff1axiaolincoding@163.com</p> <p>\u5c0f\u6797\u62bd\u65f6\u95f4\u4f1a\u9010\u4e2a\u4fee\u6b63\uff0c\u7136\u540e\u53d1\u5e03\u65b0\u7248\u672c\u7684\u56fe\u89e3\u7f51\u7edc PDF\uff0c\u4e00\u8d77\u8fed\u4ee3\u51fa\u66f4\u597d\u7684\u56fe\u89e3\u7f51\u7edc\uff01</p> <p>\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u4e86\u54e6\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/how_os_deal_network_package/","title":"2.3 Linux \u7cfb\u7edf\u662f\u5982\u4f55\u6536\u53d1\u7f51\u7edc\u5305\u7684\uff1f","text":"<p>\u8fd9\u6b21\uff0c\u5c31\u56f4\u7ed5\u4e00\u4e2a\u95ee\u9898\u6765\u8bf4\u3002</p> <p>Linux \u7cfb\u7edf\u662f\u5982\u4f55\u6536\u53d1\u7f51\u7edc\u5305\u7684\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/how_os_deal_network_package/#_1","title":"\u7f51\u7edc\u6a21\u578b","text":"<p>\u4e3a\u4e86\u4f7f\u5f97\u591a\u79cd\u8bbe\u5907\u80fd\u901a\u8fc7\u7f51\u7edc\u76f8\u4e92\u901a\u4fe1\uff0c\u548c\u4e3a\u4e86\u89e3\u51b3\u5404\u79cd\u4e0d\u540c\u8bbe\u5907\u5728\u7f51\u7edc\u4e92\u8054\u4e2d\u7684\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u56fd\u9645\u6807\u51c6\u5316\u7ec4\u7ec7\u5236\u5b9a\u4e86\u5f00\u653e\u5f0f\u7cfb\u7edf\u4e92\u8054\u901a\u4fe1\u53c2\u8003\u6a21\u578b\uff08Open System Interconnection Reference Model\uff09\uff0c\u4e5f\u5c31\u662f OSI \u7f51\u7edc\u6a21\u578b\uff0c\u8be5\u6a21\u578b\u4e3b\u8981\u6709 7 \u5c42\uff0c\u5206\u522b\u662f\u5e94\u7528\u5c42\u3001\u8868\u793a\u5c42\u3001\u4f1a\u8bdd\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u3001\u6570\u636e\u94fe\u8def\u5c42\u4ee5\u53ca\u7269\u7406\u5c42\u3002</p> <p>\u6bcf\u4e00\u5c42\u8d1f\u8d23\u7684\u804c\u80fd\u90fd\u4e0d\u540c\uff0c\u5982\u4e0b\uff1a</p> <ul> <li>\u5e94\u7528\u5c42\uff0c\u8d1f\u8d23\u7ed9\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7edf\u4e00\u7684\u63a5\u53e3\uff1b</li> <li>\u8868\u793a\u5c42\uff0c\u8d1f\u8d23\u628a\u6570\u636e\u8f6c\u6362\u6210\u517c\u5bb9\u53e6\u4e00\u4e2a\u7cfb\u7edf\u80fd\u8bc6\u522b\u7684\u683c\u5f0f\uff1b</li> <li>\u4f1a\u8bdd\u5c42\uff0c\u8d1f\u8d23\u5efa\u7acb\u3001\u7ba1\u7406\u548c\u7ec8\u6b62\u8868\u793a\u5c42\u5b9e\u4f53\u4e4b\u95f4\u7684\u901a\u4fe1\u4f1a\u8bdd\uff1b</li> <li>\u4f20\u8f93\u5c42\uff0c\u8d1f\u8d23\u7aef\u5230\u7aef\u7684\u6570\u636e\u4f20\u8f93\uff1b</li> <li>\u7f51\u7edc\u5c42\uff0c\u8d1f\u8d23\u6570\u636e\u7684\u8def\u7531\u3001\u8f6c\u53d1\u3001\u5206\u7247\uff1b</li> <li>\u6570\u636e\u94fe\u8def\u5c42\uff0c\u8d1f\u8d23\u6570\u636e\u7684\u5c01\u5e27\u548c\u5dee\u9519\u68c0\u6d4b\uff0c\u4ee5\u53ca MAC \u5bfb\u5740\uff1b</li> <li>\u7269\u7406\u5c42\uff0c\u8d1f\u8d23\u5728\u7269\u7406\u7f51\u7edc\u4e2d\u4f20\u8f93\u6570\u636e\u5e27\uff1b</li> </ul> <p>\u7531\u4e8e OSI \u6a21\u578b\u5b9e\u5728\u592a\u590d\u6742\uff0c\u63d0\u51fa\u7684\u4e5f\u53ea\u662f\u6982\u5ff5\u7406\u8bba\u4e0a\u7684\u5206\u5c42\uff0c\u5e76\u6ca1\u6709\u63d0\u4f9b\u5177\u4f53\u7684\u5b9e\u73b0\u65b9\u6848\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u6211\u4eec\u6bd4\u8f83\u5e38\u89c1\uff0c\u4e5f\u6bd4\u8f83\u5b9e\u7528\u7684\u662f\u56db\u5c42\u6a21\u578b\uff0c\u5373 TCP/IP \u7f51\u7edc\u6a21\u578b\uff0cLinux \u7cfb\u7edf\u6b63\u662f\u6309\u7167\u8fd9\u5957\u7f51\u7edc\u6a21\u578b\u6765\u5b9e\u73b0\u7f51\u7edc\u534f\u8bae\u6808\u7684\u3002</p> <p>TCP/IP \u7f51\u7edc\u6a21\u578b\u5171\u6709 4 \u5c42\uff0c\u5206\u522b\u662f\u5e94\u7528\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u548c\u7f51\u7edc\u63a5\u53e3\u5c42\uff0c\u6bcf\u4e00\u5c42\u8d1f\u8d23\u7684\u804c\u80fd\u5982\u4e0b\uff1a</p> <ul> <li>\u5e94\u7528\u5c42\uff0c\u8d1f\u8d23\u5411\u7528\u6237\u63d0\u4f9b\u4e00\u7ec4\u5e94\u7528\u7a0b\u5e8f\uff0c\u6bd4\u5982 HTTP\u3001DNS\u3001FTP \u7b49;</li> <li>\u4f20\u8f93\u5c42\uff0c\u8d1f\u8d23\u7aef\u5230\u7aef\u7684\u901a\u4fe1\uff0c\u6bd4\u5982 TCP\u3001UDP \u7b49\uff1b</li> <li>\u7f51\u7edc\u5c42\uff0c\u8d1f\u8d23\u7f51\u7edc\u5305\u7684\u5c01\u88c5\u3001\u5206\u7247\u3001\u8def\u7531\u3001\u8f6c\u53d1\uff0c\u6bd4\u5982 IP\u3001ICMP \u7b49\uff1b</li> <li>\u7f51\u7edc\u63a5\u53e3\u5c42\uff0c\u8d1f\u8d23\u7f51\u7edc\u5305\u5728\u7269\u7406\u7f51\u7edc\u4e2d\u7684\u4f20\u8f93\uff0c\u6bd4\u5982\u7f51\u7edc\u5305\u7684\u5c01\u5e27\u3001MAC \u5bfb\u5740\u3001\u5dee\u9519\u68c0\u6d4b\uff0c\u4ee5\u53ca\u901a\u8fc7\u7f51\u5361\u4f20\u8f93\u7f51\u7edc\u5e27\u7b49\uff1b</li> </ul> <p>TCP/IP \u7f51\u7edc\u6a21\u578b\u76f8\u6bd4 OSI \u7f51\u7edc\u6a21\u578b\u7b80\u5316\u4e86\u4e0d\u5c11\uff0c\u4e5f\u66f4\u52a0\u6613\u8bb0\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0d\u8fc7\uff0c\u6211\u4eec\u5e38\u8bf4\u7684\u4e03\u5c42\u548c\u56db\u5c42\u8d1f\u8f7d\u5747\u8861\uff0c\u662f\u7528 OSI \u7f51\u7edc\u6a21\u578b\u6765\u63cf\u8ff0\u7684\uff0c\u4e03\u5c42\u5bf9\u5e94\u7684\u662f\u5e94\u7528\u5c42\uff0c\u56db\u5c42\u5bf9\u5e94\u7684\u662f\u4f20\u8f93\u5c42\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/how_os_deal_network_package/#linux","title":"Linux \u7f51\u7edc\u534f\u8bae\u6808","text":"<p>\u6211\u4eec\u53ef\u4ee5\u628a\u81ea\u5df1\u7684\u8eab\u4f53\u6bd4\u4f5c\u5e94\u7528\u5c42\u4e2d\u7684\u6570\u636e\uff0c\u6253\u5e95\u8863\u670d\u6bd4\u4f5c\u4f20\u8f93\u5c42\u4e2d\u7684 TCP \u5934\uff0c\u5916\u5957\u6bd4\u4f5c\u7f51\u7edc\u5c42\u4e2d IP \u5934\uff0c\u5e3d\u5b50\u548c\u978b\u5b50\u5206\u522b\u6bd4\u4f5c\u7f51\u7edc\u63a5\u53e3\u5c42\u7684\u5e27\u5934\u548c\u5e27\u5c3e\u3002</p> <p>\u5728\u51ac\u5929\u8fd9\u4e2a\u5b63\u8282\uff0c\u5f53\u6211\u4eec\u8981\u4ece\u5bb6\u91cc\u51fa\u53bb\u73a9\u7684\u65f6\u5019\uff0c\u81ea\u7136\u8981\u5148\u7a7f\u4e2a\u6253\u5e95\u8863\u670d\uff0c\u518d\u5957\u4e0a\u4fdd\u6696\u5916\u5957\uff0c\u6700\u540e\u7a7f\u4e0a\u5e3d\u5b50\u548c\u978b\u5b50\u624d\u51fa\u95e8\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u5c31\u597d\u50cf\u6211\u4eec\u628a TCP \u534f\u8bae\u901a\u4fe1\u7684\u7f51\u7edc\u5305\u53d1\u51fa\u53bb\u7684\u65f6\u5019\uff0c\u4f1a\u628a\u5e94\u7528\u5c42\u7684\u6570\u636e\u6309\u7167\u7f51\u7edc\u534f\u8bae\u6808\u5c42\u5c42\u5c01\u88c5\u548c\u5904\u7406\u3002</p> <p>\u4f60\u4ece\u4e0b\u9762\u8fd9\u5f20\u56fe\u53ef\u4ee5\u770b\u5230\uff0c\u5e94\u7528\u5c42\u6570\u636e\u5728\u6bcf\u4e00\u5c42\u7684\u5c01\u88c5\u683c\u5f0f\u3002</p> <p></p> <p>\u5176\u4e2d\uff1a</p> <ul> <li>\u4f20\u8f93\u5c42\uff0c\u7ed9\u5e94\u7528\u6570\u636e\u524d\u9762\u589e\u52a0\u4e86 TCP  \u5934\uff1b</li> <li>\u7f51\u7edc\u5c42\uff0c\u7ed9 TCP \u6570\u636e\u5305\u524d\u9762\u589e\u52a0\u4e86 IP  \u5934\uff1b</li> <li>\u7f51\u7edc\u63a5\u53e3\u5c42\uff0c\u7ed9 IP \u6570\u636e\u5305\u524d\u540e\u5206\u522b\u589e\u52a0\u4e86\u5e27\u5934\u548c\u5e27\u5c3e\uff1b</li> </ul> <p>\u8fd9\u4e9b\u65b0\u589e\u7684\u5934\u90e8\u548c\u5c3e\u90e8\uff0c\u90fd\u6709\u5404\u81ea\u7684\u4f5c\u7528\uff0c\u4e5f\u90fd\u662f\u6309\u7167\u7279\u5b9a\u7684\u534f\u8bae\u683c\u5f0f\u586b\u5145\uff0c\u8fd9\u6bcf\u4e00\u5c42\u90fd\u589e\u52a0\u4e86\u5404\u81ea\u7684\u534f\u8bae\u5934\uff0c\u90a3\u81ea\u7136\u7f51\u7edc\u5305\u7684\u5927\u5c0f\u5c31\u589e\u5927\u4e86\uff0c\u4f46\u7269\u7406\u94fe\u8def\u5e76\u4e0d\u80fd\u4f20\u8f93\u4efb\u610f\u5927\u5c0f\u7684\u6570\u636e\u5305\uff0c\u6240\u4ee5\u5728\u4ee5\u592a\u7f51\u4e2d\uff0c\u89c4\u5b9a\u4e86\u6700\u5927\u4f20\u8f93\u5355\u5143\uff08MTU\uff09\u662f <code>1500</code> \u5b57\u8282\uff0c\u4e5f\u5c31\u662f\u89c4\u5b9a\u4e86\u5355\u6b21\u4f20\u8f93\u7684\u6700\u5927 IP \u5305\u5927\u5c0f\u3002</p> <p>\u5f53\u7f51\u7edc\u5305\u8d85\u8fc7 MTU \u7684\u5927\u5c0f\uff0c\u5c31\u4f1a\u5728\u7f51\u7edc\u5c42\u5206\u7247\uff0c\u4ee5\u786e\u4fdd\u5206\u7247\u540e\u7684 IP \u5305\u4e0d\u4f1a\u8d85\u8fc7 MTU \u5927\u5c0f\uff0c\u5982\u679c MTU \u8d8a\u5c0f\uff0c\u9700\u8981\u7684\u5206\u5305\u5c31\u8d8a\u591a\uff0c\u90a3\u4e48\u7f51\u7edc\u541e\u5410\u80fd\u529b\u5c31\u8d8a\u5dee\uff0c\u76f8\u53cd\u7684\uff0c\u5982\u679c MTU \u8d8a\u5927\uff0c\u9700\u8981\u7684\u5206\u5305\u5c31\u8d8a\u5c11\uff0c\u90a3\u4e48\u7f51\u7edc\u541e\u5410\u80fd\u529b\u5c31\u8d8a\u597d\u3002</p> <p>\u77e5\u9053\u4e86 TCP/IP \u7f51\u7edc\u6a21\u578b\uff0c\u4ee5\u53ca\u7f51\u7edc\u5305\u7684\u5c01\u88c5\u539f\u7406\u540e\uff0c\u90a3\u4e48 Linux \u7f51\u7edc\u534f\u8bae\u6808\u7684\u6837\u5b50\uff0c\u4f60\u60f3\u5fc5\u731c\u5230\u4e86\u5927\u6982\uff0c\u5b83\u5176\u5b9e\u5c31\u7c7b\u4f3c\u4e8e TCP/IP \u7684\u56db\u5c42\u7ed3\u6784\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u7684\u7684\u7f51\u7edc\u534f\u8bae\u6808\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\uff1a</p> <ul> <li>\u5e94\u7528\u7a0b\u5e8f\u9700\u8981\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\uff0c\u6765\u8ddf Socket \u5c42\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\uff1b</li> <li>Socket \u5c42\u7684\u4e0b\u9762\u5c31\u662f\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u548c\u7f51\u7edc\u63a5\u53e3\u5c42\uff1b</li> <li>\u6700\u4e0b\u9762\u7684\u4e00\u5c42\uff0c\u5219\u662f\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f\u548c\u786c\u4ef6\u7f51\u5361\u8bbe\u5907\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/how_os_deal_network_package/#linux_1","title":"Linux \u63a5\u6536\u7f51\u7edc\u5305\u7684\u6d41\u7a0b","text":"<p>\u7f51\u5361\u662f\u8ba1\u7b97\u673a\u91cc\u7684\u4e00\u4e2a\u786c\u4ef6\uff0c\u4e13\u95e8\u8d1f\u8d23\u63a5\u6536\u548c\u53d1\u9001\u7f51\u7edc\u5305\uff0c\u5f53\u7f51\u5361\u63a5\u6536\u5230\u4e00\u4e2a\u7f51\u7edc\u5305\u540e\uff0c\u4f1a\u901a\u8fc7 DMA \u6280\u672f\uff0c\u5c06\u7f51\u7edc\u5305\u5199\u5165\u5230\u6307\u5b9a\u7684\u5185\u5b58\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u5199\u5165\u5230 Ring Buffer\uff0c\u8fd9\u4e2a\u662f\u4e00\u4e2a\u73af\u5f62\u7f13\u51b2\u533a\uff0c\u63a5\u7740\u5c31\u4f1a\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\u8fd9\u4e2a\u7f51\u7edc\u5305\u5df2\u7ecf\u5230\u8fbe\u3002</p> <p>\u90a3\u5e94\u8be5\u600e\u4e48\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\u8fd9\u4e2a\u7f51\u7edc\u5305\u5df2\u7ecf\u5230\u8fbe\u4e86\u5462\uff1f</p> <p>\u6700\u7b80\u5355\u7684\u4e00\u79cd\u65b9\u5f0f\u5c31\u662f\u89e6\u53d1\u4e2d\u65ad\uff0c\u4e5f\u5c31\u662f\u6bcf\u5f53\u7f51\u5361\u6536\u5230\u4e00\u4e2a\u7f51\u7edc\u5305\uff0c\u5c31\u89e6\u53d1\u4e00\u4e2a\u4e2d\u65ad\u544a\u8bc9\u64cd\u4f5c\u7cfb\u7edf\u3002</p> <p>\u4f46\u662f\uff0c\u8fd9\u5b58\u5728\u4e00\u4e2a\u95ee\u9898\uff0c\u5728\u9ad8\u6027\u80fd\u7f51\u7edc\u573a\u666f\u4e0b\uff0c\u7f51\u7edc\u5305\u7684\u6570\u91cf\u4f1a\u975e\u5e38\u591a\uff0c\u90a3\u4e48\u5c31\u4f1a\u89e6\u53d1\u975e\u5e38\u591a\u7684\u4e2d\u65ad\uff0c\u8981\u77e5\u9053\u5f53 CPU  \u6536\u5230\u4e86\u4e2d\u65ad\uff0c\u5c31\u4f1a\u505c\u4e0b\u624b\u91cc\u7684\u4e8b\u60c5\uff0c\u800c\u53bb\u5904\u7406\u8fd9\u4e9b\u7f51\u7edc\u5305\uff0c\u5904\u7406\u5b8c\u6bd5\u540e\uff0c\u624d\u4f1a\u56de\u53bb\u7ee7\u7eed\u5176\u4ed6\u4e8b\u60c5\uff0c\u90a3\u4e48\u9891\u7e41\u5730\u89e6\u53d1\u4e2d\u65ad\uff0c\u5219\u4f1a\u5bfc\u81f4 CPU \u4e00\u76f4\u6ca1\u5b8c\u6ca1\u4e86\u7684\u5904\u7406\u4e2d\u65ad\uff0c\u800c\u5bfc\u81f4\u5176\u4ed6\u4efb\u52a1\u53ef\u80fd\u65e0\u6cd5\u7ee7\u7eed\u524d\u8fdb\uff0c\u4ece\u800c\u5f71\u54cd\u7cfb\u7edf\u7684\u6574\u4f53\u6548\u7387\u3002</p> <p>\u6240\u4ee5\u4e3a\u4e86\u89e3\u51b3\u9891\u7e41\u4e2d\u65ad\u5e26\u6765\u7684\u6027\u80fd\u5f00\u9500\uff0cLinux \u5185\u6838\u5728 2.6 \u7248\u672c\u4e2d\u5f15\u5165\u4e86 NAPI \u673a\u5236\uff0c\u5b83\u662f\u6df7\u5408\u300c\u4e2d\u65ad\u548c\u8f6e\u8be2\u300d\u7684\u65b9\u5f0f\u6765\u63a5\u6536\u7f51\u7edc\u5305\uff0c\u5b83\u7684\u6838\u5fc3\u6982\u5ff5\u5c31\u662f\u4e0d\u91c7\u7528\u4e2d\u65ad\u7684\u65b9\u5f0f\u8bfb\u53d6\u6570\u636e\uff0c\u800c\u662f\u9996\u5148\u91c7\u7528\u4e2d\u65ad\u5524\u9192\u6570\u636e\u63a5\u6536\u7684\u670d\u52a1\u7a0b\u5e8f\uff0c\u7136\u540e <code>poll</code> \u7684\u65b9\u6cd5\u6765\u8f6e\u8be2\u6570\u636e\u3002</p> <p>\u56e0\u6b64\uff0c\u5f53\u6709\u7f51\u7edc\u5305\u5230\u8fbe\u65f6\uff0c\u4f1a\u901a\u8fc7 DMA \u6280\u672f\uff0c\u5c06\u7f51\u7edc\u5305\u5199\u5165\u5230\u6307\u5b9a\u7684\u5185\u5b58\u5730\u5740\uff0c\u63a5\u7740\u7f51\u5361\u5411 CPU \u53d1\u8d77\u786c\u4ef6\u4e2d\u65ad\uff0c\u5f53 CPU \u6536\u5230\u786c\u4ef6\u4e2d\u65ad\u8bf7\u6c42\u540e\uff0c\u6839\u636e\u4e2d\u65ad\u8868\uff0c\u8c03\u7528\u5df2\u7ecf\u6ce8\u518c\u7684\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u3002</p> <p>\u786c\u4ef6\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u4f1a\u505a\u5982\u4e0b\u7684\u4e8b\u60c5\uff1a</p> <ul> <li>\u9700\u8981\u5148\u300c\u6682\u65f6\u5c4f\u853d\u4e2d\u65ad\u300d\uff0c\u8868\u793a\u5df2\u7ecf\u77e5\u9053\u5185\u5b58\u4e2d\u6709\u6570\u636e\u4e86\uff0c\u544a\u8bc9\u7f51\u5361\u4e0b\u6b21\u518d\u6536\u5230\u6570\u636e\u5305\u76f4\u63a5\u5199\u5185\u5b58\u5c31\u53ef\u4ee5\u4e86\uff0c\u4e0d\u8981\u518d\u901a\u77e5 CPU \u4e86\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u6548\u7387\uff0c\u907f\u514d CPU \u4e0d\u505c\u7684\u88ab\u4e2d\u65ad\u3002</li> <li>\u63a5\u7740\uff0c\u53d1\u8d77\u300c\u8f6f\u4e2d\u65ad\u300d\uff0c\u7136\u540e\u6062\u590d\u521a\u624d\u5c4f\u853d\u7684\u4e2d\u65ad\u3002</li> </ul> <p>\u81f3\u6b64\uff0c\u786c\u4ef6\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u7684\u5de5\u4f5c\u5c31\u5df2\u7ecf\u5b8c\u6210\u3002</p> <p>\u786c\u4ef6\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u505a\u7684\u4e8b\u60c5\u5f88\u5c11\uff0c\u4e3b\u8981\u8017\u65f6\u7684\u5de5\u4f5c\u90fd\u4ea4\u7ed9\u8f6f\u4e2d\u65ad\u5904\u7406\u51fd\u6570\u4e86\u3002</p> <p>\u8f6f\u4e2d\u65ad\u7684\u5904\u7406</p> <p>\u5185\u6838\u4e2d\u7684 ksoftirqd \u7ebf\u7a0b\u4e13\u95e8\u8d1f\u8d23\u8f6f\u4e2d\u65ad\u7684\u5904\u7406\uff0c\u5f53 ksoftirqd \u5185\u6838\u7ebf\u7a0b\u6536\u5230\u8f6f\u4e2d\u65ad\u540e\uff0c\u5c31\u4f1a\u6765\u8f6e\u8be2\u5904\u7406\u6570\u636e\u3002</p> <p>ksoftirqd \u7ebf\u7a0b\u4f1a\u4ece Ring Buffer \u4e2d\u83b7\u53d6\u4e00\u4e2a\u6570\u636e\u5e27\uff0c\u7528 sk_buff \u8868\u793a\uff0c\u4ece\u800c\u53ef\u4ee5\u4f5c\u4e3a\u4e00\u4e2a\u7f51\u7edc\u5305\u4ea4\u7ed9\u7f51\u7edc\u534f\u8bae\u6808\u8fdb\u884c\u9010\u5c42\u5904\u7406\u3002</p> <p>\u7f51\u7edc\u534f\u8bae\u6808</p> <p>\u9996\u5148\uff0c\u4f1a\u5148\u8fdb\u5165\u5230\u7f51\u7edc\u63a5\u53e3\u5c42\uff0c\u5728\u8fd9\u4e00\u5c42\u4f1a\u68c0\u67e5\u62a5\u6587\u7684\u5408\u6cd5\u6027\uff0c\u5982\u679c\u4e0d\u5408\u6cd5\u5219\u4e22\u5f03\uff0c\u5408\u6cd5\u5219\u4f1a\u627e\u51fa\u8be5\u7f51\u7edc\u5305\u7684\u4e0a\u5c42\u534f\u8bae\u7684\u7c7b\u578b\uff0c\u6bd4\u5982\u662f IPv4\uff0c\u8fd8\u662f IPv6\uff0c\u63a5\u7740\u518d\u53bb\u6389\u5e27\u5934\u548c\u5e27\u5c3e\uff0c\u7136\u540e\u4ea4\u7ed9\u7f51\u7edc\u5c42\u3002</p> <p>\u5230\u4e86\u7f51\u7edc\u5c42\uff0c\u5219\u53d6\u51fa IP \u5305\uff0c\u5224\u65ad\u7f51\u7edc\u5305\u4e0b\u4e00\u6b65\u7684\u8d70\u5411\uff0c\u6bd4\u5982\u662f\u4ea4\u7ed9\u4e0a\u5c42\u5904\u7406\u8fd8\u662f\u8f6c\u53d1\u51fa\u53bb\u3002\u5f53\u786e\u8ba4\u8fd9\u4e2a\u7f51\u7edc\u5305\u8981\u53d1\u9001\u7ed9\u672c\u673a\u540e\uff0c\u5c31\u4f1a\u4ece IP \u5934\u91cc\u770b\u770b\u4e0a\u4e00\u5c42\u534f\u8bae\u7684\u7c7b\u578b\u662f TCP \u8fd8\u662f UDP\uff0c\u63a5\u7740\u53bb\u6389 IP \u5934\uff0c\u7136\u540e\u4ea4\u7ed9\u4f20\u8f93\u5c42\u3002</p> <p>\u4f20\u8f93\u5c42\u53d6\u51fa TCP \u5934\u6216 UDP \u5934\uff0c\u6839\u636e\u56db\u5143\u7ec4\u300c\u6e90 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684 IP\u3001\u76ee\u7684\u7aef\u53e3\u300d\u4f5c\u4e3a\u6807\u8bc6\uff0c\u627e\u51fa\u5bf9\u5e94\u7684 Socket\uff0c\u5e76\u628a\u6570\u636e\u653e\u5230 Socket \u7684\u63a5\u6536\u7f13\u51b2\u533a\u3002</p> <p>\u6700\u540e\uff0c\u5e94\u7528\u5c42\u7a0b\u5e8f\u8c03\u7528 Socket \u63a5\u53e3\uff0c\u5c06\u5185\u6838\u7684 Socket \u63a5\u6536\u7f13\u51b2\u533a\u7684\u6570\u636e\u300c\u62f7\u8d1d\u300d\u5230\u5e94\u7528\u5c42\u7684\u7f13\u51b2\u533a\uff0c\u7136\u540e\u5524\u9192\u7528\u6237\u8fdb\u7a0b\u3002</p> <p>\u81f3\u6b64\uff0c\u4e00\u4e2a\u7f51\u7edc\u5305\u7684\u63a5\u6536\u8fc7\u7a0b\u5c31\u5df2\u7ecf\u7ed3\u675f\u4e86\uff0c\u4f60\u4e5f\u53ef\u4ee5\u4ece\u4e0b\u56fe\u5de6\u8fb9\u90e8\u5206\u770b\u5230\u7f51\u7edc\u5305\u63a5\u6536\u7684\u6d41\u7a0b\uff0c\u53f3\u8fb9\u90e8\u5206\u521a\u597d\u53cd\u8fc7\u6765\uff0c\u5b83\u662f\u7f51\u7edc\u5305\u53d1\u9001\u7684\u6d41\u7a0b\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/how_os_deal_network_package/#linux_2","title":"Linux \u53d1\u9001\u7f51\u7edc\u5305\u7684\u6d41\u7a0b","text":"<p>\u5982\u4e0a\u56fe\u7684\u53f3\u534a\u90e8\u5206\uff0c\u53d1\u9001\u7f51\u7edc\u5305\u7684\u6d41\u7a0b\u6b63\u597d\u548c\u63a5\u6536\u6d41\u7a0b\u76f8\u53cd\u3002</p> <p>\u9996\u5148\uff0c\u5e94\u7528\u7a0b\u5e8f\u4f1a\u8c03\u7528 Socket \u53d1\u9001\u6570\u636e\u5305\u7684\u63a5\u53e3\uff0c\u7531\u4e8e\u8fd9\u4e2a\u662f\u7cfb\u7edf\u8c03\u7528\uff0c\u6240\u4ee5\u4f1a\u4ece\u7528\u6237\u6001\u9677\u5165\u5230\u5185\u6838\u6001\u4e2d\u7684 Socket \u5c42\uff0c\u5185\u6838\u4f1a\u7533\u8bf7\u4e00\u4e2a\u5185\u6838\u6001\u7684 sk_buff \u5185\u5b58\uff0c\u5c06\u7528\u6237\u5f85\u53d1\u9001\u7684\u6570\u636e\u62f7\u8d1d\u5230 sk_buff \u5185\u5b58\uff0c\u5e76\u5c06\u5176\u52a0\u5165\u5230\u53d1\u9001\u7f13\u51b2\u533a\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u7f51\u7edc\u534f\u8bae\u6808\u4ece Socket \u53d1\u9001\u7f13\u51b2\u533a\u4e2d\u53d6\u51fa sk_buff\uff0c\u5e76\u6309\u7167 TCP/IP \u534f\u8bae\u6808\u4ece\u4e0a\u5230\u4e0b\u9010\u5c42\u5904\u7406\u3002</p> <p>\u5982\u679c\u4f7f\u7528\u7684\u662f TCP \u4f20\u8f93\u534f\u8bae\u53d1\u9001\u6570\u636e\uff0c\u90a3\u4e48\u5148\u62f7\u8d1d\u4e00\u4e2a\u65b0\u7684 sk_buff \u526f\u672c \uff0c\u8fd9\u662f\u56e0\u4e3a sk_buff \u540e\u7eed\u5728\u8c03\u7528\u7f51\u7edc\u5c42\uff0c\u6700\u540e\u5230\u8fbe\u7f51\u5361\u53d1\u9001\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u8fd9\u4e2a sk_buff \u4f1a\u88ab\u91ca\u653e\u6389\u3002\u800c TCP \u534f\u8bae\u662f\u652f\u6301\u4e22\u5931\u91cd\u4f20\u7684\uff0c\u5728\u6536\u5230\u5bf9\u65b9\u7684 ACK \u4e4b\u524d\uff0c\u8fd9\u4e2a sk_buff \u4e0d\u80fd\u88ab\u5220\u9664\u3002\u6240\u4ee5\u5185\u6838\u7684\u505a\u6cd5\u5c31\u662f\u6bcf\u6b21\u8c03\u7528\u7f51\u5361\u53d1\u9001\u7684\u65f6\u5019\uff0c\u5b9e\u9645\u4e0a\u4f20\u9012\u51fa\u53bb\u7684\u662f sk_buff \u7684\u4e00\u4e2a\u62f7\u8d1d\uff0c\u7b49\u6536\u5230 ACK \u518d\u771f\u6b63\u5220\u9664\u3002</p> <p>\u63a5\u7740\uff0c\u5bf9 sk_buff \u586b\u5145 TCP \u5934\u3002\u8fd9\u91cc\u63d0\u4e00\u4e0b\uff0csk_buff \u53ef\u4ee5\u8868\u793a\u5404\u4e2a\u5c42\u7684\u6570\u636e\u5305\uff0c\u5728\u5e94\u7528\u5c42\u6570\u636e\u5305\u53eb data\uff0c\u5728 TCP \u5c42\u6211\u4eec\u79f0\u4e3a segment\uff0c\u5728 IP \u5c42\u6211\u4eec\u53eb packet\uff0c\u5728\u6570\u636e\u94fe\u8def\u5c42\u79f0\u4e3a frame\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u597d\u5947\uff0c\u4e3a\u4ec0\u4e48\u5168\u90e8\u6570\u636e\u5305\u53ea\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53\u6765\u63cf\u8ff0\u5462\uff1f\u534f\u8bae\u6808\u91c7\u7528\u7684\u662f\u5206\u5c42\u7ed3\u6784\uff0c\u4e0a\u5c42\u5411\u4e0b\u5c42\u4f20\u9012\u6570\u636e\u65f6\u9700\u8981\u589e\u52a0\u5305\u5934\uff0c\u4e0b\u5c42\u5411\u4e0a\u5c42\u6570\u636e\u65f6\u53c8\u9700\u8981\u53bb\u6389\u5305\u5934\uff0c\u5982\u679c\u6bcf\u4e00\u5c42\u90fd\u7528\u4e00\u4e2a\u7ed3\u6784\u4f53\uff0c\u90a3\u5728\u5c42\u4e4b\u95f4\u4f20\u9012\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u8981\u53d1\u751f\u591a\u6b21\u62f7\u8d1d\uff0c\u8fd9\u5c06\u5927\u5927\u964d\u4f4e CPU \u6548\u7387\u3002</p> <p>\u4e8e\u662f\uff0c\u4e3a\u4e86\u5728\u5c42\u7ea7\u4e4b\u95f4\u4f20\u9012\u6570\u636e\u65f6\uff0c\u4e0d\u53d1\u751f\u62f7\u8d1d\uff0c\u53ea\u7528 sk_buff \u4e00\u4e2a\u7ed3\u6784\u4f53\u6765\u63cf\u8ff0\u6240\u6709\u7684\u7f51\u7edc\u5305\uff0c\u90a3\u5b83\u662f\u5982\u4f55\u505a\u5230\u7684\u5462\uff1f\u662f\u901a\u8fc7\u8c03\u6574 sk_buff \u4e2d <code>data</code> \u7684\u6307\u9488\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5f53\u63a5\u6536\u62a5\u6587\u65f6\uff0c\u4ece\u7f51\u5361\u9a71\u52a8\u5f00\u59cb\uff0c\u901a\u8fc7\u534f\u8bae\u6808\u5c42\u5c42\u5f80\u4e0a\u4f20\u9001\u6570\u636e\u62a5\uff0c\u901a\u8fc7\u589e\u52a0 skb-&gt;data \u7684\u503c\uff0c\u6765\u9010\u6b65\u5265\u79bb\u534f\u8bae\u9996\u90e8\u3002</li> <li>\u5f53\u8981\u53d1\u9001\u62a5\u6587\u65f6\uff0c\u521b\u5efa sk_buff \u7ed3\u6784\u4f53\uff0c\u6570\u636e\u7f13\u5b58\u533a\u7684\u5934\u90e8\u9884\u7559\u8db3\u591f\u7684\u7a7a\u95f4\uff0c\u7528\u6765\u586b\u5145\u5404\u5c42\u9996\u90e8\uff0c\u5728\u7ecf\u8fc7\u5404\u4e0b\u5c42\u534f\u8bae\u65f6\uff0c\u901a\u8fc7\u51cf\u5c11 skb-&gt;data \u7684\u503c\u6765\u589e\u52a0\u534f\u8bae\u9996\u90e8\u3002</li> </ul> <p>\u4f60\u53ef\u4ee5\u4ece\u4e0b\u9762\u8fd9\u5f20\u56fe\u770b\u5230\uff0c\u5f53\u53d1\u9001\u62a5\u6587\u65f6\uff0cdata \u6307\u9488\u7684\u79fb\u52a8\u8fc7\u7a0b\u3002</p> <p></p> <p>\u81f3\u6b64\uff0c\u4f20\u8f93\u5c42\u7684\u5de5\u4f5c\u4e5f\u5c31\u90fd\u5b8c\u6210\u4e86\u3002</p> <p>\u7136\u540e\u4ea4\u7ed9\u7f51\u7edc\u5c42\uff0c\u5728\u7f51\u7edc\u5c42\u91cc\u4f1a\u505a\u8fd9\u4e9b\u5de5\u4f5c\uff1a\u9009\u53d6\u8def\u7531\uff08\u786e\u8ba4\u4e0b\u4e00\u8df3\u7684 IP\uff09\u3001\u586b\u5145 IP \u5934\u3001netfilter \u8fc7\u6ee4\u3001\u5bf9\u8d85\u8fc7 MTU \u5927\u5c0f\u7684\u6570\u636e\u5305\u8fdb\u884c\u5206\u7247\u3002\u5904\u7406\u5b8c\u8fd9\u4e9b\u5de5\u4f5c\u540e\u4f1a\u4ea4\u7ed9\u7f51\u7edc\u63a5\u53e3\u5c42\u5904\u7406\u3002</p> <p>\u7f51\u7edc\u63a5\u53e3\u5c42\u4f1a\u901a\u8fc7 ARP \u534f\u8bae\u83b7\u5f97\u4e0b\u4e00\u8df3\u7684 MAC \u5730\u5740\uff0c\u7136\u540e\u5bf9 sk_buff \u586b\u5145\u5e27\u5934\u548c\u5e27\u5c3e\uff0c\u63a5\u7740\u5c06 sk_buff \u653e\u5230\u7f51\u5361\u7684\u53d1\u9001\u961f\u5217\u4e2d\u3002</p> <p>\u8fd9\u4e00\u4e9b\u5de5\u4f5c\u51c6\u5907\u597d\u540e\uff0c\u4f1a\u89e6\u53d1\u300c\u8f6f\u4e2d\u65ad\u300d\u544a\u8bc9\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f\uff0c\u8fd9\u91cc\u6709\u65b0\u7684\u7f51\u7edc\u5305\u9700\u8981\u53d1\u9001\uff0c\u9a71\u52a8\u7a0b\u5e8f\u4f1a\u4ece\u53d1\u9001\u961f\u5217\u4e2d\u8bfb\u53d6 sk_buff\uff0c\u5c06\u8fd9\u4e2a sk_buff \u6302\u5230 RingBuffer \u4e2d\uff0c\u63a5\u7740\u5c06 sk_buff \u6570\u636e\u6620\u5c04\u5230\u7f51\u5361\u53ef\u8bbf\u95ee\u7684\u5185\u5b58 DMA \u533a\u57df\uff0c\u6700\u540e\u89e6\u53d1\u771f\u5b9e\u7684\u53d1\u9001\u3002</p> <p>\u5f53\u6570\u636e\u53d1\u9001\u5b8c\u6210\u4ee5\u540e\uff0c\u5176\u5b9e\u5de5\u4f5c\u5e76\u6ca1\u6709\u7ed3\u675f\uff0c\u56e0\u4e3a\u5185\u5b58\u8fd8\u6ca1\u6709\u6e05\u7406\u3002\u5f53\u53d1\u9001\u5b8c\u6210\u7684\u65f6\u5019\uff0c\u7f51\u5361\u8bbe\u5907\u4f1a\u89e6\u53d1\u4e00\u4e2a\u786c\u4e2d\u65ad\u6765\u91ca\u653e\u5185\u5b58\uff0c\u4e3b\u8981\u662f\u91ca\u653e sk_buff \u5185\u5b58\u548c\u6e05\u7406  RingBuffer \u5185\u5b58\u3002</p> <p>\u6700\u540e\uff0c\u5f53\u6536\u5230\u8fd9\u4e2a TCP \u62a5\u6587\u7684 ACK \u5e94\u7b54\u65f6\uff0c\u4f20\u8f93\u5c42\u5c31\u4f1a\u91ca\u653e\u539f\u59cb\u7684 sk_buff\u3002</p> <p>\u53d1\u9001\u7f51\u7edc\u6570\u636e\u7684\u65f6\u5019\uff0c\u6d89\u53ca\u51e0\u6b21\u5185\u5b58\u62f7\u8d1d\u64cd\u4f5c\uff1f</p> <p>\u7b2c\u4e00\u6b21\uff0c\u8c03\u7528\u53d1\u9001\u6570\u636e\u7684\u7cfb\u7edf\u8c03\u7528\u7684\u65f6\u5019\uff0c\u5185\u6838\u4f1a\u7533\u8bf7\u4e00\u4e2a\u5185\u6838\u6001\u7684 sk_buff \u5185\u5b58\uff0c\u5c06\u7528\u6237\u5f85\u53d1\u9001\u7684\u6570\u636e\u62f7\u8d1d\u5230 sk_buff \u5185\u5b58\uff0c\u5e76\u5c06\u5176\u52a0\u5165\u5230\u53d1\u9001\u7f13\u51b2\u533a\u3002</p> <p>\u7b2c\u4e8c\u6b21\uff0c\u5728\u4f7f\u7528 TCP \u4f20\u8f93\u534f\u8bae\u7684\u60c5\u51b5\u4e0b\uff0c\u4ece\u4f20\u8f93\u5c42\u8fdb\u5165\u7f51\u7edc\u5c42\u7684\u65f6\u5019\uff0c\u6bcf\u4e00\u4e2a sk_buff \u90fd\u4f1a\u88ab\u514b\u9686\u4e00\u4e2a\u65b0\u7684\u526f\u672c\u51fa\u6765\u3002\u526f\u672c sk_buff \u4f1a\u88ab\u9001\u5f80\u7f51\u7edc\u5c42\uff0c\u7b49\u5b83\u53d1\u9001\u5b8c\u7684\u65f6\u5019\u5c31\u4f1a\u91ca\u653e\u6389\uff0c\u7136\u540e\u539f\u59cb\u7684 sk_buff \u8fd8\u4fdd\u7559\u5728\u4f20\u8f93\u5c42\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u5b9e\u73b0 TCP \u7684\u53ef\u9760\u4f20\u8f93\uff0c\u7b49\u6536\u5230\u8fd9\u4e2a\u6570\u636e\u5305\u7684 ACK \u65f6\uff0c\u624d\u4f1a\u91ca\u653e\u539f\u59cb\u7684 sk_buff\u3002</p> <p>\u7b2c\u4e09\u6b21\uff0c\u5f53 IP \u5c42\u53d1\u73b0 sk_buff \u5927\u4e8e MTU \u65f6\u624d\u9700\u8981\u8fdb\u884c\u3002\u4f1a\u518d\u7533\u8bf7\u989d\u5916\u7684 sk_buff\uff0c\u5e76\u5c06\u539f\u6765\u7684 sk_buff \u62f7\u8d1d\u4e3a\u591a\u4e2a\u5c0f\u7684 sk_buff\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/how_os_deal_network_package/#_2","title":"\u603b\u7ed3","text":"<p>\u7535\u8111\u4e0e\u7535\u8111\u4e4b\u95f4\u901a\u5e38\u90fd\u662f\u901a\u8fc7\u8bdd\u7f51\u5361\u3001\u4ea4\u6362\u673a\u3001\u8def\u7531\u5668\u7b49\u7f51\u7edc\u8bbe\u5907\u8fde\u63a5\u5230\u4e00\u8d77\uff0c\u90a3\u7531\u4e8e\u7f51\u7edc\u8bbe\u5907\u7684\u5f02\u6784\u6027\uff0c\u56fd\u9645\u6807\u51c6\u5316\u7ec4\u7ec7\u5b9a\u4e49\u4e86\u4e00\u4e2a\u4e03\u5c42\u7684 OSI \u7f51\u7edc\u6a21\u578b\uff0c\u4f46\u662f\u8fd9\u4e2a\u6a21\u578b\u7531\u4e8e\u6bd4\u8f83\u590d\u6742\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\u5e76\u6ca1\u6709\u91c7\u7528\uff0c\u800c\u662f\u91c7\u7528\u4e86\u66f4\u4e3a\u7b80\u5316\u7684 TCP/IP \u6a21\u578b\uff0cLinux \u7f51\u7edc\u534f\u8bae\u6808\u5c31\u662f\u6309\u7167\u4e86\u8be5\u6a21\u578b\u6765\u5b9e\u73b0\u7684\u3002</p> <p>TCP/IP \u6a21\u578b\u4e3b\u8981\u5206\u4e3a\u5e94\u7528\u5c42\u3001\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\u3001\u7f51\u7edc\u63a5\u53e3\u5c42\u56db\u5c42\uff0c\u6bcf\u4e00\u5c42\u8d1f\u8d23\u7684\u804c\u8d23\u90fd\u4e0d\u540c\uff0c\u8fd9\u4e5f\u662f Linux \u7f51\u7edc\u534f\u8bae\u6808\u4e3b\u8981\u6784\u6210\u90e8\u5206\u3002</p> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7 Socket \u63a5\u53e3\u53d1\u9001\u6570\u636e\u5305\uff0c\u6570\u636e\u5305\u4f1a\u88ab\u7f51\u7edc\u534f\u8bae\u6808\u4ece\u4e0a\u5230\u4e0b\u8fdb\u884c\u9010\u5c42\u5904\u7406\u540e\uff0c\u624d\u4f1a\u88ab\u9001\u5230\u7f51\u5361\u961f\u5217\u4e2d\uff0c\u968f\u540e\u7531\u7f51\u5361\u5c06\u7f51\u7edc\u5305\u53d1\u9001\u51fa\u53bb\u3002</p> <p>\u800c\u5728\u63a5\u6536\u7f51\u7edc\u5305\u65f6\uff0c\u540c\u6837\u4e5f\u8981\u5148\u7ecf\u8fc7\u7f51\u7edc\u534f\u8bae\u6808\u4ece\u4e0b\u5230\u4e0a\u7684\u9010\u5c42\u5904\u7406\uff0c\u6700\u540e\u624d\u4f1a\u88ab\u9001\u5230\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>Linux \u7f51\u7edc\u5305\u53d1\u9001\u8fc7\u7a0b\uff1ahttps://mp.weixin.qq.com/s/wThfD9th9e_-YGHJJ3HXNQ</li> <li>Linux \u7f51\u7edc\u6570\u636e\u63a5\u6536\u6d41\u7a0b\uff08TCP\uff09- NAPI\uff1ahttps://wenfh2020.com/2021/12/29/kernel-tcp-receive/</li> <li>Linux \u7f51\u7edc - \u6570\u636e\u5305\u63a5\u6536\u8fc7\u7a0b\uff1ahttps://blog.csdn.net/frank_jb/article/details/115841622</li> </ul> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u6211\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/tcp_ip_model/","title":"2.1 TCP/IP \u7f51\u7edc\u6a21\u578b\u6709\u54ea\u51e0\u5c42\uff1f","text":"<p>\u95ee\u5927\u5bb6\uff0c\u4e3a\u4ec0\u4e48\u8981\u6709 TCP/IP \u7f51\u7edc\u6a21\u578b\uff1f</p> <p>\u5bf9\u4e8e\u540c\u4e00\u53f0\u8bbe\u5907\u4e0a\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u6709\u5f88\u591a\u79cd\u65b9\u5f0f\uff0c\u6bd4\u5982\u6709\u7ba1\u9053\u3001\u6d88\u606f\u961f\u5217\u3001\u5171\u4eab\u5185\u5b58\u3001\u4fe1\u53f7\u7b49\u65b9\u5f0f\uff0c\u800c\u5bf9\u4e8e\u4e0d\u540c\u8bbe\u5907\u4e0a\u7684\u8fdb\u7a0b\u95f4\u901a\u4fe1\uff0c\u5c31\u9700\u8981\u7f51\u7edc\u901a\u4fe1\uff0c\u800c\u8bbe\u5907\u662f\u591a\u6837\u6027\u7684\uff0c\u6240\u4ee5\u8981\u517c\u5bb9\u591a\u79cd\u591a\u6837\u7684\u8bbe\u5907\uff0c\u5c31\u534f\u5546\u51fa\u4e86\u4e00\u5957\u901a\u7528\u7684\u7f51\u7edc\u534f\u8bae\u3002</p> <p>\u8fd9\u4e2a\u7f51\u7edc\u534f\u8bae\u662f\u5206\u5c42\u7684\uff0c\u6bcf\u4e00\u5c42\u90fd\u6709\u5404\u81ea\u7684\u4f5c\u7528\u548c\u804c\u8d23\uff0c\u63a5\u4e0b\u6765\u5c31\u6839\u636e\u300cTCP/IP \u7f51\u7edc\u6a21\u578b\u300d\u5206\u522b\u5bf9\u6bcf\u4e00\u5c42\u8fdb\u884c\u4ecb\u7ecd\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/tcp_ip_model/#_1","title":"\u5e94\u7528\u5c42","text":"<p>\u6700\u4e0a\u5c42\u7684\uff0c\u4e5f\u662f\u6211\u4eec\u80fd\u76f4\u63a5\u63a5\u89e6\u5230\u7684\u5c31\u662f\u5e94\u7528\u5c42\uff08Application Layer\uff09\uff0c\u6211\u4eec\u7535\u8111\u6216\u624b\u673a\u4f7f\u7528\u7684\u5e94\u7528\u8f6f\u4ef6\u90fd\u662f\u5728\u5e94\u7528\u5c42\u5b9e\u73b0\u3002\u90a3\u4e48\uff0c\u5f53\u4e24\u4e2a\u4e0d\u540c\u8bbe\u5907\u7684\u5e94\u7528\u9700\u8981\u901a\u4fe1\u7684\u65f6\u5019\uff0c\u5e94\u7528\u5c31\u628a\u5e94\u7528\u6570\u636e\u4f20\u7ed9\u4e0b\u4e00\u5c42\uff0c\u4e5f\u5c31\u662f\u4f20\u8f93\u5c42\u3002</p> <p>\u6240\u4ee5\uff0c\u5e94\u7528\u5c42\u53ea\u9700\u8981\u4e13\u6ce8\u4e8e\u4e3a\u7528\u6237\u63d0\u4f9b\u5e94\u7528\u529f\u80fd\uff0c\u6bd4\u5982 HTTP\u3001FTP\u3001Telnet\u3001DNS\u3001SMTP \u7b49\u3002</p> <p>\u5e94\u7528\u5c42\u662f\u4e0d\u7528\u53bb\u5173\u5fc3\u6570\u636e\u662f\u5982\u4f55\u4f20\u8f93\u7684\uff0c\u5c31\u7c7b\u4f3c\u4e8e\uff0c\u6211\u4eec\u5bc4\u5feb\u9012\u7684\u65f6\u5019\uff0c\u53ea\u9700\u8981\u628a\u5305\u88f9\u4ea4\u7ed9\u5feb\u9012\u5458\uff0c\u7531\u4ed6\u8d1f\u8d23\u8fd0\u8f93\u5feb\u9012\uff0c\u6211\u4eec\u4e0d\u9700\u8981\u5173\u5fc3\u5feb\u9012\u662f\u5982\u4f55\u88ab\u8fd0\u8f93\u7684\u3002</p> <p>\u800c\u4e14\u5e94\u7528\u5c42\u662f\u5de5\u4f5c\u5728\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u7528\u6237\u6001\uff0c\u4f20\u8f93\u5c42\u53ca\u4ee5\u4e0b\u5219\u5de5\u4f5c\u5728\u5185\u6838\u6001\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/tcp_ip_model/#_2","title":"\u4f20\u8f93\u5c42","text":"<p>\u5e94\u7528\u5c42\u7684\u6570\u636e\u5305\u4f1a\u4f20\u7ed9\u4f20\u8f93\u5c42\uff0c\u4f20\u8f93\u5c42\uff08Transport Layer\uff09\u662f\u4e3a\u5e94\u7528\u5c42\u63d0\u4f9b\u7f51\u7edc\u652f\u6301\u7684\u3002</p> <p></p> <p>\u5728\u4f20\u8f93\u5c42\u4f1a\u6709\u4e24\u4e2a\u4f20\u8f93\u534f\u8bae\uff0c\u5206\u522b\u662f TCP \u548c UDP\u3002</p> <p>TCP \u7684\u5168\u79f0\u53eb\u4f20\u8f93\u63a7\u5236\u534f\u8bae\uff08Transmission Control Protocol\uff09\uff0c\u5927\u90e8\u5206\u5e94\u7528\u4f7f\u7528\u7684\u6b63\u662f TCP \u4f20\u8f93\u5c42\u534f\u8bae\uff0c\u6bd4\u5982 HTTP \u5e94\u7528\u5c42\u534f\u8bae\u3002TCP \u76f8\u6bd4  UDP \u591a\u4e86\u5f88\u591a\u7279\u6027\uff0c\u6bd4\u5982\u6d41\u91cf\u63a7\u5236\u3001\u8d85\u65f6\u91cd\u4f20\u3001\u62e5\u585e\u63a7\u5236\u7b49\uff0c\u8fd9\u4e9b\u90fd\u662f\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u5305\u80fd\u53ef\u9760\u5730\u4f20\u8f93\u7ed9\u5bf9\u65b9\u3002 </p> <p>UDP \u76f8\u5bf9\u6765\u8bf4\u5c31\u5f88\u7b80\u5355\uff0c\u7b80\u5355\u5230\u53ea\u8d1f\u8d23\u53d1\u9001\u6570\u636e\u5305\uff0c\u4e0d\u4fdd\u8bc1\u6570\u636e\u5305\u662f\u5426\u80fd\u62b5\u8fbe\u5bf9\u65b9\uff0c\u4f46\u5b83\u5b9e\u65f6\u6027\u76f8\u5bf9\u66f4\u597d\uff0c\u4f20\u8f93\u6548\u7387\u4e5f\u9ad8\u3002\u5f53\u7136\uff0cUDP \u4e5f\u53ef\u4ee5\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\uff0c\u628a TCP \u7684\u7279\u6027\u5728\u5e94\u7528\u5c42\u4e0a\u5b9e\u73b0\u5c31\u53ef\u4ee5\uff0c\u4e0d\u8fc7\u8981\u5b9e\u73b0\u4e00\u4e2a\u5546\u7528\u7684\u53ef\u9760 UDP \u4f20\u8f93\u534f\u8bae\uff0c\u4e5f\u4e0d\u662f\u4e00\u4ef6\u7b80\u5355\u7684\u4e8b\u60c5\u3002</p> <p>\u5e94\u7528\u9700\u8981\u4f20\u8f93\u7684\u6570\u636e\u53ef\u80fd\u4f1a\u975e\u5e38\u5927\uff0c\u5982\u679c\u76f4\u63a5\u4f20\u8f93\u5c31\u4e0d\u597d\u63a7\u5236\uff0c\u56e0\u6b64\u5f53\u4f20\u8f93\u5c42\u7684\u6570\u636e\u5305\u5927\u5c0f\u8d85\u8fc7 MSS\uff08TCP \u6700\u5927\u62a5\u6587\u6bb5\u957f\u5ea6\uff09 \uff0c\u5c31\u8981\u5c06\u6570\u636e\u5305\u5206\u5757\uff0c\u8fd9\u6837\u5373\u4f7f\u4e2d\u9014\u6709\u4e00\u4e2a\u5206\u5757\u4e22\u5931\u6216\u635f\u574f\u4e86\uff0c\u53ea\u9700\u8981\u91cd\u65b0\u53d1\u9001\u8fd9\u4e00\u4e2a\u5206\u5757\uff0c\u800c\u4e0d\u7528\u91cd\u65b0\u53d1\u9001\u6574\u4e2a\u6570\u636e\u5305\u3002\u5728 TCP \u534f\u8bae\u4e2d\uff0c\u6211\u4eec\u628a\u6bcf\u4e2a\u5206\u5757\u79f0\u4e3a\u4e00\u4e2a TCP \u6bb5\uff08TCP Segment\uff09\u3002</p> <p></p> <p>\u5f53\u8bbe\u5907\u4f5c\u4e3a\u63a5\u6536\u65b9\u65f6\uff0c\u4f20\u8f93\u5c42\u5219\u8981\u8d1f\u8d23\u628a\u6570\u636e\u5305\u4f20\u7ed9\u5e94\u7528\uff0c\u4f46\u662f\u4e00\u53f0\u8bbe\u5907\u4e0a\u53ef\u80fd\u4f1a\u6709\u5f88\u591a\u5e94\u7528\u5728\u63a5\u6536\u6216\u8005\u4f20\u8f93\u6570\u636e\uff0c\u56e0\u6b64\u9700\u8981\u7528\u4e00\u4e2a\u7f16\u53f7\u5c06\u5e94\u7528\u533a\u5206\u5f00\u6765\uff0c\u8fd9\u4e2a\u7f16\u53f7\u5c31\u662f\u7aef\u53e3\u3002</p> <p>\u6bd4\u5982 80 \u7aef\u53e3\u901a\u5e38\u662f Web \u670d\u52a1\u5668\u7528\u7684\uff0c22 \u7aef\u53e3\u901a\u5e38\u662f\u8fdc\u7a0b\u767b\u5f55\u670d\u52a1\u5668\u7528\u7684\u3002\u800c\u5bf9\u4e8e\u6d4f\u89c8\u5668\uff08\u5ba2\u6237\u7aef\uff09\u4e2d\u7684\u6bcf\u4e2a\u6807\u7b7e\u680f\u90fd\u662f\u4e00\u4e2a\u72ec\u7acb\u7684\u8fdb\u7a0b\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u4e3a\u8fd9\u4e9b\u8fdb\u7a0b\u5206\u914d\u4e34\u65f6\u7684\u7aef\u53e3\u53f7\u3002</p> <p>\u7531\u4e8e\u4f20\u8f93\u5c42\u7684\u62a5\u6587\u4e2d\u4f1a\u643a\u5e26\u7aef\u53e3\u53f7\uff0c\u56e0\u6b64\u63a5\u6536\u65b9\u53ef\u4ee5\u8bc6\u522b\u51fa\u8be5\u62a5\u6587\u662f\u53d1\u9001\u7ed9\u54ea\u4e2a\u5e94\u7528\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/tcp_ip_model/#_3","title":"\u7f51\u7edc\u5c42","text":"<p>\u4f20\u8f93\u5c42\u53ef\u80fd\u5927\u5bb6\u521a\u63a5\u89e6\u7684\u65f6\u5019\uff0c\u4f1a\u8ba4\u4e3a\u5b83\u8d1f\u8d23\u5c06\u6570\u636e\u4ece\u4e00\u4e2a\u8bbe\u5907\u4f20\u8f93\u5230\u53e6\u4e00\u4e2a\u8bbe\u5907\uff0c\u4e8b\u5b9e\u4e0a\u5b83\u5e76\u4e0d\u8d1f\u8d23\u3002</p> <p>\u5b9e\u9645\u573a\u666f\u4e2d\u7684\u7f51\u7edc\u73af\u8282\u662f\u9519\u7efc\u590d\u6742\u7684\uff0c\u4e2d\u95f4\u6709\u5404\u79cd\u5404\u6837\u7684\u7ebf\u8def\u548c\u5206\u53c9\u8def\u53e3\uff0c\u5982\u679c\u4e00\u4e2a\u8bbe\u5907\u7684\u6570\u636e\u8981\u4f20\u8f93\u7ed9\u53e6\u4e00\u4e2a\u8bbe\u5907\uff0c\u5c31\u9700\u8981\u5728\u5404\u79cd\u5404\u6837\u7684\u8def\u5f84\u548c\u8282\u70b9\u8fdb\u884c\u9009\u62e9\uff0c\u800c\u4f20\u8f93\u5c42\u7684\u8bbe\u8ba1\u7406\u5ff5\u662f\u7b80\u5355\u3001\u9ad8\u6548\u3001\u4e13\u6ce8\uff0c\u5982\u679c\u4f20\u8f93\u5c42\u8fd8\u8d1f\u8d23\u8fd9\u4e00\u5757\u529f\u80fd\u5c31\u6709\u70b9\u8fdd\u80cc\u8bbe\u8ba1\u539f\u5219\u4e86\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u4e0d\u5e0c\u671b\u4f20\u8f93\u5c42\u534f\u8bae\u5904\u7406\u592a\u591a\u7684\u4e8b\u60c5\uff0c\u53ea\u9700\u8981\u670d\u52a1\u597d\u5e94\u7528\u5373\u53ef\uff0c\u8ba9\u5176\u4f5c\u4e3a\u5e94\u7528\u95f4\u6570\u636e\u4f20\u8f93\u7684\u5a92\u4ecb\uff0c\u5e2e\u52a9\u5b9e\u73b0\u5e94\u7528\u5230\u5e94\u7528\u7684\u901a\u4fe1\uff0c\u800c\u5b9e\u9645\u7684\u4f20\u8f93\u529f\u80fd\u5c31\u4ea4\u7ed9\u4e0b\u4e00\u5c42\uff0c\u4e5f\u5c31\u662f\u7f51\u7edc\u5c42\uff08Internet Layer\uff09\u3002</p> <p></p> <p>\u7f51\u7edc\u5c42\u6700\u5e38\u4f7f\u7528\u7684\u662f IP \u534f\u8bae\uff08Internet Protocol\uff09\uff0cIP \u534f\u8bae\u4f1a\u5c06\u4f20\u8f93\u5c42\u7684\u62a5\u6587\u4f5c\u4e3a\u6570\u636e\u90e8\u5206\uff0c\u518d\u52a0\u4e0a IP \u62a5\u5934\u7ec4\u88c5\u6210 IP \u62a5\u6587\uff0c\u5982\u679c IP \u62a5\u6587\u5927\u5c0f\u8d85\u8fc7 MTU\uff08\u4ee5\u592a\u7f51\u4e2d\u4e00\u822c\u4e3a 1500 \u5b57\u8282\uff09\u5c31\u4f1a\u518d\u6b21\u8fdb\u884c\u5206\u7247\uff0c\u5f97\u5230\u4e00\u4e2a\u5373\u5c06\u53d1\u9001\u5230\u7f51\u7edc\u7684 IP \u62a5\u6587\u3002</p> <p></p> <p>\u7f51\u7edc\u5c42\u8d1f\u8d23\u5c06\u6570\u636e\u4ece\u4e00\u4e2a\u8bbe\u5907\u4f20\u8f93\u5230\u53e6\u4e00\u4e2a\u8bbe\u5907\uff0c\u4e16\u754c\u4e0a\u90a3\u4e48\u591a\u8bbe\u5907\uff0c\u53c8\u8be5\u5982\u4f55\u627e\u5230\u5bf9\u65b9\u5462\uff1f\u56e0\u6b64\uff0c\u7f51\u7edc\u5c42\u9700\u8981\u6709\u533a\u5206\u8bbe\u5907\u7684\u7f16\u53f7\u3002</p> <p>\u6211\u4eec\u4e00\u822c\u7528 IP \u5730\u5740\u7ed9\u8bbe\u5907\u8fdb\u884c\u7f16\u53f7\uff0c\u5bf9\u4e8e IPv4 \u534f\u8bae\uff0cIP \u5730\u5740\u5171 32 \u4f4d\uff0c\u5206\u6210\u4e86\u56db\u6bb5\uff08\u6bd4\u5982\uff0c192.168.100.1\uff09\uff0c\u6bcf\u6bb5\u662f 8 \u4f4d\u3002\u53ea\u6709\u4e00\u4e2a\u5355\u7eaf\u7684 IP \u5730\u5740\u867d\u7136\u505a\u5230\u4e86\u533a\u5206\u8bbe\u5907\uff0c\u4f46\u662f\u5bfb\u5740\u8d77\u6765\u5c31\u7279\u522b\u9ebb\u70e6\uff0c\u5168\u4e16\u754c\u90a3\u4e48\u591a\u53f0\u8bbe\u5907\uff0c\u96be\u9053\u4e00\u4e2a\u4e00\u4e2a\u53bb\u5339\u914d\uff1f\u8fd9\u663e\u7136\u4e0d\u79d1\u5b66\u3002</p> <p>\u56e0\u6b64\uff0c\u9700\u8981\u5c06 IP \u5730\u5740\u5206\u6210\u4e24\u79cd\u610f\u4e49\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f\u7f51\u7edc\u53f7\uff0c\u8d1f\u8d23\u6807\u8bc6\u8be5 IP \u5730\u5740\u662f\u5c5e\u4e8e\u54ea\u4e2a\u300c\u5b50\u7f51\u300d\u7684\uff1b</li> <li>\u4e00\u4e2a\u662f\u4e3b\u673a\u53f7\uff0c\u8d1f\u8d23\u6807\u8bc6\u540c\u4e00\u300c\u5b50\u7f51\u300d\u4e0b\u7684\u4e0d\u540c\u4e3b\u673a\uff1b</li> </ul> <p>\u600e\u4e48\u5206\u7684\u5462\uff1f\u8fd9\u9700\u8981\u914d\u5408\u5b50\u7f51\u63a9\u7801\u624d\u80fd\u7b97\u51fa IP \u5730\u5740 \u7684\u7f51\u7edc\u53f7\u548c\u4e3b\u673a\u53f7\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982 10.100.122.0/24\uff0c\u540e\u9762\u7684<code>/24</code>\u8868\u793a\u5c31\u662f <code>255.255.255.0</code> \u5b50\u7f51\u63a9\u7801\uff0c255.255.255.0 \u4e8c\u8fdb\u5236\u662f\u300c11111111-11111111-11111111-00000000\u300d\uff0c\u5927\u5bb6\u6570\u6570\u4e00\u5171\u591a\u5c11\u4e2a 1\uff1f\u4e0d\u7528\u6570\u4e86\uff0c\u662f 24 \u4e2a 1\uff0c\u4e3a\u4e86\u7b80\u5316\u5b50\u7f51\u63a9\u7801\u7684\u8868\u793a\uff0c\u7528/24 \u4ee3\u66ff 255.255.255.0\u3002</p> <p>\u77e5\u9053\u4e86\u5b50\u7f51\u63a9\u7801\uff0c\u8be5\u600e\u4e48\u8ba1\u7b97\u51fa\u7f51\u7edc\u5730\u5740\u548c\u4e3b\u673a\u5730\u5740\u5462\uff1f</p> <p>\u5c06 10.100.122.2 \u548c 255.255.255.0 \u8fdb\u884c\u6309\u4f4d\u4e0e\u8fd0\u7b97\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u7f51\u7edc\u53f7\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5c06 255.255.255.0 \u53d6\u53cd\u540e\u4e0e IP \u5730\u5740\u8fdb\u884c\u8fdb\u884c\u6309\u4f4d\u4e0e\u8fd0\u7b97\uff0c\u5c31\u53ef\u4ee5\u5f97\u5230\u4e3b\u673a\u53f7\u3002</p> <p>\u5927\u5bb6\u53ef\u4ee5\u53bb\u641c\u7d22\u4e0b\u5b50\u7f51\u63a9\u7801\u8ba1\u7b97\u5668\uff0c\u81ea\u5df1\u6539\u53d8\u4e0b\u300c\u63a9\u7801\u4f4d\u300d\u7684\u6570\u503c\uff0c\u5c31\u80fd\u4f53\u4f1a\u5230\u5b50\u7f51\u63a9\u7801\u7684\u4f5c\u7528\u4e86\u3002</p> <p></p> <p>\u90a3\u4e48\u5728\u5bfb\u5740\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5148\u5339\u914d\u5230\u76f8\u540c\u7684\u7f51\u7edc\u53f7\uff08\u8868\u793a\u8981\u627e\u5230\u540c\u4e00\u4e2a\u5b50\u7f51\uff09\uff0c\u624d\u4f1a\u53bb\u627e\u5bf9\u5e94\u7684\u4e3b\u673a\u3002</p> <p>\u9664\u4e86\u5bfb\u5740\u80fd\u529b\uff0cIP \u534f\u8bae\u8fd8\u6709\u53e6\u4e00\u4e2a\u91cd\u8981\u7684\u80fd\u529b\u5c31\u662f\u8def\u7531\u3002\u5b9e\u9645\u573a\u666f\u4e2d\uff0c\u4e24\u53f0\u8bbe\u5907\u5e76\u4e0d\u662f\u7528\u4e00\u6761\u7f51\u7ebf\u8fde\u63a5\u8d77\u6765\u7684\uff0c\u800c\u662f\u901a\u8fc7\u5f88\u591a\u7f51\u5173\u3001\u8def\u7531\u5668\u3001\u4ea4\u6362\u673a\u7b49\u4f17\u591a\u7f51\u7edc\u8bbe\u5907\u8fde\u63a5\u8d77\u6765\u7684\uff0c\u90a3\u4e48\u5c31\u4f1a\u5f62\u6210\u5f88\u591a\u6761\u7f51\u7edc\u7684\u8def\u5f84\uff0c\u56e0\u6b64\u5f53\u6570\u636e\u5305\u5230\u8fbe\u4e00\u4e2a\u7f51\u7edc\u8282\u70b9\uff0c\u5c31\u9700\u8981\u901a\u8fc7\u8def\u7531\u7b97\u6cd5\u51b3\u5b9a\u4e0b\u4e00\u6b65\u8d70\u54ea\u6761\u8def\u5f84\u3002</p> <p>\u8def\u7531\u5668\u5bfb\u5740\u5de5\u4f5c\u4e2d\uff0c\u5c31\u662f\u8981\u627e\u5230\u76ee\u6807\u5730\u5740\u7684\u5b50\u7f51\uff0c\u627e\u5230\u540e\u8fdb\u800c\u628a\u6570\u636e\u5305\u8f6c\u53d1\u7ed9\u5bf9\u5e94\u7684\u7f51\u7edc\u5185\u3002</p> <p></p> <p>\u6240\u4ee5\uff0cIP \u534f\u8bae\u7684\u5bfb\u5740\u4f5c\u7528\u662f\u544a\u8bc9\u6211\u4eec\u53bb\u5f80\u4e0b\u4e00\u4e2a\u76ee\u7684\u5730\u8be5\u671d\u54ea\u4e2a\u65b9\u5411\u8d70\uff0c\u8def\u7531\u5219\u662f\u6839\u636e\u300c\u4e0b\u4e00\u4e2a\u76ee\u7684\u5730\u300d\u9009\u62e9\u8def\u5f84\u3002\u5bfb\u5740\u66f4\u50cf\u5728\u5bfc\u822a\uff0c\u8def\u7531\u66f4\u50cf\u5728\u64cd\u4f5c\u65b9\u5411\u76d8\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/tcp_ip_model/#_4","title":"\u7f51\u7edc\u63a5\u53e3\u5c42","text":"<p>\u751f\u6210\u4e86 IP \u5934\u90e8\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u8981\u4ea4\u7ed9\u7f51\u7edc\u63a5\u53e3\u5c42\uff08Link Layer\uff09\u5728 IP \u5934\u90e8\u7684\u524d\u9762\u52a0\u4e0a MAC \u5934\u90e8\uff0c\u5e76\u5c01\u88c5\u6210\u6570\u636e\u5e27\uff08Data frame\uff09\u53d1\u9001\u5230\u7f51\u7edc\u4e0a\u3002</p> <p></p> <p>IP \u5934\u90e8\u4e2d\u7684\u63a5\u6536\u65b9 IP \u5730\u5740\u8868\u793a\u7f51\u7edc\u5305\u7684\u76ee\u7684\u5730\uff0c\u901a\u8fc7\u8fd9\u4e2a\u5730\u5740\u6211\u4eec\u5c31\u53ef\u4ee5\u5224\u65ad\u8981\u5c06\u5305\u53d1\u5230\u54ea\u91cc\uff0c\u4f46\u5728\u4ee5\u592a\u7f51\u7684\u4e16\u754c\u4e2d\uff0c\u8fd9\u4e2a\u601d\u8def\u662f\u884c\u4e0d\u901a\u7684\u3002</p> <p>\u4ec0\u4e48\u662f\u4ee5\u592a\u7f51\u5462\uff1f\u7535\u8111\u4e0a\u7684\u4ee5\u592a\u7f51\u63a5\u53e3\uff0cWi-Fi \u63a5\u53e3\uff0c\u4ee5\u592a\u7f51\u4ea4\u6362\u673a\u3001\u8def\u7531\u5668\u4e0a\u7684\u5343\u5146\uff0c\u4e07\u5146\u4ee5\u592a\u7f51\u53e3\uff0c\u8fd8\u6709\u7f51\u7ebf\uff0c\u5b83\u4eec\u90fd\u662f\u4ee5\u592a\u7f51\u7684\u7ec4\u6210\u90e8\u5206\u3002\u4ee5\u592a\u7f51\u5c31\u662f\u4e00\u79cd\u5728\u300c\u5c40\u57df\u7f51\u300d\u5185\uff0c\u628a\u9644\u8fd1\u7684\u8bbe\u5907\u8fde\u63a5\u8d77\u6765\uff0c\u4f7f\u5b83\u4eec\u4e4b\u95f4\u53ef\u4ee5\u8fdb\u884c\u901a\u8baf\u7684\u6280\u672f\u3002</p> <p>\u4ee5\u592a\u7f51\u5728\u5224\u65ad\u7f51\u7edc\u5305\u76ee\u7684\u5730\u65f6\u548c IP \u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u56e0\u6b64\u5fc5\u987b\u91c7\u7528\u76f8\u5339\u914d\u7684\u65b9\u5f0f\u624d\u80fd\u5728\u4ee5\u592a\u7f51\u4e2d\u5c06\u5305\u53d1\u5f80\u76ee\u7684\u5730\uff0c\u800c MAC \u5934\u90e8\u5c31\u662f\u5e72\u8fd9\u4e2a\u7528\u7684\uff0c\u6240\u4ee5\uff0c\u5728\u4ee5\u592a\u7f51\u8fdb\u884c\u901a\u8baf\u8981\u7528\u5230 MAC \u5730\u5740\u3002</p> <p>MAC \u5934\u90e8\u662f\u4ee5\u592a\u7f51\u4f7f\u7528\u7684\u5934\u90e8\uff0c\u5b83\u5305\u542b\u4e86\u63a5\u6536\u65b9\u548c\u53d1\u9001\u65b9\u7684 MAC \u5730\u5740\u7b49\u4fe1\u606f\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ARP \u534f\u8bae\u83b7\u53d6\u5bf9\u65b9\u7684 MAC \u5730\u5740\u3002</p> <p>\u6240\u4ee5\u8bf4\uff0c\u7f51\u7edc\u63a5\u53e3\u5c42\u4e3b\u8981\u4e3a\u7f51\u7edc\u5c42\u63d0\u4f9b\u300c\u94fe\u8def\u7ea7\u522b\u300d\u4f20\u8f93\u7684\u670d\u52a1\uff0c\u8d1f\u8d23\u5728\u4ee5\u592a\u7f51\u3001WiFi \u8fd9\u6837\u7684\u5e95\u5c42\u7f51\u7edc\u4e0a\u53d1\u9001\u539f\u59cb\u6570\u636e\u5305\uff0c\u5de5\u4f5c\u5728\u7f51\u5361\u8fd9\u4e2a\u5c42\u6b21\uff0c\u4f7f\u7528 MAC \u5730\u5740\u6765\u6807\u8bc6\u7f51\u7edc\u4e0a\u7684\u8bbe\u5907\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/tcp_ip_model/#_5","title":"\u603b\u7ed3","text":"<p>\u7efc\u4e0a\u6240\u8ff0\uff0cTCP/IP \u7f51\u7edc\u901a\u5e38\u662f\u7531\u4e0a\u5230\u4e0b\u5206\u6210 4 \u5c42\uff0c\u5206\u522b\u662f\u5e94\u7528\u5c42\uff0c\u4f20\u8f93\u5c42\uff0c\u7f51\u7edc\u5c42\u548c\u7f51\u7edc\u63a5\u53e3\u5c42\u3002</p> <p></p> <p>\u518d\u7ed9\u5927\u5bb6\u8d34\u4e00\u4e0b\u6bcf\u4e00\u5c42\u7684\u5c01\u88c5\u683c\u5f0f\uff1a</p> <p></p> <p>\u7f51\u7edc\u63a5\u53e3\u5c42\u7684\u4f20\u8f93\u5355\u4f4d\u662f\u5e27\uff08frame\uff09\uff0cIP \u5c42\u7684\u4f20\u8f93\u5355\u4f4d\u662f\u5305\uff08packet\uff09\uff0cTCP \u5c42\u7684\u4f20\u8f93\u5355\u4f4d\u662f\u6bb5\uff08segment\uff09\uff0cHTTP \u7684\u4f20\u8f93\u5355\u4f4d\u5219\u662f\u6d88\u606f\u6216\u62a5\u6587\uff08message\uff09\u3002\u4f46\u8fd9\u4e9b\u540d\u8bcd\u5e76\u6ca1\u6709\u4ec0\u4e48\u672c\u8d28\u7684\u533a\u5206\uff0c\u53ef\u4ee5\u7edf\u79f0\u4e3a\u6570\u636e\u5305\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/","title":"2.2 \u952e\u5165\u7f51\u5740\u5230\u7f51\u9875\u663e\u793a\uff0c\u671f\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f","text":"<p>\u60f3\u5fc5\u4e0d\u5c11\u5c0f\u4f19\u4f34\u9762\u8bd5\u8fc7\u7a0b\u4e2d\uff0c\u4f1a\u9047\u5230\u300c\u5f53\u952e\u5165\u7f51\u5740\u540e\uff0c\u5230\u7f51\u9875\u663e\u793a\uff0c\u5176\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\u300d\u7684\u9762\u8bd5\u9898\u3002</p> <p>\u8fd8\u522b\u8bf4\uff0c\u8fd9\u95ee\u9898\u771f\u633a\u5e38\u95ee\u7684\uff0c\u524d\u51e0\u5929\u5750\u5728\u6211\u65c1\u8fb9\u7684\u4e3b\u7ba1\u7535\u8bdd\u9762\u8bd5\u5e94\u8058\u8005\u7684\u65f6\u5019\uff0c\u4e5f\u95ee\u4e86\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u63a5\u4e0b\u6765\u4ee5\u4e0b\u56fe\u8f83\u7b80\u5355\u7684\u7f51\u7edc\u62d3\u6251\u6a21\u578b\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u63a2\u7a76\u63a2\u7a76\u5176\u95f4\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#http","title":"\u5b64\u5355\u5c0f\u5f1f \u2014\u2014 HTTP","text":"<p>\u6d4f\u89c8\u5668\u505a\u7684\u7b2c\u4e00\u6b65\u5de5\u4f5c\u662f\u89e3\u6790 URL</p> <p>\u9996\u5148\u6d4f\u89c8\u5668\u505a\u7684\u7b2c\u4e00\u6b65\u5de5\u4f5c\u5c31\u662f\u8981\u5bf9 <code>URL</code> \u8fdb\u884c\u89e3\u6790\uff0c\u4ece\u800c\u751f\u6210\u53d1\u9001\u7ed9 <code>Web</code> \u670d\u52a1\u5668\u7684\u8bf7\u6c42\u4fe1\u606f\u3002</p> <p>\u8ba9\u6211\u4eec\u770b\u770b\u4e00\u6761\u957f\u957f\u7684 URL \u91cc\u7684\u5404\u4e2a\u5143\u7d20\u7684\u4ee3\u8868\u4ec0\u4e48\uff0c\u89c1\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6240\u4ee5\u56fe\u4e2d\u7684\u957f\u957f\u7684 URL \u5b9e\u9645\u4e0a\u662f\u8bf7\u6c42\u670d\u52a1\u5668\u91cc\u7684\u6587\u4ef6\u8d44\u6e90\u3002</p> <p>\u8981\u662f\u4e0a\u56fe\u4e2d\u7684\u84dd\u8272\u90e8\u5206 URL \u5143\u7d20\u90fd\u7701\u7565\u4e86\uff0c\u90a3\u5e94\u8be5\u662f\u8bf7\u6c42\u54ea\u4e2a\u6587\u4ef6\u5462\uff1f</p> <p>\u5f53\u6ca1\u6709\u8def\u5f84\u540d\u65f6\uff0c\u5c31\u4ee3\u8868\u8bbf\u95ee\u6839\u76ee\u5f55\u4e0b\u4e8b\u5148\u8bbe\u7f6e\u7684\u9ed8\u8ba4\u6587\u4ef6\uff0c\u4e5f\u5c31\u662f <code>/index.html</code> \u6216\u8005 <code>/default.html</code> \u8fd9\u4e9b\u6587\u4ef6\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u53d1\u751f\u6df7\u4e71\u4e86\u3002</p> <p>\u751f\u4ea7 HTTP \u8bf7\u6c42\u4fe1\u606f</p> <p>\u5bf9 <code>URL</code> \u8fdb\u884c\u89e3\u6790\u4e4b\u540e\uff0c\u6d4f\u89c8\u5668\u786e\u5b9a\u4e86 Web \u670d\u52a1\u5668\u548c\u6587\u4ef6\u540d\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u6839\u636e\u8fd9\u4e9b\u4fe1\u606f\u6765\u751f\u6210 HTTP \u8bf7\u6c42\u6d88\u606f\u4e86\u3002</p> <p></p> <p>\u4e00\u4e2a\u5b64\u5355 HTTP \u6570\u636e\u5305\u8868\u793a\uff1a\u201c\u6211\u8fd9\u4e48\u4e00\u4e2a\u5c0f\u5c0f\u7684\u6570\u636e\u5305\uff0c\u6ca1\u4eb2\u6ca1\u53cb\uff0c\u76f4\u63a5\u53d1\u5230\u6d69\u701a\u7684\u7f51\u7edc\uff0c\u8c01\u4f1a\u77e5\u9053\u6211\u5462\uff1f\u8c01\u80fd\u8f7d\u6211\u4e00\u7a0b\u5462\uff1f\u8c01\u80fd\u4fdd\u62a4\u6211\u5462\uff1f\u6211\u7684\u76ee\u7684\u5730\u5728\u54ea\u5462\uff1f\u201d\u5145\u6ee1\u5404\u79cd\u7591\u95ee\u7684\u5b83\uff0c\u6ca1\u6709\u505c\u6ede\u4e0d\u524d\uff0c\u4f9d\u7136\u8e0f\u4e0a\u4e86\u5f81\u9014\uff01</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#dns","title":"\u771f\u5b9e\u5730\u5740\u67e5\u8be2 \u2014\u2014 DNS","text":"<p>\u901a\u8fc7\u6d4f\u89c8\u5668\u89e3\u6790 URL \u5e76\u751f\u6210 HTTP \u6d88\u606f\u540e\uff0c\u9700\u8981\u59d4\u6258\u64cd\u4f5c\u7cfb\u7edf\u5c06\u6d88\u606f\u53d1\u9001\u7ed9 <code>Web</code>  \u670d\u52a1\u5668\u3002</p> <p>\u4f46\u5728\u53d1\u9001\u4e4b\u524d\uff0c\u8fd8\u6709\u4e00\u9879\u5de5\u4f5c\u9700\u8981\u5b8c\u6210\uff0c\u90a3\u5c31\u662f\u67e5\u8be2\u670d\u52a1\u5668\u57df\u540d\u5bf9\u5e94\u7684 IP \u5730\u5740\uff0c\u56e0\u4e3a\u59d4\u6258\u64cd\u4f5c\u7cfb\u7edf\u53d1\u9001\u6d88\u606f\u65f6\uff0c\u5fc5\u987b\u63d0\u4f9b\u901a\u4fe1\u5bf9\u8c61\u7684 IP \u5730\u5740\u3002</p> <p>\u6bd4\u5982\u6211\u4eec\u6253\u7535\u8bdd\u7684\u65f6\u5019\uff0c\u5fc5\u987b\u8981\u77e5\u9053\u5bf9\u65b9\u7684\u7535\u8bdd\u53f7\u7801\uff0c\u4f46\u7531\u4e8e\u7535\u8bdd\u53f7\u7801\u96be\u4ee5\u8bb0\u5fc6\uff0c\u6240\u4ee5\u901a\u5e38\u6211\u4eec\u4f1a\u5c06\u5bf9\u65b9\u7535\u8bdd\u53f7 + \u59d3\u540d\u4fdd\u5b58\u5728\u901a\u8baf\u5f55\u91cc\u3002</p> <p>\u6240\u4ee5\uff0c\u6709\u4e00\u79cd\u670d\u52a1\u5668\u5c31\u4e13\u95e8\u4fdd\u5b58\u4e86 <code>Web</code> \u670d\u52a1\u5668\u57df\u540d\u4e0e <code>IP</code> \u7684\u5bf9\u5e94\u5173\u7cfb\uff0c\u5b83\u5c31\u662f <code>DNS</code> \u670d\u52a1\u5668\u3002</p> <p>\u57df\u540d\u7684\u5c42\u7ea7\u5173\u7cfb</p> <p>DNS \u4e2d\u7684\u57df\u540d\u90fd\u662f\u7528\u53e5\u70b9\u6765\u5206\u9694\u7684\uff0c\u6bd4\u5982 <code>www.server.com</code>\uff0c\u8fd9\u91cc\u7684\u53e5\u70b9\u4ee3\u8868\u4e86\u4e0d\u540c\u5c42\u6b21\u4e4b\u95f4\u7684\u754c\u9650\u3002</p> <p>\u5728\u57df\u540d\u4e2d\uff0c\u8d8a\u9760\u53f3\u7684\u4f4d\u7f6e\u8868\u793a\u5176\u5c42\u7ea7\u8d8a\u9ad8\u3002</p> <p>\u6bd5\u7adf\u57df\u540d\u662f\u5916\u56fd\u4eba\u53d1\u660e\uff0c\u6240\u4ee5\u601d\u7ef4\u548c\u4e2d\u56fd\u4eba\u76f8\u53cd\uff0c\u6bd4\u5982\u8bf4\u4e00\u4e2a\u57ce\u5e02\u5730\u70b9\u7684\u65f6\u5019\uff0c\u5916\u56fd\u559c\u6b22\u4ece\u5c0f\u5230\u5927\u7684\u65b9\u5f0f\u987a\u5e8f\u8bf4\u8d77\uff08\u5982 XX \u8857\u9053 XX \u533a XX \u5e02 XX \u7701\uff09\uff0c\u800c\u4e2d\u56fd\u5219\u559c\u6b22\u4ece\u5927\u5230\u5c0f\u7684\u987a\u5e8f\uff08\u5982 XX \u7701 XX \u5e02 XX \u533a XX \u8857\u9053\uff09\u3002</p> <p>\u5b9e\u9645\u4e0a\u57df\u540d\u6700\u540e\u8fd8\u6709\u4e00\u4e2a\u70b9\uff0c\u6bd4\u5982 <code>www.server.com.</code>\uff0c\u8fd9\u4e2a\u6700\u540e\u7684\u4e00\u4e2a\u70b9\u4ee3\u8868\u6839\u57df\u540d\u3002</p> <p>\u4e5f\u5c31\u662f\uff0c<code>.</code> \u6839\u57df\u662f\u5728\u6700\u9876\u5c42\uff0c\u5b83\u7684\u4e0b\u4e00\u5c42\u5c31\u662f <code>.com</code> \u9876\u7ea7\u57df\uff0c\u518d\u4e0b\u9762\u662f <code>server.com</code>\u3002</p> <p>\u6240\u4ee5\u57df\u540d\u7684\u5c42\u7ea7\u5173\u7cfb\u7c7b\u4f3c\u4e00\u4e2a\u6811\u72b6\u7ed3\u6784\uff1a</p> <ul> <li>\u6839 DNS \u670d\u52a1\u5668\uff08.\uff09</li> <li>\u9876\u7ea7\u57df DNS \u670d\u52a1\u5668\uff08.com\uff09</li> <li>\u6743\u5a01 DNS \u670d\u52a1\u5668\uff08server.com\uff09</li> </ul> <p></p> <p>\u6839\u57df\u7684 DNS \u670d\u52a1\u5668\u4fe1\u606f\u4fdd\u5b58\u5728\u4e92\u8054\u7f51\u4e2d\u6240\u6709\u7684 DNS \u670d\u52a1\u5668\u4e2d\u3002</p> <p>\u8fd9\u6837\u4e00\u6765\uff0c\u4efb\u4f55 DNS \u670d\u52a1\u5668\u5c31\u90fd\u53ef\u4ee5\u627e\u5230\u5e76\u8bbf\u95ee\u6839\u57df DNS \u670d\u52a1\u5668\u4e86\u3002</p> <p>\u56e0\u6b64\uff0c\u5ba2\u6237\u7aef\u53ea\u8981\u80fd\u591f\u627e\u5230\u4efb\u610f\u4e00\u53f0 DNS \u670d\u52a1\u5668\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u5b83\u627e\u5230\u6839\u57df DNS \u670d\u52a1\u5668\uff0c\u7136\u540e\u518d\u4e00\u8def\u987a\u85e4\u6478\u74dc\u627e\u5230\u4f4d\u4e8e\u4e0b\u5c42\u7684\u67d0\u53f0\u76ee\u6807 DNS \u670d\u52a1\u5668\u3002</p> <p>\u57df\u540d\u89e3\u6790\u7684\u5de5\u4f5c\u6d41\u7a0b</p> <ol> <li>\u5ba2\u6237\u7aef\u9996\u5148\u4f1a\u53d1\u51fa\u4e00\u4e2a DNS \u8bf7\u6c42\uff0c\u95ee www.server.com \u7684 IP \u662f\u5565\uff0c\u5e76\u53d1\u7ed9\u672c\u5730 DNS \u670d\u52a1\u5668\uff08\u4e5f\u5c31\u662f\u5ba2\u6237\u7aef\u7684 TCP/IP \u8bbe\u7f6e\u4e2d\u586b\u5199\u7684 DNS \u670d\u52a1\u5668\u5730\u5740\uff09\u3002</li> <li>\u672c\u5730\u57df\u540d\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u540e\uff0c\u5982\u679c\u7f13\u5b58\u91cc\u7684\u8868\u683c\u80fd\u627e\u5230 www.server.com\uff0c\u5219\u5b83\u76f4\u63a5\u8fd4\u56de IP \u5730\u5740\u3002\u5982\u679c\u6ca1\u6709\uff0c\u672c\u5730 DNS \u4f1a\u53bb\u95ee\u5b83\u7684\u6839\u57df\u540d\u670d\u52a1\u5668\uff1a\u201c\u8001\u5927\uff0c\u80fd\u544a\u8bc9\u6211 www.server.com \u7684 IP \u5730\u5740\u5417\uff1f\u201d\u6839\u57df\u540d\u670d\u52a1\u5668\u662f\u6700\u9ad8\u5c42\u6b21\u7684\uff0c\u5b83\u4e0d\u76f4\u63a5\u7528\u4e8e\u57df\u540d\u89e3\u6790\uff0c\u4f46\u80fd\u6307\u660e\u4e00\u6761\u9053\u8def\u3002 </li> <li>\u6839 DNS \u6536\u5230\u6765\u81ea\u672c\u5730 DNS \u7684\u8bf7\u6c42\u540e\uff0c\u53d1\u73b0\u540e\u7f6e\u662f .com\uff0c\u8bf4\uff1a\u201cwww.server.com \u8fd9\u4e2a\u57df\u540d\u5f52 .com \u533a\u57df\u7ba1\u7406\u201d\uff0c\u6211\u628a .com \u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\u7684\u5730\u5740\u7ed9\u4f60\uff0c\u4f60\u53bb\u95ee\u95ee\u5b83\u5427\u3002\u201d</li> <li>\u672c\u5730 DNS \u6536\u5230\u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\u7684\u5730\u5740\u540e\uff0c\u53d1\u8d77\u8bf7\u6c42\u95ee\u201c\u8001\u4e8c\uff0c\u4f60\u80fd\u544a\u8bc9\u6211 www.server.com  \u7684 IP \u5730\u5740\u5417\uff1f\u201d</li> <li>\u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\u8bf4\uff1a\u201c\u6211\u7ed9\u4f60\u8d1f\u8d23 www.server.com \u533a\u57df\u7684\u6743\u5a01 DNS \u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u4f60\u53bb\u95ee\u5b83\u5e94\u8be5\u80fd\u95ee\u5230\u201d\u3002</li> <li>\u672c\u5730 DNS \u4e8e\u662f\u8f6c\u5411\u95ee\u6743\u5a01 DNS \u670d\u52a1\u5668\uff1a\u201c\u8001\u4e09\uff0cwww.server.com \u5bf9\u5e94\u7684 IP \u662f\u5565\u5440\uff1f\u201dserver.com \u7684\u6743\u5a01 DNS \u670d\u52a1\u5668\uff0c\u5b83\u662f\u57df\u540d\u89e3\u6790\u7ed3\u679c\u7684\u539f\u51fa\u5904\u3002\u4e3a\u5565\u53eb\u6743\u5a01\u5462\uff1f\u5c31\u662f\u6211\u7684\u57df\u540d\u6211\u505a\u4e3b\u3002</li> <li>\u6743\u5a01 DNS \u670d\u52a1\u5668\u67e5\u8be2\u540e\u5c06\u5bf9\u5e94\u7684 IP \u5730\u5740 X.X.X.X \u544a\u8bc9\u672c\u5730 DNS\u3002</li> <li>\u672c\u5730 DNS \u518d\u5c06 IP \u5730\u5740\u8fd4\u56de\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u548c\u76ee\u6807\u5efa\u7acb\u8fde\u63a5\u3002</li> </ol> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86 DNS \u7684\u89e3\u6790\u8fc7\u7a0b\u3002\u73b0\u5728\u603b\u7ed3\u4e00\u4e0b\uff0c\u6574\u4e2a\u8fc7\u7a0b\u6211\u753b\u6210\u4e86\u4e00\u4e2a\u56fe\u3002</p> <p></p> <p>DNS \u57df\u540d\u89e3\u6790\u7684\u8fc7\u7a0b\u86ee\u6709\u610f\u601d\u7684\uff0c\u6574\u4e2a\u8fc7\u7a0b\u5c31\u548c\u6211\u4eec\u65e5\u5e38\u751f\u6d3b\u4e2d\u627e\u4eba\u95ee\u8def\u7684\u8fc7\u7a0b\u7c7b\u4f3c\uff0c\u53ea\u6307\u8def\u4e0d\u5e26\u8def\u3002</p> <p>\u90a3\u662f\u4e0d\u662f\u6bcf\u6b21\u89e3\u6790\u57df\u540d\u90fd\u8981\u7ecf\u8fc7\u90a3\u4e48\u591a\u7684\u6b65\u9aa4\u5462\uff1f</p> <p>\u5f53\u7136\u4e0d\u662f\u4e86\uff0c\u8fd8\u6709\u7f13\u5b58\u8fd9\u4e2a\u4e1c\u897f\u7684\u561b\u3002</p> <p>\u6d4f\u89c8\u5668\u4f1a\u5148\u770b\u81ea\u8eab\u6709\u6ca1\u6709\u5bf9\u8fd9\u4e2a\u57df\u540d\u7684\u7f13\u5b58\uff0c\u5982\u679c\u6709\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5c31\u53bb\u95ee\u64cd\u4f5c\u7cfb\u7edf\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e5f\u4f1a\u53bb\u770b\u81ea\u5df1\u7684\u7f13\u5b58\uff0c\u5982\u679c\u6709\uff0c\u5c31\u76f4\u63a5\u8fd4\u56de\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u518d\u53bb hosts \u6587\u4ef6\u770b\uff0c\u4e5f\u6ca1\u6709\uff0c\u624d\u4f1a\u53bb\u95ee\u300c\u672c\u5730 DNS \u670d\u52a1\u5668\u300d\u3002</p> <p>\u6570\u636e\u5305\u8868\u793a\uff1a\u201cDNS \u8001\u5927\u54e5\u5389\u5bb3\u5440\uff0c\u627e\u5230\u4e86\u76ee\u7684\u5730\u4e86\uff01\u6211\u8fd8\u662f\u5f88\u8ff7\u832b\u5440\uff0c\u6211\u8981\u53d1\u51fa\u53bb\uff0c\u63a5\u4e0b\u6765\u6211\u9700\u8981\u8c01\u7684\u5e2e\u52a9\u5462\uff1f\u201d</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#_1","title":"\u6307\u5357\u597d\u5e2e\u624b \u2014\u2014 \u534f\u8bae\u6808","text":"<p>\u901a\u8fc7 DNS \u83b7\u53d6\u5230 IP \u540e\uff0c\u5c31\u53ef\u4ee5\u628a HTTP \u7684\u4f20\u8f93\u5de5\u4f5c\u4ea4\u7ed9\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684\u534f\u8bae\u6808\u3002</p> <p>\u534f\u8bae\u6808\u7684\u5185\u90e8\u5206\u4e3a\u51e0\u4e2a\u90e8\u5206\uff0c\u5206\u522b\u627f\u62c5\u4e0d\u540c\u7684\u5de5\u4f5c\u3002\u4e0a\u4e0b\u5173\u7cfb\u662f\u6709\u4e00\u5b9a\u7684\u89c4\u5219\u7684\uff0c\u4e0a\u9762\u7684\u90e8\u5206\u4f1a\u5411\u4e0b\u9762\u7684\u90e8\u5206\u59d4\u6258\u5de5\u4f5c\uff0c\u4e0b\u9762\u7684\u90e8\u5206\u6536\u5230\u59d4\u6258\u7684\u5de5\u4f5c\u5e76\u6267\u884c\u3002</p> <p></p> <p>\u5e94\u7528\u7a0b\u5e8f\uff08\u6d4f\u89c8\u5668\uff09\u901a\u8fc7\u8c03\u7528 Socket \u5e93\uff0c\u6765\u59d4\u6258\u534f\u8bae\u6808\u5de5\u4f5c\u3002\u534f\u8bae\u6808\u7684\u4e0a\u534a\u90e8\u5206\u6709\u4e24\u5757\uff0c\u5206\u522b\u662f\u8d1f\u8d23\u6536\u53d1\u6570\u636e\u7684 TCP \u548c UDP \u534f\u8bae\uff0c\u8fd9\u4e24\u4e2a\u4f20\u8f93\u534f\u8bae\u4f1a\u63a5\u53d7\u5e94\u7528\u5c42\u7684\u59d4\u6258\u6267\u884c\u6536\u53d1\u6570\u636e\u7684\u64cd\u4f5c\u3002</p> <p>\u534f\u8bae\u6808\u7684\u4e0b\u9762\u4e00\u534a\u662f\u7528 IP \u534f\u8bae\u63a7\u5236\u7f51\u7edc\u5305\u6536\u53d1\u64cd\u4f5c\uff0c\u5728\u4e92\u8054\u7f51\u4e0a\u4f20\u6570\u636e\u65f6\uff0c\u6570\u636e\u4f1a\u88ab\u5207\u5206\u6210\u4e00\u5757\u5757\u7684\u7f51\u7edc\u5305\uff0c\u800c\u5c06\u7f51\u7edc\u5305\u53d1\u9001\u7ed9\u5bf9\u65b9\u7684\u64cd\u4f5c\u5c31\u662f\u7531 IP \u8d1f\u8d23\u7684\u3002</p> <p>\u6b64\u5916 IP \u4e2d\u8fd8\u5305\u62ec <code>ICMP</code> \u534f\u8bae\u548c <code>ARP</code> \u534f\u8bae\u3002</p> <ul> <li><code>ICMP</code> \u7528\u4e8e\u544a\u77e5\u7f51\u7edc\u5305\u4f20\u9001\u8fc7\u7a0b\u4e2d\u4ea7\u751f\u7684\u9519\u8bef\u4ee5\u53ca\u5404\u79cd\u63a7\u5236\u4fe1\u606f\u3002</li> <li><code>ARP</code> \u7528\u4e8e\u6839\u636e IP \u5730\u5740\u67e5\u8be2\u76f8\u5e94\u7684\u4ee5\u592a\u7f51 MAC \u5730\u5740\u3002</li> </ul> <p>IP \u4e0b\u9762\u7684\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f\u8d1f\u8d23\u63a7\u5236\u7f51\u5361\u786c\u4ef6\uff0c\u800c\u6700\u4e0b\u9762\u7684\u7f51\u5361\u5219\u8d1f\u8d23\u5b8c\u6210\u5b9e\u9645\u7684\u6536\u53d1\u64cd\u4f5c\uff0c\u4e5f\u5c31\u662f\u5bf9\u7f51\u7ebf\u4e2d\u7684\u4fe1\u53f7\u6267\u884c\u53d1\u9001\u548c\u63a5\u6536\u64cd\u4f5c\u3002</p> <p>\u6570\u636e\u5305\u770b\u4e86\u8fd9\u4efd\u6307\u5357\u8868\u793a\uff1a\u201c\u539f\u6765\u6211\u9700\u8981\u90a3\u4e48\u591a\u5927\u4f6c\u7684\u534f\u52a9\u554a\uff0c\u90a3\u6211\u5148\u53bb\u627e\u627e TCP \u5927\u4f6c\uff01\u201d</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#tcp","title":"\u53ef\u9760\u4f20\u8f93 \u2014\u2014 TCP","text":"<p>HTTP \u662f\u57fa\u4e8e TCP \u534f\u8bae\u4f20\u8f93\u7684\uff0c\u6240\u4ee5\u5728\u8fd9\u6211\u4eec\u5148\u4e86\u89e3\u4e0b TCP \u534f\u8bae\u3002</p> <p>TCP \u5305\u5934\u683c\u5f0f</p> <p>\u6211\u4eec\u5148\u770b\u770b TCP \u62a5\u6587\u5934\u90e8\u7684\u683c\u5f0f\uff1a</p> <p></p> <p>\u9996\u5148\uff0c\u6e90\u7aef\u53e3\u53f7\u548c\u76ee\u6807\u7aef\u53e3\u53f7\u662f\u4e0d\u53ef\u5c11\u7684\uff0c\u5982\u679c\u6ca1\u6709\u8fd9\u4e24\u4e2a\u7aef\u53e3\u53f7\uff0c\u6570\u636e\u5c31\u4e0d\u77e5\u9053\u5e94\u8be5\u53d1\u7ed9\u54ea\u4e2a\u5e94\u7528\u3002</p> <p>\u63a5\u4e0b\u6765\u6709\u5305\u7684\u5e8f\u53f7\uff0c\u8fd9\u4e2a\u662f\u4e3a\u4e86\u89e3\u51b3\u5305\u4e71\u5e8f\u7684\u95ee\u9898\u3002</p> <p>\u8fd8\u6709\u5e94\u8be5\u6709\u7684\u662f\u786e\u8ba4\u53f7\uff0c\u76ee\u7684\u662f\u786e\u8ba4\u53d1\u51fa\u53bb\u5bf9\u65b9\u662f\u5426\u6709\u6536\u5230\u3002\u5982\u679c\u6ca1\u6709\u6536\u5230\u5c31\u5e94\u8be5\u91cd\u65b0\u53d1\u9001\uff0c\u76f4\u5230\u9001\u8fbe\uff0c\u8fd9\u4e2a\u662f\u4e3a\u4e86\u89e3\u51b3\u4e0d\u4e22\u5305\u7684\u95ee\u9898\u3002</p> <p>\u63a5\u4e0b\u6765\u8fd8\u6709\u4e00\u4e9b\u72b6\u6001\u4f4d\u3002\u4f8b\u5982 <code>SYN</code> \u662f\u53d1\u8d77\u4e00\u4e2a\u8fde\u63a5\uff0c<code>ACK</code> \u662f\u56de\u590d\uff0c<code>RST</code> \u662f\u91cd\u65b0\u8fde\u63a5\uff0c<code>FIN</code> \u662f\u7ed3\u675f\u8fde\u63a5\u7b49\u3002TCP \u662f\u9762\u5411\u8fde\u63a5\u7684\uff0c\u56e0\u800c\u53cc\u65b9\u8981\u7ef4\u62a4\u8fde\u63a5\u7684\u72b6\u6001\uff0c\u8fd9\u4e9b\u5e26\u72b6\u6001\u4f4d\u7684\u5305\u7684\u53d1\u9001\uff0c\u4f1a\u5f15\u8d77\u53cc\u65b9\u7684\u72b6\u6001\u53d8\u66f4\u3002</p> <p>\u8fd8\u6709\u4e00\u4e2a\u91cd\u8981\u7684\u5c31\u662f\u7a97\u53e3\u5927\u5c0f\u3002TCP \u8981\u505a\u6d41\u91cf\u63a7\u5236\uff0c\u901a\u4fe1\u53cc\u65b9\u5404\u58f0\u660e\u4e00\u4e2a\u7a97\u53e3\uff08\u7f13\u5b58\u5927\u5c0f\uff09\uff0c\u6807\u8bc6\u81ea\u5df1\u5f53\u524d\u80fd\u591f\u7684\u5904\u7406\u80fd\u529b\uff0c\u522b\u53d1\u9001\u7684\u592a\u5feb\uff0c\u6491\u6b7b\u6211\uff0c\u4e5f\u522b\u53d1\u7684\u592a\u6162\uff0c\u997f\u6b7b\u6211\u3002</p> <p>\u9664\u4e86\u505a\u6d41\u91cf\u63a7\u5236\u4ee5\u5916\uff0cTCP \u8fd8\u4f1a\u505a\u62e5\u585e\u63a7\u5236\uff0c\u5bf9\u4e8e\u771f\u6b63\u7684\u901a\u8def\u5835\u8f66\u4e0d\u5835\u8f66\uff0c\u5b83\u65e0\u80fd\u4e3a\u529b\uff0c\u552f\u4e00\u80fd\u505a\u7684\u5c31\u662f\u63a7\u5236\u81ea\u5df1\uff0c\u4e5f\u5373\u63a7\u5236\u53d1\u9001\u7684\u901f\u5ea6\u3002\u4e0d\u80fd\u6539\u53d8\u4e16\u754c\uff0c\u5c31\u6539\u53d8\u81ea\u5df1\u561b\u3002</p> <p>TCP \u4f20\u8f93\u6570\u636e\u4e4b\u524d\uff0c\u8981\u5148\u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5</p> <p>\u5728 HTTP \u4f20\u8f93\u6570\u636e\u4e4b\u524d\uff0c\u9996\u5148\u9700\u8981 TCP \u5efa\u7acb\u8fde\u63a5\uff0cTCP \u8fde\u63a5\u7684\u5efa\u7acb\uff0c\u901a\u5e38\u79f0\u4e3a\u4e09\u6b21\u63e1\u624b\u3002</p> <p>\u8fd9\u4e2a\u6240\u8c13\u7684\u300c\u8fde\u63a5\u300d\uff0c\u53ea\u662f\u53cc\u65b9\u8ba1\u7b97\u673a\u91cc\u7ef4\u62a4\u4e00\u4e2a\u72b6\u6001\u673a\uff0c\u5728\u8fde\u63a5\u5efa\u7acb\u7684\u8fc7\u7a0b\u4e2d\uff0c\u53cc\u65b9\u7684\u72b6\u6001\u53d8\u5316\u65f6\u5e8f\u56fe\u5c31\u50cf\u8fd9\u6837\u3002</p> <p></p> <ul> <li> <p>\u4e00\u5f00\u59cb\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u5904\u4e8e <code>CLOSED</code> \u72b6\u6001\u3002\u5148\u662f\u670d\u52a1\u7aef\u4e3b\u52a8\u76d1\u542c\u67d0\u4e2a\u7aef\u53e3\uff0c\u5904\u4e8e <code>LISTEN</code> \u72b6\u6001\u3002</p> </li> <li> <p>\u7136\u540e\u5ba2\u6237\u7aef\u4e3b\u52a8\u53d1\u8d77\u8fde\u63a5 <code>SYN</code>\uff0c\u4e4b\u540e\u5904\u4e8e <code>SYN-SENT</code> \u72b6\u6001\u3002</p> </li> <li> <p>\u670d\u52a1\u7aef\u6536\u5230\u53d1\u8d77\u7684\u8fde\u63a5\uff0c\u8fd4\u56de <code>SYN</code>\uff0c\u5e76\u4e14 <code>ACK</code> \u5ba2\u6237\u7aef\u7684 <code>SYN</code>\uff0c\u4e4b\u540e\u5904\u4e8e <code>SYN-RCVD</code> \u72b6\u6001\u3002</p> </li> <li> <p>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u53d1\u9001\u7684 <code>SYN</code> \u548c <code>ACK</code> \u4e4b\u540e\uff0c\u53d1\u9001\u5bf9 <code>SYN</code> \u786e\u8ba4\u7684 <code>ACK</code>\uff0c\u4e4b\u540e\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\uff0c\u56e0\u4e3a\u5b83\u4e00\u53d1\u4e00\u6536\u6210\u529f\u4e86\u3002</p> </li> <li> <p>\u670d\u52a1\u7aef\u6536\u5230 <code>ACK</code> \u7684 <code>ACK</code> \u4e4b\u540e\uff0c\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\uff0c\u56e0\u4e3a\u5b83\u4e5f\u4e00\u53d1\u4e00\u6536\u4e86\u3002</p> </li> </ul> <p>\u6240\u4ee5\u4e09\u6b21\u63e1\u624b\u76ee\u7684\u662f\u4fdd\u8bc1\u53cc\u65b9\u90fd\u6709\u53d1\u9001\u548c\u63a5\u6536\u7684\u80fd\u529b\u3002</p> <p>\u5982\u4f55\u67e5\u770b TCP \u7684\u8fde\u63a5\u72b6\u6001\uff1f</p> <p>TCP \u7684\u8fde\u63a5\u72b6\u6001\u67e5\u770b\uff0c\u5728 Linux \u53ef\u4ee5\u901a\u8fc7 <code>netstat -napt</code> \u547d\u4ee4\u67e5\u770b\u3002</p> <p></p> <p>TCP \u5206\u5272\u6570\u636e</p> <p>\u5982\u679c HTTP \u8bf7\u6c42\u6d88\u606f\u6bd4\u8f83\u957f\uff0c\u8d85\u8fc7\u4e86 <code>MSS</code> \u7684\u957f\u5ea6\uff0c\u8fd9\u65f6 TCP \u5c31\u9700\u8981\u628a HTTP \u7684\u6570\u636e\u62c6\u89e3\u6210\u4e00\u5757\u5757\u7684\u6570\u636e\u53d1\u9001\uff0c\u800c\u4e0d\u662f\u4e00\u6b21\u6027\u53d1\u9001\u6240\u6709\u6570\u636e\u3002</p> <p></p> <ul> <li><code>MTU</code>\uff1a\u4e00\u4e2a\u7f51\u7edc\u5305\u7684\u6700\u5927\u957f\u5ea6\uff0c\u4ee5\u592a\u7f51\u4e2d\u4e00\u822c\u4e3a <code>1500</code> \u5b57\u8282\u3002</li> <li><code>MSS</code>\uff1a\u9664\u53bb IP \u548c TCP \u5934\u90e8\u4e4b\u540e\uff0c\u4e00\u4e2a\u7f51\u7edc\u5305\u6240\u80fd\u5bb9\u7eb3\u7684 TCP \u6570\u636e\u7684\u6700\u5927\u957f\u5ea6\u3002</li> </ul> <p>\u6570\u636e\u4f1a\u88ab\u4ee5 <code>MSS</code> \u7684\u957f\u5ea6\u4e3a\u5355\u4f4d\u8fdb\u884c\u62c6\u5206\uff0c\u62c6\u5206\u51fa\u6765\u7684\u6bcf\u4e00\u5757\u6570\u636e\u90fd\u4f1a\u88ab\u653e\u8fdb\u5355\u72ec\u7684\u7f51\u7edc\u5305\u4e2d\u3002\u4e5f\u5c31\u662f\u5728\u6bcf\u4e2a\u88ab\u62c6\u5206\u7684\u6570\u636e\u52a0\u4e0a TCP \u5934\u4fe1\u606f\uff0c\u7136\u540e\u4ea4\u7ed9 IP \u6a21\u5757\u6765\u53d1\u9001\u6570\u636e\u3002</p> <p></p> <p>TCP \u62a5\u6587\u751f\u6210</p> <p>TCP \u534f\u8bae\u91cc\u9762\u4f1a\u6709\u4e24\u4e2a\u7aef\u53e3\uff0c\u4e00\u4e2a\u662f\u6d4f\u89c8\u5668\u76d1\u542c\u7684\u7aef\u53e3\uff08\u901a\u5e38\u662f\u968f\u673a\u751f\u6210\u7684\uff09\uff0c\u4e00\u4e2a\u662f Web \u670d\u52a1\u5668\u76d1\u542c\u7684\u7aef\u53e3\uff08HTTP \u9ed8\u8ba4\u7aef\u53e3\u53f7\u662f <code>80</code>\uff0cHTTPS \u9ed8\u8ba4\u7aef\u53e3\u53f7\u662f <code>443</code>\uff09\u3002</p> <p>\u5728\u53cc\u65b9\u5efa\u7acb\u4e86\u8fde\u63a5\u540e\uff0cTCP \u62a5\u6587\u4e2d\u7684\u6570\u636e\u90e8\u5206\u5c31\u662f\u5b58\u653e HTTP \u5934\u90e8 + \u6570\u636e\uff0c\u7ec4\u88c5\u597d TCP \u62a5\u6587\u4e4b\u540e\uff0c\u5c31\u9700\u4ea4\u7ed9\u4e0b\u9762\u7684\u7f51\u7edc\u5c42\u5904\u7406\u3002</p> <p>\u81f3\u6b64\uff0c\u7f51\u7edc\u5305\u7684\u62a5\u6587\u5982\u4e0b\u56fe\u3002</p> <p></p> <p>\u6b64\u65f6\uff0c\u9047\u4e0a\u4e86 TCP \u7684  \u6570\u636e\u5305\u6fc0\u52a8\u8868\u793a\uff1a\u201c\u592a\u597d\u4e86\uff0c\u78b0\u5230\u4e86\u53ef\u9760\u4f20\u8f93\u7684 TCP \u4f20\u8f93\uff0c\u5b83\u7ed9\u6211\u52a0\u4e0a TCP \u5934\u90e8\uff0c\u6211\u4e0d\u518d\u5b64\u5355\u4e86\uff0c\u5b89\u5168\u611f\u5341\u8db3\u554a\uff01\u6709\u5927\u4f6c\u53ef\u4ee5\u4fdd\u62a4\u6211\u7684\u53ef\u9760\u9001\u8fbe\uff01\u4f46\u6211\u5e94\u8be5\u5f80\u54ea\u8d70\u5462\uff1f\u201d</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#ip","title":"\u8fdc\u7a0b\u5b9a\u4f4d \u2014\u2014 IP","text":"<p>TCP \u6a21\u5757\u5728\u6267\u884c\u8fde\u63a5\u3001\u6536\u53d1\u3001\u65ad\u5f00\u7b49\u5404\u9636\u6bb5\u64cd\u4f5c\u65f6\uff0c\u90fd\u9700\u8981\u59d4\u6258 IP \u6a21\u5757\u5c06\u6570\u636e\u5c01\u88c5\u6210\u7f51\u7edc\u5305\u53d1\u9001\u7ed9\u901a\u4fe1\u5bf9\u8c61\u3002</p> <p>IP \u5305\u5934\u683c\u5f0f</p> <p>\u6211\u4eec\u5148\u770b\u770b IP \u62a5\u6587\u5934\u90e8\u7684\u683c\u5f0f\uff1a</p> <p></p> <p>\u5728 IP \u534f\u8bae\u91cc\u9762\u9700\u8981\u6709\u6e90\u5730\u5740 IP \u548c \u76ee\u6807\u5730\u5740 IP\uff1a</p> <ul> <li>\u6e90\u5730\u5740 IP\uff0c\u5373\u662f\u5ba2\u6237\u7aef\u8f93\u51fa\u7684 IP \u5730\u5740\uff1b</li> <li>\u76ee\u6807\u5730\u5740\uff0c\u5373\u901a\u8fc7 DNS \u57df\u540d\u89e3\u6790\u5f97\u5230\u7684 Web \u670d\u52a1\u5668 IP\u3002</li> </ul> <p>\u56e0\u4e3a HTTP \u662f\u7ecf\u8fc7 TCP \u4f20\u8f93\u7684\uff0c\u6240\u4ee5\u5728 IP \u5305\u5934\u7684\u534f\u8bae\u53f7\uff0c\u8981\u586b\u5199\u4e3a <code>06</code>\uff08\u5341\u516d\u8fdb\u5236\uff09\uff0c\u8868\u793a\u534f\u8bae\u4e3a TCP\u3002</p> <p>\u5047\u8bbe\u5ba2\u6237\u7aef\u6709\u591a\u4e2a\u7f51\u5361\uff0c\u5c31\u4f1a\u6709\u591a\u4e2a IP \u5730\u5740\uff0c\u90a3 IP \u5934\u90e8\u7684\u6e90\u5730\u5740\u5e94\u8be5\u9009\u62e9\u54ea\u4e2a IP \u5462\uff1f</p> <p>\u5f53\u5b58\u5728\u591a\u4e2a\u7f51\u5361\u65f6\uff0c\u5728\u586b\u5199\u6e90\u5730\u5740 IP \u65f6\uff0c\u5c31\u9700\u8981\u5224\u65ad\u5230\u5e95\u5e94\u8be5\u586b\u5199\u54ea\u4e2a\u5730\u5740\u3002\u8fd9\u4e2a\u5224\u65ad\u76f8\u5f53\u4e8e\u5728\u591a\u5757\u7f51\u5361\u4e2d\u5224\u65ad\u5e94\u8be5\u4f7f\u7528\u54ea\u4e2a\u4e00\u5757\u7f51\u5361\u6765\u53d1\u9001\u5305\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\u5c31\u9700\u8981\u6839\u636e\u8def\u7531\u8868\u89c4\u5219\uff0c\u6765\u5224\u65ad\u54ea\u4e00\u4e2a\u7f51\u5361\u4f5c\u4e3a\u6e90\u5730\u5740 IP\u3002</p> <p>\u5728 Linux \u64cd\u4f5c\u7cfb\u7edf\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>route -n</code> \u547d\u4ee4\u67e5\u770b\u5f53\u524d\u7cfb\u7edf\u7684\u8def\u7531\u8868\u3002</p> <p></p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6839\u636e\u4e0a\u9762\u7684\u8def\u7531\u8868\uff0c\u6211\u4eec\u5047\u8bbe Web \u670d\u52a1\u5668\u7684\u76ee\u6807\u5730\u5740\u662f <code>192.168.10.200</code>\u3002</p> <p></p> <ol> <li>\u9996\u5148\u5148\u548c\u7b2c\u4e00\u6761\u76ee\u7684\u5b50\u7f51\u63a9\u7801\uff08<code>Genmask</code>\uff09\u8fdb\u884c \u4e0e\u8fd0\u7b97\uff0c\u5f97\u5230\u7ed3\u679c\u4e3a <code>192.168.10.0</code>\uff0c\u4f46\u662f\u7b2c\u4e00\u4e2a\u6761\u76ee\u7684 <code>Destination</code> \u662f <code>192.168.3.0</code>\uff0c\u4e24\u8005\u4e0d\u4e00\u81f4\u6240\u4ee5\u5339\u914d\u5931\u8d25\u3002</li> <li>\u518d\u4e0e\u7b2c\u4e8c\u6761\u76ee\u7684\u5b50\u7f51\u63a9\u7801\u8fdb\u884c \u4e0e\u8fd0\u7b97\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e3a <code>192.168.10.0</code>\uff0c\u4e0e\u7b2c\u4e8c\u6761\u76ee\u7684 <code>Destination 192.168.10.0</code> \u5339\u914d\u6210\u529f\uff0c\u6240\u4ee5\u5c06\u4f7f\u7528 <code>eth1</code> \u7f51\u5361\u7684 IP \u5730\u5740\u4f5c\u4e3a IP \u5305\u5934\u7684\u6e90\u5730\u5740\u3002</li> </ol> <p>\u90a3\u4e48\u5047\u8bbe Web \u670d\u52a1\u5668\u7684\u76ee\u6807\u5730\u5740\u662f <code>10.100.20.100</code>\uff0c\u90a3\u4e48\u4f9d\u7136\u4f9d\u7167\u4e0a\u9762\u7684\u8def\u7531\u8868\u89c4\u5219\u5224\u65ad\uff0c\u5224\u65ad\u540e\u7684\u7ed3\u679c\u662f\u548c\u7b2c\u4e09\u6761\u76ee\u5339\u914d\u3002</p> <p>\u7b2c\u4e09\u6761\u76ee\u6bd4\u8f83\u7279\u6b8a\uff0c\u5b83\u76ee\u6807\u5730\u5740\u548c\u5b50\u7f51\u63a9\u7801\u90fd\u662f <code>0.0.0.0</code>\uff0c\u8fd9\u8868\u793a\u9ed8\u8ba4\u7f51\u5173\uff0c\u5982\u679c\u5176\u4ed6\u6240\u6709\u6761\u76ee\u90fd\u65e0\u6cd5\u5339\u914d\uff0c\u5c31\u4f1a\u81ea\u52a8\u5339\u914d\u8fd9\u4e00\u884c\u3002\u5e76\u4e14\u540e\u7eed\u5c31\u628a\u5305\u53d1\u7ed9\u8def\u7531\u5668\uff0c<code>Gateway</code> \u5373\u662f\u8def\u7531\u5668\u7684 IP \u5730\u5740\u3002</p> <p>IP \u62a5\u6587\u751f\u6210</p> <p>\u81f3\u6b64\uff0c\u7f51\u7edc\u5305\u7684\u62a5\u6587\u5982\u4e0b\u56fe\u3002</p> <p></p> <p>\u6b64\u65f6\uff0c\u52a0\u4e0a\u4e86 IP \u5934\u90e8\u7684\u6570\u636e\u5305\u8868\u793a\uff1a\u201c\u6709 IP \u5927\u4f6c\u7ed9\u6211\u6307\u8def\u4e86\uff0c\u611f\u8c22 IP \u5c42\u7ed9\u6211\u52a0\u4e0a\u4e86 IP \u5305\u5934\uff0c\u8ba9\u6211\u6709\u4e86\u8fdc\u7a0b\u5b9a\u4f4d\u7684\u80fd\u529b\uff0c\u4e0d\u4f1a\u5bb3\u6015\u5728\u6d69\u701a\u7684\u4e92\u8054\u7f51\u8ff7\u832b\u4e86\uff01\u53ef\u662f\u76ee\u7684\u5730\u597d\u8fdc\u554a\uff0c\u6211\u4e0b\u4e00\u7ad9\u5e94\u8be5\u53bb\u54ea\u5462\uff1f\u201d</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#mac","title":"\u4e24\u70b9\u4f20\u8f93 \u2014\u2014 MAC","text":"<p>\u751f\u6210\u4e86 IP \u5934\u90e8\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u7f51\u7edc\u5305\u8fd8\u9700\u8981\u5728 IP \u5934\u90e8\u7684\u524d\u9762\u52a0\u4e0a MAC \u5934\u90e8\u3002</p> <p>MAC \u5305\u5934\u683c\u5f0f</p> <p>MAC \u5934\u90e8\u662f\u4ee5\u592a\u7f51\u4f7f\u7528\u7684\u5934\u90e8\uff0c\u5b83\u5305\u542b\u4e86\u63a5\u6536\u65b9\u548c\u53d1\u9001\u65b9\u7684 MAC \u5730\u5740\u7b49\u4fe1\u606f\u3002</p> <p></p> <p>\u5728 MAC \u5305\u5934\u91cc\u9700\u8981\u53d1\u9001\u65b9 MAC \u5730\u5740\u548c\u63a5\u6536\u65b9\u76ee\u6807 MAC \u5730\u5740\uff0c\u7528\u4e8e\u4e24\u70b9\u4e4b\u95f4\u7684\u4f20\u8f93\u3002</p> <p>\u4e00\u822c\u5728 TCP/IP \u901a\u4fe1\u91cc\uff0cMAC \u5305\u5934\u7684\u534f\u8bae\u7c7b\u578b\u53ea\u4f7f\u7528\uff1a</p> <ul> <li><code>0800</code> \uff1aIP \u534f\u8bae</li> <li><code>0806</code> \uff1aARP \u534f\u8bae</li> </ul> <p>MAC \u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\u5982\u4f55\u786e\u8ba4\uff1f</p> <p>\u53d1\u9001\u65b9\u7684 MAC \u5730\u5740\u83b7\u53d6\u5c31\u6bd4\u8f83\u7b80\u5355\u4e86\uff0cMAC \u5730\u5740\u662f\u5728\u7f51\u5361\u751f\u4ea7\u65f6\u5199\u5165\u5230 ROM \u91cc\u7684\uff0c\u53ea\u8981\u5c06\u8fd9\u4e2a\u503c\u8bfb\u53d6\u51fa\u6765\u5199\u5165\u5230 MAC \u5934\u90e8\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u63a5\u6536\u65b9\u7684 MAC \u5730\u5740\u5c31\u6709\u70b9\u590d\u6742\u4e86\uff0c\u53ea\u8981\u544a\u8bc9\u4ee5\u592a\u7f51\u5bf9\u65b9\u7684 MAC \u7684\u5730\u5740\uff0c\u4ee5\u592a\u7f51\u5c31\u4f1a\u5e2e\u6211\u4eec\u628a\u5305\u53d1\u9001\u8fc7\u53bb\uff0c\u90a3\u4e48\u5f88\u663e\u7136\u8fd9\u91cc\u5e94\u8be5\u586b\u5199\u5bf9\u65b9\u7684 MAC \u5730\u5740\u3002</p> <p>\u6240\u4ee5\u5148\u5f97\u641e\u6e05\u695a\u5e94\u8be5\u628a\u5305\u53d1\u7ed9\u8c01\uff0c\u8fd9\u4e2a\u53ea\u8981\u67e5\u4e00\u4e0b\u8def\u7531\u8868\u5c31\u77e5\u9053\u4e86\u3002\u5728\u8def\u7531\u8868\u4e2d\u627e\u5230\u76f8\u5339\u914d\u7684\u6761\u76ee\uff0c\u7136\u540e\u628a\u5305\u53d1\u7ed9 <code>Gateway</code> \u5217\u4e2d\u7684 IP \u5730\u5740\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u65e2\u7136\u77e5\u9053\u8981\u53d1\u7ed9\u8c01\uff0c\u90a3\u5982\u4f55\u83b7\u53d6\u5bf9\u65b9\u7684 MAC \u5730\u5740\u5462\uff1f</p> <p>\u4e0d\u77e5\u9053\u5bf9\u65b9 MAC \u5730\u5740\uff1f\u4e0d\u77e5\u9053\u5c31\u558a\u5457\u3002</p> <p>\u6b64\u65f6\u5c31\u9700\u8981 <code>ARP</code> \u534f\u8bae\u5e2e\u6211\u4eec\u627e\u5230\u8def\u7531\u5668\u7684 MAC \u5730\u5740\u3002</p> <p></p> <p>ARP \u534f\u8bae\u4f1a\u5728\u4ee5\u592a\u7f51\u4e2d\u4ee5\u5e7f\u64ad\u7684\u5f62\u5f0f\uff0c\u5bf9\u4ee5\u592a\u7f51\u6240\u6709\u7684\u8bbe\u5907\u558a\u51fa\uff1a\u201c\u8fd9\u4e2a IP \u5730\u5740\u662f\u8c01\u7684\uff1f\u8bf7\u628a\u4f60\u7684 MAC \u5730\u5740\u544a\u8bc9\u6211\u201d\u3002</p> <p>\u7136\u540e\u5c31\u4f1a\u6709\u4eba\u56de\u7b54\uff1a\u201c\u8fd9\u4e2a IP \u5730\u5740\u662f\u6211\u7684\uff0c\u6211\u7684 MAC \u5730\u5740\u662f XXXX\u201d\u3002</p> <p>\u5982\u679c\u5bf9\u65b9\u548c\u81ea\u5df1\u5904\u4e8e\u540c\u4e00\u4e2a\u5b50\u7f51\u4e2d\uff0c\u90a3\u4e48\u901a\u8fc7\u4e0a\u9762\u7684\u64cd\u4f5c\u5c31\u53ef\u4ee5\u5f97\u5230\u5bf9\u65b9\u7684 MAC \u5730\u5740\u3002\u7136\u540e\uff0c\u6211\u4eec\u5c06\u8fd9\u4e2a MAC \u5730\u5740\u5199\u5165 MAC \u5934\u90e8\uff0cMAC \u5934\u90e8\u5c31\u5b8c\u6210\u4e86\u3002</p> <p>\u597d\u50cf\u6bcf\u6b21\u90fd\u8981\u5e7f\u64ad\u83b7\u53d6\uff0c\u8fd9\u4e0d\u662f\u5f88\u9ebb\u70e6\u5417\uff1f</p> <p>\u653e\u5fc3\uff0c\u5728\u540e\u7eed\u64cd\u4f5c\u7cfb\u7edf\u4f1a\u628a\u672c\u6b21\u67e5\u8be2\u7ed3\u679c\u653e\u5230\u4e00\u5757\u53eb\u505a ARP \u7f13\u5b58\u7684\u5185\u5b58\u7a7a\u95f4\u7559\u7740\u4ee5\u540e\u7528\uff0c\u4e0d\u8fc7\u7f13\u5b58\u7684\u65f6\u95f4\u5c31\u51e0\u5206\u949f\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728\u53d1\u5305\u65f6\uff1a</p> <ul> <li>\u5148\u67e5\u8be2 ARP \u7f13\u5b58\uff0c\u5982\u679c\u5176\u4e2d\u5df2\u7ecf\u4fdd\u5b58\u4e86\u5bf9\u65b9\u7684 MAC \u5730\u5740\uff0c\u5c31\u4e0d\u9700\u8981\u53d1\u9001 ARP \u67e5\u8be2\uff0c\u76f4\u63a5\u4f7f\u7528 ARP \u7f13\u5b58\u4e2d\u7684\u5730\u5740\u3002</li> <li>\u800c\u5f53 ARP \u7f13\u5b58\u4e2d\u4e0d\u5b58\u5728\u5bf9\u65b9 MAC \u5730\u5740\u65f6\uff0c\u5219\u53d1\u9001 ARP \u5e7f\u64ad\u67e5\u8be2\u3002</li> </ul> <p>\u67e5\u770b ARP \u7f13\u5b58\u5185\u5bb9</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 <code>arp -a</code> \u547d\u4ee4\u6765\u67e5\u770b ARP \u7f13\u5b58\u7684\u5185\u5bb9\u3002</p> <p></p> <p>MAC \u62a5\u6587\u751f\u6210</p> <p>\u81f3\u6b64\uff0c\u7f51\u7edc\u5305\u7684\u62a5\u6587\u5982\u4e0b\u56fe\u3002</p> <p></p> <p>\u6b64\u65f6\uff0c\u52a0\u4e0a\u4e86 MAC \u5934\u90e8\u7684\u6570\u636e\u5305\u4e07\u5206\u611f\u8c22\uff0c\u8bf4\u9053\uff1a\u201c\u611f\u8c22 MAC \u5927\u4f6c\uff0c\u6211\u77e5\u9053\u6211\u4e0b\u4e00\u6b65\u8981\u53bb\u54ea\u4e86\uff01\u6211\u73b0\u5728\u6709\u5f88\u591a\u5934\u90e8\u5144\u5f1f\uff0c\u76f8\u4fe1\u6211\u53ef\u4ee5\u5230\u8fbe\u6700\u7ec8\u7684\u76ee\u7684\u5730\uff01\u201d\u3002 \u5e26\u7740\u4f17\u591a\u5934\u90e8\u5144\u5f1f\u7684\u6570\u636e\u5305\uff0c\u7ec8\u4e8e\u51c6\u5907\u8981\u51fa\u95e8\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#_2","title":"\u51fa\u53e3 \u2014\u2014 \u7f51\u5361","text":"<p>\u7f51\u7edc\u5305\u53ea\u662f\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u7684\u4e00\u4e32\u4e8c\u8fdb\u5236\u6570\u5b57\u4fe1\u606f\uff0c\u6ca1\u6709\u529e\u6cd5\u76f4\u63a5\u53d1\u9001\u7ed9\u5bf9\u65b9\u3002\u56e0\u6b64\uff0c\u6211\u4eec\u9700\u8981\u5c06\u6570\u5b57\u4fe1\u606f\u8f6c\u6362\u4e3a\u7535\u4fe1\u53f7\uff0c\u624d\u80fd\u5728\u7f51\u7ebf\u4e0a\u4f20\u8f93\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u8fd9\u624d\u662f\u771f\u6b63\u7684\u6570\u636e\u53d1\u9001\u8fc7\u7a0b\u3002</p> <p>\u8d1f\u8d23\u6267\u884c\u8fd9\u4e00\u64cd\u4f5c\u7684\u662f\u7f51\u5361\uff0c\u8981\u63a7\u5236\u7f51\u5361\u8fd8\u9700\u8981\u9760\u7f51\u5361\u9a71\u52a8\u7a0b\u5e8f\u3002</p> <p>\u7f51\u5361\u9a71\u52a8\u83b7\u53d6\u7f51\u7edc\u5305\u4e4b\u540e\uff0c\u4f1a\u5c06\u5176\u590d\u5236\u5230\u7f51\u5361\u5185\u7684\u7f13\u5b58\u533a\u4e2d\uff0c\u63a5\u7740\u4f1a\u5728\u5176\u5f00\u5934\u52a0\u4e0a\u62a5\u5934\u548c\u8d77\u59cb\u5e27\u5206\u754c\u7b26\uff0c\u5728\u672b\u5c3e\u52a0\u4e0a\u7528\u4e8e\u68c0\u6d4b\u9519\u8bef\u7684\u5e27\u6821\u9a8c\u5e8f\u5217\u3002</p> <p></p> <ul> <li>\u8d77\u59cb\u5e27\u5206\u754c\u7b26\u662f\u4e00\u4e2a\u7528\u6765\u8868\u793a\u5305\u8d77\u59cb\u4f4d\u7f6e\u7684\u6807\u8bb0</li> <li>\u672b\u5c3e\u7684 <code>FCS</code>\uff08\u5e27\u6821\u9a8c\u5e8f\u5217\uff09\u7528\u6765\u68c0\u67e5\u5305\u4f20\u8f93\u8fc7\u7a0b\u662f\u5426\u6709\u635f\u574f</li> </ul> <p>\u6700\u540e\u7f51\u5361\u4f1a\u5c06\u5305\u8f6c\u4e3a\u7535\u4fe1\u53f7\uff0c\u901a\u8fc7\u7f51\u7ebf\u53d1\u9001\u51fa\u53bb\u3002</p> <p>\u5509\uff0c\u771f\u662f\u4e0d\u5bb9\u6613\uff0c\u53d1\u4e00\u4e2a\u5305\uff0c\u771f\u662f\u5386\u7ecf\u5343\u8f9b\u4e07\u82e6\u3002\u81f4\u6b64\uff0c\u4e00\u4e2a\u5e26\u6709\u8bb8\u591a\u5934\u90e8\u7684\u6570\u636e\u7ec8\u4e8e\u8e0f\u4e0a\u5bfb\u627e\u76ee\u7684\u5730\u7684\u5f81\u9014\u4e86\uff01</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#_3","title":"\u9001\u522b\u8005 \u2014\u2014 \u4ea4\u6362\u673a","text":"<p>\u4e0b\u9762\u6765\u770b\u4e00\u4e0b\u5305\u662f\u5982\u4f55\u901a\u8fc7\u4ea4\u6362\u673a\u7684\u3002\u4ea4\u6362\u673a\u7684\u8bbe\u8ba1\u662f\u5c06\u7f51\u7edc\u5305\u539f\u6837\u8f6c\u53d1\u5230\u76ee\u7684\u5730\u3002\u4ea4\u6362\u673a\u5de5\u4f5c\u5728 MAC \u5c42\uff0c\u4e5f\u79f0\u4e3a\u4e8c\u5c42\u7f51\u7edc\u8bbe\u5907\u3002</p> <p>\u4ea4\u6362\u673a\u7684\u5305\u63a5\u6536\u64cd\u4f5c</p> <p>\u9996\u5148\uff0c\u7535\u4fe1\u53f7\u5230\u8fbe\u7f51\u7ebf\u63a5\u53e3\uff0c\u4ea4\u6362\u673a\u91cc\u7684\u6a21\u5757\u8fdb\u884c\u63a5\u6536\uff0c\u63a5\u4e0b\u6765\u4ea4\u6362\u673a\u91cc\u7684\u6a21\u5757\u5c06\u7535\u4fe1\u53f7\u8f6c\u6362\u4e3a\u6570\u5b57\u4fe1\u53f7\u3002</p> <p>\u7136\u540e\u901a\u8fc7\u5305\u672b\u5c3e\u7684 <code>FCS</code> \u6821\u9a8c\u9519\u8bef\uff0c\u5982\u679c\u6ca1\u95ee\u9898\u5219\u653e\u5230\u7f13\u51b2\u533a\u3002\u8fd9\u90e8\u5206\u64cd\u4f5c\u57fa\u672c\u548c\u8ba1\u7b97\u673a\u7684\u7f51\u5361\u76f8\u540c\uff0c\u4f46\u4ea4\u6362\u673a\u7684\u5de5\u4f5c\u65b9\u5f0f\u548c\u7f51\u5361\u4e0d\u540c\u3002</p> <p>\u8ba1\u7b97\u673a\u7684\u7f51\u5361\u672c\u8eab\u5177\u6709 MAC \u5730\u5740\uff0c\u5e76\u901a\u8fc7\u6838\u5bf9\u6536\u5230\u7684\u5305\u7684\u63a5\u6536\u65b9 MAC \u5730\u5740\u5224\u65ad\u662f\u4e0d\u662f\u53d1\u7ed9\u81ea\u5df1\u7684\uff0c\u5982\u679c\u4e0d\u662f\u53d1\u7ed9\u81ea\u5df1\u7684\u5219\u4e22\u5f03\uff1b\u76f8\u5bf9\u5730\uff0c\u4ea4\u6362\u673a\u7684\u7aef\u53e3\u4e0d\u6838\u5bf9\u63a5\u6536\u65b9 MAC \u5730\u5740\uff0c\u800c\u662f\u76f4\u63a5\u63a5\u6536\u6240\u6709\u7684\u5305\u5e76\u5b58\u653e\u5230\u7f13\u51b2\u533a\u4e2d\u3002\u56e0\u6b64\uff0c\u548c\u7f51\u5361\u4e0d\u540c\uff0c\u4ea4\u6362\u673a\u7684\u7aef\u53e3\u4e0d\u5177\u6709 MAC \u5730\u5740\u3002</p> <p>\u5c06\u5305\u5b58\u5165\u7f13\u51b2\u533a\u540e\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u67e5\u8be2\u4e00\u4e0b\u8fd9\u4e2a\u5305\u7684\u63a5\u6536\u65b9 MAC \u5730\u5740\u662f\u5426\u5df2\u7ecf\u5728 MAC \u5730\u5740\u8868\u4e2d\u6709\u8bb0\u5f55\u4e86\u3002</p> <p>\u4ea4\u6362\u673a\u7684 MAC \u5730\u5740\u8868\u4e3b\u8981\u5305\u542b\u4e24\u4e2a\u4fe1\u606f\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f\u8bbe\u5907\u7684 MAC \u5730\u5740\uff0c</li> <li>\u53e6\u4e00\u4e2a\u662f\u8be5\u8bbe\u5907\u8fde\u63a5\u5728\u4ea4\u6362\u673a\u7684\u54ea\u4e2a\u7aef\u53e3\u4e0a\u3002</li> </ul> <p></p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u6536\u5230\u7684\u5305\u7684\u63a5\u6536\u65b9 MAC \u5730\u5740\u4e3a <code>00-02-B3-1C-9C-F9</code>\uff0c\u5219\u4e0e\u56fe\u4e2d\u8868\u4e2d\u7684\u7b2c 3 \u884c\u5339\u914d\uff0c\u6839\u636e\u7aef\u53e3\u5217\u7684\u4fe1\u606f\uff0c\u53ef\u77e5\u8fd9\u4e2a\u5730\u5740\u4f4d\u4e8e <code>3</code> \u53f7\u7aef\u53e3\u4e0a\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u901a\u8fc7\u4ea4\u6362\u7535\u8def\u5c06\u5305\u53d1\u9001\u5230\u76f8\u5e94\u7684\u7aef\u53e3\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u4ea4\u6362\u673a\u6839\u636e MAC \u5730\u5740\u8868\u67e5\u627e MAC \u5730\u5740\uff0c\u7136\u540e\u5c06\u4fe1\u53f7\u53d1\u9001\u5230\u76f8\u5e94\u7684\u7aef\u53e3\u3002</p> <p>\u5f53 MAC \u5730\u5740\u8868\u627e\u4e0d\u5230\u6307\u5b9a\u7684 MAC \u5730\u5740\u4f1a\u600e\u4e48\u6837\uff1f</p> <p>\u5730\u5740\u8868\u4e2d\u627e\u4e0d\u5230\u6307\u5b9a\u7684 MAC \u5730\u5740\u3002\u8fd9\u53ef\u80fd\u662f\u56e0\u4e3a\u5177\u6709\u8be5\u5730\u5740\u7684\u8bbe\u5907\u8fd8\u6ca1\u6709\u5411\u4ea4\u6362\u673a\u53d1\u9001\u8fc7\u5305\uff0c\u6216\u8005\u8fd9\u4e2a\u8bbe\u5907\u4e00\u6bb5\u65f6\u95f4\u6ca1\u6709\u5de5\u4f5c\u5bfc\u81f4\u5730\u5740\u88ab\u4ece\u5730\u5740\u8868\u4e2d\u5220\u9664\u4e86\u3002</p> <p>\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u4ea4\u6362\u673a\u65e0\u6cd5\u5224\u65ad\u5e94\u8be5\u628a\u5305\u8f6c\u53d1\u5230\u54ea\u4e2a\u7aef\u53e3\uff0c\u53ea\u80fd\u5c06\u5305\u8f6c\u53d1\u5230\u9664\u4e86\u6e90\u7aef\u53e3\u4e4b\u5916\u7684\u6240\u6709\u7aef\u53e3\u4e0a\uff0c\u65e0\u8bba\u8be5\u8bbe\u5907\u8fde\u63a5\u5728\u54ea\u4e2a\u7aef\u53e3\u4e0a\u90fd\u80fd\u6536\u5230\u8fd9\u4e2a\u5305\u3002</p> <p>\u8fd9\u6837\u505a\u4e0d\u4f1a\u4ea7\u751f\u4ec0\u4e48\u95ee\u9898\uff0c\u56e0\u4e3a\u4ee5\u592a\u7f51\u7684\u8bbe\u8ba1\u672c\u6765\u5c31\u662f\u5c06\u5305\u53d1\u9001\u5230\u6574\u4e2a\u7f51\u7edc\u7684\uff0c\u7136\u540e\u53ea\u6709\u76f8\u5e94\u7684\u63a5\u6536\u8005\u624d\u63a5\u6536\u5305\uff0c\u800c\u5176\u4ed6\u8bbe\u5907\u5219\u4f1a\u5ffd\u7565\u8fd9\u4e2a\u5305\u3002</p> <p>\u6709\u4eba\u4f1a\u8bf4\uff1a\u201c\u8fd9\u6837\u505a\u4f1a\u53d1\u9001\u591a\u4f59\u7684\u5305\uff0c\u4f1a\u4e0d\u4f1a\u9020\u6210\u7f51\u7edc\u62e5\u585e\u5462\uff1f\u201d</p> <p>\u5176\u5b9e\u5b8c\u5168\u4e0d\u7528\u8fc7\u4e8e\u62c5\u5fc3\uff0c\u56e0\u4e3a\u53d1\u9001\u4e86\u5305\u4e4b\u540e\u76ee\u6807\u8bbe\u5907\u4f1a\u4f5c\u51fa\u54cd\u5e94\uff0c\u53ea\u8981\u8fd4\u56de\u4e86\u54cd\u5e94\u5305\uff0c\u4ea4\u6362\u673a\u5c31\u53ef\u4ee5\u5c06\u5b83\u7684\u5730\u5740\u5199\u5165 MAC \u5730\u5740\u8868\uff0c\u4e0b\u6b21\u4e5f\u5c31\u4e0d\u9700\u8981\u628a\u5305\u53d1\u5230\u6240\u6709\u7aef\u53e3\u4e86\u3002</p> <p>\u5c40\u57df\u7f51\u4e2d\u6bcf\u79d2\u53ef\u4ee5\u4f20\u8f93\u4e0a\u5343\u4e2a\u5305\uff0c\u591a\u51fa\u4e00\u4e24\u4e2a\u5305\u5e76\u65e0\u5927\u788d\u3002</p> <p>\u6b64\u5916\uff0c\u5982\u679c\u63a5\u6536\u65b9 MAC \u5730\u5740\u662f\u4e00\u4e2a\u5e7f\u64ad\u5730\u5740\uff0c\u90a3\u4e48\u4ea4\u6362\u673a\u4f1a\u5c06\u5305\u53d1\u9001\u5230\u9664\u6e90\u7aef\u53e3\u4e4b\u5916\u7684\u6240\u6709\u7aef\u53e3\u3002</p> <p>\u4ee5\u4e0b\u4e24\u4e2a\u5c5e\u4e8e\u5e7f\u64ad\u5730\u5740\uff1a</p> <ul> <li>MAC \u5730\u5740\u4e2d\u7684 <code>FF:FF:FF:FF:FF:FF</code></li> <li>IP \u5730\u5740\u4e2d\u7684 <code>255.255.255.255</code></li> </ul> <p>\u6570\u636e\u5305\u901a\u8fc7\u4ea4\u6362\u673a\u8f6c\u53d1\u62b5\u8fbe\u4e86\u8def\u7531\u5668\uff0c\u51c6\u5907\u8981\u79bb\u5f00\u571f\u751f\u571f\u957f\u7684\u5b50\u7f51\u4e86\u3002\u6b64\u65f6\uff0c\u6570\u636e\u5305\u548c\u4ea4\u6362\u673a\u79bb\u522b\u65f6\u8bf4\u9053\uff1a\u201c\u611f\u8c22\u4ea4\u6362\u673a\u5144\u5f1f\uff0c\u5e2e\u6211\u8f6c\u53d1\u5230\u51fa\u5883\u7684\u5927\u95e8\uff0c\u6211\u8981\u51fa\u8fdc\u95e8\u5566\uff01\u201d</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#_4","title":"\u51fa\u5883\u5927\u95e8 \u2014\u2014 \u8def\u7531\u5668","text":"<p>\u8def\u7531\u5668\u4e0e\u4ea4\u6362\u673a\u7684\u533a\u522b</p> <p>\u7f51\u7edc\u5305\u7ecf\u8fc7\u4ea4\u6362\u673a\u4e4b\u540e\uff0c\u73b0\u5728\u5230\u8fbe\u4e86\u8def\u7531\u5668\uff0c\u5e76\u5728\u6b64\u88ab\u8f6c\u53d1\u5230\u4e0b\u4e00\u4e2a\u8def\u7531\u5668\u6216\u76ee\u6807\u8bbe\u5907\u3002</p> <p>\u8fd9\u4e00\u6b65\u8f6c\u53d1\u7684\u5de5\u4f5c\u539f\u7406\u548c\u4ea4\u6362\u673a\u7c7b\u4f3c\uff0c\u4e5f\u662f\u901a\u8fc7\u67e5\u8868\u5224\u65ad\u5305\u8f6c\u53d1\u7684\u76ee\u6807\u3002</p> <p>\u4e0d\u8fc7\u5728\u5177\u4f53\u7684\u64cd\u4f5c\u8fc7\u7a0b\u4e0a\uff0c\u8def\u7531\u5668\u548c\u4ea4\u6362\u673a\u662f\u6709\u533a\u522b\u7684\u3002</p> <ul> <li>\u56e0\u4e3a\u8def\u7531\u5668\u662f\u57fa\u4e8e IP \u8bbe\u8ba1\u7684\uff0c\u4fd7\u79f0\u4e09\u5c42\u7f51\u7edc\u8bbe\u5907\uff0c\u8def\u7531\u5668\u7684\u5404\u4e2a\u7aef\u53e3\u90fd\u5177\u6709 MAC \u5730\u5740\u548c IP \u5730\u5740\uff1b</li> <li>\u800c\u4ea4\u6362\u673a\u662f\u57fa\u4e8e\u4ee5\u592a\u7f51\u8bbe\u8ba1\u7684\uff0c\u4fd7\u79f0\u4e8c\u5c42\u7f51\u7edc\u8bbe\u5907\uff0c\u4ea4\u6362\u673a\u7684\u7aef\u53e3\u4e0d\u5177\u6709 MAC \u5730\u5740\u3002</li> </ul> <p>\u8def\u7531\u5668\u57fa\u672c\u539f\u7406</p> <p>\u8def\u7531\u5668\u7684\u7aef\u53e3\u5177\u6709 MAC \u5730\u5740\uff0c\u56e0\u6b64\u5b83\u5c31\u80fd\u591f\u6210\u4e3a\u4ee5\u592a\u7f51\u7684\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\uff1b\u540c\u65f6\u8fd8\u5177\u6709 IP \u5730\u5740\uff0c\u4ece\u8fd9\u4e2a\u610f\u4e49\u4e0a\u6765\u8bf4\uff0c\u5b83\u548c\u8ba1\u7b97\u673a\u7684\u7f51\u5361\u662f\u4e00\u6837\u7684\u3002</p> <p>\u5f53\u8f6c\u53d1\u5305\u65f6\uff0c\u9996\u5148\u8def\u7531\u5668\u7aef\u53e3\u4f1a\u63a5\u6536\u53d1\u7ed9\u81ea\u5df1\u7684\u4ee5\u592a\u7f51\u5305\uff0c\u7136\u540e\u8def\u7531\u8868\u67e5\u8be2\u8f6c\u53d1\u76ee\u6807\uff0c\u518d\u7531\u76f8\u5e94\u7684\u7aef\u53e3\u4f5c\u4e3a\u53d1\u9001\u65b9\u5c06\u4ee5\u592a\u7f51\u5305\u53d1\u9001\u51fa\u53bb\u3002</p> <p>\u8def\u7531\u5668\u7684\u5305\u63a5\u6536\u64cd\u4f5c</p> <p>\u9996\u5148\uff0c\u7535\u4fe1\u53f7\u5230\u8fbe\u7f51\u7ebf\u63a5\u53e3\u90e8\u5206\uff0c\u8def\u7531\u5668\u4e2d\u7684\u6a21\u5757\u4f1a\u5c06\u7535\u4fe1\u53f7\u8f6c\u6210\u6570\u5b57\u4fe1\u53f7\uff0c\u7136\u540e\u901a\u8fc7\u5305\u672b\u5c3e\u7684 <code>FCS</code> \u8fdb\u884c\u9519\u8bef\u6821\u9a8c\u3002</p> <p>\u5982\u679c\u6ca1\u95ee\u9898\u5219\u68c0\u67e5 MAC \u5934\u90e8\u4e2d\u7684\u63a5\u6536\u65b9 MAC \u5730\u5740\uff0c\u770b\u770b\u662f\u4e0d\u662f\u53d1\u7ed9\u81ea\u5df1\u7684\u5305\uff0c\u5982\u679c\u662f\u5c31\u653e\u5230\u63a5\u6536\u7f13\u51b2\u533a\u4e2d\uff0c\u5426\u5219\u5c31\u4e22\u5f03\u8fd9\u4e2a\u5305\u3002</p> <p>\u603b\u7684\u6765\u8bf4\uff0c\u8def\u7531\u5668\u7684\u7aef\u53e3\u90fd\u5177\u6709 MAC \u5730\u5740\uff0c\u53ea\u63a5\u6536\u4e0e\u81ea\u8eab\u5730\u5740\u5339\u914d\u7684\u5305\uff0c\u9047\u5230\u4e0d\u5339\u914d\u7684\u5305\u5219\u76f4\u63a5\u4e22\u5f03\u3002</p> <p>\u67e5\u8be2\u8def\u7531\u8868\u786e\u5b9a\u8f93\u51fa\u7aef\u53e3</p> <p>\u5b8c\u6210\u5305\u63a5\u6536\u64cd\u4f5c\u4e4b\u540e\uff0c\u8def\u7531\u5668\u5c31\u4f1a\u53bb\u6389\u5305\u5f00\u5934\u7684 MAC \u5934\u90e8\u3002</p> <p>MAC \u5934\u90e8\u7684\u4f5c\u7528\u5c31\u662f\u5c06\u5305\u9001\u8fbe\u8def\u7531\u5668\uff0c\u5176\u4e2d\u7684\u63a5\u6536\u65b9 MAC \u5730\u5740\u5c31\u662f\u8def\u7531\u5668\u7aef\u53e3\u7684 MAC \u5730\u5740\u3002\u56e0\u6b64\uff0c\u5f53\u5305\u5230\u8fbe\u8def\u7531\u5668\u4e4b\u540e\uff0cMAC \u5934\u90e8\u7684\u4efb\u52a1\u5c31\u5b8c\u6210\u4e86\uff0c\u4e8e\u662f MAC \u5934\u90e8\u5c31\u4f1a\u88ab\u4e22\u5f03\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8def\u7531\u5668\u4f1a\u6839\u636e MAC \u5934\u90e8\u540e\u65b9\u7684 <code>IP</code> \u5934\u90e8\u4e2d\u7684\u5185\u5bb9\u8fdb\u884c\u5305\u7684\u8f6c\u53d1\u64cd\u4f5c\u3002</p> <p>\u8f6c\u53d1\u64cd\u4f5c\u5206\u4e3a\u51e0\u4e2a\u9636\u6bb5\uff0c\u9996\u5148\u662f\u67e5\u8be2\u8def\u7531\u8868\u5224\u65ad\u8f6c\u53d1\u76ee\u6807\u3002</p> <p></p> <p>\u5177\u4f53\u7684\u5de5\u4f5c\u6d41\u7a0b\u6839\u636e\u4e0a\u56fe\uff0c\u4e3e\u4e2a\u4f8b\u5b50\u3002</p> <p>\u5047\u8bbe\u5730\u5740\u4e3a <code>10.10.1.101</code> \u7684\u8ba1\u7b97\u673a\u8981\u5411\u5730\u5740\u4e3a <code>192.168.1.100</code> \u7684\u670d\u52a1\u5668\u53d1\u9001\u4e00\u4e2a\u5305\uff0c\u8fd9\u4e2a\u5305\u5148\u5230\u8fbe\u56fe\u4e2d\u7684\u8def\u7531\u5668\u3002</p> <p>\u5224\u65ad\u8f6c\u53d1\u76ee\u6807\u7684\u7b2c\u4e00\u6b65\uff0c\u5c31\u662f\u6839\u636e\u5305\u7684\u63a5\u6536\u65b9 IP \u5730\u5740\u67e5\u8be2\u8def\u7531\u8868\u4e2d\u7684\u76ee\u6807\u5730\u5740\u680f\uff0c\u4ee5\u627e\u5230\u76f8\u5339\u914d\u7684\u8bb0\u5f55\u3002</p> <p>\u8def\u7531\u5339\u914d\u548c\u524d\u9762\u8bb2\u7684\u4e00\u6837\uff0c\u6bcf\u4e2a\u6761\u76ee\u7684\u5b50\u7f51\u63a9\u7801\u548c <code>192.168.1.100</code> IP \u505a &amp; \u4e0e\u8fd0\u7b97\u540e\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e0e\u5bf9\u5e94\u6761\u76ee\u7684\u76ee\u6807\u5730\u5740\u8fdb\u884c\u5339\u914d\uff0c\u5982\u679c\u5339\u914d\u5c31\u4f1a\u4f5c\u4e3a\u5019\u9009\u8f6c\u53d1\u76ee\u6807\uff0c\u5982\u679c\u4e0d\u5339\u914d\u5c31\u7ee7\u7eed\u4e0e\u4e0b\u4e2a\u6761\u76ee\u8fdb\u884c\u8def\u7531\u5339\u914d\u3002</p> <p>\u5982\u7b2c\u4e8c\u6761\u76ee\u7684\u5b50\u7f51\u63a9\u7801 <code>255.255.255.0</code> \u4e0e <code>192.168.1.100</code> IP \u505a &amp; \u4e0e\u8fd0\u7b97\u540e\uff0c\u5f97\u5230\u7ed3\u679c\u662f <code>192.168.1.0</code> \uff0c\u8fd9\u4e0e\u7b2c\u4e8c\u6761\u76ee\u7684\u76ee\u6807\u5730\u5740 <code>192.168.1.0</code> \u5339\u914d\uff0c\u8be5\u7b2c\u4e8c\u6761\u76ee\u8bb0\u5f55\u5c31\u4f1a\u88ab\u4f5c\u4e3a\u8f6c\u53d1\u76ee\u6807\u3002</p> <p>\u5b9e\u5728\u627e\u4e0d\u5230\u5339\u914d\u8def\u7531\u65f6\uff0c\u5c31\u4f1a\u9009\u62e9\u9ed8\u8ba4\u8def\u7531\uff0c\u8def\u7531\u8868\u4e2d\u5b50\u7f51\u63a9\u7801\u4e3a <code>0.0.0.0</code> \u7684\u8bb0\u5f55\u8868\u793a\u300c\u9ed8\u8ba4\u8def\u7531\u300d\u3002</p> <p>\u8def\u7531\u5668\u7684\u53d1\u9001\u64cd\u4f5c</p> <p>\u63a5\u4e0b\u6765\u5c31\u4f1a\u8fdb\u5165\u5305\u7684\u53d1\u9001\u64cd\u4f5c\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u9700\u8981\u6839\u636e\u8def\u7531\u8868\u7684\u7f51\u5173\u5217\u5224\u65ad\u5bf9\u65b9\u7684\u5730\u5740\u3002</p> <ul> <li>\u5982\u679c\u7f51\u5173\u662f\u4e00\u4e2a IP \u5730\u5740\uff0c\u5219\u8fd9\u4e2a IP \u5730\u5740\u5c31\u662f\u6211\u4eec\u8981\u8f6c\u53d1\u5230\u7684\u76ee\u6807\u5730\u5740\uff0c\u8fd8\u672a\u62b5\u8fbe\u7ec8\u70b9\uff0c\u8fd8\u9700\u7ee7\u7eed\u9700\u8981\u8def\u7531\u5668\u8f6c\u53d1\u3002</li> <li>\u5982\u679c\u7f51\u5173\u4e3a\u7a7a\uff0c\u5219 IP \u5934\u90e8\u4e2d\u7684\u63a5\u6536\u65b9 IP \u5730\u5740\u5c31\u662f\u8981\u8f6c\u53d1\u5230\u7684\u76ee\u6807\u5730\u5740\uff0c\u4e5f\u662f\u5c31\u7ec8\u4e8e\u627e\u5230 IP \u5305\u5934\u91cc\u7684\u76ee\u6807\u5730\u5740\u4e86\uff0c\u8bf4\u660e\u5df2\u62b5\u8fbe\u7ec8\u70b9\u3002</li> </ul> <p>\u77e5\u9053\u5bf9\u65b9\u7684 IP \u5730\u5740\u4e4b\u540e\uff0c\u63a5\u4e0b\u6765\u9700\u8981\u901a\u8fc7 <code>ARP</code> \u534f\u8bae\u6839\u636e IP \u5730\u5740\u67e5\u8be2 MAC \u5730\u5740\uff0c\u5e76\u5c06\u67e5\u8be2\u7684\u7ed3\u679c\u4f5c\u4e3a\u63a5\u6536\u65b9 MAC \u5730\u5740\u3002</p> <p>\u8def\u7531\u5668\u4e5f\u6709 ARP \u7f13\u5b58\uff0c\u56e0\u6b64\u9996\u5148\u4f1a\u5728 ARP \u7f13\u5b58\u4e2d\u67e5\u8be2\uff0c\u5982\u679c\u627e\u4e0d\u5230\u5219\u53d1\u9001 ARP \u67e5\u8be2\u8bf7\u6c42\u3002</p> <p>\u63a5\u4e0b\u6765\u662f\u53d1\u9001\u65b9 MAC \u5730\u5740\u5b57\u6bb5\uff0c\u8fd9\u91cc\u586b\u5199\u8f93\u51fa\u7aef\u53e3\u7684 MAC \u5730\u5740\u3002\u8fd8\u6709\u4e00\u4e2a\u4ee5\u592a\u7c7b\u578b\u5b57\u6bb5\uff0c\u586b\u5199 <code>0800</code> \uff08\u5341\u516d\u8fdb\u5236\uff09\u8868\u793a IP \u534f\u8bae\u3002</p> <p>\u7f51\u7edc\u5305\u5b8c\u6210\u540e\uff0c\u63a5\u4e0b\u6765\u4f1a\u5c06\u5176\u8f6c\u6362\u6210\u7535\u4fe1\u53f7\u5e76\u901a\u8fc7\u7aef\u53e3\u53d1\u9001\u51fa\u53bb\u3002\u8fd9\u4e00\u6b65\u7684\u5de5\u4f5c\u8fc7\u7a0b\u548c\u8ba1\u7b97\u673a\u4e5f\u662f\u76f8\u540c\u7684\u3002</p> <p>\u53d1\u9001\u51fa\u53bb\u7684\u7f51\u7edc\u5305\u4f1a\u901a\u8fc7\u4ea4\u6362\u673a\u5230\u8fbe\u4e0b\u4e00\u4e2a\u8def\u7531\u5668\u3002\u7531\u4e8e\u63a5\u6536\u65b9 MAC \u5730\u5740\u5c31\u662f\u4e0b\u4e00\u4e2a\u8def\u7531\u5668\u7684\u5730\u5740\uff0c\u6240\u4ee5\u4ea4\u6362\u673a\u4f1a\u6839\u636e\u8fd9\u4e00\u5730\u5740\u5c06\u5305\u4f20\u8f93\u5230\u4e0b\u4e00\u4e2a\u8def\u7531\u5668\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u4e0b\u4e00\u4e2a\u8def\u7531\u5668\u4f1a\u5c06\u5305\u8f6c\u53d1\u7ed9\u518d\u4e0b\u4e00\u4e2a\u8def\u7531\u5668\uff0c\u7ecf\u8fc7\u5c42\u5c42\u8f6c\u53d1\u4e4b\u540e\uff0c\u7f51\u7edc\u5305\u5c31\u5230\u8fbe\u4e86\u6700\u7ec8\u7684\u76ee\u7684\u5730\u3002</p> <p>\u4e0d\u77e5\u4f60\u53d1\u73b0\u4e86\u6ca1\u6709\uff0c\u5728\u7f51\u7edc\u5305\u4f20\u8f93\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6e90 IP \u548c\u76ee\u6807 IP \u59cb\u7ec8\u662f\u4e0d\u4f1a\u53d8\u7684\uff0c\u4e00\u76f4\u53d8\u5316\u7684\u662f MAC \u5730\u5740\uff08NAT\u9664\u5916\uff09\uff0c\u56e0\u4e3a\u9700\u8981 MAC \u5730\u5740\u5728\u4ee5\u592a\u7f51\u5185\u8fdb\u884c\u4e24\u4e2a\u8bbe\u5907\u4e4b\u95f4\u7684\u5305\u4f20\u8f93\u3002</p> <p>\u6570\u636e\u5305\u901a\u8fc7\u591a\u4e2a\u8def\u7531\u5668\u9053\u53cb\u7684\u5e2e\u52a9\uff0c\u5728\u7f51\u7edc\u4e16\u754c\u9014\u7ecf\u4e86\u5f88\u591a\u8def\u7a0b\uff0c\u6700\u7ec8\u62b5\u8fbe\u4e86\u76ee\u7684\u5730\u7684\u57ce\u95e8\uff01\u57ce\u95e8\u503c\u5b88\u7684\u8def\u7531\u5668\uff0c\u53d1\u73b0\u4e86\u8fd9\u4e2a\u5c0f\u5144\u5f1f\u6570\u636e\u5305\u539f\u6765\u662f\u627e\u57ce\u5185\u7684\u4eba\uff0c\u4e8e\u662f\u5b83\u5c31\u5c06\u6570\u636e\u5305\u9001\u8fdb\u4e86\u57ce\u5185\uff0c\u518d\u7ecf\u7531\u57ce\u5185\u7684\u4ea4\u6362\u673a\u5e2e\u52a9\u4e0b\uff0c\u6700\u7ec8\u8f6c\u53d1\u5230\u4e86\u76ee\u7684\u5730\u4e86\u3002\u6570\u636e\u5305\u611f\u6168\u4e07\u5343\u7684\u8bf4\u9053\uff1a\u201c\u591a\u8c22\u8fd9\u4e00\u8def\u4e0a\uff0c\u5404\u8def\u5927\u4fa0\u7684\u76f8\u52a9\uff01\u201d</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#_5","title":"\u4e92\u76f8\u6252\u76ae \u2014\u2014 \u670d\u52a1\u5668 \u4e0e \u5ba2\u6237\u7aef","text":"<p>\u6570\u636e\u5305\u62b5\u8fbe\u4e86\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u80af\u5b9a\u9ad8\u5174\u5440\uff0c\u6b63\u6240\u8c13\u6709\u670b\u81ea\u8fdc\u65b9\u6765\uff0c\u4e0d\u4ea6\u4e50\u4e4e\uff1f</p> <p>\u670d\u52a1\u5668\u9ad8\u5174\u7684\u4e0d\u5f97\u4e86\uff0c\u4e8e\u662f\u5f00\u59cb\u6252\u6570\u636e\u5305\u7684\u76ae\uff01\u5c31\u597d\u50cf\u4f60\u6536\u5230\u5feb\u9012\uff0c\u80fd\u4e0d\u5174\u594b\u5417\uff1f</p> <p></p> <p>\u6570\u636e\u5305\u62b5\u8fbe\u670d\u52a1\u5668\u540e\uff0c\u670d\u52a1\u5668\u4f1a\u5148\u6252\u5f00\u6570\u636e\u5305\u7684 MAC \u5934\u90e8\uff0c\u67e5\u770b\u662f\u5426\u548c\u670d\u52a1\u5668\u81ea\u5df1\u7684 MAC \u5730\u5740\u7b26\u5408\uff0c\u7b26\u5408\u5c31\u5c06\u5305\u6536\u8d77\u6765\u3002</p> <p>\u63a5\u7740\u7ee7\u7eed\u6252\u5f00\u6570\u636e\u5305\u7684 IP \u5934\uff0c\u53d1\u73b0 IP \u5730\u5740\u7b26\u5408\uff0c\u6839\u636e IP \u5934\u4e2d\u534f\u8bae\u9879\uff0c\u77e5\u9053\u81ea\u5df1\u4e0a\u5c42\u662f TCP \u534f\u8bae\u3002</p> <p>\u4e8e\u662f\uff0c\u6252\u5f00 TCP \u7684\u5934\uff0c\u91cc\u9762\u6709\u5e8f\u5217\u53f7\uff0c\u9700\u8981\u770b\u4e00\u770b\u8fd9\u4e2a\u5e8f\u5217\u5305\u662f\u4e0d\u662f\u6211\u60f3\u8981\u7684\uff0c\u5982\u679c\u662f\u5c31\u653e\u5165\u7f13\u5b58\u4e2d\u7136\u540e\u8fd4\u56de\u4e00\u4e2a ACK\uff0c\u5982\u679c\u4e0d\u662f\u5c31\u4e22\u5f03\u3002TCP \u5934\u90e8\u91cc\u9762\u8fd8\u6709\u7aef\u53e3\u53f7\uff0cHTTP \u7684\u670d\u52a1\u5668\u6b63\u5728\u76d1\u542c\u8fd9\u4e2a\u7aef\u53e3\u53f7\u3002</p> <p>\u4e8e\u662f\uff0c\u670d\u52a1\u5668\u81ea\u7136\u5c31\u77e5\u9053\u662f HTTP \u8fdb\u7a0b\u60f3\u8981\u8fd9\u4e2a\u5305\uff0c\u4e8e\u662f\u5c31\u5c06\u5305\u53d1\u7ed9 HTTP \u8fdb\u7a0b\u3002</p> <p>\u670d\u52a1\u5668\u7684 HTTP \u8fdb\u7a0b\u770b\u5230\uff0c\u539f\u6765\u8fd9\u4e2a\u8bf7\u6c42\u662f\u8981\u8bbf\u95ee\u4e00\u4e2a\u9875\u9762\uff0c\u4e8e\u662f\u5c31\u628a\u8fd9\u4e2a\u7f51\u9875\u5c01\u88c5\u5728 HTTP \u54cd\u5e94\u62a5\u6587\u91cc\u3002</p> <p>HTTP \u54cd\u5e94\u62a5\u6587\u4e5f\u9700\u8981\u7a7f\u4e0a TCP\u3001IP\u3001MAC \u5934\u90e8\uff0c\u4e0d\u8fc7\u8fd9\u6b21\u662f\u6e90\u5730\u5740\u662f\u670d\u52a1\u5668 IP \u5730\u5740\uff0c\u76ee\u7684\u5730\u5740\u662f\u5ba2\u6237\u7aef IP \u5730\u5740\u3002</p> <p>\u7a7f\u597d\u5934\u90e8\u8863\u670d\u540e\uff0c\u4ece\u7f51\u5361\u51fa\u53bb\uff0c\u4ea4\u7531\u4ea4\u6362\u673a\u8f6c\u53d1\u5230\u51fa\u57ce\u7684\u8def\u7531\u5668\uff0c\u8def\u7531\u5668\u5c31\u628a\u54cd\u5e94\u6570\u636e\u5305\u53d1\u5230\u4e86\u4e0b\u4e00\u4e2a\u8def\u7531\u5668\uff0c\u5c31\u8fd9\u6837\u8df3\u554a\u8df3\u3002</p> <p>\u6700\u540e\u8df3\u5230\u4e86\u5ba2\u6237\u7aef\u7684\u57ce\u95e8\u628a\u5b88\u7684\u8def\u7531\u5668\uff0c\u8def\u7531\u5668\u6252\u5f00 IP \u5934\u90e8\u53d1\u73b0\u662f\u8981\u627e\u57ce\u5185\u7684\u4eba\uff0c\u4e8e\u662f\u53c8\u628a\u5305\u53d1\u7ed9\u4e86\u57ce\u5185\u7684\u4ea4\u6362\u673a\uff0c\u518d\u7531\u4ea4\u6362\u673a\u8f6c\u53d1\u5230\u5ba2\u6237\u7aef\u3002</p> <p>\u5ba2\u6237\u7aef\u6536\u5230\u4e86\u670d\u52a1\u5668\u7684\u54cd\u5e94\u6570\u636e\u5305\u540e\uff0c\u540c\u6837\u4e5f\u975e\u5e38\u7684\u9ad8\u5174\uff0c\u5ba2\u6237\u80fd\u62c6\u5feb\u9012\u4e86\uff01</p> <p>\u4e8e\u662f\uff0c\u5ba2\u6237\u7aef\u5f00\u59cb\u6252\u76ae\uff0c\u628a\u6536\u5230\u7684\u6570\u636e\u5305\u7684\u76ae\u6252\u5269 HTTP \u54cd\u5e94\u62a5\u6587\u540e\uff0c\u4ea4\u7ed9\u6d4f\u89c8\u5668\u53bb\u6e32\u67d3\u9875\u9762\uff0c\u4e00\u4efd\u7279\u522b\u7684\u6570\u636e\u5305\u5feb\u9012\uff0c\u5c31\u8fd9\u6837\u663e\u793a\u51fa\u6765\u4e86\uff01</p> <p>\u6700\u540e\uff0c\u5ba2\u6237\u7aef\u8981\u79bb\u5f00\u4e86\uff0c\u5411\u670d\u52a1\u5668\u53d1\u8d77\u4e86 TCP \u56db\u6b21\u6325\u624b\uff0c\u81f3\u6b64\u53cc\u65b9\u7684\u8fde\u63a5\u5c31\u65ad\u5f00\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#_6","title":"\u4e00\u4e2a\u6570\u636e\u5305\u81ed\u4e0d\u8981\u8138\u7684\u611f\u53d7","text":"<p>\u4e0b\u9762\u5185\u5bb9\u7684\u300c\u6211\u300d\uff0c\u4ee3\u8868\u300c\u81ed\u7f8e\u7684\u6570\u636e\u5305\u89d2\u8272\u300d\u3002\u6ce8\uff1a\uff08\u62ec\u53f7\u7684\u5185\u5bb9\uff09\u4ee3\u8868\u6211\u7684\u5410\u69fd\uff0c\u4e09\u8fde\u5478\uff01</p> <p>\u6211\u4e00\u5f00\u59cb\u6211\u867d\u7136\u5b64\u5355\u3001\u4e0d\u77e5\u6240\u63aa\uff0c\u4f46\u6ca1\u6709\u505c\u6ede\u4e0d\u524d\u3002\u6211\u4f9d\u7136\u6ee1\u6000\u4fe1\u5fc3\u548c\u52c7\u6c14\u5f00\u59cb\u4e86\u5f81\u9014\u3002\uff08\u4f60\u5f53\u7136\u6709\u52c7\u6c14\uff0c\u4f60\u662f\u5e94\u7528\u5c42\u6570\u636e\uff0c\u540e\u9762\u6709\u5e95\u5c42\u5144\u5f1f\u5f53\u9760\u5c71\uff0c\u6211\u5478\uff01\uff09</p> <p>\u6211\u5f88\u5e86\u5e78\u9047\u5230\u4e86\u5404\u8def\u795e\u901a\u5e7f\u5927\u7684\u5927\u4f6c\uff0c\u6709\u53ef\u9760\u4f20\u8f93\u7684 TCP\u3001\u6709\u8fdc\u7a0b\u5b9a\u4f4d\u529f\u80fd\u7684 IP\u3001\u6709\u6307\u660e\u4e0b\u4e00\u7ad9\u4f4d\u7f6e\u7684 MAC \u7b49\uff08\u4f60\u5f53\u7136\u4f1a\u9047\u5230\uff0c\u56e0\u4e3a\u90fd\u88ab\u8ba1\u7b97\u673a\u5b89\u6392\u597d\u7684\uff0c\u6211\u5478\uff01\uff09\u3002</p> <p>\u8fd9\u4e9b\u5927\u4f6c\u90fd\u7ed9\u6211\u524d\u9762\u52a0\u4e0a\u4e86\u5934\u90e8\uff0c\u4f7f\u5f97\u6211\u80fd\u5728\u4ea4\u6362\u673a\u548c\u8def\u7531\u5668\u7684\u8f6c\u53d1\u4e0b\uff0c\u62b5\u8fbe\u5230\u4e86\u76ee\u7684\u5730\uff01\uff08\u54ce\uff0c\u4f60\u4e5f\u4e0d\u5bb9\u6613\uff0c\u4e0d\u5410\u69fd\u4e86\uff0c\u653e\u8fc7\u4f60\uff01\uff09</p> <p>\u8fd9\u4e00\u8def\u4e0a\u7684\u7ecf\u5386\uff0c\u8ba9\u6211\u8ba4\u8bc6\u5230\u4e86\u7f51\u7edc\u4e16\u754c\u4e2d\u5404\u8def\u5927\u4fa0\u534f\u4f5c\u7684\u91cd\u8981\u6027\uff0c\u662f\u4ed6\u4eec\u7ef4\u62a4\u4e86\u7f51\u7edc\u4e16\u754c\u7684\u79e9\u5e8f\uff0c\u611f\u8c22\u4ed6\u4eec\uff01\uff08\u6211\u5478\uff0c\u4f60\u5e94\u8be5\u611f\u8c22\u4f17\u591a\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6\uff01\uff09</p> <p>\u53c2\u8003\u8d44\u6599</p> <p>[1] \u6237\u6839\u52e4\u3002\u7f51\u7edc\u662f\u600e\u4e48\u8fde\u63a5\u7684\u3002\u4eba\u6c11\u90ae\u7535\u51fa\u7248\u793e\u3002</p> <p>[2] \u5218\u8d85\u3002\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u3002\u6781\u5ba2\u65f6\u95f4\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/1_base/what_happen_url/#_7","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u8bfb\u8005\u95ee\uff1a\u201c\u7b14\u8bb0\u672c\u7684\u662f\u81ea\u5e26\u4ea4\u6362\u673a\u7684\u5417\uff1f\u4ea4\u6362\u673a\u73b0\u5728\u6211\u8fd8\u4e0d\u77e5\u9053\u662f\u4ec0\u4e48\u201d</p> <p>\u7b14\u8bb0\u672c\u4e0d\u662f\u4ea4\u6362\u673a\uff0c\u4ea4\u6362\u673a\u901a\u5e38\u662f 2 \u4e2a\u7f51\u53e3\u4ee5\u4e0a\u3002</p> <p>\u73b0\u5728\u5bb6\u91cc\u7684\u8def\u7531\u5668\u5176\u5b9e\u6709\u4e86\u4ea4\u6362\u673a\u7684\u529f\u80fd\u4e86\u3002\u4ea4\u6362\u673a\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u6210\u4e00\u4e2a\u8bbe\u5907\uff0c\u4e09\u53f0\u7535\u8111\u7f51\u7ebf\u63a5\u5230\u8fd9\u4e2a\u8bbe\u5907\uff0c\u8fd9\u4e09\u53f0\u7535\u8111\u5c31\u53ef\u4ee5\u4e92\u76f8\u901a\u4fe1\u4e86\uff0c\u4ea4\u6362\u673a\u561b\uff0c\u4ea4\u6362\u6570\u636e\u8fd9\u4e48\u7406\u89e3\u5c31\u53ef\u4ee5\u3002</p> <p>\u8bfb\u8005\u95ee\uff1a\u201c\u5982\u679c\u77e5\u9053\u4f60\u7535\u8111\u7684 Mac \u5730\u5740\uff0c\u6211\u53ef\u4ee5\u76f4\u63a5\u7ed9\u4f60\u53d1\u6d88\u606f\u5417\uff1f\u201d</p> <p>Mac \u5730\u5740\u53ea\u80fd\u662f\u4e24\u4e2a\u8bbe\u5907\u4e4b\u95f4\u4f20\u9012\u65f6\u4f7f\u7528\u7684\uff0c\u5982\u679c\u4f60\u8981\u4ece\u5927\u8001\u8fdc\u7ed9\u6211\u53d1\u6d88\u606f\uff0c\u662f\u79bb\u4e0d\u5f00 IP \u7684\u3002</p> <p>\u8bfb\u8005\u95ee\uff1a\u201c\u8bf7\u95ee\u516c\u7f51\u670d\u52a1\u5668\u7684 Mac \u5730\u5740\u662f\u5728\u4ec0\u4e48\u65f6\u673a\u901a\u8fc7\u4ec0\u4e48\u65b9\u5f0f\u83b7\u53d6\u5230\u7684\uff1f\u6211\u770b ARP \u83b7\u53d6 Mac \u5730\u5740\u53ea\u80fd\u83b7\u53d6\u5230\u5185\u7f51\u673a\u5668\u7684 Mac \u5730\u5740\u5427\uff1f\u201d</p> <p>\u5728\u53d1\u9001\u6570\u636e\u5305\u65f6\uff0c\u5982\u679c\u76ee\u6807\u4e3b\u673a\u4e0d\u662f\u672c\u5730\u5c40\u57df\u7f51\uff0c\u586b\u5165\u7684 Mac \u5730\u5740\u662f\u8def\u7531\u5668\uff0c\u4e5f\u5c31\u662f\u628a\u6570\u636e\u5305\u8f6c\u53d1\u7ed9\u8def\u7531\u5668\uff0c\u8def\u7531\u5668\u4e00\u76f4\u8f6c\u53d1\u4e0b\u4e00\u4e2a\u8def\u7531\u5668\uff0c\u76f4\u5230\u8f6c\u53d1\u5230\u76ee\u6807\u4e3b\u673a\u7684\u8def\u7531\u5668\uff0c\u53d1\u73b0 IP \u5730\u5740\u662f\u81ea\u5df1\u5c40\u57df\u7f51\u5185\u7684\u4e3b\u673a\uff0c\u5c31\u4f1a ARP \u8bf7\u6c42\u83b7\u53d6\u76ee\u6807\u4e3b\u673a\u7684 Mac \u5730\u5740\uff0c\u4ece\u800c\u8f6c\u53d1\u5230\u8fd9\u4e2a\u670d\u52a1\u5668\u4e3b\u673a\u3002</p> <p>\u8f6c\u53d1\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6e90 IP \u5730\u5740\u548c\u76ee\u6807 IP \u5730\u5740\u662f\u4e0d\u4f1a\u53d8\u7684\uff08\u524d\u63d0\uff1a\u6ca1\u6709\u4f7f\u7528 NAT \u7f51\u7edc\u7684\uff09\uff0c\u6e90 MAC \u5730\u5740\u548c\u76ee\u6807 MAC \u5730\u5740\u662f\u4f1a\u53d8\u5316\u7684\u3002</p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u6211\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/","title":"3.6 HTTP/2 \u725b\u903c\u5728\u54ea\uff1f","text":"<p>\u4e0d\u591a BB \u4e86\uff0c\u76f4\u63a5\u53d1\u8f66\uff01</p> <p>\u4e00\u8d77\u6765\u770b\u770b HTTP/2 \u725b\u903c\u5728\u54ea\uff1f</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/#http11","title":"HTTP/1.1 \u534f\u8bae\u7684\u6027\u80fd\u95ee\u9898","text":"<p>\u6211\u4eec\u5f97\u5148\u8981\u4e86\u89e3\u4e0b HTTP/1.1 \u534f\u8bae\u5b58\u5728\u7684\u6027\u80fd\u95ee\u9898\uff0c\u56e0\u4e3a HTTP/2 \u534f\u8bae\u5c31\u662f\u628a\u8fd9\u4e9b\u6027\u80fd\u95ee\u9898\u9010\u4e2a\u653b\u7834\u4e86\u3002</p> <p>\u73b0\u5728\u7684\u7ad9\u70b9\u76f8\u6bd4\u4ee5\u524d\u53d8\u5316\u592a\u591a\u4e86\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u6d88\u606f\u7684\u5927\u5c0f\u53d8\u5927\u4e86\uff0c\u4ece\u51e0 KB \u5927\u5c0f\u7684\u6d88\u606f\uff0c\u5230\u51e0 MB \u5927\u5c0f\u7684\u6d88\u606f\uff1b</li> <li>\u9875\u9762\u8d44\u6e90\u53d8\u591a\u4e86\uff0c\u4ece\u6bcf\u4e2a\u9875\u9762\u4e0d\u5230 10 \u4e2a\u7684\u8d44\u6e90\uff0c\u5230\u6bcf\u9875\u8d85 100 \u591a\u4e2a\u8d44\u6e90\uff1b</li> <li>\u5185\u5bb9\u5f62\u5f0f\u53d8\u591a\u6837\u4e86\uff0c\u4ece\u5355\u7eaf\u5230\u6587\u672c\u5185\u5bb9\uff0c\u5230\u56fe\u7247\u3001\u89c6\u9891\u3001\u97f3\u9891\u7b49\u5185\u5bb9\uff1b</li> <li>\u5b9e\u65f6\u6027\u8981\u6c42\u53d8\u9ad8\u4e86\uff0c\u5bf9\u9875\u9762\u7684\u5b9e\u65f6\u6027\u8981\u6c42\u7684\u5e94\u7528\u8d8a\u6765\u8d8a\u591a\uff1b</li> </ul> <p>\u8fd9\u4e9b\u53d8\u5316\u5e26\u6765\u7684\u6700\u5927\u6027\u80fd\u95ee\u9898\u5c31\u662f HTTP/1.1 \u7684\u9ad8\u5ef6\u8fdf\uff0c\u5ef6\u8fdf\u9ad8\u5fc5\u7136\u5f71\u54cd\u7684\u5c31\u662f\u7528\u6237\u4f53\u9a8c\u3002\u4e3b\u8981\u539f\u56e0\u5982\u4e0b\u51e0\u4e2a\uff1a</p> <ul> <li>\u5ef6\u8fdf\u96be\u4ee5\u4e0b\u964d\uff0c\u867d\u7136\u73b0\u5728\u7f51\u7edc\u7684\u300c\u5e26\u5bbd\u300d\u76f8\u6bd4\u4ee5\u524d\u53d8\u591a\u4e86\uff0c\u4f46\u662f\u5ef6\u8fdf\u964d\u5230\u4e00\u5b9a\u5e45\u5ea6\u540e\uff0c\u5c31\u5f88\u96be\u518d\u4e0b\u964d\u4e86\uff0c\u8bf4\u767d\u4e86\u5c31\u662f\u5230\u8fbe\u4e86\u5ef6\u8fdf\u7684\u4e0b\u9650\uff1b</li> <li>\u5e76\u53d1\u8fde\u63a5\u6709\u9650\uff0c\u8c37\u6b4c\u6d4f\u89c8\u5668\u6700\u5927\u5e76\u53d1\u8fde\u63a5\u6570\u662f 6 \u4e2a\uff0c\u800c\u4e14\u6bcf\u4e00\u4e2a\u8fde\u63a5\u90fd\u8981\u7ecf\u8fc7 TCP \u548c TLS \u63e1\u624b\u8017\u65f6\uff0c\u4ee5\u53ca TCP \u6162\u542f\u52a8\u8fc7\u7a0b\u7ed9\u6d41\u91cf\u5e26\u6765\u7684\u5f71\u54cd\uff1b</li> <li>\u961f\u5934\u963b\u585e\u95ee\u9898\uff0c\u540c\u4e00\u8fde\u63a5\u53ea\u80fd\u5728\u5b8c\u6210\u4e00\u4e2a HTTP \u4e8b\u52a1\uff08\u8bf7\u6c42\u548c\u54cd\u5e94\uff09\u540e\uff0c\u624d\u80fd\u5904\u7406\u4e0b\u4e00\u4e2a\u4e8b\u52a1\uff1b</li> <li>HTTP \u5934\u90e8\u5de8\u5927\u4e14\u91cd\u590d\uff0c\u7531\u4e8e HTTP \u534f\u8bae\u662f\u65e0\u72b6\u6001\u7684\uff0c\u6bcf\u4e00\u4e2a\u8bf7\u6c42\u90fd\u5f97\u643a\u5e26 HTTP \u5934\u90e8\uff0c\u7279\u522b\u662f\u5bf9\u4e8e\u6709\u643a\u5e26 Cookie \u7684\u5934\u90e8\uff0c\u800c Cookie \u7684\u5927\u5c0f\u901a\u5e38\u5f88\u5927\uff1b</li> <li>\u4e0d\u652f\u6301\u670d\u52a1\u5668\u63a8\u9001\u6d88\u606f\uff0c\u56e0\u6b64\u5f53\u5ba2\u6237\u7aef\u9700\u8981\u83b7\u53d6\u901a\u77e5\u65f6\uff0c\u53ea\u80fd\u901a\u8fc7\u5b9a\u65f6\u5668\u4e0d\u65ad\u5730\u62c9\u53d6\u6d88\u606f\uff0c\u8fd9\u65e0\u7591\u6d6a\u8d39\u5927\u91cf\u4e86\u5e26\u5bbd\u548c\u670d\u52a1\u5668\u8d44\u6e90\u3002</li> </ul> <p>\u4e3a\u4e86\u89e3\u51b3 HTTP/1.1 \u6027\u80fd\u95ee\u9898\uff0c\u5177\u4f53\u7684\u4f18\u5316\u624b\u6bb5\u4f60\u53ef\u4ee5\u770b\u8fd9\u7bc7\u6587\u7ae0\u300cHTTP/1.1 \u5982\u4f55\u4f18\u5316\uff1f\u300d\uff0c\u8fd9\u91cc\u6211\u4e3e\u4f8b\u51e0\u4e2a\u5e38\u89c1\u7684\u4f18\u5316\u624b\u6bb5\uff1a</p> <ul> <li>\u5c06\u591a\u5f20\u5c0f\u56fe\u5408\u5e76\u6210\u4e00\u5f20\u5927\u56fe\u4f9b\u6d4f\u89c8\u5668 JavaScript \u6765\u5207\u5272\u4f7f\u7528\uff0c\u8fd9\u6837\u53ef\u4ee5\u5c06\u591a\u4e2a\u8bf7\u6c42\u5408\u5e76\u6210\u4e00\u4e2a\u8bf7\u6c42\uff0c\u4f46\u662f\u5e26\u6765\u4e86\u65b0\u7684\u95ee\u9898\uff0c\u5f53\u67d0\u5f20\u5c0f\u56fe\u7247\u66f4\u65b0\u4e86\uff0c\u90a3\u4e48\u9700\u8981\u91cd\u65b0\u8bf7\u6c42\u5927\u56fe\u7247\uff0c\u6d6a\u8d39\u4e86\u5927\u91cf\u7684\u7f51\u7edc\u5e26\u5bbd\uff1b</li> <li>\u5c06\u56fe\u7247\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u901a\u8fc7 Base64 \u7f16\u7801\u540e\uff0c\u628a\u7f16\u7801\u6570\u636e\u5d4c\u5165\u5230 HTML \u6216 CSS \u6587\u4ef6\u4e2d\uff0c\u4ee5\u6b64\u6765\u51cf\u5c11\u7f51\u7edc\u8bf7\u6c42\u6b21\u6570\uff1b</li> <li>\u5c06\u591a\u4e2a\u4f53\u79ef\u8f83\u5c0f\u7684 JavaScript \u6587\u4ef6\u4f7f\u7528 Webpack \u7b49\u5de5\u5177\u6253\u5305\u6210\u4e00\u4e2a\u4f53\u79ef\u66f4\u5927\u7684 JavaScript \u6587\u4ef6\uff0c\u4ee5\u4e00\u4e2a\u8bf7\u6c42\u66ff\u4ee3\u4e86\u5f88\u591a\u4e2a\u8bf7\u6c42\uff0c\u4f46\u662f\u5e26\u6765\u7684\u95ee\u9898\uff0c\u5f53\u67d0\u4e2a js \u6587\u4ef6\u53d8\u5316\u4e86\uff0c\u9700\u8981\u91cd\u65b0\u8bf7\u6c42\u540c\u4e00\u4e2a\u5305\u91cc\u7684\u6240\u6709 js \u6587\u4ef6\uff1b</li> <li>\u5c06\u540c\u4e00\u4e2a\u9875\u9762\u7684\u8d44\u6e90\u5206\u6563\u5230\u4e0d\u540c\u57df\u540d\uff0c\u63d0\u5347\u5e76\u53d1\u8fde\u63a5\u4e0a\u9650\uff0c\u56e0\u4e3a\u6d4f\u89c8\u5668\u901a\u5e38\u5bf9\u540c\u4e00\u57df\u540d\u7684 HTTP \u8fde\u63a5\u6700\u5927\u53ea\u80fd\u662f 6 \u4e2a\uff1b</li> </ul> <p>\u5c3d\u7ba1\u5bf9 HTTP/1.1 \u534f\u8bae\u7684\u4f18\u5316\u624b\u6bb5\u5982\u6b64\u4e4b\u591a\uff0c\u4f46\u662f\u6548\u679c\u8fd8\u662f\u4e0d\u5c3d\u4eba\u610f\uff0c\u56e0\u4e3a\u8fd9\u4e9b\u624b\u6bb5\u90fd\u662f\u5bf9 HTTP/1.1 \u534f\u8bae\u7684\u201c\u5916\u90e8\u201d\u505a\u4f18\u5316\uff0c\u800c\u4e00\u4e9b\u5173\u952e\u7684\u5730\u65b9\u662f\u6ca1\u529e\u6cd5\u4f18\u5316\u7684\uff0c\u6bd4\u5982\u8bf7\u6c42 - \u54cd\u5e94\u6a21\u578b\u3001\u5934\u90e8\u5de8\u5927\u4e14\u91cd\u590d\u3001\u5e76\u53d1\u8fde\u63a5\u8017\u65f6\u3001\u670d\u52a1\u5668\u4e0d\u80fd\u4e3b\u52a8\u63a8\u9001\u7b49\uff0c\u8981\u6539\u53d8\u8fd9\u4e9b\u5fc5\u987b\u91cd\u65b0\u8bbe\u8ba1 HTTP \u534f\u8bae\uff0c\u4e8e\u662f HTTP/2 \u5c31\u51fa\u6765\u4e86\uff01</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/#http11_1","title":"\u517c\u5bb9 HTTP/1.1","text":"<p>HTTP/2 \u51fa\u6765\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u6539\u5584 HTTP \u7684\u6027\u80fd\u3002\u534f\u8bae\u5347\u7ea7\u6709\u4e00\u4e2a\u5f88\u91cd\u8981\u7684\u5730\u65b9\uff0c\u5c31\u662f\u8981\u517c\u5bb9\u8001\u7248\u672c\u7684\u534f\u8bae\uff0c\u5426\u5219\u65b0\u534f\u8bae\u63a8\u5e7f\u8d77\u6765\u5c31\u76f8\u5f53\u56f0\u96be\uff0c\u6240\u5e78 HTTP/2 \u505a\u5230\u4e86\u517c\u5bb9 HTTP/1.1\u3002</p> <p>\u90a3\u4e48\uff0cHTTP/2 \u662f\u600e\u4e48\u505a\u7684\u5462\uff1f</p> <p>\u7b2c\u4e00\u70b9\uff0cHTTP/2 \u6ca1\u6709\u5728 URI \u91cc\u5f15\u5165\u65b0\u7684\u534f\u8bae\u540d\uff0c\u4ecd\u7136\u7528\u300chttp://\u300d\u8868\u793a\u660e\u6587\u534f\u8bae\uff0c\u7528\u300chttps://\u300d\u8868\u793a\u52a0\u5bc6\u534f\u8bae\uff0c\u4e8e\u662f\u53ea\u9700\u8981\u6d4f\u89c8\u5668\u548c\u670d\u52a1\u5668\u5728\u80cc\u540e\u81ea\u52a8\u5347\u7ea7\u534f\u8bae\uff0c\u8fd9\u6837\u53ef\u4ee5\u8ba9\u7528\u6237\u610f\u8bc6\u4e0d\u5230\u534f\u8bae\u7684\u5347\u7ea7\uff0c\u5f88\u597d\u7684\u5b9e\u73b0\u4e86\u534f\u8bae\u7684\u5e73\u6ed1\u5347\u7ea7\u3002</p> <p>\u7b2c\u4e8c\u70b9\uff0c\u53ea\u5728\u5e94\u7528\u5c42\u505a\u4e86\u6539\u53d8\uff0c\u8fd8\u662f\u57fa\u4e8e TCP \u534f\u8bae\u4f20\u8f93\uff0c\u5e94\u7528\u5c42\u65b9\u9762\u4e3a\u4e86\u4fdd\u6301\u529f\u80fd\u4e0a\u7684\u517c\u5bb9\uff0cHTTP/2 \u628a HTTP \u5206\u89e3\u6210\u4e86\u300c\u8bed\u4e49\u300d\u548c\u300c\u8bed\u6cd5\u300d\u4e24\u4e2a\u90e8\u5206\uff0c\u300c\u8bed\u4e49\u300d\u5c42\u4e0d\u505a\u6539\u52a8\uff0c\u4e0e HTTP/1.1 \u5b8c\u5168\u4e00\u81f4\uff0c\u6bd4\u5982\u8bf7\u6c42\u65b9\u6cd5\u3001\u72b6\u6001\u7801\u3001\u5934\u5b57\u6bb5\u7b49\u89c4\u5219\u4fdd\u7559\u4e0d\u53d8\u3002</p> <p>\u4f46\u662f\uff0cHTTP/2 \u5728\u300c\u8bed\u6cd5\u300d\u5c42\u9762\u505a\u4e86\u5f88\u591a\u6539\u9020\uff0c\u57fa\u672c\u6539\u53d8\u4e86 HTTP \u62a5\u6587\u7684\u4f20\u8f93\u683c\u5f0f\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/#_1","title":"\u5934\u90e8\u538b\u7f29","text":"<p>HTTP \u534f\u8bae\u7684\u62a5\u6587\u662f\u7531\u300cHeader + Body\u300d\u6784\u6210\u7684\uff0c\u5bf9\u4e8e Body \u90e8\u5206\uff0cHTTP/1.1 \u534f\u8bae\u53ef\u4ee5\u4f7f\u7528\u5934\u5b57\u6bb5\u300cContent-Encoding\u300d\u6307\u5b9a Body \u7684\u538b\u7f29\u65b9\u5f0f\uff0c\u6bd4\u5982\u7528 gzip \u538b\u7f29\uff0c\u8fd9\u6837\u53ef\u4ee5\u8282\u7ea6\u5e26\u5bbd\uff0c\u4f46\u62a5\u6587\u4e2d\u7684\u53e6\u5916\u4e00\u90e8\u5206 Header\uff0c\u662f\u6ca1\u6709\u9488\u5bf9\u5b83\u7684\u4f18\u5316\u624b\u6bb5\u3002</p> <p>HTTP/1.1 \u62a5\u6587\u4e2d Header \u90e8\u5206\u5b58\u5728\u7684\u95ee\u9898\uff1a</p> <ul> <li>\u542b\u5f88\u591a\u56fa\u5b9a\u7684\u5b57\u6bb5\uff0c\u6bd4\u5982 Cookie\u3001User Agent\u3001Accept \u7b49\uff0c\u8fd9\u4e9b\u5b57\u6bb5\u52a0\u8d77\u6765\u4e5f\u9ad8\u8fbe\u51e0\u767e\u5b57\u8282\u751a\u81f3\u4e0a\u5343\u5b57\u8282\uff0c\u6240\u4ee5\u6709\u5fc5\u8981\u538b\u7f29\uff1b</li> <li>\u5927\u91cf\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u62a5\u6587\u91cc\u6709\u5f88\u591a\u5b57\u6bb5\u503c\u90fd\u662f\u91cd\u590d\u7684\uff0c\u8fd9\u6837\u4f1a\u4f7f\u5f97\u5927\u91cf\u5e26\u5bbd\u88ab\u8fd9\u4e9b\u5197\u4f59\u7684\u6570\u636e\u5360\u7528\u4e86\uff0c\u6240\u4ee5\u6709\u5fc5\u987b\u8981\u907f\u514d\u91cd\u590d\u6027\uff1b</li> <li>\u5b57\u6bb5\u662f ASCII \u7f16\u7801\u7684\uff0c\u867d\u7136\u6613\u4e8e\u4eba\u7c7b\u89c2\u5bdf\uff0c\u4f46\u6548\u7387\u4f4e\uff0c\u6240\u4ee5\u6709\u5fc5\u8981\u6539\u6210\u4e8c\u8fdb\u5236\u7f16\u7801\uff1b</li> </ul> <p>HTTP/2 \u5bf9 Header \u90e8\u5206\u505a\u4e86\u5927\u6539\u9020\uff0c\u628a\u4ee5\u4e0a\u7684\u95ee\u9898\u90fd\u89e3\u51b3\u4e86\u3002</p> <p>HTTP/2 \u6ca1\u4f7f\u7528\u5e38\u89c1\u7684 gzip \u538b\u7f29\u65b9\u5f0f\u6765\u538b\u7f29\u5934\u90e8\uff0c\u800c\u662f\u5f00\u53d1\u4e86 HPACK \u7b97\u6cd5\uff0cHPACK \u7b97\u6cd5\u4e3b\u8981\u5305\u542b\u4e09\u4e2a\u7ec4\u6210\u90e8\u5206\uff1a</p> <ul> <li>\u9759\u6001\u5b57\u5178\uff1b</li> <li>\u52a8\u6001\u5b57\u5178\uff1b</li> <li>Huffman \u7f16\u7801\uff08\u538b\u7f29\u7b97\u6cd5\uff09\uff1b</li> </ul> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e24\u7aef\u90fd\u4f1a\u5efa\u7acb\u548c\u7ef4\u62a4\u300c\u5b57\u5178\u300d\uff0c\u7528\u957f\u5ea6\u8f83\u5c0f\u7684\u7d22\u5f15\u53f7\u8868\u793a\u91cd\u590d\u7684\u5b57\u7b26\u4e32\uff0c\u518d\u7528 Huffman \u7f16\u7801\u538b\u7f29\u6570\u636e\uff0c\u53ef\u8fbe\u5230 50%~90% \u7684\u9ad8\u538b\u7f29\u7387\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/#_2","title":"\u9759\u6001\u8868\u7f16\u7801","text":"<p>HTTP/2 \u4e3a\u9ad8\u9891\u51fa\u73b0\u5728\u5934\u90e8\u7684\u5b57\u7b26\u4e32\u548c\u5b57\u6bb5\u5efa\u7acb\u4e86\u4e00\u5f20\u9759\u6001\u8868\uff0c\u5b83\u662f\u5199\u5165\u5230 HTTP/2 \u6846\u67b6\u91cc\u7684\uff0c\u4e0d\u4f1a\u53d8\u5316\u7684\uff0c\u9759\u6001\u8868\u91cc\u5171\u6709 <code>61</code> \u7ec4\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8868\u4e2d\u7684 <code>Index</code> \u8868\u793a\u7d22\u5f15\uff08Key\uff09\uff0c<code>Header Value</code> \u8868\u793a\u7d22\u5f15\u5bf9\u5e94\u7684  Value\uff0c<code>Header Name</code> \u8868\u793a\u5b57\u6bb5\u7684\u540d\u5b57\uff0c\u6bd4\u5982 Index \u4e3a 2 \u4ee3\u8868 GET\uff0cIndex \u4e3a 8 \u4ee3\u8868\u72b6\u6001\u7801 200\u3002</p> <p>\u4f60\u53ef\u80fd\u6ce8\u610f\u5230\uff0c\u8868\u4e2d\u6709\u7684 Index \u6ca1\u6709\u5bf9\u5e94\u7684 Header Value\uff0c\u8fd9\u662f\u56e0\u4e3a\u8fd9\u4e9b Value \u5e76\u4e0d\u662f\u56fa\u5b9a\u7684\u800c\u662f\u53d8\u5316\u7684\uff0c\u8fd9\u4e9b Value \u90fd\u4f1a\u7ecf\u8fc7 Huffman \u7f16\u7801\u540e\uff0c\u624d\u4f1a\u53d1\u9001\u51fa\u53bb\u3002</p> <p>\u8fd9\u4e48\u8bf4\u6709\u70b9\u62bd\u8c61\uff0c\u6211\u4eec\u6765\u770b\u4e2a\u5177\u4f53\u7684\u4f8b\u5b50\uff0c\u4e0b\u9762\u8fd9\u4e2a <code>server</code> \u5934\u90e8\u5b57\u6bb5\uff0c\u5728 HTTP/1.1 \u7684\u5f62\u5f0f\u5982\u4e0b\uff1a</p> Text Only<pre><code>server: nghttpx\\r\\n\n</code></pre> <p>\u7b97\u4e0a\u5192\u53f7\u7a7a\u683c\u548c\u672b\u5c3e\u7684<code>\\r\\n</code>\uff0c\u5171\u5360\u7528\u4e86 17 \u5b57\u8282\uff0c\u800c\u4f7f\u7528\u4e86\u9759\u6001\u8868\u548c Huffman \u7f16\u7801\uff0c\u53ef\u4ee5\u5c06\u5b83\u538b\u7f29\u6210 8 \u5b57\u8282\uff0c\u538b\u7f29\u7387\u5927\u6982 47%\u3002</p> <p>\u6211\u6293\u4e86\u4e2a HTTP/2 \u534f\u8bae\u7684\u7f51\u7edc\u5305\uff0c\u4f60\u53ef\u4ee5\u4ece\u4e0b\u56fe\u770b\u5230\uff0c\u9ad8\u4eae\u90e8\u5206\u5c31\u662f <code>server</code> \u5934\u90e8\u5b57\u6bb5\uff0c\u53ea\u7528\u4e86 8 \u4e2a\u5b57\u8282\u6765\u8868\u793a <code>server</code> \u5934\u90e8\u6570\u636e\u3002</p> <p></p> <p>\u6839\u636e RFC7541 \u89c4\u8303\uff0c\u5982\u679c\u5934\u90e8\u5b57\u6bb5\u5c5e\u4e8e\u9759\u6001\u8868\u8303\u56f4\uff0c\u5e76\u4e14 Value \u662f\u53d8\u5316\uff0c\u90a3\u4e48\u5b83\u7684 HTTP/2 \u5934\u90e8\u524d 2 \u4f4d\u56fa\u5b9a\u4e3a <code>01</code>\uff0c\u6240\u4ee5\u6574\u4e2a\u5934\u90e8\u683c\u5f0f\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>HTTP/2 \u5934\u90e8\u7531\u4e8e\u57fa\u4e8e\u4e8c\u8fdb\u5236\u7f16\u7801\uff0c\u5c31\u4e0d\u9700\u8981\u5192\u53f7\u7a7a\u683c\u548c\u672b\u5c3e\u7684\\r\\n \u4f5c\u4e3a\u5206\u9694\u7b26\uff0c\u4e8e\u662f\u6539\u7528\u8868\u793a\u5b57\u7b26\u4e32\u957f\u5ea6\uff08Value Length\uff09\u6765\u5206\u5272 Index \u548c Value\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6839\u636e\u8fd9\u4e2a\u5934\u90e8\u683c\u5f0f\u6765\u5206\u6790\u4e0a\u9762\u6293\u5305\u7684 <code>server</code> \u5934\u90e8\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u3002</p> <p>\u9996\u5148\uff0c\u4ece\u9759\u6001\u8868\u4e2d\u80fd\u67e5\u5230 <code>server</code> \u5934\u90e8\u5b57\u6bb5\u7684 Index \u4e3a 54\uff0c\u4e8c\u8fdb\u5236\u4e3a 110110\uff0c\u518d\u52a0\u4e0a\u56fa\u5b9a 01\uff0c\u5934\u90e8\u683c\u5f0f\u7b2c 1 \u4e2a\u5b57\u8282\u5c31\u662f <code>01110110</code>\uff0c\u8fd9\u6b63\u662f\u4e0a\u9762\u6293\u5305\u6807\u6ce8\u7684\u7ea2\u8272\u90e8\u5206\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u3002        </p> <p>\u7136\u540e\uff0c\u7b2c\u4e8c\u4e2a\u5b57\u8282\u7684\u9996\u4e2a\u6bd4\u7279\u4f4d\u8868\u793a Value \u662f\u5426\u7ecf\u8fc7 Huffman \u7f16\u7801\uff0c\u5269\u4f59\u7684 7 \u4f4d\u8868\u793a Value \u7684\u957f\u5ea6\uff0c\u6bd4\u5982\u8fd9\u6b21\u4f8b\u5b50\u7684\u7b2c\u4e8c\u4e2a\u5b57\u8282\u4e3a <code>10000110</code>\uff0c\u9996\u4f4d\u6bd4\u7279\u4f4d\u4e3a 1 \u5c31\u4ee3\u8868 Value \u5b57\u7b26\u4e32\u662f\u7ecf\u8fc7 Huffman \u7f16\u7801\u7684\uff0c\u7ecf\u8fc7 Huffman \u7f16\u7801\u7684 Value \u957f\u5ea6\u4e3a 6\u3002</p> <p>\u6700\u540e\uff0c\u5b57\u7b26\u4e32 <code>nghttpx</code> \u7ecf\u8fc7 Huffman \u7f16\u7801\u540e\u538b\u7f29\u6210\u4e86 6 \u4e2a\u5b57\u8282\uff0cHuffman \u7f16\u7801\u7684\u539f\u7406\u662f\u5c06\u9ad8\u9891\u51fa\u73b0\u7684\u4fe1\u606f\u7528\u300c\u8f83\u77ed\u300d\u7684\u7f16\u7801\u8868\u793a\uff0c\u4ece\u800c\u7f29\u51cf\u5b57\u7b26\u4e32\u957f\u5ea6\u3002</p> <p>\u4e8e\u662f\uff0c\u5728\u7edf\u8ba1\u5927\u91cf\u7684 HTTP \u5934\u90e8\u540e\uff0cHTTP/2 \u6839\u636e\u51fa\u73b0\u9891\u7387\u5c06 ASCII \u7801\u7f16\u7801\u4e3a\u4e86 Huffman \u7f16\u7801\u8868\uff0c\u53ef\u4ee5\u5728 RFC7541 \u6587\u6863\u627e\u5230\u8fd9\u5f20\u9759\u6001 Huffman \u8868\uff0c\u6211\u5c31\u4e0d\u628a\u8868\u7684\u5168\u90e8\u5185\u5bb9\u5217\u51fa\u6765\u4e86\uff0c\u6211\u53ea\u5217\u51fa\u5b57\u7b26\u4e32 <code>nghttpx</code> \u4e2d\u6bcf\u4e2a\u5b57\u7b26\u5bf9\u5e94\u7684 Huffman \u7f16\u7801\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u901a\u8fc7\u67e5\u8868\u540e\uff0c\u5b57\u7b26\u4e32 <code>nghttpx</code> \u7684 Huffman \u7f16\u7801\u5728\u4e0b\u56fe\u770b\u5230\uff0c\u5171 6 \u4e2a\u5b57\u8282\uff0c\u6bcf\u4e00\u4e2a\u5b57\u7b26\u7684 Huffman \u7f16\u7801\uff0c\u6211\u7528\u76f8\u540c\u7684\u989c\u8272\u5c06\u4ed6\u4eec\u5bf9\u5e94\u8d77\u6765\u4e86\uff0c\u6700\u540e\u7684 7 \u4f4d\u662f\u8865\u4f4d\u7684\u3002</p> <p></p> <p>\u6700\u7ec8\uff0c<code>server</code> \u5934\u90e8\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u5bf9\u5e94\u7684\u9759\u6001\u5934\u90e8\u683c\u5f0f\u5982\u4e0b\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/#_3","title":"\u52a8\u6001\u8868\u7f16\u7801","text":"<p>\u9759\u6001\u8868\u53ea\u5305\u542b\u4e86 61 \u79cd\u9ad8\u9891\u51fa\u73b0\u5728\u5934\u90e8\u7684\u5b57\u7b26\u4e32\uff0c\u4e0d\u5728\u9759\u6001\u8868\u8303\u56f4\u5185\u7684\u5934\u90e8\u5b57\u7b26\u4e32\u5c31\u8981\u81ea\u884c\u6784\u5efa\u52a8\u6001\u8868\uff0c\u5b83\u7684 Index \u4ece <code>62</code> \u8d77\u6b65\uff0c\u4f1a\u5728\u7f16\u7801\u89e3\u7801\u7684\u65f6\u5019\u968f\u65f6\u66f4\u65b0\u3002</p> <p>\u6bd4\u5982\uff0c\u7b2c\u4e00\u6b21\u53d1\u9001\u65f6\u5934\u90e8\u4e2d\u7684\u300c<code>User-Agent</code> \u300d\u5b57\u6bb5\u6570\u636e\u6709\u4e0a\u767e\u4e2a\u5b57\u8282\uff0c\u7ecf\u8fc7 Huffman \u7f16\u7801\u53d1\u9001\u51fa\u53bb\u540e\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53cc\u65b9\u90fd\u4f1a\u66f4\u65b0\u81ea\u5df1\u7684\u52a8\u6001\u8868\uff0c\u6dfb\u52a0\u4e00\u4e2a\u65b0\u7684 Index \u53f7 62\u3002\u90a3\u4e48\u5728\u4e0b\u4e00\u6b21\u53d1\u9001\u7684\u65f6\u5019\uff0c\u5c31\u4e0d\u7528\u91cd\u590d\u53d1\u8fd9\u4e2a\u5b57\u6bb5\u7684\u6570\u636e\u4e86\uff0c\u53ea\u7528\u53d1 1 \u4e2a\u5b57\u8282\u7684 Index \u53f7\u5c31\u597d\u4e86\uff0c\u56e0\u4e3a\u53cc\u65b9\u90fd\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u52a8\u6001\u8868\u83b7\u53d6\u5230\u5b57\u6bb5\u7684\u6570\u636e\u3002</p> <p>\u6240\u4ee5\uff0c\u4f7f\u5f97\u52a8\u6001\u8868\u751f\u6548\u6709\u4e00\u4e2a\u524d\u63d0\uff1a\u5fc5\u987b\u540c\u4e00\u4e2a\u8fde\u63a5\u4e0a\uff0c\u91cd\u590d\u4f20\u8f93\u5b8c\u5168\u76f8\u540c\u7684 HTTP \u5934\u90e8\u3002\u5982\u679c\u6d88\u606f\u5b57\u6bb5\u5728 1 \u4e2a\u8fde\u63a5\u4e0a\u53ea\u53d1\u9001\u4e86 1 \u6b21\uff0c\u6216\u8005\u91cd\u590d\u4f20\u8f93\u65f6\uff0c\u5b57\u6bb5\u603b\u662f\u7565\u6709\u53d8\u5316\uff0c\u52a8\u6001\u8868\u5c31\u65e0\u6cd5\u88ab\u5145\u5206\u5229\u7528\u4e86\u3002</p> <p>\u56e0\u6b64\uff0c\u968f\u7740\u5728\u540c\u4e00 HTTP/2 \u8fde\u63a5\u4e0a\u53d1\u9001\u7684\u62a5\u6587\u8d8a\u6765\u8d8a\u591a\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53cc\u65b9\u7684\u300c\u5b57\u5178\u300d\u79ef\u7d2f\u7684\u8d8a\u6765\u8d8a\u591a\uff0c\u7406\u8bba\u4e0a\u6700\u7ec8\u6bcf\u4e2a\u5934\u90e8\u5b57\u6bb5\u90fd\u4f1a\u53d8\u6210 1 \u4e2a\u5b57\u8282\u7684 Index\uff0c\u8fd9\u6837\u4fbf\u907f\u514d\u4e86\u5927\u91cf\u7684\u5197\u4f59\u6570\u636e\u7684\u4f20\u8f93\uff0c\u5927\u5927\u8282\u7ea6\u4e86\u5e26\u5bbd\u3002</p> <p>\u7406\u60f3\u5f88\u7f8e\u597d\uff0c\u73b0\u5b9e\u5f88\u9aa8\u611f\u3002\u52a8\u6001\u8868\u8d8a\u5927\uff0c\u5360\u7528\u7684\u5185\u5b58\u4e5f\u5c31\u8d8a\u5927\uff0c\u5982\u679c\u5360\u7528\u4e86\u592a\u591a\u5185\u5b58\uff0c\u662f\u4f1a\u5f71\u54cd\u670d\u52a1\u5668\u6027\u80fd\u7684\uff0c\u56e0\u6b64 Web \u670d\u52a1\u5668\u90fd\u4f1a\u63d0\u4f9b\u7c7b\u4f3c <code>http2_max_requests</code> \u7684\u914d\u7f6e\uff0c\u7528\u4e8e\u9650\u5236\u4e00\u4e2a\u8fde\u63a5\u4e0a\u80fd\u591f\u4f20\u8f93\u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u907f\u514d\u52a8\u6001\u8868\u65e0\u9650\u589e\u5927\uff0c\u8bf7\u6c42\u6570\u91cf\u5230\u8fbe\u4e0a\u9650\u540e\uff0c\u5c31\u4f1a\u5173\u95ed HTTP/2 \u8fde\u63a5\u6765\u91ca\u653e\u5185\u5b58\u3002</p> <p>\u7efc\u4e0a\uff0cHTTP/2 \u5934\u90e8\u7684\u7f16\u7801\u901a\u8fc7\u300c\u9759\u6001\u8868\u3001\u52a8\u6001\u8868\u3001Huffman \u7f16\u7801\u300d\u5171\u540c\u5b8c\u6210\u7684\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/#_4","title":"\u4e8c\u8fdb\u5236\u5e27","text":"<p>HTTP/2 \u5389\u5bb3\u7684\u5730\u65b9\u5728\u4e8e\u5c06 HTTP/1 \u7684\u6587\u672c\u683c\u5f0f\u6539\u6210\u4e8c\u8fdb\u5236\u683c\u5f0f\u4f20\u8f93\u6570\u636e\uff0c\u6781\u5927\u63d0\u9ad8\u4e86 HTTP \u4f20\u8f93\u6548\u7387\uff0c\u800c\u4e14\u4e8c\u8fdb\u5236\u6570\u636e\u4f7f\u7528\u4f4d\u8fd0\u7b97\u80fd\u9ad8\u6548\u89e3\u6790\u3002</p> <p>\u4f60\u53ef\u4ee5\u4ece\u4e0b\u56fe\u770b\u5230\uff0cHTTP/1.1 \u7684\u54cd\u5e94\u548c HTTP/2 \u7684\u533a\u522b\uff1a</p> <p></p> <p>HTTP/2 \u628a\u54cd\u5e94\u62a5\u6587\u5212\u5206\u6210\u4e86\u4e24\u7c7b\u5e27\uff08Frame\uff09\uff0c\u56fe\u4e2d\u7684 HEADERS\uff08\u9996\u90e8\uff09\u548c DATA\uff08\u6d88\u606f\u8d1f\u8f7d\uff09\u662f\u5e27\u7684\u7c7b\u578b\uff0c\u4e5f\u5c31\u662f\u8bf4\u4e00\u6761 HTTP \u54cd\u5e94\uff0c\u5212\u5206\u6210\u4e86\u4e24\u7c7b\u5e27\u6765\u4f20\u8f93\uff0c\u5e76\u4e14\u91c7\u7528\u4e8c\u8fdb\u5236\u6765\u7f16\u7801\u3002</p> <p>\u6bd4\u5982\u72b6\u6001\u7801 200\uff0c\u5728 HTTP/1.1 \u662f\u7528 '2''0''0' \u4e09\u4e2a\u5b57\u7b26\u6765\u8868\u793a\uff08\u4e8c\u8fdb\u5236\uff1a00110010 00110000 00110000\uff09\uff0c\u5171\u7528\u4e86 3 \u4e2a\u5b57\u8282\uff0c\u5982\u4e0b\u56fe</p> <p></p> <p>\u5728 HTTP/2 \u5bf9\u4e8e\u72b6\u6001\u7801 200 \u7684\u4e8c\u8fdb\u5236\u7f16\u7801\u662f 10001000\uff0c\u53ea\u7528\u4e86 1 \u5b57\u8282\u5c31\u80fd\u8868\u793a\uff0c\u76f8\u6bd4\u4e8e HTTP/1.1 \u8282\u7701\u4e86 2 \u4e2a\u5b57\u8282\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>Header: :status: 200 OK \u7684\u7f16\u7801\u5185\u5bb9\u4e3a\uff1a1000 1000\uff0c\u90a3\u4e48\u8868\u8fbe\u7684\u542b\u4e49\u662f\u4ec0\u4e48\u5462\uff1f</p> <p></p> <ol> <li>\u6700\u524d\u9762\u7684 1 \u6807\u8bc6\u8be5 Header \u662f\u9759\u6001\u8868\u4e2d\u5df2\u7ecf\u5b58\u5728\u7684 KV\u3002</li> <li>\u6211\u4eec\u518d\u56de\u987e\u4e00\u4e0b\u4e4b\u524d\u7684\u9759\u6001\u8868\u5185\u5bb9\uff0c\u201c:status: 200 OK\u201d\u5176\u9759\u6001\u8868\u7f16\u7801\u662f 8\uff0c\u5373 1000\u3002</li> </ol> <p>\u56e0\u6b64\uff0c\u6574\u4f53\u52a0\u8d77\u6765\u5c31\u662f 1000 1000\u3002</p> <p>HTTP/2 \u4e8c\u8fdb\u5236\u5e27\u7684\u7ed3\u6784\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5e27\u5934\uff08Frame Header\uff09\u5f88\u5c0f\uff0c\u53ea\u6709 9 \u4e2a\u5b57\u8282\uff0c\u5e27\u5f00\u5934\u7684\u524d 3 \u4e2a\u5b57\u8282\u8868\u793a\u5e27\u6570\u636e\uff08Frame Playload\uff09\u7684\u957f\u5ea6\u3002</p> <p>\u5e27\u957f\u5ea6\u540e\u9762\u7684\u4e00\u4e2a\u5b57\u8282\u662f\u8868\u793a\u5e27\u7684\u7c7b\u578b\uff0cHTTP/2 \u603b\u5171\u5b9a\u4e49\u4e86 10 \u79cd\u7c7b\u578b\u7684\u5e27\uff0c\u4e00\u822c\u5206\u4e3a\u6570\u636e\u5e27\u548c\u63a7\u5236\u5e27\u4e24\u7c7b\uff0c\u5982\u4e0b\u8868\u683c\uff1a</p> <p></p> <p>\u5e27\u7c7b\u578b\u540e\u9762\u7684\u4e00\u4e2a\u5b57\u8282\u662f\u6807\u5fd7\u4f4d\uff0c\u53ef\u4ee5\u4fdd\u5b58 8 \u4e2a\u6807\u5fd7\u4f4d\uff0c\u7528\u4e8e\u643a\u5e26\u7b80\u5355\u7684\u63a7\u5236\u4fe1\u606f\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>END_HEADERS \u8868\u793a\u5934\u6570\u636e\u7ed3\u675f\u6807\u5fd7\uff0c\u76f8\u5f53\u4e8e HTTP/1 \u91cc\u5934\u540e\u7684\u7a7a\u884c\uff08\u201c\\r\\n\u201d\uff09\uff1b</li> <li>END_Stream \u8868\u793a\u5355\u65b9\u5411\u6570\u636e\u53d1\u9001\u7ed3\u675f\uff0c\u540e\u7eed\u4e0d\u4f1a\u518d\u6709\u6570\u636e\u5e27\u3002</li> <li>PRIORITY \u8868\u793a\u6d41\u7684\u4f18\u5148\u7ea7\uff1b</li> </ul> <p>\u5e27\u5934\u7684\u6700\u540e 4 \u4e2a\u5b57\u8282\u662f\u6d41\u6807\u8bc6\u7b26\uff08Stream ID\uff09\uff0c\u4f46\u6700\u9ad8\u4f4d\u88ab\u4fdd\u7559\u4e0d\u7528\uff0c\u53ea\u6709 31 \u4f4d\u53ef\u4ee5\u4f7f\u7528\uff0c\u56e0\u6b64\u6d41\u6807\u8bc6\u7b26\u7684\u6700\u5927\u503c\u662f 2^31\uff0c\u5927\u7ea6\u662f 21 \u4ebf\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u7528\u6765\u6807\u8bc6\u8be5 Frame \u5c5e\u4e8e\u54ea\u4e2a Stream\uff0c\u63a5\u6536\u65b9\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u4fe1\u606f\u4ece\u4e71\u5e8f\u7684\u5e27\u91cc\u627e\u5230\u76f8\u540c Stream ID \u7684\u5e27\uff0c\u4ece\u800c\u6709\u5e8f\u7ec4\u88c5\u4fe1\u606f\u3002</p> <p>\u6700\u540e\u9762\u5c31\u662f\u5e27\u6570\u636e\u4e86\uff0c\u5b83\u5b58\u653e\u7684\u662f\u901a\u8fc7 HPACK  \u7b97\u6cd5\u538b\u7f29\u8fc7\u7684 HTTP \u5934\u90e8\u548c\u5305\u4f53\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/#_5","title":"\u5e76\u53d1\u4f20\u8f93","text":"<p>\u77e5\u9053\u4e86 HTTP/2 \u7684\u5e27\u7ed3\u6784\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u5b83\u662f\u5982\u4f55\u5b9e\u73b0\u5e76\u53d1\u4f20\u8f93\u7684\u3002</p> <p>\u6211\u4eec\u90fd\u77e5\u9053 HTTP/1.1 \u7684\u5b9e\u73b0\u662f\u57fa\u4e8e\u8bf7\u6c42 - \u54cd\u5e94\u6a21\u578b\u7684\u3002\u540c\u4e00\u4e2a\u8fde\u63a5\u4e2d\uff0cHTTP \u5b8c\u6210\u4e00\u4e2a\u4e8b\u52a1\uff08\u8bf7\u6c42\u4e0e\u54cd\u5e94\uff09\uff0c\u624d\u80fd\u5904\u7406\u4e0b\u4e00\u4e2a\u4e8b\u52a1\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u53d1\u51fa\u8bf7\u6c42\u7b49\u5f85\u54cd\u5e94\u7684\u8fc7\u7a0b\u4e2d\uff0c\u662f\u6ca1\u529e\u6cd5\u505a\u5176\u4ed6\u4e8b\u60c5\u7684\uff0c\u5982\u679c\u54cd\u5e94\u8fdf\u8fdf\u4e0d\u6765\uff0c\u90a3\u4e48\u540e\u7eed\u7684\u8bf7\u6c42\u662f\u65e0\u6cd5\u53d1\u9001\u7684\uff0c\u4e5f\u9020\u6210\u4e86\u961f\u5934\u963b\u585e\u7684\u95ee\u9898\u3002</p> <p>\u800c HTTP/2 \u5c31\u5f88\u725b\u903c\u4e86\uff0c\u901a\u8fc7 Stream \u8fd9\u4e2a\u8bbe\u8ba1\uff0c\u591a\u4e2a Stream \u590d\u7528\u4e00\u6761 TCP \u8fde\u63a5\uff0c\u8fbe\u5230\u5e76\u53d1\u7684\u6548\u679c\uff0c\u89e3\u51b3\u4e86 HTTP/1.1 \u961f\u5934\u963b\u585e\u7684\u95ee\u9898\uff0c\u63d0\u9ad8\u4e86 HTTP \u4f20\u8f93\u7684\u541e\u5410\u91cf\u3002</p> <p>\u4e3a\u4e86\u7406\u89e3 HTTP/2 \u7684\u5e76\u53d1\u662f\u600e\u6837\u5b9e\u73b0\u7684\uff0c\u6211\u4eec\u5148\u6765\u7406\u89e3 HTTP/2 \u4e2d\u7684 Stream\u3001Message\u3001Frame \u8fd9 3 \u4e2a\u6982\u5ff5\u3002</p> <p></p> <p>\u4f60\u53ef\u4ee5\u4ece\u4e0a\u56fe\u4e2d\u770b\u5230\uff1a</p> <ul> <li>1 \u4e2a TCP \u8fde\u63a5\u5305\u542b\u4e00\u4e2a\u6216\u8005\u591a\u4e2a Stream\uff0cStream \u662f HTTP/2 \u5e76\u53d1\u7684\u5173\u952e\u6280\u672f\uff1b</li> <li>1 \u4e2a Stream \u91cc\u5305\u542b 2\u4e2a Message\uff0cMessage \u5bf9\u5e94 HTTP/1 \u4e2d\u7684\u8bf7\u6c42\u6216\u54cd\u5e94\uff0c\u7531 HTTP \u5934\u90e8\u548c\u5305\u4f53\u6784\u6210\uff1b</li> <li>Message \u91cc\u5305\u542b\u4e00\u6761\u6216\u8005\u591a\u4e2a Frame\uff0cFrame \u662f HTTP/2 \u6700\u5c0f\u5355\u4f4d\uff0c\u4ee5\u4e8c\u8fdb\u5236\u538b\u7f29\u683c\u5f0f\u5b58\u653e HTTP/1 \u4e2d\u7684\u5185\u5bb9\uff08\u5934\u90e8\u548c\u5305\u4f53\uff09\uff1b</li> </ul> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u51fa\u4e2a\u7ed3\u8bba\uff1a\u591a\u4e2a Stream \u8dd1\u5728\u4e00\u6761 TCP \u8fde\u63a5\uff0c\u540c\u4e00\u4e2a HTTP \u8bf7\u6c42\u4e0e\u54cd\u5e94\u662f\u8dd1\u5728\u540c\u4e00\u4e2a Stream \u4e2d\uff0cHTTP \u6d88\u606f\u53ef\u4ee5\u7531\u591a\u4e2a Frame \u6784\u6210\uff0c\u4e00\u4e2a Frame \u53ef\u4ee5\u7531\u591a\u4e2a TCP \u62a5\u6587\u6784\u6210\u3002</p> <p></p> <p>\u5728 HTTP/2 \u8fde\u63a5\u4e0a\uff0c\u4e0d\u540c Stream \u7684\u5e27\u662f\u53ef\u4ee5\u4e71\u5e8f\u53d1\u9001\u7684\uff08\u56e0\u6b64\u53ef\u4ee5\u5e76\u53d1\u4e0d\u540c\u7684 Stream\uff09\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5e27\u7684\u5934\u90e8\u4f1a\u643a\u5e26 Stream ID \u4fe1\u606f\uff0c\u6240\u4ee5\u63a5\u6536\u7aef\u53ef\u4ee5\u901a\u8fc7 Stream ID \u6709\u5e8f\u7ec4\u88c5\u6210 HTTP \u6d88\u606f\uff0c\u800c\u540c\u4e00 Stream \u5185\u90e8\u7684\u5e27\u5fc5\u987b\u662f\u4e25\u683c\u6709\u5e8f\u7684\u3002</p> <p>\u6bd4\u5982\u4e0b\u56fe\uff0c\u670d\u52a1\u7aef\u5e76\u884c\u4ea4\u9519\u5730\u53d1\u9001\u4e86\u4e24\u4e2a\u54cd\u5e94\uff1aStream 1 \u548c Stream 3\uff0c\u8fd9\u4e24\u4e2a Stream \u90fd\u662f\u8dd1\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e0a\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\uff0c\u4f1a\u6839\u636e\u76f8\u540c\u7684 Stream ID \u6709\u5e8f\u7ec4\u88c5\u6210 HTTP \u6d88\u606f\u3002</p> <p></p> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53cc\u65b9\u90fd\u53ef\u4ee5\u5efa\u7acb Stream\uff0c\u56e0\u4e3a\u670d\u52a1\u7aef\u53ef\u4ee5\u4e3b\u52a8\u63a8\u9001\u8d44\u6e90\u7ed9\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u5efa\u7acb\u7684 Stream \u5fc5\u987b\u662f\u5947\u6570\u53f7\uff0c\u800c\u670d\u52a1\u5668\u5efa\u7acb\u7684 Stream \u5fc5\u987b\u662f\u5076\u6570\u53f7\u3002</p> <p>\u6bd4\u5982\u4e0b\u56fe\uff0cStream 1 \u662f\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u8bf7\u6c42\u7684\u8d44\u6e90\uff0c\u5c5e\u4e8e\u5ba2\u6237\u7aef\u5efa\u7acb\u7684 Stream\uff0c\u6240\u4ee5\u8be5 Stream \u7684 ID \u662f\u5947\u6570\uff08\u6570\u5b57 1\uff09\uff1bStream 2 \u548c 4 \u90fd\u662f\u670d\u52a1\u7aef\u4e3b\u52a8\u5411\u5ba2\u6237\u7aef\u63a8\u9001\u7684\u8d44\u6e90\uff0c\u5c5e\u4e8e\u670d\u52a1\u7aef\u5efa\u7acb\u7684 Stream\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a Stream \u7684 ID \u662f\u5076\u6570\uff08\u6570\u5b57 2 \u548c 4\uff09\u3002</p> <p></p> <p>\u540c\u4e00\u4e2a\u8fde\u63a5\u4e2d\u7684 Stream ID \u662f\u4e0d\u80fd\u590d\u7528\u7684\uff0c\u53ea\u80fd\u987a\u5e8f\u9012\u589e\uff0c\u6240\u4ee5\u5f53 Stream ID \u8017\u5c3d\u65f6\uff0c\u9700\u8981\u53d1\u4e00\u4e2a\u63a7\u5236\u5e27 <code>GOAWAY</code>\uff0c\u7528\u6765\u5173\u95ed TCP \u8fde\u63a5\u3002 </p> <p>\u5728 Nginx \u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>http2_max_concurrent_Streams</code> \u914d\u7f6e\u6765\u8bbe\u7f6e Stream \u7684\u4e0a\u9650\uff0c\u9ed8\u8ba4\u662f 128 \u4e2a\u3002</p> <p>HTTP/2 \u901a\u8fc7 Stream \u5b9e\u73b0\u7684\u5e76\u53d1\uff0c\u6bd4 HTTP/1.1 \u901a\u8fc7 TCP \u8fde\u63a5\u5b9e\u73b0\u5e76\u53d1\u8981\u725b\u903c\u7684\u591a\uff0c\u56e0\u4e3a\u5f53 HTTP/2 \u5b9e\u73b0 100 \u4e2a\u5e76\u53d1 Stream \u65f6\uff0c\u53ea\u9700\u8981\u5efa\u7acb\u4e00\u6b21 TCP \u8fde\u63a5\uff0c\u800c HTTP/1.1 \u9700\u8981\u5efa\u7acb 100 \u4e2a TCP \u8fde\u63a5\uff0c\u6bcf\u4e2a TCP \u8fde\u63a5\u90fd\u8981\u7ecf\u8fc7 TCP \u63e1\u624b\u3001\u6162\u542f\u52a8\u4ee5\u53ca TLS \u63e1\u624b\u8fc7\u7a0b\uff0c\u8fd9\u4e9b\u90fd\u662f\u5f88\u8017\u65f6\u7684\u3002</p> <p>HTTP/2 \u8fd8\u53ef\u4ee5\u5bf9\u6bcf\u4e2a Stream \u8bbe\u7f6e\u4e0d\u540c\u4f18\u5148\u7ea7\uff0c\u5e27\u5934\u4e2d\u7684\u300c\u6807\u5fd7\u4f4d\u300d\u53ef\u4ee5\u8bbe\u7f6e\u4f18\u5148\u7ea7\uff0c\u6bd4\u5982\u5ba2\u6237\u7aef\u8bbf\u95ee HTML/CSS \u548c\u56fe\u7247\u8d44\u6e90\u65f6\uff0c\u5e0c\u671b\u670d\u52a1\u5668\u5148\u4f20\u9012 HTML/CSS\uff0c\u518d\u4f20\u56fe\u7247\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e Stream \u7684\u4f18\u5148\u7ea7\u6765\u5b9e\u73b0\uff0c\u4ee5\u6b64\u63d0\u9ad8\u7528\u6237\u4f53\u9a8c\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/#_6","title":"\u670d\u52a1\u5668\u4e3b\u52a8\u63a8\u9001\u8d44\u6e90","text":"<p>HTTP/1.1 \u4e0d\u652f\u6301\u670d\u52a1\u5668\u4e3b\u52a8\u63a8\u9001\u8d44\u6e90\u7ed9\u5ba2\u6237\u7aef\uff0c\u90fd\u662f\u7531\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u8d77\u8bf7\u6c42\u540e\uff0c\u624d\u80fd\u83b7\u53d6\u5230\u670d\u52a1\u5668\u54cd\u5e94\u7684\u8d44\u6e90\u3002</p> <p>\u6bd4\u5982\uff0c\u5ba2\u6237\u7aef\u901a\u8fc7 HTTP/1.1 \u8bf7\u6c42\u4ece\u670d\u52a1\u5668\u90a3\u83b7\u53d6\u5230\u4e86 HTML \u6587\u4ef6\uff0c\u800c HTML \u53ef\u80fd\u8fd8\u9700\u8981\u4f9d\u8d56 CSS \u6765\u6e32\u67d3\u9875\u9762\uff0c\u8fd9\u65f6\u5ba2\u6237\u7aef\u8fd8\u8981\u518d\u53d1\u8d77\u83b7\u53d6 CSS \u6587\u4ef6\u7684\u8bf7\u6c42\uff0c\u9700\u8981\u4e24\u6b21\u6d88\u606f\u5f80\u8fd4\uff0c\u5982\u4e0b\u56fe\u5de6\u8fb9\u90e8\u5206\uff1a</p> <p></p> <p>\u5982\u4e0a\u56fe\u53f3\u8fb9\u90e8\u5206\uff0c\u5728 HTTP/2 \u4e2d\uff0c\u5ba2\u6237\u7aef\u5728\u8bbf\u95ee HTML \u65f6\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u76f4\u63a5\u4e3b\u52a8\u63a8\u9001 CSS \u6587\u4ef6\uff0c\u51cf\u5c11\u4e86\u6d88\u606f\u4f20\u9012\u7684\u6b21\u6570\u3002</p> <p>\u5728 Nginx \u4e2d\uff0c\u5982\u679c\u4f60\u5e0c\u671b\u5ba2\u6237\u7aef\u8bbf\u95ee /test.html \u65f6\uff0c\u670d\u52a1\u5668\u76f4\u63a5\u63a8\u9001 /test.css\uff0c\u90a3\u4e48\u53ef\u4ee5\u8fd9\u4e48\u914d\u7f6e\uff1a</p> Nginx Configuration File<pre><code>location /test.html { \n  http2_push /test.css; \n}\n</code></pre> <p>\u90a3 HTTP/2 \u7684\u63a8\u9001\u662f\u600e\u4e48\u5b9e\u73b0\u7684\uff1f</p> <p>\u5ba2\u6237\u7aef\u53d1\u8d77\u7684\u8bf7\u6c42\uff0c\u5fc5\u987b\u4f7f\u7528\u7684\u662f\u5947\u6570\u53f7 Stream\uff0c\u670d\u52a1\u5668\u4e3b\u52a8\u7684\u63a8\u9001\uff0c\u4f7f\u7528\u7684\u662f\u5076\u6570\u53f7 Stream\u3002\u670d\u52a1\u5668\u5728\u63a8\u9001\u8d44\u6e90\u65f6\uff0c\u4f1a\u901a\u8fc7 <code>PUSH_PROMISE</code> \u5e27\u4f20\u8f93 HTTP \u5934\u90e8\uff0c\u5e76\u901a\u8fc7\u5e27\u4e2d\u7684 <code>Promised Stream ID</code> \u5b57\u6bb5\u544a\u77e5\u5ba2\u6237\u7aef\uff0c\u63a5\u4e0b\u6765\u4f1a\u5728\u54ea\u4e2a\u5076\u6570\u53f7 Stream \u4e2d\u53d1\u9001\u5305\u4f53\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\uff0c\u5728 Stream 1 \u4e2d\u901a\u77e5\u5ba2\u6237\u7aef CSS \u8d44\u6e90\u5373\u5c06\u5230\u6765\uff0c\u7136\u540e\u5728 Stream 2 \u4e2d\u53d1\u9001 CSS \u8d44\u6e90\uff0c\u6ce8\u610f Stream 1 \u548c 2 \u662f\u53ef\u4ee5\u5e76\u53d1\u7684\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http2/#_7","title":"\u603b\u7ed3","text":"<p>HTTP/2 \u534f\u8bae\u5176\u5b9e\u8fd8\u6709\u5f88\u591a\u5185\u5bb9\uff0c\u6bd4\u5982\u6d41\u63a7\u5236\u3001\u6d41\u72b6\u6001\u3001\u4f9d\u8d56\u5173\u7cfb\u7b49\u7b49\u3002</p> <p>\u8fd9\u6b21\u4e3b\u8981\u4ecb\u7ecd\u4e86\u5173\u4e8e HTTP/2 \u662f\u5982\u4f55\u63d0\u5347\u6027\u80fd\u7684\u51e0\u4e2a\u65b9\u5411\uff0c\u5b83\u76f8\u6bd4 HTTP/1 \u5927\u5927\u63d0\u9ad8\u4e86\u4f20\u8f93\u6548\u7387\u3001\u541e\u5410\u80fd\u529b\u3002</p> <p>\u7b2c\u4e00\u70b9\uff0c\u5bf9\u4e8e\u5e38\u89c1\u7684 HTTP \u5934\u90e8\u901a\u8fc7\u9759\u6001\u8868\u548c Huffman \u7f16\u7801\u7684\u65b9\u5f0f\uff0c\u5c06\u4f53\u79ef\u538b\u7f29\u4e86\u8fd1\u4e00\u534a\uff0c\u800c\u4e14\u9488\u5bf9\u540e\u7eed\u7684\u8bf7\u6c42\u5934\u90e8\uff0c\u8fd8\u53ef\u4ee5\u5efa\u7acb\u52a8\u6001\u8868\uff0c\u5c06\u4f53\u79ef\u538b\u7f29\u8fd1 90%\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u7f16\u7801\u6548\u7387\uff0c\u540c\u65f6\u8282\u7ea6\u4e86\u5e26\u5bbd\u8d44\u6e90\u3002</p> <p>\u4e0d\u8fc7\uff0c\u52a8\u6001\u8868\u5e76\u975e\u53ef\u4ee5\u65e0\u9650\u589e\u5927\uff0c\u56e0\u4e3a\u52a8\u6001\u8868\u662f\u4f1a\u5360\u7528\u5185\u5b58\u7684\uff0c\u52a8\u6001\u8868\u8d8a\u5927\uff0c\u5185\u5b58\u4e5f\u8d8a\u5927\uff0c\u5bb9\u6613\u5f71\u54cd\u670d\u52a1\u5668\u603b\u4f53\u7684\u5e76\u53d1\u80fd\u529b\uff0c\u56e0\u6b64\u670d\u52a1\u5668\u9700\u8981\u9650\u5236 HTTP/2 \u8fde\u63a5\u65f6\u957f\u6216\u8005\u8bf7\u6c42\u6b21\u6570\u3002</p> <p>\u7b2c\u4e8c\u70b9\uff0cHTTP/2 \u5b9e\u73b0\u4e86 Stream \u5e76\u53d1\uff0c\u591a\u4e2a Stream \u53ea\u9700\u590d\u7528 1 \u4e2a TCP \u8fde\u63a5\uff0c\u8282\u7ea6\u4e86 TCP \u548c TLS \u63e1\u624b\u65f6\u95f4\uff0c\u4ee5\u53ca\u51cf\u5c11\u4e86 TCP \u6162\u542f\u52a8\u9636\u6bb5\u5bf9\u6d41\u91cf\u7684\u5f71\u54cd\u3002\u4e0d\u540c\u7684 Stream ID \u53ef\u4ee5\u5e76\u53d1\uff0c\u5373\u4f7f\u4e71\u5e8f\u53d1\u9001\u5e27\u4e5f\u6ca1\u95ee\u9898\uff0c\u6bd4\u5982\u53d1\u9001 A \u8bf7\u6c42\u5e27 1 -&gt; B \u8bf7\u6c42\u5e27 1 -&gt; A \u8bf7\u6c42\u5e27 2 -&gt; B \u8bf7\u6c42\u5e27 2\uff0c\u4f46\u662f\u540c\u4e00\u4e2a Stream \u91cc\u7684\u5e27\u5fc5\u987b\u4e25\u683c\u6709\u5e8f\u3002</p> <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u6839\u636e\u8d44\u6e90\u7684\u6e32\u67d3\u987a\u5e8f\u6765\u8bbe\u7f6e Stream \u7684\u4f18\u5148\u7ea7\uff0c\u4ece\u800c\u63d0\u9ad8\u7528\u6237\u4f53\u9a8c\u3002</p> <p>\u7b2c\u4e09\u70b9\uff0c\u670d\u52a1\u5668\u652f\u6301\u4e3b\u52a8\u63a8\u9001\u8d44\u6e90\uff0c\u5927\u5927\u63d0\u5347\u4e86\u6d88\u606f\u7684\u4f20\u8f93\u6027\u80fd\uff0c\u670d\u52a1\u5668\u63a8\u9001\u8d44\u6e90\u65f6\uff0c\u4f1a\u5148\u53d1\u9001 PUSH_PROMISE \u5e27\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u63a5\u4e0b\u6765\u5728\u54ea\u4e2a Stream \u53d1\u9001\u8d44\u6e90\uff0c\u7136\u540e\u7528\u5076\u6570\u53f7 Stream \u53d1\u9001\u8d44\u6e90\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p>HTTP/2 \u901a\u8fc7 Stream \u7684\u5e76\u53d1\u80fd\u529b\uff0c\u89e3\u51b3\u4e86 HTTP/1 \u961f\u5934\u963b\u585e\u7684\u95ee\u9898\uff0c\u770b\u4f3c\u5f88\u5b8c\u7f8e\u4e86\uff0c\u4f46\u662f HTTP/2 \u8fd8\u662f\u5b58\u5728\u201c\u961f\u5934\u963b\u585e\u201d\u7684\u95ee\u9898\uff0c\u53ea\u4e0d\u8fc7\u95ee\u9898\u4e0d\u662f\u5728 HTTP \u8fd9\u4e00\u5c42\u9762\uff0c\u800c\u662f\u5728 TCP \u8fd9\u4e00\u5c42\u3002</p> <p>HTTP/2 \u662f\u57fa\u4e8e TCP \u534f\u8bae\u6765\u4f20\u8f93\u6570\u636e\u7684\uff0cTCP \u662f\u5b57\u8282\u6d41\u534f\u8bae\uff0cTCP \u5c42\u5fc5\u987b\u4fdd\u8bc1\u6536\u5230\u7684\u5b57\u8282\u6570\u636e\u662f\u5b8c\u6574\u4e14\u8fde\u7eed\u7684\uff0c\u8fd9\u6837\u5185\u6838\u624d\u4f1a\u5c06\u7f13\u51b2\u533a\u91cc\u7684\u6570\u636e\u8fd4\u56de\u7ed9 HTTP \u5e94\u7528\uff0c\u90a3\u4e48\u5f53\u300c\u524d 1 \u4e2a\u5b57\u8282\u6570\u636e\u300d\u6ca1\u6709\u5230\u8fbe\u65f6\uff0c\u540e\u6536\u5230\u7684\u5b57\u8282\u6570\u636e\u53ea\u80fd\u5b58\u653e\u5728\u5185\u6838\u7f13\u51b2\u533a\u91cc\uff0c\u53ea\u6709\u7b49\u5230\u8fd9 1 \u4e2a\u5b57\u8282\u6570\u636e\u5230\u8fbe\u65f6\uff0cHTTP/2 \u5e94\u7528\u5c42\u624d\u80fd\u4ece\u5185\u6838\u4e2d\u62ff\u5230\u6570\u636e\uff0c\u8fd9\u5c31\u662f HTTP/2 \u961f\u5934\u963b\u585e\u95ee\u9898\u3002</p> <p>\u6709\u6ca1\u6709\u4ec0\u4e48\u89e3\u51b3\u65b9\u6848\u5462\uff1f\u65e2\u7136\u662f TCP \u534f\u8bae\u81ea\u8eab\u7684\u95ee\u9898\uff0c\u90a3\u5e72\u8106\u653e\u5f03 TCP \u534f\u8bae\uff0c\u8f6c\u800c\u4f7f\u7528 UDP \u534f\u8bae\u4f5c\u4e3a\u4f20\u8f93\u5c42\u534f\u8bae\uff0c\u8fd9\u4e2a\u5927\u80c6\u7684\u51b3\u5b9a\uff0cHTTP/3 \u534f\u8bae\u505a\u4e86\uff01</p> <p></p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ol> <li>https://developers.google.com/web/fundamentals/performance/http2</li> <li>https://http2.akamai.com/demo</li> <li>https://tools.ietf.org/html/rfc7541</li> </ol> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/","title":"3.7 HTTP/3 \u5f3a\u52bf\u6765\u88ad","text":"<p>HTTP/3 \u73b0\u5728\uff082022 \u5e74 5 \u6708\uff09\u8fd8\u6ca1\u6b63\u5f0f\u63a8\u51fa\uff0c\u4e0d\u8fc7\u81ea 2017 \u5e74\u8d77\uff0cHTTP/3 \u5df2\u7ecf\u66f4\u65b0\u5230 34 \u4e2a\u8349\u6848\u4e86\uff0c\u57fa\u672c\u7684\u7279\u6027\u5df2\u7ecf\u786e\u5b9a\u4e0b\u6765\u4e86\uff0c\u5bf9\u4e8e\u5305\u683c\u5f0f\u53ef\u80fd\u540e\u7eed\u4f1a\u6709\u53d8\u5316\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u6b21 HTTP/3 \u4ecb\u7ecd\u4e0d\u4f1a\u6d89\u53ca\u5230\u5305\u683c\u5f0f\uff0c\u53ea\u8bf4\u5b83\u7684\u7279\u6027\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#http2","title":"\u7f8e\u4e2d\u4e0d\u8db3\u7684 HTTP/2","text":"<p>HTTP/2 \u901a\u8fc7\u5934\u90e8\u538b\u7f29\u3001\u4e8c\u8fdb\u5236\u7f16\u7801\u3001\u591a\u8def\u590d\u7528\u3001\u670d\u52a1\u5668\u63a8\u9001\u7b49\u65b0\u7279\u6027\u5927\u5e45\u5ea6\u63d0\u5347\u4e86 HTTP/1.1 \u7684\u6027\u80fd\uff0c\u800c\u7f8e\u4e2d\u4e0d\u8db3\u7684\u662f HTTP/2 \u534f\u8bae\u662f\u57fa\u4e8e TCP \u5b9e\u73b0\u7684\uff0c\u4e8e\u662f\u5b58\u5728\u7684\u7f3a\u9677\u6709\u4e09\u4e2a\u3002</p> <ul> <li>\u961f\u5934\u963b\u585e\uff1b</li> <li>TCP \u4e0e TLS \u7684\u63e1\u624b\u65f6\u5ef6\u8fdf\uff1b</li> <li>\u7f51\u7edc\u8fc1\u79fb\u9700\u8981\u91cd\u65b0\u8fde\u63a5\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#_1","title":"\u961f\u5934\u963b\u585e","text":"<p>HTTP/2 \u591a\u4e2a\u8bf7\u6c42\u662f\u8dd1\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\u7684\uff0c\u90a3\u4e48\u5f53 TCP \u4e22\u5305\u65f6\uff0c\u6574\u4e2a TCP \u90fd\u8981\u7b49\u5f85\u91cd\u4f20\uff0c\u90a3\u4e48\u5c31\u4f1a\u963b\u585e\u8be5 TCP \u8fde\u63a5\u4e2d\u7684\u6240\u6709\u8bf7\u6c42\u3002</p> <p>\u6bd4\u5982\u4e0b\u56fe\u4e2d\uff0cStream 2 \u6709\u4e00\u4e2a TCP \u62a5\u6587\u4e22\u5931\u4e86\uff0c\u90a3\u4e48\u5373\u4f7f\u6536\u5230\u4e86 Stream 3 \u548c Stream 4 \u7684 TCP \u62a5\u6587\uff0c\u5e94\u7528\u5c42\u4e5f\u662f\u65e0\u6cd5\u8bfb\u53d6\u7684\uff0c\u76f8\u5f53\u4e8e\u963b\u585e\u4e86 Stream 3 \u548c Stream 4 \u8bf7\u6c42\u3002</p> <p></p> <p>\u56e0\u4e3a TCP \u662f\u5b57\u8282\u6d41\u534f\u8bae\uff0cTCP \u5c42\u5fc5\u987b\u4fdd\u8bc1\u6536\u5230\u7684\u5b57\u8282\u6570\u636e\u662f\u5b8c\u6574\u4e14\u6709\u5e8f\u7684\uff0c\u5982\u679c\u5e8f\u5217\u53f7\u8f83\u4f4e\u7684 TCP \u6bb5\u5728\u7f51\u7edc\u4f20\u8f93\u4e2d\u4e22\u5931\u4e86\uff0c\u5373\u4f7f\u5e8f\u5217\u53f7\u8f83\u9ad8\u7684 TCP \u6bb5\u5df2\u7ecf\u88ab\u63a5\u6536\u4e86\uff0c\u5e94\u7528\u5c42\u4e5f\u65e0\u6cd5\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u5230\u8fd9\u90e8\u5206\u6570\u636e\uff0c\u4ece HTTP \u89c6\u89d2\u770b\uff0c\u5c31\u662f\u8bf7\u6c42\u88ab\u963b\u585e\u4e86\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u56fe\u4e2d\u53d1\u9001\u65b9\u53d1\u9001\u4e86\u5f88\u591a\u4e2a Packet\uff0c\u6bcf\u4e2a Packet \u90fd\u6709\u81ea\u5df1\u7684\u5e8f\u53f7\uff0c\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u662f TCP \u7684\u5e8f\u5217\u53f7\uff0c\u5176\u4e2d Packet 3 \u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u4e86\uff0c\u5373\u4f7f Packet 4-6 \u88ab\u63a5\u6536\u65b9\u6536\u5230\u540e\uff0c\u7531\u4e8e\u5185\u6838\u4e2d\u7684 TCP \u6570\u636e\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u4e8e\u662f\u63a5\u6536\u65b9\u7684\u5e94\u7528\u5c42\u5c31\u65e0\u6cd5\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u5230\uff0c\u53ea\u6709\u7b49\u5230 Packet 3 \u91cd\u4f20\u540e\uff0c\u63a5\u6536\u65b9\u7684\u5e94\u7528\u5c42\u624d\u53ef\u4ee5\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u8fd9\u5c31\u662f HTTP/2 \u7684\u961f\u5934\u963b\u585e\u95ee\u9898\uff0c\u662f\u5728 TCP \u5c42\u9762\u53d1\u751f\u7684\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#tcp-tls","title":"TCP \u4e0e TLS \u7684\u63e1\u624b\u65f6\u5ef6\u8fdf","text":"<p>\u53d1\u8d77 HTTP \u8bf7\u6c42\u65f6\uff0c\u9700\u8981\u7ecf\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\u548c TLS \u56db\u6b21\u63e1\u624b\uff08TLS 1.2\uff09\u7684\u8fc7\u7a0b\uff0c\u56e0\u6b64\u5171\u9700\u8981 3 \u4e2a RTT \u7684\u65f6\u5ef6\u624d\u80fd\u53d1\u51fa\u8bf7\u6c42\u6570\u636e\u3002</p> <p></p> <p>\u53e6\u5916\uff0cTCP \u7531\u4e8e\u5177\u6709\u300c\u62e5\u585e\u63a7\u5236\u300d\u7684\u7279\u6027\uff0c\u6240\u4ee5\u521a\u5efa\u7acb\u8fde\u63a5\u7684 TCP \u4f1a\u6709\u4e2a\u300c\u6162\u542f\u52a8\u300d\u7684\u8fc7\u7a0b\uff0c\u5b83\u4f1a\u5bf9 TCP \u8fde\u63a5\u4ea7\u751f\u201c\u51cf\u901f\u201d\u6548\u679c\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#_2","title":"\u7f51\u7edc\u8fc1\u79fb\u9700\u8981\u91cd\u65b0\u8fde\u63a5","text":"<p>\u4e00\u4e2a TCP \u8fde\u63a5\u662f\u7531\u56db\u5143\u7ec4\uff08\u6e90 IP \u5730\u5740\uff0c\u6e90\u7aef\u53e3\uff0c\u76ee\u6807 IP \u5730\u5740\uff0c\u76ee\u6807\u7aef\u53e3\uff09\u786e\u5b9a\u7684\uff0c\u8fd9\u610f\u5473\u7740\u5982\u679c IP \u5730\u5740\u6216\u8005\u7aef\u53e3\u53d8\u52a8\u4e86\uff0c\u5c31\u4f1a\u5bfc\u81f4\u9700\u8981 TCP \u4e0e TLS \u91cd\u65b0\u63e1\u624b\uff0c\u8fd9\u4e0d\u5229\u4e8e\u79fb\u52a8\u8bbe\u5907\u5207\u6362\u7f51\u7edc\u7684\u573a\u666f\uff0c\u6bd4\u5982 4G \u7f51\u7edc\u73af\u5883\u5207\u6362\u6210 WiFi\u3002</p> <p>\u8fd9\u4e9b\u95ee\u9898\u90fd\u662f TCP \u534f\u8bae\u56fa\u6709\u7684\u95ee\u9898\uff0c\u65e0\u8bba\u5e94\u7528\u5c42\u7684 HTTP/2 \u5728\u600e\u4e48\u8bbe\u8ba1\u90fd\u65e0\u6cd5\u9003\u8131\u3002\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u5fc5\u987b\u628a\u4f20\u8f93\u5c42\u534f\u8bae\u66ff\u6362\u6210 UDP\uff0c\u8fd9\u4e2a\u5927\u80c6\u7684\u51b3\u5b9a\uff0cHTTP/3 \u505a\u4e86\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#quic","title":"QUIC \u534f\u8bae\u7684\u7279\u70b9","text":"<p>\u6211\u4eec\u6df1\u77e5\uff0cUDP \u662f\u4e00\u4e2a\u7b80\u5355\u3001\u4e0d\u53ef\u9760\u7684\u4f20\u8f93\u534f\u8bae\uff0c\u800c\u4e14\u662f UDP \u5305\u4e4b\u95f4\u662f\u65e0\u5e8f\u7684\uff0c\u4e5f\u6ca1\u6709\u4f9d\u8d56\u5173\u7cfb\u3002</p> <p>\u800c\u4e14\uff0cUDP \u662f\u4e0d\u9700\u8981\u8fde\u63a5\u7684\uff0c\u4e5f\u5c31\u4e0d\u9700\u8981\u63e1\u624b\u548c\u6325\u624b\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u5929\u7136\u7684\u5c31\u6bd4 TCP \u5feb\u3002</p> <p>\u5f53\u7136\uff0cHTTP/3 \u4e0d\u4ec5\u4ec5\u53ea\u662f\u7b80\u5355\u5c06\u4f20\u8f93\u534f\u8bae\u66ff\u6362\u6210\u4e86 UDP\uff0c\u8fd8\u57fa\u4e8e UDP \u534f\u8bae\u5728\u300c\u5e94\u7528\u5c42\u300d\u5b9e\u73b0\u4e86 QUIC \u534f\u8bae\uff0c\u5b83\u5177\u6709\u7c7b\u4f3c TCP \u7684\u8fde\u63a5\u7ba1\u7406\u3001\u62e5\u585e\u7a97\u53e3\u3001\u6d41\u91cf\u63a7\u5236\u7684\u7f51\u7edc\u7279\u6027\uff0c\u76f8\u5f53\u4e8e\u5c06\u4e0d\u53ef\u9760\u4f20\u8f93\u7684 UDP \u534f\u8bae\u53d8\u6210\u201c\u53ef\u9760\u201d\u7684\u4e86\uff0c\u6240\u4ee5\u4e0d\u7528\u62c5\u5fc3\u6570\u636e\u5305\u4e22\u5931\u7684\u95ee\u9898\u3002</p> <p>QUIC \u534f\u8bae\u7684\u4f18\u70b9\u6709\u5f88\u591a\uff0c\u8fd9\u91cc\u4e3e\u4f8b\u51e0\u4e2a\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u65e0\u961f\u5934\u963b\u585e\uff1b</li> <li>\u66f4\u5feb\u7684\u8fde\u63a5\u5efa\u7acb\uff1b</li> <li>\u8fde\u63a5\u8fc1\u79fb\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#_3","title":"\u65e0\u961f\u5934\u963b\u585e","text":"<p>QUIC \u534f\u8bae\u4e5f\u6709\u7c7b\u4f3c HTTP/2 Stream \u4e0e\u591a\u8def\u590d\u7528\u7684\u6982\u5ff5\uff0c\u4e5f\u662f\u53ef\u4ee5\u5728\u540c\u4e00\u6761\u8fde\u63a5\u4e0a\u5e76\u53d1\u4f20\u8f93\u591a\u4e2a Stream\uff0cStream \u53ef\u4ee5\u8ba4\u4e3a\u5c31\u662f\u4e00\u6761 HTTP \u8bf7\u6c42\u3002</p> <p>\u7531\u4e8e QUIC \u4f7f\u7528\u7684\u4f20\u8f93\u534f\u8bae\u662f UDP\uff0cUDP \u4e0d\u5173\u5fc3\u6570\u636e\u5305\u7684\u987a\u5e8f\uff0c\u5982\u679c\u6570\u636e\u5305\u4e22\u5931\uff0cUDP \u4e5f\u4e0d\u5173\u5fc3\u3002</p> <p>\u4e0d\u8fc7 QUIC \u534f\u8bae\u4f1a\u4fdd\u8bc1\u6570\u636e\u5305\u7684\u53ef\u9760\u6027\uff0c\u6bcf\u4e2a\u6570\u636e\u5305\u90fd\u6709\u4e00\u4e2a\u5e8f\u53f7\u552f\u4e00\u6807\u8bc6\u3002\u5f53\u67d0\u4e2a\u6d41\u4e2d\u7684\u4e00\u4e2a\u6570\u636e\u5305\u4e22\u5931\u4e86\uff0c\u5373\u4f7f\u8be5\u6d41\u7684\u5176\u4ed6\u6570\u636e\u5305\u5230\u8fbe\u4e86\uff0c\u6570\u636e\u4e5f\u65e0\u6cd5\u88ab HTTP/3 \u8bfb\u53d6\uff0c\u76f4\u5230 QUIC \u91cd\u4f20\u4e22\u5931\u7684\u62a5\u6587\uff0c\u6570\u636e\u624d\u4f1a\u4ea4\u7ed9 HTTP/3\u3002</p> <p>\u800c\u5176\u4ed6\u6d41\u7684\u6570\u636e\u62a5\u6587\u53ea\u8981\u88ab\u5b8c\u6574\u63a5\u6536\uff0cHTTP/3 \u5c31\u53ef\u4ee5\u8bfb\u53d6\u5230\u6570\u636e\u3002\u8fd9\u4e0e HTTP/2 \u4e0d\u540c\uff0cHTTP/2 \u53ea\u8981\u67d0\u4e2a\u6d41\u4e2d\u7684\u6570\u636e\u5305\u4e22\u5931\u4e86\uff0c\u5176\u4ed6\u6d41\u4e5f\u4f1a\u56e0\u6b64\u53d7\u5f71\u54cd\u3002</p> <p>\u6240\u4ee5\uff0cQUIC \u8fde\u63a5\u4e0a\u7684\u591a\u4e2a Stream \u4e4b\u95f4\u5e76\u6ca1\u6709\u4f9d\u8d56\uff0c\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u67d0\u4e2a\u6d41\u53d1\u751f\u4e22\u5305\u4e86\uff0c\u53ea\u4f1a\u5f71\u54cd\u8be5\u6d41\uff0c\u5176\u4ed6\u6d41\u4e0d\u53d7\u5f71\u54cd\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#_4","title":"\u66f4\u5feb\u7684\u8fde\u63a5\u5efa\u7acb","text":"<p>\u5bf9\u4e8e HTTP/1 \u548c HTTP/2 \u534f\u8bae\uff0cTCP \u548c TLS \u662f\u5206\u5c42\u7684\uff0c\u5206\u522b\u5c5e\u4e8e\u5185\u6838\u5b9e\u73b0\u7684\u4f20\u8f93\u5c42\u3001OpenSSL \u5e93\u5b9e\u73b0\u7684\u8868\u793a\u5c42\uff0c\u56e0\u6b64\u5b83\u4eec\u96be\u4ee5\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u9700\u8981\u5206\u6279\u6b21\u6765\u63e1\u624b\uff0c\u5148 TCP \u63e1\u624b\uff0c\u518d TLS \u63e1\u624b\u3002</p> <p>HTTP/3 \u5728\u4f20\u8f93\u6570\u636e\u524d\u867d\u7136\u9700\u8981 QUIC \u534f\u8bae\u63e1\u624b\uff0c\u8fd9\u4e2a\u63e1\u624b\u8fc7\u7a0b\u53ea\u9700\u8981 1 RTT\uff0c\u63e1\u624b\u7684\u76ee\u7684\u662f\u4e3a\u786e\u8ba4\u53cc\u65b9\u7684\u300c\u8fde\u63a5 ID\u300d\uff0c\u8fde\u63a5\u8fc1\u79fb\u5c31\u662f\u57fa\u4e8e\u8fde\u63a5 ID \u5b9e\u73b0\u7684\u3002</p> <p>\u4f46\u662f HTTP/3 \u7684 QUIC \u534f\u8bae\u5e76\u4e0d\u662f\u4e0e TLS \u5206\u5c42\uff0c\u800c\u662f QUIC \u5185\u90e8\u5305\u542b\u4e86 TLS\uff0c\u5b83\u5728\u81ea\u5df1\u7684\u5e27\u4f1a\u643a\u5e26 TLS \u91cc\u7684\u201c\u8bb0\u5f55\u201d\uff0c\u518d\u52a0\u4e0a QUIC \u4f7f\u7528\u7684\u662f TLS 1.3\uff0c\u56e0\u6b64\u4ec5\u9700 1 \u4e2a RTT \u5c31\u53ef\u4ee5\u300c\u540c\u65f6\u300d\u5b8c\u6210\u5efa\u7acb\u8fde\u63a5\u4e0e\u5bc6\u94a5\u534f\u5546\uff0c\u751a\u81f3\u5728\u7b2c\u4e8c\u6b21\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u5e94\u7528\u6570\u636e\u5305\u53ef\u4ee5\u548c QUIC \u63e1\u624b\u4fe1\u606f\uff08\u8fde\u63a5\u4fe1\u606f + TLS \u4fe1\u606f\uff09\u4e00\u8d77\u53d1\u9001\uff0c\u8fbe\u5230 0-RTT \u7684\u6548\u679c\u3002</p> <p>\u5982\u4e0b\u56fe\u53f3\u8fb9\u90e8\u5206\uff0cHTTP/3 \u5f53\u4f1a\u8bdd\u6062\u590d\u65f6\uff0c\u6709\u6548\u8d1f\u8f7d\u6570\u636e\u4e0e\u7b2c\u4e00\u4e2a\u6570\u636e\u5305\u4e00\u8d77\u53d1\u9001\uff0c\u53ef\u4ee5\u505a\u5230 0-RTT\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#_5","title":"\u8fde\u63a5\u8fc1\u79fb","text":"<p>\u5728\u524d\u9762\u6211\u4eec\u63d0\u5230\uff0c\u57fa\u4e8e TCP \u4f20\u8f93\u534f\u8bae\u7684 HTTP \u534f\u8bae\uff0c\u7531\u4e8e\u662f\u901a\u8fc7\u56db\u5143\u7ec4\uff08\u6e90 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684 IP\u3001\u76ee\u7684\u7aef\u53e3\uff09\u786e\u5b9a\u4e00\u6761 TCP \u8fde\u63a5\u3002</p> <p></p> <p>\u90a3\u4e48\u5f53\u79fb\u52a8\u8bbe\u5907\u7684\u7f51\u7edc\u4ece 4G \u5207\u6362\u5230 WiFi \u65f6\uff0c\u610f\u5473\u7740 IP \u5730\u5740\u53d8\u5316\u4e86\uff0c\u90a3\u4e48\u5c31\u5fc5\u987b\u8981\u65ad\u5f00\u8fde\u63a5\uff0c\u7136\u540e\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\uff0c\u800c\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\u5305\u542b TCP \u4e09\u6b21\u63e1\u624b\u548c TLS \u56db\u6b21\u63e1\u624b\u7684\u65f6\u5ef6\uff0c\u4ee5\u53ca TCP \u6162\u542f\u52a8\u7684\u51cf\u901f\u8fc7\u7a0b\uff0c\u7ed9\u7528\u6237\u7684\u611f\u89c9\u5c31\u662f\u7f51\u7edc\u7a81\u7136\u5361\u987f\u4e86\u4e00\u4e0b\uff0c\u56e0\u6b64\u8fde\u63a5\u7684\u8fc1\u79fb\u6210\u672c\u662f\u5f88\u9ad8\u7684\u3002</p> <p>\u800c QUIC \u534f\u8bae\u6ca1\u6709\u7528\u56db\u5143\u7ec4\u7684\u65b9\u5f0f\u6765\u201c\u7ed1\u5b9a\u201d\u8fde\u63a5\uff0c\u800c\u662f\u901a\u8fc7\u8fde\u63a5 ID \u6765\u6807\u8bb0\u901a\u4fe1\u7684\u4e24\u4e2a\u7aef\u70b9\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53ef\u4ee5\u5404\u81ea\u9009\u62e9\u4e00\u7ec4 ID \u6765\u6807\u8bb0\u81ea\u5df1\uff0c\u56e0\u6b64\u5373\u4f7f\u79fb\u52a8\u8bbe\u5907\u7684\u7f51\u7edc\u53d8\u5316\u540e\uff0c\u5bfc\u81f4 IP \u5730\u5740\u53d8\u5316\u4e86\uff0c\u53ea\u8981\u4ecd\u4fdd\u6709\u4e0a\u4e0b\u6587\u4fe1\u606f\uff08\u6bd4\u5982\u8fde\u63a5 ID\u3001TLS \u5bc6\u94a5\u7b49\uff09\uff0c\u5c31\u53ef\u4ee5\u201c\u65e0\u7f1d\u201d\u5730\u590d\u7528\u539f\u8fde\u63a5\uff0c\u6d88\u9664\u91cd\u8fde\u7684\u6210\u672c\uff0c\u6ca1\u6709\u4e1d\u6beb\u5361\u987f\u611f\uff0c\u8fbe\u5230\u4e86\u8fde\u63a5\u8fc1\u79fb\u7684\u529f\u80fd\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#http3","title":"HTTP/3 \u534f\u8bae","text":"<p>\u4e86\u89e3\u5b8c QUIC \u534f\u8bae\u7684\u7279\u70b9\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b HTTP/3 \u534f\u8bae\u5728 HTTP \u8fd9\u4e00\u5c42\u505a\u4e86\u4ec0\u4e48\u53d8\u5316\u3002</p> <p>HTTP/3 \u540c HTTP/2 \u4e00\u6837\u91c7\u7528\u4e8c\u8fdb\u5236\u5e27\u7684\u7ed3\u6784\uff0c\u4e0d\u540c\u7684\u5730\u65b9\u5728\u4e8e HTTP/2 \u7684\u4e8c\u8fdb\u5236\u5e27\u91cc\u9700\u8981\u5b9a\u4e49 Stream\uff0c\u800c  HTTP/3 \u81ea\u8eab\u4e0d\u9700\u8981\u518d\u5b9a\u4e49 Stream\uff0c\u76f4\u63a5\u4f7f\u7528 QUIC \u91cc\u7684 Stream\uff0c\u4e8e\u662f HTTP/3 \u7684\u5e27\u7684\u7ed3\u6784\u4e5f\u53d8\u7b80\u5355\u4e86\u3002 </p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0cHTTP/3 \u5e27\u5934\u53ea\u6709\u4e24\u4e2a\u5b57\u6bb5\uff1a\u7c7b\u578b\u548c\u957f\u5ea6\u3002</p> <p>\u6839\u636e\u5e27\u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u5927\u4f53\u4e0a\u5206\u4e3a\u6570\u636e\u5e27\u548c\u63a7\u5236\u5e27\u4e24\u5927\u7c7b\uff0cHeaders \u5e27\uff08HTTP \u5934\u90e8\uff09\u548c DATA \u5e27\uff08HTTP \u5305\u4f53\uff09\u5c5e\u4e8e\u6570\u636e\u5e27\u3002</p> <p>HTTP/3 \u5728\u5934\u90e8\u538b\u7f29\u7b97\u6cd5\u8fd9\u4e00\u65b9\u9762\u4e5f\u505a\u4e86\u5347\u7ea7\uff0c\u5347\u7ea7\u6210\u4e86 QPACK\u3002\u4e0e HTTP/2 \u4e2d\u7684 HPACK \u7f16\u7801\u65b9\u5f0f\u76f8\u4f3c\uff0cHTTP/3 \u4e2d\u7684 QPACK \u4e5f\u91c7\u7528\u4e86\u9759\u6001\u8868\u3001\u52a8\u6001\u8868\u53ca Huffman \u7f16\u7801\u3002</p> <p>\u5bf9\u4e8e\u9759\u6001\u8868\u7684\u53d8\u5316\uff0cHTTP/2 \u4e2d\u7684 HPACK \u7684\u9759\u6001\u8868\u53ea\u6709 61 \u9879\uff0c\u800c HTTP/3 \u4e2d\u7684 QPACK \u7684\u9759\u6001\u8868\u6269\u5927\u5230 91 \u9879\u3002</p> <p>HTTP/2 \u548c HTTP/3 \u7684 Huffman \u7f16\u7801\u5e76\u6ca1\u6709\u591a\u5927\u4e0d\u540c\uff0c\u4f46\u662f\u52a8\u6001\u8868\u7f16\u89e3\u7801\u65b9\u5f0f\u4e0d\u540c\u3002</p> <p>\u6240\u8c13\u7684\u52a8\u6001\u8868\uff0c\u5728\u9996\u6b21\u8bf7\u6c42 - \u54cd\u5e94\u540e\uff0c\u53cc\u65b9\u4f1a\u5c06\u672a\u5305\u542b\u5728\u9759\u6001\u8868\u4e2d\u7684 Header \u9879\u66f4\u65b0\u5404\u81ea\u7684\u52a8\u6001\u8868\uff0c\u63a5\u7740\u540e\u7eed\u4f20\u8f93\u65f6\u4ec5\u7528 1 \u4e2a\u6570\u5b57\u8868\u793a\uff0c\u7136\u540e\u5bf9\u65b9\u53ef\u4ee5\u6839\u636e\u8fd9 1 \u4e2a\u6570\u5b57\u4ece\u52a8\u6001\u8868\u67e5\u5230\u5bf9\u5e94\u7684\u6570\u636e\uff0c\u5c31\u4e0d\u5fc5\u6bcf\u6b21\u90fd\u4f20\u8f93\u957f\u957f\u7684\u6570\u636e\uff0c\u5927\u5927\u63d0\u5347\u4e86\u7f16\u7801\u6548\u7387\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u52a8\u6001\u8868\u662f\u5177\u6709\u65f6\u5e8f\u6027\u7684\uff0c\u5982\u679c\u9996\u6b21\u51fa\u73b0\u7684\u8bf7\u6c42\u53d1\u751f\u4e86\u4e22\u5305\uff0c\u540e\u7eed\u7684\u6536\u5230\u8bf7\u6c42\uff0c\u5bf9\u65b9\u5c31\u65e0\u6cd5\u89e3\u7801\u51fa HPACK \u5934\u90e8\uff0c\u56e0\u4e3a\u5bf9\u65b9\u8fd8\u6ca1\u5efa\u7acb\u597d\u52a8\u6001\u8868\uff0c\u56e0\u6b64\u540e\u7eed\u7684\u8bf7\u6c42\u89e3\u7801\u4f1a\u963b\u585e\u5230\u9996\u6b21\u8bf7\u6c42\u4e2d\u4e22\u5931\u7684\u6570\u636e\u5305\u91cd\u4f20\u8fc7\u6765\u3002</p> <p>HTTP/3 \u7684 QPACK \u89e3\u51b3\u4e86\u8fd9\u4e00\u95ee\u9898\uff0c\u90a3\u5b83\u662f\u5982\u4f55\u89e3\u51b3\u7684\u5462\uff1f</p> <p>QUIC \u4f1a\u6709\u4e24\u4e2a\u7279\u6b8a\u7684\u5355\u5411\u6d41\uff0c\u6240\u8c13\u7684\u5355\u5411\u6d41\u53ea\u6709\u4e00\u7aef\u53ef\u4ee5\u53d1\u9001\u6d88\u606f\uff0c\u53cc\u5411\u5219\u6307\u4e24\u7aef\u90fd\u53ef\u4ee5\u53d1\u9001\u6d88\u606f\uff0c\u4f20\u8f93 HTTP \u6d88\u606f\u65f6\u7528\u7684\u662f\u53cc\u5411\u6d41\uff0c\u8fd9\u4e24\u4e2a\u5355\u5411\u6d41\u7684\u7528\u6cd5\uff1a</p> <ul> <li>\u4e00\u4e2a\u53eb QPACK Encoder Stream\uff0c\u7528\u4e8e\u5c06\u4e00\u4e2a\u5b57\u5178\uff08Key-Value\uff09\u4f20\u9012\u7ed9\u5bf9\u65b9\uff0c\u6bd4\u5982\u9762\u5bf9\u4e0d\u5c5e\u4e8e\u9759\u6001\u8868\u7684 HTTP \u8bf7\u6c42\u5934\u90e8\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a Stream \u53d1\u9001\u5b57\u5178\uff1b</li> <li>\u4e00\u4e2a\u53eb QPACK Decoder Stream\uff0c\u7528\u4e8e\u54cd\u5e94\u5bf9\u65b9\uff0c\u544a\u8bc9\u5b83\u521a\u53d1\u7684\u5b57\u5178\u5df2\u7ecf\u66f4\u65b0\u5230\u81ea\u5df1\u7684\u672c\u5730\u52a8\u6001\u8868\u4e86\uff0c\u540e\u7eed\u5c31\u53ef\u4ee5\u4f7f\u7528\u8fd9\u4e2a\u5b57\u5178\u6765\u7f16\u7801\u4e86\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u7279\u6b8a\u7684\u5355\u5411\u6d41\u662f\u7528\u6765\u540c\u6b65\u53cc\u65b9\u7684\u52a8\u6001\u8868\uff0c\u7f16\u7801\u65b9\u6536\u5230\u89e3\u7801\u65b9\u66f4\u65b0\u786e\u8ba4\u7684\u901a\u77e5\u540e\uff0c\u624d\u4f7f\u7528\u52a8\u6001\u8868\u7f16\u7801 HTTP \u5934\u90e8\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http3/#_6","title":"\u603b\u7ed3","text":"<p>HTTP/2 \u867d\u7136\u5177\u6709\u591a\u4e2a\u6d41\u5e76\u53d1\u4f20\u8f93\u7684\u80fd\u529b\uff0c\u4f46\u662f\u4f20\u8f93\u5c42\u662f TCP \u534f\u8bae\uff0c\u4e8e\u662f\u5b58\u5728\u4ee5\u4e0b\u7f3a\u9677\uff1a</p> <ul> <li>\u961f\u5934\u963b\u585e\uff0cHTTP/2 \u591a\u4e2a\u8bf7\u6c42\u8dd1\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\uff0c\u5982\u679c\u5e8f\u5217\u53f7\u8f83\u4f4e\u7684 TCP \u6bb5\u5728\u7f51\u7edc\u4f20\u8f93\u4e2d\u4e22\u5931\u4e86\uff0c\u5373\u4f7f\u5e8f\u5217\u53f7\u8f83\u9ad8\u7684 TCP \u6bb5\u5df2\u7ecf\u88ab\u63a5\u6536\u4e86\uff0c\u5e94\u7528\u5c42\u4e5f\u65e0\u6cd5\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u5230\u8fd9\u90e8\u5206\u6570\u636e\uff0c\u4ece HTTP \u89c6\u89d2\u770b\uff0c\u5c31\u662f\u591a\u4e2a\u8bf7\u6c42\u88ab\u963b\u585e\u4e86\uff1b</li> <li>TCP \u548c TLS \u63e1\u624b\u65f6\u5ef6\uff0cTCP \u4e09\u6b21\u63e1\u624b\u548c TLS \u56db\u6b21\u63e1\u624b\uff0c\u5171\u6709 3-RTT \u7684\u65f6\u5ef6\uff1b</li> <li>\u8fde\u63a5\u8fc1\u79fb\u9700\u8981\u91cd\u65b0\u8fde\u63a5\uff0c\u79fb\u52a8\u8bbe\u5907\u4ece 4G \u7f51\u7edc\u73af\u5883\u5207\u6362\u5230 WiFi \u65f6\uff0c\u7531\u4e8e TCP \u662f\u57fa\u4e8e\u56db\u5143\u7ec4\u6765\u786e\u8ba4\u4e00\u6761 TCP \u8fde\u63a5\u7684\uff0c\u90a3\u4e48\u7f51\u7edc\u73af\u5883\u53d8\u5316\u540e\uff0c\u5c31\u4f1a\u5bfc\u81f4 IP \u5730\u5740\u6216\u7aef\u53e3\u53d8\u5316\uff0c\u4e8e\u662f TCP \u53ea\u80fd\u65ad\u5f00\u8fde\u63a5\uff0c\u7136\u540e\u518d\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\uff0c\u5207\u6362\u7f51\u7edc\u73af\u5883\u7684\u6210\u672c\u9ad8\uff1b</li> </ul> <p>HTTP/3 \u5c31\u5c06\u4f20\u8f93\u5c42\u4ece TCP \u66ff\u6362\u6210\u4e86 UDP\uff0c\u5e76\u5728 UDP \u534f\u8bae\u4e0a\u5f00\u53d1\u4e86 QUIC \u534f\u8bae\uff0c\u6765\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u9760\u4f20\u8f93\u3002</p> <p>QUIC \u534f\u8bae\u7684\u7279\u70b9\uff1a</p> <ul> <li>\u65e0\u961f\u5934\u963b\u585e\uff0cQUIC \u8fde\u63a5\u4e0a\u7684\u591a\u4e2a Stream \u4e4b\u95f4\u5e76\u6ca1\u6709\u4f9d\u8d56\uff0c\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u4e5f\u4e0d\u4f1a\u6709\u5e95\u5c42\u534f\u8bae\u9650\u5236\uff0c\u67d0\u4e2a\u6d41\u53d1\u751f\u4e22\u5305\u4e86\uff0c\u53ea\u4f1a\u5f71\u54cd\u8be5\u6d41\uff0c\u5176\u4ed6\u6d41\u4e0d\u53d7\u5f71\u54cd\uff1b</li> <li>\u5efa\u7acb\u8fde\u63a5\u901f\u5ea6\u5feb\uff0c\u56e0\u4e3a QUIC \u5185\u90e8\u5305\u542b TLS 1.3\uff0c\u56e0\u6b64\u4ec5\u9700 1 \u4e2a RTT \u5c31\u53ef\u4ee5\u300c\u540c\u65f6\u300d\u5b8c\u6210\u5efa\u7acb\u8fde\u63a5\u4e0e TLS \u5bc6\u94a5\u534f\u5546\uff0c\u751a\u81f3\u5728\u7b2c\u4e8c\u6b21\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u5e94\u7528\u6570\u636e\u5305\u53ef\u4ee5\u548c QUIC \u63e1\u624b\u4fe1\u606f\uff08\u8fde\u63a5\u4fe1\u606f + TLS \u4fe1\u606f\uff09\u4e00\u8d77\u53d1\u9001\uff0c\u8fbe\u5230 0-RTT \u7684\u6548\u679c\u3002</li> <li>\u8fde\u63a5\u8fc1\u79fb\uff0cQUIC \u534f\u8bae\u6ca1\u6709\u7528\u56db\u5143\u7ec4\u7684\u65b9\u5f0f\u6765\u201c\u7ed1\u5b9a\u201d\u8fde\u63a5\uff0c\u800c\u662f\u901a\u8fc7\u300c\u8fde\u63a5 ID\u300d\u6765\u6807\u8bb0\u901a\u4fe1\u7684\u4e24\u4e2a\u7aef\u70b9\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53ef\u4ee5\u5404\u81ea\u9009\u62e9\u4e00\u7ec4 ID \u6765\u6807\u8bb0\u81ea\u5df1\uff0c\u56e0\u6b64\u5373\u4f7f\u79fb\u52a8\u8bbe\u5907\u7684\u7f51\u7edc\u53d8\u5316\u540e\uff0c\u5bfc\u81f4 IP \u5730\u5740\u53d8\u5316\u4e86\uff0c\u53ea\u8981\u4ecd\u4fdd\u6709\u4e0a\u4e0b\u6587\u4fe1\u606f\uff08\u6bd4\u5982\u8fde\u63a5 ID\u3001TLS \u5bc6\u94a5\u7b49\uff09\uff0c\u5c31\u53ef\u4ee5\u201c\u65e0\u7f1d\u201d\u5730\u590d\u7528\u539f\u8fde\u63a5\uff0c\u6d88\u9664\u91cd\u8fde\u7684\u6210\u672c\uff1b</li> </ul> <p>\u53e6\u5916 HTTP/3 \u7684 QPACK \u901a\u8fc7\u4e24\u4e2a\u7279\u6b8a\u7684\u5355\u5411\u6d41\u6765\u540c\u6b65\u53cc\u65b9\u7684\u52a8\u6001\u8868\uff0c\u89e3\u51b3\u4e86 HTTP/2 \u7684 HPACK \u961f\u5934\u963b\u585e\u95ee\u9898\u3002</p> <p>\u671f\u5f85\uff0cHTTP/3 \u6b63\u5f0f\u63a8\u51fa\u7684\u90a3\u4e00\u5929\uff01</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ol> <li>https://medium.com/faun/http-2-spdy-and-http-3-quic-bae7d9a3d484</li> <li>https://developers.google.com/web/fundamentals/performance/http2?hl=zh-cn</li> <li>https://blog.cloudflare.com/http3-the-past-present-and-future/</li> <li>https://tools.ietf.org/html/draft-ietf-quic-http-34</li> <li>https://tools.ietf.org/html/draft-ietf-quic-transport-34#section-17</li> <li>https://ably.com/topic/http3?amp%3Butm_campaign=evergreen&amp;amp%3Butm_source=reddit&amp;utm_medium=referral</li> <li>https://www.nginx.org.cn/article/detail/422</li> <li>https://www.bilibili.com/read/cv793000/</li> <li>https://www.chinaz.com/2020/1009/1192436.shtml</li> </ol> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/","title":"3.1 HTTP \u5e38\u89c1\u9762\u8bd5\u9898","text":"<p>\u5728\u9762\u8bd5\u8fc7\u7a0b\u4e2d\uff0cHTTP \u88ab\u63d0\u95ee\u7684\u6982\u7387\u8fd8\u662f\u6bd4\u8f83\u9ad8\u7684\u3002</p> <p>\u5c0f\u6797\u6211\u641c\u96c6\u4e86 6 \u5927\u7c7b HTTP \u9762\u8bd5\u5e38\u95ee\u7684\u9898\u76ee\uff0c\u540c\u65f6\u8fd9 6 \u5927\u7c7b\u9898\u8ddf HTTP \u7684\u53d1\u5c55\u548c\u6f14\u53d8\u5173\u8054\u6027\u662f\u6bd4\u8f83\u5927\u7684\uff0c\u901a\u8fc7\u95ee\u7b54 + \u56fe\u89e3\u7684\u5f62\u5f0f\u7531\u6d45\u5165\u6df1\u7684\u65b9\u5f0f\u5e2e\u52a9\u5927\u5bb6\u8fdb\u4e00\u6b65\u7684\u5b66\u4e60\u548c\u7406\u89e3 HTTP\u3002</p> <ol> <li>HTTP \u57fa\u672c\u6982\u5ff5</li> <li>Get \u4e0e Post</li> <li>HTTP \u7279\u6027</li> <li>HTTP \u7f13\u5b58\u6280\u672f</li> <li>HTTPS \u4e0e HTTP</li> <li>HTTP/1.1\u3001HTTP/2\u3001HTTP/3 \u6f14\u53d8</li> </ol> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http","title":"HTTP \u57fa\u672c\u6982\u5ff5","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http_1","title":"HTTP \u662f\u4ec0\u4e48\uff1f","text":"<p>HTTP \u662f\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\uff0c\u4e5f\u5c31\u662fHyperText Transfer Protocol\u3002</p> <p>\u80fd\u5426\u8be6\u7ec6\u89e3\u91ca\u300c\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\u300d\uff1f</p> <p>HTTP \u7684\u540d\u5b57\u300c\u8d85\u6587\u672c\u534f\u8bae\u4f20\u8f93\u300d\uff0c\u5b83\u53ef\u4ee5\u62c6\u6210\u4e09\u4e2a\u90e8\u5206\uff1a</p> <ul> <li>\u8d85\u6587\u672c</li> <li>\u4f20\u8f93</li> <li>\u534f\u8bae</li> </ul> <p></p> <p>1. \u300c\u534f\u8bae\u300d</p> <p>\u5728\u751f\u6d3b\u4e2d\uff0c\u6211\u4eec\u4e5f\u80fd\u968f\u5904\u53ef\u89c1\u300c\u534f\u8bae\u300d\uff0c\u4f8b\u5982\uff1a</p> <ul> <li>\u521a\u6bd5\u4e1a\u65f6\u4f1a\u7b7e\u4e00\u4e2a\u300c\u4e09\u65b9\u534f\u8bae\u300d\uff1b</li> <li>\u627e\u623f\u5b50\u65f6\u4f1a\u7b7e\u4e00\u4e2a\u300c\u79df\u623f\u534f\u8bae\u300d\uff1b</li> </ul> <p></p> <p>\u751f\u6d3b\u4e2d\u7684\u534f\u8bae\uff0c\u672c\u8d28\u4e0a\u4e0e\u8ba1\u7b97\u673a\u4e2d\u7684\u534f\u8bae\u662f\u76f8\u540c\u7684\uff0c\u534f\u8bae\u7684\u7279\u70b9\uff1a</p> <ul> <li>\u300c\u534f\u300d\u5b57\uff0c\u4ee3\u8868\u7684\u610f\u601d\u662f\u5fc5\u987b\u6709\u4e24\u4e2a\u4ee5\u4e0a\u7684\u53c2\u4e0e\u8005\u3002\u4f8b\u5982\u4e09\u65b9\u534f\u8bae\u91cc\u7684\u53c2\u4e0e\u8005\u6709\u4e09\u4e2a\uff1a\u4f60\u3001\u516c\u53f8\u3001\u5b66\u6821\u4e09\u4e2a\uff1b\u79df\u623f\u534f\u8bae\u91cc\u7684\u53c2\u4e0e\u8005\u6709\u4e24\u4e2a\uff1a\u4f60\u548c\u623f\u4e1c\u3002</li> <li>\u300c\u8bae\u300d\u5b57\uff0c\u4ee3\u8868\u7684\u610f\u601d\u662f\u5bf9\u53c2\u4e0e\u8005\u7684\u4e00\u79cd\u884c\u4e3a\u7ea6\u5b9a\u548c\u89c4\u8303\u3002\u4f8b\u5982\u4e09\u65b9\u534f\u8bae\u91cc\u89c4\u5b9a\u8bd5\u7528\u671f\u671f\u9650\u3001\u6bc1\u7ea6\u91d1\u7b49\uff1b\u79df\u623f\u534f\u8bae\u91cc\u89c4\u5b9a\u79df\u671f\u671f\u9650\u3001\u6bcf\u6708\u79df\u91d1\u91d1\u989d\u3001\u8fdd\u7ea6\u5982\u4f55\u5904\u7406\u7b49\u3002</li> </ul> <p>\u9488\u5bf9 HTTP \u534f\u8bae\uff0c\u6211\u4eec\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\u3002</p> <p>HTTP \u662f\u4e00\u4e2a\u7528\u5728\u8ba1\u7b97\u673a\u4e16\u754c\u91cc\u7684\u534f\u8bae\u3002\u5b83\u4f7f\u7528\u8ba1\u7b97\u673a\u80fd\u591f\u7406\u89e3\u7684\u8bed\u8a00\u786e\u7acb\u4e86\u4e00\u79cd\u8ba1\u7b97\u673a\u4e4b\u95f4\u4ea4\u6d41\u901a\u4fe1\u7684\u89c4\u8303\uff08\u4e24\u4e2a\u4ee5\u4e0a\u7684\u53c2\u4e0e\u8005\uff09\uff0c\u4ee5\u53ca\u76f8\u5173\u7684\u5404\u79cd\u63a7\u5236\u548c\u9519\u8bef\u5904\u7406\u65b9\u5f0f\uff08\u884c\u4e3a\u7ea6\u5b9a\u548c\u89c4\u8303\uff09\u3002</p> <p>2. \u300c\u4f20\u8f93\u300d</p> <p>\u6240\u8c13\u7684\u300c\u4f20\u8f93\u300d\uff0c\u5f88\u597d\u7406\u89e3\uff0c\u5c31\u662f\u628a\u4e00\u5806\u4e1c\u897f\u4ece A \u70b9\u642c\u5230 B \u70b9\uff0c\u6216\u8005\u4ece B \u70b9 \u642c\u5230 A \u70b9\u3002</p> <p>\u522b\u8f7b\u89c6\u4e86\u8fd9\u4e2a\u7b80\u5355\u7684\u52a8\u4f5c\uff0c\u5b83\u81f3\u5c11\u5305\u542b\u4e24\u9879\u91cd\u8981\u7684\u4fe1\u606f\u3002</p> <p>HTTP \u534f\u8bae\u662f\u4e00\u4e2a\u53cc\u5411\u534f\u8bae\u3002</p> <p>\u6211\u4eec\u5728\u4e0a\u7f51\u51b2\u6d6a\u65f6\uff0c\u6d4f\u89c8\u5668\u662f\u8bf7\u6c42\u65b9 A\uff0c\u767e\u5ea6\u7f51\u7ad9\u5c31\u662f\u5e94\u7b54\u65b9 B\u3002\u53cc\u65b9\u7ea6\u5b9a\u7528 HTTP \u534f\u8bae\u6765\u901a\u4fe1\uff0c\u4e8e\u662f\u6d4f\u89c8\u5668\u628a\u8bf7\u6c42\u6570\u636e\u53d1\u9001\u7ed9\u7f51\u7ad9\uff0c\u7f51\u7ad9\u518d\u628a\u4e00\u4e9b\u6570\u636e\u8fd4\u56de\u7ed9\u6d4f\u89c8\u5668\uff0c\u6700\u540e\u7531\u6d4f\u89c8\u5668\u6e32\u67d3\u5728\u5c4f\u5e55\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u56fe\u7247\u3001\u89c6\u9891\u4e86\u3002</p> <p></p> <p>\u6570\u636e\u867d\u7136\u662f\u5728 A \u548c B \u4e4b\u95f4\u4f20\u8f93\uff0c\u4f46\u5141\u8bb8\u4e2d\u95f4\u6709\u4e2d\u8f6c\u6216\u63a5\u529b\u3002</p> <p>\u5c31\u597d\u50cf\u7b2c\u4e00\u6392\u7684\u540c\u5b66\u60f3\u4f20\u9012\u7eb8\u6761\u7ed9\u6700\u540e\u4e00\u6392\u7684\u540c\u5b66\uff0c\u90a3\u4e48\u4f20\u9012\u7684\u8fc7\u7a0b\u4e2d\u5c31\u9700\u8981\u7ecf\u8fc7\u597d\u591a\u4e2a\u540c\u5b66\uff08\u4e2d\u95f4\u4eba\uff09\uff0c\u8fd9\u6837\u7684\u4f20\u8f93\u65b9\u5f0f\u5c31\u4ece\u300cA &lt; --- &gt; B\u300d\uff0c\u53d8\u6210\u4e86\u300cA &lt;-&gt; N &lt;-&gt; M &lt;-&gt; B\u300d\u3002</p> <p>\u800c\u5728 HTTP \u91cc\uff0c\u9700\u8981\u4e2d\u95f4\u4eba\u9075\u4ece HTTP \u534f\u8bae\uff0c\u53ea\u8981\u4e0d\u6253\u6270\u57fa\u672c\u7684\u6570\u636e\u4f20\u8f93\uff0c\u5c31\u53ef\u4ee5\u6dfb\u52a0\u4efb\u610f\u989d\u5916\u7684\u4e1c\u897f\u3002</p> <p>\u9488\u5bf9\u4f20\u8f93\uff0c\u6211\u4eec\u53ef\u4ee5\u8fdb\u4e00\u6b65\u7406\u89e3\u4e86 HTTP\u3002</p> <p>HTTP \u662f\u4e00\u4e2a\u5728\u8ba1\u7b97\u673a\u4e16\u754c\u91cc\u4e13\u95e8\u7528\u6765\u5728\u4e24\u70b9\u4e4b\u95f4\u4f20\u8f93\u6570\u636e\u7684\u7ea6\u5b9a\u548c\u89c4\u8303\u3002</p> <p>3. \u300c\u8d85\u6587\u672c\u300d</p> <p>HTTP \u4f20\u8f93\u7684\u5185\u5bb9\u662f\u300c\u8d85\u6587\u672c\u300d\u3002</p> <p>\u6211\u4eec\u5148\u6765\u7406\u89e3\u300c\u6587\u672c\u300d\uff0c\u5728\u4e92\u8054\u7f51\u65e9\u671f\u7684\u65f6\u5019\u53ea\u662f\u7b80\u5355\u7684\u5b57\u7b26\u6587\u5b57\uff0c\u4f46\u73b0\u5728\u300c\u6587\u672c\u300d\u7684\u6db5\u4e49\u5df2\u7ecf\u53ef\u4ee5\u6269\u5c55\u4e3a\u56fe\u7247\u3001\u89c6\u9891\u3001\u538b\u7f29\u5305\u7b49\uff0c\u5728 HTTP \u773c\u91cc\u8fd9\u4e9b\u90fd\u7b97\u4f5c\u300c\u6587\u672c\u300d\u3002</p> <p>\u518d\u6765\u7406\u89e3\u300c\u8d85\u6587\u672c\u300d\uff0c\u5b83\u5c31\u662f\u8d85\u8d8a\u4e86\u666e\u901a\u6587\u672c\u7684\u6587\u672c\uff0c\u5b83\u662f\u6587\u5b57\u3001\u56fe\u7247\u3001\u89c6\u9891\u7b49\u7684\u6df7\u5408\u4f53\uff0c\u6700\u5173\u952e\u6709\u8d85\u94fe\u63a5\uff0c\u80fd\u4ece\u4e00\u4e2a\u8d85\u6587\u672c\u8df3\u8f6c\u5230\u53e6\u5916\u4e00\u4e2a\u8d85\u6587\u672c\u3002</p> <p>HTML \u5c31\u662f\u6700\u5e38\u89c1\u7684\u8d85\u6587\u672c\u4e86\uff0c\u5b83\u672c\u8eab\u53ea\u662f\u7eaf\u6587\u5b57\u6587\u4ef6\uff0c\u4f46\u5185\u90e8\u7528\u5f88\u591a\u6807\u7b7e\u5b9a\u4e49\u4e86\u56fe\u7247\u3001\u89c6\u9891\u7b49\u7684\u94fe\u63a5\uff0c\u518d\u7ecf\u8fc7\u6d4f\u89c8\u5668\u7684\u89e3\u91ca\uff0c\u5448\u73b0\u7ed9\u6211\u4eec\u7684\u5c31\u662f\u4e00\u4e2a\u6587\u5b57\u3001\u6709\u753b\u9762\u7684\u7f51\u9875\u4e86\u3002</p> <p>OK\uff0c\u7ecf\u8fc7\u4e86\u5bf9 HTTP \u91cc\u8fd9\u4e09\u4e2a\u540d\u8bcd\u7684\u8be6\u7ec6\u89e3\u91ca\uff0c\u5c31\u53ef\u4ee5\u7ed9\u51fa\u6bd4\u300c\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\u300d\u8fd9\u4e03\u4e2a\u5b57\u66f4\u51c6\u786e\u66f4\u6709\u6280\u672f\u542b\u91cf\u7684\u7b54\u6848\uff1a</p> <p>HTTP \u662f\u4e00\u4e2a\u5728\u8ba1\u7b97\u673a\u4e16\u754c\u91cc\u4e13\u95e8\u5728\u300c\u4e24\u70b9\u300d\u4e4b\u95f4\u300c\u4f20\u8f93\u300d\u6587\u5b57\u3001\u56fe\u7247\u3001\u97f3\u9891\u3001\u89c6\u9891\u7b49\u300c\u8d85\u6587\u672c\u300d\u6570\u636e\u7684\u300c\u7ea6\u5b9a\u548c\u89c4\u8303\u300d\u3002</p> <p>\u90a3\u300cHTTP \u662f\u7528\u4e8e\u4ece\u4e92\u8054\u7f51\u670d\u52a1\u5668\u4f20\u8f93\u8d85\u6587\u672c\u5230\u672c\u5730\u6d4f\u89c8\u5668\u7684\u534f\u8bae\u300d\uff0c\u8fd9\u79cd\u8bf4\u6cd5\u6b63\u786e\u5417\uff1f</p> <p>\u8fd9\u79cd\u8bf4\u6cd5\u662f\u4e0d\u6b63\u786e\u7684\u3002\u56e0\u4e3a\u4e5f\u53ef\u4ee5\u662f\u300c\u670d\u52a1\u5668&lt; -- &gt;\u670d\u52a1\u5668\u300d\uff0c\u6240\u4ee5\u91c7\u7528\u4e24\u70b9\u4e4b\u95f4\u7684\u63cf\u8ff0\u4f1a\u66f4\u51c6\u786e\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http_2","title":"HTTP \u5e38\u89c1\u7684\u72b6\u6001\u7801\u6709\u54ea\u4e9b\uff1f","text":"<p><code>1xx</code> \u7c7b\u72b6\u6001\u7801\u5c5e\u4e8e\u63d0\u793a\u4fe1\u606f\uff0c\u662f\u534f\u8bae\u5904\u7406\u4e2d\u7684\u4e00\u79cd\u4e2d\u95f4\u72b6\u6001\uff0c\u5b9e\u9645\u7528\u5230\u7684\u6bd4\u8f83\u5c11\u3002</p> <ul> <li>\u300c101 Switching Protocols\u300d\u534f\u8bae\u5207\u6362\uff0c\u670d\u52a1\u5668\u5df2\u7ecf\u7406\u89e3\u4e86\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u5e76\u5c06\u901a\u8fc7 Upgrade \u6d88\u606f\u5934\u901a\u77e5\u5ba2\u6237\u7aef\u91c7\u7528\u4e0d\u540c\u7684\u534f\u8bae\u6765\u5b8c\u6210\u8fd9\u4e2a\u8bf7\u6c42\u3002\u6bd4\u5982\u5207\u6362\u5230\u4e00\u4e2a\u5b9e\u65f6\u4e14\u540c\u6b65\u7684\u534f\u8bae\uff08\u5982 WebSocket\uff09\u4ee5\u4f20\u9001\u5229\u7528\u6b64\u7c7b\u7279\u6027\u7684\u8d44\u6e90\u3002</li> </ul> <p><code>2xx</code> \u7c7b\u72b6\u6001\u7801\u8868\u793a\u670d\u52a1\u5668\u6210\u529f\u5904\u7406\u4e86\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\uff0c\u4e5f\u662f\u6211\u4eec\u6700\u613f\u610f\u770b\u5230\u7684\u72b6\u6001\u3002</p> <ul> <li> <p>\u300c200 OK\u300d\u662f\u6700\u5e38\u89c1\u7684\u6210\u529f\u72b6\u6001\u7801\uff0c\u8868\u793a\u4e00\u5207\u6b63\u5e38\u3002\u5982\u679c\u662f\u975e <code>HEAD</code> \u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u8fd4\u56de\u7684\u54cd\u5e94\u5934\u90fd\u4f1a\u6709 body \u6570\u636e\u3002</p> </li> <li> <p>\u300c204 No Content\u300d\u4e5f\u662f\u5e38\u89c1\u7684\u6210\u529f\u72b6\u6001\u7801\uff0c\u4e0e 200 OK \u57fa\u672c\u76f8\u540c\uff0c\u4f46\u54cd\u5e94\u5934\u6ca1\u6709 body \u6570\u636e\u3002</p> </li> <li> <p>\u300c206 Partial Content\u300d\u662f\u5e94\u7528\u4e8e HTTP \u5206\u5757\u4e0b\u8f7d\u6216\u65ad\u70b9\u7eed\u4f20\uff0c\u8868\u793a\u54cd\u5e94\u8fd4\u56de\u7684 body \u6570\u636e\u5e76\u4e0d\u662f\u8d44\u6e90\u7684\u5168\u90e8\uff0c\u800c\u662f\u5176\u4e2d\u7684\u4e00\u90e8\u5206\uff0c\u4e5f\u662f\u670d\u52a1\u5668\u5904\u7406\u6210\u529f\u7684\u72b6\u6001\u3002</p> </li> </ul> <p><code>3xx</code> \u7c7b\u72b6\u6001\u7801\u8868\u793a\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u8d44\u6e90\u53d1\u751f\u4e86\u53d8\u52a8\uff0c\u9700\u8981\u5ba2\u6237\u7aef\u7528\u65b0\u7684 URL \u91cd\u65b0\u53d1\u9001\u8bf7\u6c42\u83b7\u53d6\u8d44\u6e90\uff0c\u4e5f\u5c31\u662f\u91cd\u5b9a\u5411\u3002 </p> <ul> <li> <p>\u300c301 Moved Permanently\u300d\u8868\u793a\u6c38\u4e45\u91cd\u5b9a\u5411\uff0c\u8bf4\u660e\u8bf7\u6c42\u7684\u8d44\u6e90\u5df2\u7ecf\u4e0d\u5b58\u5728\u4e86\uff0c\u9700\u6539\u7528\u65b0\u7684 URL \u518d\u6b21\u8bbf\u95ee\u3002</p> </li> <li> <p>\u300c302 Found\u300d\u8868\u793a\u4e34\u65f6\u91cd\u5b9a\u5411\uff0c\u8bf4\u660e\u8bf7\u6c42\u7684\u8d44\u6e90\u8fd8\u5728\uff0c\u4f46\u6682\u65f6\u9700\u8981\u7528\u53e6\u4e00\u4e2a URL \u6765\u8bbf\u95ee\u3002</p> </li> </ul> <p>301 \u548c 302 \u90fd\u4f1a\u5728\u54cd\u5e94\u5934\u91cc\u4f7f\u7528\u5b57\u6bb5 <code>Location</code>\uff0c\u6307\u660e\u540e\u7eed\u8981\u8df3\u8f6c\u7684 URL\uff0c\u6d4f\u89c8\u5668\u4f1a\u81ea\u52a8\u91cd\u5b9a\u5411\u65b0\u7684 URL\u3002</p> <ul> <li>\u300c304 Not Modified\u300d\u4e0d\u5177\u6709\u8df3\u8f6c\u7684\u542b\u4e49\uff0c\u8868\u793a\u8d44\u6e90\u672a\u4fee\u6539\uff0c\u91cd\u5b9a\u5411\u5df2\u5b58\u5728\u7684\u7f13\u51b2\u6587\u4ef6\uff0c\u4e5f\u79f0\u7f13\u5b58\u91cd\u5b9a\u5411\uff0c\u4e5f\u5c31\u662f\u544a\u8bc9\u5ba2\u6237\u7aef\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\u7f13\u5b58\u8d44\u6e90\uff0c\u7528\u4e8e\u7f13\u5b58\u63a7\u5236\u3002</li> </ul> <p><code>4xx</code> \u7c7b\u72b6\u6001\u7801\u8868\u793a\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u62a5\u6587\u6709\u8bef\uff0c\u670d\u52a1\u5668\u65e0\u6cd5\u5904\u7406\uff0c\u4e5f\u5c31\u662f\u9519\u8bef\u7801\u7684\u542b\u4e49\u3002</p> <ul> <li> <p>\u300c400 Bad Request\u300d\u8868\u793a\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u62a5\u6587\u6709\u9519\u8bef\uff0c\u4f46\u53ea\u662f\u4e2a\u7b3c\u7edf\u7684\u9519\u8bef\u3002</p> </li> <li> <p>\u300c403 Forbidden\u300d\u8868\u793a\u670d\u52a1\u5668\u7981\u6b62\u8bbf\u95ee\u8d44\u6e90\uff0c\u5e76\u4e0d\u662f\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u51fa\u9519\u3002</p> </li> <li> <p>\u300c404 Not Found\u300d\u8868\u793a\u8bf7\u6c42\u7684\u8d44\u6e90\u5728\u670d\u52a1\u5668\u4e0a\u4e0d\u5b58\u5728\u6216\u672a\u627e\u5230\uff0c\u6240\u4ee5\u65e0\u6cd5\u63d0\u4f9b\u7ed9\u5ba2\u6237\u7aef\u3002</p> </li> </ul> <p><code>5xx</code> \u7c7b\u72b6\u6001\u7801\u8868\u793a\u5ba2\u6237\u7aef\u8bf7\u6c42\u62a5\u6587\u6b63\u786e\uff0c\u4f46\u662f\u670d\u52a1\u5668\u5904\u7406\u65f6\u5185\u90e8\u53d1\u751f\u4e86\u9519\u8bef\uff0c\u5c5e\u4e8e\u670d\u52a1\u5668\u7aef\u7684\u9519\u8bef\u7801\u3002</p> <ul> <li> <p>\u300c500 Internal Server Error\u300d\u4e0e 400 \u7c7b\u4f3c\uff0c\u662f\u4e2a\u7b3c\u7edf\u901a\u7528\u7684\u9519\u8bef\u7801\uff0c\u670d\u52a1\u5668\u53d1\u751f\u4e86\u4ec0\u4e48\u9519\u8bef\uff0c\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\u3002</p> </li> <li> <p>\u300c501 Not Implemented\u300d\u8868\u793a\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u529f\u80fd\u8fd8\u4e0d\u652f\u6301\uff0c\u7c7b\u4f3c\u201c\u5373\u5c06\u5f00\u4e1a\uff0c\u656c\u8bf7\u671f\u5f85\u201d\u7684\u610f\u601d\u3002</p> </li> <li> <p>\u300c502 Bad Gateway\u300d\u901a\u5e38\u662f\u670d\u52a1\u5668\u4f5c\u4e3a\u7f51\u5173\u6216\u4ee3\u7406\u65f6\u8fd4\u56de\u7684\u9519\u8bef\u7801\uff0c\u8868\u793a\u670d\u52a1\u5668\u81ea\u8eab\u5de5\u4f5c\u6b63\u5e38\uff0c\u8bbf\u95ee\u540e\u7aef\u670d\u52a1\u5668\u53d1\u751f\u4e86\u9519\u8bef\u3002</p> </li> <li> <p>\u300c503 Service Unavailable\u300d\u8868\u793a\u670d\u52a1\u5668\u5f53\u524d\u5f88\u5fd9\uff0c\u6682\u65f6\u65e0\u6cd5\u54cd\u5e94\u5ba2\u6237\u7aef\uff0c\u7c7b\u4f3c\u201c\u7f51\u7edc\u670d\u52a1\u6b63\u5fd9\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5\u201d\u7684\u610f\u601d\u3002</p> </li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http_3","title":"HTTP \u5e38\u89c1\u5b57\u6bb5\u6709\u54ea\u4e9b\uff1f","text":"<p>Host \u5b57\u6bb5</p> <p>\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u7528\u6765\u6307\u5b9a\u670d\u52a1\u5668\u7684\u57df\u540d\u3002</p> <p></p> Text Only<pre><code>Host: www.A.com\n</code></pre> <p>\u6709\u4e86 <code>Host</code> \u5b57\u6bb5\uff0c\u5c31\u53ef\u4ee5\u5c06\u8bf7\u6c42\u53d1\u5f80\u300c\u540c\u4e00\u53f0\u300d\u670d\u52a1\u5668\u4e0a\u7684\u4e0d\u540c\u7f51\u7ad9\u3002</p> <p>Content-Length \u5b57\u6bb5</p> <p>\u670d\u52a1\u5668\u5728\u8fd4\u56de\u6570\u636e\u65f6\uff0c\u4f1a\u6709 <code>Content-Length</code> \u5b57\u6bb5\uff0c\u8868\u660e\u672c\u6b21\u56de\u5e94\u7684\u6570\u636e\u957f\u5ea6\u3002</p> <p></p> Text Only<pre><code>Content-Length: 1000\n</code></pre> <p>\u5982\u4e0a\u9762\u5219\u662f\u544a\u8bc9\u6d4f\u89c8\u5668\uff0c\u672c\u6b21\u670d\u52a1\u5668\u56de\u5e94\u7684\u6570\u636e\u957f\u5ea6\u662f 1000 \u4e2a\u5b57\u8282\uff0c\u540e\u9762\u7684\u5b57\u8282\u5c31\u5c5e\u4e8e\u4e0b\u4e00\u4e2a\u56de\u5e94\u4e86\u3002</p> <p>\u5927\u5bb6\u5e94\u8be5\u90fd\u77e5\u9053 HTTP \u662f\u57fa\u4e8e TCP \u4f20\u8f93\u534f\u8bae\u8fdb\u884c\u901a\u4fe1\u7684\uff0c\u800c\u4f7f\u7528\u4e86 TCP \u4f20\u8f93\u534f\u8bae\uff0c\u5c31\u4f1a\u5b58\u5728\u4e00\u4e2a\u201c\u7c98\u5305\u201d\u7684\u95ee\u9898\uff0cHTTP \u534f\u8bae\u901a\u8fc7\u8bbe\u7f6e\u56de\u8f66\u7b26\u3001\u6362\u884c\u7b26\u4f5c\u4e3a HTTP header \u7684\u8fb9\u754c\uff0c\u901a\u8fc7 Content-Length \u5b57\u6bb5\u4f5c\u4e3a HTTP body \u7684\u8fb9\u754c\uff0c\u8fd9\u4e24\u4e2a\u65b9\u5f0f\u90fd\u662f\u4e3a\u4e86\u89e3\u51b3\u201c\u7c98\u5305\u201d\u7684\u95ee\u9898\u3002\u5177\u4f53\u4ec0\u4e48\u662f TCP \u7c98\u5305\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1a\u5982\u4f55\u7406\u89e3\u662f TCP \u9762\u5411\u5b57\u8282\u6d41\u534f\u8bae\uff1f</p> <p>Connection \u5b57\u6bb5</p> <p><code>Connection</code> \u5b57\u6bb5\u6700\u5e38\u7528\u4e8e\u5ba2\u6237\u7aef\u8981\u6c42\u670d\u52a1\u5668\u4f7f\u7528\u300cHTTP \u957f\u8fde\u63a5\u300d\u673a\u5236\uff0c\u4ee5\u4fbf\u5176\u4ed6\u8bf7\u6c42\u590d\u7528\u3002</p> <p></p> <p>HTTP \u957f\u8fde\u63a5\u7684\u7279\u70b9\u662f\uff0c\u53ea\u8981\u4efb\u610f\u4e00\u7aef\u6ca1\u6709\u660e\u786e\u63d0\u51fa\u65ad\u5f00\u8fde\u63a5\uff0c\u5219\u4fdd\u6301 TCP \u8fde\u63a5\u72b6\u6001\u3002</p> <p></p> <p>HTTP/1.1 \u7248\u672c\u7684\u9ed8\u8ba4\u8fde\u63a5\u90fd\u662f\u957f\u8fde\u63a5\uff0c\u4f46\u4e3a\u4e86\u517c\u5bb9\u8001\u7248\u672c\u7684 HTTP\uff0c\u9700\u8981\u6307\u5b9a <code>Connection</code> \u9996\u90e8\u5b57\u6bb5\u7684\u503c\u4e3a <code>Keep-Alive</code>\u3002</p> Text Only<pre><code>Connection: Keep-Alive\n</code></pre> <p>\u5f00\u542f\u4e86 HTTP Keep-Alive \u673a\u5236\u540e\uff0c\u8fde\u63a5\u5c31\u4e0d\u4f1a\u4e2d\u65ad\uff0c\u800c\u662f\u4fdd\u6301\u8fde\u63a5\u3002\u5f53\u5ba2\u6237\u7aef\u53d1\u9001\u53e6\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u5b83\u4f1a\u4f7f\u7528\u540c\u4e00\u4e2a\u8fde\u63a5\uff0c\u4e00\u76f4\u6301\u7eed\u5230\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u7aef\u63d0\u51fa\u65ad\u5f00\u8fde\u63a5\u3002</p> <p>PS\uff1a\u5927\u5bb6\u4e0d\u8981\u628a HTTP  Keep-Alive \u548c TCP Keepalive \u641e\u6df7\u4e86\uff0c\u8fd9\u4e24\u4e2a\u867d\u7136\u957f\u7684\u50cf\uff0c\u4f46\u662f\u4e0d\u662f\u4e00\u4e2a\u4e1c\u897f\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1aTCP Keepalive \u548c HTTP Keep-Alive \u662f\u4e00\u4e2a\u4e1c\u897f\u5417\uff1f</p> <p>Content-Type \u5b57\u6bb5</p> <p><code>Content-Type</code> \u5b57\u6bb5\u7528\u4e8e\u670d\u52a1\u5668\u56de\u5e94\u65f6\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\uff0c\u672c\u6b21\u6570\u636e\u662f\u4ec0\u4e48\u683c\u5f0f\u3002</p> <p></p> Text Only<pre><code>Content-Type: text/html; Charset=utf-8\n</code></pre> <p>\u4e0a\u9762\u7684\u7c7b\u578b\u8868\u660e\uff0c\u53d1\u9001\u7684\u662f\u7f51\u9875\uff0c\u800c\u4e14\u7f16\u7801\u662f UTF-8\u3002</p> <p>\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u4f7f\u7528 <code>Accept</code> \u5b57\u6bb5\u58f0\u660e\u81ea\u5df1\u53ef\u4ee5\u63a5\u53d7\u54ea\u4e9b\u6570\u636e\u683c\u5f0f\u3002</p> Text Only<pre><code>Accept: */*\n</code></pre> <p>\u4e0a\u9762\u4ee3\u7801\u4e2d\uff0c\u5ba2\u6237\u7aef\u58f0\u660e\u81ea\u5df1\u53ef\u4ee5\u63a5\u53d7\u4efb\u4f55\u683c\u5f0f\u7684\u6570\u636e\u3002</p> <p>Content-Encoding \u5b57\u6bb5</p> <p><code>Content-Encoding</code> \u5b57\u6bb5\u8bf4\u660e\u6570\u636e\u7684\u538b\u7f29\u65b9\u6cd5\u3002\u8868\u793a\u670d\u52a1\u5668\u8fd4\u56de\u7684\u6570\u636e\u4f7f\u7528\u4e86\u4ec0\u4e48\u538b\u7f29\u683c\u5f0f</p> <p></p> Text Only<pre><code>Content-Encoding: gzip\n</code></pre> <p>\u4e0a\u9762\u8868\u793a\u670d\u52a1\u5668\u8fd4\u56de\u7684\u6570\u636e\u91c7\u7528\u4e86 gzip \u65b9\u5f0f\u538b\u7f29\uff0c\u544a\u77e5\u5ba2\u6237\u7aef\u9700\u8981\u7528\u6b64\u65b9\u5f0f\u89e3\u538b\u3002</p> <p>\u5ba2\u6237\u7aef\u5728\u8bf7\u6c42\u65f6\uff0c\u7528 <code>Accept-Encoding</code> \u5b57\u6bb5\u8bf4\u660e\u81ea\u5df1\u53ef\u4ee5\u63a5\u53d7\u54ea\u4e9b\u538b\u7f29\u65b9\u6cd5\u3002</p> Text Only<pre><code>Accept-Encoding: gzip, deflate\n</code></pre>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#get-post","title":"GET \u4e0e POST","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#get-post_1","title":"GET \u548c POST \u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u6839\u636e RFC \u89c4\u8303\uff0cGET \u7684\u8bed\u4e49\u662f\u4ece\u670d\u52a1\u5668\u83b7\u53d6\u6307\u5b9a\u7684\u8d44\u6e90\uff0c\u8fd9\u4e2a\u8d44\u6e90\u53ef\u4ee5\u662f\u9759\u6001\u7684\u6587\u672c\u3001\u9875\u9762\u3001\u56fe\u7247\u89c6\u9891\u7b49\u3002GET \u8bf7\u6c42\u7684\u53c2\u6570\u4f4d\u7f6e\u4e00\u822c\u662f\u5199\u5728 URL \u4e2d\uff0cURL \u89c4\u5b9a\u53ea\u80fd\u652f\u6301 ASCII\uff0c\u6240\u4ee5 GET \u8bf7\u6c42\u7684\u53c2\u6570\u53ea\u5141\u8bb8 ASCII \u5b57\u7b26\uff0c\u800c\u4e14\u6d4f\u89c8\u5668\u4f1a\u5bf9 URL \u7684\u957f\u5ea6\u6709\u9650\u5236\uff08HTTP \u534f\u8bae\u672c\u8eab\u5bf9 URL \u957f\u5ea6\u5e76\u6ca1\u6709\u505a\u4efb\u4f55\u89c4\u5b9a\uff09\u3002</p> <p>\u6bd4\u5982\uff0c\u4f60\u6253\u5f00\u6211\u7684\u6587\u7ae0\uff0c\u6d4f\u89c8\u5668\u5c31\u4f1a\u53d1\u9001 GET \u8bf7\u6c42\u7ed9\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u5c31\u4f1a\u8fd4\u56de\u6587\u7ae0\u7684\u6240\u6709\u6587\u5b57\u53ca\u8d44\u6e90\u3002</p> <p></p> <p>\u6839\u636e RFC \u89c4\u8303\uff0cPOST \u7684\u8bed\u4e49\u662f\u6839\u636e\u8bf7\u6c42\u8d1f\u8377\uff08\u62a5\u6587 body\uff09\u5bf9\u6307\u5b9a\u7684\u8d44\u6e90\u505a\u51fa\u5904\u7406\uff0c\u5177\u4f53\u7684\u5904\u7406\u65b9\u5f0f\u89c6\u8d44\u6e90\u7c7b\u578b\u800c\u4e0d\u540c\u3002POST \u8bf7\u6c42\u643a\u5e26\u6570\u636e\u7684\u4f4d\u7f6e\u4e00\u822c\u662f\u5199\u5728\u62a5\u6587 body \u4e2d\uff0cbody \u4e2d\u7684\u6570\u636e\u53ef\u4ee5\u662f\u4efb\u610f\u683c\u5f0f\u7684\u6570\u636e\uff0c\u53ea\u8981\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u534f\u5546\u597d\u5373\u53ef\uff0c\u800c\u4e14\u6d4f\u89c8\u5668\u4e0d\u4f1a\u5bf9 body \u5927\u5c0f\u505a\u9650\u5236\u3002</p> <p>\u6bd4\u5982\uff0c\u4f60\u5728\u6211\u6587\u7ae0\u5e95\u90e8\uff0c\u6572\u5165\u4e86\u7559\u8a00\u540e\u70b9\u51fb\u300c\u63d0\u4ea4\u300d\uff08\u6697\u793a\u4f60\u4eec\u7559\u8a00\uff09\uff0c\u6d4f\u89c8\u5668\u5c31\u4f1a\u6267\u884c\u4e00\u6b21 POST \u8bf7\u6c42\uff0c\u628a\u4f60\u7684\u7559\u8a00\u6587\u5b57\u653e\u8fdb\u4e86\u62a5\u6587 body \u91cc\uff0c\u7136\u540e\u62fc\u63a5\u597d POST \u8bf7\u6c42\u5934\uff0c\u901a\u8fc7 TCP \u534f\u8bae\u53d1\u9001\u7ed9\u670d\u52a1\u5668\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#get-post_2","title":"GET \u548c POST \u65b9\u6cd5\u90fd\u662f\u5b89\u5168\u548c\u5e42\u7b49\u7684\u5417\uff1f","text":"<p>\u5148\u8bf4\u660e\u4e0b\u5b89\u5168\u548c\u5e42\u7b49\u7684\u6982\u5ff5\uff1a</p> <ul> <li>\u5728 HTTP \u534f\u8bae\u91cc\uff0c\u6240\u8c13\u7684\u300c\u5b89\u5168\u300d\u662f\u6307\u8bf7\u6c42\u65b9\u6cd5\u4e0d\u4f1a\u300c\u7834\u574f\u300d\u670d\u52a1\u5668\u4e0a\u7684\u8d44\u6e90\u3002</li> <li>\u6240\u8c13\u7684\u300c\u5e42\u7b49\u300d\uff0c\u610f\u601d\u662f\u591a\u6b21\u6267\u884c\u76f8\u540c\u7684\u64cd\u4f5c\uff0c\u7ed3\u679c\u90fd\u662f\u300c\u76f8\u540c\u300d\u7684\u3002</li> </ul> <p>\u5982\u679c\u4ece RFC \u89c4\u8303\u5b9a\u4e49\u7684\u8bed\u4e49\u6765\u770b\uff1a </p> <ul> <li>GET \u65b9\u6cd5\u5c31\u662f\u5b89\u5168\u4e14\u5e42\u7b49\u7684\uff0c\u56e0\u4e3a\u5b83\u662f\u300c\u53ea\u8bfb\u300d\u64cd\u4f5c\uff0c\u65e0\u8bba\u64cd\u4f5c\u591a\u5c11\u6b21\uff0c\u670d\u52a1\u5668\u4e0a\u7684\u6570\u636e\u90fd\u662f\u5b89\u5168\u7684\uff0c\u4e14\u6bcf\u6b21\u7684\u7ed3\u679c\u90fd\u662f\u76f8\u540c\u7684\u3002\u6240\u4ee5\uff0c\u53ef\u4ee5\u5bf9 GET \u8bf7\u6c42\u7684\u6570\u636e\u505a\u7f13\u5b58\uff0c\u8fd9\u4e2a\u7f13\u5b58\u53ef\u4ee5\u505a\u5230\u6d4f\u89c8\u5668\u672c\u8eab\u4e0a\uff08\u5f7b\u5e95\u907f\u514d\u6d4f\u89c8\u5668\u53d1\u8bf7\u6c42\uff09\uff0c\u4e5f\u53ef\u4ee5\u505a\u5230\u4ee3\u7406\u4e0a\uff08\u5982 nginx\uff09\uff0c\u800c\u4e14\u5728\u6d4f\u89c8\u5668\u4e2d GET \u8bf7\u6c42\u53ef\u4ee5\u4fdd\u5b58\u4e3a\u4e66\u7b7e\u3002</li> <li>POST \u56e0\u4e3a\u662f\u300c\u65b0\u589e\u6216\u63d0\u4ea4\u6570\u636e\u300d\u7684\u64cd\u4f5c\uff0c\u4f1a\u4fee\u6539\u670d\u52a1\u5668\u4e0a\u7684\u8d44\u6e90\uff0c\u6240\u4ee5\u662f\u4e0d\u5b89\u5168\u7684\uff0c\u4e14\u591a\u6b21\u63d0\u4ea4\u6570\u636e\u5c31\u4f1a\u521b\u5efa\u591a\u4e2a\u8d44\u6e90\uff0c\u6240\u4ee5\u4e0d\u662f\u5e42\u7b49\u7684\u3002\u6240\u4ee5\uff0c\u6d4f\u89c8\u5668\u4e00\u822c\u4e0d\u4f1a\u7f13\u5b58 POST \u8bf7\u6c42\uff0c\u4e5f\u4e0d\u80fd\u628a POST \u8bf7\u6c42\u4fdd\u5b58\u4e3a\u4e66\u7b7e\u3002</li> </ul> <p>\u505a\u4e2a\u7b80\u8981\u7684\u5c0f\u7ed3\u3002</p> <p>GET \u7684\u8bed\u4e49\u662f\u8bf7\u6c42\u83b7\u53d6\u6307\u5b9a\u7684\u8d44\u6e90\u3002GET \u65b9\u6cd5\u662f\u5b89\u5168\u3001\u5e42\u7b49\u3001\u53ef\u88ab\u7f13\u5b58\u7684\u3002</p> <p>POST \u7684\u8bed\u4e49\u662f\u6839\u636e\u8bf7\u6c42\u8d1f\u8377\uff08\u62a5\u6587\u4e3b\u4f53\uff09\u5bf9\u6307\u5b9a\u7684\u8d44\u6e90\u505a\u51fa\u5904\u7406\uff0c\u5177\u4f53\u7684\u5904\u7406\u65b9\u5f0f\u89c6\u8d44\u6e90\u7c7b\u578b\u800c\u4e0d\u540c\u3002POST \u4e0d\u5b89\u5168\uff0c\u4e0d\u5e42\u7b49\uff0c\uff08\u5927\u90e8\u5206\u5b9e\u73b0\uff09\u4e0d\u53ef\u7f13\u5b58\u3002</p> <p>\u6ce8\u610f\uff0c\u4e0a\u9762\u662f\u4ece RFC \u89c4\u8303\u5b9a\u4e49\u7684\u8bed\u4e49\u6765\u5206\u6790\u7684\u3002</p> <p>\u4f46\u662f\u5b9e\u9645\u8fc7\u7a0b\u4e2d\uff0c\u5f00\u53d1\u8005\u4e0d\u4e00\u5b9a\u4f1a\u6309\u7167 RFC \u89c4\u8303\u5b9a\u4e49\u7684\u8bed\u4e49\u6765\u5b9e\u73b0 GET \u548c POST \u65b9\u6cd5\u3002\u6bd4\u5982\uff1a</p> <ul> <li>\u53ef\u4ee5\u7528 GET \u65b9\u6cd5\u5b9e\u73b0\u65b0\u589e\u6216\u5220\u9664\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u8fd9\u6837\u5b9e\u73b0\u7684 GET \u65b9\u6cd5\u81ea\u7136\u5c31\u4e0d\u662f\u5b89\u5168\u548c\u5e42\u7b49\u3002</li> <li>\u53ef\u4ee5\u7528 POST \u65b9\u6cd5\u5b9e\u73b0\u67e5\u8be2\u6570\u636e\u7684\u8bf7\u6c42\uff0c\u8fd9\u6837\u5b9e\u73b0\u7684  POST \u65b9\u6cd5\u81ea\u7136\u5c31\u662f\u5b89\u5168\u548c\u5e42\u7b49\u3002</li> </ul> <p>\u66fe\u7ecf\u6709\u4e2a\u7b11\u8bdd\uff0c\u6709\u4eba\u5199\u4e86\u4e2a\u535a\u5ba2\uff0c\u5220\u9664\u535a\u5ba2\u7528\u7684\u662f GET \u8bf7\u6c42\uff0c\u4ed6\u89c9\u5f97\u6ca1\u4eba\u8bbf\u95ee\u5c31\u8fde\u9274\u6743\u90fd\u6ca1\u505a\u3002\u7136\u540e Google \u670d\u52a1\u5668\u722c\u866b\u722c\u4e86\u4e00\u904d\uff0c\u4ed6\u6240\u6709\u535a\u6587\u5c31\u6ca1\u4e86\u3002\u3002\u3002</p> <p>\u5982\u679c\u300c\u5b89\u5168\u300d\u653e\u5165\u6982\u5ff5\u662f\u6307\u4fe1\u606f\u662f\u5426\u4f1a\u88ab\u6cc4\u6f0f\u7684\u8bdd\uff0c\u867d\u7136 POST \u7528 body \u4f20\u8f93\u6570\u636e\uff0c\u800c GET \u7528 URL \u4f20\u8f93\uff0c\u8fd9\u6837\u6570\u636e\u4f1a\u5728\u6d4f\u89c8\u5668\u5730\u5740\u680f\u5bb9\u6613\u770b\u5230\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u8bf4 GET \u4e0d\u5982 POST \u5b89\u5168\u7684\u3002</p> <p>\u56e0\u4e3a HTTP \u4f20\u8f93\u7684\u5185\u5bb9\u90fd\u662f\u660e\u6587\u7684\uff0c\u867d\u7136\u5728\u6d4f\u89c8\u5668\u5730\u5740\u680f\u770b\u4e0d\u5230 POST \u63d0\u4ea4\u7684 body \u6570\u636e\uff0c\u4f46\u662f\u53ea\u8981\u6293\u4e2a\u5305\u5c31\u90fd\u80fd\u770b\u5230\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u8981\u907f\u514d\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u6570\u636e\u88ab\u7a83\u53d6\uff0c\u5c31\u8981\u4f7f\u7528 HTTPS \u534f\u8bae\uff0c\u8fd9\u6837\u6240\u6709 HTTP \u7684\u6570\u636e\u90fd\u4f1a\u88ab\u52a0\u5bc6\u4f20\u8f93\u3002</p> <p>GET \u8bf7\u6c42\u53ef\u4ee5\u5e26 body \u5417\uff1f</p> <p>RFC \u89c4\u8303\u5e76\u6ca1\u6709\u89c4\u5b9a GET \u8bf7\u6c42\u4e0d\u80fd\u5e26 body \u7684\u3002\u7406\u8bba\u4e0a\uff0c\u4efb\u4f55\u8bf7\u6c42\u90fd\u53ef\u4ee5\u5e26 body \u7684\u3002\u53ea\u662f\u56e0\u4e3a RFC \u89c4\u8303\u5b9a\u4e49\u7684 GET \u8bf7\u6c42\u662f\u83b7\u53d6\u8d44\u6e90\uff0c\u6240\u4ee5\u6839\u636e\u8fd9\u4e2a\u8bed\u4e49\u4e0d\u9700\u8981\u7528\u5230 body\u3002</p> <p>\u53e6\u5916\uff0cURL \u4e2d\u7684\u67e5\u8be2\u53c2\u6570\u4e5f\u4e0d\u662f GET \u6240\u72ec\u6709\u7684\uff0cPOST \u8bf7\u6c42\u7684 URL \u4e2d\u4e5f\u53ef\u4ee5\u6709\u53c2\u6570\u7684\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http_4","title":"HTTP \u7f13\u5b58\u6280\u672f","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http_5","title":"HTTP \u7f13\u5b58\u6709\u54ea\u4e9b\u5b9e\u73b0\u65b9\u5f0f\uff1f","text":"<p>\u5bf9\u4e8e\u4e00\u4e9b\u5177\u6709\u91cd\u590d\u6027\u7684 HTTP \u8bf7\u6c42\uff0c\u6bd4\u5982\u6bcf\u6b21\u8bf7\u6c42\u5f97\u5230\u7684\u6570\u636e\u90fd\u4e00\u6837\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u5bf9\u300c\u8bf7\u6c42 - \u54cd\u5e94\u300d\u7684\u6570\u636e\u90fd\u7f13\u5b58\u5728\u672c\u5730\uff0c\u90a3\u4e48\u4e0b\u6b21\u5c31\u76f4\u63a5\u8bfb\u53d6\u672c\u5730\u7684\u6570\u636e\uff0c\u4e0d\u5fc5\u5728\u901a\u8fc7\u7f51\u7edc\u83b7\u53d6\u670d\u52a1\u5668\u7684\u54cd\u5e94\u4e86\uff0c\u8fd9\u6837\u7684\u8bdd HTTP/1.1 \u7684\u6027\u80fd\u80af\u5b9a\u8089\u773c\u53ef\u89c1\u7684\u63d0\u5347\u3002</p> <p>\u6240\u4ee5\uff0c\u907f\u514d\u53d1\u9001 HTTP \u8bf7\u6c42\u7684\u65b9\u6cd5\u5c31\u662f\u901a\u8fc7\u7f13\u5b58\u6280\u672f\uff0cHTTP \u8bbe\u8ba1\u8005\u65e9\u5728\u4e4b\u524d\u5c31\u8003\u8651\u5230\u4e86\u8fd9\u70b9\uff0c\u56e0\u6b64 HTTP \u534f\u8bae\u7684\u5934\u90e8\u6709\u4e0d\u5c11\u662f\u9488\u5bf9\u7f13\u5b58\u7684\u5b57\u6bb5\u3002</p> <p>HTTP \u7f13\u5b58\u6709\u4e24\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u5206\u522b\u662f\u5f3a\u5236\u7f13\u5b58\u548c\u534f\u5546\u7f13\u5b58\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#_1","title":"\u4ec0\u4e48\u662f\u5f3a\u5236\u7f13\u5b58\uff1f","text":"<p>\u5f3a\u7f13\u5b58\u6307\u7684\u662f\u53ea\u8981\u6d4f\u89c8\u5668\u5224\u65ad\u7f13\u5b58\u6ca1\u6709\u8fc7\u671f\uff0c\u5219\u76f4\u63a5\u4f7f\u7528\u6d4f\u89c8\u5668\u7684\u672c\u5730\u7f13\u5b58\uff0c\u51b3\u5b9a\u662f\u5426\u4f7f\u7528\u7f13\u5b58\u7684\u4e3b\u52a8\u6027\u5728\u4e8e\u6d4f\u89c8\u5668\u8fd9\u8fb9\u3002</p> <p>\u5982\u4e0b\u56fe\u4e2d\uff0c\u8fd4\u56de\u7684\u662f 200 \u72b6\u6001\u7801\uff0c\u4f46\u5728 size \u9879\u4e2d\u6807\u8bc6\u7684\u662f from disk cache\uff0c\u5c31\u662f\u4f7f\u7528\u4e86\u5f3a\u5236\u7f13\u5b58\u3002</p> <p></p> <p>\u5f3a\u7f13\u5b58\u662f\u5229\u7528\u4e0b\u9762\u8fd9\u4e24\u4e2a HTTP \u54cd\u5e94\u5934\u90e8\uff08Response Header\uff09\u5b57\u6bb5\u5b9e\u73b0\u7684\uff0c\u5b83\u4eec\u90fd\u7528\u6765\u8868\u793a\u8d44\u6e90\u5728\u5ba2\u6237\u7aef\u7f13\u5b58\u7684\u6709\u6548\u671f\uff1a</p> <ul> <li><code>Cache-Control</code>\uff0c\u662f\u4e00\u4e2a\u76f8\u5bf9\u65f6\u95f4\uff1b</li> <li><code>Expires</code>\uff0c\u662f\u4e00\u4e2a\u7edd\u5bf9\u65f6\u95f4\uff1b</li> </ul> <p>\u5982\u679c HTTP \u54cd\u5e94\u5934\u90e8\u540c\u65f6\u6709 Cache-Control \u548c Expires \u5b57\u6bb5\u7684\u8bdd\uff0cCache-Control \u7684\u4f18\u5148\u7ea7\u9ad8\u4e8e Expires \u3002</p> <p>Cache-control \u9009\u9879\u66f4\u591a\u4e00\u4e9b\uff0c\u8bbe\u7f6e\u66f4\u52a0\u7cbe\u7ec6\uff0c\u6240\u4ee5\u5efa\u8bae\u4f7f\u7528 Cache-Control \u6765\u5b9e\u73b0\u5f3a\u7f13\u5b58\u3002\u5177\u4f53\u7684\u5b9e\u73b0\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5f53\u6d4f\u89c8\u5668\u7b2c\u4e00\u6b21\u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1\u5668\u8d44\u6e90\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u5728\u8fd4\u56de\u8fd9\u4e2a\u8d44\u6e90\u7684\u540c\u65f6\uff0c\u5728 Response \u5934\u90e8\u52a0\u4e0a Cache-Control\uff0cCache-Control \u4e2d\u8bbe\u7f6e\u4e86\u8fc7\u671f\u65f6\u95f4\u5927\u5c0f\uff1b</li> <li>\u6d4f\u89c8\u5668\u518d\u6b21\u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1\u5668\u4e2d\u7684\u8be5\u8d44\u6e90\u65f6\uff0c\u4f1a\u5148\u901a\u8fc7\u8bf7\u6c42\u8d44\u6e90\u7684\u65f6\u95f4\u4e0e Cache-Control \u4e2d\u8bbe\u7f6e\u7684\u8fc7\u671f\u65f6\u95f4\u5927\u5c0f\uff0c\u6765\u8ba1\u7b97\u51fa\u8be5\u8d44\u6e90\u662f\u5426\u8fc7\u671f\uff0c\u5982\u679c\u6ca1\u6709\uff0c\u5219\u4f7f\u7528\u8be5\u7f13\u5b58\uff0c\u5426\u5219\u91cd\u65b0\u8bf7\u6c42\u670d\u52a1\u5668\uff1b</li> <li>\u670d\u52a1\u5668\u518d\u6b21\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4f1a\u518d\u6b21\u66f4\u65b0 Response \u5934\u90e8\u7684 Cache-Control\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#_2","title":"\u4ec0\u4e48\u662f\u534f\u5546\u7f13\u5b58\uff1f","text":"<p>\u5f53\u6211\u4eec\u5728\u6d4f\u89c8\u5668\u4f7f\u7528\u5f00\u53d1\u8005\u5de5\u5177\u7684\u65f6\u5019\uff0c\u4f60\u53ef\u80fd\u4f1a\u770b\u5230\u8fc7\u67d0\u4e9b\u8bf7\u6c42\u7684\u54cd\u5e94\u7801\u662f <code>304</code>\uff0c\u8fd9\u4e2a\u662f\u544a\u8bc9\u6d4f\u89c8\u5668\u53ef\u4ee5\u4f7f\u7528\u672c\u5730\u7f13\u5b58\u7684\u8d44\u6e90\uff0c\u901a\u5e38\u8fd9\u79cd\u901a\u8fc7\u670d\u52a1\u7aef\u544a\u77e5\u5ba2\u6237\u7aef\u662f\u5426\u53ef\u4ee5\u4f7f\u7528\u7f13\u5b58\u7684\u65b9\u5f0f\u88ab\u79f0\u4e3a\u534f\u5546\u7f13\u5b58\u3002</p> <p></p> <p>\u4e0a\u56fe\u5c31\u662f\u4e00\u4e2a\u534f\u5546\u7f13\u5b58\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u534f\u5546\u7f13\u5b58\u5c31\u662f\u4e0e\u670d\u52a1\u7aef\u534f\u5546\u4e4b\u540e\uff0c\u901a\u8fc7\u534f\u5546\u7ed3\u679c\u6765\u5224\u65ad\u662f\u5426\u4f7f\u7528\u672c\u5730\u7f13\u5b58\u3002</p> <p>\u534f\u5546\u7f13\u5b58\u53ef\u4ee5\u57fa\u4e8e\u4e24\u79cd\u5934\u90e8\u6765\u5b9e\u73b0\u3002</p> <p>\u7b2c\u4e00\u79cd\uff1a\u8bf7\u6c42\u5934\u90e8\u4e2d\u7684 <code>If-Modified-Since</code> \u5b57\u6bb5\u4e0e\u54cd\u5e94\u5934\u90e8\u4e2d\u7684 <code>Last-Modified</code> \u5b57\u6bb5\u5b9e\u73b0\uff0c\u8fd9\u4e24\u4e2a\u5b57\u6bb5\u7684\u610f\u601d\u662f\uff1a</p> <ul> <li>\u54cd\u5e94\u5934\u90e8\u4e2d\u7684 <code>Last-Modified</code>\uff1a\u6807\u793a\u8fd9\u4e2a\u54cd\u5e94\u8d44\u6e90\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\uff1b</li> <li>\u8bf7\u6c42\u5934\u90e8\u4e2d\u7684 <code>If-Modified-Since</code>\uff1a\u5f53\u8d44\u6e90\u8fc7\u671f\u4e86\uff0c\u53d1\u73b0\u54cd\u5e94\u5934\u4e2d\u5177\u6709 Last-Modified \u58f0\u660e\uff0c\u5219\u518d\u6b21\u53d1\u8d77\u8bf7\u6c42\u7684\u65f6\u5019\u5e26\u4e0a Last-Modified \u7684\u65f6\u95f4\uff0c\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\u53d1\u73b0\u6709 If-Modified-Since \u5219\u4e0e\u88ab\u8bf7\u6c42\u8d44\u6e90\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u8fdb\u884c\u5bf9\u6bd4\uff08Last-Modified\uff09\uff0c\u5982\u679c\u6700\u540e\u4fee\u6539\u65f6\u95f4\u8f83\u65b0\uff08\u5927\uff09\uff0c\u8bf4\u660e\u8d44\u6e90\u53c8\u88ab\u6539\u8fc7\uff0c\u5219\u8fd4\u56de\u6700\u65b0\u8d44\u6e90\uff0cHTTP 200 OK\uff1b\u5982\u679c\u6700\u540e\u4fee\u6539\u65f6\u95f4\u8f83\u65e7\uff08\u5c0f\uff09\uff0c\u8bf4\u660e\u8d44\u6e90\u65e0\u65b0\u4fee\u6539\uff0c\u54cd\u5e94 HTTP 304 \u8d70\u7f13\u5b58\u3002</li> </ul> <p>\u7b2c\u4e8c\u79cd\uff1a\u8bf7\u6c42\u5934\u90e8\u4e2d\u7684 <code>If-None-Match</code> \u5b57\u6bb5\u4e0e\u54cd\u5e94\u5934\u90e8\u4e2d\u7684 <code>ETag</code> \u5b57\u6bb5\uff0c\u8fd9\u4e24\u4e2a\u5b57\u6bb5\u7684\u610f\u601d\u662f\uff1a   - \u54cd\u5e94\u5934\u90e8\u4e2d <code>Etag</code>\uff1a\u552f\u4e00\u6807\u8bc6\u54cd\u5e94\u8d44\u6e90\uff1b   - \u8bf7\u6c42\u5934\u90e8\u4e2d\u7684 <code>If-None-Match</code>\uff1a\u5f53\u8d44\u6e90\u8fc7\u671f\u65f6\uff0c\u6d4f\u89c8\u5668\u53d1\u73b0\u54cd\u5e94\u5934\u91cc\u6709 Etag\uff0c\u5219\u518d\u6b21\u5411\u670d\u52a1\u5668\u53d1\u8d77\u8bf7\u6c42\u65f6\uff0c\u4f1a\u5c06\u8bf7\u6c42\u5934 If-None-Match \u503c\u8bbe\u7f6e\u4e3a Etag \u7684\u503c\u3002\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\u8fdb\u884c\u6bd4\u5bf9\uff0c\u5982\u679c\u8d44\u6e90\u6ca1\u6709\u53d8\u5316\u8fd4\u56de 304\uff0c\u5982\u679c\u8d44\u6e90\u53d8\u5316\u4e86\u8fd4\u56de 200\u3002</p> <p>\u7b2c\u4e00\u79cd\u5b9e\u73b0\u65b9\u5f0f\u662f\u57fa\u4e8e\u65f6\u95f4\u5b9e\u73b0\u7684\uff0c\u7b2c\u4e8c\u79cd\u5b9e\u73b0\u65b9\u5f0f\u662f\u57fa\u4e8e\u4e00\u4e2a\u552f\u4e00\u6807\u8bc6\u5b9e\u73b0\u7684\uff0c\u76f8\u5bf9\u6765\u8bf4\u540e\u8005\u53ef\u4ee5\u66f4\u52a0\u51c6\u786e\u5730\u5224\u65ad\u6587\u4ef6\u5185\u5bb9\u662f\u5426\u88ab\u4fee\u6539\uff0c\u907f\u514d\u7531\u4e8e\u65f6\u95f4\u7be1\u6539\u5bfc\u81f4\u7684\u4e0d\u53ef\u9760\u95ee\u9898\u3002</p> <p>\u5982\u679c\u5728\u7b2c\u4e00\u6b21\u8bf7\u6c42\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u8fd4\u56de\u7684 HTTP \u54cd\u5e94\u5934\u90e8\u540c\u65f6\u6709 Etag \u548c Last-Modified \u5b57\u6bb5\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u518d\u4e0b\u4e00\u6b21\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5982\u679c\u5e26\u4e0a\u4e86 ETag \u548c Last-Modified \u5b57\u6bb5\u4fe1\u606f\u7ed9\u670d\u52a1\u7aef\uff0c\u8fd9\u65f6 Etag \u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u7aef\u5148\u4f1a\u5224\u65ad Etag \u662f\u5426\u53d8\u5316\u4e86\uff0c\u5982\u679c Etag \u6709\u53d8\u5316\u5c31\u4e0d\u7528\u5728\u5224\u65ad Last-Modified \u4e86\uff0c\u5982\u679c Etag \u6ca1\u6709\u53d8\u5316\uff0c\u7136\u540e\u518d\u770b  Last-Modified\u3002</p> <p>\u4e3a\u4ec0\u4e48 ETag \u7684\u4f18\u5148\u7ea7\u66f4\u9ad8\uff1f \u8fd9\u662f\u56e0\u4e3a ETag \u4e3b\u8981\u80fd\u89e3\u51b3 Last-Modified \u51e0\u4e2a\u6bd4\u8f83\u96be\u4ee5\u89e3\u51b3\u7684\u95ee\u9898\uff1a</p> <ol> <li>\u5728\u6ca1\u6709\u4fee\u6539\u6587\u4ef6\u5185\u5bb9\u60c5\u51b5\u4e0b\u6587\u4ef6\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u53ef\u80fd\u4e5f\u4f1a\u6539\u53d8\uff0c\u8fd9\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u8ba4\u4e3a\u8fd9\u6587\u4ef6\u88ab\u6539\u52a8\u4e86\uff0c\u4ece\u800c\u91cd\u65b0\u8bf7\u6c42\uff1b</li> <li>\u53ef\u80fd\u6709\u4e9b\u6587\u4ef6\u662f\u5728\u79d2\u7ea7\u4ee5\u5185\u4fee\u6539\u7684\uff0c<code>If-Modified-Since</code> \u80fd\u68c0\u67e5\u5230\u7684\u7c92\u5ea6\u662f\u79d2\u7ea7\u7684\uff0c\u4f7f\u7528 Etag \u5c31\u80fd\u591f\u4fdd\u8bc1\u8fd9\u79cd\u9700\u6c42\u4e0b\u5ba2\u6237\u7aef\u5728 1 \u79d2\u5185\u80fd\u5237\u65b0\u591a\u6b21\uff1b</li> <li>\u6709\u4e9b\u670d\u52a1\u5668\u4e0d\u80fd\u7cbe\u786e\u83b7\u53d6\u6587\u4ef6\u7684\u6700\u540e\u4fee\u6539\u65f6\u95f4\u3002</li> </ol> <p>\u6ce8\u610f\uff0c\u534f\u5546\u7f13\u5b58\u8fd9\u4e24\u4e2a\u5b57\u6bb5\u90fd\u9700\u8981\u914d\u5408\u5f3a\u5236\u7f13\u5b58\u4e2d Cache-Control \u5b57\u6bb5\u6765\u4f7f\u7528\uff0c\u53ea\u6709\u5728\u672a\u80fd\u547d\u4e2d\u5f3a\u5236\u7f13\u5b58\u7684\u65f6\u5019\uff0c\u624d\u80fd\u53d1\u8d77\u5e26\u6709\u534f\u5546\u7f13\u5b58\u5b57\u6bb5\u7684\u8bf7\u6c42\u3002</p> <p>\u4e0b\u56fe\u662f\u5f3a\u5236\u7f13\u5b58\u548c\u534f\u5546\u7f13\u5b58\u7684\u5de5\u4f5c\u6d41\u7a0b\uff1a</p> <p></p> <p>\u5f53\u4f7f\u7528 ETag \u5b57\u6bb5\u5b9e\u73b0\u7684\u534f\u5546\u7f13\u5b58\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u6d4f\u89c8\u5668\u7b2c\u4e00\u6b21\u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1\u5668\u8d44\u6e90\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u5728\u8fd4\u56de\u8fd9\u4e2a\u8d44\u6e90\u7684\u540c\u65f6\uff0c\u5728 Response \u5934\u90e8\u52a0\u4e0a ETag \u552f\u4e00\u6807\u8bc6\uff0c\u8fd9\u4e2a\u552f\u4e00\u6807\u8bc6\u7684\u503c\u662f\u6839\u636e\u5f53\u524d\u8bf7\u6c42\u7684\u8d44\u6e90\u751f\u6210\u7684\uff1b</li> <li>\u5f53\u6d4f\u89c8\u5668\u518d\u6b21\u8bf7\u6c42\u8bbf\u95ee\u670d\u52a1\u5668\u4e2d\u7684\u8be5\u8d44\u6e90\u65f6\uff0c\u9996\u5148\u4f1a\u5148\u68c0\u67e5\u5f3a\u5236\u7f13\u5b58\u662f\u5426\u8fc7\u671f\uff1a</li> <li>\u5982\u679c\u6ca1\u6709\u8fc7\u671f\uff0c\u5219\u76f4\u63a5\u4f7f\u7528\u672c\u5730\u7f13\u5b58\uff1b</li> <li>\u5982\u679c\u7f13\u5b58\u8fc7\u671f\u4e86\uff0c\u4f1a\u5728 Request \u5934\u90e8\u52a0\u4e0a If-None-Match \u5b57\u6bb5\uff0c\u8be5\u5b57\u6bb5\u7684\u503c\u5c31\u662f ETag \u552f\u4e00\u6807\u8bc6\uff1b</li> <li>\u670d\u52a1\u5668\u518d\u6b21\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4f1a\u6839\u636e\u8bf7\u6c42\u4e2d\u7684 If-None-Match \u503c\u4e0e\u5f53\u524d\u8bf7\u6c42\u7684\u8d44\u6e90\u751f\u6210\u7684\u552f\u4e00\u6807\u8bc6\u8fdb\u884c\u6bd4\u8f83\uff1a</li> <li>\u5982\u679c\u503c\u76f8\u7b49\uff0c\u5219\u8fd4\u56de 304 Not Modified\uff0c\u4e0d\u4f1a\u8fd4\u56de\u8d44\u6e90\uff1b</li> <li>\u5982\u679c\u4e0d\u76f8\u7b49\uff0c\u5219\u8fd4\u56de 200 \u72b6\u6001\u7801\u548c\u8fd4\u56de\u8d44\u6e90\uff0c\u5e76\u5728 Response \u5934\u90e8\u52a0\u4e0a\u65b0\u7684 ETag \u552f\u4e00\u6807\u8bc6\uff1b</li> <li>\u5982\u679c\u6d4f\u89c8\u5668\u6536\u5230 304 \u7684\u8bf7\u6c42\u54cd\u5e94\u72b6\u6001\u7801\uff0c\u5219\u4f1a\u4ece\u672c\u5730\u7f13\u5b58\u4e2d\u52a0\u8f7d\u8d44\u6e90\uff0c\u5426\u5219\u66f4\u65b0\u8d44\u6e90\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http_6","title":"HTTP \u7279\u6027","text":"<p>\u5230\u76ee\u524d\u4e3a\u6b62\uff0cHTTP \u5e38\u89c1\u5230\u7248\u672c\u6709 HTTP/1.1\uff0cHTTP/2.0\uff0cHTTP/3.0\uff0c\u4e0d\u540c\u7248\u672c\u7684 HTTP \u7279\u6027\u662f\u4e0d\u4e00\u6837\u7684\u3002</p> <p>\u8fd9\u91cc\u5148\u7528  HTTP/1.1 \u7248\u672c\u7ed9\u5927\u5bb6\u4ecb\u7ecd\uff0c\u5176\u4ed6\u7248\u672c\u7684\u540e\u7eed\u4e5f\u4f1a\u4ecb\u7ecd\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http11","title":"HTTP/1.1 \u7684\u4f18\u70b9\u6709\u54ea\u4e9b\uff1f","text":"<p>HTTP \u6700\u7a81\u51fa\u7684\u4f18\u70b9\u662f\u300c\u7b80\u5355\u3001\u7075\u6d3b\u548c\u6613\u4e8e\u6269\u5c55\u3001\u5e94\u7528\u5e7f\u6cdb\u548c\u8de8\u5e73\u53f0\u300d\u3002</p> <p>1. \u7b80\u5355</p> <p>HTTP \u57fa\u672c\u7684\u62a5\u6587\u683c\u5f0f\u5c31\u662f <code>header + body</code>\uff0c\u5934\u90e8\u4fe1\u606f\u4e5f\u662f <code>key-value</code> \u7b80\u5355\u6587\u672c\u7684\u5f62\u5f0f\uff0c\u6613\u4e8e\u7406\u89e3\uff0c\u964d\u4f4e\u4e86\u5b66\u4e60\u548c\u4f7f\u7528\u7684\u95e8\u69db\u3002</p> <p>2. \u7075\u6d3b\u548c\u6613\u4e8e\u6269\u5c55</p> <p>HTTP \u534f\u8bae\u91cc\u7684\u5404\u7c7b\u8bf7\u6c42\u65b9\u6cd5\u3001URI/URL\u3001\u72b6\u6001\u7801\u3001\u5934\u5b57\u6bb5\u7b49\u6bcf\u4e2a\u7ec4\u6210\u8981\u6c42\u90fd\u6ca1\u6709\u88ab\u56fa\u5b9a\u6b7b\uff0c\u90fd\u5141\u8bb8\u5f00\u53d1\u4eba\u5458\u81ea\u5b9a\u4e49\u548c\u6269\u5145\u3002</p> <p>\u540c\u65f6 HTTP \u7531\u4e8e\u662f\u5de5\u4f5c\u5728\u5e94\u7528\u5c42\uff08 <code>OSI</code> \u7b2c\u4e03\u5c42\uff09\uff0c\u5219\u5b83\u4e0b\u5c42\u53ef\u4ee5\u968f\u610f\u53d8\u5316\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>HTTPS \u5c31\u662f\u5728 HTTP \u4e0e TCP \u5c42\u4e4b\u95f4\u589e\u52a0\u4e86 SSL/TLS \u5b89\u5168\u4f20\u8f93\u5c42\uff1b</li> <li>HTTP/1.1 \u548c HTTP/2.0 \u4f20\u8f93\u534f\u8bae\u4f7f\u7528\u7684\u662f TCP \u534f\u8bae\uff0c\u800c\u5230\u4e86 HTTP/3.0 \u4f20\u8f93\u534f\u8bae\u6539\u7528\u4e86 UDP \u534f\u8bae\u3002</li> </ul> <p>3. \u5e94\u7528\u5e7f\u6cdb\u548c\u8de8\u5e73\u53f0</p> <p>\u4e92\u8054\u7f51\u53d1\u5c55\u81f3\u4eca\uff0cHTTP \u7684\u5e94\u7528\u8303\u56f4\u975e\u5e38\u7684\u5e7f\u6cdb\uff0c\u4ece\u53f0\u5f0f\u673a\u7684\u6d4f\u89c8\u5668\u5230\u624b\u673a\u4e0a\u7684\u5404\u79cd APP\uff0c\u4ece\u770b\u65b0\u95fb\u3001\u5237\u8d34\u5427\u5230\u8d2d\u7269\u3001\u7406\u8d22\u3001\u5403\u9e21\uff0cHTTP \u7684\u5e94\u7528\u904d\u5730\u5f00\u82b1\uff0c\u540c\u65f6\u5929\u7136\u5177\u6709\u8de8\u5e73\u53f0\u7684\u4f18\u8d8a\u6027\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http11_1","title":"HTTP/1.1 \u7684\u7f3a\u70b9\u6709\u54ea\u4e9b\uff1f","text":"<p>HTTP \u534f\u8bae\u91cc\u6709\u4f18\u7f3a\u70b9\u4e00\u4f53\u7684\u53cc\u5203\u5251\uff0c\u5206\u522b\u662f\u300c\u65e0\u72b6\u6001\u3001\u660e\u6587\u4f20\u8f93\u300d\uff0c\u540c\u65f6\u8fd8\u6709\u4e00\u5927\u7f3a\u70b9\u300c\u4e0d\u5b89\u5168\u300d\u3002</p> <p>1. \u65e0\u72b6\u6001\u53cc\u5203\u5251</p> <p>\u65e0\u72b6\u6001\u7684\u597d\u5904\uff0c\u56e0\u4e3a\u670d\u52a1\u5668\u4e0d\u4f1a\u53bb\u8bb0\u5fc6 HTTP \u7684\u72b6\u6001\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u989d\u5916\u7684\u8d44\u6e90\u6765\u8bb0\u5f55\u72b6\u6001\u4fe1\u606f\uff0c\u8fd9\u80fd\u51cf\u8f7b\u670d\u52a1\u5668\u7684\u8d1f\u62c5\uff0c\u80fd\u591f\u628a\u66f4\u591a\u7684 CPU \u548c\u5185\u5b58\u7528\u6765\u5bf9\u5916\u63d0\u4f9b\u670d\u52a1\u3002</p> <p>\u65e0\u72b6\u6001\u7684\u574f\u5904\uff0c\u65e2\u7136\u670d\u52a1\u5668\u6ca1\u6709\u8bb0\u5fc6\u80fd\u529b\uff0c\u5b83\u5728\u5b8c\u6210\u6709\u5173\u8054\u6027\u7684\u64cd\u4f5c\u65f6\u4f1a\u975e\u5e38\u9ebb\u70e6\u3002</p> <p>\u4f8b\u5982\u767b\u5f55-&gt;\u6dfb\u52a0\u8d2d\u7269\u8f66-&gt;\u4e0b\u5355-&gt;\u7ed3\u7b97-&gt;\u652f\u4ed8\uff0c\u8fd9\u7cfb\u5217\u64cd\u4f5c\u90fd\u8981\u77e5\u9053\u7528\u6237\u7684\u8eab\u4efd\u624d\u884c\u3002\u4f46\u670d\u52a1\u5668\u4e0d\u77e5\u9053\u8fd9\u4e9b\u8bf7\u6c42\u662f\u6709\u5173\u8054\u7684\uff0c\u6bcf\u6b21\u90fd\u8981\u95ee\u4e00\u904d\u8eab\u4efd\u4fe1\u606f\u3002</p> <p>\u8fd9\u6837\u6bcf\u64cd\u4f5c\u4e00\u6b21\uff0c\u90fd\u8981\u9a8c\u8bc1\u4fe1\u606f\uff0c\u8fd9\u6837\u7684\u8d2d\u7269\u4f53\u9a8c\u8fd8\u80fd\u6109\u5feb\u5417\uff1f\u522b\u95ee\uff0c\u95ee\u5c31\u662f\u9178\u723d\uff01</p> <p>\u5bf9\u4e8e\u65e0\u72b6\u6001\u7684\u95ee\u9898\uff0c\u89e3\u6cd5\u65b9\u6848\u6709\u5f88\u591a\u79cd\uff0c\u5176\u4e2d\u6bd4\u8f83\u7b80\u5355\u7684\u65b9\u5f0f\u7528 Cookie \u6280\u672f\u3002</p> <p><code>Cookie</code> \u901a\u8fc7\u5728\u8bf7\u6c42\u548c\u54cd\u5e94\u62a5\u6587\u4e2d\u5199\u5165 Cookie \u4fe1\u606f\u6765\u63a7\u5236\u5ba2\u6237\u7aef\u7684\u72b6\u6001\u3002</p> <p>\u76f8\u5f53\u4e8e\uff0c\u5728\u5ba2\u6237\u7aef\u7b2c\u4e00\u6b21\u8bf7\u6c42\u540e\uff0c\u670d\u52a1\u5668\u4f1a\u4e0b\u53d1\u4e00\u4e2a\u88c5\u6709\u5ba2\u6237\u4fe1\u606f\u7684\u300c\u5c0f\u8d34\u7eb8\u300d\uff0c\u540e\u7eed\u5ba2\u6237\u7aef\u8bf7\u6c42\u670d\u52a1\u5668\u7684\u65f6\u5019\uff0c\u5e26\u4e0a\u300c\u5c0f\u8d34\u7eb8\u300d\uff0c\u670d\u52a1\u5668\u5c31\u80fd\u8ba4\u5f97\u4e86\u4e86\uff0c</p> <p></p> <p>2. \u660e\u6587\u4f20\u8f93\u53cc\u5203\u5251</p> <p>\u660e\u6587\u610f\u5473\u7740\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u7684\u4fe1\u606f\uff0c\u662f\u53ef\u65b9\u4fbf\u9605\u8bfb\u7684\uff0c\u6bd4\u5982 Wireshark \u6293\u5305\u90fd\u53ef\u4ee5\u76f4\u63a5\u8089\u773c\u67e5\u770b\uff0c\u4e3a\u6211\u4eec\u8c03\u8bd5\u5de5\u4f5c\u5e26\u4e86\u6781\u5927\u7684\u4fbf\u5229\u6027\u3002</p> <p>\u4f46\u662f\u8fd9\u6b63\u662f\u8fd9\u6837\uff0cHTTP \u7684\u6240\u6709\u4fe1\u606f\u90fd\u66b4\u9732\u5728\u4e86\u5149\u5929\u5316\u65e5\u4e0b\uff0c\u76f8\u5f53\u4e8e\u4fe1\u606f\u88f8\u5954\u3002\u5728\u4f20\u8f93\u7684\u6f2b\u957f\u7684\u8fc7\u7a0b\u4e2d\uff0c\u4fe1\u606f\u7684\u5185\u5bb9\u90fd\u6beb\u65e0\u9690\u79c1\u53ef\u8a00\uff0c\u5f88\u5bb9\u6613\u5c31\u80fd\u88ab\u7a83\u53d6\uff0c\u5982\u679c\u91cc\u9762\u6709\u4f60\u7684\u8d26\u53f7\u5bc6\u7801\u4fe1\u606f\uff0c\u90a3\u4f60\u53f7\u6ca1\u4e86\u3002</p> <p></p> <p>3. \u4e0d\u5b89\u5168</p> <p>HTTP \u6bd4\u8f83\u4e25\u91cd\u7684\u7f3a\u70b9\u5c31\u662f\u4e0d\u5b89\u5168\uff1a</p> <ul> <li>\u901a\u4fe1\u4f7f\u7528\u660e\u6587\uff08\u4e0d\u52a0\u5bc6\uff09\uff0c\u5185\u5bb9\u53ef\u80fd\u4f1a\u88ab\u7a83\u542c\u3002\u6bd4\u5982\uff0c\u8d26\u53f7\u4fe1\u606f\u5bb9\u6613\u6cc4\u6f0f\uff0c\u90a3\u4f60\u53f7\u6ca1\u4e86\u3002</li> <li>\u4e0d\u9a8c\u8bc1\u901a\u4fe1\u65b9\u7684\u8eab\u4efd\uff0c\u56e0\u6b64\u6709\u53ef\u80fd\u906d\u9047\u4f2a\u88c5\u3002\u6bd4\u5982\uff0c\u8bbf\u95ee\u5047\u7684\u6dd8\u5b9d\u3001\u62fc\u591a\u591a\uff0c\u90a3\u4f60\u94b1\u6ca1\u4e86\u3002</li> <li>\u65e0\u6cd5\u8bc1\u660e\u62a5\u6587\u7684\u5b8c\u6574\u6027\uff0c\u6240\u4ee5\u6709\u53ef\u80fd\u5df2\u906d\u7be1\u6539\u3002\u6bd4\u5982\uff0c\u7f51\u9875\u4e0a\u690d\u5165\u5783\u573e\u5e7f\u544a\uff0c\u89c6\u89c9\u6c61\u67d3\uff0c\u773c\u6ca1\u4e86\u3002</li> </ul> <p>HTTP \u7684\u5b89\u5168\u95ee\u9898\uff0c\u53ef\u4ee5\u7528 HTTPS \u7684\u65b9\u5f0f\u89e3\u51b3\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u5f15\u5165 SSL/TLS \u5c42\uff0c\u4f7f\u5f97\u5728\u5b89\u5168\u4e0a\u8fbe\u5230\u4e86\u6781\u81f4\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http11_2","title":"HTTP/1.1 \u7684\u6027\u80fd\u5982\u4f55\uff1f","text":"<p>HTTP \u534f\u8bae\u662f\u57fa\u4e8e TCP/IP\uff0c\u5e76\u4e14\u4f7f\u7528\u4e86\u300c\u8bf7\u6c42 - \u5e94\u7b54\u300d\u7684\u901a\u4fe1\u6a21\u5f0f\uff0c\u6240\u4ee5\u6027\u80fd\u7684\u5173\u952e\u5c31\u5728\u8fd9\u4e24\u70b9\u91cc\u3002</p> <p>1. \u957f\u8fde\u63a5</p> <p>\u65e9\u671f HTTP/1.0 \u6027\u80fd\u4e0a\u7684\u4e00\u4e2a\u5f88\u5927\u7684\u95ee\u9898\uff0c\u90a3\u5c31\u662f\u6bcf\u53d1\u8d77\u4e00\u4e2a\u8bf7\u6c42\uff0c\u90fd\u8981\u65b0\u5efa\u4e00\u6b21 TCP \u8fde\u63a5\uff08\u4e09\u6b21\u63e1\u624b\uff09\uff0c\u800c\u4e14\u662f\u4e32\u884c\u8bf7\u6c42\uff0c\u505a\u4e86\u65e0\u8c13\u7684 TCP \u8fde\u63a5\u5efa\u7acb\u548c\u65ad\u5f00\uff0c\u589e\u52a0\u4e86\u901a\u4fe1\u5f00\u9500\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4e0a\u8ff0 TCP \u8fde\u63a5\u95ee\u9898\uff0cHTTP/1.1 \u63d0\u51fa\u4e86\u957f\u8fde\u63a5\u7684\u901a\u4fe1\u65b9\u5f0f\uff0c\u4e5f\u53eb\u6301\u4e45\u8fde\u63a5\u3002\u8fd9\u79cd\u65b9\u5f0f\u7684\u597d\u5904\u5728\u4e8e\u51cf\u5c11\u4e86 TCP \u8fde\u63a5\u7684\u91cd\u590d\u5efa\u7acb\u548c\u65ad\u5f00\u6240\u9020\u6210\u7684\u989d\u5916\u5f00\u9500\uff0c\u51cf\u8f7b\u4e86\u670d\u52a1\u5668\u7aef\u7684\u8d1f\u8f7d\u3002</p> <p>\u6301\u4e45\u8fde\u63a5\u7684\u7279\u70b9\u662f\uff0c\u53ea\u8981\u4efb\u610f\u4e00\u7aef\u6ca1\u6709\u660e\u786e\u63d0\u51fa\u65ad\u5f00\u8fde\u63a5\uff0c\u5219\u4fdd\u6301 TCP \u8fde\u63a5\u72b6\u6001\u3002</p> <p></p> <p>\u5f53\u7136\uff0c\u5982\u679c\u67d0\u4e2a HTTP \u957f\u8fde\u63a5\u8d85\u8fc7\u4e00\u5b9a\u65f6\u95f4\u6ca1\u6709\u4efb\u4f55\u6570\u636e\u4ea4\u4e92\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u4e3b\u52a8\u65ad\u5f00\u8fd9\u4e2a\u8fde\u63a5\u3002</p> <p>2. \u7ba1\u9053\u7f51\u7edc\u4f20\u8f93</p> <p>HTTP/1.1 \u91c7\u7528\u4e86\u957f\u8fde\u63a5\u7684\u65b9\u5f0f\uff0c\u8fd9\u4f7f\u5f97\u7ba1\u9053\uff08pipeline\uff09\u7f51\u7edc\u4f20\u8f93\u6210\u4e3a\u4e86\u53ef\u80fd\u3002</p> <p>\u5373\u53ef\u5728\u540c\u4e00\u4e2a TCP \u8fde\u63a5\u91cc\u9762\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u53d1\u8d77\u591a\u4e2a\u8bf7\u6c42\uff0c\u53ea\u8981\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u53d1\u51fa\u53bb\u4e86\uff0c\u4e0d\u5fc5\u7b49\u5176\u56de\u6765\uff0c\u5c31\u53ef\u4ee5\u53d1\u7b2c\u4e8c\u4e2a\u8bf7\u6c42\u51fa\u53bb\uff0c\u53ef\u4ee5\u51cf\u5c11\u6574\u4f53\u7684\u54cd\u5e94\u65f6\u95f4\u3002</p> <p>\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u8bf7\u6c42\u4e24\u4e2a\u8d44\u6e90\u3002\u4ee5\u524d\u7684\u505a\u6cd5\u662f\uff0c\u5728\u540c\u4e00\u4e2a TCP \u8fde\u63a5\u91cc\u9762\uff0c\u5148\u53d1\u9001 A \u8bf7\u6c42\uff0c\u7136\u540e\u7b49\u5f85\u670d\u52a1\u5668\u505a\u51fa\u56de\u5e94\uff0c\u6536\u5230\u540e\u518d\u53d1\u51fa B \u8bf7\u6c42\u3002\u90a3\u4e48\uff0c\u7ba1\u9053\u673a\u5236\u5219\u662f\u5141\u8bb8\u6d4f\u89c8\u5668\u540c\u65f6\u53d1\u51fa A \u8bf7\u6c42\u548c B \u8bf7\u6c42\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4f46\u662f\u670d\u52a1\u5668\u5fc5\u987b\u6309\u7167\u63a5\u6536\u8bf7\u6c42\u7684\u987a\u5e8f\u53d1\u9001\u5bf9\u8fd9\u4e9b\u7ba1\u9053\u5316\u8bf7\u6c42\u7684\u54cd\u5e94\u3002</p> <p>\u5982\u679c\u670d\u52a1\u7aef\u5728\u5904\u7406 A \u8bf7\u6c42\u65f6\u8017\u65f6\u6bd4\u8f83\u957f\uff0c\u90a3\u4e48\u540e\u7eed\u7684\u8bf7\u6c42\u7684\u5904\u7406\u90fd\u4f1a\u88ab\u963b\u585e\u4f4f\uff0c\u8fd9\u79f0\u4e3a\u300c\u961f\u5934\u5835\u585e\u300d\u3002</p> <p>\u6240\u4ee5\uff0cHTTP/1.1 \u7ba1\u9053\u89e3\u51b3\u4e86\u8bf7\u6c42\u7684\u961f\u5934\u963b\u585e\uff0c\u4f46\u662f\u6ca1\u6709\u89e3\u51b3\u54cd\u5e94\u7684\u961f\u5934\u963b\u585e\u3002</p> <p>::: tip</p> <p>\u6ce8\u610f!!!</p> <p>\u5b9e\u9645\u4e0a HTTP/1.1 \u7ba1\u9053\u5316\u6280\u672f\u4e0d\u662f\u9ed8\u8ba4\u5f00\u542f\uff0c\u800c\u4e14\u6d4f\u89c8\u5668\u57fa\u672c\u90fd\u6ca1\u6709\u652f\u6301\uff0c\u6240\u4ee5\u540e\u9762\u6240\u6709\u6587\u7ae0\u8ba8\u8bba HTTP/1.1 \u90fd\u662f\u5efa\u7acb\u5728\u6ca1\u6709\u4f7f\u7528\u7ba1\u9053\u5316\u7684\u524d\u63d0\u3002\u5927\u5bb6\u77e5\u9053\u6709\u8fd9\u4e2a\u529f\u80fd\uff0c\u4f46\u662f\u6ca1\u6709\u88ab\u4f7f\u7528\u5c31\u884c\u4e86\u3002</p> <p>:::</p> <p>3. \u961f\u5934\u963b\u585e </p> <p>\u300c\u8bf7\u6c42 - \u5e94\u7b54\u300d\u7684\u6a21\u5f0f\u52a0\u5267\u4e86 HTTP \u7684\u6027\u80fd\u95ee\u9898\u3002</p> <p>\u56e0\u4e3a\u5f53\u987a\u5e8f\u53d1\u9001\u7684\u8bf7\u6c42\u5e8f\u5217\u4e2d\u7684\u4e00\u4e2a\u8bf7\u6c42\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u88ab\u963b\u585e\u65f6\uff0c\u5728\u540e\u9762\u6392\u961f\u7684\u6240\u6709\u8bf7\u6c42\u4e5f\u4e00\u540c\u88ab\u963b\u585e\u4e86\uff0c\u4f1a\u62db\u81f4\u5ba2\u6237\u7aef\u4e00\u76f4\u8bf7\u6c42\u4e0d\u5230\u6570\u636e\uff0c\u8fd9\u4e5f\u5c31\u662f\u300c\u961f\u5934\u963b\u585e\u300d\uff0c\u597d\u6bd4\u4e0a\u73ed\u7684\u8def\u4e0a\u585e\u8f66\u3002</p> <p></p> <p>\u603b\u4e4b HTTP/1.1 \u7684\u6027\u80fd\u4e00\u822c\u822c\uff0c\u540e\u7eed\u7684 HTTP/2 \u548c HTTP/3 \u5c31\u662f\u5728\u4f18\u5316 HTTP \u7684\u6027\u80fd\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http-https","title":"HTTP \u4e0e HTTPS","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http-https_1","title":"HTTP \u4e0e HTTPS \u6709\u54ea\u4e9b\u533a\u522b\uff1f","text":"<ul> <li> <p>HTTP \u662f\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\uff0c\u4fe1\u606f\u662f\u660e\u6587\u4f20\u8f93\uff0c\u5b58\u5728\u5b89\u5168\u98ce\u9669\u7684\u95ee\u9898\u3002HTTPS \u5219\u89e3\u51b3 HTTP \u4e0d\u5b89\u5168\u7684\u7f3a\u9677\uff0c\u5728 TCP \u548c HTTP \u7f51\u7edc\u5c42\u4e4b\u95f4\u52a0\u5165\u4e86 SSL/TLS \u5b89\u5168\u534f\u8bae\uff0c\u4f7f\u5f97\u62a5\u6587\u80fd\u591f\u52a0\u5bc6\u4f20\u8f93\u3002</p> </li> <li> <p>HTTP \u8fde\u63a5\u5efa\u7acb\u76f8\u5bf9\u7b80\u5355\uff0cTCP \u4e09\u6b21\u63e1\u624b\u4e4b\u540e\u4fbf\u53ef\u8fdb\u884c HTTP \u7684\u62a5\u6587\u4f20\u8f93\u3002\u800c HTTPS \u5728 TCP \u4e09\u6b21\u63e1\u624b\u4e4b\u540e\uff0c\u8fd8\u9700\u8fdb\u884c SSL/TLS \u7684\u63e1\u624b\u8fc7\u7a0b\uff0c\u624d\u53ef\u8fdb\u5165\u52a0\u5bc6\u62a5\u6587\u4f20\u8f93\u3002</p> </li> <li> <p>\u4e24\u8005\u7684\u9ed8\u8ba4\u7aef\u53e3\u4e0d\u4e00\u6837\uff0cHTTP \u9ed8\u8ba4\u7aef\u53e3\u53f7\u662f 80\uff0cHTTPS \u9ed8\u8ba4\u7aef\u53e3\u53f7\u662f 443\u3002</p> </li> <li> <p>HTTPS \u534f\u8bae\u9700\u8981\u5411 CA\uff08\u8bc1\u4e66\u6743\u5a01\u673a\u6784\uff09\u7533\u8bf7\u6570\u5b57\u8bc1\u4e66\uff0c\u6765\u4fdd\u8bc1\u670d\u52a1\u5668\u7684\u8eab\u4efd\u662f\u53ef\u4fe1\u7684\u3002</p> </li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#https-http","title":"HTTPS \u89e3\u51b3\u4e86 HTTP \u7684\u54ea\u4e9b\u95ee\u9898\uff1f","text":"<p>HTTP \u7531\u4e8e\u662f\u660e\u6587\u4f20\u8f93\uff0c\u6240\u4ee5\u5b89\u5168\u4e0a\u5b58\u5728\u4ee5\u4e0b\u4e09\u4e2a\u98ce\u9669\uff1a</p> <ul> <li>\u7a83\u542c\u98ce\u9669\uff0c\u6bd4\u5982\u901a\u4fe1\u94fe\u8def\u4e0a\u53ef\u4ee5\u83b7\u53d6\u901a\u4fe1\u5185\u5bb9\uff0c\u7528\u6237\u53f7\u5bb9\u6613\u6ca1\u3002</li> <li>\u7be1\u6539\u98ce\u9669\uff0c\u6bd4\u5982\u5f3a\u5236\u690d\u5165\u5783\u573e\u5e7f\u544a\uff0c\u89c6\u89c9\u6c61\u67d3\uff0c\u7528\u6237\u773c\u5bb9\u6613\u778e\u3002</li> <li>\u5192\u5145\u98ce\u9669\uff0c\u6bd4\u5982\u5192\u5145\u6dd8\u5b9d\u7f51\u7ad9\uff0c\u7528\u6237\u94b1\u5bb9\u6613\u6ca1\u3002</li> </ul> <p></p> <p>HTTPS \u5728 HTTP \u4e0e TCP \u5c42\u4e4b\u95f4\u52a0\u5165\u4e86 <code>SSL/TLS</code> \u534f\u8bae\uff0c\u53ef\u4ee5\u5f88\u597d\u7684\u89e3\u51b3\u4e86\u4e0a\u8ff0\u7684\u98ce\u9669\uff1a</p> <ul> <li>\u4fe1\u606f\u52a0\u5bc6\uff1a\u4ea4\u4e92\u4fe1\u606f\u65e0\u6cd5\u88ab\u7a83\u53d6\uff0c\u4f46\u4f60\u7684\u53f7\u4f1a\u56e0\u4e3a\u300c\u81ea\u8eab\u5fd8\u8bb0\u300d\u8d26\u53f7\u800c\u6ca1\u3002</li> <li>\u6821\u9a8c\u673a\u5236\uff1a\u65e0\u6cd5\u7be1\u6539\u901a\u4fe1\u5185\u5bb9\uff0c\u7be1\u6539\u4e86\u5c31\u4e0d\u80fd\u6b63\u5e38\u663e\u793a\uff0c\u4f46\u767e\u5ea6\u300c\u7ade\u4ef7\u6392\u540d\u300d\u4f9d\u7136\u53ef\u4ee5\u641c\u7d22\u5783\u573e\u5e7f\u544a\u3002</li> <li>\u8eab\u4efd\u8bc1\u4e66\uff1a\u8bc1\u660e\u6dd8\u5b9d\u662f\u771f\u7684\u6dd8\u5b9d\u7f51\uff0c\u4f46\u4f60\u7684\u94b1\u8fd8\u662f\u4f1a\u56e0\u4e3a\u300c\u5241\u624b\u300d\u800c\u6ca1\u3002</li> </ul> <p>\u53ef\u89c1\uff0c\u53ea\u8981\u81ea\u8eab\u4e0d\u505a\u300c\u6076\u300d\uff0cSSL/TLS \u534f\u8bae\u662f\u80fd\u4fdd\u8bc1\u901a\u4fe1\u662f\u5b89\u5168\u7684\u3002</p> <p>HTTPS \u662f\u5982\u4f55\u89e3\u51b3\u4e0a\u9762\u7684\u4e09\u4e2a\u98ce\u9669\u7684\uff1f</p> <ul> <li>\u6df7\u5408\u52a0\u5bc6\u7684\u65b9\u5f0f\u5b9e\u73b0\u4fe1\u606f\u7684\u673a\u5bc6\u6027\uff0c\u89e3\u51b3\u4e86\u7a83\u542c\u7684\u98ce\u9669\u3002</li> <li>\u6458\u8981\u7b97\u6cd5\u7684\u65b9\u5f0f\u6765\u5b9e\u73b0\u5b8c\u6574\u6027\uff0c\u5b83\u80fd\u591f\u4e3a\u6570\u636e\u751f\u6210\u72ec\u4e00\u65e0\u4e8c\u7684\u300c\u6307\u7eb9\u300d\uff0c\u6307\u7eb9\u7528\u4e8e\u6821\u9a8c\u6570\u636e\u7684\u5b8c\u6574\u6027\uff0c\u89e3\u51b3\u4e86\u7be1\u6539\u7684\u98ce\u9669\u3002</li> <li>\u5c06\u670d\u52a1\u5668\u516c\u94a5\u653e\u5165\u5230\u6570\u5b57\u8bc1\u4e66\u4e2d\uff0c\u89e3\u51b3\u4e86\u5192\u5145\u7684\u98ce\u9669\u3002</li> </ul> <p>1. \u6df7\u5408\u52a0\u5bc6</p> <p>\u901a\u8fc7\u6df7\u5408\u52a0\u5bc6\u7684\u65b9\u5f0f\u53ef\u4ee5\u4fdd\u8bc1\u4fe1\u606f\u7684\u673a\u5bc6\u6027\uff0c\u89e3\u51b3\u4e86\u7a83\u542c\u7684\u98ce\u9669\u3002</p> <p></p> <p>HTTPS \u91c7\u7528\u7684\u662f\u5bf9\u79f0\u52a0\u5bc6\u548c\u975e\u5bf9\u79f0\u52a0\u5bc6\u7ed3\u5408\u7684\u300c\u6df7\u5408\u52a0\u5bc6\u300d\u65b9\u5f0f\uff1a</p> <ul> <li>\u5728\u901a\u4fe1\u5efa\u7acb\u524d\u91c7\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u65b9\u5f0f\u4ea4\u6362\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\uff0c\u540e\u7eed\u5c31\u4e0d\u518d\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\u3002</li> <li>\u5728\u901a\u4fe1\u8fc7\u7a0b\u4e2d\u5168\u90e8\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u7684\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u7684\u65b9\u5f0f\u52a0\u5bc6\u660e\u6587\u6570\u636e\u3002</li> </ul> <p>\u91c7\u7528\u300c\u6df7\u5408\u52a0\u5bc6\u300d\u7684\u65b9\u5f0f\u7684\u539f\u56e0\uff1a</p> <ul> <li>\u5bf9\u79f0\u52a0\u5bc6\u53ea\u4f7f\u7528\u4e00\u4e2a\u5bc6\u94a5\uff0c\u8fd0\u7b97\u901f\u5ea6\u5feb\uff0c\u5bc6\u94a5\u5fc5\u987b\u4fdd\u5bc6\uff0c\u65e0\u6cd5\u505a\u5230\u5b89\u5168\u7684\u5bc6\u94a5\u4ea4\u6362\u3002</li> <li>\u975e\u5bf9\u79f0\u52a0\u5bc6\u4f7f\u7528\u4e24\u4e2a\u5bc6\u94a5\uff1a\u516c\u94a5\u548c\u79c1\u94a5\uff0c\u516c\u94a5\u53ef\u4ee5\u4efb\u610f\u5206\u53d1\u800c\u79c1\u94a5\u4fdd\u5bc6\uff0c\u89e3\u51b3\u4e86\u5bc6\u94a5\u4ea4\u6362\u95ee\u9898\u4f46\u901f\u5ea6\u6162\u3002</li> </ul> <p>2. \u6458\u8981\u7b97\u6cd5 + \u6570\u5b57\u7b7e\u540d</p> <p>\u4e3a\u4e86\u4fdd\u8bc1\u4f20\u8f93\u7684\u5185\u5bb9\u4e0d\u88ab\u7be1\u6539\uff0c\u6211\u4eec\u9700\u8981\u5bf9\u5185\u5bb9\u8ba1\u7b97\u51fa\u4e00\u4e2a\u300c\u6307\u7eb9\u300d\uff0c\u7136\u540e\u540c\u5185\u5bb9\u4e00\u8d77\u4f20\u8f93\u7ed9\u5bf9\u65b9\u3002</p> <p>\u5bf9\u65b9\u6536\u5230\u540e\uff0c\u5148\u662f\u5bf9\u5185\u5bb9\u4e5f\u8ba1\u7b97\u51fa\u4e00\u4e2a\u300c\u6307\u7eb9\u300d\uff0c\u7136\u540e\u8ddf\u53d1\u9001\u65b9\u53d1\u9001\u7684\u300c\u6307\u7eb9\u300d\u505a\u4e00\u4e2a\u6bd4\u8f83\uff0c\u5982\u679c\u300c\u6307\u7eb9\u300d\u76f8\u540c\uff0c\u8bf4\u660e\u5185\u5bb9\u6ca1\u6709\u88ab\u7be1\u6539\uff0c\u5426\u5219\u5c31\u53ef\u4ee5\u5224\u65ad\u51fa\u5185\u5bb9\u88ab\u7be1\u6539\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c\u5728\u8ba1\u7b97\u673a\u91cc\u4f1a\u7528\u6458\u8981\u7b97\u6cd5\uff08\u54c8\u5e0c\u51fd\u6570\uff09\u6765\u8ba1\u7b97\u51fa\u5185\u5bb9\u7684\u54c8\u5e0c\u503c\uff0c\u4e5f\u5c31\u662f\u5185\u5bb9\u7684\u300c\u6307\u7eb9\u300d\uff0c\u8fd9\u4e2a\u54c8\u5e0c\u503c\u662f\u552f\u4e00\u7684\uff0c\u4e14\u65e0\u6cd5\u901a\u8fc7\u54c8\u5e0c\u503c\u63a8\u5bfc\u51fa\u5185\u5bb9\u3002</p> <p></p> <p>\u901a\u8fc7\u54c8\u5e0c\u7b97\u6cd5\u53ef\u4ee5\u786e\u4fdd\u5185\u5bb9\u4e0d\u4f1a\u88ab\u7be1\u6539\uff0c\u4f46\u662f\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u300c\u5185\u5bb9 + \u54c8\u5e0c\u503c\u300d\u4e0d\u4f1a\u88ab\u4e2d\u95f4\u4eba\u66ff\u6362\uff0c\u56e0\u4e3a\u8fd9\u91cc\u7f3a\u5c11\u5bf9\u5ba2\u6237\u7aef\u6536\u5230\u7684\u6d88\u606f\u662f\u5426\u6765\u6e90\u4e8e\u670d\u52a1\u7aef\u7684\u8bc1\u660e\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4f60\u60f3\u5411\u8001\u5e08\u8bf7\u5047\uff0c\u4e00\u822c\u6765\u8bf4\u662f\u8981\u6c42\u7531\u5bb6\u957f\u5199\u4e00\u4efd\u8bf7\u5047\u7406\u7531\u5e76\u7b7e\u540d\uff0c\u8001\u5e08\u624d\u80fd\u5141\u8bb8\u4f60\u8bf7\u5047\u3002</p> <p>\u4f46\u662f\u4f60\u6709\u6a21\u4eff\u4f60\u7238\u7238\u5b57\u8ff9\u7684\u80fd\u529b\uff0c\u4f60\u7528\u4f60\u7238\u7238\u7684\u5b57\u8ff9\u5199\u4e86\u4e00\u4efd\u8bf7\u5047\u7406\u7531\u7136\u540e\u7b7e\u4e0a\u4f60\u7238\u7238\u7684\u540d\u5b57\uff0c\u8001\u5e08\u4e00\u770b\u5230\u8fd9\u4e2a\u8bf7\u5047\u6761\uff0c\u67e5\u770b\u5b57\u8ff9\u548c\u7b7e\u540d\uff0c\u5c31\u8bef\u4ee5\u4e3a\u662f\u4f60\u7238\u7238\u5199\u7684\uff0c\u5c31\u4f1a\u5141\u8bb8\u4f60\u8bf7\u5047\u3002</p> <p>\u90a3\u4f5c\u4e3a\u8001\u5e08\uff0c\u8981\u5982\u4f55\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\u5462\uff1f\u73b0\u5b9e\u751f\u6d3b\u4e2d\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u7535\u8bdd\u6216\u89c6\u9891\u6765\u786e\u8ba4\u662f\u5426\u662f\u7531\u7236\u6bcd\u53d1\u51fa\u7684\u8bf7\u5047\uff0c\u4f46\u662f\u8ba1\u7b97\u673a\u91cc\u53ef\u6ca1\u6709\u8fd9\u79cd\u64cd\u4f5c\u3002</p> <p>\u90a3\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0c\u8ba1\u7b97\u673a\u91cc\u4f1a\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u6765\u89e3\u51b3\uff0c\u5171\u6709\u4e24\u4e2a\u5bc6\u94a5\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f\u516c\u94a5\uff0c\u8fd9\u4e2a\u662f\u53ef\u4ee5\u516c\u5f00\u7ed9\u6240\u6709\u4eba\u7684\uff1b</li> <li>\u4e00\u4e2a\u662f\u79c1\u94a5\uff0c\u8fd9\u4e2a\u5fc5\u987b\u7531\u672c\u4eba\u7ba1\u7406\uff0c\u4e0d\u53ef\u6cc4\u9732\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u5bc6\u94a5\u53ef\u4ee5\u53cc\u5411\u52a0\u89e3\u5bc6\u7684\uff0c\u6bd4\u5982\u53ef\u4ee5\u7528\u516c\u94a5\u52a0\u5bc6\u5185\u5bb9\uff0c\u7136\u540e\u7528\u79c1\u94a5\u89e3\u5bc6\uff0c\u4e5f\u53ef\u4ee5\u7528\u79c1\u94a5\u52a0\u5bc6\u5185\u5bb9\uff0c\u516c\u94a5\u89e3\u5bc6\u5185\u5bb9\u3002</p> <p>\u6d41\u7a0b\u7684\u4e0d\u540c\uff0c\u610f\u5473\u7740\u76ee\u7684\u4e5f\u4e0d\u76f8\u540c\uff1a</p> <ul> <li>\u516c\u94a5\u52a0\u5bc6\uff0c\u79c1\u94a5\u89e3\u5bc6\u3002\u8fd9\u4e2a\u76ee\u7684\u662f\u4e3a\u4e86\u4fdd\u8bc1\u5185\u5bb9\u4f20\u8f93\u7684\u5b89\u5168\uff0c\u56e0\u4e3a\u88ab\u516c\u94a5\u52a0\u5bc6\u7684\u5185\u5bb9\uff0c\u5176\u4ed6\u4eba\u662f\u65e0\u6cd5\u89e3\u5bc6\u7684\uff0c\u53ea\u6709\u6301\u6709\u79c1\u94a5\u7684\u4eba\uff0c\u624d\u80fd\u89e3\u5bc6\u51fa\u5b9e\u9645\u7684\u5185\u5bb9\uff1b</li> <li>\u79c1\u94a5\u52a0\u5bc6\uff0c\u516c\u94a5\u89e3\u5bc6\u3002\u8fd9\u4e2a\u76ee\u7684\u662f\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u4e0d\u4f1a\u88ab\u5192\u5145\uff0c\u56e0\u4e3a\u79c1\u94a5\u662f\u4e0d\u53ef\u6cc4\u9732\u7684\uff0c\u5982\u679c\u516c\u94a5\u80fd\u6b63\u5e38\u89e3\u5bc6\u51fa\u79c1\u94a5\u52a0\u5bc6\u7684\u5185\u5bb9\uff0c\u5c31\u80fd\u8bc1\u660e\u8fd9\u4e2a\u6d88\u606f\u662f\u6765\u6e90\u4e8e\u6301\u6709\u79c1\u94a5\u8eab\u4efd\u7684\u4eba\u53d1\u9001\u7684\u3002</li> </ul> <p>\u4e00\u822c\u6211\u4eec\u4e0d\u4f1a\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\u6765\u52a0\u5bc6\u5b9e\u9645\u7684\u4f20\u8f93\u5185\u5bb9\uff0c\u56e0\u4e3a\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u8ba1\u7b97\u6bd4\u8f83\u8017\u8d39\u6027\u80fd\u7684\u3002</p> <p>\u6240\u4ee5\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u7528\u9014\u4e3b\u8981\u5728\u4e8e\u901a\u8fc7\u300c\u79c1\u94a5\u52a0\u5bc6\uff0c\u516c\u94a5\u89e3\u5bc6\u300d\u7684\u65b9\u5f0f\uff0c\u6765\u786e\u8ba4\u6d88\u606f\u7684\u8eab\u4efd\uff0c\u6211\u4eec\u5e38\u8bf4\u7684\u6570\u5b57\u7b7e\u540d\u7b97\u6cd5\uff0c\u5c31\u662f\u7528\u7684\u662f\u8fd9\u79cd\u65b9\u5f0f\uff0c\u4e0d\u8fc7\u79c1\u94a5\u52a0\u5bc6\u5185\u5bb9\u4e0d\u662f\u5185\u5bb9\u672c\u8eab\uff0c\u800c\u662f\u5bf9\u5185\u5bb9\u7684\u54c8\u5e0c\u503c\u52a0\u5bc6\u3002</p> <p></p> <p>\u79c1\u94a5\u662f\u7531\u670d\u52a1\u7aef\u4fdd\u7ba1\uff0c\u7136\u540e\u670d\u52a1\u7aef\u4f1a\u5411\u5ba2\u6237\u7aef\u9881\u53d1\u5bf9\u5e94\u7684\u516c\u94a5\u3002\u5982\u679c\u5ba2\u6237\u7aef\u6536\u5230\u7684\u4fe1\u606f\uff0c\u80fd\u88ab\u516c\u94a5\u89e3\u5bc6\uff0c\u5c31\u8bf4\u660e\u8be5\u6d88\u606f\u662f\u7531\u670d\u52a1\u5668\u53d1\u9001\u7684\u3002</p> <p>\u5f15\u5165\u4e86\u6570\u5b57\u7b7e\u540d\u7b97\u6cd5\u540e\uff0c\u4f60\u5c31\u65e0\u6cd5\u6a21\u4eff\u4f60\u7238\u7238\u7684\u5b57\u8ff9\u6765\u8bf7\u5047\u4e86\uff0c\u4f60\u7238\u7238\u624b\u4e0a\u6301\u6709\u7740\u79c1\u94a5\uff0c\u4f60\u8001\u5e08\u6301\u6709\u7740\u516c\u94a5\u3002</p> <p>\u8fd9\u6837\u53ea\u6709\u7528\u4f60\u7238\u7238\u624b\u4e0a\u7684\u79c1\u94a5\u624d\u5bf9\u8bf7\u5047\u6761\u8fdb\u884c\u300c\u7b7e\u540d\u300d\uff0c\u8001\u5e08\u901a\u8fc7\u516c\u94a5\u770b\u80fd\u4e0d\u80fd\u89e3\u51fa\u8fd9\u4e2a\u300c\u7b7e\u540d\u300d\uff0c\u5982\u679c\u80fd\u89e3\u51fa\u5e76\u4e14\u786e\u8ba4\u5185\u5bb9\u7684\u5b8c\u6574\u6027\uff0c\u5c31\u80fd\u8bc1\u660e\u662f\u7531\u4f60\u7238\u7238\u53d1\u8d77\u7684\u8bf7\u5047\u6761\uff0c\u8fd9\u6837\u8001\u5e08\u624d\u5141\u8bb8\u4f60\u8bf7\u5047\uff0c\u5426\u5219\u8001\u5e08\u5c31\u4e0d\u8ba4\u3002</p> <p>3. \u6570\u5b57\u8bc1\u4e66</p> <p>\u524d\u9762\u6211\u4eec\u77e5\u9053\uff1a</p> <ul> <li>\u53ef\u4ee5\u901a\u8fc7\u54c8\u5e0c\u7b97\u6cd5\u6765\u4fdd\u8bc1\u6d88\u606f\u7684\u5b8c\u6574\u6027\uff1b</li> <li>\u53ef\u4ee5\u901a\u8fc7\u6570\u5b57\u7b7e\u540d\u6765\u4fdd\u8bc1\u6d88\u606f\u7684\u6765\u6e90\u53ef\u9760\u6027\uff08\u80fd\u786e\u8ba4\u6d88\u606f\u662f\u7531\u6301\u6709\u79c1\u94a5\u7684\u4e00\u65b9\u53d1\u9001\u7684\uff09\uff1b</li> </ul> <p>\u4f46\u662f\u8fd9\u8fd8\u8fdc\u8fdc\u4e0d\u591f\uff0c\u8fd8\u7f3a\u5c11\u8eab\u4efd\u9a8c\u8bc1\u7684\u73af\u8282\uff0c\u4e07\u4e00\u516c\u94a5\u662f\u88ab\u4f2a\u9020\u7684\u5462\uff1f</p> <p>\u8fd8\u662f\u62ff\u8bf7\u5047\u7684\u4f8b\u5b50\uff0c\u867d\u7136\u4f60\u7238\u7238\u6301\u6709\u79c1\u94a5\uff0c\u8001\u5e08\u901a\u8fc7\u662f\u5426\u80fd\u7528\u516c\u94a5\u89e3\u5bc6\u6765\u786e\u8ba4\u8fd9\u4e2a\u8bf7\u5047\u6761\u662f\u4e0d\u662f\u6765\u6e90\u4f60\u7236\u4eb2\u7684\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u8fd8\u53ef\u4ee5\u81ea\u5df1\u4f2a\u9020\u51fa\u4e00\u5bf9\u516c\u79c1\u94a5\u554a\uff01</p> <p>\u4f60\u627e\u4e86\u4e2a\u591c\u665a\uff0c\u5077\u5077\u628a\u8001\u5e08\u684c\u9762\u4e0a\u548c\u4f60\u7238\u7238\u914d\u5bf9\u7684\u516c\u94a5\uff0c\u6362\u6210\u4e86\u4f60\u7684\u516c\u94a5\uff0c\u90a3\u4e48\u4e0b\u6b21\u4f60\u5728\u8bf7\u5047\u7684\u65f6\u5019\uff0c\u4f60\u7ee7\u7eed\u6a21\u4eff\u4f60\u7238\u7238\u7684\u5b57\u8ff9\u5199\u4e86\u4e2a\u8bf7\u5047\u6761\uff0c\u7136\u540e\u7528\u4f60\u7684\u79c1\u94a5\u505a\u4e2a\u4e86\u300c\u6570\u5b57\u7b7e\u540d\u300d\u3002</p> <p>\u4f46\u662f\u8001\u5e08\u5e76\u4e0d\u77e5\u9053\u81ea\u5df1\u7684\u516c\u94a5\u88ab\u4f60\u66ff\u6362\u8fc7\u4e86\uff0c\u6240\u4ee5\u4ed6\u8fd8\u662f\u6309\u7167\u5f80\u5e38\u4e00\u6837\u7528\u516c\u94a5\u89e3\u5bc6\uff0c\u7531\u4e8e\u8fd9\u4e2a\u516c\u94a5\u548c\u4f60\u7684\u79c1\u94a5\u662f\u914d\u5bf9\u7684\uff0c\u8001\u5e08\u5f53\u7136\u80fd\u7528\u8fd9\u4e2a\u88ab\u66ff\u6362\u7684\u516c\u94a5\u89e3\u5bc6\u51fa\u6765\uff0c\u5e76\u4e14\u786e\u8ba4\u4e86\u5185\u5bb9\u7684\u5b8c\u6574\u6027\uff0c\u4e8e\u662f\u8001\u5e08\u5c31\u4f1a\u4ee5\u4e3a\u662f\u4f60\u7236\u4eb2\u5199\u7684\u8bf7\u5047\u6761\uff0c\u53c8\u5141\u8bb8\u4f60\u8bf7\u5047\u4e86\u3002</p> <p>\u597d\u5bb6\u4f19\uff0c\u4e3a\u4e86\u4e00\u4e2a\u8bf7\u5047\uff0c\u771f\u7684\u662f\u6597\u667a\u6597\u52c7\u3002</p> <p>\u540e\u9762\u4f60\u7684\u8001\u5e08\u548c\u7236\u4eb2\u53d1\u73b0\u4e86\u4f60\u4f2a\u9020\u516c\u79c1\u94a5\u7684\u4e8b\u60c5\u540e\uff0c\u51b3\u5b9a\u91cd\u65b0\u5546\u91cf\u4e00\u4e2a\u5bf9\u7b56\u6765\u5e94\u5bf9\u4f60\u8fd9\u4e2a\u81ed\u5bb6\u4f19\u3002</p> <p>\u6b63\u6240\u8c13\u9b54\u9ad8\u4e00\u5c3a\uff0c\u9053\u9ad8\u4e00\u4e08\u3002</p> <p>\u65e2\u7136\u4f2a\u9020\u516c\u79c1\u94a5\u90a3\u4e48\u968f\u610f\uff0c\u6240\u4ee5\u4f60\u7238\u628a\u4ed6\u7684\u516c\u94a5\u6ce8\u518c\u5230\u8b66\u5bdf\u5c40\uff0c\u8b66\u5bdf\u5c40\u7528\u4ed6\u4eec\u81ea\u5df1\u7684\u79c1\u94a5\u5bf9\u4f60\u7236\u4eb2\u7684\u516c\u94a5\u505a\u4e86\u4e2a\u6570\u5b57\u7b7e\u540d\uff0c\u7136\u540e\u628a\u4f60\u7238\u7238\u7684\u300c\u4e2a\u4eba\u4fe1\u606f + \u516c\u94a5 + \u6570\u5b57\u7b7e\u540d\u300d\u6253\u5305\u6210\u4e00\u4e2a\u6570\u5b57\u8bc1\u4e66\uff0c\u4e5f\u5c31\u662f\u8bf4\u8fd9\u4e2a\u6570\u5b57\u8bc1\u4e66\u5305\u542b\u4f60\u7238\u7238\u7684\u516c\u94a5\u3002</p> <p>\u8fd9\u6837\uff0c\u4f60\u7238\u7238\u5982\u679c\u56e0\u4e3a\u5bb6\u91cc\u786e\u5b9e\u6709\u4e8b\u8981\u5411\u8001\u5e08\u5e2e\u4f60\u8bf7\u5047\u7684\u65f6\u5019\uff0c\u4e0d\u4ec5\u4f1a\u7528\u81ea\u5df1\u7684\u79c1\u94a5\u5bf9\u5185\u5bb9\u8fdb\u884c\u7b7e\u540d\uff0c\u8fd8\u4f1a\u628a\u6570\u5b57\u8bc1\u4e66\u7ed9\u5230\u8001\u5e08\u3002</p> <p>\u8001\u5e08\u62ff\u5230\u4e86\u6570\u5b57\u8bc1\u4e66\u540e\uff0c\u9996\u5148\u4f1a\u53bb\u8b66\u5bdf\u5c40\u9a8c\u8bc1\u8fd9\u4e2a\u6570\u5b57\u8bc1\u4e66\u662f\u5426\u5408\u6cd5\uff0c\u56e0\u4e3a\u6570\u5b57\u8bc1\u4e66\u91cc\u6709\u8b66\u5bdf\u5c40\u7684\u6570\u5b57\u7b7e\u540d\uff0c\u8b66\u5bdf\u5c40\u8981\u9a8c\u8bc1\u8bc1\u4e66\u5408\u6cd5\u6027\u7684\u65f6\u5019\uff0c\u7528\u81ea\u5df1\u7684\u516c\u94a5\u89e3\u5bc6\uff0c\u5982\u679c\u80fd\u89e3\u5bc6\u6210\u529f\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e2a\u6570\u5b57\u8bc1\u4e66\u662f\u5728\u8b66\u5bdf\u5c40\u6ce8\u518c\u8fc7\u7684\uff0c\u5c31\u8ba4\u4e3a\u8be5\u6570\u5b57\u8bc1\u4e66\u662f\u5408\u6cd5\u7684\uff0c\u7136\u540e\u5c31\u4f1a\u628a\u6570\u5b57\u8bc1\u4e66\u91cc\u5934\u7684\u516c\u94a5\uff08\u4f60\u7238\u7238\u7684\uff09\u7ed9\u5230\u8001\u5e08\u3002</p> <p>\u7531\u4e8e\u901a\u8fc7\u8b66\u5bdf\u5c40\u9a8c\u8bc1\u4e86\u6570\u5b57\u8bc1\u4e66\u662f\u5408\u6cd5\u7684\uff0c\u90a3\u4e48\u5c31\u80fd\u8bc1\u660e\u8fd9\u4e2a\u516c\u94a5\u5c31\u662f\u4f60\u7236\u4eb2\u7684\uff0c\u4e8e\u662f\u8001\u5e08\u5c31\u53ef\u4ee5\u5b89\u5fc3\u7684\u7528\u8fd9\u4e2a\u516c\u94a5\u89e3\u5bc6\u51fa\u6e05\u6559\u6761\uff0c\u5982\u679c\u80fd\u89e3\u5bc6\u51fa\uff0c\u5c31\u8bc1\u660e\u662f\u4f60\u7238\u7238\u5199\u7684\u8bf7\u5047\u6761\u3002</p> <p>\u6b63\u662f\u901a\u8fc7\u4e86\u4e00\u4e2a\u6743\u5a01\u7684\u673a\u6784\u6765\u8bc1\u660e\u4f60\u7238\u7238\u7684\u8eab\u4efd\uff0c\u6240\u4ee5\u4f60\u7684\u4f2a\u9020\u516c\u79c1\u94a5\u8fd9\u4e2a\u5c0f\u4f0e\u4fe9\u5c31\u6ca1\u7528\u4e86\u3002</p> <p>\u5728\u8ba1\u7b97\u673a\u91cc\uff0c\u8fd9\u4e2a\u6743\u5a01\u7684\u673a\u6784\u5c31\u662f CA\uff08\u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\uff09\uff0c\u5c06\u670d\u52a1\u5668\u516c\u94a5\u653e\u5728\u6570\u5b57\u8bc1\u4e66\uff08\u7531\u6570\u5b57\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\u9881\u53d1\uff09\u4e2d\uff0c\u53ea\u8981\u8bc1\u4e66\u662f\u53ef\u4fe1\u7684\uff0c\u516c\u94a5\u5c31\u662f\u53ef\u4fe1\u7684\u3002</p> <p>\u6570\u5b57\u8bc1\u4e66\u7684\u5de5\u4f5c\u6d41\u7a0b\uff0c\u6211\u4e5f\u753b\u4e86\u4e00\u5f20\u56fe\uff0c\u65b9\u4fbf\u5927\u5bb6\u7406\u89e3\uff1a</p> <p></p> <p>\u901a\u8fc7\u6570\u5b57\u8bc1\u4e66\u7684\u65b9\u5f0f\u4fdd\u8bc1\u670d\u52a1\u5668\u516c\u94a5\u7684\u8eab\u4efd\uff0c\u89e3\u51b3\u5192\u5145\u7684\u98ce\u9669\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#https","title":"HTTPS  \u662f\u5982\u4f55\u5efa\u7acb\u8fde\u63a5\u7684\uff1f\u5176\u95f4\u4ea4\u4e92\u4e86\u4ec0\u4e48\uff1f","text":"<p>SSL/TLS \u534f\u8bae\u57fa\u672c\u6d41\u7a0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u7d22\u8981\u5e76\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u516c\u94a5\u3002</li> <li>\u53cc\u65b9\u534f\u5546\u751f\u4ea7\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u3002</li> <li>\u53cc\u65b9\u91c7\u7528\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u8fdb\u884c\u52a0\u5bc6\u901a\u4fe1\u3002</li> </ul> <p>\u524d\u4e24\u6b65\u4e5f\u5c31\u662f SSL/TLS \u7684\u5efa\u7acb\u8fc7\u7a0b\uff0c\u4e5f\u5c31\u662f TLS \u63e1\u624b\u9636\u6bb5\u3002</p> <p>TLS \u7684\u300c\u63e1\u624b\u9636\u6bb5\u300d\u6d89\u53ca\u56db\u6b21\u901a\u4fe1\uff0c\u4f7f\u7528\u4e0d\u540c\u7684\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\uff0cTLS \u63e1\u624b\u6d41\u7a0b\u4e5f\u4f1a\u4e0d\u4e00\u6837\u7684\uff0c\u73b0\u5728\u5e38\u7528\u7684\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u6709\u4e24\u79cd\uff1aRSA \u7b97\u6cd5 \u548c ECDHE \u7b97\u6cd5\u3002</p> <p>\u57fa\u4e8e RSA \u7b97\u6cd5\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\u6bd4\u8f83\u5bb9\u6613\u7406\u89e3\uff0c\u6240\u4ee5\u8fd9\u91cc\u5148\u7528\u8fd9\u4e2a\u7ed9\u5927\u5bb6\u5c55\u793a TLS \u63e1\u624b\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>TLS \u534f\u8bae\u5efa\u7acb\u7684\u8be6\u7ec6\u6d41\u7a0b\uff1a</p> <p>1. ClientHello</p> <p>\u9996\u5148\uff0c\u7531\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u5668\u53d1\u8d77\u52a0\u5bc6\u901a\u4fe1\u8bf7\u6c42\uff0c\u4e5f\u5c31\u662f <code>ClientHello</code> \u8bf7\u6c42\u3002</p> <p>\u5728\u8fd9\u4e00\u6b65\uff0c\u5ba2\u6237\u7aef\u4e3b\u8981\u5411\u670d\u52a1\u5668\u53d1\u9001\u4ee5\u4e0b\u4fe1\u606f\uff1a</p> <p>\uff081\uff09\u5ba2\u6237\u7aef\u652f\u6301\u7684 TLS \u534f\u8bae\u7248\u672c\uff0c\u5982 TLS 1.2 \u7248\u672c\u3002</p> <p>\uff082\uff09\u5ba2\u6237\u7aef\u751f\u4ea7\u7684\u968f\u673a\u6570\uff08<code>Client Random</code>\uff09\uff0c\u540e\u9762\u7528\u4e8e\u751f\u6210\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u6761\u4ef6\u4e4b\u4e00\u3002</p> <p>\uff083\uff09\u5ba2\u6237\u7aef\u652f\u6301\u7684\u5bc6\u7801\u5957\u4ef6\u5217\u8868\uff0c\u5982 RSA \u52a0\u5bc6\u7b97\u6cd5\u3002</p> <p>2. SeverHello</p> <p>\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u8bf7\u6c42\u540e\uff0c\u5411\u5ba2\u6237\u7aef\u53d1\u51fa\u54cd\u5e94\uff0c\u4e5f\u5c31\u662f <code>ServerHello</code>\u3002\u670d\u52a1\u5668\u56de\u5e94\u7684\u5185\u5bb9\u6709\u5982\u4e0b\u5185\u5bb9\uff1a</p> <p>\uff081\uff09\u786e\u8ba4 TLS \u534f\u8bae\u7248\u672c\uff0c\u5982\u679c\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\uff0c\u5219\u5173\u95ed\u52a0\u5bc6\u901a\u4fe1\u3002</p> <p>\uff082\uff09\u670d\u52a1\u5668\u751f\u4ea7\u7684\u968f\u673a\u6570\uff08<code>Server Random</code>\uff09\uff0c\u4e5f\u662f\u540e\u9762\u7528\u4e8e\u751f\u4ea7\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u6761\u4ef6\u4e4b\u4e00\u3002</p> <p>\uff083\uff09\u786e\u8ba4\u7684\u5bc6\u7801\u5957\u4ef6\u5217\u8868\uff0c\u5982 RSA \u52a0\u5bc6\u7b97\u6cd5\u3002</p> <p>\uff084\uff09\u670d\u52a1\u5668\u7684\u6570\u5b57\u8bc1\u4e66\u3002</p> <p>3.\u5ba2\u6237\u7aef\u56de\u5e94</p> <p>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u5668\u7684\u56de\u5e94\u4e4b\u540e\uff0c\u9996\u5148\u901a\u8fc7\u6d4f\u89c8\u5668\u6216\u8005\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u7684 CA \u516c\u94a5\uff0c\u786e\u8ba4\u670d\u52a1\u5668\u7684\u6570\u5b57\u8bc1\u4e66\u7684\u771f\u5b9e\u6027\u3002</p> <p>\u5982\u679c\u8bc1\u4e66\u6ca1\u6709\u95ee\u9898\uff0c\u5ba2\u6237\u7aef\u4f1a\u4ece\u6570\u5b57\u8bc1\u4e66\u4e2d\u53d6\u51fa\u670d\u52a1\u5668\u7684\u516c\u94a5\uff0c\u7136\u540e\u4f7f\u7528\u5b83\u52a0\u5bc6\u62a5\u6587\uff0c\u5411\u670d\u52a1\u5668\u53d1\u9001\u5982\u4e0b\u4fe1\u606f\uff1a</p> <p>\uff081\uff09\u4e00\u4e2a\u968f\u673a\u6570\uff08<code>pre-master key</code>\uff09\u3002\u8be5\u968f\u673a\u6570\u4f1a\u88ab\u670d\u52a1\u5668\u516c\u94a5\u52a0\u5bc6\u3002</p> <p>\uff082\uff09\u52a0\u5bc6\u901a\u4fe1\u7b97\u6cd5\u6539\u53d8\u901a\u77e5\uff0c\u8868\u793a\u968f\u540e\u7684\u4fe1\u606f\u90fd\u5c06\u7528\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u52a0\u5bc6\u901a\u4fe1\u3002</p> <p>\uff083\uff09\u5ba2\u6237\u7aef\u63e1\u624b\u7ed3\u675f\u901a\u77e5\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u7684\u63e1\u624b\u9636\u6bb5\u5df2\u7ecf\u7ed3\u675f\u3002\u8fd9\u4e00\u9879\u540c\u65f6\u628a\u4e4b\u524d\u6240\u6709\u5185\u5bb9\u7684\u53d1\u751f\u7684\u6570\u636e\u505a\u4e2a\u6458\u8981\uff0c\u7528\u6765\u4f9b\u670d\u52a1\u7aef\u6821\u9a8c\u3002</p> <p>\u4e0a\u9762\u7b2c\u4e00\u9879\u7684\u968f\u673a\u6570\u662f\u6574\u4e2a\u63e1\u624b\u9636\u6bb5\u7684\u7b2c\u4e09\u4e2a\u968f\u673a\u6570\uff0c\u4f1a\u53d1\u7ed9\u670d\u52a1\u7aef\uff0c\u6240\u4ee5\u8fd9\u4e2a\u968f\u673a\u6570\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u6709\u4e86\u8fd9\u4e09\u4e2a\u968f\u673a\u6570\uff08Client Random\u3001Server Random\u3001pre-master key\uff09\uff0c\u63a5\u7740\u5c31\u7528\u53cc\u65b9\u534f\u5546\u7684\u52a0\u5bc6\u7b97\u6cd5\uff0c\u5404\u81ea\u751f\u6210\u672c\u6b21\u901a\u4fe1\u7684\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u3002</p> <p>4. \u670d\u52a1\u5668\u7684\u6700\u540e\u56de\u5e94</p> <p>\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u7684\u7b2c\u4e09\u4e2a\u968f\u673a\u6570\uff08<code>pre-master key</code>\uff09\u4e4b\u540e\uff0c\u901a\u8fc7\u534f\u5546\u7684\u52a0\u5bc6\u7b97\u6cd5\uff0c\u8ba1\u7b97\u51fa\u672c\u6b21\u901a\u4fe1\u7684\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u3002</p> <p>\u7136\u540e\uff0c\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u6700\u540e\u7684\u4fe1\u606f\uff1a</p> <p>\uff081\uff09\u52a0\u5bc6\u901a\u4fe1\u7b97\u6cd5\u6539\u53d8\u901a\u77e5\uff0c\u8868\u793a\u968f\u540e\u7684\u4fe1\u606f\u90fd\u5c06\u7528\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u52a0\u5bc6\u901a\u4fe1\u3002</p> <p>\uff082\uff09\u670d\u52a1\u5668\u63e1\u624b\u7ed3\u675f\u901a\u77e5\uff0c\u8868\u793a\u670d\u52a1\u5668\u7684\u63e1\u624b\u9636\u6bb5\u5df2\u7ecf\u7ed3\u675f\u3002\u8fd9\u4e00\u9879\u540c\u65f6\u628a\u4e4b\u524d\u6240\u6709\u5185\u5bb9\u7684\u53d1\u751f\u7684\u6570\u636e\u505a\u4e2a\u6458\u8981\uff0c\u7528\u6765\u4f9b\u5ba2\u6237\u7aef\u6821\u9a8c\u3002</p> <p>\u81f3\u6b64\uff0c\u6574\u4e2a TLS \u7684\u63e1\u624b\u9636\u6bb5\u5168\u90e8\u7ed3\u675f\u3002\u63a5\u4e0b\u6765\uff0c\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u8fdb\u5165\u52a0\u5bc6\u901a\u4fe1\uff0c\u5c31\u5b8c\u5168\u662f\u4f7f\u7528\u666e\u901a\u7684 HTTP \u534f\u8bae\uff0c\u53ea\u4e0d\u8fc7\u7528\u300c\u4f1a\u8bdd\u79d8\u94a5\u300d\u52a0\u5bc6\u5185\u5bb9\u3002</p> <p>::: tip</p> <p>\u5982\u679c\u60f3\u6df1\u5165\u5b66\u4e60\u57fa\u4e8e RSA \u7b97\u6cd5\u7684 HTTPS \u63e1\u624b\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff0c\u6211\u901a\u8fc7\u6293\u5305\u7684\u65b9\u5f0f\uff0c\u9010\u6b65\u5206\u6790\u6bcf\u4e00\u4e2a\u8fc7\u7a0b\uff1aHTTPS RSA \u63e1\u624b\u89e3\u6790</p> <p>\u4e0d\u8fc7\uff0c\u57fa\u4e8e RSA \u7b97\u6cd5\u7684 HTTPS \u5b58\u5728\u300c\u524d\u5411\u5b89\u5168\u300d\u7684\u95ee\u9898\uff1a\u5982\u679c\u670d\u52a1\u7aef\u7684\u79c1\u94a5\u6cc4\u6f0f\u4e86\uff0c\u8fc7\u53bb\u88ab\u7b2c\u4e09\u65b9\u622a\u83b7\u7684\u6240\u6709 TLS \u901a\u8baf\u5bc6\u6587\u90fd\u4f1a\u88ab\u7834\u89e3\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u540e\u9762\u5c31\u51fa\u73b0\u4e86 ECDHE \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\uff0c\u6211\u4eec\u73b0\u5728\u5927\u591a\u6570\u7f51\u7ad9\u4f7f\u7528\u7684\u6b63\u662f ECDHE \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\uff0c\u5173\u4e8e ECDHE \u63e1\u624b\u7684\u8fc7\u7a0b\u53ef\u4ee5\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1aHTTPS ECDHE \u63e1\u624b\u89e3\u6790</p> <p>:::</p> <p>\u5ba2\u6237\u7aef\u6821\u9a8c\u6570\u5b57\u8bc1\u4e66\u7684\u6d41\u7a0b\u662f\u600e\u6837\u7684\uff1f</p> <p>\u63a5\u4e0b\u6765\uff0c\u8be6\u7ec6\u8bf4\u4e00\u4e0b\u5b9e\u9645\u4e2d\u6570\u5b57\u8bc1\u4e66\u7b7e\u53d1\u548c\u9a8c\u8bc1\u6d41\u7a0b\u3002</p> <p>\u5982\u4e0b\u56fe\u56fe\u6240\u793a\uff0c\u4e3a\u6570\u5b57\u8bc1\u4e66\u7b7e\u53d1\u548c\u9a8c\u8bc1\u6d41\u7a0b\uff1a</p> <p></p> <p>CA \u7b7e\u53d1\u8bc1\u4e66\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0a\u56fe\u5de6\u8fb9\u90e8\u5206\uff1a</p> <ul> <li>\u9996\u5148 CA \u4f1a\u628a\u6301\u6709\u8005\u7684\u516c\u94a5\u3001\u7528\u9014\u3001\u9881\u53d1\u8005\u3001\u6709\u6548\u65f6\u95f4\u7b49\u4fe1\u606f\u6253\u6210\u4e00\u4e2a\u5305\uff0c\u7136\u540e\u5bf9\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u884c Hash \u8ba1\u7b97\uff0c\u5f97\u5230\u4e00\u4e2a Hash \u503c\uff1b</li> <li>\u7136\u540e CA \u4f1a\u4f7f\u7528\u81ea\u5df1\u7684\u79c1\u94a5\u5c06\u8be5 Hash \u503c\u52a0\u5bc6\uff0c\u751f\u6210 Certificate Signature\uff0c\u4e5f\u5c31\u662f CA \u5bf9\u8bc1\u4e66\u505a\u4e86\u7b7e\u540d\uff1b</li> <li>\u6700\u540e\u5c06 Certificate Signature \u6dfb\u52a0\u5728\u6587\u4ef6\u8bc1\u4e66\u4e0a\uff0c\u5f62\u6210\u6570\u5b57\u8bc1\u4e66\uff1b</li> </ul> <p>\u5ba2\u6237\u7aef\u6821\u9a8c\u670d\u52a1\u7aef\u7684\u6570\u5b57\u8bc1\u4e66\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0a\u56fe\u53f3\u8fb9\u90e8\u5206\uff1a</p> <ul> <li>\u9996\u5148\u5ba2\u6237\u7aef\u4f1a\u4f7f\u7528\u540c\u6837\u7684 Hash \u7b97\u6cd5\u83b7\u53d6\u8be5\u8bc1\u4e66\u7684 Hash \u503c H1\uff1b</li> <li>\u901a\u5e38\u6d4f\u89c8\u5668\u548c\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u96c6\u6210\u4e86 CA \u7684\u516c\u94a5\u4fe1\u606f\uff0c\u6d4f\u89c8\u5668\u6536\u5230\u8bc1\u4e66\u540e\u53ef\u4ee5\u4f7f\u7528 CA \u7684\u516c\u94a5\u89e3\u5bc6 Certificate Signature \u5185\u5bb9\uff0c\u5f97\u5230\u4e00\u4e2a Hash \u503c H2\uff1b</li> <li>\u6700\u540e\u6bd4\u8f83 H1 \u548c H2\uff0c\u5982\u679c\u503c\u76f8\u540c\uff0c\u5219\u4e3a\u53ef\u4fe1\u8d56\u7684\u8bc1\u4e66\uff0c\u5426\u5219\u5219\u8ba4\u4e3a\u8bc1\u4e66\u4e0d\u53ef\u4fe1\u3002</li> </ul> <p>\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u8bc1\u4e66\u7684\u9a8c\u8bc1\u8fc7\u7a0b\u4e2d\u8fd8\u5b58\u5728\u4e00\u4e2a\u8bc1\u4e66\u4fe1\u4efb\u94fe\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u6211\u4eec\u5411 CA \u7533\u8bf7\u7684\u8bc1\u4e66\u4e00\u822c\u4e0d\u662f\u6839\u8bc1\u4e66\u7b7e\u53d1\u7684\uff0c\u800c\u662f\u7531\u4e2d\u95f4\u8bc1\u4e66\u7b7e\u53d1\u7684\uff0c\u6bd4\u5982\u767e\u5ea6\u7684\u8bc1\u4e66\uff0c\u4ece\u4e0b\u56fe\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u8bc1\u4e66\u7684\u5c42\u7ea7\u6709\u4e09\u7ea7\uff1a</p> <p></p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u4e09\u7ea7\u5c42\u7ea7\u5173\u7cfb\u7684\u8bc1\u4e66\u7684\u9a8c\u8bc1\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u6536\u5230 baidu.com \u7684\u8bc1\u4e66\u540e\uff0c\u53d1\u73b0\u8fd9\u4e2a\u8bc1\u4e66\u7684\u7b7e\u53d1\u8005\u4e0d\u662f\u6839\u8bc1\u4e66\uff0c\u5c31\u65e0\u6cd5\u6839\u636e\u672c\u5730\u5df2\u6709\u7684\u6839\u8bc1\u4e66\u4e2d\u7684\u516c\u94a5\u53bb\u9a8c\u8bc1 baidu.com \u8bc1\u4e66\u662f\u5426\u53ef\u4fe1\u3002\u4e8e\u662f\uff0c\u5ba2\u6237\u7aef\u6839\u636e baidu.com \u8bc1\u4e66\u4e2d\u7684\u7b7e\u53d1\u8005\uff0c\u627e\u5230\u8be5\u8bc1\u4e66\u7684\u9881\u53d1\u673a\u6784\u662f\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\uff0c\u7136\u540e\u5411 CA \u8bf7\u6c42\u8be5\u4e2d\u95f4\u8bc1\u4e66\u3002</li> <li>\u8bf7\u6c42\u5230\u8bc1\u4e66\u540e\u53d1\u73b0\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\u662f\u7531\u201cGlobalSign Root CA\u201d\u7b7e\u53d1\u7684\uff0c\u7531\u4e8e\u201cGlobalSign Root CA\u201d\u6ca1\u6709\u518d\u4e0a\u7ea7\u7b7e\u53d1\u673a\u6784\uff0c\u8bf4\u660e\u5b83\u662f\u6839\u8bc1\u4e66\uff0c\u4e5f\u5c31\u662f\u81ea\u7b7e\u8bc1\u4e66\u3002\u5e94\u7528\u8f6f\u4ef6\u4f1a\u68c0\u67e5\u6b64\u8bc1\u4e66\u6709\u5426\u5df2\u9884\u8f7d\u4e8e\u6839\u8bc1\u4e66\u6e05\u5355\u4e0a\uff0c\u5982\u679c\u6709\uff0c\u5219\u53ef\u4ee5\u5229\u7528\u6839\u8bc1\u4e66\u4e2d\u7684\u516c\u94a5\u53bb\u9a8c\u8bc1\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\uff0c\u5982\u679c\u53d1\u73b0\u9a8c\u8bc1\u901a\u8fc7\uff0c\u5c31\u8ba4\u4e3a\u8be5\u4e2d\u95f4\u8bc1\u4e66\u662f\u53ef\u4fe1\u7684\u3002</li> <li>\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\u88ab\u4fe1\u4efb\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\u4e2d\u7684\u516c\u94a5\u53bb\u9a8c\u8bc1 baidu.com \u8bc1\u4e66\u7684\u53ef\u4fe1\u6027\uff0c\u5982\u679c\u9a8c\u8bc1\u901a\u8fc7\uff0c\u5c31\u53ef\u4ee5\u4fe1\u4efb baidu.com \u8bc1\u4e66\u3002</li> </ul> <p>\u5728\u8fd9\u56db\u4e2a\u6b65\u9aa4\u4e2d\uff0c\u6700\u5f00\u59cb\u5ba2\u6237\u7aef\u53ea\u4fe1\u4efb\u6839\u8bc1\u4e66 GlobalSign Root CA \u8bc1\u4e66\u7684\uff0c\u7136\u540e\u201cGlobalSign Root CA\u201d\u8bc1\u4e66\u4fe1\u4efb\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\uff0c\u800c\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\u53c8\u4fe1\u4efb baidu.com \u8bc1\u4e66\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u4e5f\u4fe1\u4efb baidu.com \u8bc1\u4e66\u3002</p> <p>\u603b\u62ec\u6765\u8bf4\uff0c\u7531\u4e8e\u7528\u6237\u4fe1\u4efb GlobalSign\uff0c\u6240\u4ee5\u7531 GlobalSign \u6240\u62c5\u4fdd\u7684 baidu.com \u53ef\u4ee5\u88ab\u4fe1\u4efb\uff0c\u53e6\u5916\u7531\u4e8e\u7528\u6237\u4fe1\u4efb\u64cd\u4f5c\u7cfb\u7edf\u6216\u6d4f\u89c8\u5668\u7684\u8f6f\u4ef6\u5546\uff0c\u6240\u4ee5\u7531\u8f6f\u4ef6\u5546\u9884\u8f7d\u4e86\u6839\u8bc1\u4e66\u7684 GlobalSign \u90fd\u53ef\u88ab\u4fe1\u4efb\u3002</p> <p></p> <p>\u64cd\u4f5c\u7cfb\u7edf\u91cc\u4e00\u822c\u90fd\u4f1a\u5185\u7f6e\u4e00\u4e9b\u6839\u8bc1\u4e66\uff0c\u6bd4\u5982\u6211\u7684 MAC \u7535\u8111\u91cc\u5185\u7f6e\u7684\u6839\u8bc1\u4e66\u6709\u8fd9\u4e48\u591a\uff1a</p> <p></p> <p>\u8fd9\u6837\u7684\u4e00\u5c42\u5c42\u5730\u9a8c\u8bc1\u5c31\u6784\u6210\u4e86\u4e00\u6761\u4fe1\u4efb\u94fe\u8def\uff0c\u6574\u4e2a\u8bc1\u4e66\u4fe1\u4efb\u94fe\u9a8c\u8bc1\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6700\u540e\u4e00\u4e2a\u95ee\u9898\uff0c\u4e3a\u4ec0\u4e48\u9700\u8981\u8bc1\u4e66\u94fe\u8fd9\u4e48\u9ebb\u70e6\u7684\u6d41\u7a0b\uff1fRoot CA \u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u9881\u53d1\u8bc1\u4e66\uff0c\u800c\u662f\u8981\u641e\u90a3\u4e48\u591a\u4e2d\u95f4\u5c42\u7ea7\u5462\uff1f</p> <p>\u8fd9\u662f\u4e3a\u4e86\u786e\u4fdd\u6839\u8bc1\u4e66\u7684\u7edd\u5bf9\u5b89\u5168\u6027\uff0c\u5c06\u6839\u8bc1\u4e66\u9694\u79bb\u5730\u8d8a\u4e25\u683c\u8d8a\u597d\uff0c\u4e0d\u7136\u6839\u8bc1\u4e66\u5982\u679c\u5931\u5b88\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a\u4fe1\u4efb\u94fe\u90fd\u4f1a\u6709\u95ee\u9898\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#https_1","title":"HTTPS \u7684\u5e94\u7528\u6570\u636e\u662f\u5982\u4f55\u4fdd\u8bc1\u5b8c\u6574\u6027\u7684\uff1f","text":"<p>TLS \u5728\u5b9e\u73b0\u4e0a\u5206\u4e3a\u63e1\u624b\u534f\u8bae\u548c\u8bb0\u5f55\u534f\u8bae\u4e24\u5c42\uff1a</p> <ul> <li>TLS \u63e1\u624b\u534f\u8bae\u5c31\u662f\u6211\u4eec\u524d\u9762\u8bf4\u7684 TLS \u56db\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\uff0c\u8d1f\u8d23\u534f\u5546\u52a0\u5bc6\u7b97\u6cd5\u548c\u751f\u6210\u5bf9\u79f0\u5bc6\u94a5\uff0c\u540e\u7eed\u7528\u6b64\u5bc6\u94a5\u6765\u4fdd\u62a4\u5e94\u7528\u7a0b\u5e8f\u6570\u636e\uff08\u5373 HTTP \u6570\u636e\uff09\uff1b</li> <li>TLS \u8bb0\u5f55\u534f\u8bae\u8d1f\u8d23\u4fdd\u62a4\u5e94\u7528\u7a0b\u5e8f\u6570\u636e\u5e76\u9a8c\u8bc1\u5176\u5b8c\u6574\u6027\u548c\u6765\u6e90\uff0c\u6240\u4ee5\u5bf9 HTTP \u6570\u636e\u52a0\u5bc6\u662f\u4f7f\u7528\u8bb0\u5f55\u534f\u8bae\uff1b</li> </ul> <p>TLS \u8bb0\u5f55\u534f\u8bae\u4e3b\u8981\u8d1f\u8d23\u6d88\u606f\uff08HTTP \u6570\u636e\uff09\u7684\u538b\u7f29\uff0c\u52a0\u5bc6\u53ca\u6570\u636e\u7684\u8ba4\u8bc1\uff0c\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li> <p>\u9996\u5148\uff0c\u6d88\u606f\u88ab\u5206\u5272\u6210\u591a\u4e2a\u8f83\u77ed\u7684\u7247\u6bb5\uff0c\u7136\u540e\u5206\u522b\u5bf9\u6bcf\u4e2a\u7247\u6bb5\u8fdb\u884c\u538b\u7f29\u3002</p> </li> <li> <p>\u63a5\u4e0b\u6765\uff0c\u7ecf\u8fc7\u538b\u7f29\u7684\u7247\u6bb5\u4f1a\u88ab\u52a0\u4e0a\u6d88\u606f\u8ba4\u8bc1\u7801\uff08MAC \u503c\uff0c\u8fd9\u4e2a\u662f\u901a\u8fc7\u54c8\u5e0c\u7b97\u6cd5\u751f\u6210\u7684\uff09\uff0c\u8fd9\u662f\u4e3a\u4e86\u4fdd\u8bc1\u5b8c\u6574\u6027\uff0c\u5e76\u8fdb\u884c\u6570\u636e\u7684\u8ba4\u8bc1\u3002\u901a\u8fc7\u9644\u52a0\u6d88\u606f\u8ba4\u8bc1\u7801\u7684 MAC \u503c\uff0c\u53ef\u4ee5\u8bc6\u522b\u51fa\u7be1\u6539\u3002\u4e0e\u6b64\u540c\u65f6\uff0c\u4e3a\u4e86\u9632\u6b62\u91cd\u653e\u653b\u51fb\uff0c\u5728\u8ba1\u7b97\u6d88\u606f\u8ba4\u8bc1\u7801\u65f6\uff0c\u8fd8\u52a0\u4e0a\u4e86\u7247\u6bb5\u7684\u7f16\u7801\u3002</p> </li> <li> <p>\u518d\u63a5\u4e0b\u6765\uff0c\u7ecf\u8fc7\u538b\u7f29\u7684\u7247\u6bb5\u518d\u52a0\u4e0a\u6d88\u606f\u8ba4\u8bc1\u7801\u4f1a\u4e00\u8d77\u901a\u8fc7\u5bf9\u79f0\u5bc6\u7801\u8fdb\u884c\u52a0\u5bc6\u3002</p> </li> <li> <p>\u6700\u540e\uff0c\u4e0a\u8ff0\u7ecf\u8fc7\u52a0\u5bc6\u7684\u6570\u636e\u518d\u52a0\u4e0a\u7531\u6570\u636e\u7c7b\u578b\u3001\u7248\u672c\u53f7\u3001\u538b\u7f29\u540e\u7684\u957f\u5ea6\u7ec4\u6210\u7684\u62a5\u5934\u5c31\u662f\u6700\u7ec8\u7684\u62a5\u6587\u6570\u636e\u3002</p> </li> </ul> <p>\u8bb0\u5f55\u534f\u8bae\u5b8c\u6210\u540e\uff0c\u6700\u7ec8\u7684\u62a5\u6587\u6570\u636e\u5c06\u4f20\u9012\u5230\u4f20\u8f93\u63a7\u5236\u534f\u8bae (TCP) \u5c42\u8fdb\u884c\u4f20\u8f93\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u8be6\u7ec6\u4e86\u89e3\u8bb0\u5f55\u534f\u8bae\u662f\u5982\u4f55\u5206\u7247\u3001\u538b\u7f29\u3001\u8ba1\u7b97 MAC \u503c\u3001\u5206\u7ec4\u52a0\u5bc6\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u7406\u89e3 SSL/TLS \u7cfb\u5217 (\u56db) \u8bb0\u5f55\u534f\u8bae</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#https_2","title":"HTTPS \u4e00\u5b9a\u5b89\u5168\u53ef\u9760\u5417\uff1f","text":"<p>\u4e4b\u524d\u6709\u8bfb\u8005\u5728\u5b57\u8282\u9762\u8bd5\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\uff1aHTTPS \u4e00\u5b9a\u5b89\u5168\u53ef\u9760\u5417\uff1f</p> <p></p> <p>\u8fd9\u4e2a\u95ee\u9898\u7684\u573a\u666f\u662f\u8fd9\u6837\u7684\uff1a\u5ba2\u6237\u7aef\u901a\u8fc7\u6d4f\u89c8\u5668\u5411\u670d\u52a1\u7aef\u53d1\u8d77 HTTPS \u8bf7\u6c42\u65f6\uff0c\u88ab\u300c\u5047\u57fa\u7ad9\u300d\u8f6c\u53d1\u5230\u4e86\u4e00\u4e2a\u300c\u4e2d\u95f4\u4eba\u670d\u52a1\u5668\u300d\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u662f\u548c\u300c\u4e2d\u95f4\u4eba\u670d\u52a1\u5668\u300d\u5b8c\u6210\u4e86 TLS \u63e1\u624b\uff0c\u7136\u540e\u8fd9\u4e2a\u300c\u4e2d\u95f4\u4eba\u670d\u52a1\u5668\u300d\u518d\u4e0e\u771f\u6b63\u7684\u670d\u52a1\u7aef\u5b8c\u6210 TLS \u63e1\u624b\u3002</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u8d77 HTTPS \u5efa\u7acb\u8fde\u63a5\u8bf7\u6c42\u65f6\uff0c\u7136\u540e\u88ab\u300c\u5047\u57fa\u7ad9\u300d\u8f6c\u53d1\u5230\u4e86\u4e00\u4e2a\u300c\u4e2d\u95f4\u4eba\u670d\u52a1\u5668\u300d\uff0c\u63a5\u7740\u4e2d\u95f4\u4eba\u5411\u670d\u52a1\u7aef\u53d1\u8d77 HTTPS \u5efa\u7acb\u8fde\u63a5\u8bf7\u6c42\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u4e0e\u4e2d\u95f4\u4eba\u8fdb\u884c TLS \u63e1\u624b\uff0c\u4e2d\u95f4\u4eba\u4e0e\u670d\u52a1\u7aef\u8fdb\u884c TLS \u63e1\u624b\uff1b</li> <li>\u5728\u5ba2\u6237\u7aef\u4e0e\u4e2d\u95f4\u4eba\u8fdb\u884c TLS \u63e1\u624b\u8fc7\u7a0b\u4e2d\uff0c\u4e2d\u95f4\u4eba\u4f1a\u53d1\u9001\u81ea\u5df1\u7684\u516c\u94a5\u8bc1\u4e66\u7ed9\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u9a8c\u8bc1\u8bc1\u4e66\u7684\u771f\u4f2a\uff0c\u7136\u540e\u4ece\u8bc1\u4e66\u62ff\u5230\u516c\u94a5\uff0c\u5e76\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u7528\u516c\u94a5\u52a0\u5bc6\u968f\u673a\u6570\u53d1\u9001\u7ed9\u4e2d\u95f4\u4eba\uff0c\u4e2d\u95f4\u4eba\u4f7f\u7528\u79c1\u94a5\u89e3\u5bc6\uff0c\u5f97\u5230\u968f\u673a\u6570\uff0c\u6b64\u65f6\u53cc\u65b9\u90fd\u6709\u968f\u673a\u6570\uff0c\u7136\u540e\u901a\u8fc7\u7b97\u6cd5\u751f\u6210\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff08A\uff09\uff0c\u540e\u7eed\u5ba2\u6237\u7aef\u4e0e\u4e2d\u95f4\u4eba\u901a\u4fe1\u5c31\u7528\u8fd9\u4e2a\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u6765\u52a0\u5bc6\u6570\u636e\u4e86\u3002</li> <li>\u5728\u4e2d\u95f4\u4eba\u4e0e\u670d\u52a1\u7aef\u8fdb\u884c TLS \u63e1\u624b\u8fc7\u7a0b\u4e2d\uff0c\u670d\u52a1\u7aef\u4f1a\u53d1\u9001\u4ece CA \u673a\u6784\u7b7e\u53d1\u7684\u516c\u94a5\u8bc1\u4e66\u7ed9\u4e2d\u95f4\u4eba\uff0c\u4ece\u8bc1\u4e66\u62ff\u5230\u516c\u94a5\uff0c\u5e76\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u7528\u516c\u94a5\u52a0\u5bc6\u968f\u673a\u6570\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u4f7f\u7528\u79c1\u94a5\u89e3\u5bc6\uff0c\u5f97\u5230\u968f\u673a\u6570\uff0c\u6b64\u65f6\u53cc\u65b9\u90fd\u6709\u968f\u673a\u6570\uff0c\u7136\u540e\u901a\u8fc7\u7b97\u6cd5\u751f\u6210\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff08B\uff09\uff0c\u540e\u7eed\u4e2d\u95f4\u4eba\u4e0e\u670d\u52a1\u7aef\u901a\u4fe1\u5c31\u7528\u8fd9\u4e2a\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u6765\u52a0\u5bc6\u6570\u636e\u4e86\u3002</li> <li>\u540e\u7eed\u7684\u901a\u4fe1\u8fc7\u7a0b\u4e2d\uff0c\u4e2d\u95f4\u4eba\u7528\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff08A\uff09\u89e3\u5bc6\u5ba2\u6237\u7aef\u7684 HTTPS \u8bf7\u6c42\u7684\u6570\u636e\uff0c\u7136\u540e\u7528\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff08B\uff09\u52a0\u5bc6 HTTPS \u8bf7\u6c42\u540e\uff0c\u8f6c\u53d1\u7ed9\u670d\u52a1\u7aef\uff0c\u63a5\u7740\u670d\u52a1\u7aef\u53d1\u9001 HTTPS \u54cd\u5e94\u6570\u636e\u7ed9\u4e2d\u95f4\u4eba\uff0c\u4e2d\u95f4\u4eba\u7528\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff08B\uff09\u89e3\u5bc6 HTTPS \u54cd\u5e94\u6570\u636e\uff0c\u7136\u540e\u518d\u7528\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff08A\uff09\u52a0\u5bc6\u540e\uff0c\u8f6c\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ul> <p>\u4ece\u5ba2\u6237\u7aef\u7684\u89d2\u5ea6\u770b\uff0c\u5176\u5b9e\u5e76\u4e0d\u77e5\u9053\u7f51\u7edc\u4e2d\u5b58\u5728\u4e2d\u95f4\u4eba\u670d\u52a1\u5668\u8fd9\u4e2a\u89d2\u8272\u3002\u90a3\u4e48\u4e2d\u95f4\u4eba\u5c31\u53ef\u4ee5\u89e3\u5f00\u6d4f\u89c8\u5668\u53d1\u8d77\u7684 HTTPS \u8bf7\u6c42\u91cc\u7684\u6570\u636e\uff0c\u4e5f\u53ef\u4ee5\u89e3\u5f00\u670d\u52a1\u7aef\u54cd\u5e94\u7ed9\u6d4f\u89c8\u5668\u7684 HTTPS \u54cd\u5e94\u6570\u636e\u3002\u76f8\u5f53\u4e8e\uff0c\u4e2d\u95f4\u4eba\u80fd\u591f\u201c\u5077\u770b\u201d\u6d4f\u89c8\u5668\u4e0e\u670d\u52a1\u7aef\u4e4b\u95f4\u7684 HTTPS \u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u6570\u636e\u3002</p> <p>\u4f46\u662f\u8981\u53d1\u751f\u8fd9\u79cd\u573a\u666f\u662f\u6709\u524d\u63d0\u7684\uff0c\u524d\u63d0\u662f\u7528\u6237\u70b9\u51fb\u63a5\u53d7\u4e86\u4e2d\u95f4\u4eba\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u3002</p> <p>\u4e2d\u95f4\u4eba\u670d\u52a1\u5668\u4e0e\u5ba2\u6237\u7aef\u5728 TLS \u63e1\u624b\u8fc7\u7a0b\u4e2d\uff0c\u5b9e\u9645\u4e0a\u53d1\u9001\u4e86\u81ea\u5df1\u4f2a\u9020\u7684\u8bc1\u4e66\u7ed9\u6d4f\u89c8\u5668\uff0c\u800c\u8fd9\u4e2a\u4f2a\u9020\u7684\u8bc1\u4e66\u662f\u80fd\u88ab\u6d4f\u89c8\u5668\uff08\u5ba2\u6237\u7aef\uff09\u8bc6\u522b\u51fa\u662f\u975e\u6cd5\u7684\uff0c\u4e8e\u662f\u5c31\u4f1a\u63d0\u9192\u7528\u6237\u8be5\u8bc1\u4e66\u5b58\u5728\u95ee\u9898\u3002</p> <p></p> <p>\u5982\u679c\u7528\u6237\u6267\u610f\u70b9\u51fb\u300c\u7ee7\u7eed\u6d4f\u89c8\u6b64\u7f51\u7ad9\u300d\uff0c\u76f8\u5f53\u4e8e\u7528\u6237\u63a5\u53d7\u4e86\u4e2d\u95f4\u4eba\u4f2a\u9020\u7684\u8bc1\u4e66\uff0c\u90a3\u4e48\u540e\u7eed\u6574\u4e2a HTTPS \u901a\u4fe1\u90fd\u80fd\u88ab\u4e2d\u95f4\u4eba\u76d1\u542c\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u5176\u5b9e\u5e76\u4e0d\u80fd\u8bf4 HTTPS \u4e0d\u591f\u5b89\u5168\uff0c\u6bd5\u7adf\u6d4f\u89c8\u5668\u90fd\u5df2\u7ecf\u63d0\u793a\u8bc1\u4e66\u6709\u95ee\u9898\u4e86\uff0c\u5982\u679c\u7528\u6237\u575a\u51b3\u8981\u8bbf\u95ee\uff0c\u90a3\u4e0d\u80fd\u602a HTTPS\uff0c\u5f97\u602a\u81ea\u5df1\u624b\u8d31\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c\u4f60\u7684\u7535\u8111\u4e2d\u6bd2\u4e86\uff0c\u88ab\u6076\u610f\u5bfc\u5165\u4e86\u4e2d\u95f4\u4eba\u7684\u6839\u8bc1\u4e66\uff0c\u90a3\u4e48\u5728\u9a8c\u8bc1\u4e2d\u95f4\u4eba\u7684\u8bc1\u4e66\u7684\u65f6\u5019\uff0c\u7531\u4e8e\u4f60\u64cd\u4f5c\u7cfb\u7edf\u4fe1\u4efb\u4e86\u4e2d\u95f4\u4eba\u7684\u6839\u8bc1\u4e66\uff0c\u90a3\u4e48\u7b49\u540c\u4e8e\u4e2d\u95f4\u4eba\u7684\u8bc1\u4e66\u662f\u5408\u6cd5\u7684\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u6d4f\u89c8\u5668\u662f\u4e0d\u4f1a\u5f39\u51fa\u8bc1\u4e66\u5b58\u5728\u95ee\u9898\u7684\u98ce\u9669\u63d0\u9192\u7684\u3002</p> <p>\u8fd9\u5176\u5b9e\u4e5f\u4e0d\u5173 HTTPS \u7684\u4e8b\u60c5\uff0c\u662f\u4f60\u7535\u8111\u4e2d\u6bd2\u4e86\u624d\u5bfc\u81f4 HTTPS \u6570\u636e\u88ab\u4e2d\u95f4\u4eba\u52ab\u6301\u7684\u3002</p> <p>\u6240\u4ee5\uff0cHTTPS \u534f\u8bae\u672c\u8eab\u5230\u76ee\u524d\u4e3a\u6b62\u8fd8\u662f\u6ca1\u6709\u4efb\u4f55\u6f0f\u6d1e\u7684\uff0c\u5373\u4f7f\u4f60\u6210\u529f\u8fdb\u884c\u4e2d\u95f4\u4eba\u653b\u51fb\uff0c\u672c\u8d28\u4e0a\u662f\u5229\u7528\u4e86\u5ba2\u6237\u7aef\u7684\u6f0f\u6d1e\uff08\u7528\u6237\u70b9\u51fb\u7ee7\u7eed\u8bbf\u95ee\u6216\u8005\u88ab\u6076\u610f\u5bfc\u5165\u4f2a\u9020\u7684\u6839\u8bc1\u4e66\uff09\uff0c\u5e76\u4e0d\u662f HTTPS \u4e0d\u591f\u5b89\u5168\u3002</p> <p>\u4e3a\u4ec0\u4e48\u6293\u5305\u5de5\u5177\u80fd\u622a\u53d6 HTTPS \u6570\u636e\uff1f</p> <p>\u5f88\u591a\u6293\u5305\u5de5\u5177 \u4e4b\u6240\u4ee5\u53ef\u4ee5\u660e\u6587\u770b\u5230 HTTPS \u6570\u636e\uff0c\u5de5\u4f5c\u539f\u7406\u4e0e\u4e2d\u95f4\u4eba\u4e00\u81f4\u7684\u3002</p> <p>\u5bf9\u4e8e HTTPS \u8fde\u63a5\u6765\u8bf4\uff0c\u4e2d\u95f4\u4eba\u8981\u6ee1\u8db3\u4ee5\u4e0b\u4e24\u70b9\uff0c\u624d\u80fd\u5b9e\u73b0\u771f\u6b63\u7684\u660e\u6587\u4ee3\u7406\uff1a</p> <ol> <li>\u4e2d\u95f4\u4eba\uff0c\u4f5c\u4e3a\u5ba2\u6237\u7aef\u4e0e\u771f\u5b9e\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\u8fd9\u4e00\u6b65\u4e0d\u4f1a\u6709\u95ee\u9898\uff0c\u56e0\u4e3a\u670d\u52a1\u7aef\u4e0d\u4f1a\u6821\u9a8c\u5ba2\u6237\u7aef\u7684\u8eab\u4efd\uff1b</li> <li>\u4e2d\u95f4\u4eba\uff0c\u4f5c\u4e3a\u670d\u52a1\u7aef\u4e0e\u771f\u5b9e\u5ba2\u6237\u7aef\u5efa\u7acb\u8fde\u63a5\uff0c\u8fd9\u91cc\u4f1a\u6709\u5ba2\u6237\u7aef\u4fe1\u4efb\u670d\u52a1\u7aef\u7684\u95ee\u9898\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u7aef\u5fc5\u987b\u6709\u5bf9\u5e94\u57df\u540d\u7684\u79c1\u94a5\uff1b</li> </ol> <p>\u4e2d\u95f4\u4eba\u8981\u62ff\u5230\u79c1\u94a5\u53ea\u80fd\u901a\u8fc7\u5982\u4e0b\u65b9\u5f0f\uff1a</p> <ol> <li>\u53bb\u7f51\u7ad9\u670d\u52a1\u7aef\u62ff\u5230\u79c1\u94a5\uff1b</li> <li>\u53bb CA \u5904\u62ff\u57df\u540d\u7b7e\u53d1\u79c1\u94a5\uff1b</li> <li>\u81ea\u5df1\u7b7e\u53d1\u53d7\u6d4f\u89c8\u5668\u4fe1\u4efb\u7684\u8bc1\u4e66\uff1b</li> </ol> <p>\u4e0d\u7528\u89e3\u91ca\uff0c\u6293\u5305\u5de5\u5177\u53ea\u80fd\u4f7f\u7528\u7b2c\u4e09\u79cd\u65b9\u5f0f\u53d6\u5f97\u4e2d\u95f4\u4eba\u7684\u8eab\u4efd\u3002</p> <p>\u56e0\u6b64\u4f7f\u7528\u6293\u5305\u5de5\u5177\u8fdb\u884c HTTPS \u6293\u5305\u7684\u65f6\u5019\uff0c\u6293\u5305\u5de5\u5177\u4f1a\u751f\u6210\u6839\u8bc1\u4e66\uff0c\u5bfc\u5165\u5230\u5ba2\u6237\u7aef\u7cfb\u7edf\u7684 \u53d7\u4fe1\u4efb\u7684\u6839\u8bc1\u4e66\u5217\u8868 \u4e2d\uff0c\u8fd9\u91cc\u7684\u6839\u8bc1\u4e66\u5b9e\u9645\u4e0a\u8d77\u8ba4\u8bc1\u4e2d\u5fc3\uff08CA\uff09\u7684\u4f5c\u7528\u3002  </p> <p>\u968f\u540e\u6293\u5305\u5de5\u5177\u4f7f\u7528\u8be5\u6839\u8bc1\u4e66\u7b7e\u53d1\u57df\u540d\u7684\u8bc1\u4e66\uff0c\u56e0\u4e3a\u6839\u8bc1\u4e66\u53d7\u4fe1\u4efb\uff0c\u57df\u540d\u7684\u8bc1\u4e66\u540c\u6837\u4f1a\u88ab\u6d4f\u89c8\u5668\u4fe1\u4efb\u3002\u4e5f\u5c31\u662f\u6293\u5305\u5de5\u5177\u7ed9\u81ea\u5df1\u521b\u5efa\u4e86\u4e00\u4e2a\u8ba4\u8bc1\u4e2d\u5fc3 CA\uff0c\u5ba2\u6237\u7aef\u62ff\u7740\u4e2d\u95f4\u4eba\uff08\u6293\u5305\u5de5\u5177\uff09\u7b7e\u53d1\u7684\u8bc1\u4e66\u53bb\u4e2d\u95f4\u4eba\uff08\u6293\u5305\u5de5\u5177\uff09\u81ea\u5df1\u7684 CA \u505a\u8ba4\u8bc1\uff0c\u8fd9\u4e2a\u8bc1\u4e66\u5f53\u7136\u88ab\u8ba4\u4e3a\u662f\u6709\u6548\u7684\u3002  </p> <p>\u5982\u4f55\u907f\u514d\u88ab\u4e2d\u95f4\u4eba\u6293\u53d6\u6570\u636e\uff1f</p> <p>\u6211\u4eec\u8981\u4fdd\u8bc1\u81ea\u5df1\u7535\u8111\u7684\u5b89\u5168\uff0c\u4e0d\u8981\u88ab\u75c5\u6bd2\u4e58\u865a\u800c\u5165\uff0c\u800c\u4e14\u4e5f\u4e0d\u8981\u70b9\u51fb\u4efb\u4f55\u8bc1\u4e66\u975e\u6cd5\u7684\u7f51\u7ad9\uff0c\u8fd9\u6837 HTTPS \u6570\u636e\u5c31\u4e0d\u4f1a\u88ab\u4e2d\u95f4\u4eba\u622a\u53d6\u5230\u4e86\u3002</p> <p>\u5f53\u7136\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u901a\u8fc7 HTTPS \u53cc\u5411\u8ba4\u8bc1\u6765\u907f\u514d\u8fd9\u79cd\u95ee\u9898\u3002</p> <p>\u4e00\u822c\u6211\u4eec\u7684 HTTPS \u662f\u5355\u5411\u8ba4\u8bc1\uff0c\u5ba2\u6237\u7aef\u53ea\u4f1a\u9a8c\u8bc1\u4e86\u670d\u52a1\u7aef\u7684\u8eab\u4efd\uff0c\u4f46\u662f\u670d\u52a1\u7aef\u5e76\u4e0d\u4f1a\u9a8c\u8bc1\u5ba2\u6237\u7aef\u7684\u8eab\u4efd\u3002</p> <p></p> <p>\u5982\u679c\u7528\u4e86\u53cc\u5411\u8ba4\u8bc1\u65b9\u5f0f\uff0c\u4e0d\u4ec5\u5ba2\u6237\u7aef\u4f1a\u9a8c\u8bc1\u670d\u52a1\u7aef\u7684\u8eab\u4efd\uff0c\u800c\u4e14\u670d\u52a1\u7aef\u4e5f\u4f1a\u9a8c\u8bc1\u5ba2\u6237\u7aef\u7684\u8eab\u4efd\u3002\u670d\u52a1\u7aef\u4e00\u65e6\u9a8c\u8bc1\u5230\u8bf7\u6c42\u81ea\u5df1\u7684\u5ba2\u6237\u7aef\u4e3a\u4e0d\u53ef\u4fe1\u4efb\u7684\uff0c\u670d\u52a1\u7aef\u5c31\u62d2\u7edd\u7ee7\u7eed\u901a\u4fe1\uff0c\u5ba2\u6237\u7aef\u5982\u679c\u53d1\u73b0\u670d\u52a1\u7aef\u4e3a\u4e0d\u53ef\u4fe1\u4efb\u7684\uff0c\u90a3\u4e48\u4e5f\u4e2d\u6b62\u901a\u4fe1\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http11http2http3","title":"HTTP/1.1\u3001HTTP/2\u3001HTTP/3 \u6f14\u53d8","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http11-http10","title":"HTTP/1.1 \u76f8\u6bd4 HTTP/1.0 \u63d0\u9ad8\u4e86\u4ec0\u4e48\u6027\u80fd\uff1f","text":"<p>HTTP/1.1 \u76f8\u6bd4 HTTP/1.0 \u6027\u80fd\u4e0a\u7684\u6539\u8fdb\uff1a</p> <ul> <li>\u4f7f\u7528\u957f\u8fde\u63a5\u7684\u65b9\u5f0f\u6539\u5584\u4e86 HTTP/1.0 \u77ed\u8fde\u63a5\u9020\u6210\u7684\u6027\u80fd\u5f00\u9500\u3002</li> <li>\u652f\u6301\u7ba1\u9053\uff08pipeline\uff09\u7f51\u7edc\u4f20\u8f93\uff0c\u53ea\u8981\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u53d1\u51fa\u53bb\u4e86\uff0c\u4e0d\u5fc5\u7b49\u5176\u56de\u6765\uff0c\u5c31\u53ef\u4ee5\u53d1\u7b2c\u4e8c\u4e2a\u8bf7\u6c42\u51fa\u53bb\uff0c\u53ef\u4ee5\u51cf\u5c11\u6574\u4f53\u7684\u54cd\u5e94\u65f6\u95f4\u3002</li> </ul> <p>\u4f46 HTTP/1.1 \u8fd8\u662f\u6709\u6027\u80fd\u74f6\u9888\uff1a</p> <ul> <li>\u8bf7\u6c42 / \u54cd\u5e94\u5934\u90e8\uff08Header\uff09\u672a\u7ecf\u538b\u7f29\u5c31\u53d1\u9001\uff0c\u9996\u90e8\u4fe1\u606f\u8d8a\u591a\u5ef6\u8fdf\u8d8a\u5927\u3002\u53ea\u80fd\u538b\u7f29 <code>Body</code> \u7684\u90e8\u5206\uff1b</li> <li>\u53d1\u9001\u5197\u957f\u7684\u9996\u90e8\u3002\u6bcf\u6b21\u4e92\u76f8\u53d1\u9001\u76f8\u540c\u7684\u9996\u90e8\u9020\u6210\u7684\u6d6a\u8d39\u8f83\u591a\uff1b</li> <li>\u670d\u52a1\u5668\u662f\u6309\u8bf7\u6c42\u7684\u987a\u5e8f\u54cd\u5e94\u7684\uff0c\u5982\u679c\u670d\u52a1\u5668\u54cd\u5e94\u6162\uff0c\u4f1a\u62db\u81f4\u5ba2\u6237\u7aef\u4e00\u76f4\u8bf7\u6c42\u4e0d\u5230\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u961f\u5934\u963b\u585e\uff1b</li> <li>\u6ca1\u6709\u8bf7\u6c42\u4f18\u5148\u7ea7\u63a7\u5236\uff1b</li> <li>\u8bf7\u6c42\u53ea\u80fd\u4ece\u5ba2\u6237\u7aef\u5f00\u59cb\uff0c\u670d\u52a1\u5668\u53ea\u80fd\u88ab\u52a8\u54cd\u5e94\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http2","title":"HTTP/2 \u505a\u4e86\u4ec0\u4e48\u4f18\u5316\uff1f","text":"<p>HTTP/2 \u534f\u8bae\u662f\u57fa\u4e8e HTTPS \u7684\uff0c\u6240\u4ee5 HTTP/2 \u7684\u5b89\u5168\u6027\u4e5f\u662f\u6709\u4fdd\u969c\u7684\u3002</p> <p></p> <p>\u90a3 HTTP/2 \u76f8\u6bd4 HTTP/1.1 \u6027\u80fd\u4e0a\u7684\u6539\u8fdb\uff1a</p> <ul> <li>\u5934\u90e8\u538b\u7f29</li> <li>\u4e8c\u8fdb\u5236\u683c\u5f0f</li> <li>\u5e76\u53d1\u4f20\u8f93</li> <li>\u670d\u52a1\u5668\u4e3b\u52a8\u63a8\u9001\u8d44\u6e90</li> </ul> <p>1. \u5934\u90e8\u538b\u7f29</p> <p>HTTP/2 \u4f1a\u538b\u7f29\u5934\uff08Header\uff09\u5982\u679c\u4f60\u540c\u65f6\u53d1\u51fa\u591a\u4e2a\u8bf7\u6c42\uff0c\u4ed6\u4eec\u7684\u5934\u662f\u4e00\u6837\u7684\u6216\u662f\u76f8\u4f3c\u7684\uff0c\u90a3\u4e48\uff0c\u534f\u8bae\u4f1a\u5e2e\u4f60\u6d88\u9664\u91cd\u590d\u7684\u90e8\u5206\u3002</p> <p>\u8fd9\u5c31\u662f\u6240\u8c13\u7684 <code>HPACK</code> \u7b97\u6cd5\uff1a\u5728\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u540c\u65f6\u7ef4\u62a4\u4e00\u5f20\u5934\u4fe1\u606f\u8868\uff0c\u6240\u6709\u5b57\u6bb5\u90fd\u4f1a\u5b58\u5165\u8fd9\u4e2a\u8868\uff0c\u751f\u6210\u4e00\u4e2a\u7d22\u5f15\u53f7\uff0c\u4ee5\u540e\u5c31\u4e0d\u53d1\u9001\u540c\u6837\u5b57\u6bb5\u4e86\uff0c\u53ea\u53d1\u9001\u7d22\u5f15\u53f7\uff0c\u8fd9\u6837\u5c31\u63d0\u9ad8\u901f\u5ea6\u4e86\u3002</p> <p>2. \u4e8c\u8fdb\u5236\u683c\u5f0f</p> <p>HTTP/2 \u4e0d\u518d\u50cf HTTP/1.1 \u91cc\u7684\u7eaf\u6587\u672c\u5f62\u5f0f\u7684\u62a5\u6587\uff0c\u800c\u662f\u5168\u9762\u91c7\u7528\u4e86\u4e8c\u8fdb\u5236\u683c\u5f0f\uff0c\u5934\u4fe1\u606f\u548c\u6570\u636e\u4f53\u90fd\u662f\u4e8c\u8fdb\u5236\uff0c\u5e76\u4e14\u7edf\u79f0\u4e3a\u5e27\uff08frame\uff09\uff1a\u5934\u4fe1\u606f\u5e27\uff08Headers Frame\uff09\u548c\u6570\u636e\u5e27\uff08Data Frame\uff09\u3002</p> <p></p> <p>\u8fd9\u6837\u867d\u7136\u5bf9\u4eba\u4e0d\u53cb\u597d\uff0c\u4f46\u662f\u5bf9\u8ba1\u7b97\u673a\u975e\u5e38\u53cb\u597d\uff0c\u56e0\u4e3a\u8ba1\u7b97\u673a\u53ea\u61c2\u4e8c\u8fdb\u5236\uff0c\u90a3\u4e48\u6536\u5230\u62a5\u6587\u540e\uff0c\u65e0\u9700\u518d\u5c06\u660e\u6587\u7684\u62a5\u6587\u8f6c\u6210\u4e8c\u8fdb\u5236\uff0c\u800c\u662f\u76f4\u63a5\u89e3\u6790\u4e8c\u8fdb\u5236\u62a5\u6587\uff0c\u8fd9\u589e\u52a0\u4e86\u6570\u636e\u4f20\u8f93\u7684\u6548\u7387\u3002</p> <p>\u6bd4\u5982\u72b6\u6001\u7801 200\uff0c\u5728 HTTP/1.1 \u662f\u7528 '2''0''0' \u4e09\u4e2a\u5b57\u7b26\u6765\u8868\u793a\uff08\u4e8c\u8fdb\u5236\uff1a00110010 00110000 00110000\uff09\uff0c\u5171\u7528\u4e86 3 \u4e2a\u5b57\u8282\uff0c\u5982\u4e0b\u56fe</p> <p></p> <p>\u5728 HTTP/2 \u5bf9\u4e8e\u72b6\u6001\u7801 200 \u7684\u4e8c\u8fdb\u5236\u7f16\u7801\u662f 10001000\uff0c\u53ea\u7528\u4e86 1 \u5b57\u8282\u5c31\u80fd\u8868\u793a\uff0c\u76f8\u6bd4\u4e8e HTTP/1.1 \u8282\u7701\u4e86 2 \u4e2a\u5b57\u8282\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>Header: :status: 200 OK \u7684\u7f16\u7801\u5185\u5bb9\u4e3a\uff1a1000 1000\uff0c\u90a3\u4e48\u8868\u8fbe\u7684\u542b\u4e49\u662f\u4ec0\u4e48\u5462\uff1f</p> <p></p> <ol> <li>\u6700\u524d\u9762\u7684 1 \u8868\u793a\u8be5 Header \u662f\u9759\u6001\u8868\u4e2d\u5df2\u7ecf\u5b58\u5728\u7684 KV\u3002\uff08\u81f3\u4e8e\u4ec0\u4e48\u662f\u9759\u6001\u8868\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1aHTTP/2 \u725b\u903c\u5728\u54ea\uff1f\uff09</li> <li>\u5728\u9759\u6001\u8868\u7406\uff0c\u201c:status: 200 ok\u201d\u9759\u6001\u8868\u7f16\u7801\u662f 8\uff0c\u4e8c\u8fdb\u5236\u5373\u662f 1000\u3002</li> </ol> <p>\u56e0\u6b64\uff0c\u6574\u4f53\u52a0\u8d77\u6765\u5c31\u662f 1000 1000\u3002</p> <p>3. \u5e76\u53d1\u4f20\u8f93</p> <p>\u6211\u4eec\u90fd\u77e5\u9053 HTTP/1.1 \u7684\u5b9e\u73b0\u662f\u57fa\u4e8e\u8bf7\u6c42 - \u54cd\u5e94\u6a21\u578b\u7684\u3002\u540c\u4e00\u4e2a\u8fde\u63a5\u4e2d\uff0cHTTP \u5b8c\u6210\u4e00\u4e2a\u4e8b\u52a1\uff08\u8bf7\u6c42\u4e0e\u54cd\u5e94\uff09\uff0c\u624d\u80fd\u5904\u7406\u4e0b\u4e00\u4e2a\u4e8b\u52a1\uff0c\u4e5f\u5c31\u662f\u8bf4\u5728\u53d1\u51fa\u8bf7\u6c42\u7b49\u5f85\u54cd\u5e94\u7684\u8fc7\u7a0b\u4e2d\uff0c\u662f\u6ca1\u529e\u6cd5\u505a\u5176\u4ed6\u4e8b\u60c5\u7684\uff0c\u5982\u679c\u54cd\u5e94\u8fdf\u8fdf\u4e0d\u6765\uff0c\u90a3\u4e48\u540e\u7eed\u7684\u8bf7\u6c42\u662f\u65e0\u6cd5\u53d1\u9001\u7684\uff0c\u4e5f\u9020\u6210\u4e86\u961f\u5934\u963b\u585e\u7684\u95ee\u9898\u3002</p> <p>\u800c HTTP/2 \u5c31\u5f88\u725b\u903c\u4e86\uff0c\u5f15\u51fa\u4e86 Stream \u6982\u5ff5\uff0c\u591a\u4e2a Stream \u590d\u7528\u5728\u4e00\u6761 TCP \u8fde\u63a5\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u770b\u5230\uff0c1 \u4e2a TCP \u8fde\u63a5\u5305\u542b\u591a\u4e2a Stream\uff0cStream \u91cc\u53ef\u4ee5\u5305\u542b 1 \u4e2a\u6216\u591a\u4e2a Message\uff0cMessage \u5bf9\u5e94 HTTP/1 \u4e2d\u7684\u8bf7\u6c42\u6216\u54cd\u5e94\uff0c\u7531 HTTP \u5934\u90e8\u548c\u5305\u4f53\u6784\u6210\u3002Message \u91cc\u5305\u542b\u4e00\u6761\u6216\u8005\u591a\u4e2a Frame\uff0cFrame \u662f HTTP/2 \u6700\u5c0f\u5355\u4f4d\uff0c\u4ee5\u4e8c\u8fdb\u5236\u538b\u7f29\u683c\u5f0f\u5b58\u653e HTTP/1 \u4e2d\u7684\u5185\u5bb9\uff08\u5934\u90e8\u548c\u5305\u4f53\uff09\u3002</p> <p>\u9488\u5bf9\u4e0d\u540c\u7684 HTTP \u8bf7\u6c42\u7528\u72ec\u4e00\u65e0\u4e8c\u7684 Stream ID \u6765\u533a\u5206\uff0c\u63a5\u6536\u7aef\u53ef\u4ee5\u901a\u8fc7 Stream ID \u6709\u5e8f\u7ec4\u88c5\u6210 HTTP \u6d88\u606f\uff0c\u4e0d\u540c Stream \u7684\u5e27\u662f\u53ef\u4ee5\u4e71\u5e8f\u53d1\u9001\u7684\uff0c\u56e0\u6b64\u53ef\u4ee5\u5e76\u53d1\u4e0d\u540c\u7684 Stream\uff0c\u4e5f\u5c31\u662f HTTP/2 \u53ef\u4ee5\u5e76\u884c\u4ea4\u9519\u5730\u53d1\u9001\u8bf7\u6c42\u548c\u54cd\u5e94\u3002</p> <p>\u6bd4\u5982\u4e0b\u56fe\uff0c\u670d\u52a1\u7aef\u5e76\u884c\u4ea4\u9519\u5730\u53d1\u9001\u4e86\u4e24\u4e2a\u54cd\u5e94\uff1aStream 1 \u548c Stream 3\uff0c\u8fd9\u4e24\u4e2a Stream \u90fd\u662f\u8dd1\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e0a\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\uff0c\u4f1a\u6839\u636e\u76f8\u540c\u7684 Stream ID \u6709\u5e8f\u7ec4\u88c5\u6210 HTTP \u6d88\u606f\u3002</p> <p></p> <p>4\u3001\u670d\u52a1\u5668\u63a8\u9001</p> <p>HTTP/2 \u8fd8\u5728\u4e00\u5b9a\u7a0b\u5ea6\u4e0a\u6539\u5584\u4e86\u4f20\u7edf\u7684\u300c\u8bf7\u6c42 - \u5e94\u7b54\u300d\u5de5\u4f5c\u6a21\u5f0f\uff0c\u670d\u52a1\u7aef\u4e0d\u518d\u662f\u88ab\u52a8\u5730\u54cd\u5e94\uff0c\u53ef\u4ee5\u4e3b\u52a8\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u6d88\u606f\u3002</p> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53cc\u65b9\u90fd\u53ef\u4ee5\u5efa\u7acb Stream\uff0cStream ID \u4e5f\u662f\u6709\u533a\u522b\u7684\uff0c\u5ba2\u6237\u7aef\u5efa\u7acb\u7684 Stream \u5fc5\u987b\u662f\u5947\u6570\u53f7\uff0c\u800c\u670d\u52a1\u5668\u5efa\u7acb\u7684 Stream \u5fc5\u987b\u662f\u5076\u6570\u53f7\u3002</p> <p>\u6bd4\u5982\u4e0b\u56fe\uff0cStream 1 \u662f\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u8bf7\u6c42\u7684\u8d44\u6e90\uff0c\u5c5e\u4e8e\u5ba2\u6237\u7aef\u5efa\u7acb\u7684 Stream\uff0c\u6240\u4ee5\u8be5 Stream \u7684 ID \u662f\u5947\u6570\uff08\u6570\u5b57 1\uff09\uff1bStream 2 \u548c 4 \u90fd\u662f\u670d\u52a1\u7aef\u4e3b\u52a8\u5411\u5ba2\u6237\u7aef\u63a8\u9001\u7684\u8d44\u6e90\uff0c\u5c5e\u4e8e\u670d\u52a1\u7aef\u5efa\u7acb\u7684 Stream\uff0c\u6240\u4ee5\u8fd9\u4e24\u4e2a Stream \u7684 ID \u662f\u5076\u6570\uff08\u6570\u5b57 2 \u548c 4\uff09\u3002</p> <p></p> <p>\u518d\u6bd4\u5982\uff0c\u5ba2\u6237\u7aef\u901a\u8fc7 HTTP/1.1 \u8bf7\u6c42\u4ece\u670d\u52a1\u5668\u90a3\u83b7\u53d6\u5230\u4e86 HTML \u6587\u4ef6\uff0c\u800c HTML \u53ef\u80fd\u8fd8\u9700\u8981\u4f9d\u8d56 CSS \u6765\u6e32\u67d3\u9875\u9762\uff0c\u8fd9\u65f6\u5ba2\u6237\u7aef\u8fd8\u8981\u518d\u53d1\u8d77\u83b7\u53d6 CSS \u6587\u4ef6\u7684\u8bf7\u6c42\uff0c\u9700\u8981\u4e24\u6b21\u6d88\u606f\u5f80\u8fd4\uff0c\u5982\u4e0b\u56fe\u5de6\u8fb9\u90e8\u5206\uff1a</p> <p></p> <p>\u5982\u4e0a\u56fe\u53f3\u8fb9\u90e8\u5206\uff0c\u5728 HTTP/2 \u4e2d\uff0c\u5ba2\u6237\u7aef\u5728\u8bbf\u95ee HTML \u65f6\uff0c\u670d\u52a1\u5668\u53ef\u4ee5\u76f4\u63a5\u4e3b\u52a8\u63a8\u9001 CSS \u6587\u4ef6\uff0c\u51cf\u5c11\u4e86\u6d88\u606f\u4f20\u9012\u7684\u6b21\u6570\u3002</p> <p>HTTP/2 \u6709\u4ec0\u4e48\u7f3a\u9677\uff1f</p> <p>HTTP/2 \u901a\u8fc7 Stream \u7684\u5e76\u53d1\u80fd\u529b\uff0c\u89e3\u51b3\u4e86 HTTP/1 \u961f\u5934\u963b\u585e\u7684\u95ee\u9898\uff0c\u770b\u4f3c\u5f88\u5b8c\u7f8e\u4e86\uff0c\u4f46\u662f HTTP/2 \u8fd8\u662f\u5b58\u5728\u201c\u961f\u5934\u963b\u585e\u201d\u7684\u95ee\u9898\uff0c\u53ea\u4e0d\u8fc7\u95ee\u9898\u4e0d\u662f\u5728 HTTP \u8fd9\u4e00\u5c42\u9762\uff0c\u800c\u662f\u5728 TCP \u8fd9\u4e00\u5c42\u3002</p> <p>HTTP/2 \u662f\u57fa\u4e8e TCP \u534f\u8bae\u6765\u4f20\u8f93\u6570\u636e\u7684\uff0cTCP \u662f\u5b57\u8282\u6d41\u534f\u8bae\uff0cTCP \u5c42\u5fc5\u987b\u4fdd\u8bc1\u6536\u5230\u7684\u5b57\u8282\u6570\u636e\u662f\u5b8c\u6574\u4e14\u8fde\u7eed\u7684\uff0c\u8fd9\u6837\u5185\u6838\u624d\u4f1a\u5c06\u7f13\u51b2\u533a\u91cc\u7684\u6570\u636e\u8fd4\u56de\u7ed9 HTTP \u5e94\u7528\uff0c\u90a3\u4e48\u5f53\u300c\u524d 1 \u4e2a\u5b57\u8282\u6570\u636e\u300d\u6ca1\u6709\u5230\u8fbe\u65f6\uff0c\u540e\u6536\u5230\u7684\u5b57\u8282\u6570\u636e\u53ea\u80fd\u5b58\u653e\u5728\u5185\u6838\u7f13\u51b2\u533a\u91cc\uff0c\u53ea\u6709\u7b49\u5230\u8fd9 1 \u4e2a\u5b57\u8282\u6570\u636e\u5230\u8fbe\u65f6\uff0cHTTP/2 \u5e94\u7528\u5c42\u624d\u80fd\u4ece\u5185\u6838\u4e2d\u62ff\u5230\u6570\u636e\uff0c\u8fd9\u5c31\u662f HTTP/2 \u961f\u5934\u963b\u585e\u95ee\u9898\u3002</p> <p></p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u56fe\u4e2d\u53d1\u9001\u65b9\u53d1\u9001\u4e86\u5f88\u591a\u4e2a packet\uff0c\u6bcf\u4e2a packet \u90fd\u6709\u81ea\u5df1\u7684\u5e8f\u53f7\uff0c\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u662f TCP \u7684\u5e8f\u5217\u53f7\uff0c\u5176\u4e2d packet 3 \u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u4e86\uff0c\u5373\u4f7f packet 4-6 \u88ab\u63a5\u6536\u65b9\u6536\u5230\u540e\uff0c\u7531\u4e8e\u5185\u6838\u4e2d\u7684 TCP \u6570\u636e\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u4e8e\u662f\u63a5\u6536\u65b9\u7684\u5e94\u7528\u5c42\u5c31\u65e0\u6cd5\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u5230\uff0c\u53ea\u6709\u7b49\u5230 packet 3 \u91cd\u4f20\u540e\uff0c\u63a5\u6536\u65b9\u7684\u5e94\u7528\u5c42\u624d\u53ef\u4ee5\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u5230\u6570\u636e\uff0c\u8fd9\u5c31\u662f HTTP/2 \u7684\u961f\u5934\u963b\u585e\u95ee\u9898\uff0c\u662f\u5728 TCP \u5c42\u9762\u53d1\u751f\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u4e00\u65e6\u53d1\u751f\u4e86\u4e22\u5305\u73b0\u8c61\uff0c\u5c31\u4f1a\u89e6\u53d1 TCP \u7684\u91cd\u4f20\u673a\u5236\uff0c\u8fd9\u6837\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\u7684\u6240\u6709\u7684 HTTP \u8bf7\u6c42\u90fd\u5fc5\u987b\u7b49\u5f85\u8fd9\u4e2a\u4e22\u4e86\u7684\u5305\u88ab\u91cd\u4f20\u56de\u6765\u3002</p> <p>::: tip</p> <p>\u5982\u679c\u60f3\u66f4\u8fdb\u4e00\u6b65\u4e86\u89e3 HTTP/2 \u534f\u8bae\uff0c\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1aHTTP/2 \u725b\u903c\u5728\u54ea\uff1f</p> <p>:::</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#http3","title":"HTTP/3 \u505a\u4e86\u54ea\u4e9b\u4f18\u5316\uff1f","text":"<p>\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86 HTTP/1.1 \u548c HTTP/2 \u90fd\u6709\u961f\u5934\u963b\u585e\u7684\u95ee\u9898\uff1a</p> <ul> <li>HTTP/1.1 \u4e2d\u7684\u7ba1\u9053\uff08pipeline\uff09\u867d\u7136\u89e3\u51b3\u4e86\u8bf7\u6c42\u7684\u961f\u5934\u963b\u585e\uff0c\u4f46\u662f\u6ca1\u6709\u89e3\u51b3\u54cd\u5e94\u7684\u961f\u5934\u963b\u585e\uff0c\u56e0\u4e3a\u670d\u52a1\u7aef\u9700\u8981\u6309\u987a\u5e8f\u54cd\u5e94\u6536\u5230\u7684\u8bf7\u6c42\uff0c\u5982\u679c\u670d\u52a1\u7aef\u5904\u7406\u67d0\u4e2a\u8bf7\u6c42\u6d88\u8017\u7684\u65f6\u95f4\u6bd4\u8f83\u957f\uff0c\u90a3\u4e48\u53ea\u80fd\u7b49\u54cd\u5e94\u5b8c\u8fd9\u4e2a\u8bf7\u6c42\u540e\uff0c\u624d\u80fd\u5904\u7406\u4e0b\u4e00\u4e2a\u8bf7\u6c42\uff0c\u8fd9\u5c5e\u4e8e HTTP \u5c42\u961f\u5934\u963b\u585e\u3002</li> <li>HTTP/2 \u867d\u7136\u901a\u8fc7\u591a\u4e2a\u8bf7\u6c42\u590d\u7528\u4e00\u4e2a TCP \u8fde\u63a5\u89e3\u51b3\u4e86 HTTP \u7684\u961f\u5934\u963b\u585e\uff0c\u4f46\u662f\u4e00\u65e6\u53d1\u751f\u4e22\u5305\uff0c\u5c31\u4f1a\u963b\u585e\u4f4f\u6240\u6709\u7684 HTTP \u8bf7\u6c42\uff0c\u8fd9\u5c5e\u4e8e TCP \u5c42\u961f\u5934\u963b\u585e\u3002</li> </ul> <p>HTTP/2 \u961f\u5934\u963b\u585e\u7684\u95ee\u9898\u662f\u56e0\u4e3a TCP\uff0c\u6240\u4ee5 HTTP/3 \u628a HTTP \u4e0b\u5c42\u7684 TCP \u534f\u8bae\u6539\u6210\u4e86 UDP\uff01</p> <p></p> <p>UDP \u53d1\u9001\u662f\u4e0d\u7ba1\u987a\u5e8f\uff0c\u4e5f\u4e0d\u7ba1\u4e22\u5305\u7684\uff0c\u6240\u4ee5\u4e0d\u4f1a\u51fa\u73b0\u50cf HTTP/2 \u961f\u5934\u963b\u585e\u7684\u95ee\u9898\u3002\u5927\u5bb6\u90fd\u77e5\u9053 UDP \u662f\u4e0d\u53ef\u9760\u4f20\u8f93\u7684\uff0c\u4f46\u57fa\u4e8e UDP \u7684 QUIC \u534f\u8bae \u53ef\u4ee5\u5b9e\u73b0\u7c7b\u4f3c TCP \u7684\u53ef\u9760\u6027\u4f20\u8f93\u3002</p> <p>QUIC \u6709\u4ee5\u4e0b 3 \u4e2a\u7279\u70b9\u3002</p> <ul> <li>\u65e0\u961f\u5934\u963b\u585e</li> <li>\u66f4\u5feb\u7684\u8fde\u63a5\u5efa\u7acb</li> <li>\u8fde\u63a5\u8fc1\u79fb</li> </ul> <p>1\u3001\u65e0\u961f\u5934\u963b\u585e</p> <p>QUIC \u534f\u8bae\u4e5f\u6709\u7c7b\u4f3c HTTP/2 Stream \u4e0e\u591a\u8def\u590d\u7528\u7684\u6982\u5ff5\uff0c\u4e5f\u662f\u53ef\u4ee5\u5728\u540c\u4e00\u6761\u8fde\u63a5\u4e0a\u5e76\u53d1\u4f20\u8f93\u591a\u4e2a Stream\uff0cStream \u53ef\u4ee5\u8ba4\u4e3a\u5c31\u662f\u4e00\u6761 HTTP \u8bf7\u6c42\u3002</p> <p>QUIC \u6709\u81ea\u5df1\u7684\u4e00\u5957\u673a\u5236\u53ef\u4ee5\u4fdd\u8bc1\u4f20\u8f93\u7684\u53ef\u9760\u6027\u7684\u3002\u5f53\u67d0\u4e2a\u6d41\u53d1\u751f\u4e22\u5305\u65f6\uff0c\u53ea\u4f1a\u963b\u585e\u8fd9\u4e2a\u6d41\uff0c\u5176\u4ed6\u6d41\u4e0d\u4f1a\u53d7\u5230\u5f71\u54cd\uff0c\u56e0\u6b64\u4e0d\u5b58\u5728\u961f\u5934\u963b\u585e\u95ee\u9898\u3002\u8fd9\u4e0e HTTP/2 \u4e0d\u540c\uff0cHTTP/2 \u53ea\u8981\u67d0\u4e2a\u6d41\u4e2d\u7684\u6570\u636e\u5305\u4e22\u5931\u4e86\uff0c\u5176\u4ed6\u6d41\u4e5f\u4f1a\u56e0\u6b64\u53d7\u5f71\u54cd\u3002</p> <p>\u6240\u4ee5\uff0cQUIC \u8fde\u63a5\u4e0a\u7684\u591a\u4e2a Stream \u4e4b\u95f4\u5e76\u6ca1\u6709\u4f9d\u8d56\uff0c\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u67d0\u4e2a\u6d41\u53d1\u751f\u4e22\u5305\u4e86\uff0c\u53ea\u4f1a\u5f71\u54cd\u8be5\u6d41\uff0c\u5176\u4ed6\u6d41\u4e0d\u53d7\u5f71\u54cd\u3002</p> <p></p> <p>2\u3001\u66f4\u5feb\u7684\u8fde\u63a5\u5efa\u7acb</p> <p>\u5bf9\u4e8e HTTP/1 \u548c HTTP/2 \u534f\u8bae\uff0cTCP \u548c TLS \u662f\u5206\u5c42\u7684\uff0c\u5206\u522b\u5c5e\u4e8e\u5185\u6838\u5b9e\u73b0\u7684\u4f20\u8f93\u5c42\u3001openssl \u5e93\u5b9e\u73b0\u7684\u8868\u793a\u5c42\uff0c\u56e0\u6b64\u5b83\u4eec\u96be\u4ee5\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u9700\u8981\u5206\u6279\u6b21\u6765\u63e1\u624b\uff0c\u5148 TCP \u63e1\u624b\uff0c\u518d TLS \u63e1\u624b\u3002</p> <p>HTTP/3 \u5728\u4f20\u8f93\u6570\u636e\u524d\u867d\u7136\u9700\u8981 QUIC \u534f\u8bae\u63e1\u624b\uff0c\u4f46\u8fd9\u4e2a\u63e1\u624b\u8fc7\u7a0b\u53ea\u9700\u8981 1 RTT\uff0c\u63e1\u624b\u7684\u76ee\u7684\u662f\u4e3a\u786e\u8ba4\u53cc\u65b9\u7684\u300c\u8fde\u63a5 ID\u300d\uff0c\u8fde\u63a5\u8fc1\u79fb\u5c31\u662f\u57fa\u4e8e\u8fde\u63a5 ID \u5b9e\u73b0\u7684\u3002</p> <p>\u4f46\u662f HTTP/3 \u7684 QUIC \u534f\u8bae\u5e76\u4e0d\u662f\u4e0e TLS \u5206\u5c42\uff0c\u800c\u662f QUIC \u5185\u90e8\u5305\u542b\u4e86 TLS\uff0c\u5b83\u5728\u81ea\u5df1\u7684\u5e27\u4f1a\u643a\u5e26 TLS \u91cc\u7684\u201c\u8bb0\u5f55\u201d\uff0c\u518d\u52a0\u4e0a QUIC \u4f7f\u7528\u7684\u662f TLS/1.3\uff0c\u56e0\u6b64\u4ec5\u9700 1 \u4e2a RTT \u5c31\u53ef\u4ee5\u300c\u540c\u65f6\u300d\u5b8c\u6210\u5efa\u7acb\u8fde\u63a5\u4e0e\u5bc6\u94a5\u534f\u5546\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u751a\u81f3\uff0c\u5728\u7b2c\u4e8c\u6b21\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u5e94\u7528\u6570\u636e\u5305\u53ef\u4ee5\u548c QUIC \u63e1\u624b\u4fe1\u606f\uff08\u8fde\u63a5\u4fe1\u606f + TLS \u4fe1\u606f\uff09\u4e00\u8d77\u53d1\u9001\uff0c\u8fbe\u5230 0-RTT \u7684\u6548\u679c\u3002</p> <p>\u5982\u4e0b\u56fe\u53f3\u8fb9\u90e8\u5206\uff0cHTTP/3 \u5f53\u4f1a\u8bdd\u6062\u590d\u65f6\uff0c\u6709\u6548\u8d1f\u8f7d\u6570\u636e\u4e0e\u7b2c\u4e00\u4e2a\u6570\u636e\u5305\u4e00\u8d77\u53d1\u9001\uff0c\u53ef\u4ee5\u505a\u5230 0-RTT\uff08\u4e0b\u56fe\u7684\u53f3\u4e0b\u89d2\uff09\uff1a</p> <p></p> <p>3\u3001\u8fde\u63a5\u8fc1\u79fb</p> <p>\u57fa\u4e8e TCP \u4f20\u8f93\u534f\u8bae\u7684 HTTP \u534f\u8bae\uff0c\u7531\u4e8e\u662f\u901a\u8fc7\u56db\u5143\u7ec4\uff08\u6e90 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684 IP\u3001\u76ee\u7684\u7aef\u53e3\uff09\u786e\u5b9a\u4e00\u6761 TCP \u8fde\u63a5\u3002</p> <p></p> <p>\u90a3\u4e48\u5f53\u79fb\u52a8\u8bbe\u5907\u7684\u7f51\u7edc\u4ece 4G \u5207\u6362\u5230 WIFI \u65f6\uff0c\u610f\u5473\u7740 IP \u5730\u5740\u53d8\u5316\u4e86\uff0c\u90a3\u4e48\u5c31\u5fc5\u987b\u8981\u65ad\u5f00\u8fde\u63a5\uff0c\u7136\u540e\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\u3002\u800c\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\u5305\u542b TCP \u4e09\u6b21\u63e1\u624b\u548c TLS \u56db\u6b21\u63e1\u624b\u7684\u65f6\u5ef6\uff0c\u4ee5\u53ca TCP \u6162\u542f\u52a8\u7684\u51cf\u901f\u8fc7\u7a0b\uff0c\u7ed9\u7528\u6237\u7684\u611f\u89c9\u5c31\u662f\u7f51\u7edc\u7a81\u7136\u5361\u987f\u4e86\u4e00\u4e0b\uff0c\u56e0\u6b64\u8fde\u63a5\u7684\u8fc1\u79fb\u6210\u672c\u662f\u5f88\u9ad8\u7684\u3002</p> <p>\u800c QUIC \u534f\u8bae\u6ca1\u6709\u7528\u56db\u5143\u7ec4\u7684\u65b9\u5f0f\u6765\u201c\u7ed1\u5b9a\u201d\u8fde\u63a5\uff0c\u800c\u662f\u901a\u8fc7\u8fde\u63a5 ID \u6765\u6807\u8bb0\u901a\u4fe1\u7684\u4e24\u4e2a\u7aef\u70b9\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53ef\u4ee5\u5404\u81ea\u9009\u62e9\u4e00\u7ec4 ID \u6765\u6807\u8bb0\u81ea\u5df1\uff0c\u56e0\u6b64\u5373\u4f7f\u79fb\u52a8\u8bbe\u5907\u7684\u7f51\u7edc\u53d8\u5316\u540e\uff0c\u5bfc\u81f4 IP \u5730\u5740\u53d8\u5316\u4e86\uff0c\u53ea\u8981\u4ecd\u4fdd\u6709\u4e0a\u4e0b\u6587\u4fe1\u606f\uff08\u6bd4\u5982\u8fde\u63a5 ID\u3001TLS \u5bc6\u94a5\u7b49\uff09\uff0c\u5c31\u53ef\u4ee5\u201c\u65e0\u7f1d\u201d\u5730\u590d\u7528\u539f\u8fde\u63a5\uff0c\u6d88\u9664\u91cd\u8fde\u7684\u6210\u672c\uff0c\u6ca1\u6709\u4e1d\u6beb\u5361\u987f\u611f\uff0c\u8fbe\u5230\u4e86\u8fde\u63a5\u8fc1\u79fb\u7684\u529f\u80fd\u3002</p> <p>\u6240\u4ee5\uff0cQUIC \u662f\u4e00\u4e2a\u5728 UDP \u4e4b\u4e0a\u7684\u4f2a TCP + TLS + HTTP/2 \u7684\u591a\u8def\u590d\u7528\u7684\u534f\u8bae\u3002</p> <p>QUIC \u662f\u65b0\u534f\u8bae\uff0c\u5bf9\u4e8e\u5f88\u591a\u7f51\u7edc\u8bbe\u5907\uff0c\u6839\u672c\u4e0d\u77e5\u9053\u4ec0\u4e48\u662f QUIC\uff0c\u53ea\u4f1a\u5f53\u505a UDP\uff0c\u8fd9\u6837\u4f1a\u51fa\u73b0\u65b0\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u6709\u7684\u7f51\u7edc\u8bbe\u5907\u662f\u4f1a\u4e22\u6389 UDP \u5305\u7684\uff0c\u800c QUIC \u662f\u57fa\u4e8e UDP \u5b9e\u73b0\u7684\uff0c\u90a3\u4e48\u5982\u679c\u7f51\u7edc\u8bbe\u5907\u65e0\u6cd5\u8bc6\u522b\u8fd9\u4e2a\u662f QUIC \u5305\uff0c\u90a3\u4e48\u5c31\u4f1a\u5f53\u4f5c UDP \u5305\uff0c\u7136\u540e\u88ab\u4e22\u5f03\u3002</p> <p>HTTP/3 \u73b0\u5728\u666e\u53ca\u7684\u8fdb\u5ea6\u975e\u5e38\u7684\u7f13\u6162\uff0c\u4e0d\u77e5\u9053\u672a\u6765 UDP \u662f\u5426\u80fd\u591f\u9006\u88ad TCP\u3002</p> <p>::: tip</p> <p>\u5982\u679c\u60f3\u66f4\u8fdb\u4e00\u6b65\u4e86\u89e3 HTTP/3 \u548c QUIC \u534f\u8bae\uff0c\u53ef\u4ee5\u770b\u6211\u8fd9\u4e24\u7bc7\u6587\u7ae0\uff1a</p> <ul> <li>HTTP/3 \u5f3a\u52bf\u6765\u88ad</li> <li>\u5982\u4f55\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\uff1f</li> </ul> <p>:::</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <p>[1] \u4e0a\u91ce \u5ba3\u3002\u56fe\u89e3 HTTP.\u4eba\u6c11\u90ae\u7535\u51fa\u7248\u793e\u3002</p> <p>[2] \u7f57\u5251\u950b\u3002\u900f\u89c6 HTTP \u534f\u8bae\u3002\u6781\u5ba2\u65f6\u95f4\u3002</p> <p>[3] \u9648\u7693.HTTP \u7684\u524d\u4e16\u4eca\u3002\u9177\u58f3 CoolShell.https://coolshell.cn/articles/19840.html</p> <p>[4] \u962e\u4e00\u5cf0.HTTP \u534f\u8bae\u5165\u95e8\u3002\u962e\u4e00\u5cf0\u7684\u7f51\u7edc\u65e5\u5fd7.http://www.ruanyifeng.com/blog/2016/08/http.html</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_interview/#_3","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u8bfb\u8005\u95ee\uff1a\u201chttps \u548c http \u76f8\u6bd4\uff0c\u5c31\u662f\u4f20\u8f93\u7684\u5185\u5bb9\u591a\u4e86\u5bf9\u79f0\u52a0\u5bc6\uff0c\u53ef\u4ee5\u8fd9\u4e48\u7406\u89e3\u5417\uff1f\u201d</p> <ol> <li> <p>\u5efa\u7acb\u8fde\u63a5\u65f6\u5019\uff1ahttps \u6bd4 http \u591a\u4e86 TLS \u7684\u63e1\u624b\u8fc7\u7a0b\uff1b</p> </li> <li> <p>\u4f20\u8f93\u5185\u5bb9\u7684\u65f6\u5019\uff1ahttps \u4f1a\u628a\u6570\u636e\u8fdb\u884c\u52a0\u5bc6\uff0c\u901a\u5e38\u662f\u5bf9\u79f0\u52a0\u5bc6\u6570\u636e\uff1b</p> </li> </ol> <p>\u8bfb\u8005\u95ee\uff1a\u201c\u6211\u770b\u6587\u4e2d TLS \u548c SSL \u6ca1\u6709\u505a\u533a\u5206\uff0c\u8fd9\u4e24\u4e2a\u9700\u8981\u533a\u5206\u5417\uff1f\u201d</p> <p>\u8fd9\u4fe9\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u4e1c\u897f\u3002</p> <p>SSL \u662f\u6d0b\u6587\u201cSecure Sockets Layer\u201d\u7684\u7f29\u5199\uff0c\u4e2d\u6587\u53eb\u505a\u300c\u5b89\u5168\u5957\u63a5\u5c42\u300d\u3002\u5b83\u662f\u5728\u4e0a\u4e16\u7eaa 90 \u5e74\u4ee3\u4e2d\u671f\uff0c\u7531\u7f51\u666f\u516c\u53f8\u8bbe\u8ba1\u7684\u3002</p> <p>\u5230\u4e86 1999 \u5e74\uff0cSSL \u56e0\u4e3a\u5e94\u7528\u5e7f\u6cdb\uff0c\u5df2\u7ecf\u6210\u4e3a\u4e92\u8054\u7f51\u4e0a\u7684\u4e8b\u5b9e\u6807\u51c6\u3002IETF \u5c31\u5728\u90a3\u5e74\u628a SSL \u6807\u51c6\u5316\u3002\u6807\u51c6\u5316\u4e4b\u540e\u7684\u540d\u79f0\u6539\u4e3a TLS\uff08\u662f\u201cTransport Layer Security\u201d\u7684\u7f29\u5199\uff09\uff0c\u4e2d\u6587\u53eb\u505a\u300c\u4f20\u8f93\u5c42\u5b89\u5168\u534f\u8bae\u300d\u3002</p> <p>\u5f88\u591a\u76f8\u5173\u7684\u6587\u7ae0\u90fd\u628a\u8fd9\u4e24\u8005\u5e76\u5217\u79f0\u547c\uff08SSL/TLS\uff09\uff0c\u56e0\u4e3a\u8fd9\u4e24\u8005\u53ef\u4ee5\u89c6\u4f5c\u540c\u4e00\u4e2a\u4e1c\u897f\u7684\u4e0d\u540c\u9636\u6bb5\u3002</p> <p>\u8bfb\u8005\u95ee\uff1a\u201c\u4e3a\u5565 SSL \u7684\u63e1\u624b\u662f 4 \u6b21\uff1f\u201d</p> <p>SSL/TLS 1.2 \u9700\u8981 4 \u63e1\u624b\uff0c\u9700\u8981 2 \u4e2a RTT \u7684\u65f6\u5ef6\uff0c\u6211\u6587\u4e2d\u7684\u56fe\u662f\u628a\u6bcf\u4e2a\u4ea4\u4e92\u5206\u5f00\u753b\u4e86\uff0c\u5b9e\u9645\u4e0a\u628a\u4ed6\u4eec\u5408\u5728\u4e00\u8d77\u53d1\u9001\uff0c\u5c31\u662f 4 \u6b21\u63e1\u624b\uff1a</p> <p></p> <p>\u53e6\u5916\uff0cSSL/TLS 1.3 \u4f18\u5316\u4e86\u8fc7\u7a0b\uff0c\u53ea\u9700\u8981 1 \u4e2a RTT \u5f80\u8fd4\u65f6\u5ef6\uff0c\u4e5f\u5c31\u662f\u53ea\u9700\u8981 3 \u6b21\u63e1\u624b\uff1a</p> <p></p> <p>\u672c\u6587\u7684 <code>30</code> \u5f20\u56fe\u7247\uff0c\u90fd\u662f\u4ece\u4e00\u6761\u7ebf\u4e24\u6761\u7ebf\u753b\u51fa\u6765\uff0c\u7070\u5e38\u7684\u8d39\u52b2\uff0c\u6df1\u5207\u611f\u53d7\u5230\u753b\u56fe\u4e5f\u662f\u4e2a\u4f53\u529b\u6d3b\u554a\uff01 </p> <p>\u7231\u5077\u61d2\u7684\u6211\u5176\u5b9e\u4e0d\u7231\u753b\u56fe\uff0c\u4f46\u4e3a\u4e86\u8ba9\u5927\u5bb6\u80fd\u66f4\u597d\u7684\u7406\u89e3\uff0c\u5728\u8ddf\u81ea\u5df1\u65e0\u6570\u6b21\u6597\u4e89\u540e\uff0c\u8e0f\u4e0a\u4e86\u8017\u65f6\u8017\u4f53\u529b\u7684\u753b\u56fe\u7684\u4e0d\u5f52\u8def\uff0c\u5e0c\u671b\u5bf9\u4f60\u4eec\u6709\u5e2e\u52a9\uff01</p> <p>\u5c0f\u6797\u662f\u4e13\u4e3a\u5927\u5bb6\u56fe\u89e3\u7684\u5de5\u5177\u4eba\uff0cGoodbye\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/","title":"3.2 HTTP/1.1 \u5982\u4f55\u4f18\u5316\uff1f","text":"<p>\u95ee\u4f60\u4e00\u53e5\uff1a\u300c\u4f60\u77e5\u9053 HTTP/1.1 \u8be5\u5982\u4f55\u4f18\u5316\u5417\uff1f\u300d</p> <p>\u6211\u4eec\u53ef\u4ee5\u4ece\u4e0b\u9762\u8fd9\u4e09\u79cd\u4f18\u5316\u601d\u8def\u6765\u4f18\u5316 HTTP/1.1 \u534f\u8bae\uff1a</p> <ul> <li>\u5c3d\u91cf\u907f\u514d\u53d1\u9001 HTTP \u8bf7\u6c42\uff1b</li> <li>\u5728\u9700\u8981\u53d1\u9001 HTTP \u8bf7\u6c42\u65f6\uff0c\u8003\u8651\u5982\u4f55\u51cf\u5c11\u8bf7\u6c42\u6b21\u6570\uff1b</li> <li>\u51cf\u5c11\u670d\u52a1\u5668\u7684 HTTP \u54cd\u5e94\u7684\u6570\u636e\u5927\u5c0f\uff1b</li> </ul> <p>\u4e0b\u9762\uff0c\u5c31\u9488\u5bf9\u8fd9\u4e09\u79cd\u601d\u8def\u5177\u4f53\u770b\u770b\u6709\u54ea\u4e9b\u4f18\u5316\u65b9\u6cd5\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/#http","title":"\u5982\u4f55\u907f\u514d\u53d1\u9001 HTTP \u8bf7\u6c42\uff1f","text":"<p>\u8fd9\u4e2a\u601d\u8def\u4f60\u770b\u5230\u662f\u4e0d\u662f\u89c9\u5f97\u5f88\u5947\u602a\uff0c\u4e0d\u53d1\u9001 HTTP \u8bf7\u6c42\uff0c\u90a3\u5ba2\u6237\u7aef\u8fd8\u600e\u4e48\u548c\u670d\u52a1\u5668\u4ea4\u4e92\u6570\u636e\uff1f\u5c0f\u6797\u4f60\u8fd9\u4e0d\u662f\u800d\u6d41\u6c13\u561b\uff1f</p> <p>\u51b7\u9759\u51b7\u9759\uff0c\u4f60\u8bf4\u7684\u6ca1\u9519\uff0c\u5ba2\u6237\u7aef\u5f53\u7136\u8981\u5411\u670d\u52a1\u5668\u53d1\u9001\u8bf7\u6c42\u7684\u3002</p> <p>\u4f46\u662f\uff0c\u5bf9\u4e8e\u4e00\u4e9b\u5177\u6709\u91cd\u590d\u6027\u7684 HTTP \u8bf7\u6c42\uff0c\u6bd4\u5982\u6bcf\u6b21\u8bf7\u6c42\u5f97\u5230\u7684\u6570\u636e\u90fd\u4e00\u6837\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u628a\u8fd9\u5bf9\u300c\u8bf7\u6c42 - \u54cd\u5e94\u300d\u7684\u6570\u636e\u90fd\u7f13\u5b58\u5728\u672c\u5730\uff0c\u90a3\u4e48\u4e0b\u6b21\u5c31\u76f4\u63a5\u8bfb\u53d6\u672c\u5730\u7684\u6570\u636e\uff0c\u4e0d\u5fc5\u5728\u901a\u8fc7\u7f51\u7edc\u83b7\u53d6\u670d\u52a1\u5668\u7684\u54cd\u5e94\u4e86\uff0c\u8fd9\u6837\u7684\u8bdd HTTP/1.1 \u7684\u6027\u80fd\u80af\u5b9a\u8089\u773c\u53ef\u89c1\u7684\u63d0\u5347\u3002</p> <p>\u6240\u4ee5\uff0c\u907f\u514d\u53d1\u9001 HTTP \u8bf7\u6c42\u7684\u65b9\u6cd5\u5c31\u662f\u901a\u8fc7\u7f13\u5b58\u6280\u672f\uff0cHTTP \u8bbe\u8ba1\u8005\u65e9\u5728\u4e4b\u524d\u5c31\u8003\u8651\u5230\u4e86\u8fd9\u70b9\uff0c\u56e0\u6b64 HTTP \u534f\u8bae\u7684\u5934\u90e8\u6709\u4e0d\u5c11\u662f\u9488\u5bf9\u7f13\u5b58\u7684\u5b57\u6bb5\u3002</p> <p>\u90a3\u7f13\u5b58\u662f\u5982\u4f55\u505a\u5230\u7684\u5462\uff1f</p> <p>\u5ba2\u6237\u7aef\u4f1a\u628a\u7b2c\u4e00\u6b21\u8bf7\u6c42\u4ee5\u53ca\u54cd\u5e94\u7684\u6570\u636e\u4fdd\u5b58\u5728\u672c\u5730\u78c1\u76d8\u4e0a\uff0c\u5176\u4e2d\u5c06\u8bf7\u6c42\u7684 URL \u4f5c\u4e3a key\uff0c\u800c\u54cd\u5e94\u4f5c\u4e3a value\uff0c\u4e24\u8005\u5f62\u6210\u6620\u5c04\u5173\u7cfb\u3002</p> <p>\u8fd9\u6837\u5f53\u540e\u7eed\u53d1\u8d77\u76f8\u540c\u7684\u8bf7\u6c42\u65f6\uff0c\u5c31\u53ef\u4ee5\u5148\u5728\u672c\u5730\u78c1\u76d8\u4e0a\u901a\u8fc7 key \u67e5\u5230\u5bf9\u5e94\u7684 value\uff0c\u4e5f\u5c31\u662f\u54cd\u5e94\uff0c\u5982\u679c\u627e\u5230\u4e86\uff0c\u5c31\u76f4\u63a5\u4ece\u672c\u5730\u8bfb\u53d6\u8be5\u54cd\u5e94\u3002\u6bcb\u5eb8\u7f6e\u7591\uff0c\u8bfb\u53d6\u672c\u5730\u78c1\u76d8\u7684\u901f\u5ea6\u80af\u5b9a\u6bd4\u7f51\u7edc\u8bf7\u6c42\u5feb\u5f97\u591a\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u806a\u660e\u7684\u4f60\u53ef\u80fd\u60f3\u5230\u4e86\uff0c\u4e07\u4e00\u7f13\u5b58\u7684\u54cd\u5e94\u4e0d\u662f\u6700\u65b0\u7684\uff0c\u800c\u5ba2\u6237\u7aef\u5e76\u4e0d\u77e5\u60c5\uff0c\u90a3\u4e48\u8be5\u600e\u4e48\u529e\u5462\uff1f</p> <p>\u653e\u5fc3\uff0c\u8fd9\u4e2a\u95ee\u9898 HTTP \u8bbe\u8ba1\u8005\u65e9\u5df2\u8003\u8651\u5230\u3002</p> <p>\u6240\u4ee5\uff0c\u670d\u52a1\u5668\u5728\u53d1\u9001 HTTP \u54cd\u5e94\u65f6\uff0c\u4f1a\u4f30\u7b97\u4e00\u4e2a\u8fc7\u671f\u7684\u65f6\u95f4\uff0c\u5e76\u628a\u8fd9\u4e2a\u4fe1\u606f\u653e\u5230\u54cd\u5e94\u5934\u90e8\u4e2d\uff0c\u8fd9\u6837\u5ba2\u6237\u7aef\u5728\u67e5\u770b\u54cd\u5e94\u5934\u90e8\u7684\u4fe1\u606f\u65f6\uff0c\u4e00\u65e6\u53d1\u73b0\u7f13\u5b58\u7684\u54cd\u5e94\u662f\u8fc7\u671f\u7684\uff0c\u5219\u5c31\u4f1a\u91cd\u65b0\u53d1\u9001\u7f51\u7edc\u8bf7\u6c42\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u4ece\u7b2c\u4e00\u6b21\u8bf7\u6c42\u5f97\u5230\u7684\u54cd\u5e94\u5934\u90e8\u4e2d\u53d1\u73b0\u8be5\u54cd\u5e94\u8fc7\u671f\u4e86\uff0c\u5ba2\u6237\u7aef\u91cd\u65b0\u53d1\u9001\u8bf7\u6c42\uff0c\u5047\u8bbe\u670d\u52a1\u5668\u4e0a\u7684\u8d44\u6e90\u5e76\u6ca1\u6709\u53d8\u66f4\uff0c\u8fd8\u662f\u8001\u6837\u5b50\uff0c\u90a3\u4e48\u4f60\u89c9\u5f97\u8fd8\u8981\u5728\u670d\u52a1\u5668\u7684\u54cd\u5e94\u5e26\u4e0a\u8fd9\u4e2a\u8d44\u6e90\u5417\uff1f</p> <p>\u5f88\u663e\u7136\u4e0d\u5e26\u7684\u8bdd\uff0c\u53ef\u4ee5\u63d0\u9ad8 HTTP \u534f\u8bae\u7684\u6027\u80fd\uff0c\u90a3\u5177\u4f53\u5982\u4f55\u505a\u5230\u5462\uff1f </p> <p>\u53ea\u9700\u8981\u5ba2\u6237\u7aef\u5728\u91cd\u65b0\u53d1\u9001\u8bf7\u6c42\u65f6\uff0c\u5728\u8bf7\u6c42\u7684 <code>Etag</code> \u5934\u90e8\u5e26\u4e0a\u7b2c\u4e00\u6b21\u8bf7\u6c42\u7684\u54cd\u5e94\u5934\u90e8\u4e2d\u7684\u6458\u8981\uff0c\u8fd9\u4e2a\u6458\u8981\u662f\u552f\u4e00\u6807\u8bc6\u54cd\u5e94\u7684\u8d44\u6e90\uff0c\u5f53\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\uff0c\u4f1a\u5c06\u672c\u5730\u8d44\u6e90\u7684\u6458\u8981\u4e0e\u8bf7\u6c42\u4e2d\u7684\u6458\u8981\u505a\u4e2a\u6bd4\u8f83\u3002</p> <p>\u5982\u679c\u4e0d\u540c\uff0c\u90a3\u4e48\u8bf4\u660e\u5ba2\u6237\u7aef\u7684\u7f13\u5b58\u5df2\u7ecf\u6ca1\u6709\u4ef7\u503c\uff0c\u670d\u52a1\u5668\u5728\u54cd\u5e94\u4e2d\u5e26\u4e0a\u6700\u65b0\u7684\u8d44\u6e90\u3002</p> <p>\u5982\u679c\u76f8\u540c\uff0c\u8bf4\u660e\u5ba2\u6237\u7aef\u7684\u7f13\u5b58\u8fd8\u662f\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\u7684\uff0c\u90a3\u4e48\u670d\u52a1\u5668\u4ec5\u8fd4\u56de\u4e0d\u542b\u6709\u5305\u4f53\u7684 <code>304 Not Modified</code> \u54cd\u5e94\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u4ecd\u7136\u6709\u6548\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u54cd\u5e94\u8d44\u6e90\u5728\u7f51\u7edc\u4e2d\u4f20\u8f93\u7684\u5ef6\u65f6\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u7f13\u5b58\u771f\u7684\u662f\u6027\u80fd\u4f18\u5316\u7684\u4e00\u628a\u4e07\u80fd\u94a5\u5319\uff0c\u5c0f\u5230 CPU Cache\u3001Page Cache\u3001Redis Cache\uff0c\u5927\u5230 HTTP \u534f\u8bae\u7684\u7f13\u5b58\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/#http_1","title":"\u5982\u4f55\u51cf\u5c11 HTTP \u8bf7\u6c42\u6b21\u6570\uff1f","text":"<p>\u51cf\u5c11 HTTP \u8bf7\u6c42\u6b21\u6570\u81ea\u7136\u4e5f\u5c31\u63d0\u5347\u4e86 HTTP \u6027\u80fd\uff0c\u53ef\u4ee5\u4ece\u8fd9 3 \u4e2a\u65b9\u9762\u5165\u624b\uff1a</p> <ul> <li>\u51cf\u5c11\u91cd\u5b9a\u5411\u8bf7\u6c42\u6b21\u6570\uff1b</li> <li>\u5408\u5e76\u8bf7\u6c42\uff1b</li> <li>\u5ef6\u8fdf\u53d1\u9001\u8bf7\u6c42\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/#_1","title":"\u51cf\u5c11\u91cd\u5b9a\u5411\u8bf7\u6c42\u6b21\u6570","text":"<p>\u6211\u4eec\u5148\u6765\u770b\u770b\u4ec0\u4e48\u662f\u91cd\u5b9a\u5411\u8bf7\u6c42\uff1f</p> <p>\u670d\u52a1\u5668\u4e0a\u7684\u4e00\u4e2a\u8d44\u6e90\u53ef\u80fd\u7531\u4e8e\u8fc1\u79fb\u3001\u7ef4\u62a4\u7b49\u539f\u56e0\u4ece url1 \u79fb\u81f3 url2 \u540e\uff0c\u800c\u5ba2\u6237\u7aef\u4e0d\u77e5\u60c5\uff0c\u5b83\u8fd8\u662f\u7ee7\u7eed\u8bf7\u6c42 url1\uff0c\u8fd9\u65f6\u670d\u52a1\u5668\u4e0d\u80fd\u7c97\u66b4\u5730\u8fd4\u56de\u9519\u8bef\uff0c\u800c\u662f\u901a\u8fc7 <code>302</code> \u54cd\u5e94\u7801\u548c <code>Location</code> \u5934\u90e8\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u8be5\u8d44\u6e90\u5df2\u7ecf\u8fc1\u79fb\u81f3 url2 \u4e86\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u9700\u8981\u518d\u53d1\u9001 url2 \u8bf7\u6c42\u4ee5\u83b7\u5f97\u670d\u52a1\u5668\u7684\u8d44\u6e90\u3002</p> <p>\u90a3\u4e48\uff0c\u5982\u679c\u91cd\u5b9a\u5411\u8bf7\u6c42\u8d8a\u591a\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5c31\u8981\u591a\u6b21\u53d1\u8d77 HTTP \u8bf7\u6c42\uff0c\u6bcf\u4e00\u6b21\u7684 HTTP \u8bf7\u6c42\u90fd\u5f97\u7ecf\u8fc7\u7f51\u7edc\uff0c\u8fd9\u65e0\u7591\u4f1a\u8d8a\u964d\u4f4e\u7f51\u7edc\u6027\u80fd\u3002</p> <p>\u53e6\u5916\uff0c\u670d\u52a1\u7aef\u8fd9\u4e00\u65b9\u5f80\u5f80\u4e0d\u53ea\u6709\u4e00\u53f0\u670d\u52a1\u5668\uff0c\u6bd4\u5982\u6e90\u670d\u52a1\u5668\u4e0a\u4e00\u7ea7\u662f\u4ee3\u7406\u670d\u52a1\u5668\uff0c\u7136\u540e\u4ee3\u7406\u670d\u52a1\u5668\u624d\u4e0e\u5ba2\u6237\u7aef\u901a\u4fe1\uff0c\u8fd9\u65f6\u5ba2\u6237\u7aef\u91cd\u5b9a\u5411\u5c31\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u4e0e\u4ee3\u7406\u670d\u52a1\u5668\u4e4b\u95f4\u9700\u8981 2 \u6b21\u6d88\u606f\u4f20\u9012\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5982\u679c\u91cd\u5b9a\u5411\u7684\u5de5\u4f5c\u4ea4\u7531\u4ee3\u7406\u670d\u52a1\u5668\u5b8c\u6210\uff0c\u5c31\u80fd\u51cf\u5c11 HTTP \u8bf7\u6c42\u6b21\u6570\u4e86\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u800c\u4e14\u5f53\u4ee3\u7406\u670d\u52a1\u5668\u77e5\u6653\u4e86\u91cd\u5b9a\u5411\u89c4\u5219\u540e\uff0c\u53ef\u4ee5\u8fdb\u4e00\u6b65\u51cf\u5c11\u6d88\u606f\u4f20\u9012\u6b21\u6570\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u9664\u4e86 <code>302</code> \u91cd\u5b9a\u5411\u54cd\u5e94\u7801\uff0c\u8fd8\u6709\u5176\u4ed6\u4e00\u4e9b\u91cd\u5b9a\u5411\u7684\u54cd\u5e94\u7801\uff0c\u4f60\u53ef\u4ee5\u4ece\u4e0b\u56fe\u770b\u5230\uff1a</p> <p></p> <p>\u5176\u4e2d\uff0c<code>301</code> \u548c <code>308</code> \u54cd\u5e94\u7801\u662f\u544a\u8bc9\u5ba2\u6237\u7aef\u53ef\u4ee5\u5c06\u91cd\u5b9a\u5411\u54cd\u5e94\u7f13\u5b58\u5230\u672c\u5730\u78c1\u76d8\uff0c\u4e4b\u540e\u5ba2\u6237\u7aef\u5c31\u81ea\u52a8\u7528 url2 \u66ff\u4ee3 url1 \u8bbf\u95ee\u670d\u52a1\u5668\u7684\u8d44\u6e90\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/#_2","title":"\u5408\u5e76\u8bf7\u6c42","text":"<p>\u5982\u679c\u628a\u591a\u4e2a\u8bbf\u95ee\u5c0f\u6587\u4ef6\u7684\u8bf7\u6c42\u5408\u5e76\u6210\u4e00\u4e2a\u5927\u7684\u8bf7\u6c42\uff0c\u867d\u7136\u4f20\u8f93\u7684\u603b\u8d44\u6e90\u8fd8\u662f\u4e00\u6837\uff0c\u4f46\u662f\u51cf\u5c11\u8bf7\u6c42\uff0c\u4e5f\u5c31\u610f\u5473\u7740\u51cf\u5c11\u4e86\u91cd\u590d\u53d1\u9001\u7684 HTTP \u5934\u90e8\u3002</p> <p>\u53e6\u5916\u7531\u4e8e HTTP/1.1 \u662f\u8bf7\u6c42\u54cd\u5e94\u6a21\u578b\uff0c\u5982\u679c\u7b2c\u4e00\u4e2a\u53d1\u9001\u7684\u8bf7\u6c42\uff0c\u672a\u6536\u5230\u5bf9\u5e94\u7684\u54cd\u5e94\uff0c\u90a3\u4e48\u540e\u7eed\u7684\u8bf7\u6c42\u5c31\u4e0d\u4f1a\u53d1\u9001\uff08PS\uff1aHTTP/1.1 \u7ba1\u9053\u6a21\u5f0f\u662f\u9ed8\u8ba4\u4e0d\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u8ba8\u8bba HTTP/1.1  \u7684\u961f\u5934\u963b\u585e\u95ee\u9898\uff0c\u662f\u4e0d\u8003\u8651\u7ba1\u9053\u6a21\u5f0f\u7684\uff09\uff0c\u4e8e\u662f\u4e3a\u4e86\u9632\u6b62\u5355\u4e2a\u8bf7\u6c42\u7684\u963b\u585e\uff0c\u6240\u4ee5\u4e00\u822c\u6d4f\u89c8\u5668\u4f1a\u540c\u65f6\u53d1\u8d77 5-6 \u4e2a\u8bf7\u6c42\uff0c\u6bcf\u4e00\u4e2a\u8bf7\u6c42\u90fd\u662f\u4e0d\u540c\u7684 TCP \u8fde\u63a5\uff0c\u90a3\u4e48\u5982\u679c\u5408\u5e76\u4e86\u8bf7\u6c42\uff0c\u4e5f\u5c31\u4f1a\u51cf\u5c11 TCP \u8fde\u63a5\u7684\u6570\u91cf\uff0c\u56e0\u800c\u7701\u53bb\u4e86  TCP \u63e1\u624b\u548c\u6162\u542f\u52a8\u8fc7\u7a0b\u8017\u8d39\u7684\u65f6\u95f4\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5177\u4f53\u770b\u770b\u5408\u5e76\u8bf7\u6c42\u7684\u51e0\u79cd\u65b9\u5f0f\u3002</p> <p>\u6709\u7684\u7f51\u9875\u4f1a\u542b\u6709\u5f88\u591a\u5c0f\u56fe\u7247\u3001\u5c0f\u56fe\u6807\uff0c\u6709\u591a\u5c11\u4e2a\u5c0f\u56fe\u7247\uff0c\u5ba2\u6237\u7aef\u5c31\u8981\u53d1\u8d77\u591a\u5c11\u6b21\u8bf7\u6c42\u3002\u90a3\u4e48\u5bf9\u4e8e\u8fd9\u4e9b\u5c0f\u56fe\u7247\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 <code>CSS Image Sprites</code> \u6280\u672f\u628a\u5b83\u4eec\u5408\u6210\u4e00\u4e2a\u5927\u56fe\u7247\uff0c\u8fd9\u6837\u6d4f\u89c8\u5668\u5c31\u53ef\u4ee5\u7528\u4e00\u6b21\u8bf7\u6c42\u83b7\u5f97\u4e00\u4e2a\u5927\u56fe\u7247\uff0c\u7136\u540e\u518d\u6839\u636e CSS \u6570\u636e\u628a\u5927\u56fe\u7247\u5207\u5272\u6210\u591a\u5f20\u5c0f\u56fe\u7247\u3002</p> <p></p> <p>\u8fd9\u79cd\u65b9\u5f0f\u5c31\u662f\u901a\u8fc7\u5c06\u591a\u4e2a\u5c0f\u56fe\u7247\u5408\u5e76\u6210\u4e00\u4e2a\u5927\u56fe\u7247\u6765\u51cf\u5c11 HTTP \u8bf7\u6c42\u7684\u6b21\u6570\uff0c\u4ee5\u51cf\u5c11 HTTP \u8bf7\u6c42\u7684\u6b21\u6570\uff0c\u4ece\u800c\u51cf\u5c11\u7f51\u7edc\u7684\u5f00\u9500\u3002</p> <p>\u9664\u4e86\u5c06\u5c0f\u56fe\u7247\u5408\u5e76\u6210\u5927\u56fe\u7247\u7684\u65b9\u5f0f\uff0c\u8fd8\u6709\u670d\u52a1\u7aef\u4f7f\u7528 <code>webpack</code> \u7b49\u6253\u5305\u5de5\u5177\u5c06 js\u3001css \u7b49\u8d44\u6e90\u5408\u5e76\u6253\u5305\u6210\u5927\u6587\u4ef6\uff0c\u4e5f\u662f\u80fd\u8fbe\u5230\u7c7b\u4f3c\u7684\u6548\u679c\u3002</p> <p>\u53e6\u5916\uff0c\u8fd8\u53ef\u4ee5\u5c06\u56fe\u7247\u7684\u4e8c\u8fdb\u5236\u6570\u636e\u7528 <code>base64</code> \u7f16\u7801\u540e\uff0c\u4ee5 URL \u7684\u5f62\u5f0f\u5d4c\u5165\u5230 HTML \u6587\u4ef6\uff0c\u8ddf\u968f HTML \u6587\u4ef6\u4e00\u5e76\u53d1\u9001\u3002</p> Text Only<pre><code>&lt;image src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPoAAAFKCAIAAAC7M9WrAAAACXBIWXMAA ... /&gt;\n</code></pre> <p>\u8fd9\u6837\u5ba2\u6237\u7aef\u6536\u5230 HTML \u540e\uff0c\u5c31\u53ef\u4ee5\u76f4\u63a5\u89e3\u7801\u51fa\u6570\u636e\uff0c\u7136\u540e\u76f4\u63a5\u663e\u793a\u56fe\u7247\uff0c\u5c31\u4e0d\u7528\u518d\u53d1\u8d77\u56fe\u7247\u76f8\u5173\u7684\u8bf7\u6c42\uff0c\u8fd9\u6837\u4fbf\u51cf\u5c11\u4e86\u8bf7\u6c42\u7684\u6b21\u6570\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5408\u5e76\u8bf7\u6c42\u7684\u65b9\u5f0f\u5c31\u662f\u5408\u5e76\u8d44\u6e90\uff0c\u4ee5\u4e00\u4e2a\u5927\u8d44\u6e90\u7684\u8bf7\u6c42\u66ff\u6362\u591a\u4e2a\u5c0f\u8d44\u6e90\u7684\u8bf7\u6c42\u3002</p> <p>\u4f46\u662f\u8fd9\u6837\u7684\u5408\u5e76\u8bf7\u6c42\u4f1a\u5e26\u6765\u65b0\u7684\u95ee\u9898\uff0c\u5f53\u5927\u8d44\u6e90\u4e2d\u7684\u67d0\u4e00\u4e2a\u5c0f\u8d44\u6e90\u53d1\u751f\u53d8\u5316\u540e\uff0c\u5ba2\u6237\u7aef\u5fc5\u987b\u91cd\u65b0\u4e0b\u8f7d\u6574\u4e2a\u5b8c\u6574\u7684\u5927\u8d44\u6e90\u6587\u4ef6\uff0c\u8fd9\u663e\u7136\u5e26\u6765\u4e86\u989d\u5916\u7684\u7f51\u7edc\u6d88\u8017\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/#_3","title":"\u5ef6\u8fdf\u53d1\u9001\u8bf7\u6c42","text":"<p>\u4e0d\u8981\u4e00\u53e3\u6c14\u5403\u6210\u5927\u80d6\u5b50\uff0c\u4e00\u822c HTML \u91cc\u4f1a\u542b\u6709\u5f88\u591a HTTP \u7684 URL\uff0c\u5f53\u524d\u4e0d\u9700\u8981\u7684\u8d44\u6e90\uff0c\u6211\u4eec\u6ca1\u5fc5\u8981\u4e5f\u83b7\u53d6\u8fc7\u6765\uff0c\u4e8e\u662f\u53ef\u4ee5\u901a\u8fc7\u300c\u6309\u9700\u83b7\u53d6\u300d\u7684\u65b9\u5f0f\uff0c\u6765\u51cf\u5c11\u7b2c\u4e00\u65f6\u95f4\u7684 HTTP \u8bf7\u6c42\u6b21\u6570\u3002</p> <p>\u8bf7\u6c42\u7f51\u9875\u7684\u65f6\u5019\uff0c\u6ca1\u5fc5\u8981\u628a\u5168\u90e8\u8d44\u6e90\u90fd\u83b7\u53d6\u5230\uff0c\u800c\u662f\u53ea\u83b7\u53d6\u5f53\u524d\u7528\u6237\u6240\u770b\u5230\u7684\u9875\u9762\u8d44\u6e90\uff0c\u5f53\u7528\u6237\u5411\u4e0b\u6ed1\u52a8\u9875\u9762\u7684\u65f6\u5019\uff0c\u518d\u5411\u670d\u52a1\u5668\u83b7\u53d6\u63a5\u4e0b\u6765\u7684\u8d44\u6e90\uff0c\u8fd9\u6837\u5c31\u8fbe\u5230\u4e86\u5ef6\u8fdf\u53d1\u9001\u8bf7\u6c42\u7684\u6548\u679c\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/#http_2","title":"\u5982\u4f55\u51cf\u5c11 HTTP \u54cd\u5e94\u7684\u6570\u636e\u5927\u5c0f\uff1f","text":"<p>\u5bf9\u4e8e HTTP \u7684\u8bf7\u6c42\u548c\u54cd\u5e94\uff0c\u901a\u5e38 HTTP \u7684\u54cd\u5e94\u7684\u6570\u636e\u5927\u5c0f\u4f1a\u6bd4\u8f83\u5927\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u5668\u8fd4\u56de\u7684\u8d44\u6e90\u4f1a\u6bd4\u8f83\u5927\u3002</p> <p>\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u8003\u8651\u5bf9\u54cd\u5e94\u7684\u8d44\u6e90\u8fdb\u884c\u538b\u7f29\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u51cf\u5c11\u54cd\u5e94\u7684\u6570\u636e\u5927\u5c0f\uff0c\u4ece\u800c\u63d0\u9ad8\u7f51\u7edc\u4f20\u8f93\u7684\u6548\u7387\u3002</p> <p>\u538b\u7f29\u7684\u65b9\u5f0f\u4e00\u822c\u5206\u4e3a 2 \u79cd\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u65e0\u635f\u538b\u7f29\uff1b</li> <li>\u6709\u635f\u538b\u7f29\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/#_4","title":"\u65e0\u635f\u538b\u7f29","text":"<p>\u65e0\u635f\u538b\u7f29\u662f\u6307\u8d44\u6e90\u7ecf\u8fc7\u538b\u7f29\u540e\uff0c\u4fe1\u606f\u4e0d\u88ab\u7834\u574f\uff0c\u8fd8\u80fd\u5b8c\u5168\u6062\u590d\u5230\u538b\u7f29\u524d\u7684\u539f\u6837\uff0c\u9002\u5408\u7528\u5728\u6587\u672c\u6587\u4ef6\u3001\u7a0b\u5e8f\u53ef\u6267\u884c\u6587\u4ef6\u3001\u7a0b\u5e8f\u6e90\u4ee3\u7801\u3002</p> <p>\u9996\u5148\uff0c\u6211\u4eec\u9488\u5bf9\u4ee3\u7801\u7684\u8bed\u6cd5\u89c4\u5219\u8fdb\u884c\u538b\u7f29\uff0c\u56e0\u4e3a\u901a\u5e38\u4ee3\u7801\u6587\u4ef6\u90fd\u6709\u5f88\u591a\u6362\u884c\u7b26\u6216\u8005\u7a7a\u683c\uff0c\u8fd9\u4e9b\u662f\u4e3a\u4e86\u5e2e\u52a9\u7a0b\u5e8f\u5458\u66f4\u597d\u7684\u9605\u8bfb\uff0c\u4f46\u662f\u673a\u5668\u6267\u884c\u65f6\u5e76\u4e0d\u8981\u8fd9\u4e9b\u7b26\uff0c\u628a\u8fd9\u4e9b\u591a\u4f59\u7684\u7b26\u53f7\u7ed9\u53bb\u9664\u6389\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u662f\u65e0\u635f\u538b\u7f29\u4e86\uff0c\u9700\u8981\u5bf9\u539f\u59cb\u8d44\u6e90\u5efa\u7acb\u7edf\u8ba1\u6a21\u578b\uff0c\u5229\u7528\u8fd9\u4e2a\u7edf\u8ba1\u6a21\u578b\uff0c\u5c06\u5e38\u51fa\u73b0\u7684\u6570\u636e\u7528\u8f83\u77ed\u7684\u4e8c\u8fdb\u5236\u6bd4\u7279\u5e8f\u5217\u8868\u793a\uff0c\u5c06\u4e0d\u5e38\u51fa\u73b0\u7684\u6570\u636e\u7528\u8f83\u957f\u7684\u4e8c\u8fdb\u5236\u6bd4\u7279\u5e8f\u5217\u8868\u793a\uff0c\u751f\u6210\u4e8c\u8fdb\u5236\u6bd4\u7279\u5e8f\u5217\u4e00\u822c\u662f\u300c\u970d\u592b\u66fc\u7f16\u7801\u300d\u7b97\u6cd5\u3002</p> <p>gzip \u5c31\u662f\u6bd4\u8f83\u5e38\u89c1\u7684\u65e0\u635f\u538b\u7f29\u3002\u5ba2\u6237\u7aef\u652f\u6301\u7684\u538b\u7f29\u7b97\u6cd5\uff0c\u4f1a\u5728 HTTP \u8bf7\u6c42\u4e2d\u901a\u8fc7\u5934\u90e8\u4e2d\u7684 <code>Accept-Encoding</code> \u5b57\u6bb5\u544a\u8bc9\u670d\u52a1\u5668\uff1a</p> Text Only<pre><code>Accept-Encoding: gzip, deflate, br\n</code></pre> <p>\u670d\u52a1\u5668\u6536\u5230\u540e\uff0c\u4f1a\u4ece\u4e2d\u9009\u62e9\u4e00\u4e2a\u670d\u52a1\u5668\u652f\u6301\u7684\u6216\u8005\u5408\u9002\u7684\u538b\u7f29\u7b97\u6cd5\uff0c\u7136\u540e\u4f7f\u7528\u6b64\u538b\u7f29\u7b97\u6cd5\u5bf9\u54cd\u5e94\u8d44\u6e90\u8fdb\u884c\u538b\u7f29\uff0c\u6700\u540e\u901a\u8fc7\u54cd\u5e94\u5934\u90e8\u4e2d\u7684 <code>Content-Encoding</code> \u5b57\u6bb5\u544a\u8bc9\u5ba2\u6237\u7aef\u8be5\u8d44\u6e90\u4f7f\u7528\u7684\u538b\u7f29\u7b97\u6cd5\u3002</p> Text Only<pre><code>Content-Encoding: gzip\n</code></pre> <p>gzip \u7684\u538b\u7f29\u6548\u7387\u76f8\u6bd4 Google \u63a8\u51fa\u7684 Brotli \u7b97\u6cd5\u8fd8\u662f\u5dee\u70b9\u610f\u601d\uff0c\u4e5f\u5c31\u662f\u4e0a\u6587\u4e2d\u7684 br\uff0c\u6240\u4ee5\u5982\u679c\u53ef\u4ee5\uff0c\u670d\u52a1\u5668\u5e94\u8be5\u9009\u62e9\u538b\u7f29\u6548\u7387\u66f4\u9ad8\u7684 br \u538b\u7f29\u7b97\u6cd5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/#_5","title":"\u6709\u635f\u538b\u7f29","text":"<p>\u4e0e\u65e0\u635f\u538b\u7f29\u76f8\u5bf9\u7684\u5c31\u662f\u6709\u635f\u538b\u7f29\uff0c\u7ecf\u8fc7\u6b64\u65b9\u6cd5\u538b\u7f29\uff0c\u89e3\u538b\u7684\u6570\u636e\u4f1a\u4e0e\u539f\u59cb\u6570\u636e\u4e0d\u540c\u4f46\u662f\u975e\u5e38\u63a5\u8fd1\u3002</p> <p>\u6709\u635f\u538b\u7f29\u4e3b\u8981\u5c06\u6b21\u8981\u7684\u6570\u636e\u820d\u5f03\uff0c\u727a\u7272\u4e00\u4e9b\u8d28\u91cf\u6765\u51cf\u5c11\u6570\u636e\u91cf\u3001\u63d0\u9ad8\u538b\u7f29\u6bd4\uff0c\u8fd9\u79cd\u65b9\u6cd5\u7ecf\u5e38\u7528\u4e8e\u538b\u7f29\u591a\u5a92\u4f53\u6570\u636e\uff0c\u6bd4\u5982\u97f3\u9891\u3001\u89c6\u9891\u3001\u56fe\u7247\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7 HTTP \u8bf7\u6c42\u5934\u90e8\u4e2d\u7684 <code>Accept</code> \u5b57\u6bb5\u91cc\u7684\u300cq \u8d28\u91cf\u56e0\u5b50\u300d\uff0c\u544a\u8bc9\u670d\u52a1\u5668\u671f\u671b\u7684\u8d44\u6e90\u8d28\u91cf\u3002</p> Text Only<pre><code>Accept: audio/*; q=0.2, audio/basic\n</code></pre> <p>\u5173\u4e8e\u56fe\u7247\u7684\u538b\u7f29\uff0c\u76ee\u524d\u538b\u7f29\u6bd4\u8f83\u9ad8\u7684\u662f Google \u63a8\u51fa\u7684 WebP \u683c\u5f0f\uff0c\u5b83\u4e0e\u5e38\u89c1\u7684 Png \u683c\u5f0f\u56fe\u7247\u7684\u538b\u7f29\u6bd4\u4f8b\u5bf9\u6bd4\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u76f8\u540c\u56fe\u7247\u8d28\u91cf\u4e0b\uff0cWebP \u683c\u5f0f\u7684\u56fe\u7247\u5927\u5c0f\u90fd\u6bd4 Png \u683c\u5f0f\u7684\u56fe\u7247\u5c0f\uff0c\u6240\u4ee5\u5bf9\u4e8e\u5927\u91cf\u56fe\u7247\u7684\u7f51\u7ad9\uff0c\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 WebP \u683c\u5f0f\u7684\u56fe\u7247\uff0c\u8fd9\u5c06\u5927\u5e45\u5ea6\u63d0\u5347\u7f51\u7edc\u4f20\u8f93\u7684\u6027\u80fd\u3002</p> <p>\u5173\u4e8e\u97f3\u89c6\u9891\u7684\u538b\u7f29\uff0c\u97f3\u89c6\u9891\u4e3b\u8981\u662f\u52a8\u6001\u7684\uff0c\u6bcf\u4e2a\u5e27\u90fd\u6709\u65f6\u5e8f\u7684\u5173\u7cfb\uff0c\u901a\u5e38\u65f6\u95f4\u8fde\u7eed\u7684\u5e27\u4e4b\u95f4\u7684\u53d8\u5316\u662f\u5f88\u5c0f\u7684\u3002</p> <p>\u6bd4\u5982\uff0c\u4e00\u4e2a\u5728\u770b\u4e66\u7684\u89c6\u9891\uff0c\u753b\u9762\u901a\u5e38\u53ea\u6709\u4eba\u7269\u7684\u624b\u548c\u4e66\u684c\u4e0a\u7684\u4e66\u662f\u4f1a\u6709\u53d8\u5316\u7684\uff0c\u800c\u5176\u4ed6\u5730\u65b9\u901a\u5e38\u90fd\u662f\u9759\u6001\u7684\uff0c\u4e8e\u662f\u53ea\u9700\u8981\u5728\u4e00\u4e2a\u9759\u6001\u7684\u5173\u952e\u5e27\uff0c\u4f7f\u7528\u589e\u91cf\u6570\u636e\u6765\u8868\u8fbe\u540e\u7eed\u7684\u5e27\uff0c\u8fd9\u6837\u4fbf\u51cf\u5c11\u4e86\u5f88\u591a\u6570\u636e\uff0c\u63d0\u9ad8\u4e86\u7f51\u7edc\u4f20\u8f93\u7684\u6027\u80fd\u3002\u5bf9\u4e8e\u89c6\u9891\u5e38\u89c1\u7684\u7f16\u7801\u683c\u5f0f\u6709 H264\u3001H265 \u7b49\uff0c\u97f3\u9891\u5e38\u89c1\u7684\u7f16\u7801\u683c\u5f0f\u6709 AAC\u3001AC3\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_optimize/#_6","title":"\u603b\u7ed3","text":"<p>\u8fd9\u6b21\u4e3b\u8981\u4ece 3 \u4e2a\u65b9\u9762\u4ecb\u7ecd\u4e86\u4f18\u5316 HTTP/1.1 \u534f\u8bae\u7684\u601d\u8def\u3002</p> <p>\u7b2c\u4e00\u4e2a\u601d\u8def\u662f\uff0c\u901a\u8fc7\u7f13\u5b58\u6280\u672f\u6765\u907f\u514d\u53d1\u9001 HTTP \u8bf7\u6c42\u3002\u5ba2\u6237\u7aef\u6536\u5230\u7b2c\u4e00\u4e2a\u8bf7\u6c42\u7684\u54cd\u5e94\u540e\uff0c\u53ef\u4ee5\u5c06\u5176\u7f13\u5b58\u5728\u672c\u5730\u78c1\u76d8\uff0c\u4e0b\u6b21\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5982\u679c\u7f13\u5b58\u6ca1\u8fc7\u671f\uff0c\u5c31\u76f4\u63a5\u8bfb\u53d6\u672c\u5730\u7f13\u5b58\u7684\u54cd\u5e94\u6570\u636e\u3002\u5982\u679c\u7f13\u5b58\u8fc7\u671f\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u8bf7\u6c42\u7684\u65f6\u5019\u5e26\u4e0a\u54cd\u5e94\u6570\u636e\u7684\u6458\u8981\uff0c\u670d\u52a1\u5668\u6bd4\u5bf9\u540e\u53d1\u73b0\u8d44\u6e90\u6ca1\u6709\u53d8\u5316\uff0c\u5c31\u53d1\u51fa\u4e0d\u5e26\u5305\u4f53\u7684 304 \u54cd\u5e94\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u7f13\u5b58\u7684\u54cd\u5e94\u4ecd\u7136\u6709\u6548\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u601d\u8def\u662f\uff0c\u51cf\u5c11 HTTP \u8bf7\u6c42\u7684\u6b21\u6570\uff0c\u6709\u4ee5\u4e0b\u7684\u65b9\u6cd5\uff1a</p> <ol> <li>\u5c06\u539f\u672c\u7531\u5ba2\u6237\u7aef\u5904\u7406\u7684\u91cd\u5b9a\u5411\u8bf7\u6c42\uff0c\u4ea4\u7ed9\u4ee3\u7406\u670d\u52a1\u5668\u5904\u7406\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u91cd\u5b9a\u5411\u8bf7\u6c42\u7684\u6b21\u6570\uff1b</li> <li>\u5c06\u591a\u4e2a\u5c0f\u8d44\u6e90\u5408\u5e76\u6210\u4e00\u4e2a\u5927\u8d44\u6e90\u518d\u4f20\u8f93\uff0c\u80fd\u591f\u51cf\u5c11 HTTP \u8bf7\u6c42\u6b21\u6570\u4ee5\u53ca \u5934\u90e8\u7684\u91cd\u590d\u4f20\u8f93\uff0c\u518d\u6765\u51cf\u5c11 TCP \u8fde\u63a5\u6570\u91cf\uff0c\u8fdb\u800c\u7701\u53bb TCP \u63e1\u624b\u548c\u6162\u542f\u52a8\u7684\u7f51\u7edc\u6d88\u8017\uff1b</li> <li>\u6309\u9700\u8bbf\u95ee\u8d44\u6e90\uff0c\u53ea\u8bbf\u95ee\u5f53\u524d\u7528\u6237\u770b\u5f97\u5230/\u7528\u5f97\u5230\u7684\u8d44\u6e90\uff0c\u5f53\u5ba2\u6237\u5f80\u4e0b\u6ed1\u52a8\uff0c\u518d\u8bbf\u95ee\u63a5\u4e0b\u6765\u7684\u8d44\u6e90\uff0c\u4ee5\u6b64\u8fbe\u5230\u5ef6\u8fdf\u8bf7\u6c42\uff0c\u4e5f\u5c31\u51cf\u5c11\u4e86\u540c\u4e00\u65f6\u95f4\u7684 HTTP \u8bf7\u6c42\u6b21\u6570\u3002</li> </ol> <p>\u7b2c\u4e09\u601d\u8def\u662f\uff0c\u901a\u8fc7\u538b\u7f29\u54cd\u5e94\u8d44\u6e90\uff0c\u964d\u4f4e\u4f20\u8f93\u8d44\u6e90\u7684\u5927\u5c0f\uff0c\u4ece\u800c\u63d0\u9ad8\u4f20\u8f93\u6548\u7387\uff0c\u6240\u4ee5\u5e94\u5f53\u9009\u62e9\u66f4\u4f18\u79c0\u7684\u538b\u7f29\u7b97\u6cd5\u3002</p> <p>\u4e0d\u7ba1\u600e\u4e48\u4f18\u5316 HTTP/1.1 \u534f\u8bae\u90fd\u662f\u6709\u9650\u7684\uff0c\u4e0d\u7136\u4e5f\u4e0d\u4f1a\u51fa\u73b0 HTTP/2 \u548c HTTP/3 \u534f\u8bae\uff0c\u540e\u7eed\u6211\u4eec\u518d\u6765\u4ecb\u7ecd HTTP/2 \u548c HTTP/3 \u534f\u8bae\u3002</p> <p>\u597d\u4e86\uff0c\u6b64\u6b21\u5206\u4eab\u5230\u8fd9\u5c31\u7ed3\u675f\u4e86\uff0c\u5982\u679c\u8fd9\u7bc7\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u6765\u4e2a\u4e09\u8fde\uff0c\u4f60\u4eec\u7684\u652f\u6301\u5c31\u662f\u5c0f\u6797\u7684\u6700\u5927\u52a8\u529b\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ol> <li>https://isparta.github.io/compare-webp/index.html</li> <li>https://zh.wikipedia.org/wiki/https://en.wikipedia.org/wiki/Lossy_compression</li> <li>https://en.wikipedia.org/wiki/Lossless_compression</li> <li>https://time.geekbang.org/column/article/242667</li> <li>https://www.tutorialrepublic.com/css-tutorial/css-sprites.php</li> <li>https://blog.csdn.net/weixin_38055381/article/details/81504716</li> <li>https://blog.csdn.net/weixin_44151887/article/details/106278559</li> </ol> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_rpc/","title":"3.8 \u65e2\u7136\u6709 HTTP \u534f\u8bae\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 RPC\uff1f","text":"<p>\u6765\u6e90\uff1a\u516c\u4f17\u53f7@\u5c0f\u767d debug</p> <p>\u539f\u6587\u5730\u5740\uff1a\u65e2\u7136\u6709 HTTP \u534f\u8bae\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 RPC\uff1f</p> <p>\u6211\u60f3\u8d77\u4e86\u6211\u521a\u5de5\u4f5c\u7684\u65f6\u5019\uff0c\u7b2c\u4e00\u6b21\u63a5\u89e6 RPC \u534f\u8bae\uff0c\u5f53\u65f6\u5c31\u5f88\u61f5\uff0c\u6211 HTTP \u534f\u8bae\u7528\u7684\u597d\u597d\u7684\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u7528 RPC \u534f\u8bae\uff1f</p> <p>\u4e8e\u662f\u5c31\u5230\u7f51\u4e0a\u53bb\u641c\u3002</p> <p>\u4e0d\u5c11\u89e3\u91ca\u663e\u5f97\u975e\u5e38\u5b98\u65b9\uff0c\u6211\u76f8\u4fe1\u5927\u5bb6\u5728\u5404\u79cd\u5e73\u53f0\u4e0a\u4e5f\u90fd\u770b\u5230\u8fc7\uff0c\u89e3\u91ca\u4e86\u53c8\u597d\u50cf\u6ca1\u89e3\u91ca\uff0c\u90fd\u5728\u7528\u4e00\u4e2a\u6211\u4eec\u4e0d\u8ba4\u8bc6\u7684\u6982\u5ff5\u53bb\u89e3\u91ca\u53e6\u5916\u4e00\u4e2a\u6211\u4eec\u4e0d\u8ba4\u8bc6\u7684\u6982\u5ff5\uff0c\u61c2\u7684\u4eba\u4e0d\u9700\u8981\u770b\uff0c\u4e0d\u61c2\u7684\u4eba\u770b\u4e86\u8fd8\u662f\u4e0d\u61c2\u3002</p> <p>\u8fd9\u79cd\u770b\u4e86\uff0c\u53c8\u597d\u50cf\u6ca1\u770b\u7684\u611f\u89c9\uff0c\u4e91\u91cc\u96fe\u91cc\u7684\u5f88\u96be\u53d7\uff0c\u6211\u61c2\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u5927\u5bb6\u6709\u5f3a\u70c8\u7684\u5ba1\u4e11\u75b2\u52b3\uff0c\u4eca\u5929\u6211\u4eec\u6765\u5c1d\u8bd5\u91cd\u65b0\u6362\u4e2a\u65b9\u5f0f\u8bb2\u4e00\u8bb2\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_rpc/#tcp","title":"\u4ece TCP \u804a\u8d77","text":"<p>\u4f5c\u4e3a\u4e00\u4e2a\u7a0b\u5e8f\u5458\uff0c\u5047\u8bbe\u6211\u4eec\u9700\u8981\u5728 A \u7535\u8111\u7684\u8fdb\u7a0b\u53d1\u4e00\u6bb5\u6570\u636e\u5230 B \u7535\u8111\u7684\u8fdb\u7a0b\uff0c\u6211\u4eec\u4e00\u822c\u4f1a\u5728\u4ee3\u7801\u91cc\u4f7f\u7528 Socket \u8fdb\u884c\u7f16\u7a0b\u3002</p> <p>\u8fd9\u65f6\u5019\uff0c\u6211\u4eec\u53ef\u9009\u9879\u4e00\u822c\u4e5f\u5c31 TCP \u548c UDP \u4e8c\u9009\u4e00\u3002TCP \u53ef\u9760\uff0cUDP \u4e0d\u53ef\u9760\u3002\u9664\u975e\u662f\u9a6c\u603b\u8fd9\u79cd\u795e\u7ea7\u7a0b\u5e8f\u5458\uff08\u65e9\u671f QQ \u5927\u91cf\u4f7f\u7528 UDP\uff09\uff0c\u5426\u5219\uff0c\u53ea\u8981\u7a0d\u5fae\u5bf9\u53ef\u9760\u6027\u6709\u4e9b\u8981\u6c42\uff0c\u666e\u901a\u4eba\u4e00\u822c\u65e0\u8111\u9009 TCP \u5c31\u5bf9\u4e86\u3002</p> <p>\u7c7b\u4f3c\u4e0b\u9762\u8fd9\u6837\u3002</p> C<pre><code>fd = socket(AF_INET,SOCK_STREAM,0);\n</code></pre> <p>\u5176\u4e2d <code>SOCK_STREAM</code>\uff0c\u662f\u6307\u4f7f\u7528\u5b57\u8282\u6d41\u4f20\u8f93\u6570\u636e\uff0c\u8bf4\u767d\u4e86\u5c31\u662f TCP \u534f\u8bae\u3002</p> <p>\u5728\u5b9a\u4e49\u4e86 Socket \u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u5bf9\u8fd9\u4e2a Socket \u8fdb\u884c\u64cd\u4f5c\uff0c\u6bd4\u5982\u7528 <code>bind()</code> \u7ed1\u5b9a IP \u7aef\u53e3\uff0c\u7528 <code>connect()</code> \u53d1\u8d77\u5efa\u8fde\u3002</p> <p></p> <p>\u5728\u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0c\u6211\u4eec\u5c31\u53ef\u4ee5\u4f7f\u7528 <code>send()</code> \u53d1\u9001\u6570\u636e\uff0c<code>recv()</code> \u63a5\u6536\u6570\u636e\u3002</p> <p>\u5149\u8fd9\u6837\u4e00\u4e2a\u7eaf\u88f8\u7684 TCP \u8fde\u63a5\uff0c\u5c31\u53ef\u4ee5\u505a\u5230\u6536\u53d1\u6570\u636e\u4e86\uff0c\u90a3\u662f\u4e0d\u662f\u5c31\u591f\u4e86\uff1f</p> <p>\u4e0d\u884c\uff0c\u8fd9\u4e48\u7528\u4f1a\u6709\u95ee\u9898\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_rpc/#tcp_1","title":"\u4f7f\u7528\u7eaf\u88f8 TCP \u4f1a\u6709\u4ec0\u4e48\u95ee\u9898","text":"<p>\u516b\u80a1\u6587\u5e38\u80cc\uff0cTCP \u662f\u6709\u4e09\u4e2a\u7279\u70b9\uff0c\u9762\u5411\u8fde\u63a5\u3001\u53ef\u9760\u3001\u57fa\u4e8e\u5b57\u8282\u6d41\u3002</p> <p></p> <p>\u8fd9\u4e09\u4e2a\u7279\u70b9\u771f\u7684\u6982\u62ec\u7684\u975e\u5e38\u7cbe\u8f9f\uff0c\u8fd9\u4e2a\u516b\u80a1\u6587\u6211\u4eec\u6ca1\u767d\u80cc\u3002</p> <p>\u6bcf\u4e2a\u7279\u70b9\u5c55\u5f00\u90fd\u80fd\u804a\u4e00\u7bc7\u6587\u7ae0\uff0c\u800c\u4eca\u5929\u6211\u4eec\u9700\u8981\u5173\u6ce8\u7684\u662f\u57fa\u4e8e\u5b57\u8282\u6d41\u8fd9\u4e00\u70b9\u3002</p> <p>\u5b57\u8282\u6d41\u53ef\u4ee5\u7406\u89e3\u4e3a\u4e00\u4e2a\u53cc\u5411\u7684\u901a\u9053\u91cc\u6d41\u6dcc\u7684\u6570\u636e\uff0c\u8fd9\u4e2a\u6570\u636e\u5176\u5b9e\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u4e8c\u8fdb\u5236\u6570\u636e\uff0c\u7b80\u5355\u6765\u8bf4\u5c31\u662f\u4e00\u5927\u5806 01 \u4e32\u3002\u7eaf\u88f8 TCP \u6536\u53d1\u7684\u8fd9\u4e9b 01 \u4e32\u4e4b\u95f4\u662f\u6ca1\u6709\u4efb\u4f55\u8fb9\u754c\u7684\uff0c\u4f60\u6839\u672c\u4e0d\u77e5\u9053\u5230\u54ea\u4e2a\u5730\u65b9\u624d\u7b97\u4e00\u6761\u5b8c\u6574\u6d88\u606f\u3002</p> <p></p> <p>\u6b63\u56e0\u4e3a\u8fd9\u4e2a\u6ca1\u6709\u4efb\u4f55\u8fb9\u754c\u7684\u7279\u70b9\uff0c\u6240\u4ee5\u5f53\u6211\u4eec\u9009\u62e9\u4f7f\u7528 TCP \u53d1\u9001\"\u590f\u6d1b\"\u548c\"\u7279\u70e6\u607c\"\u7684\u65f6\u5019\uff0c\u63a5\u6536\u7aef\u6536\u5230\u7684\u5c31\u662f\"\u590f\u6d1b\u7279\u70e6\u607c\"\uff0c\u8fd9\u65f6\u5019\u63a5\u6536\u7aef\u6ca1\u53d1\u533a\u5206\u4f60\u662f\u60f3\u8981\u8868\u8fbe\"\u590f\u6d1b\"+\"\u7279\u70e6\u607c\"\u8fd8\u662f\"\u590f\u6d1b\u7279\"+\"\u70e6\u607c\"\u3002</p> <p></p> <p>\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u7c98\u5305\u95ee\u9898\uff0c\u4e4b\u524d\u4e5f\u5199\u8fc7\u4e00\u7bc7\u4e13\u95e8\u7684\u6587\u7ae0\u804a\u8fc7\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p>\u8bf4\u8fd9\u4e2a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u544a\u8bc9\u5927\u5bb6\uff0c\u7eaf\u88f8 TCP \u662f\u4e0d\u80fd\u76f4\u63a5\u62ff\u6765\u7528\u7684\uff0c\u4f60\u9700\u8981\u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\u52a0\u5165\u4e00\u4e9b\u81ea\u5b9a\u4e49\u7684\u89c4\u5219\uff0c\u7528\u4e8e\u533a\u5206\u6d88\u606f\u8fb9\u754c\u3002</p> <p>\u4e8e\u662f\u6211\u4eec\u4f1a\u628a\u6bcf\u6761\u8981\u53d1\u9001\u7684\u6570\u636e\u90fd\u5305\u88c5\u4e00\u4e0b\uff0c\u6bd4\u5982\u52a0\u5165\u6d88\u606f\u5934\uff0c\u6d88\u606f\u5934\u91cc\u5199\u6e05\u695a\u4e00\u4e2a\u5b8c\u6574\u7684\u5305\u957f\u5ea6\u662f\u591a\u5c11\uff0c\u6839\u636e\u8fd9\u4e2a\u957f\u5ea6\u53ef\u4ee5\u7ee7\u7eed\u63a5\u6536\u6570\u636e\uff0c\u622a\u53d6\u51fa\u6765\u540e\u5b83\u4eec\u5c31\u662f\u6211\u4eec\u771f\u6b63\u8981\u4f20\u8f93\u7684\u6d88\u606f\u4f53\u3002</p> <p></p> <p>\u800c\u8fd9\u91cc\u5934\u63d0\u5230\u7684\u6d88\u606f\u5934\uff0c\u8fd8\u53ef\u4ee5\u653e\u5404\u79cd\u4e1c\u897f\uff0c\u6bd4\u5982\u6d88\u606f\u4f53\u662f\u5426\u88ab\u538b\u7f29\u8fc7\u548c\u6d88\u606f\u4f53\u683c\u5f0f\u4e4b\u7c7b\u7684\uff0c\u53ea\u8981\u4e0a\u4e0b\u6e38\u90fd\u7ea6\u5b9a\u597d\u4e86\uff0c\u4e92\u76f8\u90fd\u8ba4\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u534f\u8bae\u3002</p> <p>\u6bcf\u4e2a\u4f7f\u7528 TCP \u7684\u9879\u76ee\u90fd\u53ef\u80fd\u4f1a\u5b9a\u4e49\u4e00\u5957\u7c7b\u4f3c\u8fd9\u6837\u7684\u534f\u8bae\u89e3\u6790\u6807\u51c6\uff0c\u4ed6\u4eec\u53ef\u80fd\u6709\u533a\u522b\uff0c\u4f46\u539f\u7406\u90fd\u7c7b\u4f3c\u3002</p> <p>\u4e8e\u662f\u57fa\u4e8e TCP\uff0c\u5c31\u884d\u751f\u4e86\u975e\u5e38\u591a\u7684\u534f\u8bae\uff0c\u6bd4\u5982 HTTP \u548c RPC\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_rpc/#http-rpc","title":"HTTP \u548c RPC","text":"<p>\u6211\u4eec\u56de\u8fc7\u5934\u6765\u770b\u7f51\u7edc\u7684\u5206\u5c42\u56fe\u3002</p> <p></p> <p>TCP \u662f\u4f20\u8f93\u5c42\u7684\u534f\u8bae\uff0c\u800c\u57fa\u4e8e TCP \u9020\u51fa\u6765\u7684 HTTP \u548c\u5404\u7c7b RPC \u534f\u8bae\uff0c\u5b83\u4eec\u90fd\u53ea\u662f\u5b9a\u4e49\u4e86\u4e0d\u540c\u6d88\u606f\u683c\u5f0f\u7684\u5e94\u7528\u5c42\u534f\u8bae\u800c\u5df2\u3002</p> <p>HTTP \u534f\u8bae\uff08Hyper Text Transfer Protocol\uff09\uff0c\u53c8\u53eb\u505a\u8d85\u6587\u672c\u4f20\u8f93\u534f\u8bae\u3002\u6211\u4eec\u7528\u7684\u6bd4\u8f83\u591a\uff0c\u5e73\u65f6\u4e0a\u7f51\u5728\u6d4f\u89c8\u5668\u4e0a\u6572\u4e2a\u7f51\u5740\u5c31\u80fd\u8bbf\u95ee\u7f51\u9875\uff0c\u8fd9\u91cc\u7528\u5230\u7684\u5c31\u662f HTTP \u534f\u8bae\u3002</p> <p></p> <p>\u800c RPC\uff08Remote Procedure Call\uff09\uff0c\u53c8\u53eb\u505a\u8fdc\u7a0b\u8fc7\u7a0b\u8c03\u7528\u3002\u5b83\u672c\u8eab\u5e76\u4e0d\u662f\u4e00\u4e2a\u5177\u4f53\u7684\u534f\u8bae\uff0c\u800c\u662f\u4e00\u79cd\u8c03\u7528\u65b9\u5f0f\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6211\u4eec\u5e73\u65f6\u8c03\u7528\u4e00\u4e2a\u672c\u5730\u65b9\u6cd5\u5c31\u50cf\u4e0b\u9762\u8fd9\u6837\u3002</p> Text Only<pre><code> res = localFunc(req)\n</code></pre> <p>\u5982\u679c\u73b0\u5728\u8fd9\u4e0d\u662f\u4e2a\u672c\u5730\u65b9\u6cd5\uff0c\u800c\u662f\u4e2a\u8fdc\u7aef\u670d\u52a1\u5668\u66b4\u9732\u51fa\u6765\u7684\u4e00\u4e2a\u65b9\u6cd5 <code>remoteFunc</code>\uff0c\u5982\u679c\u6211\u4eec\u8fd8\u80fd\u50cf\u8c03\u7528\u672c\u5730\u65b9\u6cd5\u90a3\u6837\u53bb\u8c03\u7528\u5b83\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u5c4f\u853d\u6389\u4e00\u4e9b\u7f51\u7edc\u7ec6\u8282\uff0c\u7528\u8d77\u6765\u66f4\u65b9\u4fbf\uff0c\u5c82\u4e0d\u7f8e\u54c9\uff1f</p> Text Only<pre><code> res = remoteFunc(req)\n</code></pre> <p></p> <p>\u57fa\u4e8e\u8fd9\u4e2a\u601d\u8def\uff0c\u5927\u4f6c\u4eec\u9020\u51fa\u4e86\u975e\u5e38\u591a\u6b3e\u5f0f\u7684 RPC \u534f\u8bae\uff0c\u6bd4\u5982\u6bd4\u8f83\u6709\u540d\u7684<code>gRPC</code>\uff0c<code>thrift</code>\u3002</p> <p>\u503c\u5f97\u6ce8\u610f\u7684\u662f\uff0c\u867d\u7136\u5927\u90e8\u5206 RPC \u534f\u8bae\u5e95\u5c42\u4f7f\u7528 TCP\uff0c\u4f46\u5b9e\u9645\u4e0a\u5b83\u4eec\u4e0d\u4e00\u5b9a\u975e\u5f97\u4f7f\u7528 TCP\uff0c\u6539\u7528 UDP \u6216\u8005 HTTP\uff0c\u5176\u5b9e\u4e5f\u53ef\u4ee5\u505a\u5230\u7c7b\u4f3c\u7684\u529f\u80fd\u3002</p> <p></p> <p>\u5230\u8fd9\u91cc\uff0c\u6211\u4eec\u56de\u5230\u6587\u7ae0\u6807\u9898\u7684\u95ee\u9898\u3002</p> <p>\u65e2\u7136\u6709 HTTP \u534f\u8bae\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 RPC\uff1f</p> <p>\u5176\u5b9e\uff0c<code>TCP</code> \u662f70 \u5e74\u4ee3\u51fa\u6765\u7684\u534f\u8bae\uff0c\u800c <code>HTTP</code> \u662f 90 \u5e74\u4ee3\u624d\u5f00\u59cb\u6d41\u884c\u7684\u3002\u800c\u76f4\u63a5\u4f7f\u7528\u88f8 TCP \u4f1a\u6709\u95ee\u9898\uff0c\u53ef\u60f3\u800c\u77e5\uff0c\u8fd9\u4e2d\u95f4\u8fd9\u4e48\u591a\u5e74\u6709\u591a\u5c11\u81ea\u5b9a\u4e49\u7684\u534f\u8bae\uff0c\u800c\u8fd9\u91cc\u9762\u5c31\u670980 \u5e74\u4ee3\u51fa\u6765\u7684 <code>RPC</code>\u3002</p> <p>\u6240\u4ee5\u6211\u4eec\u8be5\u95ee\u7684\u4e0d\u662f\u65e2\u7136\u6709 HTTP \u534f\u8bae\u4e3a\u4ec0\u4e48\u8981\u6709 RPC\uff0c\u800c\u662f\u4e3a\u4ec0\u4e48\u6709 RPC \u8fd8\u8981\u6709 HTTP \u534f\u8bae\u3002</p> <p>\u90a3\u65e2\u7136\u6709 RPC \u4e86\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 HTTP \u5462\uff1f</p> <p>\u73b0\u5728\u7535\u8111\u4e0a\u88c5\u7684\u5404\u79cd\u8054\u7f51\u8f6f\u4ef6\uff0c\u6bd4\u5982 xx \u7ba1\u5bb6\uff0cxx \u536b\u58eb\uff0c\u5b83\u4eec\u90fd\u4f5c\u4e3a\u5ba2\u6237\u7aef\uff08Client\uff09\u9700\u8981\u8ddf\u670d\u52a1\u7aef\uff08Server\uff09\u5efa\u7acb\u8fde\u63a5\u6536\u53d1\u6d88\u606f\uff0c\u6b64\u65f6\u90fd\u4f1a\u7528\u5230\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u5728\u8fd9\u79cd Client/Server (C/S) \u67b6\u6784\u4e0b\uff0c\u5b83\u4eec\u53ef\u4ee5\u4f7f\u7528\u81ea\u5bb6\u9020\u7684 RPC \u534f\u8bae\uff0c\u56e0\u4e3a\u5b83\u53ea\u7ba1\u8fde\u81ea\u5df1\u516c\u53f8\u7684\u670d\u52a1\u5668\u5c31 ok \u4e86\u3002</p> <p>\u4f46\u6709\u4e2a\u8f6f\u4ef6\u4e0d\u540c\uff0c\u6d4f\u89c8\u5668\uff08Browser\uff09\uff0c\u4e0d\u7ba1\u662f Chrome \u8fd8\u662f IE\uff0c\u5b83\u4eec\u4e0d\u4ec5\u8981\u80fd\u8bbf\u95ee\u81ea\u5bb6\u516c\u53f8\u7684\u670d\u52a1\u5668\uff08Server\uff09\uff0c\u8fd8\u9700\u8981\u8bbf\u95ee\u5176\u4ed6\u516c\u53f8\u7684\u7f51\u7ad9\u670d\u52a1\u5668\uff0c\u56e0\u6b64\u5b83\u4eec\u9700\u8981\u6709\u4e2a\u7edf\u4e00\u7684\u6807\u51c6\uff0c\u4e0d\u7136\u5927\u5bb6\u6ca1\u6cd5\u4ea4\u6d41\u3002\u4e8e\u662f\uff0cHTTP \u5c31\u662f\u90a3\u4e2a\u65f6\u4ee3\u7528\u4e8e\u7edf\u4e00 Browser/Server (B/S) \u7684\u534f\u8bae\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\u5728\u591a\u5e74\u4ee5\u524d\uff0cHTTP \u4e3b\u8981\u7528\u4e8e B/S \u67b6\u6784\uff0c\u800c RPC \u66f4\u591a\u7528\u4e8e C/S \u67b6\u6784\u3002\u4f46\u73b0\u5728\u5176\u5b9e\u5df2\u7ecf\u6ca1\u5206\u90a3\u4e48\u6e05\u4e86\uff0cB/S \u548c C/S \u5728\u6162\u6162\u878d\u5408\u3002\u5f88\u591a\u8f6f\u4ef6\u540c\u65f6\u652f\u6301\u591a\u7aef\uff0c\u6bd4\u5982\u67d0\u5ea6\u4e91\u76d8\uff0c\u65e2\u8981\u652f\u6301\u7f51\u9875\u7248\uff0c\u8fd8\u8981\u652f\u6301\u624b\u673a\u7aef\u548c PC \u7aef\uff0c\u5982\u679c\u901a\u4fe1\u534f\u8bae\u90fd\u7528 HTTP \u7684\u8bdd\uff0c\u90a3\u670d\u52a1\u5668\u53ea\u7528\u540c\u4e00\u5957\u5c31\u591f\u4e86\u3002\u800c RPC \u5c31\u5f00\u59cb\u9000\u5c45\u5e55\u540e\uff0c\u4e00\u822c\u7528\u4e8e\u516c\u53f8\u5185\u90e8\u96c6\u7fa4\u91cc\uff0c\u5404\u4e2a\u5fae\u670d\u52a1\u4e4b\u95f4\u7684\u901a\u8baf\u3002</p> <p>\u90a3\u8fd9\u4e48\u8bf4\u7684\u8bdd\uff0c\u90fd\u7528 HTTP \u5f97\u4e86\uff0c\u8fd8\u7528\u4ec0\u4e48 RPC\uff1f</p> <p>\u4eff\u4f5b\u53c8\u56de\u5230\u4e86\u6587\u7ae0\u5f00\u5934\u7684\u6837\u5b50\uff0c\u90a3\u8fd9\u5c31\u8981\u4ece\u5b83\u4eec\u4e4b\u95f4\u7684\u533a\u522b\u5f00\u59cb\u8bf4\u8d77\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_rpc/#http-rpc_1","title":"HTTP \u548c RPC \u6709\u4ec0\u4e48\u533a\u522b","text":"<p>\u6211\u4eec\u6765\u770b\u770b RPC \u548c HTTP \u533a\u522b\u6bd4\u8f83\u660e\u663e\u7684\u51e0\u4e2a\u70b9\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_rpc/#_1","title":"\u670d\u52a1\u53d1\u73b0","text":"<p>\u9996\u5148\u8981\u5411\u67d0\u4e2a\u670d\u52a1\u5668\u53d1\u8d77\u8bf7\u6c42\uff0c\u4f60\u5f97\u5148\u5efa\u7acb\u8fde\u63a5\uff0c\u800c\u5efa\u7acb\u8fde\u63a5\u7684\u524d\u63d0\u662f\uff0c\u4f60\u5f97\u77e5\u9053 IP \u5730\u5740\u548c\u7aef\u53e3\u3002\u8fd9\u4e2a\u627e\u5230\u670d\u52a1\u5bf9\u5e94\u7684 IP \u7aef\u53e3\u7684\u8fc7\u7a0b\uff0c\u5176\u5b9e\u5c31\u662f\u670d\u52a1\u53d1\u73b0\u3002</p> <p>\u5728 HTTP \u4e2d\uff0c\u4f60\u77e5\u9053\u670d\u52a1\u7684\u57df\u540d\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7 DNS \u670d\u52a1\u53bb\u89e3\u6790\u5f97\u5230\u5b83\u80cc\u540e\u7684 IP \u5730\u5740\uff0c\u9ed8\u8ba4 80 \u7aef\u53e3\u3002</p> <p>\u800c RPC \u7684\u8bdd\uff0c\u5c31\u6709\u4e9b\u533a\u522b\uff0c\u4e00\u822c\u4f1a\u6709\u4e13\u95e8\u7684\u4e2d\u95f4\u670d\u52a1\u53bb\u4fdd\u5b58\u670d\u52a1\u540d\u548c IP \u4fe1\u606f\uff0c\u6bd4\u5982 Consul \u6216\u8005 Etcd\uff0c\u751a\u81f3\u662f Redis\u3002\u60f3\u8981\u8bbf\u95ee\u67d0\u4e2a\u670d\u52a1\uff0c\u5c31\u53bb\u8fd9\u4e9b\u4e2d\u95f4\u670d\u52a1\u53bb\u83b7\u5f97 IP \u548c\u7aef\u53e3\u4fe1\u606f\u3002\u7531\u4e8e DNS \u4e5f\u662f\u670d\u52a1\u53d1\u73b0\u7684\u4e00\u79cd\uff0c\u6240\u4ee5\u4e5f\u6709\u57fa\u4e8e DNS \u53bb\u505a\u670d\u52a1\u53d1\u73b0\u7684\u7ec4\u4ef6\uff0c\u6bd4\u5982CoreDNS\u3002</p> <p>\u53ef\u4ee5\u770b\u51fa\u670d\u52a1\u53d1\u73b0\u8fd9\u4e00\u5757\uff0c\u4e24\u8005\u662f\u6709\u4e9b\u533a\u522b\uff0c\u4f46\u4e0d\u592a\u80fd\u5206\u9ad8\u4f4e\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_rpc/#_2","title":"\u5e95\u5c42\u8fde\u63a5\u5f62\u5f0f","text":"<p>\u4ee5\u4e3b\u6d41\u7684 HTTP/1.1 \u534f\u8bae\u4e3a\u4f8b\uff0c\u5176\u9ed8\u8ba4\u5728\u5efa\u7acb\u5e95\u5c42 TCP \u8fde\u63a5\u4e4b\u540e\u4f1a\u4e00\u76f4\u4fdd\u6301\u8fd9\u4e2a\u8fde\u63a5\uff08Keep Alive\uff09\uff0c\u4e4b\u540e\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u90fd\u4f1a\u590d\u7528\u8fd9\u6761\u8fde\u63a5\u3002</p> <p>\u800c RPC \u534f\u8bae\uff0c\u4e5f\u8ddf HTTP \u7c7b\u4f3c\uff0c\u4e5f\u662f\u901a\u8fc7\u5efa\u7acb TCP \u957f\u94fe\u63a5\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\uff0c\u4f46\u4e0d\u540c\u7684\u5730\u65b9\u5728\u4e8e\uff0cRPC \u534f\u8bae\u4e00\u822c\u8fd8\u4f1a\u518d\u5efa\u4e2a\u8fde\u63a5\u6c60\uff0c\u5728\u8bf7\u6c42\u91cf\u5927\u7684\u65f6\u5019\uff0c\u5efa\u7acb\u591a\u6761\u8fde\u63a5\u653e\u5728\u6c60\u5185\uff0c\u8981\u53d1\u6570\u636e\u7684\u65f6\u5019\u5c31\u4ece\u6c60\u91cc\u53d6\u4e00\u6761\u8fde\u63a5\u51fa\u6765\uff0c\u7528\u5b8c\u653e\u56de\u53bb\uff0c\u4e0b\u6b21\u518d\u590d\u7528\uff0c\u53ef\u4ee5\u8bf4\u975e\u5e38\u73af\u4fdd\u3002</p> <p></p> <p>\u7531\u4e8e\u8fde\u63a5\u6c60\u6709\u5229\u4e8e\u63d0\u5347\u7f51\u7edc\u8bf7\u6c42\u6027\u80fd\uff0c\u6240\u4ee5\u4e0d\u5c11\u7f16\u7a0b\u8bed\u8a00\u7684\u7f51\u7edc\u5e93\u91cc\u90fd\u4f1a\u7ed9 HTTP \u52a0\u4e2a\u8fde\u63a5\u6c60\uff0c\u6bd4\u5982 Go \u5c31\u662f\u8fd9\u4e48\u5e72\u7684\u3002</p> <p>\u53ef\u4ee5\u770b\u51fa\u8fd9\u4e00\u5757\u4e24\u8005\u4e5f\u6ca1\u592a\u5927\u533a\u522b\uff0c\u6240\u4ee5\u4e5f\u4e0d\u662f\u5173\u952e\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_rpc/#_3","title":"\u4f20\u8f93\u7684\u5185\u5bb9","text":"<p>\u57fa\u4e8e TCP \u4f20\u8f93\u7684\u6d88\u606f\uff0c\u8bf4\u5230\u5e95\uff0c\u65e0\u975e\u90fd\u662f\u6d88\u606f\u5934 Header \u548c\u6d88\u606f\u4f53 Body\u3002</p> <p>Header \u662f\u7528\u4e8e\u6807\u8bb0\u4e00\u4e9b\u7279\u6b8a\u4fe1\u606f\uff0c\u5176\u4e2d\u6700\u91cd\u8981\u7684\u662f\u6d88\u606f\u4f53\u957f\u5ea6\u3002</p> <p>Body \u5219\u662f\u653e\u6211\u4eec\u771f\u6b63\u9700\u8981\u4f20\u8f93\u7684\u5185\u5bb9\uff0c\u800c\u8fd9\u4e9b\u5185\u5bb9\u53ea\u80fd\u662f\u4e8c\u8fdb\u5236 01 \u4e32\uff0c\u6bd5\u7adf\u8ba1\u7b97\u673a\u53ea\u8ba4\u8bc6\u8fd9\u73a9\u610f\u3002\u6240\u4ee5 TCP \u4f20\u5b57\u7b26\u4e32\u548c\u6570\u5b57\u90fd\u95ee\u9898\u4e0d\u5927\uff0c\u56e0\u4e3a\u5b57\u7b26\u4e32\u53ef\u4ee5\u8f6c\u6210\u7f16\u7801\u518d\u53d8\u6210 01 \u4e32\uff0c\u800c\u6570\u5b57\u672c\u8eab\u4e5f\u80fd\u76f4\u63a5\u8f6c\u4e3a\u4e8c\u8fdb\u5236\u3002\u4f46\u7ed3\u6784\u4f53\u5462\uff0c\u6211\u4eec\u5f97\u60f3\u4e2a\u529e\u6cd5\u5c06\u5b83\u4e5f\u8f6c\u4e3a\u4e8c\u8fdb\u5236 01 \u4e32\uff0c\u8fd9\u6837\u7684\u65b9\u6848\u73b0\u5728\u4e5f\u6709\u5f88\u591a\u73b0\u6210\u7684\uff0c\u6bd4\u5982 Json\uff0cProtobuf\u3002</p> <p>\u8fd9\u4e2a\u5c06\u7ed3\u6784\u4f53\u8f6c\u4e3a\u4e8c\u8fdb\u5236\u6570\u7ec4\u7684\u8fc7\u7a0b\u5c31\u53eb\u5e8f\u5217\u5316\uff0c\u53cd\u8fc7\u6765\u5c06\u4e8c\u8fdb\u5236\u6570\u7ec4\u590d\u539f\u6210\u7ed3\u6784\u4f53\u7684\u8fc7\u7a0b\u53eb\u53cd\u5e8f\u5217\u5316\u3002</p> <p></p> <p>\u5bf9\u4e8e\u4e3b\u6d41\u7684 HTTP/1.1\uff0c\u867d\u7136\u5b83\u73b0\u5728\u53eb\u8d85\u6587\u672c\u534f\u8bae\uff0c\u652f\u6301\u97f3\u9891\u89c6\u9891\uff0c\u4f46 HTTP \u8bbe\u8ba1\u521d\u662f\u7528\u4e8e\u505a\u7f51\u9875\u6587\u672c\u5c55\u793a\u7684\uff0c\u6240\u4ee5\u5b83\u4f20\u7684\u5185\u5bb9\u4ee5\u5b57\u7b26\u4e32\u4e3a\u4e3b\u3002Header \u548c Body \u90fd\u662f\u5982\u6b64\u3002\u5728 Body \u8fd9\u5757\uff0c\u5b83\u4f7f\u7528 Json \u6765\u5e8f\u5217\u5316\u7ed3\u6784\u4f53\u6570\u636e\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u968f\u4fbf\u622a\u4e2a\u56fe\u76f4\u89c2\u770b\u4e0b\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\u8fd9\u91cc\u9762\u7684\u5185\u5bb9\u975e\u5e38\u591a\u7684\u5197\u4f59\uff0c\u663e\u5f97\u975e\u5e38\u5570\u55e6\u3002\u6700\u660e\u663e\u7684\uff0c\u50cf <code>Header</code> \u91cc\u7684\u90a3\u4e9b\u4fe1\u606f\uff0c\u5176\u5b9e\u5982\u679c\u6211\u4eec\u7ea6\u5b9a\u597d\u5934\u90e8\u7684\u7b2c\u51e0\u4f4d\u662f Content-Type\uff0c\u5c31\u4e0d\u9700\u8981\u6bcf\u6b21\u90fd\u771f\u7684\u628a\"Content-Type\"\u8fd9\u4e2a\u5b57\u6bb5\u90fd\u4f20\u8fc7\u6765\uff0c\u7c7b\u4f3c\u7684\u60c5\u51b5\u5176\u5b9e\u5728 <code>body</code> \u7684 Json \u7ed3\u6784\u91cc\u4e5f\u7279\u522b\u660e\u663e\u3002</p> <p>\u800c RPC\uff0c\u56e0\u4e3a\u5b83\u5b9a\u5236\u5316\u7a0b\u5ea6\u66f4\u9ad8\uff0c\u53ef\u4ee5\u91c7\u7528\u4f53\u79ef\u66f4\u5c0f\u7684 Protobuf \u6216\u5176\u4ed6\u5e8f\u5217\u5316\u534f\u8bae\u53bb\u4fdd\u5b58\u7ed3\u6784\u4f53\u6570\u636e\uff0c\u540c\u65f6\u4e5f\u4e0d\u9700\u8981\u50cf HTTP \u90a3\u6837\u8003\u8651\u5404\u79cd\u6d4f\u89c8\u5668\u884c\u4e3a\uff0c\u6bd4\u5982 302 \u91cd\u5b9a\u5411\u8df3\u8f6c\u5565\u7684\u3002\u56e0\u6b64\u6027\u80fd\u4e5f\u4f1a\u66f4\u597d\u4e00\u4e9b\uff0c\u8fd9\u4e5f\u662f\u5728\u516c\u53f8\u5185\u90e8\u5fae\u670d\u52a1\u4e2d\u629b\u5f03 HTTP\uff0c\u9009\u62e9\u4f7f\u7528 RPC \u7684\u6700\u4e3b\u8981\u539f\u56e0\u3002</p> <p></p> <p></p> <p>\u5f53\u7136\u4e0a\u9762\u8bf4\u7684 HTTP\uff0c\u5176\u5b9e\u7279\u6307\u7684\u662f\u73b0\u5728\u4e3b\u6d41\u4f7f\u7528\u7684 HTTP/1.1\uff0c<code>HTTP/2</code> \u5728\u524d\u8005\u7684\u57fa\u7840\u4e0a\u505a\u4e86\u5f88\u591a\u6539\u8fdb\uff0c\u6240\u4ee5\u6027\u80fd\u53ef\u80fd\u6bd4\u5f88\u591a RPC \u534f\u8bae\u8fd8\u8981\u597d\uff0c\u751a\u81f3\u8fde <code>gRPC</code> \u5e95\u5c42\u90fd\u76f4\u63a5\u7528\u7684 <code>HTTP/2</code>\u3002</p> <p>\u90a3\u4e48\u95ee\u9898\u53c8\u6765\u4e86\uff0c\u4e3a\u4ec0\u4e48\u65e2\u7136\u6709\u4e86 HTTP/2\uff0c\u8fd8\u8981\u6709 RPC \u534f\u8bae\uff1f</p> <p>\u8fd9\u4e2a\u662f\u7531\u4e8e HTTP/2 \u662f 2015 \u5e74\u51fa\u6765\u7684\u3002\u90a3\u65f6\u5019\u5f88\u591a\u516c\u53f8\u5185\u90e8\u7684 RPC \u534f\u8bae\u90fd\u5df2\u7ecf\u8dd1\u4e86\u597d\u4e9b\u5e74\u4e86\uff0c\u57fa\u4e8e\u5386\u53f2\u539f\u56e0\uff0c\u4e00\u822c\u4e5f\u6ca1\u5fc5\u8981\u53bb\u6362\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_rpc/#_4","title":"\u603b\u7ed3","text":"<ul> <li>\u7eaf\u88f8 TCP \u662f\u80fd\u6536\u53d1\u6570\u636e\uff0c\u4f46\u5b83\u662f\u4e2a\u65e0\u8fb9\u754c\u7684\u6570\u636e\u6d41\uff0c\u4e0a\u5c42\u9700\u8981\u5b9a\u4e49\u6d88\u606f\u683c\u5f0f\u7528\u4e8e\u5b9a\u4e49\u6d88\u606f\u8fb9\u754c\u3002\u4e8e\u662f\u5c31\u6709\u4e86\u5404\u79cd\u534f\u8bae\uff0cHTTP \u548c\u5404\u7c7b RPC \u534f\u8bae\u5c31\u662f\u5728 TCP \u4e4b\u4e0a\u5b9a\u4e49\u7684\u5e94\u7528\u5c42\u534f\u8bae\u3002</li> <li>RPC \u672c\u8d28\u4e0a\u4e0d\u7b97\u662f\u534f\u8bae\uff0c\u800c\u662f\u4e00\u79cd\u8c03\u7528\u65b9\u5f0f\uff0c\u800c\u50cf gRPC \u548c Thrift \u8fd9\u6837\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u624d\u662f\u534f\u8bae\uff0c\u5b83\u4eec\u662f\u5b9e\u73b0\u4e86 RPC \u8c03\u7528\u7684\u534f\u8bae\u3002\u76ee\u7684\u662f\u5e0c\u671b\u7a0b\u5e8f\u5458\u80fd\u50cf\u8c03\u7528\u672c\u5730\u65b9\u6cd5\u90a3\u6837\u53bb\u8c03\u7528\u8fdc\u7aef\u7684\u670d\u52a1\u65b9\u6cd5\u3002\u540c\u65f6 RPC \u6709\u5f88\u591a\u79cd\u5b9e\u73b0\u65b9\u5f0f\uff0c\u4e0d\u4e00\u5b9a\u975e\u5f97\u57fa\u4e8e TCP \u534f\u8bae\u3002</li> <li>\u4ece\u53d1\u5c55\u5386\u53f2\u6765\u8bf4\uff0cHTTP \u4e3b\u8981\u7528\u4e8e B/S \u67b6\u6784\uff0c\u800c RPC \u66f4\u591a\u7528\u4e8e C/S \u67b6\u6784\u3002\u4f46\u73b0\u5728\u5176\u5b9e\u5df2\u7ecf\u6ca1\u5206\u90a3\u4e48\u6e05\u4e86\uff0cB/S \u548c C/S \u5728\u6162\u6162\u878d\u5408\u3002\u5f88\u591a\u8f6f\u4ef6\u540c\u65f6\u652f\u6301\u591a\u7aef\uff0c\u6240\u4ee5\u5bf9\u5916\u4e00\u822c\u7528 HTTP \u534f\u8bae\uff0c\u800c\u5185\u90e8\u96c6\u7fa4\u7684\u5fae\u670d\u52a1\u4e4b\u95f4\u5219\u91c7\u7528 RPC \u534f\u8bae\u8fdb\u884c\u901a\u8baf\u3002</li> <li>RPC \u5176\u5b9e\u6bd4 HTTP \u51fa\u73b0\u7684\u8981\u65e9\uff0c\u4e14\u6bd4\u76ee\u524d\u4e3b\u6d41\u7684 HTTP/1.1 \u6027\u80fd\u8981\u66f4\u597d\uff0c\u6240\u4ee5\u5927\u90e8\u5206\u516c\u53f8\u5185\u90e8\u90fd\u8fd8\u5728\u4f7f\u7528 RPC\u3002</li> <li>HTTP/2.0 \u5728 HTTP/1.1 \u7684\u57fa\u7840\u4e0a\u505a\u4e86\u4f18\u5316\uff0c\u6027\u80fd\u53ef\u80fd\u6bd4\u5f88\u591a RPC \u534f\u8bae\u90fd\u8981\u597d\uff0c\u4f46\u7531\u4e8e\u662f\u8fd9\u51e0\u5e74\u624d\u51fa\u6765\u7684\uff0c\u6240\u4ee5\u4e5f\u4e0d\u592a\u53ef\u80fd\u53d6\u4ee3\u6389 RPC\u3002</li> </ul> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/","title":"3.9 \u65e2\u7136\u6709 HTTP \u534f\u8bae\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 WebSocket\uff1f","text":"<p>\u6765\u6e90\uff1a\u516c\u4f17\u53f7@\u5c0f\u767d debug</p> <p>\u539f\u6587\u5730\u5740\uff1a\u65e2\u7136\u6709 HTTP \u534f\u8bae\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u6709 WebSocket\uff1f</p> <p>\u5e73\u65f6\u6211\u4eec\u6253\u5f00\u7f51\u9875\uff0c\u6bd4\u5982\u8d2d\u7269\u7f51\u7ad9\u67d0\u5b9d\u3002\u90fd\u662f\u70b9\u4e00\u4e0b\u300c\u5217\u8868\u5546\u54c1\u300d\uff0c\u8df3\u8f6c\u4e00\u4e0b\u7f51\u9875\u5c31\u5230\u4e86\u300c\u5546\u54c1\u8be6\u60c5\u300d\u3002</p> <p>\u4ece HTTP \u534f\u8bae\u7684\u89d2\u5ea6\u6765\u770b\uff0c\u5c31\u662f\u70b9\u4e00\u4e0b\u7f51\u9875\u4e0a\u7684\u67d0\u4e2a\u6309\u94ae\uff0c\u524d\u7aef\u53d1\u4e00\u6b21 HTTP \u8bf7\u6c42\uff0c\u7f51\u7ad9\u8fd4\u56de\u4e00\u6b21 HTTP \u54cd\u5e94\u3002\u8fd9\u79cd\u7531\u5ba2\u6237\u7aef\u4e3b\u52a8\u8bf7\u6c42\uff0c\u670d\u52a1\u5668\u54cd\u5e94\u7684\u65b9\u5f0f\u4e5f\u6ee1\u8db3\u5927\u90e8\u5206\u7f51\u9875\u7684\u529f\u80fd\u573a\u666f\u3002</p> <p>\u4f46\u6709\u6ca1\u6709\u53d1\u73b0\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u5668\u4ece\u6765\u5c31\u300c\u4e0d\u4f1a\u4e3b\u52a8\u300d\u7ed9\u5ba2\u6237\u7aef\u53d1\u4e00\u6b21\u6d88\u606f\u3002\u5c31\u50cf\u4f60\u559c\u6b22\u7684\u5973\u751f\u4ece\u6765\u4e0d\u4f1a\u4e3b\u52a8\u627e\u4f60\u4e00\u6837\u3002</p> <p>\u4f46\u5982\u679c\u73b0\u5728\uff0c\u4f60\u5728\u5237\u7f51\u9875\u7684\u65f6\u5019\u300c\u53f3\u4e0b\u89d2\u300d\u7a81\u7136\u5f39\u51fa\u4e00\u4e2a\u5c0f\u5e7f\u544a\uff0c\u63d0\u793a\u4f60\u3010\u4e00\u4e2a\u4eba\u5728\u5bb6\u5077\u5077\u624d\u80fd\u73a9\u54e6\u3011\u3002</p> <p>\u6c42\u77e5\uff0c\u597d\u5b66\uff0c\u52e4\u594b\uff0c\u8fd9\u4e9b\u523b\u5728\u4f60 DNA \u91cc\u7684\u4e1c\u897f\u90fd\u52a8\u8d77\u6765\u4e86\u3002</p> <p>\u4f60\u70b9\u5f00\u540e\u53d1\u73b0\u3002</p> <p>\u957f\u76f8\u5e73\u5e73\u65e0\u5947\u7684\u53e4\u67d0\u63d0\u793a\u4f60\"\u9053\u58eb 9 \u6761\u72d7\uff0c\u5168\u670d\u6a2a\u7740\u8d70\"\u3002</p> <p>\u5f71\u5e1d\u67d0\u8f89\u8001\u5e08\u8ddf\u4f60\u8bf4\"\u7cfb\u5144\u5f1f\u5c31\u6765\u780d\u6211\"\u3002</p> <p></p> <p>\u6765\u90fd\u6765\u4e86\uff0c\u4f60\u5c31\u9009\u4e86\u4e2a\u89d2\u8272\u8fdb\u5230\u4e86\u6e38\u620f\u754c\u9762\u91cc\u3002</p> <p></p> <p>\u8fd9\u65f6\u5019\uff0c\u4e0a\u6765\u5c31\u662f\u4e00\u4e2a\u5c0f\u602a\uff0c\u4ece\u8fdc\u5904\u8d70\u6765\uff0c\u7136\u540e\u75af\u72c2\u62ff\u6728\u68d2\u5b50\u62bd\u4f60\u3002</p> <p>\u4f60\u5168\u7a0b\u6ca1\u70b9\u4efb\u4f55\u4e00\u6b21\u9f20\u6807\u3002\u670d\u52a1\u5668\u5c31\u81ea\u52a8\u5c06\u602a\u7269\u7684\u79fb\u52a8\u6570\u636e\u548c\u653b\u51fb\u6570\u636e\u6e90\u6e90\u4e0d\u65ad\u53d1\u7ed9\u4f60\u4e86\u3002</p> <p>\u8fd9\u2026\u2026.\u592a\u6696\u5fc3\u4e86\u3002</p> <p>\u611f\u52a8\u4e4b\u4f59\uff0c\u95ee\u9898\u5c31\u6765\u4e86\uff1a</p> <p>\u50cf\u8fd9\u79cd\u770b\u8d77\u6765\u670d\u52a1\u5668\u4e3b\u52a8\u53d1\u6d88\u606f\u7ed9\u5ba2\u6237\u7aef\u7684\u573a\u666f\uff0c\u662f\u600e\u4e48\u505a\u5230\u7684\uff1f</p> <p>\u5728\u771f\u6b63\u56de\u7b54\u8fd9\u4e2a\u95ee\u9898\u4e4b\u524d\uff0c\u6211\u4eec\u5148\u6765\u804a\u4e0b\u4e00\u4e9b\u76f8\u5173\u7684\u77e5\u8bc6\u80cc\u666f\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#http","title":"\u4f7f\u7528 HTTP \u4e0d\u65ad\u8f6e\u8be2","text":"<p>\u5176\u5b9e\u95ee\u9898\u7684\u75db\u70b9\u5728\u4e8e\uff0c\u600e\u4e48\u6837\u624d\u80fd\u5728\u7528\u6237\u4e0d\u505a\u4efb\u4f55\u64cd\u4f5c\u7684\u60c5\u51b5\u4e0b\uff0c\u7f51\u9875\u80fd\u6536\u5230\u6d88\u606f\u5e76\u53d1\u751f\u53d8\u66f4\u3002</p> <p>\u6700\u5e38\u89c1\u7684\u89e3\u51b3\u65b9\u6848\u662f\uff0c\u7f51\u9875\u7684\u524d\u7aef\u4ee3\u7801\u91cc\u4e0d\u65ad\u5b9a\u65f6\u53d1 HTTP \u8bf7\u6c42\u5230\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\u540e\u7ed9\u5ba2\u6237\u7aef\u54cd\u5e94\u6d88\u606f\u3002</p> <p>\u8fd9\u5176\u5b9e\u65f6\u4e00\u79cd\u300c\u4f2a\u300d\u670d\u52a1\u5668\u63a8\u7684\u5f62\u5f0f\u3002</p> <p>\u5b83\u5176\u5b9e\u5e76\u4e0d\u662f\u670d\u52a1\u5668\u4e3b\u52a8\u53d1\u6d88\u606f\u5230\u5ba2\u6237\u7aef\uff0c\u800c\u662f\u5ba2\u6237\u7aef\u81ea\u5df1\u4e0d\u65ad\u5077\u5077\u8bf7\u6c42\u670d\u52a1\u5668\uff0c\u53ea\u662f\u7528\u6237\u65e0\u611f\u77e5\u800c\u5df2\u3002</p> <p>\u7528\u8fd9\u79cd\u65b9\u5f0f\u7684\u573a\u666f\u4e5f\u6709\u5f88\u591a\uff0c\u6700\u5e38\u89c1\u7684\u5c31\u662f\u626b\u7801\u767b\u5f55\u3002</p> <p>\u6bd4\u5982\uff0c\u67d0\u4fe1\u516c\u4f17\u53f7\u5e73\u53f0\uff0c\u767b\u5f55\u9875\u9762\u4e8c\u7ef4\u7801\u51fa\u73b0\u4e4b\u540e\uff0c\u524d\u7aef\u7f51\u9875\u6839\u672c\u4e0d\u77e5\u9053\u7528\u6237\u626b\u6ca1\u626b\uff0c\u4e8e\u662f\u4e0d\u65ad\u53bb\u5411\u540e\u7aef\u670d\u52a1\u5668\u8be2\u95ee\uff0c\u770b\u6709\u6ca1\u6709\u4eba\u626b\u8fc7\u8fd9\u4e2a\u7801\u3002\u800c\u4e14\u662f\u4ee5\u5927\u6982 1 \u5230 2 \u79d2\u7684\u95f4\u9694\u53bb\u4e0d\u65ad\u53d1\u51fa\u8bf7\u6c42\uff0c\u8fd9\u6837\u53ef\u4ee5\u4fdd\u8bc1\u7528\u6237\u5728\u626b\u7801\u540e\u80fd\u5728 1 \u5230 2 \u79d2\u5185\u5f97\u5230\u53ca\u65f6\u7684\u53cd\u9988\uff0c\u4e0d\u81f3\u4e8e\u7b49\u592a\u4e45\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#http_1","title":"\u4f7f\u7528 HTTP \u5b9a\u65f6\u8f6e\u8be2","text":"<p>\u4f46\u8fd9\u6837\uff0c\u4f1a\u6709\u4e24\u4e2a\u6bd4\u8f83\u660e\u663e\u7684\u95ee\u9898\uff1a</p> <ul> <li>\u5f53\u4f60\u6253\u5f00 F12 \u9875\u9762\u65f6\uff0c\u4f60\u4f1a\u53d1\u73b0\u6ee1\u5c4f\u7684 HTTP \u8bf7\u6c42\u3002\u867d\u7136\u5f88\u5c0f\uff0c\u4f46\u8fd9\u5176\u5b9e\u4e5f\u6d88\u8017\u5e26\u5bbd\uff0c\u540c\u65f6\u4e5f\u4f1a\u589e\u52a0\u4e0b\u6e38\u670d\u52a1\u5668\u7684\u8d1f\u62c5\u3002</li> <li>\u6700\u574f\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u5728\u626b\u7801\u540e\uff0c\u9700\u8981\u7b49\u4e2a 1~2 \u79d2\uff0c\u6b63\u597d\u624d\u89e6\u53d1\u4e0b\u4e00\u6b21 HTTP \u8bf7\u6c42\uff0c\u7136\u540e\u624d\u8df3\u8f6c\u9875\u9762\uff0c\u7528\u6237\u4f1a\u611f\u5230\u660e\u663e\u7684\u5361\u987f\u3002</li> </ul> <p>\u4f7f\u7528\u8d77\u6765\u7684\u4f53\u9a8c\u5c31\u662f\uff0c\u4e8c\u7ef4\u7801\u51fa\u73b0\u540e\uff0c\u624b\u673a\u626b\u4e00\u626b\uff0c\u7136\u540e\u5728\u624b\u673a\u4e0a\u70b9\u4e2a\u786e\u8ba4\uff0c\u8fd9\u65f6\u5019\u5361\u987f\u7b49\u4e2a 1~2 \u79d2\uff0c\u9875\u9762\u624d\u8df3\u8f6c\u3002</p> <p></p> <p>\u90a3\u4e48\u95ee\u9898\u53c8\u6765\u4e86\uff0c\u6709\u6ca1\u6709\u66f4\u597d\u7684\u89e3\u51b3\u65b9\u6848\uff1f</p> <p>\u6709\uff0c\u800c\u4e14\u5b9e\u73b0\u8d77\u6765\u6210\u672c\u8fd8\u975e\u5e38\u4f4e\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#_1","title":"\u957f\u8f6e\u8be2","text":"<p>\u6211\u4eec\u77e5\u9053\uff0cHTTP \u8bf7\u6c42\u53d1\u51fa\u540e\uff0c\u4e00\u822c\u4f1a\u7ed9\u670d\u52a1\u5668\u7559\u4e00\u5b9a\u7684\u65f6\u95f4\u505a\u54cd\u5e94\uff0c\u6bd4\u5982 3 \u79d2\uff0c\u89c4\u5b9a\u65f6\u95f4\u5185\u6ca1\u8fd4\u56de\uff0c\u5c31\u8ba4\u4e3a\u662f\u8d85\u65f6\u3002</p> <p>\u5982\u679c\u6211\u4eec\u7684 HTTP \u8bf7\u6c42\u5c06\u8d85\u65f6\u8bbe\u7f6e\u7684\u5f88\u5927\uff0c\u6bd4\u5982 30 \u79d2\uff0c\u5728\u8fd9 30 \u79d2\u5185\u53ea\u8981\u670d\u52a1\u5668\u6536\u5230\u4e86\u626b\u7801\u8bf7\u6c42\uff0c\u5c31\u7acb\u9a6c\u8fd4\u56de\u7ed9\u5ba2\u6237\u7aef\u7f51\u9875\u3002\u5982\u679c\u8d85\u65f6\uff0c\u90a3\u5c31\u7acb\u9a6c\u53d1\u8d77\u4e0b\u4e00\u6b21\u8bf7\u6c42\u3002</p> <p>\u8fd9\u6837\u5c31\u51cf\u5c11\u4e86 HTTP \u8bf7\u6c42\u7684\u4e2a\u6570\uff0c\u5e76\u4e14\u7531\u4e8e\u5927\u90e8\u5206\u60c5\u51b5\u4e0b\uff0c\u7528\u6237\u90fd\u4f1a\u5728\u67d0\u4e2a 30 \u79d2\u7684\u533a\u95f4\u5185\u505a\u626b\u7801\u64cd\u4f5c\uff0c\u6240\u4ee5\u54cd\u5e94\u4e5f\u662f\u53ca\u65f6\u7684\u3002</p> <p></p> <p>\u6bd4\u5982\uff0c\u67d0\u5ea6\u4e91\u7f51\u76d8\u5c31\u662f\u8fd9\u4e48\u5e72\u7684\u3002\u6240\u4ee5\u4f60\u4f1a\u53d1\u73b0\u4e00\u626b\u7801\uff0c\u624b\u673a\u4e0a\u70b9\u4e2a\u786e\u8ba4\uff0c\u7535\u8111\u7aef\u7f51\u9875\u5c31\u79d2\u8df3\u8f6c\uff0c\u4f53\u9a8c\u5f88\u597d\u3002</p> <p></p> <p>\u50cf\u8fd9\u79cd\u53d1\u8d77\u4e00\u4e2a\u8bf7\u6c42\uff0c\u5728\u8f83\u957f\u65f6\u95f4\u5185\u7b49\u5f85\u670d\u52a1\u5668\u54cd\u5e94\u7684\u673a\u5236\uff0c\u5c31\u662f\u6240\u8c13\u7684\u957f\u8f6e\u8be2\u673a\u5236\u3002\u6211\u4eec\u5e38\u7528\u7684\u6d88\u606f\u961f\u5217 RocketMQ \u4e2d\uff0c\u6d88\u8d39\u8005\u53bb\u53d6\u6570\u636e\u65f6\uff0c\u4e5f\u7528\u5230\u4e86\u8fd9\u79cd\u65b9\u5f0f\u3002</p> <p></p> <p>\u50cf\u8fd9\u79cd\uff0c\u5728\u7528\u6237\u4e0d\u611f\u77e5\u7684\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u5668\u5c06\u6570\u636e\u63a8\u9001\u7ed9\u6d4f\u89c8\u5668\u7684\u6280\u672f\uff0c\u5c31\u662f\u6240\u8c13\u7684\u670d\u52a1\u5668\u63a8\u9001\u6280\u672f\uff0c\u5b83\u8fd8\u6709\u4e2a\u6beb\u4e0d\u6cbe\u8fb9\u7684\u82f1\u6587\u540d\uff0ccomet \u6280\u672f\uff0c\u5927\u5bb6\u542c\u8fc7\u5c31\u597d\u3002</p> <p>\u4e0a\u9762\u63d0\u5230\u7684\u4e24\u79cd\u89e3\u51b3\u65b9\u6848\uff08\u4e0d\u65ad\u8f6e\u8be2\u548c\u957f\u8f6e\u8be2\uff09\uff0c\u672c\u8d28\u4e0a\uff0c\u5176\u5b9e\u8fd8\u662f\u5ba2\u6237\u7aef\u4e3b\u52a8\u53bb\u53d6\u6570\u636e\u3002</p> <p>\u5bf9\u4e8e\u50cf\u626b\u7801\u767b\u5f55\u8fd9\u6837\u7684\u7b80\u5355\u573a\u666f\u8fd8\u80fd\u7528\u7528\u3002\u4f46\u5982\u679c\u662f\u7f51\u9875\u6e38\u620f\u5462\uff0c\u6e38\u620f\u4e00\u822c\u4f1a\u6709\u5927\u91cf\u7684\u6570\u636e\u9700\u8981\u4ece\u670d\u52a1\u5668\u4e3b\u52a8\u63a8\u9001\u5230\u5ba2\u6237\u7aef\u3002</p> <p>\u8fd9\u5c31\u5f97\u8bf4\u4e0b WebSocket \u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#websocket","title":"WebSocket \u662f\u4ec0\u4e48","text":"<p>\u6211\u4eec\u77e5\u9053 TCP \u8fde\u63a5\u7684\u4e24\u7aef\uff0c\u540c\u4e00\u65f6\u95f4\u91cc\uff0c\u53cc\u65b9\u90fd\u53ef\u4ee5\u4e3b\u52a8\u5411\u5bf9\u65b9\u53d1\u9001\u6570\u636e\u3002\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u5168\u53cc\u5de5\u3002</p> <p>\u800c\u73b0\u5728\u4f7f\u7528\u6700\u5e7f\u6cdb\u7684 <code>HTTP/1.1</code>\uff0c\u4e5f\u662f\u57fa\u4e8e TCP \u534f\u8bae\u7684\uff0c\u540c\u4e00\u65f6\u95f4\u91cc\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53ea\u80fd\u6709\u4e00\u65b9\u4e3b\u52a8\u53d1\u6570\u636e\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u534a\u53cc\u5de5\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u597d\u597d\u7684\u5168\u53cc\u5de5 TCP\uff0c\u88ab HTTP/1.1 \u7528\u6210\u4e86\u534a\u53cc\u5de5\u3002</p> <p>\u4e3a\u4ec0\u4e48\uff1f</p> <p>\u8fd9\u662f\u7531\u4e8e HTTP \u534f\u8bae\u8bbe\u8ba1\u4e4b\u521d\uff0c\u8003\u8651\u7684\u662f\u770b\u770b\u7f51\u9875\u6587\u672c\u7684\u573a\u666f\uff0c\u80fd\u505a\u5230\u5ba2\u6237\u7aef\u53d1\u8d77\u8bf7\u6c42\u518d\u7531\u670d\u52a1\u5668\u54cd\u5e94\uff0c\u5c31\u591f\u4e86\uff0c\u6839\u672c\u5c31\u6ca1\u8003\u8651\u7f51\u9875\u6e38\u620f\u8fd9\u79cd\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4e4b\u95f4\u90fd\u8981\u4e92\u76f8\u4e3b\u52a8\u53d1\u5927\u91cf\u6570\u636e\u7684\u573a\u666f\u3002</p> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u66f4\u597d\u7684\u652f\u6301\u8fd9\u6837\u7684\u573a\u666f\uff0c\u6211\u4eec\u9700\u8981\u53e6\u5916\u4e00\u4e2a\u57fa\u4e8e TCP \u7684\u65b0\u534f\u8bae\u3002</p> <p>\u4e8e\u662f\u65b0\u7684\u5e94\u7528\u5c42\u534f\u8bae WebSocket \u5c31\u88ab\u8bbe\u8ba1\u51fa\u6765\u4e86\u3002</p> <p>\u5927\u5bb6\u522b\u88ab\u8fd9\u4e2a\u540d\u5b57\u7ed9\u5e26\u504f\u4e86\u3002\u867d\u7136\u540d\u5b57\u5e26\u4e86\u4e2a socket\uff0c\u4f46\u5176\u5b9e socket \u548c WebSocket \u4e4b\u95f4\uff0c\u5c31\u8ddf\u96f7\u5cf0\u548c\u96f7\u5cf0\u5854\u4e00\u6837\uff0c\u4e8c\u8005\u63a5\u8fd1\u6beb\u65e0\u5173\u7cfb\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#websocket_1","title":"\u600e\u4e48\u5efa\u7acb WebSocket \u8fde\u63a5","text":"<p>\u6211\u4eec\u5e73\u65f6\u5237\u7f51\u9875\uff0c\u4e00\u822c\u90fd\u662f\u5728\u6d4f\u89c8\u5668\u4e0a\u5237\u7684\uff0c\u4e00\u4f1a\u5237\u5237\u56fe\u6587\uff0c\u8fd9\u65f6\u5019\u7528\u7684\u662f HTTP \u534f\u8bae\uff0c\u4e00\u4f1a\u6253\u5f00\u7f51\u9875\u6e38\u620f\uff0c\u8fd9\u65f6\u5019\u5c31\u5f97\u5207\u6362\u6210\u6211\u4eec\u65b0\u4ecb\u7ecd\u7684 WebSocket \u534f\u8bae\u3002</p> <p>\u4e3a\u4e86\u517c\u5bb9\u8fd9\u4e9b\u4f7f\u7528\u573a\u666f\u3002\u6d4f\u89c8\u5668\u5728 TCP \u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\u4e4b\u540e\uff0c\u90fd\u7edf\u4e00\u4f7f\u7528 HTTP \u534f\u8bae\u5148\u8fdb\u884c\u4e00\u6b21\u901a\u4fe1\u3002</p> <ul> <li>\u5982\u679c\u6b64\u65f6\u662f\u666e\u901a\u7684 HTTP \u8bf7\u6c42\uff0c\u90a3\u540e\u7eed\u53cc\u65b9\u5c31\u8fd8\u662f\u8001\u6837\u5b50\u7ee7\u7eed\u7528\u666e\u901a HTTP \u534f\u8bae\u8fdb\u884c\u4ea4\u4e92\uff0c\u8fd9\u70b9\u6ca1\u5565\u7591\u95ee\u3002</li> <li>\u5982\u679c\u8fd9\u65f6\u5019\u662f\u60f3\u5efa\u7acb WebSocket \u8fde\u63a5\uff0c\u5c31\u4f1a\u5728 HTTP \u8bf7\u6c42\u91cc\u5e26\u4e0a\u4e00\u4e9b\u7279\u6b8a\u7684 header \u5934\uff0c\u5982\u4e0b\uff1a</li> </ul> HTTP<pre><code>Connection: Upgrade\nUpgrade: WebSocket\nSec-WebSocket-Key: T2a6wZlAwhgQNqruZ2YUyg==\\r\\n\n</code></pre> <p>\u8fd9\u4e9b header \u5934\u7684\u610f\u601d\u662f\uff0c\u6d4f\u89c8\u5668\u60f3\u5347\u7ea7\u534f\u8bae\uff08Connection: Upgrade\uff09\uff0c\u5e76\u4e14\u60f3\u5347\u7ea7\u6210 WebSocket \u534f\u8bae\uff08Upgrade: WebSocket\uff09\u3002\u540c\u65f6\u5e26\u4e0a\u4e00\u6bb5\u968f\u673a\u751f\u6210\u7684 Base64 \u7801\uff08Sec-WebSocket-Key\uff09\uff0c\u53d1\u7ed9\u670d\u52a1\u5668\u3002</p> <p>\u5982\u679c\u670d\u52a1\u5668\u6b63\u597d\u652f\u6301\u5347\u7ea7\u6210 WebSocket \u534f\u8bae\u3002\u5c31\u4f1a\u8d70 WebSocket \u63e1\u624b\u6d41\u7a0b\uff0c\u540c\u65f6\u6839\u636e\u5ba2\u6237\u7aef\u751f\u6210\u7684 Base64 \u7801\uff0c\u7528\u67d0\u4e2a\u516c\u5f00\u7684\u7b97\u6cd5\u53d8\u6210\u53e6\u4e00\u6bb5\u5b57\u7b26\u4e32\uff0c\u653e\u5728 HTTP \u54cd\u5e94\u7684 <code>Sec-WebSocket-Accept</code> \u5934\u91cc\uff0c\u540c\u65f6\u5e26\u4e0a <code>101 \u72b6\u6001\u7801</code>\uff0c\u53d1\u56de\u7ed9\u6d4f\u89c8\u5668\u3002HTTP \u7684\u54cd\u5e94\u5982\u4e0b\uff1a</p> HTTP<pre><code>HTTP/1.1 101 Switching Protocols\\r\\n\nSec-WebSocket-Accept: iBJKv/ALIW2DobfoA4dmr3JHBCY=\\r\\n\nUpgrade: WebSocket\\r\\n\nConnection: Upgrade\\r\\n\n</code></pre> <p>HTTP \u72b6\u6001\u7801=200\uff08\u6b63\u5e38\u54cd\u5e94\uff09\u7684\u60c5\u51b5\uff0c\u5927\u5bb6\u89c1\u5f97\u591a\u4e86\u3002101 \u786e\u5b9e\u4e0d\u5e38\u89c1\uff0c\u5b83\u5176\u5b9e\u662f\u6307\u534f\u8bae\u5207\u6362\u3002</p> <p></p> <p>\u4e4b\u540e\uff0c\u6d4f\u89c8\u5668\u4e5f\u7528\u540c\u6837\u7684\u516c\u5f00\u7b97\u6cd5\u5c06 <code>Base64 \u7801</code> \u8f6c\u6210\u53e6\u4e00\u6bb5\u5b57\u7b26\u4e32\uff0c\u5982\u679c\u8fd9\u6bb5\u5b57\u7b26\u4e32\u8ddf\u670d\u52a1\u5668\u4f20\u56de\u6765\u7684\u5b57\u7b26\u4e32\u4e00\u81f4\uff0c\u90a3\u9a8c\u8bc1\u901a\u8fc7\u3002</p> <p></p> <p>\u5c31\u8fd9\u6837\u7ecf\u5386\u4e86\u4e00\u6765\u4e00\u56de\u4e24\u6b21 HTTP \u63e1\u624b\uff0cWebSocket \u5c31\u5efa\u7acb\u5b8c\u6210\u4e86\uff0c\u540e\u7eed\u53cc\u65b9\u5c31\u53ef\u4ee5\u4f7f\u7528 WebSocket \u7684\u6570\u636e\u683c\u5f0f\u8fdb\u884c\u901a\u4fe1\u4e86\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#websocket_2","title":"WebSocket \u6293\u5305","text":"<p>\u6211\u4eec\u53ef\u4ee5\u7528 WireShark \u6293\u4e2a\u5305\uff0c\u5b9e\u9645\u770b\u4e0b\u6570\u636e\u5305\u7684\u60c5\u51b5\u3002</p> <p></p> <p>\u4e0a\u9762\u8fd9\u5f20\u56fe\uff0c\u6ce8\u610f\u753b\u4e86\u7ea2\u6846\u7684\u7b2c <code>2445</code> \u884c\u62a5\u6587\uff0c\u662f WebSocket \u7684\u7b2c\u4e00\u6b21\u63e1\u624b\uff0c\u610f\u601d\u662f\u53d1\u8d77\u4e86\u4e00\u6b21\u5e26\u6709 <code>\u7279\u6b8a Header</code> \u7684 HTTP \u8bf7\u6c42\u3002</p> <p></p> <p>\u4e0a\u9762\u8fd9\u4e2a\u56fe\u91cc\u753b\u4e86\u7ea2\u6846\u7684 <code>4714</code> \u884c\u62a5\u6587\uff0c\u5c31\u662f\u670d\u52a1\u5668\u5728\u5f97\u5230\u7b2c\u4e00\u6b21\u63e1\u624b\u540e\uff0c\u54cd\u5e94\u7684\u7b2c\u4e8c\u6b21\u63e1\u624b\uff0c\u53ef\u4ee5\u770b\u5230\u8fd9\u4e5f\u662f\u4e2a HTTP \u7c7b\u578b\u7684\u62a5\u6587\uff0c\u8fd4\u56de\u7684\u72b6\u6001\u7801\u662f 101\u3002\u540c\u65f6\u53ef\u4ee5\u770b\u5230\u8fd4\u56de\u7684\u62a5\u6587 Header \u4e2d\u4e5f\u5e26\u6709\u5404\u79cd <code>WebSocket</code> \u76f8\u5173\u7684\u4fe1\u606f\uff0c\u6bd4\u5982 <code>Sec-WebSocket-Accept</code>\u3002</p> <p></p> <p>\u4e0a\u9762\u8fd9\u5f20\u56fe\u5c31\u662f\u5168\u8c8c\u4e86\uff0c\u4ece\u622a\u56fe\u4e0a\u7684\u6ce8\u91ca\u53ef\u4ee5\u770b\u51fa\uff0cWebSocket \u548c HTTP \u4e00\u6837\u90fd\u662f\u57fa\u4e8e TCP \u7684\u534f\u8bae\u3002\u7ecf\u5386\u4e86\u4e09\u6b21 TCP \u63e1\u624b\u4e4b\u540e\uff0c\u5229\u7528 HTTP \u534f\u8bae\u5347\u7ea7\u4e3a WebSocket \u534f\u8bae\u3002</p> <p>\u4f60\u5728\u7f51\u4e0a\u53ef\u80fd\u4f1a\u770b\u5230\u4e00\u79cd\u8bf4\u6cd5\uff1a\u201cWebSocket \u662f\u57fa\u4e8e HTTP \u7684\u65b0\u534f\u8bae\u201d\uff0c\u5176\u5b9e\u8fd9\u5e76\u4e0d\u5bf9\uff0c\u56e0\u4e3a WebSocket \u53ea\u6709\u5728\u5efa\u7acb\u8fde\u63a5\u65f6\u624d\u7528\u5230\u4e86 HTTP\uff0c\u5347\u7ea7\u5b8c\u6210\u4e4b\u540e\u5c31\u8ddf HTTP \u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u4e86\u3002</p> <p>\u8fd9\u5c31\u597d\u50cf\u4f60\u559c\u6b22\u7684\u5973\u751f\u901a\u8fc7\u4f60\u8981\u5230\u4e86\u4f60\u5927\u5b66\u5ba4\u53cb\u7684\u5fae\u4fe1\uff0c\u7136\u540e\u4ed6\u4eec\u81ea\u5df1\u5c31\u804a\u8d77\u6765\u4e86\u3002\u4f60\u80fd\u8bf4\u8fd9\u4e2a\u5973\u751f\u662f\u901a\u8fc7\u4f60\u53bb\u8ddf\u4f60\u5ba4\u53cb\u6c9f\u901a\u7684\u5417\uff1f\u4e0d\u80fd\u3002\u4f60\u8ddf HTTP \u4e00\u6837\uff0c\u90fd\u53ea\u662f\u4e2a\u5de5\u5177\u4eba\u3002</p> <p></p> <p>\u8fd9\u5c31\u6709\u70b9\"\u501f\u58f3\u751f\u86cb\"\u7684\u90a3\u610f\u601d\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#http-websocket","title":"HTTP \u548c WebSocket \u7684\u5173\u7cfb","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#websocket_3","title":"WebSocket \u7684\u6d88\u606f\u683c\u5f0f","text":"<p>\u4e0a\u9762\u63d0\u5230\u5728\u5b8c\u6210\u534f\u8bae\u5347\u7ea7\u4e4b\u540e\uff0c\u4e24\u7aef\u5c31\u4f1a\u7528 WebSocket \u7684\u6570\u636e\u683c\u5f0f\u8fdb\u884c\u901a\u4fe1\u3002</p> <p>\u6570\u636e\u5305\u5728 WebSocket \u4e2d\u88ab\u53eb\u505a\u5e27\uff0c\u6211\u4eec\u6765\u770b\u4e0b\u5b83\u7684\u6570\u636e\u683c\u5f0f\u957f\u4ec0\u4e48\u6837\u5b50\u3002</p> <p></p> <p>\u8fd9\u91cc\u9762\u5b57\u6bb5\u5f88\u591a\uff0c\u4f46\u6211\u4eec\u53ea\u9700\u8981\u5173\u6ce8\u4e0b\u9762\u8fd9\u51e0\u4e2a\u3002</p> <p>opcode \u5b57\u6bb5\uff1a\u8fd9\u4e2a\u662f\u7528\u6765\u6807\u5fd7\u8fd9\u662f\u4e2a\u4ec0\u4e48\u7c7b\u578b\u7684\u6570\u636e\u5e27\u3002\u6bd4\u5982\u3002</p> <ul> <li>\u7b49\u4e8e 1\uff0c\u662f\u6307 text \u7c7b\u578b\uff08<code>string</code>\uff09\u7684\u6570\u636e\u5305</li> <li>\u7b49\u4e8e 2\uff0c\u662f\u4e8c\u8fdb\u5236\u6570\u636e\u7c7b\u578b\uff08<code>[]byte</code>\uff09\u7684\u6570\u636e\u5305</li> <li>\u7b49\u4e8e 8\uff0c\u662f\u5173\u95ed\u8fde\u63a5\u7684\u4fe1\u53f7</li> </ul> <p>payload \u5b57\u6bb5\uff1a\u5b58\u653e\u7684\u662f\u6211\u4eec\u771f\u6b63\u60f3\u8981\u4f20\u8f93\u7684\u6570\u636e\u7684\u957f\u5ea6\uff0c\u5355\u4f4d\u662f\u5b57\u8282\u3002\u6bd4\u5982\u4f60\u8981\u53d1\u9001\u7684\u6570\u636e\u662f <code>\u5b57\u7b26\u4e32\"111\"</code>\uff0c\u90a3\u5b83\u7684\u957f\u5ea6\u5c31\u662f <code>3</code>\u3002</p> <p></p> <p>\u53e6\u5916\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u4eec\u5b58\u653epayload \u957f\u5ea6\u7684\u5b57\u6bb5\u6709\u597d\u51e0\u4e2a\uff0c\u6211\u4eec\u65e2\u53ef\u4ee5\u7528\u6700\u524d\u9762\u7684 <code>7 bit</code>, \u4e5f\u53ef\u4ee5\u7528\u540e\u9762\u7684 <code>7+16 bit</code> \u6216 <code>7+64 bit</code>\u3002</p> <p>\u90a3\u4e48\u95ee\u9898\u5c31\u6765\u4e86\u3002</p> <p>\u6211\u4eec\u77e5\u9053\uff0c\u5728\u6570\u636e\u5c42\u9762\uff0c\u5927\u5bb6\u90fd\u662f 01 \u4e8c\u8fdb\u5236\u6d41\u3002\u6211\u600e\u4e48\u77e5\u9053\u4ec0\u4e48\u60c5\u51b5\u4e0b\u5e94\u8be5\u8bfb 7 bit\uff0c\u4ec0\u4e48\u60c5\u51b5\u4e0b\u5e94\u8be5\u8bfb 7+16 bit \u5462\uff1f</p> <p>WebSocket \u4f1a\u7528\u6700\u5f00\u59cb\u7684 7 bit \u505a\u6807\u5fd7\u4f4d\u3002\u4e0d\u7ba1\u63a5\u4e0b\u6765\u7684\u6570\u636e\u6709\u591a\u5927\uff0c\u90fd\u5148\u8bfb\u6700\u5148\u7684 7 \u4e2a bit\uff0c\u6839\u636e\u5b83\u7684\u53d6\u503c\u51b3\u5b9a\u8fd8\u8981\u4e0d\u8981\u518d\u8bfb\u4e2a 16 bit \u6216 64 bit\u3002</p> <ul> <li>\u5982\u679c <code>\u6700\u5f00\u59cb\u7684 7 bit</code> \u7684\u503c\u662f 0~125\uff0c\u90a3\u4e48\u5b83\u5c31\u8868\u793a\u4e86 payload \u5168\u90e8\u957f\u5ea6\uff0c\u53ea\u8bfb\u6700\u5f00\u59cb\u7684 <code>7 \u4e2a bit</code> \u5c31\u5b8c\u4e8b\u4e86\u3002</li> </ul> <p></p> <ul> <li>\u5982\u679c\u662f <code>126\uff080x7E\uff09</code>\u3002\u90a3\u5b83\u8868\u793a payload \u7684\u957f\u5ea6\u8303\u56f4\u5728 <code>126~65535</code> \u4e4b\u95f4\uff0c\u63a5\u4e0b\u6765\u8fd8\u9700\u8981\u518d\u8bfb 16 bit\u3002\u8fd9 16 bit \u4f1a\u5305\u542b payload \u7684\u771f\u5b9e\u957f\u5ea6\u3002</li> </ul> <p></p> <ul> <li>\u5982\u679c\u662f <code>127\uff080x7F\uff09</code>\u3002\u90a3\u5b83\u8868\u793a payload \u7684\u957f\u5ea6\u8303\u56f4 <code>&gt;=65536</code>\uff0c\u63a5\u4e0b\u6765\u8fd8\u9700\u8981\u518d\u8bfb 64 bit\u3002\u8fd9 64 bit \u4f1a\u5305\u542b payload \u7684\u957f\u5ea6\u3002\u8fd9\u80fd\u653e 2 \u7684 64 \u6b21\u65b9 byte \u7684\u6570\u636e\uff0c\u6362\u7b97\u4e00\u4e0b\u597d\u591a\u4e2a TB\uff0c\u80af\u5b9a\u591f\u7528\u4e86\u3002</li> </ul> <p></p> <p>payload data \u5b57\u6bb5\uff1a\u8fd9\u91cc\u5b58\u653e\u7684\u5c31\u662f\u771f\u6b63\u8981\u4f20\u8f93\u7684\u6570\u636e\uff0c\u5728\u77e5\u9053\u4e86\u4e0a\u9762\u7684 payload \u957f\u5ea6\u540e\uff0c\u5c31\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u503c\u53bb\u622a\u53d6\u5bf9\u5e94\u7684\u6570\u636e\u3002</p> <p>\u5927\u5bb6\u6709\u6ca1\u6709\u53d1\u73b0\u4e00\u4e2a\u5c0f\u7ec6\u8282\uff0cWebSocket \u7684\u6570\u636e\u683c\u5f0f\u4e5f\u662f\u6570\u636e\u5934\uff08\u5185\u542b payload \u957f\u5ea6\uff09 + payload data \u7684\u5f62\u5f0f\u3002</p> <p></p> <p>\u8fd9\u662f\u56e0\u4e3a TCP \u534f\u8bae\u672c\u8eab\u5c31\u662f\u5168\u53cc\u5de5\uff0c\u4f46\u76f4\u63a5\u4f7f\u7528\u7eaf\u88f8 TCP \u53bb\u4f20\u8f93\u6570\u636e\uff0c\u4f1a\u6709\u7c98\u5305\u7684\"\u95ee\u9898\"\u3002\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e0a\u5c42\u534f\u8bae\u4e00\u822c\u4f1a\u7528\u6d88\u606f\u5934 + \u6d88\u606f\u4f53\u7684\u683c\u5f0f\u53bb\u91cd\u65b0\u5305\u88c5\u8981\u53d1\u7684\u6570\u636e\u3002</p> <p>\u800c\u6d88\u606f\u5934\u91cc\u4e00\u822c\u542b\u6709\u6d88\u606f\u4f53\u7684\u957f\u5ea6\uff0c\u901a\u8fc7\u8fd9\u4e2a\u957f\u5ea6\u53ef\u4ee5\u53bb\u622a\u53d6\u771f\u6b63\u7684\u6d88\u606f\u4f53\u3002</p> <p>HTTP \u534f\u8bae\u548c\u5927\u90e8\u5206 RPC \u534f\u8bae\uff0c\u4ee5\u53ca\u6211\u4eec\u4eca\u5929\u4ecb\u7ecd\u7684 WebSocket \u534f\u8bae\uff0c\u90fd\u662f\u8fd9\u6837\u8bbe\u8ba1\u7684\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#websocket_4","title":"WebSocket \u7684\u4f7f\u7528\u573a\u666f","text":"<p>WebSocket \u5b8c\u7f8e\u7ee7\u627f\u4e86 TCP \u534f\u8bae\u7684\u5168\u53cc\u5de5\u80fd\u529b\uff0c\u5e76\u4e14\u8fd8\u8d34\u5fc3\u7684\u63d0\u4f9b\u4e86\u89e3\u51b3\u7c98\u5305\u7684\u65b9\u6848\u3002</p> <p>\u5b83\u9002\u7528\u4e8e\u9700\u8981\u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\uff08\u6d4f\u89c8\u5668\uff09\u9891\u7e41\u4ea4\u4e92\u7684\u5927\u90e8\u5206\u573a\u666f\uff0c\u6bd4\u5982\u7f51\u9875/\u5c0f\u7a0b\u5e8f\u6e38\u620f\uff0c\u7f51\u9875\u804a\u5929\u5ba4\uff0c\u4ee5\u53ca\u4e00\u4e9b\u7c7b\u4f3c\u98de\u4e66\u8fd9\u6837\u7684\u7f51\u9875\u534f\u540c\u529e\u516c\u8f6f\u4ef6\u3002</p> <p>\u56de\u5230\u6587\u7ae0\u5f00\u5934\u7684\u95ee\u9898\uff0c\u5728\u4f7f\u7528 WebSocket \u534f\u8bae\u7684\u7f51\u9875\u6e38\u620f\u91cc\uff0c\u602a\u7269\u79fb\u52a8\u4ee5\u53ca\u653b\u51fb\u73a9\u5bb6\u7684\u884c\u4e3a\u662f\u670d\u52a1\u5668\u903b\u8f91\u4ea7\u751f\u7684\uff0c\u5bf9\u73a9\u5bb6\u4ea7\u751f\u7684\u4f24\u5bb3\u7b49\u6570\u636e\uff0c\u90fd\u9700\u8981\u7531\u670d\u52a1\u5668\u4e3b\u52a8\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u83b7\u5f97\u6570\u636e\u540e\u5c55\u793a\u5bf9\u5e94\u7684\u6548\u679c\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/http_websocket/#_2","title":"\u603b\u7ed3","text":"<ul> <li>TCP \u534f\u8bae\u672c\u8eab\u662f\u5168\u53cc\u5de5\u7684\uff0c\u4f46\u6211\u4eec\u6700\u5e38\u7528\u7684 HTTP/1.1\uff0c\u867d\u7136\u662f\u57fa\u4e8e TCP \u7684\u534f\u8bae\uff0c\u4f46\u5b83\u662f\u534a\u53cc\u5de5\u7684\uff0c\u5bf9\u4e8e\u5927\u90e8\u5206\u9700\u8981\u670d\u52a1\u5668\u4e3b\u52a8\u63a8\u9001\u6570\u636e\u5230\u5ba2\u6237\u7aef\u7684\u573a\u666f\uff0c\u90fd\u4e0d\u592a\u53cb\u597d\uff0c\u56e0\u6b64\u6211\u4eec\u9700\u8981\u4f7f\u7528\u652f\u6301\u5168\u53cc\u5de5\u7684 WebSocket \u534f\u8bae\u3002</li> <li>\u5728 HTTP/1.1 \u91cc\uff0c\u53ea\u8981\u5ba2\u6237\u7aef\u4e0d\u95ee\uff0c\u670d\u52a1\u7aef\u5c31\u4e0d\u7b54\u3002\u57fa\u4e8e\u8fd9\u6837\u7684\u7279\u70b9\uff0c\u5bf9\u4e8e\u767b\u5f55\u9875\u9762\u8fd9\u6837\u7684\u7b80\u5355\u573a\u666f\uff0c\u53ef\u4ee5\u4f7f\u7528\u5b9a\u65f6\u8f6e\u8be2\u6216\u8005\u957f\u8f6e\u8be2\u7684\u65b9\u5f0f\u5b9e\u73b0\u670d\u52a1\u5668\u63a8\u9001(comet) \u7684\u6548\u679c\u3002</li> <li>\u5bf9\u4e8e\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4e4b\u95f4\u9700\u8981\u9891\u7e41\u4ea4\u4e92\u7684\u590d\u6742\u573a\u666f\uff0c\u6bd4\u5982\u7f51\u9875\u6e38\u620f\uff0c\u90fd\u53ef\u4ee5\u8003\u8651\u4f7f\u7528 WebSocket \u534f\u8bae\u3002</li> <li>WebSocket \u548c socket \u51e0\u4e4e\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\uff0c\u53ea\u662f\u53eb\u6cd5\u76f8\u4f3c\u3002</li> <li>\u6b63\u56e0\u4e3a\u5404\u4e2a\u6d4f\u89c8\u5668\u90fd\u652f\u6301 HTTP \u534f\u8bae\uff0c\u6240\u4ee5 WebSocket \u4f1a\u5148\u5229\u7528 HTTP \u534f\u8bae\u52a0\u4e0a\u4e00\u4e9b\u7279\u6b8a\u7684 Header \u5934\u8fdb\u884c\u63e1\u624b\u5347\u7ea7\u64cd\u4f5c\uff0c\u5347\u7ea7\u6210\u529f\u540e\u5c31\u8ddf HTTP \u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u4e86\uff0c\u4e4b\u540e\u5c31\u7528 WebSocket \u7684\u6570\u636e\u683c\u5f0f\u8fdb\u884c\u6536\u53d1\u6570\u636e\u3002</li> </ul> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d\u5173\u6ce8\u6211</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/","title":"3.4 HTTPS ECDHE \u63e1\u624b\u89e3\u6790","text":"<p>HTTPS \u5e38\u7528\u7684\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u6709\u4e24\u79cd\uff0c\u5206\u522b\u662f RSA \u548c ECDHE \u7b97\u6cd5\u3002</p> <p>\u5176\u4e2d\uff0cRSA \u662f\u6bd4\u8f83\u4f20\u7edf\u7684\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\uff0c\u5b83\u4e0d\u5177\u5907\u524d\u5411\u5b89\u5168\u7684\u6027\u8d28\uff0c\u56e0\u6b64\u73b0\u5728\u5f88\u5c11\u670d\u52a1\u5668\u4f7f\u7528\u7684\u3002\u800c ECDHE \u7b97\u6cd5\u5177\u6709\u524d\u5411\u5b89\u5168\uff0c\u6240\u4ee5\u88ab\u5e7f\u6cdb\u4f7f\u7528\u3002</p> <p>\u6211\u5728\u4e0a\u4e00\u7bc7\u5df2\u7ecf\u4ecb\u7ecd\u4e86 RSA \u63e1\u624b\u7684\u8fc7\u7a0b\uff0c\u4eca\u5929\u8fd9\u4e00\u7bc7\u5c31\u300c\u4ece\u7406\u8bba\u518d\u5230\u5b9e\u6218\u6293\u5305\u300d\u4ecb\u7ecd ECDHE \u7b97\u6cd5\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#_1","title":"\u79bb\u6563\u5bf9\u6570","text":"<p>ECDHE \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\u662f DH \u7b97\u6cd5\u6f14\u8fdb\u8fc7\u6765\u7684\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u4ece DH \u7b97\u6cd5\u8bf4\u8d77\u3002</p> <p>DH \u7b97\u6cd5\u662f\u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff0c\u56e0\u6b64\u5b83\u53ef\u4ee5\u7528\u4e8e\u5bc6\u94a5\u4ea4\u6362\uff0c\u8be5\u7b97\u6cd5\u7684\u6838\u5fc3\u6570\u5b66\u601d\u60f3\u662f\u79bb\u6563\u5bf9\u6570\u3002</p> <p>\u662f\u4e0d\u662f\u542c\u5230\u8fd9\u4e2a\u6570\u5b66\u6982\u5ff5\u5c31\u6002\u4e86\uff1f\u4e0d\u6015\uff0c\u8fd9\u6b21\u4e0d\u4f1a\u8bf4\u79bb\u6563\u5bf9\u6570\u63a8\u5bfc\u7684\u8fc7\u7a0b\uff0c\u53ea\u7b80\u5355\u63d0\u4e00\u4e0b\u5b83\u7684\u6570\u5b66\u516c\u5f0f\u3002</p> <p>\u79bb\u6563\u5bf9\u6570\u662f\u300c\u79bb\u6563 + \u5bf9\u6570\u300d\u7684\u4e24\u4e2a\u6570\u5b66\u6982\u5ff5\u7684\u7ec4\u5408\uff0c\u6240\u4ee5\u6211\u4eec\u5148\u6765\u590d\u4e60\u4e00\u904d\u5bf9\u6570\u3002</p> <p>\u8981\u8bf4\u8d77\u5bf9\u6570\uff0c\u5fc5\u7136\u8981\u8bf4\u6307\u6570\uff0c\u56e0\u4e3a\u5b83\u4eec\u662f\u4e92\u4e3a\u53cd\u51fd\u6570\uff0c\u6307\u6570\u5c31\u662f\u5e42\u8fd0\u7b97\uff0c\u5bf9\u6570\u662f\u6307\u6570\u7684\u9006\u8fd0\u7b97\u3002</p> <p>\u4e3e\u4e2a\u6817\u5b50\uff0c\u5982\u679c\u4ee5 2 \u4f5c\u4e3a\u5e95\u6570\uff0c\u90a3\u4e48\u6307\u6570\u548c\u5bf9\u6570\u8fd0\u7b97\u516c\u5f0f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u90a3\u4e48\u5bf9\u4e8e\u5e95\u6570\u4e3a 2 \u7684\u65f6\u5019\uff0c32 \u7684\u5bf9\u6570\u662f 5\uff0c64 \u7684\u5bf9\u6570\u662f 6\uff0c\u8ba1\u7b97\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5bf9\u6570\u8fd0\u7b97\u7684\u53d6\u503c\u662f\u53ef\u4ee5\u8fde\u7eed\u7684\uff0c\u800c\u79bb\u6563\u5bf9\u6570\u7684\u53d6\u503c\u662f\u4e0d\u80fd\u8fde\u7eed\u7684\uff0c\u56e0\u6b64\u4e5f\u4ee5\u300c\u79bb\u6563\u300d\u5f97\u540d\uff0c</p> <p>\u79bb\u6563\u5bf9\u6570\u662f\u5728\u5bf9\u6570\u8fd0\u7b97\u7684\u57fa\u7840\u4e0a\u52a0\u4e86\u300c\u6a21\u8fd0\u7b97\u300d\uff0c\u4e5f\u5c31\u8bf4\u53d6\u4f59\u6570\uff0c\u5bf9\u5e94\u7f16\u7a0b\u8bed\u8a00\u7684\u64cd\u4f5c\u7b26\u662f\u300c%\u300d\uff0c\u4e5f\u53ef\u4ee5\u7528 mod \u8868\u793a\u3002\u79bb\u6563\u5bf9\u6570\u7684\u6982\u5ff5\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0a\u56fe\u7684\uff0c\u5e95\u6570 a \u548c\u6a21\u6570 p \u662f\u79bb\u6563\u5bf9\u6570\u7684\u516c\u5171\u53c2\u6570\uff0c\u4e5f\u5c31\u8bf4\u662f\u516c\u5f00\u7684\uff0cb \u662f\u771f\u6570\uff0ci \u662f\u5bf9\u6570\u3002\u77e5\u9053\u4e86\u5bf9\u6570\uff0c\u5c31\u53ef\u4ee5\u7528\u4e0a\u9762\u7684\u516c\u5f0f\u8ba1\u7b97\u51fa\u771f\u6570\u3002\u4f46\u53cd\u8fc7\u6765\uff0c\u77e5\u9053\u771f\u6570\u5374\u5f88\u96be\u63a8\u7b97\u51fa\u5bf9\u6570\u3002</p> <p>\u7279\u522b\u662f\u5f53\u6a21\u6570 p \u662f\u4e00\u4e2a\u5f88\u5927\u7684\u8d28\u6570\uff0c\u5373\u4f7f\u77e5\u9053\u5e95\u6570 a \u548c\u771f\u6570 b\uff0c\u5728\u73b0\u6709\u7684\u8ba1\u7b97\u673a\u7684\u8ba1\u7b97\u6c34\u5e73\u662f\u51e0\u4e4e\u65e0\u6cd5\u7b97\u51fa\u79bb\u6563\u5bf9\u6570\u7684\uff0c\u8fd9\u5c31\u662f DH \u7b97\u6cd5\u7684\u6570\u5b66\u57fa\u7840\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#dh","title":"DH \u7b97\u6cd5","text":"<p>\u8ba4\u8bc6\u4e86\u79bb\u6563\u5bf9\u6570\uff0c\u6211\u4eec\u6765\u770b\u770b DH \u7b97\u6cd5\u662f\u5982\u4f55\u5bc6\u94a5\u4ea4\u6362\u7684\u3002</p> <p>\u73b0\u5047\u8bbe\u5c0f\u7ea2\u548c\u5c0f\u660e\u7ea6\u5b9a\u4f7f\u7528 DH \u7b97\u6cd5\u6765\u4ea4\u6362\u5bc6\u94a5\uff0c\u90a3\u4e48\u57fa\u4e8e\u79bb\u6563\u5bf9\u6570\uff0c\u5c0f\u7ea2\u548c\u5c0f\u660e\u9700\u8981\u5148\u786e\u5b9a\u6a21\u6570\u548c\u5e95\u6570\u4f5c\u4e3a\u7b97\u6cd5\u7684\u53c2\u6570\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u662f\u516c\u5f00\u7684\uff0c\u7528 P \u548c G \u6765\u4ee3\u79f0\u3002</p> <p>\u7136\u540e\u5c0f\u7ea2\u548c\u5c0f\u660e\u5404\u81ea\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6574\u6570\u4f5c\u4e3a\u79c1\u94a5\uff0c\u53cc\u65b9\u7684\u79c1\u94a5\u8981\u5404\u81ea\u4e25\u683c\u4fdd\u7ba1\uff0c\u4e0d\u80fd\u6cc4\u6f0f\uff0c\u5c0f\u7ea2\u7684\u79c1\u94a5\u7528 a \u4ee3\u79f0\uff0c\u5c0f\u660e\u7684\u79c1\u94a5\u7528 b \u4ee3\u79f0\u3002</p> <p>\u73b0\u5728\u5c0f\u7ea2\u548c\u5c0f\u660e\u53cc\u65b9\u90fd\u6709\u4e86 P \u548c G \u4ee5\u53ca\u5404\u81ea\u7684\u79c1\u94a5\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u516c\u94a5\uff1a</p> <ul> <li>\u5c0f\u7ea2\u7684\u516c\u94a5\u8bb0\u4f5c A\uff0cA = G ^ a ( mod P )\uff1b</li> <li>\u5c0f\u660e\u7684\u516c\u94a5\u8bb0\u4f5c B\uff0cB = G ^ b ( mod P )\uff1b</li> </ul> <p>A \u548c B \u4e5f\u662f\u516c\u5f00\u7684\uff0c\u56e0\u4e3a\u6839\u636e\u79bb\u6563\u5bf9\u6570\u7684\u539f\u7406\uff0c\u4ece\u771f\u6570\uff08A \u548c B\uff09\u53cd\u5411\u8ba1\u7b97\u5bf9\u6570 a \u548c b \u662f\u975e\u5e38\u56f0\u96be\u7684\uff0c\u81f3\u5c11\u5728\u73b0\u6709\u8ba1\u7b97\u673a\u7684\u8ba1\u7b97\u80fd\u529b\u662f\u65e0\u6cd5\u7834\u89e3\u7684\uff0c\u5982\u679c\u91cf\u5b50\u8ba1\u7b97\u673a\u51fa\u6765\u4e86\uff0c\u90a3\u5c31\u6709\u53ef\u80fd\u88ab\u7834\u89e3\uff0c\u5f53\u7136\u5982\u679c\u91cf\u5b50\u8ba1\u7b97\u673a\u771f\u7684\u51fa\u6765\u4e86\uff0c\u90a3\u4e48\u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\u5c31\u8981\u505a\u5927\u7684\u5347\u7ea7\u4e86\u3002</p> <p>\u53cc\u65b9\u4ea4\u6362\u5404\u81ea DH \u516c\u94a5\u540e\uff0c\u5c0f\u7ea2\u624b\u4e0a\u5171\u6709 5 \u4e2a\u6570\uff1aP\u3001G\u3001a\u3001A\u3001B\uff0c\u5c0f\u660e\u624b\u4e0a\u4e5f\u540c\u6837\u5171\u6709 5 \u4e2a\u6570\uff1aP\u3001G\u3001b\u3001B\u3001A\u3002</p> <p>\u7136\u540e\u5c0f\u7ea2\u6267\u884c\u8fd0\u7b97\uff1aB ^ a ( mod P )\uff0c\u5176\u7ed3\u679c\u4e3a K\uff0c\u56e0\u4e3a\u79bb\u6563\u5bf9\u6570\u7684\u5e42\u8fd0\u7b97\u6709\u4ea4\u6362\u5f8b\uff0c\u6240\u4ee5\u5c0f\u660e\u6267\u884c\u8fd0\u7b97\uff1aA ^ b ( mod P )\uff0c\u5f97\u5230\u7684\u7ed3\u679c\u4e5f\u662f K\u3002</p> <p></p> <p>\u8fd9\u4e2a K \u5c31\u662f\u5c0f\u7ea2\u548c\u5c0f\u660e\u4e4b\u95f4\u7528\u7684\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff0c\u53ef\u4ee5\u4f5c\u4e3a\u4f1a\u8bdd\u5bc6\u94a5\u4f7f\u7528\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6574\u4e2a\u5bc6\u94a5\u534f\u5546\u8fc7\u7a0b\u4e2d\uff0c\u5c0f\u7ea2\u548c\u5c0f\u660e\u516c\u5f00\u4e86 4 \u4e2a\u4fe1\u606f\uff1aP\u3001G\u3001A\u3001B\uff0c\u5176\u4e2d P\u3001G \u662f\u7b97\u6cd5\u7684\u53c2\u6570\uff0cA \u548c B \u662f\u516c\u94a5\uff0c\u800c a\u3001b \u662f\u53cc\u65b9\u5404\u81ea\u4fdd\u7ba1\u7684\u79c1\u94a5\uff0c\u9ed1\u5ba2\u65e0\u6cd5\u83b7\u53d6\u8fd9 2 \u4e2a\u79c1\u94a5\uff0c\u56e0\u6b64\u9ed1\u5ba2\u53ea\u80fd\u4ece\u516c\u5f00\u7684 P\u3001G\u3001A\u3001B \u5165\u624b\uff0c\u8ba1\u7b97\u51fa\u79bb\u6563\u5bf9\u6570\uff08\u79c1\u94a5\uff09\u3002</p> <p>\u524d\u9762\u4e5f\u591a\u6b21\u5f3a\u8c03\uff0c\u6839\u636e\u79bb\u6563\u5bf9\u6570\u7684\u539f\u7406\uff0c\u5982\u679c P \u662f\u4e00\u4e2a\u5927\u6570\uff0c\u5728\u73b0\u6709\u7684\u8ba1\u7b97\u673a\u7684\u8ba1\u7b97\u80fd\u529b\u662f\u5f88\u96be\u7834\u89e3\u51fa \u79c1\u94a5 a\u3001b \u7684\uff0c\u7834\u89e3\u4e0d\u51fa\u79c1\u94a5\uff0c\u4e5f\u5c31\u65e0\u6cd5\u8ba1\u7b97\u51fa\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u56e0\u6b64 DH \u5bc6\u94a5\u4ea4\u6362\u662f\u5b89\u5168\u7684\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#dhe","title":"DHE \u7b97\u6cd5","text":"<p>\u6839\u636e\u79c1\u94a5\u751f\u6210\u7684\u65b9\u5f0f\uff0cDH \u7b97\u6cd5\u5206\u4e3a\u4e24\u79cd\u5b9e\u73b0\uff1a</p> <ul> <li>static DH \u7b97\u6cd5\uff0c\u8fd9\u4e2a\u662f\u5df2\u7ecf\u88ab\u5e9f\u5f03\u4e86\uff1b</li> <li>DHE \u7b97\u6cd5\uff0c\u73b0\u5728\u5e38\u7528\u7684\uff1b</li> </ul> <p>static DH \u7b97\u6cd5\u91cc\u6709\u4e00\u65b9\u7684\u79c1\u94a5\u662f\u9759\u6001\u7684\uff0c\u4e5f\u5c31\u8bf4\u6bcf\u6b21\u5bc6\u94a5\u534f\u5546\u7684\u65f6\u5019\u6709\u4e00\u65b9\u7684\u79c1\u94a5\u90fd\u662f\u4e00\u6837\u7684\uff0c\u4e00\u822c\u662f\u670d\u52a1\u5668\u65b9\u56fa\u5b9a\uff0c\u5373 a \u4e0d\u53d8\uff0c\u5ba2\u6237\u7aef\u7684\u79c1\u94a5\u5219\u662f\u968f\u673a\u751f\u6210\u7684\u3002</p> <p>\u4e8e\u662f\uff0cDH \u4ea4\u6362\u5bc6\u94a5\u65f6\u5c31\u53ea\u6709\u5ba2\u6237\u7aef\u7684\u516c\u94a5\u662f\u53d8\u5316\uff0c\u800c\u670d\u52a1\u7aef\u516c\u94a5\u662f\u4e0d\u53d8\u7684\uff0c\u90a3\u4e48\u968f\u7740\u65f6\u95f4\u5ef6\u957f\uff0c\u9ed1\u5ba2\u5c31\u4f1a\u622a\u83b7\u6d77\u91cf\u7684\u5bc6\u94a5\u534f\u5546\u8fc7\u7a0b\u7684\u6570\u636e\uff0c\u56e0\u4e3a\u5bc6\u94a5\u534f\u5546\u7684\u8fc7\u7a0b\u6709\u4e9b\u6570\u636e\u662f\u516c\u5f00\u7684\uff0c\u9ed1\u5ba2\u5c31\u53ef\u4ee5\u4f9d\u636e\u8fd9\u4e9b\u6570\u636e\u66b4\u529b\u7834\u89e3\u51fa\u670d\u52a1\u5668\u7684\u79c1\u94a5\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u8ba1\u7b97\u51fa\u4f1a\u8bdd\u5bc6\u94a5\u4e86\uff0c\u4e8e\u662f\u4e4b\u524d\u622a\u83b7\u7684\u52a0\u5bc6\u6570\u636e\u4f1a\u88ab\u7834\u89e3\uff0c\u6240\u4ee5 static DH \u7b97\u6cd5\u4e0d\u5177\u5907\u524d\u5411\u5b89\u5168\u6027\u3002</p> <p>\u65e2\u7136\u56fa\u5b9a\u4e00\u65b9\u7684\u79c1\u94a5\u6709\u88ab\u7834\u89e3\u7684\u98ce\u9669\uff0c\u90a3\u4e48\u5e72\u8106\u5c31\u8ba9\u53cc\u65b9\u7684\u79c1\u94a5\u5728\u6bcf\u6b21\u5bc6\u94a5\u4ea4\u6362\u901a\u4fe1\u65f6\uff0c\u90fd\u662f\u968f\u673a\u751f\u6210\u7684\u3001\u4e34\u65f6\u7684\uff0c\u8fd9\u4e2a\u65b9\u5f0f\u4e5f\u5c31\u662f DHE \u7b97\u6cd5\uff0cE \u5168\u79f0\u662f ephemeral\uff08\u4e34\u65f6\u6027\u7684\uff09\u3002</p> <p>\u6240\u4ee5\uff0c\u5373\u4f7f\u6709\u4e2a\u725b\u903c\u7684\u9ed1\u5ba2\u7834\u89e3\u4e86\u67d0\u4e00\u6b21\u901a\u4fe1\u8fc7\u7a0b\u7684\u79c1\u94a5\uff0c\u5176\u4ed6\u901a\u4fe1\u8fc7\u7a0b\u7684\u79c1\u94a5\u4ecd\u7136\u662f\u5b89\u5168\u7684\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u901a\u4fe1\u8fc7\u7a0b\u7684\u79c1\u94a5\u90fd\u662f\u6ca1\u6709\u4efb\u4f55\u5173\u7cfb\u7684\uff0c\u90fd\u662f\u72ec\u7acb\u7684\uff0c\u8fd9\u6837\u5c31\u4fdd\u8bc1\u4e86\u300c\u524d\u5411\u5b89\u5168\u300d\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#ecdhe","title":"ECDHE \u7b97\u6cd5","text":"<p>DHE \u7b97\u6cd5\u7531\u4e8e\u8ba1\u7b97\u6027\u80fd\u4e0d\u4f73\uff0c\u56e0\u4e3a\u9700\u8981\u505a\u5927\u91cf\u7684\u4e58\u6cd5\uff0c\u4e3a\u4e86\u63d0\u5347 DHE \u7b97\u6cd5\u7684\u6027\u80fd\uff0c\u6240\u4ee5\u5c31\u51fa\u73b0\u4e86\u73b0\u5728\u5e7f\u6cdb\u7528\u4e8e\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5 \u2014\u2014  ECDHE \u7b97\u6cd5\u3002</p> <p>ECDHE \u7b97\u6cd5\u662f\u5728 DHE \u7b97\u6cd5\u7684\u57fa\u7840\u4e0a\u5229\u7528\u4e86 ECC \u692d\u5706\u66f2\u7ebf\u7279\u6027\uff0c\u53ef\u4ee5\u7528\u66f4\u5c11\u7684\u8ba1\u7b97\u91cf\u8ba1\u7b97\u51fa\u516c\u94a5\uff0c\u4ee5\u53ca\u6700\u7ec8\u7684\u4f1a\u8bdd\u5bc6\u94a5\u3002</p> <p>\u5c0f\u7ea2\u548c\u5c0f\u660e\u4f7f\u7528 ECDHE \u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u53cc\u65b9\u4e8b\u5148\u786e\u5b9a\u597d\u4f7f\u7528\u54ea\u79cd\u692d\u5706\u66f2\u7ebf\uff0c\u548c\u66f2\u7ebf\u4e0a\u7684\u57fa\u70b9 G\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u90fd\u662f\u516c\u5f00\u7684\uff1b</li> <li>\u53cc\u65b9\u5404\u81ea\u968f\u673a\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\u4f5c\u4e3a\u79c1\u94a5 d\uff0c\u5e76\u4e0e\u57fa\u70b9 G \u76f8\u4e58\u5f97\u5230\u516c\u94a5 Q\uff08Q = dG\uff09\uff0c\u6b64\u65f6\u5c0f\u7ea2\u7684\u516c\u79c1\u94a5\u4e3a Q1 \u548c d1\uff0c\u5c0f\u660e\u7684\u516c\u79c1\u94a5\u4e3a Q2 \u548c d2\uff1b</li> <li>\u53cc\u65b9\u4ea4\u6362\u5404\u81ea\u7684\u516c\u94a5\uff0c\u6700\u540e\u5c0f\u7ea2\u8ba1\u7b97\u70b9\uff08x1\uff0cy1\uff09 = d1Q2\uff0c\u5c0f\u660e\u8ba1\u7b97\u70b9\uff08x2\uff0cy2\uff09 = d2Q1\uff0c\u7531\u4e8e\u692d\u5706\u66f2\u7ebf\u4e0a\u662f\u53ef\u4ee5\u6ee1\u8db3\u4e58\u6cd5\u4ea4\u6362\u548c\u7ed3\u5408\u5f8b\uff0c\u6240\u4ee5 d1Q2 = d1d2G = d2d1G = d2Q1\uff0c\u56e0\u6b64\u53cc\u65b9\u7684 x \u5750\u6807\u662f\u4e00\u6837\u7684\uff0c\u6240\u4ee5\u5b83\u662f\u5171\u4eab\u5bc6\u94a5\uff0c\u4e5f\u5c31\u662f\u4f1a\u8bdd\u5bc6\u94a5\u3002</li> </ul> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\uff0c\u53cc\u65b9\u7684\u79c1\u94a5\u90fd\u662f\u968f\u673a\u3001\u4e34\u65f6\u751f\u6210\u7684\uff0c\u90fd\u662f\u4e0d\u516c\u5f00\u7684\uff0c\u5373\u4f7f\u6839\u636e\u516c\u5f00\u7684\u4fe1\u606f\uff08\u692d\u5706\u66f2\u7ebf\u3001\u516c\u94a5\u3001\u57fa\u70b9 G\uff09\u4e5f\u662f\u5f88\u96be\u8ba1\u7b97\u51fa\u692d\u5706\u66f2\u7ebf\u4e0a\u7684\u79bb\u6563\u5bf9\u6570\uff08\u79c1\u94a5\uff09\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#ecdhe_1","title":"ECDHE \u63e1\u624b\u8fc7\u7a0b","text":"<p>\u77e5\u9053\u4e86 ECDHE \u7b97\u6cd5\u57fa\u672c\u539f\u7406\u540e\uff0c\u6211\u4eec\u5c31\u7ed3\u5408\u5b9e\u9645\u7684\u60c5\u51b5\u6765\u770b\u770b\u3002  </p> <p>\u6211\u7528 Wireshark \u5de5\u5177\u6293\u4e86\u7528 ECDHE \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\u7684 TSL \u63e1\u624b\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u770b\u5230\u662f\u56db\u6b21\u63e1\u624b\uff1a</p> <p></p> <p>\u7ec6\u5fc3\u7684\u5c0f\u4f19\u4f34\u5e94\u8be5\u53d1\u73b0\u4e86\uff0c\u4f7f\u7528\u4e86 ECDHE\uff0c\u5728 TLS \u7b2c\u56db\u6b21\u63e1\u624b\u524d\uff0c\u5ba2\u6237\u7aef\u5c31\u5df2\u7ecf\u53d1\u9001\u4e86\u52a0\u5bc6\u7684 HTTP \u6570\u636e\uff0c\u800c\u5bf9\u4e8e RSA \u63e1\u624b\u8fc7\u7a0b\uff0c\u5fc5\u987b\u8981\u5b8c\u6210 TLS \u56db\u6b21\u63e1\u624b\uff0c\u624d\u80fd\u4f20\u8f93\u5e94\u7528\u6570\u636e\u3002</p> <p>\u6240\u4ee5\uff0cECDHE \u76f8\u6bd4 RSA \u63e1\u624b\u8fc7\u7a0b\u7701\u53bb\u4e86\u4e00\u4e2a\u6d88\u606f\u5f80\u8fd4\u7684\u65f6\u95f4\uff0c\u8fd9\u4e2a\u6709\u70b9\u300c\u62a2\u8dd1\u300d\u7684\u610f\u601d\uff0c\u5b83\u88ab\u79f0\u4e3a\u662f\u300cTLS False Start\u300d\uff0c\u8ddf\u300cTCP Fast Open\u300d\u6709\u70b9\u50cf\uff0c\u90fd\u662f\u5728\u8fd8\u6ca1\u8fde\u63a5\u5b8c\u5168\u5efa\u7acb\u524d\uff0c\u5c31\u53d1\u9001\u4e86\u5e94\u7528\u6570\u636e\uff0c\u8fd9\u6837\u4fbf\u63d0\u9ad8\u4e86\u4f20\u8f93\u7684\u6548\u7387\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u6790\u6bcf\u4e00\u4e2a ECDHE \u63e1\u624b\u8fc7\u7a0b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#tls","title":"TLS \u7b2c\u4e00\u6b21\u63e1\u624b","text":"<p>\u5ba2\u6237\u7aef\u9996\u5148\u4f1a\u53d1\u4e00\u4e2a\u300cClient Hello\u300d\u6d88\u606f\uff0c\u6d88\u606f\u91cc\u9762\u6709\u5ba2\u6237\u7aef\u4f7f\u7528\u7684 TLS \u7248\u672c\u53f7\u3001\u652f\u6301\u7684\u5bc6\u7801\u5957\u4ef6\u5217\u8868\uff0c\u4ee5\u53ca\u751f\u6210\u7684\u968f\u673a\u6570\uff08Client Random\uff09\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#tls_1","title":"TLS \u7b2c\u4e8c\u6b21\u63e1\u624b","text":"<p>\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684\u300c\u6253\u62db\u547c\u300d\uff0c\u540c\u6837\u4e5f\u8981\u56de\u793c\uff0c\u4f1a\u8fd4\u56de\u300cServer Hello\u300d\u6d88\u606f\uff0c\u6d88\u606f\u9762\u6709\u670d\u52a1\u5668\u786e\u8ba4\u7684 TLS \u7248\u672c\u53f7\uff0c\u4e5f\u7ed9\u51fa\u4e86\u4e00\u4e2a\u968f\u673a\u6570\uff08Server Random\uff09\uff0c\u7136\u540e\u4ece\u5ba2\u6237\u7aef\u7684\u5bc6\u7801\u5957\u4ef6\u5217\u8868\u9009\u62e9\u4e86\u4e00\u4e2a\u5408\u9002\u7684\u5bc6\u7801\u5957\u4ef6\u3002</p> <p></p> <p>\u4e0d\u8fc7\uff0c\u8fd9\u6b21\u9009\u62e9\u7684\u5bc6\u7801\u5957\u4ef6\u5c31\u548c RSA \u4e0d\u4e00\u6837\u4e86\uff0c\u6211\u4eec\u6765\u5206\u6790\u4e00\u4e0b\u8fd9\u6b21\u7684\u5bc6\u7801\u5957\u4ef6\u7684\u610f\u601d\u3002</p> <p>\u300c TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384\u300d</p> <ul> <li>\u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\u4f7f\u7528 ECDHE\uff1b</li> <li>\u7b7e\u540d\u7b97\u6cd5\u4f7f\u7528 RSA\uff1b</li> <li>\u63e1\u624b\u540e\u7684\u901a\u4fe1\u4f7f\u7528 AES \u5bf9\u79f0\u7b97\u6cd5\uff0c\u5bc6\u94a5\u957f\u5ea6 256 \u4f4d\uff0c\u5206\u7ec4\u6a21\u5f0f\u662f GCM\uff1b</li> <li>\u6458\u8981\u7b97\u6cd5\u4f7f\u7528 SHA384\uff1b</li> </ul> <p>\u63a5\u7740\uff0c\u670d\u52a1\u7aef\u4e3a\u4e86\u8bc1\u660e\u81ea\u5df1\u7684\u8eab\u4efd\uff0c\u53d1\u9001\u300cCertificate\u300d\u6d88\u606f\uff0c\u4f1a\u628a\u8bc1\u4e66\u4e5f\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002</p> <p></p> <p>\u8fd9\u4e00\u6b65\u5c31\u548c RSA \u63e1\u624b\u8fc7\u7a0b\u6709\u5f88\u5927\u5230\u533a\u522b\u4e86\uff0c\u56e0\u4e3a\u670d\u52a1\u7aef\u9009\u62e9\u4e86 ECDHE \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\uff0c\u6240\u4ee5\u4f1a\u5728\u53d1\u9001\u5b8c\u8bc1\u4e66\u540e\uff0c\u53d1\u9001\u300cServer Key Exchange\u300d\u6d88\u606f\u3002</p> <p></p> <p>\u8fd9\u4e2a\u8fc7\u7a0b\u670d\u52a1\u5668\u505a\u4e86\u4e09\u4ef6\u4e8b\uff1a</p> <ul> <li>\u9009\u62e9\u4e86\u540d\u4e3a x25519 \u7684\u692d\u5706\u66f2\u7ebf\uff0c\u9009\u597d\u4e86\u692d\u5706\u66f2\u7ebf\u76f8\u5f53\u4e8e\u692d\u5706\u66f2\u7ebf\u57fa\u70b9 G \u4e5f\u5b9a\u597d\u4e86\uff0c\u8fd9\u4e9b\u90fd\u4f1a\u516c\u5f00\u7ed9\u5ba2\u6237\u7aef\uff1b</li> <li>\u751f\u6210\u968f\u673a\u6570\u4f5c\u4e3a\u670d\u52a1\u7aef\u692d\u5706\u66f2\u7ebf\u7684\u79c1\u94a5\uff0c\u4fdd\u7559\u5230\u672c\u5730\uff1b</li> <li>\u6839\u636e\u57fa\u70b9 G \u548c\u79c1\u94a5\u8ba1\u7b97\u51fa\u670d\u52a1\u7aef\u7684\u692d\u5706\u66f2\u7ebf\u516c\u94a5\uff0c\u8fd9\u4e2a\u4f1a\u516c\u5f00\u7ed9\u5ba2\u6237\u7aef\u3002</li> </ul> <p>\u4e3a\u4e86\u4fdd\u8bc1\u8fd9\u4e2a\u692d\u5706\u66f2\u7ebf\u7684\u516c\u94a5\u4e0d\u88ab\u7b2c\u4e09\u65b9\u7be1\u6539\uff0c\u670d\u52a1\u7aef\u4f1a\u7528 RSA \u7b7e\u540d\u7b97\u6cd5\u7ed9\u670d\u52a1\u7aef\u7684\u692d\u5706\u66f2\u7ebf\u516c\u94a5\u505a\u4e2a\u7b7e\u540d\u3002</p> <p>\u968f\u540e\uff0c\u5c31\u662f\u300cServer Hello Done\u300d\u6d88\u606f\uff0c\u670d\u52a1\u7aef\u8ddf\u5ba2\u6237\u7aef\u8868\u660e\uff1a\u201c\u8fd9\u4e9b\u5c31\u662f\u6211\u63d0\u4f9b\u7684\u4fe1\u606f\uff0c\u6253\u62db\u547c\u5b8c\u6bd5\u201d\u3002</p> <p></p> <p>\u81f3\u6b64\uff0cTLS \u4e24\u6b21\u63e1\u624b\u5c31\u5df2\u7ecf\u5b8c\u6210\u4e86\uff0c\u76ee\u524d\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u901a\u8fc7\u660e\u6587\u5171\u4eab\u4e86\u8fd9\u51e0\u4e2a\u4fe1\u606f\uff1aClient Random\u3001Server Random\u3001\u4f7f\u7528\u7684\u692d\u5706\u66f2\u7ebf\u3001\u692d\u5706\u66f2\u7ebf\u57fa\u70b9 G\u3001\u670d\u52a1\u7aef\u692d\u5706\u66f2\u7ebf\u7684\u516c\u94a5\uff0c\u8fd9\u51e0\u4e2a\u4fe1\u606f\u5f88\u91cd\u8981\uff0c\u662f\u540e\u7eed\u751f\u6210\u4f1a\u8bdd\u5bc6\u94a5\u7684\u6750\u6599\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#tls_2","title":"TLS \u7b2c\u4e09\u6b21\u63e1\u624b","text":"<p>\u5ba2\u6237\u7aef\u6536\u5230\u4e86\u670d\u52a1\u7aef\u7684\u8bc1\u4e66\u540e\uff0c\u81ea\u7136\u8981\u6821\u9a8c\u8bc1\u4e66\u662f\u5426\u5408\u6cd5\uff0c\u5982\u679c\u8bc1\u4e66\u5408\u6cd5\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u5230\u8eab\u4efd\u5c31\u662f\u6ca1\u95ee\u9898\u7684\u3002\u6821\u9a8c\u8bc1\u4e66\u7684\u8fc7\u7a0b\u4f1a\u8d70\u8bc1\u4e66\u94fe\u9010\u7ea7\u9a8c\u8bc1\uff0c\u786e\u8ba4\u8bc1\u4e66\u7684\u771f\u5b9e\u6027\uff0c\u518d\u7528\u8bc1\u4e66\u7684\u516c\u94a5\u9a8c\u8bc1\u7b7e\u540d\uff0c\u8fd9\u6837\u5c31\u80fd\u786e\u8ba4\u670d\u52a1\u7aef\u7684\u8eab\u4efd\u4e86\uff0c\u786e\u8ba4\u65e0\u8bef\u540e\uff0c\u5c31\u53ef\u4ee5\u7ee7\u7eed\u5f80\u4e0b\u8d70\u3002</p> <p>\u5ba2\u6237\u7aef\u4f1a\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\u4f5c\u4e3a\u5ba2\u6237\u7aef\u692d\u5706\u66f2\u7ebf\u7684\u79c1\u94a5\uff0c\u7136\u540e\u518d\u6839\u636e\u670d\u52a1\u7aef\u524d\u9762\u7ed9\u7684\u4fe1\u606f\uff0c\u751f\u6210\u5ba2\u6237\u7aef\u7684\u692d\u5706\u66f2\u7ebf\u516c\u94a5\uff0c\u7136\u540e\u7528\u300cClient Key Exchange\u300d\u6d88\u606f\u53d1\u7ed9\u670d\u52a1\u7aef\u3002</p> <p></p> <p>\u81f3\u6b64\uff0c\u53cc\u65b9\u90fd\u6709\u5bf9\u65b9\u7684\u692d\u5706\u66f2\u7ebf\u516c\u94a5\u3001\u81ea\u5df1\u7684\u692d\u5706\u66f2\u7ebf\u79c1\u94a5\u3001\u692d\u5706\u66f2\u7ebf\u57fa\u70b9 G\u3002\u4e8e\u662f\uff0c\u53cc\u65b9\u90fd\u5c31\u8ba1\u7b97\u51fa\u70b9\uff08x\uff0cy\uff09\uff0c\u5176\u4e2d x \u5750\u6807\u503c\u53cc\u65b9\u90fd\u662f\u4e00\u6837\u7684\uff0c\u524d\u9762\u8bf4 ECDHE \u7b97\u6cd5\u65f6\u5019\uff0c\u8bf4  x \u662f\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u4f46\u5b9e\u9645\u5e94\u7528\u4e2d\uff0cx \u8fd8\u4e0d\u662f\u6700\u7ec8\u7684\u4f1a\u8bdd\u5bc6\u94a5\u3002</p> <p>\u8fd8\u8bb0\u5f97 TLS \u63e1\u624b\u9636\u6bb5\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u4f1a\u751f\u6210\u4e86\u4e00\u4e2a\u968f\u673a\u6570\u4f20\u9012\u7ed9\u5bf9\u65b9\u5417\uff1f</p> <p>\u6700\u7ec8\u7684\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u5c31\u662f\u7528\u300c\u5ba2\u6237\u7aef\u968f\u673a\u6570 + \u670d\u52a1\u7aef\u968f\u673a\u6570 + x\uff08ECDHE \u7b97\u6cd5\u7b97\u51fa\u7684\u5171\u4eab\u5bc6\u94a5\uff09 \u300d\u4e09\u4e2a\u6750\u6599\u751f\u6210\u7684\u3002</p> <p>\u4e4b\u6240\u4ee5\u8fd9\u4e48\u9ebb\u70e6\uff0c\u662f\u56e0\u4e3a TLS \u8bbe\u8ba1\u8005\u4e0d\u4fe1\u4efb\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u300c\u4f2a\u968f\u673a\u6570\u300d\u7684\u53ef\u9760\u6027\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u771f\u6b63\u7684\u5b8c\u5168\u968f\u673a\uff0c\u628a\u4e09\u4e2a\u4e0d\u53ef\u9760\u7684\u968f\u673a\u6570\u6df7\u5408\u8d77\u6765\uff0c\u90a3\u4e48\u300c\u968f\u673a\u300d\u7684\u7a0b\u5ea6\u5c31\u975e\u5e38\u9ad8\u4e86\uff0c\u8db3\u591f\u8ba9\u9ed1\u5ba2\u8ba1\u7b97\u4e0d\u51fa\u6700\u7ec8\u7684\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u5b89\u5168\u6027\u66f4\u9ad8\u3002</p> <p>\u7b97\u597d\u4f1a\u8bdd\u5bc6\u94a5\u540e\uff0c\u5ba2\u6237\u7aef\u4f1a\u53d1\u4e00\u4e2a\u300cChange Cipher Spec\u300d\u6d88\u606f\uff0c\u544a\u8bc9\u670d\u52a1\u7aef\u540e\u7eed\u6539\u7528\u5bf9\u79f0\u7b97\u6cd5\u52a0\u5bc6\u901a\u4fe1\u3002</p> <p></p> <p>\u63a5\u7740\uff0c\u5ba2\u6237\u7aef\u4f1a\u53d1\u300cEncrypted Handshake Message\u300d\u6d88\u606f\uff0c\u628a\u4e4b\u524d\u53d1\u9001\u7684\u6570\u636e\u505a\u4e00\u4e2a\u6458\u8981\uff0c\u518d\u7528\u5bf9\u79f0\u5bc6\u94a5\u52a0\u5bc6\u4e00\u4e0b\uff0c\u8ba9\u670d\u52a1\u7aef\u505a\u4e2a\u9a8c\u8bc1\uff0c\u9a8c\u8bc1\u4e0b\u672c\u6b21\u751f\u6210\u7684\u5bf9\u79f0\u5bc6\u94a5\u662f\u5426\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#tls_3","title":"TLS \u7b2c\u56db\u6b21\u63e1\u624b","text":"<p>\u6700\u540e\uff0c\u670d\u52a1\u7aef\u4e5f\u4f1a\u6709\u4e00\u4e2a\u540c\u6837\u7684\u64cd\u4f5c\uff0c\u53d1\u300cChange Cipher Spec\u300d\u548c\u300cEncrypted Handshake Message\u300d\u6d88\u606f\uff0c\u5982\u679c\u53cc\u65b9\u90fd\u9a8c\u8bc1\u52a0\u5bc6\u548c\u89e3\u5bc6\u6ca1\u95ee\u9898\uff0c\u90a3\u4e48\u63e1\u624b\u6b63\u5f0f\u5b8c\u6210\u3002\u4e8e\u662f\uff0c\u5c31\u53ef\u4ee5\u6b63\u5e38\u6536\u53d1\u52a0\u5bc6\u7684 HTTP \u8bf7\u6c42\u548c\u54cd\u5e94\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_ecdhe/#_2","title":"\u603b\u7ed3","text":"<p>RSA  \u548c ECDHE \u63e1\u624b\u8fc7\u7a0b\u7684\u533a\u522b\uff1a</p> <ul> <li>RSA \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\u300c\u4e0d\u652f\u6301\u300d\u524d\u5411\u4fdd\u5bc6\uff0cECDHE \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\u300c\u652f\u6301\u300d\u524d\u5411\u4fdd\u5bc6\uff1b</li> <li>\u4f7f\u7528\u4e86 RSA \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\uff0cTLS \u5b8c\u6210\u56db\u6b21\u63e1\u624b\u540e\uff0c\u624d\u80fd\u8fdb\u884c\u5e94\u7528\u6570\u636e\u4f20\u8f93\uff0c\u800c\u5bf9\u4e8e ECDHE \u7b97\u6cd5\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u4e0d\u7528\u7b49\u670d\u52a1\u7aef\u7684\u6700\u540e\u4e00\u6b21 TLS \u63e1\u624b\uff0c\u5c31\u53ef\u4ee5\u63d0\u524d\u53d1\u51fa\u52a0\u5bc6\u7684 HTTP \u6570\u636e\uff0c\u8282\u7701\u4e86\u4e00\u4e2a\u6d88\u606f\u7684\u5f80\u8fd4\u65f6\u95f4\uff08\u8fd9\u4e2a\u662f RFC \u6587\u6863\u89c4\u5b9a\u7684\uff0c\u5177\u4f53\u539f\u56e0\u6587\u6863\u6ca1\u6709\u8bf4\u660e\uff0c\u6240\u4ee5\u8fd9\u70b9\u6211\u4e5f\u4e0d\u592a\u660e\u767d\uff09\uff1b</li> <li>\u4f7f\u7528 ECDHE\uff0c\u5728 TLS \u7b2c 2 \u6b21\u63e1\u624b\u4e2d\uff0c\u4f1a\u51fa\u73b0\u670d\u52a1\u5668\u7aef\u53d1\u51fa\u7684\u300cServer Key Exchange\u300d\u6d88\u606f\uff0c\u800c RSA \u63e1\u624b\u8fc7\u7a0b\u6ca1\u6709\u8be5\u6d88\u606f\uff1b</li> </ul> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ol> <li>https://zh.wikipedia.org/wiki/\u6a62\u5713\u66f2\u7dda\u8fea\u83f2-\u8d6b\u723e\u66fc\u91d1\u9470\u4ea4\u63db</li> <li>https://zh.wikipedia.org/wiki/\u692d\u5706\u66f2\u7ebf</li> <li>https://zh.wikipedia.org/wiki/\u8fea\u83f2-\u8d6b\u723e\u66fc\u5bc6\u9470\u4ea4\u63db</li> <li>https://time.geekbang.org/column/article/148188</li> <li>https://zhuanlan.zhihu.com/p/106967180</li> </ol> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/","title":"3.5 HTTPS \u5982\u4f55\u4f18\u5316\uff1f","text":"<p>\u7531\u88f8\u6570\u636e\u4f20\u8f93\u7684 HTTP \u534f\u8bae\u8f6c\u6210\u52a0\u5bc6\u6570\u636e\u4f20\u8f93\u7684 HTTPS \u534f\u8bae\uff0c\u7ed9\u5e94\u7528\u6570\u636e\u5957\u4e86\u4e2a\u300c\u4fdd\u62a4\u4f1e\u300d\uff0c\u63d0\u9ad8\u5b89\u5168\u6027\u7684\u540c\u65f6\u4e5f\u5e26\u6765\u4e86\u6027\u80fd\u6d88\u8017\u3002</p> <p>\u56e0\u4e3a HTTPS \u76f8\u6bd4 HTTP \u534f\u8bae\u591a\u4e00\u4e2a TLS \u534f\u8bae\u63e1\u624b\u8fc7\u7a0b\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u901a\u8fc7\u975e\u5bf9\u79f0\u52a0\u5bc6\u63e1\u624b\u534f\u5546\u6216\u8005\u4ea4\u6362\u51fa\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u6700\u957f\u53ef\u4ee5\u82b1\u8d39\u6389 2 RTT\uff0c\u63a5\u7740\u540e\u7eed\u4f20\u8f93\u7684\u5e94\u7528\u6570\u636e\u90fd\u5f97\u4f7f\u7528\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u6765\u52a0\u5bc6/\u89e3\u5bc6\u3002</p> <p>\u4e3a\u4e86\u6570\u636e\u7684\u5b89\u5168\u6027\uff0c\u6211\u4eec\u4e0d\u5f97\u4e0d\u4f7f\u7528 HTTPS \u534f\u8bae\uff0c\u81f3\u4eca\u5927\u90e8\u5206\u7f51\u5740\u90fd\u5df2\u4ece HTTP \u8fc1\u79fb\u81f3 HTTPS \u534f\u8bae\uff0c\u56e0\u6b64\u9488\u5bf9 HTTPS \u7684\u4f18\u5316\u662f\u975e\u5e38\u91cd\u8981\u7684\u3002</p> <p>\u8fd9\u6b21\uff0c\u5c31\u4ece\u591a\u4e2a\u89d2\u5ea6\u6765\u4f18\u5316 HTTPS\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_1","title":"\u5206\u6790\u6027\u80fd\u635f\u8017","text":"<p>\u65e2\u7136\u8981\u5bf9 HTTPS \u4f18\u5316\uff0c\u90a3\u5f97\u6e05\u695a\u54ea\u4e9b\u6b65\u9aa4\u4f1a\u4ea7\u751f\u6027\u80fd\u6d88\u8017\uff0c\u518d\u5bf9\u75c7\u4e0b\u836f\u3002</p> <p>\u4ea7\u751f\u6027\u80fd\u6d88\u8017\u7684\u4e24\u4e2a\u73af\u8282\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a\u73af\u8282\uff0cTLS \u534f\u8bae\u63e1\u624b\u8fc7\u7a0b\uff1b</li> <li>\u7b2c\u4e8c\u4e2a\u73af\u8282\uff0c\u63e1\u624b\u540e\u7684\u5bf9\u79f0\u52a0\u5bc6\u62a5\u6587\u4f20\u8f93\u3002</li> </ul> <p>\u5bf9\u4e8e\u7b2c\u4e8c\u73af\u8282\uff0c\u73b0\u5728\u4e3b\u6d41\u7684\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5 AES\u3001ChaCha20 \u6027\u80fd\u90fd\u662f\u4e0d\u9519\u7684\uff0c\u800c\u4e14\u4e00\u4e9b CPU \u5382\u5546\u8fd8\u9488\u5bf9\u5b83\u4eec\u505a\u4e86\u786c\u4ef6\u7ea7\u522b\u7684\u4f18\u5316\uff0c\u56e0\u6b64\u8fd9\u4e2a\u73af\u8282\u7684\u6027\u80fd\u6d88\u8017\u53ef\u4ee5\u8bf4\u975e\u5e38\u5730\u5c0f\u3002</p> <p>\u800c\u7b2c\u4e00\u4e2a\u73af\u8282\uff0cTLS \u534f\u8bae\u63e1\u624b\u8fc7\u7a0b\u4e0d\u4ec5\u589e\u52a0\u4e86\u7f51\u7edc\u5ef6\u65f6\uff08\u6700\u957f\u53ef\u4ee5\u82b1\u8d39\u6389 2 RTT\uff09\uff0c\u800c\u4e14\u63e1\u624b\u8fc7\u7a0b\u4e2d\u7684\u4e00\u4e9b\u6b65\u9aa4\u4e5f\u4f1a\u4ea7\u751f\u6027\u80fd\u635f\u8017\uff0c\u6bd4\u5982\uff1a</p> <ul> <li>\u5bf9\u4e8e ECDHE \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\uff0c\u63e1\u624b\u8fc7\u7a0b\u4e2d\u4f1a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u9700\u8981\u4e34\u65f6\u751f\u6210\u692d\u5706\u66f2\u7ebf\u516c\u79c1\u94a5\uff1b</li> <li>\u5ba2\u6237\u7aef\u9a8c\u8bc1\u8bc1\u4e66\u65f6\uff0c\u4f1a\u8bbf\u95ee CA \u83b7\u53d6 CRL \u6216\u8005 OCSP\uff0c\u76ee\u7684\u662f\u9a8c\u8bc1\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u662f\u5426\u6709\u88ab\u540a\u9500\uff1b</li> <li>\u53cc\u65b9\u8ba1\u7b97 Pre-Master\uff0c\u4e5f\u5c31\u662f\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff1b</li> </ul> <p>\u4e3a\u4e86\u5927\u5bb6\u66f4\u6e05\u695a\u8fd9\u4e9b\u6b65\u9aa4\u5728 TLS \u534f\u8bae\u63e1\u624b\u7684\u54ea\u4e00\u4e2a\u9636\u6bb5\uff0c\u6211\u753b\u51fa\u4e86\u8fd9\u5e45\u56fe\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_2","title":"\u786c\u4ef6\u4f18\u5316","text":"<p>\u73a9\u6e38\u620f\u65f6\uff0c\u5982\u679c\u6211\u4eec\u600e\u4e48\u90fd\u6218\u80dc\u4e0d\u4e86\u5bf9\u65b9\uff0c\u90a3\u4e48\u6709\u4e00\u4e2a\u6700\u6709\u6548\u3001\u6700\u5feb\u7684\u65b9\u5f0f\u6765\u53d8\u5f3a\uff0c\u90a3\u5c31\u662f\u300c\u5145\u94b1\u300d\uff0c\u5982\u679c\u8fd8\u662f\u4e0d\u884c\uff0c\u90a3\u8bf4\u660e\u4f60\u5145\u7684\u94b1\u8fd8\u4e0d\u591f\u591a\u3002</p> <p></p> <p>\u5bf9\u4e8e\u8ba1\u7b97\u673a\u91cc\u4e5f\u662f\u4e00\u6837\uff0c\u8f6f\u4ef6\u90fd\u662f\u8dd1\u5728\u7269\u7406\u786c\u4ef6\u4e0a\uff0c\u786c\u4ef6\u8d8a\u725b\u903c\uff0c\u8f6f\u4ef6\u8dd1\u7684\u4e5f\u8d8a\u5feb\uff0c\u6240\u4ee5\u5982\u679c\u8981\u4f18\u5316 HTTPS \u4f18\u5316\uff0c\u6700\u76f4\u63a5\u7684\u65b9\u5f0f\u5c31\u662f\u82b1\u94b1\u4e70\u6027\u80fd\u53c2\u6570\u66f4\u725b\u903c\u7684\u786c\u4ef6\u3002</p> <p>\u4f46\u662f\u82b1\u94b1\u4e5f\u8981\u82b1\u5bf9\u65b9\u5411\uff0cHTTPS \u534f\u8bae\u662f\u8ba1\u7b97\u5bc6\u96c6\u578b\uff0c\u800c\u4e0d\u662f I/O \u5bc6\u96c6\u578b\uff0c\u6240\u4ee5\u4e0d\u80fd\u628a\u94b1\u82b1\u5728\u7f51\u5361\u3001\u786c\u76d8\u7b49\u5730\u65b9\uff0c\u5e94\u8be5\u82b1\u5728 CPU \u4e0a\u3002</p> <p>\u4e00\u4e2a\u597d\u7684 CPU\uff0c\u53ef\u4ee5\u63d0\u9ad8\u8ba1\u7b97\u6027\u80fd\uff0c\u56e0\u4e3a HTTPS \u8fde\u63a5\u8fc7\u7a0b\u4e2d\u5c31\u6709\u5927\u91cf\u9700\u8981\u8ba1\u7b97\u5bc6\u94a5\u7684\u8fc7\u7a0b\uff0c\u6240\u4ee5\u8fd9\u6837\u53ef\u4ee5\u52a0\u901f TLS \u63e1\u624b\u8fc7\u7a0b\u3002</p> <p>\u53e6\u5916\uff0c\u5982\u679c\u53ef\u4ee5\uff0c\u5e94\u8be5\u9009\u62e9\u53ef\u4ee5\u652f\u6301 AES-NI \u7279\u6027\u7684 CPU\uff0c\u56e0\u4e3a\u8fd9\u79cd\u6b3e\u5f0f\u7684 CPU \u80fd\u5728\u6307\u4ee4\u7ea7\u522b\u4f18\u5316\u4e86 AES \u7b97\u6cd5\uff0c\u8fd9\u6837\u4fbf\u52a0\u901f\u4e86\u6570\u636e\u7684\u52a0\u89e3\u5bc6\u4f20\u8f93\u8fc7\u7a0b\u3002</p> <p>\u5982\u679c\u4f60\u7684\u670d\u52a1\u5668\u662f Linux \u7cfb\u7edf\uff0c\u90a3\u4e48\u4f60\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u8fd9\u884c\u547d\u4ee4\u67e5\u770b CPU \u662f\u5426\u652f\u6301 AES-NI \u6307\u4ee4\u96c6\uff1a</p> <p></p> <p>\u5982\u679c\u6211\u4eec\u7684 CPU \u652f\u6301 AES-NI \u7279\u6027\uff0c\u90a3\u4e48\u5bf9\u4e8e\u5bf9\u79f0\u52a0\u5bc6\u7684\u7b97\u6cd5\u5e94\u8be5\u9009\u62e9 AES \u7b97\u6cd5\u3002\u5426\u5219\u53ef\u4ee5\u9009\u62e9 ChaCha20 \u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff0c\u56e0\u4e3a ChaCha20 \u7b97\u6cd5\u7684\u8fd0\u7b97\u6307\u4ee4\u76f8\u6bd4 AES \u7b97\u6cd5\u4f1a\u5bf9 CPU \u66f4\u53cb\u597d\u4e00\u70b9\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_3","title":"\u8f6f\u4ef6\u4f18\u5316","text":"<p>\u5982\u679c\u516c\u53f8\u9884\u7b97\u5145\u8db3\u5bf9\u4e8e\u65b0\u7684\u670d\u52a1\u5668\u662f\u53ef\u4ee5\u8003\u8651\u8d2d\u4e70\u66f4\u597d\u7684 CPU\uff0c\u4f46\u662f\u5bf9\u4e8e\u5df2\u7ecf\u5728\u4f7f\u7528\u7684\u670d\u52a1\u5668\uff0c\u786c\u4ef6\u4f18\u5316\u7684\u65b9\u5f0f\u53ef\u80fd\u5c31\u4e0d\u592a\u9002\u5408\u4e86\uff0c\u4e8e\u662f\u5c31\u8981\u4ece\u8f6f\u4ef6\u7684\u65b9\u5411\u6765\u4f18\u5316\u4e86\u3002</p> <p>\u8f6f\u4ef6\u7684\u4f18\u5316\u65b9\u5411\u53ef\u4ee5\u5206\u6210\u4e24\u79cd\uff0c\u4e00\u4e2a\u662f\u8f6f\u4ef6\u5347\u7ea7\uff0c\u4e00\u4e2a\u662f\u534f\u8bae\u4f18\u5316\u3002</p> <p>\u5148\u8bf4\u7b2c\u4e00\u4e2a\u8f6f\u4ef6\u5347\u7ea7\uff0c\u8f6f\u4ef6\u5347\u7ea7\u5c31\u662f\u5c06\u6b63\u5728\u4f7f\u7528\u7684\u8f6f\u4ef6\u5347\u7ea7\u5230\u6700\u65b0\u7248\u672c\uff0c\u56e0\u4e3a\u6700\u65b0\u7248\u672c\u4e0d\u4ec5\u63d0\u4f9b\u4e86\u6700\u65b0\u7684\u7279\u6027\uff0c\u4e5f\u4f18\u5316\u4e86\u4ee5\u524d\u8f6f\u4ef6\u7684\u95ee\u9898\u6216\u6027\u80fd\u3002\u6bd4\u5982\uff1a</p> <ul> <li>\u5c06 Linux \u5185\u6838\u4ece 2.x \u5347\u7ea7\u5230 4.x\uff1b</li> <li>\u5c06 OpenSSL \u4ece 1.0.1 \u5347\u7ea7\u5230 1.1.1\uff1b</li> <li>...</li> </ul> <p>\u770b\u4f3c\u7b80\u5355\u7684\u8f6f\u4ef6\u5347\u7ea7\uff0c\u5bf9\u4e8e\u6709\u6210\u767e\u4e0a\u5343\u670d\u52a1\u5668\u7684\u516c\u53f8\u6765\u8bf4\uff0c\u8f6f\u4ef6\u5347\u7ea7\u4e5f\u8ddf\u786c\u4ef6\u5347\u7ea7\u540c\u6837\u662f\u4e00\u4e2a\u68d8\u624b\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u8981\u5b9e\u884c\u8f6f\u4ef6\u5347\u7ea7\uff0c\u4f1a\u82b1\u8d39\u65f6\u95f4\u548c\u4eba\u529b\uff0c\u540c\u65f6\u4e5f\u5b58\u5728\u4e00\u5b9a\u7684\u98ce\u9669\uff0c\u4e5f\u53ef\u80fd\u4f1a\u5f71\u54cd\u6b63\u5e38\u7684\u7ebf\u4e0a\u670d\u52a1\u3002</p> <p>\u65e2\u7136\u5982\u6b64\uff0c\u6211\u4eec\u628a\u76ee\u5149\u653e\u5230\u534f\u8bae\u4f18\u5316\uff0c\u4e5f\u5c31\u662f\u5728\u73b0\u6709\u7684\u73af\u8282\u4e0b\uff0c\u901a\u8fc7\u8f83\u5c0f\u7684\u6539\u52a8\uff0c\u6765\u8fdb\u884c\u4f18\u5316\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_4","title":"\u534f\u8bae\u4f18\u5316","text":"<p>\u534f\u8bae\u7684\u4f18\u5316\u5c31\u662f\u5bf9\u300c\u5bc6\u94a5\u4ea4\u6362\u8fc7\u7a0b\u300d\u8fdb\u884c\u4f18\u5316\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_5","title":"\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u4f18\u5316","text":"<p>TLS 1.2 \u7248\u672c\u5982\u679c\u4f7f\u7528\u7684\u662f RSA \u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\uff0c\u90a3\u4e48\u9700\u8981 4 \u6b21\u63e1\u624b\uff0c\u4e5f\u5c31\u662f\u8981\u82b1\u8d39 2 RTT\uff0c\u624d\u53ef\u4ee5\u8fdb\u884c\u5e94\u7528\u6570\u636e\u7684\u4f20\u8f93\uff0c\u800c\u4e14 RSA \u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u4e0d\u5177\u5907\u524d\u5411\u5b89\u5168\u6027\u3002</p> <p>\u603b\u4e4b\u4f7f\u7528 RSA \u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\uff0c\u4e0d\u4ec5\u6162\uff0c\u800c\u4e14\u5b89\u5168\u6027\u4e5f\u4e0d\u9ad8\u3002</p> <p>\u56e0\u6b64\u5982\u679c\u53ef\u4ee5\uff0c\u5c3d\u91cf\u9009\u7528 ECDHE \u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u66ff\u6362 RSA \u7b97\u6cd5\uff0c\u56e0\u4e3a\u8be5\u7b97\u6cd5\u7531\u4e8e\u652f\u6301\u300cFalse Start\u300d\uff0c\u5b83\u662f\u201c\u62a2\u8dd1\u201d\u7684\u610f\u601d\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u5728 TLS \u534f\u8bae\u7684\u7b2c 3 \u6b21\u63e1\u624b\u540e\uff0c\u7b2c 4 \u6b21\u63e1\u624b\u524d\uff0c\u53d1\u9001\u52a0\u5bc6\u7684\u5e94\u7528\u6570\u636e\uff0c\u4ee5\u6b64\u5c06 TLS \u63e1\u624b\u7684\u6d88\u606f\u5f80\u8fd4\u7531 2 RTT \u51cf\u5c11\u5230 1 RTT\uff0c\u800c\u4e14\u5b89\u5168\u6027\u4e5f\u9ad8\uff0c\u5177\u5907\u524d\u5411\u5b89\u5168\u6027\u3002</p> <p>ECDHE \u7b97\u6cd5\u662f\u57fa\u4e8e\u692d\u5706\u66f2\u7ebf\u5b9e\u73b0\u7684\uff0c\u4e0d\u540c\u7684\u692d\u5706\u66f2\u7ebf\u6027\u80fd\u4e5f\u4e0d\u540c\uff0c\u5e94\u8be5\u5c3d\u91cf\u9009\u62e9 x25519 \u66f2\u7ebf\uff0c\u8be5\u66f2\u7ebf\u662f\u76ee\u524d\u6700\u5feb\u7684\u692d\u5706\u66f2\u7ebf\u3002</p> <p>\u6bd4\u5982\u5728 Nginx \u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528 ssl_ecdh_curve \u6307\u4ee4\u914d\u7f6e\u60f3\u4f7f\u7528\u7684\u692d\u5706\u66f2\u7ebf\uff0c\u628a\u4f18\u5148\u4f7f\u7528\u7684\u653e\u5728\u524d\u9762\uff1a</p> <p></p> <p>\u5bf9\u4e8e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u65b9\u9762\uff0c\u5982\u679c\u5bf9\u5b89\u5168\u6027\u4e0d\u662f\u7279\u522b\u9ad8\u7684\u8981\u6c42\uff0c\u53ef\u4ee5\u9009\u7528 AES_128_GCM\uff0c\u5b83\u6bd4 AES_256_GCM \u5feb\u4e00\u4e9b\uff0c\u56e0\u4e3a\u5bc6\u94a5\u7684\u957f\u5ea6\u77ed\u4e00\u4e9b\u3002</p> <p>\u6bd4\u5982\u5728 Nginx \u4e0a\uff0c\u53ef\u4ee5\u4f7f\u7528 ssl_ciphers \u6307\u4ee4\u914d\u7f6e\u60f3\u4f7f\u7528\u7684\u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\u548c\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff0c\u4e5f\u5c31\u662f\u5bc6\u94a5\u5957\u4ef6\uff0c\u800c\u4e14\u628a\u6027\u80fd\u6700\u5feb\u6700\u5b89\u5168\u7684\u7b97\u6cd5\u653e\u5728\u6700\u524d\u9762\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#tls","title":"TLS \u5347\u7ea7","text":"<p>\u5f53\u7136\uff0c\u5982\u679c\u53ef\u4ee5\uff0c\u76f4\u63a5\u628a TLS 1.2 \u5347\u7ea7\u6210 TLS 1.3\uff0cTLS 1.3 \u5927\u5e45\u5ea6\u7b80\u5316\u4e86\u63e1\u624b\u7684\u6b65\u9aa4\uff0c\u5b8c\u6210 TLS \u63e1\u624b\u53ea\u8981 1 RTT\uff0c\u800c\u4e14\u5b89\u5168\u6027\u66f4\u9ad8\u3002</p> <p>\u5728 TLS 1.2 \u7684\u63e1\u624b\u4e2d\uff0c\u4e00\u822c\u662f\u9700\u8981 4 \u6b21\u63e1\u624b\uff0c\u5148\u8981\u901a\u8fc7 Client Hello\uff08\u7b2c 1 \u6b21\u63e1\u624b\uff09\u548c Server Hello\uff08\u7b2c 2 \u6b21\u63e1\u624b\uff09\u6d88\u606f\u534f\u5546\u51fa\u540e\u7eed\u4f7f\u7528\u7684\u52a0\u5bc6\u7b97\u6cd5\uff0c\u518d\u4e92\u76f8\u4ea4\u6362\u516c\u94a5\uff08\u7b2c 3 \u548c \u7b2c 4 \u6b21\u63e1\u624b\uff09\uff0c\u7136\u540e\u8ba1\u7b97\u51fa\u6700\u7ec8\u7684\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u4e0b\u56fe\u7684\u5de6\u8fb9\u90e8\u5206\u5c31\u662f TLS 1.2 \u7684\u63e1\u624b\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u4e0a\u56fe\u7684\u53f3\u8fb9\u90e8\u5206\u5c31\u662f TLS 1.3 \u7684\u63e1\u624b\u8fc7\u7a0b\uff0c\u53ef\u4ee5\u53d1\u73b0 TLS 1.3 \u628a Hello \u548c\u516c\u94a5\u4ea4\u6362\u8fd9\u4e24\u4e2a\u6d88\u606f\u5408\u5e76\u6210\u4e86\u4e00\u4e2a\u6d88\u606f\uff0c\u4e8e\u662f\u8fd9\u6837\u5c31\u51cf\u5c11\u5230\u53ea\u9700 1 RTT \u5c31\u80fd\u5b8c\u6210 TLS \u63e1\u624b\u3002</p> <p>\u600e\u4e48\u5408\u5e76\u7684\u5462\uff1f\u5177\u4f53\u7684\u505a\u6cd5\u662f\uff0c\u5ba2\u6237\u7aef\u5728  Client Hello \u6d88\u606f\u91cc\u5e26\u4e0a\u4e86\u652f\u6301\u7684\u692d\u5706\u66f2\u7ebf\uff0c\u4ee5\u53ca\u8fd9\u4e9b\u692d\u5706\u66f2\u7ebf\u5bf9\u5e94\u7684\u516c\u94a5\u3002</p> <p>\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u9009\u5b9a\u4e00\u4e2a\u692d\u5706\u66f2\u7ebf\u7b49\u53c2\u6570\uff0c\u7136\u540e\u8fd4\u56de\u6d88\u606f\u65f6\uff0c\u5e26\u4e0a\u670d\u52a1\u7aef\u8fd9\u8fb9\u7684\u516c\u94a5\u3002\u7ecf\u8fc7\u8fd9 1 \u4e2a RTT\uff0c\u53cc\u65b9\u624b\u4e0a\u5df2\u7ecf\u6709\u751f\u6210\u4f1a\u8bdd\u5bc6\u94a5\u7684\u6750\u6599\u4e86\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u8ba1\u7b97\u51fa\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u5c31\u53ef\u4ee5\u8fdb\u884c\u5e94\u7528\u6570\u636e\u7684\u52a0\u5bc6\u4f20\u8f93\u4e86\u3002</p> <p>\u800c\u4e14\uff0cTLS1.3 \u5bf9\u5bc6\u7801\u5957\u4ef6\u8fdb\u884c\u201c\u51cf\u80a5\u201d\u4e86\uff0c \u5bf9\u4e8e\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\uff0c\u5e9f\u9664\u4e86\u4e0d\u652f\u6301\u524d\u5411\u5b89\u5168\u6027\u7684  RSA \u548c DH \u7b97\u6cd5\uff0c\u53ea\u652f\u6301 ECDHE \u7b97\u6cd5\u3002</p> <p>\u5bf9\u4e8e\u5bf9\u79f0\u52a0\u5bc6\u548c\u7b7e\u540d\u7b97\u6cd5\uff0c\u53ea\u652f\u6301\u76ee\u524d\u6700\u5b89\u5168\u7684\u51e0\u4e2a\u5bc6\u7801\u5957\u4ef6\uff0c\u6bd4\u5982 openssl \u4e2d\u4ec5\u652f\u6301\u4e0b\u9762 5 \u79cd\u5bc6\u7801\u5957\u4ef6\uff1a</p> <ul> <li>TLS_AES_256_GCM_SHA384</li> <li>TLS_CHACHA20_POLY1305_SHA256</li> <li>TLS_AES_128_GCM_SHA256</li> <li>TLS_AES_128_CCM_8_SHA256</li> <li>TLS_AES_128_CCM_SHA256</li> </ul> <p>\u4e4b\u6240\u4ee5 TLS1.3   \u4ec5\u652f\u6301\u8fd9\u4e48\u5c11\u7684\u5bc6\u7801\u5957\u4ef6\uff0c\u662f\u56e0\u4e3a TLS1.2 \u7531\u4e8e\u652f\u6301\u5404\u79cd\u53e4\u8001\u4e14\u4e0d\u5b89\u5168\u7684\u5bc6\u7801\u5957\u4ef6\uff0c\u4e2d\u95f4\u4eba\u53ef\u4ee5\u5229\u7528\u964d\u7ea7\u653b\u51fb\uff0c\u4f2a\u9020\u5ba2\u6237\u7aef\u7684 Client Hello \u6d88\u606f\uff0c\u66ff\u6362\u5ba2\u6237\u7aef\u652f\u6301\u7684\u5bc6\u7801\u5957\u4ef6\u4e3a\u4e00\u4e9b\u4e0d\u5b89\u5168\u7684\u5bc6\u7801\u5957\u4ef6\uff0c\u4f7f\u5f97\u670d\u52a1\u5668\u88ab\u8feb\u4f7f\u7528\u8fd9\u4e2a\u5bc6\u7801\u5957\u4ef6\u8fdb\u884c HTTPS \u8fde\u63a5\uff0c\u4ece\u800c\u7834\u89e3\u5bc6\u6587\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_6","title":"\u8bc1\u4e66\u4f18\u5316","text":"<p>\u4e3a\u4e86\u9a8c\u8bc1\u7684\u670d\u52a1\u5668\u7684\u8eab\u4efd\uff0c\u670d\u52a1\u5668\u4f1a\u5728 TLS \u63e1\u624b\u8fc7\u7a0b\u4e2d\uff0c\u628a\u81ea\u5df1\u7684\u8bc1\u4e66\u53d1\u7ed9\u5ba2\u6237\u7aef\uff0c\u4ee5\u6b64\u8bc1\u660e\u81ea\u5df1\u8eab\u4efd\u662f\u53ef\u4fe1\u7684\u3002</p> <p>\u5bf9\u4e8e\u8bc1\u4e66\u7684\u4f18\u5316\uff0c\u53ef\u4ee5\u6709\u4e24\u4e2a\u65b9\u5411\uff1a</p> <ul> <li>\u4e00\u4e2a\u662f\u8bc1\u4e66\u4f20\u8f93\uff0c</li> <li>\u4e00\u4e2a\u662f\u8bc1\u4e66\u9a8c\u8bc1\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_7","title":"\u8bc1\u4e66\u4f20\u8f93\u4f18\u5316","text":"<p>\u8981\u8ba9\u8bc1\u4e66\u66f4\u4fbf\u4e8e\u4f20\u8f93\uff0c\u90a3\u5fc5\u7136\u662f\u51cf\u5c11\u8bc1\u4e66\u7684\u5927\u5c0f\uff0c\u8fd9\u6837\u53ef\u4ee5\u8282\u7ea6\u5e26\u5bbd\uff0c\u4e5f\u80fd\u51cf\u5c11\u5ba2\u6237\u7aef\u7684\u8fd0\u7b97\u91cf\u3002\u6240\u4ee5\uff0c\u5bf9\u4e8e\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u5e94\u8be5\u9009\u62e9\u692d\u5706\u66f2\u7ebf\uff08ECDSA\uff09\u8bc1\u4e66\uff0c\u800c\u4e0d\u662f RSA \u8bc1\u4e66\uff0c\u56e0\u4e3a\u5728\u76f8\u540c\u5b89\u5168\u5f3a\u5ea6\u4e0b\uff0cECC \u5bc6\u94a5\u957f\u5ea6\u6bd4 RSA \u77ed\u7684\u591a\u3002 </p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_8","title":"\u8bc1\u4e66\u9a8c\u8bc1\u4f18\u5316","text":"<p>\u5ba2\u6237\u7aef\u5728\u9a8c\u8bc1\u8bc1\u4e66\u65f6\uff0c\u662f\u4e2a\u590d\u6742\u7684\u8fc7\u7a0b\uff0c\u4f1a\u8d70\u8bc1\u4e66\u94fe\u9010\u7ea7\u9a8c\u8bc1\uff0c\u9a8c\u8bc1\u7684\u8fc7\u7a0b\u4e0d\u4ec5\u9700\u8981\u300c\u7528 CA \u516c\u94a5\u89e3\u5bc6\u8bc1\u4e66\u300d\u4ee5\u53ca\u300c\u7528\u7b7e\u540d\u7b97\u6cd5\u9a8c\u8bc1\u8bc1\u4e66\u7684\u5b8c\u6574\u6027\u300d\uff0c\u800c\u4e14\u4e3a\u4e86\u77e5\u9053\u8bc1\u4e66\u662f\u5426\u88ab CA \u540a\u9500\uff0c\u5ba2\u6237\u7aef\u6709\u65f6\u8fd8\u4f1a\u518d\u53bb\u8bbf\u95ee CA\uff0c\u4e0b\u8f7d CRL \u6216\u8005 OCSP \u6570\u636e\uff0c\u4ee5\u6b64\u786e\u8ba4\u8bc1\u4e66\u7684\u6709\u6548\u6027\u3002</p> <p>\u8fd9\u4e2a\u8bbf\u95ee\u8fc7\u7a0b\u662f HTTP \u8bbf\u95ee\uff0c\u56e0\u6b64\u53c8\u4f1a\u4ea7\u751f\u4e00\u7cfb\u5217\u7f51\u7edc\u901a\u4fe1\u7684\u5f00\u9500\uff0c\u5982 DNS \u67e5\u8be2\u3001\u5efa\u7acb\u8fde\u63a5\u3001\u6536\u53d1\u6570\u636e\u7b49\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#crl","title":"CRL","text":"<p>CRL \u79f0\u4e3a\u8bc1\u4e66\u540a\u9500\u5217\u8868\uff08Certificate Revocation List\uff09\uff0c\u8fd9\u4e2a\u5217\u8868\u662f\u7531 CA \u5b9a\u671f\u66f4\u65b0\uff0c\u5217\u8868\u5185\u5bb9\u90fd\u662f\u88ab\u64a4\u9500\u4fe1\u4efb\u7684\u8bc1\u4e66\u5e8f\u53f7\uff0c\u5982\u679c\u670d\u52a1\u5668\u7684\u8bc1\u4e66\u5728\u6b64\u5217\u8868\uff0c\u5c31\u8ba4\u4e3a\u8bc1\u4e66\u5df2\u7ecf\u5931\u6548\uff0c\u4e0d\u5728\u7684\u8bdd\uff0c\u5219\u8ba4\u4e3a\u8bc1\u4e66\u662f\u6709\u6548\u7684\u3002</p> <p></p> <p>\u4f46\u662f CRL \u5b58\u5728\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a\u95ee\u9898\uff0c\u7531\u4e8e CRL \u5217\u8868\u662f\u7531 CA \u7ef4\u62a4\u7684\uff0c\u5b9a\u671f\u66f4\u65b0\uff0c\u5982\u679c\u4e00\u4e2a\u8bc1\u4e66\u521a\u88ab\u540a\u9500\u540e\uff0c\u5ba2\u6237\u7aef\u5728\u66f4\u65b0 CRL \u4e4b\u524d\u8fd8\u662f\u4f1a\u4fe1\u4efb\u8fd9\u4e2a\u8bc1\u4e66\uff0c\u5b9e\u65f6\u6027\u8f83\u5dee\uff1b</li> <li>\u7b2c\u4e8c\u4e2a\u95ee\u9898\uff0c\u968f\u7740\u540a\u9500\u8bc1\u4e66\u7684\u589e\u591a\uff0c\u5217\u8868\u4f1a\u8d8a\u6765\u8d8a\u5927\uff0c\u4e0b\u8f7d\u7684\u901f\u5ea6\u5c31\u4f1a\u8d8a\u6162\uff0c\u4e0b\u8f7d\u5b8c\u5ba2\u6237\u7aef\u8fd8\u5f97\u904d\u5386\u8fd9\u4e48\u5927\u7684\u5217\u8868\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u5728\u6821\u9a8c\u8bc1\u4e66\u8fd9\u4e00\u73af\u8282\u7684\u5ef6\u65f6\u5f88\u5927\uff0c\u8fdb\u800c\u62d6\u6162\u4e86 HTTPS \u8fde\u63a5\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#ocsp","title":"OCSP","text":"<p>\u56e0\u6b64\uff0c\u73b0\u5728\u57fa\u672c\u90fd\u662f\u4f7f\u7528 OCSP\uff0c\u540d\u4e3a\u5728\u7ebf\u8bc1\u4e66\u72b6\u6001\u534f\u8bae\uff08Online Certificate Status Protocol\uff09\u6765\u67e5\u8be2\u8bc1\u4e66\u7684\u6709\u6548\u6027\uff0c\u5b83\u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\u5411 CA \u53d1\u9001\u67e5\u8be2\u8bf7\u6c42\uff0c\u8ba9 CA \u8fd4\u56de\u8bc1\u4e66\u7684\u6709\u6548\u72b6\u6001\u3002</p> <p></p> <p>\u4e0d\u5fc5\u50cf CRL \u65b9\u5f0f\u5ba2\u6237\u7aef\u9700\u8981\u4e0b\u8f7d\u5927\u5927\u7684\u5217\u8868\uff0c\u8fd8\u8981\u4ece\u5217\u8868\u67e5\u8be2\uff0c\u540c\u65f6\u56e0\u4e3a\u53ef\u4ee5\u5b9e\u65f6\u67e5\u8be2\u6bcf\u4e00\u5f20\u8bc1\u4e66\u7684\u6709\u6548\u6027\uff0c\u89e3\u51b3\u4e86 CRL \u7684\u5b9e\u65f6\u6027\u95ee\u9898\u3002</p> <p>OCSP \u9700\u8981\u5411  CA \u67e5\u8be2\uff0c\u56e0\u6b64\u4e5f\u662f\u8981\u53d1\u751f\u7f51\u7edc\u8bf7\u6c42\uff0c\u800c\u4e14\u8fd8\u5f97\u770b  CA \u670d\u52a1\u5668\u7684\u201c\u8138\u8272\u201d\uff0c\u5982\u679c\u7f51\u7edc\u72b6\u6001\u4e0d\u597d\uff0c\u6216\u8005 CA \u670d\u52a1\u5668\u7e41\u5fd9\uff0c\u4e5f\u4f1a\u5bfc\u81f4\u5ba2\u6237\u7aef\u5728\u6821\u9a8c\u8bc1\u4e66\u8fd9\u4e00\u73af\u8282\u7684\u5ef6\u65f6\u53d8\u5927\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#ocsp-stapling","title":"OCSP Stapling","text":"<p>\u4e8e\u662f\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u4e2a\u7f51\u7edc\u5f00\u9500\uff0c\u5c31\u51fa\u73b0\u4e86 OCSP Stapling\uff0c\u5176\u539f\u7406\u662f\uff1a\u670d\u52a1\u5668\u5411 CA \u5468\u671f\u6027\u5730\u67e5\u8be2\u8bc1\u4e66\u72b6\u6001\uff0c\u83b7\u5f97\u4e00\u4e2a\u5e26\u6709\u65f6\u95f4\u6233\u548c\u7b7e\u540d\u7684\u54cd\u5e94\u7ed3\u679c\u5e76\u7f13\u5b58\u5b83\u3002</p> <p></p> <p>\u5f53\u6709\u5ba2\u6237\u7aef\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u628a\u8fd9\u4e2a\u300c\u54cd\u5e94\u7ed3\u679c\u300d\u5728 TLS \u63e1\u624b\u8fc7\u7a0b\u4e2d\u53d1\u7ed9\u5ba2\u6237\u7aef\u3002\u7531\u4e8e\u6709\u7b7e\u540d\u7684\u5b58\u5728\uff0c\u670d\u52a1\u5668\u65e0\u6cd5\u7be1\u6539\uff0c\u56e0\u6b64\u5ba2\u6237\u7aef\u5c31\u80fd\u5f97\u77e5\u8bc1\u4e66\u662f\u5426\u5df2\u88ab\u540a\u9500\u4e86\uff0c\u8fd9\u6837\u5ba2\u6237\u7aef\u5c31\u4e0d\u9700\u8981\u518d\u53bb\u67e5\u8be2\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_9","title":"\u4f1a\u8bdd\u590d\u7528","text":"<p>TLS \u63e1\u624b\u7684\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u534f\u5546\u51fa\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u4e5f\u5c31\u662f\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff0c\u90a3\u6211\u4eec\u5982\u679c\u6211\u4eec\u628a\u9996\u6b21 TLS \u63e1\u624b\u534f\u5546\u7684\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u7f13\u5b58\u8d77\u6765\uff0c\u5f85\u4e0b\u6b21\u9700\u8981\u5efa\u7acb HTTPS \u8fde\u63a5\u65f6\uff0c\u76f4\u63a5\u300c\u590d\u7528\u300d\u8fd9\u4e2a\u5bc6\u94a5\uff0c\u4e0d\u5c31\u51cf\u5c11 TLS \u63e1\u624b\u7684\u6027\u80fd\u635f\u8017\u4e86\u5417\uff1f</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u5c31\u662f\u4f1a\u8bdd\u590d\u7528\uff08TLS session resumption\uff09\uff0c\u4f1a\u8bdd\u590d\u7528\u5206\u4e24\u79cd\uff1a</p> <ul> <li>\u7b2c\u4e00\u79cd\u53eb Session ID\uff1b</li> <li>\u7b2c\u4e8c\u79cd\u53eb Session Ticket\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#session-id","title":"Session ID","text":"<p>Session ID \u7684\u5de5\u4f5c\u539f\u7406\u662f\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u9996\u6b21  TLS \u63e1\u624b\u8fde\u63a5\u540e\uff0c\u53cc\u65b9\u4f1a\u5728\u5185\u5b58\u7f13\u5b58\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u5e76\u7528\u552f\u4e00\u7684 Session ID \u6765\u6807\u8bc6\uff0cSession ID \u548c\u4f1a\u8bdd\u5bc6\u94a5\u76f8\u5f53\u4e8e key-value \u7684\u5173\u7cfb\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef\u518d\u6b21\u8fde\u63a5\u65f6\uff0chello \u6d88\u606f\u91cc\u4f1a\u5e26\u4e0a Session ID\uff0c\u670d\u52a1\u5668\u6536\u5230\u540e\u5c31\u4f1a\u4ece\u5185\u5b58\u627e\uff0c\u5982\u679c\u627e\u5230\u5c31\u76f4\u63a5\u7528\u8be5\u4f1a\u8bdd\u5bc6\u94a5\u6062\u590d\u4f1a\u8bdd\u72b6\u6001\uff0c\u8df3\u8fc7\u5176\u4f59\u7684\u8fc7\u7a0b\uff0c\u53ea\u7528\u4e00\u4e2a\u6d88\u606f\u5f80\u8fd4\u5c31\u53ef\u4ee5\u5efa\u7acb\u5b89\u5168\u901a\u4fe1\u3002\u5f53\u7136\u4e3a\u4e86\u5b89\u5168\u6027\uff0c\u5185\u5b58\u4e2d\u7684\u4f1a\u8bdd\u5bc6\u94a5\u4f1a\u5b9a\u671f\u5931\u6548\u3002</p> <p></p> <p>\u4f46\u662f\u5b83\u6709\u4e24\u4e2a\u7f3a\u70b9\uff1a</p> <ul> <li>\u670d\u52a1\u5668\u5fc5\u987b\u4fdd\u6301\u6bcf\u4e00\u4e2a\u5ba2\u6237\u7aef\u7684\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u968f\u7740\u5ba2\u6237\u7aef\u7684\u589e\u591a\uff0c\u670d\u52a1\u5668\u7684\u5185\u5b58\u538b\u529b\u4e5f\u4f1a\u8d8a\u5927\u3002</li> <li>\u73b0\u5728\u7f51\u7ad9\u670d\u52a1\u4e00\u822c\u662f\u7531\u591a\u53f0\u670d\u52a1\u5668\u901a\u8fc7\u8d1f\u8f7d\u5747\u8861\u63d0\u4f9b\u670d\u52a1\u7684\uff0c\u5ba2\u6237\u7aef\u518d\u6b21\u8fde\u63a5\u4e0d\u4e00\u5b9a\u4f1a\u547d\u4e2d\u4e0a\u6b21\u8bbf\u95ee\u8fc7\u7684\u670d\u52a1\u5668\uff0c\u4e8e\u662f\u8fd8\u8981\u8d70\u5b8c\u6574\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#session-ticket","title":"Session Ticket","text":"<p>\u4e3a\u4e86\u89e3\u51b3 Session ID \u7684\u95ee\u9898\uff0c\u5c31\u51fa\u73b0\u4e86 Session Ticket\uff0c\u670d\u52a1\u5668\u4e0d\u518d\u7f13\u5b58\u6bcf\u4e2a\u5ba2\u6237\u7aef\u7684\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u800c\u662f\u628a\u7f13\u5b58\u7684\u5de5\u4f5c\u4ea4\u7ed9\u4e86\u5ba2\u6237\u7aef\uff0c\u7c7b\u4f3c\u4e8e HTTP \u7684 Cookie\u3002</p> <p>\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u5668\u9996\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u670d\u52a1\u5668\u4f1a\u52a0\u5bc6\u300c\u4f1a\u8bdd\u5bc6\u94a5\u300d\u4f5c\u4e3a Ticket \u53d1\u7ed9\u5ba2\u6237\u7aef\uff0c\u4ea4\u7ed9\u5ba2\u6237\u7aef\u7f13\u5b58\u8be5 Ticket\u3002</p> <p>\u5ba2\u6237\u7aef\u518d\u6b21\u8fde\u63a5\u670d\u52a1\u5668\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u53d1\u9001 Ticket\uff0c\u670d\u52a1\u5668\u89e3\u5bc6\u540e\u5c31\u53ef\u4ee5\u83b7\u53d6\u4e0a\u4e00\u6b21\u7684\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u7136\u540e\u9a8c\u8bc1\u6709\u6548\u671f\uff0c\u5982\u679c\u6ca1\u95ee\u9898\uff0c\u5c31\u53ef\u4ee5\u6062\u590d\u4f1a\u8bdd\u4e86\uff0c\u5f00\u59cb\u52a0\u5bc6\u901a\u4fe1\u3002</p> <p></p> <p>\u5bf9\u4e8e\u96c6\u7fa4\u670d\u52a1\u5668\u7684\u8bdd\uff0c\u8981\u786e\u4fdd\u6bcf\u53f0\u670d\u52a1\u5668\u52a0\u5bc6\u300c\u4f1a\u8bdd\u5bc6\u94a5\u300d\u7684\u5bc6\u94a5\u662f\u4e00\u81f4\u7684\uff0c\u8fd9\u6837\u5ba2\u6237\u7aef\u643a\u5e26 Ticket \u8bbf\u95ee\u4efb\u610f\u4e00\u53f0\u670d\u52a1\u5668\u65f6\uff0c\u90fd\u80fd\u6062\u590d\u4f1a\u8bdd\u3002</p> <p>Session ID \u548c Session Ticket \u90fd\u4e0d\u5177\u5907\u524d\u5411\u5b89\u5168\u6027\uff0c\u56e0\u4e3a\u4e00\u65e6\u52a0\u5bc6\u300c\u4f1a\u8bdd\u5bc6\u94a5\u300d\u7684\u5bc6\u94a5\u88ab\u7834\u89e3\u6216\u8005\u670d\u52a1\u5668\u6cc4\u6f0f\u300c\u4f1a\u8bdd\u5bc6\u94a5\u300d\uff0c\u524d\u9762\u52ab\u6301\u7684\u901a\u4fe1\u5bc6\u6587\u90fd\u4f1a\u88ab\u7834\u89e3\u3002</p> <p>\u540c\u65f6\u5e94\u5bf9\u91cd\u653e\u653b\u51fb\u4e5f\u5f88\u56f0\u96be\uff0c\u8fd9\u91cc\u7b80\u5355\u4ecb\u7ecd\u4e0b\u91cd\u653e\u653b\u51fb\u5de5\u4f5c\u7684\u539f\u7406\u3002</p> <p></p> <p>\u5047\u8bbe Alice \u60f3\u5411 Bob \u8bc1\u660e\u81ea\u5df1\u7684\u8eab\u4efd\u3002Bob \u8981\u6c42 Alice \u7684\u5bc6\u7801\u4f5c\u4e3a\u8eab\u4efd\u8bc1\u660e\uff0c\u7231\u4e3d\u4e1d\u5e94\u5c3d\u5168\u529b\u63d0\u4f9b\uff08\u53ef\u80fd\u662f\u5728\u7ecf\u8fc7\u5982\u54c8\u5e0c\u51fd\u6570\u7684\u8f6c\u6362\u4e4b\u540e\uff09\u3002\u4e0e\u6b64\u540c\u65f6\uff0cEve \u7a83\u542c\u4e86\u5bf9\u8bdd\u5e76\u4fdd\u7559\u4e86\u5bc6\u7801\uff08\u6216\u54c8\u5e0c\uff09\u3002</p> <p>\u4ea4\u6362\u7ed3\u675f\u540e\uff0cEve\uff08\u5192\u5145 Alice\uff09\u8fde\u63a5\u5230 Bob\u3002\u5f53\u88ab\u8981\u6c42\u63d0\u4f9b\u8eab\u4efd\u8bc1\u660e\u65f6\uff0cEve \u53d1\u9001\u4ece Bob \u63a5\u53d7\u7684\u6700\u540e\u4e00\u4e2a\u4f1a\u8bdd\u4e2d\u8bfb\u53d6\u7684 Alice \u7684\u5bc6\u7801\uff08\u6216\u54c8\u5e0c\uff09\uff0c\u4ece\u800c\u6388\u4e88 Eve \u8bbf\u95ee\u6743\u9650\u3002</p> <p>\u91cd\u653e\u653b\u51fb\u7684\u5371\u9669\u4e4b\u5904\u5728\u4e8e\uff0c\u5982\u679c\u4e2d\u95f4\u4eba\u622a\u83b7\u4e86\u67d0\u4e2a\u5ba2\u6237\u7aef\u7684 Session ID \u6216 Session Ticket \u4ee5\u53ca POST \u62a5\u6587\uff0c\u800c\u4e00\u822c POST \u8bf7\u6c42\u4f1a\u6539\u53d8\u6570\u636e\u5e93\u7684\u6570\u636e\uff0c\u4e2d\u95f4\u4eba\u5c31\u53ef\u4ee5\u5229\u7528\u6b64\u622a\u83b7\u7684\u62a5\u6587\uff0c\u4e0d\u65ad\u5411\u670d\u52a1\u5668\u53d1\u9001\u8be5\u62a5\u6587\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u6570\u636e\u5e93\u7684\u6570\u636e\u88ab\u4e2d\u95f4\u4eba\u6539\u53d8\u4e86\uff0c\u800c\u5ba2\u6237\u662f\u4e0d\u77e5\u60c5\u7684\u3002</p> <p>\u907f\u514d\u91cd\u653e\u653b\u51fb\u7684\u65b9\u5f0f\u5c31\u662f\u9700\u8981\u5bf9\u4f1a\u8bdd\u5bc6\u94a5\u8bbe\u5b9a\u4e00\u4e2a\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#pre-shared-key","title":"Pre-shared Key","text":"<p>\u524d\u9762\u7684 Session ID \u548c Session Ticket \u65b9\u5f0f\u90fd\u9700\u8981\u5728 1 RTT \u624d\u80fd\u6062\u590d\u4f1a\u8bdd\u3002</p> <p>\u800c TLS1.3  \u66f4\u4e3a\u725b\u903c\uff0c\u5bf9\u4e8e\u91cd\u8fde TLS1.3 \u53ea\u9700\u8981 0 RTT\uff0c\u539f\u7406\u548c Ticket \u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u5728\u91cd\u8fde\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u628a Ticket \u548c HTTP \u8bf7\u6c42\u4e00\u540c\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u8fd9\u79cd\u65b9\u5f0f\u53eb Pre-shared Key\u3002</p> <p></p> <p>\u540c\u6837\u7684\uff0cPre-shared Key \u4e5f\u6709\u91cd\u653e\u653b\u51fb\u7684\u5371\u9669\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\uff0c\u5047\u8bbe\u4e2d\u95f4\u4eba\u901a\u8fc7\u67d0\u79cd\u65b9\u5f0f\uff0c\u622a\u83b7\u4e86\u5ba2\u6237\u7aef\u4f7f\u7528\u4f1a\u8bdd\u91cd\u7528\u6280\u672f\u7684 POST \u8bf7\u6c42\uff0c\u901a\u5e38 POST \u8bf7\u6c42\u662f\u4f1a\u6539\u53d8\u6570\u636e\u5e93\u7684\u6570\u636e\uff0c\u7136\u540e\u4e2d\u95f4\u4eba\u5c31\u53ef\u4ee5\u628a\u622a\u83b7\u7684\u8fd9\u4e2a\u62a5\u6587\u53d1\u9001\u7ed9\u670d\u52a1\u5668\uff0c\u670d\u52a1\u5668\u6536\u5230\u540e\uff0c\u4e5f\u8ba4\u4e3a\u662f\u5408\u6cd5\u7684\uff0c\u4e8e\u662f\u5c31\u6062\u590d\u4f1a\u8bdd\uff0c\u81f4\u4f7f\u6570\u636e\u5e93\u7684\u6570\u636e\u53c8\u88ab\u66f4\u6539\uff0c\u4f46\u662f\u6b64\u65f6\u7528\u6237\u662f\u4e0d\u77e5\u60c5\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u5e94\u5bf9\u91cd\u653e\u653b\u51fb\u53ef\u4ee5\u7ed9\u4f1a\u8bdd\u5bc6\u94a5\u8bbe\u5b9a\u4e00\u4e2a\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\uff0c\u4ee5\u53ca\u53ea\u9488\u5bf9\u5b89\u5168\u7684 HTTP \u8bf7\u6c42\u5982 GET/HEAD \u4f7f\u7528\u4f1a\u8bdd\u91cd\u7528\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_optimize/#_10","title":"\u603b\u7ed3","text":"<p>\u5bf9\u4e8e\u786c\u4ef6\u4f18\u5316\u7684\u65b9\u5411\uff0c\u56e0\u4e3a HTTPS \u662f\u5c5e\u4e8e\u8ba1\u7b97\u5bc6\u96c6\u578b\uff0c\u5e94\u8be5\u9009\u62e9\u8ba1\u7b97\u529b\u66f4\u5f3a\u7684 CPU\uff0c\u800c\u4e14\u6700\u597d\u9009\u62e9\u652f\u6301 AES-NI \u7279\u6027\u7684 CPU\uff0c\u8fd9\u4e2a\u7279\u6027\u53ef\u4ee5\u5728\u786c\u4ef6\u7ea7\u522b\u4f18\u5316 AES \u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff0c\u52a0\u5feb\u5e94\u7528\u6570\u636e\u7684\u52a0\u89e3\u5bc6\u3002</p> <p>\u5bf9\u4e8e\u8f6f\u4ef6\u4f18\u5316\u7684\u65b9\u5411\uff0c\u5982\u679c\u53ef\u4ee5\uff0c\u628a\u8f6f\u4ef6\u5347\u7ea7\u6210\u8f83\u65b0\u7684\u7248\u672c\uff0c\u6bd4\u5982\u5c06 Linux \u5185\u6838 2.X \u5347\u7ea7\u6210 4.X\uff0c\u5c06 openssl 1.0.1 \u5347\u7ea7\u5230 1.1.1\uff0c\u56e0\u4e3a\u65b0\u7248\u672c\u7684\u8f6f\u4ef6\u4e0d\u4ec5\u4f1a\u63d0\u4f9b\u65b0\u7684\u7279\u6027\uff0c\u800c\u4e14\u8fd8\u4f1a\u4fee\u590d\u8001\u7248\u672c\u7684\u95ee\u9898\u3002</p> <p>\u5bf9\u4e8e\u534f\u8bae\u4f18\u5316\u7684\u65b9\u5411\uff1a</p> <ul> <li>\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u5e94\u8be5\u9009\u62e9 ECDHE \u7b97\u6cd5\uff0c\u800c\u4e0d\u7528 RSA \u7b97\u6cd5\uff0c\u56e0\u4e3a ECDHE \u7b97\u6cd5\u5177\u5907\u524d\u5411\u5b89\u5168\u6027\uff0c\u800c\u4e14\u5ba2\u6237\u7aef\u53ef\u4ee5\u5728\u7b2c\u4e09\u6b21\u63e1\u624b\u4e4b\u540e\uff0c\u5c31\u53d1\u9001\u52a0\u5bc6\u5e94\u7528\u6570\u636e\uff0c\u8282\u7701\u4e86 1 RTT\u3002</li> <li>\u5c06 TLS1.2 \u5347\u7ea7 TLS1.3\uff0c\u56e0\u4e3a TLS1.3 \u7684\u63e1\u624b\u8fc7\u7a0b\u53ea\u9700\u8981 1 RTT\uff0c\u800c\u4e14\u5b89\u5168\u6027\u66f4\u5f3a\u3002</li> </ul> <p>\u5bf9\u4e8e\u8bc1\u4e66\u4f18\u5316\u7684\u65b9\u5411\uff1a</p> <ul> <li>\u670d\u52a1\u5668\u5e94\u8be5\u9009\u7528 ECDSA \u8bc1\u4e66\uff0c\u800c\u975e RSA \u8bc1\u4e66\uff0c\u56e0\u4e3a\u5728\u76f8\u540c\u5b89\u5168\u7ea7\u522b\u4e0b\uff0cECC \u7684\u5bc6\u94a5\u957f\u5ea6\u6bd4 RSA \u77ed\u5f88\u591a\uff0c\u8fd9\u6837\u53ef\u4ee5\u63d0\u9ad8\u8bc1\u4e66\u4f20\u8f93\u7684\u6548\u7387\uff1b</li> <li>\u670d\u52a1\u5668\u5e94\u8be5\u5f00\u542f OCSP Stapling \u529f\u80fd\uff0c\u7531\u670d\u52a1\u5668\u9884\u5148\u83b7\u5f97 OCSP \u7684\u54cd\u5e94\uff0c\u5e76\u628a\u54cd\u5e94\u7ed3\u679c\u7f13\u5b58\u8d77\u6765\uff0c\u8fd9\u6837 TLS \u63e1\u624b\u7684\u65f6\u5019\u5c31\u4e0d\u7528\u518d\u8bbf\u95ee CA \u670d\u52a1\u5668\uff0c\u51cf\u5c11\u4e86\u7f51\u7edc\u901a\u4fe1\u7684\u5f00\u9500\uff0c\u63d0\u9ad8\u4e86\u8bc1\u4e66\u9a8c\u8bc1\u7684\u6548\u7387\uff1b</li> </ul> <p>\u5bf9\u4e8e\u91cd\u8fde HTTPS \u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e00\u4e9b\u6280\u672f\u8ba9\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4f7f\u7528\u4e0a\u4e00\u6b21 HTTPS \u8fde\u63a5\u4f7f\u7528\u7684\u4f1a\u8bdd\u5bc6\u94a5\uff0c\u76f4\u63a5\u6062\u590d\u4f1a\u8bdd\uff0c\u800c\u4e0d\u7528\u518d\u91cd\u65b0\u8d70\u5b8c\u6574\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\u3002</p> <p>\u5e38\u89c1\u7684\u4f1a\u8bdd\u91cd\u7528\u6280\u672f\u6709 Session ID \u548c Session Ticket\uff0c\u7528\u4e86\u4f1a\u8bdd\u91cd\u7528\u6280\u672f\uff0c\u5f53\u518d\u6b21\u91cd\u8fde HTTPS \u65f6\uff0c\u53ea\u9700\u8981 1 RTT \u5c31\u53ef\u4ee5\u6062\u590d\u4f1a\u8bdd\u3002\u5bf9\u4e8e TLS1.3 \u4f7f\u7528 Pre-shared Key \u4f1a\u8bdd\u91cd\u7528\u6280\u672f\uff0c\u53ea\u9700\u8981 0 RTT \u5c31\u53ef\u4ee5\u6062\u590d\u4f1a\u8bdd\u3002</p> <p>\u8fd9\u4e9b\u4f1a\u8bdd\u91cd\u7528\u6280\u672f\u867d\u7136\u597d\u7528\uff0c\u4f46\u662f\u5b58\u5728\u4e00\u5b9a\u7684\u5b89\u5168\u98ce\u9669\uff0c\u5b83\u4eec\u4e0d\u4ec5\u4e0d\u5177\u5907\u524d\u5411\u5b89\u5168\uff0c\u800c\u4e14\u6709\u91cd\u653e\u653b\u51fb\u7684\u98ce\u9669\uff0c\u6240\u4ee5\u5e94\u5f53\u5bf9\u4f1a\u8bdd\u5bc6\u94a5\u8bbe\u5b9a\u4e00\u4e2a\u5408\u7406\u7684\u8fc7\u671f\u65f6\u95f4\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ol> <li>http://www.doc88.com/p-8621583210895.html</li> <li>https://zhuanlan.zhihu.com/p/33685085</li> <li>https://en.wikipedia.org/wiki/Replay_attack</li> <li>https://en.wikipedia.org/wiki/Downgrade_attack</li> <li>https://www.cnblogs.com/racent-Z/p/14011056.html</li> <li>http://www.guoyanbin.com/a-detailed-look-at-rfc-8446-a-k-a-tls-1-3/</li> <li>https://www.thesslstore.com/blog/crl-explained-what-is-a-certificate-revocation-list/</li> </ol> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/","title":"3.3 HTTPS RSA \u63e1\u624b\u89e3\u6790","text":"<p>\u6211\u524d\u9762\u8bb2\uff0c\u7b80\u5355\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e86\u7684 HTTPS \u63e1\u624b\u8fc7\u7a0b\uff0c\u4f46\u662f\u8fd8\u4e0d\u591f\u7ec6\uff01</p> <p>\u53ea\u8bb2\u4e86\u6bd4\u8f83\u57fa\u7840\u7684\u90e8\u5206\uff0c\u6240\u4ee5\u8fd9\u6b21\u6211\u4eec\u518d\u6765\u6df1\u5165\u4e00\u4e0b HTTPS\uff0c\u7528\u5b9e\u6218\u6293\u5305\u7684\u65b9\u5f0f\uff0c\u5e26\u5927\u5bb6\u518d\u6765\u7aa5\u63a2\u4e00\u6b21 HTTPS\u3002</p> <p></p> <p>\u5bf9\u4e8e\u8fd8\u4e0d\u77e5\u9053\u5bf9\u79f0\u52a0\u5bc6\u548c\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u540c\u5b66\uff0c\u4f60\u5148\u590d\u4e60\u6211\u4ee5\u524d\u7684\u8fd9\u7bc7\u6587\u7ae0\u300c\u786c\u6838\uff0130 \u5f20\u56fe\u89e3 HTTP \u5e38\u89c1\u7684\u9762\u8bd5\u9898\u300d\uff0c\u672c\u7bc7\u6587\u7ae0\u9ed8\u8ba4\u5927\u5bb6\u5df2\u7ecf\u5177\u5907\u4e86\u8fd9\u4e9b\u77e5\u8bc6\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#tls","title":"TLS \u63e1\u624b\u8fc7\u7a0b","text":"<p>HTTP \u7531\u4e8e\u662f\u660e\u6587\u4f20\u8f93\uff0c\u6240\u8c13\u7684\u660e\u6587\uff0c\u5c31\u662f\u8bf4\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u4fe1\u606f\u90fd\u662f\u8089\u773c\u53ef\u89c1\u7684\uff0c\u968f\u610f\u4f7f\u7528\u4e00\u4e2a\u6293\u5305\u5de5\u5177\u90fd\u53ef\u4ee5\u622a\u83b7\u901a\u4fe1\u7684\u5185\u5bb9\u3002</p> <p>\u6240\u4ee5\u5b89\u5168\u4e0a\u5b58\u5728\u4ee5\u4e0b\u4e09\u4e2a\u98ce\u9669\uff1a</p> <ul> <li>\u7a83\u542c\u98ce\u9669\uff0c\u6bd4\u5982\u901a\u4fe1\u94fe\u8def\u4e0a\u53ef\u4ee5\u83b7\u53d6\u901a\u4fe1\u5185\u5bb9\uff0c\u7528\u6237\u53f7\u5bb9\u6613\u6ca1\u3002</li> <li>\u7be1\u6539\u98ce\u9669\uff0c\u6bd4\u5982\u5f3a\u5236\u690d\u5165\u5783\u573e\u5e7f\u544a\uff0c\u89c6\u89c9\u6c61\u67d3\uff0c\u7528\u6237\u773c\u5bb9\u6613\u778e\u3002</li> <li>\u5192\u5145\u98ce\u9669\uff0c\u6bd4\u5982\u5192\u5145\u6dd8\u5b9d\u7f51\u7ad9\uff0c\u7528\u6237\u94b1\u5bb9\u6613\u6ca1\u3002</li> </ul> <p>HTTPS \u5728 HTTP \u4e0e TCP \u5c42\u4e4b\u95f4\u52a0\u5165\u4e86 TLS \u534f\u8bae\uff0c\u6765\u89e3\u51b3\u4e0a\u8ff0\u7684\u98ce\u9669\u3002</p> <p></p> <p>TLS \u534f\u8bae\u662f\u5982\u4f55\u89e3\u51b3 HTTP \u7684\u98ce\u9669\u7684\u5462\uff1f</p> <ul> <li>\u4fe1\u606f\u52a0\u5bc6\uff1aHTTP \u4ea4\u4e92\u4fe1\u606f\u662f\u88ab\u52a0\u5bc6\u7684\uff0c\u7b2c\u4e09\u65b9\u5c31\u65e0\u6cd5\u88ab\u7a83\u53d6\uff1b</li> <li>\u6821\u9a8c\u673a\u5236\uff1a\u6821\u9a8c\u4fe1\u606f\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u662f\u5426\u6709\u88ab\u7b2c\u4e09\u65b9\u7be1\u6539\u8fc7\uff0c\u5982\u679c\u88ab\u7be1\u6539\u8fc7\uff0c\u5219\u4f1a\u6709\u8b66\u544a\u63d0\u793a\uff1b</li> <li>\u8eab\u4efd\u8bc1\u4e66\uff1a\u8bc1\u660e\u6dd8\u5b9d\u662f\u771f\u7684\u6dd8\u5b9d\u7f51\uff1b</li> </ul> <p>\u53ef\u89c1\uff0c\u6709\u4e86 TLS \u534f\u8bae\uff0c\u80fd\u4fdd\u8bc1 HTTP \u901a\u4fe1\u662f\u5b89\u5168\u7684\u4e86\uff0c\u90a3\u4e48\u5728\u8fdb\u884c HTTP \u901a\u4fe1\u524d\uff0c\u9700\u8981\u5148\u8fdb\u884c TLS \u63e1\u624b\u3002TLS \u7684\u63e1\u624b\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e0a\u56fe\u7b80\u8981\u6982\u8ff0\u4e86 TLS \u7684\u63e1\u624b\u8fc7\u7a0b\uff0c\u5176\u4e2d\u6bcf\u4e00\u4e2a\u300c\u6846\u300d\u90fd\u662f\u4e00\u4e2a\u8bb0\u5f55\uff08record\uff09\uff0c\u8bb0\u5f55\u662f TLS \u6536\u53d1\u6570\u636e\u7684\u57fa\u672c\u5355\u4f4d\uff0c\u7c7b\u4f3c\u4e8e TCP \u91cc\u7684 segment\u3002\u591a\u4e2a\u8bb0\u5f55\u53ef\u4ee5\u7ec4\u5408\u6210\u4e00\u4e2a TCP \u5305\u53d1\u9001\uff0c\u6240\u4ee5\u901a\u5e38\u7ecf\u8fc7\u300c\u56db\u4e2a\u6d88\u606f\u300d\u5c31\u53ef\u4ee5\u5b8c\u6210 TLS \u63e1\u624b\uff0c\u4e5f\u5c31\u662f\u9700\u8981 2 \u4e2a RTT \u7684\u65f6\u5ef6\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5728\u5b89\u5168\u7684\u901a\u4fe1\u73af\u5883\u91cc\u53d1\u9001 HTTP \u62a5\u6587\uff0c\u5b9e\u73b0 HTTPS \u534f\u8bae\u3002</p> <p>\u6240\u4ee5\u53ef\u4ee5\u53d1\u73b0\uff0cHTTPS \u662f\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u9700\u8981\u5148\u5b8c\u6210 TCP \u8fde\u63a5\u5efa\u7acb\uff0c\u7136\u540e\u8d70 TLS \u63e1\u624b\u8fc7\u7a0b\u540e\uff0c\u624d\u80fd\u5efa\u7acb\u901a\u4fe1\u5b89\u5168\u7684\u8fde\u63a5\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u4e0d\u540c\u7684\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\uff0cTLS \u7684\u63e1\u624b\u8fc7\u7a0b\u53ef\u80fd\u4f1a\u6709\u4e00\u4e9b\u533a\u522b\u3002</p> <p>\u8fd9\u91cc\u5148\u7b80\u5355\u4ecb\u7ecd\u4e0b\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\uff0c\u56e0\u4e3a\u8003\u8651\u5230\u6027\u80fd\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u53cc\u65b9\u5728\u52a0\u5bc6\u5e94\u7528\u4fe1\u606f\u65f6\u4f7f\u7528\u7684\u662f\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\uff0c\u800c\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u662f\u4e0d\u80fd\u88ab\u6cc4\u6f0f\u7684\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u7684\u5b89\u5168\u6027\uff0c\u6240\u4ee5\u4f7f\u7528\u975e\u5bf9\u79f0\u52a0\u5bc6\u7684\u65b9\u5f0f\u6765\u4fdd\u62a4\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u7684\u534f\u5546\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u5c31\u662f\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u8d1f\u8d23\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c31\u4ee5\u6700\u7b80\u5355\u7684 <code>RSA</code> \u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\uff0c\u6765\u770b\u770b\u5b83\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#rsa","title":"RSA \u63e1\u624b\u8fc7\u7a0b","text":"<p>\u4f20\u7edf\u7684 TLS \u63e1\u624b\u57fa\u672c\u90fd\u662f\u4f7f\u7528 RSA \u7b97\u6cd5\u6765\u5b9e\u73b0\u5bc6\u94a5\u4ea4\u6362\u7684\uff0c\u5728\u5c06 TLS \u8bc1\u4e66\u90e8\u7f72\u670d\u52a1\u7aef\u65f6\uff0c\u8bc1\u4e66\u6587\u4ef6\u5176\u5b9e\u5c31\u662f\u670d\u52a1\u7aef\u7684\u516c\u94a5\uff0c\u4f1a\u5728 TLS \u63e1\u624b\u9636\u6bb5\u4f20\u9012\u7ed9\u5ba2\u6237\u7aef\uff0c\u800c\u670d\u52a1\u7aef\u7684\u79c1\u94a5\u5219\u4e00\u76f4\u7559\u5728\u670d\u52a1\u7aef\uff0c\u4e00\u5b9a\u8981\u786e\u4fdd\u79c1\u94a5\u4e0d\u80fd\u88ab\u7a83\u53d6\u3002</p> <p>\u5728 RSA \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\u4e2d\uff0c\u5ba2\u6237\u7aef\u4f1a\u751f\u6210\u968f\u673a\u5bc6\u94a5\uff0c\u5e76\u4f7f\u7528\u670d\u52a1\u7aef\u7684\u516c\u94a5\u52a0\u5bc6\u540e\u518d\u4f20\u7ed9\u670d\u52a1\u7aef\u3002\u6839\u636e\u975e\u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5\uff0c\u516c\u94a5\u52a0\u5bc6\u7684\u6d88\u606f\u4ec5\u80fd\u901a\u8fc7\u79c1\u94a5\u89e3\u5bc6\uff0c\u8fd9\u6837\u670d\u52a1\u7aef\u89e3\u5bc6\u540e\uff0c\u53cc\u65b9\u5c31\u5f97\u5230\u4e86\u76f8\u540c\u7684\u5bc6\u94a5\uff0c\u518d\u7528\u5b83\u52a0\u5bc6\u5e94\u7528\u6d88\u606f\u3002</p> <p>\u6211\u7528 Wireshark \u5de5\u5177\u6293\u4e86\u7528 RSA \u5bc6\u94a5\u4ea4\u6362\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\uff0c\u4f60\u53ef\u4ee5\u4ece\u4e0b\u9762\u770b\u5230\uff0c\u4e00\u5171\u7ecf\u5386\u4e86\u56db\u6b21\u63e1\u624b\uff1a</p> <p></p> <p>\u5bf9\u5e94 Wireshark \u7684\u6293\u5305\uff0c\u6211\u4e5f\u753b\u4e86\u4e00\u5e45\u56fe\uff0c\u4f60\u53ef\u4ee5\u4ece\u4e0b\u56fe\u5f88\u6e05\u6670\u5730\u770b\u5230\u8be5\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u90a3\u4e48\uff0c\u63a5\u4e0b\u6765\u9488\u5bf9\u6bcf\u4e00\u4e2a TLS \u63e1\u624b\u505a\u8fdb\u4e00\u6b65\u7684\u4ecb\u7ecd\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#tls_1","title":"TLS \u7b2c\u4e00\u6b21\u63e1\u624b","text":"<p>\u5ba2\u6237\u7aef\u9996\u5148\u4f1a\u53d1\u4e00\u4e2a\u300cClient Hello\u300d\u6d88\u606f\uff0c\u5b57\u9762\u610f\u601d\u6211\u4eec\u4e5f\u80fd\u7406\u89e3\u5230\uff0c\u8fd9\u662f\u8ddf\u670d\u52a1\u5668\u300c\u6253\u62db\u547c\u300d\u3002</p> <p></p> <p>\u6d88\u606f\u91cc\u9762\u6709\u5ba2\u6237\u7aef\u4f7f\u7528\u7684 TLS \u7248\u672c\u53f7\u3001\u652f\u6301\u7684\u5bc6\u7801\u5957\u4ef6\u5217\u8868\uff0c\u4ee5\u53ca\u751f\u6210\u7684\u968f\u673a\u6570\uff08Client Random\uff09\uff0c\u8fd9\u4e2a\u968f\u673a\u6570\u4f1a\u88ab\u670d\u52a1\u7aef\u4fdd\u7559\uff0c\u5b83\u662f\u751f\u6210\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u7684\u6750\u6599\u4e4b\u4e00\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#tls_2","title":"TLS \u7b2c\u4e8c\u6b21\u63e1\u624b","text":"<p>\u5f53\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684\u300cClient Hello\u300d\u6d88\u606f\u540e\uff0c\u4f1a\u786e\u8ba4 TLS \u7248\u672c\u53f7\u662f\u5426\u652f\u6301\uff0c\u548c\u4ece\u5bc6\u7801\u5957\u4ef6\u5217\u8868\u4e2d\u9009\u62e9\u4e00\u4e2a\u5bc6\u7801\u5957\u4ef6\uff0c\u4ee5\u53ca\u751f\u6210\u968f\u673a\u6570\uff08Server Random\uff09\u3002</p> <p>\u63a5\u7740\uff0c\u8fd4\u56de\u300cServer Hello\u300d\u6d88\u606f\uff0c\u6d88\u606f\u91cc\u9762\u6709\u670d\u52a1\u5668\u786e\u8ba4\u7684 TLS \u7248\u672c\u53f7\uff0c\u4e5f\u7ed9\u51fa\u4e86\u968f\u673a\u6570\uff08Server Random\uff09\uff0c\u7136\u540e\u4ece\u5ba2\u6237\u7aef\u7684\u5bc6\u7801\u5957\u4ef6\u5217\u8868\u9009\u62e9\u4e86\u4e00\u4e2a\u5408\u9002\u7684\u5bc6\u7801\u5957\u4ef6\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u670d\u52a1\u7aef\u9009\u62e9\u7684\u5bc6\u7801\u5957\u4ef6\u662f\u201cCipher Suite: TLS_RSA_WITH_AES_128_GCM_SHA256\u201d\u3002</p> <p>\u8fd9\u4e2a\u5bc6\u7801\u5957\u4ef6\u770b\u8d77\u6765\u771f\u8ba9\u4eba\u5934\u6655\uff0c\u597d\u4e00\u5927\u4e32\uff0c\u4f46\u662f\u5176\u5b9e\u5b83\u662f\u6709\u56fa\u5b9a\u683c\u5f0f\u548c\u89c4\u8303\u7684\u3002\u57fa\u672c\u7684\u5f62\u5f0f\u662f\u300c\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5 + \u7b7e\u540d\u7b97\u6cd5 + \u5bf9\u79f0\u52a0\u5bc6\u7b97\u6cd5 + \u6458\u8981\u7b97\u6cd5\u300d\uff0c\u4e00\u822c WITH \u5355\u8bcd\u524d\u9762\u6709\u4e24\u4e2a\u5355\u8bcd\uff0c\u7b2c\u4e00\u4e2a\u5355\u8bcd\u662f\u7ea6\u5b9a\u5bc6\u94a5\u4ea4\u6362\u7684\u7b97\u6cd5\uff0c\u7b2c\u4e8c\u4e2a\u5355\u8bcd\u662f\u7ea6\u5b9a\u8bc1\u4e66\u7684\u9a8c\u8bc1\u7b97\u6cd5\u3002\u6bd4\u5982\u521a\u624d\u7684\u5bc6\u7801\u5957\u4ef6\u7684\u610f\u601d\u5c31\u662f\uff1a</p> <ul> <li>\u7531\u4e8e WITH \u5355\u8bcd\u524d\u53ea\u6709\u4e00\u4e2a RSA\uff0c\u5219\u8bf4\u660e\u63e1\u624b\u65f6\u5bc6\u94a5\u4ea4\u6362\u7b97\u6cd5\u548c\u7b7e\u540d\u7b97\u6cd5\u90fd\u662f\u4f7f\u7528 RSA\uff1b</li> <li>\u63e1\u624b\u540e\u7684\u901a\u4fe1\u4f7f\u7528 AES \u5bf9\u79f0\u7b97\u6cd5\uff0c\u5bc6\u94a5\u957f\u5ea6 128 \u4f4d\uff0c\u5206\u7ec4\u6a21\u5f0f\u662f GCM\uff1b</li> <li>\u6458\u8981\u7b97\u6cd5 SHA256 \u7528\u4e8e\u6d88\u606f\u8ba4\u8bc1\u548c\u4ea7\u751f\u968f\u673a\u6570\uff1b</li> </ul> <p>\u5c31\u524d\u9762\u8fd9\u4e24\u4e2a\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u76f8\u4e92\u300c\u6253\u62db\u547c\u300d\u7684\u8fc7\u7a0b\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5c31\u5df2\u786e\u8ba4\u4e86 TLS \u7248\u672c\u548c\u4f7f\u7528\u7684\u5bc6\u7801\u5957\u4ef6\uff0c\u800c\u4e14\u4f60\u53ef\u80fd\u53d1\u73b0\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u4f1a\u5404\u81ea\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u5e76\u4e14\u8fd8\u4f1a\u628a\u968f\u673a\u6570\u4f20\u9012\u7ed9\u5bf9\u65b9\u3002</p> <p>\u90a3\u8fd9\u4e2a\u968f\u673a\u6570\u6709\u5565\u7528\u5462\uff1f\u5176\u5b9e\u8fd9\u4e24\u4e2a\u968f\u673a\u6570\u662f\u540e\u7eed\u4f5c\u4e3a\u751f\u6210\u300c\u4f1a\u8bdd\u5bc6\u94a5\u300d\u7684\u6761\u4ef6\uff0c\u6240\u8c13\u7684\u4f1a\u8bdd\u5bc6\u94a5\u5c31\u662f\u6570\u636e\u4f20\u8f93\u65f6\uff0c\u6240\u4f7f\u7528\u7684\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u3002</p> <p>\u7136\u540e\uff0c\u670d\u52a1\u7aef\u4e3a\u4e86\u8bc1\u660e\u81ea\u5df1\u7684\u8eab\u4efd\uff0c\u4f1a\u53d1\u9001\u300cServer Certificate\u300d\u7ed9\u5ba2\u6237\u7aef\uff0c\u8fd9\u4e2a\u6d88\u606f\u91cc\u542b\u6709\u6570\u5b57\u8bc1\u4e66\u3002</p> <p></p> <p>\u968f\u540e\uff0c\u670d\u52a1\u7aef\u53d1\u4e86\u300cServer Hello Done\u300d\u6d88\u606f\uff0c\u76ee\u7684\u662f\u544a\u8bc9\u5ba2\u6237\u7aef\uff0c\u6211\u5df2\u7ecf\u628a\u8be5\u7ed9\u4f60\u7684\u4e1c\u897f\u90fd\u7ed9\u4f60\u4e86\uff0c\u672c\u6b21\u6253\u62db\u547c\u5b8c\u6bd5\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#_1","title":"\u5ba2\u6237\u7aef\u9a8c\u8bc1\u8bc1\u4e66","text":"<p>\u5728\u8fd9\u91cc\u5239\u4e2a\u8f66\uff0c\u5ba2\u6237\u7aef\u62ff\u5230\u4e86\u670d\u52a1\u7aef\u7684\u6570\u5b57\u8bc1\u4e66\u540e\uff0c\u8981\u600e\u4e48\u6821\u9a8c\u8be5\u6570\u5b57\u8bc1\u4e66\u662f\u771f\u5b9e\u6709\u6548\u7684\u5462\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#ca","title":"\u6570\u5b57\u8bc1\u4e66\u548c CA \u673a\u6784","text":"<p>\u5728\u8bf4\u6821\u9a8c\u6570\u5b57\u8bc1\u4e66\u662f\u5426\u53ef\u4fe1\u7684\u8fc7\u7a0b\u524d\uff0c\u6211\u4eec\u5148\u6765\u770b\u770b\u6570\u5b57\u8bc1\u4e66\u662f\u4ec0\u4e48\uff0c\u4e00\u4e2a\u6570\u5b57\u8bc1\u4e66\u901a\u5e38\u5305\u542b\u4e86\uff1a</p> <ul> <li>\u516c\u94a5\uff1b</li> <li>\u6301\u6709\u8005\u4fe1\u606f\uff1b</li> <li>\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\uff08CA\uff09\u7684\u4fe1\u606f\uff1b</li> <li>CA \u5bf9\u8fd9\u4efd\u6587\u4ef6\u7684\u6570\u5b57\u7b7e\u540d\u53ca\u4f7f\u7528\u7684\u7b97\u6cd5\uff1b</li> <li>\u8bc1\u4e66\u6709\u6548\u671f\uff1b</li> <li>\u8fd8\u6709\u4e00\u4e9b\u5176\u4ed6\u989d\u5916\u4fe1\u606f\uff1b</li> </ul> <p>\u90a3\u6570\u5b57\u8bc1\u4e66\u7684\u4f5c\u7528\uff0c\u662f\u7528\u6765\u8ba4\u8bc1\u516c\u94a5\u6301\u6709\u8005\u7684\u8eab\u4efd\uff0c\u4ee5\u9632\u6b62\u7b2c\u4e09\u65b9\u8fdb\u884c\u5192\u5145\u3002\u8bf4\u7b80\u5355\u4e9b\uff0c\u8bc1\u4e66\u5c31\u662f\u7528\u6765\u544a\u8bc9\u5ba2\u6237\u7aef\uff0c\u8be5\u670d\u52a1\u7aef\u662f\u5426\u662f\u5408\u6cd5\u7684\uff0c\u56e0\u4e3a\u53ea\u6709\u8bc1\u4e66\u5408\u6cd5\uff0c\u624d\u4ee3\u8868\u670d\u52a1\u7aef\u8eab\u4efd\u662f\u53ef\u4fe1\u7684\u3002</p> <p>\u6211\u4eec\u7528\u8bc1\u4e66\u6765\u8ba4\u8bc1\u516c\u94a5\u6301\u6709\u8005\u7684\u8eab\u4efd\uff08\u670d\u52a1\u7aef\u7684\u8eab\u4efd\uff09\uff0c\u90a3\u8bc1\u4e66\u53c8\u662f\u600e\u4e48\u6765\u7684\uff1f\u53c8\u8be5\u600e\u4e48\u8ba4\u8bc1\u8bc1\u4e66\u5462\uff1f</p> <p>\u4e3a\u4e86\u8ba9\u670d\u52a1\u7aef\u7684\u516c\u94a5\u88ab\u5927\u5bb6\u4fe1\u4efb\uff0c\u670d\u52a1\u7aef\u7684\u8bc1\u4e66\u90fd\u662f\u7531 CA\uff08Certificate Authority\uff0c\u8bc1\u4e66\u8ba4\u8bc1\u673a\u6784\uff09\u7b7e\u540d\u7684\uff0cCA \u5c31\u662f\u7f51\u7edc\u4e16\u754c\u91cc\u7684\u516c\u5b89\u5c40\u3001\u516c\u8bc1\u4e2d\u5fc3\uff0c\u5177\u6709\u6781\u9ad8\u7684\u53ef\u4fe1\u5ea6\uff0c\u6240\u4ee5\u7531\u5b83\u6765\u7ed9\u5404\u4e2a\u516c\u94a5\u7b7e\u540d\uff0c\u4fe1\u4efb\u7684\u4e00\u65b9\u7b7e\u53d1\u7684\u8bc1\u4e66\uff0c\u90a3\u5fc5\u7136\u8bc1\u4e66\u4e5f\u662f\u88ab\u4fe1\u4efb\u7684\u3002</p> <p>\u4e4b\u6240\u4ee5\u8981\u7b7e\u540d\uff0c\u662f\u56e0\u4e3a\u7b7e\u540d\u7684\u4f5c\u7528\u53ef\u4ee5\u907f\u514d\u4e2d\u95f4\u4eba\u5728\u83b7\u53d6\u8bc1\u4e66\u65f6\u5bf9\u8bc1\u4e66\u5185\u5bb9\u7684\u7be1\u6539\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#_2","title":"\u6570\u5b57\u8bc1\u4e66\u7b7e\u53d1\u548c\u9a8c\u8bc1\u6d41\u7a0b","text":"<p>\u5982\u4e0b\u56fe\u6240\u793a\uff0c\u4e3a\u6570\u5b57\u8bc1\u4e66\u7b7e\u53d1\u548c\u9a8c\u8bc1\u6d41\u7a0b\uff1a</p> <p></p> <p>CA \u7b7e\u53d1\u8bc1\u4e66\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0a\u56fe\u5de6\u8fb9\u90e8\u5206\uff1a</p> <ul> <li>\u9996\u5148 CA \u4f1a\u628a\u6301\u6709\u8005\u7684\u516c\u94a5\u3001\u7528\u9014\u3001\u9881\u53d1\u8005\u3001\u6709\u6548\u65f6\u95f4\u7b49\u4fe1\u606f\u6253\u6210\u4e00\u4e2a\u5305\uff0c\u7136\u540e\u5bf9\u8fd9\u4e9b\u4fe1\u606f\u8fdb\u884c Hash \u8ba1\u7b97\uff0c\u5f97\u5230\u4e00\u4e2a Hash \u503c\uff1b</li> <li>\u7136\u540e CA \u4f1a\u4f7f\u7528\u81ea\u5df1\u7684\u79c1\u94a5\u5c06\u8be5 Hash \u503c\u52a0\u5bc6\uff0c\u751f\u6210 Certificate Signature\uff0c\u4e5f\u5c31\u662f CA \u5bf9\u8bc1\u4e66\u505a\u4e86\u7b7e\u540d\uff1b</li> <li>\u6700\u540e\u5c06 Certificate Signature \u6dfb\u52a0\u5728\u6587\u4ef6\u8bc1\u4e66\u4e0a\uff0c\u5f62\u6210\u6570\u5b57\u8bc1\u4e66\uff1b</li> </ul> <p>\u5ba2\u6237\u7aef\u6821\u9a8c\u670d\u52a1\u7aef\u7684\u6570\u5b57\u8bc1\u4e66\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0a\u56fe\u53f3\u8fb9\u90e8\u5206\uff1a</p> <ul> <li>\u9996\u5148\u5ba2\u6237\u7aef\u4f1a\u4f7f\u7528\u540c\u6837\u7684 Hash \u7b97\u6cd5\u83b7\u53d6\u8be5\u8bc1\u4e66\u7684 Hash \u503c H1\uff1b</li> <li>\u901a\u5e38\u6d4f\u89c8\u5668\u548c\u64cd\u4f5c\u7cfb\u7edf\u4e2d\u96c6\u6210\u4e86 CA \u7684\u516c\u94a5\u4fe1\u606f\uff0c\u6d4f\u89c8\u5668\u6536\u5230\u8bc1\u4e66\u540e\u53ef\u4ee5\u4f7f\u7528 CA \u7684\u516c\u94a5\u89e3\u5bc6 Certificate Signature \u5185\u5bb9\uff0c\u5f97\u5230\u4e00\u4e2a Hash \u503c H2\uff1b</li> <li>\u6700\u540e\u6bd4\u8f83 H1 \u548c H2\uff0c\u5982\u679c\u503c\u76f8\u540c\uff0c\u5219\u4e3a\u53ef\u4fe1\u8d56\u7684\u8bc1\u4e66\uff0c\u5426\u5219\u5219\u8ba4\u4e3a\u8bc1\u4e66\u4e0d\u53ef\u4fe1\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#_3","title":"\u8bc1\u4e66\u94fe","text":"<p>\u4f46\u4e8b\u5b9e\u4e0a\uff0c\u8bc1\u4e66\u7684\u9a8c\u8bc1\u8fc7\u7a0b\u4e2d\u8fd8\u5b58\u5728\u4e00\u4e2a\u8bc1\u4e66\u4fe1\u4efb\u94fe\u7684\u95ee\u9898\uff0c\u56e0\u4e3a\u6211\u4eec\u5411 CA \u7533\u8bf7\u7684\u8bc1\u4e66\u4e00\u822c\u4e0d\u662f\u6839\u8bc1\u4e66\u7b7e\u53d1\u7684\uff0c\u800c\u662f\u7531\u4e2d\u95f4\u8bc1\u4e66\u7b7e\u53d1\u7684\uff0c\u6bd4\u5982\u767e\u5ea6\u7684\u8bc1\u4e66\uff0c\u4ece\u4e0b\u56fe\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u8bc1\u4e66\u7684\u5c42\u7ea7\u6709\u4e09\u7ea7\uff1a</p> <p></p> <p>\u5bf9\u4e8e\u8fd9\u79cd\u4e09\u7ea7\u5c42\u7ea7\u5173\u7cfb\u7684\u8bc1\u4e66\u7684\u9a8c\u8bc1\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u6536\u5230 baidu.com \u7684\u8bc1\u4e66\u540e\uff0c\u53d1\u73b0\u8fd9\u4e2a\u8bc1\u4e66\u7684\u7b7e\u53d1\u8005\u4e0d\u662f\u6839\u8bc1\u4e66\uff0c\u5c31\u65e0\u6cd5\u6839\u636e\u672c\u5730\u5df2\u6709\u7684\u6839\u8bc1\u4e66\u4e2d\u7684\u516c\u94a5\u53bb\u9a8c\u8bc1 baidu.com \u8bc1\u4e66\u662f\u5426\u53ef\u4fe1\u3002\u4e8e\u662f\uff0c\u5ba2\u6237\u7aef\u6839\u636e baidu.com \u8bc1\u4e66\u4e2d\u7684\u7b7e\u53d1\u8005\uff0c\u627e\u5230\u8be5\u8bc1\u4e66\u7684\u9881\u53d1\u673a\u6784\u662f\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\uff0c\u7136\u540e\u5411 CA \u8bf7\u6c42\u8be5\u4e2d\u95f4\u8bc1\u4e66\u3002</li> <li>\u8bf7\u6c42\u5230\u8bc1\u4e66\u540e\u53d1\u73b0\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\u662f\u7531\u201cGlobalSign Root CA\u201d\u7b7e\u53d1\u7684\uff0c\u7531\u4e8e\u201cGlobalSign Root CA\u201d\u6ca1\u6709\u518d\u4e0a\u7ea7\u7b7e\u53d1\u673a\u6784\uff0c\u8bf4\u660e\u5b83\u662f\u6839\u8bc1\u4e66\uff0c\u4e5f\u5c31\u662f\u81ea\u7b7e\u8bc1\u4e66\u3002\u5e94\u7528\u8f6f\u4ef6\u4f1a\u68c0\u67e5\u6b64\u8bc1\u4e66\u662f\u5426\u5df2\u9884\u8f7d\u4e8e\u6839\u8bc1\u4e66\u6e05\u5355\u4e0a\uff0c\u5982\u679c\u6709\uff0c\u5219\u53ef\u4ee5\u5229\u7528\u6839\u8bc1\u4e66\u4e2d\u7684\u516c\u94a5\u53bb\u9a8c\u8bc1\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\uff0c\u5982\u679c\u53d1\u73b0\u9a8c\u8bc1\u901a\u8fc7\uff0c\u5c31\u8ba4\u4e3a\u8be5\u4e2d\u95f4\u8bc1\u4e66\u662f\u53ef\u4fe1\u7684\u3002</li> <li>\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\u88ab\u4fe1\u4efb\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\u4e2d\u7684\u516c\u94a5\u53bb\u9a8c\u8bc1 baidu.com \u8bc1\u4e66\u7684\u53ef\u4fe1\u6027\uff0c\u5982\u679c\u9a8c\u8bc1\u901a\u8fc7\uff0c\u5c31\u53ef\u4ee5\u4fe1\u4efb baidu.com \u8bc1\u4e66\u3002</li> </ul> <p>\u5728\u8fd9\u56db\u4e2a\u6b65\u9aa4\u4e2d\uff0c\u6700\u5f00\u59cb\u5ba2\u6237\u7aef\u53ea\u4fe1\u4efb\u6839\u8bc1\u4e66 GlobalSign Root CA \u8bc1\u4e66\u7684\uff0c\u7136\u540e\u201cGlobalSign Root CA\u201d\u8bc1\u4e66\u4fe1\u4efb\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\uff0c\u800c\u201cGlobalSign Organization Validation CA - SHA256 - G2\u201d\u8bc1\u4e66\u53c8\u4fe1\u4efb baidu.com \u8bc1\u4e66\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u4e5f\u4fe1\u4efb baidu.com \u8bc1\u4e66\u3002</p> <p>\u603b\u62ec\u6765\u8bf4\uff0c\u7531\u4e8e\u7528\u6237\u4fe1\u4efb GlobalSign\uff0c\u6240\u4ee5\u7531 GlobalSign \u6240\u62c5\u4fdd\u7684 baidu.com \u53ef\u4ee5\u88ab\u4fe1\u4efb\uff0c\u53e6\u5916\u7531\u4e8e\u7528\u6237\u4fe1\u4efb\u64cd\u4f5c\u7cfb\u7edf\u6216\u6d4f\u89c8\u5668\u7684\u8f6f\u4ef6\u5546\uff0c\u6240\u4ee5\u7531\u8f6f\u4ef6\u5546\u9884\u8f7d\u4e86\u6839\u8bc1\u4e66\u7684 GlobalSign \u90fd\u53ef\u88ab\u4fe1\u4efb\u3002</p> <p></p> <p>\u64cd\u4f5c\u7cfb\u7edf\u91cc\u4e00\u822c\u90fd\u4f1a\u5185\u7f6e\u4e00\u4e9b\u6839\u8bc1\u4e66\uff0c\u6bd4\u5982\u6211\u7684 MAC \u7535\u8111\u91cc\u5185\u7f6e\u7684\u6839\u8bc1\u4e66\u6709\u8fd9\u4e48\u591a\uff1a</p> <p></p> <p>\u8fd9\u6837\u7684\u4e00\u5c42\u5c42\u5730\u9a8c\u8bc1\u5c31\u6784\u6210\u4e86\u4e00\u6761\u4fe1\u4efb\u94fe\u8def\uff0c\u6574\u4e2a\u8bc1\u4e66\u4fe1\u4efb\u94fe\u9a8c\u8bc1\u6d41\u7a0b\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6700\u540e\u4e00\u4e2a\u95ee\u9898\uff0c\u4e3a\u4ec0\u4e48\u9700\u8981\u8bc1\u4e66\u94fe\u8fd9\u4e48\u9ebb\u70e6\u7684\u6d41\u7a0b\uff1fRoot CA \u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u9881\u53d1\u8bc1\u4e66\uff0c\u800c\u662f\u8981\u641e\u90a3\u4e48\u591a\u4e2d\u95f4\u5c42\u7ea7\u5462\uff1f</p> <p>\u8fd9\u662f\u4e3a\u4e86\u786e\u4fdd\u6839\u8bc1\u4e66\u7684\u7edd\u5bf9\u5b89\u5168\u6027\uff0c\u5c06\u6839\u8bc1\u4e66\u9694\u79bb\u5730\u8d8a\u4e25\u683c\u8d8a\u597d\uff0c\u4e0d\u7136\u6839\u8bc1\u4e66\u5982\u679c\u5931\u5b88\u4e86\uff0c\u90a3\u4e48\u6574\u4e2a\u4fe1\u4efb\u94fe\u90fd\u4f1a\u6709\u95ee\u9898\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#tls_3","title":"TLS \u7b2c\u4e09\u6b21\u63e1\u624b","text":"<p>\u5ba2\u6237\u7aef\u9a8c\u8bc1\u5b8c\u8bc1\u4e66\u540e\uff0c\u8ba4\u4e3a\u53ef\u4fe1\u5219\u7ee7\u7eed\u5f80\u4e0b\u8d70\u3002</p> <p>\u63a5\u7740\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u751f\u6210\u4e00\u4e2a\u65b0\u7684\u968f\u673a\u6570  (pre-master)\uff0c\u7528\u670d\u52a1\u5668\u7684 RSA \u516c\u94a5\u52a0\u5bc6\u8be5\u968f\u673a\u6570\uff0c\u901a\u8fc7\u300cClient Key Exchange\u300d\u6d88\u606f\u4f20\u7ed9\u670d\u52a1\u7aef\u3002</p> <p></p> <p>\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u7528 RSA \u79c1\u94a5\u89e3\u5bc6\uff0c\u5f97\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u968f\u673a\u6570 (pre-master)\u3002</p> <p>\u81f3\u6b64\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u53cc\u65b9\u90fd\u5171\u4eab\u4e86\u4e09\u4e2a\u968f\u673a\u6570\uff0c\u5206\u522b\u662f Client Random\u3001Server Random\u3001pre-master\u3002</p> <p>\u4e8e\u662f\uff0c\u53cc\u65b9\u6839\u636e\u5df2\u7ecf\u5f97\u5230\u7684\u4e09\u4e2a\u968f\u673a\u6570\uff0c\u751f\u6210\u4f1a\u8bdd\u5bc6\u94a5\uff08Master Secret\uff09\uff0c\u5b83\u662f\u5bf9\u79f0\u5bc6\u94a5\uff0c\u7528\u4e8e\u5bf9\u540e\u7eed\u7684 HTTP \u8bf7\u6c42/\u54cd\u5e94\u7684\u6570\u636e\u52a0\u89e3\u5bc6\u3002</p> <p>\u751f\u6210\u5b8c\u300c\u4f1a\u8bdd\u5bc6\u94a5\u300d\u540e\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u53d1\u4e00\u4e2a\u300cChange Cipher Spec\u300d\uff0c\u544a\u8bc9\u670d\u52a1\u7aef\u5f00\u59cb\u4f7f\u7528\u52a0\u5bc6\u65b9\u5f0f\u53d1\u9001\u6d88\u606f\u3002</p> <p></p> <p>\u7136\u540e\uff0c\u5ba2\u6237\u7aef\u518d\u53d1\u4e00\u4e2a\u300cEncrypted Handshake Message\uff08Finishd\uff09\u300d\u6d88\u606f\uff0c\u628a\u4e4b\u524d\u6240\u6709\u53d1\u9001\u7684\u6570\u636e\u505a\u4e2a\u6458\u8981\uff0c\u518d\u7528\u4f1a\u8bdd\u5bc6\u94a5\uff08master secret\uff09\u52a0\u5bc6\u4e00\u4e0b\uff0c\u8ba9\u670d\u52a1\u5668\u505a\u4e2a\u9a8c\u8bc1\uff0c\u9a8c\u8bc1\u52a0\u5bc6\u901a\u4fe1\u300c\u662f\u5426\u53ef\u7528\u300d\u548c\u300c\u4e4b\u524d\u63e1\u624b\u4fe1\u606f\u662f\u5426\u6709\u88ab\u4e2d\u9014\u7be1\u6539\u8fc7\u300d\u3002</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u300cChange Cipher Spec\u300d\u4e4b\u524d\u4f20\u8f93\u7684 TLS \u63e1\u624b\u6570\u636e\u90fd\u662f\u660e\u6587\uff0c\u4e4b\u540e\u90fd\u662f\u5bf9\u79f0\u5bc6\u94a5\u52a0\u5bc6\u7684\u5bc6\u6587\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#tls_4","title":"TLS \u7b2c\u56db\u6b21\u63e1\u624b","text":"<p>\u670d\u52a1\u5668\u4e5f\u662f\u540c\u6837\u7684\u64cd\u4f5c\uff0c\u53d1\u300cChange Cipher Spec\u300d\u548c\u300cEncrypted Handshake Message\u300d\u6d88\u606f\uff0c\u5982\u679c\u53cc\u65b9\u90fd\u9a8c\u8bc1\u52a0\u5bc6\u548c\u89e3\u5bc6\u6ca1\u95ee\u9898\uff0c\u90a3\u4e48\u63e1\u624b\u6b63\u5f0f\u5b8c\u6210\u3002</p> <p>\u6700\u540e\uff0c\u5c31\u7528\u300c\u4f1a\u8bdd\u5bc6\u94a5\u300d\u52a0\u89e3\u5bc6 HTTP \u8bf7\u6c42\u548c\u54cd\u5e94\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/2_http/https_rsa/#rsa_1","title":"RSA \u7b97\u6cd5\u7684\u7f3a\u9677","text":"<p>\u4f7f\u7528 RSA \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\u7684\u6700\u5927\u95ee\u9898\u662f\u4e0d\u652f\u6301\u524d\u5411\u4fdd\u5bc6\u3002</p> <p>\u56e0\u4e3a\u5ba2\u6237\u7aef\u4f20\u9012\u968f\u673a\u6570\uff08\u7528\u4e8e\u751f\u6210\u5bf9\u79f0\u52a0\u5bc6\u5bc6\u94a5\u7684\u6761\u4ef6\u4e4b\u4e00\uff09\u7ed9\u670d\u52a1\u7aef\u65f6\u4f7f\u7528\u7684\u662f\u516c\u94a5\u52a0\u5bc6\u7684\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u4f1a\u7528\u79c1\u94a5\u89e3\u5bc6\u5f97\u5230\u968f\u673a\u6570\u3002\u6240\u4ee5\u4e00\u65e6\u670d\u52a1\u7aef\u7684\u79c1\u94a5\u6cc4\u6f0f\u4e86\uff0c\u8fc7\u53bb\u88ab\u7b2c\u4e09\u65b9\u622a\u83b7\u7684\u6240\u6709 TLS \u901a\u8baf\u5bc6\u6587\u90fd\u4f1a\u88ab\u7834\u89e3\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u540e\u9762\u5c31\u51fa\u73b0\u4e86 ECDHE \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\uff0c\u6211\u4eec\u73b0\u5728\u5927\u591a\u6570\u7f51\u7ad9\u4f7f\u7528\u7684\u6b63\u662f ECDHE \u5bc6\u94a5\u534f\u5546\u7b97\u6cd5\uff0c\u5173\u4e8e ECDHE \u63e1\u624b\u7684\u8fc7\u7a0b\uff0c\u5c06\u5728\u4e0b\u4e00\u7bc7\u63ed\u6653\u3002</p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/challenge_ack/","title":"4.9 \u5df2\u5efa\u7acb\u8fde\u63a5\u7684 TCP\uff0c\u6536\u5230 SYN \u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6628\u665a\u6709\u4f4d\u8bfb\u8005\u95ee\u4e86\u6211\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a</p> <p></p> <p>\u5927\u6982\u610f\u601d\u662f\uff0c\u4e00\u4e2a\u5df2\u7ecf\u5efa\u7acb\u7684 TCP \u8fde\u63a5\uff0c\u5ba2\u6237\u7aef\u4e2d\u9014\u5b95\u673a\u4e86\uff0c\u800c\u670d\u52a1\u7aef\u6b64\u65f6\u4e5f\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\uff0c\u4e00\u76f4\u5904\u4e8e Established \u72b6\u6001\uff0c\u5ba2\u6237\u7aef\u6062\u590d\u540e\uff0c\u5411\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u4f1a\u600e\u4e48\u5904\u7406\uff1f</p> <p>\u770b\u8fc7\u6211\u7684\u56fe\u89e3\u7f51\u7edc\u7684\u8bfb\u8005\u90fd\u77e5\u9053\uff0cTCP \u8fde\u63a5\u662f\u7531\u300c\u56db\u5143\u7ec4\u300d\u552f\u4e00\u786e\u8ba4\u7684\u3002</p> <p>\u7136\u540e\u8fd9\u4e2a\u573a\u666f\u4e2d\uff0c\u5ba2\u6237\u7aef\u7684 IP\u3001\u670d\u52a1\u7aef IP\u3001\u76ee\u7684\u7aef\u53e3\u5e76\u6ca1\u6709\u53d8\u5316\uff0c\u6240\u4ee5\u8fd9\u4e2a\u95ee\u9898\u5173\u952e\u8981\u770b\u5ba2\u6237\u7aef\u53d1\u9001\u7684 SYN \u62a5\u6587\u4e2d\u7684\u6e90\u7aef\u53e3\u662f\u5426\u548c\u4e0a\u4e00\u6b21\u8fde\u63a5\u7684\u6e90\u7aef\u53e3\u76f8\u540c\u3002</p> <p>1. \u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\u91cc\u7684\u7aef\u53e3\u53f7\u4e0e\u5386\u53f2\u8fde\u63a5\u4e0d\u76f8\u540c</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u6062\u590d\u540e\u53d1\u9001\u7684 SYN \u62a5\u6587\u4e2d\u7684\u6e90\u7aef\u53e3\u53f7\u8ddf\u4e0a\u4e00\u6b21\u8fde\u63a5\u7684\u6e90\u7aef\u53e3\u53f7\u4e0d\u4e00\u6837\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u4f1a\u8ba4\u4e3a\u662f\u65b0\u7684\u8fde\u63a5\u8981\u5efa\u7acb\uff0c\u4e8e\u662f\u5c31\u4f1a\u901a\u8fc7\u4e09\u6b21\u63e1\u624b\u6765\u5efa\u7acb\u65b0\u7684\u8fde\u63a5\u3002</p> <p>\u90a3\u65e7\u8fde\u63a5\u91cc\u5904\u4e8e Established \u72b6\u6001\u7684\u670d\u52a1\u7aef\u6700\u540e\u4f1a\u600e\u4e48\u6837\u5462\uff1f</p> <p>\u5982\u679c\u670d\u52a1\u7aef\u53d1\u9001\u4e86\u6570\u636e\u5305\u7ed9\u5ba2\u6237\u7aef\uff0c\u7531\u4e8e\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u5df2\u7ecf\u88ab\u5173\u95ed\u4e86\uff0c\u6b64\u65f6\u5ba2\u6237\u7684\u5185\u6838\u5c31\u4f1a\u56de RST \u62a5\u6587\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\u5c31\u4f1a\u91ca\u653e\u8fde\u63a5\u3002</p> <p>\u5982\u679c\u670d\u52a1\u7aef\u4e00\u76f4\u6ca1\u6709\u53d1\u9001\u6570\u636e\u5305\u7ed9\u5ba2\u6237\u7aef\uff0c\u5728\u8d85\u8fc7\u4e00\u6bb5\u65f6\u95f4\u540e\uff0cTCP \u4fdd\u6d3b\u673a\u5236\u5c31\u4f1a\u542f\u52a8\uff0c\u68c0\u6d4b\u5230\u5ba2\u6237\u7aef\u6ca1\u6709\u5b58\u6d3b\u540e\uff0c\u63a5\u7740\u670d\u52a1\u7aef\u5c31\u4f1a\u91ca\u653e\u6389\u8be5\u8fde\u63a5\u3002</p> <p>2. \u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\u91cc\u7684\u7aef\u53e3\u53f7\u4e0e\u5386\u53f2\u8fde\u63a5\u76f8\u540c</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u6062\u590d\u540e\uff0c\u53d1\u9001\u7684 SYN \u62a5\u6587\u4e2d\u7684\u6e90\u7aef\u53e3\u53f7\u8ddf\u4e0a\u4e00\u6b21\u8fde\u63a5\u7684\u6e90\u7aef\u53e3\u53f7\u4e00\u6837\uff0c\u4e5f\u5c31\u662f\u5904\u4e8e Established \u72b6\u6001\u7684\u670d\u52a1\u7aef\u6536\u5230\u4e86\u8fd9\u4e2a SYN \u62a5\u6587\u3002</p> <p>\u5927\u5bb6\u89c9\u5f97\u670d\u52a1\u7aef\u6b64\u65f6\u4f1a\u505a\u4ec0\u4e48\u5904\u7406\u5462\uff1f - \u4e22\u6389 SYN \u62a5\u6587\uff1f - \u56de\u590d RST \u62a5\u6587\uff1f - \u56de\u590d ACK \u62a5\u6587\uff1f</p> <p>\u521a\u5f00\u59cb\u6211\u770b\u5230\u8fd9\u4e2a\u95ee\u9898\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u6ca1\u6709\u601d\u8def\u7684\uff0c\u56e0\u4e3a\u4e4b\u524d\u6ca1\u5173\u6ce8\u8fc7\uff0c\u7136\u540e\u8fd9\u4e2a\u95ee\u9898\u4e0d\u80fd\u9760\u731c\uff0c\u6240\u4ee5\u6211\u5c31\u770b\u4e86 RFC \u89c4\u8303\u548c\u770b\u4e86 Linux \u5185\u6838\u6e90\u7801\uff0c\u6700\u7ec8\u77e5\u9053\u4e86\u7b54\u6848\u3002</p> <p>\u6211\u4e0d\u5356\u5173\u5b50\uff0c\u5148\u76f4\u63a5\u8bf4\u7b54\u6848\u3002</p> <p></p> <p>\u5904\u4e8e Established \u72b6\u6001\u7684\u670d\u52a1\u7aef\uff0c\u5982\u679c\u6536\u5230\u4e86\u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\uff08\u6ce8\u610f\u6b64\u65f6\u7684 SYN \u62a5\u6587\u5176\u5b9e\u662f\u4e71\u5e8f\u7684\uff0c\u56e0\u4e3a SYN \u62a5\u6587\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u5176\u5b9e\u662f\u4e00\u4e2a\u968f\u673a\u6570\uff09\uff0c\u4f1a\u56de\u590d\u4e00\u4e2a\u643a\u5e26\u4e86\u6b63\u786e\u5e8f\u5217\u53f7\u548c\u786e\u8ba4\u53f7\u7684 ACK \u62a5\u6587\uff0c\u8fd9\u4e2a ACK \u88ab\u79f0\u4e4b\u4e3a Challenge ACK\u3002</p> <p>\u63a5\u7740\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u8fd9\u4e2a Challenge ACK\uff0c\u53d1\u73b0\u786e\u8ba4\u53f7\uff08ack num\uff09\u5e76\u4e0d\u662f\u81ea\u5df1\u671f\u671b\u6536\u5230\u7684\uff0c\u4e8e\u662f\u5c31\u4f1a\u56de RST \u62a5\u6587\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u5c31\u4f1a\u91ca\u653e\u6389\u8be5\u8fde\u63a5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/challenge_ack/#rfc","title":"RFC \u6587\u6863\u89e3\u91ca","text":"<p>RFC 793 \u6587\u6863\u91cc\u7684\u7b2c 34 \u9875\u91cc\uff0c\u6709\u8bf4\u5230\u8fd9\u4e2a\u4f8b\u5b50\u3002</p> <p></p> <p>\u539f\u6587\u7684\u89e3\u91ca\u6211\u4e5f\u8d34\u51fa\u6765\u7ed9\u5927\u5bb6\u770b\u770b\u3002</p> <ul> <li>When the SYN arrives at line 3, TCP B, being in a synchronized state, and the incoming segment outside the window, responds with an acknowledgment indicating what sequence it next expects to hear (ACK 100).</li> <li>TCP A sees that this segment does not acknowledge anything it sent and, being unsynchronized, sends a reset (RST) because it has detected a half-open connection.</li> <li>TCP B aborts at line 5.  </li> <li>TCP A willcontinue to try to Established the connection;</li> </ul> <p>\u6211\u5c31\u4e0d\u778e\u7ffb\u8bd1\u4e86\uff0c\u610f\u601d\u548c\u6211\u5728\u524d\u9762\u7528\u4e2d\u6587\u8bf4\u7684\u89e3\u91ca\u5dee\u4e0d\u591a\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/challenge_ack/#_1","title":"\u6e90\u7801\u5206\u6790","text":"<p>\u5904\u4e8e Established \u72b6\u6001\u7684\u670d\u52a1\u7aef\u5982\u679c\u6536\u5230\u4e86\u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\u65f6\uff0c\u5185\u6838\u4f1a\u8c03\u7528\u8fd9\u4e9b\u51fd\u6570\uff1a</p> C#<pre><code>tcp_v4_rcv\n  -&gt; tcp_v4_do_rcv\n    -&gt; tcp_rcv_Establisheded\n      -&gt; tcp_validate_incoming\n        -&gt; tcp_send_ack\n</code></pre> <p>\u6211\u4eec\u53ea\u5173\u6ce8 tcp_validate_incoming \u51fd\u6570\u662f\u600e\u4e48\u5904\u7406 SYN \u62a5\u6587\u7684\uff0c\u7cbe\u7b80\u540e\u7684\u4ee3\u7801\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u5b9e\u73b0\u53ef\u4ee5\u770b\u5230\uff0c\u5904\u4e8e Established \u72b6\u6001\u7684\u670d\u52a1\u7aef\uff0c\u5728\u6536\u5230\u62a5\u6587\u540e\uff0c\u9996\u5148\u4f1a\u5224\u65ad\u5e8f\u5217\u53f7\u662f\u5426\u5728\u7a97\u53e3\u5185\uff0c\u5982\u679c\u4e0d\u5728\uff0c\u5219\u770b\u770b RST \u6807\u8bb0\u6709\u6ca1\u6709\u88ab\u8bbe\u7f6e\uff0c\u5982\u679c\u6709\u5c31\u4f1a\u4e22\u6389\u3002\u7136\u540e\u5982\u679c\u6ca1\u6709 RST \u6807\u5fd7\uff0c\u5c31\u4f1a\u5224\u65ad\u662f\u5426\u6709 SYN \u6807\u8bb0\uff0c\u5982\u679c\u6709 SYN \u6807\u8bb0\u5c31\u4f1a\u8df3\u8f6c\u5230 syn_challenge \u6807\u7b7e\uff0c\u7136\u540e\u6267\u884c tcp_send_challenge_ack \u51fd\u6570\u3002</p> <p>tcp_send_challenge_ack \u51fd\u6570\u91cc\u5c31\u4f1a\u8c03\u7528 tcp_send_ack \u51fd\u6570\u6765\u56de\u590d\u4e00\u4e2a\u643a\u5e26\u4e86\u6b63\u786e\u5e8f\u5217\u53f7\u548c\u786e\u8ba4\u53f7\u7684 ACK \u62a5\u6587\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/challenge_ack/#tcp","title":"\u5982\u4f55\u5173\u95ed\u4e00\u4e2a TCP \u8fde\u63a5\uff1f","text":"<p>\u8fd9\u91cc\u95ee\u9898\u5927\u5bb6\u8fd9\u4e48\u4e00\u4e2a\u95ee\u9898\uff0c\u5982\u4f55\u5173\u95ed\u4e00\u4e2a TCP \u8fde\u63a5\uff1f</p> <p>\u53ef\u80fd\u5927\u5bb6\u7b2c\u4e00\u53cd\u5e94\u662f\u300c\u6740\u6389\u8fdb\u7a0b\u300d\u4e0d\u5c31\u884c\u4e86\u5417\uff1f</p> <p>\u662f\u7684\uff0c\u8fd9\u4e2a\u662f\u6700\u7c97\u66b4\u7684\u65b9\u5f0f\uff0c\u6740\u6389\u5ba2\u6237\u7aef\u8fdb\u7a0b\u548c\u670d\u52a1\u7aef\u8fdb\u7a0b\u5f71\u54cd\u7684\u8303\u56f4\u4f1a\u6709\u6240\u4e0d\u540c\uff1a - \u5728\u5ba2\u6237\u7aef\u6740\u6389\u8fdb\u7a0b\u7684\u8bdd\uff0c\u5c31\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u6765\u65ad\u5f00\u8fd9\u4e2a\u5ba2\u6237\u7aef\u8fdb\u7a0b\u4e0e\u670d\u52a1\u7aef\u5efa\u7acb\u7684\u6240\u6709 TCP \u8fde\u63a5\uff0c\u8fd9\u79cd\u65b9\u5f0f\u5f71\u54cd\u8303\u56f4\u53ea\u6709\u8fd9\u4e2a\u5ba2\u6237\u7aef\u8fdb\u7a0b\u6240\u5efa\u7acb\u7684\u8fde\u63a5\uff0c\u800c\u5176\u4ed6\u5ba2\u6237\u7aef\u6216\u8fdb\u7a0b\u4e0d\u4f1a\u53d7\u5f71\u54cd\u3002 - \u800c\u5728\u670d\u52a1\u7aef\u6740\u6389\u8fdb\u7a0b\u5f71\u54cd\u5c31\u5927\u4e86\uff0c\u6b64\u65f6\u6240\u6709\u7684 TCP \u8fde\u63a5\u90fd\u4f1a\u88ab\u5173\u95ed\uff0c\u670d\u52a1\u7aef\u65e0\u6cd5\u7ee7\u7eed\u63d0\u4f9b\u8bbf\u95ee\u670d\u52a1\u3002</p> <p>\u6240\u4ee5\uff0c\u5173\u95ed\u8fdb\u7a0b\u7684\u65b9\u5f0f\u5e76\u4e0d\u53ef\u53d6\uff0c\u6700\u597d\u7684\u65b9\u5f0f\u8981\u7cbe\u7ec6\u5230\u5173\u95ed\u67d0\u4e00\u6761 TCP \u8fde\u63a5\u3002</p> <p>\u6709\u7684\u5c0f\u4f19\u4f34\u53ef\u80fd\u4f1a\u8bf4\uff0c\u4f2a\u9020\u4e00\u4e2a\u56db\u5143\u7ec4\u76f8\u540c\u7684 RST \u62a5\u6587\u4e0d\u5c31\u884c\u4e86\uff1f</p> <p>\u8fd9\u4e2a\u601d\u8def\u5f88\u597d\uff0c\u4f46\u662f\u4e0d\u8981\u5fd8\u4e86\u8fd8\u6709\u4e2a\u5e8f\u5217\u53f7\u7684\u95ee\u9898\uff0c\u4f60\u4f2a\u9020\u7684 RST \u62a5\u6587\u7684\u5e8f\u5217\u53f7\u4e00\u5b9a\u80fd\u88ab\u5bf9\u65b9\u63a5\u53d7\u5417\uff1f</p> <p>\u5982\u679c RST \u62a5\u6587\u7684\u5e8f\u5217\u53f7\u4e0d\u662f\u5bf9\u65b9\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\uff0c\u8fd9\u4e2a RST \u62a5\u6587\u4f1a\u88ab\u5bf9\u65b9\u4e22\u5f03\u7684\uff0c\u5c31\u8fbe\u4e0d\u5230\u5173\u95ed\u7684\u8fde\u63a5\u7684\u6548\u679c\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u9762\u8fd9\u4e2a\u573a\u666f\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u4e86\u4e00\u4e2a\u957f\u5ea6\u4e3a 100 \u7684 TCP \u6570\u636e\u62a5\u6587\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\u54cd\u5e94\u4e86 ACK \u62a5\u6587\uff0c\u8868\u793a\u6536\u5230\u4e86\u8fd9\u4e2a TCP \u6570\u636e\u62a5\u6587\u3002\u670d\u52a1\u7aef\u54cd\u5e94\u7684\u8fd9\u4e2a ACK \u62a5\u6587\u4e2d\u7684\u786e\u8ba4\u53f7\uff08ack = x + 100\uff09\u5c31\u662f\u8868\u660e\u670d\u52a1\u7aef\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\u662f x + 100\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u8981\u4f2a\u9020\u4e00\u4e2a\u80fd\u5173\u95ed TCP \u8fde\u63a5\u7684 RST \u62a5\u6587\uff0c\u5fc5\u987b\u540c\u65f6\u6ee1\u8db3\u300c\u56db\u5143\u7ec4\u76f8\u540c\u300d\u548c\u300c\u5e8f\u5217\u53f7\u662f\u5bf9\u65b9\u671f\u671b\u7684\u300d\u8fd9\u4e24\u4e2a\u6761\u4ef6\u3002</p> <p>\u76f4\u63a5\u4f2a\u9020\u7b26\u5408\u9884\u671f\u7684\u5e8f\u5217\u53f7\u662f\u6bd4\u8f83\u56f0\u96be\uff0c\u56e0\u4e3a\u5982\u679c\u4e00\u4e2a\u6b63\u5728\u4f20\u8f93\u6570\u636e\u7684 TCP \u8fde\u63a5\uff0c\u5e8f\u5217\u53f7\u90fd\u662f\u65f6\u523b\u90fd\u5728\u53d8\u5316\uff0c\u56e0\u6b64\u5f88\u96be\u521a\u597d\u4f2a\u9020\u4e00\u4e2a\u6b63\u786e\u5e8f\u5217\u53f7\u7684 RST \u62a5\u6587\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/challenge_ack/#killcx","title":"killcx \u7684\u5de5\u5177","text":"<p>\u529e\u6cd5\u8fd8\u662f\u6709\u7684\uff0c\u6211\u4eec\u53ef\u4ee5\u4f2a\u9020\u4e00\u4e2a\u56db\u5143\u7ec4\u76f8\u540c\u7684 SYN \u62a5\u6587\uff0c\u6765\u62ff\u5230\u201c\u5408\u6cd5\u201d\u7684\u5e8f\u5217\u53f7\uff01</p> <p>\u6b63\u5982\u6211\u4eec\u6700\u5f00\u59cb\u5b66\u5230\u7684\uff0c\u5982\u679c\u5904\u4e8e Established \u72b6\u6001\u7684\u670d\u52a1\u7aef\uff0c\u6536\u5230\u56db\u5143\u7ec4\u76f8\u540c\u7684 SYN \u62a5\u6587\u540e\uff0c\u4f1a\u56de\u590d\u4e00\u4e2a Challenge ACK\uff0c\u8fd9\u4e2a ACK \u62a5\u6587\u91cc\u7684\u300c\u786e\u8ba4\u53f7\u300d\uff0c\u6b63\u597d\u662f\u670d\u52a1\u7aef\u4e0b\u4e00\u6b21\u60f3\u8981\u63a5\u6536\u7684\u5e8f\u5217\u53f7\uff0c\u8bf4\u767d\u4e86\uff0c\u5c31\u662f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e00\u6b65\u62ff\u5230\u670d\u52a1\u7aef\u4e0b\u4e00\u6b21\u9884\u671f\u63a5\u6536\u7684\u5e8f\u5217\u53f7\u3002</p> <p>\u7136\u540e\u7528\u8fd9\u4e2a\u786e\u8ba4\u53f7\u4f5c\u4e3a RST \u62a5\u6587\u7684\u5e8f\u5217\u53f7\uff0c\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u4f1a\u8ba4\u4e3a\u8fd9\u4e2a RST \u62a5\u6587\u91cc\u7684\u5e8f\u5217\u53f7\u662f\u5408\u6cd5\u7684\uff0c\u4e8e\u662f\u5c31\u4f1a\u91ca\u653e\u8fde\u63a5\uff01</p> <p>\u5728 Linux \u4e0a\u6709\u4e2a\u53eb killcx \u7684\u5de5\u5177\uff0c\u5c31\u662f\u57fa\u4e8e\u4e0a\u9762\u8fd9\u6837\u7684\u65b9\u5f0f\u5b9e\u73b0\u7684\uff0c\u5b83\u4f1a\u4e3b\u52a8\u53d1\u9001 SYN \u5305\u83b7\u53d6 SEQ/ACK \u53f7\uff0c\u7136\u540e\u5229\u7528 SEQ/ACK \u53f7\u4f2a\u9020\u4e24\u4e2a RST \u62a5\u6587\u5206\u522b\u53d1\u7ed9\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\uff0c\u8fd9\u6837\u53cc\u65b9\u7684 TCP \u8fde\u63a5\u90fd\u4f1a\u88ab\u91ca\u653e\uff0c\u8fd9\u79cd\u65b9\u5f0f\u6d3b\u8dc3\u548c\u975e\u6d3b\u8dc3\u7684 TCP \u8fde\u63a5\u90fd\u53ef\u4ee5\u6740\u6389\u3002</p> <p>killcx \u7684\u5de5\u5177\u4f7f\u7528\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u5982\u679c\u5728\u670d\u52a1\u7aef\u6267\u884c killcx \u5de5\u5177\uff0c\u53ea\u9700\u6307\u660e\u5ba2\u6237\u7aef\u7684 IP \u548c\u7aef\u53e3\u53f7\uff0c\u5982\u679c\u5728\u5ba2\u6237\u7aef\u6267\u884c killcx \u5de5\u5177\uff0c\u5219\u5c31\u6307\u660e\u670d\u52a1\u7aef\u7684 IP \u548c\u7aef\u53e3\u53f7\u3002</p> <p>C#<pre><code>./killcx &lt;IP\u5730\u5740&gt;:&lt;\u7aef\u53e3\u53f7&gt;\n</code></pre> killcx \u5de5\u5177\u7684\u5de5\u4f5c\u539f\u7406\uff0c\u5982\u4e0b\u56fe\uff0c\u4e0b\u56fe\u662f\u5728\u5ba2\u6237\u7aef\u6267\u884c killcx \u5de5\u5177\u3002</p> <p></p> <p>\u5b83\u4f2a\u9020\u5ba2\u6237\u7aef\u53d1\u9001 SYN \u62a5\u6587\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\u5c31\u4f1a\u56de\u590d\u4e00\u4e2a\u643a\u5e26\u4e86\u6b63\u786e\u300c\u5e8f\u5217\u53f7\u548c\u786e\u8ba4\u53f7\u300d\u7684 ACK \u62a5\u6587\uff08Challenge ACK\uff09\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u5229\u7528\u8fd9\u4e2a ACK \u62a5\u6587\u91cc\u9762\u7684\u4fe1\u606f\uff0c\u4f2a\u9020\u4e24\u4e2a RST \u62a5\u6587\uff1a - \u7528 Challenge ACK \u91cc\u7684\u786e\u8ba4\u53f7\u4f2a\u9020 RST \u62a5\u6587\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u6536\u5230 RST \u62a5\u6587\u540e\u5c31\u4f1a\u91ca\u653e\u8fde\u63a5\u3002 - \u7528 Challenge ACK \u91cc\u7684\u5e8f\u5217\u53f7\u4f2a\u9020 RST \u62a5\u6587\u53d1\u9001\u7ed9\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u6536\u5230 RST \u4e5f\u4f1a\u91ca\u653e\u8fde\u63a5\u3002</p> <p>\u6b63\u662f\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\uff0c\u6210\u529f\u5c06\u4e00\u4e2a TCP \u8fde\u63a5\u5173\u95ed\u4e86\uff01</p> <p>\u8fd9\u91cc\u7ed9\u5927\u5bb6\u8d34\u4e00\u4e2a\u4f7f\u7528 killcx \u5de5\u5177\u5173\u95ed\u8fde\u63a5\u7684\u6293\u5305\u56fe\uff0c\u5927\u5bb6\u591a\u770b\u770b\u5e8f\u5217\u53f7\u548c\u786e\u8ba4\u53f7\u7684\u53d8\u5316\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u4ee5\u540e\u6293\u5305\u4e2d\uff0c\u5982\u679c\u83ab\u540d\u5947\u5999\u51fa\u73b0\u4e00\u4e2a SYN \u5305\uff0c\u6709\u53ef\u80fd\u5bf9\u65b9\u63a5\u4e0b\u6765\u60f3\u8981\u5bf9\u4f60\u53d1\u8d77\u7684 RST \u653b\u51fb\uff0c\u76f4\u63a5\u5c06\u4f60\u7684 TCP \u8fde\u63a5\u65ad\u5f00\uff01</p> <p>\u600e\u4e48\u6837\uff0c\u5f88\u5de7\u5999\u5427\uff01</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/challenge_ack/#tcpkill","title":"tcpkill \u7684\u5de5\u5177","text":"<p>\u9664\u4e86 killcx \u5de5\u5177\u80fd\u5173\u95ed TCP \u8fde\u63a5\uff0c\u8fd8\u6709 tcpkill \u5de5\u5177\u4e5f\u53ef\u4ee5\u505a\u5230\u3002</p> <p>\u8fd9\u4e24\u4e2a\u5de5\u5177\u90fd\u662f\u901a\u8fc7\u4f2a\u9020 RST \u62a5\u6587\u6765\u5173\u95ed\u6307\u5b9a\u7684 TCP \u8fde\u63a5\uff0c\u4f46\u662f\u5b83\u4eec\u62ff\u5230\u6b63\u786e\u7684\u5e8f\u5217\u53f7\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u4e0d\u540c\u7684\u3002</p> <ul> <li>tcpkill \u5de5\u5177\u662f\u5728\u53cc\u65b9\u8fdb\u884c TCP \u901a\u4fe1\u65f6\uff0c\u62ff\u5230\u5bf9\u65b9\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\uff0c\u7136\u540e\u5c06\u5e8f\u5217\u53f7\u586b\u5145\u5230\u4f2a\u9020\u7684 RST \u62a5\u6587\uff0c\u5e76\u5c06\u5176\u53d1\u9001\u7ed9\u5bf9\u65b9\uff0c\u8fbe\u5230\u5173\u95ed TCP \u8fde\u63a5\u7684\u6548\u679c\u3002</li> <li>killcx \u5de5\u5177\u662f\u4e3b\u52a8\u53d1\u9001\u4e00\u4e2a SYN \u62a5\u6587\uff0c\u5bf9\u65b9\u6536\u5230\u540e\u4f1a\u56de\u590d\u4e00\u4e2a\u643a\u5e26\u4e86\u6b63\u786e\u5e8f\u5217\u53f7\u548c\u786e\u8ba4\u53f7\u7684 ACK \u62a5\u6587\uff0c\u8fd9\u4e2a ACK \u88ab\u79f0\u4e4b\u4e3a Challenge ACK\uff0c\u8fd9\u65f6\u5c31\u53ef\u4ee5\u62ff\u5230\u5bf9\u65b9\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\uff0c\u7136\u540e\u5c06\u5e8f\u5217\u53f7\u586b\u5145\u5230\u4f2a\u9020\u7684 RST \u62a5\u6587\uff0c\u5e76\u5c06\u5176\u53d1\u9001\u7ed9\u5bf9\u65b9\uff0c\u8fbe\u5230\u5173\u95ed TCP \u8fde\u63a5\u7684\u6548\u679c\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e24\u4e2a\u5de5\u5177\u5728\u83b7\u53d6\u5bf9\u65b9\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\u7684\u65b9\u5f0f\u662f\u4e0d\u540c\u7684\u3002</p> <p>tcpkill \u5de5\u5177\u5c5e\u4e8e\u88ab\u52a8\u83b7\u53d6\uff0c\u5c31\u662f\u5728\u53cc\u65b9\u8fdb\u884c TCP \u901a\u4fe1\u7684\u65f6\u5019\uff0c\u624d\u80fd\u83b7\u53d6\u5230\u6b63\u786e\u7684\u5e8f\u5217\u53f7\uff0c\u5f88\u663e\u7136\u8fd9\u79cd\u65b9\u5f0f\u65e0\u6cd5\u5173\u95ed\u975e\u6d3b\u8dc3\u7684 TCP \u8fde\u63a5\uff0c\u53ea\u80fd\u7528\u4e8e\u5173\u95ed\u6d3b\u8dc3\u7684 TCP \u8fde\u63a5\u3002\u56e0\u4e3a\u5982\u679c\u8fd9\u6761 TCP \u8fde\u63a5\u4e00\u76f4\u6ca1\u6709\u4efb\u4f55\u6570\u636e\u4f20\u8f93\uff0c\u5219\u5c31\u6c38\u8fdc\u83b7\u53d6\u4e0d\u5230\u6b63\u786e\u7684\u5e8f\u5217\u53f7\u3002</p> <p>killcx \u5de5\u5177\u5219\u662f\u5c5e\u4e8e\u4e3b\u52a8\u83b7\u53d6\uff0c\u5b83\u662f\u4e3b\u52a8\u53d1\u9001\u4e00\u4e2a SYN \u62a5\u6587\uff0c\u901a\u8fc7\u5bf9\u65b9\u56de\u590d\u7684 Challenge ACK \u6765\u83b7\u53d6\u6b63\u786e\u7684\u5e8f\u5217\u53f7\uff0c\u6240\u4ee5\u8fd9\u79cd\u65b9\u5f0f\u65e0\u8bba TCP \u8fde\u63a5\u662f\u5426\u6d3b\u8dc3\uff0c\u90fd\u53ef\u4ee5\u5173\u95ed\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u5c31\u7528\u8fd9 tcpkill \u5de5\u5177\u6765\u505a\u4e2a\u5b9e\u9a8c\u3002</p> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u7528 nc \u5de5\u5177\u6765\u6a21\u62df\u4e00\u4e2a TCP \u670d\u52a1\u7aef\uff0c\u76d1\u542c 8888 \u7aef\u53e3\u3002</p> <p></p> <p>\u63a5\u7740\uff0c\u5728\u5ba2\u6237\u7aef\u673a\u5b50\u4e0a\uff0c\u7528 nc \u5de5\u5177\u6a21\u62df\u4e00\u4e2a TCP \u5ba2\u6237\u7aef\uff0c\u8fde\u63a5\u6211\u4eec\u521a\u624d\u542f\u52a8\u7684\u670d\u52a1\u7aef\uff0c\u5e76\u4e14\u6307\u5b9a\u4e86\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u4e3a 11111\u3002</p> <p></p> <p>\u8fd9\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u5c31\u53ef\u4ee5\u770b\u5230\u8fd9\u6761 TCP \u8fde\u63a5\u4e86\u3002</p> <p></p> <p>\u6ce8\u610f\uff0c\u6211\u8fd9\u53f0\u670d\u52a1\u7aef\u7684\u516c\u7f51 IP \u5730\u5740\u662f 121.43.173.240\uff0c\u79c1\u7f51 IP \u5730\u5740\u662f 172.19.11.21\uff0c\u5728\u670d\u52a1\u7aef\u901a\u8fc7 netstat \u547d\u4ee4\u67e5\u770b TCP \u8fde\u63a5\u7684\u65f6\u5019\uff0c\u5219\u4f1a\u5c06\u670d\u52a1\u7aef\u7684\u5730\u5740\u663e\u793a\u6210\u79c1\u7f51 IP \u5730\u5740\u3002\u81f3\u6b64\uff0c\u6211\u4eec\u524d\u671f\u5de5\u4f5c\u5c31\u505a\u597d\u4e86\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5728\u670d\u52a1\u7aef\u6267\u884c tcpkill \u5de5\u5177\uff0c\u6765\u5173\u95ed\u8fd9\u6761 TCP \u8fde\u63a5\uff0c\u770b\u770b\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</p> <p>\u5728\u8fd9\u91cc\uff0c\u6211\u6307\u5b9a\u4e86\u8981\u5173\u95ed\u7684\u5ba2\u6237\u7aef IP \u4e3a 114.132.166.90 \u548c\u7aef\u53e3\u4e3a 11111 \u7684 TCP \u8fde\u63a5\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0ctcpkill \u5de5\u5177\u963b\u585e\u4e2d\uff0c\u6ca1\u6709\u4efb\u4f55\u8f93\u51fa\uff0c\u800c\u4e14\u6b64\u65f6\u7684 TCP \u8fde\u63a5\u8fd8\u662f\u5b58\u5728\u7684\uff0c\u5e76\u6ca1\u6709\u88ab\u5e72\u6389\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48 TCP \u8fde\u63a5\u6ca1\u7528\u88ab\u5e72\u6389\uff1f</p> <p>\u56e0\u4e3a\u5728\u6267\u884c tcpkill \u5de5\u5177\u540e\uff0c\u8fd9\u6761 TCP \u8fde\u63a5\u5e76\u6ca1\u6709\u4f20\u8f93\u4efb\u4f55\u6570\u636e\uff0c\u800c tcpkill \u5de5\u5177\u662f\u9700\u8981\u62e6\u622a\u53cc\u65b9\u7684 TCP \u901a\u4fe1\uff0c\u624d\u80fd\u83b7\u53d6\u5230\u6b63\u786e\u7684\u5e8f\u5217\u53f7\uff0c\u4ece\u800c\u624d\u80fd\u4f2a\u88c5\u51fa\u6b63\u786e\u7684\u5e8f\u5217\u53f7\u7684 RST \u62a5\u6587\u3002</p> <p>\u6240\u4ee5\uff0c\u4ece\u8fd9\u91cc\u4e5f\u8bf4\u660e\u4e86\uff0ctcpkill \u5de5\u5177\u4e0d\u9002\u5408\u5173\u95ed\u975e\u6d3b\u8dc3\u7684 TCP \u8fde\u63a5\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u5c1d\u8bd5\u5728\u5ba2\u6237\u7aef\u53d1\u9001\u4e00\u4e2a\u6570\u636e\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5728\u53d1\u9001\u4e86\u300chi\u300d\u6570\u636e\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u65ad\u5f00\u4e86\uff0c\u5e76\u4e14\u9519\u8bef\u63d0\u793a\u8fde\u63a5\u88ab\u5bf9\u65b9\u5173\u95ed\u4e86\u3002</p> <p>\u6b64\u65f6\uff0c\u670d\u52a1\u7aef\u5df2\u7ecf\u67e5\u770b\u4e0d\u5230\u521a\u624d\u90a3\u6761 TCP \u8fde\u63a5\u4e86\u3002</p> <p></p> <p>\u7136\u540e\uff0c\u6211\u4eec\u5728\u670d\u52a1\u7aef\u770b\u770b tcpkill \u5de5\u5177\u8f93\u51fa\u7684\u4fe1\u606f\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c tcpkill \u5de5\u5177\u7ed9\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u90fd\u53d1\u9001\u4e86\u4f2a\u9020\u7684 RST \u62a5\u6587\uff0c\u4ece\u800c\u8fbe\u5230\u5173\u95ed\u4e00\u6761 TCP \u8fde\u63a5\u7684\u6548\u679c\u3002</p> <p>\u5230\u8fd9\u91cc\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u8fd0\u884c tcpkill \u5de5\u5177\u540e\uff0c\u53ea\u6709\u76ee\u6807\u8fde\u63a5\u6709\u65b0 TCP \u5305\u53d1\u9001/\u63a5\u6536\u7684\u65f6\u5019\uff0c\u624d\u80fd\u5173\u95ed\u4e00\u6761 TCP \u8fde\u63a5\u3002\u56e0\u6b64\uff0ctcpkill \u53ea\u9002\u5408\u5173\u95ed\u6d3b\u8dc3\u7684 TCP \u8fde\u63a5\uff0c\u4e0d\u9002\u5408\u7528\u6765\u5173\u95ed\u975e\u6d3b\u8dc3\u7684 TCP \u8fde\u63a5\u3002</p> <p>\u4e0a\u9762\u7684\u5b9e\u9a8c\u8fc7\u7a0b\uff0c\u6211\u4e5f\u6293\u4e86\u6570\u636e\u5305\uff0c\u6d41\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u6700\u540e\u4e00\u4e2a RST \u62a5\u6587\u5c31\u662f tcpkill \u5de5\u5177\u4f2a\u9020\u7684 RST \u62a5\u6587\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/challenge_ack/#_2","title":"\u603b\u7ed3","text":"<p>\u8981\u4f2a\u9020\u4e00\u4e2a\u80fd\u5173\u95ed TCP \u8fde\u63a5\u7684 RST \u62a5\u6587\uff0c\u5fc5\u987b\u540c\u65f6\u6ee1\u8db3\u300c\u56db\u5143\u7ec4\u76f8\u540c\u300d\u548c\u300c\u5e8f\u5217\u53f7\u662f\u5bf9\u65b9\u671f\u671b\u7684\u300d\u8fd9\u4e24\u4e2a\u6761\u4ef6\u3002</p> <p>\u4eca\u5929\u7ed9\u5927\u5bb6\u4ecb\u7ecd\u4e86\u4e24\u79cd\u5173\u95ed TCP \u8fde\u63a5\u7684\u5de5\u5177\uff1atcpkill \u548c killcx \u5de5\u5177\u3002</p> <p>\u8fd9\u4e24\u79cd\u5de5\u5177\u90fd\u662f\u901a\u8fc7\u4f2a\u9020 RST \u62a5\u6587\u6765\u5173\u95ed TCP \u8fde\u63a5\u7684\uff0c\u4f46\u662f\u5b83\u4eec\u83b7\u53d6\u300c\u5bf9\u65b9\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\u7684\u65b9\u5f0f\u662f\u4e0d\u540c\u7684\uff0c\u4e5f\u6b63\u56e0\u6b64\uff0c\u9020\u5c31\u4e86\u8fd9\u4e24\u4e2a\u5de5\u5177\u7684\u5e94\u7528\u573a\u666f\u6709\u533a\u522b\u3002</p> <ul> <li>tcpkill \u5de5\u5177\u53ea\u80fd\u7528\u6765\u5173\u95ed\u6d3b\u8dc3\u7684 TCP \u8fde\u63a5\uff0c\u65e0\u6cd5\u5173\u95ed\u975e\u6d3b\u8dc3\u7684 TCP \u8fde\u63a5\uff0c\u56e0\u4e3a tcpkill \u5de5\u5177\u662f\u7b49\u53cc\u65b9\u8fdb\u884c TCP \u901a\u4fe1\u540e\uff0c\u624d\u53bb\u83b7\u53d6\u6b63\u786e\u7684\u5e8f\u5217\u53f7\uff0c\u5982\u679c\u8fd9\u6761 TCP \u8fde\u63a5\u4e00\u76f4\u6ca1\u6709\u4efb\u4f55\u6570\u636e\u4f20\u8f93\uff0c\u5219\u5c31\u6c38\u8fdc\u83b7\u53d6\u4e0d\u5230\u6b63\u786e\u7684\u5e8f\u5217\u53f7\u3002</li> <li>killcx \u5de5\u5177\u53ef\u4ee5\u7528\u6765\u5173\u95ed\u6d3b\u8dc3\u548c\u975e\u6d3b\u8dc3\u7684 TCP \u8fde\u63a5\uff0c\u56e0\u4e3a killcx \u5de5\u5177\u662f\u4e3b\u52a8\u53d1\u9001 SYN \u62a5\u6587\uff0c\u8fd9\u65f6\u5bf9\u65b9\u5c31\u4f1a\u56de\u590d Challenge ACK\uff0c\u7136\u540e killcx \u5de5\u5177\u5c31\u80fd\u4ece\u8fd9\u4e2a ACK \u83b7\u53d6\u5230\u6b63\u786e\u7684\u5e8f\u5217\u53f7\u3002</li> </ul> <p>\u5b8c\uff01</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/isn_deff/","title":"4.7 \u4e3a\u4ec0\u4e48 TCP \u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u8981\u4e0d\u4e00\u6837\u5462\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e3a\u4ec0\u4e48 TCP \u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u8981\u4e0d\u4e00\u6837\u5462\uff1f</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4e00\u6b65\u4e00\u6b65\u7ed9\u5927\u5bb6\u8bb2\u660e\u767d\uff0c\u6211\u89c9\u5f97\u5e94\u8be5\u6709\u4e0d\u5c11\u4eba\u4f1a\u6709\u7c7b\u4f3c\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u4eca\u5929\u518d\u809d\u4e00\u7bc7\uff01</p> <p>\u4e3a\u4ec0\u4e48 TCP \u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u8981\u4e0d\u4e00\u6837\u5462\uff1f</p> <p>\u4e3b\u8981\u539f\u56e0\u662f\u4e3a\u4e86\u9632\u6b62\u5386\u53f2\u62a5\u6587\u88ab\u4e0b\u4e00\u4e2a\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u63a5\u6536\u3002</p> <p>TCP \u56db\u6b21\u6325\u624b\u4e2d\u7684 TIME_WAIT \u72b6\u6001\u4e0d\u662f\u4f1a\u6301\u7eed 2 MSL \u65f6\u957f\uff0c\u5386\u53f2\u62a5\u6587\u4e0d\u662f\u65e9\u5c31\u5728\u7f51\u7edc\u4e2d\u6d88\u5931\u4e86\u5417\uff1f</p> <p>\u662f\u7684\uff0c\u5982\u679c\u80fd\u6b63\u5e38\u56db\u6b21\u6325\u624b\uff0c\u7531\u4e8e TIME_WAIT \u72b6\u6001\u4f1a\u6301\u7eed 2 MSL \u65f6\u957f\uff0c\u5386\u53f2\u62a5\u6587\u4f1a\u5728\u4e0b\u4e00\u4e2a\u8fde\u63a5\u4e4b\u524d\u5c31\u4f1a\u81ea\u7136\u6d88\u5931\u3002</p> <p>\u4f46\u662f\u6765\u4e86\uff0c\u6211\u4eec\u5e76\u4e0d\u80fd\u4fdd\u8bc1\u6bcf\u6b21\u8fde\u63a5\u90fd\u80fd\u901a\u8fc7\u56db\u6b21\u6325\u624b\u6765\u6b63\u5e38\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u5047\u8bbe\u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u662f\u4ece 0 \u5f00\u59cb\uff1a</p> <p></p> <p>\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5efa\u7acb\u4e00\u4e2a TCP \u8fde\u63a5\uff0c\u5728\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\u5305\u88ab\u7f51\u7edc\u963b\u585e\u4e86\uff0c\u7136\u540e\u8d85\u65f6\u91cd\u4f20\u4e86\u8fd9\u4e2a\u6570\u636e\u5305\uff0c\u800c\u6b64\u65f6\u670d\u52a1\u7aef\u8bbe\u5907\u65ad\u7535\u91cd\u542f\u4e86\uff0c\u4e4b\u524d\u4e0e\u5ba2\u6237\u7aef\u5efa\u7acb\u7684\u8fde\u63a5\u5c31\u6d88\u5931\u4e86\uff0c\u4e8e\u662f\u5728\u6536\u5230\u5ba2\u6237\u7aef\u7684\u6570\u636e\u5305\u7684\u65f6\u5019\u5c31\u4f1a\u53d1\u9001 RST \u62a5\u6587\u3002</li> <li>\u7d27\u63a5\u7740\uff0c\u5ba2\u6237\u7aef\u53c8\u4e0e\u670d\u52a1\u7aef\u5efa\u7acb\u4e86\u4e0e\u4e0a\u4e00\u4e2a\u8fde\u63a5\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\uff1b</li> <li>\u5728\u65b0\u8fde\u63a5\u5efa\u7acb\u5b8c\u6210\u540e\uff0c\u4e0a\u4e00\u4e2a\u8fde\u63a5\u4e2d\u88ab\u7f51\u7edc\u963b\u585e\u7684\u6570\u636e\u5305\u6b63\u597d\u62b5\u8fbe\u4e86\u670d\u52a1\u7aef\uff0c\u521a\u597d\u8be5\u6570\u636e\u5305\u7684\u5e8f\u5217\u53f7\u6b63\u597d\u662f\u5728\u670d\u52a1\u7aef\u7684\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u6240\u4ee5\u8be5\u6570\u636e\u5305\u4f1a\u88ab\u670d\u52a1\u7aef\u6b63\u5e38\u63a5\u6536\uff0c\u5c31\u4f1a\u9020\u6210\u6570\u636e\u9519\u4e71\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c\u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u662f\u4e00\u6837\u7684\u8bdd\uff0c\u5f88\u5bb9\u6613\u51fa\u73b0\u5386\u53f2\u62a5\u6587\u88ab\u4e0b\u4e00\u4e2a\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u63a5\u6536\u7684\u95ee\u9898\u3002</p> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u4e0d\u4e00\u6837\u4e0d\u662f\u4e5f\u4f1a\u53d1\u751f\u8fd9\u6837\u7684\u4e8b\u60c5\u5417\uff1f</p> <p>\u662f\u7684\uff0c\u5373\u4f7f\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u4e0d\u4e00\u6837\uff0c\u4e5f\u4f1a\u5b58\u5728\u6536\u5230\u5386\u53f2\u62a5\u6587\u7684\u53ef\u80fd\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u8981\u6e05\u695a\u4e00\u70b9\uff0c\u5386\u53f2\u62a5\u6587\u80fd\u5426\u88ab\u5bf9\u65b9\u63a5\u6536\uff0c\u8fd8\u8981\u770b\u8be5\u5386\u53f2\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u662f\u5426\u6b63\u597d\u5728\u5bf9\u65b9\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u5982\u679c\u4e0d\u5728\u5c31\u4f1a\u4e22\u5f03\uff0c\u5982\u679c\u5728\u624d\u4f1a\u63a5\u6536\u3002</p> <p>\u5982\u679c\u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u300c\u4e0d\u4e00\u6837\u300d\uff0c\u5c31\u6709\u5927\u6982\u7387\u56e0\u4e3a\u5386\u53f2\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u300c\u4e0d\u5728\u300d\u5bf9\u65b9\u63a5\u6536\u7a97\u53e3\uff0c\u4ece\u800c\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u4e86\u5386\u53f2\u62a5\u6587\uff0c\u6bd4\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u76f8\u53cd\uff0c\u5982\u679c\u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u300c\u4e00\u6837\u300d\uff0c\u5c31\u6709\u5927\u6982\u7387\u9047\u5230\u5386\u53f2\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u521a\u300c\u597d\u5728\u300d\u5bf9\u65b9\u7684\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u4ece\u800c\u5bfc\u81f4\u5386\u53f2\u62a5\u6587\u88ab\u65b0\u8fde\u63a5\u6210\u529f\u63a5\u6536\u3002</p> <p>\u6240\u4ee5\uff0c\u6bcf\u6b21\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u4e0d\u4e00\u6837\u80fd\u591f\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5386\u53f2\u62a5\u6587\u88ab\u4e0b\u4e00\u4e2a\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u63a5\u6536\uff0c\u6ce8\u610f\u662f\u5f88\u5927\u7a0b\u5ea6\u4e0a\uff0c\u5e76\u4e0d\u662f\u5b8c\u5168\u907f\u514d\u4e86\u3002</p> <p>\u90a3\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u662f\u968f\u673a\u7684\uff0c\u90a3\u8fd8\u662f\u6709\u53ef\u80fd\u968f\u673a\u6210\u4e00\u6837\u7684\u5440\uff1f</p> <p>RFC793 \u63d0\u5230\u521d\u59cb\u5316\u5e8f\u5217\u53f7 ISN \u968f\u673a\u751f\u6210\u7b97\u6cd5\uff1a<code>ISN = M + F(localhost, localport, remotehost, remoteport)</code>\u3002</p> <ul> <li>M \u662f\u4e00\u4e2a\u8ba1\u65f6\u5668\uff0c\u8fd9\u4e2a\u8ba1\u65f6\u5668\u6bcf\u9694 4 \u5fae\u79d2\u52a0 1\u3002</li> <li>F \u662f\u4e00\u4e2a Hash \u7b97\u6cd5\uff0c\u6839\u636e\u6e90 IP\u3001\u76ee\u7684 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684\u7aef\u53e3\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\u503c\uff0c\u8981\u4fdd\u8bc1 Hash \u7b97\u6cd5\u4e0d\u80fd\u88ab\u5916\u90e8\u8f7b\u6613\u63a8\u7b97\u5f97\u51fa\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u968f\u673a\u6570\u662f\u4f1a\u57fa\u4e8e\u65f6\u949f\u8ba1\u65f6\u5668\u9012\u589e\u7684\uff0c\u57fa\u672c\u4e0d\u53ef\u80fd\u4f1a\u968f\u673a\u6210\u4e00\u6837\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u3002</p> <p>\u61c2\u4e86\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u662f\u968f\u673a\u751f\u6210\u7684\u8bdd\uff0c\u5c31\u80fd\u907f\u514d\u8fde\u63a5\u63a5\u6536\u5386\u53f2\u62a5\u6587\u4e86\u3002</p> <p>\u662f\u7684\uff0c\u4f46\u662f\u4e5f\u4e0d\u662f\u5b8c\u5168\u907f\u514d\u4e86\u3002</p> <p>\u4e3a\u4e86\u80fd\u66f4\u597d\u7684\u7406\u89e3\u8fd9\u4e2a\u539f\u56e0\uff0c\u6211\u4eec\u5148\u6765\u4e86\u89e3\u5e8f\u5217\u53f7\uff08SEQ\uff09\u548c\u521d\u59cb\u5e8f\u5217\u53f7\uff08ISN\uff09\u3002</p> <ul> <li>\u5e8f\u5217\u53f7\uff0c\u662f TCP \u4e00\u4e2a\u5934\u90e8\u5b57\u6bb5\uff0c\u6807\u8bc6\u4e86 TCP \u53d1\u9001\u7aef\u5230 TCP \u63a5\u6536\u7aef\u7684\u6570\u636e\u6d41\u7684\u4e00\u4e2a\u5b57\u8282\uff0c\u56e0\u4e3a TCP \u662f\u9762\u5411\u5b57\u8282\u6d41\u7684\u53ef\u9760\u534f\u8bae\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u7684\u987a\u5e8f\u6027\u548c\u53ef\u9760\u6027\uff0cTCP \u4e3a\u6bcf\u4e2a\u4f20\u8f93\u65b9\u5411\u4e0a\u7684\u6bcf\u4e2a\u5b57\u8282\u90fd\u8d4b\u4e88\u4e86\u4e00\u4e2a\u7f16\u53f7\uff0c\u4ee5\u4fbf\u4e8e\u4f20\u8f93\u6210\u529f\u540e\u786e\u8ba4\u3001\u4e22\u5931\u540e\u91cd\u4f20\u4ee5\u53ca\u5728\u63a5\u6536\u7aef\u4fdd\u8bc1\u4e0d\u4f1a\u4e71\u5e8f\u3002\u5e8f\u5217\u53f7\u662f\u4e00\u4e2a 32 \u4f4d\u7684\u65e0\u7b26\u53f7\u6570\uff0c\u56e0\u6b64\u5728\u5230\u8fbe 4G \u4e4b\u540e\u518d\u5faa\u73af\u56de\u5230 0\u3002</li> <li>\u521d\u59cb\u5e8f\u5217\u53f7\uff0c\u5728 TCP \u5efa\u7acb\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u4f1a\u5404\u81ea\u751f\u6210\u4e00\u4e2a\u521d\u59cb\u5e8f\u5217\u53f7\uff0c\u5b83\u662f\u57fa\u4e8e\u65f6\u949f\u751f\u6210\u7684\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u6765\u4fdd\u8bc1\u6bcf\u4e2a\u8fde\u63a5\u90fd\u62e5\u6709\u4e0d\u540c\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u3002\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u53ef\u88ab\u89c6\u4e3a\u4e00\u4e2a 32 \u4f4d\u7684\u8ba1\u6570\u5668\uff0c\u8be5\u8ba1\u6570\u5668\u7684\u6570\u503c\u6bcf 4 \u5fae\u79d2\u52a0 1\uff0c\u5faa\u73af\u4e00\u6b21\u9700\u8981 4.55 \u5c0f\u65f6\u3002</li> </ul> <p>\u7ed9\u5927\u5bb6\u6293\u4e86\u4e00\u4e2a\u5305\uff0c\u4e0b\u56fe\u4e2d\u7684 Seq \u5c31\u662f\u5e8f\u5217\u53f7\uff0c\u5176\u4e2d\u7ea2\u8272\u6846\u4f4f\u7684\u5206\u522b\u662f\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5404\u81ea\u751f\u6210\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u3002</p> <p></p> <p>\u901a\u8fc7\u524d\u9762\u6211\u4eec\u77e5\u9053\uff0c\u5e8f\u5217\u53f7\u548c\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u5e76\u4e0d\u662f\u65e0\u9650\u9012\u589e\u7684\uff0c\u4f1a\u53d1\u751f\u56de\u7ed5\u4e3a\u521d\u59cb\u503c\u7684\u60c5\u51b5\uff0c\u8fd9\u610f\u5473\u7740\u65e0\u6cd5\u6839\u636e\u5e8f\u5217\u53f7\u6765\u5224\u65ad\u65b0\u8001\u6570\u636e\u3002</p> <p>\u4e0d\u8981\u4ee5\u4e3a\u5e8f\u5217\u53f7\u7684\u4e0a\u9650\u503c\u662f 4 GB\uff0c\u5c31\u4ee5\u4e3a\u5f88\u5927\uff0c\u5f88\u96be\u53d1\u751f\u56de\u7ed5\u3002\u5728\u4e00\u4e2a\u901f\u5ea6\u8db3\u591f\u5feb\u7684\u7f51\u7edc\u4e2d\u4f20\u8f93\u5927\u91cf\u6570\u636e\u65f6\uff0c\u5e8f\u5217\u53f7\u7684\u56de\u7ed5\u65f6\u95f4\u5c31\u4f1a\u53d8\u77ed\u3002\u5982\u679c\u5e8f\u5217\u53f7\u56de\u7ed5\u7684\u65f6\u95f4\u6781\u77ed\uff0c\u6211\u4eec\u5c31\u4f1a\u518d\u6b21\u9762\u4e34\u4e4b\u524d\u5ef6\u8fdf\u7684\u62a5\u6587\u62b5\u8fbe\u540e\u5e8f\u5217\u53f7\u4f9d\u7136\u6709\u6548\u7684\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u9700\u8981\u6709 TCP \u65f6\u95f4\u6233\u3002<code>tcp_timestamps</code> \u53c2\u6570\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\uff0c\u5f00\u542f\u4e86 <code>tcp_timestamps</code> \u53c2\u6570\uff0cTCP \u5934\u90e8\u5c31\u4f1a\u4f7f\u7528\u65f6\u95f4\u6233\u9009\u9879\uff0c\u5b83\u6709\u4e24\u4e2a\u597d\u5904\uff0c\u4e00\u4e2a\u662f\u4fbf\u4e8e\u7cbe\u786e\u8ba1\u7b97 RTT\uff0c\u53e6\u4e00\u4e2a\u662f\u80fd\u9632\u6b62\u5e8f\u5217\u53f7\u56de\u7ed5\uff08PAWS\uff09\u3002</p> <p>\u8bd5\u770b\u4e0b\u9762\u7684\u793a\u4f8b\uff0c\u5047\u8bbe TCP \u7684\u53d1\u9001\u7a97\u53e3\u662f 1 GB\uff0c\u5e76\u4e14\u4f7f\u7528\u4e86\u65f6\u95f4\u6233\u9009\u9879\uff0c\u53d1\u9001\u65b9\u4f1a\u4e3a\u6bcf\u4e2a TCP \u62a5\u6587\u5206\u914d\u65f6\u95f4\u6233\u6570\u503c\uff0c\u6211\u4eec\u5047\u8bbe\u6bcf\u4e2a\u62a5\u6587\u65f6\u95f4\u52a0 1\uff0c\u7136\u540e\u4f7f\u7528\u8fd9\u4e2a\u8fde\u63a5\u4f20\u8f93\u4e00\u4e2a 6 GB \u5927\u5c0f\u7684\u6570\u636e\u6d41\u3002</p> <p></p> <p>32 \u4f4d\u7684\u5e8f\u5217\u53f7\u5728\u65f6\u523b D \u548c E \u4e4b\u95f4\u56de\u7ed5\u3002\u5047\u8bbe\u5728\u65f6\u523b B \u6709\u4e00\u4e2a\u62a5\u6587\u4e22\u5931\u5e76\u88ab\u91cd\u4f20\uff0c\u53c8\u5047\u8bbe\u8fd9\u4e2a\u62a5\u6587\u6bb5\u5728\u7f51\u7edc\u4e0a\u7ed5\u4e86\u8fdc\u8def\u5e76\u5728\u65f6\u523b F \u91cd\u65b0\u51fa\u73b0\u3002\u5982\u679c TCP \u65e0\u6cd5\u8bc6\u522b\u8fd9\u4e2a\u7ed5\u56de\u7684\u62a5\u6587\uff0c\u90a3\u4e48\u6570\u636e\u5b8c\u6574\u6027\u5c31\u4f1a\u906d\u5230\u7834\u574f\u3002</p> <p>\u4f7f\u7528\u65f6\u95f4\u6233\u9009\u9879\u80fd\u591f\u6709\u6548\u7684\u9632\u6b62\u4e0a\u8ff0\u95ee\u9898\uff0c\u5982\u679c\u4e22\u5931\u7684\u62a5\u6587\u4f1a\u5728\u65f6\u523b F \u91cd\u65b0\u51fa\u73b0\uff0c\u7531\u4e8e\u5b83\u7684\u65f6\u95f4\u6233\u4e3a 2\uff0c\u5c0f\u4e8e\u6700\u8fd1\u7684\u6709\u6548\u65f6\u95f4\u6233\uff085 \u6216 6\uff09\uff0c\u56e0\u6b64\u9632\u56de\u7ed5\u5e8f\u5217\u53f7\u7b97\u6cd5\uff08PAWS\uff09\u4f1a\u5c06\u5176\u4e22\u5f03\u3002</p> <p>\u9632\u56de\u7ed5\u5e8f\u5217\u53f7\u7b97\u6cd5\u8981\u6c42\u8fde\u63a5\u53cc\u65b9\u7ef4\u62a4\u6700\u8fd1\u4e00\u6b21\u6536\u5230\u7684\u6570\u636e\u5305\u7684\u65f6\u95f4\u6233\uff08Recent TSval\uff09\uff0c\u6bcf\u6536\u5230\u4e00\u4e2a\u65b0\u6570\u636e\u5305\u90fd\u4f1a\u8bfb\u53d6\u6570\u636e\u5305\u4e2d\u7684\u65f6\u95f4\u6233\u503c\u8ddf Recent TSval \u503c\u505a\u6bd4\u8f83\uff0c\u5982\u679c\u53d1\u73b0\u6536\u5230\u7684\u6570\u636e\u5305\u4e2d\u65f6\u95f4\u6233\u4e0d\u662f\u9012\u589e\u7684\uff0c\u5219\u8868\u793a\u8be5\u6570\u636e\u5305\u662f\u8fc7\u671f\u7684\uff0c\u5c31\u4f1a\u76f4\u63a5\u4e22\u5f03\u8fd9\u4e2a\u6570\u636e\u5305\u3002</p> <p>\u61c2\u4e86\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u662f\u968f\u673a\u751f\u6210\uff0c\u80fd\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u5386\u53f2\u62a5\u6587\u88ab\u4e0b\u4e00\u4e2a\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u63a5\u6536\uff0c\u7136\u540e\u53c8\u5f15\u5165\u65f6\u95f4\u6233\u7684\u673a\u5236\uff0c\u4ece\u800c\u5b8c\u5168\u907f\u514d\u4e86\u5386\u53f2\u62a5\u6587\u88ab\u63a5\u6536\u7684\u95ee\u9898\u3002</p> <p>\u55ef\u55ef\uff0c\u6ca1\u9519\u3002</p> <p>\u5982\u679c\u65f6\u95f4\u6233\u4e5f\u56de\u7ed5\u4e86\u600e\u4e48\u529e\uff1f</p> <p>\u65f6\u95f4\u6233\u7684\u5927\u5c0f\u662f 32 bit\uff0c\u6240\u4ee5\u7406\u8bba\u4e0a\u4e5f\u662f\u6709\u56de\u7ed5\u7684\u53ef\u80fd\u6027\u7684\u3002</p> <p>\u65f6\u95f4\u6233\u56de\u7ed5\u7684\u901f\u5ea6\u53ea\u4e0e\u5bf9\u7aef\u4e3b\u673a\u65f6\u949f\u9891\u7387\u6709\u5173\u3002</p> <p>Linux \u4ee5\u672c\u5730\u65f6\u949f\u8ba1\u6570\uff08jiffies\uff09\u4f5c\u4e3a\u65f6\u95f4\u6233\u7684\u503c\uff0c\u4e0d\u540c\u7684\u589e\u957f\u65f6\u95f4\u4f1a\u6709\u4e0d\u540c\u7684\u95ee\u9898\uff1a</p> <ul> <li>\u5982\u679c\u65f6\u949f\u8ba1\u6570\u52a0 1 \u9700\u8981 1 ms\uff0c\u5219\u9700\u8981\u7ea6 24.8 \u5929\u624d\u80fd\u56de\u7ed5\u4e00\u534a\uff0c\u53ea\u8981\u62a5\u6587\u7684\u751f\u5b58\u65f6\u95f4\u5c0f\u4e8e\u8fd9\u4e2a\u503c\u7684\u8bdd\u5224\u65ad\u65b0\u65e7\u6570\u636e\u5c31\u4e0d\u4f1a\u51fa\u9519\u3002</li> <li>\u5982\u679c\u65f6\u949f\u8ba1\u6570\u63d0\u9ad8\u5230 1 us \u52a0 1\uff0c\u5219\u56de\u7ed5\u9700\u8981\u7ea6 71.58 \u5206\u949f\u624d\u80fd\u56de\u7ed5\uff0c\u8fd9\u65f6\u95ee\u9898\u4e5f\u4e0d\u5927\uff0c\u56e0\u4e3a\u7f51\u7edc\u4e2d\u65e7\u62a5\u6587\u51e0\u4e4e\u4e0d\u53ef\u80fd\u751f\u5b58\u8d85\u8fc7 70 \u5206\u949f\uff0c\u53ea\u662f\u5982\u679c 70 \u5206\u949f\u6ca1\u6709\u62a5\u6587\u6536\u53d1\u5219\u4f1a\u6709\u4e00\u4e2a\u5305\u8d8a\u8fc7 PAWS\uff08\u8fd9\u79cd\u60c5\u51b5\u4f1a\u6bd4\u8f83\u591a\u89c1\uff0c\u76f8\u6bd4\u4e4b\u4e0b 24 \u5929\u6ca1\u6709\u6570\u636e\u4f20\u8f93\u7684 TCP \u8fde\u63a5\u5c11\u4e4b\u53c8\u5c11\uff09\uff0c\u4f46\u9664\u975e\u8fd9\u4e2a\u5305\u78b0\u5de7\u662f\u5e8f\u5217\u53f7\u56de\u7ed5\u7684\u65e7\u6570\u636e\u5305\u800c\u88ab\u653e\u5165\u63a5\u6536\u961f\u5217\uff08\u592a\u5de7\u4e86\u5427\uff09\uff0c\u5426\u5219\u4e5f\u4e0d\u4f1a\u6709\u95ee\u9898\uff1b</li> <li>\u5982\u679c\u65f6\u949f\u8ba1\u6570\u63d0\u9ad8\u5230 0.1 us \u52a0 1 \u56de\u7ed5\u9700\u8981 7 \u5206\u949f\u591a\u4e00\u70b9\uff0c\u8fd9\u65f6\u5c31\u53ef\u80fd\u4f1a\u6709\u95ee\u9898\u4e86\uff0c\u8fde\u63a5\u5982\u679c 7 \u5206\u949f\u6ca1\u6709\u6570\u636e\u6536\u53d1\u5c31\u4f1a\u6709\u4e00\u4e2a\u62a5\u6587\u8d8a\u8fc7 PAWS\uff0c\u5bf9\u4e8e TCP \u8fde\u63a5\u800c\u8a00\u8fd9\u4e48\u77ed\u7684\u65f6\u95f4\u5185\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\u592a\u5e38\u89c1\u4e86\u5427\uff01\u8fd9\u6837\u7684\u8bdd\u4f1a\u9891\u7e41\u6709\u5305\u8d8a\u8fc7 PAWS \u68c0\u67e5\uff0c\u4ece\u800c\u4f7f\u5f97\u65e7\u5305\u6df7\u5165\u6570\u636e\u4e2d\u7684\u6982\u7387\u5927\u5927\u589e\u52a0\uff1b</li> </ul> <p>Linux \u5728 PAWS \u68c0\u67e5\u505a\u4e86\u4e00\u4e2a\u7279\u6b8a\u5904\u7406\uff0c\u5982\u679c\u4e00\u4e2a TCP \u8fde\u63a5\u8fde\u7eed 24 \u5929\u4e0d\u6536\u53d1\u6570\u636e\u5219\u5728\u63a5\u6536\u7b2c\u4e00\u4e2a\u5305\u65f6\u57fa\u4e8e\u65f6\u95f4\u6233\u7684 PAWS \u4f1a\u5931\u6548\uff0c\u4e5f\u5c31\u662f\u53ef\u4ee5 PAWS \u51fd\u6570\u4f1a\u653e\u8fc7\u8fd9\u4e2a\u7279\u6b8a\u7684\u60c5\u51b5\uff0c\u8ba4\u4e3a\u662f\u5408\u6cd5\u7684\uff0c\u53ef\u4ee5\u63a5\u6536\u8be5\u6570\u636e\u5305\u3002</p> C<pre><code>// tcp_paws_check \u51fd\u6570\u5982\u679c\u8fd4\u56de true \u5219 PAWS \u901a\u8fc7\uff1a\nstatic inline bool tcp_paws_check(const struct tcp_options_received *rx_opt, int paws_win)\n{\n......\n\n   // \u4ece\u4e0a\u6b21\u6536\u5230\u5305\u5230\u73b0\u5728\u7ecf\u5386\u7684\u65f6\u95f4\u591a\u4e8e 24 \u5929\uff0c\u8fd4\u56de true\n if (unlikely(get_seconds() &gt;= rx_opt-&gt;ts_recent_stamp + TCP_PAWS_24DAYS))\n    return true;\n\n.....\n    return false;\n}\n</code></pre> <p>\u8981\u89e3\u51b3\u65f6\u95f4\u6233\u56de\u7ed5\u7684\u95ee\u9898\uff0c\u53ef\u4ee5\u8003\u8651\u4ee5\u4e0b\u89e3\u51b3\u65b9\u6848\uff1a</p> <p>1\uff09\u589e\u52a0\u65f6\u95f4\u6233\u7684\u5927\u5c0f\uff0c\u7531 32 bit \u6269\u5927\u5230 64 bit</p> <p>\u8fd9\u6837\u867d\u7136\u53ef\u4ee5\u5728\u80fd\u591f\u9884\u89c1\u7684\u672a\u6765\u89e3\u51b3\u65f6\u95f4\u6233\u56de\u7ed5\u7684\u95ee\u9898\uff0c\u4f46\u4f1a\u5bfc\u81f4\u65b0\u65e7\u534f\u8bae\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u50cf\u73b0\u5728\u7684 IPv4 \u4e0e IPv6 \u4e00\u6837</p> <p>2\uff09\u5c06\u4e00\u4e2a\u4e0e\u65f6\u949f\u9891\u7387\u65e0\u5173\u7684\u503c\u4f5c\u4e3a\u65f6\u95f4\u6233\uff0c\u65f6\u949f\u9891\u7387\u53ef\u4ee5\u589e\u52a0\u4f46\u65f6\u95f4\u6233\u7684\u589e\u901f\u4e0d\u53d8</p> <p>\u968f\u7740\u65f6\u949f\u9891\u7387\u7684\u63d0\u9ad8\uff0cTCP \u5728\u76f8\u540c\u65f6\u95f4\u5185\u80fd\u591f\u6536\u53d1\u7684\u5305\u4e5f\u4f1a\u8d8a\u6765\u8d8a\u591a\u3002\u5982\u679c\u65f6\u95f4\u6233\u7684\u589e\u901f\u4e0d\u53d8\uff0c\u5219\u4f1a\u6709\u8d8a\u6765\u8d8a\u591a\u7684\u62a5\u6587\u4f7f\u7528\u76f8\u540c\u7684\u65f6\u95f4\u6233\u3002\u8fd9\u79cd\u8d8b\u52bf\u5230\u8fbe\u4e00\u5b9a\u7a0b\u5ea6\u5219\u65f6\u95f4\u6233\u5c31\u4f1a\u5931\u53bb\u610f\u4e49\uff0c\u9664\u975e\u5728\u53ef\u9884\u89c1\u7684\u672a\u6765\u8fd9\u79cd\u60c5\u51b5\u4e0d\u4f1a\u53d1\u751f\u3002</p> <p>3\uff09\u6682\u65f6\u6ca1\u60f3\u5230</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/out_of_order_fin/","title":"4.10 \u56db\u6b21\u6325\u624b\u4e2d\u6536\u5230\u4e71\u5e8f\u7684 FIN \u5305\u4f1a\u5982\u4f55\u5904\u7406\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6536\u5230\u4e2a\u8bfb\u8005\u7684\u95ee\u9898\uff0c\u4ed6\u5728\u9762\u8bd5\u9e45\u5382\u7684\u65f6\u5019\uff0c\u88ab\u641e\u61f5\u4e86\uff0c\u56e0\u4e3a\u9762\u8bd5\u5b98\u95ee\u4e86\u4ed6\u8fd9\u4e48\u4e00\u4e2a\u7f51\u7edc\u95ee\u9898\uff1a</p> <p></p> <p>\u4e0d\u5f97\u4e0d\u8bf4\uff0c\u9e45\u5382\u771f\u7684\u5f88\u559c\u6b22\u95ee\u7f51\u7edc\u95ee\u9898\uff0c\u800c\u4e14\u7231\u95ee\u5f02\u5e38\u60c5\u51b5\u4e0b\u7684\u7f51\u7edc\u95ee\u9898\uff0c\u4e4b\u524d\u4e5f\u6709\u7bc7\u53e6\u5916\u4e00\u4e2a\u8bfb\u8005\u9762\u8bd5\u9e45\u5382\u7684\u7f51\u7edc\u95ee\u9898\uff1a\u300c\u88ab\u9e45\u5382\u9762\u6015\u4e86\uff01\u300d\u3002</p> <p>\u4e0d\u8fc7\u8fd9\u9053\u9e45\u5382\u7684\u7f51\u7edc\u9898\u53ef\u80fd\u662f\u63d0\u95ee\u7684\u8bfb\u8005\u8868\u8ff0\u6709\u95ee\u9898\uff0c\u56e0\u4e3a\u5982\u679c FIN \u62a5\u6587\u6bd4\u6570\u636e\u5305\u5148\u62b5\u8fbe\u5ba2\u6237\u7aef\uff0c\u6b64\u65f6 FIN \u62a5\u6587\u5176\u5b9e\u662f\u4e00\u4e2a\u4e71\u5e8f\u7684\u62a5\u6587\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u7684 TCP \u8fde\u63a5\u5e76\u4e0d\u4f1a\u4ece FIN_WAIT_2 \u72b6\u6001\u8f6c\u6362\u5230 TIME_WAIT \u72b6\u6001\u3002</p> <p></p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u8981\u5173\u6ce8\u5230\u70b9\u662f\u770b\u300c\u5728 FIN_WAIT_2 \u72b6\u6001\u4e0b\uff0c\u662f\u5982\u4f55\u5904\u7406\u6536\u5230\u7684\u4e71\u5e8f\u5230 FIN \u62a5\u6587\uff0c\u7136\u540e TCP \u8fde\u63a5\u53c8\u662f\u4ec0\u4e48\u65f6\u5019\u624d\u8fdb\u5165\u5230 TIME_WAIT \u72b6\u6001\uff1f\u300d\u3002</p> <p>\u6211\u8fd9\u91cc\u5148\u76f4\u63a5\u8bf4\u7ed3\u8bba\uff1a</p> <p>\u5728 FIN_WAIT_2 \u72b6\u6001\u65f6\uff0c\u5982\u679c\u6536\u5230\u4e71\u5e8f\u7684 FIN \u62a5\u6587\uff0c\u90a3\u4e48\u5c31\u88ab\u4f1a\u52a0\u5165\u5230\u300c\u4e71\u5e8f\u961f\u5217\u300d\uff0c\u5e76\u4e0d\u4f1a\u8fdb\u5165\u5230 TIME_WAIT \u72b6\u6001\u3002</p> <p>\u7b49\u518d\u6b21\u6536\u5230\u524d\u9762\u88ab\u7f51\u7edc\u5ef6\u8fdf\u7684\u6570\u636e\u5305\u65f6\uff0c\u4f1a\u5224\u65ad\u4e71\u5e8f\u961f\u5217\u6709\u6ca1\u6709\u6570\u636e\uff0c\u7136\u540e\u4f1a\u68c0\u6d4b\u4e71\u5e8f\u961f\u5217\u4e2d\u662f\u5426\u6709\u53ef\u7528\u7684\u6570\u636e\uff0c\u5982\u679c\u80fd\u5728\u4e71\u5e8f\u961f\u5217\u4e2d\u627e\u5230\u4e0e\u5f53\u524d\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u4fdd\u6301\u7684\u987a\u5e8f\u7684\u62a5\u6587\uff0c\u5c31\u4f1a\u770b\u8be5\u62a5\u6587\u662f\u5426\u6709 FIN \u6807\u5fd7\uff0c\u5982\u679c\u53d1\u73b0\u6709 FIN \u6807\u5fd7\uff0c\u8fd9\u65f6\u624d\u4f1a\u8fdb\u5165 TIME_WAIT \u72b6\u6001\u3002</p> <p>\u6211\u4e5f\u753b\u4e86\u4e00\u5f20\u56fe\uff0c\u5927\u5bb6\u53ef\u4ee5\u7ed3\u5408\u7740\u56fe\u6765\u7406\u89e3\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/out_of_order_fin/#tcp","title":"TCP \u6e90\u7801\u5206\u6790","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6211\u5e26\u5927\u5bb6\u770b\u770b\u6e90\u7801\uff0c\u542c\u5230\u8981\u6e90\u7801\u5206\u6790\uff0c\u53ef\u80fd\u6709\u7684\u540c\u5b66\u5c31\u6002\u4e86\u3002</p> <p>\u5176\u5b9e\u8981\u5206\u6790\u6211\u4eec\u4eca\u5929\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ea\u8981\u61c2 if else \u5c31\u884c\u4e86\uff0c\u6211\u4e5f\u4f1a\u7528\u4e2d\u6587\u6765\u8868\u8ff0\u4ee3\u7801\u7684\u903b\u8f91\uff0c\u6240\u4ee5\u5355\u7eaf\u770b\u6211\u7684\u6587\u5b57\u4e5f\u662f\u53ef\u4ee5\u7684\u3002</p> <p>\u8fd9\u6b21\u6211\u4eec\u91cd\u70b9\u5206\u6790\u7684\u662f\uff0c\u5728 FIN_WAIT_2 \u72b6\u6001\u4e0b\uff0c\u6536\u5230 FIN \u62a5\u6587\u662f\u5982\u4f55\u5904\u7406\u7684\u3002</p> <p>\u5728 Linux \u5185\u6838\u91cc\uff0c\u5f53 IP \u5c42\u5904\u7406\u5b8c\u6d88\u606f\u540e\uff0c\u4f1a\u901a\u8fc7\u56de\u8c03 tcp_v4_rcv \u51fd\u6570\u5c06\u6d88\u606f\u8f6c\u7ed9 TCP \u5c42\uff0c\u6240\u4ee5\u8fd9\u4e2a\u51fd\u6570\u5c31\u662f TCP \u5c42\u6536\u5230\u6d88\u606f\u7684\u5165\u53e3\u3002</p> <p> \u5904\u4e8e FIN_WAIT_2 \u72b6\u6001\u4e0b\u7684\u5ba2\u6237\u7aef\uff0c\u5728\u6536\u5230\u670d\u52a1\u7aef\u7684\u62a5\u6587\u540e\uff0c\u6700\u7ec8\u4f1a\u8c03\u7528 tcp_v4_do_rcv \u51fd\u6570\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0ctcp_v4_do_rcv \u65b9\u6cd5\u4f1a\u8c03\u7528 tcp_rcv_state_process\uff0c\u5728\u8fd9\u91cc\u4f1a\u6839\u636e TCP \u72b6\u6001\u505a\u5bf9\u5e94\u7684\u5904\u7406\uff0c\u8fd9\u91cc\u6211\u4eec\u53ea\u5173\u6ce8 FIN_WAIT_2 \u72b6\u6001\u3002</p> <p></p> <p>\u5728\u4e0a\u9762\u8fd9\u4e2a\u4ee3\u7801\u91cc\uff0c\u53ef\u4ee5\u770b\u5230\u5982\u679c shutdown \u5173\u95ed\u4e86\u8bfb\u65b9\u5411\uff0c\u90a3\u4e48\u5728\u6536\u5230\u5bf9\u65b9\u53d1\u6765\u7684\u6570\u636e\u5305\uff0c\u5219\u4f1a\u56de\u590d RST \u62a5\u6587\u3002</p> <p>\u800c\u6211\u4eec\u8fd9\u6b21\u7684\u9898\u76ee\u91cc\uff0cshutdown \u53ea\u5173\u95ed\u4e86\u5199\u65b9\u5411\uff0c\u6240\u4ee5\u4f1a\u7ee7\u7eed\u5f80\u4e0b\u8c03\u7528 tcp_data_queue \u51fd\u6570\uff08\u56e0\u4e3a case TCP_FIN_WAIT2 \u4ee3\u7801\u5757\u91cc\u5e76\u6ca1\u6709 break \u8bed\u53e5\uff0c\u6240\u4ee5\u4f1a\u8d70\u5230\u8be5\u51fd\u6570\uff09\u3002</p> <p> \u5728\u4e0a\u9762\u7684 tcp_data_queue \u51fd\u6570\u91cc\uff0c\u5982\u679c\u6536\u5230\u7684\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u662f\u6211\u4eec\u9884\u671f\u7684\uff0c\u4e5f\u5c31\u662f\u6709\u5e8f\u7684\u8bdd\uff1a - \u4f1a\u5224\u65ad\u8be5\u62a5\u6587\u6709\u6ca1\u6709 FIN \u6807\u5fd7\uff0c\u5982\u679c\u6709\u7684\u8bdd\u5c31\u4f1a\u8c03\u7528 tcp_fin \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u8d1f\u8d23\u5c06 FIN_WAIT_2 \u72b6\u6001\u8f6c\u6362\u4e3a TIME_WAIT\u3002 - \u63a5\u7740\u8fd8\u4f1a\u770b\u4e71\u5e8f\u961f\u5217\u6709\u6ca1\u6709\u6570\u636e\uff0c\u5982\u679c\u6709\u7684\u8bdd\u4f1a\u8c03\u7528 tcp_ofo_queue \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u8d1f\u8d23\u68c0\u67e5\u4e71\u5e8f\u961f\u5217\u4e2d\u662f\u5426\u6709\u6570\u636e\u5305\u53ef\u7528\uff0c\u5373\u80fd\u4e0d\u80fd\u5728\u4e71\u5e8f\u961f\u5217\u627e\u5230\u4e0e\u5f53\u524d\u6570\u636e\u5305\u4fdd\u6301\u5e8f\u5217\u53f7\u8fde\u7eed\u7684\u6570\u636e\u5305\u3002</p> <p>\u800c\u5f53\u6536\u5230\u7684\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u4e0d\u662f\u6211\u4eec\u9884\u671f\u7684\uff0c\u4e5f\u5c31\u662f\u4e71\u5e8f\u7684\u8bdd\uff0c\u5219\u8c03\u7528 tcp_data_queue_ofo \u51fd\u6570\uff0c\u5c06\u62a5\u6587\u52a0\u5165\u5230\u4e71\u5e8f\u961f\u5217\uff0c\u8fd9\u4e2a\u961f\u5217\u7684\u6570\u636e\u7ed3\u6784\u662f\u7ea2\u9ed1\u6811\u3002</p> <p>\u6211\u4eec\u7684\u9898\u76ee\u91cc\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u7684 FIN \u62a5\u6587\u5b9e\u9645\u4e0a\u662f\u4e00\u4e2a\u4e71\u5e8f\u7684\u62a5\u6587\uff0c\u56e0\u6b64\u6b64\u65f6\u5e76\u4e0d\u4f1a\u8c03\u7528 tcp_fin \u51fd\u6570\u8fdb\u884c\u72b6\u6001\u8f6c\u6362\uff0c\u800c\u662f\u5c06\u62a5\u6587\u901a\u8fc7 tcp_data_queue_ofo \u51fd\u6570\u52a0\u5165\u5230\u4e71\u5e8f\u961f\u5217\u3002</p> <p>\u7136\u540e\u5f53\u5ba2\u6237\u7aef\u6536\u5230\u88ab\u7f51\u7edc\u5ef6\u8fdf\u7684\u6570\u636e\u5305\u540e\uff0c\u6b64\u65f6\u56e0\u4e3a\u8be5\u6570\u636e\u5305\u7684\u5e8f\u5217\u53f7\u662f\u671f\u671b\u7684\uff0c\u7136\u540e\u53c8\u56e0\u4e3a\u4e0a\u4e00\u6b21\u6536\u5230\u7684\u4e71\u5e8f FIN \u62a5\u6587\u88ab\u52a0\u5165\u5230\u4e86\u4e71\u5e8f\u961f\u5217\uff0c\u8868\u660e\u4e71\u5e8f\u961f\u5217\u662f\u6709\u6570\u636e\u7684\uff0c\u4e8e\u662f\u5c31\u4f1a\u8c03\u7528 tcp_ofo_queue \u51fd\u6570\u3002</p> <p>\u6211\u4eec\u6765\u770b\u770b tcp_ofo_queue \u51fd\u6570\u3002</p> <p></p> <p>\u5728\u4e0a\u9762\u7684 tcp_ofo_queue \u51fd\u6570\u91cc\uff0c\u5728\u4e71\u5e8f\u961f\u5217\u4e2d\u627e\u5230\u80fd\u4e0e\u5f53\u524d\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u4fdd\u6301\u7684\u987a\u5e8f\u7684\u62a5\u6587\u540e\uff0c\u4f1a\u770b\u8be5\u62a5\u6587\u662f\u5426\u6709 FIN \u6807\u5fd7\uff0c\u5982\u679c\u6709\u7684\u8bdd\uff0c\u5c31\u4f1a\u8c03\u7528 tcp_fin() \u51fd\u6570\u3002</p> <p>\u6700\u540e\uff0c\u6211\u4eec\u6765\u770b\u770b tcp_fin \u51fd\u6570\u7684\u5904\u7406\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c\u5f53\u524d\u7684 TCP \u72b6\u6001\u4e3a TCP_FIN_WAIT2\uff0c\u5c31\u4f1a\u53d1\u9001\u7b2c\u56db\u6b21\u6325\u624b ack\uff0c\u7136\u540e\u8c03\u7528 tcp_time_wait \u51fd\u6570\uff0c\u8fd9\u4e2a\u51fd\u6570\u91cc\u4f1a\u5c06 TCP \u72b6\u6001\u53d8\u66f4\u4e3a TIME_WAIT\uff0c\u5e76\u542f\u52a8 TIME_WAIT \u7684\u5b9a\u65f6\u5668\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/out_of_order_fin/#tcp_1","title":"\u600e\u4e48\u770b TCP \u6e90\u7801\uff1f","text":"<p>\u4e4b\u524d\u6709\u4e0d\u5c11\u540c\u5b66\u95ee\u6211\uff0c\u6211\u662f\u600e\u4e48\u770b TCP \u6e90\u7801\u7684\uff1f</p> <p>\u5176\u5b9e\u6211\u770b TCP \u6e90\u7801\uff0c\u5e76\u4e0d\u662f\u76f4\u63a5\u6253\u5f00 Linux \u6e90\u7801\u76f4\u63a5\u770b\uff0c\u56e0\u4e3a Linux \u6e90\u7801\u5b9e\u5728\u592a\u5e9e\u5927\u4e86\uff0c\u5982\u679c\u6211\u4e0d\u77e5\u9053 TCP \u5165\u53e3\u51fd\u6570\u5728\u54ea\uff0c\u90a3\u7b80\u76f4\u5c31\u662f\u5927\u6d77\u635e\u9488\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u770b TCP \u6e90\u7801\uff0c\u6211\u4eec\u53ef\u4ee5\u53bb\u7f51\u4e0a\u641c\u7d22\u4e0b\u522b\u4eba\u7684\u6e90\u7801\u5206\u6790\uff0c\u7f51\u4e0a\u5df2\u7ecf\u6709\u5f88\u591a\u524d\u8f88\u5e2e\u6211\u4eec\u5206\u6790\u4e86 TCP \u6e90\u7801\u4e86\uff0c\u800c\u4e14\u5404\u4e2a\u51fd\u6570\u7684\u8c03\u7528\u94fe\u8def\uff0c\u4ed6\u4eec\u90fd\u6709\u5199\u51fa\u6765\u4e86\u3002</p> <p>\u6bd4\u5982\uff0c\u4f60\u60f3\u4e86\u89e3 TCP \u4e09\u6b21\u63e1\u624b/\u56db\u6b21\u6325\u624b\u7684\u6e90\u7801\u5b9e\u73b0\uff0c\u4f60\u5c31\u53ef\u4ee5\u4ee5\u300cTCP \u4e09\u6b21\u63e1\u624b/\u56db\u6b21\u6325\u624b\u7684\u6e90\u7801\u5206\u6790\u300d\u8fd9\u6837\u5173\u952e\u5b57\u6765\u641c\u7d22\uff0c\u5927\u90e8\u5206\u6587\u7ae0\u7684\u6ce8\u91ca\u5199\u7684\u8fd8\u662f\u5f88\u6e05\u6670\uff0c\u6211\u6700\u5f00\u59cb\u5c31\u6309\u8fd9\u79cd\u65b9\u5f0f\u6765\u5b66\u4e60 TCP \u6e90\u7801\u7684\u3002</p> <p>\u7f51\u4e0a\u7684\u6587\u7ae0\u4e00\u822c\u53ea\u4f1a\u5c06\u91cd\u70b9\u7684\u90e8\u5206\uff0c\u5f88\u591a\u4ee3\u7801\u7ec6\u8282\u6ca1\u6709\u8d34\u51fa\u6765\uff0c\u5982\u679c\u4f60\u60f3\u5b8c\u6574\u7684\u770b\u5230\u51fd\u6570\u7684\u6240\u6709\u4ee3\u7801\uff0c\u90a3\u5c31\u5f97\u770b\u5185\u6838\u4ee3\u7801\u4e86\u3002</p> <p>\u8fd9\u91cc\u63a8\u8350\u4e2a\u770b Linux \u5185\u6838\u4ee3\u7801\u7684\u5728\u7ebf\u7f51\u7ad9\uff1a</p> <p>https://elixir.bootlin.com/linux/latest/source</p> <p></p> <p>\u6211\u89c9\u5f97\u8fd8\u662f\u633a\u597d\u7528\u7684\uff0c\u5de6\u4fa7\u5404\u4e2a\u7248\u672c\u7684\u4ee3\u7801\u90fd\u6709\uff0c\u53f3\u4e0a\u89d2\u4e5f\u53ef\u4ee5\u641c\u7d22\u51fd\u6570\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u770b TCP \u6e90\u7801\u7684\u7ecf\u9a8c\u5c31\u662f\uff0c\u5148\u5728\u7f51\u4e0a\u627e\u627e\u524d\u8f88\u5199\u7684 TCP \u6e90\u7801\u5206\u6790\uff0c\u7136\u540e\u77e5\u9053\u6574\u4e2a\u51fd\u6570\u7684\u8c03\u7528\u94fe\u8def\u540e\uff0c\u5982\u679c\u60f3\u5177\u4f53\u4e86\u89e3\u67d0\u4e2a\u51fd\u6570\u7684\u5177\u4f53\u5b9e\u73b0\uff0c\u53ef\u4ee5\u5728\u6211\u8bf4\u7684\u90a3\u4e2a\u770b Linux \u5185\u6838\u4ee3\u7801\u7684\u5728\u7ebf\u7f51\u7ad9\u4e0a\u641c\u7d22\u8be5\u51fd\u6570\uff0c\u5c31\u53ef\u4ee5\u770b\u5230\u5b8c\u6574\u7684\u51fd\u6570\u7684\u5b9e\u73b0\u3002\u5982\u679c\u4e2d\u9014\u9047\u5230\u770b\u4e0d\u61c2\u7684\u4ee3\u7801\uff0c\u4e5f\u53ef\u4ee5\u5c06\u8fd9\u4e2a\u4ee3\u7801\u590d\u5236\u5230\u767e\u5ea6\u6216\u8005\u8c37\u6b4c\u641c\u7d22\uff0c\u4e00\u822c\u4e5f\u80fd\u627e\u5230\u522b\u4eba\u5206\u6790\u7684\u8fc7\u7a0b\u3002</p> <p>\u5b66\u4f1a\u4e86\u770b TCP \u6e90\u7801\u5176\u5b9e\u6709\u52a9\u4e8e\u6211\u4eec\u5206\u6790\u4e00\u4e9b\u5f02\u5e38\u95ee\u9898\uff0c\u5c31\u6bd4\u5982\u4eca\u5929\u8fd9\u9053\u7f51\u7edc\u9898\u76ee\uff0c\u5728\u7f51\u4e0a\u5176\u5b9e\u662f\u641c\u7d22\u4e0d\u51fa\u7b54\u6848\u7684\uff0c\u800c\u4e14\u6211\u4eec\u4e5f\u5f88\u96be\u7528\u5b9e\u9a8c\u7684\u65b9\u5f0f\u6765\u6a21\u62df\u3002</p> <p>\u6240\u4ee5\u8981\u60f3\u77e5\u9053\u7b54\u6848\uff0c\u53ea\u80fd\u53bb\u770b\u6e90\u7801\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/port/","title":"4.18 TCP \u548c UDP \u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e4b\u524d\u6709\u8bfb\u8005\u5728\u5b57\u8282\u9762\u8bd5\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\uff1aTCP \u548c UDP \u53ef\u4ee5\u540c\u65f6\u76d1\u542c\u76f8\u540c\u7684\u7aef\u53e3\u5417\uff1f</p> <p></p> <p>\u5173\u4e8e\u7aef\u53e3\u7684\u77e5\u8bc6\u70b9\uff0c\u8fd8\u662f\u633a\u591a\u53ef\u4ee5\u8bb2\u7684\uff0c\u6bd4\u5982\u8fd8\u53ef\u4ee5\u7275\u626f\u5230\u8fd9\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u591a\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u53ef\u4ee5\u540c\u65f6\u7ed1\u5b9a\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f</li> <li>\u91cd\u542f TCP \u670d\u52a1\u8fdb\u7a0b\u65f6\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u201cAddress in use\u201d\u7684\u62a5\u9519\u4fe1\u606f\uff1f\u53c8\u8be5\u600e\u4e48\u907f\u514d\uff1f</li> <li>\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u5417\uff1f</li> <li>\u5ba2\u6237\u7aef TCP \u8fde\u63a5 TIME_WAIT \u72b6\u6001\u8fc7\u591a\uff0c\u4f1a\u5bfc\u81f4\u7aef\u53e3\u8d44\u6e90\u8017\u5c3d\u800c\u65e0\u6cd5\u5efa\u7acb\u65b0\u7684\u8fde\u63a5\u5417\uff1f</li> </ul> <p>\u6240\u4ee5\uff0c\u8fd9\u6b21\u5c31\u8ddf\u5927\u5bb6\u76d8\u4e00\u76d8\u8fd9\u4e9b\u95ee\u9898\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/port/#tcp-udp","title":"TCP \u548c UDP \u53ef\u4ee5\u540c\u65f6\u7ed1\u5b9a\u76f8\u540c\u7684\u7aef\u53e3\u5417\uff1f","text":"<p>\u5176\u5b9e\u6211\u611f\u89c9\u8fd9\u4e2a\u95ee\u9898\u300cTCP \u548c UDP \u53ef\u4ee5\u540c\u65f6\u76d1\u542c\u76f8\u540c\u7684\u7aef\u53e3\u5417\uff1f\u300d\u8868\u8ff0\u6709\u95ee\u9898\uff0c\u8fd9\u4e2a\u95ee\u9898\u5e94\u8be5\u8868\u8ff0\u6210\u300cTCP \u548c UDP \u53ef\u4ee5\u540c\u65f6\u7ed1\u5b9a\u76f8\u540c\u7684\u7aef\u53e3\u5417\uff1f\u300d</p> <p>\u56e0\u4e3a\u300c\u76d1\u542c\u300d\u8fd9\u4e2a\u52a8\u4f5c\u662f\u5728 TCP \u670d\u52a1\u7aef\u7f51\u7edc\u7f16\u7a0b\u4e2d\u624d\u5177\u6709\u7684\uff0c\u800c UDP \u670d\u52a1\u7aef\u7f51\u7edc\u7f16\u7a0b\u4e2d\u662f\u6ca1\u6709\u300c\u76d1\u542c\u300d\u8fd9\u4e2a\u52a8\u4f5c\u7684\u3002</p> <p>TCP \u548c UDP \u670d\u52a1\u7aef\u7f51\u7edc\u76f8\u4f3c\u7684\u4e00\u4e2a\u5730\u65b9\uff0c\u5c31\u662f\u4f1a\u8c03\u7528 bind \u7ed1\u5b9a\u7aef\u53e3\u3002</p> <p>\u7ed9\u5927\u5bb6\u8d34\u4e00\u4e0b  TCP \u548c UDP \u7f51\u7edc\u7f16\u7a0b\u7684\u533a\u522b\u5c31\u77e5\u9053\u4e86\u3002</p> <p>TCP \u7f51\u7edc\u7f16\u7a0b\u5982\u4e0b\uff0c\u670d\u52a1\u7aef\u6267\u884c listen() \u7cfb\u7edf\u8c03\u7528\u5c31\u662f\u76d1\u542c\u7aef\u53e3\u7684\u52a8\u4f5c\u3002</p> <p></p> <p>UDP \u7f51\u7edc\u7f16\u7a0b\u5982\u4e0b\uff0c\u670d\u52a1\u7aef\u662f\u6ca1\u6709\u76d1\u542c\u8fd9\u4e2a\u52a8\u4f5c\u7684\uff0c\u53ea\u6709\u6267\u884c  bind()  \u7cfb\u7edf\u8c03\u7528\u6765\u7ed1\u5b9a\u7aef\u53e3\u7684\u52a8\u4f5c\u3002</p> <p></p> <p>TCP \u548c UDP \u53ef\u4ee5\u540c\u65f6\u7ed1\u5b9a\u76f8\u540c\u7684\u7aef\u53e3\u5417\uff1f</p> <p>\u7b54\u6848\uff1a\u53ef\u4ee5\u7684\u3002</p> <p>\u5728\u6570\u636e\u94fe\u8def\u5c42\u4e2d\uff0c\u901a\u8fc7 MAC \u5730\u5740\u6765\u5bfb\u627e\u5c40\u57df\u7f51\u4e2d\u7684\u4e3b\u673a\u3002\u5728\u7f51\u9645\u5c42\u4e2d\uff0c\u901a\u8fc7 IP \u5730\u5740\u6765\u5bfb\u627e\u7f51\u7edc\u4e2d\u4e92\u8fde\u7684\u4e3b\u673a\u6216\u8def\u7531\u5668\u3002\u5728\u4f20\u8f93\u5c42\u4e2d\uff0c\u9700\u8981\u901a\u8fc7\u7aef\u53e3\u8fdb\u884c\u5bfb\u5740\uff0c\u6765\u8bc6\u522b\u540c\u4e00\u8ba1\u7b97\u673a\u4e2d\u540c\u65f6\u901a\u4fe1\u7684\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u6240\u4ee5\uff0c\u4f20\u8f93\u5c42\u7684\u300c\u7aef\u53e3\u53f7\u300d\u7684\u4f5c\u7528\uff0c\u662f\u4e3a\u4e86\u533a\u5206\u540c\u4e00\u4e2a\u4e3b\u673a\u4e0a\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u636e\u5305\u3002</p> <p>\u4f20\u8f93\u5c42\u6709\u4e24\u4e2a\u4f20\u8f93\u534f\u8bae\u5206\u522b\u662f TCP \u548c UDP\uff0c\u5728\u5185\u6838\u4e2d\u662f\u4e24\u4e2a\u5b8c\u5168\u72ec\u7acb\u7684\u8f6f\u4ef6\u6a21\u5757\u3002</p> <p>\u5f53\u4e3b\u673a\u6536\u5230\u6570\u636e\u5305\u540e\uff0c\u53ef\u4ee5\u5728 IP \u5305\u5934\u7684\u300c\u534f\u8bae\u53f7\u300d\u5b57\u6bb5\u77e5\u9053\u8be5\u6570\u636e\u5305\u662f TCP/UDP\uff0c\u6240\u4ee5\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u4fe1\u606f\u786e\u5b9a\u9001\u7ed9\u54ea\u4e2a\u6a21\u5757\uff08TCP/UDP\uff09\u5904\u7406\uff0c\u9001\u7ed9 TCP/UDP \u6a21\u5757\u7684\u62a5\u6587\u6839\u636e\u300c\u7aef\u53e3\u53f7\u300d\u786e\u5b9a\u9001\u7ed9\u54ea\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5904\u7406\u3002</p> <p></p> <p>\u56e0\u6b64\uff0cTCP/UDP \u5404\u81ea\u7684\u7aef\u53e3\u53f7\u4e5f\u76f8\u4e92\u72ec\u7acb\uff0c\u5982 TCP \u6709\u4e00\u4e2a 80 \u53f7\u7aef\u53e3\uff0cUDP \u4e5f\u53ef\u4ee5\u6709\u4e00\u4e2a 80 \u53f7\u7aef\u53e3\uff0c\u4e8c\u8005\u5e76\u4e0d\u51b2\u7a81\u3002</p> <p>\u9a8c\u8bc1\u7ed3\u679c</p> <p>\u6211\u7b80\u5355\u5199\u4e86 TCP \u548c UDP \u670d\u52a1\u7aef\u7684\u7a0b\u5e8f\uff0c\u5b83\u4eec\u90fd\u7ed1\u5b9a\u540c\u4e00\u4e2a\u7aef\u53e3\u53f7 8888\u3002</p> <p></p> <p>\u8fd0\u884c\u8fd9\u4e24\u4e2a\u7a0b\u5e8f\u540e\uff0c\u901a\u8fc7 netstat \u547d\u4ee4\u53ef\u4ee5\u770b\u5230\uff0cTCP \u548c UDP \u662f\u53ef\u4ee5\u540c\u65f6\u7ed1\u5b9a\u540c\u4e00\u4e2a\u7aef\u53e3\u53f7\u7684\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/port/#tcp","title":"\u591a\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u53ef\u4ee5\u7ed1\u5b9a\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f","text":"<p>\u8fd8\u662f\u4ee5\u524d\u9762\u7684 TCP \u670d\u52a1\u7aef\u7a0b\u5e8f\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u542f\u52a8\u4e24\u4e2a\u540c\u65f6\u7ed1\u5b9a\u540c\u4e00\u4e2a\u7aef\u53e3\u7684 TCP \u670d\u52a1\u8fdb\u7a0b\u3002</p> <p>\u8fd0\u884c\u7b2c\u4e00\u4e2a  TCP \u670d\u52a1\u8fdb\u7a0b\u4e4b\u540e\uff0cnetstat \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\uff0c8888 \u7aef\u53e3\u5df2\u7ecf\u88ab\u4e00\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u7ed1\u5b9a\u5e76\u76d1\u542c\u4e86\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u8fd0\u884c\u7b2c\u4e8c\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u5c31\u62a5\u9519\u4e86\u201cAddress already in use\u201d\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6211\u4e0a\u9762\u7684\u6d4b\u8bd5\u6848\u4f8b\u662f\u4e24\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u540c\u65f6\u7ed1\u5b9a\u5730\u5740\u548c\u7aef\u53e3\u662f\uff1a0.0.0.0 \u5730\u5740\u548c 8888 \u7aef\u53e3\uff0c\u6240\u4ee5\u624d\u51fa\u73b0\u7684\u9519\u8bef\u3002</p> <p>\u5982\u679c\u4e24\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u7ed1\u5b9a\u7684 IP \u5730\u5740\u4e0d\u540c\uff0c\u800c\u7aef\u53e3\u76f8\u540c\u7684\u8bdd\uff0c\u4e5f\u662f\u53ef\u4ee5\u7ed1\u5b9a\u6210\u529f\u7684\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u9488\u5bf9\u300c\u591a\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u53ef\u4ee5\u7ed1\u5b9a\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f\u300d\u8fd9\u4e2a\u95ee\u9898\u7684\u7b54\u6848\u662f\uff1a\u5982\u679c\u4e24\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u540c\u65f6\u7ed1\u5b9a\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u90fd\u76f8\u540c\uff0c\u90a3\u4e48\u6267\u884c bind() \u65f6\u5019\u5c31\u4f1a\u51fa\u9519\uff0c\u9519\u8bef\u662f\u201cAddress already in use\u201d\u3002</p> <p>\u6ce8\u610f\uff0c\u5982\u679c TCP \u670d\u52a1\u8fdb\u7a0b A \u7ed1\u5b9a\u7684\u5730\u5740\u662f  0.0.0.0 \u548c\u7aef\u53e3 8888\uff0c\u800c\u5982\u679c TCP \u670d\u52a1\u8fdb\u7a0b B \u7ed1\u5b9a\u7684\u5730\u5740\u662f 192.168.1.100 \u5730\u5740\uff08\u6216\u8005\u5176\u4ed6\u5730\u5740\uff09\u548c\u7aef\u53e3 8888\uff0c\u90a3\u4e48\u6267\u884c bind() \u65f6\u5019\u4e5f\u4f1a\u51fa\u9519\u3002</p> <p>\u8fd9\u662f\u56e0\u4e3a 0.0.0.0  \u5730\u5740\u6bd4\u8f83\u7279\u6b8a\uff0c\u4ee3\u8868\u4efb\u610f\u5730\u5740\uff0c\u610f\u5473\u7740\u7ed1\u5b9a\u4e86 0.0.0.0  \u5730\u5740\uff0c\u76f8\u5f53\u4e8e\u628a\u4e3b\u673a\u4e0a\u7684\u6240\u6709 IP \u5730\u5740\u90fd\u7ed1\u5b9a\u4e86\u3002</p> <p>::: tip</p> <p>\u5982\u679c\u60f3\u591a\u4e2a\u8fdb\u7a0b\u7ed1\u5b9a\u76f8\u540c\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u4e5f\u662f\u6709\u529e\u6cd5\u7684\uff0c\u5c31\u662f\u5bf9 socket \u8bbe\u7f6e SO_REUSEPORT \u5c5e\u6027\uff08\u5185\u6838 3.9 \u7248\u672c\u63d0\u4f9b\u7684\u65b0\u7279\u6027\uff09\uff0c\u672c\u6587\u4e0d\u5bf9 SO_REUSEPORT \u505a\u5177\u4f53\u4ecb\u7ecd\uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u81ea\u884c\u53bb\u5b66\u4e60\u3002</p> <p>:::</p> <p>\u91cd\u542f TCP \u670d\u52a1\u8fdb\u7a0b\u65f6\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u6709\u201cAddress in use\u201d\u7684\u62a5\u9519\u4fe1\u606f\uff1f</p> <p>TCP \u670d\u52a1\u8fdb\u7a0b\u9700\u8981\u7ed1\u5b9a\u4e00\u4e2a IP \u5730\u5740\u548c\u4e00\u4e2a\u7aef\u53e3\uff0c\u7136\u540e\u5c31\u76d1\u542c\u5728\u8fd9\u4e2a\u5730\u5740\u548c\u7aef\u53e3\u4e0a\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u5230\u6765\u3002</p> <p>\u7136\u540e\u5728\u5b9e\u8df5\u4e2d\uff0c\u6211\u4eec\u53ef\u80fd\u4f1a\u7ecf\u5e38\u78b0\u5230\u4e00\u4e2a\u95ee\u9898\uff0c\u5f53 TCP \u670d\u52a1\u8fdb\u7a0b\u91cd\u542f\u4e4b\u540e\uff0c\u603b\u662f\u78b0\u5230\u201cAddress in use\u201d\u7684\u62a5\u9519\u4fe1\u606f\uff0cTCP \u670d\u52a1\u8fdb\u7a0b\u4e0d\u80fd\u5f88\u5feb\u5730\u91cd\u542f\uff0c\u800c\u662f\u8981\u8fc7\u4e00\u4f1a\u624d\u80fd\u91cd\u542f\u6210\u529f\u3002</p> <p>\u8fd9\u662f\u4e3a\u4ec0\u4e48\u5462\uff1f</p> <p>\u5f53\u6211\u4eec\u91cd\u542f TCP \u670d\u52a1\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u610f\u5473\u7740\u901a\u8fc7\u670d\u52a1\u5668\u7aef\u53d1\u8d77\u4e86\u5173\u95ed\u8fde\u63a5\u64cd\u4f5c\uff0c\u4e8e\u662f\u5c31\u4f1a\u7ecf\u8fc7\u56db\u6b21\u6325\u624b\uff0c\u800c\u5bf9\u4e8e\u4e3b\u52a8\u5173\u95ed\u65b9\uff0c\u4f1a\u5728 TIME_WAIT \u8fd9\u4e2a\u72b6\u6001\u91cc\u505c\u7559\u4e00\u6bb5\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u95f4\u5927\u7ea6\u4e3a 2MSL\u3002</p> <p></p> <p>\u5f53 TCP \u670d\u52a1\u8fdb\u7a0b\u91cd\u542f\u65f6\uff0c\u670d\u52a1\u7aef\u4f1a\u51fa\u73b0 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0cTIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u4f7f\u7528\u7684 IP+PORT \u4ecd\u7136\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6709\u6548\u7684 IP+PORT \u7ec4\u5408\uff0c\u76f8\u540c\u673a\u5668\u4e0a\u4e0d\u80fd\u591f\u5728\u8be5 IP+PORT \u7ec4\u5408\u4e0a\u8fdb\u884c\u7ed1\u5b9a\uff0c\u90a3\u4e48\u6267\u884c bind() \u51fd\u6570\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8fd4\u56de\u4e86 Address already in use \u7684\u9519\u8bef\u3002</p> <p>\u800c\u7b49 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u7ed3\u675f\u540e\uff0c\u91cd\u542f TCP \u670d\u52a1\u8fdb\u7a0b\u5c31\u80fd\u6210\u529f\u3002</p> <p>\u91cd\u542f TCP \u670d\u52a1\u8fdb\u7a0b\u65f6\uff0c\u5982\u4f55\u907f\u514d\u201cAddress in use\u201d\u7684\u62a5\u9519\u4fe1\u606f\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u8c03\u7528 bind \u524d\uff0c\u5bf9 socket \u8bbe\u7f6e SO_REUSEADDR \u5c5e\u6027\uff0c\u53ef\u4ee5\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u3002</p> C<pre><code>int on = 1;\nsetsockopt(listenfd, SOL_SOCKET, SO_REUSEADDR, &amp;on, sizeof(on));\n</code></pre> <p>\u56e0\u4e3a SO_REUSEADDR \u4f5c\u7528\u662f\uff1a\u5982\u679c\u5f53\u524d\u542f\u52a8\u8fdb\u7a0b\u7ed1\u5b9a\u7684 IP+PORT \u4e0e\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u5360\u7528\u7684 IP+PORT \u5b58\u5728\u51b2\u7a81\uff0c\u4f46\u662f\u65b0\u542f\u52a8\u7684\u8fdb\u7a0b\u4f7f\u7528\u4e86 SO_REUSEADDR \u9009\u9879\uff0c\u90a3\u4e48\u8be5\u8fdb\u7a0b\u5c31\u53ef\u4ee5\u7ed1\u5b9a\u6210\u529f\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u670d\u52a1\u7aef\u6709\u4e2a\u76d1\u542c 0.0.0.0 \u5730\u5740\u548c 8888 \u7aef\u53e3\u7684 TCP \u670d\u52a1\u8fdb\u7a0b\u3002\u200d</p> <p></p> <p>\u6709\u4e2a\u5ba2\u6237\u7aef\uff08IP \u5730\u5740\uff1a192.168.1.100\uff09\u5df2\u7ecf\u548c\u670d\u52a1\u7aef\uff08IP \u5730\u5740\uff1a172.19.11.200\uff09\u5efa\u7acb\u4e86 TCP \u8fde\u63a5\uff0c\u90a3\u4e48\u5728 TCP \u670d\u52a1\u8fdb\u7a0b\u91cd\u542f\u65f6\uff0c\u670d\u52a1\u7aef\u4f1a\u4e0e\u5ba2\u6237\u7aef\u7ecf\u5386\u56db\u6b21\u6325\u624b\uff0c\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u4f1a\u77ed\u6682\u5904\u4e8e TIME_WAIT \u72b6\u6001\uff1a</p> Bash<pre><code>\u5ba2\u6237\u7aef\u5730\u5740:\u7aef\u53e3           \u670d\u52a1\u7aef\u5730\u5740:\u7aef\u53e3        TCP \u8fde\u63a5\u72b6\u6001\n192.168.1.100:37272     172.19.11.200:8888    TIME_WAI\n</code></pre> <p>\u5982\u679c TCP \u670d\u52a1\u8fdb\u7a0b\u6ca1\u6709\u5bf9 socket \u8bbe\u7f6e SO_REUSEADDR \u5c5e\u6027\uff0c\u90a3\u4e48\u5728\u91cd\u542f\u65f6\uff0c\u7531\u4e8e\u5b58\u5728\u4e00\u4e2a\u548c\u7ed1\u5b9a IP+PORT \u4e00\u6837\u7684 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u90a3\u4e48\u5728\u6267\u884c bind() \u51fd\u6570\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8fd4\u56de\u4e86 Address already in use \u7684\u9519\u8bef\u3002</p> <p>\u5982\u679c TCP \u670d\u52a1\u8fdb\u7a0b\u5bf9 socket \u8bbe\u7f6e SO_REUSEADDR \u5c5e\u6027\u4e86\uff0c\u90a3\u4e48\u5728\u91cd\u542f\u65f6\uff0c\u5373\u4f7f\u5b58\u5728\u4e00\u4e2a\u548c\u7ed1\u5b9a IP+PORT \u4e00\u6837\u7684 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u4f9d\u7136\u53ef\u4ee5\u6b63\u5e38\u7ed1\u5b9a\u6210\u529f\uff0c\u56e0\u6b64\u53ef\u4ee5\u6b63\u5e38\u91cd\u542f\u6210\u529f\u3002</p> <p>\u56e0\u6b64\uff0c\u5728\u6240\u6709 TCP \u670d\u52a1\u5668\u7a0b\u5e8f\u4e2d\uff0c\u8c03\u7528 bind \u4e4b\u524d\u6700\u597d\u5bf9 socket \u8bbe\u7f6e SO_REUSEADDR \u5c5e\u6027\uff0c\u8fd9\u4e0d\u4f1a\u4ea7\u751f\u5371\u5bb3\uff0c\u76f8\u53cd\uff0c\u5b83\u4f1a\u5e2e\u52a9\u6211\u4eec\u5728\u5f88\u5feb\u65f6\u95f4\u5185\u91cd\u542f\u670d\u52a1\u7aef\u7a0b\u5e8f\u3002\u200d</p> <p>\u524d\u9762\u6211\u63d0\u5230\u8fc7\u8fd9\u4e2a\u95ee\u9898\uff1a\u5982\u679c TCP \u670d\u52a1\u8fdb\u7a0b A \u7ed1\u5b9a\u7684\u5730\u5740\u662f  0.0.0.0 \u548c\u7aef\u53e3 8888\uff0c\u800c\u5982\u679c TCP \u670d\u52a1\u8fdb\u7a0b B \u7ed1\u5b9a\u7684\u5730\u5740\u662f 192.168.1.100 \u5730\u5740\uff08\u6216\u8005\u5176\u4ed6\u5730\u5740\uff09\u548c\u7aef\u53e3 8888\uff0c\u90a3\u4e48\u6267\u884c bind() \u65f6\u5019\u4e5f\u4f1a\u51fa\u9519\u3002</p> <p>\u8fd9\u4e2a\u95ee\u9898\u4e5f\u53ef\u4ee5\u7531 SO_REUSEADDR \u89e3\u51b3\uff0c\u56e0\u4e3a\u5b83\u7684\u53e6\u5916\u4e00\u4e2a\u4f5c\u7528\uff1a\u7ed1\u5b9a\u7684 IP \u5730\u5740 + \u7aef\u53e3\u65f6\uff0c\u53ea\u8981 IP \u5730\u5740\u4e0d\u662f\u6b63\u597d (exactly) \u76f8\u540c\uff0c\u90a3\u4e48\u5141\u8bb8\u7ed1\u5b9a\u3002</p> <p>\u6bd4\u5982\uff0c0.0.0.0:8888 \u548c 192.168.1.100:8888\uff0c\u867d\u7136\u903b\u8f91\u610f\u4e49\u4e0a\u524d\u8005\u5305\u542b\u4e86\u540e\u8005\uff0c\u4f46\u662f 0.0.0.0 \u6cdb\u6307\u6240\u6709\u672c\u5730 IP\uff0c\u800c 192.168.1.100 \u7279\u6307\u67d0\u4e00 IP\uff0c\u4e24\u8005\u5e76\u4e0d\u662f\u5b8c\u5168\u76f8\u540c\uff0c\u6240\u4ee5\u5728\u5bf9 socket \u8bbe\u7f6e SO_REUSEADDR \u5c5e\u6027\u540e\uff0c\u90a3\u4e48\u6267\u884c bind() \u65f6\u5019\u5c31\u4f1a\u7ed1\u5b9a\u6210\u529f\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/port/#_1","title":"\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u5417\uff1f","text":"<p>\u5ba2\u6237\u7aef\u5728\u6267\u884c connect \u51fd\u6570\u7684\u65f6\u5019\uff0c\u4f1a\u5728\u5185\u6838\u91cc\u968f\u673a\u9009\u62e9\u4e00\u4e2a\u7aef\u53e3\uff0c\u7136\u540e\u5411\u670d\u52a1\u7aef\u53d1\u8d77 SYN \u62a5\u6587\uff0c\u7136\u540e\u4e0e\u670d\u52a1\u7aef\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u9009\u62e9\u7684\u53d1\u751f\u5728 connect \u51fd\u6570\uff0c\u5185\u6838\u5728\u9009\u62e9\u7aef\u53e3\u7684\u65f6\u5019\uff0c\u4f1a\u4ece <code>net.ipv4.ip_local_port_range</code> \u8fd9\u4e2a\u5185\u6838\u53c2\u6570\u6307\u5b9a\u7684\u8303\u56f4\u6765\u9009\u53d6\u4e00\u4e2a\u7aef\u53e3\u4f5c\u4e3a\u5ba2\u6237\u7aef\u7aef\u53e3\u3002</p> <p>\u8be5\u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u662f 32768 61000\uff0c\u610f\u5473\u7740\u7aef\u53e3\u603b\u53ef\u7528\u7684\u6570\u91cf\u662f 61000 - 32768 = 28232 \u4e2a\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u5b8c\u6210 TCP \u8fde\u63a5\u5efa\u7acb\u540e\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 netstat \u547d\u4ee4\u67e5\u770b TCP \u8fde\u63a5\u3002</p> Bash<pre><code>$ netstat -napt\n\u534f\u8bae  \u6e90ip\u5730\u5740:\u7aef\u53e3            \u76ee\u7684ip\u5730\u5740\uff1a\u7aef\u53e3         \u72b6\u6001\ntcp  192.168.110.182.64992   117.147.199.51.443     ESTABLISHED\n</code></pre> <p>\u90a3\u95ee\u9898\u6765\u4e86\uff0c\u4e0a\u9762\u5ba2\u6237\u7aef\u5df2\u7ecf\u7528\u4e86 64992 \u7aef\u53e3\uff0c\u90a3\u4e48\u8fd8\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\u8be5\u7aef\u53e3\u53d1\u8d77\u8fde\u63a5\u5417\uff1f</p> <p>\u8fd9\u4e2a\u95ee\u9898\uff0c\u5f88\u591a\u540c\u5b66\u90fd\u4f1a\u8bf4\u4e0d\u53ef\u4ee5\u7ee7\u7eed\u4f7f\u7528\u8be5\u7aef\u53e3\u4e86\uff0c\u5982\u679c\u6309\u8fd9\u4e2a\u7406\u89e3\u7684\u8bdd\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u5ba2\u6237\u7aef\u53ef\u4ee5\u9009\u62e9\u7684\u7aef\u53e3\u662f 28232 \u4e2a\uff0c\u90a3\u4e48\u610f\u5473\u7740\u5ba2\u6237\u7aef\u53ea\u80fd\u6700\u591a\u5efa\u7acb  28232 \u4e2a TCP \u8fde\u63a5\uff0c\u5982\u679c\u771f\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5ba2\u6237\u7aef\u5e76\u53d1\u8fde\u63a5\u4e5f\u592a\u5c11\u4e86\u5427\uff0c\u6240\u4ee5\u8fd9\u662f\u9519\u8bef\u7406\u89e3\u3002</p> <p>\u6b63\u786e\u7684\u7406\u89e3\u662f\uff0cTCP \u8fde\u63a5\u662f\u7531\u56db\u5143\u7ec4\uff08\u6e90 IP \u5730\u5740\uff0c\u6e90\u7aef\u53e3\uff0c\u76ee\u7684 IP \u5730\u5740\uff0c\u76ee\u7684\u7aef\u53e3\uff09\u552f\u4e00\u786e\u8ba4\u7684\uff0c\u90a3\u4e48\u53ea\u8981\u56db\u5143\u7ec4\u4e2d\u5176\u4e2d\u4e00\u4e2a\u5143\u7d20\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u90a3\u4e48\u5c31\u8868\u793a\u4e0d\u540c\u7684 TCP \u8fde\u63a5\u7684\u3002\u6240\u4ee5\u5982\u679c\u5ba2\u6237\u7aef\u5df2\u4f7f\u7528\u7aef\u53e3 64992 \u4e0e\u670d\u52a1\u7aef A \u5efa\u7acb\u4e86\u8fde\u63a5\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u8981\u4e0e\u670d\u52a1\u7aef B \u5efa\u7acb\u8fde\u63a5\uff0c\u8fd8\u662f\u53ef\u4ee5\u4f7f\u7528\u7aef\u53e3 64992 \u7684\uff0c\u56e0\u4e3a\u5185\u6838\u662f\u901a\u8fc7\u56db\u5143\u7ec4\u4fe1\u606f\u6765\u5b9a\u4f4d\u4e00\u4e2a TCP \u8fde\u63a5\u7684\uff0c\u5e76\u4e0d\u4f1a\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u53f7\u76f8\u540c\uff0c\u800c\u5bfc\u81f4\u8fde\u63a5\u51b2\u7a81\u7684\u95ee\u9898\u3002</p> <p>\u6bd4\u5982\u4e0b\u9762\u8fd9\u5f20\u56fe\uff0c\u6709 2 \u4e2a TCP \u8fde\u63a5\uff0c\u5de6\u8fb9\u662f\u5ba2\u6237\u7aef\uff0c\u53f3\u8fb9\u662f\u670d\u52a1\u7aef\uff0c\u5ba2\u6237\u7aef\u4f7f\u7528\u4e86\u76f8\u540c\u7684\u7aef\u53e3 50004 \u4e0e\u4e24\u4e2a\u670d\u52a1\u7aef\u5efa\u7acb\u4e86 TCP \u8fde\u63a5\u3002</p> <p></p> <p>\u4ed4\u7ec6\u770b\uff0c\u4e0a\u9762\u8fd9\u4e24\u6761 TCP \u8fde\u63a5\u7684\u56db\u5143\u7ec4\u4fe1\u606f\u4e2d\u7684\u300c\u76ee\u7684 IP \u5730\u5740\u300d\u662f\u4e0d\u540c\u7684\uff0c\u4e00\u4e2a\u662f 180.101.49.12\uff0c\u53e6\u5916\u4e00\u4e2a\u662f 180.101.49.11\u3002</p> <p>\u591a\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5 bind \u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f</p> <p>bind \u51fd\u6570\u867d\u7136\u5e38\u7528\u4e8e\u670d\u52a1\u7aef\u7f51\u7edc\u7f16\u7a0b\u4e2d\uff0c\u4f46\u662f\u5b83\u4e5f\u662f\u7528\u4e8e\u5ba2\u6237\u7aef\u7684\u3002</p> <p>\u524d\u9762\u6211\u4eec\u77e5\u9053\uff0c\u5ba2\u6237\u7aef\u662f\u5728\u8c03\u7528 connect \u51fd\u6570\u7684\u65f6\u5019\uff0c\u7531\u5185\u6838\u968f\u673a\u9009\u53d6\u4e00\u4e2a\u7aef\u53e3\u4f5c\u4e3a\u8fde\u63a5\u7684\u7aef\u53e3\u3002</p> <p>\u800c\u5982\u679c\u6211\u4eec\u60f3\u81ea\u5df1\u6307\u5b9a\u8fde\u63a5\u7684\u7aef\u53e3\uff0c\u5c31\u53ef\u4ee5\u7528 bind \u51fd\u6570\u6765\u5b9e\u73b0\uff1a\u5ba2\u6237\u7aef\u5148\u901a\u8fc7 bind \u51fd\u6570\u7ed1\u5b9a\u4e00\u4e2a\u7aef\u53e3\uff0c\u7136\u540e\u8c03\u7528 connect \u51fd\u6570\u5c31\u4f1a\u8df3\u8fc7\u7aef\u53e3\u9009\u62e9\u7684\u8fc7\u7a0b\u4e86\uff0c\u8f6c\u800c\u4f7f\u7528 bind \u65f6\u786e\u5b9a\u7684\u7aef\u53e3\u3002</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff1a\u591a\u4e2a\u5ba2\u6237\u7aef\u53ef\u4ee5 bind \u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f</p> <p>\u8981\u770b\u591a\u4e2a\u5ba2\u6237\u7aef\u7ed1\u5b9a\u7684 IP + PORT \u662f\u5426\u90fd\u76f8\u540c\uff0c\u5982\u679c\u90fd\u662f\u76f8\u540c\u7684\uff0c\u90a3\u4e48\u5728\u6267\u884c bind() \u65f6\u5019\u5c31\u4f1a\u51fa\u9519\uff0c\u9519\u8bef\u662f\u201cAddress already in use\u201d\u3002</p> <p>\u5982\u679c\u4e00\u4e2a\u7ed1\u5b9a\u5728 192.168.1.100:6666\uff0c\u4e00\u4e2a\u7ed1\u5b9a\u5728 192.168.1.200:6666\uff0c\u56e0\u4e3a IP \u4e0d\u76f8\u540c\uff0c\u6240\u4ee5\u6267\u884c bind() \u7684\u65f6\u5019\uff0c\u80fd\u6b63\u5e38\u7ed1\u5b9a\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u591a\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u7ed1\u5b9a\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u90fd\u662f\u76f8\u540c\u7684\uff0c\u90a3\u4e48\u6267\u884c bind() \u65f6\u5019\u5c31\u4f1a\u51fa\u9519\uff0c\u9519\u8bef\u662f\u201cAddress already in use\u201d\u3002</p> <p>\u4e00\u822c\u800c\u8a00\uff0c\u5ba2\u6237\u7aef\u4e0d\u5efa\u8bae\u4f7f\u7528 bind \u51fd\u6570\uff0c\u5e94\u8be5\u4ea4\u7531 connect \u51fd\u6570\u6765\u9009\u62e9\u7aef\u53e3\u4f1a\u6bd4\u8f83\u597d\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u901a\u5e38\u90fd\u6ca1\u4ec0\u4e48\u610f\u4e49\u3002</p> <p>\u5ba2\u6237\u7aef TCP \u8fde\u63a5 TIME_WAIT \u72b6\u6001\u8fc7\u591a\uff0c\u4f1a\u5bfc\u81f4\u7aef\u53e3\u8d44\u6e90\u8017\u5c3d\u800c\u65e0\u6cd5\u5efa\u7acb\u65b0\u7684\u8fde\u63a5\u5417\uff1f</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\u8981\u770b\uff0c\u5ba2\u6237\u7aef\u662f\u5426\u90fd\u662f\u4e0e\u540c\u4e00\u4e2a\u670d\u52a1\u5668\uff08\u76ee\u6807\u5730\u5740\u548c\u76ee\u6807\u7aef\u53e3\u4e00\u6837\uff09\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u90fd\u662f\u4e0e\u540c\u4e00\u4e2a\u670d\u52a1\u5668\uff08\u76ee\u6807\u5730\u5740\u548c\u76ee\u6807\u7aef\u53e3\u4e00\u6837\uff09\u5efa\u7acb\u8fde\u63a5\uff0c\u90a3\u4e48\u5982\u679c\u5ba2\u6237\u7aef TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u8fc7\u591a\uff0c\u5f53\u7aef\u53e3\u8d44\u6e90\u88ab\u8017\u5c3d\uff0c\u5c31\u65e0\u6cd5\u4e0e\u8fd9\u4e2a\u670d\u52a1\u5668\u518d\u5efa\u7acb\u8fde\u63a5\u4e86\u3002</p> <p>\u4f46\u662f\uff0c\u56e0\u4e3a\u53ea\u8981\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u670d\u52a1\u5668\u4e0d\u540c\uff0c\u7aef\u53e3\u8d44\u6e90\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u90fd\u662f\u4e0e\u4e0d\u540c\u7684\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u5373\u4f7f\u5ba2\u6237\u7aef\u7aef\u53e3\u8d44\u6e90\u53ea\u6709\u51e0\u4e07\u4e2a\uff0c\u5ba2\u6237\u7aef\u53d1\u8d77\u767e\u4e07\u7ea7\u8fde\u63a5\u4e5f\u662f\u6ca1\u95ee\u9898\u7684\uff08\u5f53\u7136\u8fd9\u4e2a\u8fc7\u7a0b\u8fd8\u4f1a\u53d7\u9650\u4e8e\u5176\u4ed6\u8d44\u6e90\uff0c\u6bd4\u5982\u6587\u4ef6\u63cf\u8ff0\u7b26\u3001\u5185\u5b58\u3001CPU \u7b49\uff09\u3002</p> <p>\u5982\u4f55\u89e3\u51b3\u5ba2\u6237\u7aef TCP \u8fde\u63a5 TIME_WAIT \u8fc7\u591a\uff0c\u5bfc\u81f4\u65e0\u6cd5\u4e0e\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u95ee\u9898\uff1f</p> <p>\u524d\u9762\u6211\u4eec\u63d0\u5230\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u90fd\u662f\u4e0e\u540c\u4e00\u4e2a\u670d\u52a1\u5668\uff08\u76ee\u6807\u5730\u5740\u548c\u76ee\u6807\u7aef\u53e3\u4e00\u6837\uff09\u5efa\u7acb\u8fde\u63a5\uff0c\u90a3\u4e48\u5982\u679c\u5ba2\u6237\u7aef TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u8fc7\u591a\uff0c\u5f53\u7aef\u53e3\u8d44\u6e90\u88ab\u8017\u5c3d\uff0c\u5c31\u65e0\u6cd5\u4e0e\u8fd9\u4e2a\u670d\u52a1\u5668\u518d\u5efa\u7acb\u8fde\u63a5\u4e86\u3002</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e5f\u662f\u6709\u89e3\u51b3\u529e\u6cd5\u7684\uff0c\u90a3\u5c31\u662f\u6253\u5f00 <code>net.ipv4.tcp_tw_reuse</code> \u8fd9\u4e2a\u5185\u6838\u53c2\u6570\u3002</p> <p>\u56e0\u4e3a\u5f00\u542f\u4e86\u8fd9\u4e2a\u5185\u6838\u53c2\u6570\u540e\uff0c\u5ba2\u6237\u7aef\u8c03\u7528 connect  \u51fd\u6570\u65f6\uff0c\u5982\u679c\u9009\u62e9\u5230\u7684\u7aef\u53e3\uff0c\u5df2\u7ecf\u88ab\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u5360\u7528\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5224\u65ad\u8be5\u8fde\u63a5\u662f\u5426\u5904\u4e8e  TIME_WAIT \u72b6\u6001\uff0c\u5982\u679c\u8be5\u8fde\u63a5\u5904\u4e8e TIME_WAIT \u72b6\u6001\u5e76\u4e14 TIME_WAIT \u72b6\u6001\u6301\u7eed\u7684\u65f6\u95f4\u8d85\u8fc7\u4e86 1 \u79d2\uff0c\u90a3\u4e48\u5c31\u4f1a\u91cd\u7528\u8fd9\u4e2a\u8fde\u63a5\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u8be5\u7aef\u53e3\u4e86\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u5ba2\u6237\u7aef\u5df2\u7ecf\u4e0e\u670d\u52a1\u5668\u5efa\u7acb\u4e86\u4e00\u4e2a TCP \u8fde\u63a5\uff0c\u5e76\u4e14\u8fd9\u4e2a\u72b6\u6001\u5904\u4e8e  TIME_WAIT \u72b6\u6001\uff1a</p> Bash<pre><code>\u5ba2\u6237\u7aef\u5730\u5740:\u7aef\u53e3           \u670d\u52a1\u7aef\u5730\u5740:\u7aef\u53e3         TCP \u8fde\u63a5\u72b6\u6001\n192.168.1.100:2222      172.19.11.21:8888     TIME_WAIT\n</code></pre> <p>\u7136\u540e\u5ba2\u6237\u7aef\u53c8\u4e0e\u8be5\u670d\u52a1\u5668\uff08172.19.11.21:8888\uff09\u53d1\u8d77\u4e86\u8fde\u63a5\uff0c\u5728\u8c03\u7528 connect \u51fd\u6570\u65f6\uff0c\u5185\u6838\u521a\u597d\u9009\u62e9\u4e86 2222 \u7aef\u53e3\uff0c\u63a5\u7740\u53d1\u73b0\u5df2\u7ecf\u88ab\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u5360\u7528\u4e86\uff1a</p> <ul> <li>\u5982\u679c\u6ca1\u6709\u5f00\u542f net.ipv4.tcp_tw_reuse  \u5185\u6838\u53c2\u6570\uff0c\u90a3\u4e48\u5185\u6838\u5c31\u4f1a\u9009\u62e9\u4e0b\u4e00\u4e2a\u7aef\u53e3\uff0c\u7136\u540e\u7ee7\u7eed\u5224\u65ad\uff0c\u76f4\u5230\u627e\u5230\u4e00\u4e2a\u6ca1\u6709\u88ab\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u4f7f\u7528\u7684\u7aef\u53e3\uff0c\u5982\u679c\u7aef\u53e3\u8d44\u6e90\u8017\u5c3d\u8fd8\u662f\u6ca1\u627e\u5230\uff0c\u90a3\u4e48 connect \u51fd\u6570\u5c31\u4f1a\u8fd4\u56de\u9519\u8bef\u3002</li> <li>\u5982\u679c\u5f00\u542f\u4e86 net.ipv4.tcp_tw_reuse  \u5185\u6838\u53c2\u6570\uff0c\u5c31\u4f1a\u5224\u65ad\u8be5\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u72b6\u6001\u662f\u5426\u5904\u4e8e TIME_WAIT \u72b6\u6001\uff0c\u5982\u679c\u8fde\u63a5\u5904\u4e8e TIME_WAIT \u72b6\u6001\u5e76\u4e14\u8be5\u72b6\u6001\u6301\u7eed\u7684\u65f6\u95f4\u8d85\u8fc7\u4e86 1 \u79d2\uff0c\u90a3\u4e48\u5c31\u4f1a\u91cd\u7528\u8be5\u8fde\u63a5\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u4f7f\u7528 2222 \u7aef\u53e3\u4e86\uff0c\u8fd9\u65f6 connect \u5c31\u4f1a\u8fd4\u56de\u6210\u529f\u3002</li> </ul> <p>\u518d\u6b21\u63d0\u9192\u4e00\u6b21\uff0c\u5f00\u542f\u4e86 net.ipv4.tcp_tw_reuse  \u5185\u6838\u53c2\u6570\uff0c\u662f\u5ba2\u6237\u7aef\uff08\u8fde\u63a5\u53d1\u8d77\u65b9\uff09\u5728\u8c03\u7528 connect() \u51fd\u6570\u65f6\u624d\u8d77\u4f5c\u7528\uff0c\u6240\u4ee5\u5728\u670d\u52a1\u7aef\u5f00\u542f\u8fd9\u4e2a\u53c2\u6570\u662f\u6ca1\u6709\u6548\u679c\u7684\u3002</p> <p>\u5ba2\u6237\u7aef\u7aef\u53e3\u9009\u62e9\u7684\u6d41\u7a0b\u603b\u7ed3</p> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u5df2\u7ecf\u628a\u5ba2\u6237\u7aef\u5728\u6267\u884c connect \u51fd\u6570\u65f6\uff0c\u5185\u6838\u9009\u62e9\u7aef\u53e3\u7684\u60c5\u51b5\u5927\u81f4\u8bf4\u4e86\u4e00\u904d\uff0c\u4e3a\u4e86\u8ba9\u5927\u5bb6\u66f4\u660e\u767d\u5ba2\u6237\u7aef\u7aef\u53e3\u7684\u9009\u62e9\u8fc7\u7a0b\uff0c\u6211\u753b\u4e86\u4e00\u6d41\u7a0b\u56fe\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/port/#_2","title":"\u603b\u7ed3","text":"<p>TCP \u548c UDP \u53ef\u4ee5\u540c\u65f6\u7ed1\u5b9a\u76f8\u540c\u7684\u7aef\u53e3\u5417\uff1f</p> <p>\u53ef\u4ee5\u7684\u3002</p> <p>TCP \u548c UDP \u4f20\u8f93\u534f\u8bae\uff0c\u5728\u5185\u6838\u4e2d\u662f\u7531\u4e24\u4e2a\u5b8c\u5168\u72ec\u7acb\u7684\u8f6f\u4ef6\u6a21\u5757\u5b9e\u73b0\u7684\u3002</p> <p>\u5f53\u4e3b\u673a\u6536\u5230\u6570\u636e\u5305\u540e\uff0c\u53ef\u4ee5\u5728 IP \u5305\u5934\u7684\u300c\u534f\u8bae\u53f7\u300d\u5b57\u6bb5\u77e5\u9053\u8be5\u6570\u636e\u5305\u662f TCP/UDP\uff0c\u6240\u4ee5\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u4fe1\u606f\u786e\u5b9a\u9001\u7ed9\u54ea\u4e2a\u6a21\u5757\uff08TCP/UDP\uff09\u5904\u7406\uff0c\u9001\u7ed9 TCP/UDP \u6a21\u5757\u7684\u62a5\u6587\u6839\u636e\u300c\u7aef\u53e3\u53f7\u300d\u786e\u5b9a\u9001\u7ed9\u54ea\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5904\u7406\u3002</p> <p>\u56e0\u6b64\uff0cTCP/UDP \u5404\u81ea\u7684\u7aef\u53e3\u53f7\u4e5f\u76f8\u4e92\u72ec\u7acb\uff0c\u4e92\u4e0d\u5f71\u54cd\u3002</p> <p>\u591a\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u53ef\u4ee5\u540c\u65f6\u7ed1\u5b9a\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f</p> <p>\u5982\u679c\u4e24\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u540c\u65f6\u7ed1\u5b9a\u7684 IP \u5730\u5740\u548c\u7aef\u53e3\u90fd\u76f8\u540c\uff0c\u90a3\u4e48\u6267\u884c bind() \u65f6\u5019\u5c31\u4f1a\u51fa\u9519\uff0c\u9519\u8bef\u662f\u201cAddress already in use\u201d\u3002</p> <p>\u5982\u679c\u4e24\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u7ed1\u5b9a\u7684\u7aef\u53e3\u90fd\u76f8\u540c\uff0c\u800c IP \u5730\u5740\u4e0d\u540c\uff0c\u90a3\u4e48\u6267\u884c bind() \u4e0d\u4f1a\u51fa\u9519\u3002</p> <p>\u5982\u4f55\u89e3\u51b3\u670d\u52a1\u7aef\u91cd\u542f\u65f6\uff0c\u62a5\u9519\u201cAddress already in use\u201d\u7684\u95ee\u9898\uff1f</p> <p>\u5f53\u6211\u4eec\u91cd\u542f TCP \u670d\u52a1\u8fdb\u7a0b\u7684\u65f6\u5019\uff0c\u610f\u5473\u7740\u901a\u8fc7\u670d\u52a1\u5668\u7aef\u53d1\u8d77\u4e86\u5173\u95ed\u8fde\u63a5\u64cd\u4f5c\uff0c\u4e8e\u662f\u5c31\u4f1a\u7ecf\u8fc7\u56db\u6b21\u6325\u624b\uff0c\u800c\u5bf9\u4e8e\u4e3b\u52a8\u5173\u95ed\u65b9\uff0c\u4f1a\u5728 TIME_WAIT \u8fd9\u4e2a\u72b6\u6001\u91cc\u505c\u7559\u4e00\u6bb5\u65f6\u95f4\uff0c\u8fd9\u4e2a\u65f6\u95f4\u5927\u7ea6\u4e3a 2MSL\u3002</p> <p>\u5f53 TCP \u670d\u52a1\u8fdb\u7a0b\u91cd\u542f\u65f6\uff0c\u670d\u52a1\u7aef\u4f1a\u51fa\u73b0 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0cTIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u4f7f\u7528\u7684 IP+PORT \u4ecd\u7136\u88ab\u8ba4\u4e3a\u662f\u4e00\u4e2a\u6709\u6548\u7684 IP+PORT \u7ec4\u5408\uff0c\u76f8\u540c\u673a\u5668\u4e0a\u4e0d\u80fd\u591f\u5728\u8be5 IP+PORT \u7ec4\u5408\u4e0a\u8fdb\u884c\u7ed1\u5b9a\uff0c\u90a3\u4e48\u6267\u884c bind() \u51fd\u6570\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8fd4\u56de\u4e86 Address already in use \u7684\u9519\u8bef\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u5bf9 socket \u8bbe\u7f6e SO_REUSEADDR \u5c5e\u6027\u3002</p> <p>\u8fd9\u6837\u5373\u4f7f\u5b58\u5728\u4e00\u4e2a\u548c\u7ed1\u5b9a IP+PORT \u4e00\u6837\u7684 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u4f9d\u7136\u53ef\u4ee5\u6b63\u5e38\u7ed1\u5b9a\u6210\u529f\uff0c\u56e0\u6b64\u53ef\u4ee5\u6b63\u5e38\u91cd\u542f\u6210\u529f\u3002</p> <p>\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u5417\uff1f</p> <p>\u5728\u5ba2\u6237\u7aef\u6267\u884c connect \u51fd\u6570\u7684\u65f6\u5019\uff0c\u53ea\u8981\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u670d\u52a1\u5668\u4e0d\u662f\u540c\u4e00\u4e2a\uff0c\u5185\u6838\u5141\u8bb8\u7aef\u53e3\u91cd\u590d\u4f7f\u7528\u3002</p> <p>TCP \u8fde\u63a5\u662f\u7531\u56db\u5143\u7ec4\uff08\u6e90 IP \u5730\u5740\uff0c\u6e90\u7aef\u53e3\uff0c\u76ee\u7684 IP \u5730\u5740\uff0c\u76ee\u7684\u7aef\u53e3\uff09\u552f\u4e00\u786e\u8ba4\u7684\uff0c\u90a3\u4e48\u53ea\u8981\u56db\u5143\u7ec4\u4e2d\u5176\u4e2d\u4e00\u4e2a\u5143\u7d20\u53d1\u751f\u4e86\u53d8\u5316\uff0c\u90a3\u4e48\u5c31\u8868\u793a\u4e0d\u540c\u7684 TCP \u8fde\u63a5\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5df2\u4f7f\u7528\u7aef\u53e3 64992 \u4e0e\u670d\u52a1\u7aef A \u5efa\u7acb\u4e86\u8fde\u63a5\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u8981\u4e0e\u670d\u52a1\u7aef B \u5efa\u7acb\u8fde\u63a5\uff0c\u8fd8\u662f\u53ef\u4ee5\u4f7f\u7528\u7aef\u53e3 64992 \u7684\uff0c\u56e0\u4e3a\u5185\u6838\u662f\u901a\u8fc7\u56db\u5143\u7ec4\u4fe1\u606f\u6765\u5b9a\u4f4d\u4e00\u4e2a TCP \u8fde\u63a5\u7684\uff0c\u5e76\u4e0d\u4f1a\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u53f7\u76f8\u540c\uff0c\u800c\u5bfc\u81f4\u8fde\u63a5\u51b2\u7a81\u7684\u95ee\u9898\u3002</p> <p>\u5ba2\u6237\u7aef TCP \u8fde\u63a5 TIME_WAIT \u72b6\u6001\u8fc7\u591a\uff0c\u4f1a\u5bfc\u81f4\u7aef\u53e3\u8d44\u6e90\u8017\u5c3d\u800c\u65e0\u6cd5\u5efa\u7acb\u65b0\u7684\u8fde\u63a5\u5417\uff1f</p> <p>\u8981\u770b\u5ba2\u6237\u7aef\u662f\u5426\u90fd\u662f\u4e0e\u540c\u4e00\u4e2a\u670d\u52a1\u5668\uff08\u76ee\u6807\u5730\u5740\u548c\u76ee\u6807\u7aef\u53e3\u4e00\u6837\uff09\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u90fd\u662f\u4e0e\u540c\u4e00\u4e2a\u670d\u52a1\u5668\uff08\u76ee\u6807\u5730\u5740\u548c\u76ee\u6807\u7aef\u53e3\u4e00\u6837\uff09\u5efa\u7acb\u8fde\u63a5\uff0c\u90a3\u4e48\u5982\u679c\u5ba2\u6237\u7aef TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u8fc7\u591a\uff0c\u5f53\u7aef\u53e3\u8d44\u6e90\u88ab\u8017\u5c3d\uff0c\u5c31\u65e0\u6cd5\u4e0e\u8fd9\u4e2a\u670d\u52a1\u5668\u518d\u5efa\u7acb\u8fde\u63a5\u4e86\u3002\u5373\u4f7f\u5728\u8fd9\u79cd\u72b6\u6001\u4e0b\uff0c\u8fd8\u662f\u53ef\u4ee5\u4e0e\u5176\u4ed6\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\uff0c\u53ea\u8981\u5ba2\u6237\u7aef\u8fde\u63a5\u7684\u670d\u52a1\u5668\u4e0d\u662f\u540c\u4e00\u4e2a\uff0c\u90a3\u4e48\u7aef\u53e3\u662f\u91cd\u590d\u4f7f\u7528\u7684\u3002</p> <p>\u5982\u4f55\u89e3\u51b3\u5ba2\u6237\u7aef TCP \u8fde\u63a5 TIME_WAIT \u8fc7\u591a\uff0c\u5bfc\u81f4\u65e0\u6cd5\u4e0e\u540c\u4e00\u4e2a\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u95ee\u9898\uff1f</p> <p>\u6253\u5f00 net.ipv4.tcp_tw_reuse  \u8fd9\u4e2a\u5185\u6838\u53c2\u6570\u3002</p> <p>\u56e0\u4e3a\u5f00\u542f\u4e86\u8fd9\u4e2a\u5185\u6838\u53c2\u6570\u540e\uff0c\u5ba2\u6237\u7aef\u8c03\u7528 connect  \u51fd\u6570\u65f6\uff0c\u5982\u679c\u9009\u62e9\u5230\u7684\u7aef\u53e3\uff0c\u5df2\u7ecf\u88ab\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u5360\u7528\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5224\u65ad\u8be5\u8fde\u63a5\u662f\u5426\u5904\u4e8e  TIME_WAIT \u72b6\u6001\u3002</p> <p>\u5982\u679c\u8be5\u8fde\u63a5\u5904\u4e8e TIME_WAIT \u72b6\u6001\u5e76\u4e14 TIME_WAIT \u72b6\u6001\u6301\u7eed\u7684\u65f6\u95f4\u8d85\u8fc7\u4e86 1 \u79d2\uff0c\u90a3\u4e48\u5c31\u4f1a\u91cd\u7528\u8fd9\u4e2a\u8fde\u63a5\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u8be5\u7aef\u53e3\u4e86\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/","title":"4.17 \u5982\u4f55\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6211\u8bb0\u5f97\u4e4b\u524d\u5728\u7fa4\u91cc\u770b\u5230\uff0c\u6709\u4f4d\u8bfb\u8005\u5b57\u8282\u4e00\u9762\u7684\u65f6\u5019\u88ab\u95ee\u5230\uff1a\u300c\u5982\u4f55\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\uff1f\u300d</p> <p>\u5f88\u591a\u540c\u5b66\u7b2c\u4e00\u53cd\u5e94\u5c31\u4f1a\u8bf4\u628a TCP \u53ef\u9760\u4f20\u8f93\u7684\u7279\u6027\uff08\u5e8f\u5217\u53f7\u3001\u786e\u8ba4\u5e94\u7b54\u3001\u8d85\u65f6\u91cd\u4f20\u3001\u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236\uff09\u5728\u5e94\u7528\u5c42\u5b9e\u73b0\u4e00\u904d\u3002</p> <p>\u5b9e\u73b0\u7684\u601d\u8def\u786e\u5b9e\u8fd9\u6837\u6ca1\u9519\uff0c\u4f46\u662f\u6709\u6ca1\u6709\u60f3\u8fc7\uff0c\u65e2\u7136 TCP \u5929\u7136\u652f\u6301\u53ef\u9760\u4f20\u8f93\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981\u57fa\u4e8e UDP \u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\u5462\uff1f\u8fd9\u4e0d\u662f\u91cd\u590d\u9020\u8f6e\u5b50\u5417\uff1f</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u5148\u5f04\u6e05\u695a TCP \u534f\u8bae\u6709\u54ea\u4e9b\u75db\u70b9\uff1f\u800c\u8fd9\u4e9b\u75db\u70b9\u662f\u5426\u53ef\u4ee5\u5728\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u7684\u53ef\u9760\u4f20\u8f93\u534f\u8bae\u4e2d\u5f97\u5230\u6539\u8fdb\uff1f</p> <p>\u5728\u4e4b\u524d\u8fd9\u7bc7\u6587\u7ae0\uff1aTCP \u5c31\u6ca1\u4ec0\u4e48\u7f3a\u9677\u5417\uff1f\uff0c\u6211\u5df2\u7ecf\u8bf4\u4e86 TCP \u534f\u8bae\u56db\u4e2a\u65b9\u9762\u7684\u7f3a\u9677\uff1a</p> <ul> <li>\u5347\u7ea7 TCP \u7684\u5de5\u4f5c\u5f88\u56f0\u96be\uff1b</li> <li>TCP \u5efa\u7acb\u8fde\u63a5\u7684\u5ef6\u8fdf\uff1b</li> <li>TCP \u5b58\u5728\u961f\u5934\u963b\u585e\u95ee\u9898\uff1b</li> <li>\u7f51\u7edc\u8fc1\u79fb\u9700\u8981\u91cd\u65b0\u5efa\u7acb TCP \u8fde\u63a5\uff1b</li> </ul> <p>\u73b0\u5728\u5e02\u9762\u4e0a\u5df2\u7ecf\u6709\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u7684\u53ef\u9760\u4f20\u8f93\u534f\u8bae\u7684\u6210\u719f\u65b9\u6848\u4e86\uff0c\u90a3\u5c31\u662f QUIC \u534f\u8bae\uff0c\u5df2\u7ecf\u5e94\u7528\u5728\u4e86 HTTP/3\u3002</p> <p>\u8fd9\u6b21\uff0c\u804a\u804a QUIC \u662f\u5982\u4f55\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\u7684\uff1f\u53c8\u662f\u5982\u4f55\u89e3\u51b3\u4e0a\u9762 TCP \u534f\u8bae\u56db\u4e2a\u65b9\u9762\u7684\u7f3a\u9677\uff1f</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#quic","title":"QUIC \u662f\u5982\u4f55\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\u7684\uff1f","text":"<p>\u8981\u57fa\u4e8e UDP \u5b9e\u73b0\u7684\u53ef\u9760\u4f20\u8f93\u534f\u8bae\uff0c\u90a3\u4e48\u5c31\u8981\u5728\u5e94\u7528\u5c42\u4e0b\u529f\u592b\uff0c\u4e5f\u5c31\u662f\u8981\u8bbe\u8ba1\u597d\u534f\u8bae\u7684\u5934\u90e8\u5b57\u6bb5\u3002</p> <p>\u62ff HTTP/3 \u4e3e\u4f8b\u5b50\uff0c\u5728 UDP \u62a5\u6587\u5934\u90e8\u4e0e HTTP \u6d88\u606f\u4e4b\u95f4\uff0c\u5171\u6709 3 \u5c42\u5934\u90e8\uff1a</p> <p></p> <p>\u6574\u4f53\u770b\u7684\u89c6\u89d2\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u522b\u5bf9\u6bcf\u4e00\u4e2a Header \u505a\u4e2a\u4ecb\u7ecd\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#packet-header","title":"Packet Header","text":"<p>Packet Header \u9996\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\u548c\u65e5\u5e38\u4f20\u8f93\u6570\u636e\u65f6\u4f7f\u7528\u7684 Header \u662f\u4e0d\u540c\u7684\u3002\u5982\u4e0b\u56fe\uff08\u6ce8\u610f\u6211\u6ca1\u6709\u628a Header \u6240\u6709\u5b57\u6bb5\u90fd\u753b\u51fa\u6765\uff0c\u53ea\u662f\u753b\u51fa\u4e86\u91cd\u8981\u7684\u5b57\u6bb5\uff09\uff1a</p> <p></p> <p>Packet Header \u7ec6\u5206\u8fd9\u4e24\u79cd\uff1a</p> <ul> <li>Long Packet Header \u7528\u4e8e\u9996\u6b21\u5efa\u7acb\u8fde\u63a5\u3002</li> <li>Short Packet Header \u7528\u4e8e\u65e5\u5e38\u4f20\u8f93\u6570\u636e\u3002</li> </ul> <p>QUIC \u4e5f\u662f\u9700\u8981\u4e09\u6b21\u63e1\u624b\u6765\u5efa\u7acb\u8fde\u63a5\u7684\uff0c\u4e3b\u8981\u76ee\u7684\u662f\u4e3a\u4e86\u534f\u5546\u8fde\u63a5 ID\u3002\u534f\u5546\u51fa\u8fde\u63a5 ID \u540e\uff0c\u540e\u7eed\u4f20\u8f93\u65f6\uff0c\u53cc\u65b9\u53ea\u9700\u8981\u56fa\u5b9a\u4f4f\u8fde\u63a5 ID\uff0c\u4ece\u800c\u5b9e\u73b0\u8fde\u63a5\u8fc1\u79fb\u529f\u80fd\u3002\u6240\u4ee5\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u65e5\u5e38\u4f20\u8f93\u6570\u636e\u7684 Short Packet Header \u4e0d\u9700\u8981\u5728\u4f20\u8f93 Source Connection ID \u5b57\u6bb5\u4e86\uff0c\u53ea\u9700\u8981\u4f20\u8f93 Destination Connection ID\u3002</p> <p>Short Packet Header \u4e2d\u7684 <code>Packet Number</code> \u662f\u6bcf\u4e2a\u62a5\u6587\u72ec\u4e00\u65e0\u4e8c\u7684\u7f16\u53f7\uff0c\u5b83\u662f\u4e25\u683c\u9012\u589e\u7684\uff0c\u4e5f\u5c31\u662f\u8bf4\u5c31\u7b97 Packet N \u4e22\u5931\u4e86\uff0c\u91cd\u4f20\u7684 Packet N \u7684 Packet Number \u5df2\u7ecf\u4e0d\u662f N\uff0c\u800c\u662f\u4e00\u4e2a\u6bd4 N \u5927\u7684\u503c\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1\u5462\uff1f</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b  TCP \u7684\u95ee\u9898\uff0cTCP \u5728\u91cd\u4f20\u62a5\u6587\u65f6\u7684\u5e8f\u5217\u53f7\u548c\u539f\u59cb\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u662f\u4e00\u6837\u7684\uff0c\u4e5f\u6b63\u662f\u7531\u4e8e\u8fd9\u4e2a\u7279\u6027\uff0c\u5f15\u5165\u4e86 TCP \u91cd\u4f20\u7684\u6b67\u4e49\u95ee\u9898\u3002</p> <p></p> <p>\u6bd4\u5982\u4e0a\u56fe\uff0c\u5f53 TCP \u53d1\u751f\u8d85\u65f6\u91cd\u4f20\u540e\uff0c\u5ba2\u6237\u7aef\u53d1\u8d77\u91cd\u4f20\uff0c\u7136\u540e\u63a5\u6536\u5230\u4e86\u670d\u52a1\u7aef\u786e\u8ba4 ACK\u3002\u7531\u4e8e\u5ba2\u6237\u7aef\u539f\u59cb\u62a5\u6587\u548c\u91cd\u4f20\u62a5\u6587\u5e8f\u5217\u53f7\u90fd\u662f\u4e00\u6837\u7684\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u9488\u5bf9\u8fd9\u4e24\u4e2a\u62a5\u6587\u56de\u590d\u7684\u90fd\u662f\u76f8\u540c\u7684 ACK\u3002</p> <p>\u8fd9\u6837\u7684\u8bdd\uff0c\u5ba2\u6237\u7aef\u5c31\u65e0\u6cd5\u5224\u65ad\u51fa\u662f\u300c\u539f\u59cb\u62a5\u6587\u7684\u54cd\u5e94\u300d\u8fd8\u662f\u300c\u91cd\u4f20\u62a5\u6587\u7684\u54cd\u5e94\u300d\uff0c\u8fd9\u6837\u5728\u8ba1\u7b97 RTT\uff08\u5f80\u8fd4\u65f6\u95f4\uff09\u65f6\u5e94\u8be5\u9009\u62e9\u4ece\u53d1\u9001\u539f\u59cb\u62a5\u6587\u5f00\u59cb\u8ba1\u7b97\uff0c\u8fd8\u662f\u91cd\u4f20\u539f\u59cb\u62a5\u6587\u5f00\u59cb\u8ba1\u7b97\u5462\uff1f</p> <ul> <li>\u5982\u679c\u7b97\u6210\u539f\u59cb\u62a5\u6587\u7684\u54cd\u5e94\uff0c\u4f46\u5b9e\u9645\u4e0a\u662f\u91cd\u4f20\u62a5\u6587\u7684\u54cd\u5e94\uff08\u4e0a\u56fe\u5de6\uff09\uff0c\u4f1a\u5bfc\u81f4\u91c7\u6837 RTT \u53d8\u5927\uff1b</li> <li>\u5982\u679c\u7b97\u6210\u91cd\u4f20\u62a5\u6587\u7684\u54cd\u5e94\uff0c\u4f46\u5b9e\u9645\u4e0a\u662f\u539f\u59cb\u62a5\u6587\u7684\u54cd\u5e94\uff08\u4e0a\u56fe\u53f3\uff09\uff0c\u53c8\u5f88\u5bb9\u6613\u5bfc\u81f4\u91c7\u6837 RTT \u8fc7\u5c0f\uff1b</li> </ul> <p>RTO\uff08\u8d85\u65f6\u65f6\u95f4\uff09\u662f\u57fa\u4e8e RTT \u6765\u8ba1\u7b97\u7684\uff0c\u90a3\u4e48\u5982\u679c RTT \u8ba1\u7b97\u4e0d\u7cbe\u51c6\uff0c\u90a3\u4e48 RTO\uff08\u8d85\u65f6\u65f6\u95f4\uff09\u4e5f\u4f1a\u4e0d\u7cbe\u786e\uff0c\u8fd9\u6837\u53ef\u80fd\u5bfc\u81f4\u91cd\u4f20\u7684\u6982\u7387\u4e8b\u4ef6\u589e\u5927\u3002</p> <p>QUIC \u62a5\u6587\u4e2d\u7684 Pakcet Number \u662f\u4e25\u683c\u9012\u589e\u7684\uff0c\u5373\u4f7f\u662f\u91cd\u4f20\u62a5\u6587\uff0c\u5b83\u7684 Pakcet Number \u4e5f\u662f\u9012\u589e\u7684\uff0c\u8fd9\u6837\u5c31\u80fd\u66f4\u52a0\u7cbe\u786e\u8ba1\u7b97\u51fa\u62a5\u6587\u7684 RTT\u3002</p> <p></p> <p>\u5982\u679c ACK \u7684 Packet Number \u662f N+M\uff0c\u5c31\u6839\u636e\u91cd\u4f20\u62a5\u6587\u8ba1\u7b97\u91c7\u6837 RTT\u3002\u5982\u679c ACK \u7684 Pakcet Number \u662f N\uff0c\u5c31\u6839\u636e\u539f\u59cb\u62a5\u6587\u7684\u65f6\u95f4\u8ba1\u7b97\u91c7\u6837 RTT\uff0c\u6ca1\u6709\u6b67\u4e49\u6027\u7684\u95ee\u9898\u3002</p> <p>\u53e6\u5916\uff0c\u8fd8\u6709\u4e00\u4e2a\u597d\u5904\uff0cQUIC \u4f7f\u7528\u7684 Packet Number \u5355\u8c03\u9012\u589e\u7684\u8bbe\u8ba1\uff0c\u53ef\u4ee5\u8ba9\u6570\u636e\u5305\u4e0d\u518d\u50cf TCP \u90a3\u6837\u5fc5\u987b\u6709\u5e8f\u786e\u8ba4\uff0cQUIC \u652f\u6301\u4e71\u5e8f\u786e\u8ba4\uff0c\u5f53\u6570\u636e\u5305 Packet N \u4e22\u5931\u540e\uff0c\u53ea\u8981\u6709\u65b0\u7684\u5df2\u63a5\u6536\u6570\u636e\u5305\u786e\u8ba4\uff0c\u5f53\u524d\u7a97\u53e3\u5c31\u4f1a\u7ee7\u7eed\u5411\u53f3\u6ed1\u52a8\uff08\u540e\u9762\u8bb2\u6d41\u91cf\u63a7\u5236\u7684\u65f6\u5019\uff0c\u4f1a\u4e3e\u4f8b\u5b50\uff09\u3002</p> <p>\u5f85\u53d1\u9001\u7aef\u83b7\u77e5\u6570\u636e\u5305 Packet N \u4e22\u5931\u540e\uff0c\u4f1a\u5c06\u9700\u8981\u91cd\u4f20\u7684\u6570\u636e\u5305\u653e\u5230\u5f85\u53d1\u9001\u961f\u5217\uff0c\u91cd\u65b0\u7f16\u53f7\u6bd4\u5982\u6570\u636e\u5305 Packet N+M \u540e\u91cd\u65b0\u53d1\u9001\u7ed9\u63a5\u6536\u7aef\uff0c\u5bf9\u91cd\u4f20\u6570\u636e\u5305\u7684\u5904\u7406\u8ddf\u53d1\u9001\u65b0\u7684\u6570\u636e\u5305\u7c7b\u4f3c\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u56e0\u4e3a\u4e22\u5305\u91cd\u4f20\u5c06\u5f53\u524d\u7a97\u53e3\u963b\u585e\u5728\u539f\u5730\uff0c\u4ece\u800c\u89e3\u51b3\u4e86\u961f\u5934\u963b\u585e\u95ee\u9898\u3002</p> <p>\u6240\u4ee5\uff0cPacket Number \u5355\u8c03\u9012\u589e\u7684\u4e24\u4e2a\u597d\u5904\uff1a</p> <ul> <li>\u53ef\u4ee5\u66f4\u52a0\u7cbe\u786e\u8ba1\u7b97 RTT\uff0c\u6ca1\u6709 TCP \u91cd\u4f20\u7684\u6b67\u4e49\u6027\u95ee\u9898\uff1b</li> <li>\u53ef\u4ee5\u652f\u6301\u4e71\u5e8f\u786e\u8ba4\uff0c\u56e0\u4e3a\u4e22\u5305\u91cd\u4f20\u5c06\u5f53\u524d\u7a97\u53e3\u963b\u585e\u5728\u539f\u5730\uff0c\u800c TCP \u5fc5\u987b\u662f\u987a\u5e8f\u786e\u8ba4\u7684\uff0c\u4e22\u5305\u65f6\u4f1a\u5bfc\u81f4\u7a97\u53e3\u4e0d\u6ed1\u52a8\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#quic-frame-header","title":"QUIC Frame Header","text":"<p>\u4e00\u4e2a Packet \u62a5\u6587\u4e2d\u53ef\u4ee5\u5b58\u653e\u591a\u4e2a QUIC Frame\u3002</p> <p></p> <p>\u6bcf\u4e00\u4e2a Frame \u90fd\u6709\u660e\u786e\u7684\u7c7b\u578b\uff0c\u9488\u5bf9\u7c7b\u578b\u7684\u4e0d\u540c\uff0c\u529f\u80fd\u4e5f\u4e0d\u540c\uff0c\u81ea\u7136\u683c\u5f0f\u4e5f\u4e0d\u540c\u3002</p> <p>\u6211\u8fd9\u91cc\u53ea\u4e3e\u4f8b  Stream \u7c7b\u578b\u7684 Frame \u683c\u5f0f\uff0cStream \u53ef\u4ee5\u8ba4\u4e3a\u5c31\u662f\u4e00\u6761 HTTP \u8bf7\u6c42\uff0c\u5b83\u957f\u8fd9\u6837\uff1a</p> <p></p> <ul> <li>Stream ID \u4f5c\u7528\uff1a\u591a\u4e2a\u5e76\u53d1\u4f20\u8f93\u7684 HTTP \u6d88\u606f\uff0c\u901a\u8fc7\u4e0d\u540c\u7684 Stream ID \u52a0\u4ee5\u533a\u522b\uff0c\u7c7b\u4f3c\u4e8e HTTP2 \u7684 Stream ID\uff1b</li> <li>Offset \u4f5c\u7528\uff1a\u7c7b\u4f3c\u4e8e TCP \u534f\u8bae\u4e2d\u7684 Seq \u5e8f\u53f7\uff0c\u4fdd\u8bc1\u6570\u636e\u7684\u987a\u5e8f\u6027\u548c\u53ef\u9760\u6027\uff1b</li> <li>Length \u4f5c\u7528\uff1a\u6307\u660e\u4e86 Frame \u6570\u636e\u7684\u957f\u5ea6\u3002</li> </ul> <p>\u5728\u524d\u9762\u4ecb\u7ecd Packet Header \u65f6\uff0c\u8bf4\u5230 Packet Number \u662f\u4e25\u683c\u9012\u589e\uff0c\u5373\u4f7f\u91cd\u4f20\u62a5\u6587\u7684 Packet Number \u4e5f\u662f\u9012\u589e\u7684\uff0c\u65e2\u7136\u91cd\u4f20\u6570\u636e\u5305\u7684 Packet N+M \u4e0e\u4e22\u5931\u6570\u636e\u5305\u7684 Packet N \u7f16\u53f7\u5e76\u4e0d\u4e00\u81f4\uff0c\u6211\u4eec\u600e\u4e48\u786e\u5b9a\u8fd9\u4e24\u4e2a\u6570\u636e\u5305\u7684\u5185\u5bb9\u4e00\u6837\u5462\uff1f</p> <p>\u6240\u4ee5\u5f15\u5165 Frame Header \u8fd9\u4e00\u5c42\uff0c\u901a\u8fc7 Stream ID + Offset \u5b57\u6bb5\u4fe1\u606f\u5b9e\u73b0\u6570\u636e\u7684\u6709\u5e8f\u6027\uff0c\u901a\u8fc7\u6bd4\u8f83\u4e24\u4e2a\u6570\u636e\u5305\u7684 Stream ID \u4e0e Stream Offset\uff0c\u5982\u679c\u90fd\u662f\u4e00\u81f4\uff0c\u5c31\u8bf4\u660e\u8fd9\u4e24\u4e2a\u6570\u636e\u5305\u7684\u5185\u5bb9\u4e00\u81f4\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u4e0b\u56fe\u4e2d\uff0c\u6570\u636e\u5305 Packet N \u4e22\u5931\u4e86\uff0c\u540e\u9762\u91cd\u4f20\u8be5\u6570\u636e\u5305\u7684\u7f16\u53f7\u4e3a Packet N+2\uff0c\u4e22\u5931\u7684\u6570\u636e\u5305\u548c\u91cd\u4f20\u7684\u6570\u636e\u5305 Stream ID \u4e0e Offset \u90fd\u4e00\u81f4\uff0c\u8bf4\u660e\u8fd9\u4e24\u4e2a\u6570\u636e\u5305\u7684\u5185\u5bb9\u4e00\u81f4\u3002\u8fd9\u4e9b\u6570\u636e\u5305\u4f20\u8f93\u5230\u63a5\u6536\u7aef\u540e\uff0c\u63a5\u6536\u7aef\u80fd\u6839\u636e Stream ID \u4e0e Offset \u5b57\u6bb5\u4fe1\u606f\u5c06  Stream x \u548c Stream x+y \u6309\u7167\u987a\u5e8f\u7ec4\u7ec7\u8d77\u6765\uff0c\u7136\u540e\u4ea4\u7ed9\u5e94\u7528\u7a0b\u5e8f\u5904\u7406\u3002</p> <p></p> <p>\u603b\u7684\u6765\u8bf4\uff0cQUIC \u901a\u8fc7\u5355\u5411\u9012\u589e\u7684 Packet Number\uff0c\u914d\u5408 Stream ID \u4e0e Offset \u5b57\u6bb5\u4fe1\u606f\uff0c\u53ef\u4ee5\u652f\u6301\u4e71\u5e8f\u786e\u8ba4\u800c\u4e0d\u5f71\u54cd\u6570\u636e\u5305\u7684\u6b63\u786e\u7ec4\u88c5\uff0c\u6446\u8131\u4e86 TCP \u5fc5\u987b\u6309\u987a\u5e8f\u786e\u8ba4\u5e94\u7b54 ACK \u7684\u9650\u5236\uff0c\u89e3\u51b3\u4e86 TCP \u56e0\u67d0\u4e2a\u6570\u636e\u5305\u91cd\u4f20\u800c\u963b\u585e\u540e\u7eed\u6240\u6709\u5f85\u53d1\u9001\u6570\u636e\u5305\u7684\u95ee\u9898\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#quic-tcp","title":"QUIC \u662f\u5982\u4f55\u89e3\u51b3 TCP \u961f\u5934\u963b\u585e\u95ee\u9898\u7684\uff1f","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#tcp","title":"\u4ec0\u4e48\u662f TCP \u961f\u5934\u963b\u585e\u95ee\u9898\uff1f","text":"<p>TCP \u961f\u5934\u963b\u585e\u7684\u95ee\u9898\u8981\u4ece\u4e24\u4e2a\u89d2\u5ea6\u770b\uff0c\u4e00\u4e2a\u662f\u53d1\u9001\u7a97\u53e3\u7684\u961f\u5934\u963b\u585e\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u63a5\u6536\u7a97\u53e3\u7684\u961f\u5934\u963b\u585e\u3002</p> <p>1\u3001\u53d1\u9001\u7a97\u53e3\u7684\u961f\u5934\u963b\u585e\u3002</p> <p>TCP \u53d1\u9001\u51fa\u53bb\u7684\u6570\u636e\uff0c\u90fd\u662f\u9700\u8981\u6309\u5e8f\u786e\u8ba4\u7684\uff0c\u53ea\u6709\u5728\u6570\u636e\u90fd\u88ab\u6309\u987a\u5e8f\u786e\u8ba4\u5b8c\u540e\uff0c\u53d1\u9001\u7a97\u53e3\u624d\u4f1a\u5f80\u524d\u6ed1\u52a8\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u4e0b\u56fe\u7684\u53d1\u9001\u65b9\u628a\u53d1\u9001\u7a97\u53e3\u5185\u7684\u6570\u636e\u5168\u90e8\u90fd\u53d1\u51fa\u53bb\u4e86\uff0c\u53ef\u7528\u7a97\u53e3\u7684\u5927\u5c0f\u5c31\u4e3a 0 \u4e86\uff0c\u8868\u660e\u53ef\u7528\u7a97\u53e3\u8017\u5c3d\uff0c\u5728\u6ca1\u6536\u5230 ACK \u786e\u8ba4\u4e4b\u524d\u662f\u65e0\u6cd5\u7ee7\u7eed\u53d1\u9001\u6570\u636e\u4e86\u3002</p> <p></p> <p>\u63a5\u7740\uff0c\u5f53\u53d1\u9001\u65b9\u6536\u5230\u5bf9\u7b2c <code>32~36</code> \u5b57\u8282\u7684 ACK \u786e\u8ba4\u5e94\u7b54\u540e\uff0c\u5219\u6ed1\u52a8\u7a97\u53e3\u5f80\u53f3\u8fb9\u79fb\u52a8 5 \u4e2a\u5b57\u8282\uff0c\u56e0\u4e3a\u6709 5 \u4e2a\u5b57\u8282\u7684\u6570\u636e\u88ab\u5e94\u7b54\u786e\u8ba4\uff0c\u63a5\u4e0b\u6765\u7b2c <code>52~56</code> \u5b57\u8282\u53c8\u53d8\u6210\u4e86\u53ef\u7528\u7a97\u53e3\uff0c\u90a3\u4e48\u540e\u7eed\u4e5f\u5c31\u53ef\u4ee5\u53d1\u9001 <code>52~56</code> \u8fd9 5 \u4e2a\u5b57\u8282\u7684\u6570\u636e\u4e86\u3002</p> <p></p> <p>\u4f46\u662f\u5982\u679c\u67d0\u4e2a\u6570\u636e\u62a5\u6587\u4e22\u5931\u6216\u8005\u5176\u5bf9\u5e94\u7684 ACK \u62a5\u6587\u5728\u7f51\u7edc\u4e2d\u4e22\u5931\uff0c\u4f1a\u5bfc\u81f4\u53d1\u9001\u65b9\u65e0\u6cd5\u79fb\u52a8\u53d1\u9001\u7a97\u53e3\uff0c\u8fd9\u65f6\u5c31\u65e0\u6cd5\u518d\u53d1\u9001\u65b0\u7684\u6570\u636e\uff0c\u53ea\u80fd\u8d85\u65f6\u91cd\u4f20\u8fd9\u4e2a\u6570\u636e\u62a5\u6587\uff0c\u76f4\u5230\u6536\u5230\u8fd9\u4e2a\u91cd\u4f20\u62a5\u6587\u7684 ACK\uff0c\u53d1\u9001\u7a97\u53e3\u624d\u4f1a\u79fb\u52a8\uff0c\u7ee7\u7eed\u540e\u9762\u7684\u53d1\u9001\u884c\u4e3a\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u6bd4\u5982\u4e0b\u56fe\uff0c\u5ba2\u6237\u7aef\u662f\u53d1\u9001\u65b9\uff0c\u670d\u52a1\u5668\u662f\u63a5\u6536\u65b9\u3002</p> <p></p> <p>\u5ba2\u6237\u7aef\u53d1\u9001\u4e86\u7b2c 5\uff5e9 \u5b57\u8282\u7684\u6570\u636e\uff0c\u4f46\u662f\u7b2c 5 \u5b57\u8282\u7684 ACK \u786e\u8ba4\u62a5\u6587\u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u4e86\uff0c\u90a3\u4e48\u5373\u4f7f\u5ba2\u6237\u7aef\u6536\u5230\u7b2c 6\uff5e9 \u5b57\u8282\u7684 ACK \u786e\u8ba4\u62a5\u6587\uff0c\u53d1\u9001\u7a97\u53e3\u4e5f\u4e0d\u4f1a\u5f80\u524d\u79fb\u52a8\u3002</p> <p>\u6b64\u65f6\u7684\u7b2c 5 \u5b57\u8282\u76f8\u5f53\u4e8e\u201c\u961f\u5934\u201d\uff0c\u56e0\u4e3a\u6ca1\u6709\u6536\u5230\u201c\u961f\u5934\u201d\u7684 ACK \u786e\u8ba4\u62a5\u6587\uff0c\u5bfc\u81f4\u53d1\u9001\u7a97\u53e3\u65e0\u6cd5\u5f80\u524d\u79fb\u52a8\uff0c\u6b64\u65f6\u53d1\u9001\u65b9\u5c31\u65e0\u6cd5\u7ee7\u7eed\u53d1\u9001\u540e\u9762\u7684\u6570\u636e\uff0c\u76f8\u5f53\u4e8e\u6309\u4e0b\u4e86\u53d1\u9001\u884c\u4e3a\u7684\u6682\u505c\u952e\uff0c\u8fd9\u5c31\u662f\u53d1\u9001\u7a97\u53e3\u7684\u961f\u5934\u963b\u585e\u95ee\u9898\u3002</p> <p>2\u3001\u63a5\u6536\u7a97\u53e3\u7684\u961f\u5934\u963b\u585e\u3002</p> <p>\u63a5\u6536\u65b9\u6536\u5230\u7684\u6570\u636e\u8303\u56f4\u5fc5\u987b\u5728\u63a5\u6536\u7a97\u53e3\u8303\u56f4\u5185\uff0c\u5982\u679c\u6536\u5230\u8d85\u8fc7\u63a5\u6536\u7a97\u53e3\u8303\u56f4\u7684\u6570\u636e\uff0c\u5c31\u4f1a\u4e22\u5f03\u8be5\u6570\u636e\uff0c\u6bd4\u5982\u4e0b\u56fe\u63a5\u6536\u7a97\u53e3\u7684\u8303\u56f4\u662f 32 \uff5e 51 \u5b57\u8282\uff0c\u5982\u679c\u6536\u5230\u7b2c 52 \u5b57\u8282\u4ee5\u4e0a\u6570\u636e\u90fd\u4f1a\u88ab\u4e22\u5f03\u3002</p> <p></p> <p>\u63a5\u6536\u7a97\u53e3\u4ec0\u4e48\u65f6\u5019\u624d\u80fd\u6ed1\u52a8\uff1f\u5f53\u63a5\u6536\u7a97\u53e3\u6536\u5230\u6709\u5e8f\u6570\u636e\u65f6\uff0c\u63a5\u6536\u7a97\u53e3\u624d\u80fd\u5f80\u524d\u6ed1\u52a8\uff0c\u7136\u540e\u90a3\u4e9b\u5df2\u7ecf\u63a5\u6536\u5e76\u4e14\u88ab\u786e\u8ba4\u7684\u300c\u6709\u5e8f\u300d\u6570\u636e\u5c31\u53ef\u4ee5\u88ab\u5e94\u7528\u5c42\u8bfb\u53d6\u3002</p> <p>\u4f46\u662f\uff0c\u5f53\u63a5\u6536\u7a97\u53e3\u6536\u5230\u7684\u6570\u636e\u4e0d\u662f\u6709\u5e8f\u7684\uff0c\u6bd4\u5982\u6536\u5230\u7b2c 33\uff5e40 \u5b57\u8282\u7684\u6570\u636e\uff0c\u7531\u4e8e\u7b2c 32 \u5b57\u8282\u6570\u636e\u6ca1\u6709\u6536\u5230\uff0c\u63a5\u6536\u7a97\u53e3\u65e0\u6cd5\u5411\u524d\u6ed1\u52a8\uff0c\u90a3\u4e48\u5373\u4f7f\u5148\u6536\u5230\u7b2c 33\uff5e40 \u5b57\u8282\u7684\u6570\u636e\uff0c\u8fd9\u4e9b\u6570\u636e\u4e5f\u65e0\u6cd5\u88ab\u5e94\u7528\u5c42\u8bfb\u53d6\u7684\u3002\u53ea\u6709\u5f53\u53d1\u9001\u65b9\u91cd\u4f20\u4e86\u7b2c 32 \u5b57\u8282\u6570\u636e\u5e76\u4e14\u88ab\u63a5\u6536\u65b9\u6536\u5230\u540e\uff0c\u63a5\u6536\u7a97\u53e3\u624d\u4f1a\u5f80\u524d\u6ed1\u52a8\uff0c\u7136\u540e\u5e94\u7528\u5c42\u624d\u80fd\u4ece\u5185\u6838\u8bfb\u53d6\u7b2c 32\uff5e40 \u5b57\u8282\u7684\u6570\u636e\u3002</p> <p>\u597d\u4e86\uff0c\u81f3\u6b64\u53d1\u9001\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\u7684\u961f\u5934\u963b\u585e\u95ee\u9898\u90fd\u8bf4\u5b8c\u4e86\uff0c\u8fd9\u4e24\u4e2a\u95ee\u9898\u7684\u539f\u56e0\u90fd\u662f\u56e0\u4e3a TCP \u5fc5\u987b\u6309\u5e8f\u5904\u7406\u6570\u636e\uff0c\u4e5f\u5c31\u662f TCP \u5c42\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u6709\u5e8f\u6027\uff0c\u53ea\u6709\u5728\u5904\u7406\u5b8c\u6709\u5e8f\u7684\u6570\u636e\u540e\uff0c\u6ed1\u52a8\u7a97\u53e3\u624d\u80fd\u5f80\u524d\u6ed1\u52a8\uff0c\u5426\u5219\u5c31\u505c\u7559\u3002</p> <ul> <li> <p>\u505c\u7559\u300c\u53d1\u9001\u7a97\u53e3\u300d\u4f1a\u4f7f\u5f97\u53d1\u9001\u65b9\u65e0\u6cd5\u7ee7\u7eed\u53d1\u9001\u6570\u636e\u3002</p> </li> <li> <p>\u505c\u7559\u300c\u63a5\u6536\u7a97\u53e3\u300d\u4f1a\u4f7f\u5f97\u5e94\u7528\u5c42\u65e0\u6cd5\u8bfb\u53d6\u65b0\u7684\u6570\u636e\u3002</p> </li> </ul> <p>\u5176\u5b9e\u4e5f\u4e0d\u80fd\u602a TCP \u534f\u8bae\uff0c\u5b83\u672c\u6765\u8bbe\u8ba1\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u4fdd\u8bc1\u6570\u636e\u7684\u6709\u5e8f\u6027\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#http2","title":"HTTP/2  \u7684\u961f\u5934\u963b\u585e","text":"<p>HTTP/2 \u901a\u8fc7\u62bd\u8c61\u51fa Stream \u7684\u6982\u5ff5\uff0c\u5b9e\u73b0\u4e86 HTTP \u5e76\u53d1\u4f20\u8f93\uff0c\u4e00\u4e2a Stream \u5c31\u4ee3\u8868 HTTP/1.1 \u91cc\u7684\u8bf7\u6c42\u548c\u54cd\u5e94\u3002</p> <p></p> <p>\u5728 HTTP/2 \u8fde\u63a5\u4e0a\uff0c\u4e0d\u540c Stream \u7684\u5e27\u662f\u53ef\u4ee5\u4e71\u5e8f\u53d1\u9001\u7684\uff08\u56e0\u6b64\u53ef\u4ee5\u5e76\u53d1\u4e0d\u540c\u7684 Stream\uff09\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u5e27\u7684\u5934\u90e8\u4f1a\u643a\u5e26 Stream ID \u4fe1\u606f\uff0c\u6240\u4ee5\u63a5\u6536\u7aef\u53ef\u4ee5\u901a\u8fc7 Stream ID \u6709\u5e8f\u7ec4\u88c5\u6210 HTTP \u6d88\u606f\uff0c\u800c\u540c\u4e00 Stream \u5185\u90e8\u7684\u5e27\u5fc5\u987b\u662f\u4e25\u683c\u6709\u5e8f\u7684\u3002</p> <p>\u4f46\u662f HTTP/2 \u591a\u4e2a Stream \u8bf7\u6c42\u90fd\u662f\u5728\u4e00\u6761 TCP \u8fde\u63a5\u4e0a\u4f20\u8f93\uff0c\u8fd9\u610f\u5473\u7740\u591a\u4e2a Stream \u5171\u7528\u540c\u4e00\u4e2a TCP \u6ed1\u52a8\u7a97\u53e3\uff0c\u90a3\u4e48\u5f53\u53d1\u751f\u6570\u636e\u4e22\u5931\uff0c\u6ed1\u52a8\u7a97\u53e3\u662f\u65e0\u6cd5\u5f80\u524d\u79fb\u52a8\u7684\uff0c\u6b64\u65f6\u5c31\u4f1a\u963b\u585e\u4f4f\u6240\u6709\u7684 HTTP \u8bf7\u6c42\uff0c\u8fd9\u5c5e\u4e8e TCP \u5c42\u961f\u5934\u963b\u585e\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#quic_1","title":"\u6ca1\u6709\u961f\u5934\u963b\u585e\u7684 QUIC","text":"<p>QUIC \u4e5f\u501f\u9274 HTTP/2 \u91cc\u7684 Stream \u7684\u6982\u5ff5\uff0c\u5728\u4e00\u6761 QUIC \u8fde\u63a5\u4e0a\u53ef\u4ee5\u5e76\u53d1\u53d1\u9001\u591a\u4e2a HTTP \u8bf7\u6c42 (Stream)\u3002</p> <p>\u4f46\u662f QUIC \u7ed9\u6bcf\u4e00\u4e2a Stream \u90fd\u5206\u914d\u4e86\u4e00\u4e2a\u72ec\u7acb\u7684\u6ed1\u52a8\u7a97\u53e3\uff0c\u8fd9\u6837\u4f7f\u5f97\u4e00\u4e2a\u8fde\u63a5\u4e0a\u7684\u591a\u4e2a Stream \u4e4b\u95f4\u6ca1\u6709\u4f9d\u8d56\u5173\u7cfb\uff0c\u90fd\u662f\u76f8\u4e92\u72ec\u7acb\u7684\uff0c\u5404\u81ea\u63a7\u5236\u7684\u6ed1\u52a8\u7a97\u53e3\u3002</p> <p>\u5047\u5982 Stream2 \u4e22\u4e86\u4e00\u4e2a UDP \u5305\uff0c\u4e5f\u53ea\u4f1a\u5f71\u54cd Stream2 \u7684\u5904\u7406\uff0c\u4e0d\u4f1a\u5f71\u54cd\u5176\u4ed6 Stream\uff0c\u4e0e HTTP/2 \u4e0d\u540c\uff0cHTTP/2 \u53ea\u8981\u67d0\u4e2a\u6d41\u4e2d\u7684\u6570\u636e\u5305\u4e22\u5931\u4e86\uff0c\u5176\u4ed6\u6d41\u4e5f\u4f1a\u56e0\u6b64\u53d7\u5f71\u54cd\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#quic_2","title":"QUIC \u662f\u5982\u4f55\u505a\u6d41\u91cf\u63a7\u5236\u7684\uff1f","text":"<p>TCP \u6d41\u91cf\u63a7\u5236\u662f\u901a\u8fc7\u8ba9\u300c\u63a5\u6536\u65b9\u300d\u544a\u8bc9\u300c\u53d1\u9001\u65b9\u300d\uff0c\u5b83\uff08\u63a5\u6536\u65b9\uff09\u7684\u63a5\u6536\u7a97\u53e3\u6709\u591a\u5927\uff0c\u4ece\u800c\u8ba9\u300c\u53d1\u9001\u65b9\u300d\u6839\u636e\u300c\u63a5\u6536\u65b9\u300d\u7684\u5b9e\u9645\u63a5\u6536\u80fd\u529b\u63a7\u5236\u53d1\u9001\u7684\u6570\u636e\u91cf\u3002</p> <p>QUIC \u5b9e\u73b0\u6d41\u91cf\u63a7\u5236\u7684\u65b9\u5f0f\uff1a</p> <ul> <li>\u901a\u8fc7 window_update \u5e27\u544a\u8bc9\u5bf9\u7aef\u81ea\u5df1\u53ef\u4ee5\u63a5\u6536\u7684\u5b57\u8282\u6570\uff0c\u8fd9\u6837\u53d1\u9001\u65b9\u5c31\u4e0d\u4f1a\u53d1\u9001\u8d85\u8fc7\u8fd9\u4e2a\u6570\u91cf\u7684\u6570\u636e\u3002</li> <li>\u901a\u8fc7 BlockFrame \u544a\u8bc9\u5bf9\u7aef\u7531\u4e8e\u6d41\u91cf\u63a7\u5236\u88ab\u963b\u585e\u4e86\uff0c\u65e0\u6cd5\u53d1\u9001\u6570\u636e\u3002</li> </ul> <p>\u5728\u524d\u9762\u8bf4\u5230\uff0cTCP \u7684\u63a5\u6536\u7a97\u53e3\u5728\u6536\u5230\u6709\u5e8f\u7684\u6570\u636e\u540e\uff0c\u63a5\u6536\u7a97\u53e3\u624d\u80fd\u5f80\u524d\u6ed1\u52a8\uff0c\u5426\u5219\u505c\u6b62\u6ed1\u52a8\uff1bTCP \u7684\u53d1\u9001\u7a97\u53e3\u5728\u6536\u5230\u5bf9\u5df2\u53d1\u9001\u6570\u636e\u7684\u987a\u5e8f\u786e\u8ba4 ACK \u540e\uff0c\u53d1\u9001\u7a97\u53e3\u624d\u80fd\u5f80\u524d\u6ed1\u52a8\uff0c\u5426\u5219\u505c\u6b62\u6ed1\u52a8\u3002</p> <p>QUIC \u662f\u57fa\u4e8e UDP \u4f20\u8f93\u7684\uff0c\u800c UDP \u6ca1\u6709\u6d41\u91cf\u63a7\u5236\uff0c\u56e0\u6b64 QUIC \u5b9e\u73b0\u4e86\u81ea\u5df1\u7684\u6d41\u91cf\u63a7\u5236\u673a\u5236\uff0cQUIC \u7684\u6ed1\u52a8\u7a97\u53e3\u6ed1\u52a8\u7684\u6761\u4ef6\u8ddf TCP \u6709\u4e00\u70b9\u5dee\u522b\uff0c\u4f46\u662f\u540c\u4e00\u4e2a Stream \u7684\u6570\u636e\u4e5f\u662f\u8981\u4fdd\u8bc1\u987a\u5e8f\u7684\uff0c\u4e0d\u7136\u65e0\u6cd5\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\uff0c\u56e0\u6b64\u540c\u4e00\u4e2a Stream \u7684\u6570\u636e\u5305\u4e22\u5931\u4e86\uff0c\u4e5f\u4f1a\u9020\u6210\u7a97\u53e3\u65e0\u6cd5\u6ed1\u52a8\u3002</p> <p>QUIC \u7684 \u6bcf\u4e2a Stream \u90fd\u6709\u5404\u81ea\u7684\u6ed1\u52a8\u7a97\u53e3\uff0c\u4e0d\u540c Stream \u4e92\u76f8\u72ec\u7acb\uff0c\u961f\u5934\u7684 Stream A \u88ab\u963b\u585e\u540e\uff0c\u4e0d\u59a8\u788d StreamB\u3001C \u7684\u8bfb\u53d6\u3002\u800c\u5bf9\u4e8e HTTP/2 \u800c\u8a00\uff0c\u6240\u6709\u7684 Stream \u90fd\u8dd1\u5728\u4e00\u6761 TCP \u8fde\u63a5\u4e0a\uff0c\u800c\u8fd9\u4e9b Stream \u5171\u4eab\u4e00\u4e2a\u6ed1\u52a8\u7a97\u53e3\uff0c\u56e0\u6b64\u540c\u4e00\u4e2a Connection \u5185\uff0cStream A \u88ab\u963b\u585e\u540e\uff0cStreamB\u3001C \u5fc5\u987b\u7b49\u5f85\u3002</p> <p>QUIC \u5b9e\u73b0\u4e86\u4e24\u79cd\u7ea7\u522b\u7684\u6d41\u91cf\u63a7\u5236\uff0c\u5206\u522b\u4e3a Stream \u548c Connection \u4e24\u79cd\u7ea7\u522b\uff1a</p> <ul> <li>Stream \u7ea7\u522b\u7684\u6d41\u91cf\u63a7\u5236\uff1aStream \u53ef\u4ee5\u8ba4\u4e3a\u5c31\u662f\u4e00\u6761 HTTP \u8bf7\u6c42\uff0c\u6bcf\u4e2a Stream \u90fd\u6709\u72ec\u7acb\u7684\u6ed1\u52a8\u7a97\u53e3\uff0c\u6240\u4ee5\u6bcf\u4e2a Stream \u90fd\u53ef\u4ee5\u505a\u6d41\u91cf\u63a7\u5236\uff0c\u9632\u6b62\u5355\u4e2a Stream \u6d88\u8017\u8fde\u63a5\uff08Connection\uff09\u7684\u5168\u90e8\u63a5\u6536\u7f13\u51b2\u3002</li> <li>Connection \u6d41\u91cf\u63a7\u5236\uff1a\u9650\u5236\u8fde\u63a5\u4e2d\u6240\u6709 Stream \u76f8\u52a0\u8d77\u6765\u7684\u603b\u5b57\u8282\u6570\uff0c\u9632\u6b62\u53d1\u9001\u65b9\u8d85\u8fc7\u8fde\u63a5\u7684\u7f13\u51b2\u5bb9\u91cf\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#stream","title":"Stream \u7ea7\u522b\u7684\u6d41\u91cf\u63a7\u5236","text":"<p>\u6700\u5f00\u59cb\uff0c\u63a5\u6536\u65b9\u7684\u63a5\u6536\u7a97\u53e3\u521d\u59cb\u72b6\u6001\u5982\u4e0b\uff08\u7f51\u4e0a\u7684\u8bb2 QUIC \u6d41\u91cf\u63a7\u5236\u7684\u8d44\u6599\u592a\u5c11\u4e86\uff0c\u4e0b\u9762\u7684\u4f8b\u5b50\u6211\u662f\u53c2\u8003 google \u6587\u6863\u7684\uff1aFlow control in QUIC\uff09\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u63a5\u6536\u65b9\u6536\u5230\u4e86\u53d1\u9001\u65b9\u53d1\u9001\u8fc7\u6765\u7684\u6570\u636e\uff0c\u6709\u7684\u6570\u636e\u88ab\u4e0a\u5c42\u8bfb\u53d6\u4e86\uff0c\u6709\u7684\u6570\u636e\u4e22\u5305\u4e86\uff0c\u6b64\u65f6\u7684\u63a5\u6536\u7a97\u53e3\u72b6\u51b5\u5982\u4e0b\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u63a5\u6536\u7a97\u53e3\u7684\u5de6\u8fb9\u754c\u53d6\u51b3\u4e8e\u63a5\u6536\u5230\u7684\u6700\u5927\u504f\u79fb\u5b57\u8282\u6570\uff0c\u6b64\u65f6\u7684<code>\u63a5\u6536\u7a97\u53e3  = \u6700\u5927\u7a97\u53e3\u6570 - \u63a5\u6536\u5230\u7684\u6700\u5927\u504f\u79fb\u6570</code>\u3002</p> <p>\u8fd9\u91cc\u5c31\u53ef\u4ee5\u770b\u51fa QUIC \u7684\u6d41\u91cf\u63a7\u5236\u548c TCP \u6709\u70b9\u533a\u522b\u4e86\uff1a</p> <ul> <li>TCP \u7684\u63a5\u6536\u7a97\u53e3\u53ea\u6709\u5728\u524d\u9762\u6240\u6709\u7684 Segment \u90fd\u63a5\u6536\u7684\u60c5\u51b5\u4e0b\u624d\u4f1a\u79fb\u52a8\u5de6\u8fb9\u754c\uff0c\u5f53\u5728\u524d\u9762\u8fd8\u6709\u5b57\u8282\u672a\u63a5\u6536\u4f46\u6536\u5230\u540e\u9762\u5b57\u8282\u7684\u60c5\u51b5\u4e0b\uff0c\u7a97\u53e3\u4e5f\u4e0d\u4f1a\u79fb\u52a8\u3002</li> <li>QUIC \u7684\u63a5\u6536\u7a97\u53e3\u7684\u5de6\u8fb9\u754c\u6ed1\u52a8\u6761\u4ef6\u53d6\u51b3\u4e8e\u63a5\u6536\u5230\u7684\u6700\u5927\u504f\u79fb\u5b57\u8282\u6570\u3002</li> </ul> <p>PS\uff1a\u4f46\u662f\u4f60\u8981\u95ee\u6211\u8fd9\u4e48\u8bbe\u8ba1\u6709\u4ec0\u4e48\u597d\u5904\uff1f\u6211\u4e5f\u6682\u65f6\u6ca1\u60f3\u5230\uff0c\u56e0\u4e3a\u8d44\u6599\u592a\u5c11\u4e86\uff0c\u81f3\u4eca\u6ca1\u627e\u5230\u4e00\u4e2a\u5408\u7406\u7684\u8bf4\u660e\uff0c\u5982\u679c\u4f60\u77e5\u9053\uff0c\u6b22\u8fce\u544a\u8bc9\u6211\u554a\uff01</p> <p>\u90a3\u63a5\u6536\u7a97\u53e3\u53f3\u8fb9\u754c\u89e6\u53d1\u7684\u6ed1\u52a8\u6761\u4ef6\u662f\u4ec0\u4e48\u5462\uff1f\u770b\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5f53\u56fe\u4e2d\u7684\u7eff\u8272\u90e8\u5206\u6570\u636e\u8d85\u8fc7\u6700\u5927\u63a5\u6536\u7a97\u53e3\u7684\u4e00\u534a\u540e\uff0c\u6700\u5927\u63a5\u6536\u7a97\u53e3\u5411\u53f3\u79fb\u52a8\uff0c\u63a5\u6536\u7a97\u53e3\u7684\u53f3\u8fb9\u754c\u4e5f\u5411\u53f3\u6269\u5c55\uff0c\u540c\u65f6\u7ed9\u5bf9\u7aef\u53d1\u9001\u300c\u7a97\u53e3\u66f4\u65b0\u5e27\u300d\uff0c\u5f53\u53d1\u9001\u65b9\u6536\u5230\u63a5\u6536\u65b9\u7684\u7a97\u53e3\u66f4\u65b0\u5e27\u540e\uff0c\u53d1\u9001\u7a97\u53e3\u7684\u53f3\u8fb9\u754c\u4e5f\u4f1a\u5f80\u53f3\u6269\u5c55\uff0c\u4ee5\u6b64\u8fbe\u5230\u7a97\u53e3\u6ed1\u52a8\u7684\u6548\u679c\u3002</p> <p>\u7eff\u8272\u90e8\u5206\u7684\u6570\u636e\u662f\u5df2\u6536\u5230\u7684\u987a\u5e8f\u7684\u6570\u636e\uff0c\u5982\u679c\u4e2d\u9014\u4e22\u5931\u4e86\u6570\u636e\u5305\uff0c\u5bfc\u81f4\u7eff\u8272\u90e8\u5206\u7684\u6570\u636e\u6ca1\u6709\u8d85\u8fc7\u6700\u5927\u63a5\u6536\u7a97\u53e3\u7684\u4e00\u534a\uff0c\u90a3\u63a5\u6536\u7a97\u53e3\u5c31\u65e0\u6cd5\u6ed1\u52a8\u4e86\uff0c\u8fd9\u4e2a\u53ea\u5f71\u54cd\u540c\u4e00\u4e2a Stream\uff0c\u5176\u4ed6 Stream \u662f\u4e0d\u4f1a\u5f71\u54cd\u7684\uff0c\u56e0\u4e3a\u6bcf\u4e2a Stream \u90fd\u6709\u5404\u81ea\u7684\u6ed1\u52a8\u7a97\u53e3\u3002</p> <p>\u5728\u524d\u9762\u6211\u4eec\u8bf4\u8fc7 QUIC \u652f\u6301\u4e71\u5e8f\u786e\u8ba4\uff0c\u5177\u4f53\u662f\u600e\u4e48\u505a\u5230\u7684\u5462\uff1f</p> <p>\u63a5\u4e0b\u6765\uff0c\u4e3e\u4e2a\u4f8b\u5b50\uff08\u4e0b\u9762\u7684\u4f8b\u5b50\u6765\u6e90\u4e8e\uff1aQUIC\u2014\u2014\u5feb\u901f UDP \u7f51\u7edc\u8fde\u63a5\u534f\u8bae\uff09\uff1a</p> <p>\u5982\u56fe\u6240\u793a\uff0c\u5f53\u524d\u53d1\u9001\u65b9\u7684\u7f13\u51b2\u533a\u5927\u5c0f\u4e3a 8\uff0c\u53d1\u9001\u65b9 QUIC \u6309\u5e8f\uff08offset \u987a\u5e8f\uff09\u53d1\u9001 29-36 \u7684\u6570\u636e\u5305\uff1a</p> <p></p> <p>31\u300132\u300134 \u6570\u636e\u5305\u5148\u5230\u8fbe\uff0c\u57fa\u4e8e offset \u88ab\u4f18\u5148\u4e71\u5e8f\u786e\u8ba4\uff0c\u4f46 30 \u6570\u636e\u5305\u6ca1\u6709\u786e\u8ba4\uff0c\u6240\u4ee5\u5f53\u524d\u5df2\u63d0\u4ea4\u7684\u5b57\u8282\u504f\u79fb\u91cf\u4e0d\u53d8\uff0c\u53d1\u9001\u65b9\u7684\u7f13\u5b58\u533a\u4e0d\u53d8\u3002</p> <p></p> <p>30 \u5230\u8fbe\u5e76\u786e\u8ba4\uff0c\u53d1\u9001\u65b9\u7684\u7f13\u5b58\u533a\u6536\u7f29\u5230\u9608\u503c\uff0c\u63a5\u6536\u65b9\u53d1\u9001 MAX_STREAM_DATA Frame\uff08\u534f\u5546\u7f13\u5b58\u5927\u5c0f\u7684\u7279\u5b9a\u5e27\uff09\u7ed9\u53d1\u9001\u65b9\uff0c\u8bf7\u6c42\u589e\u957f\u6700\u5927\u7edd\u5bf9\u5b57\u8282\u504f\u79fb\u91cf\u3002</p> <p></p> <p>\u534f\u5546\u5b8c\u6bd5\u540e\u6700\u5927\u7edd\u5bf9\u5b57\u8282\u504f\u79fb\u91cf\u53f3\u79fb\uff0c\u53d1\u9001\u65b9\u7684\u7f13\u5b58\u533a\u53d8\u5927\uff0c\u540c\u65f6\u53d1\u9001\u65b9\u53d1\u73b0\u6570\u636e\u5305 33 \u8d85\u65f6</p> <p></p> <p>\u53d1\u9001\u65b9\u5c06\u8d85\u65f6\u6570\u636e\u5305\u91cd\u65b0\u7f16\u53f7\u4e3a 42 \u7ee7\u7eed\u53d1\u9001</p> <p></p> <p>\u4ee5\u4e0a\u5c31\u662f\u6700\u57fa\u672c\u7684\u6570\u636e\u5305\u53d1\u9001 - \u63a5\u6536\u8fc7\u7a0b\uff0c\u63a7\u5236\u6570\u636e\u53d1\u9001\u7684\u552f\u4e00\u9650\u5236\u5c31\u662f\u6700\u5927\u7edd\u5bf9\u5b57\u8282\u504f\u79fb\u91cf\uff0c\u8be5\u503c\u662f\u63a5\u6536\u65b9\u57fa\u4e8e\u5f53\u524d\u5df2\u7ecf\u63d0\u4ea4\u7684\u504f\u79fb\u91cf\uff08\u8fde\u7eed\u5df2\u786e\u8ba4\u5e76\u5411\u4e0a\u5c42\u5e94\u7528\u63d0\u4ea4\u7684\u6570\u636e\u5305 offset\uff09\u548c\u53d1\u9001\u65b9\u534f\u5546\u5f97\u51fa\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#connection","title":"Connection \u6d41\u91cf\u63a7\u5236","text":"<p>\u800c\u5bf9\u4e8e Connection \u7ea7\u522b\u7684\u6d41\u91cf\u7a97\u53e3\uff0c\u5176\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\u5c31\u662f\u5404\u4e2a Stream \u63a5\u6536\u7a97\u53e3\u5927\u5c0f\u4e4b\u548c\u3002</p> <p></p> <p>\u4e0a\u56fe\u6240\u793a\u7684\u4f8b\u5b50\uff0c\u6240\u6709 Streams \u7684\u6700\u5927\u7a97\u53e3\u6570\u4e3a 120\uff0c\u5176\u4e2d\uff1a</p> <ul> <li>Stream 1 \u7684\u6700\u5927\u63a5\u6536\u504f\u79fb\u4e3a 100\uff0c\u53ef\u7528\u7a97\u53e3 = 120 - 100 = 20</li> <li>Stream 2 \u7684\u6700\u5927\u63a5\u6536\u504f\u79fb\u4e3a 90\uff0c\u53ef\u7528\u7a97\u53e3 = 120 - 90 = 30</li> <li>Stream 3 \u7684\u6700\u5927\u63a5\u6536\u504f\u79fb\u4e3a 110\uff0c\u53ef\u7528\u7a97\u53e3 = 120 - 110 = 10</li> </ul> <p>\u90a3\u4e48\u6574\u4e2a Connection \u7684\u53ef\u7528\u7a97\u53e3 = 20 + 30 + 10 = 60</p> Text Only<pre><code>\u53ef\u7528\u7a97\u53e3 = Stream 1 \u53ef\u7528\u7a97\u53e3 + Stream 2 \u53ef\u7528\u7a97\u53e3 + Stream 3 \u53ef\u7528\u7a97\u53e3\n</code></pre>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#quic_3","title":"QUIC \u5bf9\u62e5\u585e\u63a7\u5236\u6539\u8fdb","text":"<p>QUIC \u534f\u8bae\u5f53\u524d\u9ed8\u8ba4\u4f7f\u7528\u4e86 TCP \u7684 Cubic \u62e5\u585e\u63a7\u5236\u7b97\u6cd5\uff08\u6211\u4eec\u719f\u77e5\u7684\u6162\u5f00\u59cb\u3001\u62e5\u585e\u907f\u514d\u3001\u5feb\u91cd\u4f20\u3001\u5feb\u6062\u590d\u7b56\u7565\uff09\uff0c\u540c\u65f6\u4e5f\u652f\u6301 CubicBytes\u3001Reno\u3001RenoBytes\u3001BBR\u3001PCC \u7b49\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\uff0c\u76f8\u5f53\u4e8e\u5c06 TCP \u7684\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u7167\u642c\u8fc7\u6765\u4e86\u3002</p> <p>QUIC \u662f\u5982\u4f55\u6539\u8fdb TCP \u7684\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u7684\u5462\uff1f</p> <p>QUIC \u662f\u5904\u4e8e\u5e94\u7528\u5c42\u7684\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c42\u9762\u5c31\u80fd\u5b9e\u73b0\u4e0d\u540c\u7684\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\uff0c\u4e0d\u9700\u8981\u64cd\u4f5c\u7cfb\u7edf\uff0c\u4e0d\u9700\u8981\u5185\u6838\u652f\u6301\u3002\u8fd9\u662f\u4e00\u4e2a\u98de\u8dc3\uff0c\u56e0\u4e3a\u4f20\u7edf\u7684 TCP \u62e5\u585e\u63a7\u5236\uff0c\u5fc5\u987b\u8981\u7aef\u5230\u7aef\u7684\u7f51\u7edc\u534f\u8bae\u6808\u652f\u6301\uff0c\u624d\u80fd\u5b9e\u73b0\u63a7\u5236\u6548\u679c\u3002\u800c\u5185\u6838\u548c\u64cd\u4f5c\u7cfb\u7edf\u7684\u90e8\u7f72\u6210\u672c\u975e\u5e38\u9ad8\uff0c\u5347\u7ea7\u5468\u671f\u5f88\u957f\uff0c\u6240\u4ee5 TCP \u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u8fed\u4ee3\u901f\u5ea6\u662f\u5f88\u6162\u7684\u3002\u800c QUIC \u53ef\u4ee5\u968f\u6d4f\u89c8\u5668\u66f4\u65b0\uff0cQUIC \u7684\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u5c31\u53ef\u4ee5\u6709\u8f83\u5feb\u7684\u8fed\u4ee3\u901f\u5ea6\u3002</p> <p>TCP \u66f4\u6539\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\u662f\u5bf9\u7cfb\u7edf\u4e2d\u6240\u6709\u5e94\u7528\u90fd\u751f\u6548\uff0c\u65e0\u6cd5\u6839\u636e\u4e0d\u540c\u5e94\u7528\u8bbe\u5b9a\u4e0d\u540c\u7684\u62e5\u585e\u63a7\u5236\u7b56\u7565\u3002\u4f46\u662f\u56e0\u4e3a QUIC \u5904\u4e8e\u5e94\u7528\u5c42\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u9488\u5bf9\u4e0d\u540c\u7684\u5e94\u7528\u8bbe\u7f6e\u4e0d\u540c\u7684\u62e5\u585e\u63a7\u5236\u7b97\u6cd5\uff0c\u8fd9\u6837\u7075\u6d3b\u6027\u5c31\u5f88\u9ad8\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#quic_4","title":"QUIC \u66f4\u5feb\u7684\u8fde\u63a5\u5efa\u7acb","text":"<p>\u5bf9\u4e8e HTTP/1 \u548c HTTP/2 \u534f\u8bae\uff0cTCP \u548c TLS \u662f\u5206\u5c42\u7684\uff0c\u5206\u522b\u5c5e\u4e8e\u5185\u6838\u5b9e\u73b0\u7684\u4f20\u8f93\u5c42\u3001openssl \u5e93\u5b9e\u73b0\u7684\u8868\u793a\u5c42\uff0c\u56e0\u6b64\u5b83\u4eec\u96be\u4ee5\u5408\u5e76\u5728\u4e00\u8d77\uff0c\u9700\u8981\u5206\u6279\u6b21\u6765\u63e1\u624b\uff0c\u5148 TCP \u63e1\u624b\uff081RTT\uff09\uff0c\u518d TLS \u63e1\u624b\uff082RTT\uff09\uff0c\u6240\u4ee5\u9700\u8981 3RTT \u7684\u5ef6\u8fdf\u624d\u80fd\u4f20\u8f93\u6570\u636e\uff0c\u5c31\u7b97 Session \u4f1a\u8bdd\u590d\u7528\uff0c\u4e5f\u9700\u8981\u81f3\u5c11 2 \u4e2a RTT\u3002</p> <p>HTTP/3 \u5728\u4f20\u8f93\u6570\u636e\u524d\u867d\u7136\u9700\u8981 QUIC \u534f\u8bae\u63e1\u624b\uff0c\u8fd9\u4e2a\u63e1\u624b\u8fc7\u7a0b\u53ea\u9700\u8981 1 RTT\uff0c\u63e1\u624b\u7684\u76ee\u7684\u662f\u4e3a\u786e\u8ba4\u53cc\u65b9\u7684\u300c\u8fde\u63a5 ID\u300d\uff0c\u8fde\u63a5\u8fc1\u79fb\u5c31\u662f\u57fa\u4e8e\u8fde\u63a5 ID \u5b9e\u73b0\u7684\u3002</p> <p>\u4f46\u662f HTTP/3 \u7684 QUIC \u534f\u8bae\u5e76\u4e0d\u662f\u4e0e TLS \u5206\u5c42\uff0c\u800c\u662fQUIC \u5185\u90e8\u5305\u542b\u4e86 TLS\uff0c\u5b83\u5728\u81ea\u5df1\u7684\u5e27\u4f1a\u643a\u5e26 TLS \u91cc\u7684\u201c\u8bb0\u5f55\u201d\uff0c\u518d\u52a0\u4e0a QUIC \u4f7f\u7528\u7684\u662f TLS1.3\uff0c\u56e0\u6b64\u4ec5\u9700 1 \u4e2a RTT \u5c31\u53ef\u4ee5\u300c\u540c\u65f6\u300d\u5b8c\u6210\u5efa\u7acb\u8fde\u63a5\u4e0e\u5bc6\u94a5\u534f\u5546\uff0c\u751a\u81f3\u5728\u7b2c\u4e8c\u6b21\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u5e94\u7528\u6570\u636e\u5305\u53ef\u4ee5\u548c QUIC \u63e1\u624b\u4fe1\u606f\uff08\u8fde\u63a5\u4fe1\u606f + TLS \u4fe1\u606f\uff09\u4e00\u8d77\u53d1\u9001\uff0c\u8fbe\u5230 0-RTT \u7684\u6548\u679c\u3002</p> <p>\u5982\u4e0b\u56fe\u53f3\u8fb9\u90e8\u5206\uff0cHTTP/3 \u5f53\u4f1a\u8bdd\u6062\u590d\u65f6\uff0c\u6709\u6548\u8d1f\u8f7d\u6570\u636e\u4e0e\u7b2c\u4e00\u4e2a\u6570\u636e\u5305\u4e00\u8d77\u53d1\u9001\uff0c\u53ef\u4ee5\u505a\u5230 0-RTT\uff08\u4e0b\u56fe\u7684\u53f3\u4e0b\u89d2\uff09\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/quic/#quic_5","title":"QUIC \u662f\u5982\u4f55\u8fc1\u79fb\u8fde\u63a5\u7684\uff1f","text":"<p>\u57fa\u4e8e TCP \u4f20\u8f93\u534f\u8bae\u7684 HTTP \u534f\u8bae\uff0c\u7531\u4e8e\u662f\u901a\u8fc7\u56db\u5143\u7ec4\uff08\u6e90 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684 IP\u3001\u76ee\u7684\u7aef\u53e3\uff09\u786e\u5b9a\u4e00\u6761 TCP \u8fde\u63a5\u3002</p> <p></p> <p>\u90a3\u4e48\u5f53\u79fb\u52a8\u8bbe\u5907\u7684\u7f51\u7edc\u4ece 4G \u5207\u6362\u5230 WIFI \u65f6\uff0c\u610f\u5473\u7740 IP \u5730\u5740\u53d8\u5316\u4e86\uff0c\u90a3\u4e48\u5c31\u5fc5\u987b\u8981\u65ad\u5f00\u8fde\u63a5\uff0c\u7136\u540e\u91cd\u65b0\u5efa\u7acb TCP \u8fde\u63a5\u3002</p> <p>\u800c\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\u5305\u542b TCP \u4e09\u6b21\u63e1\u624b\u548c TLS \u56db\u6b21\u63e1\u624b\u7684\u65f6\u5ef6\uff0c\u4ee5\u53ca TCP \u6162\u542f\u52a8\u7684\u51cf\u901f\u8fc7\u7a0b\uff0c\u7ed9\u7528\u6237\u7684\u611f\u89c9\u5c31\u662f\u7f51\u7edc\u7a81\u7136\u5361\u987f\u4e86\u4e00\u4e0b\uff0c\u56e0\u6b64\u8fde\u63a5\u7684\u8fc1\u79fb\u6210\u672c\u662f\u5f88\u9ad8\u7684\u3002</p> <p>QUIC \u534f\u8bae\u6ca1\u6709\u7528\u56db\u5143\u7ec4\u7684\u65b9\u5f0f\u6765\u201c\u7ed1\u5b9a\u201d\u8fde\u63a5\uff0c\u800c\u662f\u901a\u8fc7\u8fde\u63a5 ID\u6765\u6807\u8bb0\u901a\u4fe1\u7684\u4e24\u4e2a\u7aef\u70b9\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u53ef\u4ee5\u5404\u81ea\u9009\u62e9\u4e00\u7ec4 ID \u6765\u6807\u8bb0\u81ea\u5df1\uff0c\u56e0\u6b64\u5373\u4f7f\u79fb\u52a8\u8bbe\u5907\u7684\u7f51\u7edc\u53d8\u5316\u540e\uff0c\u5bfc\u81f4 IP \u5730\u5740\u53d8\u5316\u4e86\uff0c\u53ea\u8981\u4ecd\u4fdd\u6709\u4e0a\u4e0b\u6587\u4fe1\u606f\uff08\u6bd4\u5982\u8fde\u63a5 ID\u3001TLS \u5bc6\u94a5\u7b49\uff09\uff0c\u5c31\u53ef\u4ee5\u201c\u65e0\u7f1d\u201d\u5730\u590d\u7528\u539f\u8fde\u63a5\uff0c\u6d88\u9664\u91cd\u8fde\u7684\u6210\u672c\uff0c\u6ca1\u6709\u4e1d\u6beb\u5361\u987f\u611f\uff0c\u8fbe\u5230\u4e86\u8fde\u63a5\u8fc1\u79fb\u7684\u529f\u80fd\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <ul> <li>https://www.taohui.tech/2021/02/04/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE/%E6%B7%B1%E5%85%A5%E5%89%96%E6%9E%90HTTP3%E5%8D%8F%E8%AE%AE/</li> <li>https://zhuanlan.zhihu.com/p/32553477</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/syn_drop/","title":"4.8 SYN \u62a5\u6587\u4ec0\u4e48\u65f6\u5019\u60c5\u51b5\u4e0b\u4f1a\u88ab\u4e22\u5f03\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e4b\u524d\u6709\u4e2a\u8bfb\u8005\u5728\u79cb\u62db\u9762\u8bd5\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u4e86\u8fd9\u4e48\u4e00\u4e2a\u95ee\u9898\uff1aSYN \u62a5\u6587\u4ec0\u4e48\u65f6\u5019\u60c5\u51b5\u4e0b\u4f1a\u88ab\u4e22\u5f03\uff1f</p> <p></p> <p>\u597d\u5bb6\u4f19\uff0c\u73b0\u5728\u9762\u8bd5\u90fd\u95ee\u90a3\u4e48\u7ec6\u8282\u4e86\u5417\uff1f</p> <p>\u4e0d\u8fc7\u8bdd\u8bf4\u56de\u6765\uff0c\u8fd9\u4e2a\u95ee\u9898\u8ddf\u5de5\u4f5c\u4e0a\u4e5f\u662f\u6709\u5173\u7cfb\u7684\uff0c\u56e0\u4e3a\u6211\u5c31\u5728\u5de5\u4f5c\u4e2d\u78b0\u5230\u8fd9\u4e48\u5947\u602a\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u8d77\u4e86\u8fde\u63a5\uff0c\u4f46\u662f\u8fde\u63a5\u5e76\u6ca1\u6709\u5efa\u7acb\u8d77\u6765\uff0c\u901a\u8fc7\u6293\u5305\u5206\u6790\u53d1\u73b0\uff0c\u670d\u52a1\u7aef\u662f\u6536\u5230 SYN \u62a5\u6587\u4e86\uff0c\u4f46\u662f\u5e76\u6ca1\u6709\u56de\u590d SYN+ACK\uff08TCP \u7b2c\u4e8c\u6b21\u63e1\u624b\uff09\uff0c\u8bf4\u660e SYN \u62a5\u6587\u88ab\u670d\u52a1\u7aef\u5ffd\u7565\u4e86\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u5c31\u4e00\u76f4\u5728\u8d85\u65f6\u91cd\u4f20 SYN \u62a5\u6587\uff0c\u76f4\u5230\u8fbe\u5230\u6700\u5927\u7684\u91cd\u4f20\u6b21\u6570\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u5c31\u7ed9\u51fa\u6211\u9047\u5230\u8fc7 SYN \u62a5\u6587\u88ab\u4e22\u5f03\u7684\u4e24\u79cd\u573a\u666f\uff1a</p> <ul> <li> <p>\u5f00\u542f tcp_tw_recycle \u53c2\u6570\uff0c\u5e76\u4e14\u5728 NAT \u73af\u5883\u4e0b\uff0c\u9020\u6210 SYN \u62a5\u6587\u88ab\u4e22\u5f03</p> </li> <li> <p>TCP \u4e24\u4e2a\u961f\u5217\u6ee1\u4e86\uff08\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\uff09\uff0c\u9020\u6210 SYN \u62a5\u6587\u88ab\u4e22\u5f03</p> </li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/syn_drop/#tcp_tw_recycle","title":"\u5751\u7239\u7684 tcp_tw_recycle","text":"<p>TCP \u56db\u6b21\u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5\u65b9\u4f1a\u6709\u4e00\u4e2a TIME_WAIT \u7684\u72b6\u6001\uff0c\u8fd9\u4e2a\u72b6\u6001\u4f1a\u6301\u7eed 2 MSL \u540e\u624d\u4f1a\u8f6c\u53d8\u4e3a CLOSED \u72b6\u6001\u3002</p> <p></p> <p>\u5728 Linux  \u64cd\u4f5c\u7cfb\u7edf\u4e0b\uff0cTIME_WAIT \u72b6\u6001\u7684\u6301\u7eed\u65f6\u95f4\u662f 60 \u79d2\uff0c\u8fd9\u610f\u5473\u7740\u8fd9 60 \u79d2\u5185\uff0c\u5ba2\u6237\u7aef\u4e00\u76f4\u4f1a\u5360\u7528\u7740\u8fd9\u4e2a\u7aef\u53e3\u3002\u8981\u77e5\u9053\uff0c\u7aef\u53e3\u8d44\u6e90\u4e5f\u662f\u6709\u9650\u7684\uff0c\u4e00\u822c\u53ef\u4ee5\u5f00\u542f\u7684\u7aef\u53e3\u4e3a 32768~61000\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u53c2\u6570\u8bbe\u7f6e\u6307\u5b9a\u8303\u56f4\uff1a</p> Text Only<pre><code> net.ipv4.ip_local_port_range\n</code></pre> <p>\u5982\u679c\u5ba2\u6237\u7aef\uff08\u53d1\u8d77\u8fde\u63a5\u65b9\uff09\u7684 TIME_WAIT \u72b6\u6001\u8fc7\u591a\uff0c\u5360\u6ee1\u4e86\u6240\u6709\u7aef\u53e3\u8d44\u6e90\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u5bf9\u300c\u76ee\u7684 IP+ \u76ee\u7684 PORT\u300d\u90fd\u4e00\u6837\u7684\u670d\u52a1\u5668\u53d1\u8d77\u8fde\u63a5\u4e86\uff0c\u4f46\u662f\u88ab\u4f7f\u7528\u7684\u7aef\u53e3\uff0c\u8fd8\u662f\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u5668\u53d1\u8d77\u8fde\u63a5\u7684\u3002\u5177\u4f53\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1a\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u5417\uff1f</p> <p>\u56e0\u6b64\uff0c\u5ba2\u6237\u7aef\uff08\u53d1\u8d77\u8fde\u63a5\u65b9\uff09\u90fd\u662f\u548c\u300c\u76ee\u7684 IP+ \u76ee\u7684 PORT\u300d\u90fd\u4e00\u6837\u7684\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u8bdd\uff0c\u5f53\u5ba2\u6237\u7aef\u7684 TIME_WAIT \u72b6\u6001\u8fde\u63a5\u8fc7\u591a\u7684\u8bdd\uff0c\u5c31\u4f1a\u53d7\u7aef\u53e3\u8d44\u6e90\u9650\u5236\uff0c\u5982\u679c\u5360\u6ee1\u4e86\u6240\u6709\u7aef\u53e3\u8d44\u6e90\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u518d\u8ddf\u300c\u76ee\u7684 IP+ \u76ee\u7684 PORT\u300d\u90fd\u4e00\u6837\u7684\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u4e86\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5373\u4f7f\u662f\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u53ea\u8981\u8fde\u63a5\u7684\u662f\u4e0d\u540c\u7684\u670d\u52a1\u5668\uff0c\u7aef\u53e3\u662f\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u8fd8\u662f\u53ef\u4ee5\u5411\u5176\u4ed6\u670d\u52a1\u5668\u53d1\u8d77\u8fde\u63a5\u7684\uff0c\u8fd9\u662f\u56e0\u4e3a\u5185\u6838\u5728\u5b9a\u4f4d\u4e00\u4e2a\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u662f\u901a\u8fc7\u56db\u5143\u7ec4\uff08\u6e90 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684 IP\u3001\u76ee\u7684\u7aef\u53e3\uff09\u4fe1\u606f\u6765\u5b9a\u4f4d\u7684\uff0c\u5e76\u4e0d\u4f1a\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u4e00\u6837\uff0c\u800c\u5bfc\u81f4\u8fde\u63a5\u51b2\u7a81\u3002</p> <p>\u4f46\u662f TIME_WAIT \u72b6\u6001\u4e5f\u4e0d\u662f\u6446\u8bbe\u4f5c\u7528\uff0c\u5b83\u7684\u4f5c\u7528\u6709\u4e24\u4e2a\uff1a</p> <ul> <li>\u9632\u6b62\u5177\u6709\u76f8\u540c\u56db\u5143\u7ec4\u7684\u65e7\u6570\u636e\u5305\u88ab\u6536\u5230\uff0c\u4e5f\u5c31\u662f\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u7684\u8fde\u63a5\u63a5\u53d7\uff0c\u5426\u5219\u5c31\u4f1a\u5bfc\u81f4\u540e\u9762\u7684\u8fde\u63a5\u6536\u5230\u4e00\u4e2a\u65e0\u6548\u7684\u6570\u636e\uff0c</li> <li>\u4fdd\u8bc1\u300c\u88ab\u52a8\u5173\u95ed\u8fde\u63a5\u300d\u7684\u4e00\u65b9\u80fd\u88ab\u6b63\u786e\u7684\u5173\u95ed\uff0c\u5373\u4fdd\u8bc1\u6700\u540e\u7684 ACK \u80fd\u8ba9\u88ab\u52a8\u5173\u95ed\u65b9\u63a5\u6536\uff0c\u4ece\u800c\u5e2e\u52a9\u5176\u6b63\u5e38\u5173\u95ed;</li> </ul> <p>\u4e0d\u8fc7\uff0cLinux \u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e24\u4e2a\u53ef\u4ee5\u7cfb\u7edf\u53c2\u6570\u6765\u5feb\u901f\u56de\u6536\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u90fd\u662f\u9ed8\u8ba4\u5173\u95ed\u7684\uff1a</p> <ul> <li>net.ipv4.tcp_tw_reuse\uff0c\u5982\u679c\u5f00\u542f\u8be5\u9009\u9879\u7684\u8bdd\uff0c\u5ba2\u6237\u7aef\uff08\u8fde\u63a5\u53d1\u8d77\u65b9\uff09\u5728\u8c03\u7528 connect() \u51fd\u6570\u65f6\uff0c\u5982\u679c\u5185\u6838\u9009\u62e9\u5230\u7684\u7aef\u53e3\uff0c\u5df2\u7ecf\u88ab\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u5360\u7528\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5224\u65ad\u8be5\u8fde\u63a5\u662f\u5426\u5904\u4e8e TIME_WAIT \u72b6\u6001\uff0c\u5982\u679c\u8be5\u8fde\u63a5\u5904\u4e8e TIME_WAIT \u72b6\u6001\u5e76\u4e14 TIME_WAIT \u72b6\u6001\u6301\u7eed\u7684\u65f6\u95f4\u8d85\u8fc7\u4e86 1 \u79d2\uff0c\u90a3\u4e48\u5c31\u4f1a\u91cd\u7528\u8fd9\u4e2a\u8fde\u63a5\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u8be5\u7aef\u53e3\u4e86\u3002\u6240\u4ee5\u8be5\u9009\u9879\u53ea\u9002\u7528\u4e8e\u8fde\u63a5\u53d1\u8d77\u65b9\u3002</li> <li>net.ipv4.tcp_tw_recycle\uff0c\u5982\u679c\u5f00\u542f\u8be5\u9009\u9879\u7684\u8bdd\uff0c\u5141\u8bb8\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u88ab\u5feb\u901f\u56de\u6536\uff1b</li> </ul> <p>\u8981\u4f7f\u5f97\u8fd9\u4e24\u4e2a\u9009\u9879\u751f\u6548\uff0c\u6709\u4e00\u4e2a\u524d\u63d0\u6761\u4ef6\uff0c\u5c31\u662f\u8981\u6253\u5f00 TCP \u65f6\u95f4\u6233\uff0c\u5373 net.ipv4.tcp_timestamps=1\uff08\u9ed8\u8ba4\u5373\u4e3a 1)\uff09\u3002</p> <p>tcp_tw_recycle \u5728\u4f7f\u7528\u4e86 NAT \u7684\u7f51\u7edc\u4e0b\u662f\u4e0d\u5b89\u5168\u7684\uff01</p> <p>\u5bf9\u4e8e\u670d\u52a1\u5668\u6765\u8bf4\uff0c\u5982\u679c\u540c\u65f6\u5f00\u542f\u4e86 recycle \u548c timestamps \u9009\u9879\uff0c\u5219\u4f1a\u5f00\u542f\u4e00\u79cd\u79f0\u4e4b\u4e3a\u300cper-host \u7684 PAWS \u673a\u5236\u300d\u3002</p> <p>\u9996\u5148\u7ed9\u5927\u5bb6\u8bf4\u8bf4\u4ec0\u4e48\u662f  PAWS \u673a\u5236\uff1f</p> <p>tcp_timestamps \u9009\u9879\u5f00\u542f\u4e4b\u540e\uff0cPAWS \u673a\u5236\u4f1a\u81ea\u52a8\u5f00\u542f\uff0c\u5b83\u7684\u4f5c\u7528\u662f\u9632\u6b62 TCP \u5305\u4e2d\u7684\u5e8f\u5217\u53f7\u53d1\u751f\u7ed5\u56de\u3002</p> <p>\u6b63\u5e38\u6765\u8bf4\u6bcf\u4e2a TCP \u5305\u90fd\u4f1a\u6709\u81ea\u5df1\u552f\u4e00\u7684 SEQ\uff0c\u51fa\u73b0 TCP \u6570\u636e\u5305\u91cd\u4f20\u7684\u65f6\u5019\u4f1a\u590d\u7528 SEQ \u53f7\uff0c\u8fd9\u6837\u63a5\u6536\u65b9\u80fd\u901a\u8fc7 SEQ \u53f7\u6765\u5224\u65ad\u6570\u636e\u5305\u7684\u552f\u4e00\u6027\uff0c\u4e5f\u80fd\u5728\u91cd\u590d\u6536\u5230\u67d0\u4e2a\u6570\u636e\u5305\u7684\u65f6\u5019\u5224\u65ad\u6570\u636e\u662f\u4e0d\u662f\u91cd\u4f20\u7684\u3002\u4f46\u662f TCP \u8fd9\u4e2a SEQ \u53f7\u662f\u6709\u9650\u7684\uff0c\u4e00\u5171 32 bit\uff0cSEQ \u5f00\u59cb\u662f\u9012\u589e\uff0c\u6ea2\u51fa\u4e4b\u540e\u4ece 0 \u5f00\u59cb\u518d\u6b21\u4f9d\u6b21\u9012\u589e\u3002</p> <p>\u6240\u4ee5\u5f53 SEQ \u53f7\u51fa\u73b0\u6ea2\u51fa\u540e\u5355\u7eaf\u901a\u8fc7 SEQ \u53f7\u65e0\u6cd5\u6807\u8bc6\u6570\u636e\u5305\u7684\u552f\u4e00\u6027\uff0c\u67d0\u4e2a\u6570\u636e\u5305\u5ef6\u8fdf\u6216\u56e0\u91cd\u53d1\u800c\u5ef6\u8fdf\u65f6\u53ef\u80fd\u5bfc\u81f4\u8fde\u63a5\u4f20\u9012\u7684\u6570\u636e\u88ab\u7834\u574f\uff0c\u6bd4\u5982\uff1a</p> <p></p> <p>\u4e0a\u56fe A \u6570\u636e\u5305\u51fa\u73b0\u4e86\u91cd\u4f20\uff0c\u5e76\u5728 SEQ \u53f7\u8017\u5c3d\u518d\u6b21\u4ece A \u9012\u589e\u65f6\uff0c\u7b2c\u4e00\u6b21\u53d1\u7684 A \u6570\u636e\u5305\u5ef6\u8fdf\u5230\u8fbe\u4e86 Server\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u5982\u679c\u6ca1\u6709\u522b\u7684\u673a\u5236\u6765\u4fdd\u8bc1\uff0cServer \u4f1a\u8ba4\u4e3a\u5ef6\u8fdf\u5230\u8fbe\u7684 A \u6570\u636e\u5305\u662f\u6b63\u786e\u7684\u800c\u63a5\u6536\uff0c\u53cd\u800c\u662f\u5c06\u6b63\u5e38\u7684\u7b2c\u4e09\u6b21\u53d1\u7684 SEQ \u4e3a A \u7684\u6570\u636e\u5305\u4e22\u5f03\uff0c\u9020\u6210\u6570\u636e\u4f20\u8f93\u9519\u8bef\u3002</p> <p>PAWS \u5c31\u662f\u4e3a\u4e86\u907f\u514d\u8fd9\u4e2a\u95ee\u9898\u800c\u4ea7\u751f\u7684\uff0c\u5728\u5f00\u542f tcp_timestamps \u9009\u9879\u60c5\u51b5\u4e0b\uff0c\u4e00\u53f0\u673a\u5668\u53d1\u7684\u6240\u6709 TCP \u5305\u90fd\u4f1a\u5e26\u4e0a\u53d1\u9001\u65f6\u7684\u65f6\u95f4\u6233\uff0cPAWS \u8981\u6c42\u8fde\u63a5\u53cc\u65b9\u7ef4\u62a4\u6700\u8fd1\u4e00\u6b21\u6536\u5230\u7684\u6570\u636e\u5305\u7684\u65f6\u95f4\u6233\uff08Recent TSval\uff09\uff0c\u6bcf\u6536\u5230\u4e00\u4e2a\u65b0\u6570\u636e\u5305\u90fd\u4f1a\u8bfb\u53d6\u6570\u636e\u5305\u4e2d\u7684\u65f6\u95f4\u6233\u503c\u8ddf Recent TSval \u503c\u505a\u6bd4\u8f83\uff0c\u5982\u679c\u53d1\u73b0\u6536\u5230\u7684\u6570\u636e\u5305\u4e2d\u65f6\u95f4\u6233\u4e0d\u662f\u9012\u589e\u7684\uff0c\u5219\u8868\u793a\u8be5\u6570\u636e\u5305\u662f\u8fc7\u671f\u7684\uff0c\u5c31\u4f1a\u76f4\u63a5\u4e22\u5f03\u8fd9\u4e2a\u6570\u636e\u5305\u3002</p> <p>\u5bf9\u4e8e\u4e0a\u9762\u56fe\u4e2d\u7684\u4f8b\u5b50\u6709\u4e86 PAWS \u673a\u5236\u5c31\u80fd\u505a\u5230\u5728\u6536\u5230 Delay \u5230\u8fbe\u7684 A \u53f7\u6570\u636e\u5305\u65f6\uff0c\u8bc6\u522b\u51fa\u5b83\u662f\u4e2a\u8fc7\u671f\u7684\u6570\u636e\u5305\u800c\u5c06\u5176\u4e22\u6389\u3002</p> <p>\u90a3\u4ec0\u4e48\u662f per-host \u7684 PAWS \u673a\u5236\u5462\uff1f</p> <p>\u524d\u9762\u6211\u63d0\u5230\uff0c\u5f00\u542f\u4e86 recycle \u548c timestamps \u9009\u9879\uff0c\u5c31\u4f1a\u5f00\u542f\u4e00\u79cd\u53eb per-host \u7684 PAWS \u673a\u5236\u3002per-host \u662f\u5bf9\u300c\u5bf9\u7aef IP \u505a PAWS \u68c0\u67e5\u300d\uff0c\u800c\u975e\u5bf9\u300cIP + \u7aef\u53e3\u300d\u56db\u5143\u7ec4\u505a PAWS \u68c0\u67e5\u3002</p> <p>\u4f46\u662f\u5982\u679c\u5ba2\u6237\u7aef\u7f51\u7edc\u73af\u5883\u662f\u7528\u4e86 NAT \u7f51\u5173\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u73af\u5883\u7684\u6bcf\u4e00\u53f0\u673a\u5668\u901a\u8fc7 NAT \u7f51\u5173\u540e\uff0c\u90fd\u4f1a\u662f\u76f8\u540c\u7684 IP \u5730\u5740\uff0c\u5728\u670d\u52a1\u7aef\u770b\u6765\uff0c\u5c31\u597d\u50cf\u53ea\u662f\u5728\u8ddf\u4e00\u4e2a\u5ba2\u6237\u7aef\u6253\u4ea4\u9053\u4e00\u6837\uff0c\u65e0\u6cd5\u533a\u5206\u51fa\u6765\u3002</p> <p>Per-host PAWS \u673a\u5236\u5229\u7528 TCP option \u91cc\u7684 timestamp \u5b57\u6bb5\u7684\u589e\u957f\u6765\u5224\u65ad\u4e32\u6270\u6570\u636e\uff0c\u800c timestamp \u662f\u6839\u636e\u5ba2\u6237\u7aef\u5404\u81ea\u7684 CPU tick \u5f97\u51fa\u7684\u503c\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef A \u901a\u8fc7 NAT \u7f51\u5173\u548c\u670d\u52a1\u5668\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u7136\u540e\u670d\u52a1\u5668\u4e3b\u52a8\u5173\u95ed\u5e76\u4e14\u5feb\u901f\u56de\u6536 TIME-WAIT \u72b6\u6001\u7684\u8fde\u63a5\u540e\uff0c\u5ba2\u6237\u7aef B \u4e5f\u901a\u8fc7 NAT \u7f51\u5173\u548c\u670d\u52a1\u5668\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u6ce8\u610f\u5ba2\u6237\u7aef A  \u548c \u5ba2\u6237\u7aef B \u56e0\u4e3a\u7ecf\u8fc7\u76f8\u540c\u7684 NAT \u7f51\u5173\uff0c\u6240\u4ee5\u662f\u7528\u76f8\u540c\u7684 IP \u5730\u5740\u4e0e\u670d\u52a1\u7aef\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u5982\u679c\u5ba2\u6237\u7aef B \u7684 timestamp \u6bd4 \u5ba2\u6237\u7aef A \u7684 timestamp \u5c0f\uff0c\u90a3\u4e48\u7531\u4e8e\u670d\u52a1\u7aef\u7684 per-host \u7684 PAWS \u673a\u5236\u7684\u4f5c\u7528\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u4e22\u5f03\u5ba2\u6237\u7aef\u4e3b\u673a B \u53d1\u6765\u7684 SYN \u5305\u3002</p> <p>\u56e0\u6b64\uff0ctcp_tw_recycle \u5728\u4f7f\u7528\u4e86 NAT \u7684\u7f51\u7edc\u4e0b\u662f\u5b58\u5728\u95ee\u9898\u7684\uff0c\u5982\u679c\u5b83\u662f\u5bf9 TCP \u56db\u5143\u7ec4\u505a PAWS \u68c0\u67e5\uff0c\u800c\u4e0d\u662f\u5bf9\u300c\u76f8\u540c\u7684 IP \u505a PAWS \u68c0\u67e5\u300d\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u5b58\u5728\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002</p> <p>\u7f51\u4e0a\u5f88\u591a\u535a\u5ba2\u90fd\u8bf4\u5f00\u542f tcp_tw_recycle \u53c2\u6570\u6765\u4f18\u5316 TCP\uff0c\u6211\u4fe1\u4f60\u4e2a\u9b3c\uff0c\u7cdf\u8001\u5934\u574f\u7684\u5f88\uff01</p> <p>tcp_tw_recycle \u5728 Linux 4.12 \u7248\u672c\u540e\uff0c\u76f4\u63a5\u53d6\u6d88\u4e86\u8fd9\u4e00\u53c2\u6570\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/syn_drop/#accpet","title":"accpet \u961f\u5217\u6ee1\u4e86","text":"<p>\u5728 TCP \u4e09\u6b21\u63e1\u624b\u7684\u65f6\u5019\uff0cLinux \u5185\u6838\u4f1a\u7ef4\u62a4\u4e24\u4e2a\u961f\u5217\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u534a\u8fde\u63a5\u961f\u5217\uff0c\u4e5f\u79f0 SYN \u961f\u5217\uff1b</li> <li>\u5168\u8fde\u63a5\u961f\u5217\uff0c\u4e5f\u79f0 accepet \u961f\u5217\uff1b</li> </ul> <p>\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u8d77\u7684 SYN \u8bf7\u6c42\u540e\uff0c\u5185\u6838\u4f1a\u628a\u8be5\u8fde\u63a5\u5b58\u50a8\u5230\u534a\u8fde\u63a5\u961f\u5217\uff0c\u5e76\u5411\u5ba2\u6237\u7aef\u54cd\u5e94 SYN+ACK\uff0c\u63a5\u7740\u5ba2\u6237\u7aef\u4f1a\u8fd4\u56de ACK\uff0c\u670d\u52a1\u7aef\u6536\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\u7684 ACK \u540e\uff0c\u5185\u6838\u4f1a\u628a\u8fde\u63a5\u4ece\u534a\u8fde\u63a5\u961f\u5217\u79fb\u9664\uff0c\u7136\u540e\u521b\u5efa\u65b0\u7684\u5b8c\u5168\u7684\u8fde\u63a5\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u5230 accept \u961f\u5217\uff0c\u7b49\u5f85\u8fdb\u7a0b\u8c03\u7528 accept \u51fd\u6570\u65f6\u628a\u8fde\u63a5\u53d6\u51fa\u6765\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/syn_drop/#_1","title":"\u534a\u8fde\u63a5\u961f\u5217\u6ee1\u4e86","text":"<p>\u5f53\u670d\u52a1\u5668\u9020\u6210 syn \u653b\u51fb\uff0c\u5c31\u6709\u53ef\u80fd\u5bfc\u81f4 TCP \u534a\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u8fd9\u65f6\u540e\u9762\u6765\u7684 syn \u5305\u90fd\u4f1a\u88ab\u4e22\u5f03\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u5f00\u542f\u4e86 syncookies \u529f\u80fd\uff0c\u5373\u4f7f\u534a\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u4e22\u5f03 syn \u5305\u3002</p> <p>syncookies \u662f\u8fd9\u4e48\u505a\u7684\uff1a\u670d\u52a1\u5668\u6839\u636e\u5f53\u524d\u72b6\u6001\u8ba1\u7b97\u51fa\u4e00\u4e2a\u503c\uff0c\u653e\u5728\u5df1\u65b9\u53d1\u51fa\u7684 SYN+ACK \u62a5\u6587\u4e2d\u53d1\u51fa\uff0c\u5f53\u5ba2\u6237\u7aef\u8fd4\u56de ACK \u62a5\u6587\u65f6\uff0c\u53d6\u51fa\u8be5\u503c\u9a8c\u8bc1\uff0c\u5982\u679c\u5408\u6cd5\uff0c\u5c31\u8ba4\u4e3a\u8fde\u63a5\u5efa\u7acb\u6210\u529f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>syncookies \u53c2\u6570\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u4e2a\u503c\uff1a</p> <ul> <li>0 \u503c\uff0c\u8868\u793a\u5173\u95ed\u8be5\u529f\u80fd\uff1b</li> <li>1 \u503c\uff0c\u8868\u793a\u4ec5\u5f53 SYN \u534a\u8fde\u63a5\u961f\u5217\u653e\u4e0d\u4e0b\u65f6\uff0c\u518d\u542f\u7528\u5b83\uff1b</li> <li>2 \u503c\uff0c\u8868\u793a\u65e0\u6761\u4ef6\u5f00\u542f\u529f\u80fd\uff1b</li> </ul> <p>\u90a3\u4e48\u5728\u5e94\u5bf9 SYN \u653b\u51fb\u65f6\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u4e3a 1 \u5373\u53ef\uff1a</p> <p></p> <p>\u8fd9\u91cc\u7ed9\u51fa\u51e0\u79cd\u9632\u5fa1 SYN \u653b\u51fb\u7684\u65b9\u6cd5\uff1a</p> <ul> <li>\u589e\u5927\u534a\u8fde\u63a5\u961f\u5217\uff1b</li> <li>\u5f00\u542f tcp_syncookies \u529f\u80fd</li> <li>\u51cf\u5c11 SYN+ACK \u91cd\u4f20\u6b21\u6570</li> </ul> <p>\u65b9\u5f0f\u4e00\uff1a\u589e\u5927\u534a\u8fde\u63a5\u961f\u5217</p> <p>\u8981\u60f3\u589e\u5927\u534a\u8fde\u63a5\u961f\u5217\uff0c\u6211\u4eec\u5f97\u77e5\u4e0d\u80fd\u53ea\u5355\u7eaf\u589e\u5927 tcp_max_syn_backlog \u7684\u503c\uff0c\u8fd8\u9700\u4e00\u540c\u589e\u5927 somaxconn \u548c backlog\uff0c\u4e5f\u5c31\u662f\u589e\u5927\u5168\u8fde\u63a5\u961f\u5217\u3002\u5426\u5219\uff0c\u53ea\u5355\u7eaf\u589e\u5927 tcp_max_syn_backlog \u662f\u65e0\u6548\u7684\u3002</p> <p>\u589e\u5927 tcp_max_syn_backlog \u548c somaxconn \u7684\u65b9\u6cd5\u662f\u4fee\u6539 Linux \u5185\u6838\u53c2\u6570\uff1a</p> <p></p> <p>\u589e\u5927 backlog \u7684\u65b9\u5f0f\uff0c\u6bcf\u4e2a Web \u670d\u52a1\u90fd\u4e0d\u540c\uff0c\u6bd4\u5982 Nginx \u589e\u5927 backlog \u7684\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <p></p> <p>\u6700\u540e\uff0c\u6539\u53d8\u4e86\u5982\u4e0a\u8fd9\u4e9b\u53c2\u6570\u540e\uff0c\u8981\u91cd\u542f Nginx \u670d\u52a1\uff0c\u56e0\u4e3a\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u90fd\u662f\u5728 listen() \u521d\u59cb\u5316\u7684\u3002</p> <p>\u65b9\u5f0f\u4e8c\uff1a\u5f00\u542f tcp_syncookies \u529f\u80fd</p> <p>\u5f00\u542f tcp_syncookies \u529f\u80fd\u7684\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u4fee\u6539 Linux \u5185\u6838\u53c2\u6570\uff1a</p> <p></p> <p>\u65b9\u5f0f\u4e09\uff1a\u51cf\u5c11 SYN+ACK \u91cd\u4f20\u6b21\u6570</p> <p>\u5f53\u670d\u52a1\u7aef\u53d7\u5230 SYN \u653b\u51fb\u65f6\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684 TCP \u8fde\u63a5\uff0c\u5904\u4e8e\u8fd9\u4e2a\u72b6\u6001\u7684 TCP \u4f1a\u91cd\u4f20 SYN+ACK\uff0c\u5f53\u91cd\u4f20\u8d85\u8fc7\u6b21\u6570\u8fbe\u5230\u4e0a\u9650\u540e\uff0c\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</p> <p>\u90a3\u4e48\u9488\u5bf9 SYN \u653b\u51fb\u7684\u573a\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u51cf\u5c11 SYN+ACK \u7684\u91cd\u4f20\u6b21\u6570\uff0c\u4ee5\u52a0\u5feb\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684 TCP \u8fde\u63a5\u65ad\u5f00\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/syn_drop/#_2","title":"\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86","text":"<p>\u5728\u670d\u52a1\u7aef\u5e76\u53d1\u5904\u7406\u5927\u91cf\u8bf7\u6c42\u65f6\uff0c\u5982\u679c TCP accpet \u961f\u5217\u8fc7\u5c0f\uff0c\u6216\u8005\u5e94\u7528\u7a0b\u5e8f\u8c03\u7528 accept() \u4e0d\u53ca\u65f6\uff0c\u5c31\u4f1a\u9020\u6210 accpet \u961f\u5217\u6ee1\u4e86\uff0c\u8fd9\u65f6\u540e\u7eed\u7684\u8fde\u63a5\u5c31\u4f1a\u88ab\u4e22\u5f03\uff0c\u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0\u670d\u52a1\u7aef\u8bf7\u6c42\u6570\u91cf\u4e0a\u4e0d\u53bb\u7684\u73b0\u8c61\u3002</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 ss \u547d\u4ee4\u6765\u770b accpet \u961f\u5217\u5927\u5c0f\uff0c\u5728\u300cLISTEN \u72b6\u6001\u300d\u65f6\uff0c<code>Recv-Q/Send-Q</code> \u8868\u793a\u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>Recv-Q\uff1a\u5f53\u524d accpet \u961f\u5217\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u5f53\u524d\u5df2\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\u5e76\u7b49\u5f85\u670d\u52a1\u7aef <code>accept()</code> \u7684 TCP \u8fde\u63a5\u4e2a\u6570\uff1b</li> <li>Send-Q\uff1a\u5f53\u524d accpet \u6700\u5927\u961f\u5217\u957f\u5ea6\uff0c\u4e0a\u9762\u7684\u8f93\u51fa\u7ed3\u679c\u8bf4\u660e\u76d1\u542c 8088 \u7aef\u53e3\u7684 TCP \u670d\u52a1\u8fdb\u7a0b\uff0caccpet \u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\u4e3a 128\uff1b</li> </ul> <p>\u5982\u679c Recv-Q \u7684\u5927\u5c0f\u8d85\u8fc7 Send-Q\uff0c\u5c31\u8bf4\u660e\u53d1\u751f\u4e86 accpet \u961f\u5217\u6ee1\u7684\u60c5\u51b5\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\uff1a</p> <ul> <li>\u8c03\u5927 accpet \u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\uff0c\u8c03\u5927\u7684\u65b9\u5f0f\u662f\u901a\u8fc7\u8c03\u5927 backlog \u4ee5\u53ca somaxconn \u53c2\u6570\u3002</li> <li>\u68c0\u67e5\u7cfb\u7edf\u6216\u8005\u4ee3\u7801\u4e3a\u4ec0\u4e48\u8c03\u7528 accept()  \u4e0d\u53ca\u65f6\uff1b</li> </ul> <p>\u5173\u4e8e SYN \u961f\u5217\u548c accpet \u961f\u5217\uff0c\u6211\u4e4b\u524d\u5199\u8fc7\u4e00\u7bc7\u5f88\u8be6\u7ec6\u7684\u6587\u7ae0\uff1aTCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u53c8\u8be5\u5982\u4f55\u5e94\u5bf9\uff1f</p> <p>\u597d\u4e86\uff0c\u4eca\u5929\u5c31\u5206\u4eab\u5230\u8fd9\u91cc\u5566\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_down_and_crash/","title":"4.12 TCP \u8fde\u63a5\uff0c\u4e00\u7aef\u65ad\u7535\u548c\u8fdb\u7a0b\u5d29\u6e83\u6709\u4ec0\u4e48\u533a\u522b\uff1f","text":"<p>\u6709\u4f4d\u8bfb\u8005\u627e\u6211\u8bf4\uff0c\u4ed6\u5728\u9762\u8bd5\u817e\u8baf\u7684\u65f6\u5019\uff0c\u9047\u5230\u4e86\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u5c5e\u4e8e TCP \u5f02\u5e38\u65ad\u5f00\u8fde\u63a5\u7684\u573a\u666f\uff0c\u8fd9\u90e8\u5206\u5185\u5bb9\u5728\u6211\u7684\u300c\u56fe\u89e3\u7f51\u7edc\u300d\u8fd8\u6ca1\u6709\u8be6\u7ec6\u4ecb\u7ecd\u8fc7\uff0c\u8fd9\u6b21\u5c31\u4e58\u7740\u8fd9\u6b21\u673a\u4f1a\u8865\u4e00\u8865\u3002</p> <p></p> <p>\u8fd9\u4e2a\u95ee\u9898\u6709\u51e0\u4e2a\u5173\u952e\u8bcd\uff1a</p> <ul> <li>\u6ca1\u6709\u5f00\u542f keepalive\uff1b</li> <li>\u4e00\u76f4\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\uff1b</li> <li>\u8fdb\u7a0b\u5d29\u6e83\uff1b</li> <li>\u4e3b\u673a\u5d29\u6e83\uff1b</li> </ul> <p>\u6211\u4eec\u5148\u6765\u8ba4\u8bc6\u8ba4\u8bc6\u4ec0\u4e48\u662f TCP keepalive \u5462\uff1f</p> <p>\u8fd9\u4e1c\u897f\u5176\u5b9e\u5c31\u662f TCP \u7684\u4fdd\u6d3b\u673a\u5236\uff0c\u5b83\u7684\u5de5\u4f5c\u539f\u7406\u6211\u4e4b\u524d\u7684\u6587\u7ae0\u5199\u8fc7\uff0c\u8fd9\u91cc\u5c31\u76f4\u63a5\u8d34\u4e0b\u4ee5\u524d\u7684\u5185\u5bb9\u3002</p> <p></p> <p>\u5982\u679c\u4e24\u7aef\u7684 TCP \u8fde\u63a5\u4e00\u76f4\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\uff0c\u8fbe\u5230\u4e86\u89e6\u53d1 TCP \u4fdd\u6d3b\u673a\u5236\u7684\u6761\u4ef6\uff0c\u90a3\u4e48\u5185\u6838\u91cc\u7684 TCP \u534f\u8bae\u6808\u5c31\u4f1a\u53d1\u9001\u63a2\u6d4b\u62a5\u6587\u3002 - \u5982\u679c\u5bf9\u7aef\u7a0b\u5e8f\u662f\u6b63\u5e38\u5de5\u4f5c\u7684\u3002\u5f53 TCP \u4fdd\u6d3b\u7684\u63a2\u6d4b\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u7aef\uff0c\u5bf9\u7aef\u4f1a\u6b63\u5e38\u54cd\u5e94\uff0c\u8fd9\u6837 TCP \u4fdd\u6d3b\u65f6\u95f4\u4f1a\u88ab\u91cd\u7f6e\uff0c\u7b49\u5f85\u4e0b\u4e00\u4e2a TCP \u4fdd\u6d3b\u65f6\u95f4\u7684\u5230\u6765\u3002 - \u5982\u679c\u5bf9\u7aef\u4e3b\u673a\u5d29\u6e83\uff0c\u6216\u5bf9\u7aef\u7531\u4e8e\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\u62a5\u6587\u4e0d\u53ef\u8fbe\u3002\u5f53 TCP \u4fdd\u6d3b\u7684\u63a2\u6d4b\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u7aef\u540e\uff0c\u77f3\u6c89\u5927\u6d77\uff0c\u6ca1\u6709\u54cd\u5e94\uff0c\u8fde\u7eed\u51e0\u6b21\uff0c\u8fbe\u5230\u4fdd\u6d3b\u63a2\u6d4b\u6b21\u6570\u540e\uff0cTCP \u4f1a\u62a5\u544a\u8be5 TCP \u8fde\u63a5\u5df2\u7ecf\u6b7b\u4ea1\u3002</p> <p>\u6240\u4ee5\uff0cTCP \u4fdd\u6d3b\u673a\u5236\u53ef\u4ee5\u5728\u53cc\u65b9\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\u7684\u60c5\u51b5\uff0c\u901a\u8fc7\u63a2\u6d4b\u62a5\u6587\uff0c\u6765\u786e\u5b9a\u5bf9\u65b9\u7684 TCP \u8fde\u63a5\u662f\u5426\u5b58\u6d3b\u3002</p> <p></p> <p>\u6ce8\u610f\uff0c\u5e94\u7528\u7a0b\u5e8f\u82e5\u60f3\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\u9700\u8981\u901a\u8fc7 socket \u63a5\u53e3\u8bbe\u7f6e <code>SO_KEEPALIVE</code> \u9009\u9879\u624d\u80fd\u591f\u751f\u6548\uff0c\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_down_and_crash/#_1","title":"\u4e3b\u673a\u5d29\u6e83","text":"<p>\u77e5\u9053\u4e86 TCP keepalive \u4f5c\u7528\uff0c\u6211\u4eec\u518d\u56de\u8fc7\u5934\u770b\u9898\u76ee\u4e2d\u7684\u300c\u4e3b\u673a\u5d29\u6e83\u300d\u8fd9\u79cd\u60c5\u51b5\u3002</p> <p>\u5728\u6ca1\u6709\u5f00\u542f TCP keepalive\uff0c\u4e14\u53cc\u65b9\u4e00\u76f4\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u7684\u300c\u4e3b\u673a\u5d29\u6e83\u300d\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\u3002</p> <p>\u5ba2\u6237\u7aef\u4e3b\u673a\u5d29\u6e83\u4e86\uff0c\u670d\u52a1\u7aef\u662f\u65e0\u6cd5\u611f\u77e5\u5230\u7684\uff0c\u5728\u52a0\u4e0a\u670d\u52a1\u7aef\u6ca1\u6709\u5f00\u542f TCP keepalive\uff0c\u53c8\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\u7684\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u5c06\u4f1a\u4e00\u76f4\u5904\u4e8e ESTABLISHED \u8fde\u63a5\u72b6\u6001\uff0c\u76f4\u5230\u670d\u52a1\u7aef\u91cd\u542f\u8fdb\u7a0b\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\u4e00\u4e2a\u70b9\uff0c\u5728\u6ca1\u6709\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\u4e14\u53cc\u65b9\u4e0d\u4f20\u8f93\u6570\u636e\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u65b9\u7684 TCP \u8fde\u63a5\u5904\u5728 ESTABLISHED \u72b6\u6001\uff0c\u5e76\u4e0d\u4ee3\u8868\u53e6\u4e00\u65b9\u7684\u8fde\u63a5\u8fd8\u4e00\u5b9a\u6b63\u5e38\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_down_and_crash/#_2","title":"\u8fdb\u7a0b\u5d29\u6e83","text":"<p>\u90a3\u9898\u76ee\u4e2d\u7684\u300c\u8fdb\u7a0b\u5d29\u6e83\u300d\u7684\u60c5\u51b5\u5462\uff1f</p> <p>TCP \u7684\u8fde\u63a5\u4fe1\u606f\u662f\u7531\u5185\u6838\u7ef4\u62a4\u7684\uff0c\u6240\u4ee5\u5f53\u670d\u52a1\u7aef\u7684\u8fdb\u7a0b\u5d29\u6e83\u540e\uff0c\u5185\u6838\u9700\u8981\u56de\u6536\u8be5\u8fdb\u7a0b\u7684\u6240\u6709 TCP \u8fde\u63a5\u8d44\u6e90\uff0c\u4e8e\u662f\u5185\u6838\u4f1a\u53d1\u9001\u7b2c\u4e00\u6b21\u6325\u624b FIN \u62a5\u6587\uff0c\u540e\u7eed\u7684\u6325\u624b\u8fc7\u7a0b\u4e5f\u90fd\u662f\u5728\u5185\u6838\u5b8c\u6210\uff0c\u5e76\u4e0d\u9700\u8981\u8fdb\u7a0b\u7684\u53c2\u4e0e\uff0c\u6240\u4ee5\u5373\u4f7f\u670d\u52a1\u7aef\u7684\u8fdb\u7a0b\u9000\u51fa\u4e86\uff0c\u8fd8\u662f\u80fd\u4e0e\u5ba2\u6237\u7aef\u5b8c\u6210 TCP \u56db\u6b21\u6325\u624b\u7684\u8fc7\u7a0b\u3002</p> <p>\u6211\u81ea\u5df1\u505a\u4e86\u5b9e\u9a8c\uff0c\u4f7f\u7528 kill -9 \u6765\u6a21\u62df\u8fdb\u7a0b\u5d29\u6e83\u7684\u60c5\u51b5\uff0c\u53d1\u73b0\u5728 kill \u6389\u8fdb\u7a0b\u540e\uff0c\u670d\u52a1\u7aef\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c\u56db\u6b21\u6325\u624b\u3002</p> <p>\u6240\u4ee5\uff0c\u5373\u4f7f\u6ca1\u6709\u5f00\u542f TCP keepalive\uff0c\u4e14\u53cc\u65b9\u4e5f\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5176\u4e2d\u4e00\u65b9\u7684\u8fdb\u7a0b\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u64cd\u4f5c\u7cfb\u7edf\u662f\u53ef\u4ee5\u611f\u77e5\u7684\u5230\u7684\uff0c\u4e8e\u662f\u5c31\u4f1a\u53d1\u9001 FIN \u62a5\u6587\u7ed9\u5bf9\u65b9\uff0c\u7136\u540e\u4e0e\u5bf9\u65b9\u8fdb\u884c TCP \u56db\u6b21\u6325\u624b\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_down_and_crash/#_3","title":"\u6709\u6570\u636e\u4f20\u8f93\u7684\u573a\u666f","text":"<p>\u4ee5\u4e0a\u5c31\u662f\u5bf9\u8fd9\u4e2a\u9762\u8bd5\u9898\u7684\u56de\u7b54\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b\u5728\u300c\u6709\u6570\u636e\u4f20\u8f93\u300d\u7684\u573a\u666f\u4e0b\u7684\u4e00\u4e9b\u5f02\u5e38\u60c5\u51b5\uff1a</p> <ul> <li>\u7b2c\u4e00\u79cd\uff0c\u5ba2\u6237\u7aef\u4e3b\u673a\u5b95\u673a\uff0c\u53c8\u8fc5\u901f\u91cd\u542f\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</li> <li>\u7b2c\u4e8c\u79cd\uff0c\u5ba2\u6237\u7aef\u4e3b\u673a\u5b95\u673a\uff0c\u4e00\u76f4\u6ca1\u6709\u91cd\u542f\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_down_and_crash/#_4","title":"\u5ba2\u6237\u7aef\u4e3b\u673a\u5b95\u673a\uff0c\u53c8\u8fc5\u901f\u91cd\u542f","text":"<p>\u5728\u5ba2\u6237\u7aef\u4e3b\u673a\u5b95\u673a\u540e\uff0c\u670d\u52a1\u7aef\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u62a5\u6587\u4f1a\u5f97\u4e0d\u5230\u4efb\u4f55\u7684\u54cd\u5e94\uff0c\u5728\u4e00\u5b9a\u65f6\u957f\u540e\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u91cd\u4f20\u672a\u5f97\u5230\u54cd\u5e94\u7684\u62a5\u6587\u3002</p> <p>\u670d\u52a1\u7aef\u91cd\u4f20\u62a5\u6587\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u4e3b\u673a\u91cd\u542f\u5b8c\u6210\u540e\uff0c\u5ba2\u6237\u7aef\u7684\u5185\u6838\u5c31\u4f1a\u63a5\u6536\u91cd\u4f20\u7684\u62a5\u6587\uff0c\u7136\u540e\u6839\u636e\u62a5\u6587\u7684\u4fe1\u606f\u4f20\u9012\u7ed9\u5bf9\u5e94\u7684\u8fdb\u7a0b\uff1a - \u5982\u679c\u5ba2\u6237\u7aef\u4e3b\u673a\u4e0a\u6ca1\u6709\u8fdb\u7a0b\u7ed1\u5b9a\u8be5 TCP \u62a5\u6587\u7684\u76ee\u6807\u7aef\u53e3\u53f7\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5185\u6838\u5c31\u4f1a\u56de\u590d RST \u62a5\u6587\uff0c\u91cd\u7f6e\u8be5 TCP \u8fde\u63a5\uff1b - \u5982\u679c\u5ba2\u6237\u7aef\u4e3b\u673a\u4e0a\u6709\u8fdb\u7a0b\u7ed1\u5b9a\u8be5 TCP \u62a5\u6587\u7684\u76ee\u6807\u7aef\u53e3\u53f7\uff0c\u7531\u4e8e\u5ba2\u6237\u7aef\u4e3b\u673a\u91cd\u542f\u540e\uff0c\u4e4b\u524d\u7684 TCP \u8fde\u63a5\u7684\u6570\u636e\u7ed3\u6784\u5df2\u7ecf\u4e22\u5931\u4e86\uff0c\u5ba2\u6237\u7aef\u5185\u6838\u91cc\u534f\u8bae\u6808\u4f1a\u53d1\u73b0\u627e\u4e0d\u5230\u8be5 TCP \u8fde\u63a5\u7684 socket \u7ed3\u6784\u4f53\uff0c\u4e8e\u662f\u5c31\u4f1a\u56de\u590d RST \u62a5\u6587\uff0c\u91cd\u7f6e\u8be5 TCP \u8fde\u63a5\u3002</p> <p>\u6240\u4ee5\uff0c\u53ea\u8981\u6709\u4e00\u65b9\u91cd\u542f\u5b8c\u6210\u540e\uff0c\u6536\u5230\u4e4b\u524d TCP \u8fde\u63a5\u7684\u62a5\u6587\uff0c\u90fd\u4f1a\u56de\u590d RST \u62a5\u6587\uff0c\u4ee5\u65ad\u5f00\u8fde\u63a5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_down_and_crash/#_5","title":"\u5ba2\u6237\u7aef\u4e3b\u673a\u5b95\u673a\uff0c\u4e00\u76f4\u6ca1\u6709\u91cd\u542f","text":"<p>\u8fd9\u79cd\u60c5\u51b5\uff0c\u670d\u52a1\u7aef\u8d85\u65f6\u91cd\u4f20\u62a5\u6587\u7684\u6b21\u6570\u8fbe\u5230\u4e00\u5b9a\u9608\u503c\u540e\uff0c\u5185\u6838\u5c31\u4f1a\u5224\u5b9a\u51fa\u8be5 TCP \u6709\u95ee\u9898\uff0c\u7136\u540e\u901a\u8fc7 Socket \u63a5\u53e3\u544a\u8bc9\u5e94\u7528\u7a0b\u5e8f\u8be5 TCP \u8fde\u63a5\u51fa\u95ee\u9898\u4e86\uff0c\u4e8e\u662f\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u5c31\u4f1a\u65ad\u5f00\u3002</p> <p></p> <p>\u90a3 TCP \u7684\u6570\u636e\u62a5\u6587\u5177\u4f53\u91cd\u4f20\u51e0\u6b21\u5462\uff1f</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u63d0\u4f9b\u4e00\u4e2a\u53eb tcp_retries2 \u914d\u7f6e\u9879\uff0c\u9ed8\u8ba4\u503c\u662f 15\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u5185\u6838\u53c2\u6570\u662f\u63a7\u5236\uff0c\u5728 TCP \u8fde\u63a5\u5efa\u7acb\u7684\u60c5\u51b5\u4e0b\uff0c\u8d85\u65f6\u91cd\u4f20\u7684\u6700\u5927\u6b21\u6570\u3002</p> <p>\u4e0d\u8fc7 tcp_retries2 \u8bbe\u7f6e\u4e86 15 \u6b21\uff0c\u5e76\u4e0d\u4ee3\u8868 TCP \u8d85\u65f6\u91cd\u4f20\u4e86 15 \u6b21\u624d\u4f1a\u901a\u77e5\u5e94\u7528\u7a0b\u5e8f\u7ec8\u6b62\u8be5 TCP \u8fde\u63a5\uff0c\u5185\u6838\u4f1a\u6839\u636e tcp_retries2 \u8bbe\u7f6e\u7684\u503c\uff0c\u8ba1\u7b97\u51fa\u4e00\u4e2a timeout\uff08\u5982\u679c tcp_retries2 =15\uff0c\u90a3\u4e48\u8ba1\u7b97\u5f97\u5230\u7684 timeout = 924600 ms\uff09\uff0c\u5982\u679c\u91cd\u4f20\u95f4\u9694\u8d85\u8fc7\u8fd9\u4e2a timeout\uff0c\u5219\u8ba4\u4e3a\u8d85\u8fc7\u4e86\u9608\u503c\uff0c\u5c31\u4f1a\u505c\u6b62\u91cd\u4f20\uff0c\u7136\u540e\u5c31\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\u3002</p> <p>\u5728\u53d1\u751f\u8d85\u65f6\u91cd\u4f20\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e00\u8f6e\u7684\u8d85\u65f6\u65f6\u95f4\uff08RTO\uff09\u90fd\u662f\u500d\u6570\u589e\u957f\u7684\uff0c\u6bd4\u5982\u5982\u679c\u7b2c\u4e00\u8f6e RTO \u662f 200 \u6beb\u79d2\uff0c\u90a3\u4e48\u7b2c\u4e8c\u8f6e RTO \u662f 400 \u6beb\u79d2\uff0c\u7b2c\u4e09\u8f6e RTO \u662f 800 \u6beb\u79d2\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002</p> <p>\u800c RTO \u662f\u57fa\u4e8e RTT\uff08\u4e00\u4e2a\u5305\u7684\u5f80\u8fd4\u65f6\u95f4\uff09\u6765\u8ba1\u7b97\u7684\uff0c\u5982\u679c RTT \u8f83\u5927\uff0c\u90a3\u4e48\u8ba1\u7b97\u51fa\u6765\u7684 RTO \u5c31\u8d8a\u5927\uff0c\u90a3\u4e48\u7ecf\u8fc7\u51e0\u8f6e\u91cd\u4f20\u540e\uff0c\u5f88\u5feb\u5c31\u8fbe\u5230\u4e86\u4e0a\u9762\u7684 timeout \u503c\u4e86\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c tcp_retries2 =15\uff0c\u90a3\u4e48\u8ba1\u7b97\u5f97\u5230\u7684 timeout = 924600 ms\uff0c\u5982\u679c\u91cd\u4f20\u603b\u95f4\u9694\u65f6\u957f\u8fbe\u5230\u4e86 timeout \u5c31\u4f1a\u505c\u6b62\u91cd\u4f20\uff0c\u7136\u540e\u5c31\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\uff1a</p> <ul> <li>\u5982\u679c RTT \u6bd4\u8f83\u5c0f\uff0c\u90a3\u4e48 RTO \u521d\u59cb\u503c\u5c31\u7ea6\u7b49\u4e8e\u4e0b\u9650 200ms\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u8f6e\u7684\u8d85\u65f6\u65f6\u95f4\u662f 200 \u6beb\u79d2\uff0c\u7531\u4e8e timeout \u603b\u65f6\u957f\u662f 924600 ms\uff0c\u8868\u73b0\u51fa\u6765\u7684\u73b0\u8c61\u521a\u597d\u5c31\u662f\u91cd\u4f20\u4e86 15 \u6b21\uff0c\u8d85\u8fc7\u4e86 timeout \u503c\uff0c\u4ece\u800c\u65ad\u5f00 TCP \u8fde\u63a5</li> <li>\u5982\u679c RTT \u6bd4\u8f83\u5927\uff0c\u5047\u8bbe RTO \u521d\u59cb\u503c\u8ba1\u7b97\u5f97\u5230\u7684\u662f 1000 ms\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u8f6e\u7684\u8d85\u65f6\u65f6\u95f4\u662f 1 \u79d2\uff0c\u90a3\u4e48\u6839\u672c\u4e0d\u9700\u8981\u91cd\u4f20 15 \u6b21\uff0c\u91cd\u4f20\u603b\u95f4\u9694\u5c31\u4f1a\u8d85\u8fc7 924600 ms\u3002</li> </ul> <p>\u6700\u5c0f RTO \u548c\u6700\u5927 RTO \u662f\u5728 Linux \u5185\u6838\u4e2d\u5b9a\u4e49\u597d\u4e86\uff1a</p> C<pre><code>#define TCP_RTO_MAX ((unsigned)(120*HZ))\n#define TCP_RTO_MIN ((unsigned)(HZ/5))\n</code></pre> <p>Linux 2.6+ \u4f7f\u7528 1000 \u6beb\u79d2\u7684 HZ\uff0c\u56e0\u6b64<code>TCP_RTO_MIN</code>\u7ea6\u4e3a 200 \u6beb\u79d2\uff0c<code>TCP_RTO_MAX</code>\u7ea6\u4e3a 120 \u79d2\u3002</p> <p>\u5982\u679c<code>tcp_retries</code>\u8bbe\u7f6e\u4e3a<code>15</code>\uff0c\u4e14  RTT \u6bd4\u8f83\u5c0f\uff0c\u90a3\u4e48 RTO \u521d\u59cb\u503c\u5c31\u7ea6\u7b49\u4e8e\u4e0b\u9650 200ms\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u9700\u8981 924.6 \u79d2\u624d\u80fd\u5c06\u65ad\u5f00\u7684 TCP \u8fde\u63a5\u901a\u77e5\u7ed9\u4e0a\u5c42\uff08\u5373\u5e94\u7528\u7a0b\u5e8f\uff09\uff0c\u6bcf\u4e00\u8f6e\u7684 RTO \u589e\u957f\u5173\u7cfb\u5982\u4e0b\u8868\u683c\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_down_and_crash/#_6","title":"\u603b\u7ed3","text":"<p>\u5982\u679c\u300c\u5ba2\u6237\u7aef\u8fdb\u7a0b\u5d29\u6e83\u300d\uff0c\u5ba2\u6237\u7aef\u7684\u8fdb\u7a0b\u5728\u53d1\u751f\u5d29\u6e83\u7684\u65f6\u5019\uff0c\u5185\u6838\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u4e0e\u670d\u52a1\u7aef\u8fdb\u884c\u56db\u6b21\u6325\u624b\u3002</p> <p>\u4f46\u662f\uff0c\u300c\u5ba2\u6237\u7aef\u4e3b\u673a\u5b95\u673a\u300d\uff0c\u90a3\u4e48\u662f\u4e0d\u4f1a\u53d1\u751f\u56db\u6b21\u6325\u624b\u7684\uff0c\u5177\u4f53\u540e\u7eed\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u8fd8\u8981\u770b\u670d\u52a1\u7aef\u4f1a\u4e0d\u4f1a\u53d1\u9001\u6570\u636e\uff1f</p> <ul> <li>\u5982\u679c\u670d\u52a1\u7aef\u4f1a\u53d1\u9001\u6570\u636e\uff0c\u7531\u4e8e\u5ba2\u6237\u7aef\u5df2\u7ecf\u4e0d\u5b58\u5728\uff0c\u6536\u4e0d\u5230\u6570\u636e\u62a5\u6587\u7684\u54cd\u5e94\u62a5\u6587\uff0c\u670d\u52a1\u7aef\u7684\u6570\u636e\u62a5\u6587\u4f1a\u8d85\u65f6\u91cd\u4f20\uff0c\u5f53\u91cd\u4f20\u603b\u95f4\u9694\u65f6\u957f\u8fbe\u5230\u4e00\u5b9a\u9608\u503c\uff08\u5185\u6838\u4f1a\u6839\u636e tcp_retries2 \u8bbe\u7f6e\u7684\u503c\u8ba1\u7b97\u51fa\u4e00\u4e2a\u9608\u503c\uff09\u540e\uff0c\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\uff1b</li> <li>\u5982\u679c\u670d\u52a1\u7aef\u4e00\u76f4\u4e0d\u4f1a\u53d1\u9001\u6570\u636e\uff0c\u518d\u770b\u670d\u52a1\u7aef\u6709\u6ca1\u6709\u5f00\u542f TCP keepalive \u673a\u5236\uff1f</li> <li>\u5982\u679c\u6709\u5f00\u542f\uff0c\u670d\u52a1\u7aef\u5728\u4e00\u6bb5\u65f6\u95f4\u6ca1\u6709\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u65f6\uff0c\u4f1a\u89e6\u53d1 TCP keepalive \u673a\u5236\uff0c\u63a2\u6d4b\u5bf9\u65b9\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u63a2\u6d4b\u5230\u5bf9\u65b9\u5df2\u7ecf\u6d88\u4ea1\uff0c\u5219\u4f1a\u65ad\u5f00\u81ea\u8eab\u7684 TCP \u8fde\u63a5\uff1b</li> <li>\u5982\u679c\u6ca1\u6709\u5f00\u542f\uff0c\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u4f1a\u4e00\u76f4\u5b58\u5728\uff0c\u5e76\u4e14\u4e00\u76f4\u4fdd\u6301\u5728 ESTABLISHED \u72b6\u6001\u3002</li> </ul> <p>\u6700\u540e\u8bf4\u53e5\uff0cTCP \u725b\u903c\uff0c\u5565\u5f02\u5e38\u90fd\u8003\u8651\u5230\u4e86\u3002</p> <p>\u5c0f\u6797\u662f\u4e13\u4e3a\u5927\u5bb6\u56fe\u89e3\u7684\u5de5\u5177\u4eba\uff0cGoodbye\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/","title":"4.21 \u7528\u4e86 TCP \u534f\u8bae\uff0c\u6570\u636e\u4e00\u5b9a\u4e0d\u4f1a\u4e22\u5417\uff1f","text":"<p>\u6765\u6e90\uff1a\u516c\u4f17\u53f7@\u5c0f\u767d debug</p> <p>\u539f\u6587\u5730\u5740\uff1a\u7528\u4e86 TCP \u534f\u8bae\uff0c\u6570\u636e\u4e00\u5b9a\u4e0d\u4f1a\u4e22\u5417\uff1f</p> <p>\u5927\u5bb6\u540e\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u95ee\u5927\u5bb6\u4e00\u53e5\uff1aTCP \u662f\u4e00\u4e2a\u53ef\u9760\u7684\u4f20\u8f93\u534f\u8bae\uff0c\u90a3\u5b83\u4e00\u5b9a\u80fd\u4fdd\u8bc1\u6570\u636e\u4e0d\u4e22\u5931\u5417\uff1f</p> <p>\u8fd9\u6b21\uff0c\u5c31\u8ddf\u5927\u5bb6\u63a2\u8ba8\u8fd9\u4e2a\u95ee\u9898\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_1","title":"\u6570\u636e\u5305\u7684\u53d1\u9001\u6d41\u7a0b","text":"<p>\u9996\u5148\uff0c\u6211\u4eec\u4e24\u4e2a\u624b\u673a\u7684\u7eff\u76ae\u804a\u5929\u8f6f\u4ef6\u5ba2\u6237\u7aef\uff0c\u8981\u901a\u4fe1\uff0c\u4e2d\u95f4\u4f1a\u901a\u8fc7\u5b83\u4eec\u5bb6\u670d\u52a1\u5668\u3002\u5927\u6982\u957f\u8fd9\u6837\u3002</p> <p></p> <p>\u4f46\u4e3a\u4e86\u7b80\u5316\u6a21\u578b\uff0c\u6211\u4eec\u628a\u4e2d\u95f4\u7684\u670d\u52a1\u5668\u7ed9\u7701\u7565\u6389\uff0c\u5047\u8bbe\u8fd9\u662f\u4e2a\u7aef\u5230\u7aef\u7684\u901a\u4fe1\u3002\u4e14\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u7684\u53ef\u9760\u6027\uff0c\u6211\u4eec\u76f2\u731c\u5b83\u4eec\u4e4b\u95f4\u7528\u7684\u662fTCP \u534f\u8bae\u8fdb\u884c\u901a\u4fe1\u3002</p> <p></p> <p>\u4e3a\u4e86\u53d1\u9001\u6570\u636e\u5305\uff0c\u4e24\u7aef\u9996\u5148\u4f1a\u901a\u8fc7\u4e09\u6b21\u63e1\u624b\uff0c\u5efa\u7acb TCP \u8fde\u63a5\u3002</p> <p>\u4e00\u4e2a\u6570\u636e\u5305\uff0c\u4ece\u804a\u5929\u6846\u91cc\u53d1\u51fa\uff0c\u6d88\u606f\u4f1a\u4ece\u804a\u5929\u8f6f\u4ef6\u6240\u5728\u7684\u7528\u6237\u7a7a\u95f4\u62f7\u8d1d\u5230\u5185\u6838\u7a7a\u95f4\u7684\u53d1\u9001\u7f13\u51b2\u533a\uff08send buffer\uff09\uff0c\u6570\u636e\u5305\u5c31\u8fd9\u6837\u987a\u7740\u4f20\u8f93\u5c42\u3001\u7f51\u7edc\u5c42\uff0c\u8fdb\u5165\u5230\u6570\u636e\u94fe\u8def\u5c42\uff0c\u5728\u8fd9\u91cc\u6570\u636e\u5305\u4f1a\u7ecf\u8fc7\u6d41\u63a7\uff08qdisc\uff09\uff0c\u518d\u901a\u8fc7 RingBuffer \u53d1\u5230\u7269\u7406\u5c42\u7684\u7f51\u5361\u3002\u6570\u636e\u5c31\u8fd9\u6837\u987a\u7740\u7f51\u5361\u53d1\u5230\u4e86\u7eb7\u7e41\u590d\u6742\u7684\u7f51\u7edc\u4e16\u754c\u91cc\u3002\u8fd9\u91cc\u5934\u6570\u636e\u4f1a\u7ecf\u8fc7 n \u591a\u4e2a\u8def\u7531\u5668\u548c\u4ea4\u6362\u673a\u4e4b\u95f4\u7684\u8df3\u8f6c\uff0c\u6700\u540e\u5230\u8fbe\u76ee\u7684\u673a\u5668\u7684\u7f51\u5361\u5904\u3002</p> <p>\u6b64\u65f6\u76ee\u7684\u673a\u5668\u7684\u7f51\u5361\u4f1a\u901a\u77e5DMA\u5c06\u6570\u636e\u5305\u4fe1\u606f\u653e\u5230<code>RingBuffer</code>\u4e2d\uff0c\u518d\u89e6\u53d1\u4e00\u4e2a\u786c\u4e2d\u65ad\u7ed9<code>CPU</code>\uff0c<code>CPU</code>\u89e6\u53d1\u8f6f\u4e2d\u65ad\u8ba9<code>ksoftirqd</code>\u53bb<code>RingBuffer</code>\u6536\u5305\uff0c\u4e8e\u662f\u4e00\u4e2a\u6570\u636e\u5305\u5c31\u8fd9\u6837\u987a\u7740\u7269\u7406\u5c42\uff0c\u6570\u636e\u94fe\u8def\u5c42\uff0c\u7f51\u7edc\u5c42\uff0c\u4f20\u8f93\u5c42\uff0c\u6700\u540e\u4ece\u5185\u6838\u7a7a\u95f4\u62f7\u8d1d\u5230\u7528\u6237\u7a7a\u95f4\u91cc\u7684\u804a\u5929\u8f6f\u4ef6\u91cc\u3002</p> <p></p> <p>\u753b\u4e86\u90a3\u4e48\u5927\u4e00\u5f20\u56fe\uff0c\u53ea\u6c34\u4e86 200 \u5b57\u505a\u89e3\u91ca\uff0c\u6211\u591a\u5c11\u662f\u6709\u4e9b\u5fc3\u75db\u7684\u3002</p> <p>\u5230\u8fd9\u91cc\uff0c\u629b\u5f00\u4e00\u4e9b\u7ec6\u8282\uff0c\u5927\u5bb6\u5927\u6982\u77e5\u9053\u4e86\u4e00\u4e2a\u6570\u636e\u5305\u4ece\u53d1\u9001\u5230\u63a5\u6536\u7684\u5b8f\u89c2\u8fc7\u7a0b\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u8fd9\u4e0a\u9762\u5168\u662f\u5bc6\u5bc6\u9ebb\u9ebb\u7684\u540d\u8bcd\u3002</p> <p>\u6574\u6761\u94fe\u8def\u4e0b\u6765\uff0c\u6709\u4e0d\u5c11\u5730\u65b9\u53ef\u80fd\u4f1a\u53d1\u751f\u4e22\u5305\u3002</p> <p>\u4f46\u4e3a\u4e86\u4e0d\u8ba9\u5927\u5bb6\u4fdd\u6301\u8e72\u59ff\u592a\u4e45\u5f71\u54cd\u8eab\u4f53\u5065\u5eb7\uff0c\u6211\u8fd9\u8fb9\u53ea\u91cd\u70b9\u8bb2\u4e0b\u51e0\u4e2a\u5e38\u89c1\u5bb9\u6613\u53d1\u751f\u4e22\u5305\u7684\u573a\u666f\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_2","title":"\u5efa\u7acb\u8fde\u63a5\u65f6\u4e22\u5305","text":"<p>TCP \u534f\u8bae\u4f1a\u901a\u8fc7\u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\u3002\u5927\u6982\u957f\u4e0b\u9762\u8fd9\u6837\u3002</p> <p></p> <p>\u5728\u670d\u52a1\u7aef\uff0c\u7b2c\u4e00\u6b21\u63e1\u624b\u4e4b\u540e\uff0c\u4f1a\u5148\u5efa\u7acb\u4e2a\u534a\u8fde\u63a5\uff0c\u7136\u540e\u518d\u53d1\u51fa\u7b2c\u4e8c\u6b21\u63e1\u624b\u3002\u8fd9\u65f6\u5019\u9700\u8981\u6709\u4e2a\u5730\u65b9\u53ef\u4ee5\u6682\u5b58\u8fd9\u4e9b\u534a\u8fde\u63a5\u3002\u8fd9\u4e2a\u5730\u65b9\u5c31\u53eb\u534a\u8fde\u63a5\u961f\u5217\u3002</p> <p>\u5982\u679c\u4e4b\u540e\u7b2c\u4e09\u6b21\u63e1\u624b\u6765\u4e86\uff0c\u534a\u8fde\u63a5\u5c31\u4f1a\u5347\u7ea7\u4e3a\u5168\u8fde\u63a5\uff0c\u7136\u540e\u6682\u5b58\u5230\u53e6\u5916\u4e00\u4e2a\u53eb\u5168\u8fde\u63a5\u961f\u5217\u7684\u5730\u65b9\uff0c\u5750\u7b49\u7a0b\u5e8f\u6267\u884c<code>accept()</code>\u65b9\u6cd5\u5c06\u5176\u53d6\u8d70\u4f7f\u7528\u3002</p> <p></p> <p>\u662f\u961f\u5217\u5c31\u6709\u957f\u5ea6\uff0c\u6709\u957f\u5ea6\u5c31\u6709\u53ef\u80fd\u4f1a\u6ee1\uff0c\u5982\u679c\u5b83\u4eec\u6ee1\u4e86\uff0c\u90a3\u65b0\u6765\u7684\u5305\u5c31\u4f1a\u88ab\u4e22\u5f03\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u65b9\u5f0f\u67e5\u770b\u662f\u5426\u5b58\u5728\u8fd9\u79cd\u4e22\u5305\u884c\u4e3a\u3002</p> Bash<pre><code># \u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u6b21\u6570\n# netstat -s | grep overflowed\n    4343 times the listen queue of a socket overflowed\n\n# \u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u6b21\u6570\n# netstat -s | grep -i \"SYNs to LISTEN sockets dropped\"\n    109 times the listen queue of a socket overflowed \n</code></pre> <p>\u4ece\u73b0\u8c61\u6765\u770b\u5c31\u662f\u8fde\u63a5\u5efa\u7acb\u5931\u8d25\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_3","title":"\u6d41\u91cf\u63a7\u5236\u4e22\u5305","text":"<p>\u5e94\u7528\u5c42\u80fd\u53d1\u7f51\u7edc\u6570\u636e\u5305\u7684\u8f6f\u4ef6\u6709\u90a3\u4e48\u591a\uff0c\u5982\u679c\u6240\u6709\u6570\u636e\u4e0d\u52a0\u63a7\u5236\u4e00\u80a1\u8111\u51b2\u5165\u5230\u7f51\u5361\uff0c\u7f51\u5361\u4f1a\u5403\u4e0d\u6d88\uff0c\u90a3\u600e\u4e48\u529e\uff1f\u8ba9\u6570\u636e\u6309\u4e00\u5b9a\u7684\u89c4\u5219\u6392\u4e2a\u961f\u4f9d\u6b21\u5904\u7406\uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684qdisc(Queueing Disciplines\uff0c\u6392\u961f\u89c4\u5219)\uff0c\u8fd9\u4e5f\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u6d41\u91cf\u63a7\u5236\u673a\u5236\u3002</p> <p>\u6392\u961f\uff0c\u5f97\u5148\u6709\u4e2a\u961f\u5217\uff0c\u800c\u961f\u5217\u6709\u4e2a\u957f\u5ea6\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684<code>ifconfig</code>\u547d\u4ee4\u67e5\u770b\u5230\uff0c\u91cc\u9762\u6d89\u53ca\u5230\u7684<code>txqueuelen</code>\u540e\u9762\u7684\u6570\u5b57<code>1000</code>\uff0c\u5176\u5b9e\u5c31\u662f\u6d41\u63a7\u961f\u5217\u7684\u957f\u5ea6\u3002</p> <p>\u5f53\u53d1\u9001\u6570\u636e\u8fc7\u5feb\uff0c\u6d41\u63a7\u961f\u5217\u957f\u5ea6<code>txqueuelen</code>\u53c8\u4e0d\u591f\u5927\u65f6\uff0c\u5c31\u5bb9\u6613\u51fa\u73b0\u4e22\u5305\u73b0\u8c61\u3002</p> <p></p> <p>\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684<code>ifconfig</code>\u547d\u4ee4\uff0c\u67e5\u770b TX \u4e0b\u7684 dropped \u5b57\u6bb5\uff0c\u5f53\u5b83\u5927\u4e8e 0 \u65f6\uff0c\u5219\u6709\u53ef\u80fd\u662f\u53d1\u751f\u4e86\u6d41\u63a7\u4e22\u5305\u3002</p> Bash<pre><code># ifconfig eth0\neth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500\n        inet 172.21.66.69  netmask 255.255.240.0  broadcast 172.21.79.255\n        inet6 fe80::216:3eff:fe25:269f  prefixlen 64  scopeid 0x20&lt;link&gt;\n        ether 00:16:3e:25:26:9f  txqueuelen 1000  (Ethernet)\n        RX packets 6962682  bytes 1119047079 (1.0 GiB)\n        RX errors 0  dropped 0  overruns 0  frame 0\n        TX packets 9688919  bytes 2072511384 (1.9 GiB)\n        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0\n</code></pre> <p>\u5f53\u9047\u5230\u8fd9\u79cd\u60c5\u51b5\u65f6\uff0c\u6211\u4eec\u53ef\u4ee5\u5c1d\u8bd5\u4fee\u6539\u4e0b\u6d41\u63a7\u961f\u5217\u7684\u957f\u5ea6\u3002\u6bd4\u5982\u50cf\u4e0b\u9762\u8fd9\u6837\u5c06 eth0 \u7f51\u5361\u7684\u6d41\u63a7\u961f\u5217\u957f\u5ea6\u4ece 1000 \u63d0\u5347\u4e3a 1500.</p> Bash<pre><code># ifconfig eth0 txqueuelen 1500\n</code></pre>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_4","title":"\u7f51\u5361\u4e22\u5305","text":"<p>\u7f51\u5361\u548c\u5b83\u7684\u9a71\u52a8\u5bfc\u81f4\u4e22\u5305\u7684\u573a\u666f\u4e5f\u6bd4\u8f83\u5e38\u89c1\uff0c\u539f\u56e0\u5f88\u591a\uff0c\u6bd4\u5982\u7f51\u7ebf\u8d28\u91cf\u5dee\uff0c\u63a5\u89e6\u4e0d\u826f\u3002\u9664\u6b64\u4e4b\u5916\uff0c\u6211\u4eec\u6765\u804a\u51e0\u4e2a\u5e38\u89c1\u7684\u573a\u666f\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#ringbuffer","title":"RingBuffer \u8fc7\u5c0f\u5bfc\u81f4\u4e22\u5305","text":"<p>\u4e0a\u9762\u63d0\u5230\uff0c\u5728\u63a5\u6536\u6570\u636e\u65f6\uff0c\u4f1a\u5c06\u6570\u636e\u6682\u5b58\u5230<code>RingBuffer</code>\u63a5\u6536\u7f13\u51b2\u533a\u4e2d\uff0c\u7136\u540e\u7b49\u7740\u5185\u6838\u89e6\u53d1\u8f6f\u4e2d\u65ad\u6162\u6162\u6536\u8d70\u3002\u5982\u679c\u8fd9\u4e2a\u7f13\u51b2\u533a\u8fc7\u5c0f\uff0c\u800c\u8fd9\u65f6\u5019\u53d1\u9001\u7684\u6570\u636e\u53c8\u8fc7\u5feb\uff0c\u5c31\u6709\u53ef\u80fd\u53d1\u751f\u6ea2\u51fa\uff0c\u6b64\u65f6\u4e5f\u4f1a\u4ea7\u751f\u4e22\u5305\u3002</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u53bb\u67e5\u770b\u662f\u5426\u53d1\u751f\u8fc7\u8fd9\u6837\u7684\u4e8b\u60c5\u3002</p> Bash<pre><code># ifconfig\neth0:  RX errors 0  dropped 0  overruns 0  frame 0\n</code></pre> <p>\u67e5\u770b\u4e0a\u9762\u7684<code>overruns</code>\u6307\u6807\uff0c\u5b83\u8bb0\u5f55\u4e86\u7531\u4e8e<code>RingBuffer</code>\u957f\u5ea6\u4e0d\u8db3\u5bfc\u81f4\u7684\u6ea2\u51fa\u6b21\u6570\u3002</p> <p>\u5f53\u7136\uff0c\u7528<code>ethtool</code>\u547d\u4ee4\u4e5f\u80fd\u67e5\u770b\u3002</p> Bash<pre><code># ethtool -S eth0|grep rx_queue_0_drops\n</code></pre> <p>\u4f46\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u56e0\u4e3a\u4e00\u4e2a\u7f51\u5361\u91cc\u662f\u53ef\u4ee5\u6709\u591a\u4e2a RingBuffer\u7684\uff0c\u6240\u4ee5\u4e0a\u9762\u7684<code>rx_queue_0_drops</code>\u91cc\u7684 0 \u4ee3\u8868\u7684\u662f\u7b2c 0 \u4e2a RingBuffer\u7684\u4e22\u5305\u6570\uff0c\u5bf9\u4e8e\u591a\u961f\u5217\u7684\u7f51\u5361\uff0c\u8fd9\u4e2a 0 \u8fd8\u53ef\u4ee5\u6539\u6210\u5176\u4ed6\u6570\u5b57\u3002\u4f46\u6211\u7684\u5bb6\u5ead\u6761\u4ef6\u4e0d\u5141\u8bb8\u6211\u770b\u5176\u4ed6\u961f\u5217\u7684\u4e22\u5305\u6570\uff0c\u6240\u4ee5\u4e0a\u9762\u7684\u547d\u4ee4\u5bf9\u6211\u6765\u8bf4\u662f\u591f\u7528\u4e86\u3002\u3002\u3002</p> <p>\u5f53\u53d1\u73b0\u6709\u8fd9\u7c7b\u578b\u4e22\u5305\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u5f53\u524d\u7f51\u5361\u7684\u914d\u7f6e\u3002</p> Bash<pre><code>#ethtool -g eth0\nRing parameters for eth0:\nPre-set maximums:\nRX:        4096\nRX Mini:    0\nRX Jumbo:    0\nTX:        4096\nCurrent hardware settings:\nRX:        1024\nRX Mini:    0\nRX Jumbo:    0\nTX:        1024\n</code></pre> <p>\u4e0a\u9762\u7684\u8f93\u51fa\u5185\u5bb9\uff0c\u542b\u4e49\u662fRingBuffer \u6700\u5927\u652f\u6301 4096 \u7684\u957f\u5ea6\uff0c\u4f46\u73b0\u5728\u5b9e\u9645\u53ea\u7528\u4e86 1024\u3002</p> <p>\u60f3\u8981\u4fee\u6539\u8fd9\u4e2a\u957f\u5ea6\u53ef\u4ee5\u6267\u884c<code>ethtool -G eth1 rx 4096 tx 4096</code>\u5c06\u53d1\u9001\u548c\u63a5\u6536 RingBuffer \u7684\u957f\u5ea6\u90fd\u6539\u4e3a 4096\u3002</p> <p>RingBuffer\u589e\u5927\u4e4b\u540e\uff0c\u53ef\u4ee5\u51cf\u5c11\u56e0\u4e3a\u5bb9\u91cf\u5c0f\u800c\u5bfc\u81f4\u7684\u4e22\u5305\u60c5\u51b5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_5","title":"\u7f51\u5361\u6027\u80fd\u4e0d\u8db3","text":"<p>\u7f51\u5361\u4f5c\u4e3a\u786c\u4ef6\uff0c\u4f20\u8f93\u901f\u5ea6\u662f\u6709\u4e0a\u9650\u7684\u3002\u5f53\u7f51\u7edc\u4f20\u8f93\u901f\u5ea6\u8fc7\u5927\uff0c\u8fbe\u5230\u7f51\u5361\u4e0a\u9650\u65f6\uff0c\u5c31\u4f1a\u53d1\u751f\u4e22\u5305\u3002\u8fd9\u79cd\u60c5\u51b5\u4e00\u822c\u5e38\u89c1\u4e8e\u538b\u6d4b\u573a\u666f\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>ethtool</code>\u52a0\u7f51\u5361\u540d\uff0c\u83b7\u5f97\u5f53\u524d\u7f51\u5361\u652f\u6301\u7684\u6700\u5927\u901f\u5ea6\u3002</p> Bash<pre><code># ethtool eth0\nSettings for eth0:\n    Speed: 10000Mb/s\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u8fd9\u8fb9\u7528\u7684\u7f51\u5361\u80fd\u652f\u6301\u7684\u6700\u5927\u4f20\u8f93\u901f\u5ea6speed=1000Mb/s\u3002</p> <p>\u4e5f\u5c31\u662f\u4fd7\u79f0\u7684\u5343\u5146\u7f51\u5361\uff0c\u4f46\u6ce8\u610f\u8fd9\u91cc\u7684\u5355\u4f4d\u662fMb\uff0c\u8fd9\u91cc\u7684b \u662f\u6307 bit\uff0c\u800c\u4e0d\u662f Byte\u30021Byte=8bit\u3002\u6240\u4ee5 10000Mb/s \u8fd8\u8981\u9664\u4ee5 8\uff0c\u4e5f\u5c31\u662f\u7406\u8bba\u4e0a\u7f51\u5361\u6700\u5927\u4f20\u8f93\u901f\u5ea6\u662f<code>1000/8 = 125MB/s</code>\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7<code>sar\u547d\u4ee4</code>\u4ece\u7f51\u7edc\u63a5\u53e3\u5c42\u9762\u6765\u5206\u6790\u6570\u636e\u5305\u7684\u6536\u53d1\u60c5\u51b5\u3002</p> Bash<pre><code># sar -n DEV 1\nLinux 3.10.0-1127.19.1.el7.x86_64      2022\u5e7407\u670827\u65e5     _x86_64_    (1 CPU)\n\n08\u65f635\u520639\u79d2     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s    rxcmp/s   txcmp/s  rxmcst/s\n08\u65f635\u520640\u79d2      eth0      6.06      4.04      0.35    121682.33   0.00    0.00     0.00\n</code></pre> <p>\u5176\u4e2d txkB/s \u662f\u6307\u5f53\u524d\u6bcf\u79d2\u53d1\u9001\u7684\u5b57\u8282\uff08byte\uff09\u603b\u6570\uff0crxkB/s \u662f\u6307\u6bcf\u79d2\u63a5\u6536\u7684\u5b57\u8282\uff08byte\uff09\u603b\u6570\u3002</p> <p>\u5f53\u4e24\u8005\u52a0\u8d77\u6765\u7684\u503c\u7ea6\u7b49\u4e8e<code>12~13w\u5b57\u8282</code>\u7684\u65f6\u5019\uff0c\u4e5f\u5c31\u5bf9\u5e94\u5927\u6982<code>125MB/s</code>\u7684\u4f20\u8f93\u901f\u5ea6\u3002\u6b64\u65f6\u8fbe\u5230\u7f51\u5361\u6027\u80fd\u6781\u9650\uff0c\u5c31\u4f1a\u5f00\u59cb\u4e22\u5305\u3002</p> <p>\u9047\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u4f18\u5148\u770b\u4e0b\u4f60\u7684\u670d\u52a1\u662f\u4e0d\u662f\u771f\u6709\u8fd9\u4e48\u5927\u7684\u771f\u5b9e\u6d41\u91cf\uff0c\u5982\u679c\u662f\u7684\u8bdd\u53ef\u4ee5\u8003\u8651\u4e0b\u62c6\u5206\u670d\u52a1\uff0c\u6216\u8005\u5c31\u5fcd\u75db\u5145\u94b1\u5347\u7ea7\u4e0b\u914d\u7f6e\u5427\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_6","title":"\u63a5\u6536\u7f13\u51b2\u533a\u4e22\u5305","text":"<p>\u6211\u4eec\u4e00\u822c\u4f7f\u7528<code>TCP socket</code>\u8fdb\u884c\u7f51\u7edc\u7f16\u7a0b\u7684\u65f6\u5019\uff0c\u5185\u6838\u90fd\u4f1a\u5206\u914d\u4e00\u4e2a\u53d1\u9001\u7f13\u51b2\u533a\u548c\u4e00\u4e2a\u63a5\u6536\u7f13\u51b2\u533a\u3002</p> <p>\u5f53\u6211\u4eec\u60f3\u8981\u53d1\u4e00\u4e2a\u6570\u636e\u5305\uff0c\u4f1a\u5728\u4ee3\u7801\u91cc\u6267\u884c<code>send(msg)</code>\uff0c\u8fd9\u65f6\u5019\u6570\u636e\u5305\u5e76\u4e0d\u662f\u4e00\u628a\u68ad\u76f4\u63a5\u5c31\u8d70\u7f51\u5361\u98de\u51fa\u53bb\u7684\u3002\u800c\u662f\u5c06\u6570\u636e\u62f7\u8d1d\u5230\u5185\u6838\u53d1\u9001\u7f13\u51b2\u533a\u5c31\u5b8c\u4e8b\u8fd4\u56de\u4e86\uff0c\u81f3\u4e8e\u4ec0\u4e48\u65f6\u5019\u53d1\u6570\u636e\uff0c\u53d1\u591a\u5c11\u6570\u636e\uff0c\u8fd9\u4e2a\u540e\u7eed\u7531\u5185\u6838\u81ea\u5df1\u505a\u51b3\u5b9a\u3002</p> <p></p> <p>\u800c\u63a5\u6536\u7f13\u51b2\u533a\u4f5c\u7528\u4e5f\u7c7b\u4f3c\uff0c\u4ece\u5916\u90e8\u7f51\u7edc\u6536\u5230\u7684\u6570\u636e\u5305\u5c31\u6682\u5b58\u5728\u8fd9\u4e2a\u5730\u65b9\uff0c\u7136\u540e\u5750\u7b49\u7528\u6237\u7a7a\u95f4\u7684\u5e94\u7528\u7a0b\u5e8f\u5c06\u6570\u636e\u5305\u53d6\u8d70\u3002</p> <p>\u8fd9\u4e24\u4e2a\u7f13\u51b2\u533a\u662f\u6709\u5927\u5c0f\u9650\u5236\u7684\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u53bb\u67e5\u770b\u3002</p> Bash<pre><code># \u67e5\u770b\u63a5\u6536\u7f13\u51b2\u533a\n# sysctl net.ipv4.tcp_rmem\nnet.ipv4.tcp_rmem = 4096    87380   6291456\n\n# \u67e5\u770b\u53d1\u9001\u7f13\u51b2\u533a\n# sysctl net.ipv4.tcp_wmem\nnet.ipv4.tcp_wmem = 4096    16384   4194304\n</code></pre> <p>\u4e0d\u7ba1\u662f\u63a5\u6536\u7f13\u51b2\u533a\u8fd8\u662f\u53d1\u9001\u7f13\u51b2\u533a\uff0c\u90fd\u80fd\u770b\u5230\u4e09\u4e2a\u6570\u503c\uff0c\u5206\u522b\u5bf9\u5e94\u7f13\u51b2\u533a\u7684\u6700\u5c0f\u503c\uff0c\u9ed8\u8ba4\u503c\u548c\u6700\u5927\u503c\uff08min\u3001default\u3001max\uff09\u3002\u7f13\u51b2\u533a\u4f1a\u5728 min \u548c max \u4e4b\u95f4\u52a8\u6001\u8c03\u6574\u3002</p> <p>\u90a3\u4e48\u95ee\u9898\u6765\u4e86\uff0c\u5982\u679c\u7f13\u51b2\u533a\u8bbe\u7f6e\u8fc7\u5c0f\u4f1a\u600e\u4e48\u6837\uff1f</p> <p>\u5bf9\u4e8e\u53d1\u9001\u7f13\u51b2\u533a\uff0c\u6267\u884c send \u7684\u65f6\u5019\uff0c\u5982\u679c\u662f\u963b\u585e\u8c03\u7528\uff0c\u90a3\u5c31\u4f1a\u7b49\uff0c\u7b49\u5230\u7f13\u51b2\u533a\u6709\u7a7a\u4f4d\u53ef\u4ee5\u53d1\u6570\u636e\u3002</p> <p></p> <p>\u5982\u679c\u662f\u975e\u963b\u585e\u8c03\u7528\uff0c\u5c31\u4f1a\u7acb\u523b\u8fd4\u56de\u4e00\u4e2a <code>EAGAIN</code> \u9519\u8bef\u4fe1\u606f\uff0c\u610f\u601d\u662f  <code>Try again</code>\u3002\u8ba9\u5e94\u7528\u7a0b\u5e8f\u4e0b\u6b21\u518d\u91cd\u8bd5\u3002\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4e00\u822c\u4e0d\u4f1a\u53d1\u751f\u4e22\u5305\u3002</p> <p></p> <p>\u5f53\u63a5\u53d7\u7f13\u51b2\u533a\u6ee1\u4e86\uff0c\u4e8b\u60c5\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u5b83\u7684 TCP \u63a5\u6536\u7a97\u53e3\u4f1a\u53d8\u4e3a 0\uff0c\u4e5f\u5c31\u662f\u6240\u8c13\u7684\u96f6\u7a97\u53e3\uff0c\u5e76\u4e14\u4f1a\u901a\u8fc7\u6570\u636e\u5305\u91cc\u7684<code>win=0</code>\uff0c\u544a\u8bc9\u53d1\u9001\u7aef\uff0c\"\u7403\u7403\u4e86\uff0c\u9876\u4e0d\u4f4f\u4e86\uff0c\u522b\u53d1\u4e86\"\u3002\u4e00\u822c\u8fd9\u79cd\u60c5\u51b5\u4e0b\uff0c\u53d1\u9001\u7aef\u5c31\u8be5\u505c\u6b62\u53d1\u6d88\u606f\u4e86\uff0c\u4f46\u5982\u679c\u8fd9\u65f6\u5019\u786e\u5b9e\u8fd8\u6709\u6570\u636e\u53d1\u6765\uff0c\u5c31\u4f1a\u53d1\u751f\u4e22\u5305\u3002</p> <p></p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u91cc\u7684<code>TCPRcvQDrop</code>\u67e5\u770b\u5230\u6709\u6ca1\u6709\u53d1\u751f\u8fc7\u8fd9\u79cd\u4e22\u5305\u73b0\u8c61\u3002</p> Bash<pre><code>cat /proc/net/netstat\nTcpExt: SyncookiesSent TCPRcvQDrop SyncookiesFailed\nTcpExt: 0              157              60116\n</code></pre> <p>\u4f46\u662f\u8bf4\u4e2a\u4f24\u5fc3\u7684\u4e8b\u60c5\uff0c\u6211\u4eec\u4e00\u822c\u4e5f\u770b\u4e0d\u5230\u8fd9\u4e2a<code>TCPRcvQDrop</code>\uff0c\u56e0\u4e3a\u8fd9\u4e2a\u662f<code>5.9\u7248\u672c</code>\u91cc\u5f15\u5165\u7684\u6253\u70b9\uff0c\u800c\u6211\u4eec\u7684\u670d\u52a1\u5668\u7528\u7684\u4e00\u822c\u662f<code>2.x~3.x</code>\u5de6\u53f3\u7248\u672c\u3002\u4f60\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u4e0b\u4f60\u7528\u7684\u662f\u4ec0\u4e48\u7248\u672c\u7684 linux \u5185\u6838\u3002</p> Bash<pre><code># cat /proc/version\nLinux version 3.10.0-1127.19.1.el7.x86_64\n</code></pre>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_7","title":"\u4e24\u7aef\u4e4b\u95f4\u7684\u7f51\u7edc\u4e22\u5305","text":"<p>\u524d\u9762\u63d0\u5230\u7684\u662f\u4e24\u7aef\u673a\u5668\u5185\u90e8\u7684\u7f51\u7edc\u4e22\u5305\uff0c\u9664\u6b64\u4e4b\u5916\uff0c\u4e24\u7aef\u4e4b\u95f4\u90a3\u4e48\u957f\u7684\u4e00\u6761\u94fe\u8def\u90fd\u5c5e\u4e8e\u5916\u90e8\u7f51\u7edc\uff0c\u8fd9\u4e2d\u95f4\u6709\u5404\u79cd\u8def\u7531\u5668\u548c\u4ea4\u6362\u673a\u8fd8\u6709\u5149\u7f06\u5565\u7684\uff0c\u4e22\u5305\u4e5f\u662f\u5f88\u7ecf\u5e38\u53d1\u751f\u7684\u3002</p> <p>\u8fd9\u4e9b\u4e22\u5305\u884c\u4e3a\u53d1\u751f\u5728\u4e2d\u95f4\u94fe\u8def\u7684\u67d0\u4e9b\u4e2a\u673a\u5668\u4e0a\uff0c\u6211\u4eec\u5f53\u7136\u662f\u6ca1\u6743\u9650\u53bb\u767b\u5f55\u8fd9\u4e9b\u673a\u5668\u3002\u4f46\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u547d\u4ee4\u89c2\u5bdf\u6574\u4e2a\u94fe\u8def\u7684\u8fde\u901a\u60c5\u51b5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#ping","title":"ping \u547d\u4ee4\u67e5\u770b\u4e22\u5305","text":"<p>\u6bd4\u5982\u6211\u4eec\u77e5\u9053\u76ee\u7684\u5730\u7684\u57df\u540d\u662f <code>baidu.com</code>\u3002\u60f3\u77e5\u9053\u4f60\u7684\u673a\u5668\u5230 baidu \u670d\u52a1\u5668\u4e4b\u95f4\uff0c\u6709\u6ca1\u6709\u4ea7\u751f\u4e22\u5305\u884c\u4e3a\u3002\u53ef\u4ee5\u4f7f\u7528 ping \u547d\u4ee4\u3002</p> <p></p> <p>\u5012\u6570\u7b2c\u4e8c\u884c\u91cc\u6709\u4e2a<code>100% packet loss</code>\uff0c\u610f\u601d\u662f\u4e22\u5305\u7387 100%\u3002</p> <p>\u4f46\u8fd9\u6837\u5176\u5b9e\u4f60\u53ea\u80fd\u77e5\u9053\u4f60\u7684\u673a\u5668\u548c\u76ee\u7684\u673a\u5668\u4e4b\u95f4\u6709\u6ca1\u6709\u4e22\u5305\u3002</p> <p>\u90a3\u5982\u679c\u4f60\u60f3\u77e5\u9053\u4f60\u548c\u76ee\u7684\u673a\u5668\u4e4b\u95f4\u7684\u8fd9\u6761\u94fe\u8def\uff0c\u54ea\u4e2a\u8282\u70b9\u4e22\u5305\u4e86\uff0c\u6709\u6ca1\u6709\u529e\u6cd5\u5462\uff1f</p> <p>\u6709\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#mtr","title":"mtr \u547d\u4ee4","text":"<p>mtr \u547d\u4ee4\u53ef\u4ee5\u67e5\u770b\u5230\u4f60\u7684\u673a\u5668\u548c\u76ee\u7684\u673a\u5668\u4e4b\u95f4\u7684\u6bcf\u4e2a\u8282\u70b9\u7684\u4e22\u5305\u60c5\u51b5\u3002</p> <p>\u50cf\u4e0b\u9762\u8fd9\u6837\u6267\u884c\u547d\u4ee4\u3002</p> <p></p> <p>\u5176\u4e2d -r \u662f\u6307 report\uff0c\u4ee5\u62a5\u544a\u7684\u5f62\u5f0f\u6253\u5370\u7ed3\u679c\u3002</p> <p>\u53ef\u4ee5\u770b\u5230<code>Host</code>\u90a3\u4e00\u5217\uff0c\u51fa\u73b0\u7684\u90fd\u662f\u94fe\u8def\u4e2d\u95f4\u6bcf\u4e00\u8df3\u7684\u673a\u5668\uff0c<code>Loss</code>\u7684\u90a3\u4e00\u5217\u5c31\u662f\u6307\u8fd9\u4e00\u8df3\u5bf9\u5e94\u7684\u4e22\u5305\u7387\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u4e2d\u95f4\u6709\u4e00\u4e9b\u662f host \u662f<code>???</code>\uff0c\u90a3\u4e2a\u662f\u56e0\u4e3amtr \u9ed8\u8ba4\u7528\u7684\u662f ICMP \u5305\uff0c\u6709\u4e9b\u8282\u70b9\u9650\u5236\u4e86ICMP \u5305\uff0c\u5bfc\u81f4\u4e0d\u80fd\u6b63\u5e38\u5c55\u793a\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728 mtr \u547d\u4ee4\u91cc\u52a0\u4e2a<code>-u</code>\uff0c\u4e5f\u5c31\u662f\u4f7f\u7528udp \u5305\uff0c\u5c31\u80fd\u770b\u5230\u90e8\u5206\uff1f??\u5bf9\u5e94\u7684 IP\u3002</p> <p></p> <p>\u628aICMP \u5305\u548c UDP \u5305\u7684\u7ed3\u679c\u62fc\u5728\u4e00\u8d77\u770b\uff0c\u5c31\u662f\u6bd4\u8f83\u5b8c\u6574\u7684\u94fe\u8def\u56fe\u4e86\u3002</p> <p>\u8fd8\u6709\u4e2a\u5c0f\u7ec6\u8282\uff0c<code>Loss</code>\u90a3\u4e00\u5217\uff0c\u6211\u4eec\u5728 icmp \u7684\u573a\u666f\u4e0b\uff0c\u5173\u6ce8\u6700\u540e\u4e00\u884c\uff0c\u5982\u679c\u662f 0%\uff0c\u90a3\u4e0d\u7ba1\u524d\u9762 loss \u662f 100% \u8fd8\u662f 80% \u90fd\u65e0\u6240\u8c13\uff0c\u90a3\u4e9b\u90fd\u662f\u8282\u70b9\u9650\u5236\u5bfc\u81f4\u7684\u865a\u62a5\u3002</p> <p>\u4f46\u5982\u679c\u6700\u540e\u4e00\u884c\u662f 20%\uff0c\u518d\u5f80\u524d\u51e0\u884c\u90fd\u662f 20% \u5de6\u53f3\uff0c\u90a3\u8bf4\u660e\u4e22\u5305\u5c31\u662f\u4ece\u6700\u63a5\u8fd1\u7684\u90a3\u4e00\u884c\u5f00\u59cb\u4ea7\u751f\u7684\uff0c\u957f\u65f6\u95f4\u662f\u8fd9\u6837\uff0c\u90a3\u5f88\u53ef\u80fd\u8fd9\u4e00\u8df3\u51fa\u4e86\u70b9\u95ee\u9898\u3002\u5982\u679c\u662f\u516c\u53f8\u5185\u7f51\u7684\u8bdd\uff0c\u4f60\u53ef\u4ee5\u5e26\u7740\u8fd9\u6761\u7ebf\u7d22\u53bb\u627e\u5bf9\u5e94\u7684\u7f51\u7edc\u540c\u4e8b\u3002\u5982\u679c\u662f\u5916\u7f51\u7684\u8bdd\uff0c\u90a3\u8010\u5fc3\u70b9\u7b49\u7b49\u5427\uff0c\u522b\u4eba\u5bb6\u7684\u5f00\u53d1\u4f1a\u6bd4\u4f60\u66f4\u7740\u6025\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_8","title":"\u53d1\u751f\u4e22\u5305\u4e86\u600e\u4e48\u529e","text":"<p>\u8bf4\u4e86\u8fd9\u4e48\u591a\u3002\u53ea\u662f\u60f3\u544a\u8bc9\u5927\u5bb6\uff0c\u4e22\u5305\u662f\u5f88\u5e38\u89c1\u7684\uff0c\u51e0\u4e4e\u4e0d\u53ef\u907f\u514d\u7684\u4e00\u4ef6\u4e8b\u60c5\u3002</p> <p>\u4f46\u95ee\u9898\u6765\u4e86\uff0c\u53d1\u751f\u4e22\u5305\u4e86\u600e\u4e48\u529e\uff1f</p> <p>\u8fd9\u4e2a\u597d\u529e\uff0c\u7528TCP \u534f\u8bae\u53bb\u505a\u4f20\u8f93\u3002</p> <p></p> <p>\u5efa\u7acb\u4e86 TCP \u8fde\u63a5\u7684\u4e24\u7aef\uff0c\u53d1\u9001\u7aef\u5728\u53d1\u51fa\u6570\u636e\u540e\u4f1a\u7b49\u5f85\u63a5\u6536\u7aef\u56de\u590d<code>ack\u5305</code>\uff0c<code>ack\u5305</code>\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u544a\u8bc9\u5bf9\u65b9\u81ea\u5df1\u786e\u5b9e\u6536\u5230\u4e86\u6570\u636e\uff0c\u4f46\u5982\u679c\u4e2d\u95f4\u94fe\u8def\u53d1\u751f\u4e86\u4e22\u5305\uff0c\u90a3\u53d1\u9001\u7aef\u4f1a\u8fdf\u8fdf\u6536\u4e0d\u5230\u786e\u8ba4 ack\uff0c\u4e8e\u662f\u5c31\u4f1a\u8fdb\u884c\u91cd\u4f20\u3002\u4ee5\u6b64\u6765\u4fdd\u8bc1\u6bcf\u4e2a\u6570\u636e\u5305\u90fd\u786e\u786e\u5b9e\u5b9e\u5230\u8fbe\u4e86\u63a5\u6536\u7aef\u3002</p> <p>\u5047\u8bbe\u73b0\u5728\u7f51\u65ad\u4e86\uff0c\u6211\u4eec\u8fd8\u7528\u804a\u5929\u8f6f\u4ef6\u53d1\u6d88\u606f\uff0c\u804a\u5929\u8f6f\u4ef6\u4f1a\u4f7f\u7528 TCP \u4e0d\u65ad\u5c1d\u8bd5\u91cd\u4f20\u6570\u636e\uff0c\u5982\u679c\u91cd\u4f20\u671f\u95f4\u7f51\u7edc\u6062\u590d\u4e86\uff0c\u90a3\u6570\u636e\u5c31\u80fd\u6b63\u5e38\u53d1\u8fc7\u53bb\u3002\u4f46\u5982\u679c\u591a\u6b21\u91cd\u8bd5\u76f4\u5230\u8d85\u65f6\u90fd\u8fd8\u662f\u5931\u8d25\uff0c\u8fd9\u65f6\u5019\u4f60\u5c06\u6536\u83b7\u4e00\u4e2a\u7ea2\u8272\u611f\u53f9\u53f7\u3002</p> <p></p> <p>\u8fd9\u65f6\u5019\u95ee\u9898\u53c8\u6765\u4e86\u3002</p> <p>\u5047\u8bbe\u67d0\u7eff\u76ae\u804a\u5929\u8f6f\u4ef6\u7528\u7684\u5c31\u662f TCP \u534f\u8bae\u3002</p> <p>\u5728\u804a\u5929\u7684\u65f6\u5019\uff0c\u53d1\u751f\u4e22\u5305\u4e86\uff0c\u4e22\u5305\u4e86\u4f1a\u91cd\u8bd5\uff0c\u91cd\u8bd5\u5931\u8d25\u4e86\u8fd8\u4f1a\u51fa\u73b0\u7ea2\u8272\u611f\u53f9\u53f7\u3002</p> <p>\u4e8e\u662f\u4e4e\uff0c\u95ee\u9898\u5c31\u53d8\u6210\u4e86\uff0c\u7528\u4e86 TCP \u534f\u8bae\uff0c\u5c31\u4e00\u5b9a\u4e0d\u4f1a\u4e22\u5305\u5417\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#tcp","title":"\u7528\u4e86 TCP \u534f\u8bae\u5c31\u4e00\u5b9a\u4e0d\u4f1a\u4e22\u5305\u5417","text":"<p>\u6211\u4eec\u77e5\u9053 TCP \u4f4d\u4e8e\u4f20\u8f93\u5c42\uff0c\u5728\u5b83\u7684\u4e0a\u9762\u8fd8\u6709\u5404\u79cd\u5e94\u7528\u5c42\u534f\u8bae\uff0c\u6bd4\u5982\u5e38\u89c1\u7684 HTTP \u6216\u8005\u5404\u7c7b RPC \u534f\u8bae\u3002</p> <p></p> <p>TCP \u4fdd\u8bc1\u7684\u53ef\u9760\u6027\uff0c\u662f\u4f20\u8f93\u5c42\u7684\u53ef\u9760\u6027\u3002\u4e5f\u5c31\u662f\u8bf4\uff0cTCP \u53ea\u4fdd\u8bc1\u6570\u636e\u4ece A \u673a\u5668\u7684\u4f20\u8f93\u5c42\u53ef\u9760\u5730\u53d1\u5230 B \u673a\u5668\u7684\u4f20\u8f93\u5c42\u3002</p> <p>\u81f3\u4e8e\u6570\u636e\u5230\u4e86\u63a5\u6536\u7aef\u7684\u4f20\u8f93\u5c42\u4e4b\u540e\uff0c\u80fd\u4e0d\u80fd\u4fdd\u8bc1\u5230\u5e94\u7528\u5c42\uff0cTCP \u5e76\u4e0d\u7ba1\u3002</p> <p>\u5047\u8bbe\u73b0\u5728\uff0c\u6211\u4eec\u8f93\u5165\u4e00\u6761\u6d88\u606f\uff0c\u4ece\u804a\u5929\u6846\u53d1\u51fa\uff0c\u8d70\u5230\u4f20\u8f93\u5c42 TCP \u534f\u8bae\u7684\u53d1\u9001\u7f13\u51b2\u533a\uff0c\u4e0d\u7ba1\u4e2d\u95f4\u6709\u6ca1\u6709\u4e22\u5305\uff0c\u6700\u540e\u901a\u8fc7\u91cd\u4f20\u90fd\u4fdd\u8bc1\u53d1\u5230\u4e86\u5bf9\u65b9\u7684\u4f20\u8f93\u5c42 TCP \u63a5\u6536\u7f13\u51b2\u533a\uff0c\u6b64\u65f6\u63a5\u6536\u7aef\u56de\u590d\u4e86\u4e00\u4e2a<code>ack</code>\uff0c\u53d1\u9001\u7aef\u6536\u5230\u8fd9\u4e2a<code>ack</code>\u540e\u5c31\u4f1a\u5c06\u81ea\u5df1\u53d1\u9001\u7f13\u51b2\u533a\u91cc\u7684\u6d88\u606f\u7ed9\u6254\u6389\u3002\u5230\u8fd9\u91cc TCP \u7684\u4efb\u52a1\u5c31\u7ed3\u675f\u4e86\u3002</p> <p>TCP \u4efb\u52a1\u662f\u7ed3\u675f\u4e86\uff0c\u4f46\u804a\u5929\u8f6f\u4ef6\u7684\u4efb\u52a1\u6ca1\u7ed3\u675f\u3002</p> <p>\u804a\u5929\u8f6f\u4ef6\u8fd8\u9700\u8981\u5c06\u6570\u636e\u4ece TCP \u7684\u63a5\u6536\u7f13\u51b2\u533a\u91cc\u8bfb\u51fa\u6765\uff0c\u5982\u679c\u5728\u8bfb\u51fa\u6765\u8fd9\u4e00\u523b\uff0c\u624b\u673a\u7531\u4e8e\u5185\u5b58\u4e0d\u8db3\u6216\u5176\u4ed6\u5404\u79cd\u539f\u56e0\uff0c\u5bfc\u81f4\u8f6f\u4ef6\u5d29\u6e83\u95ea\u9000\u4e86\u3002</p> <p>\u53d1\u9001\u7aef\u4ee5\u4e3a\u81ea\u5df1\u53d1\u7684\u6d88\u606f\u5df2\u7ecf\u53d1\u7ed9\u5bf9\u65b9\u4e86\uff0c\u4f46\u63a5\u6536\u7aef\u5374\u5e76\u6ca1\u6709\u6536\u5230\u8fd9\u6761\u6d88\u606f\u3002</p> <p>\u4e8e\u662f\u4e4e\uff0c\u6d88\u606f\u5c31\u4e22\u4e86\u3002</p> <p></p> <p>\u867d\u7136\u6982\u7387\u5f88\u5c0f\uff0c\u4f46\u5b83\u5c31\u662f\u53d1\u751f\u4e86\u3002</p> <p>\u5408\u60c5\u5408\u7406\uff0c\u903b\u8f91\u81ea\u6d3d\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_9","title":"\u8fd9\u7c7b\u4e22\u5305\u95ee\u9898\u600e\u4e48\u89e3\u51b3\uff1f","text":"<p>\u6545\u4e8b\u5230\u8fd9\u91cc\u4e5f\u5230\u5c3e\u58f0\u4e86\uff0c\u611f\u52a8\u4e4b\u4f59\uff0c\u6211\u4eec\u6765\u804a\u70b9\u638f\u5fc3\u7a9d\u5b50\u7684\u8bdd\u3002</p> <p>\u5176\u5b9e\u524d\u9762\u8bf4\u7684\u90fd\u5bf9\uff0c\u6ca1\u6709\u4e00\u53e5\u662f\u5047\u8bdd\u3002</p> <p>\u4f46\u67d0\u7eff\u76ae\u804a\u5929\u8f6f\u4ef6\u8fd9\u4e48\u6210\u719f\uff0c\u600e\u4e48\u53ef\u80fd\u6ca1\u8003\u8651\u8fc7\u8fd9\u4e00\u70b9\u5462\u3002</p> <p>\u5927\u5bb6\u5e94\u8be5\u8fd8\u8bb0\u5f97\u6211\u4eec\u6587\u7ae0\u5f00\u5934\u63d0\u5230\u8fc7\uff0c\u4e3a\u4e86\u7b80\u5355\uff0c\u5c31\u5c06\u670d\u52a1\u5668\u90a3\u4e00\u65b9\u7ed9\u7701\u7565\u4e86\uff0c\u4ece\u4e09\u7aef\u901a\u4fe1\u53d8\u6210\u4e86\u4e24\u7aef\u901a\u4fe1\uff0c\u6240\u4ee5\u624d\u6709\u4e86\u8fd9\u4e2a\u4e22\u5305\u95ee\u9898\u3002</p> <p>\u73b0\u5728\u6211\u4eec\u91cd\u65b0\u5c06\u670d\u52a1\u5668\u52a0\u56de\u6765\u3002</p> <p></p> <p>\u5927\u5bb6\u6709\u6ca1\u6709\u53d1\u73b0\uff0c\u6709\u65f6\u5019\u6211\u4eec\u5728\u624b\u673a\u91cc\u804a\u4e86\u4e00\u5927\u5806\u5185\u5bb9\uff0c\u7136\u540e\u767b\u5f55\u7535\u8111\u7248\uff0c\u5b83\u80fd\u5c06\u6700\u8fd1\u7684\u804a\u5929\u8bb0\u5f55\u90fd\u540c\u6b65\u5230\u7535\u8111\u7248\u4e0a\u3002\u4e5f\u5c31\u662f\u8bf4\u670d\u52a1\u5668\u53ef\u80fd\u8bb0\u5f55\u4e86\u6211\u4eec\u6700\u8fd1\u53d1\u8fc7\u4ec0\u4e48\u6570\u636e\uff0c\u5047\u8bbe\u6bcf\u6761\u6d88\u606f\u90fd\u6709\u4e2a id\uff0c\u670d\u52a1\u5668\u548c\u804a\u5929\u8f6f\u4ef6\u6bcf\u6b21\u90fd\u62ff\u6700\u65b0\u6d88\u606f\u7684 id\u8fdb\u884c\u5bf9\u6bd4\uff0c\u5c31\u80fd\u77e5\u9053\u4e24\u7aef\u6d88\u606f\u662f\u5426\u4e00\u81f4\uff0c\u5c31\u50cf\u5bf9\u8d26\u4e00\u6837\u3002</p> <p>\u5bf9\u4e8e\u53d1\u9001\u65b9\uff0c\u53ea\u8981\u5b9a\u65f6\u8ddf\u670d\u52a1\u7aef\u7684\u5185\u5bb9\u5bf9\u8d26\u4e00\u4e0b\uff0c\u5c31\u77e5\u9053\u54ea\u6761\u6d88\u606f\u6ca1\u53d1\u9001\u6210\u529f\uff0c\u76f4\u63a5\u91cd\u53d1\u5c31\u597d\u4e86\u3002</p> <p>\u5982\u679c\u63a5\u6536\u65b9\u7684\u804a\u5929\u8f6f\u4ef6\u5d29\u6e83\u4e86\uff0c\u91cd\u542f\u540e\u8ddf\u670d\u52a1\u5668\u7a0d\u5fae\u901a\u4fe1\u4e00\u4e0b\u5c31\u77e5\u9053\u5c11\u4e86\u54ea\u6761\u6570\u636e\uff0c\u540c\u6b65\u4e0a\u6765\u5c31\u662f\u4e86\uff0c\u6240\u4ee5\u4e5f\u4e0d\u5b58\u5728\u4e0a\u9762\u63d0\u5230\u7684\u4e22\u5305\u60c5\u51b5\u3002</p> <p>\u53ef\u4ee5\u770b\u51fa\uff0cTCP \u53ea\u4fdd\u8bc1\u4f20\u8f93\u5c42\u7684\u6d88\u606f\u53ef\u9760\u6027\uff0c\u5e76\u4e0d\u4fdd\u8bc1\u5e94\u7528\u5c42\u7684\u6d88\u606f\u53ef\u9760\u6027\u3002\u5982\u679c\u6211\u4eec\u8fd8\u60f3\u4fdd\u8bc1\u5e94\u7528\u5c42\u7684\u6d88\u606f\u53ef\u9760\u6027\uff0c\u5c31\u9700\u8981\u5e94\u7528\u5c42\u81ea\u5df1\u53bb\u5b9e\u73b0\u903b\u8f91\u505a\u4fdd\u8bc1\u3002</p> <p>\u90a3\u4e48\u95ee\u9898\u53d2\u6765\u4e86\uff0c\u4e24\u7aef\u901a\u4fe1\u7684\u65f6\u5019\u4e5f\u80fd\u5bf9\u8d26\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u8981\u5f15\u5165\u7b2c\u4e09\u7aef\u670d\u52a1\u5668\uff1f</p> <p>\u4e3b\u8981\u6709\u4e09\u4e2a\u539f\u56e0\u3002</p> <ul> <li>\u7b2c\u4e00\uff0c\u5982\u679c\u662f\u4e24\u7aef\u901a\u4fe1\uff0c\u4f60\u804a\u5929\u8f6f\u4ef6\u91cc\u6709<code>1000\u4e2a</code>\u597d\u53cb\uff0c\u4f60\u5c31\u5f97\u5efa\u7acb<code>1000\u4e2a</code>\u8fde\u63a5\u3002\u4f46\u5982\u679c\u5f15\u5165\u670d\u52a1\u7aef\uff0c\u4f60\u53ea\u9700\u8981\u8ddf\u670d\u52a1\u5668\u5efa\u7acb<code>1\u4e2a</code>\u8fde\u63a5\u5c31\u591f\u4e86\uff0c\u804a\u5929\u8f6f\u4ef6\u6d88\u8017\u7684\u8d44\u6e90\u8d8a\u5c11\uff0c\u624b\u673a\u5c31\u8d8a\u7701\u7535\u3002</li> <li>\u7b2c\u4e8c\uff0c\u5c31\u662f\u5b89\u5168\u95ee\u9898\uff0c\u5982\u679c\u8fd8\u662f\u4e24\u7aef\u901a\u4fe1\uff0c\u968f\u4fbf\u4e00\u4e2a\u4eba\u627e\u4f60\u5bf9\u8d26\u4e00\u4e0b\uff0c\u4f60\u5c31\u628a\u804a\u5929\u8bb0\u5f55\u7ed9\u540c\u6b65\u8fc7\u53bb\u4e86\uff0c\u8fd9\u5e76\u4e0d\u5408\u9002\u5427\u3002\u5982\u679c\u5bf9\u65b9\u522b\u6709\u7528\u5fc3\uff0c\u4fe1\u606f\u5c31\u6cc4\u9732\u4e86\u3002\u5f15\u5165\u7b2c\u4e09\u65b9\u670d\u52a1\u7aef\u5c31\u53ef\u4ee5\u5f88\u65b9\u4fbf\u7684\u505a\u5404\u79cd\u9274\u6743\u6821\u9a8c\u3002</li> <li>\u7b2c\u4e09\uff0c\u662f\u8f6f\u4ef6\u7248\u672c\u95ee\u9898\u3002\u8f6f\u4ef6\u88c5\u5230\u7528\u6237\u624b\u673a\u4e4b\u540e\uff0c\u8f6f\u4ef6\u66f4\u4e0d\u66f4\u65b0\u5c31\u662f\u7531\u7528\u6237\u8bf4\u4e86\u7b97\u4e86\u3002\u5982\u679c\u8fd8\u662f\u4e24\u7aef\u901a\u4fe1\uff0c\u4e14\u4e24\u7aef\u7684\u8f6f\u4ef6\u7248\u672c\u8de8\u5ea6\u592a\u5927\uff0c\u5f88\u5bb9\u6613\u4ea7\u751f\u5404\u79cd\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u4f46\u5f15\u5165\u7b2c\u4e09\u7aef\u670d\u52a1\u5668\uff0c\u5c31\u53ef\u4ee5\u5f3a\u5236\u90e8\u5206\u8fc7\u4f4e\u7248\u672c\u5347\u7ea7\uff0c\u5426\u5219\u4e0d\u80fd\u4f7f\u7528\u8f6f\u4ef6\u3002\u4f46\u5bf9\u4e8e\u5927\u90e8\u5206\u517c\u5bb9\u6027\u95ee\u9898\uff0c\u7ed9\u670d\u52a1\u7aef\u52a0\u517c\u5bb9\u903b\u8f91\u5c31\u597d\u4e86\uff0c\u4e0d\u9700\u8981\u5f3a\u5236\u7528\u6237\u66f4\u65b0\u8f6f\u4ef6\u3002</li> </ul> <p>\u6240\u4ee5\u770b\u5230\u8fd9\u91cc\u5927\u5bb6\u5e94\u8be5\u660e\u767d\u4e86\uff0c\u6211\u628a\u670d\u52a1\u7aef\u53bb\u6389\uff0c\u5e76\u4e0d\u5355\u7eaf\u662f\u4e3a\u4e86\u7b80\u5355\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_drop/#_10","title":"\u603b\u7ed3","text":"<ul> <li>\u6570\u636e\u4ece\u53d1\u9001\u7aef\u5230\u63a5\u6536\u7aef\uff0c\u94fe\u8def\u5f88\u957f\uff0c\u4efb\u4f55\u4e00\u4e2a\u5730\u65b9\u90fd\u53ef\u80fd\u53d1\u751f\u4e22\u5305\uff0c\u51e0\u4e4e\u53ef\u4ee5\u8bf4\u4e22\u5305\u4e0d\u53ef\u907f\u514d\u3002</li> <li>\u5e73\u65f6\u6ca1\u4e8b\u4e5f\u4e0d\u7528\u5173\u6ce8\u4e22\u5305\uff0c\u5927\u90e8\u5206\u65f6\u5019 TCP \u7684\u91cd\u4f20\u673a\u5236\u4fdd\u8bc1\u4e86\u6d88\u606f\u53ef\u9760\u6027\u3002</li> <li>\u5f53\u4f60\u53d1\u73b0\u670d\u52a1\u5f02\u5e38\u7684\u65f6\u5019\uff0c\u6bd4\u5982\u63a5\u53e3\u5ef6\u65f6\u5f88\u9ad8\uff0c\u603b\u662f\u5931\u8d25\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u7528 ping \u6216\u8005 mtr \u547d\u4ee4\u770b\u4e0b\u662f\u4e0d\u662f\u4e2d\u95f4\u94fe\u8def\u53d1\u751f\u4e86\u4e22\u5305\u3002</li> <li>TCP \u53ea\u4fdd\u8bc1\u4f20\u8f93\u5c42\u7684\u6d88\u606f\u53ef\u9760\u6027\uff0c\u5e76\u4e0d\u4fdd\u8bc1\u5e94\u7528\u5c42\u7684\u6d88\u606f\u53ef\u9760\u6027\u3002\u5982\u679c\u6211\u4eec\u8fd8\u60f3\u4fdd\u8bc1\u5e94\u7528\u5c42\u7684\u6d88\u606f\u53ef\u9760\u6027\uff0c\u5c31\u9700\u8981\u5e94\u7528\u5c42\u81ea\u5df1\u53bb\u5b9e\u73b0\u903b\u8f91\u505a\u4fdd\u8bc1\u3002</li> </ul> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/","title":"4.2 TCP \u91cd\u4f20\u3001\u6ed1\u52a8\u7a97\u53e3\u3001\u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236","text":"<p>TCP \u5de8\u590d\u6742\uff0c\u5b83\u4e3a\u4e86\u4fdd\u8bc1\u53ef\u9760\u6027\uff0c\u7528\u4e86\u5de8\u591a\u7684\u673a\u5236\u6765\u4fdd\u8bc1\uff0c\u771f\u662f\u4e2a\u300c\u4f1f\u5927\u300d\u7684\u534f\u8bae\uff0c\u5199\u7740\u5199\u7740\u53d1\u73b0\u8fd9\u6c34\u592a\u6df1\u4e86\u3002\u3002\u3002</p> <p>\u672c\u6587\u7684\u5168\u90e8\u56fe\u7247\u90fd\u662f\u5c0f\u6797\u7ed8\u753b\u7684\uff0c\u975e\u5e38\u7684\u8f9b\u82e6\u4e14\u7d2f\uff0c\u4e0d\u5e9f\u8bdd\u4e86\uff0c\u76f4\u63a5\u8fdb\u5165\u6b63\u6587\uff0cGo\uff01</p> <p>\u76f8\u4fe1\u5927\u5bb6\u90fd\u77e5\u9053 TCP \u662f\u4e00\u4e2a\u53ef\u9760\u4f20\u8f93\u7684\u534f\u8bae\uff0c\u90a3\u5b83\u662f\u5982\u4f55\u4fdd\u8bc1\u53ef\u9760\u7684\u5462\uff1f</p> <p>\u4e3a\u4e86\u5b9e\u73b0\u53ef\u9760\u6027\u4f20\u8f93\uff0c\u9700\u8981\u8003\u8651\u5f88\u591a\u4e8b\u60c5\uff0c\u4f8b\u5982\u6570\u636e\u7684\u7834\u574f\u3001\u4e22\u5305\u3001\u91cd\u590d\u4ee5\u53ca\u5206\u7247\u987a\u5e8f\u6df7\u4e71\u7b49\u95ee\u9898\u3002\u5982\u4e0d\u80fd\u89e3\u51b3\u8fd9\u4e9b\u95ee\u9898\uff0c\u4e5f\u5c31\u65e0\u4ece\u8c08\u8d77\u53ef\u9760\u4f20\u8f93\u3002</p> <p>\u90a3\u4e48\uff0cTCP \u662f\u901a\u8fc7\u5e8f\u5217\u53f7\u3001\u786e\u8ba4\u5e94\u7b54\u3001\u91cd\u53d1\u63a7\u5236\u3001\u8fde\u63a5\u7ba1\u7406\u4ee5\u53ca\u7a97\u53e3\u63a7\u5236\u7b49\u673a\u5236\u5b9e\u73b0\u53ef\u9760\u6027\u4f20\u8f93\u7684\u3002</p> <p>\u4eca\u5929\uff0c\u5c06\u91cd\u70b9\u4ecb\u7ecd TCP \u7684\u91cd\u4f20\u673a\u5236\u3001\u6ed1\u52a8\u7a97\u53e3\u3001\u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_1","title":"\u91cd\u4f20\u673a\u5236","text":"<p>TCP \u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\u7684\u65b9\u5f0f\u4e4b\u4e00\uff0c\u662f\u901a\u8fc7\u5e8f\u5217\u53f7\u4e0e\u786e\u8ba4\u5e94\u7b54\u3002</p> <p>\u5728 TCP \u4e2d\uff0c\u5f53\u53d1\u9001\u7aef\u7684\u6570\u636e\u5230\u8fbe\u63a5\u6536\u4e3b\u673a\u65f6\uff0c\u63a5\u6536\u7aef\u4e3b\u673a\u4f1a\u8fd4\u56de\u4e00\u4e2a\u786e\u8ba4\u5e94\u7b54\u6d88\u606f\uff0c\u8868\u793a\u5df2\u6536\u5230\u6d88\u606f\u3002</p> <p></p> <p>\u4f46\u5728\u9519\u7efc\u590d\u6742\u7684\u7f51\u7edc\uff0c\u5e76\u4e0d\u4e00\u5b9a\u80fd\u5982\u4e0a\u56fe\u90a3\u4e48\u987a\u5229\u80fd\u6b63\u5e38\u7684\u6570\u636e\u4f20\u8f93\uff0c\u4e07\u4e00\u6570\u636e\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u4e22\u5931\u4e86\u5462\uff1f</p> <p>\u6240\u4ee5 TCP \u9488\u5bf9\u6570\u636e\u5305\u4e22\u5931\u7684\u60c5\u51b5\uff0c\u4f1a\u7528\u91cd\u4f20\u673a\u5236\u89e3\u51b3\u3002</p> <p>\u63a5\u4e0b\u6765\u8bf4\u8bf4\u5e38\u89c1\u7684\u91cd\u4f20\u673a\u5236\uff1a</p> <ul> <li>\u8d85\u65f6\u91cd\u4f20</li> <li>\u5feb\u901f\u91cd\u4f20</li> <li>SACK</li> <li>D-SACK</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_2","title":"\u8d85\u65f6\u91cd\u4f20","text":"<p>\u91cd\u4f20\u673a\u5236\u7684\u5176\u4e2d\u4e00\u4e2a\u65b9\u5f0f\uff0c\u5c31\u662f\u5728\u53d1\u9001\u6570\u636e\u65f6\uff0c\u8bbe\u5b9a\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5f53\u8d85\u8fc7\u6307\u5b9a\u7684\u65f6\u95f4\u540e\uff0c\u6ca1\u6709\u6536\u5230\u5bf9\u65b9\u7684 <code>ACK</code> \u786e\u8ba4\u5e94\u7b54\u62a5\u6587\uff0c\u5c31\u4f1a\u91cd\u53d1\u8be5\u6570\u636e\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684\u8d85\u65f6\u91cd\u4f20\u3002</p> <p>TCP \u4f1a\u5728\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u53d1\u751f\u8d85\u65f6\u91cd\u4f20\uff1a</p> <ul> <li>\u6570\u636e\u5305\u4e22\u5931</li> <li>\u786e\u8ba4\u5e94\u7b54\u4e22\u5931</li> </ul> <p></p> <p>\u8d85\u65f6\u65f6\u95f4\u5e94\u8be5\u8bbe\u7f6e\u4e3a\u591a\u5c11\u5462\uff1f</p> <p>\u6211\u4eec\u5148\u6765\u4e86\u89e3\u4e00\u4e0b\u4ec0\u4e48\u662f <code>RTT</code>\uff08Round-Trip Time \u5f80\u8fd4\u65f6\u5ef6\uff09\uff0c\u4ece\u4e0b\u56fe\u6211\u4eec\u5c31\u53ef\u4ee5\u77e5\u9053\uff1a</p> <p></p> <p><code>RTT</code> \u6307\u7684\u662f\u6570\u636e\u53d1\u9001\u65f6\u523b\u5230\u63a5\u6536\u5230\u786e\u8ba4\u7684\u65f6\u523b\u7684\u5dee\u503c\uff0c\u4e5f\u5c31\u662f\u5305\u7684\u5f80\u8fd4\u65f6\u95f4\u3002</p> <p>\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4\u662f\u4ee5 <code>RTO</code> \uff08Retransmission Timeout \u8d85\u65f6\u91cd\u4f20\u65f6\u95f4\uff09\u8868\u793a\u3002</p> <p>\u5047\u8bbe\u5728\u91cd\u4f20\u7684\u60c5\u51b5\u4e0b\uff0c\u8d85\u65f6\u65f6\u95f4 <code>RTO</code> \u300c\u8f83\u957f\u6216\u8f83\u77ed\u300d\u65f6\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\u4e8b\u60c5\u5462\uff1f</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u6709\u4e24\u79cd\u8d85\u65f6\u65f6\u95f4\u4e0d\u540c\u7684\u60c5\u51b5\uff1a</p> <ul> <li>\u5f53\u8d85\u65f6\u65f6\u95f4 RTO \u8f83\u5927\u65f6\uff0c\u91cd\u53d1\u5c31\u6162\uff0c\u4e22\u4e86\u8001\u534a\u5929\u624d\u91cd\u53d1\uff0c\u6ca1\u6709\u6548\u7387\uff0c\u6027\u80fd\u5dee\uff1b</li> <li>\u5f53\u8d85\u65f6\u65f6\u95f4 RTO \u8f83\u5c0f\u65f6\uff0c\u4f1a\u5bfc\u81f4\u53ef\u80fd\u5e76\u6ca1\u6709\u4e22\u5c31\u91cd\u53d1\uff0c\u4e8e\u662f\u91cd\u53d1\u7684\u5c31\u5feb\uff0c\u4f1a\u589e\u52a0\u7f51\u7edc\u62e5\u585e\uff0c\u5bfc\u81f4\u66f4\u591a\u7684\u8d85\u65f6\uff0c\u66f4\u591a\u7684\u8d85\u65f6\u5bfc\u81f4\u66f4\u591a\u7684\u91cd\u53d1\u3002</li> </ul> <p>\u7cbe\u786e\u7684\u6d4b\u91cf\u8d85\u65f6\u65f6\u95f4 <code>RTO</code> \u7684\u503c\u662f\u975e\u5e38\u91cd\u8981\u7684\uff0c\u8fd9\u53ef\u8ba9\u6211\u4eec\u7684\u91cd\u4f20\u673a\u5236\u66f4\u9ad8\u6548\u3002</p> <p>\u6839\u636e\u4e0a\u8ff0\u7684\u4e24\u79cd\u60c5\u51b5\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\uff0c\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4 RTO \u7684\u503c\u5e94\u8be5\u7565\u5927\u4e8e\u62a5\u6587\u5f80\u8fd4  RTT \u7684\u503c\u3002</p> <p></p> <p>\u81f3\u6b64\uff0c\u53ef\u80fd\u5927\u5bb6\u89c9\u5f97\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4 <code>RTO</code> \u7684\u503c\u8ba1\u7b97\uff0c\u4e5f\u4e0d\u662f\u5f88\u590d\u6742\u561b\u3002</p> <p>\u597d\u50cf\u5c31\u662f\u5728\u53d1\u9001\u7aef\u53d1\u5305\u65f6\u8bb0\u4e0b <code>t0</code> \uff0c\u7136\u540e\u63a5\u6536\u7aef\u518d\u628a\u8fd9\u4e2a <code>ack</code> \u56de\u6765\u65f6\u518d\u8bb0\u4e00\u4e2a <code>t1</code>\uff0c\u4e8e\u662f <code>RTT = t1 \u2013 t0</code>\u3002\u6ca1\u90a3\u4e48\u7b80\u5355\uff0c\u8fd9\u53ea\u662f\u4e00\u4e2a\u91c7\u6837\uff0c\u4e0d\u80fd\u4ee3\u8868\u666e\u904d\u60c5\u51b5\u3002</p> <p>\u5b9e\u9645\u4e0a\u300c\u62a5\u6587\u5f80\u8fd4 RTT \u7684\u503c\u300d\u662f\u7ecf\u5e38\u53d8\u5316\u7684\uff0c\u56e0\u4e3a\u6211\u4eec\u7684\u7f51\u7edc\u4e5f\u662f\u65f6\u5e38\u53d8\u5316\u7684\u3002\u4e5f\u5c31\u56e0\u4e3a\u300c\u62a5\u6587\u5f80\u8fd4 RTT \u7684\u503c\u300d\u662f\u7ecf\u5e38\u6ce2\u52a8\u53d8\u5316\u7684\uff0c\u6240\u4ee5\u300c\u8d85\u65f6\u91cd\u4f20\u65f6\u95f4 RTO \u7684\u503c\u300d\u5e94\u8be5\u662f\u4e00\u4e2a\u52a8\u6001\u53d8\u5316\u7684\u503c\u3002</p> <p>\u6211\u4eec\u6765\u770b\u770b Linux \u662f\u5982\u4f55\u8ba1\u7b97 <code>RTO</code> \u7684\u5462\uff1f</p> <p>\u4f30\u8ba1\u5f80\u8fd4\u65f6\u95f4\uff0c\u901a\u5e38\u9700\u8981\u91c7\u6837\u4ee5\u4e0b\u4e24\u4e2a\uff1a</p> <ul> <li>\u9700\u8981 TCP \u901a\u8fc7\u91c7\u6837 RTT \u7684\u65f6\u95f4\uff0c\u7136\u540e\u8fdb\u884c\u52a0\u6743\u5e73\u5747\uff0c\u7b97\u51fa\u4e00\u4e2a\u5e73\u6ed1 RTT \u7684\u503c\uff0c\u800c\u4e14\u8fd9\u4e2a\u503c\u8fd8\u662f\u8981\u4e0d\u65ad\u53d8\u5316\u7684\uff0c\u56e0\u4e3a\u7f51\u7edc\u72b6\u51b5\u4e0d\u65ad\u5730\u53d8\u5316\u3002</li> <li>\u9664\u4e86\u91c7\u6837 RTT\uff0c\u8fd8\u8981\u91c7\u6837 RTT \u7684\u6ce2\u52a8\u8303\u56f4\uff0c\u8fd9\u6837\u5c31\u907f\u514d\u5982\u679c RTT \u6709\u4e00\u4e2a\u5927\u7684\u6ce2\u52a8\u7684\u8bdd\uff0c\u5f88\u96be\u88ab\u53d1\u73b0\u7684\u60c5\u51b5\u3002</li> </ul> <p>RFC6289 \u5efa\u8bae\u4f7f\u7528\u4ee5\u4e0b\u7684\u516c\u5f0f\u8ba1\u7b97 RTO\uff1a</p> <p></p> <p>\u5176\u4e2d <code>SRTT</code> \u662f\u8ba1\u7b97\u5e73\u6ed1\u7684 RTT\uff0c<code>DevRTR</code> \u662f\u8ba1\u7b97\u5e73\u6ed1\u7684 RTT \u4e0e \u6700\u65b0 RTT \u7684\u5dee\u8ddd\u3002</p> <p>\u5728 Linux \u4e0b\uff0c\u03b1 = 0.125\uff0c\u03b2 = 0.25\uff0c \u03bc = 1\uff0c\u2202 = 4\u3002\u522b\u95ee\u600e\u4e48\u6765\u7684\uff0c\u95ee\u5c31\u662f\u5927\u91cf\u5b9e\u9a8c\u4e2d\u8c03\u51fa\u6765\u7684\u3002</p> <p>\u5982\u679c\u8d85\u65f6\u91cd\u53d1\u7684\u6570\u636e\uff0c\u518d\u6b21\u8d85\u65f6\u7684\u65f6\u5019\uff0c\u53c8\u9700\u8981\u91cd\u4f20\u7684\u65f6\u5019\uff0cTCP \u7684\u7b56\u7565\u662f\u8d85\u65f6\u95f4\u9694\u52a0\u500d\u3002</p> <p>\u4e5f\u5c31\u662f\u6bcf\u5f53\u9047\u5230\u4e00\u6b21\u8d85\u65f6\u91cd\u4f20\u7684\u65f6\u5019\uff0c\u90fd\u4f1a\u5c06\u4e0b\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u95f4\u9694\u8bbe\u4e3a\u5148\u524d\u503c\u7684\u4e24\u500d\u3002\u4e24\u6b21\u8d85\u65f6\uff0c\u5c31\u8bf4\u660e\u7f51\u7edc\u73af\u5883\u5dee\uff0c\u4e0d\u5b9c\u9891\u7e41\u53cd\u590d\u53d1\u9001\u3002</p> <p>\u8d85\u65f6\u89e6\u53d1\u91cd\u4f20\u5b58\u5728\u7684\u95ee\u9898\u662f\uff0c\u8d85\u65f6\u5468\u671f\u53ef\u80fd\u76f8\u5bf9\u8f83\u957f\u3002\u90a3\u662f\u4e0d\u662f\u53ef\u4ee5\u6709\u66f4\u5feb\u7684\u65b9\u5f0f\u5462\uff1f</p> <p>\u4e8e\u662f\u5c31\u53ef\u4ee5\u7528\u300c\u5feb\u901f\u91cd\u4f20\u300d\u673a\u5236\u6765\u89e3\u51b3\u8d85\u65f6\u91cd\u53d1\u7684\u65f6\u95f4\u7b49\u5f85\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_3","title":"\u5feb\u901f\u91cd\u4f20","text":"<p>TCP \u8fd8\u6709\u53e6\u5916\u4e00\u79cd\u5feb\u901f\u91cd\u4f20\uff08Fast Retransmit\uff09\u673a\u5236\uff0c\u5b83\u4e0d\u4ee5\u65f6\u95f4\u4e3a\u9a71\u52a8\uff0c\u800c\u662f\u4ee5\u6570\u636e\u9a71\u52a8\u91cd\u4f20\u3002</p> <p>\u5feb\u901f\u91cd\u4f20\u673a\u5236\uff0c\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u5462\uff1f\u5176\u5b9e\u5f88\u7b80\u5355\uff0c\u4e00\u56fe\u80dc\u5343\u8a00\u3002</p> <p></p> <p>\u5728\u4e0a\u56fe\uff0c\u53d1\u9001\u65b9\u53d1\u51fa\u4e86 1\uff0c2\uff0c3\uff0c4\uff0c5 \u4efd\u6570\u636e\uff1a</p> <ul> <li>\u7b2c\u4e00\u4efd Seq1 \u5148\u9001\u5230\u4e86\uff0c\u4e8e\u662f\u5c31 Ack \u56de 2\uff1b</li> <li>\u7ed3\u679c Seq2 \u56e0\u4e3a\u67d0\u4e9b\u539f\u56e0\u6ca1\u6536\u5230\uff0cSeq3 \u5230\u8fbe\u4e86\uff0c\u4e8e\u662f\u8fd8\u662f Ack \u56de 2\uff1b</li> <li>\u540e\u9762\u7684 Seq4 \u548c Seq5 \u90fd\u5230\u4e86\uff0c\u4f46\u8fd8\u662f Ack \u56de 2\uff0c\u56e0\u4e3a Seq2 \u8fd8\u662f\u6ca1\u6709\u6536\u5230\uff1b</li> <li>\u53d1\u9001\u7aef\u6536\u5230\u4e86\u4e09\u4e2a Ack = 2 \u7684\u786e\u8ba4\uff0c\u77e5\u9053\u4e86 Seq2 \u8fd8\u6ca1\u6709\u6536\u5230\uff0c\u5c31\u4f1a\u5728\u5b9a\u65f6\u5668\u8fc7\u671f\u4e4b\u524d\uff0c\u91cd\u4f20\u4e22\u5931\u7684 Seq2\u3002</li> <li>\u6700\u540e\uff0c\u6536\u5230\u4e86 Seq2\uff0c\u6b64\u65f6\u56e0\u4e3a Seq3\uff0cSeq4\uff0cSeq5 \u90fd\u6536\u5230\u4e86\uff0c\u4e8e\u662f Ack \u56de 6\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u5feb\u901f\u91cd\u4f20\u7684\u5de5\u4f5c\u65b9\u5f0f\u662f\u5f53\u6536\u5230\u4e09\u4e2a\u76f8\u540c\u7684 ACK \u62a5\u6587\u65f6\uff0c\u4f1a\u5728\u5b9a\u65f6\u5668\u8fc7\u671f\u4e4b\u524d\uff0c\u91cd\u4f20\u4e22\u5931\u7684\u62a5\u6587\u6bb5\u3002</p> <p>\u5feb\u901f\u91cd\u4f20\u673a\u5236\u53ea\u89e3\u51b3\u4e86\u4e00\u4e2a\u95ee\u9898\uff0c\u5c31\u662f\u8d85\u65f6\u65f6\u95f4\u7684\u95ee\u9898\uff0c\u4f46\u662f\u5b83\u4f9d\u7136\u9762\u4e34\u7740\u53e6\u5916\u4e00\u4e2a\u95ee\u9898\u3002\u5c31\u662f\u91cd\u4f20\u7684\u65f6\u5019\uff0c\u662f\u91cd\u4f20\u4e00\u4e2a\uff0c\u8fd8\u662f\u91cd\u4f20\u6240\u6709\u7684\u95ee\u9898\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe\u53d1\u9001\u65b9\u53d1\u4e86 6 \u4e2a\u6570\u636e\uff0c\u7f16\u53f7\u7684\u987a\u5e8f\u662f Seq1 ~ Seq6\uff0c\u4f46\u662f Seq2\u3001Seq3 \u90fd\u4e22\u5931\u4e86\uff0c\u90a3\u4e48\u63a5\u6536\u65b9\u5728\u6536\u5230 Seq4\u3001Seq5\u3001Seq6 \u65f6\uff0c\u90fd\u662f\u56de\u590d ACK2 \u7ed9\u53d1\u9001\u65b9\uff0c\u4f46\u662f\u53d1\u9001\u65b9\u5e76\u4e0d\u6e05\u695a\u8fd9\u8fde\u7eed\u7684 ACK2 \u662f\u63a5\u6536\u65b9\u6536\u5230\u54ea\u4e2a\u62a5\u6587\u800c\u56de\u590d\u7684\uff0c\u90a3\u662f\u9009\u62e9\u91cd\u4f20 Seq2 \u4e00\u4e2a\u62a5\u6587\uff0c\u8fd8\u662f\u91cd\u4f20  Seq2 \u4e4b\u540e\u5df2\u53d1\u9001\u7684\u6240\u6709\u62a5\u6587\u5462\uff08Seq2\u3001Seq3\u3001Seq4\u3001Seq5\u3001Seq6\uff09\u5462\uff1f</p> <ul> <li> <p>\u5982\u679c\u53ea\u9009\u62e9\u91cd\u4f20 Seq2 \u4e00\u4e2a\u62a5\u6587\uff0c\u90a3\u4e48\u91cd\u4f20\u7684\u6548\u7387\u5f88\u4f4e\u3002\u56e0\u4e3a\u5bf9\u4e8e\u4e22\u5931\u7684 Seq3 \u62a5\u6587\uff0c\u8fd8\u5f97\u5728\u540e\u7eed\u6536\u5230\u4e09\u4e2a\u91cd\u590d\u7684 ACK3 \u624d\u80fd\u89e6\u53d1\u91cd\u4f20\u3002</p> </li> <li> <p>\u5982\u679c\u9009\u62e9\u91cd\u4f20 Seq2 \u4e4b\u540e\u5df2\u53d1\u9001\u7684\u6240\u6709\u62a5\u6587\uff0c\u867d\u7136\u80fd\u540c\u65f6\u91cd\u4f20\u5df2\u4e22\u5931\u7684 Seq2 \u548c Seq3 \u62a5\u6587\uff0c\u4f46\u662f  Seq4\u3001Seq5\u3001Seq6 \u7684\u62a5\u6587\u662f\u5df2\u7ecf\u88ab\u63a5\u6536\u8fc7\u4e86\uff0c\u5bf9\u4e8e\u91cd\u4f20 Seq4 \uff5eSeq6 \u6298\u90e8\u5206\u6570\u636e\u76f8\u5f53\u4e8e\u505a\u4e86\u4e00\u6b21\u65e0\u7528\u529f\uff0c\u6d6a\u8d39\u8d44\u6e90\u3002</p> </li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u4e0d\u7ba1\u662f\u91cd\u4f20\u4e00\u4e2a\u62a5\u6587\uff0c\u8fd8\u662f\u91cd\u4f20\u5df2\u53d1\u9001\u7684\u62a5\u6587\uff0c\u90fd\u5b58\u5728\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u4e0d\u77e5\u9053\u8be5\u91cd\u4f20\u54ea\u4e9b TCP \u62a5\u6587\uff0c\u4e8e\u662f\u5c31\u6709 <code>SACK</code> \u65b9\u6cd5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#sack","title":"SACK \u65b9\u6cd5","text":"<p>\u8fd8\u6709\u4e00\u79cd\u5b9e\u73b0\u91cd\u4f20\u673a\u5236\u7684\u65b9\u5f0f\u53eb\uff1a<code>SACK</code>\uff08 Selective Acknowledgment\uff09\uff0c \u9009\u62e9\u6027\u786e\u8ba4\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u9700\u8981\u5728 TCP \u5934\u90e8\u300c\u9009\u9879\u300d\u5b57\u6bb5\u91cc\u52a0\u4e00\u4e2a <code>SACK</code> \u7684\u4e1c\u897f\uff0c\u5b83\u53ef\u4ee5\u5c06\u5df2\u6536\u5230\u7684\u6570\u636e\u7684\u4fe1\u606f\u53d1\u9001\u7ed9\u300c\u53d1\u9001\u65b9\u300d\uff0c\u8fd9\u6837\u53d1\u9001\u65b9\u5c31\u53ef\u4ee5\u77e5\u9053\u54ea\u4e9b\u6570\u636e\u6536\u5230\u4e86\uff0c\u54ea\u4e9b\u6570\u636e\u6ca1\u6536\u5230\uff0c\u77e5\u9053\u4e86\u8fd9\u4e9b\u4fe1\u606f\uff0c\u5c31\u53ef\u4ee5\u53ea\u91cd\u4f20\u4e22\u5931\u7684\u6570\u636e\u3002</p> <p>\u5982\u4e0b\u56fe\uff0c\u53d1\u9001\u65b9\u6536\u5230\u4e86\u4e09\u6b21\u540c\u6837\u7684 ACK \u786e\u8ba4\u62a5\u6587\uff0c\u4e8e\u662f\u5c31\u4f1a\u89e6\u53d1\u5feb\u901f\u91cd\u53d1\u673a\u5236\uff0c\u901a\u8fc7 <code>SACK</code> \u4fe1\u606f\u53d1\u73b0\u53ea\u6709 <code>200~299</code> \u8fd9\u6bb5\u6570\u636e\u4e22\u5931\uff0c\u5219\u91cd\u53d1\u65f6\uff0c\u5c31\u53ea\u9009\u62e9\u4e86\u8fd9\u4e2a TCP \u6bb5\u8fdb\u884c\u91cd\u590d\u3002</p> <p></p> <p>\u5982\u679c\u8981\u652f\u6301 <code>SACK</code>\uff0c\u5fc5\u987b\u53cc\u65b9\u90fd\u8981\u652f\u6301\u3002\u5728 Linux \u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>net.ipv4.tcp_sack</code> \u53c2\u6570\u6253\u5f00\u8fd9\u4e2a\u529f\u80fd\uff08Linux 2.4 \u540e\u9ed8\u8ba4\u6253\u5f00\uff09\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#duplicate-sack","title":"Duplicate SACK","text":"<p>Duplicate SACK \u53c8\u79f0 <code>D-SACK</code>\uff0c\u5176\u4e3b\u8981\u4f7f\u7528\u4e86 SACK \u6765\u544a\u8bc9\u300c\u53d1\u9001\u65b9\u300d\u6709\u54ea\u4e9b\u6570\u636e\u88ab\u91cd\u590d\u63a5\u6536\u4e86\u3002</p> <p>\u4e0b\u9762\u4e3e\u4f8b\u4e24\u4e2a\u6817\u5b50\uff0c\u6765\u8bf4\u660e <code>D-SACK</code> \u7684\u4f5c\u7528\u3002</p> <p>\u6817\u5b50\u4e00\u53f7\uff1aACK \u4e22\u5305</p> <p></p> <ul> <li>\u300c\u63a5\u6536\u65b9\u300d\u53d1\u7ed9\u300c\u53d1\u9001\u65b9\u300d\u7684\u4e24\u4e2a ACK \u786e\u8ba4\u5e94\u7b54\u90fd\u4e22\u5931\u4e86\uff0c\u6240\u4ee5\u53d1\u9001\u65b9\u8d85\u65f6\u540e\uff0c\u91cd\u4f20\u7b2c\u4e00\u4e2a\u6570\u636e\u5305\uff083000 ~ 3499\uff09</li> <li>\u4e8e\u662f\u300c\u63a5\u6536\u65b9\u300d\u53d1\u73b0\u6570\u636e\u662f\u91cd\u590d\u6536\u5230\u7684\uff0c\u4e8e\u662f\u56de\u4e86\u4e00\u4e2a SACK = 3000~3500\uff0c\u544a\u8bc9\u300c\u53d1\u9001\u65b9\u300d3000~3500 \u7684\u6570\u636e\u65e9\u5df2\u88ab\u63a5\u6536\u4e86\uff0c\u56e0\u4e3a ACK \u90fd\u5230\u4e86 4000 \u4e86\uff0c\u5df2\u7ecf\u610f\u5473\u7740 4000 \u4e4b\u524d\u7684\u6240\u6709\u6570\u636e\u90fd\u5df2\u6536\u5230\uff0c\u6240\u4ee5\u8fd9\u4e2a SACK \u5c31\u4ee3\u8868\u7740 <code>D-SACK</code>\u3002</li> <li>\u8fd9\u6837\u300c\u53d1\u9001\u65b9\u300d\u5c31\u77e5\u9053\u4e86\uff0c\u6570\u636e\u6ca1\u6709\u4e22\uff0c\u662f\u300c\u63a5\u6536\u65b9\u300d\u7684 ACK \u786e\u8ba4\u62a5\u6587\u4e22\u4e86\u3002</li> </ul> <p>\u6817\u5b50\u4e8c\u53f7\uff1a\u7f51\u7edc\u5ef6\u65f6</p> <p></p> <ul> <li>\u6570\u636e\u5305\uff081000~1499\uff09\u88ab\u7f51\u7edc\u5ef6\u8fdf\u4e86\uff0c\u5bfc\u81f4\u300c\u53d1\u9001\u65b9\u300d\u6ca1\u6709\u6536\u5230 Ack 1500 \u7684\u786e\u8ba4\u62a5\u6587\u3002</li> <li>\u800c\u540e\u9762\u62a5\u6587\u5230\u8fbe\u7684\u4e09\u4e2a\u76f8\u540c\u7684 ACK \u786e\u8ba4\u62a5\u6587\uff0c\u5c31\u89e6\u53d1\u4e86\u5feb\u901f\u91cd\u4f20\u673a\u5236\uff0c\u4f46\u662f\u5728\u91cd\u4f20\u540e\uff0c\u88ab\u5ef6\u8fdf\u7684\u6570\u636e\u5305\uff081000~1499\uff09\u53c8\u5230\u4e86\u300c\u63a5\u6536\u65b9\u300d\uff1b</li> <li>\u6240\u4ee5\u300c\u63a5\u6536\u65b9\u300d\u56de\u4e86\u4e00\u4e2a SACK=1000~1500\uff0c\u56e0\u4e3a ACK \u5df2\u7ecf\u5230\u4e86 3000\uff0c\u6240\u4ee5\u8fd9\u4e2a SACK \u662f D-SACK\uff0c\u8868\u793a\u6536\u5230\u4e86\u91cd\u590d\u7684\u5305\u3002</li> <li>\u8fd9\u6837\u53d1\u9001\u65b9\u5c31\u77e5\u9053\u5feb\u901f\u91cd\u4f20\u89e6\u53d1\u7684\u539f\u56e0\u4e0d\u662f\u53d1\u51fa\u53bb\u7684\u5305\u4e22\u4e86\uff0c\u4e5f\u4e0d\u662f\u56e0\u4e3a\u56de\u5e94\u7684 ACK \u5305\u4e22\u4e86\uff0c\u800c\u662f\u56e0\u4e3a\u7f51\u7edc\u5ef6\u8fdf\u4e86\u3002</li> </ul> <p>\u53ef\u89c1\uff0c<code>D-SACK</code> \u6709\u8fd9\u4e48\u51e0\u4e2a\u597d\u5904\uff1a</p> <ol> <li>\u53ef\u4ee5\u8ba9\u300c\u53d1\u9001\u65b9\u300d\u77e5\u9053\uff0c\u662f\u53d1\u51fa\u53bb\u7684\u5305\u4e22\u4e86\uff0c\u8fd8\u662f\u63a5\u6536\u65b9\u56de\u5e94\u7684 ACK \u5305\u4e22\u4e86;</li> <li>\u53ef\u4ee5\u77e5\u9053\u662f\u4e0d\u662f\u300c\u53d1\u9001\u65b9\u300d\u7684\u6570\u636e\u5305\u88ab\u7f51\u7edc\u5ef6\u8fdf\u4e86;</li> <li>\u53ef\u4ee5\u77e5\u9053\u7f51\u7edc\u4e2d\u662f\u4e0d\u662f\u628a\u300c\u53d1\u9001\u65b9\u300d\u7684\u6570\u636e\u5305\u7ed9\u590d\u5236\u4e86;</li> </ol> <p>\u5728 Linux \u4e0b\u53ef\u4ee5\u901a\u8fc7 <code>net.ipv4.tcp_dsack</code> \u53c2\u6570\u5f00\u542f/\u5173\u95ed\u8fd9\u4e2a\u529f\u80fd\uff08Linux 2.4 \u540e\u9ed8\u8ba4\u6253\u5f00\uff09\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_4","title":"\u6ed1\u52a8\u7a97\u53e3","text":"<p>\u5f15\u5165\u7a97\u53e3\u6982\u5ff5\u7684\u539f\u56e0</p> <p>\u6211\u4eec\u90fd\u77e5\u9053 TCP \u662f\u6bcf\u53d1\u9001\u4e00\u4e2a\u6570\u636e\uff0c\u90fd\u8981\u8fdb\u884c\u4e00\u6b21\u786e\u8ba4\u5e94\u7b54\u3002\u5f53\u4e0a\u4e00\u4e2a\u6570\u636e\u5305\u6536\u5230\u4e86\u5e94\u7b54\u4e86\uff0c\u518d\u53d1\u9001\u4e0b\u4e00\u4e2a\u3002</p> <p>\u8fd9\u4e2a\u6a21\u5f0f\u5c31\u6709\u70b9\u50cf\u6211\u548c\u4f60\u9762\u5bf9\u9762\u804a\u5929\uff0c\u4f60\u4e00\u53e5\u6211\u4e00\u53e5\u3002\u4f46\u8fd9\u79cd\u65b9\u5f0f\u7684\u7f3a\u70b9\u662f\u6548\u7387\u6bd4\u8f83\u4f4e\u7684\u3002</p> <p>\u5982\u679c\u4f60\u8bf4\u5b8c\u4e00\u53e5\u8bdd\uff0c\u6211\u5728\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\uff0c\u6ca1\u6709\u53ca\u65f6\u56de\u590d\u4f60\uff0c\u90a3\u4f60\u4e0d\u662f\u8981\u5e72\u7b49\u7740\u6211\u505a\u5b8c\u5176\u4ed6\u4e8b\u60c5\u540e\uff0c\u6211\u56de\u590d\u4f60\uff0c\u4f60\u624d\u80fd\u8bf4\u4e0b\u4e00\u53e5\u8bdd\uff0c\u5f88\u663e\u7136\u8fd9\u4e0d\u73b0\u5b9e\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u8fd9\u6837\u7684\u4f20\u8f93\u65b9\u5f0f\u6709\u4e00\u4e2a\u7f3a\u70b9\uff1a\u6570\u636e\u5305\u7684\u5f80\u8fd4\u65f6\u95f4\u8d8a\u957f\uff0c\u901a\u4fe1\u7684\u6548\u7387\u5c31\u8d8a\u4f4e\u3002</p> <p>\u4e3a\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cTCP \u5f15\u5165\u4e86\u7a97\u53e3\u8fd9\u4e2a\u6982\u5ff5\u3002\u5373\u4f7f\u5728\u5f80\u8fd4\u65f6\u95f4\u8f83\u957f\u7684\u60c5\u51b5\u4e0b\uff0c\u5b83\u4e5f\u4e0d\u4f1a\u964d\u4f4e\u7f51\u7edc\u901a\u4fe1\u7684\u6548\u7387\u3002</p> <p>\u90a3\u4e48\u6709\u4e86\u7a97\u53e3\uff0c\u5c31\u53ef\u4ee5\u6307\u5b9a\u7a97\u53e3\u5927\u5c0f\uff0c\u7a97\u53e3\u5927\u5c0f\u5c31\u662f\u6307\u65e0\u9700\u7b49\u5f85\u786e\u8ba4\u5e94\u7b54\uff0c\u800c\u53ef\u4ee5\u7ee7\u7eed\u53d1\u9001\u6570\u636e\u7684\u6700\u5927\u503c\u3002</p> <p>\u7a97\u53e3\u7684\u5b9e\u73b0\u5b9e\u9645\u4e0a\u662f\u64cd\u4f5c\u7cfb\u7edf\u5f00\u8f9f\u7684\u4e00\u4e2a\u7f13\u5b58\u7a7a\u95f4\uff0c\u53d1\u9001\u65b9\u4e3b\u673a\u5728\u7b49\u5230\u786e\u8ba4\u5e94\u7b54\u8fd4\u56de\u4e4b\u524d\uff0c\u5fc5\u987b\u5728\u7f13\u51b2\u533a\u4e2d\u4fdd\u7559\u5df2\u53d1\u9001\u7684\u6570\u636e\u3002\u5982\u679c\u6309\u671f\u6536\u5230\u786e\u8ba4\u5e94\u7b54\uff0c\u6b64\u65f6\u6570\u636e\u5c31\u53ef\u4ee5\u4ece\u7f13\u5b58\u533a\u6e05\u9664\u3002</p> <p>\u5047\u8bbe\u7a97\u53e3\u5927\u5c0f\u4e3a <code>3</code> \u4e2a TCP \u6bb5\uff0c\u90a3\u4e48\u53d1\u9001\u65b9\u5c31\u53ef\u4ee5\u300c\u8fde\u7eed\u53d1\u9001\u300d <code>3</code> \u4e2a TCP \u6bb5\uff0c\u5e76\u4e14\u4e2d\u9014\u82e5\u6709 ACK \u4e22\u5931\uff0c\u53ef\u4ee5\u901a\u8fc7\u300c\u4e0b\u4e00\u4e2a\u786e\u8ba4\u5e94\u7b54\u8fdb\u884c\u786e\u8ba4\u300d\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u56fe\u4e2d\u7684 ACK 600 \u786e\u8ba4\u5e94\u7b54\u62a5\u6587\u4e22\u5931\uff0c\u4e5f\u6ca1\u5173\u7cfb\uff0c\u56e0\u4e3a\u53ef\u4ee5\u901a\u8fc7\u4e0b\u4e00\u4e2a\u786e\u8ba4\u5e94\u7b54\u8fdb\u884c\u786e\u8ba4\uff0c\u53ea\u8981\u53d1\u9001\u65b9\u6536\u5230\u4e86 ACK 700 \u786e\u8ba4\u5e94\u7b54\uff0c\u5c31\u610f\u5473\u7740 700 \u4e4b\u524d\u7684\u6240\u6709\u6570\u636e\u300c\u63a5\u6536\u65b9\u300d\u90fd\u6536\u5230\u4e86\u3002\u8fd9\u4e2a\u6a21\u5f0f\u5c31\u53eb\u7d2f\u8ba1\u786e\u8ba4\u6216\u8005\u7d2f\u8ba1\u5e94\u7b54\u3002</p> <p>\u7a97\u53e3\u5927\u5c0f\u7531\u54ea\u4e00\u65b9\u51b3\u5b9a\uff1f</p> <p>TCP \u5934\u91cc\u6709\u4e00\u4e2a\u5b57\u6bb5\u53eb <code>Window</code>\uff0c\u4e5f\u5c31\u662f\u7a97\u53e3\u5927\u5c0f\u3002</p> <p>\u8fd9\u4e2a\u5b57\u6bb5\u662f\u63a5\u6536\u7aef\u544a\u8bc9\u53d1\u9001\u7aef\u81ea\u5df1\u8fd8\u6709\u591a\u5c11\u7f13\u51b2\u533a\u53ef\u4ee5\u63a5\u6536\u6570\u636e\u3002\u4e8e\u662f\u53d1\u9001\u7aef\u5c31\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u63a5\u6536\u7aef\u7684\u5904\u7406\u80fd\u529b\u6765\u53d1\u9001\u6570\u636e\uff0c\u800c\u4e0d\u4f1a\u5bfc\u81f4\u63a5\u6536\u7aef\u5904\u7406\u4e0d\u8fc7\u6765\u3002</p> <p>\u6240\u4ee5\uff0c\u901a\u5e38\u7a97\u53e3\u7684\u5927\u5c0f\u662f\u7531\u63a5\u6536\u65b9\u7684\u7a97\u53e3\u5927\u5c0f\u6765\u51b3\u5b9a\u7684\u3002</p> <p>\u53d1\u9001\u65b9\u53d1\u9001\u7684\u6570\u636e\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7\u63a5\u6536\u65b9\u7684\u7a97\u53e3\u5927\u5c0f\uff0c\u5426\u5219\u63a5\u6536\u65b9\u5c31\u65e0\u6cd5\u6b63\u5e38\u63a5\u6536\u5230\u6570\u636e\u3002</p> <p>\u53d1\u9001\u65b9\u7684\u6ed1\u52a8\u7a97\u53e3</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b\u53d1\u9001\u65b9\u7684\u7a97\u53e3\uff0c\u4e0b\u56fe\u5c31\u662f\u53d1\u9001\u65b9\u7f13\u5b58\u7684\u6570\u636e\uff0c\u6839\u636e\u5904\u7406\u7684\u60c5\u51b5\u5206\u6210\u56db\u4e2a\u90e8\u5206\uff0c\u5176\u4e2d\u6df1\u84dd\u8272\u65b9\u6846\u662f\u53d1\u9001\u7a97\u53e3\uff0c\u7d2b\u8272\u65b9\u6846\u662f\u53ef\u7528\u7a97\u53e3\uff1a</p> <p></p> <p>\u5728\u4e0b\u56fe\uff0c\u5f53\u53d1\u9001\u65b9\u628a\u6570\u636e\u300c\u5168\u90e8\u300d\u90fd\u4e00\u4e0b\u53d1\u9001\u51fa\u53bb\u540e\uff0c\u53ef\u7528\u7a97\u53e3\u7684\u5927\u5c0f\u5c31\u4e3a 0 \u4e86\uff0c\u8868\u660e\u53ef\u7528\u7a97\u53e3\u8017\u5c3d\uff0c\u5728\u6ca1\u6536\u5230 ACK \u786e\u8ba4\u4e4b\u524d\u662f\u65e0\u6cd5\u7ee7\u7eed\u53d1\u9001\u6570\u636e\u4e86\u3002</p> <p></p> <p>\u5728\u4e0b\u56fe\uff0c\u5f53\u6536\u5230\u4e4b\u524d\u53d1\u9001\u7684\u6570\u636e <code>32~36</code> \u5b57\u8282\u7684 ACK \u786e\u8ba4\u5e94\u7b54\u540e\uff0c\u5982\u679c\u53d1\u9001\u7a97\u53e3\u7684\u5927\u5c0f\u6ca1\u6709\u53d8\u5316\uff0c\u5219\u6ed1\u52a8\u7a97\u53e3\u5f80\u53f3\u8fb9\u79fb\u52a8 5 \u4e2a\u5b57\u8282\uff0c\u56e0\u4e3a\u6709 5 \u4e2a\u5b57\u8282\u7684\u6570\u636e\u88ab\u5e94\u7b54\u786e\u8ba4\uff0c\u63a5\u4e0b\u6765 <code>52~56</code> \u5b57\u8282\u53c8\u53d8\u6210\u4e86\u53ef\u7528\u7a97\u53e3\uff0c\u90a3\u4e48\u540e\u7eed\u4e5f\u5c31\u53ef\u4ee5\u53d1\u9001 <code>52~56</code> \u8fd9 5 \u4e2a\u5b57\u8282\u7684\u6570\u636e\u4e86\u3002</p> <p></p> <p>\u7a0b\u5e8f\u662f\u5982\u4f55\u8868\u793a\u53d1\u9001\u65b9\u7684\u56db\u4e2a\u90e8\u5206\u7684\u5462\uff1f</p> <p>TCP \u6ed1\u52a8\u7a97\u53e3\u65b9\u6848\u4f7f\u7528\u4e09\u4e2a\u6307\u9488\u6765\u8ddf\u8e2a\u5728\u56db\u4e2a\u4f20\u8f93\u7c7b\u522b\u4e2d\u7684\u6bcf\u4e00\u4e2a\u7c7b\u522b\u4e2d\u7684\u5b57\u8282\u3002\u5176\u4e2d\u4e24\u4e2a\u6307\u9488\u662f\u7edd\u5bf9\u6307\u9488\uff08\u6307\u7279\u5b9a\u7684\u5e8f\u5217\u53f7\uff09\uff0c\u4e00\u4e2a\u662f\u76f8\u5bf9\u6307\u9488\uff08\u9700\u8981\u505a\u504f\u79fb\uff09\u3002</p> <p></p> <ul> <li><code>SND.WND</code>\uff1a\u8868\u793a\u53d1\u9001\u7a97\u53e3\u7684\u5927\u5c0f\uff08\u5927\u5c0f\u662f\u7531\u63a5\u6536\u65b9\u6307\u5b9a\u7684\uff09\uff1b</li> <li><code>SND.UNA</code>\uff08Send Unacknoleged\uff09\uff1a\u662f\u4e00\u4e2a\u7edd\u5bf9\u6307\u9488\uff0c\u5b83\u6307\u5411\u7684\u662f\u5df2\u53d1\u9001\u4f46\u672a\u6536\u5230\u786e\u8ba4\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5e8f\u5217\u53f7\uff0c\u4e5f\u5c31\u662f #2 \u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u3002</li> <li> <p><code>SND.NXT</code>\uff1a\u4e5f\u662f\u4e00\u4e2a\u7edd\u5bf9\u6307\u9488\uff0c\u5b83\u6307\u5411\u672a\u53d1\u9001\u4f46\u53ef\u53d1\u9001\u8303\u56f4\u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u7684\u5e8f\u5217\u53f7\uff0c\u4e5f\u5c31\u662f #3 \u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u3002</p> </li> <li> <p>\u6307\u5411 #4 \u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f\u4e2a\u76f8\u5bf9\u6307\u9488\uff0c\u5b83\u9700\u8981 <code>SND.UNA</code> \u6307\u9488\u52a0\u4e0a <code>SND.WND</code> \u5927\u5c0f\u7684\u504f\u79fb\u91cf\uff0c\u5c31\u53ef\u4ee5\u6307\u5411 #4 \u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u4e86\u3002</p> </li> </ul> <p>\u90a3\u4e48\u53ef\u7528\u7a97\u53e3\u5927\u5c0f\u7684\u8ba1\u7b97\u5c31\u53ef\u4ee5\u662f\uff1a</p> <p>\u53ef\u7528\u7a97\u53e3\u5927\u5c0f = SND.WND -\uff08SND.NXT - SND.UNA\uff09</p> <p>\u63a5\u6536\u65b9\u7684\u6ed1\u52a8\u7a97\u53e3</p> <p>\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b\u63a5\u6536\u65b9\u7684\u7a97\u53e3\uff0c\u63a5\u6536\u7a97\u53e3\u76f8\u5bf9\u7b80\u5355\u4e00\u4e9b\uff0c\u6839\u636e\u5904\u7406\u7684\u60c5\u51b5\u5212\u5206\u6210\u4e09\u4e2a\u90e8\u5206\uff1a</p> <ul> <li> </li> <li> </li> <li> </li> </ul> <p></p> <p>\u5176\u4e2d\u4e09\u4e2a\u63a5\u6536\u90e8\u5206\uff0c\u4f7f\u7528\u4e24\u4e2a\u6307\u9488\u8fdb\u884c\u5212\u5206\uff1a</p> <ul> <li><code>RCV.WND</code>\uff1a\u8868\u793a\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f\uff0c\u5b83\u4f1a\u901a\u544a\u7ed9\u53d1\u9001\u65b9\u3002</li> <li><code>RCV.NXT</code>\uff1a\u662f\u4e00\u4e2a\u6307\u9488\uff0c\u5b83\u6307\u5411\u671f\u671b\u4ece\u53d1\u9001\u65b9\u53d1\u9001\u6765\u7684\u4e0b\u4e00\u4e2a\u6570\u636e\u5b57\u8282\u7684\u5e8f\u5217\u53f7\uff0c\u4e5f\u5c31\u662f #3 \u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u3002</li> <li>\u6307\u5411 #4 \u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u662f\u4e2a\u76f8\u5bf9\u6307\u9488\uff0c\u5b83\u9700\u8981 <code>RCV.NXT</code> \u6307\u9488\u52a0\u4e0a <code>RCV.WND</code> \u5927\u5c0f\u7684\u504f\u79fb\u91cf\uff0c\u5c31\u53ef\u4ee5\u6307\u5411 #4 \u7684\u7b2c\u4e00\u4e2a\u5b57\u8282\u4e86\u3002</li> </ul> <p>\u63a5\u6536\u7a97\u53e3\u548c\u53d1\u9001\u7a97\u53e3\u7684\u5927\u5c0f\u662f\u76f8\u7b49\u7684\u5417\uff1f</p> <p>\u5e76\u4e0d\u662f\u5b8c\u5168\u76f8\u7b49\uff0c\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f\u662f\u7ea6\u7b49\u4e8e\u53d1\u9001\u7a97\u53e3\u7684\u5927\u5c0f\u7684\u3002</p> <p>\u56e0\u4e3a\u6ed1\u52a8\u7a97\u53e3\u5e76\u4e0d\u662f\u4e00\u6210\u4e0d\u53d8\u7684\u3002\u6bd4\u5982\uff0c\u5f53\u63a5\u6536\u65b9\u7684\u5e94\u7528\u8fdb\u7a0b\u8bfb\u53d6\u6570\u636e\u7684\u901f\u5ea6\u975e\u5e38\u5feb\u7684\u8bdd\uff0c\u8fd9\u6837\u7684\u8bdd\u63a5\u6536\u7a97\u53e3\u53ef\u4ee5\u5f88\u5feb\u7684\u5c31\u7a7a\u7f3a\u51fa\u6765\u3002\u90a3\u4e48\u65b0\u7684\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\uff0c\u662f\u901a\u8fc7 TCP \u62a5\u6587\u4e2d\u7684 Windows \u5b57\u6bb5\u6765\u544a\u8bc9\u53d1\u9001\u65b9\u3002\u90a3\u4e48\u8fd9\u4e2a\u4f20\u8f93\u8fc7\u7a0b\u662f\u5b58\u5728\u65f6\u5ef6\u7684\uff0c\u6240\u4ee5\u63a5\u6536\u7a97\u53e3\u548c\u53d1\u9001\u7a97\u53e3\u662f\u7ea6\u7b49\u4e8e\u7684\u5173\u7cfb\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#1-ack-131","title":"1 \u662f\u5df2\u53d1\u9001\u5e76\u6536\u5230 ACK \u786e\u8ba4\u7684\u6570\u636e\uff1a1~31 \u5b57\u8282","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#2-ack-3245","title":"2 \u662f\u5df2\u53d1\u9001\u4f46\u672a\u6536\u5230 ACK \u786e\u8ba4\u7684\u6570\u636e\uff1a32~45 \u5b57\u8282","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#3-4651","title":"3 \u662f\u672a\u53d1\u9001\u4f46\u603b\u5927\u5c0f\u5728\u63a5\u6536\u65b9\u5904\u7406\u8303\u56f4\u5185\uff08\u63a5\u6536\u65b9\u8fd8\u6709\u7a7a\u95f4\uff09\uff1a46~51 \u5b57\u8282","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#4-52","title":"4 \u662f\u672a\u53d1\u9001\u4f46\u603b\u5927\u5c0f\u8d85\u8fc7\u63a5\u6536\u65b9\u5904\u7406\u8303\u56f4\uff08\u63a5\u6536\u65b9\u6ca1\u6709\u7a7a\u95f4\uff09\uff1a52 \u5b57\u8282\u4ee5\u540e","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#1-2","title":"1 + #2 \u662f\u5df2\u6210\u529f\u63a5\u6536\u5e76\u786e\u8ba4\u7684\u6570\u636e\uff08\u7b49\u5f85\u5e94\u7528\u8fdb\u7a0b\u8bfb\u53d6\uff09\uff1b","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#3","title":"3 \u662f\u672a\u6536\u5230\u6570\u636e\u4f46\u53ef\u4ee5\u63a5\u6536\u7684\u6570\u636e\uff1b","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#4","title":"4 \u672a\u6536\u5230\u6570\u636e\u5e76\u4e0d\u53ef\u4ee5\u63a5\u6536\u7684\u6570\u636e\uff1b","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_5","title":"\u6d41\u91cf\u63a7\u5236","text":"<p>\u53d1\u9001\u65b9\u4e0d\u80fd\u65e0\u8111\u7684\u53d1\u6570\u636e\u7ed9\u63a5\u6536\u65b9\uff0c\u8981\u8003\u8651\u63a5\u6536\u65b9\u5904\u7406\u80fd\u529b\u3002</p> <p>\u5982\u679c\u4e00\u76f4\u65e0\u8111\u7684\u53d1\u6570\u636e\u7ed9\u5bf9\u65b9\uff0c\u4f46\u5bf9\u65b9\u5904\u7406\u4e0d\u8fc7\u6765\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u89e6\u53d1\u91cd\u53d1\u673a\u5236\uff0c\u4ece\u800c\u5bfc\u81f4\u7f51\u7edc\u6d41\u91cf\u7684\u65e0\u7aef\u7684\u6d6a\u8d39\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u79cd\u73b0\u8c61\u53d1\u751f\uff0cTCP \u63d0\u4f9b\u4e00\u79cd\u673a\u5236\u53ef\u4ee5\u8ba9\u300c\u53d1\u9001\u65b9\u300d\u6839\u636e\u300c\u63a5\u6536\u65b9\u300d\u7684\u5b9e\u9645\u63a5\u6536\u80fd\u529b\u63a7\u5236\u53d1\u9001\u7684\u6570\u636e\u91cf\uff0c\u8fd9\u5c31\u662f\u6240\u8c13\u7684\u6d41\u91cf\u63a7\u5236\u3002</p> <p>\u4e0b\u9762\u4e3e\u4e2a\u6817\u5b50\uff0c\u4e3a\u4e86\u7b80\u5355\u8d77\u89c1\uff0c\u5047\u8bbe\u4ee5\u4e0b\u573a\u666f\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u662f\u63a5\u6536\u65b9\uff0c\u670d\u52a1\u7aef\u662f\u53d1\u9001\u65b9</li> <li>\u5047\u8bbe\u63a5\u6536\u7a97\u53e3\u548c\u53d1\u9001\u7a97\u53e3\u76f8\u540c\uff0c\u90fd\u4e3a <code>200</code> </li> <li>\u5047\u8bbe\u4e24\u4e2a\u8bbe\u5907\u5728\u6574\u4e2a\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u90fd\u4fdd\u6301\u76f8\u540c\u7684\u7a97\u53e3\u5927\u5c0f\uff0c\u4e0d\u53d7\u5916\u754c\u5f71\u54cd</li> </ul> <p></p> <p>\u6839\u636e\u4e0a\u56fe\u7684\u6d41\u91cf\u63a7\u5236\uff0c\u8bf4\u660e\u4e0b\u6bcf\u4e2a\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u8bf7\u6c42\u6570\u636e\u62a5\u6587\u3002\u8fd9\u91cc\u8981\u8bf4\u660e\u4e0b\uff0c\u672c\u6b21\u4f8b\u5b50\u662f\u628a\u670d\u52a1\u7aef\u4f5c\u4e3a\u53d1\u9001\u65b9\uff0c\u6240\u4ee5\u6ca1\u6709\u753b\u51fa\u670d\u52a1\u7aef\u7684\u63a5\u6536\u7a97\u53e3\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u8bf7\u6c42\u62a5\u6587\u540e\uff0c\u53d1\u9001\u786e\u8ba4\u62a5\u6587\u548c 80 \u5b57\u8282\u7684\u6570\u636e\uff0c\u4e8e\u662f\u53ef\u7528\u7a97\u53e3 <code>Usable</code> \u51cf\u5c11\u4e3a 120 \u5b57\u8282\uff0c\u540c\u65f6 <code>SND.NXT</code> \u6307\u9488\u4e5f\u5411\u53f3\u504f\u79fb 80 \u5b57\u8282\u540e\uff0c\u6307\u5411 321\uff0c\u8fd9\u610f\u5473\u7740\u4e0b\u6b21\u53d1\u9001\u6570\u636e\u7684\u65f6\u5019\uff0c\u5e8f\u5217\u53f7\u662f 321\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230 80 \u5b57\u8282\u6570\u636e\u540e\uff0c\u4e8e\u662f\u63a5\u6536\u7a97\u53e3\u5f80\u53f3\u79fb\u52a8 80 \u5b57\u8282\uff0c<code>RCV.NXT</code> \u4e5f\u5c31\u6307\u5411 321\uff0c\u8fd9\u610f\u5473\u7740\u5ba2\u6237\u7aef\u671f\u671b\u7684\u4e0b\u4e00\u4e2a\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u662f 321\uff0c\u63a5\u7740\u53d1\u9001\u786e\u8ba4\u62a5\u6587\u7ed9\u670d\u52a1\u7aef\u3002</li> <li>\u670d\u52a1\u7aef\u518d\u6b21\u53d1\u9001\u4e86 120 \u5b57\u8282\u6570\u636e\uff0c\u4e8e\u662f\u53ef\u7528\u7a97\u53e3\u8017\u5c3d\u4e3a 0\uff0c\u670d\u52a1\u7aef\u65e0\u6cd5\u518d\u7ee7\u7eed\u53d1\u9001\u6570\u636e\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230 120 \u5b57\u8282\u7684\u6570\u636e\u540e\uff0c\u4e8e\u662f\u63a5\u6536\u7a97\u53e3\u5f80\u53f3\u79fb\u52a8 120 \u5b57\u8282\uff0c<code>RCV.NXT</code> \u4e5f\u5c31\u6307\u5411 441\uff0c\u63a5\u7740\u53d1\u9001\u786e\u8ba4\u62a5\u6587\u7ed9\u670d\u52a1\u7aef\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u5bf9 80 \u5b57\u8282\u6570\u636e\u7684\u786e\u8ba4\u62a5\u6587\u540e\uff0c<code>SND.UNA</code> \u6307\u9488\u5f80\u53f3\u504f\u79fb\u540e\u6307\u5411 321\uff0c\u4e8e\u662f\u53ef\u7528\u7a97\u53e3 <code>Usable</code> \u589e\u5927\u5230 80\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u5bf9 120 \u5b57\u8282\u6570\u636e\u7684\u786e\u8ba4\u62a5\u6587\u540e\uff0c<code>SND.UNA</code> \u6307\u9488\u5f80\u53f3\u504f\u79fb\u540e\u6307\u5411 441\uff0c\u4e8e\u662f\u53ef\u7528\u7a97\u53e3 <code>Usable</code> \u589e\u5927\u5230 200\u3002</li> <li>\u670d\u52a1\u7aef\u53ef\u4ee5\u7ee7\u7eed\u53d1\u9001\u4e86\uff0c\u4e8e\u662f\u53d1\u9001\u4e86 160 \u5b57\u8282\u7684\u6570\u636e\u540e\uff0c<code>SND.NXT</code> \u6307\u5411 601\uff0c\u4e8e\u662f\u53ef\u7528\u7a97\u53e3  <code>Usable</code> \u51cf\u5c11\u5230 40\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230 160 \u5b57\u8282\u540e\uff0c\u63a5\u6536\u7a97\u53e3\u5f80\u53f3\u79fb\u52a8\u4e86 160 \u5b57\u8282\uff0c<code>RCV.NXT</code> \u4e5f\u5c31\u662f\u6307\u5411\u4e86 601\uff0c\u63a5\u7740\u53d1\u9001\u786e\u8ba4\u62a5\u6587\u7ed9\u670d\u52a1\u7aef\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u5bf9 160 \u5b57\u8282\u6570\u636e\u7684\u786e\u8ba4\u62a5\u6587\u540e\uff0c\u53d1\u9001\u7a97\u53e3\u5f80\u53f3\u79fb\u52a8\u4e86 160 \u5b57\u8282\uff0c\u4e8e\u662f <code>SND.UNA</code> \u6307\u9488\u504f\u79fb\u4e86 160 \u540e\u6307\u5411 601\uff0c\u53ef\u7528\u7a97\u53e3 <code>Usable</code> \u4e5f\u5c31\u589e\u5927\u81f3\u4e86 200\u3002</li> </ol>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_6","title":"\u64cd\u4f5c\u7cfb\u7edf\u7f13\u51b2\u533a\u4e0e\u6ed1\u52a8\u7a97\u53e3\u7684\u5173\u7cfb","text":"<p>\u524d\u9762\u7684\u6d41\u91cf\u63a7\u5236\u4f8b\u5b50\uff0c\u6211\u4eec\u5047\u5b9a\u4e86\u53d1\u9001\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\u662f\u4e0d\u53d8\u7684\uff0c\u4f46\u662f\u5b9e\u9645\u4e0a\uff0c\u53d1\u9001\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\u4e2d\u6240\u5b58\u653e\u7684\u5b57\u8282\u6570\uff0c\u90fd\u662f\u653e\u5728\u64cd\u4f5c\u7cfb\u7edf\u5185\u5b58\u7f13\u51b2\u533a\u4e2d\u7684\uff0c\u800c\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u51b2\u533a\uff0c\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u8c03\u6574\u3002</p> <p>\u5f53\u5e94\u7528\u8fdb\u7a0b\u6ca1\u529e\u6cd5\u53ca\u65f6\u8bfb\u53d6\u7f13\u51b2\u533a\u7684\u5185\u5bb9\u65f6\uff0c\u4e5f\u4f1a\u5bf9\u6211\u4eec\u7684\u7f13\u51b2\u533a\u9020\u6210\u5f71\u54cd\u3002</p> <p>\u90a3\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u51b2\u533a\uff0c\u662f\u5982\u4f55\u5f71\u54cd\u53d1\u9001\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\u7684\u5462\uff1f</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b\u7b2c\u4e00\u4e2a\u4f8b\u5b50\u3002</p> <p>\u5f53\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u53ca\u65f6\u8bfb\u53d6\u7f13\u5b58\u65f6\uff0c\u53d1\u9001\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\u7684\u53d8\u5316\u3002</p> <p>\u8003\u8651\u4ee5\u4e0b\u573a\u666f\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u4f5c\u4e3a\u53d1\u9001\u65b9\uff0c\u670d\u52a1\u7aef\u4f5c\u4e3a\u63a5\u6536\u65b9\uff0c\u53d1\u9001\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\u521d\u59cb\u5927\u5c0f\u4e3a <code>360</code>\uff1b</li> <li>\u670d\u52a1\u7aef\u975e\u5e38\u7684\u7e41\u5fd9\uff0c\u5f53\u6536\u5230\u5ba2\u6237\u7aef\u7684\u6570\u636e\u65f6\uff0c\u5e94\u7528\u5c42\u4e0d\u80fd\u53ca\u65f6\u8bfb\u53d6\u6570\u636e\u3002</li> </ul> <p></p> <p>\u6839\u636e\u4e0a\u56fe\u7684\u6d41\u91cf\u63a7\u5236\uff0c\u8bf4\u660e\u4e0b\u6bcf\u4e2a\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u53d1\u9001 140 \u5b57\u8282\u6570\u636e\u540e\uff0c\u53ef\u7528\u7a97\u53e3\u53d8\u4e3a 220\uff08360 - 140\uff09\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230 140 \u5b57\u8282\u6570\u636e\uff0c\u4f46\u662f\u670d\u52a1\u7aef\u975e\u5e38\u7e41\u5fd9\uff0c\u5e94\u7528\u8fdb\u7a0b\u53ea\u8bfb\u53d6\u4e86 40 \u4e2a\u5b57\u8282\uff0c\u8fd8\u6709 100 \u5b57\u8282\u5360\u7528\u7740\u7f13\u51b2\u533a\uff0c\u4e8e\u662f\u63a5\u6536\u7a97\u53e3\u6536\u7f29\u5230\u4e86 260\uff08360 - 100\uff09\uff0c\u6700\u540e\u53d1\u9001\u786e\u8ba4\u4fe1\u606f\u65f6\uff0c\u5c06\u7a97\u53e3\u5927\u5c0f\u901a\u544a\u7ed9\u5ba2\u6237\u7aef\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u786e\u8ba4\u548c\u7a97\u53e3\u901a\u544a\u62a5\u6587\u540e\uff0c\u53d1\u9001\u7a97\u53e3\u51cf\u5c11\u4e3a 260\u3002</li> <li>\u5ba2\u6237\u7aef\u53d1\u9001 180 \u5b57\u8282\u6570\u636e\uff0c\u6b64\u65f6\u53ef\u7528\u7a97\u53e3\u51cf\u5c11\u5230 80\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230 180 \u5b57\u8282\u6570\u636e\uff0c\u4f46\u662f\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u8bfb\u53d6\u4efb\u4f55\u6570\u636e\uff0c\u8fd9 180 \u5b57\u8282\u76f4\u63a5\u5c31\u7559\u5728\u4e86\u7f13\u51b2\u533a\uff0c\u4e8e\u662f\u63a5\u6536\u7a97\u53e3\u6536\u7f29\u5230\u4e86 80\uff08260 - 180\uff09\uff0c\u5e76\u5728\u53d1\u9001\u786e\u8ba4\u4fe1\u606f\u65f6\uff0c\u901a\u8fc7\u7a97\u53e3\u5927\u5c0f\u7ed9\u5ba2\u6237\u7aef\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u786e\u8ba4\u548c\u7a97\u53e3\u901a\u544a\u62a5\u6587\u540e\uff0c\u53d1\u9001\u7a97\u53e3\u51cf\u5c11\u4e3a 80\u3002</li> <li>\u5ba2\u6237\u7aef\u53d1\u9001 80 \u5b57\u8282\u6570\u636e\u540e\uff0c\u53ef\u7528\u7a97\u53e3\u8017\u5c3d\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230 80 \u5b57\u8282\u6570\u636e\uff0c\u4f46\u662f\u5e94\u7528\u7a0b\u5e8f\u4f9d\u7136\u6ca1\u6709\u8bfb\u53d6\u4efb\u4f55\u6570\u636e\uff0c\u8fd9 80 \u5b57\u8282\u7559\u5728\u4e86\u7f13\u51b2\u533a\uff0c\u4e8e\u662f\u63a5\u6536\u7a97\u53e3\u6536\u7f29\u5230\u4e86 0\uff0c\u5e76\u5728\u53d1\u9001\u786e\u8ba4\u4fe1\u606f\u65f6\uff0c\u901a\u8fc7\u7a97\u53e3\u5927\u5c0f\u7ed9\u5ba2\u6237\u7aef\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u786e\u8ba4\u548c\u7a97\u53e3\u901a\u544a\u62a5\u6587\u540e\uff0c\u53d1\u9001\u7a97\u53e3\u51cf\u5c11\u4e3a 0\u3002</li> </ol> <p>\u53ef\u89c1\u6700\u540e\u7a97\u53e3\u90fd\u6536\u7f29\u4e3a 0 \u4e86\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u4e86\u7a97\u53e3\u5173\u95ed\u3002\u5f53\u53d1\u9001\u65b9\u53ef\u7528\u7a97\u53e3\u53d8\u4e3a 0 \u65f6\uff0c\u53d1\u9001\u65b9\u5b9e\u9645\u4e0a\u4f1a\u5b9a\u65f6\u53d1\u9001\u7a97\u53e3\u63a2\u6d4b\u62a5\u6587\uff0c\u4ee5\u4fbf\u77e5\u9053\u63a5\u6536\u65b9\u7684\u7a97\u53e3\u662f\u5426\u53d1\u751f\u4e86\u6539\u53d8\uff0c\u8fd9\u4e2a\u5185\u5bb9\u540e\u9762\u4f1a\u8bf4\uff0c\u8fd9\u91cc\u5148\u7b80\u5355\u63d0\u4e00\u4e0b\u3002</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b\u7b2c\u4e8c\u4e2a\u4f8b\u5b50\u3002</p> <p>\u5f53\u670d\u52a1\u7aef\u7cfb\u7edf\u8d44\u6e90\u975e\u5e38\u7d27\u5f20\u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u4f1a\u76f4\u63a5\u51cf\u5c11\u4e86\u63a5\u6536\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u8fd9\u65f6\u5e94\u7528\u7a0b\u5e8f\u53c8\u65e0\u6cd5\u53ca\u65f6\u8bfb\u53d6\u7f13\u5b58\u6570\u636e\uff0c\u90a3\u4e48\u8fd9\u65f6\u5019\u5c31\u6709\u4e25\u91cd\u7684\u4e8b\u60c5\u53d1\u751f\u4e86\uff0c\u4f1a\u51fa\u73b0\u6570\u636e\u5305\u4e22\u5931\u7684\u73b0\u8c61\u3002</p> <p></p> <p>\u8bf4\u660e\u4e0b\u6bcf\u4e2a\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u53d1\u9001 140 \u5b57\u8282\u7684\u6570\u636e\uff0c\u4e8e\u662f\u53ef\u7528\u7a97\u53e3\u51cf\u5c11\u5230\u4e86 220\u3002</li> <li>\u670d\u52a1\u7aef\u56e0\u4e3a\u73b0\u5728\u975e\u5e38\u7684\u7e41\u5fd9\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e8e\u662f\u5c31\u628a\u63a5\u6536\u7f13\u5b58\u51cf\u5c11\u4e86 120 \u5b57\u8282\uff0c\u5f53\u6536\u5230 140 \u5b57\u8282\u6570\u636e\u540e\uff0c\u53c8\u56e0\u4e3a\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u8bfb\u53d6\u4efb\u4f55\u6570\u636e\uff0c\u6240\u4ee5 140 \u5b57\u8282\u7559\u5728\u4e86\u7f13\u51b2\u533a\u4e2d\uff0c\u4e8e\u662f\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\u4ece 360 \u6536\u7f29\u6210\u4e86 100\uff0c\u6700\u540e\u53d1\u9001\u786e\u8ba4\u4fe1\u606f\u65f6\uff0c\u901a\u544a\u7a97\u53e3\u5927\u5c0f\u7ed9\u5bf9\u65b9\u3002</li> <li>\u6b64\u65f6\u5ba2\u6237\u7aef\u56e0\u4e3a\u8fd8\u6ca1\u6709\u6536\u5230\u670d\u52a1\u7aef\u7684\u901a\u544a\u7a97\u53e3\u62a5\u6587\uff0c\u6240\u4ee5\u4e0d\u77e5\u9053\u6b64\u65f6\u63a5\u6536\u7a97\u53e3\u6536\u7f29\u6210\u4e86 100\uff0c\u5ba2\u6237\u7aef\u53ea\u4f1a\u770b\u81ea\u5df1\u7684\u53ef\u7528\u7a97\u53e3\u8fd8\u6709 220\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u5c31\u53d1\u9001\u4e86 180 \u5b57\u8282\u6570\u636e\uff0c\u4e8e\u662f\u53ef\u7528\u7a97\u53e3\u51cf\u5c11\u5230 40\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u4e86 180 \u5b57\u8282\u6570\u636e\u65f6\uff0c\u53d1\u73b0\u6570\u636e\u5927\u5c0f\u8d85\u8fc7\u4e86\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f\uff0c\u4e8e\u662f\u5c31\u628a\u6570\u636e\u5305\u4e22\u5931\u4e86\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u7b2c 2 \u6b65\u65f6\uff0c\u670d\u52a1\u7aef\u53d1\u9001\u7684\u786e\u8ba4\u62a5\u6587\u548c\u901a\u544a\u7a97\u53e3\u62a5\u6587\uff0c\u5c1d\u8bd5\u51cf\u5c11\u53d1\u9001\u7a97\u53e3\u5230 100\uff0c\u628a\u7a97\u53e3\u7684\u53f3\u7aef\u5411\u5de6\u6536\u7f29\u4e86 80\uff0c\u6b64\u65f6\u53ef\u7528\u7a97\u53e3\u7684\u5927\u5c0f\u5c31\u4f1a\u51fa\u73b0\u8be1\u5f02\u7684\u8d1f\u503c\u3002</li> </ol> <p>\u6240\u4ee5\uff0c\u5982\u679c\u53d1\u751f\u4e86\u5148\u51cf\u5c11\u7f13\u5b58\uff0c\u518d\u6536\u7f29\u7a97\u53e3\uff0c\u5c31\u4f1a\u51fa\u73b0\u4e22\u5305\u7684\u73b0\u8c61\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u53d1\u751f\uff0cTCP \u89c4\u5b9a\u662f\u4e0d\u5141\u8bb8\u540c\u65f6\u51cf\u5c11\u7f13\u5b58\u53c8\u6536\u7f29\u7a97\u53e3\u7684\uff0c\u800c\u662f\u91c7\u7528\u5148\u6536\u7f29\u7a97\u53e3\uff0c\u8fc7\u6bb5\u65f6\u95f4\u518d\u51cf\u5c11\u7f13\u5b58\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u907f\u514d\u4e86\u4e22\u5305\u60c5\u51b5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_7","title":"\u7a97\u53e3\u5173\u95ed","text":"<p>\u5728\u524d\u9762\u6211\u4eec\u90fd\u770b\u5230\u4e86\uff0cTCP \u901a\u8fc7\u8ba9\u63a5\u6536\u65b9\u6307\u660e\u5e0c\u671b\u4ece\u53d1\u9001\u65b9\u63a5\u6536\u7684\u6570\u636e\u5927\u5c0f\uff08\u7a97\u53e3\u5927\u5c0f\uff09\u6765\u8fdb\u884c\u6d41\u91cf\u63a7\u5236\u3002</p> <p>\u5982\u679c\u7a97\u53e3\u5927\u5c0f\u4e3a 0 \u65f6\uff0c\u5c31\u4f1a\u963b\u6b62\u53d1\u9001\u65b9\u7ed9\u63a5\u6536\u65b9\u4f20\u9012\u6570\u636e\uff0c\u76f4\u5230\u7a97\u53e3\u53d8\u4e3a\u975e 0 \u4e3a\u6b62\uff0c\u8fd9\u5c31\u662f\u7a97\u53e3\u5173\u95ed\u3002</p> <p>\u7a97\u53e3\u5173\u95ed\u6f5c\u5728\u7684\u5371\u9669</p> <p>\u63a5\u6536\u65b9\u5411\u53d1\u9001\u65b9\u901a\u544a\u7a97\u53e3\u5927\u5c0f\u65f6\uff0c\u662f\u901a\u8fc7 <code>ACK</code> \u62a5\u6587\u6765\u901a\u544a\u7684\u3002</p> <p>\u90a3\u4e48\uff0c\u5f53\u53d1\u751f\u7a97\u53e3\u5173\u95ed\u65f6\uff0c\u63a5\u6536\u65b9\u5904\u7406\u5b8c\u6570\u636e\u540e\uff0c\u4f1a\u5411\u53d1\u9001\u65b9\u901a\u544a\u4e00\u4e2a\u7a97\u53e3\u975e 0 \u7684 ACK \u62a5\u6587\uff0c\u5982\u679c\u8fd9\u4e2a\u901a\u544a\u7a97\u53e3\u7684 ACK \u62a5\u6587\u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u4e86\uff0c\u90a3\u9ebb\u70e6\u5c31\u5927\u4e86\u3002</p> <p></p> <p>\u8fd9\u4f1a\u5bfc\u81f4\u53d1\u9001\u65b9\u4e00\u76f4\u7b49\u5f85\u63a5\u6536\u65b9\u7684\u975e 0 \u7a97\u53e3\u901a\u77e5\uff0c\u63a5\u6536\u65b9\u4e5f\u4e00\u76f4\u7b49\u5f85\u53d1\u9001\u65b9\u7684\u6570\u636e\uff0c\u5982\u4e0d\u91c7\u53d6\u63aa\u65bd\uff0c\u8fd9\u79cd\u76f8\u4e92\u7b49\u5f85\u7684\u8fc7\u7a0b\uff0c\u4f1a\u9020\u6210\u4e86\u6b7b\u9501\u7684\u73b0\u8c61\u3002</p> <p>TCP \u662f\u5982\u4f55\u89e3\u51b3\u7a97\u53e3\u5173\u95ed\u65f6\uff0c\u6f5c\u5728\u7684\u6b7b\u9501\u73b0\u8c61\u5462\uff1f</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0cTCP \u4e3a\u6bcf\u4e2a\u8fde\u63a5\u8bbe\u6709\u4e00\u4e2a\u6301\u7eed\u5b9a\u65f6\u5668\uff0c\u53ea\u8981 TCP \u8fde\u63a5\u4e00\u65b9\u6536\u5230\u5bf9\u65b9\u7684\u96f6\u7a97\u53e3\u901a\u77e5\uff0c\u5c31\u542f\u52a8\u6301\u7eed\u8ba1\u65f6\u5668\u3002</p> <p>\u5982\u679c\u6301\u7eed\u8ba1\u65f6\u5668\u8d85\u65f6\uff0c\u5c31\u4f1a\u53d1\u9001\u7a97\u53e3\u63a2\u6d4b ( Window probe ) \u62a5\u6587\uff0c\u800c\u5bf9\u65b9\u5728\u786e\u8ba4\u8fd9\u4e2a\u63a2\u6d4b\u62a5\u6587\u65f6\uff0c\u7ed9\u51fa\u81ea\u5df1\u73b0\u5728\u7684\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\u3002</p> <p></p> <ul> <li>\u5982\u679c\u63a5\u6536\u7a97\u53e3\u4ecd\u7136\u4e3a 0\uff0c\u90a3\u4e48\u6536\u5230\u8fd9\u4e2a\u62a5\u6587\u7684\u4e00\u65b9\u5c31\u4f1a\u91cd\u65b0\u542f\u52a8\u6301\u7eed\u8ba1\u65f6\u5668\uff1b</li> <li>\u5982\u679c\u63a5\u6536\u7a97\u53e3\u4e0d\u662f 0\uff0c\u90a3\u4e48\u6b7b\u9501\u7684\u5c40\u9762\u5c31\u53ef\u4ee5\u88ab\u6253\u7834\u4e86\u3002</li> </ul> <p>\u7a97\u53e3\u63a2\u6d4b\u7684\u6b21\u6570\u4e00\u822c\u4e3a 3 \u6b21\uff0c\u6bcf\u6b21\u5927\u7ea6 30-60 \u79d2\uff08\u4e0d\u540c\u7684\u5b9e\u73b0\u53ef\u80fd\u4f1a\u4e0d\u4e00\u6837\uff09\u3002\u5982\u679c 3 \u6b21\u8fc7\u540e\u63a5\u6536\u7a97\u53e3\u8fd8\u662f 0 \u7684\u8bdd\uff0c\u6709\u7684 TCP \u5b9e\u73b0\u5c31\u4f1a\u53d1 <code>RST</code> \u62a5\u6587\u6765\u4e2d\u65ad\u8fde\u63a5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_8","title":"\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u75c7","text":"<p>\u5982\u679c\u63a5\u6536\u65b9\u592a\u5fd9\u4e86\uff0c\u6765\u4e0d\u53ca\u53d6\u8d70\u63a5\u6536\u7a97\u53e3\u91cc\u7684\u6570\u636e\uff0c\u90a3\u4e48\u5c31\u4f1a\u5bfc\u81f4\u53d1\u9001\u65b9\u7684\u53d1\u9001\u7a97\u53e3\u8d8a\u6765\u8d8a\u5c0f\u3002</p> <p>\u5230\u6700\u540e\uff0c\u5982\u679c\u63a5\u6536\u65b9\u817e\u51fa\u51e0\u4e2a\u5b57\u8282\u5e76\u544a\u8bc9\u53d1\u9001\u65b9\u73b0\u5728\u6709\u51e0\u4e2a\u5b57\u8282\u7684\u7a97\u53e3\uff0c\u800c\u53d1\u9001\u65b9\u4f1a\u4e49\u65e0\u53cd\u987e\u5730\u53d1\u9001\u8fd9\u51e0\u4e2a\u5b57\u8282\uff0c\u8fd9\u5c31\u662f\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u75c7\u3002</p> <p>\u8981\u77e5\u9053\uff0c\u6211\u4eec\u7684 <code>TCP + IP</code> \u5934\u6709 <code>40</code> \u4e2a\u5b57\u8282\uff0c\u4e3a\u4e86\u4f20\u8f93\u90a3\u51e0\u4e2a\u5b57\u8282\u7684\u6570\u636e\uff0c\u8981\u642d\u4e0a\u8fd9\u4e48\u5927\u7684\u5f00\u9500\uff0c\u8fd9\u592a\u4e0d\u7ecf\u6d4e\u4e86\u3002</p> <p>\u5c31\u597d\u50cf\u4e00\u4e2a\u53ef\u4ee5\u627f\u8f7d 50 \u4eba\u7684\u5927\u5df4\u8f66\uff0c\u6bcf\u6b21\u6765\u4e86\u4e00\u4e24\u4e2a\u4eba\uff0c\u5c31\u76f4\u63a5\u53d1\u8f66\u3002\u9664\u975e\u5bb6\u91cc\u6709\u77ff\u7684\u5927\u5df4\u53f8\u673a\uff0c\u624d\u6562\u8fd9\u6837\u73a9\uff0c\u4e0d\u7136\u8fdf\u65e9\u7834\u4ea7\u3002\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\u4e5f\u4e0d\u96be\uff0c\u5927\u5df4\u53f8\u673a\u7b49\u4e58\u5ba2\u6570\u91cf\u8d85\u8fc7\u4e86 25 \u4e2a\uff0c\u624d\u8ba4\u5b9a\u53ef\u4ee5\u53d1\u8f66\u3002</p> <p>\u73b0\u4e3e\u4e2a\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u75c7\u7684\u6817\u5b50\uff0c\u8003\u8651\u4ee5\u4e0b\u573a\u666f\uff1a</p> <p>\u63a5\u6536\u65b9\u7684\u7a97\u53e3\u5927\u5c0f\u662f 360 \u5b57\u8282\uff0c\u4f46\u63a5\u6536\u65b9\u7531\u4e8e\u67d0\u4e9b\u539f\u56e0\u9677\u5165\u56f0\u5883\uff0c\u5047\u8bbe\u63a5\u6536\u65b9\u7684\u5e94\u7528\u5c42\u8bfb\u53d6\u7684\u80fd\u529b\u5982\u4e0b\uff1a</p> <ul> <li>\u63a5\u6536\u65b9\u6bcf\u63a5\u6536 3 \u4e2a\u5b57\u8282\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c31\u53ea\u80fd\u4ece\u7f13\u51b2\u533a\u4e2d\u8bfb\u53d6 1 \u4e2a\u5b57\u8282\u7684\u6570\u636e\uff1b</li> <li>\u5728\u4e0b\u4e00\u4e2a\u53d1\u9001\u65b9\u7684 TCP \u6bb5\u5230\u8fbe\u4e4b\u524d\uff0c\u5e94\u7528\u7a0b\u5e8f\u8fd8\u4ece\u7f13\u51b2\u533a\u4e2d\u8bfb\u53d6\u4e86 40 \u4e2a\u989d\u5916\u7684\u5b57\u8282\uff1b</li> </ul> <p></p> <p>\u6bcf\u4e2a\u8fc7\u7a0b\u7684\u7a97\u53e3\u5927\u5c0f\u7684\u53d8\u5316\uff0c\u5728\u56fe\u4e2d\u90fd\u63cf\u8ff0\u7684\u5f88\u6e05\u695a\u4e86\uff0c\u53ef\u4ee5\u53d1\u73b0\u7a97\u53e3\u4e0d\u65ad\u51cf\u5c11\u4e86\uff0c\u5e76\u4e14\u53d1\u9001\u7684\u6570\u636e\u90fd\u662f\u6bd4\u8f83\u5c0f\u7684\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u75c7\u7684\u73b0\u8c61\u662f\u53ef\u4ee5\u53d1\u751f\u5728\u53d1\u9001\u65b9\u548c\u63a5\u6536\u65b9\uff1a</p> <ul> <li>\u63a5\u6536\u65b9\u53ef\u4ee5\u901a\u544a\u4e00\u4e2a\u5c0f\u7684\u7a97\u53e3</li> <li>\u800c\u53d1\u9001\u65b9\u53ef\u4ee5\u53d1\u9001\u5c0f\u6570\u636e</li> </ul> <p>\u4e8e\u662f\uff0c\u8981\u89e3\u51b3\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u75c7\uff0c\u5c31\u8981\u540c\u65f6\u89e3\u51b3\u4e0a\u9762\u4e24\u4e2a\u95ee\u9898\u5c31\u53ef\u4ee5\u4e86\uff1a</p> <ul> <li>\u8ba9\u63a5\u6536\u65b9\u4e0d\u901a\u544a\u5c0f\u7a97\u53e3\u7ed9\u53d1\u9001\u65b9</li> <li>\u8ba9\u53d1\u9001\u65b9\u907f\u514d\u53d1\u9001\u5c0f\u6570\u636e</li> </ul> <p>\u600e\u4e48\u8ba9\u63a5\u6536\u65b9\u4e0d\u901a\u544a\u5c0f\u7a97\u53e3\u5462\uff1f</p> <p>\u63a5\u6536\u65b9\u901a\u5e38\u7684\u7b56\u7565\u5982\u4e0b\uff1a</p> <p>\u5f53\u300c\u7a97\u53e3\u5927\u5c0f\u300d\u5c0f\u4e8e min( MSS\uff0c\u7f13\u5b58\u7a7a\u95f4/2 ) \uff0c\u4e5f\u5c31\u662f\u5c0f\u4e8e MSS \u4e0e 1/2 \u7f13\u5b58\u5927\u5c0f\u4e2d\u7684\u6700\u5c0f\u503c\u65f6\uff0c\u5c31\u4f1a\u5411\u53d1\u9001\u65b9\u901a\u544a\u7a97\u53e3\u4e3a <code>0</code>\uff0c\u4e5f\u5c31\u963b\u6b62\u4e86\u53d1\u9001\u65b9\u518d\u53d1\u6570\u636e\u8fc7\u6765\u3002</p> <p>\u7b49\u5230\u63a5\u6536\u65b9\u5904\u7406\u4e86\u4e00\u4e9b\u6570\u636e\u540e\uff0c\u7a97\u53e3\u5927\u5c0f &gt;= MSS\uff0c\u6216\u8005\u63a5\u6536\u65b9\u7f13\u5b58\u7a7a\u95f4\u6709\u4e00\u534a\u53ef\u4ee5\u4f7f\u7528\uff0c\u5c31\u53ef\u4ee5\u628a\u7a97\u53e3\u6253\u5f00\u8ba9\u53d1\u9001\u65b9\u53d1\u9001\u6570\u636e\u8fc7\u6765\u3002</p> <p>\u600e\u4e48\u8ba9\u53d1\u9001\u65b9\u907f\u514d\u53d1\u9001\u5c0f\u6570\u636e\u5462\uff1f</p> <p>\u53d1\u9001\u65b9\u901a\u5e38\u7684\u7b56\u7565\u5982\u4e0b\uff1a</p> <p>\u4f7f\u7528 Nagle \u7b97\u6cd5\uff0c\u8be5\u7b97\u6cd5\u7684\u601d\u8def\u662f\u5ef6\u65f6\u5904\u7406\uff0c\u53ea\u6709\u6ee1\u8db3\u4e0b\u9762\u4e24\u4e2a\u6761\u4ef6\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u6761\u4ef6\uff0c\u624d\u53ef\u4ee5\u53d1\u9001\u6570\u636e\uff1a</p> <ul> <li>\u6761\u4ef6\u4e00\uff1a\u8981\u7b49\u5230\u53ef\u7528\u7a97\u53e3\u5927\u5c0f &gt;= <code>MSS</code> \u5e76\u4e14 \u6570\u636e\u5927\u5c0f &gt;= <code>MSS</code>\uff1b</li> <li>\u6761\u4ef6\u4e8c\uff1a\u6536\u5230\u4e4b\u524d\u53d1\u9001\u6570\u636e\u7684 <code>ack</code> \u56de\u5305\uff1b</li> </ul> <p>\u53ea\u8981\u4e0a\u9762\u4e24\u4e2a\u6761\u4ef6\u90fd\u4e0d\u6ee1\u8db3\uff0c\u53d1\u9001\u65b9\u4e00\u76f4\u5728\u56e4\u79ef\u6570\u636e\uff0c\u76f4\u5230\u6ee1\u8db3\u4e0a\u9762\u7684\u53d1\u9001\u6761\u4ef6\u3002</p> <p>Nagle \u4f2a\u4ee3\u7801\u5982\u4e0b\uff1a</p> C<pre><code>if \u6709\u6570\u636e\u8981\u53d1\u9001 {\n    if \u53ef\u7528\u7a97\u53e3\u5927\u5c0f &gt;= MSS and \u53ef\u53d1\u9001\u7684\u6570\u636e &gt;= MSS {\n        \u7acb\u523b\u53d1\u9001MSS\u5927\u5c0f\u7684\u6570\u636e\n    } else {\n        if \u6709\u672a\u786e\u8ba4\u7684\u6570\u636e {\n            \u5c06\u6570\u636e\u653e\u5165\u7f13\u5b58\u7b49\u5f85\u63a5\u6536ACK\n        } else {\n            \u7acb\u523b\u53d1\u9001\u6570\u636e\n        }\n    }\n}\n</code></pre> <p>\u6ce8\u610f\uff0c\u5982\u679c\u63a5\u6536\u65b9\u4e0d\u80fd\u6ee1\u8db3\u300c\u4e0d\u901a\u544a\u5c0f\u7a97\u53e3\u7ed9\u53d1\u9001\u65b9\u300d\uff0c\u90a3\u4e48\u5373\u4f7f\u5f00\u4e86 Nagle \u7b97\u6cd5\uff0c\u4e5f\u65e0\u6cd5\u907f\u514d\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u75c7\uff0c\u56e0\u4e3a\u5982\u679c\u5bf9\u7aef ACK \u56de\u590d\u5f88\u5feb\u7684\u8bdd\uff08\u8fbe\u5230 Nagle \u7b97\u6cd5\u7684\u6761\u4ef6\u4e8c\uff09\uff0cNagle \u7b97\u6cd5\u5c31\u4e0d\u4f1a\u62fc\u63a5\u592a\u591a\u7684\u6570\u636e\u5305\uff0c\u8fd9\u79cd\u60c5\u51b5\u4e0b\u4f9d\u7136\u4f1a\u6709\u5c0f\u6570\u636e\u5305\u7684\u4f20\u8f93\uff0c\u7f51\u7edc\u603b\u4f53\u7684\u5229\u7528\u7387\u4f9d\u7136\u5f88\u4f4e\u3002</p> <p>\u6240\u4ee5\uff0c\u63a5\u6536\u65b9\u5f97\u6ee1\u8db3\u300c\u4e0d\u901a\u544a\u5c0f\u7a97\u53e3\u7ed9\u53d1\u9001\u65b9\u300d+ \u53d1\u9001\u65b9\u5f00\u542f Nagle \u7b97\u6cd5\uff0c\u624d\u80fd\u907f\u514d\u7cca\u6d82\u7a97\u53e3\u7efc\u5408\u75c7\u3002</p> <p>\u53e6\u5916\uff0cNagle \u7b97\u6cd5\u9ed8\u8ba4\u662f\u6253\u5f00\u7684\uff0c\u5982\u679c\u5bf9\u4e8e\u4e00\u4e9b\u9700\u8981\u5c0f\u6570\u636e\u5305\u4ea4\u4e92\u7684\u573a\u666f\u7684\u7a0b\u5e8f\uff0c\u6bd4\u5982\uff0ctelnet \u6216 ssh \u8fd9\u6837\u7684\u4ea4\u4e92\u6027\u6bd4\u8f83\u5f3a\u7684\u7a0b\u5e8f\uff0c\u5219\u9700\u8981\u5173\u95ed Nagle \u7b97\u6cd5\u3002</p> <p>\u53ef\u4ee5\u5728 Socket \u8bbe\u7f6e <code>TCP_NODELAY</code> \u9009\u9879\u6765\u5173\u95ed\u8fd9\u4e2a\u7b97\u6cd5\uff08\u5173\u95ed Nagle \u7b97\u6cd5\u6ca1\u6709\u5168\u5c40\u53c2\u6570\uff0c\u9700\u8981\u6839\u636e\u6bcf\u4e2a\u5e94\u7528\u81ea\u5df1\u7684\u7279\u70b9\u6765\u5173\u95ed\uff09</p> C<pre><code>setsockopt(sock_fd, IPPROTO_TCP, TCP_NODELAY, (char *)&amp;value, sizeof(int));\n</code></pre>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_9","title":"\u62e5\u585e\u63a7\u5236","text":"<p>\u4e3a\u4ec0\u4e48\u8981\u6709\u62e5\u585e\u63a7\u5236\u5440\uff0c\u4e0d\u662f\u6709\u6d41\u91cf\u63a7\u5236\u4e86\u5417\uff1f</p> <p>\u524d\u9762\u7684\u6d41\u91cf\u63a7\u5236\u662f\u907f\u514d\u300c\u53d1\u9001\u65b9\u300d\u7684\u6570\u636e\u586b\u6ee1\u300c\u63a5\u6536\u65b9\u300d\u7684\u7f13\u5b58\uff0c\u4f46\u662f\u5e76\u4e0d\u77e5\u9053\u7f51\u7edc\u7684\u4e2d\u53d1\u751f\u4e86\u4ec0\u4e48\u3002</p> <p>\u4e00\u822c\u6765\u8bf4\uff0c\u8ba1\u7b97\u673a\u7f51\u7edc\u90fd\u5904\u5728\u4e00\u4e2a\u5171\u4eab\u7684\u73af\u5883\u3002\u56e0\u6b64\u4e5f\u6709\u53ef\u80fd\u4f1a\u56e0\u4e3a\u5176\u4ed6\u4e3b\u673a\u4e4b\u95f4\u7684\u901a\u4fe1\u4f7f\u5f97\u7f51\u7edc\u62e5\u5835\u3002</p> <p>\u5728\u7f51\u7edc\u51fa\u73b0\u62e5\u5835\u65f6\uff0c\u5982\u679c\u7ee7\u7eed\u53d1\u9001\u5927\u91cf\u6570\u636e\u5305\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u6570\u636e\u5305\u65f6\u5ef6\u3001\u4e22\u5931\u7b49\uff0c\u8fd9\u65f6 TCP \u5c31\u4f1a\u91cd\u4f20\u6570\u636e\uff0c\u4f46\u662f\u4e00\u91cd\u4f20\u5c31\u4f1a\u5bfc\u81f4\u7f51\u7edc\u7684\u8d1f\u62c5\u66f4\u91cd\uff0c\u4e8e\u662f\u4f1a\u5bfc\u81f4\u66f4\u5927\u7684\u5ef6\u8fdf\u4ee5\u53ca\u66f4\u591a\u7684\u4e22\u5305\uff0c\u8fd9\u4e2a\u60c5\u51b5\u5c31\u4f1a\u8fdb\u5165\u6076\u6027\u5faa\u73af\u88ab\u4e0d\u65ad\u5730\u653e\u5927\u2026\u2026</p> <p>\u6240\u4ee5\uff0cTCP \u4e0d\u80fd\u5ffd\u7565\u7f51\u7edc\u4e0a\u53d1\u751f\u7684\u4e8b\uff0c\u5b83\u88ab\u8bbe\u8ba1\u6210\u4e00\u4e2a\u65e0\u79c1\u7684\u534f\u8bae\uff0c\u5f53\u7f51\u7edc\u53d1\u751f\u62e5\u585e\u65f6\uff0cTCP \u4f1a\u81ea\u6211\u727a\u7272\uff0c\u964d\u4f4e\u53d1\u9001\u7684\u6570\u636e\u91cf\u3002</p> <p>\u4e8e\u662f\uff0c\u5c31\u6709\u4e86\u62e5\u585e\u63a7\u5236\uff0c\u63a7\u5236\u7684\u76ee\u7684\u5c31\u662f\u907f\u514d\u300c\u53d1\u9001\u65b9\u300d\u7684\u6570\u636e\u586b\u6ee1\u6574\u4e2a\u7f51\u7edc\u3002</p> <p>\u4e3a\u4e86\u5728\u300c\u53d1\u9001\u65b9\u300d\u8c03\u8282\u6240\u8981\u53d1\u9001\u6570\u636e\u7684\u91cf\uff0c\u5b9a\u4e49\u4e86\u4e00\u4e2a\u53eb\u505a\u300c\u62e5\u585e\u7a97\u53e3\u300d\u7684\u6982\u5ff5\u3002</p> <p>\u4ec0\u4e48\u662f\u62e5\u585e\u7a97\u53e3\uff1f\u548c\u53d1\u9001\u7a97\u53e3\u6709\u4ec0\u4e48\u5173\u7cfb\u5462\uff1f</p> <p>\u62e5\u585e\u7a97\u53e3 cwnd\u662f\u53d1\u9001\u65b9\u7ef4\u62a4\u7684\u4e00\u4e2a\u7684\u72b6\u6001\u53d8\u91cf\uff0c\u5b83\u4f1a\u6839\u636e\u7f51\u7edc\u7684\u62e5\u585e\u7a0b\u5ea6\u52a8\u6001\u53d8\u5316\u7684\u3002</p> <p>\u6211\u4eec\u5728\u524d\u9762\u63d0\u5230\u8fc7\u53d1\u9001\u7a97\u53e3 <code>swnd</code> \u548c\u63a5\u6536\u7a97\u53e3 <code>rwnd</code> \u662f\u7ea6\u7b49\u4e8e\u7684\u5173\u7cfb\uff0c\u90a3\u4e48\u7531\u4e8e\u52a0\u5165\u4e86\u62e5\u585e\u7a97\u53e3\u7684\u6982\u5ff5\u540e\uff0c\u6b64\u65f6\u53d1\u9001\u7a97\u53e3\u7684\u503c\u662f swnd = min(cwnd, rwnd)\uff0c\u4e5f\u5c31\u662f\u62e5\u585e\u7a97\u53e3\u548c\u63a5\u6536\u7a97\u53e3\u4e2d\u7684\u6700\u5c0f\u503c\u3002</p> <p>\u62e5\u585e\u7a97\u53e3 <code>cwnd</code> \u53d8\u5316\u7684\u89c4\u5219\uff1a</p> <ul> <li>\u53ea\u8981\u7f51\u7edc\u4e2d\u6ca1\u6709\u51fa\u73b0\u62e5\u585e\uff0c<code>cwnd</code> \u5c31\u4f1a\u589e\u5927\uff1b</li> <li>\u4f46\u7f51\u7edc\u4e2d\u51fa\u73b0\u4e86\u62e5\u585e\uff0c<code>cwnd</code> \u5c31\u51cf\u5c11\uff1b</li> </ul> <p>\u90a3\u4e48\u600e\u4e48\u77e5\u9053\u5f53\u524d\u7f51\u7edc\u662f\u5426\u51fa\u73b0\u4e86\u62e5\u585e\u5462\uff1f</p> <p>\u5176\u5b9e\u53ea\u8981\u300c\u53d1\u9001\u65b9\u300d\u6ca1\u6709\u5728\u89c4\u5b9a\u65f6\u95f4\u5185\u63a5\u6536\u5230 ACK \u5e94\u7b54\u62a5\u6587\uff0c\u4e5f\u5c31\u662f\u53d1\u751f\u4e86\u8d85\u65f6\u91cd\u4f20\uff0c\u5c31\u4f1a\u8ba4\u4e3a\u7f51\u7edc\u51fa\u73b0\u4e86\u62e5\u585e\u3002</p> <p>\u62e5\u585e\u63a7\u5236\u6709\u54ea\u4e9b\u63a7\u5236\u7b97\u6cd5\uff1f</p> <p>\u62e5\u585e\u63a7\u5236\u4e3b\u8981\u662f\u56db\u4e2a\u7b97\u6cd5\uff1a</p> <ul> <li>\u6162\u542f\u52a8</li> <li>\u62e5\u585e\u907f\u514d</li> <li>\u62e5\u585e\u53d1\u751f</li> <li>\u5feb\u901f\u6062\u590d</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_10","title":"\u6162\u542f\u52a8","text":"<p>TCP \u5728\u521a\u5efa\u7acb\u8fde\u63a5\u5b8c\u6210\u540e\uff0c\u9996\u5148\u662f\u6709\u4e2a\u6162\u542f\u52a8\u7684\u8fc7\u7a0b\uff0c\u8fd9\u4e2a\u6162\u542f\u52a8\u7684\u610f\u601d\u5c31\u662f\u4e00\u70b9\u4e00\u70b9\u7684\u63d0\u9ad8\u53d1\u9001\u6570\u636e\u5305\u7684\u6570\u91cf\uff0c\u5982\u679c\u4e00\u4e0a\u6765\u5c31\u53d1\u5927\u91cf\u7684\u6570\u636e\uff0c\u8fd9\u4e0d\u662f\u7ed9\u7f51\u7edc\u6dfb\u5835\u5417\uff1f</p> <p>\u6162\u542f\u52a8\u7684\u7b97\u6cd5\u8bb0\u4f4f\u4e00\u4e2a\u89c4\u5219\u5c31\u884c\uff1a\u5f53\u53d1\u9001\u65b9\u6bcf\u6536\u5230\u4e00\u4e2a ACK\uff0c\u62e5\u585e\u7a97\u53e3 cwnd \u7684\u5927\u5c0f\u5c31\u4f1a\u52a0 1\u3002</p> <p>\u8fd9\u91cc\u5047\u5b9a\u62e5\u585e\u7a97\u53e3 <code>cwnd</code> \u548c\u53d1\u9001\u7a97\u53e3 <code>swnd</code> \u76f8\u7b49\uff0c\u4e0b\u9762\u4e3e\u4e2a\u6817\u5b50\uff1a</p> <ul> <li>\u8fde\u63a5\u5efa\u7acb\u5b8c\u6210\u540e\uff0c\u4e00\u5f00\u59cb\u521d\u59cb\u5316 <code>cwnd = 1</code>\uff0c\u8868\u793a\u53ef\u4ee5\u4f20\u4e00\u4e2a <code>MSS</code> \u5927\u5c0f\u7684\u6570\u636e\u3002</li> <li>\u5f53\u6536\u5230\u4e00\u4e2a ACK \u786e\u8ba4\u5e94\u7b54\u540e\uff0ccwnd \u589e\u52a0 1\uff0c\u4e8e\u662f\u4e00\u6b21\u80fd\u591f\u53d1\u9001 2 \u4e2a </li> <li>\u5f53\u6536\u5230 2 \u4e2a\u7684 ACK \u786e\u8ba4\u5e94\u7b54\u540e\uff0ccwnd \u589e\u52a0 2\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u6bd4\u4e4b\u524d\u591a\u53d1 2 \u4e2a\uff0c\u6240\u4ee5\u8fd9\u4e00\u6b21\u80fd\u591f\u53d1\u9001 4 \u4e2a</li> <li>\u5f53\u8fd9 4 \u4e2a\u7684 ACK \u786e\u8ba4\u5230\u6765\u7684\u65f6\u5019\uff0c\u6bcf\u4e2a\u786e\u8ba4 cwnd \u589e\u52a0 1\uff0c4 \u4e2a\u786e\u8ba4 cwnd \u589e\u52a0 4\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u6bd4\u4e4b\u524d\u591a\u53d1 4 \u4e2a\uff0c\u6240\u4ee5\u8fd9\u4e00\u6b21\u80fd\u591f\u53d1\u9001 8 \u4e2a\u3002</li> </ul> <p>\u6162\u542f\u52a8\u7b97\u6cd5\u7684\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u51fa\u6162\u542f\u52a8\u7b97\u6cd5\uff0c\u53d1\u5305\u7684\u4e2a\u6570\u662f\u6307\u6570\u6027\u7684\u589e\u957f\u3002</p> <p>\u90a3\u6162\u542f\u52a8\u6da8\u5230\u4ec0\u4e48\u65f6\u5019\u662f\u4e2a\u5934\u5462\uff1f</p> <p>\u6709\u4e00\u4e2a\u53eb\u6162\u542f\u52a8\u95e8\u9650  <code>ssthresh</code> \uff08slow start threshold\uff09\u72b6\u6001\u53d8\u91cf\u3002</p> <ul> <li>\u5f53 <code>cwnd</code> &lt;  <code>ssthresh</code> \u65f6\uff0c\u4f7f\u7528\u6162\u542f\u52a8\u7b97\u6cd5\u3002</li> <li>\u5f53 <code>cwnd</code> &gt;= <code>ssthresh</code> \u65f6\uff0c\u5c31\u4f1a\u4f7f\u7528\u300c\u62e5\u585e\u907f\u514d\u7b97\u6cd5\u300d\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_11","title":"\u62e5\u585e\u907f\u514d\u7b97\u6cd5","text":"<p>\u524d\u9762\u8bf4\u9053\uff0c\u5f53\u62e5\u585e\u7a97\u53e3 <code>cwnd</code> \u300c\u8d85\u8fc7\u300d\u6162\u542f\u52a8\u95e8\u9650 <code>ssthresh</code> \u5c31\u4f1a\u8fdb\u5165\u62e5\u585e\u907f\u514d\u7b97\u6cd5\u3002</p> <p>\u4e00\u822c\u6765\u8bf4 <code>ssthresh</code> \u7684\u5927\u5c0f\u662f <code>65535</code> \u5b57\u8282\u3002</p> <p>\u90a3\u4e48\u8fdb\u5165\u62e5\u585e\u907f\u514d\u7b97\u6cd5\u540e\uff0c\u5b83\u7684\u89c4\u5219\u662f\uff1a\u6bcf\u5f53\u6536\u5230\u4e00\u4e2a ACK \u65f6\uff0ccwnd \u589e\u52a0 1/cwnd\u3002</p> <p>\u63a5\u4e0a\u524d\u9762\u7684\u6162\u542f\u52a8\u7684\u6817\u5b50\uff0c\u73b0\u5047\u5b9a <code>ssthresh</code> \u4e3a <code>8</code>\uff1a</p> <ul> <li>\u5f53 8 \u4e2a ACK \u5e94\u7b54\u786e\u8ba4\u5230\u6765\u65f6\uff0c\u6bcf\u4e2a\u786e\u8ba4\u589e\u52a0 1/8\uff0c8 \u4e2a ACK \u786e\u8ba4 cwnd \u4e00\u5171\u589e\u52a0 1\uff0c\u4e8e\u662f\u8fd9\u4e00\u6b21\u80fd\u591f\u53d1\u9001 9 \u4e2a <code>MSS</code> \u5927\u5c0f\u7684\u6570\u636e\uff0c\u53d8\u6210\u4e86\u7ebf\u6027\u589e\u957f\u3002</li> </ul> <p>\u62e5\u585e\u907f\u514d\u7b97\u6cd5\u7684\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u62e5\u585e\u907f\u514d\u7b97\u6cd5\u5c31\u662f\u5c06\u539f\u672c\u6162\u542f\u52a8\u7b97\u6cd5\u7684\u6307\u6570\u589e\u957f\u53d8\u6210\u4e86\u7ebf\u6027\u589e\u957f\uff0c\u8fd8\u662f\u589e\u957f\u9636\u6bb5\uff0c\u4f46\u662f\u589e\u957f\u901f\u5ea6\u7f13\u6162\u4e86\u4e00\u4e9b\u3002</p> <p>\u5c31\u8fd9\u4e48\u4e00\u76f4\u589e\u957f\u7740\u540e\uff0c\u7f51\u7edc\u5c31\u4f1a\u6162\u6162\u8fdb\u5165\u4e86\u62e5\u585e\u7684\u72b6\u51b5\u4e86\uff0c\u4e8e\u662f\u5c31\u4f1a\u51fa\u73b0\u4e22\u5305\u73b0\u8c61\uff0c\u8fd9\u65f6\u5c31\u9700\u8981\u5bf9\u4e22\u5931\u7684\u6570\u636e\u5305\u8fdb\u884c\u91cd\u4f20\u3002</p> <p>\u5f53\u89e6\u53d1\u4e86\u91cd\u4f20\u673a\u5236\uff0c\u4e5f\u5c31\u8fdb\u5165\u4e86\u300c\u62e5\u585e\u53d1\u751f\u7b97\u6cd5\u300d\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_12","title":"\u62e5\u585e\u53d1\u751f","text":"<p>\u5f53\u7f51\u7edc\u51fa\u73b0\u62e5\u585e\uff0c\u4e5f\u5c31\u662f\u4f1a\u53d1\u751f\u6570\u636e\u5305\u91cd\u4f20\uff0c\u91cd\u4f20\u673a\u5236\u4e3b\u8981\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u8d85\u65f6\u91cd\u4f20</li> <li>\u5feb\u901f\u91cd\u4f20</li> </ul> <p>\u8fd9\u4e24\u79cd\u4f7f\u7528\u7684\u62e5\u585e\u53d1\u751f\u7b97\u6cd5\u662f\u4e0d\u540c\u7684\uff0c\u63a5\u4e0b\u6765\u5206\u522b\u6765\u8bf4\u8bf4\u3002</p> <p>\u53d1\u751f\u8d85\u65f6\u91cd\u4f20\u7684\u62e5\u585e\u53d1\u751f\u7b97\u6cd5</p> <p>\u5f53\u53d1\u751f\u4e86\u300c\u8d85\u65f6\u91cd\u4f20\u300d\uff0c\u5219\u5c31\u4f1a\u4f7f\u7528\u62e5\u585e\u53d1\u751f\u7b97\u6cd5\u3002</p> <p>\u8fd9\u4e2a\u65f6\u5019\uff0cssthresh \u548c cwnd \u7684\u503c\u4f1a\u53d1\u751f\u53d8\u5316\uff1a</p> <ul> <li><code>ssthresh</code> \u8bbe\u4e3a <code>cwnd/2</code>\uff0c</li> <li><code>cwnd</code> \u91cd\u7f6e\u4e3a <code>1</code> \uff08\u662f\u6062\u590d\u4e3a cwnd \u521d\u59cb\u5316\u503c\uff0c\u6211\u8fd9\u91cc\u5047\u5b9a cwnd \u521d\u59cb\u5316\u503c 1\uff09</li> </ul> <p>\u600e\u4e48\u67e5\u770b\u7cfb\u7edf\u7684  cwnd  \u521d\u59cb\u5316\u503c\uff1f</p> <p>Linux \u9488\u5bf9\u6bcf\u4e00\u4e2a TCP \u8fde\u63a5\u7684 cwnd \u521d\u59cb\u5316\u503c\u662f 10\uff0c\u4e5f\u5c31\u662f 10 \u4e2a MSS\uff0c\u6211\u4eec\u53ef\u4ee5\u7528 ss -nli \u547d\u4ee4\u67e5\u770b\u6bcf\u4e00\u4e2a TCP \u8fde\u63a5\u7684 cwnd \u521d\u59cb\u5316\u503c\uff0c\u5982\u4e0b\u56fe</p> <p></p> <p>\u62e5\u585e\u53d1\u751f\u7b97\u6cd5\u7684\u53d8\u5316\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u5c31\u91cd\u65b0\u5f00\u59cb\u6162\u542f\u52a8\uff0c\u6162\u542f\u52a8\u662f\u4f1a\u7a81\u7136\u51cf\u5c11\u6570\u636e\u6d41\u7684\u3002\u8fd9\u771f\u662f\u4e00\u65e6\u300c\u8d85\u65f6\u91cd\u4f20\u300d\uff0c\u9a6c\u4e0a\u56de\u5230\u89e3\u653e\u524d\u3002\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u592a\u6fc0\u8fdb\u4e86\uff0c\u53cd\u5e94\u4e5f\u5f88\u5f3a\u70c8\uff0c\u4f1a\u9020\u6210\u7f51\u7edc\u5361\u987f\u3002</p> <p>\u5c31\u597d\u50cf\u672c\u6765\u5728\u79cb\u540d\u5c71\u9ad8\u901f\u6f02\u79fb\u7740\uff0c\u7a81\u7136\u6765\u4e2a\u7d27\u6025\u5239\u8f66\uff0c\u8f6e\u80ce\u53d7\u5f97\u4e86\u5417\u3002\u3002\u3002</p> <p>\u53d1\u751f\u5feb\u901f\u91cd\u4f20\u7684\u62e5\u585e\u53d1\u751f\u7b97\u6cd5</p> <p>\u8fd8\u6709\u66f4\u597d\u7684\u65b9\u5f0f\uff0c\u524d\u9762\u6211\u4eec\u8bb2\u8fc7\u300c\u5feb\u901f\u91cd\u4f20\u7b97\u6cd5\u300d\u3002\u5f53\u63a5\u6536\u65b9\u53d1\u73b0\u4e22\u4e86\u4e00\u4e2a\u4e2d\u95f4\u5305\u7684\u65f6\u5019\uff0c\u53d1\u9001\u4e09\u6b21\u524d\u4e00\u4e2a\u5305\u7684 ACK\uff0c\u4e8e\u662f\u53d1\u9001\u7aef\u5c31\u4f1a\u5feb\u901f\u5730\u91cd\u4f20\uff0c\u4e0d\u5fc5\u7b49\u5f85\u8d85\u65f6\u518d\u91cd\u4f20\u3002</p> <p>TCP \u8ba4\u4e3a\u8fd9\u79cd\u60c5\u51b5\u4e0d\u4e25\u91cd\uff0c\u56e0\u4e3a\u5927\u90e8\u5206\u6ca1\u4e22\uff0c\u53ea\u4e22\u4e86\u4e00\u5c0f\u90e8\u5206\uff0c\u5219 <code>ssthresh</code> \u548c <code>cwnd</code> \u53d8\u5316\u5982\u4e0b\uff1a</p> <ul> <li><code>cwnd = cwnd/2</code> \uff0c\u4e5f\u5c31\u662f\u8bbe\u7f6e\u4e3a\u539f\u6765\u7684\u4e00\u534a;</li> <li><code>ssthresh = cwnd</code>;</li> <li>\u8fdb\u5165\u5feb\u901f\u6062\u590d\u7b97\u6cd5</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_13","title":"\u5feb\u901f\u6062\u590d","text":"<p>\u5feb\u901f\u91cd\u4f20\u548c\u5feb\u901f\u6062\u590d\u7b97\u6cd5\u4e00\u822c\u540c\u65f6\u4f7f\u7528\uff0c\u5feb\u901f\u6062\u590d\u7b97\u6cd5\u662f\u8ba4\u4e3a\uff0c\u4f60\u8fd8\u80fd\u6536\u5230 3 \u4e2a\u91cd\u590d ACK \u8bf4\u660e\u7f51\u7edc\u4e5f\u4e0d\u90a3\u4e48\u7cdf\u7cd5\uff0c\u6240\u4ee5\u6ca1\u6709\u5fc5\u8981\u50cf <code>RTO</code> \u8d85\u65f6\u90a3\u4e48\u5f3a\u70c8\u3002</p> <p>\u6b63\u5982\u524d\u9762\u6240\u8bf4\uff0c\u8fdb\u5165\u5feb\u901f\u6062\u590d\u4e4b\u524d\uff0c<code>cwnd</code> \u548c <code>ssthresh</code> \u5df2\u88ab\u66f4\u65b0\u4e86\uff1a</p> <ul> <li><code>cwnd = cwnd/2</code> \uff0c\u4e5f\u5c31\u662f\u8bbe\u7f6e\u4e3a\u539f\u6765\u7684\u4e00\u534a;</li> <li><code>ssthresh = cwnd</code>;</li> </ul> <p>\u7136\u540e\uff0c\u8fdb\u5165\u5feb\u901f\u6062\u590d\u7b97\u6cd5\u5982\u4e0b\uff1a</p> <ul> <li>\u62e5\u585e\u7a97\u53e3 <code>cwnd = ssthresh + 3</code> \uff083 \u7684\u610f\u601d\u662f\u786e\u8ba4\u6709 3 \u4e2a\u6570\u636e\u5305\u88ab\u6536\u5230\u4e86\uff09\uff1b</li> <li>\u91cd\u4f20\u4e22\u5931\u7684\u6570\u636e\u5305\uff1b</li> <li>\u5982\u679c\u518d\u6536\u5230\u91cd\u590d\u7684 ACK\uff0c\u90a3\u4e48 cwnd \u589e\u52a0 1\uff1b</li> <li>\u5982\u679c\u6536\u5230\u65b0\u6570\u636e\u7684 ACK \u540e\uff0c\u628a cwnd \u8bbe\u7f6e\u4e3a\u7b2c\u4e00\u6b65\u4e2d\u7684 ssthresh \u7684\u503c\uff0c\u539f\u56e0\u662f\u8be5 ACK \u786e\u8ba4\u4e86\u65b0\u7684\u6570\u636e\uff0c\u8bf4\u660e\u4ece duplicated  ACK \u65f6\u7684\u6570\u636e\u90fd\u5df2\u6536\u5230\uff0c\u8be5\u6062\u590d\u8fc7\u7a0b\u5df2\u7ecf\u7ed3\u675f\uff0c\u53ef\u4ee5\u56de\u5230\u6062\u590d\u4e4b\u524d\u7684\u72b6\u6001\u4e86\uff0c\u4e5f\u5373\u518d\u6b21\u8fdb\u5165\u62e5\u585e\u907f\u514d\u72b6\u6001\uff1b</li> </ul> <p>\u5feb\u901f\u6062\u590d\u7b97\u6cd5\u7684\u53d8\u5316\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4e5f\u5c31\u662f\u6ca1\u6709\u50cf\u300c\u8d85\u65f6\u91cd\u4f20\u300d\u4e00\u591c\u56de\u5230\u89e3\u653e\u524d\uff0c\u800c\u662f\u8fd8\u5728\u6bd4\u8f83\u9ad8\u7684\u503c\uff0c\u540e\u7eed\u5448\u7ebf\u6027\u589e\u957f\u3002</p> <p>::: tip</p> <p>\u5f88\u591a\u4eba\u95ee\u9898\uff0c\u5feb\u901f\u6062\u590d\u7b97\u6cd5\u8fc7\u7a0b\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u6536\u5230\u65b0\u7684\u6570\u636e\u540e\uff0ccwnd \u8bbe\u7f6e\u56de\u4e86 ssthresh\uff1f</p> <p>\u6211\u5728\u8bc4\u8bba\u533a\u770b\u5230@muum641651\u56de\u7b54\u7684\u4e0d\u9519\uff0c\u8fd9\u91cc\u8d34\u51fa\u6765\u7ed9\u5927\u5bb6\u3002</p> <p>\u6211\u7684\u7406\u89e3\u662f\uff1a</p> <ol> <li>\u5728\u5feb\u901f\u6062\u590d\u7684\u8fc7\u7a0b\u4e2d\uff0c\u9996\u5148 ssthresh = cwnd/2\uff0c\u7136\u540e cwnd = ssthresh + 3\uff0c\u8868\u793a\u7f51\u7edc\u53ef\u80fd\u51fa\u73b0\u4e86\u963b\u585e\uff0c\u6240\u4ee5\u9700\u8981\u51cf\u5c0f cwnd \u4ee5\u907f\u514d\uff0c\u52a0 3 \u4ee3\u8868\u5feb\u901f\u91cd\u4f20\u65f6\u5df2\u7ecf\u786e\u8ba4\u63a5\u6536\u5230\u4e86 3 \u4e2a\u91cd\u590d\u7684\u6570\u636e\u5305\uff1b</li> <li>\u968f\u540e\u7ee7\u7eed\u91cd\u4f20\u4e22\u5931\u7684\u6570\u636e\u5305\uff0c\u5982\u679c\u518d\u6536\u5230\u91cd\u590d\u7684 ACK\uff0c\u90a3\u4e48 cwnd \u589e\u52a0 1\u3002\u52a0 1 \u4ee3\u8868\u6bcf\u4e2a\u6536\u5230\u7684\u91cd\u590d\u7684 ACK \u5305\uff0c\u90fd\u5df2\u7ecf\u79bb\u5f00\u4e86\u7f51\u7edc\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u7684\u76ee\u7684\u662f\u5c3d\u5feb\u5c06\u4e22\u5931\u7684\u6570\u636e\u5305\u53d1\u7ed9\u76ee\u6807\u3002</li> <li>\u5982\u679c\u6536\u5230\u65b0\u6570\u636e\u7684 ACK \u540e\uff0c\u628a cwnd \u8bbe\u7f6e\u4e3a\u7b2c\u4e00\u6b65\u4e2d\u7684 ssthresh \u7684\u503c\uff0c\u6062\u590d\u8fc7\u7a0b\u7ed3\u675f\u3002</li> </ol> <p>\u9996\u5148\uff0c\u5feb\u901f\u6062\u590d\u662f\u62e5\u585e\u53d1\u751f\u540e\u6162\u542f\u52a8\u7684\u4f18\u5316\uff0c\u5176\u9996\u8981\u76ee\u7684\u4ecd\u7136\u662f\u964d\u4f4e cwnd \u6765\u51cf\u7f13\u62e5\u585e\uff0c\u6240\u4ee5\u5fc5\u7136\u4f1a\u51fa\u73b0 cwnd \u4ece\u5927\u5230\u5c0f\u7684\u6539\u53d8\u3002</p> <p>\u5176\u6b21\uff0c\u8fc7\u7a0b 2\uff08cwnd \u9010\u6e10\u52a0 1\uff09\u7684\u5b58\u5728\u662f\u4e3a\u4e86\u5c3d\u5feb\u5c06\u4e22\u5931\u7684\u6570\u636e\u5305\u53d1\u7ed9\u76ee\u6807\uff0c\u4ece\u800c\u89e3\u51b3\u62e5\u585e\u7684\u6839\u672c\u95ee\u9898\uff08\u4e09\u6b21\u76f8\u540c\u7684 ACK \u5bfc\u81f4\u7684\u5feb\u901f\u91cd\u4f20\uff09\uff0c\u6240\u4ee5\u8fd9\u4e00\u8fc7\u7a0b\u4e2d cwnd \u53cd\u800c\u662f\u9010\u6e10\u589e\u5927\u7684\u3002</p> <p>:::</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <p>[1] \u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u4e13\u680f\u3002\u5218\u8d85\u3002\u6781\u5ba2\u65f6\u95f4</p> <p>[2] Web \u534f\u8bae\u8be6\u89e3\u4e0e\u6293\u5305\u5b9e\u6218\u4e13\u680f\u3002\u9676\u8f89\u3002\u6781\u5ba2\u65f6\u95f4</p> <p>[3] TCP/IP \u8be6\u89e3 \u5377 1\uff1a\u534f\u8bae\u3002\u8303\u5efa\u534e \u8bd1\u3002\u673a\u68b0\u5de5\u4e1a\u51fa\u7248\u793e</p> <p>[4] \u56fe\u89e3 TCP/IP.\u7af9\u4e0b\u9686\u53f2.\u4eba\u6c11\u90ae\u7535\u51fa\u7248\u793e</p> <p>[5] The TCP/IP Guide.Charles M. Kozierok.</p> <p>[6] TCP \u90a3\u4e9b\u4e8b\uff08\u4e0a\uff09.\u9648\u7693\u3002\u9177\u58f3\u535a\u5ba2\u3002 https://coolshell.cn/articles/11564.html</p> <p>[7] TCP \u90a3\u4e9b\u4e8b\uff08\u4e0b\uff09.\u9648\u7693\u3002\u9177\u58f3\u535a\u5ba2.https://coolshell.cn/articles/11609.html</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_feature/#_14","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u8bfb\u8005\u95ee\uff1a\u201c\u6574\u4e2a\u770b\u5b8c\u6536\u83b7\u5f88\u5927\uff0c\u4e0b\u9762\u662f\u6211\u7684\u4e00\u4e9b\u7591\u95ee\uff08\u7a0d\u540e \u4f1a\u53bb\u786e\u8ba4\uff09\uff1a 1.\u62e5\u585e\u907f\u514d\u8fd9\u4e00\u6bb5\uff0c\u84dd\u8272\u5b57\u4f53\uff1a\u6bcf\u5f53\u6536\u5230\u4e00\u4e2a ACK \u65f6\uff0ccwnd \u589e\u52a0 1/cwnd\u3002\u662f\u5426\u5e94\u8be5\u662f 1/ssthresh?\u5426\u5219\u4e0d\u7b26\u5408\u7ebf\u6027\u589e\u957f\u3002 2.\u5feb\u901f\u91cd\u4f20\u7684\u62e5\u585e\u53d1\u751f\u7b97\u6cd5\uff0c\u6b65\u9aa4\u4e00\u548c\u6b65\u9aa4 2 \u662f \u5426\u5199\u53cd\u4e86\uff1f\u5426\u5219\u5feb\u901f\u6062\u590d\u7b97\u6cd5\u4e2d\u6700\u540e\u4e00\u6b65\u3010\u5982\u679c \u6536\u5230\u65b0\u6570\u636e\u7684 ACK \u540e\uff0c\u8bbe\u7f6e cwnd \u4e3a ssthresh\uff0c\u63a5\u770b\u5c31\u8fdb\u5165\u4e86\u62e5\u585e\u907f\u514d\u7b97\u6cd5\u3011\u6ca1\u4ec0\u4e48 \u610f\u4e49\u3002 3.\u5bf9 ssthresh \u7684\u53d8\u5316\u4ecb\u7ecd\u7684\u6bd4\u8f83\u542b\u7cca\u3002\u201d</p> <ol> <li>\u662f 1/cwnd\uff0c\u4f60\u53ef\u4ee5\u5728 RFC2581 \u7b2c 3 \u9875\u627e\u5230\u7b54\u6848  </li> <li>\u6ca1\u6709\u5199\u53cd\uff0c\u540c\u6837\u4f60\u53ef\u4ee5\u5728 RFC2581 \u7b2c 5 \u9875\u627e\u5230\u7b54\u6848  </li> <li>ssthresh \u5c31\u662f\u6162\u542f\u52a8\u95e8\u9650\uff0c\u6211\u89c9\u5f97 ssthresh \u6211\u5df2\u7ecf\u8bf4\u7684\u5f88\u6e05\u695a\u4e86\uff0c\u5f53\u7136\u4f60\u53ef\u4ee5\u627e\u5176\u4ed6\u8d44\u6599\u8865\u5145\u4f60\u7684\u7591\u60d1</li> </ol> <p>\u662f\u5427\uff1fTCP \u5de8\u590d\u6742\u5427\uff1f\u770b\u5b8c\u5f88\u7d2f\u5427\uff1f </p> <p>\u4f46\u8fd9\u8fd8\u53ea\u662f TCP \u51b0\u5c71\u4e00\u811a\uff0c\u5b83\u7684\u66f4\u6df1\u5904\u5c31\u7531\u4f60\u4eec\u81ea\u5df1\u53bb\u63a2\u7d22\u5566\u3002</p> <p>\u5c0f\u6797\u662f\u4e13\u4e3a\u5927\u5bb6\u56fe\u89e3\u7684\u5de5\u5177\u4eba\uff0cGoodbye\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_http_keepalive/","title":"4.15 TCP Keepalive \u548c HTTP Keep-Alive \u662f\u4e00\u4e2a\u4e1c\u897f\u5417\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e4b\u524d\u6709\u8bfb\u8005\u95ee\u4e86\u6211\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a</p> <p></p> <p>\u5927\u81f4\u95ee\u9898\u662f\uff0cTCP \u7684 Keepalive \u548c HTTP \u7684 Keep-Alive \u662f\u4e00\u4e2a\u4e1c\u897f\u5417\uff1f</p> <p>\u8fd9\u662f\u4e2a\u597d\u95ee\u9898\uff0c\u5e94\u8be5\u6709\u4e0d\u5c11\u4eba\u90fd\u4f1a\u641e\u6df7\uff0c\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u4e1c\u897f\u770b\u4e0a\u53bb\u592a\u50cf\u4e86\uff0c\u5f88\u5bb9\u6613\u8bef\u4ee5\u4e3a\u662f\u540c\u4e00\u4e2a\u4e1c\u897f\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u8fd9\u4e24\u4e2a\u5b8c\u5168\u662f\u4e24\u6837\u4e0d\u540c\u4e1c\u897f\uff0c\u5b9e\u73b0\u7684\u5c42\u9762\u4e5f\u4e0d\u540c\uff1a - HTTP \u7684 Keep-Alive\uff0c\u662f\u7531\u5e94\u7528\u5c42\uff08\u7528\u6237\u6001\uff09 \u5b9e\u73b0\u7684\uff0c\u79f0\u4e3a HTTP \u957f\u8fde\u63a5\uff1b - TCP \u7684 Keepalive\uff0c\u662f\u7531 TCP \u5c42\uff08\u5185\u6838\u6001\uff09 \u5b9e\u73b0\u7684\uff0c\u79f0\u4e3a TCP \u4fdd\u6d3b\u673a\u5236\uff1b</p> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u522b\u8bf4\u8bf4\u5b83\u4eec\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_http_keepalive/#http-keep-alive","title":"HTTP \u7684 Keep-Alive","text":"<p>HTTP \u534f\u8bae\u91c7\u7528\u7684\u662f\u300c\u8bf7\u6c42 - \u5e94\u7b54\u300d\u7684\u6a21\u5f0f\uff0c\u4e5f\u5c31\u662f\u5ba2\u6237\u7aef\u53d1\u8d77\u4e86\u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u624d\u4f1a\u8fd4\u56de\u54cd\u5e94\uff0c\u4e00\u6765\u4e00\u56de\u8fd9\u6837\u5b50\u3002</p> <p></p> <p>\u7531\u4e8e HTTP \u662f\u57fa\u4e8e TCP \u4f20\u8f93\u534f\u8bae\u5b9e\u73b0\u7684\uff0c\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u8981\u8fdb\u884c HTTP \u901a\u4fe1\u524d\uff0c\u9700\u8981\u5148\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u53d1\u9001 HTTP  \u8bf7\u6c42\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\u5c31\u8fd4\u56de\u54cd\u5e94\uff0c\u81f3\u6b64\u300c\u8bf7\u6c42 - \u5e94\u7b54\u300d\u7684\u6a21\u5f0f\u5c31\u5b8c\u6210\u4e86\uff0c\u968f\u540e\u5c31\u4f1a\u91ca\u653e TCP \u8fde\u63a5\u3002</p> <p></p> <p>\u5982\u679c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u8981\u7ecf\u5386\u8fd9\u6837\u7684\u8fc7\u7a0b\uff1a\u5efa\u7acb TCP -&gt; \u8bf7\u6c42\u8d44\u6e90 -&gt; \u54cd\u5e94\u8d44\u6e90 -&gt; \u91ca\u653e\u8fde\u63a5\uff0c\u90a3\u4e48\u6b64\u65b9\u5f0f\u5c31\u662f HTTP \u77ed\u8fde\u63a5\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u6837\u5b9e\u5728\u592a\u7d2f\u4eba\u4e86\uff0c\u4e00\u6b21\u8fde\u63a5\u53ea\u80fd\u8bf7\u6c42\u4e00\u6b21\u8d44\u6e90\u3002</p> <p>\u80fd\u4e0d\u80fd\u5728\u7b2c\u4e00\u4e2a HTTP \u8bf7\u6c42\u5b8c\u540e\uff0c\u5148\u4e0d\u65ad\u5f00 TCP \u8fde\u63a5\uff0c\u8ba9\u540e\u7eed\u7684 HTTP \u8bf7\u6c42\u7ee7\u7eed\u4f7f\u7528\u6b64\u8fde\u63a5\uff1f</p> <p>\u5f53\u7136\u53ef\u4ee5\uff0cHTTP \u7684 Keep-Alive \u5c31\u662f\u5b9e\u73b0\u4e86\u8fd9\u4e2a\u529f\u80fd\uff0c\u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a TCP \u8fde\u63a5\u6765\u53d1\u9001\u548c\u63a5\u6536\u591a\u4e2a HTTP \u8bf7\u6c42/\u5e94\u7b54\uff0c\u907f\u514d\u4e86\u8fde\u63a5\u5efa\u7acb\u548c\u91ca\u653e\u7684\u5f00\u9500\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u79f0\u4e3a HTTP \u957f\u8fde\u63a5\u3002</p> <p></p> <p>HTTP \u957f\u8fde\u63a5\u7684\u7279\u70b9\u662f\uff0c\u53ea\u8981\u4efb\u610f\u4e00\u7aef\u6ca1\u6709\u660e\u786e\u63d0\u51fa\u65ad\u5f00\u8fde\u63a5\uff0c\u5219\u4fdd\u6301 TCP \u8fde\u63a5\u72b6\u6001\u3002</p> <p>\u600e\u4e48\u624d\u80fd\u4f7f\u7528 HTTP \u7684 Keep-Alive \u529f\u80fd\uff1f</p> <p>\u5728 HTTP 1.0 \u4e2d\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u5982\u679c\u6d4f\u89c8\u5668\u8981\u5f00\u542f Keep-Alive\uff0c\u5b83\u5fc5\u987b\u5728\u8bf7\u6c42\u7684\u5305\u5934\u4e2d\u6dfb\u52a0\uff1a</p> Text Only<pre><code>Connection: Keep-Alive\n</code></pre> <p>\u7136\u540e\u5f53\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\uff0c\u4f5c\u51fa\u56de\u5e94\u7684\u65f6\u5019\uff0c\u5b83\u4e5f\u6dfb\u52a0\u4e00\u4e2a\u5934\u5728\u54cd\u5e94\u4e2d\uff1a</p> Text Only<pre><code>Connection: Keep-Alive\n</code></pre> <p>\u8fd9\u6837\u505a\uff0c\u8fde\u63a5\u5c31\u4e0d\u4f1a\u4e2d\u65ad\uff0c\u800c\u662f\u4fdd\u6301\u8fde\u63a5\u3002\u5f53\u5ba2\u6237\u7aef\u53d1\u9001\u53e6\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u5b83\u4f1a\u4f7f\u7528\u540c\u4e00\u4e2a\u8fde\u63a5\u3002\u8fd9\u4e00\u76f4\u7ee7\u7eed\u5230\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u7aef\u63d0\u51fa\u65ad\u5f00\u8fde\u63a5\u3002</p> <p>\u4ece HTTP 1.1 \u5f00\u59cb\uff0c\u5c31\u9ed8\u8ba4\u662f\u5f00\u542f\u4e86 Keep-Alive\uff0c\u5982\u679c\u8981\u5173\u95ed Keep-Alive\uff0c\u9700\u8981\u5728 HTTP \u8bf7\u6c42\u7684\u5305\u5934\u91cc\u6dfb\u52a0\uff1a</p> Text Only<pre><code>Connection:close\n</code></pre> <p>\u73b0\u5728\u5927\u591a\u6570\u6d4f\u89c8\u5668\u90fd\u9ed8\u8ba4\u662f\u4f7f\u7528 HTTP/1.1\uff0c\u6240\u4ee5 Keep-Alive \u90fd\u662f\u9ed8\u8ba4\u6253\u5f00\u7684\u3002\u4e00\u65e6\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u8fbe\u6210\u534f\u8bae\uff0c\u90a3\u4e48\u957f\u8fde\u63a5\u5c31\u5efa\u7acb\u597d\u4e86\u3002</p> <p>HTTP \u957f\u8fde\u63a5\u4e0d\u4ec5\u4ec5\u51cf\u5c11\u4e86 TCP \u8fde\u63a5\u8d44\u6e90\u7684\u5f00\u9500\uff0c\u800c\u4e14\u8fd9\u7ed9 HTTP \u6d41\u6c34\u7ebf\u6280\u672f\u63d0\u4f9b\u4e86\u53ef\u5b9e\u73b0\u7684\u57fa\u7840\u3002</p> <p>\u6240\u8c13\u7684 HTTP \u6d41\u6c34\u7ebf\uff0c\u662f\u5ba2\u6237\u7aef\u53ef\u4ee5\u5148\u4e00\u6b21\u6027\u53d1\u9001\u591a\u4e2a\u8bf7\u6c42\uff0c\u800c\u5728\u53d1\u9001\u8fc7\u7a0b\u4e2d\u4e0d\u9700\u5148\u7b49\u5f85\u670d\u52a1\u5668\u7684\u56de\u5e94\uff0c\u53ef\u4ee5\u51cf\u5c11\u6574\u4f53\u7684\u54cd\u5e94\u65f6\u95f4\u3002</p> <p>\u4e3e\u4f8b\u6765\u8bf4\uff0c\u5ba2\u6237\u7aef\u9700\u8981\u8bf7\u6c42\u4e24\u4e2a\u8d44\u6e90\u3002\u4ee5\u524d\u7684\u505a\u6cd5\u662f\uff0c\u5728\u540c\u4e00\u4e2a TCP \u8fde\u63a5\u91cc\u9762\uff0c\u5148\u53d1\u9001 A \u8bf7\u6c42\uff0c\u7136\u540e\u7b49\u5f85\u670d\u52a1\u5668\u505a\u51fa\u56de\u5e94\uff0c\u6536\u5230\u540e\u518d\u53d1\u51fa B \u8bf7\u6c42\u3002HTTP \u6d41\u6c34\u7ebf\u673a\u5236\u5219\u5141\u8bb8\u5ba2\u6237\u7aef\u540c\u65f6\u53d1\u51fa A \u8bf7\u6c42\u548c B \u8bf7\u6c42\u3002</p> <p></p> <p>\u4f46\u662f\u670d\u52a1\u5668\u8fd8\u662f\u6309\u7167\u987a\u5e8f\u54cd\u5e94\uff0c\u5148\u56de\u5e94 A \u8bf7\u6c42\uff0c\u5b8c\u6210\u540e\u518d\u56de\u5e94 B \u8bf7\u6c42\u3002</p> <p>\u800c\u4e14\u8981\u7b49\u670d\u52a1\u5668\u54cd\u5e94\u5b8c\u5ba2\u6237\u7aef\u7b2c\u4e00\u6279\u53d1\u9001\u7684\u8bf7\u6c42\u540e\uff0c\u5ba2\u6237\u7aef\u624d\u80fd\u53d1\u51fa\u4e0b\u4e00\u6279\u7684\u8bf7\u6c42\uff0c\u4e5f\u5c31\u8bf4\u5982\u679c\u670d\u52a1\u5668\u54cd\u5e94\u7684\u8fc7\u7a0b\u53d1\u751f\u4e86\u963b\u585e\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5c31\u65e0\u6cd5\u53d1\u51fa\u4e0b\u4e00\u6279\u7684\u8bf7\u6c42\uff0c\u6b64\u65f6\u5c31\u9020\u6210\u4e86\u300c\u961f\u5934\u963b\u585e\u300d\u7684\u95ee\u9898\u3002</p> <p>\u53ef\u80fd\u6709\u7684\u540c\u5b66\u4f1a\u95ee\uff0c\u5982\u679c\u4f7f\u7528\u4e86 HTTP \u957f\u8fde\u63a5\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5b8c\u6210\u4e00\u4e2a HTTP \u8bf7\u6c42\u540e\uff0c\u5c31\u4e0d\u518d\u53d1\u8d77\u65b0\u7684\u8bf7\u6c42\uff0c\u6b64\u65f6\u8fd9\u4e2a TCP \u8fde\u63a5\u4e00\u76f4\u5360\u7528\u7740\u4e0d\u662f\u633a\u6d6a\u8d39\u8d44\u6e90\u7684\u5417\uff1f</p> <p>\u5bf9\u6ca1\u9519\uff0c\u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u8d44\u6e90\u6d6a\u8d39\u7684\u60c5\u51b5\uff0cweb \u670d\u52a1\u8f6f\u4ef6\u4e00\u822c\u90fd\u4f1a\u63d0\u4f9b <code>keepalive_timeout</code> \u53c2\u6570\uff0c\u7528\u6765\u6307\u5b9a HTTP \u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002</p> <p>\u6bd4\u5982\u8bbe\u7f6e\u4e86 HTTP \u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u662f 60 \u79d2\uff0cweb \u670d\u52a1\u8f6f\u4ef6\u5c31\u4f1a\u542f\u52a8\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5728\u5b8c\u540e\u4e00\u4e2a HTTP \u8bf7\u6c42\u540e\uff0c\u5728 60 \u79d2\u5185\u90fd\u6ca1\u6709\u518d\u53d1\u8d77\u65b0\u7684\u8bf7\u6c42\uff0c\u5b9a\u65f6\u5668\u7684\u65f6\u95f4\u4e00\u5230\uff0c\u5c31\u4f1a\u89e6\u53d1\u56de\u8c03\u51fd\u6570\u6765\u91ca\u653e\u8be5\u8fde\u63a5\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_http_keepalive/#tcp-keepalive","title":"TCP \u7684 Keepalive","text":"<p>TCP \u7684 Keepalive \u8fd9\u4e1c\u897f\u5176\u5b9e\u5c31\u662f TCP \u7684\u4fdd\u6d3b\u673a\u5236\uff0c\u5b83\u7684\u5de5\u4f5c\u539f\u7406\u6211\u4e4b\u524d\u7684\u6587\u7ae0\u5199\u8fc7\uff0c\u8fd9\u91cc\u5c31\u76f4\u63a5\u8d34\u4e0b\u4ee5\u524d\u7684\u5185\u5bb9\u3002</p> <p>\u5982\u679c\u4e24\u7aef\u7684 TCP \u8fde\u63a5\u4e00\u76f4\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\uff0c\u8fbe\u5230\u4e86\u89e6\u53d1 TCP \u4fdd\u6d3b\u673a\u5236\u7684\u6761\u4ef6\uff0c\u90a3\u4e48\u5185\u6838\u91cc\u7684 TCP \u534f\u8bae\u6808\u5c31\u4f1a\u53d1\u9001\u63a2\u6d4b\u62a5\u6587\u3002 - \u5982\u679c\u5bf9\u7aef\u7a0b\u5e8f\u662f\u6b63\u5e38\u5de5\u4f5c\u7684\u3002\u5f53 TCP \u4fdd\u6d3b\u7684\u63a2\u6d4b\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u7aef\uff0c\u5bf9\u7aef\u4f1a\u6b63\u5e38\u54cd\u5e94\uff0c\u8fd9\u6837 TCP \u4fdd\u6d3b\u65f6\u95f4\u4f1a\u88ab\u91cd\u7f6e\uff0c\u7b49\u5f85\u4e0b\u4e00\u4e2a TCP \u4fdd\u6d3b\u65f6\u95f4\u7684\u5230\u6765\u3002 - \u5982\u679c\u5bf9\u7aef\u4e3b\u673a\u5b95\u673a\uff08\u6ce8\u610f\u4e0d\u662f\u8fdb\u7a0b\u5d29\u6e83\uff0c\u8fdb\u7a0b\u5d29\u6e83\u540e\u64cd\u4f5c\u7cfb\u7edf\u5728\u56de\u6536\u8fdb\u7a0b\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u800c\u4e3b\u673a\u5b95\u673a\u5219\u662f\u65e0\u6cd5\u611f\u77e5\u7684\uff0c\u6240\u4ee5\u9700\u8981 TCP \u4fdd\u6d3b\u673a\u5236\u6765\u63a2\u6d4b\u5bf9\u65b9\u662f\u4e0d\u662f\u53d1\u751f\u4e86\u4e3b\u673a\u5b95\u673a\uff09\uff0c\u6216\u5bf9\u7aef\u7531\u4e8e\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\u62a5\u6587\u4e0d\u53ef\u8fbe\u3002\u5f53 TCP \u4fdd\u6d3b\u7684\u63a2\u6d4b\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u7aef\u540e\uff0c\u77f3\u6c89\u5927\u6d77\uff0c\u6ca1\u6709\u54cd\u5e94\uff0c\u8fde\u7eed\u51e0\u6b21\uff0c\u8fbe\u5230\u4fdd\u6d3b\u63a2\u6d4b\u6b21\u6570\u540e\uff0cTCP \u4f1a\u62a5\u544a\u8be5 TCP \u8fde\u63a5\u5df2\u7ecf\u6b7b\u4ea1\u3002</p> <p>\u6240\u4ee5\uff0cTCP \u4fdd\u6d3b\u673a\u5236\u53ef\u4ee5\u5728\u53cc\u65b9\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\u7684\u60c5\u51b5\uff0c\u901a\u8fc7\u63a2\u6d4b\u62a5\u6587\uff0c\u6765\u786e\u5b9a\u5bf9\u65b9\u7684 TCP \u8fde\u63a5\u662f\u5426\u5b58\u6d3b\uff0c\u8fd9\u4e2a\u5de5\u4f5c\u662f\u5728\u5185\u6838\u5b8c\u6210\u7684\u3002</p> <p></p> <p>\u6ce8\u610f\uff0c\u5e94\u7528\u7a0b\u5e8f\u82e5\u60f3\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\u9700\u8981\u901a\u8fc7 socket \u63a5\u53e3\u8bbe\u7f6e <code>SO_KEEPALIVE</code> \u9009\u9879\u624d\u80fd\u591f\u751f\u6548\uff0c\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_http_keepalive/#_1","title":"\u603b\u7ed3","text":"<p>HTTP \u7684 Keep-Alive \u4e5f\u53eb HTTP \u957f\u8fde\u63a5\uff0c\u8be5\u529f\u80fd\u662f\u7531\u300c\u5e94\u7528\u7a0b\u5e8f\u300d\u5b9e\u73b0\u7684\uff0c\u53ef\u4ee5\u4f7f\u5f97\u7528\u540c\u4e00\u4e2a TCP \u8fde\u63a5\u6765\u53d1\u9001\u548c\u63a5\u6536\u591a\u4e2a HTTP \u8bf7\u6c42/\u5e94\u7b54\uff0c\u51cf\u5c11\u4e86 HTTP \u77ed\u8fde\u63a5\u5e26\u6765\u7684\u591a\u6b21 TCP \u8fde\u63a5\u5efa\u7acb\u548c\u91ca\u653e\u7684\u5f00\u9500\u3002</p> <p>TCP \u7684 Keepalive \u4e5f\u53eb TCP \u4fdd\u6d3b\u673a\u5236\uff0c\u8be5\u529f\u80fd\u662f\u7531\u300c\u5185\u6838\u300d\u5b9e\u73b0\u7684\uff0c\u5f53\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u957f\u8fbe\u4e00\u5b9a\u65f6\u95f4\u6ca1\u6709\u8fdb\u884c\u6570\u636e\u4ea4\u4e92\u65f6\uff0c\u5185\u6838\u4e3a\u4e86\u786e\u4fdd\u8be5\u8fde\u63a5\u662f\u5426\u8fd8\u6709\u6548\uff0c\u5c31\u4f1a\u53d1\u9001\u63a2\u6d4b\u62a5\u6587\uff0c\u6765\u68c0\u6d4b\u5bf9\u65b9\u662f\u5426\u8fd8\u5728\u7ebf\uff0c\u7136\u540e\u6765\u51b3\u5b9a\u662f\u5426\u8981\u5173\u95ed\u8be5\u8fde\u63a5\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/","title":"4.1 TCP \u4e09\u6b21\u63e1\u624b\u4e0e\u56db\u6b21\u6325\u624b\u9762\u8bd5\u9898","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4efb TCP \u8650\u6211\u5343\u767e\u904d\uff0c\u6211\u4ecd\u5f85 TCP \u5982\u521d\u604b\u3002</p> <p>\u5de8\u5de8\u5de8\u5de8\u957f\u7684\u63d0\u7eb2\uff0c\u53d1\u8f66\uff01\u53d1\u8f66\uff01</p> <p></p> <p>PS\uff1a\u672c\u6b21\u6587\u7ae0\u4e0d\u6d89\u53ca TCP \u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236\u3001\u53ef\u9760\u6027\u4f20\u8f93\u7b49\u65b9\u9762\u77e5\u8bc6\uff0c\u8fd9\u4e9b\u77e5\u8bc6\u5728\u8fd9\u7bc7\uff1a\u4f60\u8fd8\u5728\u4e3a TCP \u91cd\u4f20\u3001\u6ed1\u52a8\u7a97\u53e3\u3001\u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236\u53d1\u6101\u5417\uff1f\u770b\u5b8c\u56fe\u89e3\u5c31\u4e0d\u6101\u4e86</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp","title":"TCP \u57fa\u672c\u8ba4\u8bc6","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp_1","title":"TCP \u5934\u683c\u5f0f\u6709\u54ea\u4e9b\uff1f","text":"<p>\u6211\u4eec\u5148\u6765\u770b\u770b TCP \u5934\u7684\u683c\u5f0f\uff0c\u6807\u6ce8\u989c\u8272\u7684\u8868\u793a\u4e0e\u672c\u6587\u5173\u8054\u6bd4\u8f83\u5927\u7684\u5b57\u6bb5\uff0c\u5176\u4ed6\u5b57\u6bb5\u4e0d\u505a\u8be6\u7ec6\u9610\u8ff0\u3002</p> <p></p> <p>\u5e8f\u5217\u53f7\uff1a\u5728\u5efa\u7acb\u8fde\u63a5\u65f6\u7531\u8ba1\u7b97\u673a\u751f\u6210\u7684\u968f\u673a\u6570\u4f5c\u4e3a\u5176\u521d\u59cb\u503c\uff0c\u901a\u8fc7 SYN \u5305\u4f20\u7ed9\u63a5\u6536\u7aef\u4e3b\u673a\uff0c\u6bcf\u53d1\u9001\u4e00\u6b21\u6570\u636e\uff0c\u5c31\u300c\u7d2f\u52a0\u300d\u4e00\u6b21\u8be5\u300c\u6570\u636e\u5b57\u8282\u6570\u300d\u7684\u5927\u5c0f\u3002\u7528\u6765\u89e3\u51b3\u7f51\u7edc\u5305\u4e71\u5e8f\u95ee\u9898\u3002</p> <p>\u786e\u8ba4\u5e94\u7b54\u53f7\uff1a\u6307\u4e0b\u4e00\u6b21\u300c\u671f\u671b\u300d\u6536\u5230\u7684\u6570\u636e\u7684\u5e8f\u5217\u53f7\uff0c\u53d1\u9001\u7aef\u6536\u5230\u8fd9\u4e2a\u786e\u8ba4\u5e94\u7b54\u4ee5\u540e\u53ef\u4ee5\u8ba4\u4e3a\u5728\u8fd9\u4e2a\u5e8f\u53f7\u4ee5\u524d\u7684\u6570\u636e\u90fd\u5df2\u7ecf\u88ab\u6b63\u5e38\u63a5\u6536\u3002\u7528\u6765\u89e3\u51b3\u4e22\u5305\u7684\u95ee\u9898\u3002</p> <p>\u63a7\u5236\u4f4d\uff1a</p> <ul> <li>ACK\uff1a\u8be5\u4f4d\u4e3a <code>1</code> \u65f6\uff0c\u300c\u786e\u8ba4\u5e94\u7b54\u300d\u7684\u5b57\u6bb5\u53d8\u4e3a\u6709\u6548\uff0cTCP \u89c4\u5b9a\u9664\u4e86\u6700\u521d\u5efa\u7acb\u8fde\u63a5\u65f6\u7684 <code>SYN</code> \u5305\u4e4b\u5916\u8be5\u4f4d\u5fc5\u987b\u8bbe\u7f6e\u4e3a <code>1</code> \u3002</li> <li>RST\uff1a\u8be5\u4f4d\u4e3a <code>1</code> \u65f6\uff0c\u8868\u793a TCP \u8fde\u63a5\u4e2d\u51fa\u73b0\u5f02\u5e38\u5fc5\u987b\u5f3a\u5236\u65ad\u5f00\u8fde\u63a5\u3002</li> <li>SYN\uff1a\u8be5\u4f4d\u4e3a <code>1</code> \u65f6\uff0c\u8868\u793a\u5e0c\u671b\u5efa\u7acb\u8fde\u63a5\uff0c\u5e76\u5728\u5176\u300c\u5e8f\u5217\u53f7\u300d\u7684\u5b57\u6bb5\u8fdb\u884c\u5e8f\u5217\u53f7\u521d\u59cb\u503c\u7684\u8bbe\u5b9a\u3002</li> <li>FIN\uff1a\u8be5\u4f4d\u4e3a <code>1</code> \u65f6\uff0c\u8868\u793a\u4eca\u540e\u4e0d\u4f1a\u518d\u6709\u6570\u636e\u53d1\u9001\uff0c\u5e0c\u671b\u65ad\u5f00\u8fde\u63a5\u3002\u5f53\u901a\u4fe1\u7ed3\u675f\u5e0c\u671b\u65ad\u5f00\u8fde\u63a5\u65f6\uff0c\u901a\u4fe1\u53cc\u65b9\u7684\u4e3b\u673a\u4e4b\u95f4\u5c31\u53ef\u4ee5\u76f8\u4e92\u4ea4\u6362 <code>FIN</code> \u4f4d\u4e3a 1 \u7684 TCP \u6bb5\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp-tcp","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 TCP \u534f\u8bae\uff1fTCP \u5de5\u4f5c\u5728\u54ea\u4e00\u5c42\uff1f","text":"<p><code>IP</code> \u5c42\u662f\u300c\u4e0d\u53ef\u9760\u300d\u7684\uff0c\u5b83\u4e0d\u4fdd\u8bc1\u7f51\u7edc\u5305\u7684\u4ea4\u4ed8\u3001\u4e0d\u4fdd\u8bc1\u7f51\u7edc\u5305\u7684\u6309\u5e8f\u4ea4\u4ed8\u3001\u4e5f\u4e0d\u4fdd\u8bc1\u7f51\u7edc\u5305\u4e2d\u7684\u6570\u636e\u7684\u5b8c\u6574\u6027\u3002</p> <p></p> <p>\u5982\u679c\u9700\u8981\u4fdd\u969c\u7f51\u7edc\u6570\u636e\u5305\u7684\u53ef\u9760\u6027\uff0c\u90a3\u4e48\u5c31\u9700\u8981\u7531\u4e0a\u5c42\uff08\u4f20\u8f93\u5c42\uff09\u7684 <code>TCP</code> \u534f\u8bae\u6765\u8d1f\u8d23\u3002</p> <p>\u56e0\u4e3a TCP \u662f\u4e00\u4e2a\u5de5\u4f5c\u5728\u4f20\u8f93\u5c42\u7684\u53ef\u9760\u6570\u636e\u4f20\u8f93\u7684\u670d\u52a1\uff0c\u5b83\u80fd\u786e\u4fdd\u63a5\u6536\u7aef\u63a5\u6536\u7684\u7f51\u7edc\u5305\u662f\u65e0\u635f\u574f\u3001\u65e0\u95f4\u9694\u3001\u975e\u5197\u4f59\u548c\u6309\u5e8f\u7684\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp_2","title":"\u4ec0\u4e48\u662f TCP\uff1f","text":"<p>TCP \u662f\u9762\u5411\u8fde\u63a5\u7684\u3001\u53ef\u9760\u7684\u3001\u57fa\u4e8e\u5b57\u8282\u6d41\u7684\u4f20\u8f93\u5c42\u901a\u4fe1\u534f\u8bae\u3002</p> <p></p> <ul> <li> <p>\u9762\u5411\u8fde\u63a5\uff1a\u4e00\u5b9a\u662f\u300c\u4e00\u5bf9\u4e00\u300d\u624d\u80fd\u8fde\u63a5\uff0c\u4e0d\u80fd\u50cf UDP \u534f\u8bae\u53ef\u4ee5\u4e00\u4e2a\u4e3b\u673a\u540c\u65f6\u5411\u591a\u4e2a\u4e3b\u673a\u53d1\u9001\u6d88\u606f\uff0c\u4e5f\u5c31\u662f\u4e00\u5bf9\u591a\u662f\u65e0\u6cd5\u505a\u5230\u7684\uff1b</p> </li> <li> <p>\u53ef\u9760\u7684\uff1a\u65e0\u8bba\u7f51\u7edc\u94fe\u8def\u4e2d\u51fa\u73b0\u4e86\u600e\u6837\u7684\u94fe\u8def\u53d8\u5316\uff0cTCP \u90fd\u53ef\u4ee5\u4fdd\u8bc1\u4e00\u4e2a\u62a5\u6587\u4e00\u5b9a\u80fd\u591f\u5230\u8fbe\u63a5\u6536\u7aef\uff1b</p> </li> <li> <p>\u5b57\u8282\u6d41\uff1a\u7528\u6237\u6d88\u606f\u901a\u8fc7 TCP \u534f\u8bae\u4f20\u8f93\u65f6\uff0c\u6d88\u606f\u53ef\u80fd\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u300c\u5206\u7ec4\u300d\u6210\u591a\u4e2a\u7684 TCP \u62a5\u6587\uff0c\u5982\u679c\u63a5\u6536\u65b9\u7684\u7a0b\u5e8f\u5982\u679c\u4e0d\u77e5\u9053\u300c\u6d88\u606f\u7684\u8fb9\u754c\u300d\uff0c\u662f\u65e0\u6cd5\u8bfb\u51fa\u4e00\u4e2a\u6709\u6548\u7684\u7528\u6237\u6d88\u606f\u7684\u3002\u5e76\u4e14 TCP \u62a5\u6587\u662f\u300c\u6709\u5e8f\u7684\u300d\uff0c\u5f53\u300c\u524d\u4e00\u4e2a\u300dTCP \u62a5\u6587\u6ca1\u6709\u6536\u5230\u7684\u65f6\u5019\uff0c\u5373\u4f7f\u5b83\u5148\u6536\u5230\u4e86\u540e\u9762\u7684 TCP \u62a5\u6587\uff0c\u90a3\u4e48\u4e5f\u4e0d\u80fd\u6254\u7ed9\u5e94\u7528\u5c42\u53bb\u5904\u7406\uff0c\u540c\u65f6\u5bf9\u300c\u91cd\u590d\u300d\u7684 TCP \u62a5\u6587\u4f1a\u81ea\u52a8\u4e22\u5f03\u3002</p> </li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp_3","title":"\u4ec0\u4e48\u662f TCP \u8fde\u63a5\uff1f","text":"<p>\u6211\u4eec\u6765\u770b\u770b RFC 793 \u662f\u5982\u4f55\u5b9a\u4e49\u300c\u8fde\u63a5\u300d\u7684\uff1a</p> <p>Connections: The reliability and flow control mechanisms described above require that TCPs initialize and maintain certain status information for each data stream.  The combination of this information, including sockets, sequence numbers, and window sizes, is called a connection.</p> <p>\u7b80\u5355\u6765\u8bf4\u5c31\u662f\uff0c\u7528\u4e8e\u4fdd\u8bc1\u53ef\u9760\u6027\u548c\u6d41\u91cf\u63a7\u5236\u7ef4\u62a4\u7684\u67d0\u4e9b\u72b6\u6001\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u7684\u7ec4\u5408\uff0c\u5305\u62ec Socket\u3001\u5e8f\u5217\u53f7\u548c\u7a97\u53e3\u5927\u5c0f\u79f0\u4e3a\u8fde\u63a5\u3002</p> <p></p> <p>\u6240\u4ee5\u6211\u4eec\u53ef\u4ee5\u77e5\u9053\uff0c\u5efa\u7acb\u4e00\u4e2a TCP \u8fde\u63a5\u662f\u9700\u8981\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u8fbe\u6210\u4e0a\u8ff0\u4e09\u4e2a\u4fe1\u606f\u7684\u5171\u8bc6\u3002</p> <ul> <li>Socket\uff1a\u7531 IP \u5730\u5740\u548c\u7aef\u53e3\u53f7\u7ec4\u6210</li> <li>\u5e8f\u5217\u53f7\uff1a\u7528\u6765\u89e3\u51b3\u4e71\u5e8f\u95ee\u9898\u7b49</li> <li>\u7a97\u53e3\u5927\u5c0f\uff1a\u7528\u6765\u505a\u6d41\u91cf\u63a7\u5236</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp_4","title":"\u5982\u4f55\u552f\u4e00\u786e\u5b9a\u4e00\u4e2a TCP \u8fde\u63a5\u5462\uff1f","text":"<p>TCP \u56db\u5143\u7ec4\u53ef\u4ee5\u552f\u4e00\u7684\u786e\u5b9a\u4e00\u4e2a\u8fde\u63a5\uff0c\u56db\u5143\u7ec4\u5305\u62ec\u5982\u4e0b\uff1a</p> <ul> <li>\u6e90\u5730\u5740</li> <li>\u6e90\u7aef\u53e3</li> <li>\u76ee\u7684\u5730\u5740</li> <li>\u76ee\u7684\u7aef\u53e3</li> </ul> <p></p> <p>\u6e90\u5730\u5740\u548c\u76ee\u7684\u5730\u5740\u7684\u5b57\u6bb5\uff0832 \u4f4d\uff09\u662f\u5728 IP \u5934\u90e8\u4e2d\uff0c\u4f5c\u7528\u662f\u901a\u8fc7 IP \u534f\u8bae\u53d1\u9001\u62a5\u6587\u7ed9\u5bf9\u65b9\u4e3b\u673a\u3002</p> <p>\u6e90\u7aef\u53e3\u548c\u76ee\u7684\u7aef\u53e3\u7684\u5b57\u6bb5\uff0816 \u4f4d\uff09\u662f\u5728 TCP \u5934\u90e8\u4e2d\uff0c\u4f5c\u7528\u662f\u544a\u8bc9 TCP \u534f\u8bae\u5e94\u8be5\u628a\u62a5\u6587\u53d1\u7ed9\u54ea\u4e2a\u8fdb\u7a0b\u3002</p> <p>\u6709\u4e00\u4e2a IP \u7684\u670d\u52a1\u7aef\u76d1\u542c\u4e86\u4e00\u4e2a\u7aef\u53e3\uff0c\u5b83\u7684 TCP \u7684\u6700\u5927\u8fde\u63a5\u6570\u662f\u591a\u5c11\uff1f</p> <p>\u670d\u52a1\u7aef\u901a\u5e38\u56fa\u5b9a\u5728\u67d0\u4e2a\u672c\u5730\u7aef\u53e3\u4e0a\u76d1\u542c\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8bf7\u6c42\u3002</p> <p>\u56e0\u6b64\uff0c\u5ba2\u6237\u7aef IP \u548c\u7aef\u53e3\u662f\u53ef\u53d8\u7684\uff0c\u5176\u7406\u8bba\u503c\u8ba1\u7b97\u516c\u5f0f\u5982\u4e0b\uff1a</p> <p></p> <p>\u5bf9 IPv4\uff0c\u5ba2\u6237\u7aef\u7684 IP \u6570\u6700\u591a\u4e3a <code>2</code> \u7684 <code>32</code> \u6b21\u65b9\uff0c\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u6570\u6700\u591a\u4e3a <code>2</code> \u7684 <code>16</code> \u6b21\u65b9\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u7aef\u5355\u673a\u6700\u5927 TCP \u8fde\u63a5\u6570\uff0c\u7ea6\u4e3a <code>2</code> \u7684 <code>48</code> \u6b21\u65b9\u3002</p> <p>\u5f53\u7136\uff0c\u670d\u52a1\u7aef\u6700\u5927\u5e76\u53d1 TCP \u8fde\u63a5\u6570\u8fdc\u4e0d\u80fd\u8fbe\u5230\u7406\u8bba\u4e0a\u9650\uff0c\u4f1a\u53d7\u4ee5\u4e0b\u56e0\u7d20\u5f71\u54cd\uff1a</p> <ul> <li>\u6587\u4ef6\u63cf\u8ff0\u7b26\u9650\u5236\uff0c\u6bcf\u4e2a TCP \u8fde\u63a5\u90fd\u662f\u4e00\u4e2a\u6587\u4ef6\uff0c\u5982\u679c\u6587\u4ef6\u63cf\u8ff0\u7b26\u88ab\u5360\u6ee1\u4e86\uff0c\u4f1a\u53d1\u751f Too many open files\u3002Linux \u5bf9\u53ef\u6253\u5f00\u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\u7684\u6570\u91cf\u5206\u522b\u4f5c\u4e86\u4e09\u4e2a\u65b9\u9762\u7684\u9650\u5236\uff1a</li> <li>\u7cfb\u7edf\u7ea7\uff1a\u5f53\u524d\u7cfb\u7edf\u53ef\u6253\u5f00\u7684\u6700\u5927\u6570\u91cf\uff0c\u901a\u8fc7 <code>cat /proc/sys/fs/file-max</code> \u67e5\u770b\uff1b</li> <li>\u7528\u6237\u7ea7\uff1a\u6307\u5b9a\u7528\u6237\u53ef\u6253\u5f00\u7684\u6700\u5927\u6570\u91cf\uff0c\u901a\u8fc7 <code>cat /etc/security/limits.conf</code> \u67e5\u770b\uff1b</li> <li>\u8fdb\u7a0b\u7ea7\uff1a\u5355\u4e2a\u8fdb\u7a0b\u53ef\u6253\u5f00\u7684\u6700\u5927\u6570\u91cf\uff0c\u901a\u8fc7 <code>cat /proc/sys/fs/nr_open</code> \u67e5\u770b\uff1b</li> <li>\u5185\u5b58\u9650\u5236\uff0c\u6bcf\u4e2a TCP \u8fde\u63a5\u90fd\u8981\u5360\u7528\u4e00\u5b9a\u5185\u5b58\uff0c\u64cd\u4f5c\u7cfb\u7edf\u7684\u5185\u5b58\u662f\u6709\u9650\u7684\uff0c\u5982\u679c\u5185\u5b58\u8d44\u6e90\u88ab\u5360\u6ee1\u540e\uff0c\u4f1a\u53d1\u751f OOM\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#udp-tcp","title":"UDP \u548c TCP \u6709\u4ec0\u4e48\u533a\u522b\u5462\uff1f\u5206\u522b\u7684\u5e94\u7528\u573a\u666f\u662f\uff1f","text":"<p>UDP \u4e0d\u63d0\u4f9b\u590d\u6742\u7684\u63a7\u5236\u673a\u5236\uff0c\u5229\u7528 IP \u63d0\u4f9b\u9762\u5411\u300c\u65e0\u8fde\u63a5\u300d\u7684\u901a\u4fe1\u670d\u52a1\u3002</p> <p>UDP \u534f\u8bae\u771f\u7684\u975e\u5e38\u7b80\u5355\uff0c\u5934\u90e8\u53ea\u6709 <code>8</code> \u4e2a\u5b57\u8282\uff0864 \u4f4d\uff09\uff0cUDP \u7684\u5934\u90e8\u683c\u5f0f\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>\u76ee\u6807\u548c\u6e90\u7aef\u53e3\uff1a\u4e3b\u8981\u662f\u544a\u8bc9 UDP \u534f\u8bae\u5e94\u8be5\u628a\u62a5\u6587\u53d1\u7ed9\u54ea\u4e2a\u8fdb\u7a0b\u3002</li> <li>\u5305\u957f\u5ea6\uff1a\u8be5\u5b57\u6bb5\u4fdd\u5b58\u4e86 UDP \u9996\u90e8\u7684\u957f\u5ea6\u8ddf\u6570\u636e\u7684\u957f\u5ea6\u4e4b\u548c\u3002</li> <li>\u6821\u9a8c\u548c\uff1a\u6821\u9a8c\u548c\u662f\u4e3a\u4e86\u63d0\u4f9b\u53ef\u9760\u7684 UDP \u9996\u90e8\u548c\u6570\u636e\u800c\u8bbe\u8ba1\uff0c\u9632\u6b62\u6536\u5230\u5728\u7f51\u7edc\u4f20\u8f93\u4e2d\u53d7\u635f\u7684 UDP \u5305\u3002</li> </ul> <p>TCP \u548c UDP \u533a\u522b\uff1a</p> <p>1. \u8fde\u63a5</p> <ul> <li>TCP \u662f\u9762\u5411\u8fde\u63a5\u7684\u4f20\u8f93\u5c42\u534f\u8bae\uff0c\u4f20\u8f93\u6570\u636e\u524d\u5148\u8981\u5efa\u7acb\u8fde\u63a5\u3002</li> <li>UDP \u662f\u4e0d\u9700\u8981\u8fde\u63a5\uff0c\u5373\u523b\u4f20\u8f93\u6570\u636e\u3002</li> </ul> <p>2. \u670d\u52a1\u5bf9\u8c61</p> <ul> <li>TCP \u662f\u4e00\u5bf9\u4e00\u7684\u4e24\u70b9\u670d\u52a1\uff0c\u5373\u4e00\u6761\u8fde\u63a5\u53ea\u6709\u4e24\u4e2a\u7aef\u70b9\u3002</li> <li>UDP \u652f\u6301\u4e00\u5bf9\u4e00\u3001\u4e00\u5bf9\u591a\u3001\u591a\u5bf9\u591a\u7684\u4ea4\u4e92\u901a\u4fe1</li> </ul> <p>3. \u53ef\u9760\u6027</p> <ul> <li>TCP \u662f\u53ef\u9760\u4ea4\u4ed8\u6570\u636e\u7684\uff0c\u6570\u636e\u53ef\u4ee5\u65e0\u5dee\u9519\u3001\u4e0d\u4e22\u5931\u3001\u4e0d\u91cd\u590d\u3001\u6309\u5e8f\u5230\u8fbe\u3002</li> <li>UDP \u662f\u5c3d\u6700\u5927\u52aa\u529b\u4ea4\u4ed8\uff0c\u4e0d\u4fdd\u8bc1\u53ef\u9760\u4ea4\u4ed8\u6570\u636e\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u57fa\u4e8e UDP \u4f20\u8f93\u534f\u8bae\u5b9e\u73b0\u4e00\u4e2a\u53ef\u9760\u7684\u4f20\u8f93\u534f\u8bae\uff0c\u6bd4\u5982 QUIC \u534f\u8bae\uff0c\u5177\u4f53\u53ef\u4ee5\u53c2\u89c1\u8fd9\u7bc7\u6587\u7ae0\uff1a\u5982\u4f55\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\uff1f</li> </ul> <p>4. \u62e5\u585e\u63a7\u5236\u3001\u6d41\u91cf\u63a7\u5236</p> <ul> <li>TCP \u6709\u62e5\u585e\u63a7\u5236\u548c\u6d41\u91cf\u63a7\u5236\u673a\u5236\uff0c\u4fdd\u8bc1\u6570\u636e\u4f20\u8f93\u7684\u5b89\u5168\u6027\u3002</li> <li>UDP \u5219\u6ca1\u6709\uff0c\u5373\u4f7f\u7f51\u7edc\u975e\u5e38\u62e5\u5835\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u5f71\u54cd UDP \u7684\u53d1\u9001\u901f\u7387\u3002</li> </ul> <p>5. \u9996\u90e8\u5f00\u9500</p> <ul> <li>TCP \u9996\u90e8\u957f\u5ea6\u8f83\u957f\uff0c\u4f1a\u6709\u4e00\u5b9a\u7684\u5f00\u9500\uff0c\u9996\u90e8\u5728\u6ca1\u6709\u4f7f\u7528\u300c\u9009\u9879\u300d\u5b57\u6bb5\u65f6\u662f <code>20</code> \u4e2a\u5b57\u8282\uff0c\u5982\u679c\u4f7f\u7528\u4e86\u300c\u9009\u9879\u300d\u5b57\u6bb5\u5219\u4f1a\u53d8\u957f\u7684\u3002</li> <li>UDP \u9996\u90e8\u53ea\u6709 8 \u4e2a\u5b57\u8282\uff0c\u5e76\u4e14\u662f\u56fa\u5b9a\u4e0d\u53d8\u7684\uff0c\u5f00\u9500\u8f83\u5c0f\u3002</li> </ul> <p>6. \u4f20\u8f93\u65b9\u5f0f</p> <ul> <li>TCP \u662f\u6d41\u5f0f\u4f20\u8f93\uff0c\u6ca1\u6709\u8fb9\u754c\uff0c\u4f46\u4fdd\u8bc1\u987a\u5e8f\u548c\u53ef\u9760\u3002</li> <li>UDP \u662f\u4e00\u4e2a\u5305\u4e00\u4e2a\u5305\u7684\u53d1\u9001\uff0c\u662f\u6709\u8fb9\u754c\u7684\uff0c\u4f46\u53ef\u80fd\u4f1a\u4e22\u5305\u548c\u4e71\u5e8f\u3002</li> </ul> <p>7. \u5206\u7247\u4e0d\u540c</p> <ul> <li>TCP \u7684\u6570\u636e\u5927\u5c0f\u5982\u679c\u5927\u4e8e MSS \u5927\u5c0f\uff0c\u5219\u4f1a\u5728\u4f20\u8f93\u5c42\u8fdb\u884c\u5206\u7247\uff0c\u76ee\u6807\u4e3b\u673a\u6536\u5230\u540e\uff0c\u4e5f\u540c\u6837\u5728\u4f20\u8f93\u5c42\u7ec4\u88c5 TCP \u6570\u636e\u5305\uff0c\u5982\u679c\u4e2d\u9014\u4e22\u5931\u4e86\u4e00\u4e2a\u5206\u7247\uff0c\u53ea\u9700\u8981\u4f20\u8f93\u4e22\u5931\u7684\u8fd9\u4e2a\u5206\u7247\u3002</li> <li>UDP \u7684\u6570\u636e\u5927\u5c0f\u5982\u679c\u5927\u4e8e MTU \u5927\u5c0f\uff0c\u5219\u4f1a\u5728 IP \u5c42\u8fdb\u884c\u5206\u7247\uff0c\u76ee\u6807\u4e3b\u673a\u6536\u5230\u540e\uff0c\u5728 IP \u5c42\u7ec4\u88c5\u5b8c\u6570\u636e\uff0c\u63a5\u7740\u518d\u4f20\u7ed9\u4f20\u8f93\u5c42\u3002</li> </ul> <p>TCP \u548c UDP \u5e94\u7528\u573a\u666f\uff1a</p> <p>\u7531\u4e8e TCP \u662f\u9762\u5411\u8fde\u63a5\uff0c\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u53ef\u9760\u6027\u4ea4\u4ed8\uff0c\u56e0\u6b64\u7ecf\u5e38\u7528\u4e8e\uff1a</p> <ul> <li><code>FTP</code> \u6587\u4ef6\u4f20\u8f93\uff1b</li> <li>HTTP / HTTPS\uff1b</li> </ul> <p>\u7531\u4e8e UDP \u9762\u5411\u65e0\u8fde\u63a5\uff0c\u5b83\u53ef\u4ee5\u968f\u65f6\u53d1\u9001\u6570\u636e\uff0c\u518d\u52a0\u4e0a UDP \u672c\u8eab\u7684\u5904\u7406\u65e2\u7b80\u5355\u53c8\u9ad8\u6548\uff0c\u56e0\u6b64\u7ecf\u5e38\u7528\u4e8e\uff1a</p> <ul> <li>\u5305\u603b\u91cf\u8f83\u5c11\u7684\u901a\u4fe1\uff0c\u5982 <code>DNS</code> \u3001<code>SNMP</code> \u7b49\uff1b</li> <li>\u89c6\u9891\u3001\u97f3\u9891\u7b49\u591a\u5a92\u4f53\u901a\u4fe1\uff1b</li> <li>\u5e7f\u64ad\u901a\u4fe1\uff1b</li> </ul> <p>\u4e3a\u4ec0\u4e48 UDP \u5934\u90e8\u6ca1\u6709\u300c\u9996\u90e8\u957f\u5ea6\u300d\u5b57\u6bb5\uff0c\u800c TCP \u5934\u90e8\u6709\u300c\u9996\u90e8\u957f\u5ea6\u300d\u5b57\u6bb5\u5462\uff1f</p> <p>\u539f\u56e0\u662f TCP \u6709\u53ef\u53d8\u957f\u7684\u300c\u9009\u9879\u300d\u5b57\u6bb5\uff0c\u800c UDP \u5934\u90e8\u957f\u5ea6\u5219\u662f\u4e0d\u4f1a\u53d8\u5316\u7684\uff0c\u65e0\u9700\u591a\u4e00\u4e2a\u5b57\u6bb5\u53bb\u8bb0\u5f55 UDP \u7684\u9996\u90e8\u957f\u5ea6\u3002</p> <p>\u4e3a\u4ec0\u4e48 UDP \u5934\u90e8\u6709\u300c\u5305\u957f\u5ea6\u300d\u5b57\u6bb5\uff0c\u800c TCP \u5934\u90e8\u5219\u6ca1\u6709\u300c\u5305\u957f\u5ea6\u300d\u5b57\u6bb5\u5462\uff1f</p> <p>\u5148\u8bf4\u8bf4 TCP \u662f\u5982\u4f55\u8ba1\u7b97\u8d1f\u8f7d\u6570\u636e\u957f\u5ea6\uff1a</p> <p></p> <p>\u5176\u4e2d IP \u603b\u957f\u5ea6 \u548c IP \u9996\u90e8\u957f\u5ea6\uff0c\u5728 IP \u9996\u90e8\u683c\u5f0f\u662f\u5df2\u77e5\u7684\u3002TCP \u9996\u90e8\u957f\u5ea6\uff0c\u5219\u662f\u5728 TCP \u9996\u90e8\u683c\u5f0f\u5df2\u77e5\u7684\uff0c\u6240\u4ee5\u5c31\u53ef\u4ee5\u6c42\u5f97 TCP \u6570\u636e\u7684\u957f\u5ea6\u3002</p> <p>\u5927\u5bb6\u8fd9\u65f6\u5c31\u5947\u602a\u4e86\u95ee\uff1a\u201cUDP \u4e5f\u662f\u57fa\u4e8e IP \u5c42\u7684\u5440\uff0c\u90a3 UDP \u7684\u6570\u636e\u957f\u5ea6\u4e5f\u53ef\u4ee5\u901a\u8fc7\u8fd9\u4e2a\u516c\u5f0f\u8ba1\u7b97\u5440\uff1f\u4e3a\u4f55\u8fd8\u8981\u6709\u300c\u5305\u957f\u5ea6\u300d\u5462\uff1f\u201d</p> <p>\u8fd9\u4e48\u4e00\u95ee\uff0c\u786e\u5b9e\u611f\u89c9 UDP \u7684\u300c\u5305\u957f\u5ea6\u300d\u662f\u5197\u4f59\u7684\u3002</p> <p>\u6211\u67e5\u9605\u4e86\u5f88\u591a\u8d44\u6599\uff0c\u6211\u89c9\u5f97\u6709\u4e24\u4e2a\u6bd4\u8f83\u9760\u8c31\u7684\u8bf4\u6cd5\uff1a - \u7b2c\u4e00\u79cd\u8bf4\u6cd5\uff1a\u56e0\u4e3a\u4e3a\u4e86\u7f51\u7edc\u8bbe\u5907\u786c\u4ef6\u8bbe\u8ba1\u548c\u5904\u7406\u65b9\u4fbf\uff0c\u9996\u90e8\u957f\u5ea6\u9700\u8981\u662f <code>4</code> \u5b57\u8282\u7684\u6574\u6570\u500d\u3002\u5982\u679c\u53bb\u6389 UDP \u7684\u300c\u5305\u957f\u5ea6\u300d\u5b57\u6bb5\uff0c\u90a3 UDP \u9996\u90e8\u957f\u5ea6\u5c31\u4e0d\u662f <code>4</code> \u5b57\u8282\u7684\u6574\u6570\u500d\u4e86\uff0c\u6240\u4ee5\u6211\u89c9\u5f97\u8fd9\u53ef\u80fd\u662f\u4e3a\u4e86\u8865\u5168 UDP \u9996\u90e8\u957f\u5ea6\u662f  <code>4</code> \u5b57\u8282\u7684\u6574\u6570\u500d\uff0c\u624d\u8865\u5145\u4e86\u300c\u5305\u957f\u5ea6\u300d\u5b57\u6bb5\u3002 - \u7b2c\u4e8c\u79cd\u8bf4\u6cd5\uff1a\u5982\u4eca\u7684 UDP \u534f\u8bae\u662f\u57fa\u4e8e IP \u534f\u8bae\u53d1\u5c55\u7684\uff0c\u800c\u5f53\u5e74\u53ef\u80fd\u5e76\u975e\u5982\u6b64\uff0c\u4f9d\u8d56\u7684\u53ef\u80fd\u662f\u522b\u7684\u4e0d\u63d0\u4f9b\u81ea\u8eab\u62a5\u6587\u957f\u5ea6\u6216\u9996\u90e8\u957f\u5ea6\u7684\u7f51\u7edc\u5c42\u534f\u8bae\uff0c\u56e0\u6b64 UDP \u62a5\u6587\u9996\u90e8\u9700\u8981\u6709\u957f\u5ea6\u5b57\u6bb5\u4ee5\u4f9b\u8ba1\u7b97\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp-udp","title":"TCP \u548c UDP \u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f","text":"<p>\u7b54\u6848\uff1a\u53ef\u4ee5\u7684\u3002</p> <p>\u5728\u6570\u636e\u94fe\u8def\u5c42\u4e2d\uff0c\u901a\u8fc7 MAC \u5730\u5740\u6765\u5bfb\u627e\u5c40\u57df\u7f51\u4e2d\u7684\u4e3b\u673a\u3002\u5728\u7f51\u9645\u5c42\u4e2d\uff0c\u901a\u8fc7 IP \u5730\u5740\u6765\u5bfb\u627e\u7f51\u7edc\u4e2d\u4e92\u8fde\u7684\u4e3b\u673a\u6216\u8def\u7531\u5668\u3002\u5728\u4f20\u8f93\u5c42\u4e2d\uff0c\u9700\u8981\u901a\u8fc7\u7aef\u53e3\u8fdb\u884c\u5bfb\u5740\uff0c\u6765\u8bc6\u522b\u540c\u4e00\u8ba1\u7b97\u673a\u4e2d\u540c\u65f6\u901a\u4fe1\u7684\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u6240\u4ee5\uff0c\u4f20\u8f93\u5c42\u7684\u300c\u7aef\u53e3\u53f7\u300d\u7684\u4f5c\u7528\uff0c\u662f\u4e3a\u4e86\u533a\u5206\u540c\u4e00\u4e2a\u4e3b\u673a\u4e0a\u4e0d\u540c\u5e94\u7528\u7a0b\u5e8f\u7684\u6570\u636e\u5305\u3002</p> <p>\u4f20\u8f93\u5c42\u6709\u4e24\u4e2a\u4f20\u8f93\u534f\u8bae\u5206\u522b\u662f TCP \u548c UDP\uff0c\u5728\u5185\u6838\u4e2d\u662f\u4e24\u4e2a\u5b8c\u5168\u72ec\u7acb\u7684\u8f6f\u4ef6\u6a21\u5757\u3002</p> <p>\u5f53\u4e3b\u673a\u6536\u5230\u6570\u636e\u5305\u540e\uff0c\u53ef\u4ee5\u5728 IP \u5305\u5934\u7684\u300c\u534f\u8bae\u53f7\u300d\u5b57\u6bb5\u77e5\u9053\u8be5\u6570\u636e\u5305\u662f TCP/UDP\uff0c\u6240\u4ee5\u53ef\u4ee5\u6839\u636e\u8fd9\u4e2a\u4fe1\u606f\u786e\u5b9a\u9001\u7ed9\u54ea\u4e2a\u6a21\u5757\uff08TCP/UDP\uff09\u5904\u7406\uff0c\u9001\u7ed9 TCP/UDP \u6a21\u5757\u7684\u62a5\u6587\u6839\u636e\u300c\u7aef\u53e3\u53f7\u300d\u786e\u5b9a\u9001\u7ed9\u54ea\u4e2a\u5e94\u7528\u7a0b\u5e8f\u5904\u7406\u3002</p> <p></p> <p>\u56e0\u6b64\uff0cTCP/UDP \u5404\u81ea\u7684\u7aef\u53e3\u53f7\u4e5f\u76f8\u4e92\u72ec\u7acb\uff0c\u5982 TCP \u6709\u4e00\u4e2a 80 \u53f7\u7aef\u53e3\uff0cUDP \u4e5f\u53ef\u4ee5\u6709\u4e00\u4e2a 80 \u53f7\u7aef\u53e3\uff0c\u4e8c\u8005\u5e76\u4e0d\u51b2\u7a81\u3002</p> <p>\u5173\u4e8e\u7aef\u53e3\u7684\u77e5\u8bc6\u70b9\uff0c\u8fd8\u662f\u633a\u591a\u53ef\u4ee5\u8bb2\u7684\uff0c\u6bd4\u5982\u8fd8\u53ef\u4ee5\u7275\u626f\u5230\u8fd9\u51e0\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u591a\u4e2a TCP \u670d\u52a1\u8fdb\u7a0b\u53ef\u4ee5\u540c\u65f6\u7ed1\u5b9a\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f</li> <li>\u91cd\u542f TCP \u670d\u52a1\u8fdb\u7a0b\u65f6\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0\u201cAddress in use\u201d\u7684\u62a5\u9519\u4fe1\u606f\uff1f\u53c8\u8be5\u600e\u4e48\u907f\u514d\uff1f</li> <li>\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u5417\uff1f</li> <li>\u5ba2\u6237\u7aef TCP \u8fde\u63a5 TIME_WAIT \u72b6\u6001\u8fc7\u591a\uff0c\u4f1a\u5bfc\u81f4\u7aef\u53e3\u8d44\u6e90\u8017\u5c3d\u800c\u65e0\u6cd5\u5efa\u7acb\u65b0\u7684\u8fde\u63a5\u5417\uff1f</li> </ul> <p>\u4e0a\u9762\u8fd9\u4e9b\u95ee\u9898\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\u6587\u7ae0\uff1aTCP \u548c UDP \u53ef\u4ee5\u4f7f\u7528\u540c\u4e00\u4e2a\u7aef\u53e3\u5417\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp_5","title":"TCP \u8fde\u63a5\u5efa\u7acb","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp_6","title":"TCP \u4e09\u6b21\u63e1\u624b\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>TCP \u662f\u9762\u5411\u8fde\u63a5\u7684\u534f\u8bae\uff0c\u6240\u4ee5\u4f7f\u7528 TCP \u524d\u5fc5\u987b\u5148\u5efa\u7acb\u8fde\u63a5\uff0c\u800c\u5efa\u7acb\u8fde\u63a5\u662f\u901a\u8fc7\u4e09\u6b21\u63e1\u624b\u6765\u8fdb\u884c\u7684\u3002\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <ul> <li>\u4e00\u5f00\u59cb\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u5904\u4e8e <code>CLOSE</code> \u72b6\u6001\u3002\u5148\u662f\u670d\u52a1\u7aef\u4e3b\u52a8\u76d1\u542c\u67d0\u4e2a\u7aef\u53e3\uff0c\u5904\u4e8e <code>LISTEN</code> \u72b6\u6001</li> </ul> <p></p> <ul> <li>\u5ba2\u6237\u7aef\u4f1a\u968f\u673a\u521d\u59cb\u5316\u5e8f\u53f7\uff08<code>client_isn</code>\uff09\uff0c\u5c06\u6b64\u5e8f\u53f7\u7f6e\u4e8e TCP \u9996\u90e8\u7684\u300c\u5e8f\u53f7\u300d\u5b57\u6bb5\u4e2d\uff0c\u540c\u65f6\u628a <code>SYN</code> \u6807\u5fd7\u4f4d\u7f6e\u4e3a <code>1</code>\uff0c\u8868\u793a <code>SYN</code> \u62a5\u6587\u3002\u63a5\u7740\u628a\u7b2c\u4e00\u4e2a SYN \u62a5\u6587\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u8868\u793a\u5411\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\uff0c\u8be5\u62a5\u6587\u4e0d\u5305\u542b\u5e94\u7528\u5c42\u6570\u636e\uff0c\u4e4b\u540e\u5ba2\u6237\u7aef\u5904\u4e8e <code>SYN-SENT</code> \u72b6\u6001\u3002 </li> </ul> <p></p> <ul> <li>\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684 <code>SYN</code> \u62a5\u6587\u540e\uff0c\u9996\u5148\u670d\u52a1\u7aef\u4e5f\u968f\u673a\u521d\u59cb\u5316\u81ea\u5df1\u7684\u5e8f\u53f7\uff08<code>server_isn</code>\uff09\uff0c\u5c06\u6b64\u5e8f\u53f7\u586b\u5165 TCP \u9996\u90e8\u7684\u300c\u5e8f\u53f7\u300d\u5b57\u6bb5\u4e2d\uff0c\u5176\u6b21\u628a TCP \u9996\u90e8\u7684\u300c\u786e\u8ba4\u5e94\u7b54\u53f7\u300d\u5b57\u6bb5\u586b\u5165 <code>client_isn + 1</code>, \u63a5\u7740\u628a <code>SYN</code> \u548c <code>ACK</code> \u6807\u5fd7\u4f4d\u7f6e\u4e3a <code>1</code>\u3002\u6700\u540e\u628a\u8be5\u62a5\u6587\u53d1\u7ed9\u5ba2\u6237\u7aef\uff0c\u8be5\u62a5\u6587\u4e5f\u4e0d\u5305\u542b\u5e94\u7528\u5c42\u6570\u636e\uff0c\u4e4b\u540e\u670d\u52a1\u7aef\u5904\u4e8e <code>SYN-RCVD</code> \u72b6\u6001\u3002</li> </ul> <p></p> <ul> <li> <p>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u62a5\u6587\u540e\uff0c\u8fd8\u8981\u5411\u670d\u52a1\u7aef\u56de\u5e94\u6700\u540e\u4e00\u4e2a\u5e94\u7b54\u62a5\u6587\uff0c\u9996\u5148\u8be5\u5e94\u7b54\u62a5\u6587 TCP \u9996\u90e8 <code>ACK</code> \u6807\u5fd7\u4f4d\u7f6e\u4e3a <code>1</code> \uff0c\u5176\u6b21\u300c\u786e\u8ba4\u5e94\u7b54\u53f7\u300d\u5b57\u6bb5\u586b\u5165 <code>server_isn + 1</code> \uff0c\u6700\u540e\u628a\u62a5\u6587\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\uff0c\u8fd9\u6b21\u62a5\u6587\u53ef\u4ee5\u643a\u5e26\u5ba2\u6237\u5230\u670d\u52a1\u7aef\u7684\u6570\u636e\uff0c\u4e4b\u540e\u5ba2\u6237\u7aef\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\u3002</p> </li> <li> <p>\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684\u5e94\u7b54\u62a5\u6587\u540e\uff0c\u4e5f\u8fdb\u5165 <code>ESTABLISHED</code> \u72b6\u6001\u3002</p> </li> </ul> <p>\u4ece\u4e0a\u9762\u7684\u8fc7\u7a0b\u53ef\u4ee5\u53d1\u73b0\u7b2c\u4e09\u6b21\u63e1\u624b\u662f\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684\uff0c\u524d\u4e24\u6b21\u63e1\u624b\u662f\u4e0d\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684\uff0c\u8fd9\u4e5f\u662f\u9762\u8bd5\u5e38\u95ee\u7684\u9898\u3002</p> <p>\u4e00\u65e6\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\uff0c\u53cc\u65b9\u90fd\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\uff0c\u6b64\u65f6\u8fde\u63a5\u5c31\u5df2\u5efa\u7acb\u5b8c\u6210\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5c31\u53ef\u4ee5\u76f8\u4e92\u53d1\u9001\u6570\u636e\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#linux-tcp","title":"\u5982\u4f55\u5728 Linux \u7cfb\u7edf\u4e2d\u67e5\u770b TCP \u72b6\u6001\uff1f","text":"<p>TCP \u7684\u8fde\u63a5\u72b6\u6001\u67e5\u770b\uff0c\u5728 Linux \u53ef\u4ee5\u901a\u8fc7 <code>netstat -napt</code> \u547d\u4ee4\u67e5\u770b\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_1","title":"\u4e3a\u4ec0\u4e48\u662f\u4e09\u6b21\u63e1\u624b\uff1f\u4e0d\u662f\u4e24\u6b21\u3001\u56db\u6b21\uff1f","text":"<p>\u76f8\u4fe1\u5927\u5bb6\u6bd4\u8f83\u5e38\u56de\u7b54\u7684\u662f\uff1a\u201c\u56e0\u4e3a\u4e09\u6b21\u63e1\u624b\u624d\u80fd\u4fdd\u8bc1\u53cc\u65b9\u5177\u6709\u63a5\u6536\u548c\u53d1\u9001\u7684\u80fd\u529b\u3002\u201d</p> <p>\u8fd9\u56de\u7b54\u662f\u6ca1\u95ee\u9898\uff0c\u4f46\u8fd9\u56de\u7b54\u662f\u7247\u9762\u7684\uff0c\u5e76\u6ca1\u6709\u8bf4\u51fa\u4e3b\u8981\u7684\u539f\u56e0\u3002</p> <p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\u4ec0\u4e48\u662f TCP \u8fde\u63a5\uff1a</p> <ul> <li>\u7528\u4e8e\u4fdd\u8bc1\u53ef\u9760\u6027\u548c\u6d41\u91cf\u63a7\u5236\u7ef4\u62a4\u7684\u67d0\u4e9b\u72b6\u6001\u4fe1\u606f\uff0c\u8fd9\u4e9b\u4fe1\u606f\u7684\u7ec4\u5408\uff0c\u5305\u62ec Socket\u3001\u5e8f\u5217\u53f7\u548c\u7a97\u53e3\u5927\u5c0f\u79f0\u4e3a\u8fde\u63a5\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u91cd\u8981\u7684\u662f\u4e3a\u4ec0\u4e48\u4e09\u6b21\u63e1\u624b\u624d\u53ef\u4ee5\u521d\u59cb\u5316 Socket\u3001\u5e8f\u5217\u53f7\u548c\u7a97\u53e3\u5927\u5c0f\u5e76\u5efa\u7acb TCP \u8fde\u63a5\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u4ee5\u4e09\u4e2a\u65b9\u9762\u5206\u6790\u4e09\u6b21\u63e1\u624b\u7684\u539f\u56e0\uff1a</p> <ul> <li>\u4e09\u6b21\u63e1\u624b\u624d\u53ef\u4ee5\u963b\u6b62\u91cd\u590d\u5386\u53f2\u8fde\u63a5\u7684\u521d\u59cb\u5316\uff08\u4e3b\u8981\u539f\u56e0\uff09</li> <li>\u4e09\u6b21\u63e1\u624b\u624d\u53ef\u4ee5\u540c\u6b65\u53cc\u65b9\u7684\u521d\u59cb\u5e8f\u5217\u53f7</li> <li>\u4e09\u6b21\u63e1\u624b\u624d\u53ef\u4ee5\u907f\u514d\u8d44\u6e90\u6d6a\u8d39</li> </ul> <p>\u539f\u56e0\u4e00\uff1a\u907f\u514d\u5386\u53f2\u8fde\u63a5</p> <p>\u6211\u4eec\u6765\u770b\u770b RFC 793 \u6307\u51fa\u7684 TCP \u8fde\u63a5\u4f7f\u7528\u4e09\u6b21\u63e1\u624b\u7684\u9996\u8981\u539f\u56e0\uff1a</p> <p>The principle reason for the three-way handshake is to prevent old duplicate connection initiations from causing confusion.</p> <p>\u7b80\u5355\u6765\u8bf4\uff0c\u4e09\u6b21\u63e1\u624b\u7684\u9996\u8981\u539f\u56e0\u662f\u4e3a\u4e86\u9632\u6b62\u65e7\u7684\u91cd\u590d\u8fde\u63a5\u521d\u59cb\u5316\u9020\u6210\u6df7\u4e71\u3002</p> <p>\u6211\u4eec\u8003\u8651\u4e00\u4e2a\u573a\u666f\uff0c\u5ba2\u6237\u7aef\u5148\u53d1\u9001\u4e86 SYN\uff08seq = 90\uff09\u62a5\u6587\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u5b95\u673a\u4e86\uff0c\u800c\u4e14\u8fd9\u4e2a SYN \u62a5\u6587\u8fd8\u88ab\u7f51\u7edc\u963b\u585e\u4e86\uff0c\u670d\u52a1\u7aef\u5e76\u6ca1\u6709\u6536\u5230\uff0c\u63a5\u7740\u5ba2\u6237\u7aef\u91cd\u542f\u540e\uff0c\u53c8\u91cd\u65b0\u5411\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\uff0c\u53d1\u9001\u4e86 SYN\uff08seq = 100\uff09\u62a5\u6587\uff08\u6ce8\u610f\uff01\u4e0d\u662f\u91cd\u4f20 SYN\uff0c\u91cd\u4f20\u7684 SYN \u7684\u5e8f\u5217\u53f7\u662f\u4e00\u6837\u7684\uff09\u3002</p> <p>\u770b\u770b\u4e09\u6b21\u63e1\u624b\u662f\u5982\u4f55\u963b\u6b62\u5386\u53f2\u8fde\u63a5\u7684\uff1a</p> <p></p> <p>\u5ba2\u6237\u7aef\u8fde\u7eed\u53d1\u9001\u591a\u6b21 SYN\uff08\u90fd\u662f\u540c\u4e00\u4e2a\u56db\u5143\u7ec4\uff09\u5efa\u7acb\u8fde\u63a5\u7684\u62a5\u6587\uff0c\u5728\u7f51\u7edc\u62e5\u5835\u60c5\u51b5\u4e0b\uff1a</p> <ul> <li>\u4e00\u4e2a\u300c\u65e7 SYN \u62a5\u6587\u300d\u6bd4\u300c\u6700\u65b0\u7684 SYN\u300d\u62a5\u6587\u65e9\u5230\u8fbe\u4e86\u670d\u52a1\u7aef\uff0c\u90a3\u4e48\u6b64\u65f6\u670d\u52a1\u7aef\u5c31\u4f1a\u56de\u4e00\u4e2a <code>SYN + ACK</code> \u62a5\u6587\u7ed9\u5ba2\u6237\u7aef\uff0c\u6b64\u62a5\u6587\u4e2d\u7684\u786e\u8ba4\u53f7\u662f 91\uff0890+1\uff09\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u540e\uff0c\u53d1\u73b0\u81ea\u5df1\u671f\u671b\u6536\u5230\u7684\u786e\u8ba4\u53f7\u5e94\u8be5\u662f 100 + 1\uff0c\u800c\u4e0d\u662f 90 + 1\uff0c\u4e8e\u662f\u5c31\u4f1a\u56de RST \u62a5\u6587\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230 RST \u62a5\u6587\u540e\uff0c\u5c31\u4f1a\u91ca\u653e\u8fde\u63a5\u3002</li> <li>\u540e\u7eed\u6700\u65b0\u7684 SYN \u62b5\u8fbe\u4e86\u670d\u52a1\u7aef\u540e\uff0c\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u5c31\u53ef\u4ee5\u6b63\u5e38\u7684\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\u4e86\u3002</li> </ul> <p>\u4e0a\u8ff0\u4e2d\u7684\u300c\u65e7 SYN \u62a5\u6587\u300d\u79f0\u4e3a\u5386\u53f2\u8fde\u63a5\uff0cTCP \u4f7f\u7528\u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\u7684\u6700\u4e3b\u8981\u539f\u56e0\u5c31\u662f\u9632\u6b62\u300c\u5386\u53f2\u8fde\u63a5\u300d\u521d\u59cb\u5316\u4e86\u8fde\u63a5\u3002</p> <p>::: tip</p> <p>\u6709\u5f88\u591a\u4eba\u95ee\uff0c\u5982\u679c\u670d\u52a1\u7aef\u5728\u6536\u5230 RST \u62a5\u6587\u4e4b\u524d\uff0c\u5148\u6536\u5230\u4e86\u300c\u65b0 SYN \u62a5\u6587\u300d\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u62a5\u6587\u7684\u987a\u5e8f\u662f\uff1a\u300c\u65e7 SYN \u62a5\u6587\u300d-&gt;\u300c\u65b0 SYN \u62a5\u6587\u300d\uff0c\u6b64\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</p> <p>\u5f53\u670d\u52a1\u7aef\u7b2c\u4e00\u6b21\u6536\u5230 SYN \u62a5\u6587\uff0c\u4e5f\u5c31\u662f\u6536\u5230\u300c\u65e7 SYN \u62a5\u6587\u300d\u65f6\uff0c\u5c31\u4f1a\u56de\u590d <code>SYN + ACK</code> \u62a5\u6587\u7ed9\u5ba2\u6237\u7aef\uff0c\u6b64\u62a5\u6587\u4e2d\u7684\u786e\u8ba4\u53f7\u662f 91\uff0890+1\uff09\u3002</p> <p>\u7136\u540e\u8fd9\u65f6\u518d\u6536\u5230\u300c\u65b0 SYN \u62a5\u6587\u300d\u65f6\uff0c\u5c31\u4f1a\u56de Challenge Ack \u62a5\u6587\u7ed9\u5ba2\u6237\u7aef\uff0c\u8fd9\u4e2a ack \u62a5\u6587\u5e76\u4e0d\u662f\u786e\u8ba4\u6536\u5230\u300c\u65b0 SYN \u62a5\u6587\u300d\u7684\uff0c\u800c\u662f\u4e0a\u4e00\u6b21\u7684 ack \u786e\u8ba4\u53f7\uff0c\u4e5f\u5c31\u662f 91\uff0890+1\uff09\u3002\u6240\u4ee5\u5ba2\u6237\u7aef\u6536\u5230\u6b64 ACK \u62a5\u6587\u65f6\uff0c\u53d1\u73b0\u81ea\u5df1\u671f\u671b\u6536\u5230\u7684\u786e\u8ba4\u53f7\u5e94\u8be5\u662f 101\uff0c\u800c\u4e0d\u662f 91\uff0c\u4e8e\u662f\u5c31\u4f1a\u56de RST \u62a5\u6587\u3002</p> <p>:::</p> <p>\u5982\u679c\u662f\u4e24\u6b21\u63e1\u624b\u8fde\u63a5\uff0c\u5c31\u65e0\u6cd5\u963b\u6b62\u5386\u53f2\u8fde\u63a5\uff0c\u90a3\u4e3a\u4ec0\u4e48 TCP \u4e24\u6b21\u63e1\u624b\u4e3a\u4ec0\u4e48\u65e0\u6cd5\u963b\u6b62\u5386\u53f2\u8fde\u63a5\u5462\uff1f</p> <p>\u6211\u5148\u76f4\u63a5\u8bf4\u7ed3\u8bba\uff0c\u4e3b\u8981\u662f\u56e0\u4e3a\u5728\u4e24\u6b21\u63e1\u624b\u7684\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u7aef\u6ca1\u6709\u4e2d\u95f4\u72b6\u6001\u7ed9\u5ba2\u6237\u7aef\u6765\u963b\u6b62\u5386\u53f2\u8fde\u63a5\uff0c\u5bfc\u81f4\u670d\u52a1\u7aef\u53ef\u80fd\u5efa\u7acb\u4e00\u4e2a\u5386\u53f2\u8fde\u63a5\uff0c\u9020\u6210\u8d44\u6e90\u6d6a\u8d39\u3002</p> <p>\u4f60\u60f3\u60f3\uff0c\u5728\u4e24\u6b21\u63e1\u624b\u7684\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u7aef\u5728\u6536\u5230 SYN \u62a5\u6587\u540e\uff0c\u5c31\u8fdb\u5165 ESTABLISHED \u72b6\u6001\uff0c\u610f\u5473\u7740\u8fd9\u65f6\u53ef\u4ee5\u7ed9\u5bf9\u65b9\u53d1\u9001\u6570\u636e\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u6b64\u65f6\u8fd8\u6ca1\u6709\u8fdb\u5165 ESTABLISHED \u72b6\u6001\uff0c\u5047\u8bbe\u8fd9\u6b21\u662f\u5386\u53f2\u8fde\u63a5\uff0c\u5ba2\u6237\u7aef\u5224\u65ad\u5230\u6b64\u6b21\u8fde\u63a5\u4e3a\u5386\u53f2\u8fde\u63a5\uff0c\u90a3\u4e48\u5c31\u4f1a\u56de RST \u62a5\u6587\u6765\u65ad\u5f00\u8fde\u63a5\uff0c\u800c\u670d\u52a1\u7aef\u5728\u7b2c\u4e00\u6b21\u63e1\u624b\u7684\u65f6\u5019\u5c31\u8fdb\u5165 ESTABLISHED \u72b6\u6001\uff0c\u6240\u4ee5\u5b83\u53ef\u4ee5\u53d1\u9001\u6570\u636e\u7684\uff0c\u4f46\u662f\u5b83\u5e76\u4e0d\u77e5\u9053\u8fd9\u4e2a\u662f\u5386\u53f2\u8fde\u63a5\uff0c\u5b83\u53ea\u6709\u5728\u6536\u5230 RST \u62a5\u6587\u540e\uff0c\u624d\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c\u91c7\u7528\u4e24\u6b21\u63e1\u624b\u5efa\u7acb TCP \u8fde\u63a5\u7684\u573a\u666f\u4e0b\uff0c\u670d\u52a1\u7aef\u5728\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\u524d\uff0c\u5e76\u6ca1\u6709\u963b\u6b62\u6389\u5386\u53f2\u8fde\u63a5\uff0c\u5bfc\u81f4\u670d\u52a1\u7aef\u5efa\u7acb\u4e86\u4e00\u4e2a\u5386\u53f2\u8fde\u63a5\uff0c\u53c8\u767d\u767d\u53d1\u9001\u4e86\u6570\u636e\uff0c\u59a5\u59a5\u5730\u6d6a\u8d39\u4e86\u670d\u52a1\u7aef\u7684\u8d44\u6e90\u3002</p> <p>\u56e0\u6b64\uff0c\u8981\u89e3\u51b3\u8fd9\u79cd\u73b0\u8c61\uff0c\u6700\u597d\u5c31\u662f\u5728\u670d\u52a1\u7aef\u53d1\u9001\u6570\u636e\u524d\uff0c\u4e5f\u5c31\u662f\u5efa\u7acb\u8fde\u63a5\u4e4b\u524d\uff0c\u8981\u963b\u6b62\u6389\u5386\u53f2\u8fde\u63a5\uff0c\u8fd9\u6837\u5c31\u4e0d\u4f1a\u9020\u6210\u8d44\u6e90\u6d6a\u8d39\uff0c\u800c\u8981\u5b9e\u73b0\u8fd9\u4e2a\u529f\u80fd\uff0c\u5c31\u9700\u8981\u4e09\u6b21\u63e1\u624b\u3002</p> <p>\u6240\u4ee5\uff0cTCP \u4f7f\u7528\u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\u7684\u6700\u4e3b\u8981\u539f\u56e0\u662f\u9632\u6b62\u300c\u5386\u53f2\u8fde\u63a5\u300d\u521d\u59cb\u5316\u4e86\u8fde\u63a5\u3002</p> <p>::: tip</p> <p>\u6709\u4eba\u95ee\uff1a\u5ba2\u6237\u7aef\u53d1\u9001\u4e09\u6b21\u63e1\u624b\uff08ack \u62a5\u6587\uff09\u540e\u5c31\u53ef\u4ee5\u53d1\u9001\u6570\u636e\u4e86\uff0c\u800c\u88ab\u52a8\u65b9\u6b64\u65f6\u8fd8\u662f syn_received \u72b6\u6001\uff0c\u5982\u679c ack \u4e22\u4e86\uff0c\u90a3\u5ba2\u6237\u7aef\u53d1\u7684\u6570\u636e\u662f\u4e0d\u662f\u4e5f\u767d\u767d\u6d6a\u8d39\u4e86\uff1f</p> <p>\u4e0d\u662f\u7684\uff0c\u5373\u4f7f\u670d\u52a1\u7aef\u8fd8\u662f\u5728 syn_received \u72b6\u6001\uff0c\u6536\u5230\u4e86\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6570\u636e\uff0c\u8fd8\u662f\u53ef\u4ee5\u5efa\u7acb\u8fde\u63a5\u7684\uff0c\u5e76\u4e14\u8fd8\u53ef\u4ee5\u6b63\u5e38\u6536\u5230\u8fd9\u4e2a\u6570\u636e\u5305\u3002\u8fd9\u662f\u56e0\u4e3a\u6570\u636e\u62a5\u6587\u4e2d\u662f\u6709 ack \u6807\u8bc6\u4f4d\uff0c\u4e5f\u6709\u786e\u8ba4\u53f7\uff0c\u8fd9\u4e2a\u786e\u8ba4\u53f7\u5c31\u662f\u786e\u8ba4\u6536\u5230\u4e86\u7b2c\u4e8c\u6b21\u63e1\u624b\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u670d\u52a1\u7aef\u6536\u5230\u8fd9\u4e2a\u6570\u636e\u62a5\u6587\uff0c\u662f\u53ef\u4ee5\u6b63\u5e38\u5efa\u7acb\u8fde\u63a5\u7684\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u63a5\u6536\u8fd9\u4e2a\u6570\u636e\u5305\u4e86\u3002</p> <p>:::</p> <p>\u539f\u56e0\u4e8c\uff1a\u540c\u6b65\u53cc\u65b9\u521d\u59cb\u5e8f\u5217\u53f7</p> <p>TCP \u534f\u8bae\u7684\u901a\u4fe1\u53cc\u65b9\uff0c\u90fd\u5fc5\u987b\u7ef4\u62a4\u4e00\u4e2a\u300c\u5e8f\u5217\u53f7\u300d\uff0c\u5e8f\u5217\u53f7\u662f\u53ef\u9760\u4f20\u8f93\u7684\u4e00\u4e2a\u5173\u952e\u56e0\u7d20\uff0c\u5b83\u7684\u4f5c\u7528\uff1a  </p> <ul> <li>\u63a5\u6536\u65b9\u53ef\u4ee5\u53bb\u9664\u91cd\u590d\u7684\u6570\u636e\uff1b</li> <li>\u63a5\u6536\u65b9\u53ef\u4ee5\u6839\u636e\u6570\u636e\u5305\u7684\u5e8f\u5217\u53f7\u6309\u5e8f\u63a5\u6536\uff1b</li> <li>\u53ef\u4ee5\u6807\u8bc6\u53d1\u9001\u51fa\u53bb\u7684\u6570\u636e\u5305\u4e2d\uff0c\u54ea\u4e9b\u662f\u5df2\u7ecf\u88ab\u5bf9\u65b9\u6536\u5230\u7684\uff08\u901a\u8fc7 ACK \u62a5\u6587\u4e2d\u7684\u5e8f\u5217\u53f7\u77e5\u9053\uff09\uff1b</li> </ul> <p>\u53ef\u89c1\uff0c\u5e8f\u5217\u53f7\u5728 TCP \u8fde\u63a5\u4e2d\u5360\u636e\u7740\u975e\u5e38\u91cd\u8981\u7684\u4f5c\u7528\uff0c\u6240\u4ee5\u5f53\u5ba2\u6237\u7aef\u53d1\u9001\u643a\u5e26\u300c\u521d\u59cb\u5e8f\u5217\u53f7\u300d\u7684 <code>SYN</code> \u62a5\u6587\u7684\u65f6\u5019\uff0c\u9700\u8981\u670d\u52a1\u7aef\u56de\u4e00\u4e2a <code>ACK</code> \u5e94\u7b54\u62a5\u6587\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\u5df2\u88ab\u670d\u52a1\u7aef\u6210\u529f\u63a5\u6536\uff0c\u90a3\u5f53\u670d\u52a1\u7aef\u53d1\u9001\u300c\u521d\u59cb\u5e8f\u5217\u53f7\u300d\u7ed9\u5ba2\u6237\u7aef\u7684\u65f6\u5019\uff0c\u4f9d\u7136\u4e5f\u8981\u5f97\u5230\u5ba2\u6237\u7aef\u7684\u5e94\u7b54\u56de\u5e94\uff0c\u8fd9\u6837\u4e00\u6765\u4e00\u56de\uff0c\u624d\u80fd\u786e\u4fdd\u53cc\u65b9\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u80fd\u88ab\u53ef\u9760\u7684\u540c\u6b65\u3002</p> <p></p> <p>\u56db\u6b21\u63e1\u624b\u5176\u5b9e\u4e5f\u80fd\u591f\u53ef\u9760\u7684\u540c\u6b65\u53cc\u65b9\u7684\u521d\u59cb\u5316\u5e8f\u53f7\uff0c\u4f46\u7531\u4e8e\u7b2c\u4e8c\u6b65\u548c\u7b2c\u4e09\u6b65\u53ef\u4ee5\u4f18\u5316\u6210\u4e00\u6b65\uff0c\u6240\u4ee5\u5c31\u6210\u4e86\u300c\u4e09\u6b21\u63e1\u624b\u300d\u3002</p> <p>\u800c\u4e24\u6b21\u63e1\u624b\u53ea\u4fdd\u8bc1\u4e86\u4e00\u65b9\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u80fd\u88ab\u5bf9\u65b9\u6210\u529f\u63a5\u6536\uff0c\u6ca1\u529e\u6cd5\u4fdd\u8bc1\u53cc\u65b9\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u90fd\u80fd\u88ab\u786e\u8ba4\u63a5\u6536\u3002</p> <p>\u539f\u56e0\u4e09\uff1a\u907f\u514d\u8d44\u6e90\u6d6a\u8d39</p> <p>\u5982\u679c\u53ea\u6709\u300c\u4e24\u6b21\u63e1\u624b\u300d\uff0c\u5f53\u5ba2\u6237\u7aef\u53d1\u51fa\u7684 <code>SYN</code> \u62a5\u6587\u5728\u7f51\u7edc\u4e2d\u963b\u585e\uff0c\u5ba2\u6237\u7aef\u6ca1\u6709\u63a5\u6536\u5230 <code>ACK</code> \u62a5\u6587\uff0c\u5c31\u4f1a\u91cd\u65b0\u53d1\u9001 <code>SYN</code>\u62a5\u6587\u3002\u7531\u4e8e\u6ca1\u6709\u7b2c\u4e09\u6b21\u63e1\u624b\uff0c\u670d\u52a1\u7aef\u4e0d\u6e05\u695a\u5ba2\u6237\u7aef\u662f\u5426\u6536\u5230\u4e86\u81ea\u5df1\u56de\u590d\u7684 <code>ACK</code> \u62a5\u6587\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u6bcf\u6536\u5230\u4e00\u4e2a <code>SYN</code> \u5c31\u53ea\u80fd\u5148\u4e3b\u52a8\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\uff0c\u8fd9\u4f1a\u9020\u6210\u4ec0\u4e48\u60c5\u51b5\u5462\uff1f</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u7684 <code>SYN</code> \u62a5\u6587\u5728\u7f51\u7edc\u4e2d\u963b\u585e\u4e86\uff0c\u91cd\u590d\u53d1\u9001\u591a\u6b21 <code>SYN</code> \u62a5\u6587\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u5728\u6536\u5230\u8bf7\u6c42\u540e\u5c31\u4f1a\u5efa\u7acb\u591a\u4e2a\u5197\u4f59\u7684\u65e0\u6548\u8fde\u63a5\uff0c\u9020\u6210\u4e0d\u5fc5\u8981\u7684\u8d44\u6e90\u6d6a\u8d39\u3002</p> <p></p> <p>\u5373\u4e24\u6b21\u63e1\u624b\u4f1a\u9020\u6210\u6d88\u606f\u6ede\u7559\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u7aef\u91cd\u590d\u63a5\u53d7\u65e0\u7528\u7684\u8fde\u63a5\u8bf7\u6c42 <code>SYN</code> \u62a5\u6587\uff0c\u800c\u9020\u6210\u91cd\u590d\u5206\u914d\u8d44\u6e90\u3002</p> <p>::: tip</p> <p>\u5f88\u591a\u4eba\u95ee\uff0c\u4e24\u6b21\u63e1\u624b\u4e0d\u662f\u4e5f\u53ef\u4ee5\u6839\u636e\u4e0a\u4e0b\u6587\u4fe1\u606f\u4e22\u5f03<code>SYN</code>\u5386\u53f2\u62a5\u6587\u5417\uff1f</p> <p>\u6211\u8fd9\u91cc\u4e24\u6b21\u63e1\u624b\u662f\u5047\u8bbe\u300c\u7531\u4e8e\u6ca1\u6709\u7b2c\u4e09\u6b21\u63e1\u624b\uff0c\u670d\u52a1\u7aef\u4e0d\u6e05\u695a\u5ba2\u6237\u7aef\u662f\u5426\u6536\u5230\u4e86\u81ea\u5df1\u53d1\u9001\u7684\u5efa\u7acb\u8fde\u63a5\u7684 <code>ACK</code> \u786e\u8ba4\u62a5\u6587\uff0c\u6240\u4ee5\u6bcf\u6536\u5230\u4e00\u4e2a <code>SYN</code> \u5c31\u53ea\u80fd\u5148\u4e3b\u52a8\u5efa\u7acb\u4e00\u4e2a\u8fde\u63a5\u300d\u8fd9\u4e2a\u573a\u666f\u3002</p> <p>\u5f53\u7136\u4f60\u8981\u5b9e\u73b0\u6210\u7c7b\u4f3c\u4e09\u6b21\u63e1\u624b\u90a3\u6837\uff0c\u6839\u636e\u4e0a\u4e0b\u6587\u4e22\u5f03 syn \u5386\u53f2\u62a5\u6587\u4e5f\u662f\u53ef\u4ee5\u7684\uff0c\u4e24\u6b21\u63e1\u624b\u6ca1\u6709\u5177\u4f53\u7684\u5b9e\u73b0\uff0c\u600e\u4e48\u5047\u8bbe\u90fd\u884c\u3002</p> <p>:::</p> <p>\u5c0f\u7ed3</p> <p>TCP \u5efa\u7acb\u8fde\u63a5\u65f6\uff0c\u901a\u8fc7\u4e09\u6b21\u63e1\u624b\u80fd\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u7684\u5efa\u7acb\uff0c\u80fd\u51cf\u5c11\u53cc\u65b9\u4e0d\u5fc5\u8981\u7684\u8d44\u6e90\u5f00\u9500\uff0c\u80fd\u5e2e\u52a9\u53cc\u65b9\u540c\u6b65\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u3002\u5e8f\u5217\u53f7\u80fd\u591f\u4fdd\u8bc1\u6570\u636e\u5305\u4e0d\u91cd\u590d\u3001\u4e0d\u4e22\u5f03\u548c\u6309\u5e8f\u4f20\u8f93\u3002</p> <p>\u4e0d\u4f7f\u7528\u300c\u4e24\u6b21\u63e1\u624b\u300d\u548c\u300c\u56db\u6b21\u63e1\u624b\u300d\u7684\u539f\u56e0\uff1a</p> <ul> <li>\u300c\u4e24\u6b21\u63e1\u624b\u300d\uff1a\u65e0\u6cd5\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u7684\u5efa\u7acb\uff0c\u4f1a\u9020\u6210\u53cc\u65b9\u8d44\u6e90\u7684\u6d6a\u8d39\uff0c\u4e5f\u65e0\u6cd5\u53ef\u9760\u7684\u540c\u6b65\u53cc\u65b9\u5e8f\u5217\u53f7\uff1b</li> <li>\u300c\u56db\u6b21\u63e1\u624b\u300d\uff1a\u4e09\u6b21\u63e1\u624b\u5c31\u5df2\u7ecf\u7406\u8bba\u4e0a\u6700\u5c11\u53ef\u9760\u8fde\u63a5\u5efa\u7acb\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u4f7f\u7528\u66f4\u591a\u7684\u901a\u4fe1\u6b21\u6570\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp_7","title":"\u4e3a\u4ec0\u4e48\u6bcf\u6b21\u5efa\u7acb TCP \u8fde\u63a5\u65f6\uff0c\u521d\u59cb\u5316\u7684\u5e8f\u5217\u53f7\u90fd\u8981\u6c42\u4e0d\u4e00\u6837\u5462\uff1f","text":"<p>\u4e3b\u8981\u539f\u56e0\u6709\u4e24\u4e2a\u65b9\u9762\uff1a</p> <ul> <li>\u4e3a\u4e86\u9632\u6b62\u5386\u53f2\u62a5\u6587\u88ab\u4e0b\u4e00\u4e2a\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u63a5\u6536\uff08\u4e3b\u8981\u65b9\u9762\uff09\uff1b</li> <li>\u4e3a\u4e86\u5b89\u5168\u6027\uff0c\u9632\u6b62\u9ed1\u5ba2\u4f2a\u9020\u7684\u76f8\u540c\u5e8f\u5217\u53f7\u7684 TCP \u62a5\u6587\u88ab\u5bf9\u65b9\u63a5\u6536\uff1b</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u8be6\u7ec6\u8bf4\u8bf4\u7b2c\u4e00\u70b9\u3002</p> <p>\u5047\u8bbe\u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u662f\u4ece 0 \u5f00\u59cb\uff1a</p> <p></p> <p>\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5efa\u7acb\u4e00\u4e2a TCP \u8fde\u63a5\uff0c\u5728\u5ba2\u6237\u7aef\u53d1\u9001\u6570\u636e\u5305\u88ab\u7f51\u7edc\u963b\u585e\u4e86\uff0c\u7136\u540e\u8d85\u65f6\u91cd\u4f20\u4e86\u8fd9\u4e2a\u6570\u636e\u5305\uff0c\u800c\u6b64\u65f6\u670d\u52a1\u7aef\u8bbe\u5907\u65ad\u7535\u91cd\u542f\u4e86\uff0c\u4e4b\u524d\u4e0e\u5ba2\u6237\u7aef\u5efa\u7acb\u7684\u8fde\u63a5\u5c31\u6d88\u5931\u4e86\uff0c\u4e8e\u662f\u5728\u6536\u5230\u5ba2\u6237\u7aef\u7684\u6570\u636e\u5305\u7684\u65f6\u5019\u5c31\u4f1a\u53d1\u9001 RST \u62a5\u6587\u3002</li> <li>\u7d27\u63a5\u7740\uff0c\u5ba2\u6237\u7aef\u53c8\u4e0e\u670d\u52a1\u7aef\u5efa\u7acb\u4e86\u4e0e\u4e0a\u4e00\u4e2a\u8fde\u63a5\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\uff1b</li> <li>\u5728\u65b0\u8fde\u63a5\u5efa\u7acb\u5b8c\u6210\u540e\uff0c\u4e0a\u4e00\u4e2a\u8fde\u63a5\u4e2d\u88ab\u7f51\u7edc\u963b\u585e\u7684\u6570\u636e\u5305\u6b63\u597d\u62b5\u8fbe\u4e86\u670d\u52a1\u7aef\uff0c\u521a\u597d\u8be5\u6570\u636e\u5305\u7684\u5e8f\u5217\u53f7\u6b63\u597d\u662f\u5728\u670d\u52a1\u7aef\u7684\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u6240\u4ee5\u8be5\u6570\u636e\u5305\u4f1a\u88ab\u670d\u52a1\u7aef\u6b63\u5e38\u63a5\u6536\uff0c\u5c31\u4f1a\u9020\u6210\u6570\u636e\u9519\u4e71\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5982\u679c\u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u662f\u4e00\u6837\u7684\u8bdd\uff0c\u5f88\u5bb9\u6613\u51fa\u73b0\u5386\u53f2\u62a5\u6587\u88ab\u4e0b\u4e00\u4e2a\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u63a5\u6536\u7684\u95ee\u9898\u3002</p> <p>\u5982\u679c\u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u300c\u4e0d\u4e00\u6837\u300d\uff0c\u5c31\u6709\u5927\u6982\u7387\u56e0\u4e3a\u5386\u53f2\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u300c\u4e0d\u5728\u300d\u5bf9\u65b9\u63a5\u6536\u7a97\u53e3\uff0c\u4ece\u800c\u5f88\u5927\u7a0b\u5ea6\u4e0a\u907f\u514d\u4e86\u5386\u53f2\u62a5\u6587\uff0c\u6bd4\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u76f8\u53cd\uff0c\u5982\u679c\u6bcf\u6b21\u5efa\u7acb\u8fde\u63a5\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u90fd\u300c\u4e00\u6837\u300d\uff0c\u5c31\u6709\u5927\u6982\u7387\u9047\u5230\u5386\u53f2\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u521a\u300c\u597d\u5728\u300d\u5bf9\u65b9\u7684\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u4ece\u800c\u5bfc\u81f4\u5386\u53f2\u62a5\u6587\u88ab\u65b0\u8fde\u63a5\u6210\u529f\u63a5\u6536\u3002</p> <p>\u6240\u4ee5\uff0c\u6bcf\u6b21\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u4e0d\u4e00\u6837\u5f88\u5927\u7a0b\u5ea6\u4e0a\u80fd\u591f\u907f\u514d\u5386\u53f2\u62a5\u6587\u88ab\u4e0b\u4e00\u4e2a\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u63a5\u6536\uff0c\u6ce8\u610f\u662f\u5f88\u5927\u7a0b\u5ea6\u4e0a\uff0c\u5e76\u4e0d\u662f\u5b8c\u5168\u907f\u514d\u4e86\uff08\u56e0\u4e3a\u5e8f\u5217\u53f7\u4f1a\u6709\u56de\u7ed5\u7684\u95ee\u9898\uff0c\u6240\u4ee5\u9700\u8981\u7528\u65f6\u95f4\u6233\u7684\u673a\u5236\u6765\u5224\u65ad\u5386\u53f2\u62a5\u6587\uff0c\u8be6\u7ec6\u770b\u7bc7\uff1aTCP \u662f\u5982\u4f55\u907f\u514d\u5386\u53f2\u62a5\u6587\u7684\uff1f\uff09\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#isn","title":"\u521d\u59cb\u5e8f\u5217\u53f7 ISN \u662f\u5982\u4f55\u968f\u673a\u4ea7\u751f\u7684\uff1f","text":"<p>\u8d77\u59cb <code>ISN</code> \u662f\u57fa\u4e8e\u65f6\u949f\u7684\uff0c\u6bcf 4 \u5fae\u79d2 + 1\uff0c\u8f6c\u4e00\u5708\u8981 4.55 \u4e2a\u5c0f\u65f6\u3002</p> <p>RFC793 \u63d0\u5230\u521d\u59cb\u5316\u5e8f\u5217\u53f7 ISN \u968f\u673a\u751f\u6210\u7b97\u6cd5\uff1aISN = M + F(localhost, localport, remotehost, remoteport)\u3002</p> <ul> <li><code>M</code> \u662f\u4e00\u4e2a\u8ba1\u65f6\u5668\uff0c\u8fd9\u4e2a\u8ba1\u65f6\u5668\u6bcf\u9694 4 \u5fae\u79d2\u52a0 1\u3002</li> <li><code>F</code> \u662f\u4e00\u4e2a Hash \u7b97\u6cd5\uff0c\u6839\u636e\u6e90 IP\u3001\u76ee\u7684 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684\u7aef\u53e3\u751f\u6210\u4e00\u4e2a\u968f\u673a\u6570\u503c\u3002\u8981\u4fdd\u8bc1 Hash \u7b97\u6cd5\u4e0d\u80fd\u88ab\u5916\u90e8\u8f7b\u6613\u63a8\u7b97\u5f97\u51fa\uff0c\u7528 MD5 \u7b97\u6cd5\u662f\u4e00\u4e2a\u6bd4\u8f83\u597d\u7684\u9009\u62e9\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u968f\u673a\u6570\u662f\u4f1a\u57fa\u4e8e\u65f6\u949f\u8ba1\u65f6\u5668\u9012\u589e\u7684\uff0c\u57fa\u672c\u4e0d\u53ef\u80fd\u4f1a\u968f\u673a\u6210\u4e00\u6837\u7684\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#ip-tcp-mss","title":"\u65e2\u7136 IP \u5c42\u4f1a\u5206\u7247\uff0c\u4e3a\u4ec0\u4e48 TCP \u5c42\u8fd8\u9700\u8981 MSS \u5462\uff1f","text":"<p>\u6211\u4eec\u5148\u6765\u8ba4\u8bc6\u4e0b MTU \u548c MSS</p> <p></p> <ul> <li><code>MTU</code>\uff1a\u4e00\u4e2a\u7f51\u7edc\u5305\u7684\u6700\u5927\u957f\u5ea6\uff0c\u4ee5\u592a\u7f51\u4e2d\u4e00\u822c\u4e3a <code>1500</code> \u5b57\u8282\uff1b</li> <li><code>MSS</code>\uff1a\u9664\u53bb IP \u548c TCP \u5934\u90e8\u4e4b\u540e\uff0c\u4e00\u4e2a\u7f51\u7edc\u5305\u6240\u80fd\u5bb9\u7eb3\u7684 TCP \u6570\u636e\u7684\u6700\u5927\u957f\u5ea6\uff1b</li> </ul> <p>\u5982\u679c\u5728 TCP \u7684\u6574\u4e2a\u62a5\u6587\uff08\u5934\u90e8 + \u6570\u636e\uff09\u4ea4\u7ed9 IP \u5c42\u8fdb\u884c\u5206\u7247\uff0c\u4f1a\u6709\u4ec0\u4e48\u5f02\u5e38\u5462\uff1f</p> <p>\u5f53 IP \u5c42\u6709\u4e00\u4e2a\u8d85\u8fc7 <code>MTU</code> \u5927\u5c0f\u7684\u6570\u636e\uff08TCP \u5934\u90e8 + TCP \u6570\u636e\uff09\u8981\u53d1\u9001\uff0c\u90a3\u4e48 IP \u5c42\u5c31\u8981\u8fdb\u884c\u5206\u7247\uff0c\u628a\u6570\u636e\u5206\u7247\u6210\u82e5\u5e72\u7247\uff0c\u4fdd\u8bc1\u6bcf\u4e00\u4e2a\u5206\u7247\u90fd\u5c0f\u4e8e MTU\u3002\u628a\u4e00\u4efd IP \u6570\u636e\u62a5\u8fdb\u884c\u5206\u7247\u4ee5\u540e\uff0c\u7531\u76ee\u6807\u4e3b\u673a\u7684 IP \u5c42\u6765\u8fdb\u884c\u91cd\u65b0\u7ec4\u88c5\u540e\uff0c\u518d\u4ea4\u7ed9\u4e0a\u4e00\u5c42 TCP \u4f20\u8f93\u5c42\u3002</p> <p>\u8fd9\u770b\u8d77\u6765\u4e95\u7136\u6709\u5e8f\uff0c\u4f46\u8fd9\u5b58\u5728\u9690\u60a3\u7684\uff0c\u90a3\u4e48\u5f53\u5982\u679c\u4e00\u4e2a IP \u5206\u7247\u4e22\u5931\uff0c\u6574\u4e2a IP \u62a5\u6587\u7684\u6240\u6709\u5206\u7247\u90fd\u5f97\u91cd\u4f20\u3002</p> <p>\u56e0\u4e3a IP \u5c42\u672c\u8eab\u6ca1\u6709\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u5b83\u7531\u4f20\u8f93\u5c42\u7684 TCP \u6765\u8d1f\u8d23\u8d85\u65f6\u548c\u91cd\u4f20\u3002</p> <p>\u5f53\u67d0\u4e00\u4e2a IP \u5206\u7247\u4e22\u5931\u540e\uff0c\u63a5\u6536\u65b9\u7684 IP \u5c42\u5c31\u65e0\u6cd5\u7ec4\u88c5\u6210\u4e00\u4e2a\u5b8c\u6574\u7684 TCP \u62a5\u6587\uff08\u5934\u90e8 + \u6570\u636e\uff09\uff0c\u4e5f\u5c31\u65e0\u6cd5\u5c06\u6570\u636e\u62a5\u6587\u9001\u5230 TCP \u5c42\uff0c\u6240\u4ee5\u63a5\u6536\u65b9\u4e0d\u4f1a\u54cd\u5e94 ACK \u7ed9\u53d1\u9001\u65b9\uff0c\u56e0\u4e3a\u53d1\u9001\u65b9\u8fdf\u8fdf\u6536\u4e0d\u5230 ACK \u786e\u8ba4\u62a5\u6587\uff0c\u6240\u4ee5\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\uff0c\u5c31\u4f1a\u91cd\u53d1\u300c\u6574\u4e2a TCP \u62a5\u6587\uff08\u5934\u90e8 + \u6570\u636e\uff09\u300d\u3002</p> <p>\u56e0\u6b64\uff0c\u53ef\u4ee5\u5f97\u77e5\u7531 IP \u5c42\u8fdb\u884c\u5206\u7247\u4f20\u8f93\uff0c\u662f\u975e\u5e38\u6ca1\u6709\u6548\u7387\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u8fbe\u5230\u6700\u4f73\u7684\u4f20\u8f93\u6548\u80fd TCP \u534f\u8bae\u5728\u5efa\u7acb\u8fde\u63a5\u7684\u65f6\u5019\u901a\u5e38\u8981\u534f\u5546\u53cc\u65b9\u7684 MSS \u503c\uff0c\u5f53 TCP \u5c42\u53d1\u73b0\u6570\u636e\u8d85\u8fc7 MSS \u65f6\uff0c\u5219\u5c31\u5148\u4f1a\u8fdb\u884c\u5206\u7247\uff0c\u5f53\u7136\u7531\u5b83\u5f62\u6210\u7684 IP \u5305\u7684\u957f\u5ea6\u4e5f\u5c31\u4e0d\u4f1a\u5927\u4e8e MTU\uff0c\u81ea\u7136\u4e5f\u5c31\u4e0d\u7528 IP \u5206\u7247\u4e86\u3002</p> <p></p> <p>\u7ecf\u8fc7 TCP \u5c42\u5206\u7247\u540e\uff0c\u5982\u679c\u4e00\u4e2a TCP \u5206\u7247\u4e22\u5931\u540e\uff0c\u8fdb\u884c\u91cd\u53d1\u65f6\u4e5f\u662f\u4ee5 MSS \u4e3a\u5355\u4f4d\uff0c\u800c\u4e0d\u7528\u91cd\u4f20\u6240\u6709\u7684\u5206\u7247\uff0c\u5927\u5927\u589e\u52a0\u4e86\u91cd\u4f20\u7684\u6548\u7387\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_2","title":"\u7b2c\u4e00\u6b21\u63e1\u624b\u4e22\u5931\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5f53\u5ba2\u6237\u7aef\u60f3\u548c\u670d\u52a1\u7aef\u5efa\u7acb TCP \u8fde\u63a5\u7684\u65f6\u5019\uff0c\u9996\u5148\u7b2c\u4e00\u4e2a\u53d1\u7684\u5c31\u662f SYN \u62a5\u6587\uff0c\u7136\u540e\u8fdb\u5165\u5230 <code>SYN_SENT</code> \u72b6\u6001\u3002</p> <p>\u5728\u8fd9\u4e4b\u540e\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u8fdf\u8fdf\u6536\u4e0d\u5230\u670d\u52a1\u7aef\u7684 SYN-ACK \u62a5\u6587\uff08\u7b2c\u4e8c\u6b21\u63e1\u624b\uff09\uff0c\u5c31\u4f1a\u89e6\u53d1\u300c\u8d85\u65f6\u91cd\u4f20\u300d\u673a\u5236\uff0c\u91cd\u4f20 SYN \u62a5\u6587\uff0c\u800c\u4e14\u91cd\u4f20\u7684 SYN \u62a5\u6587\u7684\u5e8f\u5217\u53f7\u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u4e0d\u540c\u7248\u672c\u7684\u64cd\u4f5c\u7cfb\u7edf\u53ef\u80fd\u8d85\u65f6\u65f6\u95f4\u4e0d\u540c\uff0c\u6709\u7684 1 \u79d2\u7684\uff0c\u4e5f\u6709 3 \u79d2\u7684\uff0c\u8fd9\u4e2a\u8d85\u65f6\u65f6\u95f4\u662f\u5199\u6b7b\u5728\u5185\u6838\u91cc\u7684\uff0c\u5982\u679c\u60f3\u8981\u66f4\u6539\u5219\u9700\u8981\u91cd\u65b0\u7f16\u8bd1\u5185\u6838\uff0c\u6bd4\u8f83\u9ebb\u70e6\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef\u5728 1 \u79d2\u540e\u6ca1\u6536\u5230\u670d\u52a1\u7aef\u7684 SYN-ACK \u62a5\u6587\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u91cd\u53d1 SYN \u62a5\u6587\uff0c\u90a3\u5230\u5e95\u91cd\u53d1\u51e0\u6b21\u5462\uff1f</p> <p>\u5728 Linux \u91cc\uff0c\u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\u6700\u5927\u91cd\u4f20\u6b21\u6570\u7531 <code>tcp_syn_retries</code>\u5185\u6838\u53c2\u6570\u63a7\u5236\uff0c\u8fd9\u4e2a\u53c2\u6570\u662f\u53ef\u4ee5\u81ea\u5b9a\u4e49\u7684\uff0c\u9ed8\u8ba4\u503c\u4e00\u822c\u662f 5\u3002</p> Bash<pre><code># cat /proc/sys/net/ipv4/tcp_syn_retries\n5\n</code></pre> <p>\u901a\u5e38\uff0c\u7b2c\u4e00\u6b21\u8d85\u65f6\u91cd\u4f20\u662f\u5728 1 \u79d2\u540e\uff0c\u7b2c\u4e8c\u6b21\u8d85\u65f6\u91cd\u4f20\u662f\u5728 2 \u79d2\uff0c\u7b2c\u4e09\u6b21\u8d85\u65f6\u91cd\u4f20\u662f\u5728 4 \u79d2\u540e\uff0c\u7b2c\u56db\u6b21\u8d85\u65f6\u91cd\u4f20\u662f\u5728 8 \u79d2\u540e\uff0c\u7b2c\u4e94\u6b21\u662f\u5728\u8d85\u65f6\u91cd\u4f20 16 \u79d2\u540e\u3002\u6ca1\u9519\uff0c\u6bcf\u6b21\u8d85\u65f6\u7684\u65f6\u95f4\u662f\u4e0a\u4e00\u6b21\u7684 2 \u500d\u3002</p> <p>\u5f53\u7b2c\u4e94\u6b21\u8d85\u65f6\u91cd\u4f20\u540e\uff0c\u4f1a\u7ee7\u7eed\u7b49\u5f85 32 \u79d2\uff0c\u5982\u679c\u670d\u52a1\u7aef\u4ecd\u7136\u6ca1\u6709\u56de\u5e94 ACK\uff0c\u5ba2\u6237\u7aef\u5c31\u4e0d\u518d\u53d1\u9001 SYN \u5305\uff0c\u7136\u540e\u65ad\u5f00 TCP \u8fde\u63a5\u3002</p> <p>\u6240\u4ee5\uff0c\u603b\u8017\u65f6\u662f 1+2+4+8+16+32=63 \u79d2\uff0c\u5927\u7ea6 1 \u5206\u949f\u5de6\u53f3\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe tcp_syn_retries \u53c2\u6570\u503c\u4e3a 3\uff0c\u90a3\u4e48\u5f53\u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\u4e00\u76f4\u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u65f6\uff0c\u4f1a\u53d1\u751f\u4e0b\u56fe\u7684\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u5ba2\u6237\u7aef\u8d85\u65f6\u91cd\u4f20 3 \u6b21 SYN \u62a5\u6587\u540e\uff0c\u7531\u4e8e  tcp_syn_retries \u4e3a 3\uff0c\u5df2\u8fbe\u5230\u6700\u5927\u91cd\u4f20\u6b21\u6570\uff0c\u4e8e\u662f\u518d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u65f6\u95f4\u4e3a\u4e0a\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u670d\u52a1\u7aef\u7684\u7b2c\u4e8c\u6b21\u63e1\u624b\uff08SYN-ACK \u62a5\u6587\uff09\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_3","title":"\u7b2c\u4e8c\u6b21\u63e1\u624b\u4e22\u5931\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5f53\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684\u7b2c\u4e00\u6b21\u63e1\u624b\u540e\uff0c\u5c31\u4f1a\u56de SYN-ACK \u62a5\u6587\u7ed9\u5ba2\u6237\u7aef\uff0c\u8fd9\u4e2a\u5c31\u662f\u7b2c\u4e8c\u6b21\u63e1\u624b\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u4f1a\u8fdb\u5165 <code>SYN_RCVD</code> \u72b6\u6001\u3002</p> <p>\u7b2c\u4e8c\u6b21\u63e1\u624b\u7684 <code>SYN-ACK</code> \u62a5\u6587\u5176\u5b9e\u6709\u4e24\u4e2a\u76ee\u7684\uff1a</p> <ul> <li>\u7b2c\u4e8c\u6b21\u63e1\u624b\u91cc\u7684 ACK\uff0c\u662f\u5bf9\u7b2c\u4e00\u6b21\u63e1\u624b\u7684\u786e\u8ba4\u62a5\u6587\uff1b</li> <li>\u7b2c\u4e8c\u6b21\u63e1\u624b\u91cc\u7684 SYN\uff0c\u662f\u670d\u52a1\u7aef\u53d1\u8d77\u5efa\u7acb TCP \u8fde\u63a5\u7684\u62a5\u6587\uff1b</li> </ul> <p>\u6240\u4ee5\uff0c\u5982\u679c\u7b2c\u4e8c\u6b21\u63e1\u624b\u4e22\u4e86\uff0c\u5c31\u4f1a\u53d1\u751f\u6bd4\u8f83\u6709\u610f\u601d\u7684\u4e8b\u60c5\uff0c\u5177\u4f53\u4f1a\u600e\u4e48\u6837\u5462\uff1f</p> <p>\u56e0\u4e3a\u7b2c\u4e8c\u6b21\u63e1\u624b\u62a5\u6587\u91cc\u662f\u5305\u542b\u5bf9\u5ba2\u6237\u7aef\u7684\u7b2c\u4e00\u6b21\u63e1\u624b\u7684 ACK \u786e\u8ba4\u62a5\u6587\uff0c\u6240\u4ee5\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u8fdf\u8fdf\u6ca1\u6709\u6536\u5230\u7b2c\u4e8c\u6b21\u63e1\u624b\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5c31\u89c9\u5f97\u53ef\u80fd\u81ea\u5df1\u7684 SYN \u62a5\u6587\uff08\u7b2c\u4e00\u6b21\u63e1\u624b\uff09\u4e22\u5931\u4e86\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u5c31\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u91cd\u4f20 SYN \u62a5\u6587\u3002</p> <p>\u7136\u540e\uff0c\u56e0\u4e3a\u7b2c\u4e8c\u6b21\u63e1\u624b\u4e2d\u5305\u542b\u670d\u52a1\u7aef\u7684 SYN \u62a5\u6587\uff0c\u6240\u4ee5\u5f53\u5ba2\u6237\u7aef\u6536\u5230\u540e\uff0c\u9700\u8981\u7ed9\u670d\u52a1\u7aef\u53d1\u9001 ACK \u786e\u8ba4\u62a5\u6587\uff08\u7b2c\u4e09\u6b21\u63e1\u624b\uff09\uff0c\u670d\u52a1\u7aef\u624d\u4f1a\u8ba4\u4e3a\u8be5 SYN \u62a5\u6587\u88ab\u5ba2\u6237\u7aef\u6536\u5230\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c\u5982\u679c\u7b2c\u4e8c\u6b21\u63e1\u624b\u4e22\u5931\u4e86\uff0c\u670d\u52a1\u7aef\u5c31\u6536\u4e0d\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\uff0c\u4e8e\u662f\u670d\u52a1\u7aef\u8fd9\u8fb9\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u91cd\u4f20 SYN-ACK \u62a5\u6587\u3002</p> <p>\u5728 Linux \u4e0b\uff0cSYN-ACK \u62a5\u6587\u7684\u6700\u5927\u91cd\u4f20\u6b21\u6570\u7531 <code>tcp_synack_retries</code>\u5185\u6838\u53c2\u6570\u51b3\u5b9a\uff0c\u9ed8\u8ba4\u503c\u662f 5\u3002</p> Bash<pre><code># cat /proc/sys/net/ipv4/tcp_synack_retries\n5\n</code></pre> <p>\u56e0\u6b64\uff0c\u5f53\u7b2c\u4e8c\u6b21\u63e1\u624b\u4e22\u5931\u4e86\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u4f1a\u91cd\u4f20\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u4f1a\u91cd\u4f20 SYN \u62a5\u6587\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u6b21\u63e1\u624b\uff0c\u6700\u5927\u91cd\u4f20\u6b21\u6570\u7531 <code>tcp_syn_retries</code>\u5185\u6838\u53c2\u6570\u51b3\u5b9a\uff1b</li> <li>\u670d\u52a1\u7aef\u4f1a\u91cd\u4f20 SYN-ACK \u62a5\u6587\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e8c\u6b21\u63e1\u624b\uff0c\u6700\u5927\u91cd\u4f20\u6b21\u6570\u7531 <code>tcp_synack_retries</code> \u5185\u6838\u53c2\u6570\u51b3\u5b9a\u3002</li> </ul> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe tcp_syn_retries  \u53c2\u6570\u503c\u4e3a 1\uff0ctcp_synack_retries \u53c2\u6570\u503c\u4e3a 2\uff0c\u90a3\u4e48\u5f53\u7b2c\u4e8c\u6b21\u63e1\u624b\u4e00\u76f4\u4e22\u5931\u65f6\uff0c\u53d1\u751f\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u5ba2\u6237\u7aef\u8d85\u65f6\u91cd\u4f20 1 \u6b21 SYN \u62a5\u6587\u540e\uff0c\u7531\u4e8e  tcp_syn_retries \u4e3a 1\uff0c\u5df2\u8fbe\u5230\u6700\u5927\u91cd\u4f20\u6b21\u6570\uff0c\u4e8e\u662f\u518d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u65f6\u95f4\u4e3a\u4e0a\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u670d\u52a1\u7aef\u7684\u7b2c\u4e8c\u6b21\u63e1\u624b\uff08SYN-ACK \u62a5\u6587\uff09\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> <li>\u5f53\u670d\u52a1\u7aef\u8d85\u65f6\u91cd\u4f20 2 \u6b21 SYN-ACK \u62a5\u6587\u540e\uff0c\u7531\u4e8e tcp_synack_retries \u4e3a 2\uff0c\u5df2\u8fbe\u5230\u6700\u5927\u91cd\u4f20\u6b21\u6570\uff0c\u4e8e\u662f\u518d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u65f6\u95f4\u4e3a\u4e0a\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u5ba2\u6237\u7aef\u7684\u7b2c\u4e09\u6b21\u63e1\u624b\uff08ACK \u62a5\u6587\uff09\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_4","title":"\u7b2c\u4e09\u6b21\u63e1\u624b\u4e22\u5931\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684 SYN-ACK \u62a5\u6587\u540e\uff0c\u5c31\u4f1a\u7ed9\u670d\u52a1\u7aef\u56de\u4e00\u4e2a ACK \u62a5\u6587\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e09\u6b21\u63e1\u624b\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u72b6\u6001\u8fdb\u5165\u5230 <code>ESTABLISH</code> \u72b6\u6001\u3002</p> <p>\u56e0\u4e3a\u8fd9\u4e2a\u7b2c\u4e09\u6b21\u63e1\u624b\u7684 ACK \u662f\u5bf9\u7b2c\u4e8c\u6b21\u63e1\u624b\u7684 SYN \u7684\u786e\u8ba4\u62a5\u6587\uff0c\u6240\u4ee5\u5f53\u7b2c\u4e09\u6b21\u63e1\u624b\u4e22\u5931\u4e86\uff0c\u5982\u679c\u670d\u52a1\u7aef\u90a3\u4e00\u65b9\u8fdf\u8fdf\u6536\u4e0d\u5230\u8fd9\u4e2a\u786e\u8ba4\u62a5\u6587\uff0c\u5c31\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u91cd\u4f20 SYN-ACK \u62a5\u6587\uff0c\u76f4\u5230\u6536\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\uff0c\u6216\u8005\u8fbe\u5230\u6700\u5927\u91cd\u4f20\u6b21\u6570\u3002</p> <p>\u6ce8\u610f\uff0cACK \u62a5\u6587\u662f\u4e0d\u4f1a\u6709\u91cd\u4f20\u7684\uff0c\u5f53 ACK \u4e22\u5931\u4e86\uff0c\u5c31\u7531\u5bf9\u65b9\u91cd\u4f20\u5bf9\u5e94\u7684\u62a5\u6587\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe tcp_synack_retries \u53c2\u6570\u503c\u4e3a 2\uff0c\u90a3\u4e48\u5f53\u7b2c\u4e09\u6b21\u63e1\u624b\u4e00\u76f4\u4e22\u5931\u65f6\uff0c\u53d1\u751f\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u670d\u52a1\u7aef\u8d85\u65f6\u91cd\u4f20 2 \u6b21 SYN-ACK \u62a5\u6587\u540e\uff0c\u7531\u4e8e tcp_synack_retries \u4e3a 2\uff0c\u5df2\u8fbe\u5230\u6700\u5927\u91cd\u4f20\u6b21\u6570\uff0c\u4e8e\u662f\u518d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u65f6\u95f4\u4e3a\u4e0a\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u5ba2\u6237\u7aef\u7684\u7b2c\u4e09\u6b21\u63e1\u624b\uff08ACK \u62a5\u6587\uff09\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#syn-syn","title":"\u4ec0\u4e48\u662f SYN \u653b\u51fb\uff1f\u5982\u4f55\u907f\u514d SYN \u653b\u51fb\uff1f","text":"<p>\u6211\u4eec\u90fd\u77e5\u9053 TCP \u8fde\u63a5\u5efa\u7acb\u662f\u9700\u8981\u4e09\u6b21\u63e1\u624b\uff0c\u5047\u8bbe\u653b\u51fb\u8005\u77ed\u65f6\u95f4\u4f2a\u9020\u4e0d\u540c IP \u5730\u5740\u7684 <code>SYN</code> \u62a5\u6587\uff0c\u670d\u52a1\u7aef\u6bcf\u63a5\u6536\u5230\u4e00\u4e2a <code>SYN</code> \u62a5\u6587\uff0c\u5c31\u8fdb\u5165<code>SYN_RCVD</code> \u72b6\u6001\uff0c\u4f46\u670d\u52a1\u7aef\u53d1\u9001\u51fa\u53bb\u7684 <code>ACK + SYN</code> \u62a5\u6587\uff0c\u65e0\u6cd5\u5f97\u5230\u672a\u77e5 IP \u4e3b\u673a\u7684 <code>ACK</code> \u5e94\u7b54\uff0c\u4e45\u800c\u4e45\u4e4b\u5c31\u4f1a\u5360\u6ee1\u670d\u52a1\u7aef\u7684\u534a\u8fde\u63a5\u961f\u5217\uff0c\u4f7f\u5f97\u670d\u52a1\u7aef\u4e0d\u80fd\u4e3a\u6b63\u5e38\u7528\u6237\u670d\u52a1\u3002</p> <p></p> <p>\u5148\u8ddf\u5927\u5bb6\u8bf4\u4e00\u4e0b\uff0c\u4ec0\u4e48\u662f TCP \u534a\u8fde\u63a5\u548c\u5168\u8fde\u63a5\u961f\u5217\u3002</p> <p>\u5728 TCP \u4e09\u6b21\u63e1\u624b\u7684\u65f6\u5019\uff0cLinux \u5185\u6838\u4f1a\u7ef4\u62a4\u4e24\u4e2a\u961f\u5217\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u534a\u8fde\u63a5\u961f\u5217\uff0c\u4e5f\u79f0 SYN \u961f\u5217\uff1b</li> <li>\u5168\u8fde\u63a5\u961f\u5217\uff0c\u4e5f\u79f0 accept \u961f\u5217\uff1b</li> </ul> <p>\u6211\u4eec\u5148\u6765\u770b\u4e0b Linux \u5185\u6838\u7684 <code>SYN</code> \u961f\u5217\uff08\u534a\u8fde\u63a5\u961f\u5217\uff09\u4e0e <code>Accpet</code> \u961f\u5217\uff08\u5168\u8fde\u63a5\u961f\u5217\uff09\u662f\u5982\u4f55\u5de5\u4f5c\u7684\uff1f</p> <p></p> <p>\u6b63\u5e38\u6d41\u7a0b\uff1a</p> <ul> <li>\u5f53\u670d\u52a1\u7aef\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u7684 SYN \u62a5\u6587\u65f6\uff0c\u4f1a\u521b\u5efa\u4e00\u4e2a\u534a\u8fde\u63a5\u7684\u5bf9\u8c61\uff0c\u7136\u540e\u5c06\u5176\u52a0\u5165\u5230\u5185\u6838\u7684\u300cSYN \u961f\u5217\u300d\uff1b</li> <li>\u63a5\u7740\u53d1\u9001 SYN + ACK \u7ed9\u5ba2\u6237\u7aef\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u56de\u5e94 ACK \u62a5\u6587\uff1b</li> <li>\u670d\u52a1\u7aef\u63a5\u6536\u5230 ACK \u62a5\u6587\u540e\uff0c\u4ece\u300cSYN \u961f\u5217\u300d\u53d6\u51fa\u4e00\u4e2a\u534a\u8fde\u63a5\u5bf9\u8c61\uff0c\u7136\u540e\u521b\u5efa\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5\u5bf9\u8c61\u653e\u5165\u5230\u300cAccept \u961f\u5217\u300d\uff1b</li> <li>\u5e94\u7528\u901a\u8fc7\u8c03\u7528 <code>accpet()</code> socket \u63a5\u53e3\uff0c\u4ece\u300cAccept \u961f\u5217\u300d\u53d6\u51fa\u8fde\u63a5\u5bf9\u8c61\u3002</li> </ul> <p>\u4e0d\u7ba1\u662f\u534a\u8fde\u63a5\u961f\u5217\u8fd8\u662f\u5168\u8fde\u63a5\u961f\u5217\uff0c\u90fd\u6709\u6700\u5927\u957f\u5ea6\u9650\u5236\uff0c\u8d85\u8fc7\u9650\u5236\u65f6\uff0c\u9ed8\u8ba4\u60c5\u51b5\u90fd\u4f1a\u4e22\u5f03\u62a5\u6587\u3002</p> <p>SYN \u653b\u51fb\u65b9\u5f0f\u6700\u76f4\u63a5\u7684\u8868\u73b0\u5c31\u4f1a\u628a TCP \u534a\u8fde\u63a5\u961f\u5217\u6253\u6ee1\uff0c\u8fd9\u6837\u5f53 TCP \u534a\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u540e\u7eed\u518d\u5728\u6536\u5230 SYN \u62a5\u6587\u5c31\u4f1a\u4e22\u5f03\uff0c\u5bfc\u81f4\u5ba2\u6237\u7aef\u65e0\u6cd5\u548c\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u907f\u514d SYN \u653b\u51fb\u65b9\u5f0f\uff0c\u53ef\u4ee5\u6709\u4ee5\u4e0b\u56db\u79cd\u65b9\u6cd5\uff1a</p> <ul> <li>\u8c03\u5927 netdev_max_backlog\uff1b</li> <li>\u589e\u5927 TCP \u534a\u8fde\u63a5\u961f\u5217\uff1b</li> <li>\u5f00\u542f tcp_syncookies\uff1b</li> <li>\u51cf\u5c11 SYN+ACK \u91cd\u4f20\u6b21\u6570</li> </ul> <p>\u65b9\u5f0f\u4e00\uff1a\u8c03\u5927 netdev_max_backlog</p> <p>\u5f53\u7f51\u5361\u63a5\u6536\u6570\u636e\u5305\u7684\u901f\u5ea6\u5927\u4e8e\u5185\u6838\u5904\u7406\u7684\u901f\u5ea6\u65f6\uff0c\u4f1a\u6709\u4e00\u4e2a\u961f\u5217\u4fdd\u5b58\u8fd9\u4e9b\u6570\u636e\u5305\u3002\u63a7\u5236\u8be5\u961f\u5217\u7684\u6700\u5927\u503c\u5982\u4e0b\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u662f 1000\uff0c\u6211\u4eec\u8981\u9002\u5f53\u8c03\u5927\u8be5\u53c2\u6570\u7684\u503c\uff0c\u6bd4\u5982\u8bbe\u7f6e\u4e3a 10000\uff1a</p> Bash<pre><code>net.core.netdev_max_backlog = 10000\n</code></pre> <p>\u65b9\u5f0f\u4e8c\uff1a\u589e\u5927 TCP \u534a\u8fde\u63a5\u961f\u5217</p> <p>\u589e\u5927 TCP \u534a\u8fde\u63a5\u961f\u5217\uff0c\u8981\u540c\u65f6\u589e\u5927\u4e0b\u9762\u8fd9\u4e09\u4e2a\u53c2\u6570\uff1a</p> <ul> <li>\u589e\u5927 net.ipv4.tcp_max_syn_backlog</li> <li>\u589e\u5927  listen() \u51fd\u6570\u4e2d\u7684 backlog</li> <li>\u589e\u5927 net.core.somaxconn</li> </ul> <p>\u5177\u4f53\u4e3a\u4ec0\u4e48\u662f\u4e09\u4e2a\u53c2\u6570\u51b3\u5b9a  TCP \u534a\u8fde\u63a5\u961f\u5217\u7684\u5927\u5c0f\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1aTCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u53c8\u8be5\u5982\u4f55\u5e94\u5bf9\uff1f</p> <p>\u65b9\u5f0f\u4e09\uff1a\u5f00\u542f net.ipv4.tcp_syncookies </p> <p>\u5f00\u542f syncookies \u529f\u80fd\u5c31\u53ef\u4ee5\u5728\u4e0d\u4f7f\u7528 SYN \u534a\u8fde\u63a5\u961f\u5217\u7684\u60c5\u51b5\u4e0b\u6210\u529f\u5efa\u7acb\u8fde\u63a5\uff0c\u76f8\u5f53\u4e8e\u7ed5\u8fc7\u4e86 SYN \u534a\u8fde\u63a5\u6765\u5efa\u7acb\u8fde\u63a5\u3002</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u300cSYN \u961f\u5217\u300d\u6ee1\u4e4b\u540e\uff0c\u540e\u7eed\u670d\u52a1\u7aef\u6536\u5230 SYN \u5305\uff0c\u4e0d\u4f1a\u4e22\u5f03\uff0c\u800c\u662f\u6839\u636e\u7b97\u6cd5\uff0c\u8ba1\u7b97\u51fa\u4e00\u4e2a <code>cookie</code> \u503c\uff1b</li> <li>\u5c06 cookie \u503c\u653e\u5230\u7b2c\u4e8c\u6b21\u63e1\u624b\u62a5\u6587\u7684\u300c\u5e8f\u5217\u53f7\u300d\u91cc\uff0c\u7136\u540e\u670d\u52a1\u7aef\u56de\u7b2c\u4e8c\u6b21\u63e1\u624b\u7ed9\u5ba2\u6237\u7aef\uff1b</li> <li>\u670d\u52a1\u7aef\u63a5\u6536\u5230\u5ba2\u6237\u7aef\u7684\u5e94\u7b54\u62a5\u6587\u65f6\uff0c\u670d\u52a1\u7aef\u4f1a\u68c0\u67e5\u8fd9\u4e2a ACK \u5305\u7684\u5408\u6cd5\u6027\u3002\u5982\u679c\u5408\u6cd5\uff0c\u5c06\u8be5\u8fde\u63a5\u5bf9\u8c61\u653e\u5165\u5230\u300cAccept \u961f\u5217\u300d\u3002 </li> <li>\u6700\u540e\u5e94\u7528\u7a0b\u5e8f\u901a\u8fc7\u8c03\u7528 <code>accpet()</code> \u63a5\u53e3\uff0c\u4ece\u300cAccept \u961f\u5217\u300d\u53d6\u51fa\u7684\u8fde\u63a5\u3002</li> </ul> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u5f00\u542f\u4e86 tcp_syncookies \u4e86\uff0c\u5373\u4f7f\u53d7\u5230 SYN \u653b\u51fb\u800c\u5bfc\u81f4 SYN \u961f\u5217\u6ee1\u65f6\uff0c\u4e5f\u80fd\u4fdd\u8bc1\u6b63\u5e38\u7684\u8fde\u63a5\u6210\u529f\u5efa\u7acb\u3002</p> <p>net.ipv4.tcp_syncookies \u53c2\u6570\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u4e2a\u503c\uff1a</p> <ul> <li>0 \u503c\uff0c\u8868\u793a\u5173\u95ed\u8be5\u529f\u80fd\uff1b</li> <li>1 \u503c\uff0c\u8868\u793a\u4ec5\u5f53 SYN \u534a\u8fde\u63a5\u961f\u5217\u653e\u4e0d\u4e0b\u65f6\uff0c\u518d\u542f\u7528\u5b83\uff1b</li> <li>2 \u503c\uff0c\u8868\u793a\u65e0\u6761\u4ef6\u5f00\u542f\u529f\u80fd\uff1b</li> </ul> <p>\u90a3\u4e48\u5728\u5e94\u5bf9 SYN \u653b\u51fb\u65f6\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u4e3a 1 \u5373\u53ef\u3002</p> Bash<pre><code>$ echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies\n</code></pre> <p>\u65b9\u5f0f\u56db\uff1a\u51cf\u5c11 SYN+ACK \u91cd\u4f20\u6b21\u6570</p> <p>\u5f53\u670d\u52a1\u7aef\u53d7\u5230 SYN \u653b\u51fb\u65f6\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u5904\u4e8e SYN_REVC \u72b6\u6001\u7684 TCP \u8fde\u63a5\uff0c\u5904\u4e8e\u8fd9\u4e2a\u72b6\u6001\u7684 TCP \u4f1a\u91cd\u4f20 SYN+ACK\uff0c\u5f53\u91cd\u4f20\u8d85\u8fc7\u6b21\u6570\u8fbe\u5230\u4e0a\u9650\u540e\uff0c\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</p> <p>\u90a3\u4e48\u9488\u5bf9 SYN \u653b\u51fb\u7684\u573a\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u51cf\u5c11 SYN-ACK \u7684\u91cd\u4f20\u6b21\u6570\uff0c\u4ee5\u52a0\u5feb\u5904\u4e8e SYN_REVC \u72b6\u6001\u7684 TCP \u8fde\u63a5\u65ad\u5f00\u3002</p> <p>SYN-ACK \u62a5\u6587\u7684\u6700\u5927\u91cd\u4f20\u6b21\u6570\u7531 <code>tcp_synack_retries</code>\u5185\u6838\u53c2\u6570\u51b3\u5b9a\uff08\u9ed8\u8ba4\u503c\u662f 5 \u6b21\uff09\uff0c\u6bd4\u5982\u5c06 tcp_synack_retries \u51cf\u5c11\u5230 2 \u6b21\uff1a</p> Bash<pre><code>$ echo 2 &gt; /proc/sys/net/ipv4/tcp_synack_retries\n</code></pre>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp_8","title":"TCP \u8fde\u63a5\u65ad\u5f00","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp_9","title":"TCP \u56db\u6b21\u6325\u624b\u8fc7\u7a0b\u662f\u600e\u6837\u7684\uff1f","text":"<p>\u5929\u4e0b\u6ca1\u6709\u4e0d\u6563\u7684\u5bb4\u5e2d\uff0c\u5bf9\u4e8e TCP \u8fde\u63a5\u4e5f\u662f\u8fd9\u6837\uff0cTCP \u65ad\u5f00\u8fde\u63a5\u662f\u901a\u8fc7\u56db\u6b21\u6325\u624b\u65b9\u5f0f\u3002</p> <p>\u53cc\u65b9\u90fd\u53ef\u4ee5\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5\uff0c\u65ad\u5f00\u8fde\u63a5\u540e\u4e3b\u673a\u4e2d\u7684\u300c\u8d44\u6e90\u300d\u5c06\u88ab\u91ca\u653e\uff0c\u56db\u6b21\u6325\u624b\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <ul> <li>\u5ba2\u6237\u7aef\u6253\u7b97\u5173\u95ed\u8fde\u63a5\uff0c\u6b64\u65f6\u4f1a\u53d1\u9001\u4e00\u4e2a TCP \u9996\u90e8 <code>FIN</code> \u6807\u5fd7\u4f4d\u88ab\u7f6e\u4e3a <code>1</code> \u7684\u62a5\u6587\uff0c\u4e5f\u5373 <code>FIN</code> \u62a5\u6587\uff0c\u4e4b\u540e\u5ba2\u6237\u7aef\u8fdb\u5165 <code>FIN_WAIT_1</code> \u72b6\u6001\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u8be5\u62a5\u6587\u540e\uff0c\u5c31\u5411\u5ba2\u6237\u7aef\u53d1\u9001 <code>ACK</code> \u5e94\u7b54\u62a5\u6587\uff0c\u63a5\u7740\u670d\u52a1\u7aef\u8fdb\u5165 <code>CLOSE_WAIT</code> \u72b6\u6001\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684 <code>ACK</code> \u5e94\u7b54\u62a5\u6587\u540e\uff0c\u4e4b\u540e\u8fdb\u5165 <code>FIN_WAIT_2</code> \u72b6\u6001\u3002</li> <li>\u7b49\u5f85\u670d\u52a1\u7aef\u5904\u7406\u5b8c\u6570\u636e\u540e\uff0c\u4e5f\u5411\u5ba2\u6237\u7aef\u53d1\u9001 <code>FIN</code> \u62a5\u6587\uff0c\u4e4b\u540e\u670d\u52a1\u7aef\u8fdb\u5165 <code>LAST_ACK</code> \u72b6\u6001\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684 <code>FIN</code> \u62a5\u6587\u540e\uff0c\u56de\u4e00\u4e2a <code>ACK</code> \u5e94\u7b54\u62a5\u6587\uff0c\u4e4b\u540e\u8fdb\u5165 <code>TIME_WAIT</code> \u72b6\u6001</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u4e86 <code>ACK</code> \u5e94\u7b54\u62a5\u6587\u540e\uff0c\u5c31\u8fdb\u5165\u4e86 <code>CLOSE</code> \u72b6\u6001\uff0c\u81f3\u6b64\u670d\u52a1\u7aef\u5df2\u7ecf\u5b8c\u6210\u8fde\u63a5\u7684\u5173\u95ed\u3002</li> <li>\u5ba2\u6237\u7aef\u5728\u7ecf\u8fc7 <code>2MSL</code> \u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u81ea\u52a8\u8fdb\u5165 <code>CLOSE</code> \u72b6\u6001\uff0c\u81f3\u6b64\u5ba2\u6237\u7aef\u4e5f\u5b8c\u6210\u8fde\u63a5\u7684\u5173\u95ed\u3002</li> </ul> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u4e2a\u65b9\u5411\u90fd\u9700\u8981\u4e00\u4e2a FIN \u548c\u4e00\u4e2a ACK\uff0c\u56e0\u6b64\u901a\u5e38\u88ab\u79f0\u4e3a\u56db\u6b21\u6325\u624b\u3002</p> <p>\u8fd9\u91cc\u4e00\u70b9\u9700\u8981\u6ce8\u610f\u662f\uff1a\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u7684\uff0c\u624d\u6709 TIME_WAIT \u72b6\u6001\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_5","title":"\u4e3a\u4ec0\u4e48\u6325\u624b\u9700\u8981\u56db\u6b21\uff1f","text":"<p>\u518d\u6765\u56de\u987e\u4e0b\u56db\u6b21\u6325\u624b\u53cc\u65b9\u53d1 <code>FIN</code> \u5305\u7684\u8fc7\u7a0b\uff0c\u5c31\u80fd\u7406\u89e3\u4e3a\u4ec0\u4e48\u9700\u8981\u56db\u6b21\u4e86\u3002</p> <ul> <li>\u5173\u95ed\u8fde\u63a5\u65f6\uff0c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001 <code>FIN</code> \u65f6\uff0c\u4ec5\u4ec5\u8868\u793a\u5ba2\u6237\u7aef\u4e0d\u518d\u53d1\u9001\u6570\u636e\u4e86\u4f46\u662f\u8fd8\u80fd\u63a5\u6536\u6570\u636e\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684 <code>FIN</code> \u62a5\u6587\u65f6\uff0c\u5148\u56de\u4e00\u4e2a <code>ACK</code> \u5e94\u7b54\u62a5\u6587\uff0c\u800c\u670d\u52a1\u7aef\u53ef\u80fd\u8fd8\u6709\u6570\u636e\u9700\u8981\u5904\u7406\u548c\u53d1\u9001\uff0c\u7b49\u670d\u52a1\u7aef\u4e0d\u518d\u53d1\u9001\u6570\u636e\u65f6\uff0c\u624d\u53d1\u9001 <code>FIN</code> \u62a5\u6587\u7ed9\u5ba2\u6237\u7aef\u6765\u8868\u793a\u540c\u610f\u73b0\u5728\u5173\u95ed\u8fde\u63a5\u3002</li> </ul> <p>\u4ece\u4e0a\u9762\u8fc7\u7a0b\u53ef\u77e5\uff0c\u670d\u52a1\u7aef\u901a\u5e38\u9700\u8981\u7b49\u5f85\u5b8c\u6210\u6570\u636e\u7684\u53d1\u9001\u548c\u5904\u7406\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u7684 <code>ACK</code> \u548c <code>FIN</code> \u4e00\u822c\u90fd\u4f1a\u5206\u5f00\u53d1\u9001\uff0c\u56e0\u6b64\u662f\u9700\u8981\u56db\u6b21\u6325\u624b\u3002</p> <p>\u4f46\u662f\u5728\u7279\u5b9a\u60c5\u51b5\u4e0b\uff0c\u56db\u6b21\u6325\u624b\u662f\u53ef\u4ee5\u53d8\u6210\u4e09\u6b21\u6325\u624b\u7684\uff0c\u5177\u4f53\u60c5\u51b5\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1aTCP \u56db\u6b21\u6325\u624b\uff0c\u53ef\u4ee5\u53d8\u6210\u4e09\u6b21\u5417\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_6","title":"\u7b2c\u4e00\u6b21\u6325\u624b\u4e22\u5931\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5f53\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u5173\u95ed\u65b9\uff09\u8c03\u7528 close \u51fd\u6570\u540e\uff0c\u5c31\u4f1a\u5411\u670d\u52a1\u7aef\u53d1\u9001 FIN \u62a5\u6587\uff0c\u8bd5\u56fe\u4e0e\u670d\u52a1\u7aef\u65ad\u5f00\u8fde\u63a5\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u8fdb\u5165\u5230 <code>FIN_WAIT_1</code> \u72b6\u6001\u3002</p> <p>\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u80fd\u53ca\u65f6\u6536\u5230\u670d\u52a1\u7aef\uff08\u88ab\u52a8\u5173\u95ed\u65b9\uff09\u7684 ACK\uff0c\u5219\u4f1a\u5f88\u5feb\u53d8\u4e3a <code>FIN_WAIT2</code>\u72b6\u6001\u3002</p> <p>\u5982\u679c\u7b2c\u4e00\u6b21\u6325\u624b\u4e22\u5931\u4e86\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u8fdf\u8fdf\u6536\u4e0d\u5230\u88ab\u52a8\u65b9\u7684 ACK \u7684\u8bdd\uff0c\u4e5f\u5c31\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u91cd\u4f20 FIN \u62a5\u6587\uff0c\u91cd\u53d1\u6b21\u6570\u7531 <code>tcp_orphan_retries</code> \u53c2\u6570\u63a7\u5236\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef\u91cd\u4f20 FIN \u62a5\u6587\u7684\u6b21\u6570\u8d85\u8fc7 <code>tcp_orphan_retries</code> \u540e\uff0c\u5c31\u4e0d\u518d\u53d1\u9001 FIN \u62a5\u6587\uff0c\u5219\u4f1a\u5728\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u65f6\u95f4\u4e3a\u4e0a\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u7b2c\u4e8c\u6b21\u6325\u624b\uff0c\u90a3\u4e48\u76f4\u63a5\u8fdb\u5165\u5230 <code>close</code> \u72b6\u6001\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe tcp_orphan_retries \u53c2\u6570\u503c\u4e3a 3\uff0c\u5f53\u7b2c\u4e00\u6b21\u6325\u624b\u4e00\u76f4\u4e22\u5931\u65f6\uff0c\u53d1\u751f\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u5ba2\u6237\u7aef\u8d85\u65f6\u91cd\u4f20 3 \u6b21 FIN \u62a5\u6587\u540e\uff0c\u7531\u4e8e tcp_orphan_retries \u4e3a 3\uff0c\u5df2\u8fbe\u5230\u6700\u5927\u91cd\u4f20\u6b21\u6570\uff0c\u4e8e\u662f\u518d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u65f6\u95f4\u4e3a\u4e0a\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u670d\u52a1\u7aef\u7684\u7b2c\u4e8c\u6b21\u6325\u624b\uff08ACK \u62a5\u6587\uff09\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_7","title":"\u7b2c\u4e8c\u6b21\u6325\u624b\u4e22\u5931\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5f53\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684\u7b2c\u4e00\u6b21\u6325\u624b\u540e\uff0c\u5c31\u4f1a\u5148\u56de\u4e00\u4e2a ACK \u786e\u8ba4\u62a5\u6587\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u7684\u8fde\u63a5\u8fdb\u5165\u5230 <code>CLOSE_WAIT</code> \u72b6\u6001\u3002</p> <p>\u5728\u524d\u9762\u6211\u4eec\u4e5f\u63d0\u4e86\uff0cACK \u62a5\u6587\u662f\u4e0d\u4f1a\u91cd\u4f20\u7684\uff0c\u6240\u4ee5\u5982\u679c\u670d\u52a1\u7aef\u7684\u7b2c\u4e8c\u6b21\u6325\u624b\u4e22\u5931\u4e86\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u91cd\u4f20 FIN \u62a5\u6587\uff0c\u76f4\u5230\u6536\u5230\u670d\u52a1\u7aef\u7684\u7b2c\u4e8c\u6b21\u6325\u624b\uff0c\u6216\u8005\u8fbe\u5230\u6700\u5927\u7684\u91cd\u4f20\u6b21\u6570\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe tcp_orphan_retries \u53c2\u6570\u503c\u4e3a 2\uff0c\u5f53\u7b2c\u4e8c\u6b21\u6325\u624b\u4e00\u76f4\u4e22\u5931\u65f6\uff0c\u53d1\u751f\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u5ba2\u6237\u7aef\u8d85\u65f6\u91cd\u4f20 2 \u6b21 FIN \u62a5\u6587\u540e\uff0c\u7531\u4e8e tcp_orphan_retries \u4e3a 2\uff0c\u5df2\u8fbe\u5230\u6700\u5927\u91cd\u4f20\u6b21\u6570\uff0c\u4e8e\u662f\u518d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u65f6\u95f4\u4e3a\u4e0a\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u670d\u52a1\u7aef\u7684\u7b2c\u4e8c\u6b21\u6325\u624b\uff08ACK \u62a5\u6587\uff09\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> </ul> <p>\u8fd9\u91cc\u63d0\u4e00\u4e0b\uff0c\u5f53\u5ba2\u6237\u7aef\u6536\u5230\u7b2c\u4e8c\u6b21\u6325\u624b\uff0c\u4e5f\u5c31\u662f\u6536\u5230\u670d\u52a1\u7aef\u53d1\u9001\u7684 ACK \u62a5\u6587\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u5904\u4e8e <code>FIN_WAIT2</code> \u72b6\u6001\uff0c\u5728\u8fd9\u4e2a\u72b6\u6001\u9700\u8981\u7b49\u670d\u52a1\u7aef\u53d1\u9001\u7b2c\u4e09\u6b21\u6325\u624b\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u7aef\u7684 FIN \u62a5\u6587\u3002</p> <p>\u5bf9\u4e8e close \u51fd\u6570\u5173\u95ed\u7684\u8fde\u63a5\uff0c\u7531\u4e8e\u65e0\u6cd5\u518d\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\uff0c\u6240\u4ee5<code>FIN_WAIT2</code> \u72b6\u6001\u4e0d\u53ef\u4ee5\u6301\u7eed\u592a\u4e45\uff0c\u800c <code>tcp_fin_timeout</code> \u63a7\u5236\u4e86\u8fd9\u4e2a\u72b6\u6001\u4e0b\u8fde\u63a5\u7684\u6301\u7eed\u65f6\u957f\uff0c\u9ed8\u8ba4\u503c\u662f 60 \u79d2\u3002</p> <p>\u8fd9\u610f\u5473\u7740\u5bf9\u4e8e\u8c03\u7528 close \u5173\u95ed\u7684\u8fde\u63a5\uff0c\u5982\u679c\u5728 60 \u79d2\u540e\u8fd8\u6ca1\u6709\u6536\u5230 FIN \u62a5\u6587\uff0c\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u5173\u95ed\u65b9\uff09\u7684\u8fde\u63a5\u5c31\u4f1a\u76f4\u63a5\u5173\u95ed\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4f46\u662f\u6ce8\u610f\uff0c\u5982\u679c\u4e3b\u52a8\u5173\u95ed\u65b9\u4f7f\u7528 shutdown \u51fd\u6570\u5173\u95ed\u8fde\u63a5\uff0c\u6307\u5b9a\u4e86\u53ea\u5173\u95ed\u53d1\u9001\u65b9\u5411\uff0c\u800c\u63a5\u6536\u65b9\u5411\u5e76\u6ca1\u6709\u5173\u95ed\uff0c\u90a3\u4e48\u610f\u5473\u7740\u4e3b\u52a8\u5173\u95ed\u65b9\u8fd8\u662f\u53ef\u4ee5\u63a5\u6536\u6570\u636e\u7684\u3002</p> <p>\u6b64\u65f6\uff0c\u5982\u679c\u4e3b\u52a8\u5173\u95ed\u65b9\u4e00\u76f4\u6ca1\u6536\u5230\u7b2c\u4e09\u6b21\u6325\u624b\uff0c\u90a3\u4e48\u4e3b\u52a8\u5173\u95ed\u65b9\u7684\u8fde\u63a5\u5c06\u4f1a\u4e00\u76f4\u5904\u4e8e <code>FIN_WAIT2</code> \u72b6\u6001\uff08<code>tcp_fin_timeout</code> \u65e0\u6cd5\u63a7\u5236 shutdown \u5173\u95ed\u7684\u8fde\u63a5\uff09\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_8","title":"\u7b2c\u4e09\u6b21\u6325\u624b\u4e22\u5931\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5f53\u670d\u52a1\u7aef\uff08\u88ab\u52a8\u5173\u95ed\u65b9\uff09\u6536\u5230\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u5173\u95ed\u65b9\uff09\u7684 FIN \u62a5\u6587\u540e\uff0c\u5185\u6838\u4f1a\u81ea\u52a8\u56de\u590d ACK\uff0c\u540c\u65f6\u8fde\u63a5\u5904\u4e8e <code>CLOSE_WAIT</code> \u72b6\u6001\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u8868\u793a\u7b49\u5f85\u5e94\u7528\u8fdb\u7a0b\u8c03\u7528 close \u51fd\u6570\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u6b64\u65f6\uff0c\u5185\u6838\u662f\u6ca1\u6709\u6743\u5229\u66ff\u4ee3\u8fdb\u7a0b\u5173\u95ed\u8fde\u63a5\uff0c\u5fc5\u987b\u7531\u8fdb\u7a0b\u4e3b\u52a8\u8c03\u7528 close \u51fd\u6570\u6765\u89e6\u53d1\u670d\u52a1\u7aef\u53d1\u9001 FIN \u62a5\u6587\u3002</p> <p>\u670d\u52a1\u7aef\u5904\u4e8e CLOSE_WAIT \u72b6\u6001\u65f6\uff0c\u8c03\u7528\u4e86 close \u51fd\u6570\uff0c\u5185\u6838\u5c31\u4f1a\u53d1\u51fa FIN \u62a5\u6587\uff0c\u540c\u65f6\u8fde\u63a5\u8fdb\u5165 LAST_ACK \u72b6\u6001\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u8fd4\u56de ACK \u6765\u786e\u8ba4\u8fde\u63a5\u5173\u95ed\u3002</p> <p>\u5982\u679c\u8fdf\u8fdf\u6536\u4e0d\u5230\u8fd9\u4e2a ACK\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u91cd\u53d1 FIN \u62a5\u6587\uff0c\u91cd\u53d1\u6b21\u6570\u4ecd\u7136\u7531 <code>tcp_orphan_retries</code> \u53c2\u6570\u63a7\u5236\uff0c\u8fd9\u4e0e\u5ba2\u6237\u7aef\u91cd\u53d1 FIN \u62a5\u6587\u7684\u91cd\u4f20\u6b21\u6570\u63a7\u5236\u65b9\u5f0f\u662f\u4e00\u6837\u7684\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe <code>tcp_orphan_retries</code> = 3\uff0c\u5f53\u7b2c\u4e09\u6b21\u6325\u624b\u4e00\u76f4\u4e22\u5931\u65f6\uff0c\u53d1\u751f\u7684\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u670d\u52a1\u7aef\u91cd\u4f20\u7b2c\u4e09\u6b21\u6325\u624b\u62a5\u6587\u7684\u6b21\u6570\u8fbe\u5230\u4e86 3 \u6b21\u540e\uff0c\u7531\u4e8e tcp_orphan_retries \u4e3a 3\uff0c\u8fbe\u5230\u4e86\u91cd\u4f20\u6700\u5927\u6b21\u6570\uff0c\u4e8e\u662f\u518d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u65f6\u95f4\u4e3a\u4e0a\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u5ba2\u6237\u7aef\u7684\u7b2c\u56db\u6b21\u6325\u624b\uff08ACK \u62a5\u6587\uff09\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> <li>\u5ba2\u6237\u7aef\u56e0\u4e3a\u662f\u901a\u8fc7 close \u51fd\u6570\u5173\u95ed\u8fde\u63a5\u7684\uff0c\u5904\u4e8e FIN_WAIT_2 \u72b6\u6001\u662f\u6709\u65f6\u957f\u9650\u5236\u7684\uff0c\u5982\u679c tcp_fin_timeout \u65f6\u95f4\u5185\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u670d\u52a1\u7aef\u7684\u7b2c\u4e09\u6b21\u6325\u624b\uff08FIN \u62a5\u6587\uff09\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_9","title":"\u7b2c\u56db\u6b21\u6325\u624b\u4e22\u5931\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5f53\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684\u7b2c\u4e09\u6b21\u6325\u624b\u7684 FIN \u62a5\u6587\u540e\uff0c\u5c31\u4f1a\u56de ACK \u62a5\u6587\uff0c\u4e5f\u5c31\u662f\u7b2c\u56db\u6b21\u6325\u624b\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u8fde\u63a5\u8fdb\u5165 <code>TIME_WAIT</code> \u72b6\u6001\u3002</p> <p>\u5728 Linux \u7cfb\u7edf\uff0cTIME_WAIT \u72b6\u6001\u4f1a\u6301\u7eed 2MSL \u540e\u624d\u4f1a\u8fdb\u5165\u5173\u95ed\u72b6\u6001\u3002</p> <p>\u7136\u540e\uff0c\u670d\u52a1\u7aef\uff08\u88ab\u52a8\u5173\u95ed\u65b9\uff09\u6ca1\u6709\u6536\u5230 ACK \u62a5\u6587\u524d\uff0c\u8fd8\u662f\u5904\u4e8e LAST_ACK \u72b6\u6001\u3002</p> <p>\u5982\u679c\u7b2c\u56db\u6b21\u6325\u624b\u7684 ACK \u62a5\u6587\u6ca1\u6709\u5230\u8fbe\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u91cd\u53d1 FIN \u62a5\u6587\uff0c\u91cd\u53d1\u6b21\u6570\u4ecd\u7136\u7531\u524d\u9762\u4ecb\u7ecd\u8fc7\u7684 <code>tcp_orphan_retries</code> \u53c2\u6570\u63a7\u5236\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5047\u8bbe tcp_orphan_retries \u4e3a 2\uff0c\u5f53\u7b2c\u56db\u6b21\u6325\u624b\u4e00\u76f4\u4e22\u5931\u65f6\uff0c\u53d1\u751f\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u670d\u52a1\u7aef\u91cd\u4f20\u7b2c\u4e09\u6b21\u6325\u624b\u62a5\u6587\u8fbe\u5230 2 \u65f6\uff0c\u7531\u4e8e tcp_orphan_retries \u4e3a 2\uff0c\u8fbe\u5230\u4e86\u6700\u5927\u91cd\u4f20\u6b21\u6570\uff0c\u4e8e\u662f\u518d\u7b49\u5f85\u4e00\u6bb5\u65f6\u95f4\uff08\u65f6\u95f4\u4e3a\u4e0a\u4e00\u6b21\u8d85\u65f6\u65f6\u95f4\u7684 2 \u500d\uff09\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u80fd\u6536\u5230\u5ba2\u6237\u7aef\u7684\u7b2c\u56db\u6b21\u6325\u624b\uff08ACK \u62a5\u6587\uff09\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> <li>\u5ba2\u6237\u7aef\u5728\u6536\u5230\u7b2c\u4e09\u6b21\u6325\u624b\u540e\uff0c\u5c31\u4f1a\u8fdb\u5165 TIME_WAIT \u72b6\u6001\uff0c\u5f00\u542f\u65f6\u957f\u4e3a 2MSL \u7684\u5b9a\u65f6\u5668\uff0c\u5982\u679c\u9014\u4e2d\u518d\u6b21\u6536\u5230\u7b2c\u4e09\u6b21\u6325\u624b\uff08FIN \u62a5\u6587\uff09\u540e\uff0c\u5c31\u4f1a\u91cd\u7f6e\u5b9a\u65f6\u5668\uff0c\u5f53\u7b49\u5f85 2MSL \u65f6\u957f\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#time_wait-2msl","title":"\u4e3a\u4ec0\u4e48 TIME_WAIT \u7b49\u5f85\u7684\u65f6\u95f4\u662f 2MSL\uff1f","text":"<p><code>MSL</code> \u662f Maximum Segment Lifetime\uff0c\u62a5\u6587\u6700\u5927\u751f\u5b58\u65f6\u95f4\uff0c\u5b83\u662f\u4efb\u4f55\u62a5\u6587\u5728\u7f51\u7edc\u4e0a\u5b58\u5728\u7684\u6700\u957f\u65f6\u95f4\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u65f6\u95f4\u62a5\u6587\u5c06\u88ab\u4e22\u5f03\u3002\u56e0\u4e3a TCP \u62a5\u6587\u57fa\u4e8e\u662f IP \u534f\u8bae\u7684\uff0c\u800c IP \u5934\u4e2d\u6709\u4e00\u4e2a <code>TTL</code> \u5b57\u6bb5\uff0c\u662f IP \u6570\u636e\u62a5\u53ef\u4ee5\u7ecf\u8fc7\u7684\u6700\u5927\u8def\u7531\u6570\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u5904\u7406\u4ed6\u7684\u8def\u7531\u5668\u6b64\u503c\u5c31\u51cf 1\uff0c\u5f53\u6b64\u503c\u4e3a 0 \u5219\u6570\u636e\u62a5\u5c06\u88ab\u4e22\u5f03\uff0c\u540c\u65f6\u53d1\u9001 ICMP \u62a5\u6587\u901a\u77e5\u6e90\u4e3b\u673a\u3002</p> <p>MSL \u4e0e TTL \u7684\u533a\u522b\uff1aMSL \u7684\u5355\u4f4d\u662f\u65f6\u95f4\uff0c\u800c TTL \u662f\u7ecf\u8fc7\u8def\u7531\u8df3\u6570\u3002\u6240\u4ee5 MSL \u5e94\u8be5\u8981\u5927\u4e8e\u7b49\u4e8e TTL \u6d88\u8017\u4e3a 0 \u7684\u65f6\u95f4\uff0c\u4ee5\u786e\u4fdd\u62a5\u6587\u5df2\u88ab\u81ea\u7136\u6d88\u4ea1\u3002</p> <p>TTL \u7684\u503c\u4e00\u822c\u662f 64\uff0cLinux \u5c06 MSL \u8bbe\u7f6e\u4e3a 30 \u79d2\uff0c\u610f\u5473\u7740 Linux \u8ba4\u4e3a\u6570\u636e\u62a5\u6587\u7ecf\u8fc7 64 \u4e2a\u8def\u7531\u5668\u7684\u65f6\u95f4\u4e0d\u4f1a\u8d85\u8fc7 30 \u79d2\uff0c\u5982\u679c\u8d85\u8fc7\u4e86\uff0c\u5c31\u8ba4\u4e3a\u62a5\u6587\u5df2\u7ecf\u6d88\u5931\u5728\u7f51\u7edc\u4e2d\u4e86\u3002</p> <p>TIME_WAIT \u7b49\u5f85 2 \u500d\u7684 MSL\uff0c\u6bd4\u8f83\u5408\u7406\u7684\u89e3\u91ca\u662f\uff1a\u7f51\u7edc\u4e2d\u53ef\u80fd\u5b58\u5728\u6765\u81ea\u53d1\u9001\u65b9\u7684\u6570\u636e\u5305\uff0c\u5f53\u8fd9\u4e9b\u53d1\u9001\u65b9\u7684\u6570\u636e\u5305\u88ab\u63a5\u6536\u65b9\u5904\u7406\u540e\u53c8\u4f1a\u5411\u5bf9\u65b9\u53d1\u9001\u54cd\u5e94\uff0c\u6240\u4ee5\u4e00\u6765\u4e00\u56de\u9700\u8981\u7b49\u5f85 2 \u500d\u7684\u65f6\u95f4\u3002</p> <p>\u6bd4\u5982\uff0c\u5982\u679c\u88ab\u52a8\u5173\u95ed\u65b9\u6ca1\u6709\u6536\u5230\u65ad\u5f00\u8fde\u63a5\u7684\u6700\u540e\u7684 ACK \u62a5\u6587\uff0c\u5c31\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u53d1 <code>FIN</code> \u62a5\u6587\uff0c\u53e6\u4e00\u65b9\u63a5\u6536\u5230 FIN \u540e\uff0c\u4f1a\u91cd\u53d1 ACK \u7ed9\u88ab\u52a8\u5173\u95ed\u65b9\uff0c\u4e00\u6765\u4e00\u53bb\u6b63\u597d 2 \u4e2a MSL\u3002</p> <p>\u53ef\u4ee5\u770b\u5230 2MSL \u65f6\u957f \u8fd9\u5176\u5b9e\u662f\u76f8\u5f53\u4e8e\u81f3\u5c11\u5141\u8bb8\u62a5\u6587\u4e22\u5931\u4e00\u6b21\u3002\u6bd4\u5982\uff0c\u82e5 ACK \u5728\u4e00\u4e2a MSL \u5185\u4e22\u5931\uff0c\u8fd9\u6837\u88ab\u52a8\u65b9\u91cd\u53d1\u7684 FIN \u4f1a\u5728\u7b2c 2 \u4e2a MSL \u5185\u5230\u8fbe\uff0cTIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u53ef\u4ee5\u5e94\u5bf9\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u662f 4 \u6216\u8005 8 MSL \u7684\u65f6\u957f\u5462\uff1f\u4f60\u53ef\u4ee5\u60f3\u8c61\u4e00\u4e2a\u4e22\u5305\u7387\u8fbe\u5230\u767e\u5206\u4e4b\u4e00\u7684\u7cdf\u7cd5\u7f51\u7edc\uff0c\u8fde\u7eed\u4e24\u6b21\u4e22\u5305\u7684\u6982\u7387\u53ea\u6709\u4e07\u5206\u4e4b\u4e00\uff0c\u8fd9\u4e2a\u6982\u7387\u5b9e\u5728\u662f\u592a\u5c0f\u4e86\uff0c\u5ffd\u7565\u5b83\u6bd4\u89e3\u51b3\u5b83\u66f4\u5177\u6027\u4ef7\u6bd4\u3002</p> <p><code>2MSL</code> \u7684\u65f6\u95f4\u662f\u4ece\u5ba2\u6237\u7aef\u63a5\u6536\u5230 FIN \u540e\u53d1\u9001 ACK \u5f00\u59cb\u8ba1\u65f6\u7684\u3002\u5982\u679c\u5728 TIME-WAIT \u65f6\u95f4\u5185\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684 ACK \u6ca1\u6709\u4f20\u8f93\u5230\u670d\u52a1\u7aef\uff0c\u5ba2\u6237\u7aef\u53c8\u63a5\u6536\u5230\u4e86\u670d\u52a1\u7aef\u91cd\u53d1\u7684 FIN \u62a5\u6587\uff0c\u90a3\u4e48 2MSL \u65f6\u95f4\u5c06\u91cd\u65b0\u8ba1\u65f6\u3002</p> <p>\u5728 Linux \u7cfb\u7edf\u91cc <code>2MSL</code> \u9ed8\u8ba4\u662f <code>60</code> \u79d2\uff0c\u90a3\u4e48\u4e00\u4e2a <code>MSL</code> \u4e5f\u5c31\u662f <code>30</code> \u79d2\u3002Linux \u7cfb\u7edf\u505c\u7559\u5728 TIME_WAIT \u7684\u65f6\u95f4\u4e3a\u56fa\u5b9a\u7684 60 \u79d2\u3002</p> <p>\u5176\u5b9a\u4e49\u5728 Linux \u5185\u6838\u4ee3\u7801\u91cc\u7684\u540d\u79f0\u4e3a TCP_TIMEWAIT_LEN\uff1a</p> C<pre><code>#define TCP_TIMEWAIT_LEN (60*HZ) /* how long to wait to destroy TIME-WAIT \n                                    state, about 60 seconds  */\n</code></pre> <p>\u5982\u679c\u8981\u4fee\u6539 TIME_WAIT \u7684\u65f6\u95f4\u957f\u5ea6\uff0c\u53ea\u80fd\u4fee\u6539 Linux \u5185\u6838\u4ee3\u7801\u91cc TCP_TIMEWAIT_LEN \u7684\u503c\uff0c\u5e76\u91cd\u65b0\u7f16\u8bd1 Linux \u5185\u6838\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#time_wait","title":"\u4e3a\u4ec0\u4e48\u9700\u8981 TIME_WAIT \u72b6\u6001\uff1f","text":"<p>\u4e3b\u52a8\u53d1\u8d77\u5173\u95ed\u8fde\u63a5\u7684\u4e00\u65b9\uff0c\u624d\u4f1a\u6709 <code>TIME-WAIT</code> \u72b6\u6001\u3002</p> <p>\u9700\u8981 TIME-WAIT \u72b6\u6001\uff0c\u4e3b\u8981\u662f\u4e24\u4e2a\u539f\u56e0\uff1a</p> <ul> <li>\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536\uff1b</li> <li>\u4fdd\u8bc1\u300c\u88ab\u52a8\u5173\u95ed\u8fde\u63a5\u300d\u7684\u4e00\u65b9\uff0c\u80fd\u88ab\u6b63\u786e\u7684\u5173\u95ed\uff1b</li> </ul> <p>\u539f\u56e0\u4e00\uff1a\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536</p> <p>\u4e3a\u4e86\u80fd\u66f4\u597d\u7684\u7406\u89e3\u8fd9\u4e2a\u539f\u56e0\uff0c\u6211\u4eec\u5148\u6765\u4e86\u89e3\u5e8f\u5217\u53f7\uff08SEQ\uff09\u548c\u521d\u59cb\u5e8f\u5217\u53f7\uff08ISN\uff09\u3002</p> <ul> <li>\u5e8f\u5217\u53f7\uff0c\u662f TCP \u4e00\u4e2a\u5934\u90e8\u5b57\u6bb5\uff0c\u6807\u8bc6\u4e86 TCP \u53d1\u9001\u7aef\u5230 TCP \u63a5\u6536\u7aef\u7684\u6570\u636e\u6d41\u7684\u4e00\u4e2a\u5b57\u8282\uff0c\u56e0\u4e3a TCP \u662f\u9762\u5411\u5b57\u8282\u6d41\u7684\u53ef\u9760\u534f\u8bae\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u7684\u987a\u5e8f\u6027\u548c\u53ef\u9760\u6027\uff0cTCP \u4e3a\u6bcf\u4e2a\u4f20\u8f93\u65b9\u5411\u4e0a\u7684\u6bcf\u4e2a\u5b57\u8282\u90fd\u8d4b\u4e88\u4e86\u4e00\u4e2a\u7f16\u53f7\uff0c\u4ee5\u4fbf\u4e8e\u4f20\u8f93\u6210\u529f\u540e\u786e\u8ba4\u3001\u4e22\u5931\u540e\u91cd\u4f20\u4ee5\u53ca\u5728\u63a5\u6536\u7aef\u4fdd\u8bc1\u4e0d\u4f1a\u4e71\u5e8f\u3002\u5e8f\u5217\u53f7\u662f\u4e00\u4e2a 32 \u4f4d\u7684\u65e0\u7b26\u53f7\u6570\uff0c\u56e0\u6b64\u5728\u5230\u8fbe 4G \u4e4b\u540e\u518d\u5faa\u73af\u56de\u5230 0\u3002</li> <li>\u521d\u59cb\u5e8f\u5217\u53f7\uff0c\u5728 TCP \u5efa\u7acb\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u4f1a\u5404\u81ea\u751f\u6210\u4e00\u4e2a\u521d\u59cb\u5e8f\u5217\u53f7\uff0c\u5b83\u662f\u57fa\u4e8e\u65f6\u949f\u751f\u6210\u7684\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u6765\u4fdd\u8bc1\u6bcf\u4e2a\u8fde\u63a5\u90fd\u62e5\u6709\u4e0d\u540c\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u3002\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u53ef\u88ab\u89c6\u4e3a\u4e00\u4e2a 32 \u4f4d\u7684\u8ba1\u6570\u5668\uff0c\u8be5\u8ba1\u6570\u5668\u7684\u6570\u503c\u6bcf 4 \u5fae\u79d2\u52a0 1\uff0c\u5faa\u73af\u4e00\u6b21\u9700\u8981 4.55 \u5c0f\u65f6\u3002</li> </ul> <p>\u7ed9\u5927\u5bb6\u6293\u4e86\u4e00\u4e2a\u5305\uff0c\u4e0b\u56fe\u4e2d\u7684 Seq \u5c31\u662f\u5e8f\u5217\u53f7\uff0c\u5176\u4e2d\u7ea2\u8272\u6846\u4f4f\u7684\u5206\u522b\u662f\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5404\u81ea\u751f\u6210\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u3002</p> <p></p> <p>\u901a\u8fc7\u524d\u9762\u6211\u4eec\u77e5\u9053\uff0c\u5e8f\u5217\u53f7\u548c\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u5e76\u4e0d\u662f\u65e0\u9650\u9012\u589e\u7684\uff0c\u4f1a\u53d1\u751f\u56de\u7ed5\u4e3a\u521d\u59cb\u503c\u7684\u60c5\u51b5\uff0c\u8fd9\u610f\u5473\u7740\u65e0\u6cd5\u6839\u636e\u5e8f\u5217\u53f7\u6765\u5224\u65ad\u65b0\u8001\u6570\u636e\u3002</p> <p>\u5047\u8bbe TIME-WAIT \u6ca1\u6709\u7b49\u5f85\u65f6\u95f4\u6216\u65f6\u95f4\u8fc7\u77ed\uff0c\u88ab\u5ef6\u8fdf\u7684\u6570\u636e\u5305\u62b5\u8fbe\u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff1f</p> <p></p> <p>\u5982\u4e0a\u56fe\uff1a</p> <ul> <li>\u670d\u52a1\u7aef\u5728\u5173\u95ed\u8fde\u63a5\u4e4b\u524d\u53d1\u9001\u7684 <code>SEQ = 301</code> \u62a5\u6587\uff0c\u88ab\u7f51\u7edc\u5ef6\u8fdf\u4e86\u3002</li> <li>\u63a5\u7740\uff0c\u670d\u52a1\u7aef\u4ee5\u76f8\u540c\u7684\u56db\u5143\u7ec4\u91cd\u65b0\u6253\u5f00\u4e86\u65b0\u8fde\u63a5\uff0c\u524d\u9762\u88ab\u5ef6\u8fdf\u7684 <code>SEQ = 301</code> \u8fd9\u65f6\u62b5\u8fbe\u4e86\u5ba2\u6237\u7aef\uff0c\u800c\u4e14\u8be5\u6570\u636e\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u521a\u597d\u5728\u5ba2\u6237\u7aef\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u56e0\u6b64\u5ba2\u6237\u7aef\u4f1a\u6b63\u5e38\u63a5\u6536\u8fd9\u4e2a\u6570\u636e\u62a5\u6587\uff0c\u4f46\u662f\u8fd9\u4e2a\u6570\u636e\u62a5\u6587\u662f\u4e0a\u4e00\u4e2a\u8fde\u63a5\u6b8b\u7559\u4e0b\u6765\u7684\uff0c\u8fd9\u6837\u5c31\u4ea7\u751f\u6570\u636e\u9519\u4e71\u7b49\u4e25\u91cd\u7684\u95ee\u9898\u3002</li> </ul> <p>\u4e3a\u4e86\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536\uff0c\u56e0\u6b64 TCP \u8bbe\u8ba1\u4e86 TIME_WAIT \u72b6\u6001\uff0c\u72b6\u6001\u4f1a\u6301\u7eed <code>2MSL</code> \u65f6\u957f\uff0c\u8fd9\u4e2a\u65f6\u95f4\u8db3\u4ee5\u8ba9\u4e24\u4e2a\u65b9\u5411\u4e0a\u7684\u6570\u636e\u5305\u90fd\u88ab\u4e22\u5f03\uff0c\u4f7f\u5f97\u539f\u6765\u8fde\u63a5\u7684\u6570\u636e\u5305\u5728\u7f51\u7edc\u4e2d\u90fd\u81ea\u7136\u6d88\u5931\uff0c\u518d\u51fa\u73b0\u7684\u6570\u636e\u5305\u4e00\u5b9a\u90fd\u662f\u65b0\u5efa\u7acb\u8fde\u63a5\u6240\u4ea7\u751f\u7684\u3002</p> <p>\u539f\u56e0\u4e8c\uff1a\u4fdd\u8bc1\u300c\u88ab\u52a8\u5173\u95ed\u8fde\u63a5\u300d\u7684\u4e00\u65b9\uff0c\u80fd\u88ab\u6b63\u786e\u7684\u5173\u95ed</p> <p>\u5728 RFC 793 \u6307\u51fa TIME-WAIT \u53e6\u4e00\u4e2a\u91cd\u8981\u7684\u4f5c\u7528\u662f\uff1a</p> <p>TIME-WAIT - represents waiting for enough time to pass to be sure the remote TCP received the acknowledgment of its connection termination request.</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0cTIME-WAIT \u4f5c\u7528\u662f\u7b49\u5f85\u8db3\u591f\u7684\u65f6\u95f4\u4ee5\u786e\u4fdd\u6700\u540e\u7684 ACK \u80fd\u8ba9\u88ab\u52a8\u5173\u95ed\u65b9\u63a5\u6536\uff0c\u4ece\u800c\u5e2e\u52a9\u5176\u6b63\u5e38\u5173\u95ed\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u5173\u95ed\u65b9\uff09\u6700\u540e\u4e00\u6b21 ACK \u62a5\u6587\uff08\u7b2c\u56db\u6b21\u6325\u624b\uff09\u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u4e86\uff0c\u90a3\u4e48\u6309\u7167 TCP \u53ef\u9760\u6027\u539f\u5219\uff0c\u670d\u52a1\u7aef\uff08\u88ab\u52a8\u5173\u95ed\u65b9\uff09\u4f1a\u91cd\u53d1 FIN \u62a5\u6587\u3002</p> <p>\u5047\u8bbe\u5ba2\u6237\u7aef\u6ca1\u6709 TIME_WAIT \u72b6\u6001\uff0c\u800c\u662f\u5728\u53d1\u5b8c\u6700\u540e\u4e00\u6b21\u56de ACK \u62a5\u6587\u5c31\u76f4\u63a5\u8fdb\u5165 CLOSE \u72b6\u6001\uff0c\u5982\u679c\u8be5  ACK \u62a5\u6587\u4e22\u5931\u4e86\uff0c\u670d\u52a1\u7aef\u5219\u91cd\u4f20\u7684 FIN \u62a5\u6587\uff0c\u800c\u8fd9\u65f6\u5ba2\u6237\u7aef\u5df2\u7ecf\u8fdb\u5165\u5230\u5173\u95ed\u72b6\u6001\u4e86\uff0c\u5728\u6536\u5230\u670d\u52a1\u7aef\u91cd\u4f20\u7684 FIN \u62a5\u6587\u540e\uff0c\u5c31\u4f1a\u56de RST \u62a5\u6587\u3002</p> <p></p> <p>\u670d\u52a1\u7aef\u6536\u5230\u8fd9\u4e2a RST \u5e76\u5c06\u5176\u89e3\u91ca\u4e3a\u4e00\u4e2a\u9519\u8bef\uff08Connection reset by peer\uff09\uff0c\u8fd9\u5bf9\u4e8e\u4e00\u4e2a\u53ef\u9760\u7684\u534f\u8bae\u6765\u8bf4\u4e0d\u662f\u4e00\u4e2a\u4f18\u96c5\u7684\u7ec8\u6b62\u65b9\u5f0f\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u51fa\u73b0\uff0c\u5ba2\u6237\u7aef\u5fc5\u987b\u7b49\u5f85\u8db3\u591f\u957f\u7684\u65f6\u95f4\uff0c\u786e\u4fdd\u670d\u52a1\u7aef\u80fd\u591f\u6536\u5230 ACK\uff0c\u5982\u679c\u670d\u52a1\u7aef\u6ca1\u6709\u6536\u5230 ACK\uff0c\u90a3\u4e48\u5c31\u4f1a\u89e6\u53d1 TCP \u91cd\u4f20\u673a\u5236\uff0c\u670d\u52a1\u7aef\u4f1a\u91cd\u65b0\u53d1\u9001\u4e00\u4e2a FIN\uff0c\u8fd9\u6837\u4e00\u53bb\u4e00\u6765\u521a\u597d\u4e24\u4e2a MSL \u7684\u65f6\u95f4\u3002</p> <p></p> <p>\u5ba2\u6237\u7aef\u5728\u6536\u5230\u670d\u52a1\u7aef\u91cd\u4f20\u7684 FIN \u62a5\u6587\u65f6\uff0cTIME_WAIT \u72b6\u6001\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u4f1a\u91cd\u7f6e\u56de 2MSL\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#time_wait_1","title":"TIME_WAIT \u8fc7\u591a\u6709\u4ec0\u4e48\u5371\u5bb3\uff1f","text":"<p>\u8fc7\u591a\u7684 TIME-WAIT \u72b6\u6001\u4e3b\u8981\u7684\u5371\u5bb3\u6709\u4e24\u79cd\uff1a</p> <ul> <li>\u7b2c\u4e00\u662f\u5360\u7528\u7cfb\u7edf\u8d44\u6e90\uff0c\u6bd4\u5982\u6587\u4ef6\u63cf\u8ff0\u7b26\u3001\u5185\u5b58\u8d44\u6e90\u3001CPU \u8d44\u6e90\u3001\u7ebf\u7a0b\u8d44\u6e90\u7b49\uff1b</li> <li>\u7b2c\u4e8c\u662f\u5360\u7528\u7aef\u53e3\u8d44\u6e90\uff0c\u7aef\u53e3\u8d44\u6e90\u4e5f\u662f\u6709\u9650\u7684\uff0c\u4e00\u822c\u53ef\u4ee5\u5f00\u542f\u7684\u7aef\u53e3\u4e3a <code>32768\uff5e61000</code>\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7 <code>net.ipv4.ip_local_port_range</code>\u53c2\u6570\u6307\u5b9a\u8303\u56f4\u3002</li> </ul> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef TIME_WAIT \u8fc7\u591a\uff0c\u9020\u6210\u7684\u5f71\u54cd\u662f\u4e0d\u540c\u7684\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u53d1\u8d77\u5173\u95ed\u8fde\u63a5\u65b9\uff09\u7684 TIME_WAIT \u72b6\u6001\u8fc7\u591a\uff0c\u5360\u6ee1\u4e86\u6240\u6709\u7aef\u53e3\u8d44\u6e90\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u5bf9\u300c\u76ee\u7684 IP+ \u76ee\u7684 PORT\u300d\u90fd\u4e00\u6837\u7684\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\u4e86\uff0c\u4f46\u662f\u88ab\u4f7f\u7528\u7684\u7aef\u53e3\uff0c\u8fd8\u662f\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\u7684\u3002\u5177\u4f53\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1a\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u5417\uff1f</p> <p>\u56e0\u6b64\uff0c\u5ba2\u6237\u7aef\uff08\u53d1\u8d77\u8fde\u63a5\u65b9\uff09\u90fd\u662f\u548c\u300c\u76ee\u7684 IP+ \u76ee\u7684 PORT\u300d\u90fd\u4e00\u6837\u7684\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\u7684\u8bdd\uff0c\u5f53\u5ba2\u6237\u7aef\u7684 TIME_WAIT \u72b6\u6001\u8fde\u63a5\u8fc7\u591a\u7684\u8bdd\uff0c\u5c31\u4f1a\u53d7\u7aef\u53e3\u8d44\u6e90\u9650\u5236\uff0c\u5982\u679c\u5360\u6ee1\u4e86\u6240\u6709\u7aef\u53e3\u8d44\u6e90\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u518d\u8ddf\u300c\u76ee\u7684 IP+ \u76ee\u7684 PORT\u300d\u90fd\u4e00\u6837\u7684\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\u4e86\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5373\u4f7f\u662f\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u53ea\u8981\u8fde\u63a5\u7684\u662f\u4e0d\u540c\u7684\u670d\u52a1\u7aef\uff0c\u7aef\u53e3\u662f\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u8fd8\u662f\u53ef\u4ee5\u5411\u5176\u4ed6\u670d\u52a1\u7aef\u53d1\u8d77\u8fde\u63a5\u7684\uff0c\u8fd9\u662f\u56e0\u4e3a\u5185\u6838\u5728\u5b9a\u4f4d\u4e00\u4e2a\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u662f\u901a\u8fc7\u56db\u5143\u7ec4\uff08\u6e90 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684 IP\u3001\u76ee\u7684\u7aef\u53e3\uff09\u4fe1\u606f\u6765\u5b9a\u4f4d\u7684\uff0c\u5e76\u4e0d\u4f1a\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u4e00\u6837\uff0c\u800c\u5bfc\u81f4\u8fde\u63a5\u51b2\u7a81\u3002</p> <p>\u5982\u679c\u670d\u52a1\u7aef\uff08\u4e3b\u52a8\u53d1\u8d77\u5173\u95ed\u8fde\u63a5\u65b9\uff09\u7684 TIME_WAIT \u72b6\u6001\u8fc7\u591a\uff0c\u5e76\u4e0d\u4f1a\u5bfc\u81f4\u7aef\u53e3\u8d44\u6e90\u53d7\u9650\uff0c\u56e0\u4e3a\u670d\u52a1\u7aef\u53ea\u76d1\u542c\u4e00\u4e2a\u7aef\u53e3\uff0c\u800c\u4e14\u7531\u4e8e\u4e00\u4e2a\u56db\u5143\u7ec4\u552f\u4e00\u786e\u5b9a\u4e00\u4e2a TCP \u8fde\u63a5\uff0c\u56e0\u6b64\u7406\u8bba\u4e0a\u670d\u52a1\u7aef\u53ef\u4ee5\u5efa\u7acb\u5f88\u591a\u8fde\u63a5\uff0c\u4f46\u662f TCP \u8fde\u63a5\u8fc7\u591a\uff0c\u4f1a\u5360\u7528\u7cfb\u7edf\u8d44\u6e90\uff0c\u6bd4\u5982\u6587\u4ef6\u63cf\u8ff0\u7b26\u3001\u5185\u5b58\u8d44\u6e90\u3001CPU \u8d44\u6e90\u3001\u7ebf\u7a0b\u8d44\u6e90\u7b49\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#time_wait_2","title":"\u5982\u4f55\u4f18\u5316 TIME_WAIT\uff1f","text":"<p>\u8fd9\u91cc\u7ed9\u51fa\u4f18\u5316 TIME-WAIT \u7684\u51e0\u4e2a\u65b9\u5f0f\uff0c\u90fd\u662f\u6709\u5229\u6709\u5f0a\uff1a</p> <ul> <li>\u6253\u5f00 net.ipv4.tcp_tw_reuse \u548c net.ipv4.tcp_timestamps \u9009\u9879\uff1b</li> <li>net.ipv4.tcp_max_tw_buckets</li> <li>\u7a0b\u5e8f\u4e2d\u4f7f\u7528 SO_LINGER\uff0c\u5e94\u7528\u5f3a\u5236\u4f7f\u7528 RST \u5173\u95ed\u3002</li> </ul> <p>\u65b9\u5f0f\u4e00\uff1anet.ipv4.tcp_tw_reuse \u548c tcp_timestamps</p> <p>\u5982\u4e0b\u7684 Linux \u5185\u6838\u53c2\u6570\u5f00\u542f\u540e\uff0c\u5219\u53ef\u4ee5\u590d\u7528\u5904\u4e8e TIME_WAIT \u7684 socket \u4e3a\u65b0\u7684\u8fde\u63a5\u6240\u7528\u3002</p> <p>\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0ctcp_tw_reuse \u529f\u80fd\u53ea\u80fd\u7528\u5ba2\u6237\u7aef\uff08\u8fde\u63a5\u53d1\u8d77\u65b9\uff09\uff0c\u56e0\u4e3a\u5f00\u542f\u4e86\u8be5\u529f\u80fd\uff0c\u5728\u8c03\u7528 connect() \u51fd\u6570\u65f6\uff0c\u5185\u6838\u4f1a\u968f\u673a\u627e\u4e00\u4e2a time_wait \u72b6\u6001\u8d85\u8fc7 1 \u79d2\u7684\u8fde\u63a5\u7ed9\u65b0\u7684\u8fde\u63a5\u590d\u7528\u3002</p> Bash<pre><code>net.ipv4.tcp_tw_reuse = 1\n</code></pre> <p>\u4f7f\u7528\u8fd9\u4e2a\u9009\u9879\uff0c\u8fd8\u6709\u4e00\u4e2a\u524d\u63d0\uff0c\u9700\u8981\u6253\u5f00\u5bf9 TCP \u65f6\u95f4\u6233\u7684\u652f\u6301\uff0c\u5373</p> Text Only<pre><code>net.ipv4.tcp_timestamps=1\uff08\u9ed8\u8ba4\u5373\u4e3a 1\uff09\n</code></pre> <p>\u8fd9\u4e2a\u65f6\u95f4\u6233\u7684\u5b57\u6bb5\u662f\u5728 TCP \u5934\u90e8\u7684\u300c\u9009\u9879\u300d\u91cc\uff0c\u5b83\u7531\u4e00\u5171 8 \u4e2a\u5b57\u8282\u8868\u793a\u65f6\u95f4\u6233\uff0c\u5176\u4e2d\u7b2c\u4e00\u4e2a 4 \u5b57\u8282\u5b57\u6bb5\u7528\u6765\u4fdd\u5b58\u53d1\u9001\u8be5\u6570\u636e\u5305\u7684\u65f6\u95f4\uff0c\u7b2c\u4e8c\u4e2a 4 \u5b57\u8282\u5b57\u6bb5\u7528\u6765\u4fdd\u5b58\u6700\u8fd1\u4e00\u6b21\u63a5\u6536\u5bf9\u65b9\u53d1\u9001\u5230\u8fbe\u6570\u636e\u7684\u65f6\u95f4\u3002</p> <p>\u7531\u4e8e\u5f15\u5165\u4e86\u65f6\u95f4\u6233\uff0c\u6211\u4eec\u5728\u524d\u9762\u63d0\u5230\u7684 <code>2MSL</code> \u95ee\u9898\u5c31\u4e0d\u590d\u5b58\u5728\u4e86\uff0c\u56e0\u4e3a\u91cd\u590d\u7684\u6570\u636e\u5305\u4f1a\u56e0\u4e3a\u65f6\u95f4\u6233\u8fc7\u671f\u88ab\u81ea\u7136\u4e22\u5f03\u3002</p> <p>\u65b9\u5f0f\u4e8c\uff1anet.ipv4.tcp_max_tw_buckets</p> <p>\u8fd9\u4e2a\u503c\u9ed8\u8ba4\u4e3a 18000\uff0c\u5f53\u7cfb\u7edf\u4e2d\u5904\u4e8e TIME_WAIT \u7684\u8fde\u63a5\u4e00\u65e6\u8d85\u8fc7\u8fd9\u4e2a\u503c\u65f6\uff0c\u7cfb\u7edf\u5c31\u4f1a\u5c06\u540e\u9762\u7684 TIME_WAIT \u8fde\u63a5\u72b6\u6001\u91cd\u7f6e\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u6bd4\u8f83\u66b4\u529b\u3002</p> <p>\u65b9\u5f0f\u4e09\uff1a\u7a0b\u5e8f\u4e2d\u4f7f\u7528 SO_LINGER</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e socket \u9009\u9879\uff0c\u6765\u8bbe\u7f6e\u8c03\u7528 close \u5173\u95ed\u8fde\u63a5\u884c\u4e3a\u3002</p> C<pre><code>struct linger so_linger;\nso_linger.l_onoff = 1;\nso_linger.l_linger = 0;\nsetsockopt(s, SOL_SOCKET, SO_LINGER, &amp;so_linger,sizeof(so_linger));\n</code></pre> <p>\u5982\u679c<code>l_onoff</code>\u4e3a\u975e 0\uff0c\u4e14<code>l_linger</code>\u503c\u4e3a 0\uff0c\u90a3\u4e48\u8c03\u7528<code>close</code>\u540e\uff0c\u4f1a\u7acb\u8be5\u53d1\u9001\u4e00\u4e2a<code>RST</code>\u6807\u5fd7\u7ed9\u5bf9\u7aef\uff0c\u8be5 TCP \u8fde\u63a5\u5c06\u8df3\u8fc7\u56db\u6b21\u6325\u624b\uff0c\u4e5f\u5c31\u8df3\u8fc7\u4e86<code>TIME_WAIT</code>\u72b6\u6001\uff0c\u76f4\u63a5\u5173\u95ed\u3002</p> <p>\u4f46\u8fd9\u4e3a\u8de8\u8d8a<code>TIME_WAIT</code>\u72b6\u6001\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53ef\u80fd\uff0c\u4e0d\u8fc7\u662f\u4e00\u4e2a\u975e\u5e38\u5371\u9669\u7684\u884c\u4e3a\uff0c\u4e0d\u503c\u5f97\u63d0\u5021\u3002</p> <p>\u524d\u9762\u4ecb\u7ecd\u7684\u65b9\u6cd5\u90fd\u662f\u8bd5\u56fe\u8d8a\u8fc7 <code>TIME_WAIT</code>\u72b6\u6001\u7684\uff0c\u8fd9\u6837\u5176\u5b9e\u4e0d\u592a\u597d\u3002\u867d\u7136 TIME_WAIT \u72b6\u6001\u6301\u7eed\u7684\u65f6\u95f4\u662f\u6709\u4e00\u70b9\u957f\uff0c\u663e\u5f97\u5f88\u4e0d\u53cb\u597d\uff0c\u4f46\u662f\u5b83\u88ab\u8bbe\u8ba1\u6765\u5c31\u662f\u7528\u6765\u907f\u514d\u53d1\u751f\u4e71\u4e03\u516b\u7cdf\u7684\u4e8b\u60c5\u3002</p> <p>\u300aUNIX \u7f51\u7edc\u7f16\u7a0b\u300b\u4e00\u4e66\u4e2d\u5374\u8bf4\u9053\uff1aTIME_WAIT \u662f\u6211\u4eec\u7684\u670b\u53cb\uff0c\u5b83\u662f\u6709\u52a9\u4e8e\u6211\u4eec\u7684\uff0c\u4e0d\u8981\u8bd5\u56fe\u907f\u514d\u8fd9\u4e2a\u72b6\u6001\uff0c\u800c\u662f\u5e94\u8be5\u5f04\u6e05\u695a\u5b83\u3002</p> <p>\u5982\u679c\u670d\u52a1\u7aef\u8981\u907f\u514d\u8fc7\u591a\u7684 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u5c31\u6c38\u8fdc\u4e0d\u8981\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5\uff0c\u8ba9\u5ba2\u6237\u7aef\u53bb\u65ad\u5f00\uff0c\u7531\u5206\u5e03\u5728\u5404\u5904\u7684\u5ba2\u6237\u7aef\u53bb\u627f\u53d7 TIME_WAIT\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#time_wait_3","title":"\u670d\u52a1\u5668\u51fa\u73b0\u5927\u91cf TIME_WAIT \u72b6\u6001\u7684\u539f\u56e0\u6709\u54ea\u4e9b\uff1f","text":"<p>\u9996\u5148\u8981\u77e5\u9053 TIME_WAIT \u72b6\u6001\u662f\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u65b9\u624d\u4f1a\u51fa\u73b0\u7684\u72b6\u6001\uff0c\u6240\u4ee5\u5982\u679c\u670d\u52a1\u5668\u51fa\u73b0\u5927\u91cf\u7684 TIME_WAIT \u72b6\u6001\u7684 TCP \u8fde\u63a5\uff0c\u5c31\u662f\u8bf4\u660e\u670d\u52a1\u5668\u4e3b\u52a8\u65ad\u5f00\u4e86\u5f88\u591a TCP \u8fde\u63a5\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u4ec0\u4e48\u573a\u666f\u4e0b\u670d\u52a1\u7aef\u4f1a\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5\u5462\uff1f</p> <ul> <li>\u7b2c\u4e00\u4e2a\u573a\u666f\uff1aHTTP \u6ca1\u6709\u4f7f\u7528\u957f\u8fde\u63a5</li> <li>\u7b2c\u4e8c\u4e2a\u573a\u666f\uff1aHTTP \u957f\u8fde\u63a5\u8d85\u65f6</li> <li>\u7b2c\u4e09\u4e2a\u573a\u666f\uff1aHTTP \u957f\u8fde\u63a5\u7684\u8bf7\u6c42\u6570\u91cf\u8fbe\u5230\u4e0a\u9650</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u5206\u522b\u4ecb\u7ecd\u4e0b\u3002</p> <p>\u7b2c\u4e00\u4e2a\u573a\u666f\uff1aHTTP \u6ca1\u6709\u4f7f\u7528\u957f\u8fde\u63a5</p> <p>\u6211\u4eec\u5148\u6765\u770b\u770b HTTP \u957f\u8fde\u63a5\uff08Keep-Alive\uff09\u673a\u5236\u662f\u600e\u4e48\u5f00\u542f\u7684\u3002</p> <p>\u5728 HTTP/1.0 \u4e2d\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff0c\u5982\u679c\u6d4f\u89c8\u5668\u8981\u5f00\u542f Keep-Alive\uff0c\u5b83\u5fc5\u987b\u5728\u8bf7\u6c42\u7684 header \u4e2d\u6dfb\u52a0\uff1a</p> Text Only<pre><code>Connection: Keep-Alive\n</code></pre> <p>\u7136\u540e\u5f53\u670d\u52a1\u5668\u6536\u5230\u8bf7\u6c42\uff0c\u4f5c\u51fa\u56de\u5e94\u7684\u65f6\u5019\uff0c\u5b83\u4e5f\u88ab\u6dfb\u52a0\u5230\u54cd\u5e94\u4e2d header \u91cc\uff1a</p> Text Only<pre><code>Connection: Keep-Alive\n</code></pre> <p>\u8fd9\u6837\u505a\uff0cTCP \u8fde\u63a5\u5c31\u4e0d\u4f1a\u4e2d\u65ad\uff0c\u800c\u662f\u4fdd\u6301\u8fde\u63a5\u3002\u5f53\u5ba2\u6237\u7aef\u53d1\u9001\u53e6\u4e00\u4e2a\u8bf7\u6c42\u65f6\uff0c\u5b83\u4f1a\u4f7f\u7528\u540c\u4e00\u4e2a TCP \u8fde\u63a5\u3002\u8fd9\u4e00\u76f4\u7ee7\u7eed\u5230\u5ba2\u6237\u7aef\u6216\u670d\u52a1\u5668\u7aef\u63d0\u51fa\u65ad\u5f00\u8fde\u63a5\u3002</p> <p>\u4ece HTTP/1.1 \u5f00\u59cb\uff0c\u5c31\u9ed8\u8ba4\u662f\u5f00\u542f\u4e86 Keep-Alive\uff0c\u73b0\u5728\u5927\u591a\u6570\u6d4f\u89c8\u5668\u90fd\u9ed8\u8ba4\u662f\u4f7f\u7528 HTTP/1.1\uff0c\u6240\u4ee5 Keep-Alive \u90fd\u662f\u9ed8\u8ba4\u6253\u5f00\u7684\u3002\u4e00\u65e6\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u8fbe\u6210\u534f\u8bae\uff0c\u90a3\u4e48\u957f\u8fde\u63a5\u5c31\u5efa\u7acb\u597d\u4e86\u3002</p> <p>\u5982\u679c\u8981\u5173\u95ed HTTP Keep-Alive\uff0c\u9700\u8981\u5728 HTTP \u8bf7\u6c42\u6216\u8005\u54cd\u5e94\u7684 header \u91cc\u6dfb\u52a0 <code>Connection:close</code> \u4fe1\u606f\uff0c\u4e5f\u5c31\u662f\u8bf4\uff0c\u53ea\u8981\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4efb\u610f\u4e00\u65b9\u7684 HTTP header \u4e2d\u6709 <code>Connection:close</code> \u4fe1\u606f\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u4f7f\u7528 HTTP \u957f\u8fde\u63a5\u7684\u673a\u5236\u3002</p> <p>\u5173\u95ed HTTP \u957f\u8fde\u63a5\u673a\u5236\u540e\uff0c\u6bcf\u6b21\u8bf7\u6c42\u90fd\u8981\u7ecf\u5386\u8fd9\u6837\u7684\u8fc7\u7a0b\uff1a\u5efa\u7acb TCP -&gt; \u8bf7\u6c42\u8d44\u6e90 -&gt; \u54cd\u5e94\u8d44\u6e90 -&gt; \u91ca\u653e\u8fde\u63a5\uff0c\u90a3\u4e48\u6b64\u65b9\u5f0f\u5c31\u662f HTTP \u77ed\u8fde\u63a5\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\uff0c\u53ea\u8981\u4efb\u610f\u4e00\u65b9\u7684 HTTP header \u4e2d\u6709 <code>Connection:close</code> \u4fe1\u606f\uff0c\u5c31\u65e0\u6cd5\u4f7f\u7528 HTTP \u957f\u8fde\u63a5\u673a\u5236\uff0c\u8fd9\u6837\u5728\u5b8c\u6210\u4e00\u6b21 HTTP \u8bf7\u6c42/\u5904\u7406\u540e\uff0c\u5c31\u4f1a\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u8fd9\u65f6\u5019\u662f\u5ba2\u6237\u7aef\u8fd8\u662f\u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u5462\uff1f</p> <p>\u5728 RFC \u6587\u6863\u4e2d\uff0c\u5e76\u6ca1\u6709\u660e\u786e\u7531\u8c01\u6765\u5173\u95ed\u8fde\u63a5\uff0c\u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u53cc\u65b9\u90fd\u53ef\u4ee5\u4e3b\u52a8\u5173\u95ed TCP \u8fde\u63a5\u3002</p> <p>\u4e0d\u8fc7\uff0c\u6839\u636e\u5927\u591a\u6570 Web \u670d\u52a1\u7684\u5b9e\u73b0\uff0c\u4e0d\u7ba1\u54ea\u4e00\u65b9\u7981\u7528\u4e86 HTTP Keep-Alive\uff0c\u90fd\u662f\u7531\u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\uff0c\u90a3\u4e48\u6b64\u65f6\u670d\u52a1\u7aef\u4e0a\u5c31\u4f1a\u51fa\u73b0 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u3002</p> <p>\u5ba2\u6237\u7aef\u7981\u7528\u4e86 HTTP Keep-Alive\uff0c\u670d\u52a1\u7aef\u5f00\u542f HTTP Keep-Alive\uff0c\u8c01\u662f\u4e3b\u52a8\u5173\u95ed\u65b9\uff1f </p> <p>\u5f53\u5ba2\u6237\u7aef\u7981\u7528\u4e86 HTTP Keep-Alive\uff0c\u8fd9\u65f6\u5019 HTTP \u8bf7\u6c42\u7684 header \u5c31\u4f1a\u6709 <code>Connection:close</code> \u4fe1\u606f\uff0c\u8fd9\u65f6\u670d\u52a1\u7aef\u5728\u53d1\u5b8c HTTP \u54cd\u5e94\u540e\uff0c\u5c31\u4f1a\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1\u5462\uff1fHTTP \u662f\u8bf7\u6c42 - \u54cd\u5e94\u6a21\u578b\uff0c\u53d1\u8d77\u65b9\u4e00\u76f4\u662f\u5ba2\u6237\u7aef\uff0cHTTP Keep-Alive \u7684\u521d\u8877\u662f\u4e3a\u5ba2\u6237\u7aef\u540e\u7eed\u7684\u8bf7\u6c42\u91cd\u7528\u8fde\u63a5\uff0c\u5982\u679c\u6211\u4eec\u5728\u67d0\u6b21 HTTP \u8bf7\u6c42 - \u54cd\u5e94\u6a21\u578b\u4e2d\uff0c\u8bf7\u6c42\u7684 header \u5b9a\u4e49\u4e86 <code>connection\uff1aclose</code> \u4fe1\u606f\uff0c\u90a3\u4e0d\u518d\u91cd\u7528\u8fd9\u4e2a\u8fde\u63a5\u7684\u65f6\u673a\u5c31\u53ea\u6709\u5728\u670d\u52a1\u7aef\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u5728 HTTP \u8bf7\u6c42 - \u54cd\u5e94\u8fd9\u4e2a\u5468\u671f\u7684\u300c\u672b\u7aef\u300d\u5173\u95ed\u8fde\u63a5\u662f\u5408\u7406\u7684\u3002</p> <p>\u5ba2\u6237\u7aef\u5f00\u542f\u4e86 HTTP Keep-Alive\uff0c\u670d\u52a1\u7aef\u7981\u7528\u4e86 HTTP Keep-Alive\uff0c\u8c01\u662f\u4e3b\u52a8\u5173\u95ed\u65b9\uff1f </p> <p>\u5f53\u5ba2\u6237\u7aef\u5f00\u542f\u4e86 HTTP Keep-Alive\uff0c\u800c\u670d\u52a1\u7aef\u7981\u7528\u4e86 HTTP Keep-Alive\uff0c\u8fd9\u65f6\u670d\u52a1\u7aef\u5728\u53d1\u5b8c HTTP \u54cd\u5e94\u540e\uff0c\u670d\u52a1\u7aef\u4e5f\u4f1a\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u8fd9\u4e48\u8bbe\u8ba1\u5462\uff1f\u5728\u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u7684\u60c5\u51b5\u4e0b\uff0c\u53ea\u8981\u8c03\u7528\u4e00\u6b21 close() \u5c31\u53ef\u4ee5\u91ca\u653e\u8fde\u63a5\uff0c\u5269\u4e0b\u7684\u5de5\u4f5c\u7531\u5185\u6838 TCP \u6808\u76f4\u63a5\u8fdb\u884c\u4e86\u5904\u7406\uff0c\u6574\u4e2a\u8fc7\u7a0b\u53ea\u6709\u4e00\u6b21 syscall\uff1b\u5982\u679c\u662f\u8981\u6c42 \u5ba2\u6237\u7aef\u5173\u95ed\uff0c\u5219\u670d\u52a1\u7aef\u5728\u5199\u5b8c\u6700\u540e\u4e00\u4e2a response \u4e4b\u540e\u9700\u8981\u628a\u8fd9\u4e2a socket \u653e\u5165 readable \u961f\u5217\uff0c\u8c03\u7528 select / epoll \u53bb\u7b49\u5f85\u4e8b\u4ef6\uff1b\u7136\u540e\u8c03\u7528\u4e00\u6b21 read() \u624d\u80fd\u77e5\u9053\u8fde\u63a5\u5df2\u7ecf\u88ab\u5173\u95ed\uff0c\u8fd9\u5176\u4e2d\u662f\u4e24\u6b21 syscall\uff0c\u591a\u4e00\u6b21\u7528\u6237\u6001\u7a0b\u5e8f\u88ab\u6fc0\u6d3b\u6267\u884c\uff0c\u800c\u4e14 socket \u4fdd\u6301\u65f6\u95f4\u4e5f\u4f1a\u66f4\u957f\u3002</p> <p>\u56e0\u6b64\uff0c\u5f53\u670d\u52a1\u7aef\u51fa\u73b0\u5927\u91cf\u7684 TIME_WAIT \u72b6\u6001\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u6392\u67e5\u4e0b\u662f\u5426\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u5f00\u542f\u4e86 HTTP Keep-Alive\uff0c\u56e0\u4e3a\u4efb\u610f\u4e00\u65b9\u6ca1\u6709\u5f00\u542f  HTTP Keep-Alive\uff0c\u90fd\u4f1a\u5bfc\u81f4\u670d\u52a1\u7aef\u5728\u5904\u7406\u5b8c\u4e00\u4e2a HTTP \u8bf7\u6c42\u540e\uff0c\u5c31\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u4e0a\u5c31\u4f1a\u51fa\u73b0\u5927\u91cf\u7684 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u3002</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u89e3\u51b3\u7684\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u8ba9\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u5f00\u542f HTTP Keep-Alive \u673a\u5236\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u573a\u666f\uff1aHTTP \u957f\u8fde\u63a5\u8d85\u65f6</p> <p>HTTP \u957f\u8fde\u63a5\u7684\u7279\u70b9\u662f\uff0c\u53ea\u8981\u4efb\u610f\u4e00\u7aef\u6ca1\u6709\u660e\u786e\u63d0\u51fa\u65ad\u5f00\u8fde\u63a5\uff0c\u5219\u4fdd\u6301 TCP \u8fde\u63a5\u72b6\u6001\u3002</p> <p>HTTP \u957f\u8fde\u63a5\u53ef\u4ee5\u5728\u540c\u4e00\u4e2a TCP \u8fde\u63a5\u4e0a\u63a5\u6536\u548c\u53d1\u9001\u591a\u4e2a HTTP \u8bf7\u6c42/\u5e94\u7b54\uff0c\u907f\u514d\u4e86\u8fde\u63a5\u5efa\u7acb\u548c\u91ca\u653e\u7684\u5f00\u9500\u3002</p> <p></p> <p>\u53ef\u80fd\u6709\u7684\u540c\u5b66\u4f1a\u95ee\uff0c\u5982\u679c\u4f7f\u7528\u4e86 HTTP \u957f\u8fde\u63a5\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5b8c\u6210\u4e00\u4e2a HTTP \u8bf7\u6c42\u540e\uff0c\u5c31\u4e0d\u518d\u53d1\u8d77\u65b0\u7684\u8bf7\u6c42\uff0c\u6b64\u65f6\u8fd9\u4e2a TCP \u8fde\u63a5\u4e00\u76f4\u5360\u7528\u7740\u4e0d\u662f\u633a\u6d6a\u8d39\u8d44\u6e90\u7684\u5417\uff1f</p> <p>\u5bf9\u6ca1\u9519\uff0c\u6240\u4ee5\u4e3a\u4e86\u907f\u514d\u8d44\u6e90\u6d6a\u8d39\u7684\u60c5\u51b5\uff0cweb \u670d\u52a1\u8f6f\u4ef6\u4e00\u822c\u90fd\u4f1a\u63d0\u4f9b\u4e00\u4e2a\u53c2\u6570\uff0c\u7528\u6765\u6307\u5b9a HTTP \u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\uff0c\u6bd4\u5982 nginx \u63d0\u4f9b\u7684 keepalive_timeout \u53c2\u6570\u3002</p> <p>\u5047\u8bbe\u8bbe\u7f6e\u4e86 HTTP \u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u662f 60 \u79d2\uff0cnginx \u5c31\u4f1a\u542f\u52a8\u4e00\u4e2a\u300c\u5b9a\u65f6\u5668\u300d\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5728\u5b8c\u540e\u4e00\u4e2a HTTP \u8bf7\u6c42\u540e\uff0c\u5728 60 \u79d2\u5185\u90fd\u6ca1\u6709\u518d\u53d1\u8d77\u65b0\u7684\u8bf7\u6c42\uff0c\u5b9a\u65f6\u5668\u7684\u65f6\u95f4\u4e00\u5230\uff0cnginx \u5c31\u4f1a\u89e6\u53d1\u56de\u8c03\u51fd\u6570\u6765\u5173\u95ed\u8be5\u8fde\u63a5\uff0c\u90a3\u4e48\u6b64\u65f6\u670d\u52a1\u7aef\u4e0a\u5c31\u4f1a\u51fa\u73b0 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u3002</p> <p></p> <p>\u5f53\u670d\u52a1\u7aef\u51fa\u73b0\u5927\u91cf TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u65f6\uff0c\u5982\u679c\u73b0\u8c61\u662f\u6709\u5927\u91cf\u7684\u5ba2\u6237\u7aef\u5efa\u7acb\u5b8c TCP \u8fde\u63a5\u540e\uff0c\u5f88\u957f\u4e00\u6bb5\u65f6\u95f4\u6ca1\u6709\u53d1\u9001\u6570\u636e\uff0c\u90a3\u4e48\u5927\u6982\u7387\u5c31\u662f\u56e0\u4e3a HTTP \u957f\u8fde\u63a5\u8d85\u65f6\uff0c\u5bfc\u81f4\u670d\u52a1\u7aef\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\uff0c\u4ea7\u751f\u5927\u91cf\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u3002</p> <p>\u53ef\u4ee5\u5f80\u7f51\u7edc\u95ee\u9898\u7684\u65b9\u5411\u6392\u67e5\uff0c\u6bd4\u5982\u662f\u5426\u662f\u56e0\u4e3a\u7f51\u7edc\u95ee\u9898\uff0c\u5bfc\u81f4\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6570\u636e\u4e00\u76f4\u6ca1\u6709\u88ab\u670d\u52a1\u7aef\u63a5\u6536\u5230\uff0c\u4ee5\u81f3\u4e8e HTTP \u957f\u8fde\u63a5\u8d85\u65f6\u3002</p> <p>\u7b2c\u4e09\u4e2a\u573a\u666f\uff1aHTTP \u957f\u8fde\u63a5\u7684\u8bf7\u6c42\u6570\u91cf\u8fbe\u5230\u4e0a\u9650</p> <p>Web \u670d\u52a1\u7aef\u901a\u5e38\u4f1a\u6709\u4e2a\u53c2\u6570\uff0c\u6765\u5b9a\u4e49\u4e00\u6761 HTTP \u957f\u8fde\u63a5\u4e0a\u6700\u5927\u80fd\u5904\u7406\u7684\u8bf7\u6c42\u6570\u91cf\uff0c\u5f53\u8d85\u8fc7\u6700\u5927\u9650\u5236\u65f6\uff0c\u5c31\u4f1a\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u6bd4\u5982 nginx \u7684 keepalive_requests \u8fd9\u4e2a\u53c2\u6570\uff0c\u8fd9\u4e2a\u53c2\u6570\u662f\u6307\u4e00\u4e2a HTTP \u957f\u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0cnginx \u5c31\u4f1a\u4e3a\u8fd9\u4e2a\u8fde\u63a5\u8bbe\u7f6e\u4e00\u4e2a\u8ba1\u6570\u5668\uff0c\u8bb0\u5f55\u8fd9\u4e2a HTTP \u957f\u8fde\u63a5\u4e0a\u5df2\u7ecf\u63a5\u6536\u5e76\u5904\u7406\u7684\u5ba2\u6237\u7aef\u8bf7\u6c42\u7684\u6570\u91cf\u3002\u5982\u679c\u8fbe\u5230\u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\u7684\u6700\u5927\u503c\u65f6\uff0c\u5219 nginx \u4f1a\u4e3b\u52a8\u5173\u95ed\u8fd9\u4e2a\u957f\u8fde\u63a5\uff0c\u90a3\u4e48\u6b64\u65f6\u670d\u52a1\u7aef\u4e0a\u5c31\u4f1a\u51fa\u73b0 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u3002</p> <p>keepalive_requests \u53c2\u6570\u7684\u9ed8\u8ba4\u503c\u662f 100\uff0c\u610f\u5473\u7740\u6bcf\u4e2a HTTP \u957f\u8fde\u63a5\u6700\u591a\u53ea\u80fd\u8dd1 100  \u6b21\u8bf7\u6c42\uff0c\u8fd9\u4e2a\u53c2\u6570\u5f80\u5f80\u88ab\u5927\u591a\u6570\u4eba\u5ffd\u7565\uff0c\u56e0\u4e3a\u5f53 QPS (\u6bcf\u79d2\u8bf7\u6c42\u6570) \u4e0d\u662f\u5f88\u9ad8\u65f6\uff0c\u9ed8\u8ba4\u503c 100 \u51d1\u5408\u591f\u7528\u3002</p> <p>\u4f46\u662f\uff0c\u5bf9\u4e8e\u4e00\u4e9b QPS \u6bd4\u8f83\u9ad8\u7684\u573a\u666f\uff0c\u6bd4\u5982\u8d85\u8fc7 10000 QPS\uff0c\u751a\u81f3\u8fbe\u5230 30000 , 50000 \u751a\u81f3\u66f4\u9ad8\uff0c\u5982\u679c keepalive_requests \u53c2\u6570\u503c\u662f 100\uff0c\u8fd9\u65f6\u5019\u5c31 nginx \u5c31\u4f1a\u5f88\u9891\u7e41\u5730\u5173\u95ed\u8fde\u63a5\uff0c\u90a3\u4e48\u6b64\u65f6\u670d\u52a1\u7aef\u4e0a\u5c31\u4f1a\u51fa\u5927\u91cf\u7684 TIME_WAIT \u72b6\u6001\u3002</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u573a\u666f\u4e0b\uff0c\u89e3\u51b3\u7684\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u8c03\u5927 nginx \u7684 keepalive_requests \u53c2\u6570\u5c31\u884c\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#close_wait","title":"\u670d\u52a1\u5668\u51fa\u73b0\u5927\u91cf CLOSE_WAIT \u72b6\u6001\u7684\u539f\u56e0\u6709\u54ea\u4e9b\uff1f","text":"<p>CLOSE_WAIT \u72b6\u6001\u662f\u300c\u88ab\u52a8\u5173\u95ed\u65b9\u300d\u624d\u4f1a\u6709\u7684\u72b6\u6001\uff0c\u800c\u4e14\u5982\u679c\u300c\u88ab\u52a8\u5173\u95ed\u65b9\u300d\u6ca1\u6709\u8c03\u7528 close \u51fd\u6570\u5173\u95ed\u8fde\u63a5\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u53d1\u51fa FIN \u62a5\u6587\uff0c\u4ece\u800c\u65e0\u6cd5\u4f7f\u5f97 CLOSE_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u8f6c\u53d8\u4e3a LAST_ACK \u72b6\u6001\u3002</p> <p>\u6240\u4ee5\uff0c\u5f53\u670d\u52a1\u7aef\u51fa\u73b0\u5927\u91cf CLOSE_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u8bf4\u660e\u670d\u52a1\u7aef\u7684\u7a0b\u5e8f\u6ca1\u6709\u8c03\u7528 close \u51fd\u6570\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u90a3\u4ec0\u4e48\u60c5\u51b5\u4f1a\u5bfc\u81f4\u670d\u52a1\u7aef\u7684\u7a0b\u5e8f\u6ca1\u6709\u8c03\u7528 close \u51fd\u6570\u5173\u95ed\u8fde\u63a5\uff1f\u8fd9\u65f6\u5019\u901a\u5e38\u9700\u8981\u6392\u67e5\u4ee3\u7801\u3002</p> <p>\u6211\u4eec\u5148\u6765\u5206\u6790\u4e00\u4e2a\u666e\u901a\u7684 TCP \u670d\u52a1\u7aef\u7684\u6d41\u7a0b\uff1a</p> <ol> <li>\u521b\u5efa\u670d\u52a1\u7aef socket\uff0cbind \u7ed1\u5b9a\u7aef\u53e3\u3001listen \u76d1\u542c\u7aef\u53e3</li> <li>\u5c06\u670d\u52a1\u7aef socket \u6ce8\u518c\u5230 epoll</li> <li>epoll_wait \u7b49\u5f85\u8fde\u63a5\u5230\u6765\uff0c\u8fde\u63a5\u5230\u6765\u65f6\uff0c\u8c03\u7528 accpet \u83b7\u53d6\u5df2\u8fde\u63a5\u7684 socket</li> <li>\u5c06\u5df2\u8fde\u63a5\u7684 socket \u6ce8\u518c\u5230 epoll</li> <li>epoll_wait \u7b49\u5f85\u4e8b\u4ef6\u53d1\u751f</li> <li>\u5bf9\u65b9\u8fde\u63a5\u5173\u95ed\u65f6\uff0c\u6211\u65b9\u8c03\u7528 close</li> </ol> <p>\u53ef\u80fd\u5bfc\u81f4\u670d\u52a1\u7aef\u6ca1\u6709\u8c03\u7528 close \u51fd\u6570\u7684\u539f\u56e0\uff0c\u5982\u4e0b\u3002</p> <p>\u7b2c\u4e00\u4e2a\u539f\u56e0\uff1a\u7b2c 2 \u6b65\u6ca1\u6709\u505a\uff0c\u6ca1\u6709\u5c06\u670d\u52a1\u7aef socket \u6ce8\u518c\u5230 epoll\uff0c\u8fd9\u6837\u6709\u65b0\u8fde\u63a5\u5230\u6765\u65f6\uff0c\u670d\u52a1\u7aef\u6ca1\u529e\u6cd5\u611f\u77e5\u8fd9\u4e2a\u4e8b\u4ef6\uff0c\u4e5f\u5c31\u65e0\u6cd5\u83b7\u53d6\u5230\u5df2\u8fde\u63a5\u7684 socket\uff0c\u90a3\u670d\u52a1\u7aef\u81ea\u7136\u5c31\u6ca1\u673a\u4f1a\u5bf9 socket \u8c03\u7528 close \u51fd\u6570\u4e86\u3002</p> <p>\u4e0d\u8fc7\u8fd9\u79cd\u539f\u56e0\u53d1\u751f\u7684\u6982\u7387\u6bd4\u8f83\u5c0f\uff0c\u8fd9\u79cd\u5c5e\u4e8e\u660e\u663e\u7684\u4ee3\u7801\u903b\u8f91 bug\uff0c\u5728\u524d\u671f read view \u9636\u6bb5\u5c31\u80fd\u53d1\u73b0\u7684\u4e86\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u539f\u56e0\uff1a\u7b2c 3 \u6b65\u6ca1\u6709\u505a\uff0c\u6709\u65b0\u8fde\u63a5\u5230\u6765\u65f6\u6ca1\u6709\u8c03\u7528 accpet \u83b7\u53d6\u8be5\u8fde\u63a5\u7684 socket\uff0c\u5bfc\u81f4\u5f53\u6709\u5927\u91cf\u7684\u5ba2\u6237\u7aef\u4e3b\u52a8\u65ad\u5f00\u4e86\u8fde\u63a5\uff0c\u800c\u670d\u52a1\u7aef\u6ca1\u673a\u4f1a\u5bf9\u8fd9\u4e9b socket \u8c03\u7528 close \u51fd\u6570\uff0c\u4ece\u800c\u5bfc\u81f4\u670d\u52a1\u7aef\u51fa\u73b0\u5927\u91cf CLOSE_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u3002</p> <p>\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u53ef\u80fd\u662f\u56e0\u4e3a\u670d\u52a1\u7aef\u5728\u6267\u884c accpet  \u51fd\u6570\u4e4b\u524d\uff0c\u4ee3\u7801\u5361\u5728\u67d0\u4e00\u4e2a\u903b\u8f91\u6216\u8005\u63d0\u524d\u629b\u51fa\u4e86\u5f02\u5e38\u3002</p> <p>\u7b2c\u4e09\u4e2a\u539f\u56e0\uff1a\u7b2c 4 \u6b65\u6ca1\u6709\u505a\uff0c\u901a\u8fc7 accpet \u83b7\u53d6\u5df2\u8fde\u63a5\u7684 socket \u540e\uff0c\u6ca1\u6709\u5c06\u5176\u6ce8\u518c\u5230 epoll\uff0c\u5bfc\u81f4\u540e\u7eed\u6536\u5230 FIN \u62a5\u6587\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u6ca1\u529e\u6cd5\u611f\u77e5\u8fd9\u4e2a\u4e8b\u4ef6\uff0c\u90a3\u670d\u52a1\u7aef\u5c31\u6ca1\u673a\u4f1a\u8c03\u7528 close \u51fd\u6570\u4e86\u3002</p> <p>\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u53ef\u80fd\u662f\u56e0\u4e3a\u670d\u52a1\u7aef\u5728\u5c06\u5df2\u8fde\u63a5\u7684 socket \u6ce8\u518c\u5230 epoll \u4e4b\u524d\uff0c\u4ee3\u7801\u5361\u5728\u67d0\u4e00\u4e2a\u903b\u8f91\u6216\u8005\u63d0\u524d\u629b\u51fa\u4e86\u5f02\u5e38\u3002\u4e4b\u524d\u770b\u5230\u8fc7\u522b\u4eba\u89e3\u51b3 close_wait \u95ee\u9898\u7684\u5b9e\u8df5\u6587\u7ae0\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u770b\u770b\uff1a\u4e00\u6b21 Netty \u4ee3\u7801\u4e0d\u5065\u58ee\u5bfc\u81f4\u7684\u5927\u91cf CLOSE_WAIT \u8fde\u63a5\u539f\u56e0\u5206\u6790</p> <p>\u7b2c\u56db\u4e2a\u539f\u56e0\uff1a\u7b2c 6 \u6b65\u6ca1\u6709\u505a\uff0c\u5f53\u53d1\u73b0\u5ba2\u6237\u7aef\u5173\u95ed\u8fde\u63a5\u540e\uff0c\u670d\u52a1\u7aef\u6ca1\u6709\u6267\u884c close \u51fd\u6570\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u4ee3\u7801\u6f0f\u5904\u7406\uff0c\u6216\u8005\u662f\u5728\u6267\u884c close \u51fd\u6570\u4e4b\u524d\uff0c\u4ee3\u7801\u5361\u5728\u67d0\u4e00\u4e2a\u903b\u8f91\uff0c\u6bd4\u5982\u53d1\u751f\u6b7b\u9501\u7b49\u7b49\u3002</p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53\u670d\u52a1\u7aef\u51fa\u73b0\u5927\u91cf CLOSE_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u901a\u5e38\u90fd\u662f\u4ee3\u7801\u7684\u95ee\u9898\uff0c\u8fd9\u65f6\u5019\u6211\u4eec\u9700\u8981\u9488\u5bf9\u5177\u4f53\u7684\u4ee3\u7801\u4e00\u6b65\u4e00\u6b65\u7684\u8fdb\u884c\u6392\u67e5\u548c\u5b9a\u4f4d\uff0c\u4e3b\u8981\u5206\u6790\u7684\u65b9\u5411\u5c31\u662f\u670d\u52a1\u7aef\u4e3a\u4ec0\u4e48\u6ca1\u6709\u8c03\u7528 close\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_10","title":"\u5982\u679c\u5df2\u7ecf\u5efa\u7acb\u4e86\u8fde\u63a5\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u7a81\u7136\u51fa\u73b0\u6545\u969c\u4e86\u600e\u4e48\u529e\uff1f","text":"<p>\u5ba2\u6237\u7aef\u51fa\u73b0\u6545\u969c\u6307\u7684\u662f\u5ba2\u6237\u7aef\u7684\u4e3b\u673a\u53d1\u751f\u4e86\u5b95\u673a\uff0c\u6216\u8005\u65ad\u7535\u7684\u573a\u666f\u3002\u53d1\u751f\u8fd9\u79cd\u60c5\u51b5\u7684\u65f6\u5019\uff0c\u5982\u679c\u670d\u52a1\u7aef\u4e00\u76f4\u4e0d\u4f1a\u53d1\u9001\u6570\u636e\u7ed9\u5ba2\u6237\u7aef\uff0c\u90a3\u4e48\u670d\u52a1\u7aef\u662f\u6c38\u8fdc\u65e0\u6cd5\u611f\u77e5\u5230\u5ba2\u6237\u7aef\u5b95\u673a\u8fd9\u4e2a\u4e8b\u4ef6\u7684\uff0c\u4e5f\u5c31\u662f\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u5c06\u4e00\u76f4\u5904\u4e8e   <code>ESTABLISH</code> \u72b6\u6001\uff0c\u5360\u7528\u7740\u7cfb\u7edf\u8d44\u6e90\u3002</p> <p>\u4e3a\u4e86\u907f\u514d\u8fd9\u79cd\u60c5\u51b5\uff0cTCP \u641e\u4e86\u4e2a\u4fdd\u6d3b\u673a\u5236\u3002\u8fd9\u4e2a\u673a\u5236\u7684\u539f\u7406\u662f\u8fd9\u6837\u7684\uff1a</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u65f6\u95f4\u6bb5\uff0c\u5728\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u5185\uff0c\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u8fde\u63a5\u76f8\u5173\u7684\u6d3b\u52a8\uff0cTCP \u4fdd\u6d3b\u673a\u5236\u4f1a\u5f00\u59cb\u4f5c\u7528\uff0c\u6bcf\u9694\u4e00\u4e2a\u65f6\u95f4\u95f4\u9694\uff0c\u53d1\u9001\u4e00\u4e2a\u63a2\u6d4b\u62a5\u6587\uff0c\u8be5\u63a2\u6d4b\u62a5\u6587\u5305\u542b\u7684\u6570\u636e\u975e\u5e38\u5c11\uff0c\u5982\u679c\u8fde\u7eed\u51e0\u4e2a\u63a2\u6d4b\u62a5\u6587\u90fd\u6ca1\u6709\u5f97\u5230\u54cd\u5e94\uff0c\u5219\u8ba4\u4e3a\u5f53\u524d\u7684 TCP \u8fde\u63a5\u5df2\u7ecf\u6b7b\u4ea1\uff0c\u7cfb\u7edf\u5185\u6838\u5c06\u9519\u8bef\u4fe1\u606f\u901a\u77e5\u7ed9\u4e0a\u5c42\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u5728 Linux \u5185\u6838\u53ef\u4ee5\u6709\u5bf9\u5e94\u7684\u53c2\u6570\u53ef\u4ee5\u8bbe\u7f6e\u4fdd\u6d3b\u65f6\u95f4\u3001\u4fdd\u6d3b\u63a2\u6d4b\u7684\u6b21\u6570\u3001\u4fdd\u6d3b\u63a2\u6d4b\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u4ee5\u4e0b\u90fd\u4e3a\u9ed8\u8ba4\u503c\uff1a</p> Bash<pre><code>net.ipv4.tcp_keepalive_time=7200\nnet.ipv4.tcp_keepalive_intvl=75  \nnet.ipv4.tcp_keepalive_probes=9\n</code></pre> <ul> <li>tcp_keepalive_time=7200\uff1a\u8868\u793a\u4fdd\u6d3b\u65f6\u95f4\u662f 7200 \u79d2\uff082 \u5c0f\u65f6\uff09\uff0c\u4e5f\u5c31 2 \u5c0f\u65f6\u5185\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u8fde\u63a5\u76f8\u5173\u7684\u6d3b\u52a8\uff0c\u5219\u4f1a\u542f\u52a8\u4fdd\u6d3b\u673a\u5236</li> <li>tcp_keepalive_intvl=75\uff1a\u8868\u793a\u6bcf\u6b21\u68c0\u6d4b\u95f4\u9694 75 \u79d2\uff1b</li> <li>tcp_keepalive_probes=9\uff1a\u8868\u793a\u68c0\u6d4b 9 \u6b21\u65e0\u54cd\u5e94\uff0c\u8ba4\u4e3a\u5bf9\u65b9\u662f\u4e0d\u53ef\u8fbe\u7684\uff0c\u4ece\u800c\u4e2d\u65ad\u672c\u6b21\u7684\u8fde\u63a5\u3002</li> </ul> <p>\u4e5f\u5c31\u662f\u8bf4\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u6700\u5c11\u9700\u8981\u7ecf\u8fc7 2 \u5c0f\u65f6 11 \u5206 15 \u79d2\u624d\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u300c\u6b7b\u4ea1\u300d\u8fde\u63a5\u3002</p> <p></p> <p>\u6ce8\u610f\uff0c\u5e94\u7528\u7a0b\u5e8f\u82e5\u60f3\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\u9700\u8981\u901a\u8fc7 socket \u63a5\u53e3\u8bbe\u7f6e <code>SO_KEEPALIVE</code> \u9009\u9879\u624d\u80fd\u591f\u751f\u6548\uff0c\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\u3002</p> <p>\u5982\u679c\u5f00\u542f\u4e86 TCP \u4fdd\u6d3b\uff0c\u9700\u8981\u8003\u8651\u4ee5\u4e0b\u51e0\u79cd\u60c5\u51b5\uff1a</p> <ul> <li> <p>\u7b2c\u4e00\u79cd\uff0c\u5bf9\u7aef\u7a0b\u5e8f\u662f\u6b63\u5e38\u5de5\u4f5c\u7684\u3002\u5f53 TCP \u4fdd\u6d3b\u7684\u63a2\u6d4b\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u7aef\uff0c\u5bf9\u7aef\u4f1a\u6b63\u5e38\u54cd\u5e94\uff0c\u8fd9\u6837 TCP \u4fdd\u6d3b\u65f6\u95f4\u4f1a\u88ab\u91cd\u7f6e\uff0c\u7b49\u5f85\u4e0b\u4e00\u4e2a TCP \u4fdd\u6d3b\u65f6\u95f4\u7684\u5230\u6765\u3002</p> </li> <li> <p>\u7b2c\u4e8c\u79cd\uff0c\u5bf9\u7aef\u4e3b\u673a\u5b95\u673a\u5e76\u91cd\u542f\u3002\u5f53 TCP \u4fdd\u6d3b\u7684\u63a2\u6d4b\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u7aef\u540e\uff0c\u5bf9\u7aef\u662f\u53ef\u4ee5\u54cd\u5e94\u7684\uff0c\u4f46\u7531\u4e8e\u6ca1\u6709\u8be5\u8fde\u63a5\u7684\u6709\u6548\u4fe1\u606f\uff0c\u4f1a\u4ea7\u751f\u4e00\u4e2a RST \u62a5\u6587\uff0c\u8fd9\u6837\u5f88\u5feb\u5c31\u4f1a\u53d1\u73b0 TCP \u8fde\u63a5\u5df2\u7ecf\u88ab\u91cd\u7f6e\u3002</p> </li> <li> <p>\u7b2c\u4e09\u79cd\uff0c\u662f\u5bf9\u7aef\u4e3b\u673a\u5b95\u673a\uff08\u6ce8\u610f\u4e0d\u662f\u8fdb\u7a0b\u5d29\u6e83\uff0c\u8fdb\u7a0b\u5d29\u6e83\u540e\u64cd\u4f5c\u7cfb\u7edf\u5728\u56de\u6536\u8fdb\u7a0b\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u800c\u4e3b\u673a\u5b95\u673a\u5219\u662f\u65e0\u6cd5\u611f\u77e5\u7684\uff0c\u6240\u4ee5\u9700\u8981 TCP \u4fdd\u6d3b\u673a\u5236\u6765\u63a2\u6d4b\u5bf9\u65b9\u662f\u4e0d\u662f\u53d1\u751f\u4e86\u4e3b\u673a\u5b95\u673a\uff09\uff0c\u6216\u5bf9\u7aef\u7531\u4e8e\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\u62a5\u6587\u4e0d\u53ef\u8fbe\u3002\u5f53 TCP \u4fdd\u6d3b\u7684\u63a2\u6d4b\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u7aef\u540e\uff0c\u77f3\u6c89\u5927\u6d77\uff0c\u6ca1\u6709\u54cd\u5e94\uff0c\u8fde\u7eed\u51e0\u6b21\uff0c\u8fbe\u5230\u4fdd\u6d3b\u63a2\u6d4b\u6b21\u6570\u540e\uff0cTCP \u4f1a\u62a5\u544a\u8be5 TCP \u8fde\u63a5\u5df2\u7ecf\u6b7b\u4ea1\u3002</p> </li> </ul> <p>TCP \u4fdd\u6d3b\u7684\u8fd9\u4e2a\u673a\u5236\u68c0\u6d4b\u7684\u65f6\u95f4\u662f\u6709\u70b9\u957f\uff0c\u6211\u4eec\u53ef\u4ee5\u81ea\u5df1\u5728\u5e94\u7528\u5c42\u5b9e\u73b0\u4e00\u4e2a\u5fc3\u8df3\u673a\u5236\u3002</p> <p>\u6bd4\u5982\uff0cweb \u670d\u52a1\u8f6f\u4ef6\u4e00\u822c\u90fd\u4f1a\u63d0\u4f9b <code>keepalive_timeout</code> \u53c2\u6570\uff0c\u7528\u6765\u6307\u5b9a HTTP \u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 HTTP \u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u662f 60 \u79d2\uff0cweb \u670d\u52a1\u8f6f\u4ef6\u5c31\u4f1a\u542f\u52a8\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5728\u5b8c\u6210\u4e00\u4e2a HTTP \u8bf7\u6c42\u540e\uff0c\u5728 60 \u79d2\u5185\u90fd\u6ca1\u6709\u518d\u53d1\u8d77\u65b0\u7684\u8bf7\u6c42\uff0c\u5b9a\u65f6\u5668\u7684\u65f6\u95f4\u4e00\u5230\uff0c\u5c31\u4f1a\u89e6\u53d1\u56de\u8c03\u51fd\u6570\u6765\u91ca\u653e\u8be5\u8fde\u63a5\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_11","title":"\u5982\u679c\u5df2\u7ecf\u5efa\u7acb\u4e86\u8fde\u63a5\uff0c\u4f46\u662f\u670d\u52a1\u7aef\u7684\u8fdb\u7a0b\u5d29\u6e83\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>TCP \u7684\u8fde\u63a5\u4fe1\u606f\u662f\u7531\u5185\u6838\u7ef4\u62a4\u7684\uff0c\u6240\u4ee5\u5f53\u670d\u52a1\u7aef\u7684\u8fdb\u7a0b\u5d29\u6e83\u540e\uff0c\u5185\u6838\u9700\u8981\u56de\u6536\u8be5\u8fdb\u7a0b\u7684\u6240\u6709 TCP \u8fde\u63a5\u8d44\u6e90\uff0c\u4e8e\u662f\u5185\u6838\u4f1a\u53d1\u9001\u7b2c\u4e00\u6b21\u6325\u624b FIN \u62a5\u6587\uff0c\u540e\u7eed\u7684\u6325\u624b\u8fc7\u7a0b\u4e5f\u90fd\u662f\u5728\u5185\u6838\u5b8c\u6210\uff0c\u5e76\u4e0d\u9700\u8981\u8fdb\u7a0b\u7684\u53c2\u4e0e\uff0c\u6240\u4ee5\u5373\u4f7f\u670d\u52a1\u7aef\u7684\u8fdb\u7a0b\u9000\u51fa\u4e86\uff0c\u8fd8\u662f\u80fd\u4e0e\u5ba2\u6237\u7aef\u5b8c\u6210 TCP \u56db\u6b21\u6325\u624b\u7684\u8fc7\u7a0b\u3002</p> <p>\u6211\u81ea\u5df1\u505a\u4e86\u4e2a\u5b9e\u9a8c\uff0c\u4f7f\u7528 kill -9 \u6765\u6a21\u62df\u8fdb\u7a0b\u5d29\u6e83\u7684\u60c5\u51b5\uff0c\u53d1\u73b0\u5728 kill \u6389\u8fdb\u7a0b\u540e\uff0c\u670d\u52a1\u7aef\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u4e0e\u5ba2\u6237\u7aef\u8fdb\u884c\u56db\u6b21\u6325\u624b\u3002</p> <p>::: tip</p> <p>\u5173\u4e8e\u8fdb\u7a0b\u5d29\u6e83\u548c\u4e3b\u673a\u5b95\u673a\u7684\u533a\u522b\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\uff1aTCP \u8fde\u63a5\uff0c\u4e00\u7aef\u65ad\u7535\u548c\u8fdb\u7a0b\u5d29\u6e83\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>\u8fd8\u6709\u4e00\u4e2a\u7c7b\u4f3c\u7684\u95ee\u9898\uff1a\u300c\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u539f\u672c\u7684 TCP \u8fde\u63a5\u8fd8\u5b58\u5728\u5417\uff1f\u300d\uff0c\u5177\u4f53\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1a\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u539f\u672c\u7684 TCP \u8fde\u63a5\u8fd8\u5b58\u5728\u5417\uff1f</p> <p>:::</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#socket","title":"Socket \u7f16\u7a0b","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#tcp-socket","title":"\u9488\u5bf9 TCP \u5e94\u8be5\u5982\u4f55 Socket \u7f16\u7a0b\uff1f","text":"<ul> <li>\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u521d\u59cb\u5316 <code>socket</code>\uff0c\u5f97\u5230\u6587\u4ef6\u63cf\u8ff0\u7b26\uff1b</li> <li>\u670d\u52a1\u7aef\u8c03\u7528 <code>bind</code>\uff0c\u5c06 socket \u7ed1\u5b9a\u5728\u6307\u5b9a\u7684 IP \u5730\u5740\u548c\u7aef\u53e3;</li> <li>\u670d\u52a1\u7aef\u8c03\u7528 <code>listen</code>\uff0c\u8fdb\u884c\u76d1\u542c\uff1b</li> <li>\u670d\u52a1\u7aef\u8c03\u7528 <code>accept</code>\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u8fde\u63a5\uff1b</li> <li>\u5ba2\u6237\u7aef\u8c03\u7528 <code>connect</code>\uff0c\u5411\u670d\u52a1\u7aef\u7684\u5730\u5740\u548c\u7aef\u53e3\u53d1\u8d77\u8fde\u63a5\u8bf7\u6c42\uff1b</li> <li>\u670d\u52a1\u7aef <code>accept</code> \u8fd4\u56de\u7528\u4e8e\u4f20\u8f93\u7684 <code>socket</code> \u7684\u6587\u4ef6\u63cf\u8ff0\u7b26\uff1b</li> <li>\u5ba2\u6237\u7aef\u8c03\u7528 <code>write</code> \u5199\u5165\u6570\u636e\uff1b\u670d\u52a1\u7aef\u8c03\u7528 <code>read</code> \u8bfb\u53d6\u6570\u636e\uff1b</li> <li>\u5ba2\u6237\u7aef\u65ad\u5f00\u8fde\u63a5\u65f6\uff0c\u4f1a\u8c03\u7528 <code>close</code>\uff0c\u90a3\u4e48\u670d\u52a1\u7aef <code>read</code> \u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u8bfb\u53d6\u5230\u4e86 <code>EOF</code>\uff0c\u5f85\u5904\u7406\u5b8c\u6570\u636e\u540e\uff0c\u670d\u52a1\u7aef\u8c03\u7528 <code>close</code>\uff0c\u8868\u793a\u8fde\u63a5\u5173\u95ed\u3002</li> </ul> <p>\u8fd9\u91cc\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u670d\u52a1\u7aef\u8c03\u7528 <code>accept</code> \u65f6\uff0c\u8fde\u63a5\u6210\u529f\u4e86\u4f1a\u8fd4\u56de\u4e00\u4e2a\u5df2\u5b8c\u6210\u8fde\u63a5\u7684 socket\uff0c\u540e\u7eed\u7528\u6765\u4f20\u8f93\u6570\u636e\u3002</p> <p>\u6240\u4ee5\uff0c\u76d1\u542c\u7684 socket \u548c\u771f\u6b63\u7528\u6765\u4f20\u9001\u6570\u636e\u7684 socket\uff0c\u662f\u300c\u4e24\u4e2a\u300dsocket\uff0c\u4e00\u4e2a\u53eb\u4f5c\u76d1\u542c socket\uff0c\u4e00\u4e2a\u53eb\u4f5c\u5df2\u5b8c\u6210\u8fde\u63a5 socket\u3002</p> <p>\u6210\u529f\u8fde\u63a5\u5efa\u7acb\u4e4b\u540e\uff0c\u53cc\u65b9\u5f00\u59cb\u901a\u8fc7 read \u548c write \u51fd\u6570\u6765\u8bfb\u5199\u6570\u636e\uff0c\u5c31\u50cf\u5f80\u4e00\u4e2a\u6587\u4ef6\u6d41\u91cc\u9762\u5199\u4e1c\u897f\u4e00\u6837\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#listen-backlog","title":"listen \u65f6\u5019\u53c2\u6570 backlog \u7684\u610f\u4e49\uff1f","text":"<p>Linux \u5185\u6838\u4e2d\u4f1a\u7ef4\u62a4\u4e24\u4e2a\u961f\u5217\uff1a</p> <ul> <li>\u534a\u8fde\u63a5\u961f\u5217\uff08SYN \u961f\u5217\uff09\uff1a\u63a5\u6536\u5230\u4e00\u4e2a SYN \u5efa\u7acb\u8fde\u63a5\u8bf7\u6c42\uff0c\u5904\u4e8e SYN_RCVD \u72b6\u6001\uff1b</li> <li>\u5168\u8fde\u63a5\u961f\u5217\uff08Accpet \u961f\u5217\uff09\uff1a\u5df2\u5b8c\u6210 TCP \u4e09\u6b21\u63e1\u624b\u8fc7\u7a0b\uff0c\u5904\u4e8e ESTABLISHED \u72b6\u6001\uff1b</li> </ul> <p></p> C<pre><code>int listen (int socketfd, int backlog)\n</code></pre> <ul> <li>\u53c2\u6570\u4e00 socketfd \u4e3a socketfd \u6587\u4ef6\u63cf\u8ff0\u7b26</li> <li>\u53c2\u6570\u4e8c backlog\uff0c\u8fd9\u53c2\u6570\u5728\u5386\u53f2\u7248\u672c\u6709\u4e00\u5b9a\u7684\u53d8\u5316</li> </ul> <p>\u5728\u65e9\u671f Linux \u5185\u6838 backlog \u662f SYN \u961f\u5217\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u672a\u5b8c\u6210\u7684\u961f\u5217\u5927\u5c0f\u3002</p> <p>\u5728 Linux \u5185\u6838 2.2 \u4e4b\u540e\uff0cbacklog \u53d8\u6210 accept \u961f\u5217\uff0c\u4e5f\u5c31\u662f\u5df2\u5b8c\u6210\u8fde\u63a5\u5efa\u7acb\u7684\u961f\u5217\u957f\u5ea6\uff0c\u6240\u4ee5\u73b0\u5728\u901a\u5e38\u8ba4\u4e3a backlog \u662f accept \u961f\u5217\u3002</p> <p>\u4f46\u662f\u4e0a\u9650\u503c\u662f\u5185\u6838\u53c2\u6570 somaxconn \u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u8bf4 accpet \u961f\u5217\u957f\u5ea6 = min(backlog, somaxconn)\u3002</p> <p>\u60f3\u8be6\u7ec6\u4e86\u89e3 TCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\uff0c\u53ef\u4ee5\u770b\u8fd9\u7bc7\uff1aTCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u53c8\u8be5\u5982\u4f55\u5e94\u5bf9\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#accept","title":"accept \u53d1\u751f\u5728\u4e09\u6b21\u63e1\u624b\u7684\u54ea\u4e00\u6b65\uff1f","text":"<p>\u6211\u4eec\u5148\u770b\u770b\u5ba2\u6237\u7aef\u8fde\u63a5\u670d\u52a1\u7aef\u65f6\uff0c\u53d1\u9001\u4e86\u4ec0\u4e48\uff1f</p> <p></p> <ul> <li>\u5ba2\u6237\u7aef\u7684\u534f\u8bae\u6808\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e86 SYN \u5305\uff0c\u5e76\u544a\u8bc9\u670d\u52a1\u7aef\u5f53\u524d\u53d1\u9001\u5e8f\u5217\u53f7 client_isn\uff0c\u5ba2\u6237\u7aef\u8fdb\u5165 SYN_SENT \u72b6\u6001\uff1b</li> <li>\u670d\u52a1\u7aef\u7684\u534f\u8bae\u6808\u6536\u5230\u8fd9\u4e2a\u5305\u4e4b\u540e\uff0c\u548c\u5ba2\u6237\u7aef\u8fdb\u884c ACK \u5e94\u7b54\uff0c\u5e94\u7b54\u7684\u503c\u4e3a client_isn+1\uff0c\u8868\u793a\u5bf9 SYN \u5305 client_isn \u7684\u786e\u8ba4\uff0c\u540c\u65f6\u670d\u52a1\u7aef\u4e5f\u53d1\u9001\u4e00\u4e2a SYN \u5305\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u5f53\u524d\u6211\u7684\u53d1\u9001\u5e8f\u5217\u53f7\u4e3a server_isn\uff0c\u670d\u52a1\u7aef\u8fdb\u5165 SYN_RCVD \u72b6\u6001\uff1b</li> <li>\u5ba2\u6237\u7aef\u534f\u8bae\u6808\u6536\u5230 ACK \u4e4b\u540e\uff0c\u4f7f\u5f97\u5e94\u7528\u7a0b\u5e8f\u4ece <code>connect</code> \u8c03\u7528\u8fd4\u56de\uff0c\u8868\u793a\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u7aef\u7684\u5355\u5411\u8fde\u63a5\u5efa\u7acb\u6210\u529f\uff0c\u5ba2\u6237\u7aef\u7684\u72b6\u6001\u4e3a ESTABLISHED\uff0c\u540c\u65f6\u5ba2\u6237\u7aef\u534f\u8bae\u6808\u4e5f\u4f1a\u5bf9\u670d\u52a1\u7aef\u7684 SYN \u5305\u8fdb\u884c\u5e94\u7b54\uff0c\u5e94\u7b54\u6570\u636e\u4e3a server_isn+1\uff1b</li> <li>ACK \u5e94\u7b54\u5305\u5230\u8fbe\u670d\u52a1\u7aef\u540e\uff0c\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u8fdb\u5165 ESTABLISHED \u72b6\u6001\uff0c\u540c\u65f6\u670d\u52a1\u7aef\u534f\u8bae\u6808\u4f7f\u5f97 <code>accept</code> \u963b\u585e\u8c03\u7528\u8fd4\u56de\uff0c\u8fd9\u4e2a\u65f6\u5019\u670d\u52a1\u7aef\u5230\u5ba2\u6237\u7aef\u7684\u5355\u5411\u8fde\u63a5\u4e5f\u5efa\u7acb\u6210\u529f\u3002\u81f3\u6b64\uff0c\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u4e24\u4e2a\u65b9\u5411\u7684\u8fde\u63a5\u90fd\u5efa\u7acb\u6210\u529f\u3002</li> </ul> <p>\u4ece\u4e0a\u9762\u7684\u63cf\u8ff0\u8fc7\u7a0b\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\u5ba2\u6237\u7aef connect \u6210\u529f\u8fd4\u56de\u662f\u5728\u7b2c\u4e8c\u6b21\u63e1\u624b\uff0c\u670d\u52a1\u7aef accept \u6210\u529f\u8fd4\u56de\u662f\u5728\u4e09\u6b21\u63e1\u624b\u6210\u529f\u4e4b\u540e\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#close","title":"\u5ba2\u6237\u7aef\u8c03\u7528 close \u4e86\uff0c\u8fde\u63a5\u662f\u65ad\u5f00\u7684\u6d41\u7a0b\u662f\u4ec0\u4e48\uff1f","text":"<p>\u6211\u4eec\u770b\u770b\u5ba2\u6237\u7aef\u4e3b\u52a8\u8c03\u7528\u4e86 <code>close</code>\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</p> <p></p> <ul> <li>\u5ba2\u6237\u7aef\u8c03\u7528 <code>close</code>\uff0c\u8868\u660e\u5ba2\u6237\u7aef\u6ca1\u6709\u6570\u636e\u9700\u8981\u53d1\u9001\u4e86\uff0c\u5219\u6b64\u65f6\u4f1a\u5411\u670d\u52a1\u7aef\u53d1\u9001 FIN \u62a5\u6587\uff0c\u8fdb\u5165 FIN_WAIT_1 \u72b6\u6001\uff1b</li> <li>\u670d\u52a1\u7aef\u63a5\u6536\u5230\u4e86 FIN \u62a5\u6587\uff0cTCP \u534f\u8bae\u6808\u4f1a\u4e3a FIN \u5305\u63d2\u5165\u4e00\u4e2a\u6587\u4ef6\u7ed3\u675f\u7b26 <code>EOF</code> \u5230\u63a5\u6536\u7f13\u51b2\u533a\u4e2d\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7 <code>read</code> \u8c03\u7528\u6765\u611f\u77e5\u8fd9\u4e2a FIN \u5305\u3002\u8fd9\u4e2a <code>EOF</code> \u4f1a\u88ab\u653e\u5728\u5df2\u6392\u961f\u7b49\u5019\u7684\u5176\u4ed6\u5df2\u63a5\u6536\u7684\u6570\u636e\u4e4b\u540e\uff0c\u8fd9\u5c31\u610f\u5473\u7740\u670d\u52a1\u7aef\u9700\u8981\u5904\u7406\u8fd9\u79cd\u5f02\u5e38\u60c5\u51b5\uff0c\u56e0\u4e3a EOF \u8868\u793a\u5728\u8be5\u8fde\u63a5\u4e0a\u518d\u65e0\u989d\u5916\u6570\u636e\u5230\u8fbe\u3002\u6b64\u65f6\uff0c\u670d\u52a1\u7aef\u8fdb\u5165 CLOSE_WAIT \u72b6\u6001\uff1b</li> <li>\u63a5\u7740\uff0c\u5f53\u5904\u7406\u5b8c\u6570\u636e\u540e\uff0c\u81ea\u7136\u5c31\u4f1a\u8bfb\u5230 <code>EOF</code>\uff0c\u4e8e\u662f\u4e5f\u8c03\u7528 <code>close</code> \u5173\u95ed\u5b83\u7684\u5957\u63a5\u5b57\uff0c\u8fd9\u4f1a\u4f7f\u5f97\u670d\u52a1\u7aef\u53d1\u51fa\u4e00\u4e2a FIN \u5305\uff0c\u4e4b\u540e\u5904\u4e8e LAST_ACK \u72b6\u6001\uff1b</li> <li>\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u670d\u52a1\u7aef\u7684 FIN \u5305\uff0c\u5e76\u53d1\u9001 ACK \u786e\u8ba4\u5305\u7ed9\u670d\u52a1\u7aef\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u5c06\u8fdb\u5165 TIME_WAIT \u72b6\u6001\uff1b</li> <li>\u670d\u52a1\u7aef\u6536\u5230 ACK \u786e\u8ba4\u5305\u540e\uff0c\u5c31\u8fdb\u5165\u4e86\u6700\u540e\u7684 CLOSE \u72b6\u6001\uff1b</li> <li>\u5ba2\u6237\u7aef\u7ecf\u8fc7 <code>2MSL</code> \u65f6\u95f4\u4e4b\u540e\uff0c\u4e5f\u8fdb\u5165 CLOSE \u72b6\u6001\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#accept-tcp","title":"\u6ca1\u6709 accept\uff0c\u80fd\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f","text":"<p>\u7b54\u6848\uff1a\u53ef\u4ee5\u7684\u3002</p> <p>accept \u7cfb\u7edf\u8c03\u7528\u5e76\u4e0d\u53c2\u4e0e TCP \u4e09\u6b21\u63e1\u624b\u8fc7\u7a0b\uff0c\u5b83\u53ea\u662f\u8d1f\u8d23\u4ece TCP \u5168\u8fde\u63a5\u961f\u5217\u53d6\u51fa\u4e00\u4e2a\u5df2\u7ecf\u5efa\u7acb\u8fde\u63a5\u7684 socket\uff0c\u7528\u6237\u5c42\u901a\u8fc7 accept \u7cfb\u7edf\u8c03\u7528\u62ff\u5230\u4e86\u5df2\u7ecf\u5efa\u7acb\u8fde\u63a5\u7684 socket\uff0c\u5c31\u53ef\u4ee5\u5bf9\u8be5 socket \u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u4e86\u3002</p> <p></p> <p>\u66f4\u60f3\u4e86\u89e3\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\uff1a\u6ca1\u6709 accept\uff0c\u80fd\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#listen-tcp","title":"\u6ca1\u6709 listen\uff0c\u80fd\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f","text":"<p>\u7b54\u6848\uff1a\u53ef\u4ee5\u7684\u3002</p> <p>\u5ba2\u6237\u7aef\u662f\u53ef\u4ee5\u81ea\u5df1\u8fde\u81ea\u5df1\u7684\u5f62\u6210\u8fde\u63a5\uff08TCP \u81ea\u8fde\u63a5\uff09\uff0c\u4e5f\u53ef\u4ee5\u4e24\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u5411\u5bf9\u65b9\u53d1\u51fa\u8bf7\u6c42\u5efa\u7acb\u8fde\u63a5\uff08TCP \u540c\u65f6\u6253\u5f00\uff09\uff0c\u8fd9\u4e24\u4e2a\u60c5\u51b5\u90fd\u6709\u4e2a\u5171\u540c\u70b9\uff0c\u5c31\u662f\u6ca1\u6709\u670d\u52a1\u7aef\u53c2\u4e0e\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709 listen\uff0c\u5c31\u80fd TCP \u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u66f4\u60f3\u4e86\u89e3\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u6587\u7ae0\uff1a\u670d\u52a1\u7aef\u6ca1\u6709 listen\uff0c\u5ba2\u6237\u7aef\u53d1\u8d77\u8fde\u63a5\u5efa\u7acb\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_interview/#_12","title":"\u5520\u53e8","text":"<p>\u5e0c\u671b\u8fd9\u7bc7\u80fd\u7834\u9664\u5927\u5bb6\u5bf9 TCP \u7684\u5927\u591a\u6570\u7591\u60d1\uff0c\u6709\u4efb\u4f55\u95ee\u9898\u90fd\u53ef\u4ee5\u5728\u7559\u8a00\u533a\u548c\u6211\u4ea4\u6d41\u3002</p> <p>\u5c0f\u6797\u662f\u4e13\u4e3a\u5927\u5bb6\u56fe\u89e3\u7684\u5de5\u5177\u4eba\uff0cGoodbye\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/","title":"4.20 \u6ca1\u6709 accept\uff0c\u80fd\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f","text":"<p>\u6765\u6e90\uff1a\u516c\u4f17\u53f7@\u5c0f\u767d debug \u539f\u6587\u5730\u5740\uff1a\u963f\u91cc\u4e8c\u9762\uff1a\u6ca1\u6709 accept\uff0c\u80fd\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f</p> <p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u8fd9\u6b21\uff0c\u6211\u4eec\u6765\u8ba8\u8bba\u4e00\u4e0b\uff0c\u6ca1\u6709 accept\uff0c\u80fd\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f</p> <p>\u4e0b\u9762\u8fd9\u4e2a\u52a8\u56fe\uff0c\u662f\u6211\u4eec\u5e73\u65f6\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5efa\u7acb\u8fde\u63a5\u65f6\u7684\u4ee3\u7801\u6d41\u7a0b\u3002</p> <p></p> <p>\u5bf9\u5e94\u7684\u662f\u4e0b\u9762\u4e00\u6bb5\u7b80\u5316\u8fc7\u7684\u670d\u52a1\u7aef\u4f2a\u4ee3\u7801\u3002</p> C<pre><code>int main()\n{\n    /*Step 1: \u521b\u5efa\u670d\u52a1\u5668\u7aef\u76d1\u542c socket \u63cf\u8ff0\u7b26 listen_fd*/    \n    listen_fd = socket(AF_INET, SOCK_STREAM, 0);\n\n    /*Step 2: bind \u7ed1\u5b9a\u670d\u52a1\u5668\u7aef\u7684 IP \u548c\u7aef\u53e3\uff0c\u6240\u6709\u5ba2\u6237\u7aef\u90fd\u5411\u8fd9\u4e2a IP \u548c\u7aef\u53e3\u53d1\u9001\u548c\u8bf7\u6c42\u6570\u636e*/    \n    bind(listen_fd, xxx);\n\n    /*Step 3: \u670d\u52a1\u7aef\u5f00\u542f\u76d1\u542c*/    \n    listen(listen_fd, 128);\n\n    /*Step 4: \u670d\u52a1\u5668\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u94fe\u63a5\uff0c\u8fd4\u56de\u503c cfd \u4e3a\u5ba2\u6237\u7aef\u7684 socket \u63cf\u8ff0\u7b26*/    \n    cfd = accept(listen_fd, xxx);\n\n    /*Step 5: \u8bfb\u53d6\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u6570\u636e*/\n    n = read(cfd, buf, sizeof(buf));\n}\n</code></pre> <p>\u4f30\u8ba1\u5927\u5bb6\u4e5f\u662f\u8001\u719f\u6089\u8fd9\u6bb5\u4f2a\u4ee3\u7801\u4e86\u3002</p> <p>\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5728\u6267\u884c <code>listen()</code> \u65b9\u6cd5\u4e4b\u540e\u8fd8\u4f1a\u6267\u884c\u4e00\u4e2a <code>accept()</code> \u65b9\u6cd5\u3002</p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u542f\u52a8\u670d\u52a1\u5668\uff0c\u4f1a\u53d1\u73b0\u6700\u540e\u7a0b\u5e8f\u4f1a\u963b\u585e\u5728 <code>accept()</code> \u91cc\u3002</p> <p>\u6b64\u65f6\u670d\u52a1\u7aef\u5c31\u7b97 ok \u4e86\uff0c\u5c31\u7b49\u5ba2\u6237\u7aef\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c\u518d\u770b\u4e0b\u7b80\u5316\u8fc7\u7684\u5ba2\u6237\u7aef\u4f2a\u4ee3\u7801\u3002</p> C<pre><code>int main()\n{\n    /*Step 1: \u521b\u5efa\u5ba2\u6237\u7aef\u7aef socket \u63cf\u8ff0\u7b26 cfd*/    \n    cfd = socket(AF_INET, SOCK_STREAM, 0);\n\n    /*Step 2: connect \u65b9\u6cd5\uff0c\u5bf9\u670d\u52a1\u5668\u7aef\u7684 IP \u548c\u7aef\u53e3\u53f7\u53d1\u8d77\u8fde\u63a5*/    \n    ret = connect(cfd, xxxx);\n\n    /*Step 3: \u5411\u670d\u52a1\u5668\u7aef\u5199\u6570\u636e*/\n    write(cfd, buf, strlen(buf));\n}\n</code></pre> <p>\u5ba2\u6237\u7aef\u6bd4\u8f83\u7b80\u5355\uff0c\u521b\u5efa\u597d <code>socket</code> \u4e4b\u540e\uff0c\u76f4\u63a5\u5c31\u53d1\u8d77 <code>connect</code> \u65b9\u6cd5\u3002</p> <p>\u6b64\u65f6\u56de\u5230\u670d\u52a1\u7aef\uff0c\u4f1a\u53d1\u73b0\u4e4b\u524d\u4e00\u76f4\u963b\u585e\u7684 accept \u65b9\u6cd5\uff0c\u8fd4\u56de\u7ed3\u679c\u4e86\u3002</p> <p>\u8fd9\u5c31\u7b97\u4e24\u7aef\u6210\u529f\u5efa\u7acb\u597d\u4e86\u4e00\u6761\u8fde\u63a5\u3002\u4e4b\u540e\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u8fdb\u884c\u8bfb\u5199\u64cd\u4f5c\u4e86\u3002</p> <p>\u90a3\u4e48\uff0c\u6211\u4eec\u4eca\u5929\u7684\u95ee\u9898\u662f\uff0c\u5982\u679c\u6ca1\u6709\u8fd9\u4e2a accept \u65b9\u6cd5\uff0cTCP \u8fde\u63a5\u8fd8\u80fd\u5efa\u7acb\u8d77\u6765\u5417\uff1f</p> <p>\u5176\u5b9e\u53ea\u8981\u5728\u6267\u884c <code>accept()</code> \u4e4b\u524d\u6267\u884c\u4e00\u4e2a <code>sleep(20)</code>\uff0c\u7136\u540e\u7acb\u523b\u6267\u884c\u5ba2\u6237\u7aef\u76f8\u5173\u7684\u65b9\u6cd5\uff0c\u540c\u65f6\u6293\u4e2a\u5305\uff0c\u5c31\u80fd\u5f97\u51fa\u7ed3\u8bba\u3002</p> <p></p> <p>\u4ece\u6293\u5305\u7ed3\u679c\u770b\u6765\uff0c\u5c31\u7b97\u4e0d\u6267\u884c <code>accept()</code> \u65b9\u6cd5\uff0c\u4e09\u6b21\u63e1\u624b\u7167\u5e38\u8fdb\u884c\uff0c\u5e76\u987a\u5229\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u66f4\u9a9a\u6c14\u7684\u662f\uff0c\u5728\u670d\u52a1\u7aef\u6267\u884c <code>accept()</code> \u524d\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u6d88\u606f\u7ed9\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u662f\u80fd\u591f\u6b63\u5e38\u56de\u590d ack \u786e\u8ba4\u5305\u7684\u3002</p> <p>\u5e76\u4e14\uff0c<code>sleep(20)</code> \u7ed3\u675f\u540e\uff0c\u670d\u52a1\u7aef\u6b63\u5e38\u6267\u884c <code>accept()</code>\uff0c\u5ba2\u6237\u7aef\u524d\u9762\u53d1\u9001\u7684\u6d88\u606f\uff0c\u8fd8\u662f\u80fd\u6b63\u5e38\u6536\u5230\u7684\u3002</p> <p>\u901a\u8fc7\u8fd9\u4e2a\u73b0\u8c61\uff0c\u6211\u4eec\u53ef\u4ee5\u591a\u60f3\u60f3\u4e3a\u4ec0\u4e48\u3002\u987a\u4fbf\u597d\u597d\u4e86\u89e3\u4e0b\u4e09\u6b21\u63e1\u624b\u7684\u7ec6\u8282\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#_1","title":"\u4e09\u6b21\u63e1\u624b\u7684\u7ec6\u8282\u5206\u6790","text":"<p>\u6211\u4eec\u5148\u770b\u9762\u8bd5\u516b\u80a1\u6587\u7684\u8001\u80a1\uff0c\u4e09\u6b21\u63e1\u624b\u3002</p> <p></p> <p>\u670d\u52a1\u7aef\u4ee3\u7801\uff0c\u5bf9 socket \u6267\u884c bind \u65b9\u6cd5\u53ef\u4ee5\u7ed1\u5b9a\u76d1\u542c\u7aef\u53e3\uff0c\u7136\u540e\u6267\u884c <code>listen</code> \u65b9\u6cd5\u540e\uff0c\u5c31\u4f1a\u8fdb\u5165\u76d1\u542c\uff08<code>LISTEN</code>\uff09\u72b6\u6001\u3002\u5185\u6838\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u5904\u4e8e <code>LISTEN</code> \u72b6\u6001\u7684 <code>socket</code> \u5206\u914d\u4e24\u4e2a\u961f\u5217\uff0c\u5206\u522b\u53eb\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#_2","title":"\u534a\u8fde\u63a5\u961f\u5217\u3001\u5168\u8fde\u63a5\u961f\u5217\u662f\u4ec0\u4e48","text":"<ul> <li>\u534a\u8fde\u63a5\u961f\u5217\uff08<code>SYN</code> \u961f\u5217\uff09\uff0c\u670d\u52a1\u7aef\u6536\u5230\u7b2c\u4e00\u6b21\u63e1\u624b\u540e\uff0c\u4f1a\u5c06 <code>sock</code> \u52a0\u5165\u5230\u8fd9\u4e2a\u961f\u5217\u4e2d\uff0c\u961f\u5217\u5185\u7684 <code>sock</code> \u90fd\u5904\u4e8e <code>SYN_RECV</code> \u72b6\u6001\u3002</li> <li>\u5168\u8fde\u63a5\u961f\u5217\uff08<code>ACCEPT</code> \u961f\u5217\uff09\uff0c\u5728\u670d\u52a1\u7aef\u6536\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\u540e\uff0c\u4f1a\u5c06\u534a\u8fde\u63a5\u961f\u5217\u7684 <code>sock</code> \u53d6\u51fa\uff0c\u653e\u5230\u5168\u8fde\u63a5\u961f\u5217\u4e2d\u3002\u961f\u5217\u91cc\u7684 <code>sock</code> \u90fd\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\u3002\u8fd9\u91cc\u9762\u7684\u8fde\u63a5\uff0c\u5c31\u7b49\u7740\u670d\u52a1\u7aef\u6267\u884c <code>accept()</code> \u540e\u88ab\u53d6\u51fa\u4e86\u3002</li> </ul> <p>\u770b\u5230\u8fd9\u91cc\uff0c\u6587\u7ae0\u5f00\u5934\u7684\u95ee\u9898\u5c31\u6709\u4e86\u7b54\u6848\uff0c\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\u4e2d\u6839\u672c\u4e0d\u9700\u8981 <code>accept()</code> \u53c2\u4e0e\uff0c \u6267\u884c <code>accept()</code> \u53ea\u662f\u4e3a\u4e86\u4ece\u5168\u8fde\u63a5\u961f\u5217\u91cc\u53d6\u51fa\u4e00\u6761\u8fde\u63a5\u3002</p> <p>\u6211\u4eec\u628a\u8bdd\u9898\u518d\u91cd\u65b0\u56de\u5230\u8fd9\u4e24\u4e2a\u961f\u5217\u4e0a\u3002</p> <p>\u867d\u7136\u90fd\u53eb\u961f\u5217\uff0c\u4f46\u5176\u5b9e\u5168\u8fde\u63a5\u961f\u5217\uff08icsk_accept_queue\uff09\u662f\u4e2a\u94fe\u8868\uff0c\u800c\u534a\u8fde\u63a5\u961f\u5217\uff08syn_table\uff09\u662f\u4e2a\u54c8\u5e0c\u8868\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#_3","title":"\u4e3a\u4ec0\u4e48\u534a\u8fde\u63a5\u961f\u5217\u8981\u8bbe\u8ba1\u6210\u54c8\u5e0c\u8868","text":"<p>\u5148\u5bf9\u6bd4\u4e0b\u5168\u8fde\u63a5\u91cc\u961f\u5217\uff0c\u4ed6\u672c\u8d28\u662f\u4e2a\u94fe\u8868\uff0c\u56e0\u4e3a\u4e5f\u662f\u7ebf\u6027\u7ed3\u6784\uff0c\u8bf4\u5b83\u662f\u4e2a\u961f\u5217\u4e5f\u6ca1\u6bdb\u75c5\u3002\u5b83\u91cc\u9762\u653e\u7684\u90fd\u662f\u5df2\u7ecf\u5efa\u7acb\u5b8c\u6210\u7684\u8fde\u63a5\uff0c\u8fd9\u4e9b\u8fde\u63a5\u6b63\u7b49\u5f85\u88ab\u53d6\u8d70\u3002\u800c\u670d\u52a1\u7aef\u53d6\u8d70\u8fde\u63a5\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5e76\u4e0d\u5173\u5fc3\u5177\u4f53\u662f\u54ea\u4e2a\u8fde\u63a5\uff0c\u53ea\u8981\u662f\u4e2a\u8fde\u63a5\u5c31\u884c\uff0c\u6240\u4ee5\u76f4\u63a5\u4ece\u961f\u5217\u5934\u53d6\u5c31\u884c\u4e86\u3002\u8fd9\u4e2a\u8fc7\u7a0b\u7b97\u6cd5\u590d\u6742\u5ea6\u4e3a <code>O(1)</code>\u3002</p> <p>\u800c\u534a\u8fde\u63a5\u961f\u5217\u5374\u4e0d\u592a\u4e00\u6837\uff0c\u56e0\u4e3a\u961f\u5217\u91cc\u7684\u90fd\u662f\u4e0d\u5b8c\u6574\u7684\u8fde\u63a5\uff0c\u55f7\u55f7\u7b49\u5f85\u7740\u7b2c\u4e09\u6b21\u63e1\u624b\u7684\u5230\u6765\u3002\u90a3\u4e48\u73b0\u5728\u6709\u4e00\u4e2a\u7b2c\u4e09\u6b21\u63e1\u624b\u6765\u4e86\uff0c\u5219\u9700\u8981\u4ece\u961f\u5217\u91cc\u628a\u76f8\u5e94 IP \u7aef\u53e3\u7684\u8fde\u63a5\u53d6\u51fa\uff0c\u5982\u679c\u534a\u8fde\u63a5\u961f\u5217\u8fd8\u662f\u4e2a\u94fe\u8868\uff0c\u90a3\u6211\u4eec\u5c31\u9700\u8981\u4f9d\u6b21\u904d\u5386\uff0c\u624d\u80fd\u62ff\u5230\u6211\u4eec\u60f3\u8981\u7684\u90a3\u4e2a\u8fde\u63a5\uff0c\u7b97\u6cd5\u590d\u6742\u5ea6\u5c31\u662f <code>O(n)</code>\u3002</p> <p>\u800c\u5982\u679c\u5c06\u534a\u8fde\u63a5\u961f\u5217\u8bbe\u8ba1\u6210\u54c8\u5e0c\u8868\uff0c\u90a3\u4e48\u67e5\u627e\u534a\u8fde\u63a5\u7684\u7b97\u6cd5\u590d\u6742\u5ea6\u5c31\u56de\u5230 <code>O(1)</code> \u4e86\u3002</p> <p>\u56e0\u6b64\u51fa\u4e8e\u6548\u7387\u8003\u8651\uff0c\u5168\u8fde\u63a5\u961f\u5217\u88ab\u8bbe\u8ba1\u6210\u94fe\u8868\uff0c\u800c\u534a\u8fde\u63a5\u961f\u5217\u88ab\u8bbe\u8ba1\u4e3a\u54c8\u5e0c\u8868\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#_4","title":"\u600e\u4e48\u89c2\u5bdf\u4e24\u4e2a\u961f\u5217\u7684\u5927\u5c0f","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#_5","title":"\u67e5\u770b\u5168\u8fde\u63a5\u961f\u5217","text":"Bash<pre><code># ss -lnt\nState      Recv-Q Send-Q     Local Address:Port           Peer Address:Port\nLISTEN     0      128        127.0.0.1:46269              *:*              \n</code></pre> <p>\u901a\u8fc7 <code>ss -lnt</code> \u547d\u4ee4\uff0c\u53ef\u4ee5\u770b\u5230\u5168\u8fde\u63a5\u961f\u5217\u7684\u5927\u5c0f\uff0c\u5176\u4e2d <code>Send-Q</code> \u662f\u6307\u5168\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u503c\uff0c\u53ef\u4ee5\u770b\u5230\u6211\u8fd9\u4e0a\u9762\u7684\u6700\u5927\u503c\u662f <code>128</code>\uff1b<code>Recv-Q</code> \u662f\u6307\u5f53\u524d\u7684\u5168\u8fde\u63a5\u961f\u5217\u7684\u4f7f\u7528\u503c\uff0c\u6211\u8fd9\u8fb9\u7528\u4e86 <code>0</code> \u4e2a\uff0c\u4e5f\u5c31\u662f\u5168\u8fde\u63a5\u961f\u5217\u91cc\u4e3a\u7a7a\uff0c\u8fde\u63a5\u90fd\u88ab\u53d6\u51fa\u6765\u4e86\u3002</p> <p>\u5f53\u4e0a\u9762 <code>Send-Q</code> \u548c <code>Recv-Q</code> \u6570\u503c\u5f88\u63a5\u8fd1\u7684\u65f6\u5019\uff0c\u90a3\u4e48\u5168\u8fde\u63a5\u961f\u5217\u53ef\u80fd\u5df2\u7ecf\u6ee1\u4e86\u3002\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u662f\u5426\u53d1\u751f\u8fc7\u961f\u5217\u6ea2\u51fa\u3002</p> Bash<pre><code># netstat -s | grep overflowed\n    4343 times the listen queue of a socket overflowed\n</code></pre> <p>\u4e0a\u9762\u8bf4\u660e\u53d1\u751f\u8fc7 <code>4343</code> \u6b21\u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u60c5\u51b5\u3002\u8fd9\u4e2a\u67e5\u770b\u5230\u7684\u662f\u5386\u53f2\u53d1\u751f\u8fc7\u7684\u6b21\u6570\u3002</p> <p>\u5982\u679c\u914d\u5408\u4f7f\u7528 <code>watch -d</code> \u547d\u4ee4\uff0c\u53ef\u4ee5\u81ea\u52a8\u6bcf <code>2s</code> \u95f4\u9694\u6267\u884c\u76f8\u540c\u547d\u4ee4\uff0c\u8fd8\u80fd\u9ad8\u4eae\u663e\u793a\u53d8\u5316\u7684\u6570\u5b57\u90e8\u5206\uff0c\u5982\u679c\u6ea2\u51fa\u7684\u6570\u5b57\u4e0d\u65ad\u53d8\u591a\uff0c\u8bf4\u660e\u6b63\u5728\u53d1\u751f\u6ea2\u51fa\u7684\u884c\u4e3a\u3002</p> Bash<pre><code># watch -d 'netstat -s | grep overflowed'\nEvery 2.0s: netstat -s | grep overflowed                                \nFri Sep 17 09:00:45 2021\n\n    4343 times the listen queue of a socket overflowed\n</code></pre>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#_6","title":"\u67e5\u770b\u534a\u8fde\u63a5\u961f\u5217","text":"<p>\u534a\u8fde\u63a5\u961f\u5217\u6ca1\u6709\u547d\u4ee4\u53ef\u4ee5\u76f4\u63a5\u67e5\u770b\u5230\uff0c\u4f46\u56e0\u4e3a\u534a\u8fde\u63a5\u961f\u5217\u91cc\uff0c\u653e\u7684\u90fd\u662f <code>SYN_RECV</code> \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u90a3\u53ef\u4ee5\u901a\u8fc7\u7edf\u8ba1\u5904\u4e8e\u8fd9\u4e2a\u72b6\u6001\u7684\u8fde\u63a5\u7684\u6570\u91cf\uff0c\u95f4\u63a5\u83b7\u5f97\u534a\u8fde\u63a5\u961f\u5217\u7684\u957f\u5ea6\u3002</p> Bash<pre><code># netstat -nt | grep -i '127.0.0.1:8080' | grep -i 'SYN_RECV' | wc -l\n0\n</code></pre> <p>\u6ce8\u610f\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u90fd\u662f\u6302\u5728\u67d0\u4e2a <code>Listen socket</code> \u4e0a\u7684\uff0c\u6211\u8fd9\u91cc\u7528\u7684\u662f <code>127.0.0.1:8080</code>\uff0c\u5927\u5bb6\u53ef\u4ee5\u66ff\u6362\u6210\u81ea\u5df1\u60f3\u8981\u67e5\u770b\u7684 IP \u7aef\u53e3\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\u6211\u7684\u673a\u5668\u4e0a\u7684\u534a\u8fde\u63a5\u961f\u5217\u957f\u5ea6\u4e3a <code>0</code>\uff0c\u8fd9\u4e2a\u5f88\u6b63\u5e38\uff0c\u6b63\u7ecf\u8fde\u63a5\u8c01\u4f1a\u6ca1\u4e8b\u8001\u5f85\u5728\u534a\u8fde\u63a5\u961f\u5217\u91cc\u3002</p> <p>\u5f53\u961f\u5217\u91cc\u7684\u534a\u8fde\u63a5\u4e0d\u65ad\u589e\u591a\uff0c\u6700\u7ec8\u4e5f\u662f\u4f1a\u53d1\u751f\u6ea2\u51fa\uff0c\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u67e5\u770b\u3002</p> Bash<pre><code># netstat -s | grep -i \"SYNs to LISTEN sockets dropped\" \n    26395 SYNs to LISTEN sockets dropped\n</code></pre> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u6211\u7684\u673a\u5668\u4e0a\u4e00\u5171\u53d1\u751f\u4e86 <code>26395</code> \u6b21\u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u3002\u540c\u6837\u5efa\u8bae\u914d\u5408 <code>watch -d</code> \u547d\u4ee4\u4f7f\u7528\u3002</p> Bash<pre><code># watch -d 'netstat -s | grep -i \"SYNs to LISTEN sockets dropped\"'\nEvery 2.0s: netstat -s | grep -i \"SYNs to LISTEN sockets dropped\"       \nFri Sep 17 08:36:38 2021\n\n    26395 SYNs to LISTEN sockets dropped\n</code></pre>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#_7","title":"\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u4f1a\u600e\u4e48\u6837\uff1f","text":"<p>\u5982\u679c\u961f\u5217\u6ee1\u4e86\uff0c\u670d\u52a1\u7aef\u8fd8\u6536\u5230\u5ba2\u6237\u7aef\u7684\u7b2c\u4e09\u6b21\u63e1\u624b ACK\uff0c\u9ed8\u8ba4\u5f53\u7136\u4f1a\u4e22\u5f03\u8fd9\u4e2a ACK\u3002</p> <p>\u4f46\u9664\u4e86\u4e22\u5f03\u4e4b\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u9644\u5e26\u884c\u4e3a\uff0c\u8fd9\u4f1a\u53d7 <code>tcp_abort_on_overflow</code> \u53c2\u6570\u7684\u5f71\u54cd\u3002</p> Bash<pre><code># cat /proc/sys/net/ipv4/tcp_abort_on_overflow\n0\n</code></pre> <ul> <li><code>tcp_abort_on_overflow</code> \u8bbe\u7f6e\u4e3a <code>0</code>\uff0c\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u4e4b\u540e\uff0c\u4f1a\u4e22\u5f03\u8fd9\u4e2a\u7b2c\u4e09\u6b21\u63e1\u624b ACK \u5305\uff0c\u5e76\u4e14\u5f00\u542f\u5b9a\u65f6\u5668\uff0c\u91cd\u4f20\u7b2c\u4e8c\u6b21\u63e1\u624b\u7684 SYN+ACK\uff0c\u5982\u679c\u91cd\u4f20\u8d85\u8fc7\u4e00\u5b9a\u9650\u5236\u6b21\u6570\uff0c\u8fd8\u4f1a\u628a\u5bf9\u5e94\u7684\u534a\u8fde\u63a5\u961f\u5217\u91cc\u7684\u8fde\u63a5\u7ed9\u5220\u6389\u3002</li> </ul> <p></p> <ul> <li><code>tcp_abort_on_overflow</code>\u8bbe\u7f6e\u4e3a <code>1</code>\uff0c\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u4e4b\u540e\uff0c\u5c31\u76f4\u63a5\u53d1 RST \u7ed9\u5ba2\u6237\u7aef\uff0c\u6548\u679c\u4e0a\u770b\u5c31\u662f\u8fde\u63a5\u65ad\u4e86\u3002</li> </ul> <p>\u8fd9\u4e2a\u73b0\u8c61\u662f\u4e0d\u662f\u5f88\u719f\u6089\uff0c\u670d\u52a1\u7aef\u7aef\u53e3\u672a\u76d1\u542c\u65f6\uff0c\u5ba2\u6237\u7aef\u5c1d\u8bd5\u53bb\u8fde\u63a5\uff0c\u670d\u52a1\u7aef\u4e5f\u4f1a\u56de\u4e00\u4e2a RST\u3002\u8fd9\u4e24\u4e2a\u60c5\u51b5\u957f\u4e00\u6837\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u8fd9\u65f6\u5019\u6536\u5230 RST \u4e4b\u540e\uff0c\u5176\u5b9e\u65e0\u6cd5\u533a\u5206\u5230\u5e95\u662f\u7aef\u53e3\u672a\u76d1\u542c\uff0c\u8fd8\u662f\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#_8","title":"\u534a\u8fde\u63a5\u961f\u5217\u8981\u662f\u6ee1\u4e86\u4f1a\u600e\u4e48\u6837","text":"<p>\u4e00\u822c\u662f\u4e22\u5f03\uff0c\u4f46\u8fd9\u4e2a\u884c\u4e3a\u53ef\u4ee5\u901a\u8fc7 <code>tcp_syncookies</code> \u53c2\u6570\u53bb\u63a7\u5236\u3002\u4f46\u6bd4\u8d77\u8fd9\u4e2a\uff0c\u66f4\u91cd\u8981\u7684\u662f\u5148\u4e86\u89e3\u4e0b\u534a\u8fde\u63a5\u961f\u5217\u4e3a\u4ec0\u4e48\u4f1a\u88ab\u6253\u6ee1\u3002</p> <p>\u9996\u5148\u6211\u4eec\u9700\u8981\u660e\u767d\uff0c\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u534a\u8fde\u63a5\u7684\"\u751f\u5b58\"\u65f6\u95f4\u5176\u5b9e\u5f88\u77ed\uff0c\u53ea\u6709\u5728\u7b2c\u4e00\u6b21\u548c\u7b2c\u4e09\u6b21\u63e1\u624b\u95f4\uff0c\u5982\u679c\u534a\u8fde\u63a5\u90fd\u6ee1\u4e86\uff0c\u8bf4\u660e\u670d\u52a1\u7aef\u75af\u72c2\u6536\u5230\u7b2c\u4e00\u6b21\u63e1\u624b\u8bf7\u6c42\uff0c\u5982\u679c\u662f\u7ebf\u4e0a\u6e38\u620f\u5e94\u7528\uff0c\u80fd\u6709\u8fd9\u4e48\u591a\u8bf7\u6c42\u8fdb\u6765\uff0c\u90a3\u8bf4\u660e\u4f60\u53ef\u80fd\u8981\u5bcc\u4e86\u3002\u4f46\u73b0\u5b9e\u5f80\u5f80\u6bd4\u8f83\u9aa8\u611f\uff0c\u4f60\u53ef\u80fd\u9047\u5230\u4e86 SYN Flood \u653b\u51fb\u3002</p> <p>\u6240\u8c13 SYN Flood \u653b\u51fb\uff0c\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a\uff0c\u653b\u51fb\u65b9\u6a21\u62df\u5ba2\u6237\u7aef\u75af\u72c2\u53d1\u7b2c\u4e00\u6b21\u63e1\u624b\u8bf7\u6c42\u8fc7\u6765\uff0c\u5728\u670d\u52a1\u7aef\u61a8\u61a8\u5730\u56de\u590d\u7b2c\u4e8c\u6b21\u63e1\u624b\u8fc7\u53bb\u4e4b\u540e\uff0c\u5ba2\u6237\u7aef\u6b7b\u6d3b\u4e0d\u53d1\u7b2c\u4e09\u6b21\u63e1\u624b\u8fc7\u6765\uff0c\u8fd9\u6837\u505a\uff0c\u53ef\u4ee5\u628a\u670d\u52a1\u7aef\u534a\u8fde\u63a5\u961f\u5217\u6253\u6ee1\uff0c\u4ece\u800c\u5bfc\u81f4\u6b63\u5e38\u8fde\u63a5\u4e0d\u80fd\u6b63\u5e38\u8fdb\u6765\u3002</p> <p></p> <p>\u90a3\u8fd9\u79cd\u60c5\u51b5\u600e\u4e48\u5904\u7406\uff1f\u6709\u6ca1\u6709\u4e00\u79cd\u65b9\u6cd5\u53ef\u4ee5\u7ed5\u8fc7\u534a\u8fde\u63a5\u961f\u5217\uff1f</p> <p>\u6709\uff0c\u4e0a\u9762\u63d0\u5230\u7684 <code>tcp_syncookies</code> \u6d3e\u4e0a\u7528\u573a\u4e86\u3002</p> Bash<pre><code># cat /proc/sys/net/ipv4/tcp_syncookies\n1\n</code></pre> <p>\u5f53\u5b83\u88ab\u8bbe\u7f6e\u4e3a <code>1</code> \u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u53d1\u6765\u7b2c\u4e00\u6b21\u63e1\u624b SYN \u65f6\uff0c\u670d\u52a1\u7aef\u4e0d\u4f1a\u5c06\u5176\u653e\u5165\u534a\u8fde\u63a5\u961f\u5217\u4e2d\uff0c\u800c\u662f\u76f4\u63a5\u751f\u6210\u4e00\u4e2a <code>cookies</code>\uff0c\u8fd9\u4e2a <code>cookies</code> \u4f1a\u8ddf\u7740\u7b2c\u4e8c\u6b21\u63e1\u624b\uff0c\u53d1\u56de\u5ba2\u6237\u7aef\u3002\u5ba2\u6237\u7aef\u5728\u53d1\u7b2c\u4e09\u6b21\u63e1\u624b\u7684\u65f6\u5019\u5e26\u4e0a\u8fd9\u4e2a <code>cookies</code>\uff0c\u670d\u52a1\u7aef\u9a8c\u8bc1\u5230\u5b83\u5c31\u662f\u5f53\u521d\u53d1\u51fa\u53bb\u7684\u90a3\u4e2a\uff0c\u5c31\u4f1a\u5efa\u7acb\u8fde\u63a5\u5e76\u653e\u5165\u5230\u5168\u8fde\u63a5\u961f\u5217\u4e2d\u3002\u53ef\u4ee5\u770b\u51fa\u6574\u4e2a\u8fc7\u7a0b\u4e0d\u518d\u9700\u8981\u534a\u8fde\u63a5\u961f\u5217\u7684\u53c2\u4e0e\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#cookies","title":"\u4f1a\u6709\u4e00\u4e2a cookies \u961f\u5217\u5417","text":"<p>\u751f\u6210\u662f <code>cookies</code>\uff0c\u4fdd\u5b58\u5728\u54ea\u5462\uff1f\u662f\u4e0d\u662f\u4f1a\u6709\u4e00\u4e2a\u961f\u5217\u4fdd\u5b58\u8fd9\u4e9b cookies\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u53cd\u8fc7\u6765\u60f3\u4e00\u4e0b\uff0c\u5982\u679c\u6709 <code>cookies</code> \u961f\u5217\uff0c\u90a3\u5b83\u4f1a\u8ddf\u534a\u8fde\u63a5\u961f\u5217\u4e00\u6837\uff0c\u5230\u5934\u6765\uff0c\u8fd8\u662f\u4f1a\u88ab SYN Flood \u653b\u51fb\u6253\u6ee1\u3002</p> <p>\u5b9e\u9645\u4e0a <code>cookies</code> \u5e76\u4e0d\u4f1a\u6709\u4e00\u4e2a\u4e13\u95e8\u7684\u961f\u5217\u4fdd\u5b58\uff0c\u5b83\u662f\u901a\u8fc7\u901a\u4fe1\u53cc\u65b9\u7684 IP \u5730\u5740\u7aef\u53e3\u3001\u65f6\u95f4\u6233\u3001MSS\u7b49\u4fe1\u606f\u8fdb\u884c\u5b9e\u65f6\u8ba1\u7b97\u7684\uff0c\u4fdd\u5b58\u5728 TCP \u62a5\u5934\u7684 <code>seq</code> \u91cc\u3002</p> <p></p> <p>\u5f53\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u6765\u7684\u7b2c\u4e09\u6b21\u63e1\u624b\u5305\u65f6\uff0c\u4f1a\u901a\u8fc7 seq \u8fd8\u539f\u51fa\u901a\u4fe1\u53cc\u65b9\u7684 IP \u5730\u5740\u7aef\u53e3\u3001\u65f6\u95f4\u6233\u3001MSS\uff0c\u9a8c\u8bc1\u901a\u8fc7\u5219\u5efa\u7acb\u8fde\u63a5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#cookies_1","title":"cookies \u65b9\u6848\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u53d6\u4ee3\u534a\u8fde\u63a5\u961f\u5217\uff1f","text":"<p>\u76ee\u524d\u770b\u4e0b\u6765 <code>syn cookies</code> \u65b9\u6848\u7701\u4e0b\u4e86\u534a\u8fde\u63a5\u961f\u5217\u6240\u9700\u8981\u7684\u961f\u5217\u5185\u5b58\uff0c\u8fd8\u80fd\u89e3\u51b3 SYN Flood \u653b\u51fb\uff0c\u90a3\u4e3a\u4ec0\u4e48\u4e0d\u76f4\u63a5\u53d6\u4ee3\u534a\u8fde\u63a5\u961f\u5217\uff1f</p> <p>\u51e1\u4e8b\u7686\u6709\u5229\u5f0a\uff0c<code>cookies</code> \u65b9\u6848\u867d\u7136\u80fd\u9632 SYN Flood \u653b\u51fb\uff0c\u4f46\u662f\u4e5f\u6709\u4e00\u4e9b\u95ee\u9898\u3002\u56e0\u4e3a\u670d\u52a1\u7aef\u5e76\u4e0d\u4f1a\u4fdd\u5b58\u8fde\u63a5\u4fe1\u606f\uff0c\u6240\u4ee5\u5982\u679c\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u6570\u636e\u5305\u4e22\u4e86\uff0c\u4e5f\u4e0d\u4f1a\u91cd\u53d1\u7b2c\u4e8c\u6b21\u63e1\u624b\u7684\u4fe1\u606f\u3002</p> <p>\u53e6\u5916\uff0c\u7f16\u7801\u89e3\u7801 <code>cookies</code>\uff0c\u90fd\u662f\u6bd4\u8f83\u8017 CPU \u7684\uff0c\u5229\u7528\u8fd9\u4e00\u70b9\uff0c\u5982\u679c\u6b64\u65f6\u653b\u51fb\u8005\u6784\u9020\u5927\u91cf\u7684\u7b2c\u4e09\u6b21\u63e1\u624b\u5305\uff08ACK \u5305\uff09\uff0c\u540c\u65f6\u5e26\u4e0a\u5404\u79cd\u778e\u7f16\u7684 <code>cookies</code> \u4fe1\u606f\uff0c\u670d\u52a1\u7aef\u6536\u5230 <code>ACK \u5305</code>\u540e\u4ee5\u4e3a\u662f\u6b63\u7ecf cookies\uff0c\u61a8\u61a8\u5730\u8dd1\u53bb\u89e3\u7801\uff08\u8017 CPU\uff09\uff0c\u6700\u540e\u53d1\u73b0\u4e0d\u662f\u6b63\u7ecf\u6570\u636e\u5305\u540e\u624d\u4e22\u5f03\u3002</p> <p>\u8fd9\u79cd\u901a\u8fc7\u6784\u9020\u5927\u91cf <code>ACK \u5305</code>\u53bb\u6d88\u8017\u670d\u52a1\u7aef\u8d44\u6e90\u7684\u653b\u51fb\uff0c\u53eb ACK \u653b\u51fb\uff0c\u53d7\u5230\u653b\u51fb\u7684\u670d\u52a1\u5668\u53ef\u80fd\u4f1a\u56e0\u4e3a CPU \u8d44\u6e90\u8017\u5c3d\u5bfc\u81f4\u6ca1\u80fd\u54cd\u5e94\u6b63\u7ecf\u8bf7\u6c42\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#listen","title":"\u6ca1\u6709 listen\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u80fd\u5efa\u7acb\u8fde\u63a5","text":"<p>\u90a3\u65e2\u7136\u6ca1\u6709 <code>accept</code> \u65b9\u6cd5\u80fd\u5efa\u7acb\u8fde\u63a5\uff0c\u90a3\u662f\u4e0d\u662f\u6ca1\u6709 <code>listen</code> \u65b9\u6cd5\uff0c\u4e5f\u80fd\u5efa\u7acb\u8fde\u63a5\uff1f\u662f\u7684\uff0c\u4e4b\u524d\u5199\u7684\u4e00\u7bc7\u6587\u7ae0\u63d0\u5230\u8fc7\u5ba2\u6237\u7aef\u662f\u53ef\u4ee5\u81ea\u5df1\u8fde\u81ea\u5df1\u7684\u5f62\u6210\u8fde\u63a5\uff08TCP \u81ea\u8fde\u63a5\uff09\uff0c\u4e5f\u53ef\u4ee5\u4e24\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u5411\u5bf9\u65b9\u53d1\u51fa\u8bf7\u6c42\u5efa\u7acb\u8fde\u63a5\uff08TCP \u540c\u65f6\u6253\u5f00\uff09\uff0c\u8fd9\u4e24\u4e2a\u60c5\u51b5\u90fd\u6709\u4e2a\u5171\u540c\u70b9\uff0c\u5c31\u662f\u6ca1\u6709\u670d\u52a1\u7aef\u53c2\u4e0e\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709 listen\uff0c\u5c31\u80fd\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u5f53\u65f6\u6587\u7ae0\u6700\u540e\u4e5f\u7559\u4e86\u4e2a\u7591\u95ee\uff0c\u6ca1\u6709 listen\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u80fd\u5efa\u7acb\u8fde\u63a5\uff1f</p> <p>\u6211\u4eec\u77e5\u9053\u6267\u884c <code>listen</code> \u65b9\u6cd5\u65f6\uff0c\u4f1a\u521b\u5efa\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u3002</p> <p>\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5728\u8fd9\u4e24\u4e2a\u961f\u5217\u4e2d\u6682\u5b58\u8fde\u63a5\u4fe1\u606f\u3002</p> <p>\u6240\u4ee5\u5f62\u6210\u8fde\u63a5\uff0c\u524d\u63d0\u662f\u4f60\u5f97\u6709\u4e2a\u5730\u65b9\u5b58\u653e\u7740\uff0c\u65b9\u4fbf\u63e1\u624b\u7684\u65f6\u5019\u80fd\u6839\u636e IP \u7aef\u53e3\u7b49\u4fe1\u606f\u627e\u5230 socket \u4fe1\u606f\u3002</p> <p>\u90a3\u4e48\u5ba2\u6237\u7aef\u4f1a\u6709\u534a\u8fde\u63a5\u961f\u5217\u5417\uff1f</p> <p>\u663e\u7136\u6ca1\u6709\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u6ca1\u6709\u6267\u884c <code>listen</code>\uff0c\u56e0\u4e3a\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u90fd\u662f\u5728\u6267\u884c <code>listen</code> \u65b9\u6cd5\u65f6\uff0c\u5185\u6838\u81ea\u52a8\u521b\u5efa\u7684\u3002</p> <p>\u4f46\u5185\u6838\u8fd8\u6709\u4e2a\u5168\u5c40 <code>hash</code> \u8868\uff0c\u53ef\u4ee5\u7528\u4e8e\u5b58\u653e <code>sock</code> \u8fde\u63a5\u7684\u4fe1\u606f\u3002\u8fd9\u4e2a\u5168\u5c40 <code>hash</code> \u8868\u5176\u5b9e\u8fd8\u7ec6\u5206\u4e3a <code>ehash\uff0cbhash\u548clisten_hash</code> \u7b49\uff0c\u4f46\u56e0\u4e3a\u8fc7\u4e8e\u7ec6\u8282\uff0c\u5927\u5bb6\u7406\u89e3\u6210\u6709\u4e00\u4e2a\u5168\u5c40 hash \u5c31\u591f\u4e86\u3002</p> <p>\u5728 TCP \u81ea\u8fde\u63a5\u7684\u60c5\u51b5\u4e2d\uff0c\u5ba2\u6237\u7aef\u5728 <code>connect</code> \u65b9\u6cd5\u65f6\uff0c\u6700\u540e\u4f1a\u5c06\u81ea\u5df1\u7684\u8fde\u63a5\u4fe1\u606f\u653e\u5165\u5230\u8fd9\u4e2a\u5168\u5c40 hash \u8868\u4e2d\uff0c\u7136\u540e\u5c06\u4fe1\u606f\u53d1\u51fa\uff0c\u6d88\u606f\u5728\u7ecf\u8fc7\u56de\u73af\u5730\u5740\u91cd\u65b0\u56de\u5230 TCP \u4f20\u8f93\u5c42\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u6839\u636e IP \u7aef\u53e3\u4fe1\u606f\uff0c\u518d\u4e00\u6b21\u4ece\u8fd9\u4e2a\u5168\u5c40 hash \u4e2d\u53d6\u51fa\u4fe1\u606f\u3002\u4e8e\u662f\u63e1\u624b\u5305\u4e00\u6765\u4e00\u56de\uff0c\u6700\u540e\u6210\u529f\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>TCP \u540c\u65f6\u6253\u5f00\u7684\u60c5\u51b5\u4e5f\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u4ece\u4e00\u4e2a\u5ba2\u6237\u7aef\u53d8\u6210\u4e86\u4e24\u4e2a\u5ba2\u6237\u7aef\u800c\u5df2\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_accpet/#_9","title":"\u603b\u7ed3","text":"<ul> <li>\u6bcf\u4e00\u4e2a <code>socket</code> \u6267\u884c <code>listen</code> \u65f6\uff0c\u5185\u6838\u90fd\u4f1a\u81ea\u52a8\u521b\u5efa\u4e00\u4e2a\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u3002</li> <li>\u7b2c\u4e09\u6b21\u63e1\u624b\u524d\uff0cTCP \u8fde\u63a5\u4f1a\u653e\u5728\u534a\u8fde\u63a5\u961f\u5217\u4e2d\uff0c\u76f4\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\u5230\u6765\uff0c\u624d\u4f1a\u88ab\u653e\u5230\u5168\u8fde\u63a5\u961f\u5217\u4e2d\u3002</li> <li><code>accept</code> \u65b9\u6cd5\u53ea\u662f\u4e3a\u4e86\u4ece\u5168\u8fde\u63a5\u961f\u5217\u4e2d\u62ff\u51fa\u4e00\u6761\u8fde\u63a5\uff0c\u672c\u8eab\u8ddf\u4e09\u6b21\u63e1\u624b\u51e0\u4e4e\u6beb\u65e0\u5173\u7cfb\u3002</li> <li>\u51fa\u4e8e\u6548\u7387\u8003\u8651\uff0c\u867d\u7136\u90fd\u53eb\u961f\u5217\uff0c\u4f46\u534a\u8fde\u63a5\u961f\u5217\u5176\u5b9e\u88ab\u8bbe\u8ba1\u6210\u4e86\u54c8\u5e0c\u8868\uff0c\u800c\u5168\u8fde\u63a5\u961f\u5217\u672c\u8d28\u662f\u94fe\u8868\u3002</li> <li>\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u518d\u6765\u7b2c\u4e09\u6b21\u63e1\u624b\u4e5f\u4f1a\u4e22\u5f03\uff0c\u6b64\u65f6\u5982\u679c <code>tcp_abort_on_overflow=1</code>\uff0c\u8fd8\u4f1a\u76f4\u63a5\u53d1 <code>RST</code> \u7ed9\u5ba2\u6237\u7aef\u3002</li> <li>\u534a\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u53ef\u80fd\u662f\u56e0\u4e3a\u53d7\u5230\u4e86 <code>SYN Flood</code> \u653b\u51fb\uff0c\u53ef\u4ee5\u8bbe\u7f6e <code>tcp_syncookies</code>\uff0c\u7ed5\u5f00\u534a\u8fde\u63a5\u961f\u5217\u3002</li> <li>\u5ba2\u6237\u7aef\u6ca1\u6709\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\uff0c\u4f46\u6709\u4e00\u4e2a\u5168\u5c40 hash\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b83\u5b9e\u73b0\u81ea\u8fde\u63a5\u6216 TCP \u540c\u65f6\u6253\u5f00\u3002</li> </ul> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_listen/","title":"4.19 \u670d\u52a1\u7aef\u6ca1\u6709 listen\uff0c\u5ba2\u6237\u7aef\u53d1\u8d77\u8fde\u63a5\u5efa\u7acb\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u65e9\u4e0a\u770b\u5230\u4e00\u4e2a\u8bfb\u8005\u8bf4\u9762\u5b57\u8282\u4e09\u9762\u7684\u65f6\u5019\uff0c\u95ee\u4e86\u8fd9\u4e2a\u95ee\u9898\uff1a</p> <p></p> <p>\u8fd9\u4f4d\u8bfb\u8005\u7684\u89d2\u5ea6\u662f\u4ee5\u4e3a\u670d\u52a1\u7aef\u6ca1\u6709\u8c03\u7528 listen\uff0c\u5ba2\u6237\u7aef\u4f1a ping \u4e0d\u901a\u670d\u52a1\u5668\uff0c\u5f88\u660e\u663e\uff0c\u641e\u9519\u4e86\u3002</p> <p>ping \u4f7f\u7528\u7684\u534f\u8bae\u662f ICMP\uff0c\u5c5e\u4e8e\u7f51\u7edc\u5c42\u7684\u4e8b\u60c5\uff0c\u800c\u9762\u8bd5\u5b98\u95ee\u7684\u662f\u4f20\u8f93\u5c42\u7684\u95ee\u9898\u3002</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u670d\u52a1\u7aef\u5982\u679c\u53ea bind \u4e86 IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u800c\u6ca1\u6709\u8c03\u7528 listen \u7684\u8bdd\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u5bf9\u670d\u52a1\u7aef\u53d1\u8d77\u4e86 TCP \u8fde\u63a5\u5efa\u7acb\uff0c\u6b64\u65f6\u90a3\u4e48\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_listen/#_1","title":"\u505a\u4e2a\u5b9e\u9a8c","text":"<p>\u8fd9\u4e2a\u95ee\u9898\uff0c\u81ea\u5df1\u505a\u4e2a\u5b9e\u9a8c\u5c31\u77e5\u9053\u4e86\u3002</p> <p>\u6211\u7528\u4e0b\u9762\u8fd9\u4e2a\u7a0b\u5e8f\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u7ed1\u5b9a\u4e86 IP \u5730\u5740 + \u7aef\u53e3\uff0c\u800c\u6ca1\u6709\u8c03\u7528 listen\u3002</p> C<pre><code>/*******\u670d\u52a1\u5668\u7a0b\u5e8f  TCPServer.c ************/\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;string.h&gt;\n#include &lt;netdb.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;sys/socket.h&gt;\n\nint main(int argc, char *argv[])\n{\n    int sockfd, ret;\n    struct sockaddr_in server_addr;\n\n    /* \u670d\u52a1\u5668\u7aef\u521b\u5efa tcp socket \u63cf\u8ff0\u7b26 */\n    sockfd = socket(AF_INET, SOCK_STREAM, 0);\n    if(sockfd &lt; 0)\n    {\n        fprintf(stderr, \"Socket error:%s\\n\\a\", strerror(errno));\n        exit(1);\n    }\n\n    /* \u670d\u52a1\u5668\u7aef\u586b\u5145 sockaddr \u7ed3\u6784 */\n    bzero(&amp;server_addr, sizeof(struct sockaddr_in));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.s_addr = htonl(INADDR_ANY);\n    server_addr.sin_port = htons(8888);\n\n  /* \u7ed1\u5b9a ip + \u7aef\u53e3 */\n    ret = bind(sockfd, (struct sockaddr *)(&amp;server_addr), sizeof(struct sockaddr));\n    if(ret &lt; 0)\n    {\n        fprintf(stderr, \"Bind error:%s\\n\\a\", strerror(errno));\n        exit(1);\n    }\n\n  //\u6ca1\u6709\u8c03\u7528 listen\n\n    sleep(1000);\n    close(sockfd);\n    return 0;\n}\n</code></pre> <p>\u7136\u540e\uff0c\u6211\u7528\u6d4f\u89c8\u5668\u8bbf\u95ee\u8fd9\u4e2a\u5730\u5740\uff1ahttp://121.43.173.240:8888/</p> <p></p> <p>\u62a5\u9519\u8fde\u63a5\u670d\u52a1\u5668\u5931\u8d25\u3002</p> <p>\u540c\u65f6\uff0c\u6211\u4e5f\u7528\u6293\u5305\u5de5\u5177\uff0c\u6293\u4e86\u8fd9\u4e2a\u8fc7\u7a0b\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u5ba2\u6237\u7aef\u5bf9\u670d\u52a1\u7aef\u53d1\u8d77 SYN \u62a5\u6587\u540e\uff0c\u670d\u52a1\u7aef\u56de\u4e86 RST \u62a5\u6587\u3002</p> <p>\u6240\u4ee5\uff0c\u8fd9\u4e2a\u95ee\u9898\u5c31\u6709\u4e86\u7b54\u6848\uff0c\u670d\u52a1\u7aef\u5982\u679c\u53ea bind \u4e86 IP \u5730\u5740\u548c\u7aef\u53e3\uff0c\u800c\u6ca1\u6709\u8c03\u7528 listen \u7684\u8bdd\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u5bf9\u670d\u52a1\u7aef\u53d1\u8d77\u4e86\u8fde\u63a5\u5efa\u7acb\uff0c\u670d\u52a1\u7aef\u4f1a\u56de RST \u62a5\u6587\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_listen/#_2","title":"\u6e90\u7801\u5206\u6790","text":"<p>\u63a5\u4e0b\u6765\uff0c\u5e26\u5927\u5bb6\u6e90\u7801\u5206\u6790\u4e00\u4e0b\u3002</p> <p>Linux \u5185\u6838\u5904\u7406\u6536\u5230 TCP \u62a5\u6587\u7684\u5165\u53e3\u51fd\u6570\u662f  tcp_v4_rcv\uff0c\u5728\u6536\u5230 TCP \u62a5\u6587\u540e\uff0c\u4f1a\u8c03\u7528 __inet_lookup_skb \u51fd\u6570\u627e\u5230 TCP \u62a5\u6587\u6240\u5c5e socket\u3002</p> Text Only<pre><code>int tcp_v4_rcv(struct sk_buff *skb)\n{\n ...\n\n sk = __inet_lookup_skb(&amp;tcp_hashinfo, skb, th-&gt;source, th-&gt;dest);\n if (!sk)\n  goto no_tcp_socket;\n ...\n}\n</code></pre> <p>__inet_lookup_skb \u51fd\u6570\u9996\u5148\u67e5\u627e\u8fde\u63a5\u5efa\u7acb\u72b6\u6001\u7684 socket\uff08__inet_lookup_established\uff09\uff0c\u5728\u6ca1\u6709\u547d\u4e2d\u7684\u60c5\u51b5\u4e0b\uff0c\u624d\u4f1a\u67e5\u627e\u76d1\u542c\u5957\u63a5\u53e3\uff08__inet_lookup_listener\uff09\u3002</p> <p></p> <p>\u67e5\u627e\u76d1\u542c\u5957\u63a5\u53e3\uff08__inet_lookup_listener\uff09\u8fd9\u4e2a\u51fd\u6570\u7684\u5b9e\u73b0\u662f\uff0c\u6839\u636e\u76ee\u7684\u5730\u5740\u548c\u76ee\u7684\u7aef\u53e3\u7b97\u51fa\u4e00\u4e2a\u54c8\u5e0c\u503c\uff0c\u7136\u540e\u5728\u54c8\u5e0c\u8868\u627e\u5230\u5bf9\u5e94\u76d1\u542c\u8be5\u7aef\u53e3\u7684 socket\u3002</p> <p>\u672c\u6b21\u7684\u6848\u4f8b\u4e2d\uff0c\u670d\u52a1\u7aef\u662f\u6ca1\u6709\u8c03\u7528 listen \u51fd\u6570\u7684\uff0c\u6240\u4ee5\u81ea\u7136\u4e5f\u662f\u627e\u4e0d\u5230\u76d1\u542c\u8be5\u7aef\u53e3\u7684 socket\u3002</p> <p>\u6240\u4ee5\uff0c__inet_lookup_skb \u51fd\u6570\u6700\u7ec8\u627e\u4e0d\u5230\u5bf9\u5e94\u7684 socket\uff0c\u4e8e\u662f\u8df3\u8f6c\u5230 no_tcp_socket\u3002</p> <p></p> <p>\u5728\u8fd9\u4e2a\u9519\u8bef\u5904\u7406\u4e2d\uff0c\u53ea\u8981\u6536\u5230\u7684\u62a5\u6587\uff08skb\uff09\u7684\u300c\u6821\u9a8c\u548c\u300d\u6ca1\u95ee\u9898\u7684\u8bdd\uff0c\u5185\u6838\u5c31\u4f1a\u8c03\u7528 tcp_v4_send_reset \u53d1\u9001 RST \u4e2d\u6b62\u8fd9\u4e2a\u8fde\u63a5\u3002</p> <p>\u81f3\u6b64\uff0c\u6574\u4e2a\u6e90\u7801\u6d41\u7a0b\u5c31\u89e3\u6790\u5b8c\u3002</p> <p>\u5176\u5b9e\u5f88\u591a\u7f51\u7edc\u7684\u95ee\u9898\uff0c\u5927\u5bb6\u90fd\u53ef\u4ee5\u81ea\u5df1\u505a\u5b9e\u9a8c\u6765\u627e\u5230\u7b54\u6848\u7684\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_no_listen/#listen-tcp","title":"\u6ca1\u6709 listen\uff0c\u80fd\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f","text":"<p>\u6807\u9898\u7684\u95ee\u9898\u5728\u524d\u9762\u5df2\u7ecf\u89e3\u7b54\uff0c\u73b0\u5728\u6211\u4eec\u770b\u53e6\u5916\u4e00\u4e2a\u76f8\u4f3c\u7684\u95ee\u9898\u3002</p> <p>\u4e4b\u524d\u770b\u7fa4\u6d88\u606f\uff0c\u770b\u5230\u6709\u8bfb\u8005\u9762\u8bd5\u817e\u8baf\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\u8fd9\u4e48\u4e00\u4e2a\u95ee\u9898\u3002</p> <p>\u4e0d\u4f7f\u7528 listen\uff0c\u53ef\u4ee5\u5efa\u7acb TCP \u8fde\u63a5\u5417\uff1f</p> <p>\u7b54\u6848\uff0c\u662f\u53ef\u4ee5\u7684\uff0c\u5ba2\u6237\u7aef\u662f\u53ef\u4ee5\u81ea\u5df1\u8fde\u81ea\u5df1\u7684\u5f62\u6210\u8fde\u63a5\uff08TCP \u81ea\u8fde\u63a5\uff09\uff0c\u4e5f\u53ef\u4ee5\u4e24\u4e2a\u5ba2\u6237\u7aef\u540c\u65f6\u5411\u5bf9\u65b9\u53d1\u51fa\u8bf7\u6c42\u5efa\u7acb\u8fde\u63a5\uff08TCP \u540c\u65f6\u6253\u5f00\uff09\uff0c\u8fd9\u4e24\u4e2a\u60c5\u51b5\u90fd\u6709\u4e2a\u5171\u540c\u70b9\uff0c\u5c31\u662f\u6ca1\u6709\u670d\u52a1\u7aef\u53c2\u4e0e\uff0c\u4e5f\u5c31\u662f\u6ca1\u6709 listen\uff0c\u5c31\u80fd\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u90a3\u6ca1\u6709 listen\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u80fd\u5efa\u7acb\u8fde\u63a5\uff1f</p> <p>\u6211\u4eec\u77e5\u9053\u6267\u884c listen \u65b9\u6cd5\u65f6\uff0c\u4f1a\u521b\u5efa\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u3002</p> <p>\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5728\u8fd9\u4e24\u4e2a\u961f\u5217\u4e2d\u6682\u5b58\u8fde\u63a5\u4fe1\u606f\u3002</p> <p>\u6240\u4ee5\u5f62\u6210\u8fde\u63a5\uff0c\u524d\u63d0\u662f\u4f60\u5f97\u6709\u4e2a\u5730\u65b9\u5b58\u653e\u7740\uff0c\u65b9\u4fbf\u63e1\u624b\u7684\u65f6\u5019\u80fd\u6839\u636e IP + \u7aef\u53e3\u7b49\u4fe1\u606f\u627e\u5230\u5bf9\u5e94\u7684 socket\u3002</p> <p>\u90a3\u4e48\u5ba2\u6237\u7aef\u4f1a\u6709\u534a\u8fde\u63a5\u961f\u5217\u5417\uff1f</p> <p>\u663e\u7136\u6ca1\u6709\uff0c\u56e0\u4e3a\u5ba2\u6237\u7aef\u6ca1\u6709\u6267\u884c listen\uff0c\u56e0\u4e3a\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u90fd\u662f\u5728\u6267\u884c listen \u65b9\u6cd5\u65f6\uff0c\u5185\u6838\u81ea\u52a8\u521b\u5efa\u7684\u3002</p> <p>\u4f46\u5185\u6838\u8fd8\u6709\u4e2a\u5168\u5c40 hash \u8868\uff0c\u53ef\u4ee5\u7528\u4e8e\u5b58\u653e sock \u8fde\u63a5\u7684\u4fe1\u606f\u3002</p> <p>\u8fd9\u4e2a\u5168\u5c40 hash \u8868\u5176\u5b9e\u8fd8\u7ec6\u5206\u4e3a ehash\uff0cbhash \u548c listen_hash \u7b49\uff0c\u4f46\u56e0\u4e3a\u8fc7\u4e8e\u7ec6\u8282\uff0c\u5927\u5bb6\u7406\u89e3\u6210\u6709\u4e00\u4e2a\u5168\u5c40 hash \u5c31\u591f\u4e86\uff0c</p> <p>\u5728 TCP \u81ea\u8fde\u63a5\u7684\u60c5\u51b5\u4e2d\uff0c\u5ba2\u6237\u7aef\u5728 connect \u65b9\u6cd5\u65f6\uff0c\u6700\u540e\u4f1a\u5c06\u81ea\u5df1\u7684\u8fde\u63a5\u4fe1\u606f\u653e\u5165\u5230\u8fd9\u4e2a\u5168\u5c40 hash \u8868\u4e2d\uff0c\u7136\u540e\u5c06\u4fe1\u606f\u53d1\u51fa\uff0c\u6d88\u606f\u5728\u7ecf\u8fc7\u56de\u73af\u5730\u5740\u91cd\u65b0\u56de\u5230 TCP \u4f20\u8f93\u5c42\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u6839\u636e IP + \u7aef\u53e3\u4fe1\u606f\uff0c\u518d\u4e00\u6b21\u4ece\u8fd9\u4e2a\u5168\u5c40 hash \u4e2d\u53d6\u51fa\u4fe1\u606f\u3002\u4e8e\u662f\u63e1\u624b\u5305\u4e00\u6765\u4e00\u56de\uff0c\u6700\u540e\u6210\u529f\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>TCP \u540c\u65f6\u6253\u5f00\u7684\u60c5\u51b5\u4e5f\u7c7b\u4f3c\uff0c\u53ea\u4e0d\u8fc7\u4ece\u4e00\u4e2a\u5ba2\u6237\u7aef\u53d8\u6210\u4e86\u4e24\u4e2a\u5ba2\u6237\u7aef\u800c\u5df2\u3002</p> <p>\u505a\u4e2a\u5b9e\u9a8c</p> <p>\u5ba2\u6237\u7aef\u81ea\u8fde\u63a5\u7684\u4ee3\u7801\uff0cTCP socket \u53ef\u4ee5 connect \u5b83\u672c\u8eab bind \u7684\u5730\u5740\u548c\u7aef\u53e3\uff1a</p> C<pre><code>#include &lt;sys/types.h&gt; \n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;unistd.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;string.h&gt;\n#include &lt;errno.h&gt;\n\n#define LOCAL_IP_ADDR       (0x7F000001) // IP 127.0.0.1\n#define LOCAL_TCP_PORT      (34567) // \u7aef\u53e3\n\nint main(void)\n{\n    struct sockaddr_in local, peer;\n    int ret;\n    char buf[128];\n    int sock = socket(AF_INET, SOCK_STREAM, 0);\n\n    memset(&amp;local, 0, sizeof(local));\n    memset(&amp;peer, 0, sizeof(peer));\n\n    local.sin_family = AF_INET;\n    local.sin_port = htons(LOCAL_TCP_PORT);\n    local.sin_addr.s_addr = htonl(LOCAL_IP_ADDR);\n\n    peer = local;   \n\n    int flag = 1;\n    ret = setsockopt(sock, SOL_SOCKET, SO_REUSEADDR, &amp;flag, sizeof(flag));\n    if (ret == -1) {\n        printf(\"Fail to setsocket SO_REUSEADDR: %s\\n\", strerror(errno));\n        exit(1);\n    }\n\n    ret = bind(sock, (const struct sockaddr *)&amp;local, sizeof(local));\n    if (ret) {\n        printf(\"Fail to bind: %s\\n\", strerror(errno));\n        exit(1);\n    }\n\n    ret = connect(sock, (const struct sockaddr *)&amp;peer, sizeof(peer));\n    if (ret) {\n        printf(\"Fail to connect myself: %s\\n\", strerror(errno));\n        exit(1);\n    }\n\n    printf(\"Connect to myself successfully\\n\");\n\n    //\u53d1\u9001\u6570\u636e\n    strcpy(buf, \"Hello, myself~\");\n    send(sock, buf, strlen(buf), 0);\n\n    memset(buf, 0, sizeof(buf));\n\n    //\u63a5\u6536\u6570\u636e\n    recv(sock, buf, sizeof(buf), 0);\n    printf(\"Recv the msg: %s\\n\", buf);\n\n    sleep(1000);\n    close(sock);\n    return 0;\n}\n</code></pre> <p>\u7f16\u8bd1\u8fd0\u884c\uff1a</p> <p></p> <p>\u901a\u8fc7 netstat \u547d\u4ee4\u547d\u4ee4\u5ba2\u6237\u7aef\u81ea\u8fde\u63a5\u7684 TCP \u8fde\u63a5\uff1a</p> <p></p> <p>\u4ece\u622a\u56fe\u4e2d\uff0c\u53ef\u4ee5\u770b\u5230 TCP socket \u6210\u529f\u7684\u201c\u8fde\u63a5\u201d\u4e86\u81ea\u5df1\uff0c\u5e76\u53d1\u9001\u548c\u63a5\u6536\u4e86\u6570\u636e\u5305\uff0cnetstat \u7684\u8f93\u51fa\u66f4\u8bc1\u660e\u4e86 TCP \u7684\u4e24\u7aef\u5730\u5740\u548c\u7aef\u53e3\u662f\u5b8c\u5168\u76f8\u540c\u7684\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/","title":"4.5 \u5982\u4f55\u4f18\u5316 TCP?","text":"<p>TCP \u6027\u80fd\u7684\u63d0\u5347\u4e0d\u4ec5\u8003\u5bdf TCP \u7684\u7406\u8bba\u77e5\u8bc6\uff0c\u8fd8\u8003\u5bdf\u4e86\u5bf9\u4e8e\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u7684\u5185\u6838\u53c2\u6570\u7684\u7406\u89e3\u4e0e\u5e94\u7528\u3002</p> <p>TCP \u534f\u8bae\u662f\u7531\u64cd\u4f5c\u7cfb\u7edf\u5b9e\u73b0\uff0c\u6240\u4ee5\u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e0d\u5c11\u8c03\u8282 TCP \u7684\u53c2\u6570\u3002</p> <p></p> <p>\u5982\u4f55\u6b63\u786e\u6709\u6548\u7684\u4f7f\u7528\u8fd9\u4e9b\u53c2\u6570\uff0c\u6765\u63d0\u9ad8 TCP \u6027\u80fd\u662f\u4e00\u4e2a\u4e0d\u90a3\u4e48\u7b80\u5355\u4e8b\u60c5\u3002\u6211\u4eec\u9700\u8981\u9488\u5bf9 TCP \u6bcf\u4e2a\u9636\u6bb5\u7684\u95ee\u9898\u6765\u5bf9\u75c7\u4e0b\u836f\uff0c\u800c\u4e0d\u662f\u75c5\u6025\u4e71\u6295\u533b\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c06\u4ee5\u4e09\u4e2a\u89d2\u5ea6\u6765\u9610\u8ff0\u63d0\u5347 TCP \u7684\u7b56\u7565\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>TCP \u4e09\u6b21\u63e1\u624b\u7684\u6027\u80fd\u63d0\u5347\uff1b</li> <li>TCP \u56db\u6b21\u6325\u624b\u7684\u6027\u80fd\u63d0\u5347\uff1b</li> <li>TCP \u6570\u636e\u4f20\u8f93\u7684\u6027\u80fd\u63d0\u5347\uff1b</li> </ul> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#tcp","title":"TCP \u4e09\u6b21\u63e1\u624b\u7684\u6027\u80fd\u63d0\u5347","text":"<p>TCP \u662f\u9762\u5411\u8fde\u63a5\u7684\u3001\u53ef\u9760\u7684\u3001\u53cc\u5411\u4f20\u8f93\u7684\u4f20\u8f93\u5c42\u901a\u4fe1\u534f\u8bae\uff0c\u6240\u4ee5\u5728\u4f20\u8f93\u6570\u636e\u4e4b\u524d\u9700\u8981\u7ecf\u8fc7\u4e09\u6b21\u63e1\u624b\u624d\u80fd\u5efa\u7acb\u8fde\u63a5\u3002</p> <p></p> <p>\u90a3\u4e48\uff0c\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\u5728\u4e00\u4e2a HTTP \u8bf7\u6c42\u7684\u5e73\u5747\u65f6\u95f4\u5360\u6bd4 10% \u4ee5\u4e0a\uff0c\u5728\u7f51\u7edc\u72b6\u6001\u4e0d\u4f73\u3001\u9ad8\u5e76\u53d1\u6216\u8005\u906d\u9047 SYN \u653b\u51fb\u7b49\u573a\u666f\u4e2d\uff0c\u5982\u679c\u4e0d\u80fd\u6709\u6548\u6b63\u786e\u7684\u8c03\u8282\u4e09\u6b21\u63e1\u624b\u4e2d\u7684\u53c2\u6570\uff0c\u5c31\u4f1a\u5bf9\u6027\u80fd\u4ea7\u751f\u5f88\u591a\u7684\u5f71\u54cd\u3002</p> <p>\u5982\u4f55\u6b63\u786e\u6709\u6548\u7684\u4f7f\u7528\u8fd9\u4e9b\u53c2\u6570\uff0c\u6765\u63d0\u9ad8 TCP \u4e09\u6b21\u63e1\u624b\u7684\u6027\u80fd\uff0c\u8fd9\u5c31\u9700\u8981\u7406\u89e3\u300c\u4e09\u6b21\u63e1\u624b\u7684\u72b6\u6001\u53d8\u8fc1\u300d\uff0c\u8fd9\u6837\u5f53\u51fa\u73b0\u95ee\u9898\u65f6\uff0c\u5148\u7528 <code>netstat</code> \u547d\u4ee4\u67e5\u770b\u662f\u54ea\u4e2a\u63e1\u624b\u9636\u6bb5\u51fa\u73b0\u4e86\u95ee\u9898\uff0c\u518d\u6765\u5bf9\u75c7\u4e0b\u836f\uff0c\u800c\u4e0d\u662f\u75c5\u6025\u4e71\u6295\u533b\u3002</p> <p></p> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u53ef\u4ee5\u9488\u5bf9\u4e09\u6b21\u63e1\u624b\u4f18\u5316\u6027\u80fd\u3002\u4e3b\u52a8\u53d1\u8d77\u8fde\u63a5\u7684\u5ba2\u6237\u7aef\u4f18\u5316\u76f8\u5bf9\u7b80\u5355\u4e9b\uff0c\u800c\u670d\u52a1\u7aef\u9700\u8981\u76d1\u542c\u7aef\u53e3\uff0c\u5c5e\u4e8e\u88ab\u52a8\u8fde\u63a5\u65b9\uff0c\u5176\u95f4\u4fdd\u6301\u8bb8\u591a\u7684\u4e2d\u95f4\u72b6\u6001\uff0c\u4f18\u5316\u65b9\u6cd5\u76f8\u5bf9\u590d\u6742\u4e00\u4e9b\u3002</p> <p>\u6240\u4ee5\uff0c\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u53d1\u8d77\u8fde\u63a5\u65b9\uff09\u548c\u670d\u52a1\u7aef\uff08\u88ab\u52a8\u8fde\u63a5\u65b9\uff09\u4f18\u5316\u7684\u65b9\u5f0f\u662f\u4e0d\u540c\u7684\uff0c\u63a5\u4e0b\u6765\u5206\u522b\u9488\u5bf9\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u4f18\u5316\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_1","title":"\u5ba2\u6237\u7aef\u4f18\u5316","text":"<p>\u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\u7684\u9996\u8981\u76ee\u7684\u662f\u300c\u540c\u6b65\u5e8f\u5217\u53f7\u300d\u3002</p> <p>\u53ea\u6709\u540c\u6b65\u4e86\u5e8f\u5217\u53f7\u624d\u6709\u53ef\u9760\u4f20\u8f93\uff0cTCP \u8bb8\u591a\u7279\u6027\u90fd\u4f9d\u8d56\u4e8e\u5e8f\u5217\u53f7\u5b9e\u73b0\uff0c\u6bd4\u5982\u6d41\u91cf\u63a7\u5236\u3001\u4e22\u5305\u91cd\u4f20\u7b49\uff0c\u8fd9\u4e5f\u662f\u4e09\u6b21\u63e1\u624b\u4e2d\u7684\u62a5\u6587\u79f0\u4e3a SYN \u7684\u539f\u56e0\uff0cSYN \u7684\u5168\u79f0\u5c31\u53eb Synchronize Sequence Numbers\uff08\u540c\u6b65\u5e8f\u5217\u53f7\uff09\u3002</p> <p></p> <p>SYN_SENT \u72b6\u6001\u7684\u4f18\u5316</p> <p>\u5ba2\u6237\u7aef\u4f5c\u4e3a\u4e3b\u52a8\u53d1\u8d77\u8fde\u63a5\u65b9\uff0c\u9996\u5148\u5b83\u5c06\u53d1\u9001 SYN \u5305\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u5c31\u4f1a\u5904\u4e8e <code>SYN_SENT</code> \u72b6\u6001\u3002</p> <p>\u5ba2\u6237\u7aef\u5728\u7b49\u5f85\u670d\u52a1\u7aef\u56de\u590d\u7684 ACK \u62a5\u6587\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u5668\u4f1a\u5728\u51e0\u6beb\u79d2\u5185\u8fd4\u56de SYN+ACK\uff0c\u4f46\u5982\u679c\u5ba2\u6237\u7aef\u957f\u65f6\u95f4\u6ca1\u6709\u6536\u5230 SYN+ACK \u62a5\u6587\uff0c\u5219\u4f1a\u91cd\u53d1 SYN \u5305\uff0c\u91cd\u53d1\u7684\u6b21\u6570\u7531 tcp_syn_retries \u53c2\u6570\u63a7\u5236\uff0c\u9ed8\u8ba4\u662f 5 \u6b21\uff1a</p> <p></p> <p>\u901a\u5e38\uff0c\u7b2c\u4e00\u6b21\u8d85\u65f6\u91cd\u4f20\u662f\u5728 1 \u79d2\u540e\uff0c\u7b2c\u4e8c\u6b21\u8d85\u65f6\u91cd\u4f20\u662f\u5728 2 \u79d2\uff0c\u7b2c\u4e09\u6b21\u8d85\u65f6\u91cd\u4f20\u662f\u5728 4 \u79d2\u540e\uff0c\u7b2c\u56db\u6b21\u8d85\u65f6\u91cd\u4f20\u662f\u5728 8 \u79d2\u540e\uff0c\u7b2c\u4e94\u6b21\u662f\u5728\u8d85\u65f6\u91cd\u4f20 16 \u79d2\u540e\u3002\u6ca1\u9519\uff0c\u6bcf\u6b21\u8d85\u65f6\u7684\u65f6\u95f4\u662f\u4e0a\u4e00\u6b21\u7684 2 \u500d\u3002</p> <p>\u5f53\u7b2c\u4e94\u6b21\u8d85\u65f6\u91cd\u4f20\u540e\uff0c\u4f1a\u7ee7\u7eed\u7b49\u5f85 32 \u79d2\uff0c\u5982\u679c\u670d\u52a1\u7aef\u4ecd\u7136\u6ca1\u6709\u56de\u5e94 ACK\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u7ec8\u6b62\u4e09\u6b21\u63e1\u624b\u3002</p> <p>\u6240\u4ee5\uff0c\u603b\u8017\u65f6\u662f 1+2+4+8+16+32=63 \u79d2\uff0c\u5927\u7ea6 1 \u5206\u949f\u5de6\u53f3\u3002</p> <p></p> <p>\u4f60\u53ef\u4ee5\u6839\u636e\u7f51\u7edc\u7684\u7a33\u5b9a\u6027\u548c\u76ee\u6807\u670d\u52a1\u5668\u7684\u7e41\u5fd9\u7a0b\u5ea6\u4fee\u6539 SYN \u7684\u91cd\u4f20\u6b21\u6570\uff0c\u8c03\u6574\u5ba2\u6237\u7aef\u7684\u4e09\u6b21\u63e1\u624b\u65f6\u95f4\u4e0a\u9650\u3002\u6bd4\u5982\u5185\u7f51\u4e2d\u901a\u8baf\u65f6\uff0c\u5c31\u53ef\u4ee5\u9002\u5f53\u8c03\u4f4e\u91cd\u8bd5\u6b21\u6570\uff0c\u5c3d\u5feb\u628a\u9519\u8bef\u66b4\u9732\u7ed9\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_2","title":"\u670d\u52a1\u7aef\u4f18\u5316","text":"<p>\u5f53\u670d\u52a1\u7aef\u6536\u5230 SYN \u5305\u540e\uff0c\u670d\u52a1\u7aef\u4f1a\u7acb\u9a6c\u56de\u590d SYN+ACK \u5305\uff0c\u8868\u660e\u786e\u8ba4\u6536\u5230\u4e86\u5ba2\u6237\u7aef\u7684\u5e8f\u5217\u53f7\uff0c\u540c\u65f6\u4e5f\u628a\u81ea\u5df1\u7684\u5e8f\u5217\u53f7\u53d1\u7ed9\u5bf9\u65b9\u3002</p> <p>\u6b64\u65f6\uff0c\u670d\u52a1\u7aef\u51fa\u73b0\u4e86\u65b0\u8fde\u63a5\uff0c\u72b6\u6001\u662f <code>SYN_RCV</code>\u3002\u5728\u8fd9\u4e2a\u72b6\u6001\u4e0b\uff0cLinux \u5185\u6838\u5c31\u4f1a\u5efa\u7acb\u4e00\u4e2a\u300c\u534a\u8fde\u63a5\u961f\u5217\u300d\u6765\u7ef4\u62a4\u300c\u672a\u5b8c\u6210\u300d\u7684\u63e1\u624b\u4fe1\u606f\uff0c\u5f53\u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u540e\uff0c\u670d\u52a1\u7aef\u5c31\u65e0\u6cd5\u518d\u5efa\u7acb\u65b0\u7684\u8fde\u63a5\u3002</p> <p></p> <p>SYN \u653b\u51fb\uff0c\u653b\u51fb\u7684\u662f\u5c31\u662f\u8fd9\u4e2a\u534a\u8fde\u63a5\u961f\u5217\u3002</p> <p>\u5982\u4f55\u67e5\u770b\u7531\u4e8e SYN \u534a\u8fde\u63a5\u961f\u5217\u5df2\u6ee1\uff0c\u800c\u88ab\u4e22\u5f03\u8fde\u63a5\u7684\u60c5\u51b5\uff1f</p> <p>\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u8be5 <code>netstat -s</code> \u547d\u4ee4\u7ed9\u51fa\u7684\u7edf\u8ba1\u7ed3\u679c\u4e2d\uff0c\u53ef\u4ee5\u5f97\u5230\u7531\u4e8e\u534a\u8fde\u63a5\u961f\u5217\u5df2\u6ee1\uff0c\u5f15\u53d1\u7684\u5931\u8d25\u6b21\u6570\uff1a</p> <p></p> <p>\u4e0a\u9762\u8f93\u51fa\u7684\u6570\u503c\u662f\u7d2f\u8ba1\u503c\uff0c\u8868\u793a\u5171\u6709\u591a\u5c11\u4e2a TCP \u8fde\u63a5\u56e0\u4e3a\u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u800c\u88ab\u4e22\u5f03\u3002\u9694\u51e0\u79d2\u6267\u884c\u51e0\u6b21\uff0c\u5982\u679c\u6709\u4e0a\u5347\u7684\u8d8b\u52bf\uff0c\u8bf4\u660e\u5f53\u524d\u5b58\u5728\u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u73b0\u8c61\u3002</p> <p>\u5982\u4f55\u8c03\u6574 SYN \u534a\u8fde\u63a5\u961f\u5217\u5927\u5c0f\uff1f</p> <p>\u8981\u60f3\u589e\u5927\u534a\u8fde\u63a5\u961f\u5217\uff0c\u4e0d\u80fd\u53ea\u5355\u7eaf\u589e\u5927 tcp_max_syn_backlog \u7684\u503c\uff0c\u8fd8\u9700\u4e00\u540c\u589e\u5927 somaxconn \u548c backlog\uff0c\u4e5f\u5c31\u662f\u589e\u5927 accept \u961f\u5217\u3002\u5426\u5219\uff0c\u53ea\u5355\u7eaf\u589e\u5927 tcp_max_syn_backlog \u662f\u65e0\u6548\u7684\u3002</p> <p>\u589e\u5927 tcp_max_syn_backlog \u548c somaxconn \u7684\u65b9\u6cd5\u662f\u4fee\u6539 Linux \u5185\u6838\u53c2\u6570\uff1a</p> <p></p> <p>\u589e\u5927 backlog \u7684\u65b9\u5f0f\uff0c\u6bcf\u4e2a Web \u670d\u52a1\u90fd\u4e0d\u540c\uff0c\u6bd4\u5982 Nginx \u589e\u5927 backlog \u7684\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <p></p> <p>\u6700\u540e\uff0c\u6539\u53d8\u4e86\u5982\u4e0a\u8fd9\u4e9b\u53c2\u6570\u540e\uff0c\u8981\u91cd\u542f Nginx \u670d\u52a1\uff0c\u56e0\u4e3a SYN \u534a\u8fde\u63a5\u961f\u5217\u548c accept \u961f\u5217\u90fd\u662f\u5728 <code>listen()</code> \u521d\u59cb\u5316\u7684\u3002</p> <p>\u5982\u679c SYN \u534a\u8fde\u63a5\u961f\u5217\u5df2\u6ee1\uff0c\u53ea\u80fd\u4e22\u5f03\u8fde\u63a5\u5417\uff1f</p> <p>\u5e76\u4e0d\u662f\u8fd9\u6837\uff0c\u5f00\u542f syncookies \u529f\u80fd\u5c31\u53ef\u4ee5\u5728\u4e0d\u4f7f\u7528 SYN \u534a\u8fde\u63a5\u961f\u5217\u7684\u60c5\u51b5\u4e0b\u6210\u529f\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>syncookies \u7684\u5de5\u4f5c\u539f\u7406\uff1a\u670d\u52a1\u5668\u6839\u636e\u5f53\u524d\u72b6\u6001\u8ba1\u7b97\u51fa\u4e00\u4e2a\u503c\uff0c\u653e\u5728\u5df1\u65b9\u53d1\u51fa\u7684 SYN+ACK \u62a5\u6587\u4e2d\u53d1\u51fa\uff0c\u5f53\u5ba2\u6237\u7aef\u8fd4\u56de ACK \u62a5\u6587\u65f6\uff0c\u53d6\u51fa\u8be5\u503c\u9a8c\u8bc1\uff0c\u5982\u679c\u5408\u6cd5\uff0c\u5c31\u8ba4\u4e3a\u8fde\u63a5\u5efa\u7acb\u6210\u529f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>syncookies \u53c2\u6570\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u4e2a\u503c\uff1a</p> <ul> <li>0 \u503c\uff0c\u8868\u793a\u5173\u95ed\u8be5\u529f\u80fd\uff1b</li> <li>1 \u503c\uff0c\u8868\u793a\u4ec5\u5f53 SYN \u534a\u8fde\u63a5\u961f\u5217\u653e\u4e0d\u4e0b\u65f6\uff0c\u518d\u542f\u7528\u5b83\uff1b</li> <li>2 \u503c\uff0c\u8868\u793a\u65e0\u6761\u4ef6\u5f00\u542f\u529f\u80fd\uff1b</li> </ul> <p>\u90a3\u4e48\u5728\u5e94\u5bf9 SYN \u653b\u51fb\u65f6\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u4e3a 1 \u5373\u53ef\uff1a</p> <p></p> <p>SYN_RCV \u72b6\u6001\u7684\u4f18\u5316</p> <p>\u5f53\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u670d\u52a1\u5668\u53d1\u6765\u7684 SYN+ACK \u62a5\u6587\u540e\uff0c\u5c31\u4f1a\u56de\u590d ACK \u7ed9\u670d\u52a1\u5668\uff0c\u540c\u65f6\u5ba2\u6237\u7aef\u8fde\u63a5\u72b6\u6001\u4ece SYN_SENT \u8f6c\u6362\u4e3a ESTABLISHED\uff0c\u8868\u793a\u8fde\u63a5\u5efa\u7acb\u6210\u529f\u3002</p> <p>\u670d\u52a1\u5668\u7aef\u8fde\u63a5\u6210\u529f\u5efa\u7acb\u7684\u65f6\u95f4\u8fd8\u8981\u518d\u5f80\u540e\uff0c\u7b49\u5230\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684 ACK \u540e\uff0c\u670d\u52a1\u7aef\u7684\u8fde\u63a5\u72b6\u6001\u624d\u53d8\u4e3a ESTABLISHED\u3002</p> <p>\u5982\u679c\u670d\u52a1\u5668\u6ca1\u6709\u6536\u5230 ACK\uff0c\u5c31\u4f1a\u91cd\u53d1 SYN+ACK \u62a5\u6587\uff0c\u540c\u65f6\u4e00\u76f4\u5904\u4e8e SYN_RCV \u72b6\u6001\u3002</p> <p>\u5f53\u7f51\u7edc\u7e41\u5fd9\u3001\u4e0d\u7a33\u5b9a\u65f6\uff0c\u62a5\u6587\u4e22\u5931\u5c31\u4f1a\u53d8\u4e25\u91cd\uff0c\u6b64\u65f6\u5e94\u8be5\u8c03\u5927\u91cd\u53d1\u6b21\u6570\u3002\u53cd\u4e4b\u5219\u53ef\u4ee5\u8c03\u5c0f\u91cd\u53d1\u6b21\u6570\u3002\u4fee\u6539\u91cd\u53d1\u6b21\u6570\u7684\u65b9\u6cd5\u662f\uff0c\u8c03\u6574 tcp_synack_retries \u53c2\u6570\uff1a</p> <p></p> <p>tcp_synack_retries \u7684\u9ed8\u8ba4\u91cd\u8bd5\u6b21\u6570\u662f 5 \u6b21\uff0c\u4e0e\u5ba2\u6237\u7aef\u91cd\u4f20 SYN \u7c7b\u4f3c\uff0c\u5b83\u7684\u91cd\u4f20\u4f1a\u7ecf\u5386 1\u30012\u30014\u30018\u300116 \u79d2\uff0c\u6700\u540e\u4e00\u6b21\u91cd\u4f20\u540e\u4f1a\u7ee7\u7eed\u7b49\u5f85 32 \u79d2\uff0c\u5982\u679c\u670d\u52a1\u7aef\u4ecd\u7136\u6ca1\u6709\u6536\u5230 ACK\uff0c\u624d\u4f1a\u5173\u95ed\u8fde\u63a5\uff0c\u6545\u5171\u9700\u8981\u7b49\u5f85 63 \u79d2\u3002</p> <p>\u670d\u52a1\u5668\u6536\u5230 ACK \u540e\u8fde\u63a5\u5efa\u7acb\u6210\u529f\uff0c\u6b64\u65f6\uff0c\u5185\u6838\u4f1a\u628a\u8fde\u63a5\u4ece\u534a\u8fde\u63a5\u961f\u5217\u79fb\u9664\uff0c\u7136\u540e\u521b\u5efa\u65b0\u7684\u5b8c\u5168\u7684\u8fde\u63a5\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u5230 accept \u961f\u5217\uff0c\u7b49\u5f85\u8fdb\u7a0b\u8c03\u7528 accept \u51fd\u6570\u65f6\u628a\u8fde\u63a5\u53d6\u51fa\u6765\u3002</p> <p>\u5982\u679c\u8fdb\u7a0b\u4e0d\u80fd\u53ca\u65f6\u5730\u8c03\u7528 accept \u51fd\u6570\uff0c\u5c31\u4f1a\u9020\u6210 accept \u961f\u5217\uff08\u4e5f\u79f0\u5168\u8fde\u63a5\u961f\u5217\uff09\u6ea2\u51fa\uff0c\u6700\u7ec8\u5bfc\u81f4\u5efa\u7acb\u597d\u7684 TCP \u8fde\u63a5\u88ab\u4e22\u5f03\u3002</p> <p></p> <p>accept \u961f\u5217\u5df2\u6ee1\uff0c\u53ea\u80fd\u4e22\u5f03\u8fde\u63a5\u5417\uff1f</p> <p>\u4e22\u5f03\u8fde\u63a5\u53ea\u662f Linux \u7684\u9ed8\u8ba4\u884c\u4e3a\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u9009\u62e9\u5411\u5ba2\u6237\u7aef\u53d1\u9001 RST \u590d\u4f4d\u62a5\u6587\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u8fde\u63a5\u5df2\u7ecf\u5efa\u7acb\u5931\u8d25\u3002\u6253\u5f00\u8fd9\u4e00\u529f\u80fd\u9700\u8981\u5c06 tcp_abort_on_overflow \u53c2\u6570\u8bbe\u7f6e\u4e3a 1\u3002</p> <p></p> <p>tcp_abort_on_overflow \u5171\u6709\u4e24\u4e2a\u503c\u5206\u522b\u662f 0 \u548c 1\uff0c\u5176\u5206\u522b\u8868\u793a\uff1a</p> <ul> <li>0\uff1a\u5982\u679c accept \u961f\u5217\u6ee1\u4e86\uff0c\u90a3\u4e48 server \u6254\u6389 client  \u53d1\u8fc7\u6765\u7684 ack\uff1b</li> <li>1\uff1a\u5982\u679c accept \u961f\u5217\u6ee1\u4e86\uff0cserver \u53d1\u9001\u4e00\u4e2a <code>RST</code> \u5305\u7ed9 client\uff0c\u8868\u793a\u5e9f\u6389\u8fd9\u4e2a\u63e1\u624b\u8fc7\u7a0b\u548c\u8fd9\u4e2a\u8fde\u63a5\uff1b</li> </ul> <p>\u5982\u679c\u8981\u60f3\u77e5\u9053\u5ba2\u6237\u7aef\u8fde\u63a5\u4e0d\u4e0a\u670d\u52a1\u7aef\uff0c\u662f\u4e0d\u662f\u670d\u52a1\u7aef TCP \u5168\u8fde\u63a5\u961f\u5217\u6ee1\u7684\u539f\u56e0\uff0c\u90a3\u4e48\u53ef\u4ee5\u628a tcp_abort_on_overflow \u8bbe\u7f6e\u4e3a 1\uff0c\u8fd9\u65f6\u5982\u679c\u5728\u5ba2\u6237\u7aef\u5f02\u5e38\u4e2d\u53ef\u4ee5\u770b\u5230\u5f88\u591a <code>connection reset by peer</code> \u7684\u9519\u8bef\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8bc1\u660e\u662f\u7531\u4e8e\u670d\u52a1\u7aef TCP \u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u95ee\u9898\u3002</p> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5e94\u5f53\u628a tcp_abort_on_overflow \u8bbe\u7f6e\u4e3a 0\uff0c\u56e0\u4e3a\u8fd9\u6837\u66f4\u6709\u5229\u4e8e\u5e94\u5bf9\u7a81\u53d1\u6d41\u91cf\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53 accept \u961f\u5217\u6ee1\u5bfc\u81f4\u670d\u52a1\u5668\u4e22\u6389\u4e86 ACK\uff0c\u4e0e\u6b64\u540c\u65f6\uff0c\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u72b6\u6001\u5374\u662f ESTABLISHED\uff0c\u5ba2\u6237\u7aef\u8fdb\u7a0b\u5c31\u5728\u5efa\u7acb\u597d\u7684\u8fde\u63a5\u4e0a\u53d1\u9001\u8bf7\u6c42\u3002\u53ea\u8981\u670d\u52a1\u5668\u6ca1\u6709\u4e3a\u8bf7\u6c42\u56de\u590d ACK\uff0c\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u5c31\u4f1a\u88ab\u591a\u6b21\u300c\u91cd\u53d1\u300d\u3002\u5982\u679c\u670d\u52a1\u5668\u4e0a\u7684\u8fdb\u7a0b\u53ea\u662f\u77ed\u6682\u7684\u7e41\u5fd9\u9020\u6210 accept \u961f\u5217\u6ee1\uff0c\u90a3\u4e48\u5f53 accept \u961f\u5217\u6709\u7a7a\u4f4d\u65f6\uff0c\u518d\u6b21\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u62a5\u6587\u7531\u4e8e\u542b\u6709 ACK\uff0c\u4ecd\u7136\u4f1a\u89e6\u53d1\u670d\u52a1\u5668\u7aef\u6210\u529f\u5efa\u7acb\u8fde\u63a5\u3002</p> <p></p> <p>\u6240\u4ee5\uff0ctcp_abort_on_overflow \u8bbe\u4e3a 0 \u53ef\u4ee5\u63d0\u9ad8\u8fde\u63a5\u5efa\u7acb\u7684\u6210\u529f\u7387\uff0c\u53ea\u6709\u4f60\u975e\u5e38\u80af\u5b9a TCP \u5168\u8fde\u63a5\u961f\u5217\u4f1a\u957f\u671f\u6ea2\u51fa\u65f6\uff0c\u624d\u80fd\u8bbe\u7f6e\u4e3a 1 \u4ee5\u5c3d\u5feb\u901a\u77e5\u5ba2\u6237\u7aef\u3002</p> <p>\u5982\u4f55\u8c03\u6574 accept \u961f\u5217\u7684\u957f\u5ea6\u5462\uff1f</p> <p>accept \u961f\u5217\u7684\u957f\u5ea6\u53d6\u51b3\u4e8e somaxconn \u548c backlog \u4e4b\u95f4\u7684\u6700\u5c0f\u503c\uff0c\u4e5f\u5c31\u662f min(somaxconn, backlog)\uff0c\u5176\u4e2d\uff1a</p> <ul> <li>somaxconn \u662f Linux \u5185\u6838\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u662f 128\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>net.core.somaxconn</code> \u6765\u8bbe\u7f6e\u5176\u503c\uff1b</li> <li>backlog \u662f <code>listen(int sockfd, int backlog)</code> \u51fd\u6570\u4e2d\u7684 backlog \u5927\u5c0f\uff1b</li> </ul> <p>Tomcat\u3001Nginx\u3001Apache \u5e38\u89c1\u7684 Web \u670d\u52a1\u7684 backlog \u9ed8\u8ba4\u503c\u90fd\u662f 511\u3002</p> <p>\u5982\u4f55\u67e5\u770b\u670d\u52a1\u7aef\u8fdb\u7a0b accept \u961f\u5217\u7684\u957f\u5ea6\uff1f</p> <p>\u53ef\u4ee5\u901a\u8fc7 <code>ss -ltn</code> \u547d\u4ee4\u67e5\u770b\uff1a</p> <p></p> <ul> <li>Recv-Q\uff1a\u5f53\u524d accept \u961f\u5217\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u5f53\u524d\u5df2\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\u5e76\u7b49\u5f85\u670d\u52a1\u7aef <code>accept()</code> \u7684 TCP \u8fde\u63a5\uff1b</li> <li>Send-Q\uff1aaccept \u961f\u5217\u6700\u5927\u957f\u5ea6\uff0c\u4e0a\u9762\u7684\u8f93\u51fa\u7ed3\u679c\u8bf4\u660e\u76d1\u542c 8088 \u7aef\u53e3\u7684 TCP \u670d\u52a1\uff0caccept \u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\u4e3a 128\uff1b</li> </ul> <p>\u5982\u4f55\u67e5\u770b\u7531\u4e8e accept \u8fde\u63a5\u961f\u5217\u5df2\u6ee1\uff0c\u800c\u88ab\u4e22\u5f03\u7684\u8fde\u63a5\uff1f</p> <p>\u5f53\u8d85\u8fc7\u4e86 accept \u8fde\u63a5\u961f\u5217\uff0c\u670d\u52a1\u7aef\u5219\u4f1a\u4e22\u6389\u540e\u7eed\u8fdb\u6765\u7684 TCP \u8fde\u63a5\uff0c\u4e22\u6389\u7684 TCP \u8fde\u63a5\u7684\u4e2a\u6570\u4f1a\u88ab\u7edf\u8ba1\u8d77\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 netstat -s \u547d\u4ee4\u6765\u67e5\u770b\uff1a</p> <p></p> <p>\u4e0a\u9762\u770b\u5230\u7684 41150 times\uff0c\u8868\u793a accept \u961f\u5217\u6ea2\u51fa\u7684\u6b21\u6570\uff0c\u6ce8\u610f\u8fd9\u4e2a\u662f\u7d2f\u8ba1\u503c\u3002\u53ef\u4ee5\u9694\u51e0\u79d2\u949f\u6267\u884c\u4e0b\uff0c\u5982\u679c\u8fd9\u4e2a\u6570\u5b57\u4e00\u76f4\u5728\u589e\u52a0\u7684\u8bdd\uff0c\u8bf4\u660e accept \u8fde\u63a5\u961f\u5217\u5076\u5c14\u6ee1\u4e86\u3002</p> <p>\u5982\u679c\u6301\u7eed\u4e0d\u65ad\u5730\u6709\u8fde\u63a5\u56e0\u4e3a accept \u961f\u5217\u6ea2\u51fa\u88ab\u4e22\u5f03\uff0c\u5c31\u5e94\u8be5\u8c03\u5927 backlog \u4ee5\u53ca somaxconn \u53c2\u6570\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_3","title":"\u5982\u4f55\u7ed5\u8fc7\u4e09\u6b21\u63e1\u624b\uff1f","text":"<p>\u4ee5\u4e0a\u6211\u4eec\u53ea\u662f\u5728\u5bf9\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\u8fdb\u884c\u4f18\u5316\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u770b\u770b\u5982\u4f55\u7ed5\u8fc7\u4e09\u6b21\u63e1\u624b\u53d1\u9001\u6570\u636e\u3002</p> <p>\u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\u9020\u6210\u7684\u540e\u679c\u5c31\u662f\uff0cHTTP \u8bf7\u6c42\u5fc5\u987b\u5728\u4e00\u4e2a RTT\uff08\u4ece\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u5668\u4e00\u4e2a\u5f80\u8fd4\u7684\u65f6\u95f4\uff09\u540e\u624d\u80fd\u53d1\u9001\u3002</p> <p></p> <p>\u5728 Linux 3.7 \u5185\u6838\u7248\u672c\u4e4b\u540e\uff0c\u63d0\u4f9b\u4e86 TCP Fast Open \u529f\u80fd\uff0c\u8fd9\u4e2a\u529f\u80fd\u53ef\u4ee5\u51cf\u5c11 TCP \u8fde\u63a5\u5efa\u7acb\u7684\u65f6\u5ef6\u3002</p> <p>\u63a5\u4e0b\u6765\u8bf4\u8bf4\uff0cTCP Fast Open \u529f\u80fd\u7684\u5de5\u4f5c\u65b9\u5f0f\u3002</p> <p></p> <p>\u5728\u5ba2\u6237\u7aef\u9996\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\u7684\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u53d1\u9001 SYN \u62a5\u6587\uff0c\u8be5\u62a5\u6587\u5305\u542b Fast Open \u9009\u9879\uff0c\u4e14\u8be5\u9009\u9879\u7684 Cookie \u4e3a\u7a7a\uff0c\u8fd9\u8868\u660e\u5ba2\u6237\u7aef\u8bf7\u6c42 Fast Open Cookie\uff1b</li> <li>\u652f\u6301 TCP Fast Open \u7684\u670d\u52a1\u5668\u751f\u6210 Cookie\uff0c\u5e76\u5c06\u5176\u7f6e\u4e8e SYN-ACK \u6570\u636e\u5305\u4e2d\u7684 Fast Open \u9009\u9879\u4ee5\u53d1\u56de\u5ba2\u6237\u7aef\uff1b</li> <li>\u5ba2\u6237\u7aef\u6536\u5230 SYN-ACK \u540e\uff0c\u672c\u5730\u7f13\u5b58 Fast Open \u9009\u9879\u4e2d\u7684 Cookie\u3002</li> </ol> <p>\u6240\u4ee5\uff0c\u7b2c\u4e00\u6b21\u53d1\u8d77 HTTP GET \u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u9700\u8981\u6b63\u5e38\u7684\u4e09\u6b21\u63e1\u624b\u6d41\u7a0b\u3002</p> <p>\u4e4b\u540e\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u518d\u6b21\u5411\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u65f6\u7684\u8fc7\u7a0b\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u53d1\u9001 SYN \u62a5\u6587\uff0c\u8be5\u62a5\u6587\u5305\u542b\u300c\u6570\u636e\u300d\uff08\u5bf9\u4e8e\u975e TFO \u7684\u666e\u901a TCP \u63e1\u624b\u8fc7\u7a0b\uff0cSYN \u62a5\u6587\u4e2d\u4e0d\u5305\u542b\u300c\u6570\u636e\u300d\uff09\u4ee5\u53ca\u6b64\u524d\u8bb0\u5f55\u7684 Cookie\uff1b</li> <li>\u652f\u6301 TCP Fast Open \u7684\u670d\u52a1\u5668\u4f1a\u5bf9\u6536\u5230 Cookie \u8fdb\u884c\u6821\u9a8c\uff1a\u5982\u679c Cookie \u6709\u6548\uff0c\u670d\u52a1\u5668\u5c06\u5728 SYN-ACK \u62a5\u6587\u4e2d\u5bf9 SYN \u548c\u300c\u6570\u636e\u300d\u8fdb\u884c\u786e\u8ba4\uff0c\u670d\u52a1\u5668\u968f\u540e\u5c06\u300c\u6570\u636e\u300d\u9012\u9001\u81f3\u76f8\u5e94\u7684\u5e94\u7528\u7a0b\u5e8f\uff1b\u5982\u679c Cookie \u65e0\u6548\uff0c\u670d\u52a1\u5668\u5c06\u4e22\u5f03 SYN \u62a5\u6587\u4e2d\u5305\u542b\u7684\u300c\u6570\u636e\u300d\uff0c\u4e14\u5176\u968f\u540e\u53d1\u51fa\u7684 SYN-ACK \u62a5\u6587\u5c06\u53ea\u786e\u8ba4 SYN \u7684\u5bf9\u5e94\u5e8f\u5217\u53f7\uff1b</li> <li>\u5982\u679c\u670d\u52a1\u5668\u63a5\u53d7\u4e86 SYN \u62a5\u6587\u4e2d\u7684\u300c\u6570\u636e\u300d\uff0c\u670d\u52a1\u5668\u53ef\u5728\u63e1\u624b\u5b8c\u6210\u4e4b\u524d\u53d1\u9001\u300c\u6570\u636e\u300d\uff0c\u8fd9\u5c31\u51cf\u5c11\u4e86\u63e1\u624b\u5e26\u6765\u7684 1 \u4e2a RTT \u7684\u65f6\u95f4\u6d88\u8017\uff1b</li> <li>\u5ba2\u6237\u7aef\u5c06\u53d1\u9001 ACK \u786e\u8ba4\u670d\u52a1\u5668\u53d1\u56de\u7684 SYN \u4ee5\u53ca\u300c\u6570\u636e\u300d\uff0c\u4f46\u5982\u679c\u5ba2\u6237\u7aef\u5728\u521d\u59cb\u7684 SYN \u62a5\u6587\u4e2d\u53d1\u9001\u7684\u300c\u6570\u636e\u300d\u6ca1\u6709\u88ab\u786e\u8ba4\uff0c\u5219\u5ba2\u6237\u7aef\u5c06\u91cd\u65b0\u53d1\u9001\u300c\u6570\u636e\u300d\uff1b</li> <li>\u6b64\u540e\u7684 TCP \u8fde\u63a5\u7684\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b\u548c\u975e TFO \u7684\u6b63\u5e38\u60c5\u51b5\u4e00\u81f4\u3002</li> </ol> <p>\u6240\u4ee5\uff0c\u4e4b\u540e\u53d1\u8d77 HTTP GET \u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u53ef\u4ee5\u7ed5\u8fc7\u4e09\u6b21\u63e1\u624b\uff0c\u8fd9\u5c31\u51cf\u5c11\u4e86\u63e1\u624b\u5e26\u6765\u7684 1 \u4e2a RTT \u7684\u65f6\u95f4\u6d88\u8017\u3002</p> <p>\u5f00\u542f\u4e86 TFO \u529f\u80fd\uff0ccookie \u7684\u503c\u662f\u5b58\u653e\u5230 TCP option \u5b57\u6bb5\u91cc\u7684\uff1a</p> <p></p> <p>\u6ce8\uff1a\u5ba2\u6237\u7aef\u5728\u8bf7\u6c42\u5e76\u5b58\u50a8\u4e86 Fast Open Cookie \u4e4b\u540e\uff0c\u53ef\u4ee5\u4e0d\u65ad\u91cd\u590d TCP Fast Open \u76f4\u81f3\u670d\u52a1\u5668\u8ba4\u4e3a Cookie \u65e0\u6548\uff08\u901a\u5e38\u4e3a\u8fc7\u671f\uff09\u3002</p> <p>Linux \u4e0b\u600e\u4e48\u6253\u5f00 TCP Fast Open \u529f\u80fd\u5462\uff1f</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e tcp_fastopn \u5185\u6838\u53c2\u6570\uff0c\u6765\u6253\u5f00 Fast Open \u529f\u80fd\uff1a</p> <p></p> <p>tcp_fastopn \u5404\u4e2a\u503c\u7684\u610f\u4e49\uff1a</p> <ul> <li>0 \u5173\u95ed</li> <li>1 \u4f5c\u4e3a\u5ba2\u6237\u7aef\u4f7f\u7528 Fast Open \u529f\u80fd</li> <li>2 \u4f5c\u4e3a\u670d\u52a1\u7aef\u4f7f\u7528 Fast Open \u529f\u80fd</li> <li>3 \u65e0\u8bba\u4f5c\u4e3a\u5ba2\u6237\u7aef\u8fd8\u662f\u670d\u52a1\u5668\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528 Fast Open \u529f\u80fd</li> </ul> <p>TCP Fast Open \u529f\u80fd\u9700\u8981\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u540c\u65f6\u652f\u6301\uff0c\u624d\u6709\u6548\u679c\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_4","title":"\u5c0f\u7ed3","text":"<p>\u672c\u5c0f\u7ed3\u4e3b\u8981\u4ecb\u7ecd\u4e86\u5173\u4e8e\u4f18\u5316 TCP \u4e09\u6b21\u63e1\u624b\u7684\u51e0\u4e2a TCP \u53c2\u6570\u3002</p> <p></p> <p>\u5ba2\u6237\u7aef\u7684\u4f18\u5316</p> <p>\u5f53\u5ba2\u6237\u7aef\u53d1\u8d77 SYN \u5305\u65f6\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>tcp_syn_retries</code> \u63a7\u5236\u5176\u91cd\u4f20\u7684\u6b21\u6570\u3002</p> <p>\u670d\u52a1\u7aef\u7684\u4f18\u5316</p> <p>\u5f53\u670d\u52a1\u7aef SYN \u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u540e\uff0c\u4f1a\u5bfc\u81f4\u540e\u7eed\u8fde\u63a5\u88ab\u4e22\u5f03\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>netstat -s</code> \u89c2\u5bdf\u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u60c5\u51b5\uff0c\u5982\u679c SYN \u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u60c5\u51b5\u6bd4\u8f83\u4e25\u91cd\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>tcp_max_syn_backlog\u3001somaxconn\u3001backlog</code> \u53c2\u6570\u6765\u8c03\u6574 SYN \u534a\u8fde\u63a5\u961f\u5217\u7684\u5927\u5c0f\u3002</p> <p>\u670d\u52a1\u7aef\u56de\u590d SYN+ACK \u7684\u91cd\u4f20\u6b21\u6570\u7531 <code>tcp_synack_retries</code> \u53c2\u6570\u63a7\u5236\u3002\u5982\u679c\u906d\u53d7 SYN \u653b\u51fb\uff0c\u5e94\u628a <code>tcp_syncookies</code> \u53c2\u6570\u8bbe\u7f6e\u4e3a 1\uff0c\u8868\u793a\u4ec5\u5728 SYN \u961f\u5217\u6ee1\u540e\u5f00\u542f syncookie \u529f\u80fd\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u6b63\u5e38\u7684\u8fde\u63a5\u6210\u529f\u5efa\u7acb\u3002</p> <p>\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u8fd4\u56de\u7684 ACK\uff0c\u4f1a\u628a\u8fde\u63a5\u79fb\u5165 accpet \u961f\u5217\uff0c\u7b49\u5f85\u8fdb\u884c\u8c03\u7528 accpet() \u51fd\u6570\u53d6\u51fa\u8fde\u63a5\u3002</p> <p>\u53ef\u4ee5\u901a\u8fc7 <code>ss -lnt</code> \u67e5\u770b\u670d\u52a1\u7aef\u8fdb\u7a0b\u7684 accept \u961f\u5217\u957f\u5ea6\uff0c\u5982\u679c accept \u961f\u5217\u6ea2\u51fa\uff0c\u7cfb\u7edf\u9ed8\u8ba4\u4e22\u5f03 ACK\uff0c\u5982\u679c\u53ef\u4ee5\u628a <code>tcp_abort_on_overflow</code> \u8bbe\u7f6e\u4e3a 1\uff0c\u8868\u793a\u7528 RST \u901a\u77e5\u5ba2\u6237\u7aef\u8fde\u63a5\u5efa\u7acb\u5931\u8d25\u3002</p> <p>\u5982\u679c accpet \u961f\u5217\u6ea2\u51fa\u4e25\u91cd\uff0c\u53ef\u4ee5\u901a\u8fc7 listen \u51fd\u6570\u7684 <code>backlog</code> \u53c2\u6570\u548c <code>somaxconn</code> \u7cfb\u7edf\u53c2\u6570\u63d0\u9ad8\u961f\u5217\u5927\u5c0f\uff0caccept \u961f\u5217\u957f\u5ea6\u53d6\u51b3\u4e8e min(backlog, somaxconn)\u3002</p> <p>\u7ed5\u8fc7\u4e09\u6b21\u63e1\u624b</p> <p>TCP Fast Open \u529f\u80fd\u53ef\u4ee5\u7ed5\u8fc7\u4e09\u6b21\u63e1\u624b\uff0c\u4f7f\u5f97 HTTP \u8bf7\u6c42\u51cf\u5c11\u4e86 1 \u4e2a RTT \u7684\u65f6\u95f4\uff0cLinux \u4e0b\u53ef\u4ee5\u901a\u8fc7 <code>tcp_fastopen</code> \u5f00\u542f\u8be5\u529f\u80fd\uff0c\u540c\u65f6\u5fc5\u987b\u4fdd\u8bc1\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u540c\u65f6\u652f\u6301\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#tcp_1","title":"TCP \u56db\u6b21\u6325\u624b\u7684\u6027\u80fd\u63d0\u5347","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u4e00\u8d77\u770b\u770b\u9488\u5bf9 TCP \u56db\u6b21\u6325\u624b\u5173\u95ed\u8fde\u63a5\u65f6\uff0c\u5982\u4f55\u4f18\u5316\u6027\u80fd\u3002</p> <p>\u5728\u5f00\u59cb\u4e4b\u524d\uff0c\u6211\u4eec\u5f97\u5148\u4e86\u89e3\u56db\u6b21\u6325\u624b\u72b6\u6001\u53d8\u8fc1\u7684\u8fc7\u7a0b\u3002</p> <p>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u53cc\u65b9\u90fd\u53ef\u4ee5\u4e3b\u52a8\u65ad\u5f00\u8fde\u63a5\uff0c\u901a\u5e38\u5148\u5173\u95ed\u8fde\u63a5\u7684\u4e00\u65b9\u79f0\u4e3a\u4e3b\u52a8\u65b9\uff0c\u540e\u5173\u95ed\u8fde\u63a5\u7684\u4e00\u65b9\u79f0\u4e3a\u88ab\u52a8\u65b9\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0c\u56db\u6b21\u6325\u624b\u8fc7\u7a0b\u53ea\u6d89\u53ca\u4e86\u4e24\u79cd\u62a5\u6587\uff0c\u5206\u522b\u662f FIN \u548c ACK\uff1a</p> <ul> <li>FIN \u5c31\u662f\u7ed3\u675f\u8fde\u63a5\u7684\u610f\u601d\uff0c\u8c01\u53d1\u51fa FIN \u62a5\u6587\uff0c\u5c31\u8868\u793a\u5b83\u5c06\u4e0d\u4f1a\u518d\u53d1\u9001\u4efb\u4f55\u6570\u636e\uff0c\u5173\u95ed\u8fd9\u4e00\u65b9\u5411\u4e0a\u7684\u4f20\u8f93\u901a\u9053\uff1b</li> <li>ACK \u5c31\u662f\u786e\u8ba4\u7684\u610f\u601d\uff0c\u7528\u6765\u901a\u77e5\u5bf9\u65b9\uff1a\u4f60\u65b9\u7684\u53d1\u9001\u901a\u9053\u5df2\u7ecf\u5173\u95ed\uff1b</li> </ul> <p>\u56db\u6b21\u6325\u624b\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5f53\u4e3b\u52a8\u65b9\u5173\u95ed\u8fde\u63a5\u65f6\uff0c\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u6b64\u65f6\u53d1\u9001\u65b9\u7684 TCP \u8fde\u63a5\u5c06\u4ece ESTABLISHED \u53d8\u6210 FIN_WAIT1\u3002</li> <li>\u5f53\u88ab\u52a8\u65b9\u6536\u5230 FIN \u62a5\u6587\u540e\uff0c\u5185\u6838\u4f1a\u81ea\u52a8\u56de\u590d ACK \u62a5\u6587\uff0c\u8fde\u63a5\u72b6\u6001\u5c06\u4ece ESTABLISHED \u53d8\u6210 CLOSE_WAIT\uff0c\u8868\u793a\u88ab\u52a8\u65b9\u5728\u7b49\u5f85\u8fdb\u7a0b\u8c03\u7528 close \u51fd\u6570\u5173\u95ed\u8fde\u63a5\u3002</li> <li>\u5f53\u4e3b\u52a8\u65b9\u6536\u5230\u8fd9\u4e2a ACK \u540e\uff0c\u8fde\u63a5\u72b6\u6001\u7531 FIN_WAIT1 \u53d8\u4e3a FIN_WAIT2\uff0c\u4e5f\u5c31\u662f\u8868\u793a\u4e3b\u52a8\u65b9\u7684\u53d1\u9001\u901a\u9053\u5c31\u5173\u95ed\u4e86\u3002</li> <li>\u5f53\u88ab\u52a8\u65b9\u8fdb\u5165 CLOSE_WAIT \u65f6\uff0c\u88ab\u52a8\u65b9\u8fd8\u4f1a\u7ee7\u7eed\u5904\u7406\u6570\u636e\uff0c\u7b49\u5230\u8fdb\u7a0b\u7684 read \u51fd\u6570\u8fd4\u56de 0 \u540e\uff0c\u5e94\u7528\u7a0b\u5e8f\u5c31\u4f1a\u8c03\u7528 close \u51fd\u6570\uff0c\u8fdb\u800c\u89e6\u53d1\u5185\u6838\u53d1\u9001 FIN \u62a5\u6587\uff0c\u6b64\u65f6\u88ab\u52a8\u65b9\u7684\u8fde\u63a5\u72b6\u6001\u53d8\u4e3a LAST_ACK\u3002</li> <li>\u5f53\u4e3b\u52a8\u65b9\u6536\u5230\u8fd9\u4e2a FIN \u62a5\u6587\u540e\uff0c\u5185\u6838\u4f1a\u56de\u590d ACK \u62a5\u6587\u7ed9\u88ab\u52a8\u65b9\uff0c\u540c\u65f6\u4e3b\u52a8\u65b9\u7684\u8fde\u63a5\u72b6\u6001\u7531 FIN_WAIT2 \u53d8\u4e3a TIME_WAIT\uff0c\u5728 Linux \u7cfb\u7edf\u4e0b\u5927\u7ea6\u7b49\u5f85 1 \u5206\u949f\u540e\uff0cTIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u624d\u4f1a\u5f7b\u5e95\u5173\u95ed\u3002</li> <li>\u5f53\u88ab\u52a8\u65b9\u6536\u5230\u6700\u540e\u7684 ACK \u62a5\u6587\u540e\uff0c\u88ab\u52a8\u65b9\u7684\u8fde\u63a5\u5c31\u4f1a\u5173\u95ed\u3002</li> </ul> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u4e2a\u65b9\u5411\u90fd\u9700\u8981\u4e00\u4e2a FIN \u548c\u4e00\u4e2a ACK\uff0c\u56e0\u6b64\u901a\u5e38\u88ab\u79f0\u4e3a\u56db\u6b21\u6325\u624b\u3002</p> <p>\u8fd9\u91cc\u4e00\u70b9\u9700\u8981\u6ce8\u610f\u662f\uff1a\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u7684\uff0c\u624d\u6709 TIME_WAIT \u72b6\u6001\u3002</p> <p>\u4e3b\u52a8\u5173\u95ed\u65b9\u548c\u88ab\u52a8\u5173\u95ed\u65b9\u4f18\u5316\u7684\u601d\u8def\u4e5f\u4e0d\u540c\uff0c\u63a5\u4e0b\u6765\u5206\u522b\u8bf4\u8bf4\u5982\u4f55\u4f18\u5316\u4ed6\u4eec\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_5","title":"\u4e3b\u52a8\u65b9\u7684\u4f18\u5316","text":"<p>\u5173\u95ed\u8fde\u63a5\u7684\u65b9\u5f0f\u901a\u5e38\u6709\u4e24\u79cd\uff0c\u5206\u522b\u662f RST \u62a5\u6587\u5173\u95ed\u548c FIN \u62a5\u6587\u5173\u95ed\u3002</p> <p>\u5982\u679c\u8fdb\u7a0b\u6536\u5230 RST \u62a5\u6587\uff0c\u5c31\u76f4\u63a5\u5173\u95ed\u8fde\u63a5\u4e86\uff0c\u4e0d\u9700\u8981\u8d70\u56db\u6b21\u6325\u624b\u6d41\u7a0b\uff0c\u662f\u4e00\u4e2a\u66b4\u529b\u5173\u95ed\u8fde\u63a5\u7684\u65b9\u5f0f\u3002</p> <p>\u5b89\u5168\u5173\u95ed\u8fde\u63a5\u7684\u65b9\u5f0f\u5fc5\u987b\u901a\u8fc7\u56db\u6b21\u6325\u624b\uff0c\u5b83\u7531\u8fdb\u7a0b\u8c03\u7528 <code>close</code> \u548c <code>shutdown</code> \u51fd\u6570\u53d1\u8d77 FIN \u62a5\u6587\uff08shutdown \u53c2\u6570\u987b\u4f20\u5165 SHUT_WR \u6216\u8005 SHUT_RDWR \u624d\u4f1a\u53d1\u9001 FIN\uff09\u3002</p> <p>\u8c03\u7528 close \u51fd\u6570\u548c shutdown \u51fd\u6570\u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>\u8c03\u7528\u4e86 close \u51fd\u6570\u610f\u5473\u7740\u5b8c\u5168\u65ad\u5f00\u8fde\u63a5\uff0c\u5b8c\u5168\u65ad\u5f00\u4e0d\u4ec5\u6307\u65e0\u6cd5\u4f20\u8f93\u6570\u636e\uff0c\u800c\u4e14\u4e5f\u4e0d\u80fd\u53d1\u9001\u6570\u636e\u3002\u6b64\u65f6\uff0c\u8c03\u7528\u4e86 close \u51fd\u6570\u7684\u4e00\u65b9\u7684\u8fde\u63a5\u53eb\u505a\u300c\u5b64\u513f\u8fde\u63a5\u300d\uff0c\u5982\u679c\u4f60\u7528 netstat -p \u547d\u4ee4\uff0c\u4f1a\u53d1\u73b0\u8fde\u63a5\u5bf9\u5e94\u7684\u8fdb\u7a0b\u540d\u4e3a\u7a7a\u3002</p> <p>\u4f7f\u7528 close \u51fd\u6570\u5173\u95ed\u8fde\u63a5\u662f\u4e0d\u4f18\u96c5\u7684\u3002\u4e8e\u662f\uff0c\u5c31\u51fa\u73b0\u4e86\u4e00\u79cd\u4f18\u96c5\u5173\u95ed\u8fde\u63a5\u7684 <code>shutdown</code> \u51fd\u6570\uff0c\u5b83\u53ef\u4ee5\u63a7\u5236\u53ea\u5173\u95ed\u4e00\u4e2a\u65b9\u5411\u7684\u8fde\u63a5\uff1a</p> <p></p> <p>\u7b2c\u4e8c\u4e2a\u53c2\u6570\u51b3\u5b9a\u65ad\u5f00\u8fde\u63a5\u7684\u65b9\u5f0f\uff0c\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u79cd\u65b9\u5f0f\uff1a</p> <ul> <li>SHUT_RD(0)\uff1a\u5173\u95ed\u8fde\u63a5\u7684\u300c\u8bfb\u300d\u8fd9\u4e2a\u65b9\u5411\uff0c\u5982\u679c\u63a5\u6536\u7f13\u51b2\u533a\u6709\u5df2\u63a5\u6536\u7684\u6570\u636e\uff0c\u5219\u5c06\u4f1a\u88ab\u4e22\u5f03\uff0c\u5e76\u4e14\u540e\u7eed\u518d\u6536\u5230\u65b0\u7684\u6570\u636e\uff0c\u4f1a\u5bf9\u6570\u636e\u8fdb\u884c ACK\uff0c\u7136\u540e\u6084\u6084\u5730\u4e22\u5f03\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5bf9\u7aef\u8fd8\u662f\u4f1a\u63a5\u6536\u5230 ACK\uff0c\u5728\u8fd9\u79cd\u60c5\u51b5\u4e0b\u6839\u672c\u4e0d\u77e5\u9053\u6570\u636e\u5df2\u7ecf\u88ab\u4e22\u5f03\u4e86\u3002</li> <li>SHUT_WR(1)\uff1a\u5173\u95ed\u8fde\u63a5\u7684\u300c\u5199\u300d\u8fd9\u4e2a\u65b9\u5411\uff0c\u8fd9\u5c31\u662f\u5e38\u88ab\u79f0\u4e3a\u300c\u534a\u5173\u95ed\u300d\u7684\u8fde\u63a5\u3002\u5982\u679c\u53d1\u9001\u7f13\u51b2\u533a\u8fd8\u6709\u672a\u53d1\u9001\u7684\u6570\u636e\uff0c\u5c06\u88ab\u7acb\u5373\u53d1\u9001\u51fa\u53bb\uff0c\u5e76\u53d1\u9001\u4e00\u4e2a FIN \u62a5\u6587\u7ed9\u5bf9\u7aef\u3002</li> <li>SHUT_RDWR(2)\uff1a\u76f8\u5f53\u4e8e SHUT_RD \u548c SHUT_WR \u64cd\u4f5c\u5404\u4e00\u6b21\uff0c\u5173\u95ed\u5957\u63a5\u5b57\u7684\u8bfb\u548c\u5199\u4e24\u4e2a\u65b9\u5411\u3002</li> </ul> <p>close \u548c shutdown \u51fd\u6570\u90fd\u53ef\u4ee5\u5173\u95ed\u8fde\u63a5\uff0c\u4f46\u8fd9\u4e24\u79cd\u65b9\u5f0f\u5173\u95ed\u7684\u8fde\u63a5\uff0c\u4e0d\u53ea\u529f\u80fd\u4e0a\u6709\u5dee\u5f02\uff0c\u63a7\u5236\u5b83\u4eec\u7684 Linux \u53c2\u6570\u4e5f\u4e0d\u76f8\u540c\u3002</p> <p>FIN_WAIT1 \u72b6\u6001\u7684\u4f18\u5316</p> <p>\u4e3b\u52a8\u65b9\u53d1\u9001 FIN \u62a5\u6587\u540e\uff0c\u8fde\u63a5\u5c31\u5904\u4e8e FIN_WAIT1 \u72b6\u6001\uff0c\u6b63\u5e38\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u80fd\u53ca\u65f6\u6536\u5230\u88ab\u52a8\u65b9\u7684 ACK\uff0c\u5219\u4f1a\u5f88\u5feb\u53d8\u4e3a FIN_WAIT2 \u72b6\u6001\u3002</p> <p>\u4f46\u662f\u5f53\u8fdf\u8fdf\u6536\u4e0d\u5230\u5bf9\u65b9\u8fd4\u56de\u7684 ACK \u65f6\uff0c\u8fde\u63a5\u5c31\u4f1a\u4e00\u76f4\u5904\u4e8e FIN_WAIT1 \u72b6\u6001\u3002\u6b64\u65f6\uff0c\u5185\u6838\u4f1a\u5b9a\u65f6\u91cd\u53d1 FIN \u62a5\u6587\uff0c\u5176\u4e2d\u91cd\u53d1\u6b21\u6570\u7531 tcp_orphan_retries \u53c2\u6570\u63a7\u5236\uff08\u6ce8\u610f\uff0corphan \u867d\u7136\u662f\u5b64\u513f\u7684\u610f\u601d\uff0c\u8be5\u53c2\u6570\u5374\u4e0d\u53ea\u5bf9\u5b64\u513f\u8fde\u63a5\u6709\u6548\uff0c\u4e8b\u5b9e\u4e0a\uff0c\u5b83\u5bf9\u6240\u6709 FIN_WAIT1 \u72b6\u6001\u4e0b\u7684\u8fde\u63a5\u90fd\u6709\u6548\uff09\uff0c\u9ed8\u8ba4\u503c\u662f 0\u3002</p> <p></p> <p>\u4f60\u53ef\u80fd\u4f1a\u597d\u5947\uff0c\u8fd9 0 \u8868\u793a\u51e0\u6b21\uff1f\u5b9e\u9645\u4e0a\u5f53\u4e3a 0 \u65f6\uff0c\u7279\u6307 8 \u6b21\uff0c\u4ece\u4e0b\u9762\u7684\u5185\u6838\u6e90\u7801\u53ef\u77e5\uff1a</p> <p></p> <p>\u5982\u679c FIN_WAIT1 \u72b6\u6001\u8fde\u63a5\u5f88\u591a\uff0c\u6211\u4eec\u5c31\u9700\u8981\u8003\u8651\u964d\u4f4e tcp_orphan_retries \u7684\u503c\uff0c\u5f53\u91cd\u4f20\u6b21\u6570\u8d85\u8fc7 tcp_orphan_retries \u65f6\uff0c\u8fde\u63a5\u5c31\u4f1a\u76f4\u63a5\u5173\u95ed\u6389\u3002</p> <p>\u5bf9\u4e8e\u666e\u904d\u6b63\u5e38\u60c5\u51b5\u65f6\uff0c\u8c03\u4f4e tcp_orphan_retries \u5c31\u5df2\u7ecf\u53ef\u4ee5\u4e86\u3002\u5982\u679c\u9047\u5230\u6076\u610f\u653b\u51fb\uff0cFIN \u62a5\u6587\u6839\u672c\u65e0\u6cd5\u53d1\u9001\u51fa\u53bb\uff0c\u8fd9\u7531 TCP \u4e24\u4e2a\u7279\u6027\u5bfc\u81f4\u7684\uff1a</p> <ul> <li>\u9996\u5148\uff0cTCP \u5fc5\u987b\u4fdd\u8bc1\u62a5\u6587\u662f\u6709\u5e8f\u53d1\u9001\u7684\uff0cFIN \u62a5\u6587\u4e5f\u4e0d\u4f8b\u5916\uff0c\u5f53\u53d1\u9001\u7f13\u51b2\u533a\u8fd8\u6709\u6570\u636e\u6ca1\u6709\u53d1\u9001\u65f6\uff0cFIN \u62a5\u6587\u4e5f\u4e0d\u80fd\u63d0\u524d\u53d1\u9001\u3002</li> <li>\u5176\u6b21\uff0cTCP \u6709\u6d41\u91cf\u63a7\u5236\u529f\u80fd\uff0c\u5f53\u63a5\u6536\u65b9\u63a5\u6536\u7a97\u53e3\u4e3a 0 \u65f6\uff0c\u53d1\u9001\u65b9\u5c31\u4e0d\u80fd\u518d\u53d1\u9001\u6570\u636e\u3002\u6240\u4ee5\uff0c\u5f53\u653b\u51fb\u8005\u4e0b\u8f7d\u5927\u6587\u4ef6\u65f6\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u63a5\u6536\u7a97\u53e3\u8bbe\u4e3a 0\uff0c\u8fd9\u5c31\u4f1a\u4f7f\u5f97 FIN \u62a5\u6587\u90fd\u65e0\u6cd5\u53d1\u9001\u51fa\u53bb\uff0c\u90a3\u4e48\u8fde\u63a5\u4f1a\u4e00\u76f4\u5904\u4e8e FIN_WAIT1 \u72b6\u6001\u3002</li> </ul> <p>\u89e3\u51b3\u8fd9\u79cd\u95ee\u9898\u7684\u65b9\u6cd5\uff0c\u662f\u8c03\u6574 tcp_max_orphans \u53c2\u6570\uff0c\u5b83\u5b9a\u4e49\u4e86\u300c\u5b64\u513f\u8fde\u63a5\u300d\u7684\u6700\u5927\u6570\u91cf\uff1a</p> <p></p> <p>\u5f53\u8fdb\u7a0b\u8c03\u7528\u4e86 <code>close</code> \u51fd\u6570\u5173\u95ed\u8fde\u63a5\uff0c\u6b64\u65f6\u8fde\u63a5\u5c31\u4f1a\u662f\u300c\u5b64\u513f\u8fde\u63a5\u300d\uff0c\u56e0\u4e3a\u5b83\u65e0\u6cd5\u518d\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u3002Linux \u7cfb\u7edf\u4e3a\u4e86\u9632\u6b62\u5b64\u513f\u8fde\u63a5\u8fc7\u591a\uff0c\u5bfc\u81f4\u7cfb\u7edf\u8d44\u6e90\u957f\u65f6\u95f4\u88ab\u5360\u7528\uff0c\u5c31\u63d0\u4f9b\u4e86 <code>tcp_max_orphans</code> \u53c2\u6570\u3002\u5982\u679c\u5b64\u513f\u8fde\u63a5\u6570\u91cf\u5927\u4e8e\u5b83\uff0c\u65b0\u589e\u7684\u5b64\u513f\u8fde\u63a5\u5c06\u4e0d\u518d\u8d70\u56db\u6b21\u6325\u624b\uff0c\u800c\u662f\u76f4\u63a5\u53d1\u9001 RST \u590d\u4f4d\u62a5\u6587\u5f3a\u5236\u5173\u95ed\u3002</p> <p>FIN_WAIT2 \u72b6\u6001\u7684\u4f18\u5316</p> <p>\u5f53\u4e3b\u52a8\u65b9\u6536\u5230 ACK \u62a5\u6587\u540e\uff0c\u4f1a\u5904\u4e8e FIN_WAIT2 \u72b6\u6001\uff0c\u5c31\u8868\u793a\u4e3b\u52a8\u65b9\u7684\u53d1\u9001\u901a\u9053\u5df2\u7ecf\u5173\u95ed\uff0c\u63a5\u4e0b\u6765\u5c06\u7b49\u5f85\u5bf9\u65b9\u53d1\u9001 FIN \u62a5\u6587\uff0c\u5173\u95ed\u5bf9\u65b9\u7684\u53d1\u9001\u901a\u9053\u3002</p> <p>\u8fd9\u65f6\uff0c\u5982\u679c\u8fde\u63a5\u662f\u7528 shutdown \u51fd\u6570\u5173\u95ed\u7684\uff0c\u8fde\u63a5\u53ef\u4ee5\u4e00\u76f4\u5904\u4e8e FIN_WAIT2 \u72b6\u6001\uff0c\u56e0\u4e3a\u5b83\u53ef\u80fd\u8fd8\u53ef\u4ee5\u53d1\u9001\u6216\u63a5\u6536\u6570\u636e\u3002\u4f46\u5bf9\u4e8e close \u51fd\u6570\u5173\u95ed\u7684\u5b64\u513f\u8fde\u63a5\uff0c\u7531\u4e8e\u65e0\u6cd5\u518d\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\uff0c\u6240\u4ee5\u8fd9\u4e2a\u72b6\u6001\u4e0d\u53ef\u4ee5\u6301\u7eed\u592a\u4e45\uff0c\u800c tcp_fin_timeout \u63a7\u5236\u4e86\u8fd9\u4e2a\u72b6\u6001\u4e0b\u8fde\u63a5\u7684\u6301\u7eed\u65f6\u957f\uff0c\u9ed8\u8ba4\u503c\u662f 60 \u79d2\uff1a</p> <p></p> <p>\u5b83\u610f\u5473\u7740\u5bf9\u4e8e\u5b64\u513f\u8fde\u63a5\uff08\u8c03\u7528 close \u5173\u95ed\u7684\u8fde\u63a5\uff09\uff0c\u5982\u679c\u5728 60 \u79d2\u540e\u8fd8\u6ca1\u6709\u6536\u5230 FIN \u62a5\u6587\uff0c\u8fde\u63a5\u5c31\u4f1a\u76f4\u63a5\u5173\u95ed\u3002</p> <p>\u8fd9\u4e2a 60 \u79d2\u4e0d\u662f\u968f\u4fbf\u51b3\u5b9a\u7684\uff0c\u5b83\u4e0e TIME_WAIT \u72b6\u6001\u6301\u7eed\u7684\u65f6\u95f4\u662f\u76f8\u540c\u7684\uff0c\u540e\u9762\u6211\u4eec\u518d\u6765\u8bf4\u8bf4\u4e3a\u4ec0\u4e48\u662f 60 \u79d2\u3002</p> <p>TIME_WAIT \u72b6\u6001\u7684\u4f18\u5316</p> <p>TIME_WAIT \u662f\u4e3b\u52a8\u65b9\u56db\u6b21\u6325\u624b\u7684\u6700\u540e\u4e00\u4e2a\u72b6\u6001\uff0c\u4e5f\u662f\u6700\u5e38\u9047\u89c1\u7684\u72b6\u6001\u3002</p> <p>\u5f53\u6536\u5230\u88ab\u52a8\u65b9\u53d1\u6765\u7684 FIN \u62a5\u6587\u540e\uff0c\u4e3b\u52a8\u65b9\u4f1a\u7acb\u523b\u56de\u590d ACK\uff0c\u8868\u793a\u786e\u8ba4\u5bf9\u65b9\u7684\u53d1\u9001\u901a\u9053\u5df2\u7ecf\u5173\u95ed\uff0c\u63a5\u7740\u5c31\u5904\u4e8e TIME_WAIT \u72b6\u6001\u3002\u5728 Linux \u7cfb\u7edf\uff0cTIME_WAIT \u72b6\u6001\u4f1a\u6301\u7eed 60 \u79d2\u540e\u624d\u4f1a\u8fdb\u5165\u5173\u95ed\u72b6\u6001\u3002</p> <p>TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u5728\u4e3b\u52a8\u65b9\u770b\u6765\u786e\u5b9e\u5feb\u5df2\u7ecf\u5173\u95ed\u4e86\u3002\u7136\u540e\uff0c\u88ab\u52a8\u65b9\u6ca1\u6709\u6536\u5230 ACK \u62a5\u6587\u524d\uff0c\u8fd8\u662f\u5904\u4e8e LAST_ACK \u72b6\u6001\u3002\u5982\u679c\u8fd9\u4e2a ACK \u62a5\u6587\u6ca1\u6709\u5230\u8fbe\u88ab\u52a8\u65b9\uff0c\u88ab\u52a8\u65b9\u5c31\u4f1a\u91cd\u53d1 FIN \u62a5\u6587\u3002\u91cd\u53d1\u6b21\u6570\u4ecd\u7136\u7531\u524d\u9762\u4ecb\u7ecd\u8fc7\u7684 tcp_orphan_retries \u53c2\u6570\u63a7\u5236\u3002</p> <p>TIME-WAIT \u7684\u72b6\u6001\u5c24\u5176\u91cd\u8981\uff0c\u4e3b\u8981\u662f\u4e24\u4e2a\u539f\u56e0\uff1a</p> <ul> <li>\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536\uff1b</li> <li>\u4fdd\u8bc1\u300c\u88ab\u52a8\u5173\u95ed\u8fde\u63a5\u300d\u7684\u4e00\u65b9\uff0c\u80fd\u88ab\u6b63\u786e\u7684\u5173\u95ed\uff1b</li> </ul> <p>\u539f\u56e0\u4e00\uff1a\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536</p> <p>TIME-WAIT \u7684\u4e00\u4e2a\u4f5c\u7528\u662f\u9632\u6b62\u6536\u5230\u5386\u53f2\u6570\u636e\uff0c\u4ece\u800c\u5bfc\u81f4\u6570\u636e\u9519\u4e71\u7684\u95ee\u9898\u3002</p> <p>\u5047\u8bbe TIME-WAIT \u6ca1\u6709\u7b49\u5f85\u65f6\u95f4\u6216\u65f6\u95f4\u8fc7\u77ed\uff0c\u88ab\u5ef6\u8fdf\u7684\u6570\u636e\u5305\u62b5\u8fbe\u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff1f</p> <p></p> <ul> <li> <p>\u5982\u4e0a\u56fe\uff1a</p> </li> <li> <p>\u670d\u52a1\u7aef\u5728\u5173\u95ed\u8fde\u63a5\u4e4b\u524d\u53d1\u9001\u7684 <code>SEQ = 301</code> \u62a5\u6587\uff0c\u88ab\u7f51\u7edc\u5ef6\u8fdf\u4e86\u3002</p> </li> <li>\u63a5\u7740\uff0c\u670d\u52a1\u7aef\u4ee5\u76f8\u540c\u7684\u56db\u5143\u7ec4\u91cd\u65b0\u6253\u5f00\u4e86\u65b0\u8fde\u63a5\uff0c\u524d\u9762\u88ab\u5ef6\u8fdf\u7684 <code>SEQ = 301</code> \u8fd9\u65f6\u62b5\u8fbe\u4e86\u5ba2\u6237\u7aef\uff0c\u800c\u4e14\u8be5\u6570\u636e\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u521a\u597d\u5728\u5ba2\u6237\u7aef\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u56e0\u6b64\u5ba2\u6237\u7aef\u4f1a\u6b63\u5e38\u63a5\u6536\u8fd9\u4e2a\u6570\u636e\u62a5\u6587\uff0c\u4f46\u662f\u8fd9\u4e2a\u6570\u636e\u62a5\u6587\u662f\u4e0a\u4e00\u4e2a\u8fde\u63a5\u6b8b\u7559\u4e0b\u6765\u7684\uff0c\u8fd9\u6837\u5c31\u4ea7\u751f\u6570\u636e\u9519\u4e71\u7b49\u4e25\u91cd\u7684\u95ee\u9898\u3002</li> </ul> <p>\u4e3a\u4e86\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536\uff0c\u56e0\u6b64 TCP \u8bbe\u8ba1\u4e86 TIME_WAIT \u72b6\u6001\uff0c\u72b6\u6001\u4f1a\u6301\u7eed <code>2MSL</code> \u65f6\u957f\uff0c\u8fd9\u4e2a\u65f6\u95f4\u8db3\u4ee5\u8ba9\u4e24\u4e2a\u65b9\u5411\u4e0a\u7684\u6570\u636e\u5305\u90fd\u88ab\u4e22\u5f03\uff0c\u4f7f\u5f97\u539f\u6765\u8fde\u63a5\u7684\u6570\u636e\u5305\u5728\u7f51\u7edc\u4e2d\u90fd\u81ea\u7136\u6d88\u5931\uff0c\u518d\u51fa\u73b0\u7684\u6570\u636e\u5305\u4e00\u5b9a\u90fd\u662f\u65b0\u5efa\u7acb\u8fde\u63a5\u6240\u4ea7\u751f\u7684\u3002</p> <p>\u539f\u56e0\u4e8c\uff1a\u4fdd\u8bc1\u300c\u88ab\u52a8\u5173\u95ed\u8fde\u63a5\u300d\u7684\u4e00\u65b9\uff0c\u80fd\u88ab\u6b63\u786e\u7684\u5173\u95ed</p> <p>\u5728 RFC 793 \u6307\u51fa TIME-WAIT \u53e6\u4e00\u4e2a\u91cd\u8981\u7684\u4f5c\u7528\u662f\uff1a</p> <p>TIME-WAIT - represents waiting for enough time to pass to be sure the remote TCP received the acknowledgment of its connection termination request.</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0cTIME-WAIT \u4f5c\u7528\u662f\u7b49\u5f85\u8db3\u591f\u7684\u65f6\u95f4\u4ee5\u786e\u4fdd\u6700\u540e\u7684 ACK \u80fd\u8ba9\u88ab\u52a8\u5173\u95ed\u65b9\u63a5\u6536\uff0c\u4ece\u800c\u5e2e\u52a9\u5176\u6b63\u5e38\u5173\u95ed\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u5173\u95ed\u65b9\uff09\u6700\u540e\u4e00\u6b21 ACK \u62a5\u6587\uff08\u7b2c\u56db\u6b21\u6325\u624b\uff09\u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u4e86\uff0c\u90a3\u4e48\u6309\u7167 TCP \u53ef\u9760\u6027\u539f\u5219\uff0c\u670d\u52a1\u7aef\uff08\u88ab\u52a8\u5173\u95ed\u65b9\uff09\u4f1a\u91cd\u53d1 FIN \u62a5\u6587\u3002</p> <p>\u5047\u8bbe\u5ba2\u6237\u7aef\u6ca1\u6709 TIME_WAIT \u72b6\u6001\uff0c\u800c\u662f\u5728\u53d1\u5b8c\u6700\u540e\u4e00\u6b21\u56de ACK \u62a5\u6587\u5c31\u76f4\u63a5\u8fdb\u5165 CLOSED \u72b6\u6001\uff0c\u5982\u679c\u8be5  ACK \u62a5\u6587\u4e22\u5931\u4e86\uff0c\u670d\u52a1\u7aef\u5219\u91cd\u4f20\u7684 FIN \u62a5\u6587\uff0c\u800c\u8fd9\u65f6\u5ba2\u6237\u7aef\u5df2\u7ecf\u8fdb\u5165\u5230\u5173\u95ed\u72b6\u6001\u4e86\uff0c\u5728\u6536\u5230\u670d\u52a1\u7aef\u91cd\u4f20\u7684 FIN \u62a5\u6587\u540e\uff0c\u5c31\u4f1a\u56de RST \u62a5\u6587\u3002</p> <p></p> <p>\u670d\u52a1\u7aef\u6536\u5230\u8fd9\u4e2a RST \u5e76\u5c06\u5176\u89e3\u91ca\u4e3a\u4e00\u4e2a\u9519\u8bef\uff08Connection reset by peer\uff09\uff0c\u8fd9\u5bf9\u4e8e\u4e00\u4e2a\u53ef\u9760\u7684\u534f\u8bae\u6765\u8bf4\u4e0d\u662f\u4e00\u4e2a\u4f18\u96c5\u7684\u7ec8\u6b62\u65b9\u5f0f\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u51fa\u73b0\uff0c\u5ba2\u6237\u7aef\u5fc5\u987b\u7b49\u5f85\u8db3\u591f\u957f\u7684\u65f6\u95f4\uff0c\u786e\u4fdd\u670d\u52a1\u7aef\u80fd\u591f\u6536\u5230 ACK\uff0c\u5982\u679c\u670d\u52a1\u7aef\u6ca1\u6709\u6536\u5230 ACK\uff0c\u90a3\u4e48\u5c31\u4f1a\u89e6\u53d1 TCP \u91cd\u4f20\u673a\u5236\uff0c\u670d\u52a1\u7aef\u4f1a\u91cd\u65b0\u53d1\u9001\u4e00\u4e2a FIN\uff0c\u8fd9\u6837\u4e00\u53bb\u4e00\u6765\u521a\u597d\u4e24\u4e2a MSL \u7684\u65f6\u95f4\u3002</p> <p></p> <p>\u5ba2\u6237\u7aef\u5728\u6536\u5230\u670d\u52a1\u7aef\u91cd\u4f20\u7684 FIN \u62a5\u6587\u65f6\uff0cTIME_WAIT \u72b6\u6001\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u4f1a\u91cd\u7f6e\u56de 2MSL\u3002</p> <p>\u6211\u4eec\u518d\u56de\u8fc7\u5934\u6765\u770b\u770b\uff0c\u4e3a\u4ec0\u4e48 TIME_WAIT \u72b6\u6001\u8981\u4fdd\u6301 60 \u79d2\u5462\uff1f</p> <p>\u8fd9\u4e0e\u5b64\u513f\u8fde\u63a5 FIN_WAIT2 \u72b6\u6001\u9ed8\u8ba4\u4fdd\u7559 60 \u79d2\u7684\u539f\u7406\u662f\u4e00\u6837\u7684\uff0c\u56e0\u4e3a\u8fd9\u4e24\u4e2a\u72b6\u6001\u90fd\u9700\u8981\u4fdd\u6301 2MSL \u65f6\u957f\u3002MSL \u5168\u79f0\u662f Maximum Segment Lifetime\uff0c\u5b83\u5b9a\u4e49\u4e86\u4e00\u4e2a\u62a5\u6587\u5728\u7f51\u7edc\u4e2d\u7684\u6700\u957f\u751f\u5b58\u65f6\u95f4\uff08\u62a5\u6587\u6bcf\u7ecf\u8fc7\u4e00\u6b21\u8def\u7531\u5668\u7684\u8f6c\u53d1\uff0cIP \u5934\u90e8\u7684 TTL \u5b57\u6bb5\u5c31\u4f1a\u51cf 1\uff0c\u51cf\u5230 0 \u65f6\u62a5\u6587\u5c31\u88ab\u4e22\u5f03\uff0c\u8fd9\u5c31\u9650\u5236\u4e86\u62a5\u6587\u7684\u6700\u957f\u5b58\u6d3b\u65f6\u95f4\uff09\u3002</p> <p>\u4e3a\u4ec0\u4e48\u662f 2 MSL \u7684\u65f6\u957f\u5462\uff1f\u8fd9\u5176\u5b9e\u662f\u76f8\u5f53\u4e8e\u81f3\u5c11\u5141\u8bb8\u62a5\u6587\u4e22\u5931\u4e00\u6b21\u3002\u6bd4\u5982\uff0c\u82e5 ACK \u5728\u4e00\u4e2a MSL \u5185\u4e22\u5931\uff0c\u8fd9\u6837\u88ab\u52a8\u65b9\u91cd\u53d1\u7684 FIN \u4f1a\u5728\u7b2c 2 \u4e2a MSL \u5185\u5230\u8fbe\uff0cTIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u53ef\u4ee5\u5e94\u5bf9\u3002</p> <p>\u4e3a\u4ec0\u4e48\u4e0d\u662f 4 \u6216\u8005 8 MSL \u7684\u65f6\u957f\u5462\uff1f\u4f60\u53ef\u4ee5\u60f3\u8c61\u4e00\u4e2a\u4e22\u5305\u7387\u8fbe\u5230\u767e\u5206\u4e4b\u4e00\u7684\u7cdf\u7cd5\u7f51\u7edc\uff0c\u8fde\u7eed\u4e24\u6b21\u4e22\u5305\u7684\u6982\u7387\u53ea\u6709\u4e07\u5206\u4e4b\u4e00\uff0c\u8fd9\u4e2a\u6982\u7387\u5b9e\u5728\u662f\u592a\u5c0f\u4e86\uff0c\u5ffd\u7565\u5b83\u6bd4\u89e3\u51b3\u5b83\u66f4\u5177\u6027\u4ef7\u6bd4\u3002</p> <p>\u56e0\u6b64\uff0cTIME_WAIT \u548c FIN_WAIT2 \u72b6\u6001\u7684\u6700\u5927\u65f6\u957f\u90fd\u662f 2 MSL\uff0c\u7531\u4e8e\u5728 Linux \u7cfb\u7edf\u4e2d\uff0cMSL \u7684\u503c\u56fa\u5b9a\u4e3a 30 \u79d2\uff0c\u6240\u4ee5\u5b83\u4eec\u90fd\u662f 60 \u79d2\u3002</p> <p>TIME_WAIT \u72b6\u6001\u4f18\u5316\u65b9\u5f0f\u4e00</p> <p>Linux \u63d0\u4f9b\u4e86 tcp_max_tw_buckets \u53c2\u6570\uff0c\u5f53 TIME_WAIT \u7684\u8fde\u63a5\u6570\u91cf\u8d85\u8fc7\u8be5\u53c2\u6570\u65f6\uff0c\u65b0\u5173\u95ed\u7684\u8fde\u63a5\u5c31\u4e0d\u518d\u7ecf\u5386 TIME_WAIT \u800c\u76f4\u63a5\u5173\u95ed\uff1a</p> <p></p> <p>\u5f53\u670d\u52a1\u5668\u7684\u5e76\u53d1\u8fde\u63a5\u589e\u591a\u65f6\uff0c\u76f8\u5e94\u5730\uff0c\u540c\u65f6\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u6570\u91cf\u4e5f\u4f1a\u53d8\u591a\uff0c\u6b64\u65f6\u5c31\u5e94\u5f53\u8c03\u5927 <code>tcp_max_tw_buckets</code> \u53c2\u6570\uff0c\u51cf\u5c11\u4e0d\u540c\u8fde\u63a5\u95f4\u6570\u636e\u9519\u4e71\u7684\u6982\u7387\u3002tcp_max_tw_buckets \u4e5f\u4e0d\u662f\u8d8a\u5927\u8d8a\u597d\uff0c\u6bd5\u7adf\u7cfb\u7edf\u8d44\u6e90\u662f\u6709\u9650\u7684\u3002</p> <p>TIME_WAIT \u72b6\u6001\u4f18\u5316\u65b9\u5f0f\u4e8c</p> <p>\u6709\u4e00\u79cd\u65b9\u5f0f\u53ef\u4ee5\u5728\u5efa\u7acb\u65b0\u8fde\u63a5\u65f6\uff0c\u590d\u7528\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u90a3\u5c31\u662f\u6253\u5f00 tcp_tw_reuse \u53c2\u6570\u3002\u4f46\u662f\u9700\u8981\u6ce8\u610f\uff0c\u8be5\u53c2\u6570\u662f\u53ea\u7528\u4e8e\u5ba2\u6237\u7aef\uff08\u5efa\u7acb\u8fde\u63a5\u7684\u53d1\u8d77\u65b9\uff09\uff0c\u56e0\u4e3a\u662f\u5728\u8c03\u7528 connect() \u65f6\u8d77\u4f5c\u7528\u7684\uff0c\u800c\u5bf9\u4e8e\u670d\u52a1\u7aef\uff08\u88ab\u52a8\u8fde\u63a5\u65b9\uff09\u662f\u6ca1\u6709\u7528\u7684\u3002</p> <p></p> <p>\u7f51\u4e0a\u5f88\u591a\u535a\u5ba2\u90fd\u8bf4\u5728\u670d\u52a1\u7aef\u5f00\u542f tcp_tw_reuse \u53c2\u6570\u6765\u4f18\u5316 TCP\uff0c\u6211\u4fe1\u4f60\u4e2a\u9b3c\uff0c\u7cdf\u8001\u5934\u574f\u7684\u5f88\uff01tcp_tw_reuse \u53ea\u4f5c\u7528\u5728 connect \u51fd\u6570\uff0c\u4e5f\u5c31\u662f\u5ba2\u6237\u7aef\uff0c\u8ddf\u670d\u52a1\u7aef\u4e00\u6bdb\u5173\u7cfb\u7684\u6ca1\u6709\u3002</p> <p>tcp_tw_reuse \u4ece\u534f\u8bae\u89d2\u5ea6\u7406\u89e3\u662f\u5b89\u5168\u53ef\u63a7\u7684\uff0c\u53ef\u4ee5\u590d\u7528\u5904\u4e8e TIME_WAIT \u7684\u7aef\u53e3\u4e3a\u65b0\u7684\u8fde\u63a5\u6240\u7528\u3002</p> <p>\u4ec0\u4e48\u662f\u534f\u8bae\u89d2\u5ea6\u7406\u89e3\u7684\u5b89\u5168\u53ef\u63a7\u5462\uff1f\u4e3b\u8981\u6709\u4e24\u70b9\uff1a</p> <ul> <li>\u53ea\u9002\u7528\u4e8e\u8fde\u63a5\u53d1\u8d77\u65b9\uff0c\u4e5f\u5c31\u662f C/S \u6a21\u578b\u4e2d\u7684\u5ba2\u6237\u7aef\uff1b</li> <li>\u5bf9\u5e94\u7684 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u521b\u5efa\u65f6\u95f4\u8d85\u8fc7 1 \u79d2\u624d\u53ef\u4ee5\u88ab\u590d\u7528\u3002</li> </ul> <p>\u4f7f\u7528\u8fd9\u4e2a\u9009\u9879\uff0c\u8fd8\u6709\u4e00\u4e2a\u524d\u63d0\uff0c\u9700\u8981\u6253\u5f00\u5bf9 TCP \u65f6\u95f4\u6233\u7684\u652f\u6301\uff08\u5bf9\u65b9\u4e5f\u8981\u6253\u5f00\uff09\uff1a</p> <p></p> <p>\u7531\u4e8e\u5f15\u5165\u4e86\u65f6\u95f4\u6233\uff0c\u5b83\u80fd\u5e26\u6765\u4e86\u4e9b\u597d\u5904\uff1a</p> <ul> <li>\u6211\u4eec\u5728\u524d\u9762\u63d0\u5230\u7684 2MSL\uff08TIME_WAIT \u72b6\u6001\u7684\u6301\u7eed\u65f6\u95f4\uff09\u95ee\u9898\u5c31\u4e0d\u590d\u5b58\u5728\u4e86\uff0c\u56e0\u4e3a\u91cd\u590d\u7684\u6570\u636e\u5305\u4f1a\u56e0\u4e3a\u65f6\u95f4\u6233\u8fc7\u671f\u88ab\u81ea\u7136\u4e22\u5f03\uff1b</li> <li>\u540c\u65f6\uff0c\u5b83\u8fd8\u53ef\u4ee5\u9632\u6b62\u5e8f\u5217\u53f7\u7ed5\u56de\uff0c\u4e5f\u662f\u56e0\u4e3a\u91cd\u590d\u7684\u6570\u636e\u5305\u4f1a\u7531\u4e8e\u65f6\u95f4\u6233\u8fc7\u671f\u88ab\u81ea\u7136\u4e22\u5f03\uff1b</li> </ul> <p>\u65f6\u95f4\u6233\u662f\u5728 TCP \u7684\u9009\u9879\u5b57\u6bb5\u91cc\u5b9a\u4e49\u7684\uff0c\u5f00\u542f\u4e86\u65f6\u95f4\u6233\u529f\u80fd\uff0c\u5728 TCP \u62a5\u6587\u4f20\u8f93\u7684\u65f6\u5019\u4f1a\u5e26\u4e0a\u53d1\u9001\u62a5\u6587\u7684\u65f6\u95f4\u6233\u3002</p> <p></p> <p>\u53e6\u5916\uff0c\u8001\u7248\u672c\u7684 Linux \u8fd8\u63d0\u4f9b\u4e86 <code>tcp_tw_recycle</code> \u53c2\u6570\uff0c\u4f46\u662f\u5f53\u5f00\u542f\u4e86\u5b83\uff0c\u5141\u8bb8\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u88ab\u5feb\u901f\u56de\u6536\uff0c\u4f46\u662f\u6709\u4e2a\u5927\u5751\u3002</p> <p>\u5f00\u542f\u4e86 recycle \u548c timestamps \u9009\u9879\uff0c\u5c31\u4f1a\u5f00\u542f\u4e00\u79cd\u53eb per-host \u7684 PAWS\uff08\u5224\u65ad TCP \u62a5\u6587\u4e2d\u65f6\u95f4\u6233\u662f\u5426\u662f\u5386\u53f2\u62a5\u6587\uff09\u673a\u5236\uff0cper-host \u662f\u5bf9\u300c\u5bf9\u7aef IP \u505a PAWS \u68c0\u67e5\u300d\uff0c\u800c\u975e\u5bf9\u300cIP + \u7aef\u53e3\u300d\u56db\u5143\u7ec4\u505a PAWS \u68c0\u67e5\u3002</p> <p>\u5982\u679c\u5ba2\u6237\u7aef\u7f51\u7edc\u73af\u5883\u662f\u7528\u4e86 NAT \u7f51\u5173\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u73af\u5883\u7684\u6bcf\u4e00\u53f0\u673a\u5668\u901a\u8fc7 NAT \u7f51\u5173\u540e\uff0c\u90fd\u4f1a\u662f\u76f8\u540c\u7684 IP \u5730\u5740\uff0c\u5728\u670d\u52a1\u7aef\u770b\u6765\uff0c\u5c31\u597d\u50cf\u53ea\u662f\u5728\u8ddf\u4e00\u4e2a\u5ba2\u6237\u7aef\u6253\u4ea4\u9053\u4e00\u6837\uff0c\u65e0\u6cd5\u533a\u5206\u51fa\u6765\u3002</p> <p>Per-host PAWS \u673a\u5236\u5229\u7528 TCP option \u91cc\u7684 timestamp \u5b57\u6bb5\u7684\u589e\u957f\u6765\u5224\u65ad\u4e32\u6270\u6570\u636e\uff0c\u800c timestamp \u662f\u6839\u636e\u5ba2\u6237\u7aef\u5404\u81ea\u7684 CPU tick \u5f97\u51fa\u7684\u503c\u3002</p> <p>\u5f53\u5ba2\u6237\u7aef A \u901a\u8fc7 NAT \u7f51\u5173\u548c\u670d\u52a1\u5668\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u7136\u540e\u670d\u52a1\u5668\u4e3b\u52a8\u5173\u95ed\u5e76\u4e14\u5feb\u901f\u56de\u6536 TIME-WAIT \u72b6\u6001\u7684\u8fde\u63a5\u540e\uff0c\u5ba2\u6237\u7aef B \u4e5f\u901a\u8fc7 NAT \u7f51\u5173\u548c\u670d\u52a1\u5668\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u6ce8\u610f\u5ba2\u6237\u7aef A \u548c \u5ba2\u6237\u7aef B \u56e0\u4e3a\u7ecf\u8fc7\u76f8\u540c\u7684 NAT \u7f51\u5173\uff0c\u6240\u4ee5\u662f\u7528\u76f8\u540c\u7684 IP \u5730\u5740\u4e0e\u670d\u52a1\u7aef\u5efa\u7acb TCP \u8fde\u63a5\uff0c\u5982\u679c\u5ba2\u6237\u7aef B \u7684 timestamp \u6bd4 \u5ba2\u6237\u7aef A \u7684 timestamp \u5c0f\uff0c\u90a3\u4e48\u7531\u4e8e\u670d\u52a1\u7aef\u7684 per-host \u7684 PAWS \u673a\u5236\u7684\u4f5c\u7528\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u4e22\u5f03\u5ba2\u6237\u7aef\u4e3b\u673a B \u53d1\u6765\u7684 SYN \u5305\u3002</p> <p>\u56e0\u6b64\uff0ctcp_tw_recycle \u5728\u4f7f\u7528\u4e86 NAT \u7684\u7f51\u7edc\u4e0b\u662f\u5b58\u5728\u95ee\u9898\u7684\uff0c\u5982\u679c\u5b83\u662f\u5bf9 TCP \u56db\u5143\u7ec4\u505a PAWS \u68c0\u67e5\uff0c\u800c\u4e0d\u662f\u5bf9\u300c\u76f8\u540c\u7684 IP \u505a PAWS \u68c0\u67e5\u300d\uff0c\u90a3\u4e48\u5c31\u4e0d\u4f1a\u5b58\u5728\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002</p> <p>\u7f51\u4e0a\u5f88\u591a\u535a\u5ba2\u90fd\u8bf4\u5f00\u542f tcp_tw_recycle \u53c2\u6570\u6765\u4f18\u5316 TCP\uff0c\u6211\u4fe1\u4f60\u4e2a\u9b3c\uff0c\u7cdf\u8001\u5934\u574f\u7684\u5f88\uff01</p> <p>\u6240\u4ee5\uff0c\u4e0d\u5efa\u8bae\u8bbe\u7f6e\u4e3a 1\uff0c\u5728 Linux 4.12 \u7248\u672c\u540e\uff0cLinux \u5185\u6838\u76f4\u63a5\u53d6\u6d88\u4e86\u8fd9\u4e00\u53c2\u6570\uff0c\u5efa\u8bae\u5173\u95ed\u5b83\uff1a</p> <p></p> <p>TIME_WAIT \u72b6\u6001\u4f18\u5316\u65b9\u5f0f\u4e09</p> <p>\u6211\u4eec\u53ef\u4ee5\u5728\u7a0b\u5e8f\u4e2d\u8bbe\u7f6e socket \u9009\u9879\uff0c\u6765\u8bbe\u7f6e\u8c03\u7528 close \u5173\u95ed\u8fde\u63a5\u884c\u4e3a\u3002</p> <p></p> <p>\u5982\u679c <code>l_onoff</code> \u4e3a\u975e 0\uff0c\u4e14 <code>l_linger</code> \u503c\u4e3a 0\uff0c\u90a3\u4e48\u8c03\u7528 close \u540e\uff0c\u4f1a\u7acb\u8be5\u53d1\u9001\u4e00\u4e2a RST \u6807\u5fd7\u7ed9\u5bf9\u7aef\uff0c\u8be5 TCP \u8fde\u63a5\u5c06\u8df3\u8fc7\u56db\u6b21\u6325\u624b\uff0c\u4e5f\u5c31\u8df3\u8fc7\u4e86 TIME_WAIT \u72b6\u6001\uff0c\u76f4\u63a5\u5173\u95ed\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u53ea\u63a8\u8350\u5728\u5ba2\u6237\u7aef\u4f7f\u7528\uff0c\u670d\u52a1\u7aef\u5343\u4e07\u4e0d\u8981\u4f7f\u7528\u3002\u56e0\u4e3a\u670d\u52a1\u7aef\u4e00\u8c03\u7528 close\uff0c\u5c31\u53d1\u9001 RST \u62a5\u6587\u7684\u8bdd\uff0c\u5ba2\u6237\u7aef\u5c31\u603b\u662f\u770b\u5230 TCP \u8fde\u63a5\u9519\u8bef\u201cconnnection reset by peer\u201d\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_6","title":"\u88ab\u52a8\u65b9\u7684\u4f18\u5316","text":"<p>\u5f53\u88ab\u52a8\u65b9\u6536\u5230 FIN \u62a5\u6587\u65f6\uff0c\u5185\u6838\u4f1a\u81ea\u52a8\u56de\u590d ACK\uff0c\u540c\u65f6\u8fde\u63a5\u5904\u4e8e CLOSE_WAIT \u72b6\u6001\uff0c\u987e\u540d\u601d\u4e49\uff0c\u5b83\u8868\u793a\u7b49\u5f85\u5e94\u7528\u8fdb\u7a0b\u8c03\u7528 close \u51fd\u6570\u5173\u95ed\u8fde\u63a5\u3002</p> <p>\u5185\u6838\u6ca1\u6709\u6743\u5229\u66ff\u4ee3\u8fdb\u7a0b\u53bb\u5173\u95ed\u8fde\u63a5\uff0c\u56e0\u4e3a\u5982\u679c\u4e3b\u52a8\u65b9\u662f\u901a\u8fc7 shutdown \u5173\u95ed\u8fde\u63a5\uff0c\u90a3\u4e48\u5b83\u5c31\u662f\u60f3\u5728\u534a\u5173\u95ed\u8fde\u63a5\u4e0a\u63a5\u6536\u6570\u636e\u6216\u53d1\u9001\u6570\u636e\u3002\u56e0\u6b64\uff0cLinux \u5e76\u6ca1\u6709\u9650\u5236 CLOSE_WAIT \u72b6\u6001\u7684\u6301\u7eed\u65f6\u95f4\u3002</p> <p>\u5f53\u7136\uff0c\u5927\u591a\u6570\u5e94\u7528\u7a0b\u5e8f\u5e76\u4e0d\u4f7f\u7528 shutdown \u51fd\u6570\u5173\u95ed\u8fde\u63a5\u3002\u6240\u4ee5\uff0c\u5f53\u4f60\u7528 netstat \u547d\u4ee4\u53d1\u73b0\u5927\u91cf CLOSE_WAIT \u72b6\u6001\u3002\u5c31\u9700\u8981\u6392\u67e5\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u56e0\u4e3a\u53ef\u80fd\u56e0\u4e3a\u5e94\u7528\u7a0b\u5e8f\u51fa\u73b0\u4e86 Bug\uff0cread \u51fd\u6570\u8fd4\u56de 0 \u65f6\uff0c\u6ca1\u6709\u8c03\u7528 close \u51fd\u6570\u3002</p> <p>\u5904\u4e8e CLOSE_WAIT \u72b6\u6001\u65f6\uff0c\u8c03\u7528\u4e86 close \u51fd\u6570\uff0c\u5185\u6838\u5c31\u4f1a\u53d1\u51fa FIN \u62a5\u6587\u5173\u95ed\u53d1\u9001\u901a\u9053\uff0c\u540c\u65f6\u8fde\u63a5\u8fdb\u5165 LAST_ACK \u72b6\u6001\uff0c\u7b49\u5f85\u4e3b\u52a8\u65b9\u8fd4\u56de ACK \u6765\u786e\u8ba4\u8fde\u63a5\u5173\u95ed\u3002</p> <p>\u5982\u679c\u8fdf\u8fdf\u6536\u4e0d\u5230\u8fd9\u4e2a ACK\uff0c\u5185\u6838\u5c31\u4f1a\u91cd\u53d1 FIN \u62a5\u6587\uff0c\u91cd\u53d1\u6b21\u6570\u4ecd\u7136\u7531 tcp_orphan_retries \u53c2\u6570\u63a7\u5236\uff0c\u8fd9\u4e0e\u4e3b\u52a8\u65b9\u91cd\u53d1 FIN \u62a5\u6587\u7684\u4f18\u5316\u7b56\u7565\u4e00\u81f4\u3002</p> <p>\u8fd8\u6709\u4e00\u70b9\u6211\u4eec\u9700\u8981\u6ce8\u610f\u7684\uff0c\u5982\u679c\u88ab\u52a8\u65b9\u8fc5\u901f\u8c03\u7528 close \u51fd\u6570\uff0c\u90a3\u4e48\u88ab\u52a8\u65b9\u7684 ACK \u548c FIN \u6709\u53ef\u80fd\u5728\u4e00\u4e2a\u62a5\u6587\u4e2d\u53d1\u9001\uff0c\u8fd9\u6837\u770b\u8d77\u6765\uff0c\u56db\u6b21\u6325\u624b\u4f1a\u53d8\u6210\u4e09\u6b21\u6325\u624b\uff0c\u8fd9\u53ea\u662f\u4e00\u79cd\u7279\u6b8a\u60c5\u51b5\uff0c\u4e0d\u7528\u5728\u610f\u3002</p> <p>\u5982\u679c\u8fde\u63a5\u53cc\u65b9\u540c\u65f6\u5173\u95ed\u8fde\u63a5\uff0c\u4f1a\u600e\u4e48\u6837\uff1f</p> <p>\u7531\u4e8e TCP \u662f\u53cc\u5168\u5de5\u7684\u534f\u8bae\uff0c\u6240\u4ee5\u662f\u4f1a\u51fa\u73b0\u4e24\u65b9\u540c\u65f6\u5173\u95ed\u8fde\u63a5\u7684\u73b0\u8c61\uff0c\u4e5f\u5c31\u662f\u540c\u65f6\u53d1\u9001\u4e86 FIN \u62a5\u6587\u3002</p> <p>\u6b64\u65f6\uff0c\u4e0a\u9762\u4ecb\u7ecd\u7684\u4f18\u5316\u7b56\u7565\u4ecd\u7136\u9002\u7528\u3002\u4e24\u65b9\u53d1\u9001 FIN \u62a5\u6587\u65f6\uff0c\u90fd\u8ba4\u4e3a\u81ea\u5df1\u662f\u4e3b\u52a8\u65b9\uff0c\u6240\u4ee5\u90fd\u8fdb\u5165\u4e86 FIN_WAIT1 \u72b6\u6001\uff0cFIN \u62a5\u6587\u7684\u91cd\u53d1\u6b21\u6570\u4ecd\u7531 tcp_orphan_retries \u53c2\u6570\u63a7\u5236\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u53cc\u65b9\u5728\u7b49\u5f85 ACK \u62a5\u6587\u7684\u8fc7\u7a0b\u4e2d\uff0c\u90fd\u7b49\u6765\u4e86 FIN \u62a5\u6587\u3002\u8fd9\u662f\u4e00\u79cd\u65b0\u60c5\u51b5\uff0c\u6240\u4ee5\u8fde\u63a5\u4f1a\u8fdb\u5165\u4e00\u79cd\u53eb\u505a CLOSING \u7684\u65b0\u72b6\u6001\uff0c\u5b83\u66ff\u4ee3\u4e86 FIN_WAIT2 \u72b6\u6001\u3002\u63a5\u7740\uff0c\u53cc\u65b9\u5185\u6838\u56de\u590d ACK \u786e\u8ba4\u5bf9\u65b9\u53d1\u9001\u901a\u9053\u7684\u5173\u95ed\u540e\uff0c\u8fdb\u5165 TIME_WAIT \u72b6\u6001\uff0c\u7b49\u5f85 2MSL \u7684\u65f6\u95f4\u540e\uff0c\u8fde\u63a5\u81ea\u52a8\u5173\u95ed\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_7","title":"\u5c0f\u7ed3","text":"<p>\u9488\u5bf9 TCP \u56db\u6b21\u6325\u624b\u7684\u4f18\u5316\uff0c\u6211\u4eec\u9700\u8981\u6839\u636e\u4e3b\u52a8\u65b9\u548c\u88ab\u52a8\u65b9\u56db\u6b21\u6325\u624b\u72b6\u6001\u53d8\u5316\u6765\u8c03\u6574\u7cfb\u7edf TCP \u5185\u6838\u53c2\u6570\u3002</p> <p></p> <p>\u4e3b\u52a8\u65b9\u7684\u4f18\u5316</p> <p>\u4e3b\u52a8\u53d1\u8d77 FIN \u62a5\u6587\u65ad\u5f00\u8fde\u63a5\u7684\u4e00\u65b9\uff0c\u5982\u679c\u8fdf\u8fdf\u6ca1\u6536\u5230\u5bf9\u65b9\u7684 ACK \u56de\u590d\uff0c\u5219\u4f1a\u91cd\u4f20 FIN \u62a5\u6587\uff0c\u91cd\u4f20\u7684\u6b21\u6570\u7531 <code>tcp_orphan_retries</code> \u53c2\u6570\u51b3\u5b9a\u3002</p> <p>\u5f53\u4e3b\u52a8\u65b9\u6536\u5230 ACK \u62a5\u6587\u540e\uff0c\u8fde\u63a5\u5c31\u8fdb\u5165 FIN_WAIT2 \u72b6\u6001\uff0c\u6839\u636e\u5173\u95ed\u7684\u65b9\u5f0f\u4e0d\u540c\uff0c\u4f18\u5316\u7684\u65b9\u5f0f\u4e5f\u4e0d\u540c\uff1a</p> <ul> <li>\u5982\u679c\u8fd9\u662f close \u51fd\u6570\u5173\u95ed\u7684\u8fde\u63a5\uff0c\u90a3\u4e48\u5b83\u5c31\u662f\u5b64\u513f\u8fde\u63a5\u3002\u5982\u679c <code>tcp_fin_timeout</code> \u79d2\u5185\u6ca1\u6709\u6536\u5230\u5bf9\u65b9\u7684 FIN \u62a5\u6587\uff0c\u8fde\u63a5\u5c31\u76f4\u63a5\u5173\u95ed\u3002\u540c\u65f6\uff0c\u4e3a\u4e86\u5e94\u5bf9\u5b64\u513f\u8fde\u63a5\u5360\u7528\u592a\u591a\u7684\u8d44\u6e90\uff0c<code>tcp_max_orphans</code> \u5b9a\u4e49\u4e86\u6700\u5927\u5b64\u513f\u8fde\u63a5\u7684\u6570\u91cf\uff0c\u8d85\u8fc7\u65f6\u8fde\u63a5\u5c31\u4f1a\u76f4\u63a5\u91ca\u653e\u3002</li> <li>\u53cd\u4e4b\u662f shutdown \u51fd\u6570\u5173\u95ed\u7684\u8fde\u63a5\uff0c\u5219\u4e0d\u53d7\u6b64\u53c2\u6570\u9650\u5236\uff1b</li> </ul> <p>\u5f53\u4e3b\u52a8\u65b9\u63a5\u6536\u5230 FIN \u62a5\u6587\uff0c\u5e76\u8fd4\u56de ACK \u540e\uff0c\u4e3b\u52a8\u65b9\u7684\u8fde\u63a5\u8fdb\u5165 TIME_WAIT \u72b6\u6001\u3002\u8fd9\u4e00\u72b6\u6001\u4f1a\u6301\u7eed 1 \u5206\u949f\uff0c\u4e3a\u4e86\u9632\u6b62 TIME_WAIT \u72b6\u6001\u5360\u7528\u592a\u591a\u7684\u8d44\u6e90\uff0c<code>tcp_max_tw_buckets</code> \u5b9a\u4e49\u4e86\u6700\u5927\u6570\u91cf\uff0c\u8d85\u8fc7\u65f6\u8fde\u63a5\u4e5f\u4f1a\u76f4\u63a5\u91ca\u653e\u3002</p> <p>\u5f53 TIME_WAIT \u72b6\u6001\u8fc7\u591a\u65f6\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e <code>tcp_tw_reuse</code> \u548c <code>tcp_timestamps</code> \u4e3a 1\uff0c\u5c06 TIME_WAIT \u72b6\u6001\u7684\u7aef\u53e3\u590d\u7528\u4e8e\u4f5c\u4e3a\u5ba2\u6237\u7aef\u7684\u65b0\u8fde\u63a5\uff0c\u6ce8\u610f\u8be5\u53c2\u6570\u53ea\u9002\u7528\u4e8e\u5ba2\u6237\u7aef\u3002</p> <p>\u88ab\u52a8\u65b9\u7684\u4f18\u5316</p> <p>\u88ab\u52a8\u5173\u95ed\u7684\u8fde\u63a5\u65b9\u5e94\u5bf9\u975e\u5e38\u7b80\u5355\uff0c\u5b83\u5728\u56de\u590d ACK \u540e\u5c31\u8fdb\u5165\u4e86 CLOSE_WAIT \u72b6\u6001\uff0c\u7b49\u5f85\u8fdb\u7a0b\u8c03\u7528 close \u51fd\u6570\u5173\u95ed\u8fde\u63a5\u3002\u56e0\u6b64\uff0c\u51fa\u73b0\u5927\u91cf CLOSE_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u65f6\uff0c\u5e94\u5f53\u4ece\u5e94\u7528\u7a0b\u5e8f\u4e2d\u627e\u95ee\u9898\u3002</p> <p>\u5f53\u88ab\u52a8\u65b9\u53d1\u9001 FIN \u62a5\u6587\u540e\uff0c\u8fde\u63a5\u5c31\u8fdb\u5165 LAST_ACK \u72b6\u6001\uff0c\u5728\u672a\u7b49\u5230 ACK \u65f6\uff0c\u4f1a\u5728 <code>tcp_orphan_retries</code> \u53c2\u6570\u7684\u63a7\u5236\u4e0b\u91cd\u53d1 FIN \u62a5\u6587\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#tcp_2","title":"TCP \u4f20\u8f93\u6570\u636e\u7684\u6027\u80fd\u63d0\u5347","text":"<p>\u5728\u524d\u9762\u4ecb\u7ecd\u7684\u662f\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u7684\u4f18\u5316\u7b56\u7565\uff0c\u63a5\u4e0b\u6765\u4e3b\u8981\u4ecb\u7ecd\u7684\u662f TCP \u4f20\u8f93\u6570\u636e\u65f6\u7684\u4f18\u5316\u7b56\u7565\u3002</p> <p>TCP \u8fde\u63a5\u662f\u7531\u5185\u6838\u7ef4\u62a4\u7684\uff0c\u5185\u6838\u4f1a\u4e3a\u6bcf\u4e2a\u8fde\u63a5\u5efa\u7acb\u5185\u5b58\u7f13\u51b2\u533a\uff1a</p> <ul> <li>\u5982\u679c\u8fde\u63a5\u7684\u5185\u5b58\u914d\u7f6e\u8fc7\u5c0f\uff0c\u5c31\u65e0\u6cd5\u5145\u5206\u4f7f\u7528\u7f51\u7edc\u5e26\u5bbd\uff0cTCP \u4f20\u8f93\u6548\u7387\u5c31\u4f1a\u964d\u4f4e\uff1b</li> <li>\u5982\u679c\u8fde\u63a5\u7684\u5185\u5b58\u914d\u7f6e\u8fc7\u5927\uff0c\u5f88\u5bb9\u6613\u628a\u670d\u52a1\u5668\u8d44\u6e90\u8017\u5c3d\uff0c\u8fd9\u6837\u5c31\u4f1a\u5bfc\u81f4\u65b0\u8fde\u63a5\u65e0\u6cd5\u5efa\u7acb\uff1b</li> </ul> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u5fc5\u987b\u7406\u89e3 Linux \u4e0b TCP \u5185\u5b58\u7684\u7528\u9014\uff0c\u624d\u80fd\u6b63\u786e\u5730\u914d\u7f6e\u5185\u5b58\u5927\u5c0f\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_8","title":"\u6ed1\u52a8\u7a97\u53e3\u662f\u5982\u4f55\u5f71\u54cd\u4f20\u8f93\u901f\u5ea6\u7684\uff1f","text":"<p>TCP \u4f1a\u4fdd\u8bc1\u6bcf\u4e00\u4e2a\u62a5\u6587\u90fd\u80fd\u591f\u62b5\u8fbe\u5bf9\u65b9\uff0c\u5b83\u7684\u673a\u5236\u662f\u8fd9\u6837\uff1a\u62a5\u6587\u53d1\u51fa\u53bb\u540e\uff0c\u5fc5\u987b\u63a5\u6536\u5230\u5bf9\u65b9\u8fd4\u56de\u7684\u786e\u8ba4\u62a5\u6587 ACK\uff0c\u5982\u679c\u8fdf\u8fdf\u672a\u6536\u5230\uff0c\u5c31\u4f1a\u8d85\u65f6\u91cd\u53d1\u8be5\u62a5\u6587\uff0c\u76f4\u5230\u6536\u5230\u5bf9\u65b9\u7684 ACK \u4e3a\u6b62\u3002</p> <p>\u6240\u4ee5\uff0cTCP \u62a5\u6587\u53d1\u51fa\u53bb\u540e\uff0c\u5e76\u4e0d\u4f1a\u7acb\u9a6c\u4ece\u5185\u5b58\u4e2d\u5220\u9664\uff0c\u56e0\u4e3a\u91cd\u4f20\u65f6\u8fd8\u9700\u8981\u7528\u5230\u5b83\u3002</p> <p>\u7531\u4e8e TCP \u662f\u5185\u6838\u7ef4\u62a4\u7684\uff0c\u6240\u4ee5\u62a5\u6587\u5b58\u653e\u5728\u5185\u6838\u7f13\u51b2\u533a\u3002\u5982\u679c\u8fde\u63a5\u975e\u5e38\u591a\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7 free \u547d\u4ee4\u89c2\u5bdf\u5230 <code>buff/cache</code> \u5185\u5b58\u662f\u4f1a\u589e\u5927\u3002</p> <p>\u5982\u679c TCP \u662f\u6bcf\u53d1\u9001\u4e00\u4e2a\u6570\u636e\uff0c\u90fd\u8981\u8fdb\u884c\u4e00\u6b21\u786e\u8ba4\u5e94\u7b54\u3002\u5f53\u4e0a\u4e00\u4e2a\u6570\u636e\u5305\u6536\u5230\u4e86\u5e94\u7b54\u4e86\uff0c\u518d\u53d1\u9001\u4e0b\u4e00\u4e2a\u3002\u8fd9\u4e2a\u6a21\u5f0f\u5c31\u6709\u70b9\u50cf\u6211\u548c\u4f60\u9762\u5bf9\u9762\u804a\u5929\uff0c\u4f60\u4e00\u53e5\u6211\u4e00\u53e5\uff0c\u4f46\u8fd9\u79cd\u65b9\u5f0f\u7684\u7f3a\u70b9\u662f\u6548\u7387\u6bd4\u8f83\u4f4e\u7684\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u8fd9\u6837\u7684\u4f20\u8f93\u65b9\u5f0f\u6709\u4e00\u4e2a\u7f3a\u70b9\uff1a\u6570\u636e\u5305\u7684\u5f80\u8fd4\u65f6\u95f4\u8d8a\u957f\uff0c\u901a\u4fe1\u7684\u6548\u7387\u5c31\u8d8a\u4f4e\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\u4e0d\u96be\uff0c\u5e76\u884c\u6279\u91cf\u53d1\u9001\u62a5\u6587\uff0c\u518d\u6279\u91cf\u786e\u8ba4\u62a5\u6587\u5373\u53ef\u3002</p> <p></p> <p>\u7136\u800c\uff0c\u8fd9\u5f15\u51fa\u4e86\u53e6\u4e00\u4e2a\u95ee\u9898\uff0c\u53d1\u9001\u65b9\u53ef\u4ee5\u968f\u5fc3\u6240\u6b32\u7684\u53d1\u9001\u62a5\u6587\u5417\uff1f\u5f53\u7136\u8fd9\u4e0d\u73b0\u5b9e\uff0c\u6211\u4eec\u8fd8\u5f97\u8003\u8651\u63a5\u6536\u65b9\u7684\u5904\u7406\u80fd\u529b\u3002</p> <p>\u5f53\u63a5\u6536\u65b9\u786c\u4ef6\u4e0d\u5982\u53d1\u9001\u65b9\uff0c\u6216\u8005\u7cfb\u7edf\u7e41\u5fd9\u3001\u8d44\u6e90\u7d27\u5f20\u65f6\uff0c\u662f\u65e0\u6cd5\u77ac\u95f4\u5904\u7406\u8fd9\u4e48\u591a\u62a5\u6587\u7684\u3002\u4e8e\u662f\uff0c\u8fd9\u4e9b\u62a5\u6587\u53ea\u80fd\u88ab\u4e22\u6389\uff0c\u4f7f\u5f97\u7f51\u7edc\u6548\u7387\u975e\u5e38\u4f4e\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u79cd\u73b0\u8c61\u53d1\u751f\uff0cTCP \u63d0\u4f9b\u4e00\u79cd\u673a\u5236\u53ef\u4ee5\u8ba9\u300c\u53d1\u9001\u65b9\u300d\u6839\u636e\u300c\u63a5\u6536\u65b9\u300d\u7684\u5b9e\u9645\u63a5\u6536\u80fd\u529b\u63a7\u5236\u53d1\u9001\u7684\u6570\u636e\u91cf\uff0c\u8fd9\u5c31\u662f\u6ed1\u52a8\u7a97\u53e3\u7684\u7531\u6765\u3002</p> <p>\u63a5\u6536\u65b9\u6839\u636e\u5b83\u7684\u7f13\u51b2\u533a\uff0c\u53ef\u4ee5\u8ba1\u7b97\u51fa\u540e\u7eed\u80fd\u591f\u63a5\u6536\u591a\u5c11\u5b57\u8282\u7684\u62a5\u6587\uff0c\u8fd9\u4e2a\u6570\u5b57\u53eb\u505a\u63a5\u6536\u7a97\u53e3\u3002\u5f53\u5185\u6838\u63a5\u6536\u5230\u62a5\u6587\u65f6\uff0c\u5fc5\u987b\u7528\u7f13\u51b2\u533a\u5b58\u653e\u5b83\u4eec\uff0c\u8fd9\u6837\u5269\u4f59\u7f13\u51b2\u533a\u7a7a\u95f4\u53d8\u5c0f\uff0c\u63a5\u6536\u7a97\u53e3\u4e5f\u5c31\u53d8\u5c0f\u4e86\uff1b\u5f53\u8fdb\u7a0b\u8c03\u7528 read \u51fd\u6570\u540e\uff0c\u6570\u636e\u88ab\u8bfb\u5165\u4e86\u7528\u6237\u7a7a\u95f4\uff0c\u5185\u6838\u7f13\u51b2\u533a\u5c31\u88ab\u6e05\u7a7a\uff0c\u8fd9\u610f\u5473\u7740\u4e3b\u673a\u53ef\u4ee5\u63a5\u6536\u66f4\u591a\u7684\u62a5\u6587\uff0c\u63a5\u6536\u7a97\u53e3\u5c31\u4f1a\u53d8\u5927\u3002</p> <p>\u56e0\u6b64\uff0c\u63a5\u6536\u7a97\u53e3\u5e76\u4e0d\u662f\u6052\u5b9a\u4e0d\u53d8\u7684\uff0c\u63a5\u6536\u65b9\u4f1a\u628a\u5f53\u524d\u53ef\u63a5\u6536\u7684\u5927\u5c0f\u653e\u5728 TCP \u62a5\u6587\u5934\u90e8\u4e2d\u7684\u7a97\u53e3\u5b57\u6bb5\uff0c\u8fd9\u6837\u5c31\u53ef\u4ee5\u8d77\u5230\u7a97\u53e3\u5927\u5c0f\u901a\u77e5\u7684\u4f5c\u7528\u3002</p> <p>\u53d1\u9001\u65b9\u7684\u7a97\u53e3\u7b49\u4ef7\u4e8e\u63a5\u6536\u65b9\u7684\u7a97\u53e3\u5417\uff1f\u5982\u679c\u4e0d\u8003\u8651\u62e5\u585e\u63a7\u5236\uff0c\u53d1\u9001\u65b9\u7684\u7a97\u53e3\u5927\u5c0f\u300c\u7ea6\u7b49\u4e8e\u300d\u63a5\u6536\u65b9\u7684\u7a97\u53e3\u5927\u5c0f\uff0c\u56e0\u4e3a\u7a97\u53e3\u901a\u77e5\u62a5\u6587\u5728\u7f51\u7edc\u4f20\u8f93\u662f\u5b58\u5728\u65f6\u5ef6\u7684\uff0c\u6240\u4ee5\u662f\u7ea6\u7b49\u4e8e\u7684\u5173\u7cfb\u3002</p> <p></p> <p>\u4ece\u4e0a\u56fe\u4e2d\u53ef\u4ee5\u770b\u5230\uff0c\u7a97\u53e3\u5b57\u6bb5\u53ea\u6709 2 \u4e2a\u5b57\u8282\uff0c\u56e0\u6b64\u5b83\u6700\u591a\u80fd\u8868\u8fbe 65535 \u5b57\u8282\u5927\u5c0f\u7684\u7a97\u53e3\uff0c\u4e5f\u5c31\u662f 64KB \u5927\u5c0f\u3002</p> <p>\u8fd9\u4e2a\u7a97\u53e3\u5927\u5c0f\u6700\u5927\u503c\uff0c\u5728\u5f53\u4eca\u9ad8\u901f\u7f51\u7edc\u4e0b\uff0c\u5f88\u660e\u663e\u662f\u4e0d\u591f\u7528\u7684\u3002\u6240\u4ee5\u540e\u7eed\u6709\u4e86\u6269\u5145\u7a97\u53e3\u7684\u65b9\u6cd5\uff1a\u5728 TCP \u9009\u9879\u5b57\u6bb5\u5b9a\u4e49\u4e86\u7a97\u53e3\u6269\u5927\u56e0\u5b50\uff0c\u7528\u4e8e\u6269\u5927 TCP \u901a\u544a\u7a97\u53e3\uff0c\u5176\u503c\u5927\u5c0f\u662f 2^14\uff0c\u8fd9\u6837\u5c31\u4f7f TCP \u7684\u7a97\u53e3\u5927\u5c0f\u4ece 16 \u4f4d\u6269\u5927\u4e3a 30 \u4f4d\uff082^16 * 2^ 14 = 2^30\uff09\uff0c\u6240\u4ee5\u6b64\u65f6\u7a97\u53e3\u7684\u6700\u5927\u503c\u53ef\u4ee5\u8fbe\u5230 1GB\u3002</p> <p></p> <p>Linux \u4e2d\u6253\u5f00\u8fd9\u4e00\u529f\u80fd\uff0c\u9700\u8981\u628a tcp_window_scaling \u914d\u7f6e\u8bbe\u4e3a 1\uff08\u9ed8\u8ba4\u6253\u5f00\uff09\uff1a</p> <p></p> <p>\u8981\u4f7f\u7528\u7a97\u53e3\u6269\u5927\u9009\u9879\uff0c\u901a\u8baf\u53cc\u65b9\u5fc5\u987b\u5728\u5404\u81ea\u7684 SYN \u62a5\u6587\u4e2d\u53d1\u9001\u8fd9\u4e2a\u9009\u9879\uff1a</p> <ul> <li>\u4e3b\u52a8\u5efa\u7acb\u8fde\u63a5\u7684\u4e00\u65b9\u5728 SYN \u62a5\u6587\u4e2d\u53d1\u9001\u8fd9\u4e2a\u9009\u9879\uff1b</li> <li>\u800c\u88ab\u52a8\u5efa\u7acb\u8fde\u63a5\u7684\u4e00\u65b9\u53ea\u6709\u5728\u6536\u5230\u5e26\u7a97\u53e3\u6269\u5927\u9009\u9879\u7684 SYN \u62a5\u6587\u4e4b\u540e\u624d\u80fd\u53d1\u9001\u8fd9\u4e2a\u9009\u9879\u3002</li> </ul> <p>\u8fd9\u6837\u770b\u6765\uff0c\u53ea\u8981\u8fdb\u7a0b\u80fd\u53ca\u65f6\u5730\u8c03\u7528 read \u51fd\u6570\u8bfb\u53d6\u6570\u636e\uff0c\u5e76\u4e14\u63a5\u6536\u7f13\u51b2\u533a\u914d\u7f6e\u5f97\u8db3\u591f\u5927\uff0c\u90a3\u4e48\u63a5\u6536\u7a97\u53e3\u5c31\u53ef\u4ee5\u65e0\u9650\u5730\u653e\u5927\uff0c\u53d1\u9001\u65b9\u4e5f\u5c31\u65e0\u9650\u5730\u63d0\u5347\u53d1\u9001\u901f\u5ea6\u3002</p> <p>\u8fd9\u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u56e0\u4e3a\u7f51\u7edc\u7684\u4f20\u8f93\u80fd\u529b\u662f\u6709\u9650\u7684\uff0c\u5f53\u53d1\u9001\u65b9\u4f9d\u636e\u53d1\u9001\u7a97\u53e3\uff0c\u53d1\u9001\u8d85\u8fc7\u7f51\u7edc\u5904\u7406\u80fd\u529b\u7684\u62a5\u6587\u65f6\uff0c\u8def\u7531\u5668\u4f1a\u76f4\u63a5\u4e22\u5f03\u8fd9\u4e9b\u62a5\u6587\u3002\u56e0\u6b64\uff0c\u7f13\u51b2\u533a\u7684\u5185\u5b58\u5e76\u4e0d\u662f\u8d8a\u5927\u8d8a\u597d\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_9","title":"\u5982\u4f55\u786e\u5b9a\u6700\u5927\u4f20\u8f93\u901f\u5ea6\uff1f","text":"<p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86 TCP \u7684\u4f20\u8f93\u901f\u5ea6\uff0c\u53d7\u5236\u4e8e\u53d1\u9001\u7a97\u53e3\u4e0e\u63a5\u6536\u7a97\u53e3\uff0c\u4ee5\u53ca\u7f51\u7edc\u8bbe\u5907\u4f20\u8f93\u80fd\u529b\u3002\u5176\u4e2d\uff0c\u7a97\u53e3\u5927\u5c0f\u7531\u5185\u6838\u7f13\u51b2\u533a\u5927\u5c0f\u51b3\u5b9a\u3002\u5982\u679c\u7f13\u51b2\u533a\u4e0e\u7f51\u7edc\u4f20\u8f93\u80fd\u529b\u5339\u914d\uff0c\u90a3\u4e48\u7f13\u51b2\u533a\u7684\u5229\u7528\u7387\u5c31\u8fbe\u5230\u4e86\u6700\u5927\u5316\u3002</p> <p>\u95ee\u9898\u6765\u4e86\uff0c\u5982\u4f55\u8ba1\u7b97\u7f51\u7edc\u7684\u4f20\u8f93\u80fd\u529b\u5462\uff1f</p> <p>\u76f8\u4fe1\u5927\u5bb6\u90fd\u77e5\u9053\u7f51\u7edc\u662f\u6709\u300c\u5e26\u5bbd\u300d\u9650\u5236\u7684\uff0c\u5e26\u5bbd\u63cf\u8ff0\u7684\u662f\u7f51\u7edc\u4f20\u8f93\u80fd\u529b\uff0c\u5b83\u4e0e\u5185\u6838\u7f13\u51b2\u533a\u7684\u8ba1\u91cf\u5355\u4f4d\u4e0d\u540c\uff1a</p> <ul> <li>\u5e26\u5bbd\u662f\u5355\u4f4d\u65f6\u95f4\u5185\u7684\u6d41\u91cf\uff0c\u8868\u8fbe\u662f\u300c\u901f\u5ea6\u300d\uff0c\u6bd4\u5982\u5e38\u89c1\u7684\u5e26\u5bbd 100 MB/s\uff1b</li> <li>\u7f13\u51b2\u533a\u5355\u4f4d\u662f\u5b57\u8282\uff0c\u5f53\u7f51\u7edc\u901f\u5ea6\u4e58\u4ee5\u65f6\u95f4\u624d\u80fd\u5f97\u5230\u5b57\u8282\u6570\uff1b</li> </ul> <p>\u8fd9\u91cc\u9700\u8981\u8bf4\u4e00\u4e2a\u6982\u5ff5\uff0c\u5c31\u662f\u5e26\u5bbd\u65f6\u5ef6\u79ef\uff0c\u5b83\u51b3\u5b9a\u7f51\u7edc\u4e2d\u98de\u884c\u62a5\u6587\u7684\u5927\u5c0f\uff0c\u5b83\u7684\u8ba1\u7b97\u65b9\u5f0f\uff1a</p> <p></p> <p>\u6bd4\u5982\u6700\u5927\u5e26\u5bbd\u662f 100 MB/s\uff0c\u7f51\u7edc\u65f6\u5ef6\uff08RTT\uff09\u662f 10ms \u65f6\uff0c\u610f\u5473\u7740\u5ba2\u6237\u7aef\u5230\u670d\u52a1\u7aef\u7684\u7f51\u7edc\u4e00\u5171\u53ef\u4ee5\u5b58\u653e 100MB/s * 0.01s = 1MB \u7684\u5b57\u8282\u3002</p> <p>\u8fd9\u4e2a 1MB \u662f\u5e26\u5bbd\u548c\u65f6\u5ef6\u7684\u4e58\u79ef\uff0c\u6240\u4ee5\u5b83\u5c31\u53eb\u300c\u5e26\u5bbd\u65f6\u5ef6\u79ef\u300d\uff08\u7f29\u5199\u4e3a BDP\uff0cBandwidth Delay Product\uff09\u3002\u540c\u65f6\uff0c\u8fd9 1MB \u4e5f\u8868\u793a\u300c\u98de\u884c\u4e2d\u300d\u7684 TCP \u62a5\u6587\u5927\u5c0f\uff0c\u5b83\u4eec\u5c31\u5728\u7f51\u7edc\u7ebf\u8def\u3001\u8def\u7531\u5668\u7b49\u7f51\u7edc\u8bbe\u5907\u4e0a\u3002\u5982\u679c\u98de\u884c\u62a5\u6587\u8d85\u8fc7\u4e86 1 MB\uff0c\u5c31\u4f1a\u5bfc\u81f4\u7f51\u7edc\u8fc7\u8f7d\uff0c\u5bb9\u6613\u4e22\u5305\u3002</p> <p>\u7531\u4e8e\u53d1\u9001\u7f13\u51b2\u533a\u5927\u5c0f\u51b3\u5b9a\u4e86\u53d1\u9001\u7a97\u53e3\u7684\u4e0a\u9650\uff0c\u800c\u53d1\u9001\u7a97\u53e3\u53c8\u51b3\u5b9a\u4e86\u300c\u5df2\u53d1\u9001\u672a\u786e\u8ba4\u300d\u7684\u98de\u884c\u62a5\u6587\u7684\u4e0a\u9650\u3002\u56e0\u6b64\uff0c\u53d1\u9001\u7f13\u51b2\u533a\u4e0d\u80fd\u8d85\u8fc7\u300c\u5e26\u5bbd\u65f6\u5ef6\u79ef\u300d\u3002</p> <p>\u53d1\u9001\u7f13\u51b2\u533a\u4e0e\u5e26\u5bbd\u65f6\u5ef6\u79ef\u7684\u5173\u7cfb\uff1a</p> <ul> <li>\u5982\u679c\u53d1\u9001\u7f13\u51b2\u533a\u300c\u8d85\u8fc7\u300d\u5e26\u5bbd\u65f6\u5ef6\u79ef\uff0c\u8d85\u51fa\u7684\u90e8\u5206\u5c31\u6ca1\u529e\u6cd5\u6709\u6548\u7684\u7f51\u7edc\u4f20\u8f93\uff0c\u540c\u65f6\u5bfc\u81f4\u7f51\u7edc\u8fc7\u8f7d\uff0c\u5bb9\u6613\u4e22\u5305\uff1b</li> <li>\u5982\u679c\u53d1\u9001\u7f13\u51b2\u533a\u300c\u5c0f\u4e8e\u300d\u5e26\u5bbd\u65f6\u5ef6\u79ef\uff0c\u5c31\u4e0d\u80fd\u5f88\u597d\u7684\u53d1\u6325\u51fa\u7f51\u7edc\u7684\u4f20\u8f93\u6548\u7387\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u53d1\u9001\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u6700\u597d\u662f\u5f80\u5e26\u5bbd\u65f6\u5ef6\u79ef\u9760\u8fd1\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_10","title":"\u600e\u6837\u8c03\u6574\u7f13\u51b2\u533a\u5927\u5c0f\uff1f","text":"<p>\u5728 Linux \u4e2d\u53d1\u9001\u7f13\u51b2\u533a\u548c\u63a5\u6536\u7f13\u51b2\u90fd\u662f\u53ef\u4ee5\u7528\u53c2\u6570\u8c03\u8282\u7684\u3002\u8bbe\u7f6e\u5b8c\u540e\uff0cLinux \u4f1a\u6839\u636e\u4f60\u8bbe\u7f6e\u7684\u7f13\u51b2\u533a\u8fdb\u884c\u52a8\u6001\u8c03\u8282\u3002</p> <p>\u8c03\u8282\u53d1\u9001\u7f13\u51b2\u533a\u8303\u56f4</p> <p>\u5148\u6765\u770b\u770b\u53d1\u9001\u7f13\u51b2\u533a\uff0c\u5b83\u7684\u8303\u56f4\u901a\u8fc7 tcp_wmem \u53c2\u6570\u914d\u7f6e\uff1b</p> <p></p> <p>\u4e0a\u9762\u4e09\u4e2a\u6570\u5b57\u5355\u4f4d\u90fd\u662f\u5b57\u8282\uff0c\u5b83\u4eec\u5206\u522b\u8868\u793a\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a\u6570\u503c\u662f\u52a8\u6001\u8303\u56f4\u7684\u6700\u5c0f\u503c\uff0c4096 byte = 4K\uff1b</li> <li>\u7b2c\u4e8c\u4e2a\u6570\u503c\u662f\u521d\u59cb\u9ed8\u8ba4\u503c\uff0c16384 byte \u2248 16K\uff1b</li> <li>\u7b2c\u4e09\u4e2a\u6570\u503c\u662f\u52a8\u6001\u8303\u56f4\u7684\u6700\u5927\u503c\uff0c4194304 byte = 4096K\uff084M\uff09\uff1b</li> </ul> <p>\u53d1\u9001\u7f13\u51b2\u533a\u662f\u81ea\u884c\u8c03\u8282\u7684\uff0c\u5f53\u53d1\u9001\u65b9\u53d1\u9001\u7684\u6570\u636e\u88ab\u786e\u8ba4\u540e\uff0c\u5e76\u4e14\u6ca1\u6709\u65b0\u7684\u6570\u636e\u8981\u53d1\u9001\uff0c\u5c31\u4f1a\u628a\u53d1\u9001\u7f13\u51b2\u533a\u7684\u5185\u5b58\u91ca\u653e\u6389\u3002</p> <p>\u8c03\u8282\u63a5\u6536\u7f13\u51b2\u533a\u8303\u56f4</p> <p>\u800c\u63a5\u6536\u7f13\u51b2\u533a\u7684\u8c03\u6574\u5c31\u6bd4\u8f83\u590d\u6742\u4e00\u4e9b\uff0c\u5148\u6765\u770b\u770b\u8bbe\u7f6e\u63a5\u6536\u7f13\u51b2\u533a\u8303\u56f4\u7684 tcp_rmem \u53c2\u6570\uff1a</p> <p></p> <p>\u4e0a\u9762\u4e09\u4e2a\u6570\u5b57\u5355\u4f4d\u90fd\u662f\u5b57\u8282\uff0c\u5b83\u4eec\u5206\u522b\u8868\u793a\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a\u6570\u503c\u662f\u52a8\u6001\u8303\u56f4\u7684\u6700\u5c0f\u503c\uff0c\u8868\u793a\u5373\u4f7f\u5728\u5185\u5b58\u538b\u529b\u4e0b\u4e5f\u53ef\u4ee5\u4fdd\u8bc1\u7684\u6700\u5c0f\u63a5\u6536\u7f13\u51b2\u533a\u5927\u5c0f\uff0c4096 byte = 4K\uff1b</li> <li>\u7b2c\u4e8c\u4e2a\u6570\u503c\u662f\u521d\u59cb\u9ed8\u8ba4\u503c\uff0c87380 byte \u2248 86K\uff1b</li> <li>\u7b2c\u4e09\u4e2a\u6570\u503c\u662f\u52a8\u6001\u8303\u56f4\u7684\u6700\u5927\u503c\uff0c6291456 byte = 6144K\uff086M\uff09\uff1b</li> </ul> <p>\u63a5\u6536\u7f13\u51b2\u533a\u53ef\u4ee5\u6839\u636e\u7cfb\u7edf\u7a7a\u95f2\u5185\u5b58\u7684\u5927\u5c0f\u6765\u8c03\u8282\u63a5\u6536\u7a97\u53e3\uff1a</p> <ul> <li>\u5982\u679c\u7cfb\u7edf\u7684\u7a7a\u95f2\u5185\u5b58\u5f88\u591a\uff0c\u5c31\u53ef\u4ee5\u81ea\u52a8\u628a\u7f13\u51b2\u533a\u589e\u5927\u4e00\u4e9b\uff0c\u8fd9\u6837\u4f20\u7ed9\u5bf9\u65b9\u7684\u63a5\u6536\u7a97\u53e3\u4e5f\u4f1a\u53d8\u5927\uff0c\u56e0\u800c\u63d0\u5347\u53d1\u9001\u65b9\u53d1\u9001\u7684\u4f20\u8f93\u6570\u636e\u6570\u91cf\uff1b</li> <li>\u53cd\u4e4b\uff0c\u5982\u679c\u7cfb\u7edf\u7684\u5185\u5b58\u5f88\u7d27\u5f20\uff0c\u5c31\u4f1a\u51cf\u5c11\u7f13\u51b2\u533a\uff0c\u8fd9\u867d\u7136\u4f1a\u964d\u4f4e\u4f20\u8f93\u6548\u7387\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u66f4\u591a\u7684\u5e76\u53d1\u8fde\u63a5\u6b63\u5e38\u5de5\u4f5c\uff1b</li> </ul> <p>\u53d1\u9001\u7f13\u51b2\u533a\u7684\u8c03\u8282\u529f\u80fd\u662f\u81ea\u52a8\u5f00\u542f\u7684\uff0c\u800c\u63a5\u6536\u7f13\u51b2\u533a\u5219\u9700\u8981\u914d\u7f6e tcp_moderate_rcvbuf \u4e3a 1 \u6765\u5f00\u542f\u8c03\u8282\u529f\u80fd\uff1a</p> <p></p> <p>\u8c03\u8282 TCP \u5185\u5b58\u8303\u56f4</p> <p>\u63a5\u6536\u7f13\u51b2\u533a\u8c03\u8282\u65f6\uff0c\u600e\u4e48\u77e5\u9053\u5f53\u524d\u5185\u5b58\u662f\u5426\u7d27\u5f20\u6216\u5145\u5206\u5462\uff1f\u8fd9\u662f\u901a\u8fc7 tcp_mem \u914d\u7f6e\u5b8c\u6210\u7684\uff1a</p> <p></p> <p>\u4e0a\u9762\u4e09\u4e2a\u6570\u5b57\u5355\u4f4d\u4e0d\u662f\u5b57\u8282\uff0c\u800c\u662f\u300c\u9875\u9762\u5927\u5c0f\u300d\uff0c1 \u9875\u8868\u793a 4KB\uff0c\u5b83\u4eec\u5206\u522b\u8868\u793a\uff1a</p> <ul> <li>\u5f53 TCP \u5185\u5b58\u5c0f\u4e8e\u7b2c 1 \u4e2a\u503c\u65f6\uff0c\u4e0d\u9700\u8981\u8fdb\u884c\u81ea\u52a8\u8c03\u8282\uff1b</li> <li>\u5728\u7b2c 1 \u548c\u7b2c 2 \u4e2a\u503c\u4e4b\u95f4\u65f6\uff0c\u5185\u6838\u5f00\u59cb\u8c03\u8282\u63a5\u6536\u7f13\u51b2\u533a\u7684\u5927\u5c0f\uff1b</li> <li>\u5927\u4e8e\u7b2c 3 \u4e2a\u503c\u65f6\uff0c\u5185\u6838\u4e0d\u518d\u4e3a TCP \u5206\u914d\u65b0\u5185\u5b58\uff0c\u6b64\u65f6\u65b0\u8fde\u63a5\u662f\u65e0\u6cd5\u5efa\u7acb\u7684\uff1b</li> </ul> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\u8fd9\u4e9b\u503c\u662f\u5728\u7cfb\u7edf\u542f\u52a8\u65f6\u6839\u636e\u7cfb\u7edf\u5185\u5b58\u6570\u91cf\u8ba1\u7b97\u5f97\u5230\u7684\u3002\u6839\u636e\u5f53\u524d tcp_mem \u6700\u5927\u5185\u5b58\u9875\u9762\u6570\u662f 177120\uff0c\u5f53\u5185\u5b58\u4e3a (177120 * 4) / 1024K \u2248 692M \u65f6\uff0c\u7cfb\u7edf\u5c06\u65e0\u6cd5\u4e3a\u65b0\u7684 TCP \u8fde\u63a5\u5206\u914d\u5185\u5b58\uff0c\u5373 TCP \u8fde\u63a5\u5c06\u88ab\u62d2\u7edd\u3002</p> <p>\u6839\u636e\u5b9e\u9645\u573a\u666f\u8c03\u8282\u7684\u7b56\u7565</p> <p>\u5728\u9ad8\u5e76\u53d1\u670d\u52a1\u5668\u4e2d\uff0c\u4e3a\u4e86\u517c\u987e\u7f51\u901f\u4e0e\u5927\u91cf\u7684\u5e76\u53d1\u8fde\u63a5\uff0c\u6211\u4eec\u5e94\u5f53\u4fdd\u8bc1\u7f13\u51b2\u533a\u7684\u52a8\u6001\u8c03\u6574\u7684\u6700\u5927\u503c\u8fbe\u5230\u5e26\u5bbd\u65f6\u5ef6\u79ef\uff0c\u800c\u6700\u5c0f\u503c\u4fdd\u6301\u9ed8\u8ba4\u7684 4K \u4e0d\u53d8\u5373\u53ef\u3002\u800c\u5bf9\u4e8e\u5185\u5b58\u7d27\u5f20\u7684\u670d\u52a1\u800c\u8a00\uff0c\u8c03\u4f4e\u9ed8\u8ba4\u503c\u662f\u63d0\u9ad8\u5e76\u53d1\u7684\u6709\u6548\u624b\u6bb5\u3002</p> <p>\u540c\u65f6\uff0c\u5982\u679c\u8fd9\u662f\u7f51\u7edc IO \u578b\u670d\u52a1\u5668\uff0c\u90a3\u4e48\uff0c\u8c03\u5927 tcp_mem \u7684\u4e0a\u9650\u53ef\u4ee5\u8ba9 TCP \u8fde\u63a5\u4f7f\u7528\u66f4\u591a\u7684\u7cfb\u7edf\u5185\u5b58\uff0c\u8fd9\u6709\u5229\u4e8e\u63d0\u5347\u5e76\u53d1\u80fd\u529b\u3002\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0ctcp_wmem \u548c tcp_rmem \u7684\u5355\u4f4d\u662f\u5b57\u8282\uff0c\u800c tcp_mem \u7684\u5355\u4f4d\u662f\u9875\u9762\u5927\u5c0f\u3002\u800c\u4e14\uff0c\u5343\u4e07\u4e0d\u8981\u5728 socket \u4e0a\u76f4\u63a5\u8bbe\u7f6e SO_SNDBUF \u6216\u8005 SO_RCVBUF\uff0c\u8fd9\u6837\u4f1a\u5173\u95ed\u7f13\u51b2\u533a\u7684\u52a8\u6001\u8c03\u6574\u529f\u80fd\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_11","title":"\u5c0f\u7ed3","text":"<p>\u672c\u8282\u9488\u5bf9 TCP \u4f18\u5316\u6570\u636e\u4f20\u8f93\u7684\u65b9\u5f0f\uff0c\u505a\u4e86\u4e00\u4e9b\u4ecb\u7ecd\u3002</p> <p></p> <p>TCP \u53ef\u9760\u6027\u662f\u901a\u8fc7 ACK \u786e\u8ba4\u62a5\u6587\u5b9e\u73b0\u7684\uff0c\u53c8\u4f9d\u8d56\u6ed1\u52a8\u7a97\u53e3\u63d0\u5347\u4e86\u53d1\u9001\u901f\u5ea6\u4e5f\u517c\u987e\u4e86\u63a5\u6536\u65b9\u7684\u5904\u7406\u80fd\u529b\u3002</p> <p>\u53ef\u662f\uff0c\u9ed8\u8ba4\u7684\u6ed1\u52a8\u7a97\u53e3\u6700\u5927\u503c\u53ea\u6709 64 KB\uff0c\u4e0d\u6ee1\u8db3\u5f53\u4eca\u7684\u9ad8\u901f\u7f51\u7edc\u7684\u8981\u6c42\uff0c\u8981\u60f3\u63d0\u5347\u53d1\u9001\u901f\u5ea6\u5fc5\u987b\u63d0\u5347\u6ed1\u52a8\u7a97\u53e3\u7684\u4e0a\u9650\uff0c\u5728 Linux \u4e0b\u662f\u901a\u8fc7\u8bbe\u7f6e <code>tcp_window_scaling</code> \u4e3a 1 \u505a\u5230\u7684\uff0c\u6b64\u65f6\u6700\u5927\u503c\u53ef\u9ad8\u8fbe 1GB\u3002</p> <p>\u6ed1\u52a8\u7a97\u53e3\u5b9a\u4e49\u4e86\u7f51\u7edc\u4e2d\u98de\u884c\u62a5\u6587\u7684\u6700\u5927\u5b57\u8282\u6570\uff0c\u5f53\u5b83\u8d85\u8fc7\u5e26\u5bbd\u65f6\u5ef6\u79ef\u65f6\uff0c\u7f51\u7edc\u8fc7\u8f7d\uff0c\u5c31\u4f1a\u53d1\u751f\u4e22\u5305\u3002\u800c\u5f53\u5b83\u5c0f\u4e8e\u5e26\u5bbd\u65f6\u5ef6\u79ef\u65f6\uff0c\u5c31\u65e0\u6cd5\u5145\u5206\u5229\u7528\u7f51\u7edc\u5e26\u5bbd\u3002\u56e0\u6b64\uff0c\u6ed1\u52a8\u7a97\u53e3\u7684\u8bbe\u7f6e\uff0c\u5fc5\u987b\u53c2\u8003\u5e26\u5bbd\u65f6\u5ef6\u79ef\u3002</p> <p>\u5185\u6838\u7f13\u51b2\u533a\u51b3\u5b9a\u4e86\u6ed1\u52a8\u7a97\u53e3\u7684\u4e0a\u9650\uff0c\u7f13\u51b2\u533a\u53ef\u5206\u4e3a\uff1a\u53d1\u9001\u7f13\u51b2\u533a tcp_wmem \u548c\u63a5\u6536\u7f13\u51b2\u533a tcp_rmem\u3002</p> <p>Linux \u4f1a\u5bf9\u7f13\u51b2\u533a\u52a8\u6001\u8c03\u8282\uff0c\u6211\u4eec\u5e94\u8be5\u628a\u7f13\u51b2\u533a\u7684\u4e0a\u9650\u8bbe\u7f6e\u4e3a\u5e26\u5bbd\u65f6\u5ef6\u79ef\u3002\u53d1\u9001\u7f13\u51b2\u533a\u7684\u8c03\u8282\u529f\u80fd\u662f\u81ea\u52a8\u6253\u5f00\u7684\uff0c\u800c\u63a5\u6536\u7f13\u51b2\u533a\u9700\u8981\u628a tcp_moderate_rcvbuf \u8bbe\u7f6e\u4e3a 1 \u6765\u5f00\u542f\u3002\u5176\u4e2d\uff0c\u8c03\u8282\u7684\u4f9d\u636e\u662f TCP \u5185\u5b58\u8303\u56f4 tcp_mem\u3002</p> <p>\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u5982\u679c\u7a0b\u5e8f\u4e2d\u7684 socket \u8bbe\u7f6e SO_SNDBUF \u548c SO_RCVBUF\uff0c\u5219\u4f1a\u5173\u95ed\u7f13\u51b2\u533a\u7684\u52a8\u6001\u6574\u529f\u80fd\uff0c\u6240\u4ee5\u4e0d\u5efa\u8bae\u5728\u7a0b\u5e8f\u8bbe\u7f6e\u5b83\u4fe9\uff0c\u800c\u662f\u4ea4\u7ed9\u5185\u6838\u81ea\u52a8\u8c03\u6574\u6bd4\u8f83\u597d\u3002</p> <p>\u6709\u6548\u914d\u7f6e\u8fd9\u4e9b\u53c2\u6570\u540e\uff0c\u65e2\u80fd\u591f\u6700\u5927\u7a0b\u5ea6\u5730\u4fdd\u6301\u5e76\u53d1\u6027\uff0c\u4e5f\u80fd\u8ba9\u8d44\u6e90\u5145\u88d5\u65f6\u8fde\u63a5\u4f20\u8f93\u901f\u5ea6\u8fbe\u5230\u6700\u5927\u503c\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <p>[1] \u7cfb\u7edf\u6027\u80fd\u8c03\u4f18\u5fc5\u77e5\u5fc5\u4f1a\u3002\u9676\u8f89\u3002\u6781\u5ba2\u65f6\u95f4\u3002</p> <p>[2] \u7f51\u7edc\u7f16\u7a0b\u5b9e\u6218\u4e13\u680f\u3002\u76db\u5ef6\u654f\u3002\u6781\u5ba2\u65f6\u95f4\u3002</p> <p>[3] http://www.blogjava.net/yongboy/archive/2013/04/11/397677.html</p> <p>[4] http://blog.itpub.net/31559359/viewspace-2284113/</p> <p>[5] https://blog.51cto.com/professor/1909022</p> <p>[6] https://vincent.bernat.ch/en/blog/2014-tcp-time-wait-state-linux</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_optimize/#_12","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u8bfb\u8005\u95ee\uff1a\u201c\u5c0f\u6797\uff0c\u8bf7\u6559\u4e2a\u95ee\u9898\uff0csomaxconn \u548c backlog \u662f\u4e0d\u662f\u90fd\u662f\u6307\u7684\u662f accept \u961f\u5217\uff1f\u7136\u540e somaxconn \u662f\u5185\u6838\u53c2\u6570\uff0cbacklog \u662f\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u95f4\u9694\u5730\u4fee\u6539 somaxconn\uff0c\u6bd4\u5982 Linux \u4e2d listen() \u51fd\u6570\uff1f\u201d</p> <p>\u4e24\u8005\u53d6\u6700\u5c0f\u503c\u624d\u662f accpet \u961f\u5217\u3002</p> <p>\u8bfb\u8005\u95ee\uff1a\u201c\u5c0f\u6797\uff0c\u8fd8\u6709\u4e2a\u95ee\u9898\u8981\u8bf7\u6559\u4e0b\uff0c\u201c\u5982\u679c accept \u961f\u5217\u6ee1\u4e86\uff0c\u90a3\u4e48 server \u6254\u6389 client  \u53d1\u8fc7\u6765\u7684 ack\u201d\uff0c\u4e5f\u5c31\u662f\u8bf4\u8be5 TCP \u8fde\u63a5\u8fd8\u662f\u4f4d\u4e8e\u534a\u8fde\u63a5\u961f\u5217\u4e2d\uff0c\u6ca1\u6709\u4e22\u5f03\u5417\uff1f\u201d</p> <ol> <li>\u5f53 accept \u961f\u5217\u6ee1\u4e86\uff0c\u540e\u7eed\u65b0\u8fdb\u6765\u7684 syn \u5305\u90fd\u4f1a\u88ab\u4e22\u5931</li> <li>\u6211\u6587\u7ae0\u7684\u7a81\u53d1\u6d41\u91cf\u4f8b\u5b50\u662f\uff0c\u90a3\u4e2a\u8fde\u63a5\u8fdb\u6765\u7684\u65f6\u5019 accept \u961f\u5217\u8fd8\u6ca1\u6ee1\uff0c\u4f46\u662f\u5728\u7b2c\u4e09\u6b21\u63e1\u624b\u7684\u65f6\u5019\uff0caccept \u961f\u5217\u7a81\u7136\u6ee1\u4e86\uff0c\u5c31\u4f1a\u5bfc\u81f4 ack \u88ab\u4e22\u5f03\uff0c\u5c31\u4e00\u76f4\u5904\u4e8e\u534a\u8fde\u63a5\u961f\u5217\u3002</li> </ol> <p>\u5c0f\u6797\u662f\u4e13\u4e3a\u5927\u5bb6\u56fe\u89e3\u7684\u5de5\u5177\u4eba\uff0cGoodbye\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_problem/","title":"4.16 TCP \u534f\u8bae\u6709\u4ec0\u4e48\u7f3a\u9677\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u5199\u7684\u591a\u4e86\u540e\uff0c\u5ffd\u7136\u601d\u8003\u4e00\u4e2a\u95ee\u9898\uff0cTCP \u901a\u8fc7\u5e8f\u5217\u53f7\u3001\u786e\u8ba4\u5e94\u7b54\u3001\u8d85\u65f6\u91cd\u4f20\u3001\u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236\u7b49\u65b9\u5f0f\u5b9e\u73b0\u4e86\u53ef\u9760\u4f20\u8f93\uff0c\u770b\u8d77\u6765\u5b83\u5f88\u5b8c\u7f8e\uff0c\u4e8b\u5b9e\u771f\u7684\u662f\u8fd9\u6837\u5417\uff1fTCP \u5c31\u6ca1\u4ec0\u4e48\u7f3a\u9677\u5417\uff1f</p> <p>\u6240\u4ee5\uff0c\u4eca\u5929\u5c31\u8ddf\u5927\u5bb6\u804a\u804a\uff0cTCP \u534f\u8bae\u6709\u54ea\u4e9b\u7f3a\u9677\uff1f\u4e3b\u8981\u6709\u56db\u4e2a\u65b9\u9762\uff1a</p> <ul> <li>\u5347\u7ea7 TCP \u7684\u5de5\u4f5c\u5f88\u56f0\u96be\uff1b</li> <li>TCP \u5efa\u7acb\u8fde\u63a5\u7684\u5ef6\u8fdf\uff1b</li> <li>TCP \u5b58\u5728\u961f\u5934\u963b\u585e\u95ee\u9898\uff1b</li> <li>\u7f51\u7edc\u8fc1\u79fb\u9700\u8981\u91cd\u65b0\u5efa\u7acb TCP \u8fde\u63a5\uff1b</li> </ul> <p>\u63a5\u4e0b\u6765\uff0c\u9488\u5bf9\u8fd9\u56db\u4e2a\u65b9\u9762\u8be6\u7ec6\u8bf4\u4e00\u4e0b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_problem/#tcp","title":"\u5347\u7ea7 TCP \u7684\u5de5\u4f5c\u5f88\u56f0\u96be","text":"<p>TCP \u534f\u8bae\u662f\u8bde\u751f\u5728 1973 \u5e74\uff0c\u81f3\u4eca TCP \u534f\u8bae\u4f9d\u7136\u8fd8\u5728\u5b9e\u73b0\u66f4\u591a\u7684\u65b0\u7279\u6027\u3002</p> <p>\u4f46\u662f TCP \u534f\u8bae\u662f\u5728\u5185\u6838\u4e2d\u5b9e\u73b0\u7684\uff0c\u5e94\u7528\u7a0b\u5e8f\u53ea\u80fd\u4f7f\u7528\u4e0d\u80fd\u4fee\u6539\uff0c\u5982\u679c\u8981\u60f3\u5347\u7ea7 TCP \u534f\u8bae\uff0c\u90a3\u4e48\u53ea\u80fd\u5347\u7ea7\u5185\u6838\u3002</p> <p>\u800c\u5347\u7ea7\u5185\u6838\u8fd9\u4e2a\u5de5\u4f5c\u662f\u5f88\u9ebb\u70e6\u7684\u4e8b\u60c5\uff0c\u9ebb\u70e6\u7684\u4e8b\u60c5\u4e0d\u662f\u8bf4\u5347\u7ea7\u5185\u6838\u8fd9\u4e2a\u64cd\u4f5c\u5f88\u9ebb\u70e6\uff0c\u800c\u662f\u7531\u4e8e\u5185\u6838\u5347\u7ea7\u6d89\u53ca\u5230\u5e95\u5c42\u8f6f\u4ef6\u548c\u8fd0\u884c\u5e93\u7684\u66f4\u65b0\uff0c\u6211\u4eec\u7684\u670d\u52a1\u7a0b\u5e8f\u5c31\u9700\u8981\u56de\u5f52\u6d4b\u8bd5\u662f\u5426\u517c\u5bb9\u65b0\u7684\u5185\u6838\u7248\u672c\uff0c\u6240\u4ee5\u670d\u52a1\u5668\u7684\u5185\u6838\u5347\u7ea7\u4e5f\u6bd4\u8f83\u4fdd\u5b88\u548c\u7f13\u6162\u3002</p> <p>\u5f88\u591a TCP \u534f\u8bae\u7684\u65b0\u7279\u6027\uff0c\u90fd\u662f\u9700\u8981\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u540c\u65f6\u652f\u6301\u624d\u80fd\u751f\u6548\u7684\uff0c\u6bd4\u5982  TCP Fast Open \u8fd9\u4e2a\u7279\u6027\uff0c\u867d\u7136\u5728 2013 \u5e74\u5c31\u88ab\u63d0\u51fa\u4e86\uff0c\u4f46\u662f Windows \u5f88\u591a\u7cfb\u7edf\u7248\u672c\u4f9d\u7136\u4e0d\u652f\u6301\u5b83\uff0c\u8fd9\u662f\u56e0\u4e3a PC \u7aef\u7684\u7cfb\u7edf\u5347\u7ea7\u6ede\u540e\u5f88\u4e25\u91cd\uff0cW indows Xp \u73b0\u5728\u8fd8\u6709\u5927\u91cf\u7528\u6237\u5728\u4f7f\u7528\uff0c\u5c3d\u7ba1\u5b83\u5df2\u7ecf\u5b58\u5728\u5feb 20 \u5e74\u3002</p> <p>\u6240\u4ee5\uff0c\u5373\u4f7f TCP \u6709\u6bd4\u8f83\u597d\u7684\u7279\u6027\u66f4\u65b0\uff0c\u4e5f\u5f88\u96be\u5feb\u901f\u63a8\u5e7f\uff0c\u7528\u6237\u5f80\u5f80\u8981\u51e0\u5e74\u6216\u8005\u5341\u5e74\u624d\u80fd\u4f53\u9a8c\u5230\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_problem/#tcp_1","title":"TCP \u5efa\u7acb\u8fde\u63a5\u7684\u5ef6\u8fdf","text":"<p>\u57fa\u4e8e TCP \u5b9e\u73b0\u7684\u5e94\u7528\u534f\u8bae\uff0c\u90fd\u662f\u9700\u8981\u5148\u5efa\u7acb\u4e09\u6b21\u63e1\u624b\u624d\u80fd\u8fdb\u884c\u6570\u636e\u4f20\u8f93\uff0c\u6bd4\u5982 HTTP 1.0/1.1\u3001HTTP/2\u3001HTTPS\u3002</p> <p>\u73b0\u5728\u5927\u591a\u6570\u7f51\u7ad9\u90fd\u662f\u4f7f\u7528 HTTPS \u7684\uff0c\u8fd9\u610f\u5473\u7740\u5728 TCP \u4e09\u6b21\u63e1\u624b\u4e4b\u540e\uff0c\u8fd8\u9700\u8981\u7ecf\u8fc7 TLS \u56db\u6b21\u63e1\u624b\u540e\uff0c\u624d\u80fd\u8fdb\u884c HTTP \u6570\u636e\u7684\u4f20\u8f93\uff0c\u8fd9\u5728\u4e00\u5b9a\u7a0b\u5e8f\u4e0a\u589e\u52a0\u4e86\u6570\u636e\u4f20\u8f93\u7684\u5ef6\u8fdf\u3002</p> <p>TCP \u4e09\u6b21\u63e1\u624b\u548c TLS \u63e1\u624b\u5ef6\u8fdf\uff0c\u5982\u56fe\uff1a</p> <p></p> <p>TCP \u4e09\u6b21\u63e1\u624b\u7684\u5ef6\u8fdf\u88ab TCP Fast Open\uff08\u5feb\u901f\u6253\u5f00\uff09\u8fd9\u4e2a\u7279\u6027\u89e3\u51b3\u4e86\uff0c\u8fd9\u4e2a\u7279\u6027\u53ef\u4ee5\u5728\u300c\u7b2c\u4e8c\u6b21\u5efa\u7acb\u8fde\u63a5\u300d\u65f6\u51cf\u5c11 TCP \u8fde\u63a5\u5efa\u7acb\u7684\u65f6\u5ef6\u3002</p> <p></p> <p>\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5728\u7b2c\u4e00\u6b21\u5efa\u7acb\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u5728\u7b2c\u4e8c\u6b21\u63e1\u624b\u4ea7\u751f\u4e00\u4e2a <code>Cookie</code> \uff08\u5df2\u52a0\u5bc6\uff09\u5e76\u901a\u8fc7 SYN\u3001ACK \u5305\u4e00\u8d77\u53d1\u7ed9\u5ba2\u6237\u7aef\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u5c31\u4f1a\u7f13\u5b58\u8fd9\u4e2a <code>Cookie</code>\uff0c\u6240\u4ee5\u7b2c\u4e00\u6b21\u53d1\u8d77 HTTP Get \u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u9700\u8981 2 \u4e2a RTT \u7684\u65f6\u5ef6\uff1b</li> <li>\u5728\u4e0b\u6b21\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u5728 SYN \u5305\u5e26\u4e0a <code>Cookie</code> \u53d1\u7ed9\u670d\u52a1\u7aef\uff0c\u5c31\u63d0\u524d\u53ef\u4ee5\u8df3\u8fc7\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\uff0c\u56e0\u4e3a <code>Cookie</code> \u4e2d\u7ef4\u62a4\u4e86\u4e00\u4e9b\u4fe1\u606f\uff0c\u670d\u52a1\u7aef\u53ef\u4ee5\u4ece <code>Cookie</code> \u83b7\u53d6 TCP \u76f8\u5173\u7684\u4fe1\u606f\uff0c\u8fd9\u65f6\u53d1\u8d77\u7684 HTTP GET \u8bf7\u6c42\u5c31\u53ea\u9700\u8981 1 \u4e2a RTT \u7684\u65f6\u5ef6\uff1b</li> </ul> <p>TCP Fast Open \u8fd9\u4e2a\u7279\u6027\u662f\u4e0d\u9519\uff0c\u4f46\u662f\u5b83\u9700\u8981\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u7684\u64cd\u4f5c\u7cfb\u7edf\u540c\u65f6\u652f\u6301\u624d\u80fd\u4f53\u9a8c\u5230\uff0c\u800c TCP Fast Open \u662f\u5728 2013 \u5e74\u63d0\u51fa\u7684\uff0c\u6240\u4ee5\u5e02\u9762\u4e0a\u4f9d\u7136\u6709\u5f88\u591a\u8001\u5f0f\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u652f\u6301\uff0c\u800c\u5347\u7ea7\u64cd\u4f5c\u7cfb\u7edf\u662f\u5f88\u9ebb\u70e6\u7684\u4e8b\u60c5\uff0c\u56e0\u6b64  TCP Fast Open \u5f88\u96be\u88ab\u666e\u53ca\u5f00\u6765\u3002</p> <p>\u8fd8\u6709\u4e00\u70b9\uff0c\u9488\u5bf9 HTTPS \u6765\u8bf4\uff0cTLS \u662f\u5728\u5e94\u7528\u5c42\u5b9e\u73b0\u7684\u63e1\u624b\uff0c\u800c TCP \u662f\u5728\u5185\u6838\u5b9e\u73b0\u7684\u63e1\u624b\uff0c\u8fd9\u4e24\u4e2a\u63e1\u624b\u8fc7\u7a0b\u662f\u65e0\u6cd5\u7ed3\u5408\u5728\u4e00\u8d77\u7684\uff0c\u603b\u662f\u5f97\u5148\u5b8c\u6210 TCP \u63e1\u624b\uff0c\u624d\u80fd\u8fdb\u884c TLS \u63e1\u624b\u3002</p> <p>\u4e5f\u6b63\u662f TCP \u662f\u5728\u5185\u6838\u5b9e\u73b0\u7684\uff0c\u6240\u4ee5 TLS \u662f\u65e0\u6cd5\u5bf9 TCP \u5934\u90e8\u52a0\u5bc6\u7684\uff0c\u8fd9\u610f\u5473\u7740 TCP \u7684\u5e8f\u5217\u53f7\u90fd\u662f\u660e\u6587\u4f20\u8f93\uff0c\u6240\u4ee5\u5c31\u5b58\u5b89\u5168\u7684\u95ee\u9898\u3002</p> <p>\u4e00\u4e2a\u5178\u578b\u7684\u4f8b\u5b50\u5c31\u662f\u653b\u51fb\u8005\u4f2a\u9020\u4e00\u4e2a\u7684 RST \u62a5\u6587\u5f3a\u5236\u5173\u95ed\u4e00\u6761 TCP \u8fde\u63a5\uff0c\u800c\u653b\u51fb\u6210\u529f\u7684\u5173\u952e\u5219\u662f TCP \u5b57\u6bb5\u91cc\u7684\u5e8f\u5217\u53f7\u4f4d\u4e8e\u63a5\u6536\u65b9\u7684\u6ed1\u52a8\u7a97\u53e3\u5185\uff0c\u8be5\u62a5\u6587\u5c31\u662f\u5408\u6cd5\u7684\u3002</p> <p>\u4e3a\u6b64 TCP \u4e5f\u4e0d\u5f97\u4e0d\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\u6765\u540c\u6b65\u5404\u81ea\u7684\u5e8f\u5217\u53f7\uff0c\u800c\u4e14\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u65f6\u662f\u91c7\u7528\u968f\u673a\u7684\u65b9\u5f0f\uff08\u4e0d\u5b8c\u5168\u968f\u673a\uff0c\u800c\u662f\u968f\u7740\u65f6\u95f4\u6d41\u901d\u800c\u7ebf\u6027\u589e\u957f\uff0c\u5230\u4e86 2^32 \u5c3d\u5934\u518d\u56de\u6eda\uff09\u6765\u63d0\u5347\u653b\u51fb\u8005\u731c\u6d4b\u5e8f\u5217\u53f7\u7684\u96be\u5ea6\uff0c\u4ee5\u589e\u52a0\u5b89\u5168\u6027\u3002</p> <p>\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u53ea\u80fd\u907f\u514d\u653b\u51fb\u8005\u9884\u6d4b\u51fa\u5408\u6cd5\u7684 RST \u62a5\u6587\uff0c\u800c\u65e0\u6cd5\u907f\u514d\u653b\u51fb\u8005\u622a\u83b7\u5ba2\u6237\u7aef\u7684\u62a5\u6587\uff0c\u7136\u540e\u4e2d\u9014\u4f2a\u9020\u51fa\u5408\u6cd5 RST \u62a5\u6587\u7684\u653b\u51fb\u7684\u65b9\u5f0f\u3002</p> <p></p> <p>\u5927\u80c6\u60f3\u4e00\u4e0b\uff0c\u5982\u679c TCP \u7684\u5e8f\u5217\u53f7\u4e5f\u80fd\u88ab\u52a0\u5bc6\uff0c\u6216\u8bb8\u771f\u7684\u4e0d\u9700\u8981\u4e09\u6b21\u63e1\u624b\u4e86\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u90fd\u4ece 0 \u5f00\u59cb\uff0c\u4e5f\u5c31\u4e0d\u7528\u505a\u540c\u6b65\u5e8f\u5217\u53f7\u7684\u5de5\u4f5c\u4e86\uff0c\u4f46\u662f\u8981\u5b9e\u73b0\u8fd9\u4e2a\u8981\u6539\u9020\u6574\u4e2a\u534f\u8bae\u6808\uff0c\u592a\u8fc7\u4e8e\u9ebb\u70e6\uff0c\u5373\u4f7f\u5b9e\u73b0\u51fa\u6765\u4e86\uff0c\u5f88\u591a\u8001\u7684\u7f51\u7edc\u8bbe\u5907\u672a\u5fc5\u80fd\u517c\u5bb9\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_problem/#tcp_2","title":"TCP \u5b58\u5728\u961f\u5934\u963b\u585e\u95ee\u9898","text":"<p>TCP \u662f\u5b57\u8282\u6d41\u534f\u8bae\uff0cTCP \u5c42\u5fc5\u987b\u4fdd\u8bc1\u6536\u5230\u7684\u5b57\u8282\u6570\u636e\u662f\u5b8c\u6574\u4e14\u6709\u5e8f\u7684\uff0c\u5982\u679c\u5e8f\u5217\u53f7\u8f83\u4f4e\u7684 TCP \u6bb5\u5728\u7f51\u7edc\u4f20\u8f93\u4e2d\u4e22\u5931\u4e86\uff0c\u5373\u4f7f\u5e8f\u5217\u53f7\u8f83\u9ad8\u7684 TCP \u6bb5\u5df2\u7ecf\u88ab\u63a5\u6536\u4e86\uff0c\u5e94\u7528\u5c42\u4e5f\u65e0\u6cd5\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u5230\u8fd9\u90e8\u5206\u6570\u636e\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u56fe\u4e2d\u53d1\u9001\u65b9\u53d1\u9001\u4e86\u5f88\u591a\u4e2a packet\uff0c\u6bcf\u4e2a packet \u90fd\u6709\u81ea\u5df1\u7684\u5e8f\u53f7\uff0c\u4f60\u53ef\u4ee5\u8ba4\u4e3a\u662f TCP \u7684\u5e8f\u5217\u53f7\uff0c\u5176\u4e2d <code>packet #3</code> \u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u4e86\uff0c\u5373\u4f7f <code>packet #4-6</code> \u88ab\u63a5\u6536\u65b9\u6536\u5230\u540e\uff0c\u7531\u4e8e\u5185\u6838\u4e2d\u7684 TCP \u6570\u636e\u4e0d\u662f\u8fde\u7eed\u7684\uff0c\u4e8e\u662f\u63a5\u6536\u65b9\u7684\u5e94\u7528\u5c42\u5c31\u65e0\u6cd5\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u5230\uff0c\u53ea\u6709\u7b49\u5230 <code>packet #3</code> \u91cd\u4f20\u540e\uff0c\u63a5\u6536\u65b9\u7684\u5e94\u7528\u5c42\u624d\u53ef\u4ee5\u4ece\u5185\u6838\u4e2d\u8bfb\u53d6\u5230\u6570\u636e\u3002</p> <p>\u8fd9\u5c31\u662f TCP \u961f\u5934\u963b\u585e\u95ee\u9898\uff0c\u4f46\u8fd9\u4e5f\u4e0d\u80fd\u602a TCP\uff0c\u56e0\u4e3a\u53ea\u6709\u8fd9\u6837\u505a\u624d\u80fd\u4fdd\u8bc1\u6570\u636e\u7684\u6709\u5e8f\u6027\u3002</p> <p>HTTP/2 \u591a\u4e2a\u8bf7\u6c42\u662f\u8dd1\u5728\u4e00\u4e2a TCP \u8fde\u63a5\u4e2d\u7684\uff0c\u90a3\u4e48\u5f53 TCP \u4e22\u5305\u65f6\uff0c\u6574\u4e2a TCP \u90fd\u8981\u7b49\u5f85\u91cd\u4f20\uff0c\u90a3\u4e48\u5c31\u4f1a\u963b\u585e\u8be5 TCP \u8fde\u63a5\u4e2d\u7684\u6240\u6709\u8bf7\u6c42\uff0c\u6240\u4ee5 HTTP/2 \u961f\u5934\u963b\u585e\u95ee\u9898\u5c31\u662f\u56e0\u4e3a TCP \u534f\u8bae\u5bfc\u81f4\u7684\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_problem/#tcp_3","title":"\u7f51\u7edc\u8fc1\u79fb\u9700\u8981\u91cd\u65b0\u5efa\u7acb TCP \u8fde\u63a5","text":"<p>\u57fa\u4e8e TCP \u4f20\u8f93\u534f\u8bae\u7684 HTTP \u534f\u8bae\uff0c\u7531\u4e8e\u662f\u901a\u8fc7\u56db\u5143\u7ec4\uff08\u6e90 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684 IP\u3001\u76ee\u7684\u7aef\u53e3\uff09\u786e\u5b9a\u4e00\u6761 TCP \u8fde\u63a5\u3002</p> <p></p> <p>\u90a3\u4e48\u5f53\u79fb\u52a8\u8bbe\u5907\u7684\u7f51\u7edc\u4ece 4G \u5207\u6362\u5230 WIFI \u65f6\uff0c\u610f\u5473\u7740 IP \u5730\u5740\u53d8\u5316\u4e86\uff0c\u90a3\u4e48\u5c31\u5fc5\u987b\u8981\u65ad\u5f00\u8fde\u63a5\uff0c\u7136\u540e\u91cd\u65b0\u5efa\u7acb TCP \u8fde\u63a5\u3002</p> <p>\u800c\u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\u5305\u542b TCP \u4e09\u6b21\u63e1\u624b\u548c TLS \u56db\u6b21\u63e1\u624b\u7684\u65f6\u5ef6\uff0c\u4ee5\u53ca TCP \u6162\u542f\u52a8\u7684\u51cf\u901f\u8fc7\u7a0b\uff0c\u7ed9\u7528\u6237\u7684\u611f\u89c9\u5c31\u662f\u7f51\u7edc\u7a81\u7136\u5361\u987f\u4e86\u4e00\u4e0b\uff0c\u56e0\u6b64\u8fde\u63a5\u7684\u8fc1\u79fb\u6210\u672c\u662f\u5f88\u9ad8\u7684\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_problem/#_1","title":"\u7ed3\u5c3e","text":"<p>\u6211\u8bb0\u5f97\u4e4b\u524d\u5728\u7fa4\u91cc\u770b\u5230\uff0c\u6709\u4f4d\u8bfb\u8005\u5b57\u8282\u4e00\u9762\u7684\u65f6\u5019\u88ab\u95ee\u5230\uff1a\u300c\u5982\u4f55\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\uff1f\u300d</p> <p>\u5f88\u591a\u540c\u5b66\u7b2c\u4e00\u53cd\u5e94\u5c31\u4f1a\u8bf4\u628a TCP \u53ef\u9760\u4f20\u8f93\u7684\u7279\u6027\uff08\u5e8f\u5217\u53f7\u3001\u786e\u8ba4\u5e94\u7b54\u3001\u8d85\u65f6\u91cd\u4f20\u3001\u6d41\u91cf\u63a7\u5236\u3001\u62e5\u585e\u63a7\u5236\uff09\u5728\u5e94\u7528\u5c42\u5b9e\u73b0\u4e00\u904d\u3002</p> <p>\u5b9e\u73b0\u7684\u601d\u8def\u786e\u5b9e\u8fd9\u6837\u6ca1\u9519\uff0c\u4f46\u662f\u6709\u6ca1\u6709\u60f3\u8fc7\uff0c\u65e2\u7136 TCP \u5929\u7136\u652f\u6301\u53ef\u9760\u4f20\u8f93\uff0c\u4e3a\u4ec0\u4e48\u8fd8\u9700\u8981\u57fa\u4e8e UDP \u5b9e\u73b0\u53ef\u9760\u4f20\u8f93\u5462\uff1f\u8fd9\u4e0d\u662f\u91cd\u590d\u9020\u8f6e\u5b50\u5417\uff1f</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u5148\u5f04\u6e05\u695a TCP \u534f\u8bae\u6709\u54ea\u4e9b\u75db\u70b9\uff1f\u800c\u8fd9\u4e9b\u75db\u70b9\u662f\u5426\u53ef\u4ee5\u5728\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u7684\u53ef\u9760\u4f20\u8f93\u534f\u8bae\u4e2d\u5f97\u5230\u6539\u8fdb\uff1f</p> <p>\u73b0\u5728\u5e02\u9762\u4e0a\u5df2\u7ecf\u6709\u57fa\u4e8e UDP \u534f\u8bae\u5b9e\u73b0\u7684\u53ef\u9760\u4f20\u8f93\u534f\u8bae\u7684\u6210\u719f\u65b9\u6848\u4e86\uff0c\u90a3\u5c31\u662f QUIC \u534f\u8bae\uff0cQUIC \u534f\u8bae\u628a\u6211\u672c\u6587\u8bf4\u7684 TCP \u7684\u7f3a\u70b9\u90fd\u7ed9\u89e3\u51b3\u4e86\uff0c\u800c\u4e14\u5df2\u7ecf\u5e94\u7528\u5728\u4e86 HTTP/3\u3002</p> <p></p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_queue/","title":"4.4 TCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217","text":"<p>\u7f51\u4e0a\u8bb8\u591a\u535a\u5ba2\u9488\u5bf9\u589e\u5927 TCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u7684\u65b9\u5f0f\u5982\u4e0b\uff1a</p> <ul> <li>\u589e\u5927 TCP \u534a\u8fde\u63a5\u961f\u5217\u7684\u65b9\u5f0f\u662f\u589e\u5927 /proc/sys/net/ipv4/tcp_max_syn_backlog\uff1b</li> <li>\u589e\u5927 TCP \u5168\u8fde\u63a5\u961f\u5217\u7684\u65b9\u5f0f\u662f\u589e\u5927 listen() \u51fd\u6570\u4e2d\u7684 backlog\uff1b</li> </ul> <p>\u8fd9\u91cc\u5148\u8ddf\u5927\u5bb6\u8bf4\u4e0b\uff0c\u4e0a\u9762\u7684\u65b9\u5f0f\u90fd\u662f\u4e0d\u51c6\u786e\u7684\u3002</p> <p>\u201c\u4f60\u600e\u4e48\u77e5\u9053\u4e0d\u51c6\u786e\uff1f\u201d</p> <p>\u5f88\u7b80\u5355\u5440\uff0c\u56e0\u4e3a\u6211\u505a\u4e86\u5b9e\u9a8c\u548c\u770b\u4e86 TCP \u534f\u8bae\u6808\u7684\u5185\u6838\u6e90\u7801\uff0c\u53d1\u73b0\u8981\u589e\u5927\u8fd9\u4e24\u4e2a\u961f\u5217\u957f\u5ea6\uff0c\u4e0d\u662f\u7b80\u7b80\u5355\u5355\u589e\u5927\u67d0\u4e00\u4e2a\u53c2\u6570\u5c31\u53ef\u4ee5\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u5c31\u4f1a\u4ee5\u5b9e\u6218 + \u6e90\u7801\u5206\u6790\uff0c\u5e26\u5927\u5bb6\u89e3\u5bc6 TCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u3002</p> <p>\u201c\u6e90\u7801\u5206\u6790\uff0c\u90a3\u4e0d\u662f\u529d\u9000\u5417\uff1f\u6211\u4eec\u641e Java \u7684\u770b\u4e0d\u61c2\u5440\u201d</p> <p>\u653e\u5fc3\uff0c\u672c\u6587\u7684\u6e90\u7801\u5206\u6790\u4e0d\u4f1a\u6d89\u53ca\u5f88\u6df1\u7684\u77e5\u8bc6\uff0c\u56e0\u4e3a\u90fd\u88ab\u6211\u5220\u51cf\u4e86\uff0c\u4f60\u53ea\u9700\u8981\u4f1a\u6761\u4ef6\u5224\u65ad\u8bed\u53e5 if\u3001\u5de6\u79fb\u53f3\u79fb\u64cd\u4f5c\u7b26\u3001\u52a0\u51cf\u6cd5\u7b49\u57fa\u672c\u8bed\u6cd5\uff0c\u5c31\u53ef\u4ee5\u770b\u61c2\u3002</p> <p>\u53e6\u5916\uff0c\u4e0d\u4ec5\u6709\u6e90\u7801\u5206\u6790\uff0c\u8fd8\u4f1a\u4ecb\u7ecd Linux \u6392\u67e5\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u7684\u547d\u4ee4\u3002</p> <p>\u201c\u54e6\uff1f\u4f3c\u4e4e\u5f88\u6709\u770b\u5934\uff0c\u90a3\u6211\u59d1\u4e14\u770b\u4e00\u4e0b\u5427\uff01\u201d</p> <p>\u884c\uff0c\u6ca1\u6709\u88ab\u529d\u9000\u7684\u5c0f\u4f19\u4f34\uff0c\u503c\u5f97\u9f13\u52b1\uff0c\u4e0b\u9762\u8fd9\u56fe\u662f\u672c\u6587\u7684\u63d0\u7eb2\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_queue/#tcp","title":"\u4ec0\u4e48\u662f TCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\uff1f","text":"<p>\u5728 TCP \u4e09\u6b21\u63e1\u624b\u7684\u65f6\u5019\uff0cLinux \u5185\u6838\u4f1a\u7ef4\u62a4\u4e24\u4e2a\u961f\u5217\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>\u534a\u8fde\u63a5\u961f\u5217\uff0c\u4e5f\u79f0 SYN \u961f\u5217\uff1b</li> <li>\u5168\u8fde\u63a5\u961f\u5217\uff0c\u4e5f\u79f0 accept \u961f\u5217\uff1b</li> </ul> <p>\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u53d1\u8d77\u7684 SYN \u8bf7\u6c42\u540e\uff0c\u5185\u6838\u4f1a\u628a\u8be5\u8fde\u63a5\u5b58\u50a8\u5230\u534a\u8fde\u63a5\u961f\u5217\uff0c\u5e76\u5411\u5ba2\u6237\u7aef\u54cd\u5e94 SYN+ACK\uff0c\u63a5\u7740\u5ba2\u6237\u7aef\u4f1a\u8fd4\u56de ACK\uff0c\u670d\u52a1\u7aef\u6536\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\u7684 ACK \u540e\uff0c\u5185\u6838\u4f1a\u628a\u8fde\u63a5\u4ece\u534a\u8fde\u63a5\u961f\u5217\u79fb\u9664\uff0c\u7136\u540e\u521b\u5efa\u65b0\u7684\u5b8c\u5168\u7684\u8fde\u63a5\uff0c\u5e76\u5c06\u5176\u6dfb\u52a0\u5230 accept \u961f\u5217\uff0c\u7b49\u5f85\u8fdb\u7a0b\u8c03\u7528 accept \u51fd\u6570\u65f6\u628a\u8fde\u63a5\u53d6\u51fa\u6765\u3002</p> <p></p> <p>\u4e0d\u7ba1\u662f\u534a\u8fde\u63a5\u961f\u5217\u8fd8\u662f\u5168\u8fde\u63a5\u961f\u5217\uff0c\u90fd\u6709\u6700\u5927\u957f\u5ea6\u9650\u5236\uff0c\u8d85\u8fc7\u9650\u5236\u65f6\uff0c\u5185\u6838\u4f1a\u76f4\u63a5\u4e22\u5f03\uff0c\u6216\u8fd4\u56de RST \u5305\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_queue/#-tcp","title":"\u5b9e\u6218 - TCP \u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa","text":"<p>\u5982\u4f55\u77e5\u9053\u5e94\u7528\u7a0b\u5e8f\u7684 TCP \u5168\u8fde\u63a5\u961f\u5217\u5927\u5c0f\uff1f</p> <p>\u5728\u670d\u52a1\u7aef\u53ef\u4ee5\u4f7f\u7528 <code>ss</code> \u547d\u4ee4\uff0c\u6765\u67e5\u770b TCP \u5168\u8fde\u63a5\u961f\u5217\u7684\u60c5\u51b5\uff1a</p> <p>\u4f46\u9700\u8981\u6ce8\u610f\u7684\u662f <code>ss</code> \u547d\u4ee4\u83b7\u53d6\u7684 <code>Recv-Q/Send-Q</code> \u5728\u300cLISTEN \u72b6\u6001\u300d\u548c\u300c\u975e LISTEN \u72b6\u6001\u300d\u6240\u8868\u8fbe\u7684\u542b\u4e49\u662f\u4e0d\u540c\u7684\u3002\u4ece\u4e0b\u9762\u7684\u5185\u6838\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\u533a\u522b\uff1a</p> <p></p> <p>\u5728\u300cLISTEN \u72b6\u6001\u300d\u65f6\uff0c<code>Recv-Q/Send-Q</code> \u8868\u793a\u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>Recv-Q\uff1a\u5f53\u524d\u5168\u8fde\u63a5\u961f\u5217\u7684\u5927\u5c0f\uff0c\u4e5f\u5c31\u662f\u5f53\u524d\u5df2\u5b8c\u6210\u4e09\u6b21\u63e1\u624b\u5e76\u7b49\u5f85\u670d\u52a1\u7aef <code>accept()</code> \u7684 TCP \u8fde\u63a5\uff1b</li> <li>Send-Q\uff1a\u5f53\u524d\u5168\u8fde\u63a5\u6700\u5927\u961f\u5217\u957f\u5ea6\uff0c\u4e0a\u9762\u7684\u8f93\u51fa\u7ed3\u679c\u8bf4\u660e\u76d1\u542c 8088 \u7aef\u53e3\u7684 TCP \u670d\u52a1\uff0c\u6700\u5927\u5168\u8fde\u63a5\u957f\u5ea6\u4e3a 128\uff1b</li> </ul> <p>\u5728\u300c\u975e LISTEN \u72b6\u6001\u300d\u65f6\uff0c<code>Recv-Q/Send-Q</code> \u8868\u793a\u7684\u542b\u4e49\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>Recv-Q\uff1a\u5df2\u6536\u5230\u4f46\u672a\u88ab\u5e94\u7528\u8fdb\u7a0b\u8bfb\u53d6\u7684\u5b57\u8282\u6570\uff1b</li> <li>Send-Q\uff1a\u5df2\u53d1\u9001\u4f46\u672a\u6536\u5230\u786e\u8ba4\u7684\u5b57\u8282\u6570\uff1b</li> </ul> <p>\u5982\u4f55\u6a21\u62df TCP \u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u573a\u666f\uff1f</p> <p></p> <p>\u5b9e\u9a8c\u73af\u5883\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u662f CentOs 6.5\uff0cLinux \u5185\u6838\u7248\u672c 2.6.32</li> <li>\u670d\u52a1\u7aef IP 192.168.3.200\uff0c\u5ba2\u6237\u7aef IP 192.168.3.100 </li> <li>\u670d\u52a1\u7aef\u662f Nginx \u670d\u52a1\uff0c\u7aef\u53e3\u4e3a 8088</li> </ul> <p>\u8fd9\u91cc\u5148\u4ecb\u7ecd\u4e0b <code>wrk</code> \u5de5\u5177\uff0c\u5b83\u662f\u4e00\u6b3e\u7b80\u5355\u7684 HTTP \u538b\u6d4b\u5de5\u5177\uff0c\u5b83\u80fd\u591f\u5728\u5355\u673a\u591a\u6838 CPU \u7684\u6761\u4ef6\u4e0b\uff0c\u4f7f\u7528\u7cfb\u7edf\u81ea\u5e26\u7684\u9ad8\u6027\u80fd I/O \u673a\u5236\uff0c\u901a\u8fc7\u591a\u7ebf\u7a0b\u548c\u4e8b\u4ef6\u6a21\u5f0f\uff0c\u5bf9\u76ee\u6807\u673a\u5668\u4ea7\u751f\u5927\u91cf\u7684\u8d1f\u8f7d\u3002</p> <p>\u672c\u6b21\u6a21\u62df\u5b9e\u9a8c\u5c31\u4f7f\u7528 <code>wrk</code> \u5de5\u5177\u6765\u538b\u529b\u6d4b\u8bd5\u670d\u52a1\u7aef\uff0c\u53d1\u8d77\u5927\u91cf\u7684\u8bf7\u6c42\uff0c\u4e00\u8d77\u770b\u770b\u670d\u52a1\u7aef TCP \u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u6709\u4ec0\u4e48\u89c2\u5bdf\u6307\u6807\uff1f</p> <p>\u5ba2\u6237\u7aef\u6267\u884c <code>wrk</code> \u547d\u4ee4\u5bf9\u670d\u52a1\u7aef\u53d1\u8d77\u538b\u529b\u6d4b\u8bd5\uff0c\u5e76\u53d1 3 \u4e07\u4e2a\u8fde\u63a5\uff1a</p> <p></p> <p>\u5728\u670d\u52a1\u7aef\u53ef\u4ee5\u4f7f\u7528 <code>ss</code> \u547d\u4ee4\uff0c\u6765\u67e5\u770b\u5f53\u524d TCP \u5168\u8fde\u63a5\u961f\u5217\u7684\u60c5\u51b5\uff1a</p> <p></p> <p>\u5176\u95f4\u5171\u6267\u884c\u4e86\u4e24\u6b21 ss \u547d\u4ee4\uff0c\u4ece\u4e0a\u9762\u7684\u8f93\u51fa\u7ed3\u679c\uff0c\u53ef\u4ee5\u53d1\u73b0\u5f53\u524d TCP \u5168\u8fde\u63a5\u961f\u5217\u4e0a\u5347\u5230\u4e86 129 \u5927\u5c0f\uff0c\u8d85\u8fc7\u4e86\u6700\u5927 TCP \u5168\u8fde\u63a5\u961f\u5217\u3002</p> <p>\u5f53\u8d85\u8fc7\u4e86 TCP \u6700\u5927\u5168\u8fde\u63a5\u961f\u5217\uff0c\u670d\u52a1\u7aef\u5219\u4f1a\u4e22\u6389\u540e\u7eed\u8fdb\u6765\u7684 TCP \u8fde\u63a5\uff0c\u4e22\u6389\u7684 TCP \u8fde\u63a5\u7684\u4e2a\u6570\u4f1a\u88ab\u7edf\u8ba1\u8d77\u6765\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528 netstat -s \u547d\u4ee4\u6765\u67e5\u770b\uff1a</p> <p></p> <p>\u4e0a\u9762\u770b\u5230\u7684 41150 times\uff0c\u8868\u793a\u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u6b21\u6570\uff0c\u6ce8\u610f\u8fd9\u4e2a\u662f\u7d2f\u8ba1\u503c\u3002\u53ef\u4ee5\u9694\u51e0\u79d2\u949f\u6267\u884c\u4e0b\uff0c\u5982\u679c\u8fd9\u4e2a\u6570\u5b57\u4e00\u76f4\u5728\u589e\u52a0\u7684\u8bdd\u80af\u5b9a\u5168\u8fde\u63a5\u961f\u5217\u5076\u5c14\u6ee1\u4e86\u3002</p> <p>\u4ece\u4e0a\u9762\u7684\u6a21\u62df\u7ed3\u679c\uff0c\u53ef\u4ee5\u5f97\u77e5\uff0c\u5f53\u670d\u52a1\u7aef\u5e76\u53d1\u5904\u7406\u5927\u91cf\u8bf7\u6c42\u65f6\uff0c\u5982\u679c TCP \u5168\u8fde\u63a5\u961f\u5217\u8fc7\u5c0f\uff0c\u5c31\u5bb9\u6613\u6ea2\u51fa\u3002\u53d1\u751f TCP \u5168\u8fde\u63a5\u961f\u6ea2\u51fa\u7684\u65f6\u5019\uff0c\u540e\u7eed\u7684\u8bf7\u6c42\u5c31\u4f1a\u88ab\u4e22\u5f03\uff0c\u8fd9\u6837\u5c31\u4f1a\u51fa\u73b0\u670d\u52a1\u7aef\u8bf7\u6c42\u6570\u91cf\u4e0a\u4e0d\u53bb\u7684\u73b0\u8c61\u3002</p> <p></p> <p>Linux \u6709\u4e2a\u53c2\u6570\u53ef\u4ee5\u6307\u5b9a\u5f53 TCP \u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u4f1a\u4f7f\u7528\u4ec0\u4e48\u7b56\u7565\u6765\u56de\u5e94\u5ba2\u6237\u7aef\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u4e22\u5f03\u8fde\u63a5\u53ea\u662f Linux \u7684\u9ed8\u8ba4\u884c\u4e3a\uff0c\u6211\u4eec\u8fd8\u53ef\u4ee5\u9009\u62e9\u5411\u5ba2\u6237\u7aef\u53d1\u9001 RST \u590d\u4f4d\u62a5\u6587\uff0c\u544a\u8bc9\u5ba2\u6237\u7aef\u8fde\u63a5\u5df2\u7ecf\u5efa\u7acb\u5931\u8d25\u3002</p> <p></p> <p>tcp_abort_on_overflow \u5171\u6709\u4e24\u4e2a\u503c\u5206\u522b\u662f 0 \u548c 1\uff0c\u5176\u5206\u522b\u8868\u793a\uff1a</p> <ul> <li>0\uff1a\u5982\u679c\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u90a3\u4e48 server \u6254\u6389 client  \u53d1\u8fc7\u6765\u7684 ack\uff1b</li> <li>1\uff1a\u5982\u679c\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0cserver \u53d1\u9001\u4e00\u4e2a <code>reset</code> \u5305\u7ed9 client\uff0c\u8868\u793a\u5e9f\u6389\u8fd9\u4e2a\u63e1\u624b\u8fc7\u7a0b\u548c\u8fd9\u4e2a\u8fde\u63a5\uff1b</li> </ul> <p>\u5982\u679c\u8981\u60f3\u77e5\u9053\u5ba2\u6237\u7aef\u8fde\u63a5\u4e0d\u4e0a\u670d\u52a1\u7aef\uff0c\u662f\u4e0d\u662f\u670d\u52a1\u7aef TCP \u5168\u8fde\u63a5\u961f\u5217\u6ee1\u7684\u539f\u56e0\uff0c\u90a3\u4e48\u53ef\u4ee5\u628a tcp_abort_on_overflow \u8bbe\u7f6e\u4e3a 1\uff0c\u8fd9\u65f6\u5982\u679c\u5728\u5ba2\u6237\u7aef\u5f02\u5e38\u4e2d\u53ef\u4ee5\u770b\u5230\u5f88\u591a <code>connection reset by peer</code> \u7684\u9519\u8bef\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u8bc1\u660e\u662f\u7531\u4e8e\u670d\u52a1\u7aef TCP \u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u95ee\u9898\u3002</p> <p>\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u5e94\u5f53\u628a tcp_abort_on_overflow \u8bbe\u7f6e\u4e3a 0\uff0c\u56e0\u4e3a\u8fd9\u6837\u66f4\u6709\u5229\u4e8e\u5e94\u5bf9\u7a81\u53d1\u6d41\u91cf\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5f53 TCP \u5168\u8fde\u63a5\u961f\u5217\u6ee1\u5bfc\u81f4\u670d\u52a1\u5668\u4e22\u6389\u4e86 ACK\uff0c\u4e0e\u6b64\u540c\u65f6\uff0c\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u72b6\u6001\u5374\u662f ESTABLISHED\uff0c\u8fdb\u7a0b\u5c31\u5728\u5efa\u7acb\u597d\u7684\u8fde\u63a5\u4e0a\u53d1\u9001\u8bf7\u6c42\u3002\u53ea\u8981\u670d\u52a1\u5668\u6ca1\u6709\u4e3a\u8bf7\u6c42\u56de\u590d ACK\uff0c\u8bf7\u6c42\u5c31\u4f1a\u88ab\u591a\u6b21\u91cd\u53d1\u3002\u5982\u679c\u670d\u52a1\u5668\u4e0a\u7684\u8fdb\u7a0b\u53ea\u662f\u77ed\u6682\u7684\u7e41\u5fd9\u9020\u6210 accept \u961f\u5217\u6ee1\uff0c\u90a3\u4e48\u5f53 TCP \u5168\u8fde\u63a5\u961f\u5217\u6709\u7a7a\u4f4d\u65f6\uff0c\u518d\u6b21\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u62a5\u6587\u7531\u4e8e\u542b\u6709 ACK\uff0c\u4ecd\u7136\u4f1a\u89e6\u53d1\u670d\u52a1\u5668\u7aef\u6210\u529f\u5efa\u7acb\u8fde\u63a5\u3002</p> <p>\u6240\u4ee5\uff0ctcp_abort_on_overflow \u8bbe\u4e3a 0 \u53ef\u4ee5\u63d0\u9ad8\u8fde\u63a5\u5efa\u7acb\u7684\u6210\u529f\u7387\uff0c\u53ea\u6709\u4f60\u975e\u5e38\u80af\u5b9a TCP \u5168\u8fde\u63a5\u961f\u5217\u4f1a\u957f\u671f\u6ea2\u51fa\u65f6\uff0c\u624d\u80fd\u8bbe\u7f6e\u4e3a 1 \u4ee5\u5c3d\u5feb\u901a\u77e5\u5ba2\u6237\u7aef\u3002</p> <p>\u5982\u4f55\u589e\u5927 TCP \u5168\u8fde\u63a5\u961f\u5217\u5462\uff1f</p> <p>\u662f\u7684\uff0c\u5f53\u53d1\u73b0 TCP \u5168\u8fde\u63a5\u961f\u5217\u53d1\u751f\u6ea2\u51fa\u7684\u65f6\u5019\uff0c\u6211\u4eec\u5c31\u9700\u8981\u589e\u5927\u8be5\u961f\u5217\u7684\u5927\u5c0f\uff0c\u4ee5\u4fbf\u53ef\u4ee5\u5e94\u5bf9\u5ba2\u6237\u7aef\u5927\u91cf\u7684\u8bf7\u6c42\u3002</p> <p>TCP \u5168\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u503c\u53d6\u51b3\u4e8e somaxconn \u548c backlog \u4e4b\u95f4\u7684\u6700\u5c0f\u503c\uff0c\u4e5f\u5c31\u662f min(somaxconn, backlog)\u3002\u4ece\u4e0b\u9762\u7684 Linux \u5185\u6838\u4ee3\u7801\u53ef\u4ee5\u5f97\u77e5\uff1a</p> <p></p> <ul> <li><code>somaxconn</code> \u662f Linux \u5185\u6838\u7684\u53c2\u6570\uff0c\u9ed8\u8ba4\u503c\u662f 128\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>/proc/sys/net/core/somaxconn</code> \u6765\u8bbe\u7f6e\u5176\u503c\uff1b</li> <li><code>backlog</code> \u662f <code>listen(int sockfd, int backlog)</code> \u51fd\u6570\u4e2d\u7684 backlog \u5927\u5c0f\uff0cNginx \u9ed8\u8ba4\u503c\u662f 511\uff0c\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539\u914d\u7f6e\u6587\u4ef6\u8bbe\u7f6e\u5176\u957f\u5ea6\uff1b</li> </ul> <p>\u524d\u9762\u6a21\u62df\u6d4b\u8bd5\u4e2d\uff0c\u6211\u7684\u6d4b\u8bd5\u73af\u5883\uff1a</p> <ul> <li>somaxconn \u662f\u9ed8\u8ba4\u503c 128\uff1b</li> <li>Nginx \u7684 backlog \u662f\u9ed8\u8ba4\u503c 511</li> </ul> <p>\u6240\u4ee5\u6d4b\u8bd5\u73af\u5883\u7684 TCP \u5168\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\u4e3a min(128, 511)\uff0c\u4e5f\u5c31\u662f <code>128</code>\uff0c\u53ef\u4ee5\u6267\u884c <code>ss</code> \u547d\u4ee4\u67e5\u770b\uff1a</p> <p></p> <p>\u73b0\u5728\u6211\u4eec\u91cd\u65b0\u538b\u6d4b\uff0c\u628a TCP \u5168\u8fde\u63a5\u961f\u5217\u641e\u5927\uff0c\u628a <code>somaxconn</code> \u8bbe\u7f6e\u6210 5000\uff1a</p> <p></p> <p>\u63a5\u7740\u628a Nginx \u7684 backlog \u4e5f\u540c\u6837\u8bbe\u7f6e\u6210 5000\uff1a</p> <p></p> <p>\u6700\u540e\u8981\u91cd\u542f Nginx \u670d\u52a1\uff0c\u56e0\u4e3a\u53ea\u6709\u91cd\u65b0\u8c03\u7528 <code>listen()</code> \u51fd\u6570 TCP \u5168\u8fde\u63a5\u961f\u5217\u624d\u4f1a\u91cd\u65b0\u521d\u59cb\u5316\u3002</p> <p>\u91cd\u542f\u5b8c\u540e Nginx \u670d\u52a1\u540e\uff0c\u670d\u52a1\u7aef\u6267\u884c ss \u547d\u4ee4\uff0c\u67e5\u770b TCP \u5168\u8fde\u63a5\u961f\u5217\u5927\u5c0f\uff1a</p> <p></p> <p>\u4ece\u6267\u884c\u7ed3\u679c\uff0c\u53ef\u4ee5\u53d1\u73b0 TCP \u5168\u8fde\u63a5\u6700\u5927\u503c\u4e3a 5000\u3002</p> <p>\u589e\u5927 TCP \u5168\u8fde\u63a5\u961f\u5217\u540e\uff0c\u7ee7\u7eed\u538b\u6d4b</p> <p>\u5ba2\u6237\u7aef\u540c\u6837\u4ee5 3 \u4e07\u4e2a\u8fde\u63a5\u5e76\u53d1\u53d1\u9001\u8bf7\u6c42\u7ed9\u670d\u52a1\u7aef\uff1a</p> <p></p> <p>\u670d\u52a1\u7aef\u6267\u884c <code>ss</code> \u547d\u4ee4\uff0c\u67e5\u770b TCP \u5168\u8fde\u63a5\u961f\u5217\u4f7f\u7528\u60c5\u51b5\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684\u6267\u884c\u7ed3\u679c\uff0c\u53ef\u4ee5\u53d1\u73b0\u5168\u8fde\u63a5\u961f\u5217\u4f7f\u7528\u589e\u957f\u7684\u5f88\u5feb\uff0c\u4f46\u662f\u4e00\u76f4\u90fd\u6ca1\u6709\u8d85\u8fc7\u6700\u5927\u503c\uff0c\u6240\u4ee5\u5c31\u4e0d\u4f1a\u6ea2\u51fa\uff0c\u90a3\u4e48 <code>netstat -s</code> \u5c31\u4e0d\u4f1a\u6709 TCP \u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u4e2a\u6570\u7684\u663e\u793a\uff1a</p> <p></p> <p>\u8bf4\u660e TCP \u5168\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\u4ece 128 \u589e\u5927\u5230 5000 \u540e\uff0c\u670d\u52a1\u7aef\u6297\u4f4f\u4e86 3 \u4e07\u8fde\u63a5\u5e76\u53d1\u8bf7\u6c42\uff0c\u4e5f\u6ca1\u6709\u53d1\u751f\u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u73b0\u8c61\u4e86\u3002</p> <p>\u5982\u679c\u6301\u7eed\u4e0d\u65ad\u5730\u6709\u8fde\u63a5\u56e0\u4e3a TCP \u5168\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u88ab\u4e22\u5f03\uff0c\u5c31\u5e94\u8be5\u8c03\u5927 backlog \u4ee5\u53ca somaxconn \u53c2\u6570\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_queue/#-tcp_1","title":"\u5b9e\u6218 - TCP \u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa","text":"<p>\u5982\u4f55\u67e5\u770b TCP \u534a\u8fde\u63a5\u961f\u5217\u957f\u5ea6\uff1f</p> <p>\u5f88\u9057\u61be\uff0cTCP \u534a\u8fde\u63a5\u961f\u5217\u957f\u5ea6\u7684\u957f\u5ea6\uff0c\u6ca1\u6709\u50cf\u5168\u8fde\u63a5\u961f\u5217\u90a3\u6837\u53ef\u4ee5\u7528 ss \u547d\u4ee4\u67e5\u770b\u3002</p> <p>\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u6293\u4f4f TCP \u534a\u8fde\u63a5\u7684\u7279\u70b9\uff0c\u5c31\u662f\u670d\u52a1\u7aef\u5904\u4e8e <code>SYN_RECV</code> \u72b6\u6001\u7684 TCP \u8fde\u63a5\uff0c\u5c31\u662f TCP \u534a\u8fde\u63a5\u961f\u5217\u3002</p> <p>\u4e8e\u662f\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u8ba1\u7b97\u5f53\u524d TCP \u534a\u8fde\u63a5\u961f\u5217\u957f\u5ea6\uff1a</p> <p></p> <p>\u5982\u4f55\u6a21\u62df TCP \u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u573a\u666f\uff1f</p> <p>\u6a21\u62df TCP \u534a\u8fde\u63a5\u6ea2\u51fa\u573a\u666f\u4e0d\u96be\uff0c\u5b9e\u9645\u4e0a\u5c31\u662f\u5bf9\u670d\u52a1\u7aef\u4e00\u76f4\u53d1\u9001 TCP SYN \u5305\uff0c\u4f46\u662f\u4e0d\u56de\u7b2c\u4e09\u6b21\u63e1\u624b ACK\uff0c\u8fd9\u6837\u5c31\u4f1a\u4f7f\u5f97\u670d\u52a1\u7aef\u6709\u5927\u91cf\u7684\u5904\u4e8e <code>SYN_RECV</code> \u72b6\u6001\u7684 TCP \u8fde\u63a5\u3002</p> <p>\u8fd9\u5176\u5b9e\u4e5f\u5c31\u662f\u6240\u8c13\u7684 SYN \u6d2a\u6cdb\u3001SYN \u653b\u51fb\u3001DDos \u653b\u51fb\u3002</p> <p></p> <p>\u5b9e\u9a8c\u73af\u5883\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u662f CentOs 6.5\uff0cLinux \u5185\u6838\u7248\u672c 2.6.32</li> <li>\u670d\u52a1\u7aef IP 192.168.3.200\uff0c\u5ba2\u6237\u7aef IP 192.168.3.100 </li> <li>\u670d\u52a1\u7aef\u662f Nginx \u670d\u52a1\uff0c\u7aef\u53e3\u4e3a 8088</li> </ul> <p>\u6ce8\u610f\uff1a\u672c\u6b21\u6a21\u62df\u5b9e\u9a8c\u662f\u6ca1\u6709\u5f00\u542f tcp_syncookies\uff0c\u5173\u4e8e tcp_syncookies \u7684\u4f5c\u7528\uff0c\u540e\u7eed\u4f1a\u8bf4\u660e\u3002</p> <p>\u672c\u6b21\u5b9e\u9a8c\u4f7f\u7528 <code>hping3</code> \u5de5\u5177\u6a21\u62df SYN \u653b\u51fb\uff1a</p> <p></p> <p>\u5f53\u670d\u52a1\u7aef\u53d7\u5230 SYN \u653b\u51fb\u540e\uff0c\u8fde\u63a5\u670d\u52a1\u7aef ssh \u5c31\u4f1a\u65ad\u5f00\u4e86\uff0c\u65e0\u6cd5\u518d\u8fde\u4e0a\u3002\u53ea\u80fd\u5728\u670d\u52a1\u7aef\u4e3b\u673a\u4e0a\u6267\u884c\u67e5\u770b\u5f53\u524d TCP \u534a\u8fde\u63a5\u961f\u5217\u5927\u5c0f\uff1a</p> <p></p> <p>\u540c\u65f6\uff0c\u8fd8\u53ef\u4ee5\u901a\u8fc7 netstat -s \u89c2\u5bdf\u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u60c5\u51b5\uff1a</p> <p></p> <p>\u4e0a\u9762\u8f93\u51fa\u7684\u6570\u503c\u662f\u7d2f\u8ba1\u503c\uff0c\u8868\u793a\u5171\u6709\u591a\u5c11\u4e2a TCP \u8fde\u63a5\u56e0\u4e3a\u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u800c\u88ab\u4e22\u5f03\u3002\u9694\u51e0\u79d2\u6267\u884c\u51e0\u6b21\uff0c\u5982\u679c\u6709\u4e0a\u5347\u7684\u8d8b\u52bf\uff0c\u8bf4\u660e\u5f53\u524d\u5b58\u5728\u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u73b0\u8c61\u3002</p> <p>\u5927\u90e8\u5206\u4eba\u90fd\u8bf4 tcp_max_syn_backlog \u662f\u6307\u5b9a\u534a\u8fde\u63a5\u961f\u5217\u7684\u5927\u5c0f\uff0c\u662f\u771f\u7684\u5417\uff1f</p> <p>\u5f88\u9057\u61be\uff0c\u534a\u8fde\u63a5\u961f\u5217\u7684\u5927\u5c0f\u5e76\u4e0d\u5355\u5355\u53ea\u8ddf <code>tcp_max_syn_backlog</code> \u6709\u5173\u7cfb\u3002</p> <p>\u4e0a\u9762\u6a21\u62df SYN \u653b\u51fb\u573a\u666f\u65f6\uff0c\u670d\u52a1\u7aef\u7684 tcp_max_syn_backlog \u7684\u9ed8\u8ba4\u503c\u5982\u4e0b\uff1a</p> <p></p> <p>\u4f46\u662f\u5728\u6d4b\u8bd5\u7684\u65f6\u5019\u53d1\u73b0\uff0c\u670d\u52a1\u7aef\u6700\u591a\u53ea\u6709 256 \u4e2a\u534a\u8fde\u63a5\u961f\u5217\uff0c\u800c\u4e0d\u662f 512\uff0c\u6240\u4ee5\u534a\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u957f\u5ea6\u4e0d\u4e00\u5b9a\u7531 tcp_max_syn_backlog \u503c\u51b3\u5b9a\u7684\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8d70\u8fdb Linux \u5185\u6838\u7684\u6e90\u7801\uff0c\u6765\u5206\u6790 TCP \u534a\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u503c\u662f\u5982\u4f55\u51b3\u5b9a\u7684\u3002</p> <p>TCP \u7b2c\u4e00\u6b21\u63e1\u624b\uff08\u6536\u5230 SYN \u5305\uff09\u7684 Linux \u5185\u6838\u4ee3\u7801\u5982\u4e0b\uff0c\u5176\u4e2d\u7f29\u51cf\u4e86\u5927\u91cf\u7684\u4ee3\u7801\uff0c\u53ea\u9700\u8981\u91cd\u70b9\u5173\u6ce8 TCP \u534a\u8fde\u63a5\u961f\u5217\u6ea2\u51fa\u7684\u5904\u7406\u903b\u8f91\uff1a</p> <p></p> <p>\u4ece\u6e90\u7801\u4e2d\uff0c\u6211\u53ef\u4ee5\u5f97\u51fa\u5171\u6709\u4e09\u4e2a\u6761\u4ef6\u56e0\u961f\u5217\u957f\u5ea6\u7684\u5173\u7cfb\u800c\u88ab\u4e22\u5f03\u7684\uff1a</p> <p></p> <ol> <li>\u5982\u679c\u534a\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u5e76\u4e14\u6ca1\u6709\u5f00\u542f tcp_syncookies\uff0c\u5219\u4f1a\u4e22\u5f03\uff1b</li> <li>\u82e5\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u4e14\u6ca1\u6709\u91cd\u4f20 SYN+ACK \u5305\u7684\u8fde\u63a5\u8bf7\u6c42\u591a\u4e8e 1 \u4e2a\uff0c\u5219\u4f1a\u4e22\u5f03\uff1b</li> <li>\u5982\u679c\u6ca1\u6709\u5f00\u542f tcp_syncookies\uff0c\u5e76\u4e14 max_syn_backlog \u51cf\u53bb \u5f53\u524d\u534a\u8fde\u63a5\u961f\u5217\u957f\u5ea6\u5c0f\u4e8e (max_syn_backlog &gt;&gt; 2)\uff0c\u5219\u4f1a\u4e22\u5f03\uff1b</li> </ol> <p>\u5173\u4e8e tcp_syncookies \u7684\u8bbe\u7f6e\uff0c\u540e\u9762\u5728\u8be6\u7ec6\u8bf4\u660e\uff0c\u53ef\u4ee5\u5148\u7ed9\u5927\u5bb6\u8bf4\u4e00\u4e0b\uff0c\u5f00\u542f tcp_syncookies \u662f\u7f13\u89e3 SYN \u653b\u51fb\u5176\u4e2d\u4e00\u4e2a\u624b\u6bb5\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u7ee7\u7eed\u8ddf\u4e00\u4e0b\u68c0\u6d4b\u534a\u8fde\u63a5\u961f\u5217\u662f\u5426\u6ee1\u7684\u51fd\u6570 inet_csk_reqsk_queue_is_full \u548c \u68c0\u6d4b\u5168\u8fde\u63a5\u961f\u5217\u662f\u5426\u6ee1\u7684\u51fd\u6570 sk_acceptq_is_full\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u6e90\u7801\uff0c\u53ef\u4ee5\u5f97\u77e5\uff1a</p> <ul> <li>\u5168\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u503c\u662f <code>sk_max_ack_backlog</code> \u53d8\u91cf\uff0csk_max_ack_backlog \u5b9e\u9645\u4e0a\u662f\u5728 listen() \u6e90\u7801\u91cc\u6307\u5b9a\u7684\uff0c\u4e5f\u5c31\u662f min(somaxconn, backlog)\uff1b</li> <li>\u534a\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u503c\u662f <code>max_qlen_log</code> \u53d8\u91cf\uff0cmax_qlen_log \u662f\u5728\u54ea\u6307\u5b9a\u7684\u5462\uff1f\u73b0\u5728\u6682\u65f6\u8fd8\u4e0d\u77e5\u9053\uff0c\u6211\u4eec\u7ee7\u7eed\u8ddf\u8fdb\uff1b</li> </ul> <p>\u6211\u4eec\u7ee7\u7eed\u8ddf\u8fdb\u4ee3\u7801\uff0c\u770b\u4e00\u4e0b\u662f\u54ea\u91cc\u521d\u59cb\u5316\u4e86\u534a\u8fde\u63a5\u961f\u5217\u7684\u6700\u5927\u503c max_qlen_log\uff1a</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u7b97\u51fa max_qlen_log \u662f 8\uff0c\u4e8e\u662f\u4ee3\u5165\u5230 \u68c0\u6d4b\u534a\u8fde\u63a5\u961f\u5217\u662f\u5426\u6ee1\u7684\u51fd\u6570 reqsk_queue_is_full\uff1a</p> <p></p> <p>\u4e5f\u5c31\u662f <code>qlen &gt;&gt; 8</code> \u4ec0\u4e48\u65f6\u5019\u4e3a 1 \u5c31\u4ee3\u8868\u534a\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\u3002\u8fd9\u8ba1\u7b97\u8fd9\u4e0d\u96be\uff0c\u5f88\u660e\u663e\u662f\u5f53 qlen \u4e3a 256 \u65f6\uff0c<code>256 &gt;&gt; 8 = 1</code>\u3002</p> <p>\u81f3\u6b64\uff0c\u603b\u7b97\u77e5\u9053\u4e3a\u4ec0\u4e48\u4e0a\u9762\u6a21\u62df\u6d4b\u8bd5 SYN \u653b\u51fb\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u5904\u4e8e <code>SYN_RECV</code> \u8fde\u63a5\u6700\u5927\u53ea\u6709 256 \u4e2a\u3002</p> <p>\u53ef\u89c1\uff0c\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\u4e0d\u662f\u5355\u5355\u7531 max_syn_backlog \u51b3\u5b9a\uff0c\u8fd8\u8ddf somaxconn \u548c backlog \u6709\u5173\u7cfb\u3002</p> <p>\u5728 Linux 2.6.32 \u5185\u6838\u7248\u672c\uff0c\u5b83\u4eec\u4e4b\u95f4\u7684\u5173\u7cfb\uff0c\u603b\u4f53\u53ef\u4ee5\u6982\u51b5\u4e3a\uff1a</p> <p></p> <ul> <li>\u5f53 max_syn_backlog &gt; min(somaxconn, backlog) \u65f6\uff0c\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c max_qlen_log = min(somaxconn, backlog) * 2;</li> <li>\u5f53 max_syn_backlog &lt; min(somaxconn, backlog) \u65f6\uff0c\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c max_qlen_log = max_syn_backlog * 2;</li> </ul> <p>\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c max_qlen_log \u5c31\u8868\u793a\u670d\u52a1\u7aef\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\u5417\uff1f</p> <p>\u4f9d\u7136\u5f88\u9057\u61be\uff0c\u5e76\u4e0d\u662f\u3002</p> <p>max_qlen_log \u662f\u7406\u8bba\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\uff0c\u5e76\u4e0d\u4e00\u5b9a\u4ee3\u8868\u670d\u52a1\u7aef\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\u3002</p> <p>\u5728\u524d\u9762\u6211\u4eec\u5728\u5206\u6790 TCP \u7b2c\u4e00\u6b21\u63e1\u624b\uff08\u6536\u5230 SYN \u5305\uff09\u65f6\u4f1a\u88ab\u4e22\u5f03\u7684\u4e09\u79cd\u6761\u4ef6\uff1a</p> <ol> <li>\u5982\u679c\u534a\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u5e76\u4e14\u6ca1\u6709\u5f00\u542f tcp_syncookies\uff0c\u5219\u4f1a\u4e22\u5f03\uff1b</li> <li>\u82e5\u5168\u8fde\u63a5\u961f\u5217\u6ee1\u4e86\uff0c\u4e14\u6ca1\u6709\u91cd\u4f20 SYN+ACK \u5305\u7684\u8fde\u63a5\u8bf7\u6c42\u591a\u4e8e 1 \u4e2a\uff0c\u5219\u4f1a\u4e22\u5f03\uff1b</li> <li>\u5982\u679c\u6ca1\u6709\u5f00\u542f tcp_syncookies\uff0c\u5e76\u4e14 max_syn_backlog \u51cf\u53bb \u5f53\u524d\u534a\u8fde\u63a5\u961f\u5217\u957f\u5ea6\u5c0f\u4e8e (max_syn_backlog &gt;&gt; 2)\uff0c\u5219\u4f1a\u4e22\u5f03\uff1b</li> </ol> <p>\u5047\u8bbe\u6761\u4ef6 1 \u5f53\u524d\u534a\u8fde\u63a5\u961f\u5217\u7684\u957f\u5ea6\u300c\u6ca1\u6709\u8d85\u8fc7\u300d\u7406\u8bba\u7684\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c  max_qlen_log\uff0c\u90a3\u4e48\u5982\u679c\u6761\u4ef6 3 \u6210\u7acb\uff0c\u5219\u4f9d\u7136\u4f1a\u4e22\u5f03 SYN \u5305\uff0c\u4e5f\u5c31\u4f1a\u4f7f\u5f97\u670d\u52a1\u7aef\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\u4e0d\u4f1a\u662f\u7406\u8bba\u503c max_qlen_log\u3002</p> <p>\u4f3c\u4e4e\u5f88\u96be\u7406\u89e3\uff0c\u6211\u4eec\u7ee7\u7eed\u63a5\u7740\u505a\u5b9e\u9a8c\uff0c\u5b9e\u9a8c\u89c1\u771f\u77e5\u3002</p> <p>\u670d\u52a1\u7aef\u73af\u5883\u5982\u4e0b\uff1a</p> <p></p> <p>\u914d\u7f6e\u5b8c\u540e\uff0c\u670d\u52a1\u7aef\u8981\u91cd\u542f Nginx\uff0c\u56e0\u4e3a\u5168\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\u548c\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\u662f\u5728 listen() \u51fd\u6570\u521d\u59cb\u5316\u3002</p> <p>\u6839\u636e\u524d\u9762\u7684\u6e90\u7801\u5206\u6790\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba1\u7b97\u51fa\u534a\u8fde\u63a5\u961f\u5217 max_qlen_log \u7684\u6700\u5927\u503c\u4e3a 256\uff1a</p> <p></p> <p>\u5ba2\u6237\u7aef\u6267\u884c hping3 \u53d1\u8d77 SYN \u653b\u51fb\uff1a</p> <p></p> <p>\u670d\u52a1\u7aef\u6267\u884c\u5982\u4e0b\u547d\u4ee4\uff0c\u67e5\u770b\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\uff1a</p> <p></p> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u670d\u52a1\u7aef\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\u5e76\u4e0d\u662f max_qlen_log \u53d8\u91cf\u7684\u503c\u3002</p> <p>\u8fd9\u5c31\u662f\u524d\u9762\u6240\u8bf4\u7684\u539f\u56e0\uff1a\u5982\u679c\u5f53\u524d\u534a\u8fde\u63a5\u961f\u5217\u7684\u957f\u5ea6\u300c\u6ca1\u6709\u8d85\u8fc7\u300d\u7406\u8bba\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c  max_qlen_log\uff0c\u90a3\u4e48\u5982\u679c\u6761\u4ef6 3 \u6210\u7acb\uff0c\u5219\u4f9d\u7136\u4f1a\u4e22\u5f03 SYN \u5305\uff0c\u4e5f\u5c31\u4f1a\u4f7f\u5f97\u670d\u52a1\u7aef\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\u4e0d\u4f1a\u662f\u7406\u8bba\u503c max_qlen_log\u3002</p> <p>\u6211\u4eec\u6765\u5206\u6790\u4e00\u6ce2\u6761\u4ef6 3 :</p> <p></p> <p>\u4ece\u4e0a\u9762\u7684\u5206\u6790\uff0c\u53ef\u4ee5\u5f97\u77e5\u5982\u679c\u89e6\u53d1\u300c\u5f53\u524d\u534a\u8fde\u63a5\u961f\u5217\u957f\u5ea6 &gt; 192\u300d\u6761\u4ef6\uff0cTCP \u7b2c\u4e00\u6b21\u63e1\u624b\u7684 SYN \u5305\u662f\u4f1a\u88ab\u4e22\u5f03\u7684\u3002</p> <p>\u5728\u524d\u9762\u6211\u4eec\u6d4b\u8bd5\u7684\u7ed3\u679c\uff0c\u670d\u52a1\u7aef\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\u662f 193\uff0c\u6b63\u597d\u662f\u89e6\u53d1\u4e86\u6761\u4ef6 3\uff0c\u6240\u4ee5\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u4e2a\u6570\u8fd8\u6ca1\u5230\u300c\u7406\u8bba\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c 256\u300d\uff0c\u5c31\u5df2\u7ecf\u628a SYN \u5305\u4e22\u5f03\u4e86\u3002</p> <p>\u6240\u4ee5\uff0c\u670d\u52a1\u7aef\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\u5206\u4e3a\u5982\u4e0b\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u5982\u679c\u300c\u5f53\u524d\u534a\u8fde\u63a5\u961f\u5217\u300d\u6ca1\u8d85\u8fc7\u300c\u7406\u8bba\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\u300d\uff0c\u4f46\u662f\u8d85\u8fc7 max_syn_backlog  - (max_syn_backlog &gt;&gt; 2)\uff0c\u90a3\u4e48\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\u5c31\u662f max_syn_backlog  - (max_syn_backlog &gt;&gt; 2)\uff1b</li> <li>\u5982\u679c\u300c\u5f53\u524d\u534a\u8fde\u63a5\u961f\u5217\u300d\u8d85\u8fc7\u300c\u7406\u8bba\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\u300d\uff0c\u90a3\u4e48\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684\u6700\u5927\u4e2a\u6570\u5c31\u662f\u300c\u7406\u8bba\u534a\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\u300d\uff1b</li> </ul> <p>\u6bcf\u4e2a Linux \u5185\u6838\u7248\u672c\u300c\u7406\u8bba\u300d\u534a\u8fde\u63a5\u6700\u5927\u503c\u8ba1\u7b97\u65b9\u5f0f\u4f1a\u4e0d\u540c\u3002</p> <p>\u5728\u4e0a\u9762\u6211\u4eec\u662f\u9488\u5bf9 Linux 2.6.32 \u7248\u672c\u5206\u6790\u7684\u300c\u7406\u8bba\u300d\u534a\u8fde\u63a5\u6700\u5927\u503c\u7684\u7b97\u6cd5\uff0c\u53ef\u80fd\u6bcf\u4e2a\u7248\u672c\u6709\u4e9b\u4e0d\u540c\u3002</p> <p>\u6bd4\u5982\u5728 Linux 5.0.0 \u7684\u65f6\u5019\uff0c\u300c\u7406\u8bba\u300d\u534a\u8fde\u63a5\u6700\u5927\u503c\u5c31\u662f\u5168\u8fde\u63a5\u961f\u5217\u6700\u5927\u503c\uff0c\u4f46\u4f9d\u7136\u8fd8\u662f\u6709\u961f\u5217\u6ea2\u51fa\u7684\u4e09\u4e2a\u6761\u4ef6\uff1a</p> <p></p> <p>\u5982\u679c SYN \u534a\u8fde\u63a5\u961f\u5217\u5df2\u6ee1\uff0c\u53ea\u80fd\u4e22\u5f03\u8fde\u63a5\u5417\uff1f</p> <p>\u5e76\u4e0d\u662f\u8fd9\u6837\uff0c\u5f00\u542f syncookies \u529f\u80fd\u5c31\u53ef\u4ee5\u5728\u4e0d\u4f7f\u7528 SYN \u534a\u8fde\u63a5\u961f\u5217\u7684\u60c5\u51b5\u4e0b\u6210\u529f\u5efa\u7acb\u8fde\u63a5\uff0c\u5728\u524d\u9762\u6211\u4eec\u6e90\u7801\u5206\u6790\u4e5f\u53ef\u4ee5\u770b\u5230\u8fd9\u70b9\uff0c\u5f53\u5f00\u542f\u4e86  syncookies \u529f\u80fd\u5c31\u4e0d\u4f1a\u4e22\u5f03\u8fde\u63a5\u3002</p> <p>syncookies \u662f\u8fd9\u4e48\u505a\u7684\uff1a\u670d\u52a1\u5668\u6839\u636e\u5f53\u524d\u72b6\u6001\u8ba1\u7b97\u51fa\u4e00\u4e2a\u503c\uff0c\u653e\u5728\u5df1\u65b9\u53d1\u51fa\u7684 SYN+ACK \u62a5\u6587\u4e2d\u53d1\u51fa\uff0c\u5f53\u5ba2\u6237\u7aef\u8fd4\u56de ACK \u62a5\u6587\u65f6\uff0c\u53d6\u51fa\u8be5\u503c\u9a8c\u8bc1\uff0c\u5982\u679c\u5408\u6cd5\uff0c\u5c31\u8ba4\u4e3a\u8fde\u63a5\u5efa\u7acb\u6210\u529f\uff0c\u5982\u4e0b\u56fe\u6240\u793a\u3002</p> <p></p> <p>syncookies \u53c2\u6570\u4e3b\u8981\u6709\u4ee5\u4e0b\u4e09\u4e2a\u503c\uff1a</p> <ul> <li>0 \u503c\uff0c\u8868\u793a\u5173\u95ed\u8be5\u529f\u80fd\uff1b</li> <li>1 \u503c\uff0c\u8868\u793a\u4ec5\u5f53 SYN \u534a\u8fde\u63a5\u961f\u5217\u653e\u4e0d\u4e0b\u65f6\uff0c\u518d\u542f\u7528\u5b83\uff1b</li> <li>2 \u503c\uff0c\u8868\u793a\u65e0\u6761\u4ef6\u5f00\u542f\u529f\u80fd\uff1b</li> </ul> <p>\u90a3\u4e48\u5728\u5e94\u5bf9 SYN \u653b\u51fb\u65f6\uff0c\u53ea\u9700\u8981\u8bbe\u7f6e\u4e3a 1 \u5373\u53ef\uff1a</p> <p></p> <p>\u5982\u4f55\u9632\u5fa1 SYN \u653b\u51fb\uff1f</p> <p>\u8fd9\u91cc\u7ed9\u51fa\u51e0\u79cd\u9632\u5fa1 SYN \u653b\u51fb\u7684\u65b9\u6cd5\uff1a</p> <ul> <li>\u589e\u5927\u534a\u8fde\u63a5\u961f\u5217\uff1b</li> <li>\u5f00\u542f tcp_syncookies \u529f\u80fd</li> <li>\u51cf\u5c11 SYN+ACK \u91cd\u4f20\u6b21\u6570</li> </ul> <p>\u65b9\u5f0f\u4e00\uff1a\u589e\u5927\u534a\u8fde\u63a5\u961f\u5217</p> <p>\u5728\u524d\u9762\u6e90\u7801\u548c\u5b9e\u9a8c\u4e2d\uff0c\u5f97\u77e5\u8981\u60f3\u589e\u5927\u534a\u8fde\u63a5\u961f\u5217\uff0c\u6211\u4eec\u5f97\u77e5\u4e0d\u80fd\u53ea\u5355\u7eaf\u589e\u5927 tcp_max_syn_backlog \u7684\u503c\uff0c\u8fd8\u9700\u4e00\u540c\u589e\u5927 somaxconn \u548c backlog\uff0c\u4e5f\u5c31\u662f\u589e\u5927\u5168\u8fde\u63a5\u961f\u5217\u3002\u5426\u5219\uff0c\u53ea\u5355\u7eaf\u589e\u5927 tcp_max_syn_backlog \u662f\u65e0\u6548\u7684\u3002</p> <p>\u589e\u5927 tcp_max_syn_backlog \u548c somaxconn \u7684\u65b9\u6cd5\u662f\u4fee\u6539 Linux \u5185\u6838\u53c2\u6570\uff1a</p> <p></p> <p>\u589e\u5927 backlog \u7684\u65b9\u5f0f\uff0c\u6bcf\u4e2a Web \u670d\u52a1\u90fd\u4e0d\u540c\uff0c\u6bd4\u5982 Nginx \u589e\u5927 backlog \u7684\u65b9\u6cd5\u5982\u4e0b\uff1a</p> <p></p> <p>\u6700\u540e\uff0c\u6539\u53d8\u4e86\u5982\u4e0a\u8fd9\u4e9b\u53c2\u6570\u540e\uff0c\u8981\u91cd\u542f Nginx \u670d\u52a1\uff0c\u56e0\u4e3a\u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\u90fd\u662f\u5728 listen() \u521d\u59cb\u5316\u7684\u3002</p> <p>\u65b9\u5f0f\u4e8c\uff1a\u5f00\u542f tcp_syncookies \u529f\u80fd</p> <p>\u5f00\u542f tcp_syncookies \u529f\u80fd\u7684\u65b9\u5f0f\u4e5f\u5f88\u7b80\u5355\uff0c\u4fee\u6539 Linux \u5185\u6838\u53c2\u6570\uff1a</p> <p></p> <p>\u65b9\u5f0f\u4e09\uff1a\u51cf\u5c11 SYN+ACK \u91cd\u4f20\u6b21\u6570</p> <p>\u5f53\u670d\u52a1\u7aef\u53d7\u5230 SYN \u653b\u51fb\u65f6\uff0c\u5c31\u4f1a\u6709\u5927\u91cf\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684 TCP \u8fde\u63a5\uff0c\u5904\u4e8e\u8fd9\u4e2a\u72b6\u6001\u7684 TCP \u4f1a\u91cd\u4f20 SYN+ACK\uff0c\u5f53\u91cd\u4f20\u8d85\u8fc7\u6b21\u6570\u8fbe\u5230\u4e0a\u9650\u540e\uff0c\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</p> <p>\u90a3\u4e48\u9488\u5bf9 SYN \u653b\u51fb\u7684\u573a\u666f\uff0c\u6211\u4eec\u53ef\u4ee5\u51cf\u5c11 SYN+ACK \u7684\u91cd\u4f20\u6b21\u6570\uff0c\u4ee5\u52a0\u5feb\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684 TCP \u8fde\u63a5\u65ad\u5f00\u3002</p> <p></p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <p>[1] \u7cfb\u7edf\u6027\u80fd\u8c03\u4f18\u5fc5\u77e5\u5fc5\u4f1a\u3002\u9676\u8f89\u3002\u6781\u5ba2\u65f6\u95f4\u3002</p> <p>[2] https://www.cnblogs.com/zengkefu/p/5606696.html</p> <p>[3] https://blog.cloudflare.com/syn-packet-handling-in-the-wild/</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_queue/#_1","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u8bfb\u8005\u95ee\uff1a\u201c\u54a6 \u6211\u6bd4\u8f83\u597d\u5947\u535a\u4e3b\u90fd\u662f\u4ece\u54ea\u91cc\u5b66\u5230\u8fd9\u4e9b\u77e5\u8bc6\u7684\u5440\uff1f\u4e66\u7c4d\uff1f\u89c6\u9891\uff1f\u8fd8\u662f\u591a\u79cd\u53c2\u8003\u8d44\u6599\u201d</p> <p>\u4f60\u53ef\u4ee5\u770b\u6211\u7684\u53c2\u8003\u6587\u732e\u5440\uff0c\u77e5\u8bc6\u70b9\u6211\u4e3b\u8981\u662f\u5728\u6781\u5ba2\u4e13\u680f\u5b66\u7684\uff0c\u5b9e\u6218\u6a21\u62df\u5b9e\u9a8c\u548c\u6e90\u7801\u89e3\u6790\u662f\u81ea\u5df1\u778e\u6298\u817e\u51fa\u6765\u7684\u3002</p> <p>\u8bfb\u8005\u95ee\uff1a\u201csyncookies \u542f\u7528\u540e\u5c31\u4e0d\u9700\u8981\u534a\u94fe\u63a5\u4e86\uff1f\u90a3\u8bf7\u6c42\u7684\u6570\u636e\u4f1a\u5b58\u5728\u54ea\u91cc\uff1f\u201d</p> <p>syncookies = 1 \u65f6\uff0c\u534a\u8fde\u63a5\u961f\u5217\u6ee1\u540e\uff0c\u540e\u7eed\u7684\u8bf7\u6c42\u5c31\u4e0d\u4f1a\u5b58\u653e\u5230\u534a\u8fde\u63a5\u961f\u5217\u4e86\uff0c\u800c\u662f\u5728\u7b2c\u4e8c\u6b21\u63e1\u624b\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u4f1a\u8ba1\u7b97\u4e00\u4e2a cookie \u503c\uff0c\u653e\u5165\u5230 SYN +ACK \u5305\u4e2d\u7684\u5e8f\u5217\u53f7\u53d1\u7ed9\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\u5e76\u56de ack\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u6821\u9a8c\u8fde\u63a5\u662f\u5426\u5408\u6cd5\uff0c\u5408\u6cd5\u5c31\u76f4\u63a5\u628a\u8fde\u63a5\u653e\u5165\u5230\u5168\u8fde\u63a5\u961f\u5217\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_queue/#_2","title":"\u6700\u540e","text":"<p>\u672c\u6587\u662f\u4ee5 Linux 2.6.32 \u7248\u672c\u7684\u5185\u6838\u7528\u5b9e\u9a8c + \u6e90\u7801\u7684\u65b9\u5f0f\uff0c\u7ed9\u5927\u5bb6\u8bf4\u660e\u4e86 TCP \u534a\u8fde\u63a5\u961f\u5217\u548c\u5168\u8fde\u63a5\u961f\u5217\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230 TCP \u534a\u8fde\u63a5\u961f\u5217\u300c\u5e76\u4e0d\u662f\u300d\u5982\u7f51\u4e0a\u8bf4\u7684\u90a3\u6837 tcp_max_syn_backlog \u8868\u793a\u534a\u8fde\u63a5\u961f\u5217\u3002</p> <p>TCP \u534a\u8fde\u63a5\u961f\u5217\u7684\u5927\u5c0f\u5bf9\u4e8e\u4e0d\u540c\u7684 Linux \u5185\u6838\u7248\u672c\u4f1a\u6709\u4e0d\u540c\u7684\u8ba1\u7b97\u65b9\u5f0f\uff0c\u6240\u4ee5\u5e76\u4e0d\u8981\u6c42\u5927\u5bb6\u8981\u6b7b\u8bb0\u4f4f\u672c\u6587\u8ba1\u7b97 TCP \u534a\u8fde\u63a5\u961f\u5217\u7684\u5927\u5c0f\u3002</p> <p>\u91cd\u8981\u7684\u662f\u8981\u5b66\u4f1a\u81ea\u6211\u6e90\u7801\u5206\u6790\uff0c\u8fd9\u6837\u4e0d\u7ba1\u78b0\u5230\u4ec0\u4e48\u7248\u672c\u7684 Linux \u5185\u6838\uff0c\u90fd\u4e0d\u518d\u6015\u4e86\u3002</p> <p>\u7f51\u4e0a\u641c\u7d22\u51fa\u6765\u7684\u4fe1\u606f\uff0c\u5e76\u4e0d\u4e00\u5b9a\u9488\u5bf9\u4f60\u7684\u7cfb\u7edf\uff0c\u901a\u8fc7\u81ea\u6211\u5206\u6790\u4e00\u6ce2\uff0c\u4f60\u4f1a\u66f4\u4e86\u89e3\u4f60\u5f53\u524d\u4f7f\u7528\u7684 Linux \u5185\u6838\u7248\u672c\uff01</p> <p>\u5c0f\u6797\u662f\u4e13\u4e3a\u5927\u5bb6\u56fe\u89e3\u7684\u5de5\u5177\u4eba\uff0cGoodbye\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_stream/","title":"4.6 \u5982\u4f55\u7406\u89e3\u662f TCP \u9762\u5411\u5b57\u8282\u6d41\u534f\u8bae\uff1f","text":"<p>\u6709\u4e2a\u8bfb\u8005\u95ee\u6211\uff0c\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a</p> <p>TCP \u662f\u9762\u5411\u5b57\u8282\u6d41\u7684\u534f\u8bae\uff0cUDP \u662f\u9762\u5411\u62a5\u6587\u7684\u534f\u8bae\uff1f\u8fd9\u91cc\u7684\u300c\u9762\u5411\u5b57\u8282\u6d41\u300d\u548c\u300c\u9762\u5411\u62a5\u6587\u300d\u8be5\u5982\u4f55\u7406\u89e3\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_stream/#_1","title":"\u5982\u4f55\u7406\u89e3\u5b57\u8282\u6d41\uff1f","text":"<p>\u4e4b\u6240\u4ee5\u4f1a\u8bf4 TCP \u662f\u9762\u5411\u5b57\u8282\u6d41\u7684\u534f\u8bae\uff0cUDP \u662f\u9762\u5411\u62a5\u6587\u7684\u534f\u8bae\uff0c\u662f\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u5bf9 TCP \u548c UDP \u534f\u8bae\u7684\u53d1\u9001\u65b9\u7684\u673a\u5236\u4e0d\u540c\uff0c\u4e5f\u5c31\u662f\u95ee\u9898\u539f\u56e0\u5728\u53d1\u9001\u65b9\u3002</p> <p>\u5148\u6765\u8bf4\u8bf4\u4e3a\u4ec0\u4e48 UDP \u662f\u9762\u5411\u62a5\u6587\u7684\u534f\u8bae\uff1f</p> <p>\u5f53\u7528\u6237\u6d88\u606f\u901a\u8fc7 UDP \u534f\u8bae\u4f20\u8f93\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u4e0d\u4f1a\u5bf9\u6d88\u606f\u8fdb\u884c\u62c6\u5206\uff0c\u5728\u7ec4\u88c5\u597d UDP \u5934\u90e8\u540e\u5c31\u4ea4\u7ed9\u7f51\u7edc\u5c42\u6765\u5904\u7406\uff0c\u6240\u4ee5\u53d1\u51fa\u53bb\u7684 UDP \u62a5\u6587\u4e2d\u7684\u6570\u636e\u90e8\u5206\u5c31\u662f\u5b8c\u6574\u7684\u7528\u6237\u6d88\u606f\uff0c\u4e5f\u5c31\u662f\u6bcf\u4e2a UDP \u62a5\u6587\u5c31\u662f\u4e00\u4e2a\u7528\u6237\u6d88\u606f\u7684\u8fb9\u754c\uff0c\u8fd9\u6837\u63a5\u6536\u65b9\u5728\u63a5\u6536\u5230 UDP \u62a5\u6587\u540e\uff0c\u8bfb\u4e00\u4e2a UDP \u62a5\u6587\u5c31\u80fd\u8bfb\u53d6\u5230\u5b8c\u6574\u7684\u7528\u6237\u6d88\u606f\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u95ee\uff0c\u5982\u679c\u6536\u5230\u4e86\u4e24\u4e2a UDP \u62a5\u6587\uff0c\u64cd\u4f5c\u7cfb\u7edf\u662f\u600e\u4e48\u533a\u5206\u5f00\u7684\uff1f</p> <p>\u64cd\u4f5c\u7cfb\u7edf\u5728\u6536\u5230 UDP \u62a5\u6587\u540e\uff0c\u4f1a\u5c06\u5176\u63d2\u5165\u5230\u961f\u5217\u91cc\uff0c\u961f\u5217\u91cc\u7684\u6bcf\u4e00\u4e2a\u5143\u7d20\u5c31\u662f\u4e00\u4e2a UDP \u62a5\u6587\uff0c\u8fd9\u6837\u5f53\u7528\u6237\u8c03\u7528 recvfrom() \u7cfb\u7edf\u8c03\u7528\u8bfb\u6570\u636e\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u4ece\u961f\u5217\u91cc\u53d6\u51fa\u4e00\u4e2a\u6570\u636e\uff0c\u7136\u540e\u4ece\u5185\u6838\u91cc\u62f7\u8d1d\u7ed9\u7528\u6237\u7f13\u51b2\u533a\u3002</p> <p></p> <p>\u518d\u6765\u8bf4\u8bf4\u4e3a\u4ec0\u4e48 TCP \u662f\u9762\u5411\u5b57\u8282\u6d41\u7684\u534f\u8bae\uff1f</p> <p>\u5f53\u7528\u6237\u6d88\u606f\u901a\u8fc7 TCP \u534f\u8bae\u4f20\u8f93\u65f6\uff0c\u6d88\u606f\u53ef\u80fd\u4f1a\u88ab\u64cd\u4f5c\u7cfb\u7edf\u5206\u7ec4\u6210\u591a\u4e2a\u7684 TCP \u62a5\u6587\uff0c\u4e5f\u5c31\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u7528\u6237\u6d88\u606f\u88ab\u62c6\u5206\u6210\u591a\u4e2a TCP \u62a5\u6587\u8fdb\u884c\u4f20\u8f93\u3002</p> <p>\u8fd9\u65f6\uff0c\u63a5\u6536\u65b9\u7684\u7a0b\u5e8f\u5982\u679c\u4e0d\u77e5\u9053\u53d1\u9001\u65b9\u53d1\u9001\u7684\u6d88\u606f\u7684\u957f\u5ea6\uff0c\u4e5f\u5c31\u662f\u4e0d\u77e5\u9053\u6d88\u606f\u7684\u8fb9\u754c\u65f6\uff0c\u662f\u65e0\u6cd5\u8bfb\u51fa\u4e00\u4e2a\u6709\u6548\u7684\u7528\u6237\u6d88\u606f\u7684\uff0c\u56e0\u4e3a\u7528\u6237\u6d88\u606f\u88ab\u62c6\u5206\u6210\u591a\u4e2a TCP \u62a5\u6587\u540e\uff0c\u5e76\u4e0d\u80fd\u50cf UDP \u90a3\u6837\uff0c\u4e00\u4e2a UDP \u62a5\u6587\u5c31\u80fd\u4ee3\u8868\u4e00\u4e2a\u5b8c\u6574\u7684\u7528\u6237\u6d88\u606f\u3002</p> <p>\u4e3e\u4e2a\u5b9e\u9645\u7684\u4f8b\u5b50\u6765\u8bf4\u660e\u3002</p> <p>\u53d1\u9001\u65b9\u51c6\u5907\u53d1\u9001\u300cHi.\u300d\u548c\u300cI am Xiaolin\u300d\u8fd9\u4e24\u4e2a\u6d88\u606f\u3002</p> <p>\u5728\u53d1\u9001\u7aef\uff0c\u5f53\u6211\u4eec\u8c03\u7528 send \u51fd\u6570\u5b8c\u6210\u6570\u636e\u201c\u53d1\u9001\u201d\u4ee5\u540e\uff0c\u6570\u636e\u5e76\u6ca1\u6709\u88ab\u771f\u6b63\u4ece\u7f51\u7edc\u4e0a\u53d1\u9001\u51fa\u53bb\uff0c\u53ea\u662f\u4ece\u5e94\u7528\u7a0b\u5e8f\u62f7\u8d1d\u5230\u4e86\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u534f\u8bae\u6808\u4e2d\u3002</p> <p>\u81f3\u4e8e\u4ec0\u4e48\u65f6\u5019\u771f\u6b63\u88ab\u53d1\u9001\uff0c\u53d6\u51b3\u4e8e\u53d1\u9001\u7a97\u53e3\u3001\u62e5\u585e\u7a97\u53e3\u4ee5\u53ca\u5f53\u524d\u53d1\u9001\u7f13\u51b2\u533a\u7684\u5927\u5c0f\u7b49\u6761\u4ef6\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u6211\u4eec\u4e0d\u80fd\u8ba4\u4e3a\u6bcf\u6b21 send \u8c03\u7528\u53d1\u9001\u7684\u6570\u636e\uff0c\u90fd\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u6574\u4f53\u5b8c\u6574\u5730\u6d88\u606f\u88ab\u53d1\u9001\u51fa\u53bb\u3002</p> <p>\u5982\u679c\u6211\u4eec\u8003\u8651\u5b9e\u9645\u7f51\u7edc\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u7684\u5404\u79cd\u5f71\u54cd\uff0c\u5047\u8bbe\u53d1\u9001\u7aef\u9646\u7eed\u8c03\u7528 send \u51fd\u6570\u5148\u540e\u53d1\u9001\u300cHi.\u300d\u548c\u300cI am Xiaolin\u300d\u62a5\u6587\uff0c\u90a3\u4e48\u5b9e\u9645\u7684\u53d1\u9001\u5f88\u6709\u53ef\u80fd\u662f\u8fd9\u51e0\u79cd\u60c5\u51b5\u3002</p> <p>\u7b2c\u4e00\u79cd\u60c5\u51b5\uff0c\u8fd9\u4e24\u4e2a\u6d88\u606f\u88ab\u5206\u5230\u540c\u4e00\u4e2a TCP \u62a5\u6587\uff0c\u50cf\u8fd9\u6837\uff1a</p> <p></p> <p>\u7b2c\u4e8c\u79cd\u60c5\u51b5\uff0c\u300cI am Xiaolin\u300d\u7684\u90e8\u5206\u968f\u300cHi\u300d\u5728\u4e00\u4e2a TCP \u62a5\u6587\u4e2d\u53d1\u9001\u51fa\u53bb\uff0c\u50cf\u8fd9\u6837\uff1a</p> <p></p> <p>\u7b2c\u4e09\u79cd\u60c5\u51b5\uff0c\u300cHi.\u300d\u7684\u4e00\u90e8\u5206\u968f TCP \u62a5\u6587\u88ab\u53d1\u9001\u51fa\u53bb\uff0c\u53e6\u4e00\u90e8\u5206\u548c\u300cI am Xiaolin\u300d\u4e00\u8d77\u968f\u53e6\u4e00\u4e2a TCP \u62a5\u6587\u53d1\u9001\u51fa\u53bb\uff0c\u50cf\u8fd9\u6837\u3002</p> <p></p> <p>\u7c7b\u4f3c\u7684\u60c5\u51b5\u8fd8\u80fd\u4e3e\u4f8b\u5f88\u591a\u79cd\uff0c\u8fd9\u91cc\u4e3b\u8981\u662f\u60f3\u8bf4\u660e\uff0c\u6211\u4eec\u4e0d\u77e5\u9053\u300cHi.\u300d\u548c\u300cI am Xiaolin\u300d\u8fd9\u4e24\u4e2a\u7528\u6237\u6d88\u606f\u662f\u5982\u4f55\u8fdb\u884c TCP \u5206\u7ec4\u4f20\u8f93\u7684\u3002</p> <p>\u56e0\u6b64\uff0c\u6211\u4eec\u4e0d\u80fd\u8ba4\u4e3a\u4e00\u4e2a\u7528\u6237\u6d88\u606f\u5bf9\u5e94\u4e00\u4e2a TCP \u62a5\u6587\uff0c\u6b63\u56e0\u4e3a\u8fd9\u6837\uff0c\u6240\u4ee5 TCP \u662f\u9762\u5411\u5b57\u8282\u6d41\u7684\u534f\u8bae\u3002</p> <p>\u5f53\u4e24\u4e2a\u6d88\u606f\u7684\u67d0\u4e2a\u90e8\u5206\u5185\u5bb9\u88ab\u5206\u5230\u540c\u4e00\u4e2a TCP \u62a5\u6587\u65f6\uff0c\u5c31\u662f\u6211\u4eec\u5e38\u8bf4\u7684 TCP \u7c98\u5305\u95ee\u9898\uff0c\u8fd9\u65f6\u63a5\u6536\u65b9\u4e0d\u77e5\u9053\u6d88\u606f\u7684\u8fb9\u754c\u7684\u8bdd\uff0c\u662f\u65e0\u6cd5\u8bfb\u51fa\u6709\u6548\u7684\u6d88\u606f\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u8981\u4ea4\u7ed9\u5e94\u7528\u7a0b\u5e8f\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_stream/#_2","title":"\u5982\u4f55\u89e3\u51b3\u7c98\u5305\uff1f","text":"<p>\u7c98\u5305\u7684\u95ee\u9898\u51fa\u73b0\u662f\u56e0\u4e3a\u4e0d\u77e5\u9053\u4e00\u4e2a\u7528\u6237\u6d88\u606f\u7684\u8fb9\u754c\u5728\u54ea\uff0c\u5982\u679c\u77e5\u9053\u4e86\u8fb9\u754c\u5728\u54ea\uff0c\u63a5\u6536\u65b9\u5c31\u53ef\u4ee5\u901a\u8fc7\u8fb9\u754c\u6765\u5212\u5206\u51fa\u6709\u6548\u7684\u7528\u6237\u6d88\u606f\u3002</p> <p>\u4e00\u822c\u6709\u4e09\u79cd\u65b9\u5f0f\u5206\u5305\u7684\u65b9\u5f0f\uff1a</p> <ul> <li>\u56fa\u5b9a\u957f\u5ea6\u7684\u6d88\u606f\uff1b</li> <li>\u7279\u6b8a\u5b57\u7b26\u4f5c\u4e3a\u8fb9\u754c\uff1b</li> <li>\u81ea\u5b9a\u4e49\u6d88\u606f\u7ed3\u6784\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_stream/#_3","title":"\u56fa\u5b9a\u957f\u5ea6\u7684\u6d88\u606f","text":"<p>\u8fd9\u79cd\u662f\u6700\u7b80\u5355\u65b9\u6cd5\uff0c\u5373\u6bcf\u4e2a\u7528\u6237\u6d88\u606f\u90fd\u662f\u56fa\u5b9a\u957f\u5ea6\u7684\uff0c\u6bd4\u5982\u89c4\u5b9a\u4e00\u4e2a\u6d88\u606f\u7684\u957f\u5ea6\u662f 64 \u4e2a\u5b57\u8282\uff0c\u5f53\u63a5\u6536\u65b9\u63a5\u6ee1 64 \u4e2a\u5b57\u8282\uff0c\u5c31\u8ba4\u4e3a\u8fd9\u4e2a\u5185\u5bb9\u662f\u4e00\u4e2a\u5b8c\u6574\u4e14\u6709\u6548\u7684\u6d88\u606f\u3002</p> <p>\u4f46\u662f\u8fd9\u79cd\u65b9\u5f0f\u7075\u6d3b\u6027\u4e0d\u9ad8\uff0c\u5b9e\u9645\u4e2d\u5f88\u5c11\u7528\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_stream/#_4","title":"\u7279\u6b8a\u5b57\u7b26\u4f5c\u4e3a\u8fb9\u754c","text":"<p>\u6211\u4eec\u53ef\u4ee5\u5728\u4e24\u4e2a\u7528\u6237\u6d88\u606f\u4e4b\u95f4\u63d2\u5165\u4e00\u4e2a\u7279\u6b8a\u7684\u5b57\u7b26\u4e32\uff0c\u8fd9\u6837\u63a5\u6536\u65b9\u5728\u63a5\u6536\u6570\u636e\u65f6\uff0c\u8bfb\u5230\u4e86\u8fd9\u4e2a\u7279\u6b8a\u5b57\u7b26\uff0c\u5c31\u628a\u8ba4\u4e3a\u5df2\u7ecf\u8bfb\u5b8c\u4e00\u4e2a\u5b8c\u6574\u7684\u6d88\u606f\u3002</p> <p>HTTP \u662f\u4e00\u4e2a\u975e\u5e38\u597d\u7684\u4f8b\u5b50\u3002</p> <p></p> <p>HTTP \u901a\u8fc7\u8bbe\u7f6e\u56de\u8f66\u7b26\u3001\u6362\u884c\u7b26\u4f5c\u4e3a HTTP \u62a5\u6587\u534f\u8bae\u7684\u8fb9\u754c\u3002</p> <p>\u6709\u4e00\u70b9\u8981\u6ce8\u610f\uff0c\u8fd9\u4e2a\u4f5c\u4e3a\u8fb9\u754c\u70b9\u7684\u7279\u6b8a\u5b57\u7b26\uff0c\u5982\u679c\u521a\u597d\u6d88\u606f\u5185\u5bb9\u91cc\u6709\u8fd9\u4e2a\u7279\u6b8a\u5b57\u7b26\uff0c\u6211\u4eec\u8981\u5bf9\u8fd9\u4e2a\u5b57\u7b26\u8f6c\u4e49\uff0c\u907f\u514d\u88ab\u63a5\u6536\u65b9\u5f53\u4f5c\u6d88\u606f\u7684\u8fb9\u754c\u70b9\u800c\u89e3\u6790\u5230\u65e0\u6548\u7684\u6570\u636e\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_stream/#_5","title":"\u81ea\u5b9a\u4e49\u6d88\u606f\u7ed3\u6784","text":"<p>\u6211\u4eec\u53ef\u4ee5\u81ea\u5b9a\u4e49\u4e00\u4e2a\u6d88\u606f\u7ed3\u6784\uff0c\u7531\u5305\u5934\u548c\u6570\u636e\u7ec4\u6210\uff0c\u5176\u4e2d\u5305\u5934\u5305\u662f\u56fa\u5b9a\u5927\u5c0f\u7684\uff0c\u800c\u4e14\u5305\u5934\u91cc\u6709\u4e00\u4e2a\u5b57\u6bb5\u6765\u8bf4\u660e\u7d27\u968f\u5176\u540e\u7684\u6570\u636e\u6709\u591a\u5927\u3002</p> <p>\u6bd4\u5982\u8fd9\u4e2a\u6d88\u606f\u7ed3\u6784\u4f53\uff0c\u9996\u5148 4 \u4e2a\u5b57\u8282\u5927\u5c0f\u7684\u53d8\u91cf\u6765\u8868\u793a\u6570\u636e\u957f\u5ea6\uff0c\u771f\u6b63\u7684\u6570\u636e\u5219\u5728\u540e\u9762\u3002</p> C<pre><code>struct { \n    u_int32_t message_length; \n    char message_data[]; \n} message;\n</code></pre> <p>\u5f53\u63a5\u6536\u65b9\u63a5\u6536\u5230\u5305\u5934\u7684\u5927\u5c0f\uff08\u6bd4\u5982 4 \u4e2a\u5b57\u8282\uff09\u540e\uff0c\u5c31\u89e3\u6790\u5305\u5934\u7684\u5185\u5bb9\uff0c\u4e8e\u662f\u5c31\u53ef\u4ee5\u77e5\u9053\u6570\u636e\u7684\u957f\u5ea6\uff0c\u7136\u540e\u63a5\u4e0b\u6765\u5c31\u7ee7\u7eed\u8bfb\u53d6\u6570\u636e\uff0c\u76f4\u5230\u8bfb\u6ee1\u6570\u636e\u7684\u957f\u5ea6\uff0c\u5c31\u53ef\u4ee5\u7ec4\u88c5\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u7528\u6237\u6d88\u606f\u6765\u5904\u7406\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/","title":"4.3 TCP \u5b9e\u6218\u6293\u5305\u5206\u6790","text":"<p>\u4e3a\u4e86\u8ba9\u5927\u5bb6\u66f4\u5bb9\u6613\u300c\u770b\u5f97\u89c1\u300dTCP\uff0c\u6211\u642d\u5efa\u4e0d\u5c11\u6d4b\u8bd5\u73af\u5883\uff0c\u5e76\u4e14\u6570\u636e\u5305\u6293\u5f88\u591a\u6b21\uff0c\u82b1\u8d39\u4e86\u4e0d\u5c11\u65f6\u95f4\uff0c\u624d\u6293\u5230\u6bd4\u8f83\u5bb9\u6613\u5206\u6790\u7684\u6570\u636e\u5305\u3002</p> <p>\u63a5\u4e0b\u6765\u4e22\u5305\u3001\u4e71\u5e8f\u3001\u8d85\u65f6\u91cd\u4f20\u3001\u5feb\u901f\u91cd\u4f20\u3001\u9009\u62e9\u6027\u786e\u8ba4\u3001\u6d41\u91cf\u63a7\u5236\u7b49\u7b49 TCP \u7684\u7279\u6027\uff0c\u90fd\u80fd\u300c\u4e00\u89c8\u65e0\u4f59\u300d\u3002</p> <p>\u6ca1\u9519\uff0c\u6211\u628a TCP \u7684\"\u8863\u670d\u6252\u5149\"\u4e86\uff0c\u5c31\u4e3a\u4e86\u7ed9\u5927\u5bb6\u770b\u7684\u6e05\u695a\uff0c\u563b\u563b\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#_1","title":"\u663e\u5f62\u201c\u4e0d\u53ef\u89c1\u201d\u7684\u7f51\u7edc\u5305","text":"<p>\u7f51\u7edc\u4e16\u754c\u4e2d\u7684\u6570\u636e\u5305\u4ea4\u4e92\u6211\u4eec\u8089\u773c\u662f\u770b\u4e0d\u89c1\u7684\uff0c\u5b83\u4eec\u5c31\u597d\u50cf\u9690\u5f62\u4e86\u4e00\u6837\uff0c\u6211\u4eec\u5bf9\u7740\u8bfe\u672c\u5b66\u4e60\u8ba1\u7b97\u673a\u7f51\u7edc\u7684\u65f6\u5019\u5c31\u4f1a\u89c9\u5f97\u975e\u5e38\u7684\u62bd\u8c61\uff0c\u52a0\u5927\u4e86\u5b66\u4e60\u7684\u96be\u5ea6\u3002</p> <p>\u8fd8\u522b\u8bf4\uff0c\u6211\u81ea\u5df1\u5728\u5927\u5b66\u7684\u65f6\u5019\uff0c\u4e5f\u662f\u5982\u6b64\u3002</p> <p>\u76f4\u5230\u5de5\u4f5c\u540e\uff0c\u8ba4\u8bc6\u4e86\u4e24\u5927\u5206\u6790\u7f51\u7edc\u7684\u5229\u5668\uff1atcpdump \u548c Wireshark\uff0c\u8fd9\u4e24\u5927\u5229\u5668\u628a\u6211\u4eec\u201c\u770b\u4e0d\u89c1\u201d\u7684\u6570\u636e\u5305\uff0c\u5448\u73b0\u5728\u6211\u4eec\u773c\u524d\uff0c\u4e00\u76ee\u4e86\u7136\u3002</p> <p>\u5509\uff0c\u5f53\u521d\u5927\u5b66\u5b66\u4e60\u8ba1\u7f51\u7684\u65f6\u5019\uff0c\u8981\u662f\u80fd\u77e5\u9053\u8fd9\u4e24\u4e2a\u5de5\u5177\uff0c\u5c31\u4e0d\u4f1a\u5b66\u7684\u4e00\u8138\u61f5\u903c\u3002</p> <p>tcpdump \u548c Wireshark \u6709\u4ec0\u4e48\u533a\u522b\uff1f</p> <p>tcpdump \u548c Wireshark \u5c31\u662f\u6700\u5e38\u7528\u7684\u7f51\u7edc\u6293\u5305\u548c\u5206\u6790\u5de5\u5177\uff0c\u66f4\u662f\u5206\u6790\u7f51\u7edc\u6027\u80fd\u5fc5\u4e0d\u53ef\u5c11\u7684\u5229\u5668\u3002</p> <ul> <li>tcpdump \u4ec5\u652f\u6301\u547d\u4ee4\u884c\u683c\u5f0f\u4f7f\u7528\uff0c\u5e38\u7528\u5728 Linux \u670d\u52a1\u5668\u4e2d\u6293\u53d6\u548c\u5206\u6790\u7f51\u7edc\u5305\u3002</li> <li>Wireshark \u9664\u4e86\u53ef\u4ee5\u6293\u5305\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u53ef\u89c6\u5316\u5206\u6790\u7f51\u7edc\u5305\u7684\u56fe\u5f62\u9875\u9762\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u8fd9\u4e24\u8005\u5b9e\u9645\u4e0a\u662f\u642d\u914d\u4f7f\u7528\u7684\uff0c\u5148\u7528 tcpdump \u547d\u4ee4\u5728 Linux \u670d\u52a1\u5668\u4e0a\u6293\u5305\uff0c\u63a5\u7740\u628a\u6293\u5305\u7684\u6587\u4ef6\u62d6\u51fa\u5230 Windows \u7535\u8111\u540e\uff0c\u7528 Wireshark \u53ef\u89c6\u5316\u5206\u6790\u3002</p> <p>\u5f53\u7136\uff0c\u5982\u679c\u4f60\u662f\u5728 Windows \u4e0a\u6293\u5305\uff0c\u53ea\u9700\u8981\u7528 Wireshark \u5de5\u5177\u5c31\u53ef\u4ee5\u3002</p> <p>tcpdump \u5728 Linux \u4e0b\u5982\u4f55\u6293\u5305\uff1f</p> <p>tcpdump \u63d0\u4f9b\u4e86\u5927\u91cf\u7684\u9009\u9879\u4ee5\u53ca\u5404\u5f0f\u5404\u6837\u7684\u8fc7\u6ee4\u8868\u8fbe\u5f0f\uff0c\u6765\u5e2e\u52a9\u4f60\u6293\u53d6\u6307\u5b9a\u7684\u6570\u636e\u5305\uff0c\u4e0d\u8fc7\u4e0d\u8981\u62c5\u5fc3\uff0c\u53ea\u9700\u8981\u638c\u63e1\u4e00\u4e9b\u5e38\u7528\u9009\u9879\u548c\u8fc7\u6ee4\u8868\u8fbe\u5f0f\uff0c\u5c31\u53ef\u4ee5\u6ee1\u8db3\u5927\u90e8\u5206\u573a\u666f\u7684\u9700\u8981\u4e86\u3002</p> <p>\u5047\u8bbe\u6211\u4eec\u8981\u6293\u53d6\u4e0b\u9762\u7684 ping \u7684\u6570\u636e\u5305\uff1a</p> <p></p> <p>\u8981\u6293\u53d6\u4e0a\u9762\u7684 ping \u547d\u4ee4\u6570\u636e\u5305\uff0c\u9996\u5148\u6211\u4eec\u8981\u77e5\u9053 ping \u7684\u6570\u636e\u5305\u662f <code>icmp</code> \u534f\u8bae\uff0c\u63a5\u7740\u5728\u4f7f\u7528 tcpdump \u6293\u5305\u7684\u65f6\u5019\uff0c\u5c31\u53ef\u4ee5\u6307\u5b9a\u53ea\u6293 icmp \u534f\u8bae\u7684\u6570\u636e\u5305\uff1a</p> <p></p> <p>\u90a3\u4e48\u5f53 tcpdump \u6293\u53d6\u5230 icmp \u6570\u636e\u5305\u540e\uff0c\u8f93\u51fa\u683c\u5f0f\u5982\u4e0b\uff1a</p> <p></p> <p></p> <p>\u4ece tcpdump \u6293\u53d6\u7684 icmp \u6570\u636e\u5305\uff0c\u6211\u4eec\u5f88\u6e05\u695a\u7684\u770b\u5230 <code>icmp echo</code> \u7684\u4ea4\u4e92\u8fc7\u7a0b\u4e86\uff0c\u9996\u5148\u53d1\u9001\u65b9\u53d1\u8d77\u4e86 <code>ICMP echo request</code> \u8bf7\u6c42\u62a5\u6587\uff0c\u63a5\u6536\u65b9\u6536\u5230\u540e\u56de\u4e86\u4e00\u4e2a <code>ICMP echo reply</code> \u54cd\u5e94\u62a5\u6587\uff0c\u4e4b\u540e <code>seq</code> \u662f\u9012\u589e\u7684\u3002</p> <p>\u6211\u5728\u8fd9\u91cc\u4e5f\u5e2e\u4f60\u6574\u7406\u4e86\u4e00\u4e9b\u6700\u5e38\u89c1\u7684\u7528\u6cd5\uff0c\u5e76\u4e14\u7ed8\u5236\u6210\u4e86\u8868\u683c\uff0c\u4f60\u53ef\u4ee5\u53c2\u8003\u4f7f\u7528\u3002</p> <p>\u9996\u5148\uff0c\u5148\u6765\u770b\u770b\u5e38\u7528\u7684\u9009\u9879\u7c7b\uff0c\u5728\u4e0a\u9762\u7684 ping \u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u7528\u8fc7 <code>-i</code> \u9009\u9879\u6307\u5b9a\u7f51\u53e3\uff0c\u7528\u8fc7 <code>-nn</code> \u9009\u9879\u4e0d\u5bf9 IP \u5730\u5740\u548c\u7aef\u53e3\u540d\u79f0\u89e3\u6790\u3002\u5176\u4ed6\u5e38\u7528\u7684\u9009\u9879\uff0c\u5982\u4e0b\u8868\u683c\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b\u5e38\u7528\u7684\u8fc7\u6ee4\u8868\u7528\u6cd5\uff0c\u5728\u4e0a\u9762\u7684 ping \u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u7528\u8fc7\u7684\u662f <code>icmp and host 183.232.231.174</code>\uff0c\u8868\u793a\u6293\u53d6 icmp \u534f\u8bae\u7684\u6570\u636e\u5305\uff0c\u4ee5\u53ca\u6e90\u5730\u5740\u6216\u76ee\u6807\u5730\u5740\u4e3a 183.232.231.174 \u7684\u5305\u3002\u5176\u4ed6\u5e38\u7528\u7684\u8fc7\u6ee4\u9009\u9879\uff0c\u6211\u4e5f\u6574\u7406\u6210\u4e86\u4e0b\u9762\u8fd9\u4e2a\u8868\u683c\u3002</p> <p></p> <p>\u8bf4\u4e86\u8fd9\u4e48\u591a\uff0c\u4f60\u5e94\u8be5\u4e5f\u53d1\u73b0\u4e86\uff0ctcpdump \u867d\u7136\u529f\u80fd\u5f3a\u5927\uff0c\u4f46\u662f\u8f93\u51fa\u7684\u683c\u5f0f\u5e76\u4e0d\u76f4\u89c2\u3002</p> <p>\u6240\u4ee5\uff0c\u5728\u5de5\u4f5c\u4e2d tcpdump \u53ea\u662f\u7528\u6765\u6293\u53d6\u6570\u636e\u5305\uff0c\u4e0d\u7528\u6765\u5206\u6790\u6570\u636e\u5305\uff0c\u800c\u662f\u628a tcpdump \u6293\u53d6\u7684\u6570\u636e\u5305\u4fdd\u5b58\u6210 pcap \u540e\u7f00\u7684\u6587\u4ef6\uff0c\u63a5\u7740\u7528 Wireshark \u5de5\u5177\u8fdb\u884c\u6570\u636e\u5305\u5206\u6790\u3002</p> <p>Wireshark \u5de5\u5177\u5982\u4f55\u5206\u6790\u6570\u636e\u5305\uff1f</p> <p>Wireshark \u9664\u4e86\u53ef\u4ee5\u6293\u5305\u5916\uff0c\u8fd8\u63d0\u4f9b\u4e86\u53ef\u89c6\u5316\u5206\u6790\u7f51\u7edc\u5305\u7684\u56fe\u5f62\u9875\u9762\uff0c\u540c\u65f6\uff0c\u8fd8\u5185\u7f6e\u4e86\u4e00\u7cfb\u5217\u7684\u6c47\u603b\u5206\u6790\u5de5\u5177\u3002</p> <p>\u6bd4\u5982\uff0c\u62ff\u4e0a\u9762\u7684 ping \u4f8b\u5b50\u6765\u8bf4\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\uff0c\u628a\u6293\u53d6\u7684\u6570\u636e\u5305\u4fdd\u5b58\u5230 ping.pcap \u6587\u4ef6</p> <p></p> <p>\u63a5\u7740\u628a ping.pcap \u6587\u4ef6\u62d6\u5230\u7535\u8111\uff0c\u518d\u7528 Wireshark \u6253\u5f00\u5b83\u3002\u6253\u5f00\u540e\uff0c\u4f60\u5c31\u53ef\u4ee5\u770b\u5230\u4e0b\u9762\u8fd9\u4e2a\u754c\u9762\uff1a</p> <p></p> <p>\u662f\u5427\uff1f\u5728 Wireshark \u7684\u9875\u9762\u91cc\uff0c\u53ef\u4ee5\u66f4\u52a0\u76f4\u89c2\u7684\u5206\u6790\u6570\u636e\u5305\uff0c\u4e0d\u4ec5\u5c55\u793a\u5404\u4e2a\u7f51\u7edc\u5305\u7684\u5934\u90e8\u4fe1\u606f\uff0c\u8fd8\u4f1a\u7528\u4e0d\u540c\u7684\u989c\u8272\u6765\u533a\u5206\u4e0d\u540c\u7684\u534f\u8bae\uff0c\u7531\u4e8e\u8fd9\u6b21\u6293\u5305\u53ea\u6709 ICMP \u534f\u8bae\uff0c\u6240\u4ee5\u53ea\u6709\u7d2b\u8272\u7684\u6761\u76ee\u3002</p> <p>\u63a5\u7740\uff0c\u5728\u7f51\u7edc\u5305\u5217\u8868\u4e2d\u9009\u62e9\u67d0\u4e00\u4e2a\u7f51\u7edc\u5305\u540e\uff0c\u5728\u5176\u4e0b\u9762\u7684\u7f51\u7edc\u5305\u8be6\u60c5\u4e2d\uff0c\u53ef\u4ee5\u66f4\u6e05\u695a\u7684\u770b\u5230\uff0c\u8fd9\u4e2a\u7f51\u7edc\u5305\u5728\u534f\u8bae\u6808\u5404\u5c42\u7684\u8be6\u7ec6\u4fe1\u606f\u3002\u6bd4\u5982\uff0c\u4ee5\u7f16\u53f7 1 \u7684\u7f51\u7edc\u5305\u4e3a\u4f8b\u5b50\uff1a</p> <p></p> <ul> <li>\u53ef\u4ee5\u5728\u6570\u636e\u94fe\u8def\u5c42\uff0c\u770b\u5230 MAC \u5305\u5934\u4fe1\u606f\uff0c\u5982\u6e90 MAC \u5730\u5740\u548c\u76ee\u6807 MAC \u5730\u5740\u7b49\u5b57\u6bb5\uff1b</li> <li>\u53ef\u4ee5\u5728 IP \u5c42\uff0c\u770b\u5230 IP \u5305\u5934\u4fe1\u606f\uff0c\u5982\u6e90 IP \u5730\u5740\u548c\u76ee\u6807 IP \u5730\u5740\u3001TTL\u3001IP \u5305\u957f\u5ea6\u3001\u534f\u8bae\u7b49 IP \u534f\u8bae\u5404\u4e2a\u5b57\u6bb5\u7684\u6570\u503c\u548c\u542b\u4e49\uff1b</li> <li>\u53ef\u4ee5\u5728 ICMP \u5c42\uff0c\u770b\u5230 ICMP \u5305\u5934\u4fe1\u606f\uff0c\u6bd4\u5982 Type\u3001Code \u7b49 ICMP \u534f\u8bae\u5404\u4e2a\u5b57\u6bb5\u7684\u6570\u503c\u548c\u542b\u4e49\uff1b</li> </ul> <p>Wireshark \u7528\u4e86\u5206\u5c42\u7684\u65b9\u5f0f\uff0c\u5c55\u793a\u4e86\u5404\u4e2a\u5c42\u7684\u5305\u5934\u4fe1\u606f\uff0c\u628a\u201c\u4e0d\u53ef\u89c1\u201d\u7684\u6570\u636e\u5305\uff0c\u6e05\u6e05\u695a\u695a\u7684\u5c55\u793a\u4e86\u7ed9\u6211\u4eec\uff0c\u8fd8\u6709\u7406\u7531\u5b66\u4e0d\u597d\u8ba1\u7b97\u673a\u7f51\u7edc\u5417\uff1f\u662f\u4e0d\u662f\u76f8\u89c1\u6068\u665a\uff1f</p> <p>\u4ece ping \u7684\u4f8b\u5b50\u4e2d\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u5230\u7f51\u7edc\u5206\u5c42\u5c31\u50cf\u6709\u5e8f\u7684\u5206\u5de5\uff0c\u6bcf\u4e00\u5c42\u90fd\u6709\u81ea\u5df1\u7684\u8d23\u4efb\u8303\u56f4\u548c\u4fe1\u606f\uff0c\u4e0a\u5c42\u534f\u8bae\u5b8c\u6210\u5de5\u4f5c\u540e\u5c31\u4ea4\u7ed9\u4e0b\u4e00\u5c42\uff0c\u6700\u7ec8\u5f62\u6210\u4e00\u4e2a\u5b8c\u6574\u7684\u7f51\u7edc\u5305\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#tcp","title":"\u89e3\u5bc6 TCP \u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b","text":"<p>\u65e2\u7136\u5b66\u4f1a\u4e86 tcpdump \u548c Wireshark \u4e24\u5927\u7f51\u7edc\u5206\u6790\u5229\u5668\uff0c\u90a3\u6211\u4eec\u5feb\u9a6c\u52a0\u97ad\uff0c\u63a5\u4e0b\u6765\u7528\u5b83\u4fe9\u6293\u53d6\u548c\u5206\u6790 HTTP \u534f\u8bae\u7f51\u7edc\u5305\uff0c\u5e76\u7406\u89e3 TCP \u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u7684\u5de5\u4f5c\u539f\u7406\u3002</p> <p>\u672c\u6b21\u4f8b\u5b50\uff0c\u6211\u4eec\u5c06\u8981\u8bbf\u95ee\u7684 http://192.168.3.200 \u670d\u52a1\u7aef\u3002\u5728\u7ec8\u7aef\u4e00\u7528 tcpdump \u547d\u4ee4\u6293\u53d6\u6570\u636e\u5305\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u5728\u7ec8\u7aef\u4e8c\u6267\u884c\u4e0b\u9762\u7684 curl \u547d\u4ee4\uff1a</p> <p></p> <p>\u6700\u540e\uff0c\u56de\u5230\u7ec8\u7aef\u4e00\uff0c\u6309\u4e0b Ctrl+C \u505c\u6b62 tcpdump\uff0c\u5e76\u628a\u5f97\u5230\u7684 http.pcap \u53d6\u51fa\u5230\u7535\u8111\u3002</p> <p>\u4f7f\u7528 Wireshark \u6253\u5f00 http.pcap \u540e\uff0c\u4f60\u5c31\u53ef\u4ee5\u5728 Wireshark \u4e2d\uff0c\u770b\u5230\u5982\u4e0b\u7684\u754c\u9762\uff1a</p> <p></p> <p>\u6211\u4eec\u90fd\u77e5\u9053 HTTP \u662f\u57fa\u4e8e TCP \u534f\u8bae\u8fdb\u884c\u4f20\u8f93\u7684\uff0c\u90a3\u4e48\uff1a</p> <ul> <li>\u6700\u5f00\u59cb\u7684 3 \u4e2a\u5305\u5c31\u662f TCP \u4e09\u6b21\u63e1\u624b\u5efa\u7acb\u8fde\u63a5\u7684\u5305</li> <li>\u4e2d\u95f4\u662f HTTP \u8bf7\u6c42\u548c\u54cd\u5e94\u7684\u5305</li> <li>\u800c\u6700\u540e\u7684 3 \u4e2a\u5305\u5219\u662f TCP \u65ad\u5f00\u8fde\u63a5\u7684\u6325\u624b\u5305</li> </ul> <p>Wireshark \u53ef\u4ee5\u7528\u65f6\u5e8f\u56fe\u7684\u65b9\u5f0f\u663e\u793a\u6570\u636e\u5305\u4ea4\u4e92\u7684\u8fc7\u7a0b\uff0c\u4ece\u83dc\u5355\u680f\u4e2d\uff0c\u70b9\u51fb \u7edf\u8ba1 (Statistics) -&gt; \u6d41\u91cf\u56fe (Flow Graph)\uff0c\u7136\u540e\uff0c\u5728\u5f39\u51fa\u7684\u754c\u9762\u4e2d\u7684\u300c\u6d41\u91cf\u7c7b\u578b\u300d\u9009\u62e9\u300cTCP Flows\u300d\uff0c\u4f60\u53ef\u4ee5\u66f4\u6e05\u6670\u7684\u770b\u5230\uff0c\u6574\u4e2a\u8fc7\u7a0b\u4e2d TCP \u6d41\u7684\u6267\u884c\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u4f60\u53ef\u80fd\u4f1a\u597d\u5947\uff0c\u4e3a\u4ec0\u4e48\u4e09\u6b21\u63e1\u624b\u8fde\u63a5\u8fc7\u7a0b\u7684 Seq \u662f 0\uff1f</p> <p>\u5b9e\u9645\u4e0a\u662f\u56e0\u4e3a Wireshark \u5de5\u5177\u5e2e\u6211\u4eec\u505a\u4e86\u4f18\u5316\uff0c\u5b83\u9ed8\u8ba4\u663e\u793a\u7684\u662f\u5e8f\u5217\u53f7 seq \u662f\u76f8\u5bf9\u503c\uff0c\u800c\u4e0d\u662f\u771f\u5b9e\u503c\u3002</p> <p>\u5982\u679c\u4f60\u60f3\u770b\u5230\u5b9e\u9645\u7684\u5e8f\u5217\u53f7\u7684\u503c\uff0c\u53ef\u4ee5\u53f3\u952e\u83dc\u5355\uff0c\u7136\u540e\u627e\u5230\u300c\u534f\u8bae\u9996\u9009\u9879\u300d\uff0c\u63a5\u7740\u627e\u5230\u300cRelative Seq\u300d\u540e\uff0c\u628a\u5b83\u7ed9\u53d6\u6d88\uff0c\u64cd\u4f5c\u5982\u4e0b\uff1a</p> <p></p> <p>\u53d6\u6d88\u540e\uff0cSeq \u663e\u793a\u7684\u5c31\u662f\u771f\u5b9e\u503c\u4e86\uff1a</p> <p></p> <p>\u53ef\u89c1\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684\u5e8f\u5217\u53f7\u5b9e\u9645\u4e0a\u662f\u4e0d\u540c\u7684\uff0c\u5e8f\u5217\u53f7\u662f\u4e00\u4e2a\u968f\u673a\u503c\u3002</p> <p>\u8fd9\u5176\u5b9e\u8ddf\u6211\u4eec\u4e66\u4e0a\u770b\u5230\u7684 TCP \u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u5f88\u7c7b\u4f3c\uff0c\u4f5c\u4e3a\u5bf9\u6bd4\uff0c\u4f60\u901a\u5e38\u770b\u5230\u7684 TCP \u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\u7684\u6d41\u7a0b\uff0c\u57fa\u672c\u662f\u8fd9\u6837\u7684\uff1a</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u6293\u5230\u7684 TCP \u6325\u624b\u662f\u4e09\u6b21\uff0c\u800c\u4e0d\u662f\u4e66\u4e0a\u8bf4\u7684\u56db\u6b21\uff1f</p> <p>\u5f53\u88ab\u52a8\u5173\u95ed\u65b9\uff08\u4e0a\u56fe\u7684\u670d\u52a1\u7aef\uff09\u5728 TCP \u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u300c\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u300d\u5e76\u4e14\u300c\u5f00\u542f\u4e86 TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\u300d\uff0c\u90a3\u4e48\u7b2c\u4e8c\u548c\u7b2c\u4e09\u6b21\u6325\u624b\u5c31\u4f1a\u5408\u5e76\u4f20\u8f93\uff0c\u8fd9\u6837\u5c31\u51fa\u73b0\u4e86\u4e09\u6b21\u6325\u624b\u3002</p> <p>\u800c\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u670d\u52a1\u5668\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684 <code>FIN</code> \u540e\uff0c\u5f88\u53ef\u80fd\u8fd8\u6ca1\u53d1\u9001\u5b8c\u6570\u636e\uff0c\u6240\u4ee5\u5c31\u4f1a\u5148\u56de\u590d\u5ba2\u6237\u7aef\u4e00\u4e2a <code>ACK</code> \u5305\uff0c\u7a0d\u7b49\u4e00\u4f1a\u513f\uff0c\u5b8c\u6210\u6240\u6709\u6570\u636e\u5305\u7684\u53d1\u9001\u540e\uff0c\u624d\u4f1a\u53d1\u9001 <code>FIN</code> \u5305\uff0c\u8fd9\u4e5f\u5c31\u662f\u56db\u6b21\u6325\u624b\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#tcp_1","title":"TCP \u4e09\u6b21\u63e1\u624b\u5f02\u5e38\u60c5\u51b5\u5b9e\u6218\u5206\u6790","text":"<p>TCP \u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\u76f8\u4fe1\u5927\u5bb6\u90fd\u80cc\u7684\u6eda\u74dc\u70c2\u719f\uff0c\u90a3\u4e48\u4f60\u6709\u6ca1\u6709\u60f3\u8fc7\u8fd9\u4e09\u4e2a\u5f02\u5e38\u60c5\u51b5\uff1a</p> <ul> <li>TCP \u7b2c\u4e00\u6b21\u63e1\u624b\u7684 SYN \u4e22\u5305\u4e86\uff0c\u4f1a\u53d1\u751f\u4e86\u4ec0\u4e48\uff1f</li> <li>TCP \u7b2c\u4e8c\u6b21\u63e1\u624b\u7684 SYN\u3001ACK \u4e22\u5305\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</li> <li>TCP \u7b2c\u4e09\u6b21\u63e1\u624b\u7684 ACK \u5305\u4e22\u4e86\uff0c\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</li> </ul> <p>\u6709\u7684\u5c0f\u4f19\u4f34\u53ef\u80fd\u8bf4\uff1a\u201c\u5f88\u7b80\u5355\u5440\uff0c\u5305\u4e22\u4e86\u5c31\u4f1a\u91cd\u4f20\u561b\u3002\u201d</p> <p>\u90a3\u6211\u5728\u7ee7\u7eed\u95ee\u4f60\uff1a</p> <ul> <li>\u90a3\u4f1a\u91cd\u4f20\u51e0\u6b21\uff1f</li> <li>\u8d85\u65f6\u91cd\u4f20\u7684\u65f6\u95f4 RTO \u4f1a\u5982\u4f55\u53d8\u5316\uff1f</li> <li>\u5728 Linux \u4e0b\u5982\u4f55\u8bbe\u7f6e\u91cd\u4f20\u6b21\u6570\uff1f</li> <li>\u2026\u2026</li> </ul> <p>\u662f\u4e0d\u662f\u54d1\u53e3\u65e0\u8a00\uff0c\u65e0\u6cd5\u56de\u7b54\uff1f</p> <p>\u4e0d\u77e5\u9053\u6ca1\u5173\u7cfb\uff0c\u63a5\u4e0b\u91cc\u6211\u7528\u4e09\u4e2a\u5b9e\u9a8c\u6848\u4f8b\uff0c\u5e26\u5927\u5bb6\u4e00\u8d77\u63a2\u7a76\u63a2\u7a76\u8fd9\u4e09\u79cd\u5f02\u5e38\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#_2","title":"\u5b9e\u9a8c\u573a\u666f","text":"<p>\u672c\u6b21\u5b9e\u9a8c\u7528\u4e86\u4e24\u53f0\u865a\u62df\u673a\uff0c\u4e00\u53f0\u4f5c\u4e3a\u670d\u52a1\u7aef\uff0c\u4e00\u53f0\u4f5c\u4e3a\u5ba2\u6237\u7aef\uff0c\u5b83\u4eec\u7684\u5173\u7cfb\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u662f CentOs 6.5 Linux\uff0cLinux \u5185\u6838\u7248\u672c 2.6.32</li> <li>\u670d\u52a1\u7aef 192.168.12.36\uff0capache web \u670d\u52a1</li> <li>\u5ba2\u6237\u7aef 192.168.12.37</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#tcp-syn","title":"\u5b9e\u9a8c\u4e00\uff1aTCP \u7b2c\u4e00\u6b21\u63e1\u624b SYN \u4e22\u5305","text":"<p>\u4e3a\u4e86\u6a21\u62df TCP \u7b2c\u4e00\u6b21\u63e1\u624b SYN \u4e22\u5305\u7684\u60c5\u51b5\uff0c\u6211\u662f\u5728\u62d4\u6389\u670d\u52a1\u5668\u7684\u7f51\u7ebf\u540e\uff0c\u7acb\u523b\u5728\u5ba2\u6237\u7aef\u6267\u884c curl \u547d\u4ee4\uff1a</p> <p></p> <p>\u5176\u95f4 tcpdump \u6293\u5305\u7684\u547d\u4ee4\u5982\u4e0b\uff1a</p> <p></p> <p>\u8fc7\u4e86\u4e00\u4f1a\uff0ccurl \u8fd4\u56de\u4e86\u8d85\u65f6\u8fde\u63a5\u7684\u9519\u8bef\uff1a</p> <p></p> <p>\u4ece <code>date</code> \u8fd4\u56de\u7684\u65f6\u95f4\uff0c\u53ef\u4ee5\u53d1\u73b0\u5728\u8d85\u65f6\u63a5\u8fd1 1 \u5206\u949f\u7684\u65f6\u95f4\u540e\uff0ccurl \u8fd4\u56de\u4e86\u9519\u8bef\u3002</p> <p>\u63a5\u7740\uff0c\u628a tcp_sys_timeout.pcap \u6587\u4ef6\u7528 Wireshark \u6253\u5f00\u5206\u6790\uff0c\u663e\u793a\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u4ece\u4e0a\u56fe\u53ef\u4ee5\u53d1\u73b0\uff0c\u5ba2\u6237\u7aef\u53d1\u8d77\u4e86 SYN \u5305\u540e\uff0c\u4e00\u76f4\u6ca1\u6709\u6536\u5230\u670d\u52a1\u7aef\u7684 ACK\uff0c\u6240\u4ee5\u4e00\u76f4\u8d85\u65f6\u91cd\u4f20\u4e86 5 \u6b21\uff0c\u5e76\u4e14\u6bcf\u6b21 RTO \u8d85\u65f6\u65f6\u95f4\u662f\u4e0d\u540c\u7684\uff1a</p> <ul> <li>\u7b2c\u4e00\u6b21\u662f\u5728 1 \u79d2\u8d85\u65f6\u91cd\u4f20</li> <li>\u7b2c\u4e8c\u6b21\u662f\u5728 3 \u79d2\u8d85\u65f6\u91cd\u4f20</li> <li>\u7b2c\u4e09\u6b21\u662f\u5728 7 \u79d2\u8d85\u65f6\u91cd\u4f20</li> <li>\u7b2c\u56db\u6b21\u662f\u5728 15 \u79d2\u8d85\u65f6\u91cd\u4f20</li> <li>\u7b2c\u4e94\u6b21\u662f\u5728 31 \u79d2\u8d85\u65f6\u91cd\u4f20</li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u6bcf\u6b21\u8d85\u65f6\u65f6\u95f4 RTO \u662f\u6307\u6570\uff08\u7ffb\u500d\uff09\u4e0a\u6da8\u7684\uff0c\u5f53\u8d85\u8fc7\u6700\u5927\u91cd\u4f20\u6b21\u6570\u540e\uff0c\u5ba2\u6237\u7aef\u4e0d\u518d\u53d1\u9001 SYN \u5305\u3002</p> <p>\u5728 Linux \u4e2d\uff0c\u7b2c\u4e00\u6b21\u63e1\u624b\u7684 <code>SYN</code> \u8d85\u65f6\u91cd\u4f20\u6b21\u6570\uff0c\u662f\u5982\u4e0b\u5185\u6838\u53c2\u6570\u6307\u5b9a\u7684\uff1a</p> Bash<pre><code>$ cat /proc/sys/net/ipv4/tcp_syn_retries\n5\n</code></pre> <p><code>tcp_syn_retries</code> \u9ed8\u8ba4\u503c\u4e3a 5\uff0c\u4e5f\u5c31\u662f SYN \u6700\u5927\u91cd\u4f20\u6b21\u6570\u662f 5 \u6b21\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u7ee7\u7eed\u505a\u5b9e\u9a8c\uff0c\u628a <code>tcp_syn_retries</code> \u8bbe\u7f6e\u4e3a 2 \u6b21\uff1a</p> Bash<pre><code>$ echo 2 &gt; /proc/sys/net/ipv4/tcp_syn_retries\n</code></pre> <p>\u91cd\u4f20\u6293\u5305\u540e\uff0c\u7528 Wireshark \u6253\u5f00\u5206\u6790\uff0c\u663e\u793a\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5b9e\u9a8c\u4e00\u7684\u5b9e\u9a8c\u5c0f\u7ed3</p> <p>\u901a\u8fc7\u5b9e\u9a8c\u4e00\u7684\u5b9e\u9a8c\u7ed3\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\uff0c\u5f53\u5ba2\u6237\u7aef\u53d1\u8d77\u7684 TCP \u7b2c\u4e00\u6b21\u63e1\u624b SYN \u5305\uff0c\u5728\u8d85\u65f6\u65f6\u95f4\u5185\u6ca1\u6536\u5230\u670d\u52a1\u7aef\u7684 ACK\uff0c\u5c31\u4f1a\u5728\u8d85\u65f6\u91cd\u4f20 SYN \u6570\u636e\u5305\uff0c\u6bcf\u6b21\u8d85\u65f6\u91cd\u4f20\u7684 RTO \u662f\u7ffb\u500d\u4e0a\u6da8\u7684\uff0c\u76f4\u5230 SYN \u5305\u7684\u91cd\u4f20\u6b21\u6570\u5230\u8fbe <code>tcp_syn_retries</code> \u503c\u540e\uff0c\u5ba2\u6237\u7aef\u4e0d\u518d\u53d1\u9001 SYN \u5305\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#tcp-synack","title":"\u5b9e\u9a8c\u4e8c\uff1aTCP \u7b2c\u4e8c\u6b21\u63e1\u624b SYN\u3001ACK \u4e22\u5305","text":"<p>\u4e3a\u4e86\u6a21\u62df\u5ba2\u6237\u7aef\u6536\u4e0d\u5230\u670d\u52a1\u7aef\u7b2c\u4e8c\u6b21\u63e1\u624b SYN\u3001ACK \u5305\uff0c\u6211\u7684\u505a\u6cd5\u662f\u5728\u5ba2\u6237\u7aef\u52a0\u4e0a\u9632\u706b\u5899\u9650\u5236\uff0c\u76f4\u63a5\u7c97\u66b4\u7684\u628a\u6765\u81ea\u670d\u52a1\u7aef\u7684\u6570\u636e\u90fd\u4e22\u5f03\uff0c\u9632\u706b\u5899\u7684\u914d\u7f6e\u5982\u4e0b\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u5728\u5ba2\u6237\u7aef\u6267\u884c curl \u547d\u4ee4\uff1a</p> <p></p> <p>\u4ece <code>date</code> \u8fd4\u56de\u7684\u65f6\u95f4\u524d\u540e\uff0c\u53ef\u4ee5\u7b97\u51fa\u5927\u6982 1 \u5206\u949f\u540e\uff0ccurl \u62a5\u9519\u9000\u51fa\u4e86\u3002</p> <p>\u5ba2\u6237\u7aef\u5728\u8fd9\u5176\u95f4\u6293\u53d6\u7684\u6570\u636e\u5305\uff0c\u7528 Wireshark \u6253\u5f00\u5206\u6790\uff0c\u663e\u793a\u7684\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u4ece\u56fe\u4e2d\u53ef\u4ee5\u53d1\u73b0\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u53d1\u8d77 SYN \u540e\uff0c\u7531\u4e8e\u9632\u706b\u5899\u5c4f\u853d\u4e86\u670d\u52a1\u7aef\u7684\u6240\u6709\u6570\u636e\u5305\uff0c\u6240\u4ee5 curl \u662f\u65e0\u6cd5\u6536\u5230\u670d\u52a1\u7aef\u7684 SYN\u3001ACK \u5305\uff0c\u5f53\u53d1\u751f\u8d85\u65f6\u540e\uff0c\u5c31\u4f1a\u91cd\u4f20 SYN \u5305</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7684 SYN \u5305\u540e\uff0c\u5c31\u4f1a\u56de SYN\u3001ACK \u5305\uff0c\u4f46\u662f\u5ba2\u6237\u7aef\u4e00\u76f4\u6ca1\u6709\u56de ACK\uff0c\u670d\u52a1\u7aef\u5728\u8d85\u65f6\u540e\uff0c\u91cd\u4f20\u4e86 SYN\u3001ACK \u5305\uff0c\u63a5\u7740\u4e00\u4f1a\uff0c\u5ba2\u6237\u7aef\u8d85\u65f6\u91cd\u4f20\u7684 SYN \u5305\u53c8\u62b5\u8fbe\u4e86\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u7136\u540e\u56de\u4e86 SYN\u3001ACK \u5305\uff0c\u4f46\u662f SYN\u3001ACK \u5305\u7684\u91cd\u4f20\u5b9a\u65f6\u5668\u5e76\u6ca1\u6709\u91cd\u7f6e\uff0c\u8fd8\u6301\u7eed\u5728\u91cd\u4f20\uff0c\u56e0\u4e3a\u7b2c\u4e8c\u6b21\u63e1\u624b\u5728\u6ca1\u6536\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\u7684 ACK \u786e\u8ba4\u62a5\u6587\u65f6\uff0c\u5c31\u4f1a\u91cd\u4f20\u5230\u6700\u5927\u6b21\u6570\u3002</li> <li>\u6700\u540e\uff0c\u5ba2\u6237\u7aef SYN \u8d85\u65f6\u91cd\u4f20\u6b21\u6570\u8fbe\u5230\u4e86 5 \u6b21\uff08tcp_syn_retries \u9ed8\u8ba4\u503c 5 \u6b21\uff09\uff0c\u5c31\u4e0d\u518d\u7ee7\u7eed\u53d1\u9001 SYN \u5305\u4e86\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u53d1\u73b0\uff0c\u5f53\u7b2c\u4e8c\u6b21\u63e1\u624b\u7684 SYN\u3001ACK \u4e22\u5305\u65f6\uff0c\u5ba2\u6237\u7aef\u4f1a\u8d85\u65f6\u91cd\u53d1 SYN \u5305\uff0c\u670d\u52a1\u7aef\u4e5f\u4f1a\u8d85\u65f6\u91cd\u4f20 SYN\u3001ACK \u5305\u3002</p> <p>\u54a6\uff1f\u5ba2\u6237\u7aef\u8bbe\u7f6e\u4e86\u9632\u706b\u5899\uff0c\u5c4f\u853d\u4e86\u670d\u52a1\u7aef\u7684\u7f51\u7edc\u5305\uff0c\u4e3a\u4ec0\u4e48 tcpdump \u8fd8\u80fd\u6293\u5230\u670d\u52a1\u7aef\u7684\u7f51\u7edc\u5305\uff1f</p> <p>\u6dfb\u52a0 iptables \u9650\u5236\u540e\uff0ctcpdump \u662f\u5426\u80fd\u6293\u5230\u5305\uff0c\u8fd9\u8981\u770b\u6dfb\u52a0\u7684 iptables \u9650\u5236\u6761\u4ef6\uff1a</p> <ul> <li>\u5982\u679c\u6dfb\u52a0\u7684\u662f <code>INPUT</code> \u89c4\u5219\uff0c\u5219\u53ef\u4ee5\u6293\u5f97\u5230\u5305</li> <li>\u5982\u679c\u6dfb\u52a0\u7684\u662f <code>OUTPUT</code> \u89c4\u5219\uff0c\u5219\u6293\u4e0d\u5230\u5305</li> </ul> <p>\u7f51\u7edc\u5305\u8fdb\u5165\u4e3b\u673a\u540e\u7684\u987a\u5e8f\u5982\u4e0b\uff1a</p> <ul> <li>\u8fdb\u6765\u7684\u987a\u5e8f Wire -&gt; NIC -&gt; tcpdump -&gt; netfilter/iptables</li> <li>\u51fa\u53bb\u7684\u987a\u5e8f iptables -&gt; tcpdump -&gt; NIC -&gt; Wire</li> </ul> <p>tcp_syn_retries \u662f\u9650\u5236 SYN \u91cd\u4f20\u6b21\u6570\uff0c\u90a3\u7b2c\u4e8c\u6b21\u63e1\u624b SYN\u3001ACK \u9650\u5236\u6700\u5927\u91cd\u4f20\u6b21\u6570\u662f\u591a\u5c11\uff1f</p> <p>TCP \u7b2c\u4e8c\u6b21\u63e1\u624b SYN\u3001ACK \u5305\u7684\u6700\u5927\u91cd\u4f20\u6b21\u6570\u662f\u901a\u8fc7 <code>tcp_synack_retries</code> \u5185\u6838\u53c2\u6570\u9650\u5236\u7684\uff0c\u5176\u9ed8\u8ba4\u503c\u5982\u4e0b\uff1a</p> Bash<pre><code>$ cat /proc/sys/net/ipv4/tcp_synack_retries\n5\n</code></pre> <p>\u662f\u7684\uff0cTCP \u7b2c\u4e8c\u6b21\u63e1\u624b SYN\u3001ACK \u5305\u7684\u6700\u5927\u91cd\u4f20\u6b21\u6570\u9ed8\u8ba4\u503c\u662f <code>5</code> \u6b21\u3002</p> <p>\u4e3a\u4e86\u9a8c\u8bc1 SYN\u3001ACK \u5305\u6700\u5927\u91cd\u4f20\u6b21\u6570\u662f 5 \u6b21\uff0c\u6211\u4eec\u7ee7\u7eed\u505a\u4e0b\u5b9e\u9a8c\uff0c\u6211\u4eec\u5148\u628a\u5ba2\u6237\u7aef\u7684 <code>tcp_syn_retries</code> \u8bbe\u7f6e\u4e3a 1\uff0c\u8868\u793a\u5ba2\u6237\u7aef SYN \u6700\u5927\u8d85\u65f6\u6b21\u6570\u662f 1 \u6b21\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u9632\u6b62\u591a\u6b21\u91cd\u4f20 SYN\uff0c\u628a\u670d\u52a1\u7aef SYN\u3001ACK \u8d85\u65f6\u5b9a\u65f6\u5668\u91cd\u7f6e\u3002</p> <p>\u63a5\u7740\uff0c\u8fd8\u662f\u5982\u4e0a\u9762\u7684\u6b65\u9aa4\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u914d\u7f6e\u9632\u706b\u5899\u5c4f\u853d\u670d\u52a1\u7aef\u7684\u6570\u636e\u5305</li> <li>\u5ba2\u6237\u7aef tcpdump \u6293\u53d6 curl \u6267\u884c\u65f6\u7684\u6570\u636e\u5305</li> </ol> <p>\u628a\u6293\u53d6\u7684\u6570\u636e\u5305\uff0c\u7528 Wireshark \u6253\u5f00\u5206\u6790\uff0c\u663e\u793a\u7684\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a </p> <p></p> <p>\u4ece\u4e0a\u56fe\uff0c\u6211\u4eec\u53ef\u4ee5\u5206\u6790\u51fa\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u7684 SYN \u53ea\u8d85\u65f6\u91cd\u4f20\u4e86 1 \u6b21\uff0c\u56e0\u4e3a <code>tcp_syn_retries</code> \u503c\u4e3a 1</li> <li>\u670d\u52a1\u7aef\u5e94\u7b54\u4e86\u5ba2\u6237\u7aef\u8d85\u65f6\u91cd\u4f20\u7684 SYN \u5305\u540e\uff0c\u7531\u4e8e\u4e00\u76f4\u6536\u4e0d\u5230\u5ba2\u6237\u7aef\u7684 ACK \u5305\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u4e00\u76f4\u5728\u8d85\u65f6\u91cd\u4f20 SYN\u3001ACK \u5305\uff0c\u6bcf\u6b21\u7684 RTO \u4e5f\u662f\u6307\u6570\u4e0a\u6da8\u7684\uff0c\u4e00\u5171\u8d85\u65f6\u91cd\u4f20\u4e86 5 \u6b21\uff0c\u56e0\u4e3a <code>tcp_synack_retries</code> \u503c\u4e3a 5</li> </ul> <p>\u63a5\u7740\uff0c\u6211\u628a tcp_synack_retries \u8bbe\u7f6e\u4e3a 2\uff0c<code>tcp_syn_retries</code> \u4f9d\u7136\u8bbe\u7f6e\u4e3a 1:</p> Bash<pre><code>$ echo 2 &gt; /proc/sys/net/ipv4/tcp_synack_retries\n$ echo 1 &gt; /proc/sys/net/ipv4/tcp_syn_retries\n</code></pre> <p>\u4f9d\u7136\u4fdd\u6301\u4e00\u6837\u7684\u5b9e\u9a8c\u6b65\u9aa4\u8fdb\u884c\u64cd\u4f5c\uff0c\u63a5\u7740\u628a\u6293\u53d6\u7684\u6570\u636e\u5305\uff0c\u7528 Wireshark \u6253\u5f00\u5206\u6790\uff0c\u663e\u793a\u7684\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a </p> <p></p> <p>\u53ef\u89c1\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u7684 SYN \u5305\u53ea\u8d85\u65f6\u91cd\u4f20\u4e86 1 \u6b21\uff0c\u7b26\u5408 tcp_syn_retries \u8bbe\u7f6e\u7684\u503c\uff1b</li> <li>\u670d\u52a1\u7aef\u7684 SYN\u3001ACK \u8d85\u65f6\u91cd\u4f20\u4e86 2 \u6b21\uff0c\u7b26\u5408 tcp_synack_retries \u8bbe\u7f6e\u7684\u503c</li> </ul> <p>\u5b9e\u9a8c\u4e8c\u7684\u5b9e\u9a8c\u5c0f\u7ed3</p> <p>\u901a\u8fc7\u5b9e\u9a8c\u4e8c\u7684\u5b9e\u9a8c\u7ed3\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\uff0c\u5f53 TCP \u7b2c\u4e8c\u6b21\u63e1\u624b SYN\u3001ACK \u5305\u4e22\u4e86\u540e\uff0c\u5ba2\u6237\u7aef SYN \u5305\u4f1a\u53d1\u751f\u8d85\u65f6\u91cd\u4f20\uff0c\u670d\u52a1\u7aef SYN\u3001ACK \u4e5f\u4f1a\u53d1\u751f\u8d85\u65f6\u91cd\u4f20\u3002</p> <p>\u5ba2\u6237\u7aef SYN \u5305\u8d85\u65f6\u91cd\u4f20\u7684\u6700\u5927\u6b21\u6570\uff0c\u662f\u7531 tcp_syn_retries \u51b3\u5b9a\u7684\uff0c\u9ed8\u8ba4\u503c\u662f 5 \u6b21\uff1b\u670d\u52a1\u7aef SYN\u3001ACK \u5305\u65f6\u91cd\u4f20\u7684\u6700\u5927\u6b21\u6570\uff0c\u662f\u7531 tcp_synack_retries \u51b3\u5b9a\u7684\uff0c\u9ed8\u8ba4\u503c\u662f 5 \u6b21\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#tcp-ack","title":"\u5b9e\u9a8c\u4e09\uff1aTCP \u7b2c\u4e09\u6b21\u63e1\u624b ACK \u4e22\u5305","text":"<p>\u4e3a\u4e86\u6a21\u62df TCP \u7b2c\u4e09\u6b21\u63e1\u624b ACK \u5305\u4e22\uff0c\u6211\u7684\u5b9e\u9a8c\u65b9\u6cd5\u662f\u5728\u670d\u52a1\u7aef\u914d\u7f6e\u9632\u706b\u5899\uff0c\u5c4f\u853d\u5ba2\u6237\u7aef TCP \u62a5\u6587\u4e2d\u6807\u5fd7\u4f4d\u662f ACK \u7684\u5305\uff0c\u4e5f\u5c31\u662f\u5f53\u670d\u52a1\u7aef\u6536\u5230\u5ba2\u6237\u7aef\u7684 TCP ACK \u7684\u62a5\u6587\u65f6\u5c31\u4f1a\u4e22\u5f03\u3002</p> <p>iptables \u914d\u7f6e\u547d\u4ee4\u5982\u4e0b\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u5728\u5ba2\u6237\u7aef\u6267\u884c\u5982\u4e0b tcpdump \u547d\u4ee4\uff1a</p> <p></p> <p>\u7136\u540e\uff0c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u8d77 telnet\uff0c\u56e0\u4e3a telnet \u547d\u4ee4\u662f\u4f1a\u53d1\u8d77 TCP \u8fde\u63a5\uff0c\u6240\u4ee5\u7528\u6b64\u547d\u4ee4\u505a\u6d4b\u8bd5\uff1a</p> <p></p> <p>\u6b64\u65f6\uff0c\u7531\u4e8e\u670d\u52a1\u7aef\u6536\u4e0d\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\u7684 ACK \u5305\uff0c\u6240\u4ee5\u4e00\u76f4\u5904\u4e8e <code>SYN_RECV</code> \u72b6\u6001\uff1a</p> <p></p> <p>\u800c\u5ba2\u6237\u7aef\u662f\u5df2\u5b8c\u6210 TCP \u8fde\u63a5\u5efa\u7acb\uff0c\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\uff1a</p> <p></p> <p>\u8fc7\u4e86 1 \u5206\u949f\u540e\uff0c\u89c2\u5bdf\u53d1\u73b0\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u4e0d\u89c1\u4e86\uff1a</p> <p></p> <p>\u8fc7\u4e86 30 \u5206\u949f\uff0c\u5ba2\u6237\u7aef\u4f9d\u7136\u8fd8\u662f\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u5728\u521a\u624d\u5ba2\u6237\u7aef\u5efa\u7acb\u7684 telnet \u4f1a\u8bdd\uff0c\u8f93\u5165 123456 \u5b57\u7b26\uff0c\u8fdb\u884c\u53d1\u9001\uff1a</p> <p></p> <p>\u6301\u7eed\u300c\u597d\u957f\u300d\u4e00\u6bb5\u65f6\u95f4\uff0c\u5ba2\u6237\u7aef\u7684 telnet \u624d\u65ad\u5f00\u8fde\u63a5\uff1a</p> <p></p> <p>\u4ee5\u4e0a\u5c31\u662f\u672c\u6b21\u7684\u5b9e\u73b0\u4e09\u7684\u73b0\u8c61\uff0c\u8fd9\u91cc\u5b58\u5728\u4e24\u4e2a\u7591\u70b9\uff1a</p> <ul> <li>\u4e3a\u4ec0\u4e48\u670d\u52a1\u7aef\u539f\u672c\u5904\u4e8e <code>SYN_RECV</code> \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u8fc7 1 \u5206\u949f\u540e\u5c31\u6d88\u5931\u4e86\uff1f</li> <li>\u4e3a\u4ec0\u4e48\u5ba2\u6237\u7aef telnet \u8f93\u5165 123456 \u5b57\u7b26\u540e\uff0c\u8fc7\u4e86\u597d\u957f\u4e00\u6bb5\u65f6\u95f4\uff0ctelnet \u624d\u65ad\u5f00\u8fde\u63a5\uff1f</li> </ul> <p>\u4e0d\u7740\u6025\uff0c\u6211\u4eec\u628a\u521a\u6293\u7684\u6570\u636e\u5305\uff0c\u7528 Wireshark \u6253\u5f00\u5206\u6790\uff0c\u663e\u793a\u7684\u65f6\u5e8f\u56fe\u5982\u4e0b\uff1a</p> <p></p> <p>\u4e0a\u56fe\u7684\u6d41\u7a0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u53d1\u9001 SYN \u5305\u7ed9\u670d\u52a1\u7aef\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u56de\u4e86\u4e2a SYN\u3001ACK \u5305\u7ed9\u5ba2\u6237\u7aef\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u5904\u4e8e <code>SYN_RECV</code> \u72b6\u6001\uff1b</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684  SYN\u3001ACK \u5305\u540e\uff0c\u7ed9\u670d\u52a1\u7aef\u56de\u4e86\u4e2a ACK \u5305\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u7684 TCP \u8fde\u63a5\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\uff1b</li> <li>\u7531\u4e8e\u670d\u52a1\u7aef\u914d\u7f6e\u4e86\u9632\u706b\u5899\uff0c\u5c4f\u853d\u4e86\u5ba2\u6237\u7aef\u7684 ACK \u5305\uff0c\u6240\u4ee5\u670d\u52a1\u7aef\u4e00\u76f4\u5904\u4e8e <code>SYN_RECV</code> \u72b6\u6001\uff0c\u6ca1\u6709\u8fdb\u5165  <code>ESTABLISHED</code> \u72b6\u6001\uff0ctcpdump \u4e4b\u6240\u4ee5\u80fd\u6293\u5230\u5ba2\u6237\u7aef\u7684 ACK \u5305\uff0c\u662f\u56e0\u4e3a\u6570\u636e\u5305\u8fdb\u5165\u7cfb\u7edf\u7684\u987a\u5e8f\u662f\u5148\u8fdb\u5165 tcpudmp\uff0c\u540e\u7ecf\u8fc7 iptables\uff1b</li> <li>\u63a5\u7740\uff0c\u670d\u52a1\u7aef\u8d85\u65f6\u91cd\u4f20\u4e86 SYN\u3001ACK \u5305\uff0c\u91cd\u4f20\u4e86 5 \u6b21\u540e\uff0c\u4e5f\u5c31\u662f\u8d85\u8fc7 tcp_synack_retries \u7684\u503c\uff08\u9ed8\u8ba4\u503c\u662f 5\uff09\uff0c\u7136\u540e\u5c31\u6ca1\u6709\u7ee7\u7eed\u91cd\u4f20\u4e86\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u4e3b\u52a8\u4e2d\u6b62\u4e86\uff0c\u6240\u4ee5\u521a\u624d\u5904\u4e8e SYN_RECV \u72b6\u6001\u7684 TCP \u8fde\u63a5\u65ad\u5f00\u4e86\uff0c\u800c\u5ba2\u6237\u7aef\u4f9d\u7136\u5904\u4e8e<code>ESTABLISHED</code> \u72b6\u6001\uff1b</li> <li>\u867d\u7136\u670d\u52a1\u7aef TCP \u65ad\u5f00\u4e86\uff0c\u4f46\u8fc7\u4e86\u4e00\u6bb5\u65f6\u95f4\uff0c\u53d1\u73b0\u5ba2\u6237\u7aef\u4f9d\u7136\u5904\u4e8e<code>ESTABLISHED</code> \u72b6\u6001\uff0c\u4e8e\u662f\u5c31\u5728\u5ba2\u6237\u7aef\u7684 telnet \u4f1a\u8bdd\u8f93\u5165\u4e86 123456 \u5b57\u7b26\uff1b</li> <li>\u7531\u4e8e\u670d\u52a1\u7aef\u7684\u9632\u706b\u5899\u914d\u7f6e\u4e86\u5c4f\u853d\u6240\u6709\u643a\u5e26 ACK \u6807\u5fd7\u4f4d\u7684 TCP \u62a5\u6587\uff0c\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6570\u636e\u62a5\u6587\uff0c\u670d\u52a1\u7aef\u5e76\u4e0d\u4f1a\u63a5\u6536\uff0c\u800c\u662f\u4e22\u5f03\uff08\u5982\u679c\u670d\u52a1\u7aef\u6ca1\u6709\u8bbe\u7f6e\u9632\u706b\u5899\uff0c\u7531\u4e8e\u670d\u52a1\u7aef\u5df2\u7ecf\u65ad\u5f00\u8fde\u63a5\uff0c\u6b64\u65f6\u6536\u5230\u5ba2\u6237\u7684\u53d1\u6765\u7684\u6570\u636e\u62a5\u6587\u540e\uff0c\u4f1a\u56de RST \u62a5\u6587\uff09\u3002\u5ba2\u6237\u7aef\u7531\u4e8e\u4e00\u76f4\u6536\u4e0d\u5230\u6570\u636e\u62a5\u6587\u7684\u786e\u8ba4\u62a5\u6587\uff0c\u6240\u4ee5\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\uff0c\u5728\u8d85\u65f6\u91cd\u4f20\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e00\u6b21\u91cd\u4f20\uff0cRTO \u7684\u503c\u662f\u6307\u6570\u589e\u957f\u7684\uff0c\u6240\u4ee5\u6301\u7eed\u4e86\u597d\u957f\u4e00\u6bb5\u65f6\u95f4\uff0c\u5ba2\u6237\u7aef\u7684 telnet \u624d\u62a5\u9519\u9000\u51fa\u4e86\uff0c\u6b64\u65f6\u5171\u91cd\u4f20\u4e86 15 \u6b21\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u7684\u4e5f\u65ad\u5f00\u4e86\u8fde\u63a5\u3002</li> </ul> <p>\u901a\u8fc7\u8fd9\u4e00\u6ce2\u5206\u6790\uff0c\u521a\u624d\u7684\u4e24\u4e2a\u7591\u70b9\u5df2\u7ecf\u89e3\u9664\u4e86\uff1a</p> <ul> <li>\u670d\u52a1\u7aef\u5728\u91cd\u4f20 SYN\u3001ACK \u5305\u65f6\uff0c\u8d85\u8fc7\u4e86\u6700\u5927\u91cd\u4f20\u6b21\u6570 <code>tcp_synack_retries</code>\uff0c\u4e8e\u662f\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u4e3b\u52a8\u65ad\u5f00\u4e86\u3002</li> <li>\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u6570\u636e\u62a5\u6587\u65f6\uff0c\u5982\u679c\u8fdf\u8fdf\u6ca1\u6709\u6536\u5230\u6570\u636e\u5305\u7684\u786e\u8ba4\u62a5\u6587\uff0c\u4e5f\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\uff0c\u4e00\u5171\u91cd\u4f20\u4e86 15 \u6b21\u6570\u636e\u62a5\u6587\uff0c\u6700\u540e telnet \u5c31\u65ad\u5f00\u4e86\u8fde\u63a5\u3002</li> </ul> <p>TCP \u7b2c\u4e00\u6b21\u63e1\u624b\u7684 SYN \u5305\u8d85\u65f6\u91cd\u4f20\u6700\u5927\u6b21\u6570\u662f\u7531 tcp_syn_retries \u6307\u5b9a\uff0cTCP \u7b2c\u4e8c\u6b21\u63e1\u624b\u7684 SYN\u3001ACK \u5305\u8d85\u65f6\u91cd\u4f20\u6700\u5927\u6b21\u6570\u662f\u7531 tcp_synack_retries \u6307\u5b9a\uff0c\u90a3 TCP \u5efa\u7acb\u8fde\u63a5\u540e\u7684\u6570\u636e\u5305\u6700\u5927\u8d85\u65f6\u91cd\u4f20\u6b21\u6570\u662f\u7531\u4ec0\u4e48\u53c2\u6570\u6307\u5b9a\u5462\uff1f</p> <p>TCP \u5efa\u7acb\u8fde\u63a5\u540e\u7684\u6570\u636e\u5305\u4f20\u8f93\uff0c\u6700\u5927\u8d85\u65f6\u91cd\u4f20\u6b21\u6570\u662f\u7531 <code>tcp_retries2</code> \u6307\u5b9a\uff0c\u9ed8\u8ba4\u503c\u662f 15 \u6b21\uff0c\u5982\u4e0b\uff1a</p> Text Only<pre><code>$ cat /proc/sys/net/ipv4/tcp_retries2\n15\n</code></pre> <p>\u5982\u679c 15 \u6b21\u91cd\u4f20\u90fd\u505a\u5b8c\u4e86\uff0cTCP \u5c31\u4f1a\u544a\u8bc9\u5e94\u7528\u5c42\u8bf4\uff1a\u201c\u641e\u4e0d\u5b9a\u4e86\uff0c\u5305\u600e\u4e48\u90fd\u4f20\u4e0d\u8fc7\u53bb\uff01\u201d</p> <p>\u90a3\u5982\u679c\u5ba2\u6237\u7aef\u4e0d\u53d1\u9001\u6570\u636e\uff0c\u4ec0\u4e48\u65f6\u5019\u624d\u4f1a\u65ad\u5f00\u5904\u4e8e ESTABLISHED \u72b6\u6001\u7684\u8fde\u63a5\uff1f</p> <p>\u8fd9\u91cc\u5c31\u9700\u8981\u63d0\u5230 TCP \u7684 \u4fdd\u6d3b\u673a\u5236\u3002\u8fd9\u4e2a\u673a\u5236\u7684\u539f\u7406\u662f\u8fd9\u6837\u7684\uff1a</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u65f6\u95f4\u6bb5\uff0c\u5728\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u5185\uff0c\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u8fde\u63a5\u76f8\u5173\u7684\u6d3b\u52a8\uff0cTCP \u4fdd\u6d3b\u673a\u5236\u4f1a\u5f00\u59cb\u4f5c\u7528\uff0c\u6bcf\u9694\u4e00\u4e2a\u65f6\u95f4\u95f4\u9694\uff0c\u53d1\u9001\u4e00\u4e2a\u300c\u63a2\u6d4b\u62a5\u6587\u300d\uff0c\u8be5\u63a2\u6d4b\u62a5\u6587\u5305\u542b\u7684\u6570\u636e\u975e\u5e38\u5c11\uff0c\u5982\u679c\u8fde\u7eed\u51e0\u4e2a\u63a2\u6d4b\u62a5\u6587\u90fd\u6ca1\u6709\u5f97\u5230\u54cd\u5e94\uff0c\u5219\u8ba4\u4e3a\u5f53\u524d\u7684 TCP \u8fde\u63a5\u5df2\u7ecf\u6b7b\u4ea1\uff0c\u7cfb\u7edf\u5185\u6838\u5c06\u9519\u8bef\u4fe1\u606f\u901a\u77e5\u7ed9\u4e0a\u5c42\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u5728 Linux \u5185\u6838\u53ef\u4ee5\u6709\u5bf9\u5e94\u7684\u53c2\u6570\u53ef\u4ee5\u8bbe\u7f6e\u4fdd\u6d3b\u65f6\u95f4\u3001\u4fdd\u6d3b\u63a2\u6d4b\u7684\u6b21\u6570\u3001\u4fdd\u6d3b\u63a2\u6d4b\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u4ee5\u4e0b\u90fd\u4e3a\u9ed8\u8ba4\u503c\uff1a</p> Text Only<pre><code>net.ipv4.tcp_keepalive_time=7200\nnet.ipv4.tcp_keepalive_intvl=75  \nnet.ipv4.tcp_keepalive_probes=9\n</code></pre> <ul> <li>tcp_keepalive_time=7200\uff1a\u8868\u793a\u4fdd\u6d3b\u65f6\u95f4\u662f 7200 \u79d2\uff082 \u5c0f\u65f6\uff09\uff0c\u4e5f\u5c31 2 \u5c0f\u65f6\u5185\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u8fde\u63a5\u76f8\u5173\u7684\u6d3b\u52a8\uff0c\u5219\u4f1a\u542f\u52a8\u4fdd\u6d3b\u673a\u5236</li> <li>tcp_keepalive_intvl=75\uff1a\u8868\u793a\u6bcf\u6b21\u68c0\u6d4b\u95f4\u9694 75 \u79d2\uff1b</li> <li>tcp_keepalive_probes=9\uff1a\u8868\u793a\u68c0\u6d4b 9 \u6b21\u65e0\u54cd\u5e94\uff0c\u8ba4\u4e3a\u5bf9\u65b9\u662f\u4e0d\u53ef\u8fbe\u7684\uff0c\u4ece\u800c\u4e2d\u65ad\u672c\u6b21\u7684\u8fde\u63a5\u3002</li> </ul> <p>\u4e5f\u5c31\u662f\u8bf4\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u6700\u5c11\u9700\u8981\u7ecf\u8fc7 2 \u5c0f\u65f6 11 \u5206 15 \u79d2\u624d\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u300c\u6b7b\u4ea1\u300d\u8fde\u63a5\u3002</p> <p></p> <p>\u8fd9\u4e2a\u65f6\u95f4\u662f\u6709\u70b9\u957f\u7684\uff0c\u6240\u4ee5\u5982\u679c\u6211\u6293\u5305\u8db3\u591f\u4e45\uff0c\u6216\u8bb8\u80fd\u6293\u5230\u63a2\u6d4b\u62a5\u6587\u3002</p> <p>\u5b9e\u9a8c\u4e09\u7684\u5b9e\u9a8c\u5c0f\u7ed3</p> <p>\u5728\u5efa\u7acb TCP \u8fde\u63a5\u65f6\uff0c\u5982\u679c\u7b2c\u4e09\u6b21\u63e1\u624b\u7684 ACK\uff0c\u670d\u52a1\u7aef\u65e0\u6cd5\u6536\u5230\uff0c\u5219\u670d\u52a1\u7aef\u5c31\u4f1a\u77ed\u6682\u5904\u4e8e <code>SYN_RECV</code> \u72b6\u6001\uff0c\u800c\u5ba2\u6237\u7aef\u4f1a\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\u3002</p> <p>\u7531\u4e8e\u670d\u52a1\u7aef\u4e00\u76f4\u6536\u4e0d\u5230 TCP \u7b2c\u4e09\u6b21\u63e1\u624b\u7684 ACK\uff0c\u5219\u4f1a\u4e00\u76f4\u91cd\u4f20 SYN\u3001ACK \u5305\uff0c\u76f4\u5230\u91cd\u4f20\u6b21\u6570\u8d85\u8fc7 <code>tcp_synack_retries</code> \u503c\uff08\u9ed8\u8ba4\u503c 5 \u6b21\uff09\u540e\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\u3002</p> <p>\u800c\u5ba2\u6237\u7aef\u5219\u4f1a\u6709\u4e24\u79cd\u60c5\u51b5\uff1a</p> <ul> <li>\u5982\u679c\u5ba2\u6237\u7aef\u6ca1\u53d1\u9001\u6570\u636e\u5305\uff0c\u4e00\u76f4\u5904\u4e8e <code>ESTABLISHED</code> \u72b6\u6001\uff0c\u7136\u540e\u7ecf\u8fc7 2 \u5c0f\u65f6 11 \u5206 15 \u79d2\u624d\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u300c\u6b7b\u4ea1\u300d\u8fde\u63a5\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u8fde\u63a5\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</li> <li>\u5982\u679c\u5ba2\u6237\u7aef\u53d1\u9001\u4e86\u6570\u636e\u5305\uff0c\u4e00\u76f4\u6ca1\u6709\u6536\u5230\u670d\u52a1\u7aef\u5bf9\u8be5\u6570\u636e\u5305\u7684\u786e\u8ba4\u62a5\u6587\uff0c\u5219\u4f1a\u4e00\u76f4\u91cd\u4f20\u8be5\u6570\u636e\u5305\uff0c\u76f4\u5230\u91cd\u4f20\u6b21\u6570\u8d85\u8fc7 <code>tcp_retries2</code> \u503c\uff08\u9ed8\u8ba4\u503c 15 \u6b21\uff09\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#tcp_2","title":"TCP \u5feb\u901f\u5efa\u7acb\u8fde\u63a5","text":"<p>\u5ba2\u6237\u7aef\u5728\u5411\u670d\u52a1\u7aef\u53d1\u8d77 HTTP GET \u8bf7\u6c42\u65f6\uff0c\u4e00\u4e2a\u5b8c\u6574\u7684\u4ea4\u4e92\u8fc7\u7a0b\uff0c\u9700\u8981 2.5 \u4e2a RTT \u7684\u65f6\u5ef6\u3002</p> <p>\u7531\u4e8e\u7b2c\u4e09\u6b21\u63e1\u624b\u662f\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684\uff0c\u8fd9\u65f6\u5982\u679c\u5728\u7b2c\u4e09\u6b21\u63e1\u624b\u53d1\u8d77 HTTP GET \u8bf7\u6c42\uff0c\u9700\u8981 2 \u4e2a RTT \u7684\u65f6\u5ef6\u3002</p> <p>\u4f46\u662f\u5728\u4e0b\u4e00\u6b21\uff08\u4e0d\u662f\u540c\u4e2a TCP \u8fde\u63a5\u7684\u4e0b\u4e00\u6b21\uff09\u53d1\u8d77 HTTP GET \u8bf7\u6c42\u65f6\uff0c\u7ecf\u5386\u7684 RTT \u4e5f\u662f\u4e00\u6837\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5728 Linux 3.7 \u5185\u6838\u7248\u672c\u4e2d\uff0c\u63d0\u4f9b\u4e86 TCP Fast Open \u529f\u80fd\uff0c\u8fd9\u4e2a\u529f\u80fd\u53ef\u4ee5\u51cf\u5c11 TCP \u8fde\u63a5\u5efa\u7acb\u7684\u65f6\u5ef6\u3002</p> <p></p> <ul> <li>\u5728\u7b2c\u4e00\u6b21\u5efa\u7acb\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u670d\u52a1\u7aef\u5728\u7b2c\u4e8c\u6b21\u63e1\u624b\u4ea7\u751f\u4e00\u4e2a <code>Cookie</code> \uff08\u5df2\u52a0\u5bc6\uff09\u5e76\u901a\u8fc7 SYN\u3001ACK \u5305\u4e00\u8d77\u53d1\u7ed9\u5ba2\u6237\u7aef\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u5c31\u4f1a\u7f13\u5b58\u8fd9\u4e2a <code>Cookie</code>\uff0c\u6240\u4ee5\u7b2c\u4e00\u6b21\u53d1\u8d77 HTTP Get \u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u9700\u8981 2 \u4e2a RTT \u7684\u65f6\u5ef6\uff1b</li> <li>\u5728\u4e0b\u6b21\u8bf7\u6c42\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u5728 SYN \u5305\u5e26\u4e0a <code>Cookie</code> \u53d1\u7ed9\u670d\u52a1\u7aef\uff0c\u5c31\u63d0\u524d\u53ef\u4ee5\u8df3\u8fc7\u4e09\u6b21\u63e1\u624b\u7684\u8fc7\u7a0b\uff0c\u56e0\u4e3a <code>Cookie</code> \u4e2d\u7ef4\u62a4\u4e86\u4e00\u4e9b\u4fe1\u606f\uff0c\u670d\u52a1\u7aef\u53ef\u4ee5\u4ece <code>Cookie</code> \u83b7\u53d6 TCP \u76f8\u5173\u7684\u4fe1\u606f\uff0c\u8fd9\u65f6\u53d1\u8d77\u7684 HTTP GET \u8bf7\u6c42\u5c31\u53ea\u9700\u8981 1 \u4e2a RTT \u7684\u65f6\u5ef6\uff1b</li> </ul> <p>\u6ce8\uff1a\u5ba2\u6237\u7aef\u5728\u8bf7\u6c42\u5e76\u5b58\u50a8\u4e86 Fast Open Cookie \u4e4b\u540e\uff0c\u53ef\u4ee5\u4e0d\u65ad\u91cd\u590d TCP Fast Open \u76f4\u81f3\u670d\u52a1\u5668\u8ba4\u4e3a Cookie \u65e0\u6548\uff08\u901a\u5e38\u4e3a\u8fc7\u671f\uff09</p> <p>\u5728 Linux \u4e0a\u5982\u4f55\u6253\u5f00 Fast Open \u529f\u80fd\uff1f</p> <p>\u53ef\u4ee5\u901a\u8fc7\u8bbe\u7f6e <code>net.ipv4.tcp_fastopn</code> \u5185\u6838\u53c2\u6570\uff0c\u6765\u6253\u5f00 Fast Open \u529f\u80fd\u3002</p> <p>net.ipv4.tcp_fastopn \u5404\u4e2a\u503c\u7684\u610f\u4e49\uff1a</p> <ul> <li>0 \u5173\u95ed</li> <li>1 \u4f5c\u4e3a\u5ba2\u6237\u7aef\u4f7f\u7528 Fast Open \u529f\u80fd</li> <li>2 \u4f5c\u4e3a\u670d\u52a1\u7aef\u4f7f\u7528 Fast Open \u529f\u80fd</li> <li>3 \u65e0\u8bba\u4f5c\u4e3a\u5ba2\u6237\u7aef\u8fd8\u662f\u670d\u52a1\u5668\uff0c\u90fd\u53ef\u4ee5\u4f7f\u7528 Fast Open \u529f\u80fd</li> </ul> <p>TCP Fast Open \u6293\u5305\u5206\u6790</p> <p>\u5728\u4e0b\u56fe\uff0c\u6570\u636e\u5305 7 \u53f7\uff0c\u5ba2\u6237\u7aef\u53d1\u8d77\u4e86\u7b2c\u4e8c\u6b21 TCP \u8fde\u63a5\u65f6\uff0cSYN \u5305\u4f1a\u643a\u5e26 Cooike\uff0c\u5e76\u4e14\u957f\u5ea6\u4e3a 5 \u7684\u6570\u636e\u3002</p> <p>\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u6821\u9a8c Cooike \u5408\u6cd5\uff0c\u4e8e\u662f\u5c31\u56de\u4e86 SYN\u3001ACK \u5305\uff0c\u5e76\u4e14\u786e\u8ba4\u5e94\u7b54\u6536\u5230\u4e86\u5ba2\u6237\u7aef\u7684\u6570\u636e\u5305\uff0cACK = 5 + 1 = 6 </p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#tcp_3","title":"TCP \u91cd\u590d\u786e\u8ba4\u548c\u5feb\u901f\u91cd\u4f20","text":"<p>\u5f53\u63a5\u6536\u65b9\u6536\u5230\u4e71\u5e8f\u6570\u636e\u5305\u65f6\uff0c\u4f1a\u53d1\u9001\u91cd\u590d\u7684 ACK\uff0c\u4ee5\u4fbf\u544a\u77e5\u53d1\u9001\u65b9\u8981\u91cd\u53d1\u8be5\u6570\u636e\u5305\uff0c\u5f53\u53d1\u9001\u65b9\u6536\u5230 3 \u4e2a\u91cd\u590d ACK \u65f6\uff0c\u5c31\u4f1a\u89e6\u53d1\u5feb\u901f\u91cd\u4f20\uff0c\u7acb\u523b\u91cd\u53d1\u4e22\u5931\u6570\u636e\u5305\u3002</p> <p></p> <p>TCP \u91cd\u590d\u786e\u8ba4\u548c\u5feb\u901f\u91cd\u4f20\u7684\u4e00\u4e2a\u6848\u4f8b\uff0c\u7528 Wireshark \u5206\u6790\uff0c\u663e\u793a\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>\u6570\u636e\u5305 1 \u671f\u671b\u7684\u4e0b\u4e00\u4e2a\u6570\u636e\u5305 Seq \u662f 1\uff0c\u4f46\u662f\u6570\u636e\u5305 2 \u53d1\u9001\u7684 Seq \u5374\u662f 10945\uff0c\u8bf4\u660e\u6536\u5230\u7684\u662f\u4e71\u5e8f\u6570\u636e\u5305\uff0c\u4e8e\u662f\u56de\u4e86\u6570\u636e\u5305 3\uff0c\u8fd8\u662f\u540c\u6837\u7684 Seq = 1\uff0cAck = 1\uff0c\u8fd9\u8868\u660e\u662f\u91cd\u590d\u7684 ACK\uff1b</li> <li>\u6570\u636e\u5305 4 \u548c 6 \u4f9d\u7136\u662f\u4e71\u5e8f\u7684\u6570\u636e\u5305\uff0c\u4e8e\u662f\u4f9d\u7136\u56de\u4e86\u91cd\u590d\u7684 ACK\uff1b</li> <li>\u5f53\u5bf9\u65b9\u6536\u5230\u4e09\u6b21\u91cd\u590d\u7684 ACK \u540e\uff0c\u4e8e\u662f\u5c31\u5feb\u901f\u91cd\u4f20\u4e86 Seq = 1\u3001Len = 1368 \u7684\u6570\u636e\u5305 8\uff1b</li> <li>\u5f53\u6536\u5230\u91cd\u4f20\u7684\u6570\u636e\u5305\u540e\uff0c\u53d1\u73b0 Seq = 1 \u662f\u671f\u671b\u7684\u6570\u636e\u5305\uff0c\u4e8e\u662f\u5c31\u53d1\u9001\u4e86\u4e2a\u786e\u8ba4\u6536\u5230\u5feb\u901f\u91cd\u4f20\u7684 ACK</li> </ul> <p>\u6ce8\u610f\uff1a\u5feb\u901f\u91cd\u4f20\u548c\u91cd\u590d ACK \u6807\u8bb0\u4fe1\u606f\u662f Wireshark \u7684\u529f\u80fd\uff0c\u975e\u6570\u636e\u5305\u672c\u8eab\u7684\u4fe1\u606f\u3002</p> <p>\u4ee5\u4e0a\u6848\u4f8b\u5728 TCP \u4e09\u6b21\u63e1\u624b\u65f6\u534f\u5546\u5f00\u542f\u4e86\u9009\u62e9\u6027\u786e\u8ba4 SACK\uff0c\u56e0\u6b64\u4e00\u65e6\u6570\u636e\u5305\u4e22\u5931\u5e76\u6536\u5230\u91cd\u590d ACK\uff0c\u5373\u4f7f\u5728\u4e22\u5931\u6570\u636e\u5305\u4e4b\u540e\u8fd8\u6210\u529f\u63a5\u6536\u4e86\u5176\u4ed6\u6570\u636e\u5305\uff0c\u4e5f\u53ea\u9700\u8981\u91cd\u4f20\u4e22\u5931\u7684\u6570\u636e\u5305\u3002\u5982\u679c\u4e0d\u542f\u7528 SACK\uff0c\u5c31\u5fc5\u987b\u91cd\u4f20\u4e22\u5931\u5305\u4e4b\u540e\u7684\u6bcf\u4e2a\u6570\u636e\u5305\u3002</p> <p>\u5982\u679c\u8981\u652f\u6301 <code>SACK</code>\uff0c\u5fc5\u987b\u53cc\u65b9\u90fd\u8981\u652f\u6301\u3002\u5728 Linux \u4e0b\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>net.ipv4.tcp_sack</code> \u53c2\u6570\u6253\u5f00\u8fd9\u4e2a\u529f\u80fd\uff08Linux 2.4 \u540e\u9ed8\u8ba4\u6253\u5f00\uff09\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#tcp_4","title":"TCP \u6d41\u91cf\u63a7\u5236","text":"<p>TCP \u4e3a\u4e86\u9632\u6b62\u53d1\u9001\u65b9\u65e0\u8111\u7684\u53d1\u9001\u6570\u636e\uff0c\u5bfc\u81f4\u63a5\u6536\u65b9\u7f13\u51b2\u533a\u88ab\u586b\u6ee1\uff0c\u6240\u4ee5\u5c31\u6709\u4e86\u6ed1\u52a8\u7a97\u53e3\u7684\u673a\u5236\uff0c\u5b83\u53ef\u5229\u7528\u63a5\u6536\u65b9\u7684\u63a5\u6536\u7a97\u53e3\u6765\u63a7\u5236\u53d1\u9001\u65b9\u8981\u53d1\u9001\u7684\u6570\u636e\u91cf\uff0c\u4e5f\u5c31\u662f\u6d41\u91cf\u63a7\u5236\u3002</p> <p>\u63a5\u6536\u7a97\u53e3\u662f\u7531\u63a5\u6536\u65b9\u6307\u5b9a\u7684\u503c\uff0c\u5b58\u50a8\u5728 TCP \u5934\u90e8\u4e2d\uff0c\u5b83\u53ef\u4ee5\u544a\u8bc9\u53d1\u9001\u65b9\u81ea\u5df1\u7684 TCP \u7f13\u51b2\u7a7a\u95f4\u533a\u5927\u5c0f\uff0c\u8fd9\u4e2a\u7f13\u51b2\u533a\u662f\u7ed9\u5e94\u7528\u7a0b\u5e8f\u8bfb\u53d6\u6570\u636e\u7684\u7a7a\u95f4\uff1a</p> <ul> <li>\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u8bfb\u53d6\u4e86\u7f13\u51b2\u533a\u7684\u6570\u636e\uff0c\u90a3\u4e48\u7f13\u51b2\u7a7a\u95f4\u533a\u5c31\u4f1a\u628a\u88ab\u8bfb\u53d6\u7684\u6570\u636e\u79fb\u9664</li> <li>\u5982\u679c\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u8bfb\u53d6\u6570\u636e\uff0c\u5219\u6570\u636e\u4f1a\u4e00\u76f4\u6ede\u7559\u5728\u7f13\u51b2\u533a\u3002</li> </ul> <p>\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f\uff0c\u662f\u5728 TCP \u4e09\u6b21\u63e1\u624b\u4e2d\u534f\u5546\u597d\u7684\uff0c\u540e\u7eed\u6570\u636e\u4f20\u8f93\u65f6\uff0c\u63a5\u6536\u65b9\u53d1\u9001\u786e\u8ba4\u5e94\u7b54 ACK \u62a5\u6587\u65f6\uff0c\u4f1a\u643a\u5e26\u5f53\u524d\u7684\u63a5\u6536\u7a97\u53e3\u7684\u5927\u5c0f\uff0c\u4ee5\u6b64\u6765\u544a\u77e5\u53d1\u9001\u65b9\u3002</p> <p>\u5047\u8bbe\u63a5\u6536\u65b9\u63a5\u6536\u5230\u6570\u636e\u540e\uff0c\u5e94\u7528\u5c42\u80fd\u5f88\u5feb\u7684\u4ece\u7f13\u51b2\u533a\u91cc\u8bfb\u53d6\u6570\u636e\uff0c\u90a3\u4e48\u7a97\u53e3\u5927\u5c0f\u4f1a\u4e00\u76f4\u4fdd\u6301\u4e0d\u53d8\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u4f46\u662f\u73b0\u5b9e\u4e2d\u670d\u52a1\u5668\u4f1a\u51fa\u73b0\u7e41\u5fd9\u7684\u60c5\u51b5\uff0c\u5f53\u5e94\u7528\u7a0b\u5e8f\u8bfb\u53d6\u901f\u5ea6\u6162\uff0c\u90a3\u4e48\u7f13\u5b58\u7a7a\u95f4\u4f1a\u6162\u6162\u88ab\u5360\u6ee1\uff0c\u4e8e\u662f\u4e3a\u4e86\u4fdd\u8bc1\u53d1\u9001\u65b9\u53d1\u9001\u7684\u6570\u636e\u4e0d\u4f1a\u8d85\u8fc7\u7f13\u51b2\u533a\u5927\u5c0f\uff0c\u670d\u52a1\u5668\u5219\u4f1a\u8c03\u6574\u7a97\u53e3\u5927\u5c0f\u7684\u503c\uff0c\u63a5\u7740\u901a\u8fc7 ACK \u62a5\u6587\u901a\u77e5\u7ed9\u5bf9\u65b9\uff0c\u544a\u77e5\u73b0\u5728\u7684\u63a5\u6536\u7a97\u53e3\u5927\u5c0f\uff0c\u4ece\u800c\u63a7\u5236\u53d1\u9001\u65b9\u53d1\u9001\u7684\u6570\u636e\u5927\u5c0f\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#_3","title":"\u96f6\u7a97\u53e3\u901a\u77e5\u4e0e\u7a97\u53e3\u63a2\u6d4b","text":"<p>\u5047\u8bbe\u63a5\u6536\u65b9\u5904\u7406\u6570\u636e\u7684\u901f\u5ea6\u8ddf\u4e0d\u4e0a\u63a5\u6536\u6570\u636e\u7684\u901f\u5ea6\uff0c\u7f13\u5b58\u5c31\u4f1a\u88ab\u5360\u6ee1\uff0c\u4ece\u800c\u5bfc\u81f4\u63a5\u6536\u7a97\u53e3\u4e3a 0\uff0c\u5f53\u53d1\u9001\u65b9\u63a5\u6536\u5230\u96f6\u7a97\u53e3\u901a\u77e5\u65f6\uff0c\u5c31\u4f1a\u505c\u6b62\u53d1\u9001\u6570\u636e\u3002</p> <p>\u5982\u4e0b\u56fe\uff0c\u53ef\u4ee5\u770b\u5230\u63a5\u6536\u65b9\u7684\u7a97\u53e3\u5927\u5c0f\u5728\u4e0d\u65ad\u7684\u6536\u7f29\u81f3 0\uff1a</p> <p></p> <p>\u63a5\u7740\uff0c\u53d1\u9001\u65b9\u4f1a\u5b9a\u65f6\u53d1\u9001\u7a97\u53e3\u5927\u5c0f\u63a2\u6d4b\u62a5\u6587\uff0c\u4ee5\u4fbf\u53ca\u65f6\u77e5\u9053\u63a5\u6536\u65b9\u7a97\u53e3\u5927\u5c0f\u7684\u53d8\u5316\u3002</p> <p>\u4ee5\u4e0b\u56fe Wireshark \u5206\u6790\u56fe\u4f5c\u4e3a\u4f8b\u5b50\u8bf4\u660e\uff1a</p> <p></p> <ul> <li>\u53d1\u9001\u65b9\u53d1\u9001\u4e86\u6570\u636e\u5305 1 \u7ed9\u63a5\u6536\u65b9\uff0c\u63a5\u6536\u65b9\u6536\u5230\u540e\uff0c\u7531\u4e8e\u7f13\u51b2\u533a\u88ab\u5360\u6ee1\uff0c\u56de\u4e86\u4e2a\u96f6\u7a97\u53e3\u901a\u77e5\uff1b</li> <li>\u53d1\u9001\u65b9\u6536\u5230\u96f6\u7a97\u53e3\u901a\u77e5\u540e\uff0c\u5c31\u4e0d\u518d\u53d1\u9001\u6570\u636e\u4e86\uff0c\u76f4\u5230\u8fc7\u4e86 <code>3.4</code> \u79d2\u540e\uff0c\u53d1\u9001\u4e86\u4e00\u4e2a TCP Keep-Alive \u62a5\u6587\uff0c\u4e5f\u5c31\u662f\u7a97\u53e3\u5927\u5c0f\u63a2\u6d4b\u62a5\u6587\uff1b</li> <li>\u5f53\u63a5\u6536\u65b9\u6536\u5230\u7a97\u53e3\u63a2\u6d4b\u62a5\u6587\u540e\uff0c\u5c31\u7acb\u9a6c\u56de\u4e00\u4e2a\u7a97\u53e3\u901a\u77e5\uff0c\u4f46\u662f\u7a97\u53e3\u5927\u5c0f\u8fd8\u662f 0\uff1b</li> <li>\u53d1\u9001\u65b9\u53d1\u73b0\u7a97\u53e3\u8fd8\u662f 0\uff0c\u4e8e\u662f\u7ee7\u7eed\u7b49\u5f85\u4e86 <code>6.8</code>\uff08\u7ffb\u500d\uff09\u79d2\u540e\uff0c\u53c8\u53d1\u9001\u4e86\u7a97\u53e3\u63a2\u6d4b\u62a5\u6587\uff0c\u63a5\u6536\u65b9\u4f9d\u7136\u8fd8\u662f\u56de\u4e86\u7a97\u53e3\u4e3a 0 \u7684\u901a\u77e5\uff1b</li> <li>\u53d1\u9001\u65b9\u53d1\u73b0\u7a97\u53e3\u8fd8\u662f 0\uff0c\u4e8e\u662f\u7ee7\u7eed\u7b49\u5f85\u4e86 <code>13.5</code>\uff08\u7ffb\u500d\uff09\u79d2\u540e\uff0c\u53c8\u53d1\u9001\u4e86\u7a97\u53e3\u63a2\u6d4b\u62a5\u6587\uff0c\u63a5\u6536\u65b9\u4f9d\u7136\u8fd8\u662f\u56de\u4e86\u7a97\u53e3\u4e3a 0 \u7684\u901a\u77e5\uff1b</li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0\uff0c\u8fd9\u4e9b\u7a97\u53e3\u63a2\u6d4b\u62a5\u6587\u4ee5 3.4s\u30016.5s\u300113.5s \u7684\u95f4\u9694\u51fa\u73b0\uff0c\u8bf4\u660e\u8d85\u65f6\u65f6\u95f4\u4f1a\u7ffb\u500d\u9012\u589e\u3002</p> <p>\u8fd9\u8fde\u63a5\u6682\u505c\u4e86 25s\uff0c\u60f3\u8c61\u4e00\u4e0b\u4f60\u5728\u6253\u738b\u8005\u7684\u65f6\u5019\uff0c25s \u7684\u5ef6\u8fdf\u4f60\u8fd8\u80fd\u4e0a\u738b\u8005\u5417\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#_4","title":"\u53d1\u9001\u7a97\u53e3\u7684\u5206\u6790","text":"<p>\u5728 Wireshark \u770b\u5230\u7684 Windows size \u4e5f\u5c31\u662f \" win = \"\uff0c\u8fd9\u4e2a\u503c\u8868\u793a\u53d1\u9001\u7a97\u53e3\u5417\uff1f</p> <p>\u8fd9\u4e0d\u662f\u53d1\u9001\u7a97\u53e3\uff0c\u800c\u662f\u5728\u5411\u5bf9\u65b9\u58f0\u660e\u81ea\u5df1\u7684\u63a5\u6536\u7a97\u53e3\u3002</p> <p>\u4f60\u53ef\u80fd\u4f1a\u597d\u5947\uff0c\u6293\u5305\u6587\u4ef6\u91cc\u6709\u300cWindow size scaling factor\u300d\uff0c\u5b83\u5176\u5b9e\u662f\u7b97\u51fa\u5b9e\u9645\u7a97\u53e3\u5927\u5c0f\u7684\u4e58\u6cd5\u56e0\u5b50\uff0c\u300cWindow size value\u300d\u5b9e\u9645\u4e0a\u5e76\u4e0d\u662f\u771f\u5b9e\u7684\u7a97\u53e3\u5927\u5c0f\uff0c\u771f\u5b9e\u7a97\u53e3\u5927\u5c0f\u7684\u8ba1\u7b97\u516c\u5f0f\u5982\u4e0b\uff1a</p> <p>\u300cWindow size value\u300d * \u300cWindow size scaling factor\u300d = \u300cCaculated window size \u300d</p> <p>\u5bf9\u5e94\u7684\u4e0b\u56fe\u6848\u4f8b\uff0c\u4e5f\u5c31\u662f 32 * 2048 = 65536\u3002</p> <p></p> <p>\u5b9e\u9645\u4e0a\u662f Caculated window size \u7684\u503c\u662f Wireshark \u5de5\u5177\u5e2e\u6211\u4eec\u7b97\u597d\u7684\uff0cWindow size scaling factor \u548c Window size value \u7684\u503c\u662f\u5728 TCP \u5934\u90e8\u4e2d\uff0c\u5176\u4e2d Window size scaling factor \u662f\u5728\u4e09\u6b21\u63e1\u624b\u8fc7\u7a0b\u4e2d\u786e\u5b9a\u7684\uff0c\u5982\u679c\u4f60\u6293\u5305\u7684\u6570\u636e\u6ca1\u6709 TCP \u4e09\u6b21\u63e1\u624b\uff0c\u90a3\u53ef\u80fd\u5c31\u65e0\u6cd5\u7b97\u51fa\u771f\u5b9e\u7684\u7a97\u53e3\u5927\u5c0f\u7684\u503c\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5982\u4f55\u5728\u5305\u91cc\u770b\u51fa\u53d1\u9001\u7a97\u53e3\u7684\u5927\u5c0f\uff1f</p> <p>\u5f88\u9057\u61be\uff0c\u6ca1\u6709\u7b80\u5355\u7684\u529e\u6cd5\uff0c\u53d1\u9001\u7a97\u53e3\u867d\u7136\u662f\u7531\u63a5\u6536\u7a97\u53e3\u51b3\u5b9a\uff0c\u4f46\u662f\u5b83\u53c8\u53ef\u4ee5\u88ab\u7f51\u7edc\u56e0\u7d20\u5f71\u54cd\uff0c\u4e5f\u5c31\u662f\u62e5\u585e\u7a97\u53e3\uff0c\u5b9e\u9645\u4e0a\u53d1\u9001\u7a97\u53e3\u662f\u503c\u662f min(\u62e5\u585e\u7a97\u53e3\uff0c\u63a5\u6536\u7a97\u53e3)\u3002</p> <p>\u53d1\u9001\u7a97\u53e3\u548c MSS \u6709\u4ec0\u4e48\u5173\u7cfb\uff1f</p> <p>\u53d1\u9001\u7a97\u53e3\u51b3\u5b9a\u4e86\u4e00\u53e3\u6c14\u80fd\u53d1\u591a\u5c11\u5b57\u8282\uff0c\u800c MSS \u51b3\u5b9a\u4e86\u8fd9\u4e9b\u5b57\u8282\u8981\u5206\u591a\u5c11\u5305\u624d\u80fd\u53d1\u5b8c\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c\u53d1\u9001\u7a97\u53e3\u4e3a 16000 \u5b57\u8282\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c MSS \u662f 1000 \u5b57\u8282\uff0c\u90a3\u5c31\u9700\u8981\u53d1\u9001 1600/1000 = 16 \u4e2a\u5305\u3002</p> <p>\u53d1\u9001\u65b9\u5728\u4e00\u4e2a\u7a97\u53e3\u53d1\u51fa n \u4e2a\u5305\uff0c\u662f\u4e0d\u662f\u9700\u8981 n \u4e2a ACK \u786e\u8ba4\u62a5\u6587\uff1f</p> <p>\u4e0d\u4e00\u5b9a\uff0c\u56e0\u4e3a TCP \u6709\u7d2f\u8ba1\u786e\u8ba4\u673a\u5236\uff0c\u6240\u4ee5\u5f53\u6536\u5230\u591a\u4e2a\u6570\u636e\u5305\u65f6\uff0c\u53ea\u9700\u8981\u5e94\u7b54\u6700\u540e\u4e00\u4e2a\u6570\u636e\u5305\u7684 ACK \u62a5\u6587\u5c31\u53ef\u4ee5\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#tcp-nagle","title":"TCP \u5ef6\u8fdf\u786e\u8ba4\u4e0e Nagle \u7b97\u6cd5","text":"<p>\u5f53\u6211\u4eec TCP \u62a5\u6587\u7684\u627f\u8f7d\u7684\u6570\u636e\u975e\u5e38\u5c0f\u7684\u65f6\u5019\uff0c\u4f8b\u5982\u51e0\u4e2a\u5b57\u8282\uff0c\u90a3\u4e48\u6574\u4e2a\u7f51\u7edc\u7684\u6548\u7387\u662f\u5f88\u4f4e\u7684\uff0c\u56e0\u4e3a\u6bcf\u4e2a TCP \u62a5\u6587\u4e2d\u90fd\u4f1a\u6709 20 \u4e2a\u5b57\u8282\u7684 TCP \u5934\u90e8\uff0c\u4e5f\u4f1a\u6709 20 \u4e2a\u5b57\u8282\u7684 IP \u5934\u90e8\uff0c\u800c\u6570\u636e\u53ea\u6709\u51e0\u4e2a\u5b57\u8282\uff0c\u6240\u4ee5\u5728\u6574\u4e2a\u62a5\u6587\u4e2d\u6709\u6548\u6570\u636e\u5360\u6709\u7684\u6bd4\u91cd\u5c31\u4f1a\u975e\u5e38\u4f4e\u3002</p> <p>\u8fd9\u5c31\u597d\u50cf\u5feb\u9012\u5458\u5f00\u7740\u5927\u8d27\u8f66\u9001\u4e00\u4e2a\u5c0f\u5305\u88f9\u4e00\u6837\u6d6a\u8d39\u3002</p> <p>\u90a3\u4e48\u5c31\u51fa\u73b0\u4e86\u5e38\u89c1\u7684\u4e24\u79cd\u7b56\u7565\uff0c\u6765\u51cf\u5c11\u5c0f\u62a5\u6587\u7684\u4f20\u8f93\uff0c\u5206\u522b\u662f\uff1a</p> <ul> <li>Nagle \u7b97\u6cd5</li> <li>\u5ef6\u8fdf\u786e\u8ba4</li> </ul> <p>Nagle \u7b97\u6cd5\u662f\u5982\u4f55\u907f\u514d\u5927\u91cf TCP \u5c0f\u6570\u636e\u62a5\u6587\u7684\u4f20\u8f93\uff1f</p> <p>Nagle \u7b97\u6cd5\u505a\u4e86\u4e00\u4e9b\u7b56\u7565\u6765\u907f\u514d\u8fc7\u591a\u7684\u5c0f\u6570\u636e\u62a5\u6587\u53d1\u9001\uff0c\u8fd9\u53ef\u63d0\u9ad8\u4f20\u8f93\u6548\u7387\u3002</p> <p>Nagle \u4f2a\u4ee3\u7801\u5982\u4e0b\uff1a</p> C<pre><code>if \u6709\u6570\u636e\u8981\u53d1\u9001 {\n    if \u53ef\u7528\u7a97\u53e3\u5927\u5c0f &gt;= MSS and \u53ef\u53d1\u9001\u7684\u6570\u636e &gt;= MSS {\n        \u7acb\u523b\u53d1\u9001MSS\u5927\u5c0f\u7684\u6570\u636e\n    } else {\n        if \u6709\u672a\u786e\u8ba4\u7684\u6570\u636e {\n            \u5c06\u6570\u636e\u653e\u5165\u7f13\u5b58\u7b49\u5f85\u63a5\u6536ACK\n        } else {\n            \u7acb\u523b\u53d1\u9001\u6570\u636e\n        }\n    }\n}\n</code></pre> <p>\u4f7f\u7528 Nagle \u7b97\u6cd5\uff0c\u8be5\u7b97\u6cd5\u7684\u601d\u8def\u662f\u5ef6\u65f6\u5904\u7406\uff0c\u53ea\u6709\u6ee1\u8db3\u4e0b\u9762\u4e24\u4e2a\u6761\u4ef6\u4e2d\u7684\u4efb\u610f\u4e00\u4e2a\u6761\u4ef6\uff0c\u624d\u80fd\u53ef\u4ee5\u53d1\u9001\u6570\u636e\uff1a</p> <ul> <li>\u6761\u4ef6\u4e00\uff1a\u8981\u7b49\u5230\u7a97\u53e3\u5927\u5c0f &gt;= <code>MSS</code> \u5e76\u4e14 \u6570\u636e\u5927\u5c0f &gt;= <code>MSS</code>\uff1b</li> <li>\u6761\u4ef6\u4e8c\uff1a\u6536\u5230\u4e4b\u524d\u53d1\u9001\u6570\u636e\u7684 <code>ack</code> \u56de\u5305\uff1b</li> </ul> <p>\u53ea\u8981\u4e0a\u9762\u4e24\u4e2a\u6761\u4ef6\u90fd\u4e0d\u6ee1\u8db3\uff0c\u53d1\u9001\u65b9\u4e00\u76f4\u5728\u56e4\u79ef\u6570\u636e\uff0c\u76f4\u5230\u6ee1\u8db3\u4e0a\u9762\u7684\u53d1\u9001\u6761\u4ef6\u3002</p> <p></p> <p>\u4e0a\u56fe\u53f3\u4fa7\u542f\u7528\u4e86 Nagle \u7b97\u6cd5\uff0c\u5b83\u7684\u53d1\u9001\u6570\u636e\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u4e00\u5f00\u59cb\u7531\u4e8e\u6ca1\u6709\u5df2\u53d1\u9001\u672a\u786e\u8ba4\u7684\u62a5\u6587\uff0c\u6240\u4ee5\u5c31\u7acb\u523b\u53d1\u4e86 H \u5b57\u7b26\uff1b</li> <li>\u63a5\u7740\uff0c\u5728\u8fd8\u6ca1\u6536\u5230\u5bf9 H \u5b57\u7b26\u7684\u786e\u8ba4\u62a5\u6587\u65f6\uff0c\u53d1\u9001\u65b9\u5c31\u4e00\u76f4\u5728\u56e4\u79ef\u6570\u636e\uff0c\u76f4\u5230\u6536\u5230\u4e86\u786e\u8ba4\u62a5\u6587\u540e\uff0c\u6b64\u65f6\u6ca1\u6709\u5df2\u53d1\u9001\u672a\u786e\u8ba4\u7684\u62a5\u6587\uff0c\u4e8e\u662f\u5c31\u628a\u56e4\u79ef\u540e\u7684 ELL \u5b57\u7b26\u4e00\u8d77\u53d1\u7ed9\u4e86\u63a5\u6536\u65b9\uff1b</li> <li>\u5f85\u6536\u5230\u5bf9 ELL \u5b57\u7b26\u7684\u786e\u8ba4\u62a5\u6587\u540e\uff0c\u4e8e\u662f\u628a\u6700\u540e\u4e00\u4e2a O \u5b57\u7b26\u53d1\u9001\u4e86\u51fa\u53bb</li> </ul> <p>\u53ef\u4ee5\u770b\u51fa\uff0cNagle \u7b97\u6cd5\u4e00\u5b9a\u4f1a\u6709\u4e00\u4e2a\u5c0f\u62a5\u6587\uff0c\u4e5f\u5c31\u662f\u5728\u6700\u5f00\u59cb\u7684\u65f6\u5019\u3002</p> <p>\u53e6\u5916\uff0cNagle \u7b97\u6cd5\u9ed8\u8ba4\u662f\u6253\u5f00\u7684\uff0c\u5982\u679c\u5bf9\u4e8e\u4e00\u4e9b\u9700\u8981\u5c0f\u6570\u636e\u5305\u4ea4\u4e92\u7684\u573a\u666f\u7684\u7a0b\u5e8f\uff0c\u6bd4\u5982\uff0ctelnet \u6216 ssh \u8fd9\u6837\u7684\u4ea4\u4e92\u6027\u6bd4\u8f83\u5f3a\u7684\u7a0b\u5e8f\uff0c\u5219\u9700\u8981\u5173\u95ed Nagle \u7b97\u6cd5\u3002</p> <p>\u53ef\u4ee5\u5728 Socket \u8bbe\u7f6e <code>TCP_NODELAY</code> \u9009\u9879\u6765\u5173\u95ed\u8fd9\u4e2a\u7b97\u6cd5\uff08\u5173\u95ed Nagle \u7b97\u6cd5\u6ca1\u6709\u5168\u5c40\u53c2\u6570\uff0c\u9700\u8981\u6839\u636e\u6bcf\u4e2a\u5e94\u7528\u81ea\u5df1\u7684\u7279\u70b9\u6765\u5173\u95ed\uff09\u3002</p> <p></p> <p>\u90a3\u5ef6\u8fdf\u786e\u8ba4\u53c8\u662f\u4ec0\u4e48\uff1f</p> <p>\u4e8b\u5b9e\u4e0a\u5f53\u6ca1\u6709\u643a\u5e26\u6570\u636e\u7684 ACK\uff0c\u5b83\u7684\u7f51\u7edc\u6548\u7387\u4e5f\u662f\u5f88\u4f4e\u7684\uff0c\u56e0\u4e3a\u5b83\u4e5f\u6709 40 \u4e2a\u5b57\u8282\u7684 IP \u5934 \u548c TCP \u5934\uff0c\u4f46\u5374\u6ca1\u6709\u643a\u5e26\u6570\u636e\u62a5\u6587\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3 ACK \u4f20\u8f93\u6548\u7387\u4f4e\u95ee\u9898\uff0c\u6240\u4ee5\u5c31\u884d\u751f\u51fa\u4e86 TCP \u5ef6\u8fdf\u786e\u8ba4\u3002</p> <p>TCP \u5ef6\u8fdf\u786e\u8ba4\u7684\u7b56\u7565\uff1a</p> <ul> <li>\u5f53\u6709\u54cd\u5e94\u6570\u636e\u8981\u53d1\u9001\u65f6\uff0cACK \u4f1a\u968f\u7740\u54cd\u5e94\u6570\u636e\u4e00\u8d77\u7acb\u523b\u53d1\u9001\u7ed9\u5bf9\u65b9</li> <li>\u5f53\u6ca1\u6709\u54cd\u5e94\u6570\u636e\u8981\u53d1\u9001\u65f6\uff0cACK \u5c06\u4f1a\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\uff0c\u4ee5\u7b49\u5f85\u662f\u5426\u6709\u54cd\u5e94\u6570\u636e\u53ef\u4ee5\u4e00\u8d77\u53d1\u9001</li> <li>\u5982\u679c\u5728\u5ef6\u8fdf\u7b49\u5f85\u53d1\u9001 ACK \u671f\u95f4\uff0c\u5bf9\u65b9\u7684\u7b2c\u4e8c\u4e2a\u6570\u636e\u62a5\u6587\u53c8\u5230\u8fbe\u4e86\uff0c\u8fd9\u65f6\u5c31\u4f1a\u7acb\u523b\u53d1\u9001 ACK</li> </ul> <p></p> <p>\u5ef6\u8fdf\u7b49\u5f85\u7684\u65f6\u95f4\u662f\u5728 Linux \u5185\u6838\u4e2d\u5b9a\u4e49\u7684\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5173\u952e\u5c31\u9700\u8981 <code>HZ</code> \u8fd9\u4e2a\u6570\u503c\u5927\u5c0f\uff0cHZ \u662f\u8ddf\u7cfb\u7edf\u7684\u65f6\u949f\u9891\u7387\u6709\u5173\uff0c\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u90fd\u4e0d\u4e00\u6837\uff0c\u5728\u6211\u7684 Linux \u7cfb\u7edf\u4e2d HZ \u5927\u5c0f\u662f <code>1000</code>\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u77e5\u9053\u4e86 HZ \u7684\u5927\u5c0f\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7b97\u51fa\uff1a</p> <ul> <li>\u6700\u5927\u5ef6\u8fdf\u786e\u8ba4\u65f6\u95f4\u662f <code>200</code> ms \uff081000/5\uff09</li> <li>\u6700\u77ed\u5ef6\u8fdf\u786e\u8ba4\u65f6\u95f4\u662f <code>40</code> ms \uff081000/25\uff09</li> </ul> <p>TCP \u5ef6\u8fdf\u786e\u8ba4\u53ef\u4ee5\u5728 Socket \u8bbe\u7f6e <code>TCP_QUICKACK</code> \u9009\u9879\u6765\u5173\u95ed\u8fd9\u4e2a\u7b97\u6cd5\u3002</p> <p></p> <p>\u5ef6\u8fdf\u786e\u8ba4 \u548c Nagle \u7b97\u6cd5\u6df7\u5408\u4f7f\u7528\u65f6\uff0c\u4f1a\u4ea7\u751f\u65b0\u7684\u95ee\u9898</p> <p>\u5f53 TCP \u5ef6\u8fdf\u786e\u8ba4 \u548c Nagle \u7b97\u6cd5\u6df7\u5408\u4f7f\u7528\u65f6\uff0c\u4f1a\u5bfc\u81f4\u65f6\u8017\u589e\u957f\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u53d1\u9001\u65b9\u4f7f\u7528\u4e86 Nagle \u7b97\u6cd5\uff0c\u63a5\u6536\u65b9\u4f7f\u7528\u4e86 TCP \u5ef6\u8fdf\u786e\u8ba4\u4f1a\u53d1\u751f\u5982\u4e0b\u7684\u8fc7\u7a0b\uff1a</p> <ul> <li>\u53d1\u9001\u65b9\u5148\u53d1\u51fa\u4e00\u4e2a\u5c0f\u62a5\u6587\uff0c\u63a5\u6536\u65b9\u6536\u5230\u540e\uff0c\u7531\u4e8e\u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\uff0c\u81ea\u5df1\u53c8\u6ca1\u6709\u8981\u53d1\u9001\u7684\u6570\u636e\uff0c\u53ea\u80fd\u5e72\u7b49\u7740\u53d1\u9001\u65b9\u7684\u4e0b\u4e00\u4e2a\u62a5\u6587\u5230\u8fbe\uff1b</li> <li>\u800c\u53d1\u9001\u65b9\u7531\u4e8e Nagle \u7b97\u6cd5\u673a\u5236\uff0c\u5728\u672a\u6536\u5230\u7b2c\u4e00\u4e2a\u62a5\u6587\u7684\u786e\u8ba4\u524d\uff0c\u662f\u4e0d\u4f1a\u53d1\u9001\u540e\u7eed\u7684\u6570\u636e\uff1b</li> <li>\u6240\u4ee5\u63a5\u6536\u65b9\u53ea\u80fd\u7b49\u5f85\u6700\u5927\u65f6\u95f4 200 ms \u540e\uff0c\u624d\u56de ACK \u62a5\u6587\uff0c\u53d1\u9001\u65b9\u6536\u5230\u7b2c\u4e00\u4e2a\u62a5\u6587\u7684\u786e\u8ba4\u62a5\u6587\u540e\uff0c\u4e5f\u624d\u53ef\u4ee5\u53d1\u9001\u540e\u7eed\u7684\u6570\u636e\u3002</li> </ul> <p>\u5f88\u660e\u663e\uff0c\u8fd9\u4e24\u4e2a\u540c\u65f6\u4f7f\u7528\u4f1a\u9020\u6210\u989d\u5916\u7684\u65f6\u5ef6\uff0c\u8fd9\u5c31\u4f1a\u4f7f\u5f97\u7f51\u7edc\"\u5f88\u6162\"\u7684\u611f\u89c9\u3002</p> <p>\u8981\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u53ea\u6709\u4e24\u4e2a\u529e\u6cd5\uff1a</p> <ul> <li>\u8981\u4e0d\u53d1\u9001\u65b9\u5173\u95ed Nagle \u7b97\u6cd5</li> <li>\u8981\u4e0d\u63a5\u6536\u65b9\u5173\u95ed TCP \u5ef6\u8fdf\u786e\u8ba4</li> </ul> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <p>[1] Wireshark \u7f51\u7edc\u5206\u6790\u7684\u827a\u672f\u3002\u6797\u6c9b\u6ee1\u3002\u4eba\u6c11\u90ae\u7535\u51fa\u7248\u793e\u3002</p> <p>[2] Wireshark \u7f51\u7edc\u5206\u6790\u5c31\u8fd9\u4e48\u7b80\u5355\u3002\u6797\u6c9b\u6ee1\u3002\u4eba\u6c11\u90ae\u7535\u51fa\u7248\u793e\u3002</p> <p>[3] Wireshark \u6570\u636e\u5305\u5206\u6790\u5b9e\u6218.Chris Sanders .\u4eba\u6c11\u90ae\u7535\u51fa\u7248\u793e\u3002\u8bfb\u8005\u95ee\u7b54</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#_5","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u8bfb\u8005\u95ee\uff1a\u201c\u4e24\u4e2a\u95ee\u9898\uff0c\u8bf7\u6559\u4e00\u4e0b\u4f5c\u8005\uff1a tcp_retries1 \u53c2\u6570\uff0c\u662f\u4ec0\u4e48\u573a\u666f\u4e0b\u751f\u6548\uff1f tcp_retries2 \u662f\u4e0d\u662f\u53ea\u53d7\u9650\u4e8e\u89c4\u5b9a\u7684\u6b21\u6570\uff0c\u8fd8\u662f\u53d7\u9650\u4e8e\u6b21\u6570\u548c\u65f6\u95f4\u9650\u5236\u7684\u6700\u5c0f\u503c\uff1f\u201d</p> <p>tcp_retries1 \u548c tcp_retries2 \u90fd\u662f\u5728 TCP \u4e09\u6b21\u63e1\u624b\u4e4b\u540e\u7684\u573a\u666f\u3002</p> <ul> <li>\u5f53\u91cd\u4f20\u6b21\u6570\u8d85\u8fc7 tcp_retries1 \u5c31\u4f1a\u6307\u793a IP \u5c42\u8fdb\u884c MTU \u63a2\u6d4b\u3001\u5237\u65b0\u8def\u7531\u7b49\u8fc7\u7a0b\uff0c\u5e76\u4e0d\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\uff0c\u5f53\u91cd\u4f20\u6b21\u6570\u8d85\u8fc7 tcp_retries2 \u624d\u4f1a\u65ad\u5f00 TCP \u6d41\u3002</li> <li>tcp_retries1 \u548c tcp_retries2 \u4e24\u4e2a\u91cd\u4f20\u6b21\u6570\u90fd\u662f\u53d7\u4e00\u4e2a timeout \u503c\u9650\u5236\u7684\uff0ctimeout \u7684\u503c\u662f\u6839\u636e\u5b83\u4fe9\u7684\u503c\u8ba1\u7b97\u51fa\u6765\u7684\uff0c\u5f53\u91cd\u4f20\u65f6\u95f4\u8d85\u8fc7 timeout\uff0c\u5c31\u4e0d\u4f1a\u7ee7\u7eed\u91cd\u4f20\u4e86\uff0c\u5373\u4f7f\u6b21\u6570\u8fd8\u6ca1\u5230\u8fbe\u3002</li> </ul> <p>\u8bfb\u8005\u95ee\uff1a\u201ctcp_orphan_retries \u4e5f\u662f\u63a7\u5236 tcp \u8fde\u63a5\u7684\u5173\u95ed\u3002\u8fd9\u4e2a\u8ddf tcp_retries1 tcp_retries2 \u6709\u4ec0\u4e48\u533a\u522b\u5417\uff1f\u201d</p> <p>\u4e3b\u52a8\u65b9\u53d1\u9001 FIN \u62a5\u6587\u540e\uff0c\u8fde\u63a5\u5c31\u5904\u4e8e FIN_WAIT1 \u72b6\u6001\u4e0b\uff0c\u8be5\u72b6\u6001\u901a\u5e38\u5e94\u5728\u6570\u5341\u6beb\u79d2\u5185\u8f6c\u4e3a FIN_WAIT2\u3002\u5982\u679c\u8fdf\u8fdf\u6536\u4e0d\u5230\u5bf9\u65b9\u8fd4\u56de\u7684 ACK \u65f6\uff0c\u6b64\u65f6\uff0c\u5185\u6838\u4f1a\u5b9a\u65f6\u91cd\u53d1 FIN \u62a5\u6587\uff0c\u5176\u4e2d\u91cd\u53d1\u6b21\u6570\u7531 tcp_orphan_retries \u53c2\u6570\u63a7\u5236\u3002</p> <p>\u8bfb\u8005\u95ee\uff1a\u201c\u8bf7\u95ee\uff0c\u4e3a\u4ec0\u4e48\u8fde\u7eed\u4e24\u4e2a\u62a5\u6587\u7684 seq \u4f1a\u662f\u4e00\u6837\u7684\u5462\uff0c\u6bd4\u5982\u4e09\u6b21\u63e1\u624b\u4e4b\u540e\u7684\u90a3\u4e2a\u62a5\u6587\uff1f\u8fd8\u662f\u8bf4\uff0c\u5e8f\u53f7\u76f8\u540c\u7684\u662f\u540c\u4e00\u4e2a\u62a5\u6587\uff0c\u53ea\u662f\u62c6\u5f00\u663e\u793a\u4e86\uff1f\u201d</p> <ol> <li>\u4e09\u6b21\u63e1\u624b\u4e2d\u7684\u524d\u4e24\u6b21\uff0c\u662f seq+1\uff1b</li> <li>\u4e09\u6b21\u63e1\u624b\u4e2d\u7684\u6700\u540e\u4e00\u4e2a ack\uff0c\u5b9e\u9645\u4e0a\u662f\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684\uff0c\u7531\u4e8e\u6211\u6587\u7ae0\u7684\u4f8b\u5b50\u662f\u6ca1\u6709\u53d1\u9001\u6570\u636e\u7684\uff0c\u4f60\u53ef\u4ee5\u770b\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\u7684 len=0\uff0c\u5728\u6570\u636e\u4f20\u8f93\u9636\u6bb5\u300c\u4e0b\u4e00\u4e2a seq=seq+len\u300d\uff0c\u6240\u4ee5\u7b2c\u4e09\u6b21\u63e1\u624b\u7684 seq \u548c\u4e0b\u4e00\u4e2a\u6570\u636e\u62a5\u7684 seq \u662f\u4e00\u6837\u7684\uff0c\u56e0\u4e3a len \u4e3a 0\uff1b</li> </ol>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tcpdump/#_6","title":"\u6700\u540e","text":"<p>\u6587\u7ae0\u4e2d Wireshark \u5206\u6790\u7684\u622a\u56fe\uff0c\u53ef\u80fd\u6709\u4e9b\u4f1a\u770b\u7684\u4e0d\u6e05\u695a\uff0c\u4e3a\u4e86\u65b9\u4fbf\u5927\u5bb6\u7528 Wireshark \u5206\u6790\uff0c\u6211\u5df2\u628a\u6587\u4e2d\u6240\u6709\u6293\u5305\u7684\u6e90\u6587\u4ef6\uff0c\u5df2\u5206\u4eab\u5230\u516c\u4f17\u53f7\u4e86\uff0c\u5927\u5bb6\u5728\u540e\u53f0\u56de\u590d\u300c\u6293\u5305\u300d\uff0c\u5c31\u53ef\u4ee5\u83b7\u53d6\u4e86\u3002</p> <p></p> <p>\u5c0f\u6797\u662f\u4e13\u4e3a\u5927\u5bb6\u56fe\u89e3\u7684\u5de5\u5177\u4eba\uff0cGoodbye\uff0c\u6211\u4eec\u4e0b\u6b21\u89c1\uff01</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_three_fin/","title":"4.22 TCP \u56db\u6b21\u6325\u624b\uff0c\u53ef\u4ee5\u53d8\u6210\u4e09\u6b21\u5417\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6709\u4f4d\u8bfb\u8005\u9762\u7f8e\u56e2\u65f6\uff0c\u88ab\u95ee\u5230\uff1aTCP \u56db\u6b21\u6325\u624b\u4e2d\uff0c\u80fd\u4e0d\u80fd\u628a\u7b2c\u4e8c\u6b21\u7684 ACK \u62a5\u6587\uff0c\u653e\u5230\u7b2c\u4e09\u6b21 FIN \u62a5\u6587\u4e00\u8d77\u53d1\u9001\uff1f</p> <p></p> <p>\u867d\u7136\u6211\u4eec\u5728\u5b66\u4e60 TCP \u6325\u624b\u65f6\uff0c\u5b66\u5230\u7684\u662f\u9700\u8981\u56db\u6b21\u6765\u5b8c\u6210 TCP \u6325\u624b\uff0c\u4f46\u662f\u5728\u4e00\u4e9b\u60c5\u51b5\u4e0b\uff0cTCP \u56db\u6b21\u6325\u624b\u662f\u53ef\u4ee5\u53d8\u6210 TCP \u4e09\u6b21\u6325\u624b\u7684\u3002</p> <p></p> <p>\u800c\u4e14\u5728\u7528 wireshark \u5de5\u5177\u6293\u5305\u7684\u65f6\u5019\uff0c\u6211\u4eec\u4e5f\u4f1a\u5e38\u770b\u5230 TCP \u6325\u624b\u8fc7\u7a0b\u662f\u4e09\u6b21\uff0c\u800c\u4e0d\u662f\u56db\u6b21\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5148\u6765\u56de\u7b54\u4e3a\u4ec0\u4e48 RFC \u6587\u6863\u91cc\u5b9a\u4e49 TCP \u6325\u624b\u8fc7\u7a0b\u662f\u8981\u56db\u6b21\uff1f</p> <p>\u518d\u6765\u56de\u7b54\u4ec0\u4e48\u60c5\u51b5\u4e0b\uff0c\u4ec0\u4e48\u60c5\u51b5\u4f1a\u51fa\u73b0\u4e09\u6b21\u6325\u624b\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_three_fin/#tcp","title":"TCP \u56db\u6b21\u6325\u624b","text":"<p>TCP \u56db\u6b21\u6325\u624b\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <p></p> <p>\u5177\u4f53\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u4e3b\u52a8\u8c03\u7528\u5173\u95ed\u8fde\u63a5\u7684\u51fd\u6570\uff0c\u4e8e\u662f\u5c31\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u8fd9\u4e2a  FIN \u62a5\u6587\u4ee3\u8868\u5ba2\u6237\u7aef\u4e0d\u4f1a\u518d\u53d1\u9001\u6570\u636e\u4e86\uff0c\u8fdb\u5165 FIN_WAIT_1 \u72b6\u6001\uff1b</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u4e86 FIN \u62a5\u6587\uff0c\u7136\u540e\u9a6c\u4e0a\u56de\u590d\u4e00\u4e2a ACK \u786e\u8ba4\u62a5\u6587\uff0c\u6b64\u65f6\u670d\u52a1\u7aef\u8fdb\u5165 CLOSE_WAIT \u72b6\u6001\u3002\u5728\u6536\u5230 FIN \u62a5\u6587\u7684\u65f6\u5019\uff0cTCP \u534f\u8bae\u6808\u4f1a\u4e3a FIN \u5305\u63d2\u5165\u4e00\u4e2a\u6587\u4ef6\u7ed3\u675f\u7b26 EOF \u5230\u63a5\u6536\u7f13\u51b2\u533a\u4e2d\uff0c\u670d\u52a1\u7aef\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u901a\u8fc7 read \u8c03\u7528\u6765\u611f\u77e5\u8fd9\u4e2a FIN \u5305\uff0c\u8fd9\u4e2a EOF \u4f1a\u88ab\u653e\u5728\u5df2\u6392\u961f\u7b49\u5019\u7684\u5176\u4ed6\u5df2\u63a5\u6536\u7684\u6570\u636e\u4e4b\u540e\uff0c\u6240\u4ee5\u5fc5\u987b\u8981\u5f97\u7ee7\u7eed read \u63a5\u6536\u7f13\u51b2\u533a\u5df2\u63a5\u6536\u7684\u6570\u636e\uff1b</li> <li>\u63a5\u7740\uff0c\u5f53\u670d\u52a1\u7aef\u5728 read \u6570\u636e\u7684\u65f6\u5019\uff0c\u6700\u540e\u81ea\u7136\u5c31\u4f1a\u8bfb\u5230 EOF\uff0c\u63a5\u7740 read() \u5c31\u4f1a\u8fd4\u56de 0\uff0c\u8fd9\u65f6\u670d\u52a1\u7aef\u5e94\u7528\u7a0b\u5e8f\u5982\u679c\u6709\u6570\u636e\u8981\u53d1\u9001\u7684\u8bdd\uff0c\u5c31\u53d1\u5b8c\u6570\u636e\u540e\u624d\u8c03\u7528\u5173\u95ed\u8fde\u63a5\u7684\u51fd\u6570\uff0c\u5982\u679c\u670d\u52a1\u7aef\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u5173\u95ed\u8fde\u63a5\u7684\u51fd\u6570\uff0c\u8fd9\u65f6\u670d\u52a1\u7aef\u5c31\u4f1a\u53d1\u4e00\u4e2a FIN \u5305\uff0c\u8fd9\u4e2a  FIN \u62a5\u6587\u4ee3\u8868\u670d\u52a1\u7aef\u4e0d\u4f1a\u518d\u53d1\u9001\u6570\u636e\u4e86\uff0c\u4e4b\u540e\u5904\u4e8e LAST_ACK \u72b6\u6001\uff1b</li> <li>\u5ba2\u6237\u7aef\u63a5\u6536\u5230\u670d\u52a1\u7aef\u7684 FIN \u5305\uff0c\u5e76\u53d1\u9001 ACK \u786e\u8ba4\u5305\u7ed9\u670d\u52a1\u7aef\uff0c\u6b64\u65f6\u5ba2\u6237\u7aef\u5c06\u8fdb\u5165 TIME_WAIT \u72b6\u6001\uff1b</li> <li>\u670d\u52a1\u7aef\u6536\u5230 ACK \u786e\u8ba4\u5305\u540e\uff0c\u5c31\u8fdb\u5165\u4e86\u6700\u540e\u7684 CLOSE \u72b6\u6001\uff1b</li> <li>\u5ba2\u6237\u7aef\u7ecf\u8fc7 2MSL \u65f6\u95f4\u4e4b\u540e\uff0c\u4e5f\u8fdb\u5165 CLOSE \u72b6\u6001\uff1b</li> </ul> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u6bcf\u4e2a\u65b9\u5411\u90fd\u9700\u8981\u4e00\u4e2a FIN \u548c\u4e00\u4e2a ACK\uff0c\u56e0\u6b64\u901a\u5e38\u88ab\u79f0\u4e3a\u56db\u6b21\u6325\u624b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_three_fin/#tcp_1","title":"\u4e3a\u4ec0\u4e48 TCP \u6325\u624b\u9700\u8981\u56db\u6b21\u5462\uff1f","text":"<p>\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u7684 FIN \u62a5\u6587\u65f6\uff0c\u5185\u6838\u4f1a\u9a6c\u4e0a\u56de\u4e00\u4e2a ACK \u5e94\u7b54\u62a5\u6587\uff0c\u4f46\u662f\u670d\u52a1\u7aef\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u8fd8\u6709\u6570\u636e\u8981\u53d1\u9001\uff0c\u6240\u4ee5\u5e76\u4e0d\u80fd\u9a6c\u4e0a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u800c\u662f\u5c06\u53d1\u9001 FIN \u62a5\u6587\u7684\u63a7\u5236\u6743\u4ea4\u7ed9\u670d\u52a1\u7aef\u5e94\u7528\u7a0b\u5e8f\uff1a</p> <ul> <li>\u5982\u679c\u670d\u52a1\u7aef\u5e94\u7528\u7a0b\u5e8f\u6709\u6570\u636e\u8981\u53d1\u9001\u7684\u8bdd\uff0c\u5c31\u53d1\u5b8c\u6570\u636e\u540e\uff0c\u624d\u8c03\u7528\u5173\u95ed\u8fde\u63a5\u7684\u51fd\u6570\uff1b</li> <li>\u5982\u679c\u670d\u52a1\u7aef\u5e94\u7528\u7a0b\u5e8f\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u7684\u8bdd\uff0c\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528\u5173\u95ed\u8fde\u63a5\u7684\u51fd\u6570\uff0c</li> </ul> <p>\u4ece\u4e0a\u9762\u8fc7\u7a0b\u53ef\u77e5\uff0c\u662f\u5426\u8981\u53d1\u9001\u7b2c\u4e09\u6b21\u6325\u624b\u7684\u63a7\u5236\u6743\u4e0d\u5728\u5185\u6838\uff0c\u800c\u662f\u5728\u88ab\u52a8\u5173\u95ed\u65b9\uff08\u4e0a\u56fe\u7684\u670d\u52a1\u7aef\uff09\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u56e0\u4e3a\u5e94\u7528\u7a0b\u5e8f\u53ef\u80fd\u8fd8\u6709\u6570\u636e\u8981\u53d1\u9001\uff0c\u7531\u5e94\u7528\u7a0b\u5e8f\u51b3\u5b9a\u4ec0\u4e48\u65f6\u5019\u8c03\u7528\u5173\u95ed\u8fde\u63a5\u7684\u51fd\u6570\uff0c\u5f53\u8c03\u7528\u4e86\u5173\u95ed\u8fde\u63a5\u7684\u51fd\u6570\uff0c\u5185\u6838\u5c31\u4f1a\u53d1\u9001 FIN \u62a5\u6587\u4e86\uff0c \u6240\u4ee5\u670d\u52a1\u7aef\u7684 ACK \u548c FIN \u4e00\u822c\u90fd\u4f1a\u5206\u5f00\u53d1\u9001\u3002</p> <p>FIN \u62a5\u6587\u4e00\u5b9a\u5f97\u8c03\u7528\u5173\u95ed\u8fde\u63a5\u7684\u51fd\u6570\uff0c\u624d\u4f1a\u53d1\u9001\u5417\uff1f</p> <p>\u4e0d\u4e00\u5b9a\u3002</p> <p>\u5982\u679c\u8fdb\u7a0b\u9000\u51fa\u4e86\uff0c\u4e0d\u7ba1\u662f\u4e0d\u662f\u6b63\u5e38\u9000\u51fa\uff0c\u8fd8\u662f\u5f02\u5e38\u9000\u51fa\uff08\u5982\u8fdb\u7a0b\u5d29\u6e83\uff09\uff0c\u5185\u6838\u90fd\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u4e0e\u5bf9\u65b9\u5b8c\u6210\u56db\u6b21\u6325\u624b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_three_fin/#vs","title":"\u7c97\u66b4\u5173\u95ed vs \u4f18\u96c5\u5173\u95ed","text":"<p>\u524d\u9762\u4ecb\u7ecd TCP \u56db\u6b21\u6325\u624b\u7684\u65f6\u5019\uff0c\u5e76\u6ca1\u6709\u8be6\u7ec6\u4ecb\u7ecd\u5173\u95ed\u8fde\u63a5\u7684\u51fd\u6570\uff0c\u5176\u5b9e\u5173\u95ed\u7684\u8fde\u63a5\u7684\u51fd\u6570\u6709\u4e24\u79cd\u51fd\u6570\uff1a</p> <ul> <li>close \u51fd\u6570\uff0c\u540c\u65f6 socket \u5173\u95ed\u53d1\u9001\u65b9\u5411\u548c\u8bfb\u53d6\u65b9\u5411\uff0c\u4e5f\u5c31\u662f socket \u4e0d\u518d\u6709\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u7684\u80fd\u529b\u3002\u5982\u679c\u6709\u591a\u8fdb\u7a0b/\u591a\u7ebf\u7a0b\u5171\u4eab\u540c\u4e00\u4e2a socket\uff0c\u5982\u679c\u6709\u4e00\u4e2a\u8fdb\u7a0b\u8c03\u7528\u4e86 close \u5173\u95ed\u53ea\u662f\u8ba9 socket \u5f15\u7528\u8ba1\u6570 -1\uff0c\u5e76\u4e0d\u4f1a\u5bfc\u81f4 socket \u4e0d\u53ef\u7528\uff0c\u540c\u65f6\u4e5f\u4e0d\u4f1a\u53d1\u51fa FIN \u62a5\u6587\uff0c\u5176\u4ed6\u8fdb\u7a0b\u8fd8\u662f\u53ef\u4ee5\u6b63\u5e38\u8bfb\u5199\u8be5 socket\uff0c\u76f4\u5230\u5f15\u7528\u8ba1\u6570\u53d8\u4e3a 0\uff0c\u624d\u4f1a\u53d1\u51fa FIN \u62a5\u6587\u3002</li> <li>shutdown \u51fd\u6570\uff0c\u53ef\u4ee5\u6307\u5b9a socket \u53ea\u5173\u95ed\u53d1\u9001\u65b9\u5411\u800c\u4e0d\u5173\u95ed\u8bfb\u53d6\u65b9\u5411\uff0c\u4e5f\u5c31\u662f socket \u4e0d\u518d\u6709\u53d1\u9001\u6570\u636e\u7684\u80fd\u529b\uff0c\u4f46\u662f\u8fd8\u662f\u5177\u6709\u63a5\u6536\u6570\u636e\u7684\u80fd\u529b\u3002\u5982\u679c\u6709\u591a\u8fdb\u7a0b/\u591a\u7ebf\u7a0b\u5171\u4eab\u540c\u4e00\u4e2a socket\uff0cshutdown \u5219\u4e0d\u7ba1\u5f15\u7528\u8ba1\u6570\uff0c\u76f4\u63a5\u4f7f\u5f97\u8be5 socket \u4e0d\u53ef\u7528\uff0c\u7136\u540e\u53d1\u51fa FIN \u62a5\u6587\uff0c\u5982\u679c\u6709\u522b\u7684\u8fdb\u7a0b\u4f01\u56fe\u4f7f\u7528\u8be5 socket\uff0c\u5c06\u4f1a\u53d7\u5230\u5f71\u54cd\u3002</li> </ul> <p>\u5982\u679c\u5ba2\u6237\u7aef\u662f\u7528 close \u51fd\u6570\u6765\u5173\u95ed\u8fde\u63a5\uff0c\u90a3\u4e48\u5728 TCP   \u56db\u6b21\u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6536\u5230\u4e86\u670d\u52a1\u7aef\u53d1\u9001\u7684\u6570\u636e\uff0c\u7531\u4e8e\u5ba2\u6237\u7aef\u5df2\u7ecf\u4e0d\u518d\u5177\u6709\u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\u7684\u80fd\u529b\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u7684\u5185\u6838\u4f1a\u56de RST \u62a5\u6587\u7ed9\u670d\u52a1\u7aef\uff0c\u7136\u540e\u5185\u6838\u4f1a\u91ca\u653e\u8fde\u63a5\uff0c\u8fd9\u65f6\u5c31\u4e0d\u4f1a\u7ecf\u5386\u5b8c\u6210\u7684 TCP \u56db\u6b21\u6325\u624b\uff0c\u6240\u4ee5\u6211\u4eec\u5e38\u8bf4\uff0c\u8c03\u7528 close \u662f\u7c97\u66b4\u7684\u5173\u95ed\u3002</p> <p></p> <p>\u5f53\u670d\u52a1\u7aef\u6536\u5230 RST \u540e\uff0c\u5185\u6838\u5c31\u4f1a\u91ca\u653e\u8fde\u63a5\uff0c\u5f53\u670d\u52a1\u7aef\u5e94\u7528\u7a0b\u5e8f\u518d\u6b21\u53d1\u8d77\u8bfb\u64cd\u4f5c\u6216\u8005\u5199\u64cd\u4f5c\u65f6\uff0c\u5c31\u80fd\u611f\u77e5\u5230\u8fde\u63a5\u5df2\u7ecf\u88ab\u91ca\u653e\u4e86\uff1a</p> <ul> <li>\u5982\u679c\u662f\u8bfb\u64cd\u4f5c\uff0c\u5219\u4f1a\u8fd4\u56de RST \u7684\u62a5\u9519\uff0c\u4e5f\u5c31\u662f\u6211\u4eec\u5e38\u89c1\u7684 Connection reset by peer\u3002</li> <li>\u5982\u679c\u662f\u5199\u64cd\u4f5c\uff0c\u90a3\u4e48\u7a0b\u5e8f\u4f1a\u4ea7\u751f SIGPIPE \u4fe1\u53f7\uff0c\u5e94\u7528\u5c42\u4ee3\u7801\u53ef\u4ee5\u6355\u83b7\u5e76\u5904\u7406\u4fe1\u53f7\uff0c\u5982\u679c\u4e0d\u5904\u7406\uff0c\u5219\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8fdb\u7a0b\u4f1a\u7ec8\u6b62\uff0c\u5f02\u5e38\u9000\u51fa\u3002</li> </ul> <p>\u76f8\u5bf9\u7684\uff0cshutdown \u51fd\u6570\u56e0\u4e3a\u53ef\u4ee5\u6307\u5b9a\u53ea\u5173\u95ed\u53d1\u9001\u65b9\u5411\u800c\u4e0d\u5173\u95ed\u8bfb\u53d6\u65b9\u5411\uff0c\u6240\u4ee5\u5373\u4f7f\u5728 TCP \u56db\u6b21\u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u6536\u5230\u4e86\u670d\u52a1\u7aef\u53d1\u9001\u7684\u6570\u636e\uff0c\u5ba2\u6237\u7aef\u4e5f\u662f\u53ef\u4ee5\u6b63\u5e38\u8bfb\u53d6\u5230\u8be5\u6570\u636e\u7684\uff0c\u7136\u540e\u5c31\u4f1a\u7ecf\u5386\u5b8c\u6574\u7684 TCP \u56db\u6b21\u6325\u624b\uff0c\u6240\u4ee5\u6211\u4eec\u5e38\u8bf4\uff0c\u8c03\u7528 shutdown \u662f\u4f18\u96c5\u7684\u5173\u95ed\u3002</p> <p></p> <p>\u4f46\u662f\u6ce8\u610f\uff0cshutdown \u51fd\u6570\u4e5f\u53ef\u4ee5\u6307\u5b9a\u300c\u53ea\u5173\u95ed\u8bfb\u53d6\u65b9\u5411\uff0c\u800c\u4e0d\u5173\u95ed\u53d1\u9001\u65b9\u5411\u300d\uff0c\u4f46\u662f\u8fd9\u65f6\u5019\u5185\u6838\u662f\u4e0d\u4f1a\u53d1\u9001 FIN \u62a5\u6587\u7684\uff0c\u56e0\u4e3a\u53d1\u9001 FIN \u62a5\u6587\u662f\u610f\u5473\u7740\u6211\u65b9\u5c06\u4e0d\u518d\u53d1\u9001\u4efb\u4f55\u6570\u636e\uff0c\u800c shutdown \u5982\u679c\u6307\u5b9a\u300c\u4e0d\u5173\u95ed\u53d1\u9001\u65b9\u5411\u300d\uff0c\u5c31\u610f\u5473\u7740 socket \u8fd8\u6709\u53d1\u9001\u6570\u636e\u7684\u80fd\u529b\uff0c\u6240\u4ee5\u5185\u6838\u5c31\u4e0d\u4f1a\u53d1\u9001 FIN\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_three_fin/#_1","title":"\u4ec0\u4e48\u60c5\u51b5\u4f1a\u51fa\u73b0\u4e09\u6b21\u6325\u624b\uff1f","text":"<p>\u5f53\u88ab\u52a8\u5173\u95ed\u65b9\uff08\u4e0a\u56fe\u7684\u670d\u52a1\u7aef\uff09\u5728 TCP \u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u300c\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u300d\u5e76\u4e14\u300c\u5f00\u542f\u4e86 TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\u300d\uff0c\u90a3\u4e48\u7b2c\u4e8c\u548c\u7b2c\u4e09\u6b21\u6325\u624b\u5c31\u4f1a\u5408\u5e76\u4f20\u8f93\uff0c\u8fd9\u6837\u5c31\u51fa\u73b0\u4e86\u4e09\u6b21\u6325\u624b\u3002</p> <p></p> <p>\u7136\u540e\u56e0\u4e3a TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\uff0c\u6240\u4ee5\u5bfc\u81f4\u6211\u4eec\u6293\u5305\u65f6\uff0c\u770b\u89c1\u4e09\u6b21\u6325\u624b\u7684\u6b21\u6570\u6bd4\u56db\u6b21\u6325\u624b\u8fd8\u591a\u3002</p> <p>\u4ec0\u4e48\u662f  TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\uff1f</p> <p>\u5f53\u53d1\u9001\u6ca1\u6709\u643a\u5e26\u6570\u636e\u7684 ACK\uff0c\u5b83\u7684\u7f51\u7edc\u6548\u7387\u4e5f\u662f\u5f88\u4f4e\u7684\uff0c\u56e0\u4e3a\u5b83\u4e5f\u6709 40 \u4e2a\u5b57\u8282\u7684 IP \u5934 \u548c TCP \u5934\uff0c\u4f46\u5374\u6ca1\u6709\u643a\u5e26\u6570\u636e\u62a5\u6587\u3002 \u4e3a\u4e86\u89e3\u51b3 ACK \u4f20\u8f93\u6548\u7387\u4f4e\u95ee\u9898\uff0c\u6240\u4ee5\u5c31\u884d\u751f\u51fa\u4e86 TCP \u5ef6\u8fdf\u786e\u8ba4\u3002 TCP \u5ef6\u8fdf\u786e\u8ba4\u7684\u7b56\u7565\uff1a</p> <ul> <li>\u5f53\u6709\u54cd\u5e94\u6570\u636e\u8981\u53d1\u9001\u65f6\uff0cACK \u4f1a\u968f\u7740\u54cd\u5e94\u6570\u636e\u4e00\u8d77\u7acb\u523b\u53d1\u9001\u7ed9\u5bf9\u65b9</li> <li>\u5f53\u6ca1\u6709\u54cd\u5e94\u6570\u636e\u8981\u53d1\u9001\u65f6\uff0cACK \u5c06\u4f1a\u5ef6\u8fdf\u4e00\u6bb5\u65f6\u95f4\uff0c\u4ee5\u7b49\u5f85\u662f\u5426\u6709\u54cd\u5e94\u6570\u636e\u53ef\u4ee5\u4e00\u8d77\u53d1\u9001</li> <li>\u5982\u679c\u5728\u5ef6\u8fdf\u7b49\u5f85\u53d1\u9001 ACK \u671f\u95f4\uff0c\u5bf9\u65b9\u7684\u7b2c\u4e8c\u4e2a\u6570\u636e\u62a5\u6587\u53c8\u5230\u8fbe\u4e86\uff0c\u8fd9\u65f6\u5c31\u4f1a\u7acb\u523b\u53d1\u9001 ACK</li> </ul> <p></p> <p>\u5ef6\u8fdf\u7b49\u5f85\u7684\u65f6\u95f4\u662f\u5728 Linux \u5185\u6838\u4e2d\u5b9a\u4e49\u7684\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5173\u952e\u5c31\u9700\u8981 HZ \u8fd9\u4e2a\u6570\u503c\u5927\u5c0f\uff0cHZ \u662f\u8ddf\u7cfb\u7edf\u7684\u65f6\u949f\u9891\u7387\u6709\u5173\uff0c\u6bcf\u4e2a\u64cd\u4f5c\u7cfb\u7edf\u90fd\u4e0d\u4e00\u6837\uff0c\u5728\u6211\u7684 Linux \u7cfb\u7edf\u4e2d HZ \u5927\u5c0f\u662f 1000\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u77e5\u9053\u4e86 HZ \u7684\u5927\u5c0f\uff0c\u90a3\u4e48\u5c31\u53ef\u4ee5\u7b97\u51fa\uff1a</p> <ul> <li>\u6700\u5927\u5ef6\u8fdf\u786e\u8ba4\u65f6\u95f4\u662f 200 ms\uff081000/5\uff09</li> <li>\u6700\u77ed\u5ef6\u8fdf\u786e\u8ba4\u65f6\u95f4\u662f 40 ms\uff081000/25\uff09</li> </ul> <p>\u600e\u4e48\u5173\u95ed TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\uff1f</p> <p>\u5982\u679c\u8981\u5173\u95ed TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\uff0c\u53ef\u4ee5\u5728 Socket \u8bbe\u7f6e\u91cc\u542f\u7528 TCP_QUICKACK\u3002</p> C++<pre><code>// 1 \u8868\u793a\u5f00\u542f TCP_QUICKACK\uff0c\u5373\u5173\u95ed TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\nint value = 1;\nsetsockopt(socketfd, IPPROTO_TCP, TCP_QUICKACK, (char*)&amp; value, sizeof(int));\n</code></pre>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_three_fin/#_2","title":"\u5b9e\u9a8c\u9a8c\u8bc1","text":""},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_three_fin/#_3","title":"\u5b9e\u9a8c\u4e00","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6765\u7ed9\u5927\u5bb6\u505a\u4e2a\u5b9e\u9a8c\uff0c\u9a8c\u8bc1\u8fd9\u4e2a\u7ed3\u8bba\uff1a</p> <p>\u5f53\u88ab\u52a8\u5173\u95ed\u65b9\uff08\u4e0a\u56fe\u7684\u670d\u52a1\u7aef\uff09\u5728 TCP \u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u300c\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u300d\u5e76\u4e14\u300c\u5f00\u542f\u4e86 TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\u300d\uff0c\u90a3\u4e48\u7b2c\u4e8c\u548c\u7b2c\u4e09\u6b21\u6325\u624b\u5c31\u4f1a\u5408\u5e76\u4f20\u8f93\uff0c\u8fd9\u6837\u5c31\u51fa\u73b0\u4e86\u4e09\u6b21\u6325\u624b\u3002</p> <p>\u670d\u52a1\u7aef\u7684\u4ee3\u7801\u5982\u4e0b\uff0c\u505a\u7684\u4e8b\u60c5\u5f88\u7b80\u5355\uff0c\u5c31\u8bfb\u53d6\u6570\u636e\uff0c\u7136\u540e\u5f53 read \u8fd4\u56de 0 \u7684\u65f6\u5019\uff0c\u5c31\u9a6c\u4e0a\u8c03\u7528 close \u5173\u95ed\u8fde\u63a5\u3002\u56e0\u4e3a TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\u662f\u9ed8\u8ba4\u5f00\u542f\u7684\uff0c\u6240\u4ee5\u4e0d\u9700\u8981\u7279\u6b8a\u8bbe\u7f6e\u3002</p> C++<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;string.h&gt;\n#include &lt;netdb.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;sys/socket.h&gt;\n#include &lt;netinet/tcp.h&gt;\n\n#define MAXLINE 1024\n\nint main(int argc, char *argv[])\n{\n\n    // 1. \u521b\u5efa\u4e00\u4e2a\u76d1\u542c socket\n    int listenfd = socket(AF_INET, SOCK_STREAM, 0);\n    if(listenfd &lt; 0)\n    {\n        fprintf(stderr, \"socket error : %s\\n\", strerror(errno));\n        return -1;\n    }\n\n    // 2. \u521d\u59cb\u5316\u670d\u52a1\u5668\u5730\u5740\u548c\u7aef\u53e3\n    struct sockaddr_in server_addr;\n    bzero(&amp;server_addr, sizeof(struct sockaddr_in));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.s_addr = htonl(INADDR_ANY);\n    server_addr.sin_port = htons(8888);\n\n    // 3. \u7ed1\u5b9a\u5730\u5740 + \u7aef\u53e3\n    if(bind(listenfd, (struct sockaddr *)(&amp;server_addr), sizeof(struct sockaddr)) &lt; 0)\n    {\n        fprintf(stderr,\"bind error:%s\\n\", strerror(errno));\n        return -1;\n    }\n\n    printf(\"begin listen....\\n\");\n\n    // 4. \u5f00\u59cb\u76d1\u542c\n    if(listen(listenfd, 128))\n    {\n        fprintf(stderr, \"listen error:%s\\n\\a\", strerror(errno));\n        exit(1);\n    }\n\n\n    // 5. \u83b7\u53d6\u5df2\u8fde\u63a5\u7684 socket\n    struct sockaddr_in client_addr;\n    socklen_t client_addrlen = sizeof(client_addr);\n    int clientfd = accept(listenfd, (struct sockaddr *)&amp;client_addr, &amp;client_addrlen);\n    if(clientfd &lt; 0) {\n        fprintf(stderr, \"accept error:%s\\n\\a\", strerror(errno));\n        exit(1);\n    }\n\n    printf(\"accept success\\n\");\n\n    char message[MAXLINE] = {0};\n\n    while(1) {\n        //6. \u8bfb\u53d6\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6570\u636e\n        int n = read(clientfd, message, MAXLINE);\n        if(n &lt; 0) { // \u8bfb\u53d6\u9519\u8bef\n            fprintf(stderr, \"read error:%s\\n\\a\", strerror(errno));\n            break;\n        } else if(n == 0) {  // \u8fd4\u56de 0\uff0c\u4ee3\u8868\u8bfb\u5230 FIN \u62a5\u6587\n            fprintf(stderr, \"client closed \\n\");\n            close(clientfd); // \u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\uff0c\u7acb\u9a6c\u5173\u95ed\u8fde\u63a5\n            break;\n        }\n\n        message[n] = 0; \n        printf(\"received %d bytes: %s\\n\", n, message);\n    }\n\n    close(listenfd);\n    return 0;\n}\n</code></pre> <p>\u5ba2\u6237\u7aef\u4ee3\u7801\u5982\u4e0b\uff0c\u505a\u7684\u4e8b\u60c5\u4e5f\u5f88\u7b80\u5355\uff0c\u4e0e\u670d\u52a1\u7aef\u8fde\u63a5\u6210\u529f\u540e\uff0c\u5c31\u53d1\u9001\u6570\u636e\u7ed9\u670d\u52a1\u7aef\uff0c\u7136\u540e\u7761\u7720\u4e00\u79d2\u540e\uff0c\u5c31\u8c03\u7528 close \u5173\u95ed\u8fde\u63a5\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u662f\u4e3b\u52a8\u5173\u95ed\u65b9\uff1a</p> C++<pre><code>#include &lt;stdlib.h&gt;\n#include &lt;stdio.h&gt;\n#include &lt;errno.h&gt;\n#include &lt;string.h&gt;\n#include &lt;netdb.h&gt;\n#include &lt;sys/types.h&gt;\n#include &lt;netinet/in.h&gt;\n#include &lt;sys/socket.h&gt;\n\nint main(int argc, char *argv[])\n{\n\n    // 1. \u521b\u5efa\u4e00\u4e2a\u76d1\u542c socket\n    int connectfd = socket(AF_INET, SOCK_STREAM, 0);\n    if(connectfd &lt; 0)\n    {\n        fprintf(stderr, \"socket error : %s\\n\", strerror(errno));\n        return -1;\n    }\n\n    // 2. \u521d\u59cb\u5316\u670d\u52a1\u5668\u5730\u5740\u548c\u7aef\u53e3\n    struct sockaddr_in server_addr;\n    bzero(&amp;server_addr, sizeof(struct sockaddr_in));\n    server_addr.sin_family = AF_INET;\n    server_addr.sin_addr.s_addr = inet_addr(\"127.0.0.1\");\n    server_addr.sin_port = htons(8888);\n\n    // 3. \u8fde\u63a5\u670d\u52a1\u5668\n    if(connect(connectfd, (struct sockaddr *)(&amp;server_addr), sizeof(server_addr)) &lt; 0)\n    {\n        fprintf(stderr,\"connect error:%s\\n\", strerror(errno));\n        return -1;\n    }\n\n    printf(\"connect success\\n\");\n\n\n    char sendline[64] = \"hello, i am xiaolin\";\n\n    //4. \u53d1\u9001\u6570\u636e\n    int ret = send(connectfd, sendline, strlen(sendline), 0);\n    if(ret != strlen(sendline)) {\n        fprintf(stderr,\"send data error:%s\\n\", strerror(errno));\n        return -1;\n    }\n\n    printf(\"already send %d bytes\\n\", ret);\n\n    sleep(1);\n\n    //5. \u5173\u95ed\u8fde\u63a5\n    close(connectfd);\n    return 0;\n}\n</code></pre> <p>\u7f16\u8bd1\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u7684\u4ee3\u7801\uff1a</p> <p></p> <p>\u5148\u542f\u7528\u670d\u52a1\u7aef\uff1a</p> <p></p> <p>\u7136\u540e\u7528 tcpdump \u5de5\u5177\u5f00\u59cb\u6293\u5305\uff0c\u547d\u4ee4\u5982\u4e0b\uff1a</p> Bash<pre><code>tcpdump -i lo tcp and port 8888 -s0 -w /home/tcp_close.pcap\n</code></pre> <p>\u7136\u540e\u542f\u7528\u5ba2\u6237\u7aef\uff0c\u53ef\u4ee5\u770b\u5230\uff0c\u4e0e\u670d\u52a1\u7aef\u8fde\u63a5\u6210\u529f\u540e\uff0c\u53d1\u5b8c\u6570\u636e\u5c31\u9000\u51fa\u4e86\u3002</p> <p></p> <p>\u6b64\u65f6\uff0c\u670d\u52a1\u7aef\u7684\u8f93\u51fa\uff1a</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u770b\u770b\u6293\u5305\u7684\u7ed3\u679c\u3002</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230\uff0cTCP \u6325\u624b\u6b21\u6570\u662f 3 \u6b21\u3002</p> <p>\u6240\u4ee5\uff0c\u4e0b\u9762\u8fd9\u4e2a\u7ed3\u8bba\u662f\u6ca1\u95ee\u9898\u7684\u3002</p> <p>\u7ed3\u8bba\uff1a\u5f53\u88ab\u52a8\u5173\u95ed\u65b9\uff08\u4e0a\u56fe\u7684\u670d\u52a1\u7aef\uff09\u5728 TCP \u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u300c\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u300d\u5e76\u4e14\u300c\u5f00\u542f\u4e86 TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\uff08\u9ed8\u8ba4\u4f1a\u5f00\u542f\uff09\u300d\uff0c\u90a3\u4e48\u7b2c\u4e8c\u548c\u7b2c\u4e09\u6b21\u6325\u624b\u5c31\u4f1a\u5408\u5e76\u4f20\u8f93\uff0c\u8fd9\u6837\u5c31\u51fa\u73b0\u4e86\u4e09\u6b21\u6325\u624b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_three_fin/#_4","title":"\u5b9e\u9a8c\u4e8c","text":"<p>\u6211\u4eec\u518d\u505a\u4e00\u6b21\u5b9e\u9a8c\uff0c\u6765\u770b\u770b\u5173\u95ed TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\uff0c\u4f1a\u51fa\u73b0\u56db\u6b21\u6325\u624b\u5417\uff1f</p> <p>\u5ba2\u6237\u7aef\u4ee3\u7801\u4fdd\u6301\u4e0d\u53d8\uff0c\u670d\u52a1\u7aef\u4ee3\u7801\u9700\u8981\u589e\u52a0\u4e00\u70b9\u4e1c\u897f\u3002</p> <p>\u5728\u4e0a\u9762\u670d\u52a1\u7aef\u4ee3\u7801\u4e2d\uff0c\u589e\u52a0\u4e86\u6253\u5f00\u4e86 TCP_QUICKACK\uff08\u5feb\u901f\u5e94\u7b54\uff09\u673a\u5236\u7684\u4ee3\u7801\uff0c\u5982\u4e0b\uff1a</p> <p></p> <p>\u7f16\u8bd1\u597d\u670d\u52a1\u7aef\u4ee3\u7801\u540e\uff0c\u5c31\u5f00\u59cb\u8fd0\u884c\u670d\u52a1\u7aef\u548c\u5ba2\u6237\u7aef\u7684\u4ee3\u7801\uff0c\u540c\u65f6\u7528 tcpdump \u8fdb\u884c\u6293\u5305\u3002</p> <p>\u6293\u5305\u7684\u7ed3\u679c\u5982\u4e0b\uff0c\u53ef\u4ee5\u770b\u5230\u662f\u56db\u6b21\u6325\u624b\u3002 </p> <p>\u6240\u4ee5\uff0c\u5f53\u88ab\u52a8\u5173\u95ed\u65b9\uff08\u4e0a\u56fe\u7684\u670d\u52a1\u7aef\uff09\u5728 TCP \u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u300c\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u300d\uff0c\u540c\u65f6\u300c\u5173\u95ed\u4e86 TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\u300d\uff0c\u90a3\u4e48\u5c31\u4f1a\u662f\u56db\u6b21\u6325\u624b\u3002</p> <p>\u8bbe\u7f6e TCP_QUICKACK \u7684\u4ee3\u7801\uff0c\u4e3a\u4ec0\u4e48\u8981\u653e\u5728 read \u8fd4\u56de 0 \u4e4b\u540e\uff1f</p> <p>\u6211\u4e5f\u662f\u591a\u6b21\u5b9e\u9a8c\u624d\u53d1\u73b0\uff0c\u5728 bind \u4e4b\u524d\u8bbe\u7f6e TCP_QUICKACK \u662f\u4e0d\u751f\u6548\u7684\uff0c\u53ea\u6709\u5728 read \u8fd4\u56de 0 \u7684\u65f6\u5019\uff0c\u8bbe\u7f6e TCP_QUICKACK \u624d\u4f1a\u51fa\u73b0\u56db\u6b21\u6325\u624b\u3002</p> <p>\u7f51\u4e0a\u67e5\u4e86\u4e0b\u8d44\u6599\u8bf4\uff0c\u8bbe\u7f6e TCP_QUICKACK \u5e76\u4e0d\u662f\u6c38\u4e45\u7684\uff0c\u6240\u4ee5\u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u7684\u65f6\u5019\uff0c\u5982\u679c\u60f3\u8981\u7acb\u523b\u56de ACK\uff0c\u90a3\u5c31\u5f97\u5728\u6bcf\u6b21\u8bfb\u53d6\u6570\u636e\u4e4b\u540e\uff0c\u91cd\u65b0\u8bbe\u7f6e TCP_QUICKACK\u3002</p> <p>\u800c\u6211\u8fd9\u91cc\u7684\u5b9e\u9a8c\uff0c\u76ee\u7684\u662f\u4e3a\u4e86\u5f53\u6536\u5230\u5ba2\u6237\u7aef\u7684 FIN \u62a5\u6587\uff08\u7b2c\u4e00\u6b21\u6325\u624b\uff09\u540e\uff0c\u7acb\u9a6c\u56de ACK \u62a5\u6587\u3002\u6240\u4ee5\u5c31\u5728 read \u8fd4\u56de 0 \u7684\u65f6\u5019\uff0c\u8bbe\u7f6e TCP_QUICKACK\u3002\u5f53\u7136\uff0c\u5b9e\u9645\u5e94\u7528\u4e2d\uff0c\u6ca1\u4eba\u4f1a\u5728\u8fd9\u4e2a\u4f4d\u7f6e\u8bbe\u7f6e TCP_QUICKACK\uff0c\u56e0\u4e3a\u64cd\u4f5c\u7cfb\u7edf\u90fd\u901a\u8fc7 TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\u5e2e\u6211\u4eec\u628a\u56db\u6b21\u6325\u624b\u4f18\u5316\u6210\u4e86\u4e09\u6b21\u6325\u624b\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_three_fin/#_5","title":"\u603b\u7ed3","text":"<p>\u5f53\u88ab\u52a8\u5173\u95ed\u65b9\u5728 TCP \u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c\u300c\u6ca1\u6709\u6570\u636e\u8981\u53d1\u9001\u300d\uff0c\u540c\u65f6\u300c\u6ca1\u6709\u5f00\u542f TCP_QUICKACK\uff08\u9ed8\u8ba4\u60c5\u51b5\u5c31\u662f\u6ca1\u6709\u5f00\u542f\uff0c\u6ca1\u6709\u5f00\u542f TCP_QUICKACK\uff0c\u7b49\u4e8e\u5c31\u662f\u5728\u4f7f\u7528 TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\uff09\u300d\uff0c\u90a3\u4e48\u7b2c\u4e8c\u548c\u7b2c\u4e09\u6b21\u6325\u624b\u5c31\u4f1a\u5408\u5e76\u4f20\u8f93\uff0c\u8fd9\u6837\u5c31\u51fa\u73b0\u4e86\u4e09\u6b21\u6325\u624b\u3002</p> <p>\u6240\u4ee5\uff0c\u51fa\u73b0\u4e09\u6b21\u6325\u624b\u73b0\u8c61\uff0c\u662f\u56e0\u4e3a TCP \u5ef6\u8fdf\u786e\u8ba4\u673a\u5236\u5bfc\u81f4\u7684\u3002</p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u6b22\u8fce\u5fae\u4fe1\u641c\u7d22\u300c\u5c0f\u6797 coding\u300d</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tls/","title":"4.14 HTTPS \u4e2d TLS \u548c TCP \u80fd\u540c\u65f6\u63e1\u624b\u5417\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u6709\u4f4d\u8bfb\u8005\u5728\u9762\u8bd5\u7684\u65f6\u5019\uff0c\u78b0\u5230\u8fd9\u4e48\u4e2a\u95ee\u9898\uff1a</p> <p></p> <p>\u9762\u8bd5\u5b98\u8ddf\u4ed6\u8bf4 HTTPS \u4e2d\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\uff0c\u7136\u540e\u8bfb\u8005\u4e4b\u524d\u770b\u6211\u7684\u6587\u7ae0\u662f\u8bf4\u300c\u5148\u8fdb\u884c TCP \u4e09\u6b21\u63e1\u624b\uff0c\u518d\u8fdb\u884c TLS \u56db\u6b21\u63e1\u624b\u300d\uff0c\u4ed6\u8ddf\u9762\u8bd5\u5b98\u8bf4\u4e86\u8fd9\u4e2a\uff0c\u9762\u8bd5\u5b98\u8bf4\u4ed6\u4e0d\u5bf9\uff0c\u4ed6\u5c31\u611f\u5230\u5f88\u56f0\u60d1\u3002</p> <p>\u6211\u4eec\u5148\u4e0d\u7ba1\u9762\u8bd5\u5b98\u8bf4\u7684\u90a3\u53e5\u300cHTTPS \u4e2d\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\u300d\u5bf9\u4e0d\u5bf9\u3002</p> <p>\u4f46\u662f\u9762\u8bd5\u5b98\u8bf4\u300cHTTPS \u5efa\u7acb\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u5148\u8fdb\u884c TCP \u4e09\u6b21\u63e1\u624b\uff0c\u518d\u8fdb\u884c TLS \u56db\u6b21\u63e1\u624b\u300d\u662f\u9519\u7684\uff0c\u8fd9\u5f88\u660e\u663e\u9762\u8bd5\u5b98\u7684\u6c34\u5e73\u6709\u95ee\u9898\uff0c\u8fd9\u79cd\u516c\u53f8\u4e0d\u53bb\u4e5f\u7f62\uff01</p> <p>\u5982\u679c\u662f\u6211\u9762\u8bd5\u9047\u5230\u8fd9\u6837\u7684\u9762\u8bd5\u5b98\uff0c\u6211\u76f4\u63a5\u5f53\u573a\u7ed9\u4ed6\u6293 HTTPS \u5efa\u7acb\u8fc7\u7a0b\u7684\u7f51\u7edc\u5305\uff0c\u7136\u540e\u7ed9\u4ed6\u770b\uff0c\u556a\u556a\u556a\u556a\u556a\u7684\u6253\u4ed6\u8138\u3002</p> <p>\u6bd4\u5982\uff0c\u4e0b\u9762\u8fd9\u4e2a TLSv1.2 \u7684 \u57fa\u4e8e RSA \u7b97\u6cd5\u7684\u56db\u6b21\u63e1\u624b\u8fc7\u7a0b\uff1a</p> <p></p> <p>\u96be\u9053\u4e0d\u662f\u5148\u4e09\u6b21\u63e1\u624b\uff0c\u518d\u8fdb\u884c TLS \u56db\u6b21\u63e1\u624b\u5417\uff1f\u9762\u8bd5\u5b98\u4f60\u8138\u75bc\u5417\uff1f</p> <p>\u4e0d\u8fc7 TLS \u63e1\u624b\u8fc7\u7a0b\u7684\u6b21\u6570\u8fd8\u5f97\u770b\u7248\u672c\u3002</p> <p>TLSv1.2 \u63e1\u624b\u8fc7\u7a0b\u57fa\u672c\u90fd\u662f\u9700\u8981\u56db\u6b21\uff0c\u4e5f\u5c31\u662f\u9700\u8981\u7ecf\u8fc7 2-RTT \u624d\u80fd\u5b8c\u6210\u63e1\u624b\uff0c\u7136\u540e\u624d\u80fd\u53d1\u9001\u8bf7\u6c42\uff0c\u800c TLSv1.3 \u53ea\u9700\u8981 1-RTT \u5c31\u80fd\u5b8c\u6210 TLS \u63e1\u624b\uff0c\u5982\u4e0b\u56fe\u3002</p> <p></p> <p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u4e0d\u7ba1 TLS \u63e1\u624b\u6b21\u6570\u5982\u4f55\uff0c\u90fd\u5f97\u5148\u7ecf\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\u540e\u624d\u80fd\u8fdb\u884c\uff0c\u56e0\u4e3a HTTPS \u90fd\u662f\u57fa\u4e8e TCP \u4f20\u8f93\u534f\u8bae\u5b9e\u73b0\u7684\uff0c\u5f97\u5148\u5efa\u7acb\u5b8c\u53ef\u9760\u7684 TCP \u8fde\u63a5\u624d\u80fd\u505a TLS \u63e1\u624b\u7684\u4e8b\u60c5\u3002</p> <p>\u90a3\u9762\u8bd5\u5b98\u8bf4\u7684\u8fd9\u53e5\u300cHTTPS \u4e2d\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\u300d\u5bf9\u4e0d\u5bf9\u5462\uff1f</p> <p>\u8fd9\u4e2a\u573a\u666f\u662f\u53ef\u80fd\u53d1\u751f\u7684\uff0c\u4f46\u662f\u9700\u8981\u5728\u7279\u5b9a\u7684\u6761\u4ef6\u4e0b\u624d\u53ef\u80fd\u53d1\u751f\uff0c\u5982\u679c\u6ca1\u6709\u8bf4\u4efb\u4f55\u524d\u63d0\u6761\u4ef6\uff0c\u8bf4\u8fd9\u53e5\u8bdd\u5c31\u662f\u5728\u800d\u6d41\u6c13\u3002</p> <p>\u90a3\u5230\u5e95\u4ec0\u4e48\u6761\u4ef6\u4e0b\uff0c\u8fd9\u4e2a\u573a\u666f\u624d\u80fd\u53d1\u751f\u5462\uff1f\u9700\u8981\u4e0b\u9762\u8fd9\u4e24\u4e2a\u6761\u4ef6\u540c\u65f6\u6ee1\u8db3\u624d\u53ef\u4ee5\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u5f00\u542f\u4e86 TCP Fast Open \u529f\u80fd\uff0c\u4e14 TLS \u7248\u672c\u662f 1.3\uff1b</li> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5df2\u7ecf\u5b8c\u6210\u8fc7\u4e00\u6b21\u901a\u4fe1\u3002</li> </ul> <p>\u90a3\u5177\u4f53\u600e\u4e48\u505a\u5230\u7684\u5462\uff1f\u6211\u4eec\u5148\u4e86\u89e3\u4e9b TCP Fast Open \u529f\u80fd\u548c TLSv1.3 \u7684\u7279\u6027\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tls/#tcp-fast-open","title":"TCP Fast Open","text":"<p>\u6211\u4eec\u5148\u6765\u4e86\u89e3\u4e0b\u4ec0\u4e48\u662f TCP Fast Open\uff1f</p> <p>\u5e38\u89c4\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u8981\u4f7f\u7528 TCP \u4f20\u8f93\u534f\u8bae\u8fdb\u884c\u901a\u4fe1\uff0c\u5219\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u901a\u4fe1\u4e4b\u524d\uff0c\u5148\u8981\u7ecf\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\u540e\uff0c\u5efa\u7acb\u5b8c\u53ef\u9760\u7684 TCP \u8fde\u63a5\u540e\uff0c\u5ba2\u6237\u7aef\u624d\u80fd\u5c06\u6570\u636e\u53d1\u9001\u7ed9\u670d\u52a1\u7aef\u3002</p> <p>\u5176\u4e2d\uff0cTCP \u7684\u7b2c\u4e00\u6b21\u548c\u7b2c\u4e8c\u6b21\u63e1\u624b\u662f\u4e0d\u80fd\u591f\u643a\u5e26\u6570\u636e\u7684\uff0c\u800c TCP \u7684\u7b2c\u4e09\u6b21\u63e1\u624b\u662f\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684\uff0c\u56e0\u4e3a\u8fd9\u65f6\u5019\u5ba2\u6237\u7aef\u7684 TCP \u8fde\u63a5\u72b6\u6001\u5df2\u7ecf\u662f ESTABLISHED\uff0c\u8868\u660e\u5ba2\u6237\u7aef\u8fd9\u4e00\u65b9\u5df2\u7ecf\u5b8c\u6210\u4e86 TCP \u8fde\u63a5\u5efa\u7acb\u3002</p> <p></p> <p>\u5c31\u7b97\u5ba2\u6237\u7aef\u643a\u5e26\u6570\u636e\u7684\u7b2c\u4e09\u6b21\u63e1\u624b\u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u4e86\uff0c\u5ba2\u6237\u7aef\u5728\u4e00\u5b9a\u65f6\u95f4\u5185\u6ca1\u6709\u6536\u5230\u670d\u52a1\u7aef\u5bf9\u8be5\u6570\u636e\u7684\u5e94\u7b54\u62a5\u6587\uff0c\u5c31\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u91cd\u4f20\u8be5\u643a\u5e26\u6570\u636e\u7684\u7b2c\u4e09\u6b21\u63e1\u624b\u7684\u62a5\u6587\uff0c\u76f4\u5230\u91cd\u4f20\u6b21\u6570\u8fbe\u5230\u7cfb\u7edf\u7684\u9608\u503c\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u9500\u6bc1\u8be5 TCP \u8fde\u63a5\u3002</p> <p>\u8bf4\u5b8c\u5e38\u89c4\u7684 TCP \u8fde\u63a5\u540e\uff0c\u6211\u4eec\u518d\u6765\u770b\u770b TCP Fast Open\u3002</p> <p>TCP Fast Open \u662f\u4e3a\u4e86\u7ed5\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\u53d1\u9001\u6570\u636e\uff0c\u5728 Linux 3.7 \u5185\u6838\u7248\u672c\u4e4b\u540e\uff0c\u63d0\u4f9b\u4e86 TCP Fast Open \u529f\u80fd\uff0c\u8fd9\u4e2a\u529f\u80fd\u53ef\u4ee5\u51cf\u5c11 TCP \u8fde\u63a5\u5efa\u7acb\u7684\u65f6\u5ef6\u3002</p> <p>\u8981\u4f7f\u7528 TCP Fast Open \u529f\u80fd\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u8981\u540c\u65f6\u652f\u6301\u624d\u4f1a\u751f\u6548\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5f00\u542f\u4e86 TCP Fast Open \u529f\u80fd\uff0c\u60f3\u8981\u7ed5\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\u53d1\u9001\u6570\u636e\uff0c\u5f97\u5efa\u7acb\u7b2c\u4e8c\u6b21\u4ee5\u540e\u7684\u901a\u4fe1\u8fc7\u7a0b\u3002</p> <p>\u5728\u5ba2\u6237\u7aef\u9996\u6b21\u5efa\u7acb\u8fde\u63a5\u65f6\u7684\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5177\u4f53\u4ecb\u7ecd\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u53d1\u9001 SYN \u62a5\u6587\uff0c\u8be5\u62a5\u6587\u5305\u542b Fast Open \u9009\u9879\uff0c\u4e14\u8be5\u9009\u9879\u7684 Cookie \u4e3a\u7a7a\uff0c\u8fd9\u8868\u660e\u5ba2\u6237\u7aef\u8bf7\u6c42 Fast Open Cookie\uff1b</li> <li>\u652f\u6301 TCP Fast Open \u7684\u670d\u52a1\u5668\u751f\u6210 Cookie\uff0c\u5e76\u5c06\u5176\u7f6e\u4e8e SYN-ACK \u62a5\u6587\u4e2d\u7684 Fast Open \u9009\u9879\u4ee5\u53d1\u56de\u5ba2\u6237\u7aef\uff1b</li> <li>\u5ba2\u6237\u7aef\u6536\u5230 SYN-ACK \u540e\uff0c\u672c\u5730\u7f13\u5b58 Fast Open \u9009\u9879\u4e2d\u7684 Cookie\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u7b2c\u4e00\u6b21\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u901a\u4fe1\u7684\u65f6\u5019\uff0c\u8fd8\u662f\u9700\u8981\u6b63\u5e38\u7684\u4e09\u6b21\u63e1\u624b\u6d41\u7a0b\u3002\u968f\u540e\uff0c\u5ba2\u6237\u7aef\u5c31\u6709\u4e86 Cookie \u8fd9\u4e2a\u4e1c\u897f\uff0c\u5b83\u53ef\u4ee5\u7528\u6765\u5411\u670d\u52a1\u5668 TCP \u8bc1\u660e\u5148\u524d\u4e0e\u5ba2\u6237\u7aef IP \u5730\u5740\u7684\u4e09\u5411\u63e1\u624b\u5df2\u6210\u529f\u5b8c\u6210\u3002</p> <p>\u5bf9\u4e8e\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef\u7684\u540e\u7eed\u901a\u4fe1\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u5728\u7b2c\u4e00\u6b21\u63e1\u624b\u7684\u65f6\u5019\u643a\u5e26\u5e94\u7528\u6570\u636e\uff0c\u4ece\u800c\u8fbe\u5230\u7ed5\u8fc7\u4e09\u6b21\u63e1\u624b\u53d1\u9001\u6570\u636e\u7684\u6548\u679c\uff0c\u6574\u4e2a\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6211\u8be6\u7ec6\u4ecb\u7ecd\u4e0b\u8fd9\u4e2a\u8fc7\u7a0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u53d1\u9001 SYN \u62a5\u6587\uff0c\u8be5\u62a5\u6587\u53ef\u4ee5\u643a\u5e26\u300c\u5e94\u7528\u6570\u636e\u300d\u4ee5\u53ca\u6b64\u524d\u8bb0\u5f55\u7684 Cookie\uff1b</li> <li>\u652f\u6301 TCP Fast Open \u7684\u670d\u52a1\u5668\u4f1a\u5bf9\u6536\u5230 Cookie \u8fdb\u884c\u6821\u9a8c\uff1a\u5982\u679c Cookie \u6709\u6548\uff0c\u670d\u52a1\u5668\u5c06\u5728 SYN-ACK \u62a5\u6587\u4e2d\u5bf9 SYN \u548c\u300c\u6570\u636e\u300d\u8fdb\u884c\u786e\u8ba4\uff0c\u670d\u52a1\u5668\u968f\u540e\u5c06\u300c\u5e94\u7528\u6570\u636e\u300d\u9012\u9001\u7ed9\u5bf9\u5e94\u7684\u5e94\u7528\u7a0b\u5e8f\uff1b\u5982\u679c Cookie \u65e0\u6548\uff0c\u670d\u52a1\u5668\u5c06\u4e22\u5f03 SYN \u62a5\u6587\u4e2d\u5305\u542b\u7684\u300c\u5e94\u7528\u6570\u636e\u300d\uff0c\u4e14\u5176\u968f\u540e\u53d1\u51fa\u7684 SYN-ACK \u62a5\u6587\u5c06\u53ea\u786e\u8ba4 SYN \u7684\u5bf9\u5e94\u5e8f\u5217\u53f7\uff1b</li> <li>\u5982\u679c\u670d\u52a1\u5668\u63a5\u53d7\u4e86 SYN \u62a5\u6587\u4e2d\u7684\u300c\u5e94\u7528\u6570\u636e\u300d\uff0c\u670d\u52a1\u5668\u53ef\u5728\u63e1\u624b\u5b8c\u6210\u4e4b\u524d\u53d1\u9001\u300c\u54cd\u5e94\u6570\u636e\u300d\uff0c\u8fd9\u5c31\u51cf\u5c11\u4e86\u63e1\u624b\u5e26\u6765\u7684 1 \u4e2a RTT \u7684\u65f6\u95f4\u6d88\u8017\uff1b</li> <li>\u5ba2\u6237\u7aef\u5c06\u53d1\u9001 ACK \u786e\u8ba4\u670d\u52a1\u5668\u53d1\u56de\u7684 SYN \u4ee5\u53ca\u300c\u5e94\u7528\u6570\u636e\u300d\uff0c\u4f46\u5982\u679c\u5ba2\u6237\u7aef\u5728\u521d\u59cb\u7684 SYN \u62a5\u6587\u4e2d\u53d1\u9001\u7684\u300c\u5e94\u7528\u6570\u636e\u300d\u6ca1\u6709\u88ab\u786e\u8ba4\uff0c\u5219\u5ba2\u6237\u7aef\u5c06\u91cd\u65b0\u53d1\u9001\u300c\u5e94\u7528\u6570\u636e\u300d\uff1b</li> <li>\u6b64\u540e\u7684 TCP \u8fde\u63a5\u7684\u6570\u636e\u4f20\u8f93\u8fc7\u7a0b\u548c\u975e TCP Fast Open \u7684\u6b63\u5e38\u60c5\u51b5\u4e00\u81f4\u3002</li> </ul> <p>\u6240\u4ee5\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u540c\u65f6\u652f\u6301 TCP Fast Open \u529f\u80fd\uff0c\u90a3\u4e48\u5728\u5b8c\u6210\u9996\u6b21\u901a\u4fe1\u8fc7\u7a0b\u540e\uff0c\u540e\u7eed\u5ba2\u6237\u7aef\u4e0e\u670d\u52a1\u7aef \u7684\u901a\u4fe1\u5219\u53ef\u4ee5\u7ed5\u8fc7\u4e09\u6b21\u63e1\u624b\u53d1\u9001\u6570\u636e\uff0c\u8fd9\u5c31\u51cf\u5c11\u4e86\u63e1\u624b\u5e26\u6765\u7684 1 \u4e2a RTT \u7684\u65f6\u95f4\u6d88\u8017\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tls/#tlsv13","title":"TLSv1.3","text":"<p>\u8bf4\u5b8c TCP Fast Open\uff0c\u518d\u6765\u770b\u770b TLSv1.3\u3002</p> <p>\u5728\u6700\u5f00\u59cb\u7684\u65f6\u5019\uff0c\u6211\u4e5f\u63d0\u5230 TLSv1.3 \u63e1\u624b\u8fc7\u7a0b\u53ea\u9700 1-RTT \u7684\u65f6\u95f4\uff0c\u5b83\u5230\u6574\u4e2a\u63e1\u624b\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>TCP \u8fde\u63a5\u7684\u7b2c\u4e09\u6b21\u63e1\u624b\u662f\u53ef\u4ee5\u643a\u5e26\u6570\u636e\u7684\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5728\u7b2c\u4e09\u6b21\u63e1\u624b\u53d1\u9001\u4e86 TLSv1.3 \u7b2c\u4e00\u6b21\u63e1\u624b\u6570\u636e\uff0c\u662f\u4e0d\u662f\u5c31\u8868\u793a\u300cHTTPS \u4e2d\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\u300d\uff1f\u3002</p> <p>\u4e0d\u662f\u7684\uff0c\u56e0\u4e3a\u670d\u52a1\u7aef\u53ea\u6709\u5728\u6536\u5230\u5ba2\u6237\u7aef\u7684 TCP \u7684\u7b2c\u4e09\u6b21\u63e1\u624b\u540e\uff0c\u624d\u80fd\u548c\u5ba2\u6237\u7aef\u8fdb\u884c\u540e\u7eed TLSv1.3 \u63e1\u624b\u3002</p> <p>TLSv1.3 \u8fd8\u6709\u4e2a\u66f4\u5389\u5bb3\u5230\u5730\u65b9\u5728\u4e8e\u4f1a\u8bdd\u6062\u590d\u673a\u5236\uff0c\u5728\u91cd\u8fde TLvS1.3 \u53ea\u9700\u8981 0-RTT\uff0c\u7528\u201cpre_shared_key\u201d\u548c\u201cearly_data\u201d\u6269\u5c55\uff0c\u5728 TCP \u8fde\u63a5\u540e\u7acb\u5373\u5c31\u5efa\u7acb\u5b89\u5168\u8fde\u63a5\u53d1\u9001\u52a0\u5bc6\u6d88\u606f\uff0c\u8fc7\u7a0b\u5982\u4e0b\u56fe\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tls/#tcp-fast-open-tlsv13","title":"TCP Fast Open + TLSv1.3","text":"<p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u540c\u65f6\u652f\u6301 TCP Fast Open \u529f\u80fd\u7684\u60c5\u51b5\u4e0b\uff0c\u5728\u7b2c\u4e8c\u6b21\u4ee5\u540e\u5230\u901a\u4fe1\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u53ef\u4ee5\u7ed5\u8fc7\u4e09\u6b21\u63e1\u624b\u76f4\u63a5\u53d1\u9001\u6570\u636e\uff0c\u800c\u4e14\u670d\u52a1\u7aef\u4e5f\u4e0d\u9700\u8981\u7b49\u6536\u5230\u7b2c\u4e09\u6b21\u63e1\u624b\u540e\u624d\u53d1\u9001\u6570\u636e\u3002</p> <p>\u5982\u679c HTTPS \u7684 TLS \u7248\u672c\u662f 1.3\uff0c\u90a3\u4e48 TLS \u8fc7\u7a0b\u53ea\u9700\u8981 1-RTT\u3002</p> <p>\u56e0\u6b64\u5982\u679c\u300cTCP Fast Open + TLSv1.3\u300d\u60c5\u51b5\u4e0b\uff0c\u5728\u7b2c\u4e8c\u6b21\u4ee5\u540e\u7684\u901a\u4fe1\u8fc7\u7a0b\u4e2d\uff0cTLS \u548c TCP \u7684\u63e1\u624b\u8fc7\u7a0b\u662f\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u7684\u3002</p> <p>\u5982\u679c\u57fa\u4e8e TCP Fast Open \u573a\u666f\u4e0b\u7684 TLSv1.3 0-RTT \u4f1a\u8bdd\u6062\u590d\u8fc7\u7a0b\uff0c\u4e0d\u4ec5 TLS \u548c TCP \u7684\u63e1\u624b\u8fc7\u7a0b\u662f\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u7684\uff0c\u800c\u4e14 HTTP \u8bf7\u6c42\u4e5f\u53ef\u4ee5\u5728\u8fd9\u671f\u95f4\u5185\u4e00\u540c\u5b8c\u6210\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tls/#_1","title":"\u603b\u7ed3","text":"<p>\u6700\u540e\u505a\u4e2a\u603b\u7ed3\u3002</p> <p>\u300cHTTPS \u662f\u5148\u8fdb\u884c TCP \u4e09\u6b21\u63e1\u624b\uff0c\u518d\u8fdb\u884c TLSv1.2 \u56db\u6b21\u63e1\u624b\u300d\uff0c\u8fd9\u53e5\u8bdd\u4e00\u70b9\u95ee\u9898\u90fd\u6ca1\u6709\uff0c\u6000\u7591\u8fd9\u53e5\u8bdd\u662f\u9519\u7684\u4eba\uff0c\u624d\u6709\u95ee\u9898\u3002</p> <p>\u300cHTTPS \u4e2d\u7684 TLS \u63e1\u624b\u8fc7\u7a0b\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u4e09\u6b21\u63e1\u624b\u300d\uff0c\u8fd9\u4e2a\u573a\u666f\u662f\u53ef\u80fd\u5b58\u5728\u5230\uff0c\u4f46\u662f\u5728\u6ca1\u6709\u8bf4\u4efb\u4f55\u524d\u63d0\u6761\u4ef6\uff0c\u800c\u8bf4\u8fd9\u53e5\u8bdd\u5c31\u7b49\u4e8e\u800d\u6d41\u6c13\u3002\u9700\u8981\u4e0b\u9762\u8fd9\u4e24\u4e2a\u6761\u4ef6\u540c\u65f6\u6ee1\u8db3\u624d\u53ef\u4ee5\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u5f00\u542f\u4e86 TCP Fast Open \u529f\u80fd\uff0c\u4e14 TLS \u7248\u672c\u662f 1.3\uff1b</li> <li>\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5df2\u7ecf\u5b8c\u6210\u8fc7\u4e00\u6b21\u901a\u4fe1\uff1b</li> </ul> <p>\u600e\u4e48\u6837\uff0c\u90a3\u4f4d\u201c\u9762\u8bd5\u5b98\u201d\u5b66\u5e9f\u4e86\u5417\uff1f</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/","title":"4.14 tcp_tw_reuse \u4e3a\u4ec0\u4e48\u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4e0a\u5468\u6709\u4e2a\u8bfb\u8005\u5728\u9762\u8bd5\u5fae\u4fe1\u7684\u65f6\u5019\uff0c\u88ab\u95ee\u5230\u65e2\u7136\u6253\u5f00 net.ipv4.tcp_tw_reuse \u53c2\u6570\u53ef\u4ee5\u5feb\u901f\u590d\u7528\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684 TCP \u8fde\u63a5\uff0c\u90a3\u4e3a\u4ec0\u4e48 Linux \u9ed8\u8ba4\u662f\u5173\u95ed\u72b6\u6001\u5462\uff1f</p> <p></p> <p></p> <p>\u597d\u5bb6\u4f19\uff0c\u771f\u7684\u95ee\u597d\u7ec6\u8282\uff01</p> <p>\u5f53\u65f6\u770b\u5230\u8bfb\u8005\u8fd9\u4e2a\u95ee\u9898\u7684\u65f6\u5019\uff0c\u6211\u4e5f\u662f\u4e00\u8138\u61f5\u903c\u7684\uff0c\u7ecf\u8fc7\u6211\u7684\u4e00\u756a\u601d\u8003\u540e\uff0c\u7ec8\u4e8e\u77e5\u9053\u600e\u4e48\u56de\u7b54\u8fd9\u9898\u4e86\u3002</p> <p>\u5176\u5b9e\u8fd9\u9898\u5728\u53d8\u76f8\u95ee\u300c\u5982\u679c TIME_WAIT \u72b6\u6001\u6301\u7eed\u65f6\u95f4\u8fc7\u77ed\u6216\u8005\u6ca1\u6709\uff0c\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\uff1f\u300d</p> <p>\u56e0\u4e3a\u5f00\u542f tcp_tw_reuse \u53c2\u6570\u53ef\u4ee5\u5feb\u901f\u590d\u7528\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684 TCP \u8fde\u63a5\u65f6\uff0c\u76f8\u5f53\u4e8e\u7f29\u77ed\u4e86 TIME_WAIT \u72b6\u6001\u7684\u6301\u7eed\u65f6\u95f4\u3002</p> <p>\u53ef\u80fd\u6709\u7684\u540c\u5b66\u4f1a\u95ee\u8bf4\uff0c\u4f7f\u7528 tcp_tw_reuse \u5feb\u901f\u590d\u7528\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684 TCP \u8fde\u63a5\u65f6\uff0c\u662f\u9700\u8981\u4fdd\u8bc1  net.ipv4.tcp_timestamps \u53c2\u6570\u662f\u5f00\u542f\u7684\uff08\u9ed8\u8ba4\u662f\u5f00\u542f\u7684\uff09\uff0c\u800c tcp_timestamps \u53c2\u6570\u53ef\u4ee5\u907f\u514d\u65e7\u8fde\u63a5\u7684\u5ef6\u8fdf\u62a5\u6587\uff0c\u8fd9\u4e0d\u662f\u89e3\u51b3\u4e86\u6ca1\u6709 TIME_WAIT \u72b6\u6001\u65f6\u7684\u95ee\u9898\u4e86\u5417\uff1f</p> <p>\u662f\u89e3\u51b3\u90e8\u5206\u95ee\u9898\uff0c\u4f46\u662f\u4e0d\u80fd\u5b8c\u5168\u89e3\u51b3\uff0c\u63a5\u4e0b\u6765\uff0c\u6211\u8ddf\u5927\u5bb6\u804a\u804a\u8fd9\u4e2a\u95ee\u9898\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/#time_wait","title":"\u4ec0\u4e48\u662f TIME_WAIT \u72b6\u6001\uff1f","text":"<p>TCP \u56db\u6b21\u6325\u624b\u8fc7\u7a0b\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p>\u56fe\u7247</p> <ul> <li>\u5ba2\u6237\u7aef\u6253\u7b97\u5173\u95ed\u8fde\u63a5\uff0c\u6b64\u65f6\u4f1a\u53d1\u9001\u4e00\u4e2a TCP \u9996\u90e8 <code>FIN</code> \u6807\u5fd7\u4f4d\u88ab\u7f6e\u4e3a <code>1</code>\u7684\u62a5\u6587\uff0c\u4e5f\u5373 <code>FIN</code> \u62a5\u6587\uff0c\u4e4b\u540e\u5ba2\u6237\u7aef\u8fdb\u5165 <code>FIN_WAIT_1</code> \u72b6\u6001\u3002</li> <li>\u670d\u52a1\u7aef\u6536\u5230\u8be5\u62a5\u6587\u540e\uff0c\u5c31\u5411\u5ba2\u6237\u7aef\u53d1\u9001 <code>ACK</code> \u5e94\u7b54\u62a5\u6587\uff0c\u63a5\u7740\u670d\u52a1\u7aef\u8fdb\u5165 <code>CLOSED_WAIT</code> \u72b6\u6001\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684 <code>ACK</code> \u5e94\u7b54\u62a5\u6587\u540e\uff0c\u4e4b\u540e\u8fdb\u5165 <code>FIN_WAIT_2</code> \u72b6\u6001\u3002</li> <li>\u7b49\u5f85\u670d\u52a1\u7aef\u5904\u7406\u5b8c\u6570\u636e\u540e\uff0c\u4e5f\u5411\u5ba2\u6237\u7aef\u53d1\u9001 <code>FIN</code> \u62a5\u6587\uff0c\u4e4b\u540e\u670d\u52a1\u7aef\u8fdb\u5165 <code>LAST_ACK</code> \u72b6\u6001\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684 <code>FIN</code> \u62a5\u6587\u540e\uff0c\u56de\u4e00\u4e2a <code>ACK</code> \u5e94\u7b54\u62a5\u6587\uff0c\u4e4b\u540e\u8fdb\u5165 <code>TIME_WAIT</code> \u72b6\u6001</li> <li>\u670d\u52a1\u5668\u6536\u5230\u4e86 <code>ACK</code> \u5e94\u7b54\u62a5\u6587\u540e\uff0c\u5c31\u8fdb\u5165\u4e86 <code>CLOSE</code> \u72b6\u6001\uff0c\u81f3\u6b64\u670d\u52a1\u7aef\u5df2\u7ecf\u5b8c\u6210\u8fde\u63a5\u7684\u5173\u95ed\u3002</li> <li>\u5ba2\u6237\u7aef\u5728\u7ecf\u8fc7 <code>2MSL</code> \u4e00\u6bb5\u65f6\u95f4\u540e\uff0c\u81ea\u52a8\u8fdb\u5165 <code>CLOSE</code> \u72b6\u6001\uff0c\u81f3\u6b64\u5ba2\u6237\u7aef\u4e5f\u5b8c\u6210\u8fde\u63a5\u7684\u5173\u95ed\u3002</li> </ul> <p>\u4f60\u53ef\u4ee5\u770b\u5230\uff0c\u4e24\u4e2a\u65b9\u5411\u90fd\u9700\u8981\u4e00\u4e2a FIN \u548c\u4e00\u4e2a ACK\uff0c\u56e0\u6b64\u901a\u5e38\u88ab\u79f0\u4e3a\u56db\u6b21\u6325\u624b\u3002</p> <p>\u8fd9\u91cc\u4e00\u70b9\u9700\u8981\u6ce8\u610f\u662f\uff1a\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u7684\uff0c\u624d\u6709 TIME_WAIT \u72b6\u6001\u3002</p> <p>\u53ef\u4ee5\u770b\u5230\uff0cTIME_WAIT \u662f\u300c\u4e3b\u52a8\u5173\u95ed\u65b9\u300d\u65ad\u5f00\u8fde\u63a5\u65f6\u7684\u6700\u540e\u4e00\u4e2a\u72b6\u6001\uff0c\u8be5\u72b6\u6001\u4f1a\u6301\u7eed *2MSL(Maximum Segment Lifetime)* \u65f6\u957f\uff0c\u4e4b\u540e\u8fdb\u5165 CLOSED \u72b6\u6001\u3002</p> <p>MSL \u6307\u7684\u662f TCP \u534f\u8bae\u4e2d\u4efb\u4f55\u62a5\u6587\u5728\u7f51\u7edc\u4e0a\u6700\u5927\u7684\u751f\u5b58\u65f6\u95f4\uff0c\u4efb\u4f55\u8d85\u8fc7\u8fd9\u4e2a\u65f6\u95f4\u7684\u6570\u636e\u90fd\u5c06\u88ab\u4e22\u5f03\u3002\u867d\u7136 RFC 793 \u89c4\u5b9a MSL \u4e3a 2 \u5206\u949f\uff0c\u4f46\u662f\u5728\u5b9e\u9645\u5b9e\u73b0\u7684\u65f6\u5019\u4f1a\u6709\u6240\u4e0d\u540c\uff0c\u6bd4\u5982 Linux \u9ed8\u8ba4\u4e3a 30 \u79d2\uff0c\u90a3\u4e48 2MSL \u5c31\u662f 60 \u79d2\u3002</p> <p>MSL \u662f\u7531\u7f51\u7edc\u5c42\u7684 IP \u5305\u4e2d\u7684 TTL \u6765\u4fdd\u8bc1\u7684\uff0cTTL \u662f IP \u5934\u90e8\u7684\u4e00\u4e2a\u5b57\u6bb5\uff0c\u7528\u4e8e\u8bbe\u7f6e\u4e00\u4e2a\u6570\u636e\u62a5\u53ef\u7ecf\u8fc7\u7684\u8def\u7531\u5668\u7684\u6570\u91cf\u4e0a\u9650\u3002\u62a5\u6587\u6bcf\u7ecf\u8fc7\u4e00\u6b21\u8def\u7531\u5668\u7684\u8f6c\u53d1\uff0cIP \u5934\u90e8\u7684 TTL \u5b57\u6bb5\u5c31\u4f1a\u51cf 1\uff0c\u51cf\u5230 0 \u65f6\u62a5\u6587\u5c31\u88ab\u4e22\u5f03\u3002</p> <p>MSL \u4e0e TTL \u7684\u533a\u522b\uff1aMSL \u7684\u5355\u4f4d\u662f\u65f6\u95f4\uff0c\u800c TTL \u662f\u7ecf\u8fc7\u8def\u7531\u8df3\u6570\u3002\u6240\u4ee5 MSL \u5e94\u8be5\u8981\u5927\u4e8e\u7b49\u4e8e TTL \u6d88\u8017\u4e3a 0 \u7684\u65f6\u95f4\uff0c\u4ee5\u786e\u4fdd\u62a5\u6587\u5df2\u88ab\u81ea\u7136\u6d88\u4ea1\u3002</p> <p>TTL \u7684\u503c\u4e00\u822c\u662f 64\uff0cLinux \u5c06 MSL \u8bbe\u7f6e\u4e3a 30 \u79d2\uff0c\u610f\u5473\u7740 Linux \u8ba4\u4e3a\u6570\u636e\u62a5\u6587\u7ecf\u8fc7 64 \u4e2a\u8def\u7531\u5668\u7684\u65f6\u95f4\u4e0d\u4f1a\u8d85\u8fc7 30 \u79d2\uff0c\u5982\u679c\u8d85\u8fc7\u4e86\uff0c\u5c31\u8ba4\u4e3a\u62a5\u6587\u5df2\u7ecf\u6d88\u5931\u5728\u7f51\u7edc\u4e2d\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/#time_wait_1","title":"\u4e3a\u4ec0\u4e48\u8981\u8bbe\u8ba1 TIME_WAIT \u72b6\u6001\uff1f","text":"<p>\u8bbe\u8ba1 TIME_WAIT \u72b6\u6001\uff0c\u4e3b\u8981\u6709\u4e24\u4e2a\u539f\u56e0\uff1a</p> <ul> <li>\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536\uff1b</li> <li>\u4fdd\u8bc1\u300c\u88ab\u52a8\u5173\u95ed\u8fde\u63a5\u300d\u7684\u4e00\u65b9\uff0c\u80fd\u88ab\u6b63\u786e\u7684\u5173\u95ed\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/#_1","title":"\u539f\u56e0\u4e00\uff1a\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536","text":"<p>\u4e3a\u4e86\u80fd\u66f4\u597d\u7684\u7406\u89e3\u8fd9\u4e2a\u539f\u56e0\uff0c\u6211\u4eec\u5148\u6765\u4e86\u89e3\u5e8f\u5217\u53f7\uff08SEQ\uff09\u548c\u521d\u59cb\u5e8f\u5217\u53f7\uff08ISN\uff09\u3002</p> <ul> <li>\u5e8f\u5217\u53f7\uff0c\u662f TCP \u4e00\u4e2a\u5934\u90e8\u5b57\u6bb5\uff0c\u6807\u8bc6\u4e86 TCP \u53d1\u9001\u7aef\u5230 TCP \u63a5\u6536\u7aef\u7684\u6570\u636e\u6d41\u7684\u4e00\u4e2a\u5b57\u8282\uff0c\u56e0\u4e3a TCP \u662f\u9762\u5411\u5b57\u8282\u6d41\u7684\u53ef\u9760\u534f\u8bae\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u6d88\u606f\u7684\u987a\u5e8f\u6027\u548c\u53ef\u9760\u6027\uff0cTCP \u4e3a\u6bcf\u4e2a\u4f20\u8f93\u65b9\u5411\u4e0a\u7684\u6bcf\u4e2a\u5b57\u8282\u90fd\u8d4b\u4e88\u4e86\u4e00\u4e2a\u7f16\u53f7\uff0c\u4ee5\u4fbf\u4e8e\u4f20\u8f93\u6210\u529f\u540e\u786e\u8ba4\u3001\u4e22\u5931\u540e\u91cd\u4f20\u4ee5\u53ca\u5728\u63a5\u6536\u7aef\u4fdd\u8bc1\u4e0d\u4f1a\u4e71\u5e8f\u3002\u5e8f\u5217\u53f7\u662f\u4e00\u4e2a 32 \u4f4d\u7684\u65e0\u7b26\u53f7\u6570\uff0c\u56e0\u6b64\u5728\u5230\u8fbe 4G \u4e4b\u540e\u518d\u5faa\u73af\u56de\u5230 0\u3002</li> <li>\u521d\u59cb\u5e8f\u5217\u53f7\uff0c\u5728 TCP \u5efa\u7acb\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u90fd\u4f1a\u5404\u81ea\u751f\u6210\u4e00\u4e2a\u521d\u59cb\u5e8f\u5217\u53f7\uff0c\u5b83\u662f\u57fa\u4e8e\u65f6\u949f\u751f\u6210\u7684\u4e00\u4e2a\u968f\u673a\u6570\uff0c\u6765\u4fdd\u8bc1\u6bcf\u4e2a\u8fde\u63a5\u90fd\u62e5\u6709\u4e0d\u540c\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u3002\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u53ef\u88ab\u89c6\u4e3a\u4e00\u4e2a 32 \u4f4d\u7684\u8ba1\u6570\u5668\uff0c\u8be5\u8ba1\u6570\u5668\u7684\u6570\u503c\u6bcf 4 \u5fae\u79d2\u52a0 1\uff0c\u5faa\u73af\u4e00\u6b21\u9700\u8981 4.55 \u5c0f\u65f6\u3002</li> </ul> <p>\u7ed9\u5927\u5bb6\u6293\u4e86\u4e00\u4e2a\u5305\uff0c\u4e0b\u56fe\u4e2d\u7684 Seq \u5c31\u662f\u5e8f\u5217\u53f7\uff0c\u5176\u4e2d\u7ea2\u8272\u6846\u4f4f\u7684\u5206\u522b\u662f\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5404\u81ea\u751f\u6210\u7684\u521d\u59cb\u5e8f\u5217\u53f7\u3002</p> <p></p> <p>\u901a\u8fc7\u524d\u9762\u6211\u4eec\u77e5\u9053\uff0c\u5e8f\u5217\u53f7\u548c\u521d\u59cb\u5316\u5e8f\u5217\u53f7\u5e76\u4e0d\u662f\u65e0\u9650\u9012\u589e\u7684\uff0c\u4f1a\u53d1\u751f\u56de\u7ed5\u4e3a\u521d\u59cb\u503c\u7684\u60c5\u51b5\uff0c\u8fd9\u610f\u5473\u7740\u65e0\u6cd5\u6839\u636e\u5e8f\u5217\u53f7\u6765\u5224\u65ad\u65b0\u8001\u6570\u636e\u3002</p> <p>\u5047\u8bbe TIME-WAIT \u6ca1\u6709\u7b49\u5f85\u65f6\u95f4\u6216\u65f6\u95f4\u8fc7\u77ed\uff0c\u88ab\u5ef6\u8fdf\u7684\u6570\u636e\u5305\u62b5\u8fbe\u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff1f</p> <p></p> <ul> <li>\u670d\u52a1\u7aef\u5728\u5173\u95ed\u8fde\u63a5\u4e4b\u524d\u53d1\u9001\u7684 <code>SEQ = 301</code> \u62a5\u6587\uff0c\u88ab\u7f51\u7edc\u5ef6\u8fdf\u4e86\u3002</li> <li>\u63a5\u7740\uff0c\u670d\u52a1\u7aef\u4ee5\u76f8\u540c\u7684\u56db\u5143\u7ec4\u91cd\u65b0\u6253\u5f00\u4e86\u65b0\u8fde\u63a5\uff0c\u524d\u9762\u88ab\u5ef6\u8fdf\u7684 <code>SEQ = 301</code> \u8fd9\u65f6\u62b5\u8fbe\u4e86\u5ba2\u6237\u7aef\uff0c\u800c\u4e14\u8be5\u6570\u636e\u62a5\u6587\u7684\u5e8f\u5217\u53f7\u521a\u597d\u5728\u5ba2\u6237\u7aef\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u56e0\u6b64\u5ba2\u6237\u7aef\u4f1a\u6b63\u5e38\u63a5\u6536\u8fd9\u4e2a\u6570\u636e\u62a5\u6587\uff0c\u4f46\u662f\u8fd9\u4e2a\u6570\u636e\u62a5\u6587\u662f\u4e0a\u4e00\u4e2a\u8fde\u63a5\u6b8b\u7559\u4e0b\u6765\u7684\uff0c\u8fd9\u6837\u5c31\u4ea7\u751f\u6570\u636e\u9519\u4e71\u7b49\u4e25\u91cd\u7684\u95ee\u9898\u3002</li> </ul> <p>\u4e3a\u4e86\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536\uff0c\u56e0\u6b64 TCP \u8bbe\u8ba1\u4e86 TIME_WAIT \u72b6\u6001\uff0c\u72b6\u6001\u4f1a\u6301\u7eed <code>2MSL</code> \u65f6\u957f\uff0c\u8fd9\u4e2a\u65f6\u95f4\u8db3\u4ee5\u8ba9\u4e24\u4e2a\u65b9\u5411\u4e0a\u7684\u6570\u636e\u5305\u90fd\u88ab\u4e22\u5f03\uff0c\u4f7f\u5f97\u539f\u6765\u8fde\u63a5\u7684\u6570\u636e\u5305\u5728\u7f51\u7edc\u4e2d\u90fd\u81ea\u7136\u6d88\u5931\uff0c\u518d\u51fa\u73b0\u7684\u6570\u636e\u5305\u4e00\u5b9a\u90fd\u662f\u65b0\u5efa\u7acb\u8fde\u63a5\u6240\u4ea7\u751f\u7684\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/#_2","title":"\u539f\u56e0\u4e8c\uff1a\u4fdd\u8bc1\u300c\u88ab\u52a8\u5173\u95ed\u8fde\u63a5\u300d\u7684\u4e00\u65b9\uff0c\u80fd\u88ab\u6b63\u786e\u7684\u5173\u95ed","text":"<p>\u5982\u679c\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u5173\u95ed\u65b9\uff09\u6700\u540e\u4e00\u6b21 ACK \u62a5\u6587\uff08\u7b2c\u56db\u6b21\u6325\u624b\uff09\u5728\u7f51\u7edc\u4e2d\u4e22\u5931\u4e86\uff0c\u90a3\u4e48\u6309\u7167 TCP \u53ef\u9760\u6027\u539f\u5219\uff0c\u670d\u52a1\u7aef\uff08\u88ab\u52a8\u5173\u95ed\u65b9\uff09\u4f1a\u91cd\u53d1 FIN \u62a5\u6587\u3002</p> <p>\u5047\u8bbe\u5ba2\u6237\u7aef\u6ca1\u6709 TIME_WAIT \u72b6\u6001\uff0c\u800c\u662f\u5728\u53d1\u5b8c\u6700\u540e\u4e00\u6b21\u56de ACK \u62a5\u6587\u5c31\u76f4\u63a5\u8fdb\u5165 CLOSED \u72b6\u6001\uff0c\u5982\u679c\u8be5  ACK \u62a5\u6587\u4e22\u5931\u4e86\uff0c\u670d\u52a1\u7aef\u5219\u91cd\u4f20\u7684 FIN \u62a5\u6587\uff0c\u800c\u8fd9\u65f6\u5ba2\u6237\u7aef\u5df2\u7ecf\u8fdb\u5165\u5230\u5173\u95ed\u72b6\u6001\u4e86\uff0c\u5728\u6536\u5230\u670d\u52a1\u7aef\u91cd\u4f20\u7684 FIN \u62a5\u6587\u540e\uff0c\u5c31\u4f1a\u56de RST \u62a5\u6587\u3002</p> <p></p> <p>\u670d\u52a1\u7aef\u6536\u5230\u8fd9\u4e2a RST \u5e76\u5c06\u5176\u89e3\u91ca\u4e3a\u4e00\u4e2a\u9519\u8bef\uff08Connection reset by peer\uff09\uff0c\u8fd9\u5bf9\u4e8e\u4e00\u4e2a\u53ef\u9760\u7684\u534f\u8bae\u6765\u8bf4\u4e0d\u662f\u4e00\u4e2a\u4f18\u96c5\u7684\u7ec8\u6b62\u65b9\u5f0f\u3002</p> <p>\u4e3a\u4e86\u9632\u6b62\u8fd9\u79cd\u60c5\u51b5\u51fa\u73b0\uff0c\u5ba2\u6237\u7aef\u5fc5\u987b\u7b49\u5f85\u8db3\u591f\u957f\u7684\u65f6\u95f4\uff0c\u786e\u4fdd\u670d\u52a1\u7aef\u80fd\u591f\u6536\u5230 ACK\uff0c\u5982\u679c\u670d\u52a1\u7aef\u6ca1\u6709\u6536\u5230 ACK\uff0c\u90a3\u4e48\u5c31\u4f1a\u89e6\u53d1 TCP \u91cd\u4f20\u673a\u5236\uff0c\u670d\u52a1\u7aef\u4f1a\u91cd\u65b0\u53d1\u9001\u4e00\u4e2a FIN\uff0c\u8fd9\u6837\u4e00\u53bb\u4e00\u6765\u521a\u597d\u4e24\u4e2a MSL \u7684\u65f6\u95f4\u3002</p> <p></p> <p>\u5ba2\u6237\u7aef\u5728\u6536\u5230\u670d\u52a1\u7aef\u91cd\u4f20\u7684 FIN \u62a5\u6587\u65f6\uff0cTIME_WAIT \u72b6\u6001\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u4f1a\u91cd\u7f6e\u56de 2MSL\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/#tcp_tw_reuse","title":"tcp_tw_reuse \u662f\u4ec0\u4e48\uff1f","text":"<p>\u5728 Linux  \u64cd\u4f5c\u7cfb\u7edf\u4e0b\uff0cTIME_WAIT \u72b6\u6001\u7684\u6301\u7eed\u65f6\u95f4\u662f 60 \u79d2\uff0c\u8fd9\u610f\u5473\u7740\u8fd9 60 \u79d2\u5185\uff0c\u5ba2\u6237\u7aef\u4e00\u76f4\u4f1a\u5360\u7528\u7740\u8fd9\u4e2a\u7aef\u53e3\u3002\u8981\u77e5\u9053\uff0c\u7aef\u53e3\u8d44\u6e90\u4e5f\u662f\u6709\u9650\u7684\uff0c\u4e00\u822c\u53ef\u4ee5\u5f00\u542f\u7684\u7aef\u53e3\u4e3a 32768~61000\uff0c\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u53c2\u6570\u8bbe\u7f6e\u6307\u5b9a\u8303\u56f4\uff1a</p> Text Only<pre><code> net.ipv4.ip_local_port_range\n</code></pre> <p>\u5982\u679c\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u65b9\uff09\u7684 TIME_WAIT \u72b6\u6001\u8fc7\u591a\uff0c\u5360\u6ee1\u4e86\u6240\u6709\u7aef\u53e3\u8d44\u6e90\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u5bf9\u300c\u76ee\u7684 IP+ \u76ee\u7684 PORT\u300d\u90fd\u4e00\u6837\u7684\u670d\u52a1\u5668\u53d1\u8d77\u8fde\u63a5\u4e86\uff0c\u4f46\u662f\u88ab\u4f7f\u7528\u7684\u7aef\u53e3\uff0c\u8fd8\u662f\u53ef\u4ee5\u7ee7\u7eed\u5bf9\u53e6\u5916\u4e00\u4e2a\u670d\u52a1\u5668\u53d1\u8d77\u8fde\u63a5\u7684\u3002\u5177\u4f53\u53ef\u4ee5\u770b\u6211\u8fd9\u7bc7\u6587\u7ae0\uff1a\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u5417\uff1f</p> <p>\u56e0\u6b64\uff0c\u5ba2\u6237\u7aef\uff08\u4e3b\u52a8\u5173\u95ed\u8fde\u63a5\u65b9\uff09\u90fd\u662f\u548c\u300c\u76ee\u7684 IP+ \u76ee\u7684 PORT\u300d\u90fd\u4e00\u6837\u7684\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u7684\u8bdd\uff0c\u5f53\u5ba2\u6237\u7aef\u7684 TIME_WAIT \u72b6\u6001\u8fde\u63a5\u8fc7\u591a\u7684\u8bdd\uff0c\u5c31\u4f1a\u53d7\u7aef\u53e3\u8d44\u6e90\u9650\u5236\uff0c\u5982\u679c\u5360\u6ee1\u4e86\u6240\u6709\u7aef\u53e3\u8d44\u6e90\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u518d\u8ddf\u300c\u76ee\u7684 IP+ \u76ee\u7684 PORT\u300d\u90fd\u4e00\u6837\u7684\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\u4e86\u3002</p> <p>\u4e0d\u8fc7\uff0c\u5373\u4f7f\u662f\u5728\u8fd9\u79cd\u573a\u666f\u4e0b\uff0c\u53ea\u8981\u8fde\u63a5\u7684\u662f\u4e0d\u540c\u7684\u670d\u52a1\u5668\uff0c\u7aef\u53e3\u662f\u53ef\u4ee5\u91cd\u590d\u4f7f\u7528\u7684\uff0c\u6240\u4ee5\u5ba2\u6237\u7aef\u8fd8\u662f\u53ef\u4ee5\u5411\u5176\u4ed6\u670d\u52a1\u5668\u53d1\u8d77\u8fde\u63a5\u7684\uff0c\u8fd9\u662f\u56e0\u4e3a\u5185\u6838\u5728\u5b9a\u4f4d\u4e00\u4e2a\u8fde\u63a5\u7684\u65f6\u5019\uff0c\u662f\u901a\u8fc7\u56db\u5143\u7ec4\uff08\u6e90 IP\u3001\u6e90\u7aef\u53e3\u3001\u76ee\u7684 IP\u3001\u76ee\u7684\u7aef\u53e3\uff09\u4fe1\u606f\u6765\u5b9a\u4f4d\u7684\uff0c\u5e76\u4e0d\u4f1a\u56e0\u4e3a\u5ba2\u6237\u7aef\u7684\u7aef\u53e3\u4e00\u6837\uff0c\u800c\u5bfc\u81f4\u8fde\u63a5\u51b2\u7a81\u3002</p> <p>\u597d\u5728\uff0cLinux \u64cd\u4f5c\u7cfb\u7edf\u63d0\u4f9b\u4e86\u4e24\u4e2a\u53ef\u4ee5\u7cfb\u7edf\u53c2\u6570\u6765\u5feb\u901f\u56de\u6536\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u8fd9\u4e24\u4e2a\u53c2\u6570\u90fd\u662f\u9ed8\u8ba4\u5173\u95ed\u7684\uff1a</p> <ul> <li>net.ipv4.tcp_tw_reuse\uff0c\u5982\u679c\u5f00\u542f\u8be5\u9009\u9879\u7684\u8bdd\uff0c\u5ba2\u6237\u7aef\uff08\u8fde\u63a5\u53d1\u8d77\u65b9\uff09\u5728\u8c03\u7528 connect() \u51fd\u6570\u65f6\uff0c\u5982\u679c\u5185\u6838\u9009\u62e9\u5230\u7684\u7aef\u53e3\uff0c\u5df2\u7ecf\u88ab\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u5360\u7528\u7684\u65f6\u5019\uff0c\u5c31\u4f1a\u5224\u65ad\u8be5\u8fde\u63a5\u662f\u5426\u5904\u4e8e TIME_WAIT \u72b6\u6001\uff0c\u5982\u679c\u8be5\u8fde\u63a5\u5904\u4e8e TIME_WAIT \u72b6\u6001\u5e76\u4e14 TIME_WAIT \u72b6\u6001\u6301\u7eed\u7684\u65f6\u95f4\u8d85\u8fc7\u4e86 1 \u79d2\uff0c\u90a3\u4e48\u5c31\u4f1a\u91cd\u7528\u8fd9\u4e2a\u8fde\u63a5\uff0c\u7136\u540e\u5c31\u53ef\u4ee5\u6b63\u5e38\u4f7f\u7528\u8be5\u7aef\u53e3\u4e86\u3002\u6240\u4ee5\u8be5\u9009\u9879\u53ea\u9002\u7528\u4e8e\u8fde\u63a5\u53d1\u8d77\u65b9\u3002</li> <li>net.ipv4.tcp_tw_recycle\uff0c\u5982\u679c\u5f00\u542f\u8be5\u9009\u9879\u7684\u8bdd\uff0c\u5141\u8bb8\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u88ab\u5feb\u901f\u56de\u6536\uff0c\u8be5\u53c2\u6570\u5728 NAT \u7684\u7f51\u7edc\u4e0b\u662f\u4e0d\u5b89\u5168\u7684\uff01\u8be6\u7ec6\u89c1\u8fd9\u7bc7\u6587\u7ae0\u4ecb\u7ecd\uff1aSYN \u62a5\u6587\u4ec0\u4e48\u65f6\u5019\u60c5\u51b5\u4e0b\u4f1a\u88ab\u4e22\u5f03\uff1f</li> </ul> <p>\u8981\u4f7f\u5f97\u4e0a\u9762\u8fd9\u4e24\u4e2a\u53c2\u6570\u751f\u6548\uff0c\u6709\u4e00\u4e2a\u524d\u63d0\u6761\u4ef6\uff0c\u5c31\u662f\u8981\u6253\u5f00 TCP \u65f6\u95f4\u6233\uff0c\u5373 net.ipv4.tcp_timestamps=1\uff08\u9ed8\u8ba4\u5373\u4e3a 1\uff09\u3002</p> <p>\u5f00\u542f\u4e86 tcp_timestamps \u53c2\u6570\uff0cTCP \u5934\u90e8\u5c31\u4f1a\u4f7f\u7528\u65f6\u95f4\u6233\u9009\u9879\uff0c\u5b83\u6709\u4e24\u4e2a\u597d\u5904\uff0c\u4e00\u4e2a\u662f\u4fbf\u4e8e\u7cbe\u786e\u8ba1\u7b97 RTT\uff0c\u53e6\u4e00\u4e2a\u662f\u80fd\u9632\u6b62\u5e8f\u5217\u53f7\u56de\u7ed5\uff08PAWS\uff09\uff0c\u6211\u4eec\u5148\u6765\u4ecb\u7ecd\u8fd9\u4e2a\u529f\u80fd\u3002</p> <p>\u5e8f\u5217\u53f7\u662f\u4e00\u4e2a 32 \u4f4d\u7684\u65e0\u7b26\u53f7\u6574\u578b\uff0c\u4e0a\u9650\u503c\u662f 4GB\uff0c\u8d85\u8fc7 4GB \u540e\u5c31\u9700\u8981\u5c06\u5e8f\u5217\u53f7\u56de\u7ed5\u8fdb\u884c\u91cd\u7528\u3002\u8fd9\u5728\u4ee5\u524d\u7f51\u901f\u6162\u7684\u5e74\u4ee3\u4e0d\u4f1a\u9020\u6210\u4ec0\u4e48\u95ee\u9898\uff0c\u4f46\u5728\u4e00\u4e2a\u901f\u5ea6\u8db3\u591f\u5feb\u7684\u7f51\u7edc\u4e2d\u4f20\u8f93\u5927\u91cf\u6570\u636e\u65f6\uff0c\u5e8f\u5217\u53f7\u7684\u56de\u7ed5\u65f6\u95f4\u5c31\u4f1a\u53d8\u77ed\u3002\u5982\u679c\u5e8f\u5217\u53f7\u56de\u7ed5\u7684\u65f6\u95f4\u6781\u77ed\uff0c\u6211\u4eec\u5c31\u4f1a\u518d\u6b21\u9762\u4e34\u4e4b\u524d\u5ef6\u8fdf\u7684\u62a5\u6587\u62b5\u8fbe\u540e\u5e8f\u5217\u53f7\u4f9d\u7136\u6709\u6548\u7684\u95ee\u9898\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u5c31\u9700\u8981\u6709 TCP \u65f6\u95f4\u6233\u3002</p> <p>\u8bd5\u770b\u4e0b\u9762\u7684\u793a\u4f8b\uff0c\u5047\u8bbe TCP \u7684\u53d1\u9001\u7a97\u53e3\u662f 1 GB\uff0c\u5e76\u4e14\u4f7f\u7528\u4e86\u65f6\u95f4\u6233\u9009\u9879\uff0c\u53d1\u9001\u65b9\u4f1a\u4e3a\u6bcf\u4e2a TCP \u62a5\u6587\u5206\u914d\u65f6\u95f4\u6233\u6570\u503c\uff0c\u6211\u4eec\u5047\u8bbe\u6bcf\u4e2a\u62a5\u6587\u65f6\u95f4\u52a0 1\uff0c\u7136\u540e\u4f7f\u7528\u8fd9\u4e2a\u8fde\u63a5\u4f20\u8f93\u4e00\u4e2a 6GB \u5927\u5c0f\u7684\u6570\u636e\u6d41\u3002</p> <p></p> <p>32 \u4f4d\u7684\u5e8f\u5217\u53f7\u5728\u65f6\u523b D \u548c E \u4e4b\u95f4\u56de\u7ed5\u3002\u5047\u8bbe\u5728\u65f6\u523b B \u6709\u4e00\u4e2a\u62a5\u6587\u4e22\u5931\u5e76\u88ab\u91cd\u4f20\uff0c\u53c8\u5047\u8bbe\u8fd9\u4e2a\u62a5\u6587\u6bb5\u5728\u7f51\u7edc\u4e0a\u7ed5\u4e86\u8fdc\u8def\u5e76\u5728\u65f6\u523b F \u91cd\u65b0\u51fa\u73b0\u3002\u5982\u679c TCP \u65e0\u6cd5\u8bc6\u522b\u8fd9\u4e2a\u7ed5\u56de\u7684\u62a5\u6587\uff0c\u90a3\u4e48\u6570\u636e\u5b8c\u6574\u6027\u5c31\u4f1a\u906d\u5230\u7834\u574f\u3002</p> <p>\u4f7f\u7528\u65f6\u95f4\u6233\u9009\u9879\u80fd\u591f\u6709\u6548\u7684\u9632\u6b62\u4e0a\u8ff0\u95ee\u9898\uff0c\u5982\u679c\u4e22\u5931\u7684\u62a5\u6587\u4f1a\u5728\u65f6\u523b F \u91cd\u65b0\u51fa\u73b0\uff0c\u7531\u4e8e\u5b83\u7684\u65f6\u95f4\u6233\u4e3a 2\uff0c\u5c0f\u4e8e\u6700\u8fd1\u7684\u6709\u6548\u65f6\u95f4\u6233\uff085 \u6216 6\uff09\uff0c\u56e0\u6b64\u9632\u56de\u7ed5\u5e8f\u5217\u53f7\u7b97\u6cd5\uff08PAWS\uff09\u4f1a\u5c06\u5176\u4e22\u5f03\u3002</p> <p>\u9632\u56de\u7ed5\u5e8f\u5217\u53f7\u7b97\u6cd5\u8981\u6c42\u8fde\u63a5\u53cc\u65b9\u7ef4\u62a4\u6700\u8fd1\u4e00\u6b21\u6536\u5230\u7684\u6570\u636e\u5305\u7684\u65f6\u95f4\u6233\uff08Recent TSval\uff09\uff0c\u6bcf\u6536\u5230\u4e00\u4e2a\u65b0\u6570\u636e\u5305\u90fd\u4f1a\u8bfb\u53d6\u6570\u636e\u5305\u4e2d\u7684\u65f6\u95f4\u6233\u503c\u8ddf Recent TSval \u503c\u505a\u6bd4\u8f83\uff0c\u5982\u679c\u53d1\u73b0\u6536\u5230\u7684\u6570\u636e\u5305\u4e2d\u65f6\u95f4\u6233\u4e0d\u662f\u9012\u589e\u7684\uff0c\u5219\u8868\u793a\u8be5\u6570\u636e\u5305\u662f\u8fc7\u671f\u7684\uff0c\u5c31\u4f1a\u76f4\u63a5\u4e22\u5f03\u8fd9\u4e2a\u6570\u636e\u5305\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/#tcp_tw_reuse_1","title":"\u4e3a\u4ec0\u4e48 tcp_tw_reuse  \u9ed8\u8ba4\u662f\u5173\u95ed\u7684\uff1f","text":"<p>\u901a\u8fc7\u524d\u9762\u8fd9\u4e48\u591a\u94fa\u57ab\uff0c\u7ec8\u4e8e\u53ef\u4ee5\u8bf4\u8fd9\u4e2a\u95ee\u9898\u4e86\u3002</p> <p>\u5f00\u542f tcp_tw_reuse \u4f1a\u6709\u4ec0\u4e48\u98ce\u9669\u5462\uff1f\u6211\u89c9\u5f97\u4f1a\u6709 2 \u4e2a\u95ee\u9898\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/#_3","title":"\u7b2c\u4e00\u4e2a\u95ee\u9898","text":"<p>\u6211\u4eec\u77e5\u9053\u5f00\u542f tcp_tw_reuse \u7684\u540c\u65f6\uff0c\u4e5f\u9700\u8981\u5f00\u542f tcp_timestamps\uff0c\u610f\u5473\u7740\u53ef\u4ee5\u7528\u65f6\u95f4\u6233\u7684\u65b9\u5f0f\u6709\u6548\u7684\u5224\u65ad\u56de\u7ed5\u5e8f\u5217\u53f7\u7684\u5386\u53f2\u62a5\u6587\u3002</p> <p>\u4f46\u662f\uff0c\u5728\u770b\u6211\u770b\u4e86\u9632\u56de\u7ed5\u5e8f\u5217\u53f7\u51fd\u6570\u7684\u6e90\u7801\u540e\uff0c\u53d1\u73b0\u5bf9\u4e8e RST \u62a5\u6587\u7684\u65f6\u95f4\u6233\u5373\u4f7f\u8fc7\u671f\u4e86\uff0c\u53ea\u8981 RST \u62a5\u6587\u7684\u5e8f\u5217\u53f7\u5728\u5bf9\u65b9\u7684\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u4e5f\u662f\u80fd\u88ab\u63a5\u53d7\u7684\u3002</p> <p>\u4e0b\u9762 tcp_validate_incoming \u51fd\u6570\u5c31\u662f\u9a8c\u8bc1\u63a5\u6536\u5230\u7684 TCP \u62a5\u6587\u662f\u5426\u5408\u683c\u7684\u51fd\u6570\uff0c\u5176\u4e2d\u7b2c\u4e00\u6b65\u5c31\u4f1a\u8fdb\u884c PAWS \u68c0\u67e5\uff0c\u7531 tcp_paws_discard \u51fd\u6570\u8d1f\u8d23\u3002</p> C<pre><code>static bool tcp_validate_incoming(struct sock *sk, struct sk_buff *skb, const struct tcphdr *th, int syn_inerr)\n{\n    struct tcp_sock *tp = tcp_sk(sk);\n\n    /* RFC1323: H1. Apply PAWS check first. */\n    if (tcp_fast_parse_options(sock_net(sk), skb, th, tp) &amp;&amp;\n        tp-&gt;rx_opt.saw_tstamp &amp;&amp;\n        tcp_paws_discard(sk, skb)) {\n        if (!th-&gt;rst) {\n            ....\n            goto discard;\n        }\n        /* Reset is accepted even if it did not pass PAWS. */\n    }\n</code></pre> <p>\u5f53 tcp_paws_discard \u8fd4\u56de true\uff0c\u5c31\u4ee3\u8868\u62a5\u6587\u662f\u4e00\u4e2a\u5386\u53f2\u62a5\u6587\uff0c\u4e8e\u662f\u5c31\u8981\u4e22\u5f03\u8fd9\u4e2a\u62a5\u6587\u3002\u4f46\u662f\u5728\u4e22\u6389\u8fd9\u4e2a\u62a5\u6587\u7684\u65f6\u5019\uff0c\u4f1a\u5148\u5224\u65ad\u662f\u4e0d\u662f RST \u62a5\u6587\uff0c\u5982\u679c\u4e0d\u662f RST \u62a5\u6587\uff0c\u624d\u4f1a\u5c06\u62a5\u6587\u4e22\u6389\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5373\u4f7f RST \u62a5\u6587\u662f\u4e00\u4e2a\u5386\u53f2\u62a5\u6587\uff0c\u5e76\u4e0d\u4f1a\u88ab\u4e22\u5f03\u3002</p> <p>\u5047\u8bbe\u6709\u8fd9\u6837\u7684\u573a\u666f\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u5411\u4e00\u4e2a\u8fd8\u6ca1\u6709\u88ab\u670d\u52a1\u7aef\u76d1\u542c\u7684\u7aef\u53e3\u53d1\u8d77\u4e86 HTTP \u8bf7\u6c42\uff0c\u63a5\u7740\u670d\u52a1\u7aef\u5c31\u4f1a\u56de RST \u62a5\u6587\u7ed9\u5bf9\u65b9\uff0c\u5f88\u53ef\u60dc\u7684\u662f RST \u62a5\u6587\u88ab\u7f51\u7edc\u963b\u585e\u4e86\u3002</li> <li>\u7531\u4e8e\u5ba2\u6237\u7aef\u8fdf\u8fdf\u6ca1\u6709\u6536\u5230 TCP \u7b2c\u4e8c\u6b21\u63e1\u624b\uff0c\u4e8e\u662f\u91cd\u53d1\u4e86 SYN \u5305\uff0c\u4e0e\u6b64\u540c\u65f6\u670d\u52a1\u7aef\u5df2\u7ecf\u5f00\u542f\u4e86\u670d\u52a1\uff0c\u76d1\u542c\u4e86\u5bf9\u5e94\u7684\u7aef\u53e3\u3002\u4e8e\u662f\u63a5\u4e0b\u6765\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u5c31\u8fdb\u884c\u4e86 TCP \u4e09\u6b21\u63e1\u624b\u3001\u6570\u636e\u4f20\u8f93\uff08HTTP \u5e94\u7b54 - \u54cd\u5e94\uff09\u3001\u56db\u6b21\u6325\u624b\u3002</li> <li>\u56e0\u4e3a\u5ba2\u6237\u7aef\u5f00\u542f\u4e86 tcp_tw_reuse\uff0c\u4e8e\u662f\u5feb\u901f\u590d\u7528 TIME_WAIT \u72b6\u6001\u7684\u7aef\u53e3\uff0c\u53c8\u4e0e\u670d\u52a1\u7aef\u5efa\u7acb\u4e86\u4e00\u4e2a\u4e0e\u521a\u624d\u76f8\u540c\u7684\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u3002</li> <li>\u63a5\u7740\uff0c\u524d\u9762\u88ab\u7f51\u7edc\u5ef6\u8fdf RST \u62a5\u6587\u8fd9\u65f6\u62b5\u8fbe\u4e86\u5ba2\u6237\u7aef\uff0c\u800c\u4e14 RST \u62a5\u6587\u7684\u5e8f\u5217\u53f7\u5728\u5ba2\u6237\u7aef\u7684\u63a5\u6536\u7a97\u53e3\u5185\uff0c\u7531\u4e8e\u9632\u56de\u7ed5\u5e8f\u5217\u53f7\u7b97\u6cd5\u4e0d\u4f1a\u9632\u6b62\u8fc7\u671f\u7684 RST\uff0c\u6240\u4ee5 RST \u62a5\u6587\u4f1a\u88ab\u5ba2\u6237\u7aef\u63a5\u53d7\u4e86\uff0c\u4e8e\u662f\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u5c31\u65ad\u5f00\u4e86\u3002</li> </ul> <p>\u4e0a\u9762\u8fd9\u4e2a\u573a\u666f\u5c31\u662f\u5f00\u542f tcp_tw_reuse \u98ce\u9669\uff0c\u56e0\u4e3a\u5feb\u901f\u590d\u7528 TIME_WAIT \u72b6\u6001\u7684\u7aef\u53e3\uff0c\u5bfc\u81f4\u65b0\u8fde\u63a5\u53ef\u80fd\u88ab\u56de\u7ed5\u5e8f\u5217\u53f7\u7684 RST \u62a5\u6587\u65ad\u5f00\u4e86\uff0c\u800c\u5982\u679c\u4e0d\u8df3\u8fc7 TIME_WAIT \u72b6\u6001\uff0c\u800c\u662f\u505c\u7559 2MSL \u65f6\u957f\uff0c\u90a3\u4e48\u8fd9\u4e2a RST \u62a5\u6587\u5c31\u4e0d\u4f1a\u51fa\u73b0\u4e0b\u4e00\u4e2a\u65b0\u7684\u8fde\u63a5\u3002</p> <p>\u53ef\u80fd\u5927\u5bb6\u4f1a\u6709\u8fd9\u6837\u7684\u7591\u95ee\uff0c\u4e3a\u4ec0\u4e48 PAWS \u68c0\u67e5\u8981\u653e\u8fc7\u8fc7\u671f\u7684 RST \u62a5\u6587\u3002\u6211\u7ffb\u4e86 RFC 1323\uff0c\u91cc\u9762\u6709\u4e00\u53e5\u63d0\u5230\uff1a</p> <p>It is recommended that RST segments NOT carry timestamps, and that RST segments be acceptable regardless of their timestamp.  Old duplicate RST segments should be exceedingly unlikely, and their cleanup function should take precedence over timestamps.</p> <p>\u5927\u6982\u7684\u610f\u601d\uff1a\u5efa\u8bae RST \u6bb5\u4e0d\u643a\u5e26\u65f6\u95f4\u6233\uff0c\u5e76\u4e14\u65e0\u8bba\u5176\u65f6\u95f4\u6233\u5982\u4f55\uff0cRST \u6bb5\u90fd\u662f\u53ef\u63a5\u53d7\u7684\u3002\u8001\u7684\u91cd\u590d\u7684 RST \u6bb5\u5e94\u8be5\u662f\u6781\u4e0d\u53ef\u80fd\u7684\uff0c\u5e76\u4e14\u5b83\u4eec\u7684\u6e05\u9664\u529f\u80fd\u5e94\u4f18\u5148\u4e8e\u65f6\u95f4\u6233\u3002</p> <p>RFC 1323 \u63d0\u5230\u8bf4\u6536\u5386\u53f2\u7684 RST \u62a5\u6587\u662f\u6781\u4e0d\u53ef\u80fd\uff0c\u4e4b\u6240\u4ee5\u6709\u8fd9\u6837\u7684\u60f3\u6cd5\u662f\u56e0\u4e3a TIME_WAIT \u72b6\u6001\u6301\u7eed\u7684 2MSL \u65f6\u95f4\uff0c\u8db3\u4ee5\u8ba9\u8fde\u63a5\u4e2d\u7684\u62a5\u6587\u5728\u7f51\u7edc\u4e2d\u81ea\u7136\u6d88\u5931\uff0c\u6240\u4ee5\u8ba4\u4e3a\u6309\u6b63\u5e38\u64cd\u4f5c\u6765\u8bf4\u662f\u4e0d\u4f1a\u53d1\u751f\u7684\uff0c\u56e0\u6b64\u8ba4\u4e3a\u6e05\u9664\u8fde\u63a5\u4f18\u5148\u4e8e\u65f6\u95f4\u6233\u3002</p> <p>\u800c\u6211\u524d\u9762\u63d0\u5230\u7684\u6848\u4f8b\uff0c\u662f\u56e0\u4e3a\u5f00\u542f\u4e86 tcp_tw_reuse \u72b6\u6001\uff0c\u8df3\u8fc7\u4e86 TIME_WAIT \u72b6\u6001\uff0c\u624d\u53d1\u751f\u7684\u4e8b\u60c5\u3002</p> <p>\u6709\u540c\u5b66\u4f1a\u8bf4\uff0c\u90fd\u7ecf\u8fc7\u4e00\u4e2a HTTP \u8bf7\u6c42\u4e86\uff0c\u5ef6\u8fdf\u7684 RST \u62a5\u6587\u7adf\u7136\u8fd8\u4f1a\u5b58\u6d3b\uff1f</p> <p>\u4e00\u4e2a HTTP \u8bf7\u6c42\u5176\u5b9e\u5f88\u5feb\u7684\uff0c\u6bd4\u5982\u6211\u4e0b\u9762\u8fd9\u4e2a\u6293\u5305\uff0c\u53ea\u9700\u8981 0.2 \u79d2\u5c31\u5b8c\u6210\u4e86\uff0c\u8fdc\u5c0f\u4e8e MSL\uff0c\u6240\u4ee5\u5ef6\u8fdf\u7684 RST \u62a5\u6587\u5b58\u6d3b\u662f\u6709\u53ef\u80fd\u7684\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/#_4","title":"\u7b2c\u4e8c\u4e2a\u95ee\u9898","text":"<p>\u5f00\u542f tcp_tw_reuse \u6765\u5feb\u901f\u590d\u7528 TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u5982\u679c\u7b2c\u56db\u6b21\u6325\u624b\u7684 ACK \u62a5\u6587\u4e22\u5931\u4e86\uff0c\u670d\u52a1\u7aef\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\uff0c\u91cd\u4f20\u7b2c\u4e09\u6b21\u6325\u624b\u62a5\u6587\uff0c\u5904\u4e8e syn_sent \u72b6\u6001\u7684\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u91cd\u4f20\u7b2c\u4e09\u6b21\u6325\u624b\u62a5\u6587\uff0c\u5219\u4f1a\u56de RST \u7ed9\u670d\u52a1\u7aef\u3002\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u65f6\u5019\u6709\u540c\u5b66\u5c31\u95ee\u4e86\uff0c\u5982\u679c TIME_WAIT \u72b6\u6001\u88ab\u5feb\u901f\u590d\u7528\u540e\uff0c\u521a\u597d\u7b2c\u56db\u6b21\u6325\u624b\u7684 ACK \u62a5\u6587\u4e22\u5931\u4e86\uff0c\u90a3\u5ba2\u6237\u7aef\u590d\u7528 TIME_WAIT \u72b6\u6001\u540e\u53d1\u9001\u7684 SYN \u62a5\u6587\u88ab\u5904\u4e8e last_ack \u72b6\u6001\u7684\u670d\u52a1\u7aef\u6536\u5230\u4e86\u4f1a\u53d1\u751f\u4ec0\u4e48\u5462\uff1f</p> <p>\u5904\u4e8e last_ack \u72b6\u6001\u7684\u670d\u52a1\u7aef\u6536\u5230\u4e86 SYN \u62a5\u6587\u540e\uff0c\u4f1a\u56de\u590d\u786e\u8ba4\u53f7\u4e0e\u670d\u52a1\u7aef\u4e0a\u4e00\u6b21\u53d1\u9001 ACK \u62a5\u6587\u4e00\u6837\u7684 ACK \u62a5\u6587\uff0c\u8fd9\u4e2a ACK \u62a5\u6587\u79f0\u4e3a Challenge ACK\uff0c\u5e76\u4e0d\u662f\u786e\u8ba4\u6536\u5230 SYN \u62a5\u6587\u3002</p> <p>\u5904\u4e8e syn_sent \u72b6\u6001\u7684\u5ba2\u6237\u7aef\u6536\u5230\u670d\u52a1\u7aef\u7684  Challenge ACK \u540e\uff0c\u53d1\u73b0\u4e0d\u662f\u81ea\u5df1\u671f\u671b\u6536\u5230\u7684\u786e\u8ba4\u53f7\uff0c\u4e8e\u662f\u5c31\u4f1a\u56de\u590d RST \u62a5\u6587\uff0c\u670d\u52a1\u7aef\u6536\u5230\u540e\uff0c\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_tw_reuse_close/#_5","title":"\u603b\u7ed3","text":"<p>tcp_tw_reuse \u7684\u4f5c\u7528\u662f\u8ba9\u5ba2\u6237\u7aef\u5feb\u901f\u590d\u7528\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u7aef\u53e3\uff0c\u76f8\u5f53\u4e8e\u8df3\u8fc7\u4e86 TIME_WAIT \u72b6\u6001\uff0c\u8fd9\u53ef\u80fd\u4f1a\u51fa\u73b0\u8fd9\u6837\u7684\u4e24\u4e2a\u95ee\u9898\uff1a</p> <ul> <li>\u5386\u53f2 RST \u62a5\u6587\u53ef\u80fd\u4f1a\u7ec8\u6b62\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\uff0c\u56e0\u4e3a PAWS \u68c0\u67e5\u5230\u5373\u4f7f RST \u662f\u8fc7\u671f\u7684\uff0c\u4e5f\u4e0d\u4f1a\u4e22\u5f03\u3002</li> <li>\u5982\u679c\u7b2c\u56db\u6b21\u6325\u624b\u7684 ACK \u62a5\u6587\u4e22\u5931\u4e86\uff0c\u6709\u53ef\u80fd\u88ab\u52a8\u5173\u95ed\u8fde\u63a5\u7684\u4e00\u65b9\u4e0d\u80fd\u88ab\u6b63\u5e38\u7684\u5173\u95ed;</li> </ul> <p>\u867d\u7136 TIME_WAIT \u72b6\u6001\u6301\u7eed\u7684\u65f6\u95f4\u662f\u6709\u4e00\u70b9\u957f\uff0c\u663e\u5f97\u5f88\u4e0d\u53cb\u597d\uff0c\u4f46\u662f\u5b83\u88ab\u8bbe\u8ba1\u6765\u5c31\u662f\u7528\u6765\u907f\u514d\u53d1\u751f\u4e71\u4e03\u516b\u7cdf\u7684\u4e8b\u60c5\u3002</p> <p>\u300aUNIX \u7f51\u7edc\u7f16\u7a0b\u300b\u4e00\u4e66\u4e2d\u5374\u8bf4\u9053\uff1aTIME_WAIT \u662f\u6211\u4eec\u7684\u670b\u53cb\uff0c\u5b83\u662f\u6709\u52a9\u4e8e\u6211\u4eec\u7684\uff0c\u4e0d\u8981\u8bd5\u56fe\u907f\u514d\u8fd9\u4e2a\u72b6\u6001\uff0c\u800c\u662f\u5e94\u8be5\u5f04\u6e05\u695a\u5b83\u3002</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_unplug_the_network_cable/","title":"4.13 \u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u539f\u672c\u7684 TCP \u8fde\u63a5\u8fd8\u5b58\u5728\u5417\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u4eca\u5929\uff0c\u804a\u4e00\u4e2a\u6709\u8da3\u7684\u95ee\u9898\uff1a\u62d4\u6389\u7f51\u7ebf\u51e0\u79d2\uff0c\u518d\u63d2\u56de\u53bb\uff0c\u539f\u672c\u7684 TCP \u8fde\u63a5\u8fd8\u5b58\u5728\u5417\uff1f</p> <p>\u53ef\u80fd\u6709\u7684\u540c\u5b66\u4f1a\u8bf4\uff0c\u7f51\u7ebf\u90fd\u88ab\u62d4\u6389\u4e86\uff0c\u90a3\u8bf4\u660e\u7269\u7406\u5c42\u88ab\u65ad\u5f00\u4e86\uff0c\u90a3\u5728\u4e0a\u5c42\u7684\u4f20\u8f93\u5c42\u7406\u5e94\u4e5f\u4f1a\u65ad\u5f00\uff0c\u6240\u4ee5\u539f\u672c\u7684 TCP \u8fde\u63a5\u5c31\u4e0d\u4f1a\u5b58\u5728\u7684\u4e86\u3002\u5c31\u597d\u50cf\uff0c\u6211\u4eec\u62e8\u6253\u6709\u7ebf\u7535\u8bdd\u7684\u65f6\u5019\uff0c\u5982\u679c\u67d0\u4e00\u65b9\u7684\u7535\u8bdd\u7ebf\u88ab\u62d4\u4e86\uff0c\u90a3\u4e48\u672c\u6b21\u901a\u8bdd\u5c31\u5f7b\u5e95\u65ad\u4e86\u3002</p> <p>\u771f\u7684\u662f\u8fd9\u6837\u5417\uff1f</p> <p>\u4e0a\u9762\u8fd9\u4e2a\u903b\u8f91\u5c31\u6709\u95ee\u9898\u3002\u95ee\u9898\u5728\u4e8e\uff0c\u9519\u8bef\u7684\u8ba4\u4e3a\u62d4\u6389\u7f51\u7ebf\u8fd9\u4e2a\u52a8\u4f5c\u4f1a\u5f71\u54cd\u4f20\u8f93\u5c42\uff0c\u4e8b\u5b9e\u4e0a\u5e76\u4e0d\u4f1a\u5f71\u54cd\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cTCP \u8fde\u63a5\u5728 Linux \u5185\u6838\u4e2d\u662f\u4e00\u4e2a\u540d\u4e3a <code>struct socket</code> \u7684\u7ed3\u6784\u4f53\uff0c\u8be5\u7ed3\u6784\u4f53\u7684\u5185\u5bb9\u5305\u542b TCP \u8fde\u63a5\u7684\u72b6\u6001\u7b49\u4fe1\u606f\u3002\u5f53\u62d4\u6389\u7f51\u7ebf\u7684\u65f6\u5019\uff0c\u64cd\u4f5c\u7cfb\u7edf\u5e76\u4e0d\u4f1a\u53d8\u66f4\u8be5\u7ed3\u6784\u4f53\u7684\u4efb\u4f55\u5185\u5bb9\uff0c\u6240\u4ee5 TCP \u8fde\u63a5\u7684\u72b6\u6001\u4e5f\u4e0d\u4f1a\u53d1\u751f\u6539\u53d8\u3002</p> <p>\u6211\u5728\u6211\u7684\u7535\u8111\u4e0a\u505a\u4e86\u4e2a\u5c0f\u5b9e\u9a8c\uff0c\u6211\u7528 ssh \u7ec8\u7aef\u8fde\u63a5\u4e86\u6211\u7684\u4e91\u670d\u52a1\u5668\uff0c\u7136\u540e\u6211\u901a\u8fc7\u65ad\u5f00 wifi \u7684\u65b9\u5f0f\u6765\u6a21\u62df\u62d4\u6389\u7f51\u7ebf\u7684\u573a\u666f\uff0c\u6b64\u65f6\u67e5\u770b TCP \u8fde\u63a5\u7684\u72b6\u6001\u6ca1\u6709\u53d1\u751f\u53d8\u5316\uff0c\u8fd8\u662f\u5904\u4e8e ESTABLISHED \u72b6\u6001\u3002</p> <p></p> <p>\u901a\u8fc7\u4e0a\u9762\u8fd9\u4e2a\u5b9e\u9a8c\u7ed3\u679c\uff0c\u6211\u4eec\u77e5\u9053\u4e86\uff0c\u62d4\u6389\u7f51\u7ebf\u8fd9\u4e2a\u52a8\u4f5c\u5e76\u4e0d\u4f1a\u5f71\u54cd TCP \u8fde\u63a5\u7684\u72b6\u6001\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u8981\u770b\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u53cc\u65b9\u505a\u4e86\u4ec0\u4e48\u52a8\u4f5c\u3002</p> <p>\u6240\u4ee5\uff0c\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u8981\u5206\u573a\u666f\u6765\u8ba8\u8bba\uff1a</p> <ul> <li>\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u6709\u6570\u636e\u4f20\u8f93\uff1b</li> <li>\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u6ca1\u6709\u6570\u636e\u4f20\u8f93\uff1b</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_unplug_the_network_cable/#_1","title":"\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u6709\u6570\u636e\u4f20\u8f93","text":"<p>\u5728\u5ba2\u6237\u7aef\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u670d\u52a1\u7aef\u5411\u5ba2\u6237\u7aef\u53d1\u9001\u7684\u6570\u636e\u62a5\u6587\u4f1a\u5f97\u4e0d\u5230\u4efb\u4f55\u7684\u54cd\u5e94\uff0c\u5728\u7b49\u5f85\u4e00\u5b9a\u65f6\u957f\u540e\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u89e6\u53d1\u8d85\u65f6\u91cd\u4f20\u673a\u5236\uff0c\u91cd\u4f20\u672a\u5f97\u5230\u54cd\u5e94\u7684\u6570\u636e\u62a5\u6587\u3002</p> <p>\u5982\u679c\u5728\u670d\u52a1\u7aef\u91cd\u4f20\u62a5\u6587\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u521a\u597d\u628a\u7f51\u7ebf\u63d2\u56de\u53bb\u4e86\uff0c\u7531\u4e8e\u62d4\u6389\u7f51\u7ebf\u5e76\u4e0d\u4f1a\u6539\u53d8\u5ba2\u6237\u7aef\u7684 TCP \u8fde\u63a5\u72b6\u6001\uff0c\u5e76\u4e14\u8fd8\u662f\u5904\u4e8e ESTABLISHED \u72b6\u6001\uff0c\u6240\u4ee5\u8fd9\u65f6\u5ba2\u6237\u7aef\u662f\u53ef\u4ee5\u6b63\u5e38\u63a5\u6536\u670d\u52a1\u7aef\u53d1\u6765\u7684\u6570\u636e\u62a5\u6587\u7684\uff0c\u7136\u540e\u5ba2\u6237\u7aef\u5c31\u4f1a\u56de ACK \u54cd\u5e94\u62a5\u6587\u3002</p> <p>\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u4f9d\u7136\u5b58\u5728\u7684\uff0c\u5c31\u611f\u89c9\u4ec0\u4e48\u4e8b\u60c5\u90fd\u6ca1\u6709\u53d1\u751f\u3002</p> <p>\u4f46\u662f\uff0c\u5982\u679c\u5728\u670d\u52a1\u7aef\u91cd\u4f20\u62a5\u6587\u7684\u8fc7\u7a0b\u4e2d\uff0c\u5ba2\u6237\u7aef\u4e00\u76f4\u6ca1\u6709\u5c06\u7f51\u7ebf\u63d2\u56de\u53bb\uff0c\u670d\u52a1\u7aef\u8d85\u65f6\u91cd\u4f20\u62a5\u6587\u7684\u6b21\u6570\u8fbe\u5230\u4e00\u5b9a\u9608\u503c\u540e\uff0c\u5185\u6838\u5c31\u4f1a\u5224\u5b9a\u51fa\u8be5 TCP \u6709\u95ee\u9898\uff0c\u7136\u540e\u901a\u8fc7 Socket \u63a5\u53e3\u544a\u8bc9\u5e94\u7528\u7a0b\u5e8f\u8be5 TCP \u8fde\u63a5\u51fa\u95ee\u9898\u4e86\uff0c\u4e8e\u662f\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u5c31\u4f1a\u65ad\u5f00\u3002</p> <p>\u800c\u7b49\u5ba2\u6237\u7aef\u63d2\u56de\u7f51\u7ebf\u540e\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e86\u6570\u636e\uff0c\u7531\u4e8e\u670d\u52a1\u7aef\u5df2\u7ecf\u6ca1\u6709\u4e0e\u5ba2\u6237\u7aef\u76f8\u540c\u56db\u5143\u7956\u7684 TCP \u8fde\u63a5\u4e86\uff0c\u56e0\u6b64\u670d\u52a1\u7aef\u5185\u6838\u5c31\u4f1a\u56de\u590d RST \u62a5\u6587\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\u5c31\u4f1a\u91ca\u653e\u8be5 TCP \u8fde\u63a5\u3002</p> <p>\u6b64\u65f6\uff0c\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u90fd\u5df2\u7ecf\u65ad\u5f00\u4e86\u3002</p> <p>\u90a3 TCP \u7684\u6570\u636e\u62a5\u6587\u5177\u4f53\u91cd\u4f20\u51e0\u6b21\u5462\uff1f</p> <p>\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u53eb tcp_retries2 \u914d\u7f6e\u9879\uff0c\u9ed8\u8ba4\u503c\u662f 15\uff0c\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u8fd9\u4e2a\u5185\u6838\u53c2\u6570\u662f\u63a7\u5236\uff0c\u5728 TCP \u8fde\u63a5\u5efa\u7acb\u7684\u60c5\u51b5\u4e0b\uff0c\u8d85\u65f6\u91cd\u4f20\u7684\u6700\u5927\u6b21\u6570\u3002</p> <p>\u4e0d\u8fc7 tcp_retries2 \u8bbe\u7f6e\u4e86 15 \u6b21\uff0c\u5e76\u4e0d\u4ee3\u8868 TCP \u8d85\u65f6\u91cd\u4f20\u4e86 15 \u6b21\u624d\u4f1a\u901a\u77e5\u5e94\u7528\u7a0b\u5e8f\u7ec8\u6b62\u8be5 TCP \u8fde\u63a5\uff0c\u5185\u6838\u4f1a\u6839\u636e tcp_retries2 \u8bbe\u7f6e\u7684\u503c\uff0c\u8ba1\u7b97\u51fa\u4e00\u4e2a timeout\uff08\u5982\u679c tcp_retries2 =15\uff0c\u90a3\u4e48\u8ba1\u7b97\u5f97\u5230\u7684 timeout = 924600 ms\uff09\uff0c\u5982\u679c\u91cd\u4f20\u95f4\u9694\u8d85\u8fc7\u8fd9\u4e2a timeout\uff0c\u5219\u8ba4\u4e3a\u8d85\u8fc7\u4e86\u9608\u503c\uff0c\u5c31\u4f1a\u505c\u6b62\u91cd\u4f20\uff0c\u7136\u540e\u5c31\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\u3002</p> <p>\u5728\u53d1\u751f\u8d85\u65f6\u91cd\u4f20\u7684\u8fc7\u7a0b\u4e2d\uff0c\u6bcf\u4e00\u8f6e\u7684\u8d85\u65f6\u65f6\u95f4\uff08RTO\uff09\u90fd\u662f\u500d\u6570\u589e\u957f\u7684\uff0c\u6bd4\u5982\u5982\u679c\u7b2c\u4e00\u8f6e RTO \u662f 200 \u6beb\u79d2\uff0c\u90a3\u4e48\u7b2c\u4e8c\u8f6e RTO \u662f 400 \u6beb\u79d2\uff0c\u7b2c\u4e09\u8f6e RTO \u662f 800 \u6beb\u79d2\uff0c\u4ee5\u6b64\u7c7b\u63a8\u3002</p> <p>\u800c RTO \u662f\u57fa\u4e8e RTT\uff08\u4e00\u4e2a\u5305\u7684\u5f80\u8fd4\u65f6\u95f4\uff09\u6765\u8ba1\u7b97\u7684\uff0c\u5982\u679c RTT \u8f83\u5927\uff0c\u90a3\u4e48\u8ba1\u7b97\u51fa\u6765\u7684 RTO \u5c31\u8d8a\u5927\uff0c\u90a3\u4e48\u7ecf\u8fc7\u51e0\u8f6e\u91cd\u4f20\u540e\uff0c\u5f88\u5feb\u5c31\u8fbe\u5230\u4e86\u4e0a\u9762\u7684 timeout \u503c\u4e86\u3002</p> <p>\u4e3e\u4e2a\u4f8b\u5b50\uff0c\u5982\u679c tcp_retries2 =15\uff0c\u90a3\u4e48\u8ba1\u7b97\u5f97\u5230\u7684 timeout = 924600 ms\uff0c\u5982\u679c\u91cd\u4f20\u603b\u95f4\u9694\u65f6\u957f\u8fbe\u5230\u4e86 timeout \u5c31\u4f1a\u505c\u6b62\u91cd\u4f20\uff0c\u7136\u540e\u5c31\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\uff1a</p> <ul> <li>\u5982\u679c RTT \u6bd4\u8f83\u5c0f\uff0c\u90a3\u4e48 RTO \u521d\u59cb\u503c\u5c31\u7ea6\u7b49\u4e8e\u4e0b\u9650 200ms\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u8f6e\u7684\u8d85\u65f6\u65f6\u95f4\u662f 200 \u6beb\u79d2\uff0c\u7531\u4e8e timeout \u603b\u65f6\u957f\u662f 924600 ms\uff0c\u8868\u73b0\u51fa\u6765\u7684\u73b0\u8c61\u521a\u597d\u5c31\u662f\u91cd\u4f20\u4e86 15 \u6b21\uff0c\u8d85\u8fc7\u4e86 timeout \u503c\uff0c\u4ece\u800c\u65ad\u5f00 TCP \u8fde\u63a5</li> <li>\u5982\u679c RTT \u6bd4\u8f83\u5927\uff0c\u5047\u8bbe RTO \u521d\u59cb\u503c\u8ba1\u7b97\u5f97\u5230\u7684\u662f 1000 ms\uff0c\u4e5f\u5c31\u662f\u7b2c\u4e00\u8f6e\u7684\u8d85\u65f6\u65f6\u95f4\u662f 1 \u79d2\uff0c\u90a3\u4e48\u6839\u672c\u4e0d\u9700\u8981\u91cd\u4f20 15 \u6b21\uff0c\u91cd\u4f20\u603b\u95f4\u9694\u5c31\u4f1a\u8d85\u8fc7 924600 ms\u3002</li> </ul> <p>\u6700\u5c0f RTO \u548c\u6700\u5927 RTO \u662f\u5728 Linux \u5185\u6838\u4e2d\u5b9a\u4e49\u597d\u4e86\uff1a</p> C<pre><code>#define TCP_RTO_MAX ((unsigned)(120*HZ))\n#define TCP_RTO_MIN ((unsigned)(HZ/5))\n</code></pre> <p>Linux 2.6+ \u4f7f\u7528 1000 \u6beb\u79d2\u7684 HZ\uff0c\u56e0\u6b64<code>TCP_RTO_MIN</code>\u7ea6\u4e3a 200 \u6beb\u79d2\uff0c<code>TCP_RTO_MAX</code>\u7ea6\u4e3a 120 \u79d2\u3002</p> <p>\u5982\u679c<code>tcp_retries</code>\u8bbe\u7f6e\u4e3a<code>15</code>\uff0c\u4e14  RTT \u6bd4\u8f83\u5c0f\uff0c\u90a3\u4e48 RTO \u521d\u59cb\u503c\u5c31\u7ea6\u7b49\u4e8e\u4e0b\u9650 200ms\uff0c\u8fd9\u610f\u5473\u7740\u5b83\u9700\u8981 924.6 \u79d2\u624d\u80fd\u5c06\u65ad\u5f00\u7684 TCP \u8fde\u63a5\u901a\u77e5\u7ed9\u4e0a\u5c42\uff08\u5373\u5e94\u7528\u7a0b\u5e8f\uff09\uff0c\u6bcf\u4e00\u8f6e\u7684 RTO \u589e\u957f\u5173\u7cfb\u5982\u4e0b\u8868\u683c\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_unplug_the_network_cable/#_2","title":"\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u6ca1\u6709\u6570\u636e\u4f20\u8f93","text":"<p>\u9488\u5bf9\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u6ca1\u6709\u6570\u636e\u4f20\u8f93\u7684\u573a\u666f\uff0c\u8fd8\u5f97\u770b\u662f\u5426\u5f00\u542f\u4e86 TCP keepalive \u673a\u5236\uff08TCP \u4fdd\u6d3b\u673a\u5236\uff09\u3002</p> <p>\u5982\u679c\u6ca1\u6709\u5f00\u542f TCP keepalive \u673a\u5236\uff0c\u5728\u5ba2\u6237\u7aef\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u5e76\u4e14\u53cc\u65b9\u90fd\u6ca1\u6709\u8fdb\u884c\u6570\u636e\u4f20\u8f93\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u5c06\u4f1a\u4e00\u76f4\u4fdd\u6301\u5b58\u5728\u3002</p> <p>\u800c\u5982\u679c\u5f00\u542f\u4e86 TCP keepalive \u673a\u5236\uff0c\u5728\u5ba2\u6237\u7aef\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u5373\u4f7f\u53cc\u65b9\u90fd\u6ca1\u6709\u8fdb\u884c\u6570\u636e\u4f20\u8f93\uff0c\u5728\u6301\u7eed\u4e00\u6bb5\u65f6\u95f4\u540e\uff0cTCP \u5c31\u4f1a\u53d1\u9001\u63a2\u6d4b\u62a5\u6587\uff1a</p> <ul> <li>\u5982\u679c\u5bf9\u7aef\u662f\u6b63\u5e38\u5de5\u4f5c\u7684\u3002\u5f53 TCP \u4fdd\u6d3b\u7684\u63a2\u6d4b\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u7aef\uff0c\u5bf9\u7aef\u4f1a\u6b63\u5e38\u54cd\u5e94\uff0c\u8fd9\u6837 TCP \u4fdd\u6d3b\u65f6\u95f4\u4f1a\u88ab\u91cd\u7f6e\uff0c\u7b49\u5f85\u4e0b\u4e00\u4e2a TCP \u4fdd\u6d3b\u65f6\u95f4\u7684\u5230\u6765\u3002</li> <li>\u5982\u679c\u5bf9\u7aef\u4e3b\u673a\u5b95\u673a\uff08\u6ce8\u610f\u4e0d\u662f\u8fdb\u7a0b\u5d29\u6e83\uff0c\u8fdb\u7a0b\u5d29\u6e83\u540e\u64cd\u4f5c\u7cfb\u7edf\u5728\u56de\u6536\u8fdb\u7a0b\u8d44\u6e90\u7684\u65f6\u5019\uff0c\u4f1a\u53d1\u9001 FIN \u62a5\u6587\uff0c\u800c\u4e3b\u673a\u5b95\u673a\u5219\u662f\u65e0\u6cd5\u611f\u77e5\u7684\uff0c\u6240\u4ee5\u9700\u8981 TCP \u4fdd\u6d3b\u673a\u5236\u6765\u63a2\u6d4b\u5bf9\u65b9\u662f\u4e0d\u662f\u53d1\u751f\u4e86\u4e3b\u673a\u5b95\u673a\uff09\uff0c\u6216\u5bf9\u7aef\u7531\u4e8e\u5176\u4ed6\u539f\u56e0\u5bfc\u81f4\u62a5\u6587\u4e0d\u53ef\u8fbe\u3002\u5f53 TCP \u4fdd\u6d3b\u7684\u63a2\u6d4b\u62a5\u6587\u53d1\u9001\u7ed9\u5bf9\u7aef\u540e\uff0c\u77f3\u6c89\u5927\u6d77\uff0c\u6ca1\u6709\u54cd\u5e94\uff0c\u8fde\u7eed\u51e0\u6b21\uff0c\u8fbe\u5230\u4fdd\u6d3b\u63a2\u6d4b\u6b21\u6570\u540e\uff0cTCP \u4f1a\u62a5\u544a\u8be5 TCP \u8fde\u63a5\u5df2\u7ecf\u6b7b\u4ea1\u3002</li> </ul> <p>\u6240\u4ee5\uff0cTCP \u4fdd\u6d3b\u673a\u5236\u53ef\u4ee5\u5728\u53cc\u65b9\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\u7684\u60c5\u51b5\uff0c\u901a\u8fc7\u63a2\u6d4b\u62a5\u6587\uff0c\u6765\u786e\u5b9a\u5bf9\u65b9\u7684 TCP \u8fde\u63a5\u662f\u5426\u5b58\u6d3b\u3002</p> <p>TCP keepalive \u673a\u5236\u5177\u4f53\u662f\u600e\u4e48\u6837\u7684\uff1f</p> <p>\u8fd9\u4e2a\u673a\u5236\u7684\u539f\u7406\u662f\u8fd9\u6837\u7684\uff1a</p> <p>\u5b9a\u4e49\u4e00\u4e2a\u65f6\u95f4\u6bb5\uff0c\u5728\u8fd9\u4e2a\u65f6\u95f4\u6bb5\u5185\uff0c\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u8fde\u63a5\u76f8\u5173\u7684\u6d3b\u52a8\uff0cTCP \u4fdd\u6d3b\u673a\u5236\u4f1a\u5f00\u59cb\u4f5c\u7528\uff0c\u6bcf\u9694\u4e00\u4e2a\u65f6\u95f4\u95f4\u9694\uff0c\u53d1\u9001\u4e00\u4e2a\u63a2\u6d4b\u62a5\u6587\uff0c\u8be5\u63a2\u6d4b\u62a5\u6587\u5305\u542b\u7684\u6570\u636e\u975e\u5e38\u5c11\uff0c\u5982\u679c\u8fde\u7eed\u51e0\u4e2a\u63a2\u6d4b\u62a5\u6587\u90fd\u6ca1\u6709\u5f97\u5230\u54cd\u5e94\uff0c\u5219\u8ba4\u4e3a\u5f53\u524d\u7684 TCP \u8fde\u63a5\u5df2\u7ecf\u6b7b\u4ea1\uff0c\u7cfb\u7edf\u5185\u6838\u5c06\u9519\u8bef\u4fe1\u606f\u901a\u77e5\u7ed9\u4e0a\u5c42\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p>\u5728 Linux \u5185\u6838\u53ef\u4ee5\u6709\u5bf9\u5e94\u7684\u53c2\u6570\u53ef\u4ee5\u8bbe\u7f6e\u4fdd\u6d3b\u65f6\u95f4\u3001\u4fdd\u6d3b\u63a2\u6d4b\u7684\u6b21\u6570\u3001\u4fdd\u6d3b\u63a2\u6d4b\u7684\u65f6\u95f4\u95f4\u9694\uff0c\u4ee5\u4e0b\u90fd\u4e3a\u9ed8\u8ba4\u503c\uff1a</p> Text Only<pre><code>net.ipv4.tcp_keepalive_time=7200\nnet.ipv4.tcp_keepalive_intvl=75  \nnet.ipv4.tcp_keepalive_probes=9\n</code></pre> <ul> <li>tcp_keepalive_time=7200\uff1a\u8868\u793a\u4fdd\u6d3b\u65f6\u95f4\u662f 7200 \u79d2\uff082 \u5c0f\u65f6\uff09\uff0c\u4e5f\u5c31 2 \u5c0f\u65f6\u5185\u5982\u679c\u6ca1\u6709\u4efb\u4f55\u8fde\u63a5\u76f8\u5173\u7684\u6d3b\u52a8\uff0c\u5219\u4f1a\u542f\u52a8\u4fdd\u6d3b\u673a\u5236</li> <li>tcp_keepalive_intvl=75\uff1a\u8868\u793a\u6bcf\u6b21\u68c0\u6d4b\u95f4\u9694 75 \u79d2\uff1b</li> <li>tcp_keepalive_probes=9\uff1a\u8868\u793a\u68c0\u6d4b 9 \u6b21\u65e0\u54cd\u5e94\uff0c\u8ba4\u4e3a\u5bf9\u65b9\u662f\u4e0d\u53ef\u8fbe\u7684\uff0c\u4ece\u800c\u4e2d\u65ad\u672c\u6b21\u7684\u8fde\u63a5\u3002</li> </ul> <p>\u4e5f\u5c31\u662f\u8bf4\u5728 Linux \u7cfb\u7edf\u4e2d\uff0c\u6700\u5c11\u9700\u8981\u7ecf\u8fc7 2 \u5c0f\u65f6 11 \u5206 15 \u79d2\u624d\u53ef\u4ee5\u53d1\u73b0\u4e00\u4e2a\u300c\u6b7b\u4ea1\u300d\u8fde\u63a5\u3002</p> <p></p> <p>\u6ce8\u610f\uff0c\u5e94\u7528\u7a0b\u5e8f\u82e5\u60f3\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\u9700\u8981\u901a\u8fc7 socket \u63a5\u53e3\u8bbe\u7f6e <code>SO_KEEPALIVE</code> \u9009\u9879\u624d\u80fd\u591f\u751f\u6548\uff0c\u5982\u679c\u6ca1\u6709\u8bbe\u7f6e\uff0c\u90a3\u4e48\u5c31\u65e0\u6cd5\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\u3002</p> <p>TCP keepalive \u673a\u5236\u63a2\u6d4b\u7684\u65f6\u95f4\u4e5f\u592a\u957f\u4e86\u5427\uff1f</p> <p>\u5bf9\u7684\uff0c\u662f\u6709\u70b9\u957f\u3002</p> <p>TCP keepalive  \u662f TCP \u5c42\uff08\u5185\u6838\u6001\uff09 \u5b9e\u73b0\u7684\uff0c\u5b83\u662f\u7ed9\u6240\u6709\u57fa\u4e8e TCP \u4f20\u8f93\u534f\u8bae\u7684\u7a0b\u5e8f\u4e00\u4e2a\u515c\u5e95\u7684\u65b9\u6848\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0c\u6211\u4eec\u5e94\u7528\u5c42\u53ef\u4ee5\u81ea\u5df1\u5b9e\u73b0\u4e00\u5957\u63a2\u6d4b\u673a\u5236\uff0c\u53ef\u4ee5\u5728\u8f83\u77ed\u7684\u65f6\u95f4\u5185\uff0c\u63a2\u6d4b\u5230\u5bf9\u65b9\u662f\u5426\u5b58\u6d3b\u3002</p> <p>\u6bd4\u5982\uff0cweb \u670d\u52a1\u8f6f\u4ef6\u4e00\u822c\u90fd\u4f1a\u63d0\u4f9b <code>keepalive_timeout</code> \u53c2\u6570\uff0c\u7528\u6765\u6307\u5b9a HTTP \u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u3002\u5982\u679c\u8bbe\u7f6e\u4e86 HTTP \u957f\u8fde\u63a5\u7684\u8d85\u65f6\u65f6\u95f4\u662f 60 \u79d2\uff0cweb \u670d\u52a1\u8f6f\u4ef6\u5c31\u4f1a\u542f\u52a8\u4e00\u4e2a\u5b9a\u65f6\u5668\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u5728\u5b8c\u540e\u4e00\u4e2a HTTP \u8bf7\u6c42\u540e\uff0c\u5728 60 \u79d2\u5185\u90fd\u6ca1\u6709\u518d\u53d1\u8d77\u65b0\u7684\u8bf7\u6c42\uff0c\u5b9a\u65f6\u5668\u7684\u65f6\u95f4\u4e00\u5230\uff0c\u5c31\u4f1a\u89e6\u53d1\u56de\u8c03\u51fd\u6570\u6765\u91ca\u653e\u8be5\u8fde\u63a5\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/tcp_unplug_the_network_cable/#_3","title":"\u603b\u7ed3","text":"<p>\u5ba2\u6237\u7aef\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u5e76\u4e0d\u4f1a\u76f4\u63a5\u5f71\u54cd TCP \u8fde\u63a5\u72b6\u6001\u3002\u6240\u4ee5\uff0c\u62d4\u6389\u7f51\u7ebf\u540e\uff0cTCP \u8fde\u63a5\u662f\u5426\u8fd8\u4f1a\u5b58\u5728\uff0c\u5173\u952e\u8981\u770b\u62d4\u6389\u7f51\u7ebf\u4e4b\u540e\uff0c\u6709\u6ca1\u6709\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002</p> <p>\u6709\u6570\u636e\u4f20\u8f93\u7684\u60c5\u51b5\uff1a</p> <ul> <li>\u5728\u5ba2\u6237\u7aef\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u5982\u679c\u670d\u52a1\u7aef\u53d1\u9001\u4e86\u6570\u636e\u62a5\u6587\uff0c\u90a3\u4e48\u5728\u670d\u52a1\u7aef\u91cd\u4f20\u6b21\u6570\u6ca1\u6709\u8fbe\u5230\u6700\u5927\u503c\u4e4b\u524d\uff0c\u5ba2\u6237\u7aef\u5c31\u63d2\u56de\u4e86\u7f51\u7ebf\uff0c\u90a3\u4e48\u53cc\u65b9\u539f\u672c\u7684 TCP \u8fde\u63a5\u8fd8\u662f\u80fd\u6b63\u5e38\u5b58\u5728\uff0c\u5c31\u597d\u50cf\u4ec0\u4e48\u4e8b\u60c5\u90fd\u6ca1\u6709\u53d1\u751f\u3002</li> <li>\u5728\u5ba2\u6237\u7aef\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u5982\u679c\u670d\u52a1\u7aef\u53d1\u9001\u4e86\u6570\u636e\u62a5\u6587\uff0c\u5728\u5ba2\u6237\u7aef\u63d2\u56de\u7f51\u7ebf\u4e4b\u524d\uff0c\u670d\u52a1\u7aef\u91cd\u4f20\u6b21\u6570\u8fbe\u5230\u4e86\u6700\u5927\u503c\u65f6\uff0c\u670d\u52a1\u7aef\u5c31\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\u3002\u7b49\u5230\u5ba2\u6237\u7aef\u63d2\u56de\u7f51\u7ebf\u540e\uff0c\u5411\u670d\u52a1\u7aef\u53d1\u9001\u4e86\u6570\u636e\uff0c\u56e0\u4e3a\u670d\u52a1\u7aef\u5df2\u7ecf\u65ad\u5f00\u4e86\u4e0e\u5ba2\u6237\u7aef\u76f8\u540c\u56db\u5143\u7ec4\u7684 TCP \u8fde\u63a5\uff0c\u6240\u4ee5\u5c31\u4f1a\u56de RST \u62a5\u6587\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\u5c31\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\u3002\u81f3\u6b64\uff0c\u53cc\u65b9\u7684 TCP \u8fde\u63a5\u90fd\u65ad\u5f00\u4e86\u3002</li> </ul> <p>\u6ca1\u6709\u6570\u636e\u4f20\u8f93\u7684\u60c5\u51b5\uff1a</p> <ul> <li>\u5982\u679c\u53cc\u65b9\u90fd\u6ca1\u6709\u5f00\u542f TCP keepalive \u673a\u5236\uff0c\u90a3\u4e48\u5728\u5ba2\u6237\u7aef\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4e00\u76f4\u4e0d\u63d2\u56de\u7f51\u7ebf\uff0c\u90a3\u4e48\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u72b6\u6001\u5c06\u4f1a\u4e00\u76f4\u4fdd\u6301\u5b58\u5728\u3002</li> <li>\u5982\u679c\u53cc\u65b9\u90fd\u5f00\u542f\u4e86 TCP keepalive \u673a\u5236\uff0c\u90a3\u4e48\u5728\u5ba2\u6237\u7aef\u62d4\u6389\u7f51\u7ebf\u540e\uff0c\u5982\u679c\u5ba2\u6237\u7aef\u4e00\u76f4\u4e0d\u63d2\u56de\u7f51\u7ebf\uff0cTCP keepalive \u673a\u5236\u4f1a\u63a2\u6d4b\u5230\u5bf9\u65b9\u7684 TCP \u8fde\u63a5\u6ca1\u6709\u5b58\u6d3b\uff0c\u4e8e\u662f\u5c31\u4f1a\u65ad\u5f00 TCP \u8fde\u63a5\u3002\u800c\u5982\u679c\u5728 TCP \u63a2\u6d4b\u671f\u95f4\uff0c\u5ba2\u6237\u7aef\u63d2\u56de\u4e86\u7f51\u7ebf\uff0c\u90a3\u4e48\u53cc\u65b9\u539f\u672c\u7684 TCP \u8fde\u63a5\u8fd8\u662f\u80fd\u6b63\u5e38\u5b58\u5728\u3002</li> </ul> <p>\u9664\u4e86\u5ba2\u6237\u7aef\u62d4\u6389\u7f51\u7ebf\u7684\u573a\u666f\uff0c\u8fd8\u6709\u5ba2\u6237\u7aef\u300c\u4e3b\u673a\u5b95\u673a\u548c\u8fdb\u7a0b\u5d29\u6e83\u300d\u7684\u4e24\u79cd\u573a\u666f\u3002</p> <p>\u7b2c\u4e00\u4e2a\u573a\u666f\uff0c\u5ba2\u6237\u7aef\u5b95\u673a\u8fd9\u4ef6\u4e8b\u8ddf\u62d4\u6389\u7f51\u7ebf\u662f\u4e00\u6837\u65e0\u6cd5\u88ab\u670d\u52a1\u7aef\u7684\u611f\u77e5\u7684\uff0c\u6240\u4ee5\u5982\u679c\u5728\u6ca1\u6709\u6570\u636e\u4f20\u8f93\uff0c\u5e76\u4e14\u6ca1\u6709\u5f00\u542f TCP keepalive \u673a\u5236\u65f6\uff0c\uff0c\u670d\u52a1\u7aef\u7684 TCP \u8fde\u63a5\u5c06\u4f1a\u4e00\u76f4\u5904\u4e8e ESTABLISHED \u8fde\u63a5\u72b6\u6001\uff0c\u76f4\u5230\u670d\u52a1\u7aef\u91cd\u542f\u8fdb\u7a0b\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u53ef\u4ee5\u5f97\u77e5\u4e00\u4e2a\u70b9\u3002\u5728\u6ca1\u6709\u4f7f\u7528 TCP \u4fdd\u6d3b\u673a\u5236\uff0c\u4e14\u53cc\u65b9\u4e0d\u4f20\u8f93\u6570\u636e\u7684\u60c5\u51b5\u4e0b\uff0c\u4e00\u65b9\u7684 TCP \u8fde\u63a5\u5904\u5728 ESTABLISHED \u72b6\u6001\u65f6\uff0c\u5e76\u4e0d\u4ee3\u8868\u53e6\u4e00\u65b9\u7684 TCP \u8fde\u63a5\u8fd8\u4e00\u5b9a\u662f\u6b63\u5e38\u7684\u3002</p> <p>\u7b2c\u4e8c\u4e2a\u573a\u666f\uff0c\u5ba2\u6237\u7aef\u7684\u8fdb\u7a0b\u5d29\u6e83\u540e\uff0c\u5ba2\u6237\u7aef\u7684\u5185\u6838\u5c31\u4f1a\u5411\u670d\u52a1\u7aef\u53d1\u9001 FIN \u62a5\u6587\uff0c\u4e0e\u670d\u52a1\u7aef\u8fdb\u884c\u56db\u6b21\u6325\u624b\u3002</p> <p>\u6240\u4ee5\uff0c\u5373\u4f7f\u6ca1\u6709\u5f00\u542f TCP keepalive\uff0c\u4e14\u53cc\u65b9\u4e5f\u6ca1\u6709\u6570\u636e\u4ea4\u4e92\u7684\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u5176\u4e2d\u4e00\u65b9\u7684\u8fdb\u7a0b\u53d1\u751f\u4e86\u5d29\u6e83\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u64cd\u4f5c\u7cfb\u7edf\u662f\u53ef\u4ee5\u611f\u77e5\u7684\u5230\u7684\uff0c\u4e8e\u662f\u5c31\u4f1a\u53d1\u9001 FIN \u62a5\u6587\u7ed9\u5bf9\u65b9\uff0c\u7136\u540e\u4e0e\u5bf9\u65b9\u8fdb\u884c TCP \u56db\u6b21\u6325\u624b\u3002</p> <p>\u5b8c\uff01</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/time_wait_recv_syn/","title":"4.11 \u5728 TIME_WAIT \u72b6\u6001\u7684 TCP \u8fde\u63a5\uff0c\u6536\u5230 SYN \u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f","text":"<p>\u5927\u5bb6\u597d\uff0c\u6211\u662f\u5c0f\u6797\u3002</p> <p>\u5468\u672b\u8ddf\u670b\u53cb\u8ba8\u8bba\u4e86\u4e00\u4e9b TCP \u7684\u95ee\u9898\uff0c\u5728\u67e5\u9605\u300aLinux \u670d\u52a1\u5668\u9ad8\u6027\u80fd\u7f16\u7a0b\u300b\u8fd9\u672c\u4e66\u7684\u65f6\u5019\uff0c\u53d1\u73b0\u4e66\u4e0a\u5199\u4e86\u8fd9\u4e48\u4e00\u53e5\u8bdd\uff1a</p> <p></p> <p>\u4e66\u4e0a\u8bf4\uff0c\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u5728\u6536\u5230\u76f8\u540c\u56db\u5143\u7ec4\u7684 SYN \u540e\uff0c\u4f1a\u56de RST \u62a5\u6587\uff0c\u5bf9\u65b9\u6536\u5230\u540e\u5c31\u4f1a\u65ad\u5f00\u8fde\u63a5\u3002</p> <p>\u4e66\u4e2d\u4f5c\u8005\u53ea\u662f\u63d0\u4e86\u8fd9\u4e48\u4e00\u53e5\u8bdd\uff0c\u6ca1\u6709\u7ed9\u4e88\u6e90\u7801\u6216\u8005\u6293\u5305\u56fe\u7684\u8bc1\u636e\u3002</p> <p>\u8d77\u521d\uff0c\u6211\u770b\u5230\u4e5f\u89c9\u5f97\u8fd9\u4e2a\u903b\u8f91\u4e5f\u633a\u7b26\u5408\u5e38\u7406\u7684\uff0c\u4f46\u662f\u5f53\u6211\u81ea\u5df1\u53bb\u5543\u4e86 TCP \u6e90\u7801\u540e\uff0c\u53d1\u73b0\u5e76\u4e0d\u662f\u8fd9\u6837\u7684\u3002</p> <p>\u6240\u4ee5\uff0c\u4eca\u5929\u5c31\u6765\u8ba8\u8bba\u4e0b\u8fd9\u4e2a\u95ee\u9898\uff0c\u300c\u5728 TCP \u6b63\u5e38\u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u6536\u5230\u76f8\u540c\u56db\u5143\u7ec4\u7684 SYN \u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f\u300d</p> <p>\u95ee\u9898\u73b0\u8c61\u5982\u4e0b\u56fe\uff0c\u5de6\u8fb9\u662f\u670d\u52a1\u7aef\uff0c\u53f3\u8fb9\u662f\u5ba2\u6237\u7aef\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/time_wait_recv_syn/#_1","title":"\u5148\u8bf4\u7ed3\u8bba","text":"<p>\u5728\u8ddf\u5927\u5bb6\u5206\u6790 TCP \u6e90\u7801\u524d\uff0c\u6211\u5148\u8ddf\u5927\u5bb6\u76f4\u63a5\u8bf4\u4e0b\u7ed3\u8bba\u3002</p> <p>\u9488\u5bf9\u8fd9\u4e2a\u95ee\u9898\uff0c\u5173\u952e\u662f\u8981\u770b SYN \u7684\u300c\u5e8f\u5217\u53f7\u548c\u65f6\u95f4\u6233\u300d\u662f\u5426\u5408\u6cd5\uff0c\u56e0\u4e3a\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u6536\u5230 SYN \u540e\uff0c\u4f1a\u5224\u65ad SYN \u7684\u300c\u5e8f\u5217\u53f7\u548c\u65f6\u95f4\u6233\u300d\u662f\u5426\u5408\u6cd5\uff0c\u7136\u540e\u6839\u636e\u5224\u65ad\u7ed3\u679c\u7684\u4e0d\u540c\u505a\u4e0d\u540c\u7684\u5904\u7406\u3002</p> <p>\u5148\u8ddf\u5927\u5bb6\u8bf4\u660e\u4e0b\uff0c\u4ec0\u4e48\u662f\u300c\u5408\u6cd5\u300d\u7684 SYN\uff1f</p> <ul> <li>\u5408\u6cd5 SYN\uff1a\u5ba2\u6237\u7aef\u7684  SYN \u7684\u300c\u5e8f\u5217\u53f7\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u671f\u671b\u4e0b\u4e00\u4e2a\u6536\u5230\u7684\u5e8f\u5217\u53f7\u300d\u8981\u5927\uff0c\u5e76\u4e14 SYN \u7684\u300c\u65f6\u95f4\u6233\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u6700\u540e\u6536\u5230\u7684\u62a5\u6587\u7684\u65f6\u95f4\u6233\u300d\u8981\u5927\u3002</li> <li>\u975e\u6cd5 SYN\uff1a\u5ba2\u6237\u7aef\u7684  SYN \u7684\u300c\u5e8f\u5217\u53f7\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u671f\u671b\u4e0b\u4e00\u4e2a\u6536\u5230\u7684\u5e8f\u5217\u53f7\u300d\u8981\u5c0f\uff0c\u6216\u8005 SYN \u7684\u300c\u65f6\u95f4\u6233\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u6700\u540e\u6536\u5230\u7684\u62a5\u6587\u7684\u65f6\u95f4\u6233\u300d\u8981\u5c0f\u3002</li> </ul> <p>\u4e0a\u9762 SYN \u5408\u6cd5\u5224\u65ad\u662f\u57fa\u4e8e\u53cc\u65b9\u90fd\u5f00\u542f\u4e86 TCP \u65f6\u95f4\u6233\u673a\u5236\u7684\u573a\u666f\uff0c\u5982\u679c\u53cc\u65b9\u90fd\u6ca1\u6709\u5f00\u542f TCP \u65f6\u95f4\u6233\u673a\u5236\uff0c\u5219 SYN \u5408\u6cd5\u5224\u65ad\u5982\u4e0b\uff1a</p> <ul> <li>\u5408\u6cd5 SYN\uff1a\u5ba2\u6237\u7aef\u7684  SYN \u7684\u300c\u5e8f\u5217\u53f7\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u671f\u671b\u4e0b\u4e00\u4e2a\u6536\u5230\u7684\u5e8f\u5217\u53f7\u300d\u8981\u5927\u3002</li> <li>\u975e\u6cd5 SYN\uff1a\u5ba2\u6237\u7aef\u7684  SYN \u7684\u300c\u5e8f\u5217\u53f7\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u671f\u671b\u4e0b\u4e00\u4e2a\u6536\u5230\u7684\u5e8f\u5217\u53f7\u300d\u8981\u5c0f\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/time_wait_recv_syn/#syn","title":"\u6536\u5230\u5408\u6cd5 SYN","text":"<p>\u5982\u679c\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u6536\u5230\u300c\u5408\u6cd5\u7684 SYN\u300d\u540e\uff0c\u5c31\u4f1a\u91cd\u7528\u6b64\u56db\u5143\u7ec4\u8fde\u63a5\uff0c\u8df3\u8fc7 2MSL \u800c\u8f6c\u53d8\u4e3a SYN_RECV \u72b6\u6001\uff0c\u63a5\u7740\u5c31\u80fd\u8fdb\u884c\u5efa\u7acb\u8fde\u63a5\u8fc7\u7a0b\u3002</p> <p>\u7528\u4e0b\u56fe\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u53cc\u65b9\u90fd\u542f\u7528\u4e86 TCP \u65f6\u95f4\u6233\u673a\u5236\uff0cTSval \u662f\u53d1\u9001\u62a5\u6587\u65f6\u7684\u65f6\u95f4\u6233\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u5728\u6536\u5230\u7b2c\u4e09\u6b21\u6325\u624b\u7684 FIN \u62a5\u6587\u65f6\uff0c\u4f1a\u8bb0\u5f55\u8be5\u62a5\u6587\u7684 TSval\uff0821\uff09\uff0c\u7528 ts_recent \u53d8\u91cf\u4fdd\u5b58\u3002\u7136\u540e\u4f1a\u8ba1\u7b97\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\uff0c\u672c\u6b21\u4f8b\u5b50\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\u5c31\u662f 301\uff0c\u7528 rcv_nxt \u53d8\u91cf\u4fdd\u5b58\u3002</p> <p>\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u6536\u5230 SYN \u540e\uff0c\u56e0\u4e3a SYN \u7684 seq\uff08400\uff09\u5927\u4e8e rcv_nxt\uff08301\uff09\uff0c\u5e76\u4e14 SYN \u7684 TSval\uff0830\uff09\u5927\u4e8e ts_recent\uff0821\uff09\uff0c\u6240\u4ee5\u662f\u4e00\u4e2a\u300c\u5408\u6cd5\u7684 SYN\u300d\uff0c\u4e8e\u662f\u5c31\u4f1a\u91cd\u7528\u6b64\u56db\u5143\u7ec4\u8fde\u63a5\uff0c\u8df3\u8fc7 2MSL \u800c\u8f6c\u53d8\u4e3a SYN_RECV \u72b6\u6001\uff0c\u63a5\u7740\u5c31\u80fd\u8fdb\u884c\u5efa\u7acb\u8fde\u63a5\u8fc7\u7a0b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/time_wait_recv_syn/#syn_1","title":"\u6536\u5230\u975e\u6cd5\u7684 SYN","text":"<p>\u5982\u679c\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u6536\u5230\u300c\u975e\u6cd5\u7684 SYN\u300d\u540e\uff0c\u5c31\u4f1a\u518d\u56de\u590d\u4e00\u4e2a\u7b2c\u56db\u6b21\u6325\u624b\u7684 ACK \u62a5\u6587\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\uff0c\u53d1\u73b0\u5e76\u4e0d\u662f\u81ea\u5df1\u671f\u671b\u6536\u5230\u786e\u8ba4\u53f7\uff08ack num\uff09\uff0c\u5c31\u56de RST \u62a5\u6587\u7ed9\u670d\u52a1\u7aef\u3002</p> <p>\u7528\u4e0b\u56fe\u4f5c\u4e3a\u4f8b\u5b50\uff0c\u53cc\u65b9\u90fd\u542f\u7528\u4e86 TCP \u65f6\u95f4\u6233\u673a\u5236\uff0cTSval \u662f\u53d1\u9001\u62a5\u6587\u65f6\u7684\u65f6\u95f4\u6233\uff1a</p> <p></p> <p>\u4e0a\u56fe\u4e2d\uff0c\u5728\u6536\u5230\u7b2c\u4e09\u6b21\u6325\u624b\u7684 FIN \u62a5\u6587\u65f6\uff0c\u4f1a\u8bb0\u5f55\u8be5\u62a5\u6587\u7684 TSval\uff0821\uff09\uff0c\u7528 ts_recent \u53d8\u91cf\u4fdd\u5b58\u3002\u7136\u540e\u4f1a\u8ba1\u7b97\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\uff0c\u672c\u6b21\u4f8b\u5b50\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\u5c31\u662f 301\uff0c\u7528 rcv_nxt \u53d8\u91cf\u4fdd\u5b58\u3002</p> <p>\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\u6536\u5230 SYN \u540e\uff0c\u56e0\u4e3a SYN \u7684 seq\uff08200\uff09\u5c0f\u4e8e rcv_nxt\uff08301\uff09\uff0c\u6240\u4ee5\u662f\u4e00\u4e2a\u300c\u975e\u6cd5\u7684 SYN\u300d\uff0c\u5c31\u4f1a\u518d\u56de\u590d\u4e00\u4e2a\u4e0e\u7b2c\u56db\u6b21\u6325\u624b\u4e00\u6837\u7684 ACK \u62a5\u6587\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\uff0c\u53d1\u73b0\u5e76\u4e0d\u662f\u81ea\u5df1\u671f\u671b\u6536\u5230\u786e\u8ba4\u53f7\uff0c\u5c31\u56de RST \u62a5\u6587\u7ed9\u670d\u52a1\u7aef\u3002</p> <p>PS\uff1a\u8fd9\u91cc\u5148\u57cb\u4e00\u4e2a\u7591\u95ee\uff0c\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u6536\u5230 RST \u4f1a\u65ad\u5f00\u8fde\u63a5\u5417\uff1f</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/time_wait_recv_syn/#_2","title":"\u6e90\u7801\u5206\u6790","text":"<p>\u4e0b\u9762\u6e90\u7801\u5206\u6790\u662f\u57fa\u4e8e Linux 4.2 \u7248\u672c\u7684\u5185\u6838\u4ee3\u7801\u3002</p> <p>Linux \u5185\u6838\u5728\u6536\u5230 TCP \u62a5\u6587\u540e\uff0c\u4f1a\u6267\u884c <code>tcp_v4_rcv</code> \u51fd\u6570\uff0c\u5728\u8be5\u51fd\u6570\u548c TIME_WAIT \u72b6\u6001\u76f8\u5173\u7684\u4e3b\u8981\u4ee3\u7801\u5982\u4e0b\uff1a</p> C<pre><code>int tcp_v4_rcv(struct sk_buff *skb)\n{\n  struct sock *sk;\n ...\n  //\u6536\u5230\u62a5\u6587\u540e\uff0c\u4f1a\u8c03\u7528\u6b64\u51fd\u6570\uff0c\u67e5\u627e\u5bf9\u5e94\u7684 sock\n sk = __inet_lookup_skb(&amp;tcp_hashinfo, skb, __tcp_hdrlen(th), th-&gt;source,\n          th-&gt;dest, sdif, &amp;refcounted);\n if (!sk)\n  goto no_tcp_socket;\n\nprocess:\n  //\u5982\u679c\u8fde\u63a5\u7684\u72b6\u6001\u4e3a time_wait\uff0c\u4f1a\u8df3\u8f6c\u5230 do_time_wait\n if (sk-&gt;sk_state == TCP_TIME_WAIT)\n  goto do_time_wait;\n\n...\n\ndo_time_wait:\n  ...\n  //\u7531 tcp_timewait_state_process \u51fd\u6570\u5904\u7406\u5728 time_wait \u72b6\u6001\u6536\u5230\u7684\u62a5\u6587\n switch (tcp_timewait_state_process(inet_twsk(sk), skb, th)) {\n    // \u5982\u679c\u662f TCP_TW_SYN\uff0c\u90a3\u4e48\u5141\u8bb8\u6b64 SYN \u91cd\u5efa\u8fde\u63a5\n    // \u5373\u5141\u8bb8 TIM_WAIT \u72b6\u6001\u8dc3\u8fc1\u5230 SYN_RECV\n    case TCP_TW_SYN: {\n      struct sock *sk2 = inet_lookup_listener(....);\n      if (sk2) {\n          ....\n          goto process;\n      }\n    }\n    // \u5982\u679c\u662f TCP_TW_ACK\uff0c\u90a3\u4e48\uff0c\u8fd4\u56de\u8bb0\u5fc6\u4e2d\u7684 ACK\n    case TCP_TW_ACK:\n      tcp_v4_timewait_ack(sk, skb);\n      break;\n    // \u5982\u679c\u662f TCP_TW_RST \u76f4\u63a5\u53d1\u9001 RESET \u5305\n    case TCP_TW_RST:\n      tcp_v4_send_reset(sk, skb);\n      inet_twsk_deschedule_put(inet_twsk(sk));\n      goto discard_it;\n     // \u5982\u679c\u662f TCP_TW_SUCCESS \u5219\u76f4\u63a5\u4e22\u5f03\u6b64\u5305\uff0c\u4e0d\u505a\u4efb\u4f55\u54cd\u5e94\n    case TCP_TW_SUCCESS:;\n }\n goto discard_it;\n}\n</code></pre> <p>\u8be5\u4ee3\u7801\u7684\u8fc7\u7a0b\uff1a</p> <ol> <li>\u63a5\u6536\u5230\u62a5\u6587\u540e\uff0c\u4f1a\u8c03\u7528 <code>__inet_lookup_skb()</code> \u51fd\u6570\u67e5\u627e\u5bf9\u5e94\u7684 sock \u7ed3\u6784\uff1b</li> <li>\u5982\u679c\u8fde\u63a5\u7684\u72b6\u6001\u662f <code>TIME_WAIT</code>\uff0c\u4f1a\u8df3\u8f6c\u5230 do_time_wait \u5904\u7406\uff1b</li> <li>\u7531 <code>tcp_timewait_state_process()</code> \u51fd\u6570\u6765\u5904\u7406\u6536\u5230\u7684\u62a5\u6587\uff0c\u5904\u7406\u540e\u6839\u636e\u8fd4\u56de\u503c\u6765\u505a\u76f8\u5e94\u7684\u5904\u7406\u3002</li> </ol> <p>\u5148\u8ddf\u5927\u5bb6\u8bf4\u4e0b\uff0c\u5982\u679c\u6536\u5230\u7684 SYN \u662f\u5408\u6cd5\u7684\uff0c<code>tcp_timewait_state_process()</code> \u51fd\u6570\u5c31\u4f1a\u8fd4\u56de <code>TCP_TW_SYN</code>\uff0c\u7136\u540e\u91cd\u7528\u6b64\u8fde\u63a5\u3002\u5982\u679c\u6536\u5230\u7684 SYN \u662f\u975e\u6cd5\u7684\uff0c<code>tcp_timewait_state_process()</code> \u51fd\u6570\u5c31\u4f1a\u8fd4\u56de <code>TCP_TW_ACK</code>\uff0c\u7136\u540e\u4f1a\u56de\u4e0a\u6b21\u53d1\u8fc7\u7684 ACK\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u770b <code>tcp_timewait_state_process()</code> \u51fd\u6570\u662f\u5982\u4f55\u5224\u65ad SYN \u5305\u7684\u3002</p> C<pre><code>enum tcp_tw_status\ntcp_timewait_state_process(struct inet_timewait_sock *tw, struct sk_buff *skb,\n      const struct tcphdr *th)\n{\n ...\n  //paws_reject \u4e3a false\uff0c\u8868\u793a\u6ca1\u6709\u53d1\u751f\u65f6\u95f4\u6233\u56de\u7ed5\n  //paws_reject \u4e3a true\uff0c\u8868\u793a\u53d1\u751f\u4e86\u65f6\u95f4\u6233\u56de\u7ed5\n bool paws_reject = false;\n\n tmp_opt.saw_tstamp = 0;\n  //TCP \u5934\u4e2d\u6709\u9009\u9879\u4e14\u65e7\u8fde\u63a5\u5f00\u542f\u4e86\u65f6\u95f4\u6233\u9009\u9879\n if (th-&gt;doff &gt; (sizeof(*th) &gt;&gt; 2) &amp;&amp; tcptw-&gt;tw_ts_recent_stamp) { \n  //\u89e3\u6790\u9009\u9879\n    tcp_parse_options(twsk_net(tw), skb, &amp;tmp_opt, 0, NULL);\n\n  if (tmp_opt.saw_tstamp) {\n   ...\n      //\u68c0\u67e5\u6536\u5230\u7684\u62a5\u6587\u7684\u65f6\u95f4\u6233\u662f\u5426\u53d1\u751f\u4e86\u65f6\u95f4\u6233\u56de\u7ed5\n   paws_reject = tcp_paws_reject(&amp;tmp_opt, th-&gt;rst);\n  }\n }\n\n....\n\n  //\u662f SYN \u5305\u3001\u6ca1\u6709 RST\u3001\u6ca1\u6709 ACK\u3001\u65f6\u95f4\u6233\u6ca1\u6709\u56de\u7ed5\uff0c\u5e76\u4e14\u5e8f\u5217\u53f7\u4e5f\u6ca1\u6709\u56de\u7ed5\uff0c\n if (th-&gt;syn &amp;&amp; !th-&gt;rst &amp;&amp; !th-&gt;ack &amp;&amp; !paws_reject &amp;&amp;\n     (after(TCP_SKB_CB(skb)-&gt;seq, tcptw-&gt;tw_rcv_nxt) ||\n      (tmp_opt.saw_tstamp &amp;&amp; //\u65b0\u8fde\u63a5\u5f00\u542f\u4e86\u65f6\u95f4\u6233\n       (s32)(tcptw-&gt;tw_ts_recent - tmp_opt.rcv_tsval) &lt; 0))) { //\u65f6\u95f4\u6233\u6ca1\u6709\u56de\u7ed5\n    // \u521d\u59cb\u5316\u5e8f\u5217\u53f7\n    u32 isn = tcptw-&gt;tw_snd_nxt + 65535 + 2; \n    if (isn == 0)\n      isn++;\n    TCP_SKB_CB(skb)-&gt;tcp_tw_isn = isn;\n    return TCP_TW_SYN; //\u5141\u8bb8\u91cd\u7528 TIME_WAIT \u56db\u5143\u7ec4\u91cd\u65b0\u5efa\u7acb\u8fde\u63a5\n }\n\n\n if (!th-&gt;rst) {\n    // \u5982\u679c\u65f6\u95f4\u6233\u56de\u7ed5\uff0c\u6216\u8005\u62a5\u6587\u91cc\u5305\u542b ack\uff0c\u5219\u5c06 TIMEWAIT \u72b6\u6001\u7684\u6301\u7eed\u65f6\u95f4\u91cd\u65b0\u5ef6\u957f\n  if (paws_reject || th-&gt;ack)\n    inet_twsk_schedule(tw, &amp;tcp_death_row, TCP_TIMEWAIT_LEN,\n        TCP_TIMEWAIT_LEN);\n\n     // \u8fd4\u56de TCP_TW_ACK, \u53d1\u9001\u4e0a\u4e00\u6b21\u7684 ACK\n    return TCP_TW_ACK;\n }\n inet_twsk_put(tw);\n return TCP_TW_SUCCESS;\n}\n</code></pre> <p>\u5982\u679c\u53cc\u65b9\u542f\u7528\u4e86 TCP \u65f6\u95f4\u6233\u673a\u5236\uff0c\u5c31\u4f1a\u901a\u8fc7 <code>tcp_paws_reject()</code> \u51fd\u6570\u6765\u5224\u65ad\u65f6\u95f4\u6233\u662f\u5426\u53d1\u751f\u4e86\u56de\u7ed5\uff0c\u4e5f\u5c31\u662f\u300c\u5f53\u524d\u6536\u5230\u7684\u62a5\u6587\u7684\u65f6\u95f4\u6233\u300d\u662f\u5426\u5927\u4e8e\u300c\u4e0a\u4e00\u6b21\u6536\u5230\u7684\u62a5\u6587\u7684\u65f6\u95f4\u6233\u300d\uff1a</p> <ul> <li>\u5982\u679c\u5927\u4e8e\uff0c\u5c31\u8bf4\u660e\u6ca1\u6709\u53d1\u751f\u65f6\u95f4\u6233\u7ed5\u56de\uff0c\u51fd\u6570\u8fd4\u56de false\u3002</li> <li>\u5982\u679c\u5c0f\u4e8e\uff0c\u5c31\u8bf4\u660e\u53d1\u751f\u4e86\u65f6\u95f4\u6233\u56de\u7ed5\uff0c\u51fd\u6570\u8fd4\u56de true\u3002</li> </ul> <p>\u4ece\u6e90\u7801\u53ef\u4ee5\u770b\u5230\uff0c\u5f53\u6536\u5230 SYN \u5305\u540e\uff0c\u5982\u679c\u8be5 SYN \u5305\u7684\u65f6\u95f4\u6233\u6ca1\u6709\u53d1\u751f\u56de\u7ed5\uff0c\u4e5f\u5c31\u662f\u65f6\u95f4\u6233\u662f\u9012\u589e\u7684\uff0c\u5e76\u4e14 SYN \u5305\u7684\u5e8f\u5217\u53f7\u4e5f\u6ca1\u6709\u53d1\u751f\u56de\u7ed5\uff0c\u4e5f\u5c31\u662f SYN \u7684\u5e8f\u5217\u53f7\u300c\u5927\u4e8e\u300d\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\u3002\u5c31\u4f1a\u521d\u59cb\u5316\u4e00\u4e2a\u5e8f\u5217\u53f7\uff0c\u7136\u540e\u8fd4\u56de TCP_TW_SYN\uff0c\u63a5\u7740\u5c31\u91cd\u7528\u8be5\u8fde\u63a5\uff0c\u4e5f\u5c31\u8df3\u8fc7 2MSL \u800c\u8f6c\u53d8\u4e3a SYN_RECV \u72b6\u6001\uff0c\u63a5\u7740\u5c31\u80fd\u8fdb\u884c\u5efa\u7acb\u8fde\u63a5\u8fc7\u7a0b\u3002</p> <p>\u5982\u679c\u53cc\u65b9\u90fd\u6ca1\u6709\u542f\u7528 TCP \u65f6\u95f4\u6233\u673a\u5236\uff0c\u5c31\u53ea\u9700\u8981\u5224\u65ad SYN \u5305\u7684\u5e8f\u5217\u53f7\u6709\u6ca1\u6709\u53d1\u751f\u56de\u7ed5\uff0c\u5982\u679c SYN \u7684\u5e8f\u5217\u53f7\u5927\u4e8e\u4e0b\u4e00\u6b21\u671f\u671b\u6536\u5230\u7684\u5e8f\u5217\u53f7\uff0c\u5c31\u53ef\u4ee5\u8df3\u8fc7 2MSL\uff0c\u91cd\u7528\u8be5\u8fde\u63a5\u3002</p> <p>\u5982\u679c SYN \u5305\u662f\u975e\u6cd5\u7684\uff0c\u5c31\u4f1a\u8fd4\u56de TCP_TW_ACK\uff0c\u63a5\u7740\u5c31\u4f1a\u53d1\u9001\u4e0e\u4e0a\u4e00\u6b21\u4e00\u6837\u7684 ACK \u7ed9\u5bf9\u65b9\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/time_wait_recv_syn/#time_wait-rst","title":"\u5728 TIME_WAIT \u72b6\u6001\uff0c\u6536\u5230 RST \u4f1a\u65ad\u5f00\u8fde\u63a5\u5417\uff1f","text":"<p>\u5728\u524d\u9762\u6211\u7559\u4e86\u4e00\u4e2a\u7591\u95ee\uff0c\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u6536\u5230 RST \u4f1a\u65ad\u5f00\u8fde\u63a5\u5417\uff1f</p> <p>\u4f1a\u4e0d\u4f1a\u65ad\u5f00\uff0c\u5173\u952e\u770b <code>net.ipv4.tcp_rfc1337</code> \u8fd9\u4e2a\u5185\u6838\u53c2\u6570\uff08\u9ed8\u8ba4\u60c5\u51b5\u662f\u4e3a 0\uff09\uff1a</p> <ul> <li>\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a 0\uff0c\u6536\u5230 RST \u62a5\u6587\u4f1a\u63d0\u524d\u7ed3\u675f TIME_WAIT \u72b6\u6001\uff0c\u91ca\u653e\u8fde\u63a5\u3002</li> <li>\u5982\u679c\u8fd9\u4e2a\u53c2\u6570\u8bbe\u7f6e\u4e3a 1\uff0c\u5c31\u4f1a\u4e22\u6389 RST \u62a5\u6587\u3002</li> </ul> <p>\u6e90\u7801\u5904\u7406\u5982\u4e0b\uff1a</p> C<pre><code>enum tcp_tw_status\ntcp_timewait_state_process(struct inet_timewait_sock *tw, struct sk_buff *skb,\n      const struct tcphdr *th)\n{\n....\n  //rst \u62a5\u6587\u7684\u65f6\u95f4\u6233\u6ca1\u6709\u53d1\u751f\u56de\u7ed5\n if (!paws_reject &amp;&amp;\n     (TCP_SKB_CB(skb)-&gt;seq == tcptw-&gt;tw_rcv_nxt &amp;&amp;\n      (TCP_SKB_CB(skb)-&gt;seq == TCP_SKB_CB(skb)-&gt;end_seq || th-&gt;rst))) {\n\n      //\u5904\u7406 rst \u62a5\u6587\n      if (th-&gt;rst) {\n        //\u4e0d\u5f00\u542f\u8fd9\u4e2a\u9009\u9879\uff0c\u5f53\u6536\u5230 RST \u65f6\u4f1a\u7acb\u5373\u56de\u6536 tw\uff0c\u4f46\u8fd9\u6837\u505a\u662f\u6709\u98ce\u9669\u7684\n        if (twsk_net(tw)-&gt;ipv4.sysctl_tcp_rfc1337 == 0) {\n          kill:\n          //\u5220\u9664 tw \u5b9a\u65f6\u5668\uff0c\u5e76\u91ca\u653e tw\n          inet_twsk_deschedule_put(tw);\n          return TCP_TW_SUCCESS;\n        }\n      } else {\n        //\u5c06 TIMEWAIT \u72b6\u6001\u7684\u6301\u7eed\u65f6\u95f4\u91cd\u65b0\u5ef6\u957f\n        inet_twsk_reschedule(tw, TCP_TIMEWAIT_LEN);\n      }\n\n      ...\n      return TCP_TW_SUCCESS;\n    }\n}\n</code></pre> <p>TIME_WAIT \u72b6\u6001\u6536\u5230 RST \u62a5\u6587\u800c\u91ca\u653e\u8fde\u63a5\uff0c\u8fd9\u6837\u7b49\u4e8e\u8df3\u8fc7 2MSL \u65f6\u95f4\uff0c\u8fd9\u4e48\u505a\u8fd8\u662f\u6709\u98ce\u9669\u3002</p> <p>sysctl_tcp_rfc1337 \u8fd9\u4e2a\u53c2\u6570\u662f\u5728 rfc 1337 \u6587\u6863\u63d0\u51fa\u6765\u7684\uff0c\u76ee\u7684\u662f\u907f\u514d\u56e0\u4e3a TIME_WAIT \u72b6\u6001\u6536\u5230 RST \u62a5\u6587\u800c\u8df3\u8fc7  2MSL \u7684\u65f6\u95f4\uff0c\u6587\u6863\u91cc\u4e5f\u7ed9\u51fa\u8df3\u8fc7  2MSL \u65f6\u95f4\u4f1a\u6709\u4ec0\u4e48\u6f5c\u5728\u95ee\u9898\u3002</p> <p>TIME_WAIT \u72b6\u6001\u4e4b\u6240\u4ee5\u8981\u6301\u7eed 2MSL \u65f6\u95f4\uff0c\u4e3b\u8981\u6709\u4e24\u4e2a\u76ee\u7684\uff1a</p> <ul> <li>\u9632\u6b62\u5386\u53f2\u8fde\u63a5\u4e2d\u7684\u6570\u636e\uff0c\u88ab\u540e\u9762\u76f8\u540c\u56db\u5143\u7ec4\u7684\u8fde\u63a5\u9519\u8bef\u7684\u63a5\u6536\uff1b</li> <li>\u4fdd\u8bc1\u300c\u88ab\u52a8\u5173\u95ed\u8fde\u63a5\u300d\u7684\u4e00\u65b9\uff0c\u80fd\u88ab\u6b63\u786e\u7684\u5173\u95ed\uff1b</li> </ul> <p>\u8be6\u7ec6\u7684\u4e3a\u4ec0\u4e48\u8981\u8bbe\u8ba1 TIME_WAIT \u72b6\u6001\uff0c\u6211\u5728\u8fd9\u7bc7\u6709\u8be6\u7ec6\u8bf4\u660e\uff1a\u5982\u679c TIME_WAIT \u72b6\u6001\u6301\u7eed\u65f6\u95f4\u8fc7\u77ed\u6216\u8005\u6ca1\u6709\uff0c\u4f1a\u6709\u4ec0\u4e48\u95ee\u9898\uff1f</p> <p>\u867d\u7136 TIME_WAIT \u72b6\u6001\u6301\u7eed\u7684\u65f6\u95f4\u662f\u6709\u4e00\u70b9\u957f\uff0c\u663e\u5f97\u5f88\u4e0d\u53cb\u597d\uff0c\u4f46\u662f\u5b83\u88ab\u8bbe\u8ba1\u6765\u5c31\u662f\u7528\u6765\u907f\u514d\u53d1\u751f\u4e71\u4e03\u516b\u7cdf\u7684\u4e8b\u60c5\u3002</p> <p>\u300aUNIX \u7f51\u7edc\u7f16\u7a0b\u300b\u4e00\u4e66\u4e2d\u5374\u8bf4\u9053\uff1aTIME_WAIT \u662f\u6211\u4eec\u7684\u670b\u53cb\uff0c\u5b83\u662f\u6709\u52a9\u4e8e\u6211\u4eec\u7684\uff0c\u4e0d\u8981\u8bd5\u56fe\u907f\u514d\u8fd9\u4e2a\u72b6\u6001\uff0c\u800c\u662f\u5e94\u8be5\u5f04\u6e05\u695a\u5b83\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4e2a\u4eba\u89c9\u5f97\u5c06 <code>net.ipv4.tcp_rfc1337</code> \u8bbe\u7f6e\u4e3a 1 \u4f1a\u6bd4\u8f83\u5b89\u5168\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/3_tcp/time_wait_recv_syn/#_3","title":"\u603b\u7ed3","text":"<p>\u5728 TCP \u6b63\u5e38\u6325\u624b\u8fc7\u7a0b\u4e2d\uff0c\u5904\u4e8e TIME_WAIT \u72b6\u6001\u7684\u8fde\u63a5\uff0c\u6536\u5230\u76f8\u540c\u56db\u5143\u7ec4\u7684 SYN \u540e\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</p> <p>\u5982\u679c\u53cc\u65b9\u5f00\u542f\u4e86\u65f6\u95f4\u6233\u673a\u5236\uff1a</p> <ul> <li>\u5982\u679c\u5ba2\u6237\u7aef\u7684  SYN \u7684\u300c\u5e8f\u5217\u53f7\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u671f\u671b\u4e0b\u4e00\u4e2a\u6536\u5230\u7684\u5e8f\u5217\u53f7\u300d\u8981\u5927\uff0c\u5e76\u4e14SYN \u7684\u300c\u65f6\u95f4\u6233\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u6700\u540e\u6536\u5230\u7684\u62a5\u6587\u7684\u65f6\u95f4\u6233\u300d\u8981\u5927\u3002\u90a3\u4e48\u5c31\u4f1a\u91cd\u7528\u8be5\u56db\u5143\u7ec4\u8fde\u63a5\uff0c\u8df3\u8fc7 2MSL \u800c\u8f6c\u53d8\u4e3a SYN_RECV \u72b6\u6001\uff0c\u63a5\u7740\u5c31\u80fd\u8fdb\u884c\u5efa\u7acb\u8fde\u63a5\u8fc7\u7a0b\u3002</li> <li>\u5982\u679c\u5ba2\u6237\u7aef\u7684  SYN \u7684\u300c\u5e8f\u5217\u53f7\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u671f\u671b\u4e0b\u4e00\u4e2a\u6536\u5230\u7684\u5e8f\u5217\u53f7\u300d\u8981\u5c0f\uff0c\u6216\u8005SYN \u7684\u300c\u65f6\u95f4\u6233\u300d\u6bd4\u670d\u52a1\u7aef\u300c\u6700\u540e\u6536\u5230\u7684\u62a5\u6587\u7684\u65f6\u95f4\u6233\u300d\u8981\u5c0f\u3002\u90a3\u4e48\u5c31\u4f1a\u518d\u56de\u590d\u4e00\u4e2a\u7b2c\u56db\u6b21\u6325\u624b\u7684 ACK \u62a5\u6587\uff0c\u5ba2\u6237\u7aef\u6536\u5230\u540e\uff0c\u53d1\u73b0\u5e76\u4e0d\u662f\u81ea\u5df1\u671f\u671b\u6536\u5230\u786e\u8ba4\u53f7\uff0c\u5c31\u56de RST \u62a5\u6587\u7ed9\u670d\u52a1\u7aef\u3002</li> </ul> <p>\u5728 TIME_WAIT \u72b6\u6001\uff0c\u6536\u5230 RST \u4f1a\u65ad\u5f00\u8fde\u63a5\u5417\uff1f</p> <ul> <li>\u5982\u679c <code>net.ipv4.tcp_rfc1337</code> \u53c2\u6570\u4e3a 0\uff0c\u5219\u63d0\u524d\u7ed3\u675f TIME_WAIT \u72b6\u6001\uff0c\u91ca\u653e\u8fde\u63a5\u3002</li> <li>\u5982\u679c <code>net.ipv4.tcp_rfc1337</code> \u53c2\u6570\u4e3a 1\uff0c\u5219\u4f1a\u4e22\u6389\u8be5 RST \u62a5\u6587\u3002</li> </ul> <p>\u5b8c\uff01</p> <p>\u6700\u65b0\u7684\u56fe\u89e3\u6587\u7ae0\u90fd\u5728\u516c\u4f17\u53f7\u9996\u53d1\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u54e6\uff01\uff01\u5982\u679c\u4f60\u60f3\u52a0\u5165\u767e\u4eba\u6280\u672f\u4ea4\u6d41\u7fa4\uff0c\u626b\u7801\u4e0b\u65b9\u4e8c\u7ef4\u7801\u56de\u590d\u300c\u52a0\u7fa4\u300d\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/","title":"5.1 IP \u57fa\u7840\u77e5\u8bc6\u5168\u5bb6\u6876","text":"<p>\u524d\u6bb5\u65f6\u95f4\uff0c\u6709\u8bfb\u8005\u5e0c\u671b\u6211\u5199\u4e00\u7bc7\u5173\u4e8e IP \u5206\u7c7b\u5730\u5740\u3001\u5b50\u7f51\u5212\u5206\u7b49\u7684\u6587\u7ae0\uff0c\u4ed6\u53cd\u9988\u5e38\u5e38\u6df7\u6dc6\uff0c\u6478\u4e0d\u7740\u5934\u8111\u3002</p> <p>\u90a3\u4e48\uff0c\u8bf4\u6765\u5c31\u6765\uff01\u800c\u4e14\u8981\u76d8\u5c31\u76d8\u5168\u4e00\u70b9\uff0c\u987a\u4fbf\u6311\u6218\u4e0b\u5c0f\u6797\u7684\u56fe\u89e3\u529f\u529b\uff0c\u6240\u4ee5\u5c31\u6765\u4e2a IP \u57fa\u7840\u77e5\u8bc6\u5168\u5bb6\u6876\u3002</p> <p>\u5403\u5b8c\u8fd9\u4e2a IP \u57fa\u7840\u77e5\u8bc6\u5168\u5bb6\u6876\uff0c\u5305\u4f60\u6491\u7740\u809a\u5b50\u558a\u51fa\uff1a\u201c\u771f\u9999\uff01\u201d</p> <p>\u4e0d\u591a\u8bf4\uff0c\u76f4\u63a5\u4e0a\u83dc\uff0c\u5171\u5206\u4e3a\u4e09\u9053\u83dc\uff1a</p> <ul> <li>\u9996\u5148\u662f\u524d\u83dc\u300cIP \u57fa\u672c\u8ba4\u8bc6\u300d</li> <li>\u5176\u6b21\u662f\u4e3b\u83dc\u300cIP \u5730\u5740\u7684\u57fa\u7840\u77e5\u8bc6\u300d</li> <li>\u6700\u540e\u662f\u70b9\u5fc3\u300cIP \u534f\u8bae\u76f8\u5173\u6280\u672f\u300d</li> </ul> <p></p> <p>\u4e3a\u5565\u8981\u6bd4\u55bb\u6210\u83dc\uff1f\u56e0\u4e3a\u5c0f\u6797\u662f\u83dc\u72d7\uff08\u62bc\u97f5\u4e0d\uff1f\uff09</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#ip","title":"\u524d\u83dc \u2014\u2014 IP \u57fa\u672c\u8ba4\u8bc6","text":"<p>IP \u5728 TCP/IP \u53c2\u8003\u6a21\u578b\u4e2d\u5904\u4e8e\u7b2c\u4e09\u5c42\uff0c\u4e5f\u5c31\u662f\u7f51\u7edc\u5c42\u3002</p> <p>\u7f51\u7edc\u5c42\u7684\u4e3b\u8981\u4f5c\u7528\u662f\uff1a\u5b9e\u73b0\u4e3b\u673a\u4e0e\u4e3b\u673a\u4e4b\u95f4\u7684\u901a\u4fe1\uff0c\u4e5f\u53eb\u70b9\u5bf9\u70b9\uff08end to end\uff09\u901a\u4fe1\u3002</p> <p></p> <p>\u7f51\u7edc\u5c42\u4e0e\u6570\u636e\u94fe\u8def\u5c42\u6709\u4ec0\u4e48\u5173\u7cfb\u5462\uff1f</p> <p>\u6709\u7684\u5c0f\u4f19\u4f34\u5206\u4e0d\u6e05 IP\uff08\u7f51\u7edc\u5c42\uff09\u548c MAC\uff08\u6570\u636e\u94fe\u8def\u5c42\uff09\u4e4b\u95f4\u7684\u533a\u522b\u548c\u5173\u7cfb\u3002</p> <p>\u5176\u5b9e\u5f88\u5bb9\u6613\u533a\u5206\uff0c\u5728\u4e0a\u9762\u6211\u4eec\u77e5\u9053 IP \u7684\u4f5c\u7528\u662f\u4e3b\u673a\u4e4b\u95f4\u901a\u4fe1\u7528\u7684\uff0c\u800c MAC \u7684\u4f5c\u7528\u5219\u662f\u5b9e\u73b0\u300c\u76f4\u8fde\u300d\u7684\u4e24\u4e2a\u8bbe\u5907\u4e4b\u95f4\u901a\u4fe1\uff0c\u800c IP \u5219\u8d1f\u8d23\u5728\u300c\u6ca1\u6709\u76f4\u8fde\u300d\u7684\u4e24\u4e2a\u7f51\u7edc\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u4f20\u8f93\u3002</p> <p>\u4e3e\u4e2a\u751f\u6d3b\u7684\u6817\u5b50\uff0c\u5c0f\u6797\u8981\u53bb\u4e00\u4e2a\u5f88\u8fdc\u7684\u5730\u65b9\u65c5\u884c\uff0c\u5236\u5b9a\u4e86\u4e00\u4e2a\u884c\u7a0b\u8868\uff0c\u5176\u95f4\u9700\u5148\u540e\u4e58\u5750\u98de\u673a\u3001\u5730\u94c1\u3001\u516c\u4ea4\u8f66\u624d\u80fd\u62b5\u8fbe\u76ee\u7684\u5730\uff0c\u4e3a\u6b64\u5c0f\u6797\u9700\u8981\u4e70\u98de\u673a\u7968\uff0c\u5730\u94c1\u7968\u7b49\u3002</p> <p>\u98de\u673a\u7968\u548c\u5730\u94c1\u7968\u90fd\u662f\u53bb\u5f80\u7279\u5b9a\u7684\u5730\u70b9\u7684\uff0c\u6bcf\u5f20\u7968\u53ea\u80fd\u591f\u5728\u67d0\u4e00\u9650\u5b9a\u533a\u95f4\u5185\u79fb\u52a8\uff0c\u6b64\u5904\u7684\u300c\u533a\u95f4\u5185\u300d\u5c31\u5982\u540c\u901a\u4fe1\u7f51\u7edc\u4e2d\u6570\u636e\u94fe\u8def\u3002</p> <p>\u5728\u533a\u95f4\u5185\u79fb\u52a8\u76f8\u5f53\u4e8e\u6570\u636e\u94fe\u8def\u5c42\uff0c\u5145\u5f53\u533a\u95f4\u5185\u4e24\u4e2a\u8282\u70b9\u4f20\u8f93\u7684\u529f\u80fd\uff0c\u533a\u95f4\u5185\u7684\u51fa\u53d1\u70b9\u597d\u6bd4\u6e90 MAC \u5730\u5740\uff0c\u76ee\u6807\u5730\u70b9\u597d\u6bd4\u76ee\u7684 MAC \u5730\u5740\u3002</p> <p>\u6574\u4e2a\u65c5\u6e38\u884c\u7a0b\u8868\u5c31\u76f8\u5f53\u4e8e\u7f51\u7edc\u5c42\uff0c\u5145\u5f53\u8fdc\u7a0b\u5b9a\u4f4d\u7684\u529f\u80fd\uff0c\u884c\u7a0b\u7684\u5f00\u59cb\u597d\u6bd4\u6e90 IP\uff0c\u884c\u7a0b\u7684\u7ec8\u70b9\u597d\u6bd4\u76ee\u7684 IP \u5730\u5740\u3002</p> <p></p> <p>\u5982\u679c\u5c0f\u6797\u53ea\u6709\u884c\u7a0b\u8868\u800c\u6ca1\u6709\u8f66\u7968\uff0c\u5c31\u65e0\u6cd5\u642d\u4e58\u4ea4\u901a\u5de5\u5177\u5230\u8fbe\u76ee\u7684\u5730\u3002\u76f8\u53cd\uff0c\u5982\u679c\u9664\u4e86\u8f66\u7968\u800c\u6ca1\u6709\u884c\u7a0b\u8868\uff0c\u6050\u6015\u4e5f\u5f88\u96be\u5230\u8fbe\u76ee\u7684\u5730\u3002\u56e0\u4e3a\u5c0f\u6797\u4e0d\u77e5\u9053\u8be5\u5750\u4ec0\u4e48\u8f66\uff0c\u4e5f\u4e0d\u77e5\u9053\u8be5\u5728\u54ea\u91cc\u6362\u4e58\u3002</p> <p>\u56e0\u6b64\uff0c\u53ea\u6709\u4e24\u8005\u517c\u5907\uff0c\u65e2\u6709\u67d0\u4e2a\u533a\u95f4\u7684\u8f66\u7968\u53c8\u6709\u6574\u4e2a\u65c5\u884c\u7684\u884c\u7a0b\u8868\uff0c\u624d\u80fd\u4fdd\u8bc1\u5230\u8fbe\u76ee\u7684\u5730\u3002\u4e0e\u6b64\u7c7b\u4f3c\uff0c\u8ba1\u7b97\u673a\u7f51\u7edc\u4e2d\u4e5f\u9700\u8981\u300c\u6570\u636e\u94fe\u8def\u5c42\u300d\u548c\u300c\u7f51\u7edc\u5c42\u300d\u8fd9\u4e2a\u5206\u5c42\u624d\u80fd\u5b9e\u73b0\u5411\u6700\u7ec8\u76ee\u6807\u5730\u5740\u7684\u901a\u4fe1\u3002</p> <p>\u8fd8\u6709\u91cd\u8981\u4e00\u70b9\uff0c\u65c5\u884c\u9014\u4e2d\u6211\u4eec\u867d\u7136\u4e0d\u65ad\u53d8\u5316\u4e86\u4ea4\u901a\u5de5\u5177\uff0c\u4f46\u662f\u65c5\u884c\u884c\u7a0b\u7684\u8d77\u59cb\u5730\u5740\u548c\u76ee\u7684\u5730\u5740\u59cb\u7ec8\u90fd\u6ca1\u53d8\u3002\u5176\u5b9e\uff0c\u5728\u7f51\u7edc\u4e2d\u6570\u636e\u5305\u4f20\u8f93\u4e2d\u4e5f\u662f\u5982\u6b64\uff0c\u6e90 IP \u5730\u5740\u548c\u76ee\u6807 IP \u5730\u5740\u5728\u4f20\u8f93\u8fc7\u7a0b\u4e2d\u662f\u4e0d\u4f1a\u53d8\u5316\u7684\uff0c\u53ea\u6709\u6e90 MAC \u5730\u5740\u548c\u76ee\u6807 MAC \u4e00\u76f4\u5728\u53d8\u5316\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#ip_1","title":"\u4e3b\u83dc \u2014\u2014 IP \u5730\u5740\u7684\u57fa\u7840\u77e5\u8bc6","text":"<p>\u5728 TCP/IP \u7f51\u7edc\u901a\u4fe1\u65f6\uff0c\u4e3a\u4e86\u4fdd\u8bc1\u80fd\u6b63\u5e38\u901a\u4fe1\uff0c\u6bcf\u4e2a\u8bbe\u5907\u90fd\u9700\u8981\u914d\u7f6e\u6b63\u786e\u7684 IP \u5730\u5740\uff0c\u5426\u5219\u65e0\u6cd5\u5b9e\u73b0\u6b63\u5e38\u7684\u901a\u4fe1\u3002</p> <p>IP \u5730\u5740\uff08IPv4 \u5730\u5740\uff09\u7531 <code>32</code> \u4f4d\u6b63\u6574\u6570\u6765\u8868\u793a\uff0cIP \u5730\u5740\u5728\u8ba1\u7b97\u673a\u662f\u4ee5\u4e8c\u8fdb\u5236\u7684\u65b9\u5f0f\u5904\u7406\u7684\u3002</p> <p>\u800c\u4eba\u7c7b\u4e3a\u4e86\u65b9\u4fbf\u8bb0\u5fc6\u91c7\u7528\u4e86\u70b9\u5206\u5341\u8fdb\u5236\u7684\u6807\u8bb0\u65b9\u5f0f\uff0c\u4e5f\u5c31\u662f\u5c06 32 \u4f4d IP \u5730\u5740\u4ee5\u6bcf 8 \u4f4d\u4e3a\u7ec4\uff0c\u5171\u5206\u4e3a <code>4</code> \u7ec4\uff0c\u6bcf\u7ec4\u4ee5\u300c<code>.</code>\u300d\u9694\u5f00\uff0c\u518d\u5c06\u6bcf\u7ec4\u8f6c\u6362\u6210\u5341\u8fdb\u5236\u3002</p> <p></p> <p>\u90a3\u4e48\uff0cIP \u5730\u5740\u6700\u5927\u503c\u4e5f\u5c31\u662f</p> <p></p> <p>\u4e5f\u5c31\u8bf4\uff0c\u6700\u5927\u5141\u8bb8 43 \u4ebf\u53f0\u8ba1\u7b97\u673a\u8fde\u63a5\u5230\u7f51\u7edc\u3002</p> <p>\u5b9e\u9645\u4e0a\uff0cIP \u5730\u5740\u5e76\u4e0d\u662f\u6839\u636e\u4e3b\u673a\u53f0\u6570\u6765\u914d\u7f6e\u7684\uff0c\u800c\u662f\u4ee5\u7f51\u5361\u3002\u50cf\u670d\u52a1\u5668\u3001\u8def\u7531\u5668\u7b49\u8bbe\u5907\u90fd\u662f\u6709 2 \u4e2a\u4ee5\u4e0a\u7684\u7f51\u5361\uff0c\u4e5f\u5c31\u662f\u5b83\u4eec\u4f1a\u6709 2 \u4e2a\u4ee5\u4e0a\u7684 IP \u5730\u5740\u3002</p> <p></p> <p>\u56e0\u6b64\uff0c\u8ba9 43 \u4ebf\u53f0\u8ba1\u7b97\u673a\u5168\u90e8\u8fde\u7f51\u5176\u5b9e\u662f\u4e0d\u53ef\u80fd\u7684\uff0c\u66f4\u4f55\u51b5 IP \u5730\u5740\u662f\u7531\u300c\u7f51\u7edc\u6807\u8bc6\u300d\u548c\u300c\u4e3b\u673a\u6807\u8bc6\u300d\u8fd9\u4e24\u4e2a\u90e8\u5206\u7ec4\u6210\u7684\uff0c\u6240\u4ee5\u5b9e\u9645\u80fd\u591f\u8fde\u63a5\u5230\u7f51\u7edc\u7684\u8ba1\u7b97\u673a\u4e2a\u6570\u66f4\u662f\u5c11\u4e86\u5f88\u591a\u3002</p> <p>\u53ef\u80fd\u6709\u7684\u5c0f\u4f19\u4f34\u63d0\u51fa\u4e86\u7591\u95ee\uff0c\u73b0\u5728\u4e0d\u4ec5\u7535\u8111\u914d\u4e86 IP\uff0c\u624b\u673a\u3001IPad \u7b49\u7535\u5b50\u8bbe\u5907\u90fd\u914d\u4e86 IP \u5440\uff0c\u7167\u7406\u6765\u8bf4\u80af\u5b9a\u4f1a\u8d85\u8fc7 43 \u4ebf\u5566\uff0c\u90a3\u662f\u600e\u4e48\u80fd\u591f\u652f\u6301\u8fd9\u4e48\u591a IP \u7684\u5462\uff1f</p> <p>\u56e0\u4e3a\u4f1a\u6839\u636e\u4e00\u79cd\u53ef\u4ee5\u66f4\u6362 IP \u5730\u5740\u7684\u6280\u672f <code>NAT</code>\uff0c\u4f7f\u5f97\u53ef\u8fde\u63a5\u8ba1\u7b97\u673a\u6570\u8d85\u8fc7 43 \u4ebf\u53f0\u3002 <code>NAT</code> \u6280\u672f\u540e\u7eed\u4f1a\u8fdb\u4e00\u6b65\u8ba8\u8bba\u548c\u8bf4\u660e\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#ip_2","title":"IP \u5730\u5740\u7684\u5206\u7c7b","text":"<p>\u4e92\u8054\u7f51\u8bde\u751f\u4e4b\u521d\uff0cIP \u5730\u5740\u663e\u5f97\u5f88\u5145\u88d5\uff0c\u4e8e\u662f\u8ba1\u7b97\u673a\u79d1\u5b66\u5bb6\u4eec\u8bbe\u8ba1\u4e86\u5206\u7c7b\u5730\u5740\u3002</p> <p>IP \u5730\u5740\u5206\u7c7b\u6210\u4e86 5 \u79cd\u7c7b\u578b\uff0c\u5206\u522b\u662f A \u7c7b\u3001B \u7c7b\u3001C \u7c7b\u3001D \u7c7b\u3001E \u7c7b\u3002</p> <p></p> <p>\u4e0a\u56fe\u4e2d\u9ec4\u8272\u90e8\u5206\u4e3a\u5206\u7c7b\u53f7\uff0c\u7528\u4ee5\u533a\u5206 IP \u5730\u5740\u7c7b\u522b\u3002</p> <p>\u4ec0\u4e48\u662f A\u3001B\u3001C \u7c7b\u5730\u5740\uff1f</p> <p>\u5176\u4e2d\u5bf9\u4e8e A\u3001B\u3001C \u7c7b\u4e3b\u8981\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff0c\u5206\u522b\u662f\u7f51\u7edc\u53f7\u548c\u4e3b\u673a\u53f7\u3002\u8fd9\u5f88\u597d\u7406\u89e3\uff0c\u597d\u6bd4\u5c0f\u6797\u662f A \u5c0f\u533a 1 \u680b 101 \u53f7\uff0c\u4f60\u662f B \u5c0f\u533a 1 \u680b 101 \u53f7\u3002</p> <p>\u6211\u4eec\u53ef\u4ee5\u7528\u4e0b\u9762\u8fd9\u4e2a\u8868\u683c\uff0c\u5c31\u80fd\u5f88\u6e05\u695a\u7684\u77e5\u9053 A\u3001B\u3001C \u5206\u7c7b\u5bf9\u5e94\u7684\u5730\u5740\u8303\u56f4\u3001\u6700\u5927\u4e3b\u673a\u4e2a\u6570\u3002</p> <p></p> <p>A\u3001B\u3001C \u5206\u7c7b\u5730\u5740\u6700\u5927\u4e3b\u673a\u4e2a\u6570\u662f\u5982\u4f55\u8ba1\u7b97\u7684\u5462\uff1f</p> <p>\u6700\u5927\u4e3b\u673a\u4e2a\u6570\uff0c\u5c31\u662f\u8981\u770b\u4e3b\u673a\u53f7\u7684\u4f4d\u6570\uff0c\u5982 C \u7c7b\u5730\u5740\u7684\u4e3b\u673a\u53f7\u5360 8 \u4f4d\uff0c\u90a3\u4e48 C \u7c7b\u5730\u5740\u7684\u6700\u5927\u4e3b\u673a\u4e2a\u6570\uff1a</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u8981\u51cf 2 \u5462\uff1f</p> <p>\u56e0\u4e3a\u5728 IP \u5730\u5740\u4e2d\uff0c\u6709\u4e24\u4e2a IP \u662f\u7279\u6b8a\u7684\uff0c\u5206\u522b\u662f\u4e3b\u673a\u53f7\u5168\u4e3a 1 \u548c \u5168\u4e3a 0 \u5730\u5740\u3002</p> <p></p> <ul> <li>\u4e3b\u673a\u53f7\u5168\u4e3a 1 \u6307\u5b9a\u67d0\u4e2a\u7f51\u7edc\u4e0b\u7684\u6240\u6709\u4e3b\u673a\uff0c\u7528\u4e8e\u5e7f\u64ad</li> <li>\u4e3b\u673a\u53f7\u5168\u4e3a 0 \u6307\u5b9a\u67d0\u4e2a\u7f51\u7edc</li> </ul> <p>\u56e0\u6b64\uff0c\u5728\u5206\u914d\u8fc7\u7a0b\u4e2d\uff0c\u5e94\u8be5\u53bb\u6389\u8fd9\u4e24\u79cd\u60c5\u51b5\u3002</p> <p>\u5e7f\u64ad\u5730\u5740\u7528\u4e8e\u4ec0\u4e48\uff1f</p> <p>\u5e7f\u64ad\u5730\u5740\u7528\u4e8e\u5728\u540c\u4e00\u4e2a\u94fe\u8def\u4e2d\u76f8\u4e92\u8fde\u63a5\u7684\u4e3b\u673a\u4e4b\u95f4\u53d1\u9001\u6570\u636e\u5305\u3002</p> <p>\u5b66\u6821\u73ed\u7ea7\u4e2d\u5c31\u6709\u5e7f\u64ad\u7684\u4f8b\u5b50\uff0c\u5728\u51c6\u5907\u4e0a\u8bfe\u7684\u65f6\u5019\uff0c\u901a\u5e38\u73ed\u957f\u4f1a\u558a\uff1a\u201c\u4e0a\u8bfe\uff0c\u5168\u4f53\u8d77\u7acb\uff01\u201d\uff0c\u73ed\u91cc\u7684\u540c\u5b66\u542c\u5230\u8fd9\u53e5\u8bdd\u662f\u4e0d\u662f\u5168\u90e8\u90fd\u7ad9\u8d77\u6765\u4e86\uff1f\u8fd9\u4e2a\u53e5\u8bdd\u5c31\u6709\u5e7f\u64ad\u7684\u542b\u4e49\u3002</p> <p>\u5f53\u4e3b\u673a\u53f7\u5168\u4e3a 1 \u65f6\uff0c\u5c31\u8868\u793a\u8be5\u7f51\u7edc\u7684\u5e7f\u64ad\u5730\u5740\u3002\u4f8b\u5982\u628a <code>172.20.0.0/16</code> \u7528\u4e8c\u8fdb\u5236\u8868\u793a\u5982\u4e0b\uff1a</p> <p>10101100.00010100.00000000.00000000</p> <p>\u5c06\u8fd9\u4e2a\u5730\u5740\u7684\u4e3b\u673a\u90e8\u5206\u5168\u90e8\u6539\u4e3a 1\uff0c\u5219\u5f62\u6210\u5e7f\u64ad\u5730\u5740\uff1a</p> <p>10101100.00010100.<code>11111111.11111111</code></p> <p>\u518d\u5c06\u8fd9\u4e2a\u5730\u5740\u7528\u5341\u8fdb\u5236\u8868\u793a\uff0c\u5219\u4e3a <code>172.20.255.255</code>\u3002</p> <p>\u5e7f\u64ad\u5730\u5740\u53ef\u4ee5\u5206\u4e3a\u672c\u5730\u5e7f\u64ad\u548c\u76f4\u63a5\u5e7f\u64ad\u4e24\u79cd\u3002</p> <ul> <li>\u5728\u672c\u7f51\u7edc\u5185\u5e7f\u64ad\u7684\u53eb\u505a\u672c\u5730\u5e7f\u64ad\u3002\u4f8b\u5982\u7f51\u7edc\u5730\u5740\u4e3a 192.168.0.0/24 \u7684\u60c5\u51b5\u4e0b\uff0c\u5e7f\u64ad\u5730\u5740\u662f 192.168.0.255\u3002\u56e0\u4e3a\u8fd9\u4e2a\u5e7f\u64ad\u5730\u5740\u7684 IP \u5305\u4f1a\u88ab\u8def\u7531\u5668\u5c4f\u853d\uff0c\u6240\u4ee5\u4e0d\u4f1a\u5230\u8fbe 192.168.0.0/24 \u4ee5\u5916\u7684\u5176\u4ed6\u94fe\u8def\u4e0a\u3002</li> <li>\u5728\u4e0d\u540c\u7f51\u7edc\u4e4b\u95f4\u7684\u5e7f\u64ad\u53eb\u505a\u76f4\u63a5\u5e7f\u64ad\u3002\u4f8b\u5982\u7f51\u7edc\u5730\u5740\u4e3a 192.168.0.0/24 \u7684\u4e3b\u673a\u5411 192.168.1.255/24 \u7684\u76ee\u6807\u5730\u5740\u53d1\u9001 IP \u5305\u3002\u6536\u5230\u8fd9\u4e2a\u5305\u7684\u8def\u7531\u5668\uff0c\u5c06\u6570\u636e\u8f6c\u53d1\u7ed9 192.168.1.0/24\uff0c\u4ece\u800c\u4f7f\u5f97\u6240\u6709 192.168.1.1~192.168.1.254 \u7684\u4e3b\u673a\u90fd\u80fd\u6536\u5230\u8fd9\u4e2a\u5305\uff08\u7531\u4e8e\u76f4\u63a5\u5e7f\u64ad\u6709\u4e00\u5b9a\u7684\u5b89\u5168\u95ee\u9898\uff0c\u591a\u6570\u60c5\u51b5\u4e0b\u4f1a\u5728\u8def\u7531\u5668\u4e0a\u8bbe\u7f6e\u4e3a\u4e0d\u8f6c\u53d1\u3002\uff09 \u3002</li> </ul> <p></p> <p>\u4ec0\u4e48\u662f D\u3001E \u7c7b\u5730\u5740\uff1f</p> <p>\u800c D \u7c7b\u548c E \u7c7b\u5730\u5740\u662f\u6ca1\u6709\u4e3b\u673a\u53f7\u7684\uff0c\u6240\u4ee5\u4e0d\u53ef\u7528\u4e8e\u4e3b\u673a IP\uff0cD \u7c7b\u5e38\u88ab\u7528\u4e8e\u591a\u64ad\uff0cE \u7c7b\u662f\u9884\u7559\u7684\u5206\u7c7b\uff0c\u6682\u65f6\u672a\u4f7f\u7528\u3002</p> <p></p> <p>\u591a\u64ad\u5730\u5740\u7528\u4e8e\u4ec0\u4e48\uff1f</p> <p>\u591a\u64ad\u7528\u4e8e\u5c06\u5305\u53d1\u9001\u7ed9\u7279\u5b9a\u7ec4\u5185\u7684\u6240\u6709\u4e3b\u673a\u3002</p> <p>\u8fd8\u662f\u4e3e\u73ed\u7ea7\u7684\u6817\u5b50\uff0c\u8001\u5e08\u8bf4\uff1a\u201c\u6700\u540e\u4e00\u6392\u7684\u540c\u5b66\uff0c\u4e0a\u6765\u505a\u8fd9\u9053\u6570\u5b66\u9898\u3002\u201d\uff0c\u8001\u5e08\u6307\u5b9a\u7684\u662f\u6700\u540e\u4e00\u6392\u7684\u540c\u5b66\uff0c\u4e5f\u5c31\u662f\u591a\u64ad\u7684\u542b\u4e49\u4e86\u3002</p> <p>\u7531\u4e8e\u5e7f\u64ad\u65e0\u6cd5\u7a7f\u900f\u8def\u7531\uff0c\u82e5\u60f3\u7ed9\u5176\u4ed6\u7f51\u6bb5\u53d1\u9001\u540c\u6837\u7684\u5305\uff0c\u5c31\u53ef\u4ee5\u4f7f\u7528\u53ef\u4ee5\u7a7f\u900f\u8def\u7531\u7684\u591a\u64ad\u3002</p> <p></p> <p>\u591a\u64ad\u4f7f\u7528\u7684 D \u7c7b\u5730\u5740\uff0c\u5176\u524d\u56db\u4f4d\u662f <code>1110</code> \u5c31\u8868\u793a\u662f\u591a\u64ad\u5730\u5740\uff0c\u800c\u5269\u4e0b\u7684 28 \u4f4d\u662f\u591a\u64ad\u7684\u7ec4\u7f16\u53f7\u3002</p> <p>\u4ece 224.0.0.0 ~ 239.255.255.255 \u90fd\u662f\u591a\u64ad\u7684\u53ef\u7528\u8303\u56f4\uff0c\u5176\u5212\u5206\u4e3a\u4ee5\u4e0b\u4e09\u7c7b\uff1a</p> <ul> <li>224.0.0.0 ~ 224.0.0.255 \u4e3a\u9884\u7559\u7684\u7ec4\u64ad\u5730\u5740\uff0c\u53ea\u80fd\u5728\u5c40\u57df\u7f51\u4e2d\uff0c\u8def\u7531\u5668\u662f\u4e0d\u4f1a\u8fdb\u884c\u8f6c\u53d1\u7684\u3002</li> <li>224.0.1.0 ~ 238.255.255.255  \u4e3a\u7528\u6237\u53ef\u7528\u7684\u7ec4\u64ad\u5730\u5740\uff0c\u53ef\u4ee5\u7528\u4e8e Internet \u4e0a\u3002</li> <li>239.0.0.0 ~ 239.255.255.255 \u4e3a\u672c\u5730\u7ba1\u7406\u7ec4\u64ad\u5730\u5740\uff0c\u53ef\u4f9b\u5185\u90e8\u7f51\u5728\u5185\u90e8\u4f7f\u7528\uff0c\u4ec5\u5728\u7279\u5b9a\u7684\u672c\u5730\u8303\u56f4\u5185\u6709\u6548\u3002</li> </ul> <p>IP \u5206\u7c7b\u7684\u4f18\u70b9</p> <p>\u4e0d\u7ba1\u662f\u8def\u7531\u5668\u8fd8\u662f\u4e3b\u673a\u89e3\u6790\u5230\u4e00\u4e2a IP \u5730\u5740\u65f6\u5019\uff0c\u6211\u4eec\u5224\u65ad\u5176 IP \u5730\u5740\u7684\u9996\u4f4d\u662f\u5426\u4e3a 0\uff0c\u4e3a 0 \u5219\u4e3a A \u7c7b\u5730\u5740\uff0c\u90a3\u4e48\u5c31\u80fd\u5f88\u5feb\u7684\u627e\u51fa\u7f51\u7edc\u5730\u5740\u548c\u4e3b\u673a\u5730\u5740\u3002</p> <p>\u5176\u4f59\u5206\u7c7b\u5224\u65ad\u65b9\u5f0f\u53c2\u8003\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u6240\u4ee5\uff0c\u8fd9\u79cd\u5206\u7c7b\u5730\u5740\u7684\u4f18\u70b9\u5c31\u662f\u7b80\u5355\u660e\u4e86\u3001\u9009\u8def\uff08\u57fa\u4e8e\u7f51\u7edc\u5730\u5740\uff09\u7b80\u5355\u3002</p> <p>IP \u5206\u7c7b\u7684\u7f3a\u70b9</p> <p>\u7f3a\u70b9\u4e00</p> <p>\u540c\u4e00\u7f51\u7edc\u4e0b\u6ca1\u6709\u5730\u5740\u5c42\u6b21\uff0c\u6bd4\u5982\u4e00\u4e2a\u516c\u53f8\u91cc\u7528\u4e86 B \u7c7b\u5730\u5740\uff0c\u4f46\u662f\u53ef\u80fd\u9700\u8981\u6839\u636e\u751f\u4ea7\u73af\u5883\u3001\u6d4b\u8bd5\u73af\u5883\u3001\u5f00\u53d1\u73af\u5883\u6765\u5212\u5206\u5730\u5740\u5c42\u6b21\uff0c\u800c\u8fd9\u79cd IP \u5206\u7c7b\u662f\u6ca1\u6709\u5730\u5740\u5c42\u6b21\u5212\u5206\u7684\u529f\u80fd\uff0c\u6240\u4ee5\u8fd9\u5c31\u7f3a\u5c11\u5730\u5740\u7684\u7075\u6d3b\u6027\u3002</p> <p>\u7f3a\u70b9\u4e8c</p> <p>A\u3001B\u3001C \u7c7b\u6709\u4e2a\u5c34\u5c2c\u5904\u5883\uff0c\u5c31\u662f\u4e0d\u80fd\u5f88\u597d\u7684\u4e0e\u73b0\u5b9e\u7f51\u7edc\u5339\u914d\u3002</p> <ul> <li>C \u7c7b\u5730\u5740\u80fd\u5305\u542b\u7684\u6700\u5927\u4e3b\u673a\u6570\u91cf\u5b9e\u5728\u592a\u5c11\u4e86\uff0c\u53ea\u6709 254 \u4e2a\uff0c\u4f30\u8ba1\u4e00\u4e2a\u7f51\u5427\u90fd\u4e0d\u591f\u7528\u3002</li> <li>\u800c B \u7c7b\u5730\u5740\u80fd\u5305\u542b\u7684\u6700\u5927\u4e3b\u673a\u6570\u91cf\u53c8\u592a\u591a\u4e86\uff0c6 \u4e07\u591a\u53f0\u673a\u5668\u653e\u5728\u4e00\u4e2a\u7f51\u7edc\u4e0b\u9762\uff0c\u4e00\u822c\u7684\u4f01\u4e1a\u57fa\u672c\u8fbe\u4e0d\u5230\u8fd9\u4e2a\u89c4\u6a21\uff0c\u95f2\u7740\u7684\u5730\u5740\u5c31\u662f\u6d6a\u8d39\u3002</li> </ul> <p>\u8fd9\u4e24\u4e2a\u7f3a\u70b9\uff0c\u90fd\u53ef\u4ee5\u5728 <code>CIDR</code> \u65e0\u5206\u7c7b\u5730\u5740\u89e3\u51b3\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#cidr","title":"\u65e0\u5206\u7c7b\u5730\u5740 CIDR","text":"<p>\u6b63\u56e0\u4e3a IP \u5206\u7c7b\u5b58\u5728\u8bb8\u591a\u7f3a\u70b9\uff0c\u6240\u4ee5\u540e\u9762\u63d0\u51fa\u4e86\u65e0\u5206\u7c7b\u5730\u5740\u7684\u65b9\u6848\uff0c\u5373 <code>CIDR</code>\u3002</p> <p>\u8fd9\u79cd\u65b9\u5f0f\u4e0d\u518d\u6709\u5206\u7c7b\u5730\u5740\u7684\u6982\u5ff5\uff0c32 \u6bd4\u7279\u7684 IP \u5730\u5740\u88ab\u5212\u5206\u4e3a\u4e24\u90e8\u5206\uff0c\u524d\u9762\u662f\u7f51\u7edc\u53f7\uff0c\u540e\u9762\u662f\u4e3b\u673a\u53f7\u3002</p> <p>\u600e\u4e48\u5212\u5206\u7f51\u7edc\u53f7\u548c\u4e3b\u673a\u53f7\u7684\u5462\uff1f</p> <p>\u8868\u793a\u5f62\u5f0f <code>a.b.c.d/x</code>\uff0c\u5176\u4e2d <code>/x</code> \u8868\u793a\u524d x \u4f4d\u5c5e\u4e8e\u7f51\u7edc\u53f7\uff0cx \u7684\u8303\u56f4\u662f <code>0 ~ 32</code>\uff0c\u8fd9\u5c31\u4f7f\u5f97 IP \u5730\u5740\u66f4\u52a0\u5177\u6709\u7075\u6d3b\u6027\u3002</p> <p>\u6bd4\u5982 10.100.122.2/24\uff0c\u8fd9\u79cd\u5730\u5740\u8868\u793a\u5f62\u5f0f\u5c31\u662f CIDR\uff0c/24 \u8868\u793a\u524d 24 \u4f4d\u662f\u7f51\u7edc\u53f7\uff0c\u5269\u4f59\u7684 8 \u4f4d\u662f\u4e3b\u673a\u53f7\u3002</p> <p></p> <p>\u8fd8\u6709\u53e6\u4e00\u79cd\u5212\u5206\u7f51\u7edc\u53f7\u4e0e\u4e3b\u673a\u53f7\u5f62\u5f0f\uff0c\u90a3\u5c31\u662f\u5b50\u7f51\u63a9\u7801\uff0c\u63a9\u7801\u7684\u610f\u601d\u5c31\u662f\u63a9\u76d6\u6389\u4e3b\u673a\u53f7\uff0c\u5269\u4f59\u7684\u5c31\u662f\u7f51\u7edc\u53f7\u3002</p> <p>\u5c06\u5b50\u7f51\u63a9\u7801\u548c IP \u5730\u5740\u6309\u4f4d\u8ba1\u7b97 AND\uff0c\u5c31\u53ef\u5f97\u5230\u7f51\u7edc\u53f7\u3002</p> <p></p> <p>\u4e3a\u4ec0\u4e48\u8981\u5206\u79bb\u7f51\u7edc\u53f7\u548c\u4e3b\u673a\u53f7\uff1f</p> <p>\u56e0\u4e3a\u4e24\u53f0\u8ba1\u7b97\u673a\u8981\u901a\u8baf\uff0c\u9996\u5148\u8981\u5224\u65ad\u662f\u5426\u5904\u4e8e\u540c\u4e00\u4e2a\u5e7f\u64ad\u57df\u5185\uff0c\u5373\u7f51\u7edc\u5730\u5740\u662f\u5426\u76f8\u540c\u3002\u5982\u679c\u7f51\u7edc\u5730\u5740\u76f8\u540c\uff0c\u8868\u660e\u63a5\u53d7\u65b9\u5728\u672c\u7f51\u7edc\u4e0a\uff0c\u90a3\u4e48\u53ef\u4ee5\u628a\u6570\u636e\u5305\u76f4\u63a5\u53d1\u9001\u5230\u76ee\u6807\u4e3b\u673a\u3002</p> <p>\u8def\u7531\u5668\u5bfb\u5740\u5de5\u4f5c\u4e2d\uff0c\u4e5f\u5c31\u662f\u901a\u8fc7\u8fd9\u6837\u7684\u65b9\u5f0f\u6765\u627e\u5230\u5bf9\u5e94\u7684\u7f51\u7edc\u53f7\u7684\uff0c\u8fdb\u800c\u628a\u6570\u636e\u5305\u8f6c\u53d1\u7ed9\u5bf9\u5e94\u7684\u7f51\u7edc\u5185\u3002</p> <p></p> <p>\u600e\u4e48\u8fdb\u884c\u5b50\u7f51\u5212\u5206\uff1f</p> <p>\u5728\u4e0a\u9762\u6211\u4eec\u77e5\u9053\u53ef\u4ee5\u901a\u8fc7\u5b50\u7f51\u63a9\u7801\u5212\u5206\u51fa\u7f51\u7edc\u53f7\u548c\u4e3b\u673a\u53f7\uff0c\u90a3\u5b9e\u9645\u4e0a\u5b50\u7f51\u63a9\u7801\u8fd8\u6709\u4e00\u4e2a\u4f5c\u7528\uff0c\u90a3\u5c31\u662f\u5212\u5206\u5b50\u7f51\u3002</p> <p>\u5b50\u7f51\u5212\u5206\u5b9e\u9645\u4e0a\u662f\u5c06\u4e3b\u673a\u5730\u5740\u5206\u4e3a\u4e24\u4e2a\u90e8\u5206\uff1a\u5b50\u7f51\u7f51\u7edc\u5730\u5740\u548c\u5b50\u7f51\u4e3b\u673a\u5730\u5740\u3002\u5f62\u5f0f\u5982\u4e0b\uff1a</p> <p></p> <ul> <li>\u672a\u505a\u5b50\u7f51\u5212\u5206\u7684 ip \u5730\u5740\uff1a\u7f51\u7edc\u5730\u5740\uff0b\u4e3b\u673a\u5730\u5740</li> <li>\u505a\u5b50\u7f51\u5212\u5206\u540e\u7684 ip \u5730\u5740\uff1a\u7f51\u7edc\u5730\u5740\uff0b\uff08\u5b50\u7f51\u7f51\u7edc\u5730\u5740\uff0b\u5b50\u7f51\u4e3b\u673a\u5730\u5740\uff09</li> </ul> <p>\u5047\u8bbe\u5bf9 C \u7c7b\u5730\u5740\u8fdb\u884c\u5b50\u7f51\u5212\u5206\uff0c\u7f51\u7edc\u5730\u5740 192.168.1.0\uff0c\u4f7f\u7528\u5b50\u7f51\u63a9\u7801 255.255.255.192 \u5bf9\u5176\u8fdb\u884c\u5b50\u7f51\u5212\u5206\u3002</p> <p>C \u7c7b\u5730\u5740\u4e2d\u524d 24 \u4f4d\u662f\u7f51\u7edc\u53f7\uff0c\u6700\u540e 8 \u4f4d\u662f\u4e3b\u673a\u53f7\uff0c\u6839\u636e\u5b50\u7f51\u63a9\u7801\u53ef\u77e5\u4ece 8 \u4f4d\u4e3b\u673a\u53f7\u4e2d\u501f\u7528 2 \u4f4d\u4f5c\u4e3a\u5b50\u7f51\u53f7\u3002</p> <p></p> <p>\u7531\u4e8e\u5b50\u7f51\u7f51\u7edc\u5730\u5740\u88ab\u5212\u5206\u6210 2 \u4f4d\uff0c\u90a3\u4e48\u5b50\u7f51\u5730\u5740\u5c31\u6709 4 \u4e2a\uff0c\u5206\u522b\u662f 00\u300101\u300110\u300111\uff0c\u5177\u4f53\u5212\u5206\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5212\u5206\u540e\u7684 4 \u4e2a\u5b50\u7f51\u5982\u4e0b\u8868\u683c\uff1a</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#ip-ip","title":"\u516c\u6709 IP \u5730\u5740\u4e0e\u79c1\u6709 IP \u5730\u5740","text":"<p>\u5728 A\u3001B\u3001C \u5206\u7c7b\u5730\u5740\uff0c\u5b9e\u9645\u4e0a\u6709\u5206\u516c\u6709 IP \u5730\u5740\u548c\u79c1\u6709 IP \u5730\u5740\u3002</p> <p></p> <p>\u5e73\u65f6\u6211\u4eec\u529e\u516c\u5ba4\u3001\u5bb6\u91cc\u3001\u5b66\u6821\u7528\u7684 IP \u5730\u5740\uff0c\u4e00\u822c\u90fd\u662f\u79c1\u6709 IP \u5730\u5740\u3002\u56e0\u4e3a\u8fd9\u4e9b\u5730\u5740\u5141\u8bb8\u7ec4\u7ec7\u5185\u90e8\u7684 IT \u4eba\u5458\u81ea\u5df1\u7ba1\u7406\u3001\u81ea\u5df1\u5206\u914d\uff0c\u800c\u4e14\u53ef\u4ee5\u91cd\u590d\u3002\u56e0\u6b64\uff0c\u4f60\u5b66\u6821\u7684\u67d0\u4e2a\u79c1\u6709 IP \u5730\u5740\u548c\u6211\u5b66\u6821\u7684\u53ef\u4ee5\u662f\u4e00\u6837\u7684\u3002</p> <p>\u5c31\u50cf\u6bcf\u4e2a\u5c0f\u533a\u90fd\u6709\u81ea\u5df1\u7684\u697c\u7f16\u53f7\u548c\u95e8\u724c\u53f7\uff0c\u4f60\u5c0f\u533a\u5bb6\u53ef\u4ee5\u53eb  1 \u680b 101 \u53f7\uff0c\u6211\u5c0f\u533a\u5bb6\u4e5f\u53ef\u4ee5\u53eb 1 \u680b 101\uff0c\u6ca1\u6709\u4efb\u4f55\u95ee\u9898\u3002\u4f46\u4e00\u65e6\u51fa\u4e86\u5c0f\u533a\uff0c\u5c31\u9700\u8981\u5e26\u4e0a\u4e2d\u5c71\u8def 666 \u53f7\uff08\u516c\u7f51 IP \u5730\u5740\uff09\uff0c\u662f\u56fd\u5bb6\u7edf\u4e00\u5206\u914d\u7684\uff0c\u4e0d\u80fd\u4e24\u4e2a\u5c0f\u533a\u90fd\u53eb\u4e2d\u5c71\u8def 666\u3002</p> <p>\u6240\u4ee5\uff0c\u516c\u6709 IP \u5730\u5740\u662f\u6709\u4e2a\u7ec4\u7ec7\u7edf\u4e00\u5206\u914d\u7684\uff0c\u5047\u8bbe\u4f60\u8981\u5f00\u4e00\u4e2a\u535a\u5ba2\u7f51\u7ad9\uff0c\u90a3\u4e48\u4f60\u5c31\u9700\u8981\u53bb\u7533\u8bf7\u8d2d\u4e70\u4e00\u4e2a\u516c\u6709 IP\uff0c\u8fd9\u6837\u5168\u4e16\u754c\u7684\u4eba\u624d\u80fd\u8bbf\u95ee\u3002\u5e76\u4e14\u516c\u6709 IP \u5730\u5740\u57fa\u672c\u4e0a\u8981\u5728\u6574\u4e2a\u4e92\u8054\u7f51\u8303\u56f4\u5185\u4fdd\u6301\u552f\u4e00\u3002</p> <p></p> <p>\u516c\u6709 IP \u5730\u5740\u7531\u8c01\u7ba1\u7406\u5462\uff1f</p> <p>\u79c1\u6709 IP \u5730\u5740\u901a\u5e38\u662f\u5185\u90e8\u7684 IT \u4eba\u5458\u7ba1\u7406\uff0c\u516c\u6709 IP \u5730\u5740\u662f\u7531 <code>ICANN</code> \u7ec4\u7ec7\u7ba1\u7406\uff0c\u4e2d\u6587\u53eb\u300c\u4e92\u8054\u7f51\u540d\u79f0\u4e0e\u6570\u5b57\u5730\u5740\u5206\u914d\u673a\u6784\u300d\u3002</p> <p>IANA \u662f ICANN \u7684\u5176\u4e2d\u4e00\u4e2a\u673a\u6784\uff0c\u5b83\u8d1f\u8d23\u5206\u914d\u4e92\u8054\u7f51 IP \u5730\u5740\uff0c\u662f\u6309\u6d32\u7684\u65b9\u5f0f\u5c42\u5c42\u5206\u914d\u3002</p> <p></p> <ul> <li>ARIN \u5317\u7f8e\u5730\u533a</li> <li>LACNIC \u62c9\u4e01\u7f8e\u6d32\u548c\u4e00\u4e9b\u52a0\u52d2\u6bd4\u7fa4\u5c9b</li> <li>RIPE NCC \u6b27\u6d32\u3001\u4e2d\u4e1c\u548c\u4e2d\u4e9a</li> <li>AfriNIC \u975e\u6d32\u5730\u533a</li> <li>APNIC \u4e9a\u592a\u5730\u533a</li> </ul> <p>\u5176\u4e2d\uff0c\u5728\u4e2d\u56fd\u662f\u7531 CNNIC \u7684\u673a\u6784\u8fdb\u884c\u7ba1\u7406\uff0c\u5b83\u662f\u4e2d\u56fd\u56fd\u5185\u552f\u4e00\u6307\u5b9a\u7684\u5168\u5c40 IP \u5730\u5740\u7ba1\u7406\u7684\u7ec4\u7ec7\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#ip_3","title":"IP \u5730\u5740\u4e0e\u8def\u7531\u63a7\u5236","text":"<p>IP \u5730\u5740\u7684\u7f51\u7edc\u5730\u5740\u8fd9\u4e00\u90e8\u5206\u662f\u7528\u4e8e\u8fdb\u884c\u8def\u7531\u63a7\u5236\u3002</p> <p>\u8def\u7531\u63a7\u5236\u8868\u4e2d\u8bb0\u5f55\u7740\u7f51\u7edc\u5730\u5740\u4e0e\u4e0b\u4e00\u6b65\u5e94\u8be5\u53d1\u9001\u81f3\u8def\u7531\u5668\u7684\u5730\u5740\u3002\u5728\u4e3b\u673a\u548c\u8def\u7531\u5668\u4e0a\u90fd\u4f1a\u6709\u5404\u81ea\u7684\u8def\u7531\u5668\u63a7\u5236\u8868\u3002</p> <p>\u5728\u53d1\u9001 IP \u5305\u65f6\uff0c\u9996\u5148\u8981\u786e\u5b9a IP \u5305\u9996\u90e8\u4e2d\u7684\u76ee\u6807\u5730\u5740\uff0c\u518d\u4ece\u8def\u7531\u63a7\u5236\u8868\u4e2d\u627e\u5230\u4e0e\u8be5\u5730\u5740\u5177\u6709\u76f8\u540c\u7f51\u7edc\u5730\u5740\u7684\u8bb0\u5f55\uff0c\u6839\u636e\u8be5\u8bb0\u5f55\u5c06 IP \u5305\u8f6c\u53d1\u7ed9\u76f8\u5e94\u7684\u4e0b\u4e00\u4e2a\u8def\u7531\u5668\u3002\u5982\u679c\u8def\u7531\u63a7\u5236\u8868\u4e2d\u5b58\u5728\u591a\u6761\u76f8\u540c\u7f51\u7edc\u5730\u5740\u7684\u8bb0\u5f55\uff0c\u5c31\u9009\u62e9\u76f8\u540c\u4f4d\u6570\u6700\u591a\u7684\u7f51\u7edc\u5730\u5740\uff0c\u4e5f\u5c31\u662f\u6700\u957f\u5339\u914d\u3002</p> <p>\u4e0b\u9762\u4ee5\u4e0b\u56fe\u7684\u7f51\u7edc\u94fe\u8def\u4f5c\u4e3a\u4f8b\u5b50\u8bf4\u660e\uff1a</p> <p></p> <ol> <li>\u4e3b\u673a A \u8981\u53d1\u9001\u4e00\u4e2a IP \u5305\uff0c\u5176\u6e90\u5730\u5740\u662f <code>10.1.1.30</code> \u548c\u76ee\u6807\u5730\u5740\u662f <code>10.1.2.10</code>\uff0c\u7531\u4e8e\u6ca1\u6709\u5728\u4e3b\u673a A \u7684\u8def\u7531\u8868\u627e\u5230\u4e0e\u76ee\u6807\u5730\u5740 <code>10.1.2.10</code> \u7684\u7f51\u7edc\u5730\u5740\uff0c\u4e8e\u662f\u5305\u88ab\u8f6c\u53d1\u5230\u9ed8\u8ba4\u8def\u7531\uff08\u8def\u7531\u5668 <code>1</code> \uff09</li> <li>\u8def\u7531\u5668 <code>1</code> \u6536\u5230 IP \u5305\u540e\uff0c\u4e5f\u5728\u8def\u7531\u5668 <code>1</code> \u7684\u8def\u7531\u8868\u5339\u914d\u4e0e\u76ee\u6807\u5730\u5740\u76f8\u540c\u7684\u7f51\u7edc\u5730\u5740\u8bb0\u5f55\uff0c\u53d1\u73b0\u5339\u914d\u5230\u4e86\uff0c\u4e8e\u662f\u5c31\u628a IP \u6570\u636e\u5305\u8f6c\u53d1\u5230\u4e86 <code>10.1.0.2</code> \u8fd9\u53f0\u8def\u7531\u5668 <code>2</code></li> <li>\u8def\u7531\u5668 <code>2</code> \u6536\u5230\u540e\uff0c\u540c\u6837\u5bf9\u6bd4\u81ea\u8eab\u7684\u8def\u7531\u8868\uff0c\u53d1\u73b0\u5339\u914d\u5230\u4e86\uff0c\u4e8e\u662f\u628a IP \u5305\u4ece\u8def\u7531\u5668 <code>2</code> \u7684 <code>10.1.2.1</code> \u8fd9\u4e2a\u63a5\u53e3\u51fa\u53bb\uff0c\u6700\u7ec8\u7ecf\u8fc7\u4ea4\u6362\u673a\u628a IP \u6570\u636e\u5305\u8f6c\u53d1\u5230\u4e86\u76ee\u6807\u4e3b\u673a</li> </ol> <p>\u73af\u56de\u5730\u5740\u662f\u4e0d\u4f1a\u6d41\u5411\u7f51\u7edc</p> <p>\u73af\u56de\u5730\u5740\u662f\u5728\u540c\u4e00\u53f0\u8ba1\u7b97\u673a\u4e0a\u7684\u7a0b\u5e8f\u4e4b\u95f4\u8fdb\u884c\u7f51\u7edc\u901a\u4fe1\u65f6\u6240\u4f7f\u7528\u7684\u4e00\u4e2a\u9ed8\u8ba4\u5730\u5740\u3002</p> <p>\u8ba1\u7b97\u673a\u4f7f\u7528\u4e00\u4e2a\u7279\u6b8a\u7684 IP \u5730\u5740 127.0.0.1 \u4f5c\u4e3a\u73af\u56de\u5730\u5740\u3002\u4e0e\u8be5\u5730\u5740\u5177\u6709\u76f8\u540c\u610f\u4e49\u7684\u662f\u4e00\u4e2a\u53eb\u505a <code>localhost</code> \u7684\u4e3b\u673a\u540d\u3002\u4f7f\u7528\u8fd9\u4e2a IP \u6216\u4e3b\u673a\u540d\u65f6\uff0c\u6570\u636e\u5305\u4e0d\u4f1a\u6d41\u5411\u7f51\u7edc\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#ip_4","title":"IP \u5206\u7247\u4e0e\u91cd\u7ec4","text":"<p>\u6bcf\u79cd\u6570\u636e\u94fe\u8def\u7684\u6700\u5927\u4f20\u8f93\u5355\u5143 <code>MTU</code> \u90fd\u662f\u4e0d\u76f8\u540c\u7684\uff0c\u5982 FDDI \u6570\u636e\u94fe\u8def MTU 4352\u3001\u4ee5\u592a\u7f51\u7684 MTU \u662f 1500 \u5b57\u8282\u7b49\u3002</p> <p>\u6bcf\u79cd\u6570\u636e\u94fe\u8def\u7684 MTU \u4e4b\u6240\u4ee5\u4e0d\u540c\uff0c\u662f\u56e0\u4e3a\u6bcf\u4e2a\u4e0d\u540c\u7c7b\u578b\u7684\u6570\u636e\u94fe\u8def\u7684\u4f7f\u7528\u76ee\u7684\u4e0d\u540c\u3002\u4f7f\u7528\u76ee\u7684\u4e0d\u540c\uff0c\u53ef\u627f\u8f7d\u7684 MTU \u4e5f\u5c31\u4e0d\u540c\u3002</p> <p>\u5176\u4e2d\uff0c\u6211\u4eec\u6700\u5e38\u89c1\u6570\u636e\u94fe\u8def\u662f\u4ee5\u592a\u7f51\uff0c\u5b83\u7684 MTU \u662f <code>1500</code> \u5b57\u8282\u3002</p> <p>\u90a3\u4e48\u5f53 IP \u6570\u636e\u5305\u5927\u5c0f\u5927\u4e8e MTU \u65f6\uff0cIP \u6570\u636e\u5305\u5c31\u4f1a\u88ab\u5206\u7247\u3002</p> <p>\u7ecf\u8fc7\u5206\u7247\u4e4b\u540e\u7684 IP \u6570\u636e\u62a5\u5728\u88ab\u91cd\u7ec4\u7684\u65f6\u5019\uff0c\u53ea\u80fd\u7531\u76ee\u6807\u4e3b\u673a\u8fdb\u884c\uff0c\u8def\u7531\u5668\u662f\u4e0d\u4f1a\u8fdb\u884c\u91cd\u7ec4\u7684\u3002</p> <p>\u5047\u8bbe\u53d1\u9001\u65b9\u53d1\u9001\u4e00\u4e2a 4000 \u5b57\u8282\u7684\u5927\u6570\u636e\u62a5\uff0c\u82e5\u8981\u4f20\u8f93\u5728\u4ee5\u592a\u7f51\u94fe\u8def\uff0c\u5219\u9700\u8981\u628a\u6570\u636e\u62a5\u5206\u7247\u6210 3 \u4e2a\u5c0f\u6570\u636e\u62a5\u8fdb\u884c\u4f20\u8f93\uff0c\u518d\u4ea4\u7531\u63a5\u6536\u65b9\u91cd\u7ec4\u6210\u5927\u6570\u636e\u62a5\u3002</p> <p></p> <p>\u5728\u5206\u7247\u4f20\u8f93\u4e2d\uff0c\u4e00\u65e6\u67d0\u4e2a\u5206\u7247\u4e22\u5931\uff0c\u5219\u4f1a\u9020\u6210\u6574\u4e2a IP \u6570\u636e\u62a5\u4f5c\u5e9f\uff0c\u6240\u4ee5 TCP \u5f15\u5165\u4e86 <code>MSS</code> \u4e5f\u5c31\u662f\u5728 TCP \u5c42\u8fdb\u884c\u5206\u7247\u4e0d\u7531 IP \u5c42\u5206\u7247\uff0c\u90a3\u4e48\u5bf9\u4e8e UDP \u6211\u4eec\u5c3d\u91cf\u4e0d\u8981\u53d1\u9001\u4e00\u4e2a\u5927\u4e8e <code>MTU</code> \u7684\u6570\u636e\u62a5\u6587\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#ipv6","title":"IPv6 \u57fa\u672c\u8ba4\u8bc6","text":"<p>IPv4 \u7684\u5730\u5740\u662f 32 \u4f4d\u7684\uff0c\u5927\u7ea6\u53ef\u4ee5\u63d0\u4f9b 42 \u4ebf\u4e2a\u5730\u5740\uff0c\u4f46\u662f\u65e9\u5728 2011 \u5e74 IPv4 \u5730\u5740\u5c31\u5df2\u7ecf\u88ab\u5206\u914d\u5b8c\u4e86\u3002</p> <p>\u4f46\u662f IPv6 \u7684\u5730\u5740\u662f <code>128</code> \u4f4d\u7684\uff0c\u8fd9\u53ef\u5206\u914d\u7684\u5730\u5740\u6570\u91cf\u662f\u5927\u7684\u60ca\u4eba\uff0c\u8bf4\u4e2a\u6bb5\u5b50 IPv6 \u53ef\u4ee5\u4fdd\u8bc1\u5730\u7403\u4e0a\u7684\u6bcf\u7c92\u6c99\u5b50\u90fd\u80fd\u88ab\u5206\u914d\u5230\u4e00\u4e2a IP \u5730\u5740\u3002</p> <p>\u4f46 IPv6 \u9664\u4e86\u6709\u66f4\u591a\u7684\u5730\u5740\u4e4b\u5916\uff0c\u8fd8\u6709\u66f4\u597d\u7684\u5b89\u5168\u6027\u548c\u6269\u5c55\u6027\uff0c\u8bf4\u7b80\u5355\u70b9\u5c31\u662f IPv6 \u76f8\u6bd4\u4e8e IPv4 \u80fd\u5e26\u6765\u66f4\u597d\u7684\u7f51\u7edc\u4f53\u9a8c\u3002</p> <p>\u4f46\u662f\u56e0\u4e3a IPv4 \u548c IPv6 \u4e0d\u80fd\u76f8\u4e92\u517c\u5bb9\uff0c\u6240\u4ee5\u4e0d\u4f46\u8981\u6211\u4eec\u7535\u8111\u3001\u624b\u673a\u4e4b\u7c7b\u7684\u8bbe\u5907\u652f\u6301\uff0c\u8fd8\u9700\u8981\u7f51\u7edc\u8fd0\u8425\u5546\u5bf9\u73b0\u6709\u7684\u8bbe\u5907\u8fdb\u884c\u5347\u7ea7\uff0c\u6240\u4ee5\u8fd9\u53ef\u80fd\u662f IPv6 \u666e\u53ca\u7387\u6bd4\u8f83\u6162\u7684\u4e00\u4e2a\u539f\u56e0\u3002</p> <p>IPv6 \u7684\u4eae\u70b9</p> <p>IPv6 \u4e0d\u4ec5\u4ec5\u53ea\u662f\u53ef\u5206\u914d\u7684\u5730\u5740\u53d8\u591a\u4e86\uff0c\u5b83\u8fd8\u6709\u975e\u5e38\u591a\u7684\u4eae\u70b9\u3002</p> <ul> <li>IPv6 \u53ef\u81ea\u52a8\u914d\u7f6e\uff0c\u5373\u4f7f\u6ca1\u6709 DHCP \u670d\u52a1\u5668\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u81ea\u52a8\u5206\u914d IP \u5730\u5740\uff0c\u771f\u662f\u4fbf\u6377\u5230\u5373\u63d2\u5373\u7528\u554a\u3002</li> <li>IPv6 \u5305\u5934\u5305\u9996\u90e8\u957f\u5ea6\u91c7\u7528\u56fa\u5b9a\u7684\u503c <code>40</code> \u5b57\u8282\uff0c\u53bb\u6389\u4e86\u5305\u5934\u6821\u9a8c\u548c\uff0c\u7b80\u5316\u4e86\u9996\u90e8\u7ed3\u6784\uff0c\u51cf\u8f7b\u4e86\u8def\u7531\u5668\u8d1f\u8377\uff0c\u5927\u5927\u63d0\u9ad8\u4e86\u4f20\u8f93\u7684\u6027\u80fd\u3002</li> <li>IPv6 \u6709\u5e94\u5bf9\u4f2a\u9020 IP \u5730\u5740\u7684\u7f51\u7edc\u5b89\u5168\u529f\u80fd\u4ee5\u53ca\u9632\u6b62\u7ebf\u8def\u7a83\u542c\u7684\u529f\u80fd\uff0c\u5927\u5927\u63d0\u5347\u4e86\u5b89\u5168\u6027\u3002</li> <li>... \uff08\u7531\u4f60\u53d1\u73b0\u66f4\u591a\u7684\u4eae\u70b9\uff09</li> </ul> <p>IPv6 \u5730\u5740\u7684\u6807\u8bc6\u65b9\u6cd5</p> <p>IPv4 \u5730\u5740\u957f\u5ea6\u5171 32 \u4f4d\uff0c\u662f\u4ee5\u6bcf 8 \u4f4d\u4f5c\u4e3a\u4e00\u7ec4\uff0c\u5e76\u7528\u70b9\u5206\u5341\u8fdb\u5236\u7684\u8868\u793a\u65b9\u5f0f\u3002</p> <p>IPv6 \u5730\u5740\u957f\u5ea6\u662f 128 \u4f4d\uff0c\u662f\u4ee5\u6bcf 16 \u4f4d\u4f5c\u4e3a\u4e00\u7ec4\uff0c\u6bcf\u7ec4\u7528\u5192\u53f7\u300c:\u300d\u9694\u5f00\u3002</p> <p></p> <p>\u5982\u679c\u51fa\u73b0\u8fde\u7eed\u7684 0 \u65f6\u8fd8\u53ef\u4ee5\u5c06\u8fd9\u4e9b 0 \u7701\u7565\uff0c\u5e76\u7528\u4e24\u4e2a\u5192\u53f7\u300c::\u300d\u9694\u5f00\u3002\u4f46\u662f\uff0c\u4e00\u4e2a IP \u5730\u5740\u4e2d\u53ea\u5141\u8bb8\u51fa\u73b0\u4e00\u6b21\u4e24\u4e2a\u8fde\u7eed\u7684\u5192\u53f7\u3002</p> <p></p> <p>IPv6 \u5730\u5740\u7684\u7ed3\u6784</p> <p>IPv6 \u7c7b\u4f3c IPv4\uff0c\u4e5f\u662f\u901a\u8fc7 IP \u5730\u5740\u7684\u524d\u51e0\u4f4d\u6807\u8bc6 IP \u5730\u5740\u7684\u79cd\u7c7b\u3002</p> <p>IPv6 \u7684\u5730\u5740\u4e3b\u8981\u6709\u4ee5\u4e0b\u7c7b\u578b\u5730\u5740\uff1a</p> <ul> <li>\u5355\u64ad\u5730\u5740\uff0c\u7528\u4e8e\u4e00\u5bf9\u4e00\u7684\u901a\u4fe1</li> <li>\u7ec4\u64ad\u5730\u5740\uff0c\u7528\u4e8e\u4e00\u5bf9\u591a\u7684\u901a\u4fe1</li> <li>\u4efb\u64ad\u5730\u5740\uff0c\u7528\u4e8e\u901a\u4fe1\u6700\u8fd1\u7684\u8282\u70b9\uff0c\u6700\u8fd1\u7684\u8282\u70b9\u662f\u7531\u8def\u7531\u534f\u8bae\u51b3\u5b9a</li> <li>\u6ca1\u6709\u5e7f\u64ad\u5730\u5740</li> </ul> <p></p> <p>IPv6 \u5355\u64ad\u5730\u5740\u7c7b\u578b</p> <p>\u5bf9\u4e8e\u4e00\u5bf9\u4e00\u901a\u4fe1\u7684 IPv6 \u5730\u5740\uff0c\u4e3b\u8981\u5212\u5206\u4e86\u4e09\u7c7b\u5355\u64ad\u5730\u5740\uff0c\u6bcf\u7c7b\u5730\u5740\u7684\u6709\u6548\u8303\u56f4\u90fd\u4e0d\u540c\u3002</p> <ul> <li>\u5728\u540c\u4e00\u94fe\u8def\u5355\u64ad\u901a\u4fe1\uff0c\u4e0d\u7ecf\u8fc7\u8def\u7531\u5668\uff0c\u53ef\u4ee5\u4f7f\u7528\u94fe\u8def\u672c\u5730\u5355\u64ad\u5730\u5740\uff0cIPv4 \u6ca1\u6709\u6b64\u7c7b\u578b</li> <li>\u5728\u5185\u7f51\u91cc\u5355\u64ad\u901a\u4fe1\uff0c\u53ef\u4ee5\u4f7f\u7528\u552f\u4e00\u672c\u5730\u5730\u5740\uff0c\u76f8\u5f53\u4e8e IPv4 \u7684\u79c1\u6709 IP</li> <li>\u5728\u4e92\u8054\u7f51\u901a\u4fe1\uff0c\u53ef\u4ee5\u4f7f\u7528\u5168\u5c40\u5355\u64ad\u5730\u5740\uff0c\u76f8\u5f53\u4e8e IPv4 \u7684\u516c\u6709 IP</li> </ul> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#ipv4-ipv6","title":"IPv4 \u9996\u90e8\u4e0e IPv6 \u9996\u90e8","text":"<p>IPv4 \u9996\u90e8\u4e0e IPv6 \u9996\u90e8\u7684\u5dee\u5f02\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>IPv6 \u76f8\u6bd4 IPv4 \u7684\u9996\u90e8\u6539\u8fdb\uff1a</p> <ul> <li>\u53d6\u6d88\u4e86\u9996\u90e8\u6821\u9a8c\u548c\u5b57\u6bb5\u3002 \u56e0\u4e3a\u5728\u6570\u636e\u94fe\u8def\u5c42\u548c\u4f20\u8f93\u5c42\u90fd\u4f1a\u6821\u9a8c\uff0c\u56e0\u6b64 IPv6 \u76f4\u63a5\u53d6\u6d88\u4e86 IP \u7684\u6821\u9a8c\u3002</li> <li>\u53d6\u6d88\u4e86\u5206\u7247/\u91cd\u65b0\u7ec4\u88c5\u76f8\u5173\u5b57\u6bb5\u3002 \u5206\u7247\u4e0e\u91cd\u7ec4\u662f\u8017\u65f6\u7684\u8fc7\u7a0b\uff0cIPv6 \u4e0d\u5141\u8bb8\u5728\u4e2d\u95f4\u8def\u7531\u5668\u8fdb\u884c\u5206\u7247\u4e0e\u91cd\u7ec4\uff0c\u8fd9\u79cd\u64cd\u4f5c\u53ea\u80fd\u5728\u6e90\u4e0e\u76ee\u6807\u4e3b\u673a\uff0c\u8fd9\u5c06\u5927\u5927\u63d0\u9ad8\u4e86\u8def\u7531\u5668\u8f6c\u53d1\u7684\u901f\u5ea6\u3002</li> <li>\u53d6\u6d88\u9009\u9879\u5b57\u6bb5\u3002 \u9009\u9879\u5b57\u6bb5\u4e0d\u518d\u662f\u6807\u51c6 IP \u9996\u90e8\u7684\u4e00\u90e8\u5206\u4e86\uff0c\u4f46\u5b83\u5e76\u6ca1\u6709\u6d88\u5931\uff0c\u800c\u662f\u53ef\u80fd\u51fa\u73b0\u5728 IPv6 \u9996\u90e8\u4e2d\u7684\u300c\u4e0b\u4e00\u4e2a\u9996\u90e8\u300d\u6307\u51fa\u7684\u4f4d\u7f6e\u4e0a\u3002\u5220\u9664\u8be5\u9009\u9879\u5b57\u6bb5\u4f7f\u7684 IPv6 \u7684\u9996\u90e8\u6210\u4e3a\u56fa\u5b9a\u957f\u5ea6\u7684 <code>40</code> \u5b57\u8282\u3002</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#ip_5","title":"\u70b9\u5fc3 \u2014\u2014 IP \u534f\u8bae\u76f8\u5173\u6280\u672f","text":"<p>\u8ddf IP \u534f\u8bae\u76f8\u5173\u7684\u6280\u672f\u4e5f\u4e0d\u5c11\uff0c\u63a5\u4e0b\u6765\u8bf4\u8bf4\u4e0e IP \u534f\u8bae\u76f8\u5173\u7684\u91cd\u8981\u4e14\u5e38\u89c1\u7684\u6280\u672f\u3002</p> <ul> <li>DNS \u57df\u540d\u89e3\u6790</li> <li>ARP \u4e0e RARP \u534f\u8bae</li> <li>DHCP \u52a8\u6001\u83b7\u53d6 IP \u5730\u5740</li> <li>NAT \u7f51\u7edc\u5730\u5740\u8f6c\u6362</li> <li>ICMP \u4e92\u8054\u7f51\u63a7\u5236\u62a5\u6587\u534f\u8bae</li> <li>IGMP \u56e0\u7279\u7f51\u7ec4\u7ba1\u7406\u534f</li> </ul>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#dns","title":"DNS","text":"<p>\u6211\u4eec\u5728\u4e0a\u7f51\u7684\u65f6\u5019\uff0c\u901a\u5e38\u4f7f\u7528\u7684\u65b9\u5f0f\u662f\u57df\u540d\uff0c\u800c\u4e0d\u662f IP \u5730\u5740\uff0c\u56e0\u4e3a\u57df\u540d\u65b9\u4fbf\u4eba\u7c7b\u8bb0\u5fc6\u3002</p> <p>\u90a3\u4e48\u5b9e\u73b0\u8fd9\u4e00\u6280\u672f\u7684\u5c31\u662f DNS \u57df\u540d\u89e3\u6790\uff0cDNS \u53ef\u4ee5\u5c06\u57df\u540d\u7f51\u5740\u81ea\u52a8\u8f6c\u6362\u4e3a\u5177\u4f53\u7684 IP \u5730\u5740\u3002</p> <p>\u57df\u540d\u7684\u5c42\u7ea7\u5173\u7cfb</p> <p>DNS \u4e2d\u7684\u57df\u540d\u90fd\u662f\u7528\u53e5\u70b9\u6765\u5206\u9694\u7684\uff0c\u6bd4\u5982 <code>www.server.com</code>\uff0c\u8fd9\u91cc\u7684\u53e5\u70b9\u4ee3\u8868\u4e86\u4e0d\u540c\u5c42\u6b21\u4e4b\u95f4\u7684\u754c\u9650\u3002</p> <p>\u5728\u57df\u540d\u4e2d\uff0c\u8d8a\u9760\u53f3\u7684\u4f4d\u7f6e\u8868\u793a\u5176\u5c42\u7ea7\u8d8a\u9ad8\u3002</p> <p>\u6bd5\u7adf\u57df\u540d\u662f\u5916\u56fd\u4eba\u53d1\u660e\uff0c\u6240\u4ee5\u601d\u7ef4\u548c\u4e2d\u56fd\u4eba\u76f8\u53cd\uff0c\u6bd4\u5982\u8bf4\u4e00\u4e2a\u57ce\u5e02\u5730\u70b9\u7684\u65f6\u5019\uff0c\u5916\u56fd\u559c\u6b22\u4ece\u5c0f\u5230\u5927\u7684\u65b9\u5f0f\u987a\u5e8f\u8bf4\u8d77\uff08\u5982 XX \u8857\u9053 XX \u533a XX \u5e02 XX \u7701\uff09\uff0c\u800c\u4e2d\u56fd\u5219\u559c\u6b22\u4ece\u5927\u5230\u5c0f\u7684\u987a\u5e8f\uff08\u5982 XX \u7701 XX \u5e02 XX \u533a XX \u8857\u9053\uff09\u3002</p> <p>\u6839\u57df\u662f\u5728\u6700\u9876\u5c42\uff0c\u5b83\u7684\u4e0b\u4e00\u5c42\u5c31\u662f com \u9876\u7ea7\u57df\uff0c\u518d\u4e0b\u9762\u662f server.com\u3002</p> <p>\u6240\u4ee5\u57df\u540d\u7684\u5c42\u7ea7\u5173\u7cfb\u7c7b\u4f3c\u4e00\u4e2a\u6811\u72b6\u7ed3\u6784\uff1a</p> <ul> <li>\u6839 DNS \u670d\u52a1\u5668</li> <li>\u9876\u7ea7\u57df DNS \u670d\u52a1\u5668\uff08com\uff09</li> <li>\u6743\u5a01 DNS \u670d\u52a1\u5668\uff08server.com\uff09</li> </ul> <p></p> <p>\u6839\u57df\u7684 DNS \u670d\u52a1\u5668\u4fe1\u606f\u4fdd\u5b58\u5728\u4e92\u8054\u7f51\u4e2d\u6240\u6709\u7684 DNS \u670d\u52a1\u5668\u4e2d\u3002\u8fd9\u6837\u4e00\u6765\uff0c\u4efb\u4f55 DNS \u670d\u52a1\u5668\u5c31\u90fd\u53ef\u4ee5\u627e\u5230\u5e76\u8bbf\u95ee\u6839\u57df DNS \u670d\u52a1\u5668\u4e86\u3002</p> <p>\u56e0\u6b64\uff0c\u5ba2\u6237\u7aef\u53ea\u8981\u80fd\u591f\u627e\u5230\u4efb\u610f\u4e00\u53f0 DNS \u670d\u52a1\u5668\uff0c\u5c31\u53ef\u4ee5\u901a\u8fc7\u5b83\u627e\u5230\u6839\u57df DNS \u670d\u52a1\u5668\uff0c\u7136\u540e\u518d\u4e00\u8def\u987a\u85e4\u6478\u74dc\u627e\u5230\u4f4d\u4e8e\u4e0b\u5c42\u7684\u67d0\u53f0\u76ee\u6807 DNS \u670d\u52a1\u5668\u3002</p> <p>\u57df\u540d\u89e3\u6790\u7684\u5de5\u4f5c\u6d41\u7a0b</p> <p>\u6d4f\u89c8\u5668\u9996\u5148\u770b\u4e00\u4e0b\u81ea\u5df1\u7684\u7f13\u5b58\u91cc\u6709\u6ca1\u6709\uff0c\u5982\u679c\u6ca1\u6709\u5c31\u5411\u64cd\u4f5c\u7cfb\u7edf\u7684\u7f13\u5b58\u8981\uff0c\u8fd8\u6ca1\u6709\u5c31\u68c0\u67e5\u672c\u673a\u57df\u540d\u89e3\u6790\u6587\u4ef6 <code>hosts</code>\uff0c\u5982\u679c\u8fd8\u662f\u6ca1\u6709\uff0c\u5c31\u4f1a DNS \u670d\u52a1\u5668\u8fdb\u884c\u67e5\u8be2\uff0c\u67e5\u8be2\u7684\u8fc7\u7a0b\u5982\u4e0b\uff1a</p> <ol> <li>\u5ba2\u6237\u7aef\u9996\u5148\u4f1a\u53d1\u51fa\u4e00\u4e2a DNS \u8bf7\u6c42\uff0c\u95ee www.server.com \u7684 IP \u662f\u5565\uff0c\u5e76\u53d1\u7ed9\u672c\u5730 DNS \u670d\u52a1\u5668\uff08\u4e5f\u5c31\u662f\u5ba2\u6237\u7aef\u7684 TCP/IP \u8bbe\u7f6e\u4e2d\u586b\u5199\u7684 DNS \u670d\u52a1\u5668\u5730\u5740\uff09\u3002</li> <li>\u672c\u5730\u57df\u540d\u670d\u52a1\u5668\u6536\u5230\u5ba2\u6237\u7aef\u7684\u8bf7\u6c42\u540e\uff0c\u5982\u679c\u7f13\u5b58\u91cc\u7684\u8868\u683c\u80fd\u627e\u5230 www.server.com\uff0c\u5219\u5b83\u76f4\u63a5\u8fd4\u56de IP \u5730\u5740\u3002\u5982\u679c\u6ca1\u6709\uff0c\u672c\u5730 DNS \u4f1a\u53bb\u95ee\u5b83\u7684\u6839\u57df\u540d\u670d\u52a1\u5668\uff1a\u201c\u8001\u5927\uff0c\u80fd\u544a\u8bc9\u6211 www.server.com \u7684 IP \u5730\u5740\u5417\uff1f\u201d\u6839\u57df\u540d\u670d\u52a1\u5668\u662f\u6700\u9ad8\u5c42\u6b21\u7684\uff0c\u5b83\u4e0d\u76f4\u63a5\u7528\u4e8e\u57df\u540d\u89e3\u6790\uff0c\u4f46\u80fd\u6307\u660e\u4e00\u6761\u9053\u8def\u3002 </li> <li>\u6839 DNS \u6536\u5230\u6765\u81ea\u672c\u5730 DNS \u7684\u8bf7\u6c42\u540e\uff0c\u53d1\u73b0\u540e\u7f6e\u662f .com\uff0c\u8bf4\uff1a\u201cwww.server.com \u8fd9\u4e2a\u57df\u540d\u5f52 .com \u533a\u57df\u7ba1\u7406\u201d\uff0c\u6211\u7ed9\u4f60 .com \u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\u5730\u5740\u7ed9\u4f60\uff0c\u4f60\u53bb\u95ee\u95ee\u5b83\u5427\u3002\u201d</li> <li>\u672c\u5730 DNS \u6536\u5230\u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\u7684\u5730\u5740\u540e\uff0c\u53d1\u8d77\u8bf7\u6c42\u95ee\u201c\u8001\u4e8c\uff0c\u4f60\u80fd\u544a\u8bc9\u6211 www.server.com  \u7684 IP \u5730\u5740\u5417\uff1f\u201d</li> <li>\u9876\u7ea7\u57df\u540d\u670d\u52a1\u5668\u8bf4\uff1a\u201c\u6211\u7ed9\u4f60\u8d1f\u8d23 www.server.com \u533a\u57df\u7684\u6743\u5a01 DNS \u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u4f60\u53bb\u95ee\u5b83\u5e94\u8be5\u80fd\u95ee\u5230\u201d\u3002</li> <li>\u672c\u5730 DNS \u4e8e\u662f\u8f6c\u5411\u95ee\u6743\u5a01 DNS \u670d\u52a1\u5668\uff1a\u201c\u8001\u4e09\uff0cwww.server.com \u5bf9\u5e94\u7684 IP \u662f\u5565\u5440\uff1f\u201dserver.com \u7684\u6743\u5a01 DNS \u670d\u52a1\u5668\uff0c\u5b83\u662f\u57df\u540d\u89e3\u6790\u7ed3\u679c\u7684\u539f\u51fa\u5904\u3002\u4e3a\u5565\u53eb\u6743\u5a01\u5462\uff1f\u5c31\u662f\u6211\u7684\u57df\u540d\u6211\u505a\u4e3b\u3002</li> <li>\u6743\u5a01 DNS \u670d\u52a1\u5668\u67e5\u8be2\u540e\u5c06\u5bf9\u5e94\u7684 IP \u5730\u5740 X.X.X.X \u544a\u8bc9\u672c\u5730 DNS\u3002</li> <li>\u672c\u5730 DNS \u518d\u5c06 IP \u5730\u5740\u8fd4\u56de\u5ba2\u6237\u7aef\uff0c\u5ba2\u6237\u7aef\u548c\u76ee\u6807\u5efa\u7acb\u8fde\u63a5\u3002</li> </ol> <p>\u81f3\u6b64\uff0c\u6211\u4eec\u5b8c\u6210\u4e86 DNS \u7684\u89e3\u6790\u8fc7\u7a0b\u3002\u73b0\u5728\u603b\u7ed3\u4e00\u4e0b\uff0c\u6574\u4e2a\u8fc7\u7a0b\u6211\u753b\u6210\u4e86\u4e00\u4e2a\u56fe\u3002</p> <p></p> <p>DNS \u57df\u540d\u89e3\u6790\u7684\u8fc7\u7a0b\u86ee\u6709\u610f\u601d\u7684\uff0c\u6574\u4e2a\u8fc7\u7a0b\u5c31\u548c\u6211\u4eec\u65e5\u5e38\u751f\u6d3b\u4e2d\u627e\u4eba\u95ee\u8def\u7684\u8fc7\u7a0b\u7c7b\u4f3c\uff0c\u53ea\u6307\u8def\u4e0d\u5e26\u8def\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#arp","title":"ARP","text":"<p>\u5728\u4f20\u8f93\u4e00\u4e2a IP \u6570\u636e\u62a5\u7684\u65f6\u5019\uff0c\u786e\u5b9a\u4e86\u6e90 IP \u5730\u5740\u548c\u76ee\u6807 IP \u5730\u5740\u540e\uff0c\u5c31\u4f1a\u901a\u8fc7\u4e3b\u673a\u300c\u8def\u7531\u8868\u300d\u786e\u5b9a IP \u6570\u636e\u5305\u4e0b\u4e00\u8df3\u3002\u7136\u800c\uff0c\u7f51\u7edc\u5c42\u7684\u4e0b\u4e00\u5c42\u662f\u6570\u636e\u94fe\u8def\u5c42\uff0c\u6240\u4ee5\u6211\u4eec\u8fd8\u8981\u77e5\u9053\u300c\u4e0b\u4e00\u8df3\u300d\u7684 MAC \u5730\u5740\u3002</p> <p>\u7531\u4e8e\u4e3b\u673a\u7684\u8def\u7531\u8868\u4e2d\u53ef\u4ee5\u627e\u5230\u4e0b\u4e00\u8df3\u7684 IP \u5730\u5740\uff0c\u6240\u4ee5\u53ef\u4ee5\u901a\u8fc7 ARP \u534f\u8bae\uff0c\u6c42\u5f97\u4e0b\u4e00\u8df3\u7684 MAC \u5730\u5740\u3002</p> <p>\u90a3\u4e48 ARP \u53c8\u662f\u5982\u4f55\u77e5\u9053\u5bf9\u65b9 MAC \u5730\u5740\u7684\u5462\uff1f</p> <p>\u7b80\u5355\u5730\u8bf4\uff0cARP \u662f\u501f\u52a9 ARP \u8bf7\u6c42\u4e0e ARP \u54cd\u5e94\u4e24\u79cd\u7c7b\u578b\u7684\u5305\u786e\u5b9a MAC \u5730\u5740\u7684\u3002</p> <p></p> <ul> <li>\u4e3b\u673a\u4f1a\u901a\u8fc7\u5e7f\u64ad\u53d1\u9001 ARP \u8bf7\u6c42\uff0c\u8fd9\u4e2a\u5305\u4e2d\u5305\u542b\u4e86\u60f3\u8981\u77e5\u9053\u7684 MAC \u5730\u5740\u7684\u4e3b\u673a IP \u5730\u5740\u3002</li> <li>\u5f53\u540c\u4e2a\u94fe\u8def\u4e2d\u7684\u6240\u6709\u8bbe\u5907\u6536\u5230 ARP \u8bf7\u6c42\u65f6\uff0c\u4f1a\u53bb\u62c6\u5f00 ARP \u8bf7\u6c42\u5305\u91cc\u7684\u5185\u5bb9\uff0c\u5982\u679c ARP \u8bf7\u6c42\u5305\u4e2d\u7684\u76ee\u6807 IP \u5730\u5740\u4e0e\u81ea\u5df1\u7684 IP \u5730\u5740\u4e00\u81f4\uff0c\u90a3\u4e48\u8fd9\u4e2a\u8bbe\u5907\u5c31\u5c06\u81ea\u5df1\u7684 MAC \u5730\u5740\u585e\u5165 ARP \u54cd\u5e94\u5305\u8fd4\u56de\u7ed9\u4e3b\u673a\u3002</li> </ul> <p>\u64cd\u4f5c\u7cfb\u7edf\u901a\u5e38\u4f1a\u628a\u7b2c\u4e00\u6b21\u901a\u8fc7 ARP \u83b7\u53d6\u7684 MAC \u5730\u5740\u7f13\u5b58\u8d77\u6765\uff0c\u4ee5\u4fbf\u4e0b\u6b21\u76f4\u63a5\u4ece\u7f13\u5b58\u4e2d\u627e\u5230\u5bf9\u5e94 IP \u5730\u5740\u7684 MAC \u5730\u5740\u3002</p> <p>\u4e0d\u8fc7\uff0cMAC \u5730\u5740\u7684\u7f13\u5b58\u662f\u6709\u4e00\u5b9a\u671f\u9650\u7684\uff0c\u8d85\u8fc7\u8fd9\u4e2a\u671f\u9650\uff0c\u7f13\u5b58\u7684\u5185\u5bb9\u5c06\u88ab\u6e05\u9664\u3002</p> <p>RARP \u534f\u8bae\u4f60\u77e5\u9053\u662f\u4ec0\u4e48\u5417\uff1f</p> <p>ARP \u534f\u8bae\u662f\u5df2\u77e5 IP \u5730\u5740\u6c42 MAC \u5730\u5740\uff0c\u90a3 RARP \u534f\u8bae\u6b63\u597d\u76f8\u53cd\uff0c\u5b83\u662f\u5df2\u77e5 MAC \u5730\u5740\u6c42 IP \u5730\u5740\u3002\u4f8b\u5982\u5c06\u6253\u5370\u673a\u670d\u52a1\u5668\u7b49\u5c0f\u578b\u5d4c\u5165\u5f0f\u8bbe\u5907\u63a5\u5165\u5230\u7f51\u7edc\u65f6\u5c31\u7ecf\u5e38\u4f1a\u7528\u5f97\u5230\u3002</p> <p>\u901a\u5e38\u8fd9\u9700\u8981\u67b6\u8bbe\u4e00\u53f0 <code>RARP</code> \u670d\u52a1\u5668\uff0c\u5728\u8fd9\u4e2a\u670d\u52a1\u5668\u4e0a\u6ce8\u518c\u8bbe\u5907\u7684 MAC \u5730\u5740\u53ca\u5176 IP \u5730\u5740\u3002\u7136\u540e\u518d\u5c06\u8fd9\u4e2a\u8bbe\u5907\u63a5\u5165\u5230\u7f51\u7edc\uff0c\u63a5\u7740\uff1a</p> <ul> <li>\u8be5\u8bbe\u5907\u4f1a\u53d1\u9001\u4e00\u6761\u300c\u6211\u7684 MAC \u5730\u5740\u662f XXXX\uff0c\u8bf7\u544a\u8bc9\u6211\uff0c\u6211\u7684 IP \u5730\u5740\u5e94\u8be5\u662f\u4ec0\u4e48\u300d\u7684\u8bf7\u6c42\u4fe1\u606f\u3002</li> <li>RARP \u670d\u52a1\u5668\u63a5\u5230\u8fd9\u4e2a\u6d88\u606f\u540e\u8fd4\u56de\u300cMAC \u5730\u5740\u4e3a XXXX \u7684\u8bbe\u5907\uff0cIP \u5730\u5740\u4e3a XXXX\u300d\u7684\u4fe1\u606f\u7ed9\u8fd9\u4e2a\u8bbe\u5907\u3002</li> </ul> <p>\u6700\u540e\uff0c\u8bbe\u5907\u5c31\u6839\u636e\u4ece RARP \u670d\u52a1\u5668\u6240\u6536\u5230\u7684\u5e94\u7b54\u4fe1\u606f\u8bbe\u7f6e\u81ea\u5df1\u7684 IP \u5730\u5740\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#dhcp","title":"DHCP","text":"<p>DHCP \u5728\u751f\u6d3b\u4e2d\u6211\u4eec\u662f\u5f88\u5e38\u89c1\u7684\u4e86\uff0c\u6211\u4eec\u7684\u7535\u8111\u901a\u5e38\u90fd\u662f\u901a\u8fc7 DHCP \u52a8\u6001\u83b7\u53d6 IP \u5730\u5740\uff0c\u5927\u5927\u7701\u53bb\u4e86\u914d IP \u4fe1\u606f\u7e41\u7410\u7684\u8fc7\u7a0b\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u6765\u770b\u770b\u6211\u4eec\u7684\u7535\u8111\u662f\u5982\u4f55\u901a\u8fc7 4 \u4e2a\u6b65\u9aa4\u7684\u8fc7\u7a0b\uff0c\u83b7\u53d6\u5230 IP \u7684\u3002</p> <p></p> <p>\u5148\u8bf4\u660e\u4e00\u70b9\uff0cDHCP \u5ba2\u6237\u7aef\u8fdb\u7a0b\u76d1\u542c\u7684\u662f 68 \u7aef\u53e3\u53f7\uff0cDHCP \u670d\u52a1\u7aef\u8fdb\u7a0b\u76d1\u542c\u7684\u662f 67 \u7aef\u53e3\u53f7\u3002</p> <p>\u8fd9 4 \u4e2a\u6b65\u9aa4\uff1a</p> <ul> <li>\u5ba2\u6237\u7aef\u9996\u5148\u53d1\u8d77 DHCP \u53d1\u73b0\u62a5\u6587\uff08DHCP DISCOVER\uff09 \u7684 IP \u6570\u636e\u62a5\uff0c\u7531\u4e8e\u5ba2\u6237\u7aef\u6ca1\u6709 IP \u5730\u5740\uff0c\u4e5f\u4e0d\u77e5\u9053 DHCP \u670d\u52a1\u5668\u7684\u5730\u5740\uff0c\u6240\u4ee5\u4f7f\u7528\u7684\u662f UDP \u5e7f\u64ad\u901a\u4fe1\uff0c\u5176\u4f7f\u7528\u7684\u5e7f\u64ad\u76ee\u7684\u5730\u5740\u662f 255.255.255.255\uff08\u7aef\u53e3 67\uff09\u5e76\u4e14\u4f7f\u7528 0.0.0.0\uff08\u7aef\u53e3 68\uff09\u4f5c\u4e3a\u6e90 IP \u5730\u5740\u3002DHCP \u5ba2\u6237\u7aef\u5c06\u8be5 IP \u6570\u636e\u62a5\u4f20\u9012\u7ed9\u94fe\u8def\u5c42\uff0c\u94fe\u8def\u5c42\u7136\u540e\u5c06\u5e27\u5e7f\u64ad\u5230\u6240\u6709\u7684\u7f51\u7edc\u4e2d\u8bbe\u5907\u3002</li> <li>DHCP \u670d\u52a1\u5668\u6536\u5230 DHCP \u53d1\u73b0\u62a5\u6587\u65f6\uff0c\u7528 DHCP \u63d0\u4f9b\u62a5\u6587\uff08DHCP OFFER\uff09 \u5411\u5ba2\u6237\u7aef\u505a\u51fa\u54cd\u5e94\u3002\u8be5\u62a5\u6587\u4ecd\u7136\u4f7f\u7528 IP \u5e7f\u64ad\u5730\u5740 255.255.255.255\uff0c\u8be5\u62a5\u6587\u4fe1\u606f\u643a\u5e26\u670d\u52a1\u5668\u63d0\u4f9b\u53ef\u79df\u7ea6\u7684 IP \u5730\u5740\u3001\u5b50\u7f51\u63a9\u7801\u3001\u9ed8\u8ba4\u7f51\u5173\u3001DNS \u670d\u52a1\u5668\u4ee5\u53ca IP \u5730\u5740\u79df\u7528\u671f\u3002</li> <li>\u5ba2\u6237\u7aef\u6536\u5230\u4e00\u4e2a\u6216\u591a\u4e2a\u670d\u52a1\u5668\u7684 DHCP \u63d0\u4f9b\u62a5\u6587\u540e\uff0c\u4ece\u4e2d\u9009\u62e9\u4e00\u4e2a\u670d\u52a1\u5668\uff0c\u5e76\u5411\u9009\u4e2d\u7684\u670d\u52a1\u5668\u53d1\u9001 DHCP \u8bf7\u6c42\u62a5\u6587\uff08DHCP REQUEST\u8fdb\u884c\u54cd\u5e94\uff0c\u56de\u663e\u914d\u7f6e\u7684\u53c2\u6570\u3002</li> <li>\u6700\u540e\uff0c\u670d\u52a1\u7aef\u7528 DHCP ACK \u62a5\u6587\u5bf9 DHCP \u8bf7\u6c42\u62a5\u6587\u8fdb\u884c\u54cd\u5e94\uff0c\u5e94\u7b54\u6240\u8981\u6c42\u7684\u53c2\u6570\u3002</li> </ul> <p>\u4e00\u65e6\u5ba2\u6237\u7aef\u6536\u5230 DHCP ACK \u540e\uff0c\u4ea4\u4e92\u4fbf\u5b8c\u6210\u4e86\uff0c\u5e76\u4e14\u5ba2\u6237\u7aef\u80fd\u591f\u5728\u79df\u7528\u671f\u5185\u4f7f\u7528 DHCP \u670d\u52a1\u5668\u5206\u914d\u7684 IP \u5730\u5740\u3002</p> <p>\u5982\u679c\u79df\u7ea6\u7684 DHCP IP \u5730\u5740\u5feb\u8fc7\u671f\u4e86\uff0c\u5ba2\u6237\u7aef\u4f1a\u5411\u670d\u52a1\u5668\u53d1\u9001 DHCP \u8bf7\u6c42\u62a5\u6587\uff1a</p> <ul> <li>\u670d\u52a1\u5668\u5982\u679c\u540c\u610f\u7ee7\u7eed\u79df\u7528\uff0c\u5219\u7528 DHCP ACK \u62a5\u6587\u8fdb\u884c\u5e94\u7b54\uff0c\u5ba2\u6237\u7aef\u5c31\u4f1a\u5ef6\u957f\u79df\u671f\u3002</li> <li>\u670d\u52a1\u5668\u5982\u679c\u4e0d\u540c\u610f\u7ee7\u7eed\u79df\u7528\uff0c\u5219\u7528 DHCP NACK \u62a5\u6587\uff0c\u5ba2\u6237\u7aef\u5c31\u8981\u505c\u6b62\u4f7f\u7528\u79df\u7ea6\u7684 IP \u5730\u5740\u3002</li> </ul> <p>\u53ef\u4ee5\u53d1\u73b0\uff0cDHCP \u4ea4\u4e92\u4e2d\uff0c\u5168\u7a0b\u90fd\u662f\u4f7f\u7528 UDP \u5e7f\u64ad\u901a\u4fe1\u3002</p> <p>\u54a6\uff0c\u7528\u7684\u662f\u5e7f\u64ad\uff0c\u90a3\u5982\u679c DHCP \u670d\u52a1\u5668\u548c\u5ba2\u6237\u7aef\u4e0d\u662f\u5728\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u5185\uff0c\u8def\u7531\u5668\u53c8\u4e0d\u4f1a\u8f6c\u53d1\u5e7f\u64ad\u5305\uff0c\u90a3\u4e0d\u662f\u6bcf\u4e2a\u7f51\u7edc\u90fd\u8981\u914d\u4e00\u4e2a DHCP \u670d\u52a1\u5668\uff1f</p> <p>\u6240\u4ee5\uff0c\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e00\u95ee\u9898\uff0c\u5c31\u51fa\u73b0\u4e86 DHCP \u4e2d\u7ee7\u4ee3\u7406\u3002\u6709\u4e86 DHCP \u4e2d\u7ee7\u4ee3\u7406\u4ee5\u540e\uff0c\u5bf9\u4e0d\u540c\u7f51\u6bb5\u7684 IP \u5730\u5740\u5206\u914d\u4e5f\u53ef\u4ee5\u7531\u4e00\u4e2a DHCP \u670d\u52a1\u5668\u7edf\u4e00\u8fdb\u884c\u7ba1\u7406\u3002</p> <p></p> <ul> <li> <p>DHCP \u5ba2\u6237\u7aef\u4f1a\u5411 DHCP \u4e2d\u7ee7\u4ee3\u7406\u53d1\u9001 DHCP \u8bf7\u6c42\u5305\uff0c\u800c DHCP \u4e2d\u7ee7\u4ee3\u7406\u5728\u6536\u5230\u8fd9\u4e2a\u5e7f\u64ad\u5305\u4ee5\u540e\uff0c\u518d\u4ee5\u5355\u64ad\u7684\u5f62\u5f0f\u53d1\u7ed9 DHCP \u670d\u52a1\u5668\u3002</p> </li> <li> <p>\u670d\u52a1\u5668\u7aef\u6536\u5230\u8be5\u5305\u4ee5\u540e\u518d\u5411 DHCP \u4e2d\u7ee7\u4ee3\u7406\u8fd4\u56de\u5e94\u7b54\uff0c\u5e76\u7531 DHCP \u4e2d\u7ee7\u4ee3\u7406\u5c06\u6b64\u5305\u5e7f\u64ad\u7ed9 DHCP \u5ba2\u6237\u7aef\u3002</p> </li> </ul> <p>\u56e0\u6b64\uff0cDHCP \u670d\u52a1\u5668\u5373\u4f7f\u4e0d\u5728\u540c\u4e00\u4e2a\u94fe\u8def\u4e0a\u4e5f\u53ef\u4ee5\u5b9e\u73b0\u7edf\u4e00\u5206\u914d\u548c\u7ba1\u7406 IP \u5730\u5740\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#nat","title":"NAT","text":"<p>IPv4 \u7684\u5730\u5740\u662f\u975e\u5e38\u7d27\u7f3a\u7684\uff0c\u5728\u524d\u9762\u6211\u4eec\u4e5f\u63d0\u5230\u53ef\u4ee5\u901a\u8fc7\u65e0\u5206\u7c7b\u5730\u5740\u6765\u51cf\u7f13 IPv4 \u5730\u5740\u8017\u5c3d\u7684\u901f\u5ea6\uff0c\u4f46\u662f\u4e92\u8054\u7f51\u7684\u7528\u6237\u589e\u901f\u662f\u975e\u5e38\u60ca\u4eba\u7684\uff0c\u6240\u4ee5 IPv4 \u5730\u5740\u4f9d\u7136\u6709\u88ab\u8017\u5c3d\u7684\u5371\u9669\u3002</p> <p>\u4e8e\u662f\uff0c\u63d0\u51fa\u4e86\u4e00\u79cd\u7f51\u7edc\u5730\u5740\u8f6c\u6362 NAT \u7684\u65b9\u6cd5\uff0c\u518d\u6b21\u7f13\u89e3\u4e86 IPv4 \u5730\u5740\u8017\u5c3d\u7684\u95ee\u9898\u3002</p> <p>\u7b80\u5355\u7684\u6765\u8bf4 NAT \u5c31\u662f\u540c\u4e2a\u516c\u53f8\u3001\u5bb6\u5ead\u3001\u6559\u5ba4\u5185\u7684\u4e3b\u673a\u5bf9\u5916\u90e8\u901a\u4fe1\u65f6\uff0c\u628a\u79c1\u6709 IP \u5730\u5740\u8f6c\u6362\u6210\u516c\u6709 IP \u5730\u5740\u3002</p> <p></p> <p>\u90a3\u4e0d\u662f N \u4e2a\u79c1\u6709 IP \u5730\u5740\uff0c\u4f60\u5c31\u8981 N \u4e2a\u516c\u6709 IP \u5730\u5740\uff1f\u8fd9\u600e\u4e48\u5c31\u7f13\u89e3\u4e86 IPv4 \u5730\u5740\u8017\u5c3d\u7684\u95ee\u9898\uff1f\u8fd9\u4e0d\u778e\u626f\u5417\uff1f</p> <p>\u786e\u5b9e\u662f\uff0c\u666e\u901a\u7684 NAT \u8f6c\u6362\u6ca1\u4ec0\u4e48\u610f\u4e49\u3002</p> <p>\u7531\u4e8e\u7edd\u5927\u591a\u6570\u7684\u7f51\u7edc\u5e94\u7528\u90fd\u662f\u4f7f\u7528\u4f20\u8f93\u5c42\u534f\u8bae TCP \u6216 UDP \u6765\u4f20\u8f93\u6570\u636e\u7684\u3002</p> <p>\u56e0\u6b64\uff0c\u53ef\u4ee5\u628a IP \u5730\u5740 + \u7aef\u53e3\u53f7\u4e00\u8d77\u8fdb\u884c\u8f6c\u6362\u3002</p> <p>\u8fd9\u6837\uff0c\u5c31\u7528\u4e00\u4e2a\u5168\u7403 IP \u5730\u5740\u5c31\u53ef\u4ee5\u4e86\uff0c\u8fd9\u79cd\u8f6c\u6362\u6280\u672f\u5c31\u53eb\u7f51\u7edc\u5730\u5740\u4e0e\u7aef\u53e3\u8f6c\u6362 NAPT\u3002</p> <p>\u5f88\u62bd\u8c61\uff1f\u6765\uff0c\u770b\u4e0b\u9762\u7684\u56fe\u89e3\u5c31\u80fd\u77ac\u95f4\u660e\u767d\u4e86\u3002</p> <p></p> <p>\u56fe\u4e2d\u6709\u4e24\u4e2a\u5ba2\u6237\u7aef 192.168.1.10 \u548c 192.168.1.11 \u540c\u65f6\u4e0e\u670d\u52a1\u5668 183.232.231.172 \u8fdb\u884c\u901a\u4fe1\uff0c\u5e76\u4e14\u8fd9\u4e24\u4e2a\u5ba2\u6237\u7aef\u7684\u672c\u5730\u7aef\u53e3\u90fd\u662f 1025\u3002</p> <p>\u6b64\u65f6\uff0c\u4e24\u4e2a\u79c1\u6709 IP \u5730\u5740\u90fd\u8f6c\u6362 IP \u5730\u5740\u4e3a\u516c\u6709\u5730\u5740 120.229.175.121\uff0c\u4f46\u662f\u4ee5\u4e0d\u540c\u7684\u7aef\u53e3\u53f7\u4f5c\u4e3a\u533a\u5206\u3002</p> <p>\u4e8e\u662f\uff0c\u751f\u6210\u4e00\u4e2a NAPT \u8def\u7531\u5668\u7684\u8f6c\u6362\u8868\uff0c\u5c31\u53ef\u4ee5\u6b63\u786e\u5730\u8f6c\u6362\u5730\u5740\u8ddf\u7aef\u53e3\u7684\u7ec4\u5408\uff0c\u4ee4\u5ba2\u6237\u7aef A\u3001B \u80fd\u540c\u65f6\u4e0e\u670d\u52a1\u5668\u4e4b\u95f4\u8fdb\u884c\u901a\u4fe1\u3002</p> <p>\u8fd9\u79cd\u8f6c\u6362\u8868\u5728 NAT \u8def\u7531\u5668\u4e0a\u81ea\u52a8\u751f\u6210\u3002\u4f8b\u5982\uff0c\u5728 TCP \u7684\u60c5\u51b5\u4e0b\uff0c\u5efa\u7acb TCP \u8fde\u63a5\u9996\u6b21\u63e1\u624b\u65f6\u7684 SYN \u5305\u4e00\u7ecf\u53d1\u51fa\uff0c\u5c31\u4f1a\u751f\u6210\u8fd9\u4e2a\u8868\u3002\u800c\u540e\u53c8\u968f\u7740\u6536\u5230\u5173\u95ed\u8fde\u63a5\u65f6\u53d1\u51fa FIN \u5305\u7684\u786e\u8ba4\u5e94\u7b54\u4ece\u8868\u4e2d\u88ab\u5220\u9664\u3002</p> <p>NAT \u90a3\u4e48\u725b\u903c\uff0c\u96be\u9053\u5c31\u6ca1\u7f3a\u70b9\u4e86\u5417\uff1f</p> <p>\u5f53\u7136\u6709\u7f3a\u9677\uff0c\u80af\u5b9a\u6ca1\u6709\u5341\u5168\u5341\u7f8e\u7684\u65b9\u6848\u3002</p> <p>\u7531\u4e8e NAT/NAPT \u90fd\u4f9d\u8d56\u4e8e\u81ea\u5df1\u7684\u8f6c\u6362\u8868\uff0c\u56e0\u6b64\u4f1a\u6709\u4ee5\u4e0b\u7684\u95ee\u9898\uff1a</p> <ul> <li>\u5916\u90e8\u65e0\u6cd5\u4e3b\u52a8\u4e0e NAT \u5185\u90e8\u670d\u52a1\u5668\u5efa\u7acb\u8fde\u63a5\uff0c\u56e0\u4e3a NAPT \u8f6c\u6362\u8868\u6ca1\u6709\u8f6c\u6362\u8bb0\u5f55\u3002</li> <li>\u8f6c\u6362\u8868\u7684\u751f\u6210\u4e0e\u8f6c\u6362\u64cd\u4f5c\u90fd\u4f1a\u4ea7\u751f\u6027\u80fd\u5f00\u9500\u3002</li> <li>\u901a\u4fe1\u8fc7\u7a0b\u4e2d\uff0c\u5982\u679c NAT \u8def\u7531\u5668\u91cd\u542f\u4e86\uff0c\u6240\u6709\u7684 TCP \u8fde\u63a5\u90fd\u5c06\u88ab\u91cd\u7f6e\u3002</li> </ul> <p>\u5982\u4f55\u89e3\u51b3 NAT \u6f5c\u5728\u7684\u95ee\u9898\u5462\uff1f</p> <p>\u89e3\u51b3\u7684\u65b9\u6cd5\u4e3b\u8981\u6709\u4e24\u79cd\u65b9\u6cd5\u3002</p> <p>\u7b2c\u4e00\u79cd\u5c31\u662f\u6539\u7528 IPv6</p> <p>IPv6 \u53ef\u7528\u8303\u56f4\u975e\u5e38\u5927\uff0c\u4ee5\u81f3\u4e8e\u6bcf\u53f0\u8bbe\u5907\u90fd\u53ef\u4ee5\u914d\u7f6e\u4e00\u4e2a\u516c\u6709 IP \u5730\u5740\uff0c\u5c31\u4e0d\u641e\u90a3\u4e48\u591a\u82b1\u91cc\u80e1\u54e8\u7684\u5730\u5740\u8f6c\u6362\u4e86\uff0c\u4f46\u662f IPv6 \u666e\u53ca\u901f\u5ea6\u8fd8\u9700\u8981\u4e00\u4e9b\u65f6\u95f4\u3002</p> <p>\u7b2c\u4e8c\u79cd NAT \u7a7f\u900f\u6280\u672f</p> <p>NAT \u7a7f\u900f\u6280\u672f\u62e5\u6709\u8fd9\u6837\u7684\u529f\u80fd\uff0c\u5b83\u80fd\u591f\u8ba9\u7f51\u7edc\u5e94\u7528\u7a0b\u5e8f\u4e3b\u52a8\u53d1\u73b0\u81ea\u5df1\u4f4d\u4e8e NAT \u8bbe\u5907\u4e4b\u540e\uff0c\u5e76\u4e14\u4f1a\u4e3b\u52a8\u83b7\u5f97 NAT \u8bbe\u5907\u7684\u516c\u6709 IP\uff0c\u5e76\u4e3a\u81ea\u5df1\u5efa\u7acb\u7aef\u53e3\u6620\u5c04\u6761\u76ee\uff0c\u6ce8\u610f\u8fd9\u4e9b\u90fd\u662f NAT \u8bbe\u5907\u540e\u7684\u5e94\u7528\u7a0b\u5e8f\u81ea\u52a8\u5b8c\u6210\u7684\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728 NAT \u7a7f\u900f\u6280\u672f\u4e2d\uff0cNAT \u8bbe\u5907\u540e\u7684\u5e94\u7528\u7a0b\u5e8f\u5904\u4e8e\u4e3b\u52a8\u5730\u4f4d\uff0c\u5b83\u5df2\u7ecf\u660e\u786e\u5730\u77e5\u9053 NAT \u8bbe\u5907\u8981\u4fee\u6539\u5b83\u5916\u53d1\u7684\u6570\u636e\u5305\uff0c\u4e8e\u662f\u5b83\u4e3b\u52a8\u914d\u5408 NAT \u8bbe\u5907\u7684\u64cd\u4f5c\uff0c\u4e3b\u52a8\u5730\u5efa\u7acb\u597d\u6620\u5c04\uff0c\u8fd9\u6837\u5c31\u4e0d\u50cf\u4ee5\u524d\u7531 NAT \u8bbe\u5907\u6765\u5efa\u7acb\u6620\u5c04\u4e86\u3002</p> <p>\u8bf4\u4eba\u8bdd\uff0c\u5c31\u662f\u5ba2\u6237\u7aef\u4e3b\u52a8\u4ece NAT \u8bbe\u5907\u83b7\u53d6\u516c\u6709 IP \u5730\u5740\uff0c\u7136\u540e\u81ea\u5df1\u5efa\u7acb\u7aef\u53e3\u6620\u5c04\u6761\u76ee\uff0c\u7136\u540e\u7528\u8fd9\u4e2a\u6761\u76ee\u5bf9\u5916\u901a\u4fe1\uff0c\u5c31\u4e0d\u9700\u8981 NAT \u8bbe\u5907\u6765\u8fdb\u884c\u8f6c\u6362\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#icmp","title":"ICMP","text":"<p>ICMP \u5168\u79f0\u662f Internet Control Message Protocol\uff0c\u4e5f\u5c31\u662f\u4e92\u8054\u7f51\u63a7\u5236\u62a5\u6587\u534f\u8bae\u3002</p> <p>\u91cc\u9762\u6709\u4e2a\u5173\u952e\u8bcd \u2014\u2014 \u63a7\u5236\uff0c\u5982\u4f55\u63a7\u5236\u7684\u5462\uff1f</p> <p>\u7f51\u7edc\u5305\u5728\u590d\u6742\u7684\u7f51\u7edc\u4f20\u8f93\u73af\u5883\u91cc\uff0c\u5e38\u5e38\u4f1a\u9047\u5230\u5404\u79cd\u95ee\u9898\u3002</p> <p>\u5f53\u9047\u5230\u95ee\u9898\u7684\u65f6\u5019\uff0c\u603b\u4e0d\u80fd\u6b7b\u4e2a\u4e0d\u660e\u4e0d\u767d\uff0c\u6ca1\u5934\u6ca1\u8111\u7684\u4f5c\u98ce\u4e0d\u662f\u8ba1\u7b97\u673a\u7f51\u7edc\u7684\u98ce\u683c\u3002\u6240\u4ee5\u9700\u8981\u4f20\u51fa\u6d88\u606f\uff0c\u62a5\u544a\u9047\u5230\u4e86\u4ec0\u4e48\u95ee\u9898\uff0c\u8fd9\u6837\u624d\u53ef\u4ee5\u8c03\u6574\u4f20\u8f93\u7b56\u7565\uff0c\u4ee5\u6b64\u6765\u63a7\u5236\u6574\u4e2a\u5c40\u9762\u3002</p> <p>ICMP \u529f\u80fd\u90fd\u6709\u5565\uff1f</p> <p><code>ICMP</code> \u4e3b\u8981\u7684\u529f\u80fd\u5305\u62ec\uff1a\u786e\u8ba4 IP \u5305\u662f\u5426\u6210\u529f\u9001\u8fbe\u76ee\u6807\u5730\u5740\u3001\u62a5\u544a\u53d1\u9001\u8fc7\u7a0b\u4e2d IP \u5305\u88ab\u5e9f\u5f03\u7684\u539f\u56e0\u548c\u6539\u5584\u7f51\u7edc\u8bbe\u7f6e\u7b49\u3002</p> <p>\u5728 <code>IP</code> \u901a\u4fe1\u4e2d\u5982\u679c\u67d0\u4e2a <code>IP</code> \u5305\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u672a\u80fd\u8fbe\u5230\u76ee\u6807\u5730\u5740\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5177\u4f53\u7684\u539f\u56e0\u5c06\u7531 ICMP \u8d1f\u8d23\u901a\u77e5\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u4f8b\u5b50\uff0c\u4e3b\u673a <code>A</code> \u5411\u4e3b\u673a <code>B</code> \u53d1\u9001\u4e86\u6570\u636e\u5305\uff0c\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u9014\u4e2d\u7684\u8def\u7531\u5668 <code>2</code> \u672a\u80fd\u53d1\u73b0\u4e3b\u673a <code>B</code> \u7684\u5b58\u5728\uff0c\u8fd9\u65f6\uff0c\u8def\u7531\u5668 <code>2</code> \u5c31\u4f1a\u5411\u4e3b\u673a <code>A</code> \u53d1\u9001\u4e00\u4e2a <code>ICMP</code> \u76ee\u6807\u4e0d\u53ef\u8fbe\u6570\u636e\u5305\uff0c\u8bf4\u660e\u53d1\u5f80\u4e3b\u673a <code>B</code> \u7684\u5305\u672a\u80fd\u6210\u529f\u3002</p> <p>ICMP \u7684\u8fd9\u79cd\u901a\u77e5\u6d88\u606f\u4f1a\u4f7f\u7528 <code>IP</code> \u8fdb\u884c\u53d1\u9001\u3002</p> <p>\u56e0\u6b64\uff0c\u4ece\u8def\u7531\u5668 <code>2</code> \u8fd4\u56de\u7684 ICMP \u5305\u4f1a\u6309\u7167\u5f80\u5e38\u7684\u8def\u7531\u63a7\u5236\u5148\u7ecf\u8fc7\u8def\u7531\u5668 <code>1</code> \u518d\u8f6c\u53d1\u7ed9\u4e3b\u673a <code>A</code> \u3002\u6536\u5230\u8be5 ICMP \u5305\u7684\u4e3b\u673a <code>A</code> \u5219\u5206\u89e3 ICMP \u7684\u9996\u90e8\u548c\u6570\u636e\u57df\u4ee5\u540e\u5f97\u77e5\u5177\u4f53\u53d1\u751f\u95ee\u9898\u7684\u539f\u56e0\u3002</p> <p>ICMP \u7c7b\u578b</p> <p>ICMP \u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a</p> <ul> <li>\u4e00\u7c7b\u662f\u7528\u4e8e\u8bca\u65ad\u7684\u67e5\u8be2\u6d88\u606f\uff0c\u4e5f\u5c31\u662f\u300c\u67e5\u8be2\u62a5\u6587\u7c7b\u578b\u300d</li> <li>\u53e6\u4e00\u7c7b\u662f\u901a\u77e5\u51fa\u9519\u539f\u56e0\u7684\u9519\u8bef\u6d88\u606f\uff0c\u4e5f\u5c31\u662f\u300c\u5dee\u9519\u62a5\u6587\u7c7b\u578b\u300d</li> </ul> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#igmp","title":"IGMP","text":"<p>ICMP \u8ddf IGMP \u662f\u4e00\u70b9\u5173\u7cfb\u90fd\u6ca1\u6709\u7684\uff0c\u5c31\u597d\u50cf\u5468\u6770\u4e0e\u5468\u6770\u4f26\u7684\u533a\u522b\uff0c\u5927\u5bb6\u4e0d\u8981\u6df7\u6dc6\u4e86\u3002</p> <p>\u5728\u524d\u9762\u6211\u4eec\u77e5\u9053\u4e86\u7ec4\u64ad\u5730\u5740\uff0c\u4e5f\u5c31\u662f D \u7c7b\u5730\u5740\uff0c\u65e2\u7136\u662f\u7ec4\u64ad\uff0c\u90a3\u5c31\u8bf4\u660e\u662f\u53ea\u6709\u4e00\u7ec4\u7684\u4e3b\u673a\u80fd\u6536\u5230\u6570\u636e\u5305\uff0c\u4e0d\u5728\u4e00\u7ec4\u7684\u4e3b\u673a\u4e0d\u80fd\u6536\u5230\u6570\u7ec4\u5305\uff0c\u600e\u4e48\u7ba1\u7406\u662f\u5426\u662f\u5728\u4e00\u7ec4\u5462\uff1f\u90a3\u4e48\uff0c\u5c31\u9700\u8981 <code>IGMP</code> \u534f\u8bae\u4e86\u3002</p> <p></p> <p>IGMP \u662f\u56e0\u7279\u7f51\u7ec4\u7ba1\u7406\u534f\u8bae\uff0c\u5de5\u4f5c\u5728\u4e3b\u673a\uff08\u7ec4\u64ad\u6210\u5458\uff09\u548c\u6700\u540e\u4e00\u8df3\u8def\u7531\u4e4b\u95f4\uff0c\u5982\u4e0a\u56fe\u4e2d\u7684\u84dd\u8272\u90e8\u5206\u3002</p> <ul> <li>IGMP \u62a5\u6587\u5411\u8def\u7531\u5668\u7533\u8bf7\u52a0\u5165\u548c\u9000\u51fa\u7ec4\u64ad\u7ec4\uff0c\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u8def\u7531\u5668\u662f\u4e0d\u4f1a\u8f6c\u53d1\u7ec4\u64ad\u5305\u5230\u8fde\u63a5\u4e2d\u7684\u4e3b\u673a\uff0c\u9664\u975e\u4e3b\u673a\u901a\u8fc7 IGMP \u52a0\u5165\u5230\u7ec4\u64ad\u7ec4\uff0c\u4e3b\u673a\u7533\u8bf7\u52a0\u5165\u5230\u7ec4\u64ad\u7ec4\u65f6\uff0c\u8def\u7531\u5668\u5c31\u4f1a\u8bb0\u5f55 IGMP \u8def\u7531\u5668\u8868\uff0c\u8def\u7531\u5668\u540e\u7eed\u5c31\u4f1a\u8f6c\u53d1\u7ec4\u64ad\u5305\u5230\u5bf9\u5e94\u7684\u4e3b\u673a\u4e86\u3002</li> <li>IGMP \u62a5\u6587\u91c7\u7528 IP \u5c01\u88c5\uff0cIP \u5934\u90e8\u7684\u534f\u8bae\u53f7\u4e3a 2\uff0c\u800c\u4e14 TTL \u5b57\u6bb5\u503c\u901a\u5e38\u4e3a 1\uff0c\u56e0\u4e3a IGMP \u662f\u5de5\u4f5c\u5728\u4e3b\u673a\u4e0e\u8fde\u63a5\u7684\u8def\u7531\u5668\u4e4b\u95f4\u3002</li> </ul> <p>IGMP \u5de5\u4f5c\u673a\u5236</p> <p>IGMP \u5206\u4e3a\u4e86\u4e09\u4e2a\u7248\u672c\u5206\u522b\u662f\uff0cIGMPv1\u3001IGMPv2\u3001IGMPv3\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u4ee5 <code>IGMPv2</code> \u4f5c\u4e3a\u4f8b\u5b50\uff0c\u8bf4\u8bf4\u5e38\u89c4\u67e5\u8be2\u4e0e\u54cd\u5e94\u548c\u79bb\u5f00\u7ec4\u64ad\u7ec4\u8fd9\u4e24\u4e2a\u5de5\u4f5c\u673a\u5236\u3002</p> <p>\u5e38\u89c4\u67e5\u8be2\u4e0e\u54cd\u5e94\u5de5\u4f5c\u673a\u5236</p> <p></p> <ol> <li>\u8def\u7531\u5668\u4f1a\u5468\u671f\u6027\u53d1\u9001\u76ee\u7684\u5730\u5740\u4e3a <code>224.0.0.1</code>\uff08\u8868\u793a\u540c\u4e00\u7f51\u6bb5\u5185\u6240\u6709\u4e3b\u673a\u548c\u8def\u7531\u5668\uff09 IGMP \u5e38\u89c4\u67e5\u8be2\u62a5\u6587\u3002</li> <li>\u4e3b\u673a 1 \u548c \u4e3b\u673a 3 \u6536\u5230\u8fd9\u4e2a\u67e5\u8be2\uff0c\u968f\u540e\u4f1a\u542f\u52a8\u300c\u62a5\u544a\u5ef6\u8fdf\u8ba1\u65f6\u5668\u300d\uff0c\u8ba1\u65f6\u5668\u7684\u65f6\u95f4\u662f\u968f\u673a\u7684\uff0c\u901a\u5e38\u662f 0~10 \u79d2\uff0c\u8ba1\u65f6\u5668\u8d85\u65f6\u540e\u4e3b\u673a\u5c31\u4f1a\u53d1\u9001 IGMP \u6210\u5458\u5173\u7cfb\u62a5\u544a\u62a5\u6587\uff08\u6e90 IP \u5730\u5740\u4e3a\u81ea\u5df1\u4e3b\u673a\u7684 IP \u5730\u5740\uff0c\u76ee\u7684 IP \u5730\u5740\u4e3a\u7ec4\u64ad\u5730\u5740\uff09\u3002\u5982\u679c\u5728\u5b9a\u65f6\u5668\u8d85\u65f6\u4e4b\u524d\uff0c\u6536\u5230\u540c\u4e00\u4e2a\u7ec4\u5185\u7684\u5176\u4ed6\u4e3b\u673a\u53d1\u9001\u7684\u6210\u5458\u5173\u7cfb\u62a5\u544a\u62a5\u6587\uff0c\u5219\u81ea\u5df1\u4e0d\u518d\u53d1\u9001\uff0c\u8fd9\u6837\u53ef\u4ee5\u51cf\u5c11\u7f51\u7edc\u4e2d\u591a\u4f59\u7684 IGMP \u62a5\u6587\u6570\u91cf\u3002</li> <li>\u8def\u7531\u5668\u6536\u5230\u4e3b\u673a\u7684\u6210\u5458\u5173\u7cfb\u62a5\u6587\u540e\uff0c\u5c31\u4f1a\u5728 IGMP \u8def\u7531\u8868\u4e2d\u52a0\u5165\u8be5\u7ec4\u64ad\u7ec4\uff0c\u540e\u7eed\u7f51\u7edc\u4e2d\u4e00\u65e6\u8be5\u7ec4\u64ad\u5730\u5740\u7684\u6570\u636e\u5230\u8fbe\u8def\u7531\u5668\uff0c\u5b83\u4f1a\u628a\u6570\u636e\u5305\u8f6c\u53d1\u51fa\u53bb\u3002</li> </ol> <p>\u79bb\u5f00\u7ec4\u64ad\u7ec4\u5de5\u4f5c\u673a\u5236</p> <p>\u79bb\u5f00\u7ec4\u64ad\u7ec4\u7684\u60c5\u51b5\u4e00\uff0c\u7f51\u6bb5\u4e2d\u4ecd\u6709\u8be5\u7ec4\u64ad\u7ec4\uff1a</p> <p></p> <ol> <li>\u4e3b\u673a 1 \u8981\u79bb\u5f00\u7ec4 224.1.1.1\uff0c\u53d1\u9001 IGMPv2 \u79bb\u7ec4\u62a5\u6587\uff0c\u62a5\u6587\u7684\u76ee\u7684\u5730\u5740\u662f 224.0.0.2\uff08\u8868\u793a\u53d1\u5411\u7f51\u6bb5\u5185\u7684\u6240\u6709\u8def\u7531\u5668\uff09</li> <li>\u8def\u7531\u5668 \u6536\u5230\u8be5\u62a5\u6587\u540e\uff0c\u4ee5 1 \u79d2\u4e3a\u95f4\u9694\u8fde\u7eed\u53d1\u9001 IGMP \u7279\u5b9a\u7ec4\u67e5\u8be2\u62a5\u6587\uff08\u5171\u8ba1\u53d1\u9001 2 \u4e2a\uff09\uff0c\u4ee5\u4fbf\u786e\u8ba4\u8be5\u7f51\u7edc\u662f\u5426\u8fd8\u6709 224.1.1.1 \u7ec4\u7684\u5176\u4ed6\u6210\u5458\u3002</li> <li>\u4e3b\u673a 3 \u4ecd\u7136\u662f\u7ec4 224.1.1.1 \u7684\u6210\u5458\uff0c\u56e0\u6b64\u5b83\u7acb\u5373\u54cd\u5e94\u8fd9\u4e2a\u7279\u5b9a\u7ec4\u67e5\u8be2\u3002\u8def\u7531\u5668\u77e5\u9053\u8be5\u7f51\u7edc\u4e2d\u4ecd\u7136\u5b58\u5728\u8be5\u7ec4\u64ad\u7ec4\u7684\u6210\u5458\uff0c\u4e8e\u662f\u7ee7\u7eed\u5411\u8be5\u7f51\u7edc\u8f6c\u53d1 224.1.1.1 \u7684\u7ec4\u64ad\u6570\u636e\u5305\u3002</li> </ol> <p>\u79bb\u5f00\u7ec4\u64ad\u7ec4\u7684\u60c5\u51b5\u4e8c\uff0c\u7f51\u6bb5\u4e2d\u6ca1\u6709\u8be5\u7ec4\u64ad\u7ec4\uff1a</p> <p></p> <ol> <li>\u4e3b\u673a 1 \u8981\u79bb\u5f00\u7ec4\u64ad\u7ec4 224.1.1.1\uff0c\u53d1\u9001 IGMP \u79bb\u7ec4\u62a5\u6587\u3002</li> <li>\u8def\u7531\u5668\u6536\u5230\u8be5\u62a5\u6587\u540e\uff0c\u4ee5 1 \u79d2\u4e3a\u95f4\u9694\u8fde\u7eed\u53d1\u9001 IGMP \u7279\u5b9a\u7ec4\u67e5\u8be2\u62a5\u6587\uff08\u5171\u8ba1\u53d1\u9001 2 \u4e2a\uff09\u3002\u6b64\u65f6\u5728\u8be5\u7f51\u6bb5\u5185\uff0c\u7ec4 224.1.1.1 \u5df2\u7ecf\u6ca1\u6709\u5176\u4ed6\u6210\u5458\u4e86\uff0c\u56e0\u6b64\u6ca1\u6709\u4e3b\u673a\u54cd\u5e94\u8fd9\u4e2a\u67e5\u8be2\u3002</li> <li>\u4e00\u5b9a\u65f6\u95f4\u540e\uff0c\u8def\u7531\u5668\u8ba4\u4e3a\u8be5\u7f51\u6bb5\u4e2d\u5df2\u7ecf\u6ca1\u6709 224.1.1.1 \u7ec4\u64ad\u7ec4\u6210\u5458\u4e86\uff0c\u5c06\u4e0d\u4f1a\u518d\u5411\u8fd9\u4e2a\u7f51\u6bb5\u8f6c\u53d1\u8be5\u7ec4\u64ad\u5730\u5740\u7684\u6570\u636e\u5305\u3002</li> </ol> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <p>[1] \u8ba1\u7b97\u673a\u7f51\u7edc - \u81ea\u9876\u5411\u4e0b\u65b9\u6cd5\u3002\u9648\u9e23 \u8bd1\u3002\u673a\u68b0\u5de5\u4e1a\u51fa\u7248\u793e</p> <p>[2] TCP/IP \u8be6\u89e3 \u5377 1\uff1a\u534f\u8bae\u3002\u8303\u5efa\u534e \u8bd1\u3002\u673a\u68b0\u5de5\u4e1a\u51fa\u7248\u793e</p> <p>[3] \u56fe\u89e3 TCP/IP.\u7af9\u4e0b\u9686\u53f2.\u4eba\u6c11\u90ae\u7535\u51fa\u7248\u793e</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ip_base/#_1","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u8bfb\u8005\u95ee\u9898\uff1a\u201c\u7ec4\u64ad\u4e0d\u592a\u61c2\u3002\u3002\u3002\u5047\u8bbe\u4e00\u53f0\u673a\u5668\u52a0\u5165\u7ec4\u64ad\u5730\u5740\uff0c\u9700\u8981\u628a IP \u6539\u6210\u7ec4\u64ad\u5730\u5740\u5417\uff1f\u5982\u679c\u79bb\u5f00\u67d0\u4e2a\u7ec4\u64ad\u5730\u5740\uff0c\u9700\u8981 dhcp \u91cd\u65b0\u8bf7\u6c42\u4e2a IP \u5417\uff1f\u201d</p> <p>\u7ec4\u64ad\u5730\u5740\u4e0d\u662f\u7528\u4e8e\u673a\u5668 ip \u5730\u5740\u7684\uff0c\u56e0\u4e3a\u7ec4\u64ad\u5730\u5740\u6ca1\u6709\u7f51\u7edc\u53f7\u548c\u4e3b\u673a\u53f7\uff0c\u6240\u4ee5\u8ddf dhcp \u6ca1\u5173\u7cfb\u3002\u7ec4\u64ad\u5730\u5740\u4e00\u822c\u662f\u7528\u4e8e udp \u534f\u8bae\uff0c\u673a\u5668\u53d1\u9001 UDP \u7ec4\u64ad\u6570\u636e\u65f6\uff0c\u76ee\u6807\u5730\u5740\u586b\u7684\u662f\u7ec4\u64ad\u5730\u5740\uff0c\u90a3\u4e48\u5728\u7ec4\u64ad\u7ec4\u5185\u7684\u673a\u5668\u90fd\u80fd\u6536\u5230\u6570\u636e\u5305\u3002</p> <p>\u662f\u5426\u52a0\u5165\u7ec4\u64ad\u7ec4\u548c\u79bb\u5f00\u7ec4\u64ad\u7ec4\uff0c\u662f\u7531 socket \u4e00\u4e2a\u63a5\u53e3\u5b9e\u73b0\u7684\uff0c\u4e3b\u673a ip \u662f\u4e0d\u7528\u6539\u53d8\u7684\u3002</p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u6211\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/","title":"5.2 ping \u7684\u5de5\u4f5c\u539f\u7406","text":"<p>\u5728\u65e5\u5e38\u751f\u6d3b\u6216\u5de5\u4f5c\u4e2d\uff0c\u6211\u4eec\u5728\u5224\u65ad\u4e0e\u5bf9\u65b9\u7f51\u7edc\u662f\u5426\u7545\u901a\uff0c\u4f7f\u7528\u7684\u6700\u591a\u7684\u83ab\u8fc7\u4e8e <code>ping</code> \u547d\u4ee4\u4e86\u3002</p> <p>\u201c\u90a3\u4f60\u77e5\u9053 <code>ping</code> \u662f\u5982\u4f55\u5de5\u4f5c\u7684\u5417\uff1f\u201d \u2014\u2014 \u6765\u81ea\u5c0f\u6797\u7684\u7075\u9b42\u62f7\u95ee</p> <p>\u53ef\u80fd\u6709\u7684\u5c0f\u4f19\u4f34\u5947\u602a\u7684\u95ee\uff1a\u201c\u6211\u867d\u7136\u4e0d\u660e\u767d\u5b83\u7684\u5de5\u4f5c\uff0c\u4f46 ping \u6211\u4e5f\u7528\u7684\u8d3c 6 \u554a\uff01\u201d</p> <p>\u4f60\u7528\u7684\u662f 6\uff0c\u4f46\u4f60\u5728\u9762\u8bd5\u5b98\u9762\u524d\uff0c\u4f60\u5c31 6 \u4e0d\u8d77\u6765\u4e86\uff0c\u6bd5\u7adf\u4ed6\u4eec\u4e5f\u7231\u95ee\u3002</p> <p>\u6240\u4ee5\uff0c\u6211\u4eec\u8981\u62b1\u6709\u300c\u77e5\u5176\u7136\uff0c\u77e5\u5176\u6240\u4ee5\u7136\u300d\u7684\u6001\u5ea6\uff0c\u8fd9\u6837\u5c31\u80fd\u907f\u514d\u9762\u8bd5\u8fc7\u7a0b\u4e2d\uff0c\u51fa\u95e8\u53f3\u62d0\u7684\u60c5\u51b5\u4e86\u3002</p> <p></p> <p>\u4e0d\u77e5\u9053\u7684\u5c0f\u4f19\u4f34\u4e5f\u6ca1\u5173\u7cfb\uff0c\u4eca\u5929\u6211\u4eec\u5c31\u6765\u641e\u5b9a\u5b83\uff0c\u641e\u61c2\u5b83\u3002\u6d88\u9664\u672c\u6b21\u7684\u95ee\u53f7\uff0c\u8ba9\u95ee\u53f7\u5c11\u4e00\u70b9\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#ip-icmp","title":"IP \u534f\u8bae\u7684\u52a9\u624b \u2014\u2014 ICMP \u534f\u8bae","text":"<p>ping \u662f\u57fa\u4e8e <code>ICMP</code> \u534f\u8bae\u5de5\u4f5c\u7684\uff0c\u6240\u4ee5\u8981\u660e\u767d ping \u7684\u5de5\u4f5c\uff0c\u9996\u5148\u6211\u4eec\u5148\u6765\u719f\u6089 ICMP \u534f\u8bae\u3002</p> <p>ICMP \u662f\u4ec0\u4e48\uff1f</p> <p>ICMP \u5168\u79f0\u662f Internet Control Message Protocol\uff0c\u4e5f\u5c31\u662f\u4e92\u8054\u7f51\u63a7\u5236\u62a5\u6587\u534f\u8bae\u3002</p> <p>\u91cc\u9762\u6709\u4e2a\u5173\u952e\u8bcd \u2014\u2014 \u63a7\u5236\uff0c\u5982\u4f55\u63a7\u5236\u7684\u5462\uff1f</p> <p>\u7f51\u7edc\u5305\u5728\u590d\u6742\u7684\u7f51\u7edc\u4f20\u8f93\u73af\u5883\u91cc\uff0c\u5e38\u5e38\u4f1a\u9047\u5230\u5404\u79cd\u95ee\u9898\u3002\u5f53\u9047\u5230\u95ee\u9898\u7684\u65f6\u5019\uff0c\u603b\u4e0d\u80fd\u6b7b\u7684\u4e0d\u660e\u4e0d\u767d\uff0c\u6ca1\u5934\u6ca1\u8111\u7684\u4f5c\u98ce\u4e0d\u662f\u8ba1\u7b97\u673a\u7f51\u7edc\u7684\u98ce\u683c\u3002\u6240\u4ee5\u9700\u8981\u4f20\u51fa\u6d88\u606f\uff0c\u62a5\u544a\u9047\u5230\u4e86\u4ec0\u4e48\u95ee\u9898\uff0c\u8fd9\u6837\u624d\u53ef\u4ee5\u8c03\u6574\u4f20\u8f93\u7b56\u7565\uff0c\u4ee5\u6b64\u6765\u63a7\u5236\u6574\u4e2a\u5c40\u9762\u3002</p> <p>ICMP \u529f\u80fd\u90fd\u6709\u5565\uff1f</p> <p><code>ICMP</code> \u4e3b\u8981\u7684\u529f\u80fd\u5305\u62ec\uff1a\u786e\u8ba4 IP \u5305\u662f\u5426\u6210\u529f\u9001\u8fbe\u76ee\u6807\u5730\u5740\u3001\u62a5\u544a\u53d1\u9001\u8fc7\u7a0b\u4e2d IP \u5305\u88ab\u5e9f\u5f03\u7684\u539f\u56e0\u548c\u6539\u5584\u7f51\u7edc\u8bbe\u7f6e\u7b49\u3002</p> <p>\u5728 <code>IP</code> \u901a\u4fe1\u4e2d\u5982\u679c\u67d0\u4e2a <code>IP</code> \u5305\u56e0\u4e3a\u67d0\u79cd\u539f\u56e0\u672a\u80fd\u8fbe\u5230\u76ee\u6807\u5730\u5740\uff0c\u90a3\u4e48\u8fd9\u4e2a\u5177\u4f53\u7684\u539f\u56e0\u5c06\u7531 ICMP \u8d1f\u8d23\u901a\u77e5\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u4f8b\u5b50\uff0c\u4e3b\u673a <code>A</code> \u5411\u4e3b\u673a <code>B</code> \u53d1\u9001\u4e86\u6570\u636e\u5305\uff0c\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u9014\u4e2d\u7684\u8def\u7531\u5668 <code>2</code> \u672a\u80fd\u53d1\u73b0\u4e3b\u673a <code>B</code> \u7684\u5b58\u5728\uff0c\u8fd9\u65f6\uff0c\u8def\u7531\u5668 <code>2</code> \u5c31\u4f1a\u5411\u4e3b\u673a <code>A</code> \u53d1\u9001\u4e00\u4e2a <code>ICMP</code> \u76ee\u6807\u4e0d\u53ef\u8fbe\u6570\u636e\u5305\uff0c\u8bf4\u660e\u53d1\u5f80\u4e3b\u673a <code>B</code> \u7684\u5305\u672a\u80fd\u6210\u529f\u3002</p> <p>ICMP \u7684\u8fd9\u79cd\u901a\u77e5\u6d88\u606f\u4f1a\u4f7f\u7528 <code>IP</code> \u8fdb\u884c\u53d1\u9001\u3002</p> <p>\u56e0\u6b64\uff0c\u4ece\u8def\u7531\u5668 <code>2</code> \u8fd4\u56de\u7684 ICMP \u5305\u4f1a\u6309\u7167\u5f80\u5e38\u7684\u8def\u7531\u63a7\u5236\u5148\u7ecf\u8fc7\u8def\u7531\u5668 <code>1</code> \u518d\u8f6c\u53d1\u7ed9\u4e3b\u673a <code>A</code> \u3002\u6536\u5230\u8be5 ICMP \u5305\u7684\u4e3b\u673a <code>A</code> \u5219\u5206\u89e3 ICMP \u7684\u9996\u90e8\u548c\u6570\u636e\u57df\u4ee5\u540e\u5f97\u77e5\u5177\u4f53\u53d1\u751f\u95ee\u9898\u7684\u539f\u56e0\u3002</p> <p>ICMP \u5305\u5934\u683c\u5f0f</p> <p>ICMP \u62a5\u6587\u662f\u5c01\u88c5\u5728 IP \u5305\u91cc\u9762\uff0c\u5b83\u5de5\u4f5c\u5728\u7f51\u7edc\u5c42\uff0c\u662f IP \u534f\u8bae\u7684\u52a9\u624b\u3002</p> <p></p> <p>ICMP \u5305\u5934\u7684\u7c7b\u578b\u5b57\u6bb5\uff0c\u5927\u81f4\u53ef\u4ee5\u5206\u4e3a\u4e24\u5927\u7c7b\uff1a</p> <ul> <li>\u4e00\u7c7b\u662f\u7528\u4e8e\u8bca\u65ad\u7684\u67e5\u8be2\u6d88\u606f\uff0c\u4e5f\u5c31\u662f\u300c\u67e5\u8be2\u62a5\u6587\u7c7b\u578b\u300d</li> <li>\u53e6\u4e00\u7c7b\u662f\u901a\u77e5\u51fa\u9519\u539f\u56e0\u7684\u9519\u8bef\u6d88\u606f\uff0c\u4e5f\u5c31\u662f\u300c\u5dee\u9519\u62a5\u6587\u7c7b\u578b\u300d</li> </ul> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#_1","title":"\u67e5\u8be2\u62a5\u6587\u7c7b\u578b","text":"<p>\u56de\u9001\u6d88\u606f \u2014\u2014 \u7c7b\u578b <code>0</code> \u548c <code>8</code></p> <p>\u56de\u9001\u6d88\u606f\u7528\u4e8e\u8fdb\u884c\u901a\u4fe1\u7684\u4e3b\u673a\u6216\u8def\u7531\u5668\u4e4b\u95f4\uff0c\u5224\u65ad\u6240\u53d1\u9001\u7684\u6570\u636e\u5305\u662f\u5426\u5df2\u7ecf\u6210\u529f\u5230\u8fbe\u5bf9\u7aef\u7684\u4e00\u79cd\u6d88\u606f\uff0c<code>ping</code> \u547d\u4ee4\u5c31\u662f\u5229\u7528\u8fd9\u4e2a\u6d88\u606f\u5b9e\u73b0\u7684\u3002</p> <p></p> <p>\u53ef\u4ee5\u5411\u5bf9\u7aef\u4e3b\u673a\u53d1\u9001\u56de\u9001\u8bf7\u6c42\u7684\u6d88\u606f\uff08<code>ICMP Echo Request Message</code>\uff0c\u7c7b\u578b <code>8</code>\uff09\uff0c\u4e5f\u53ef\u4ee5\u63a5\u6536\u5bf9\u7aef\u4e3b\u673a\u53d1\u56de\u6765\u7684\u56de\u9001\u5e94\u7b54\u6d88\u606f\uff08<code>ICMP Echo Reply Message</code>\uff0c\u7c7b\u578b <code>0</code>\uff09\u3002</p> <p></p> <p>\u76f8\u6bd4\u539f\u751f\u7684 ICMP\uff0c\u8fd9\u91cc\u591a\u4e86\u4e24\u4e2a\u5b57\u6bb5\uff1a</p> <ul> <li>\u6807\u8bc6\u7b26\uff1a\u7528\u4ee5\u533a\u5206\u662f\u54ea\u4e2a\u5e94\u7528\u7a0b\u5e8f\u53d1 ICMP \u5305\uff0c\u6bd4\u5982\u7528\u8fdb\u7a0b <code>PID</code> \u4f5c\u4e3a\u6807\u8bc6\u7b26\uff1b</li> <li>\u5e8f\u53f7\uff1a\u5e8f\u5217\u53f7\u4ece <code>0</code> \u5f00\u59cb\uff0c\u6bcf\u53d1\u9001\u4e00\u6b21\u65b0\u7684\u56de\u9001\u8bf7\u6c42\u5c31\u4f1a\u52a0 <code>1</code>\uff0c\u53ef\u4ee5\u7528\u6765\u786e\u8ba4\u7f51\u7edc\u5305\u662f\u5426\u6709\u4e22\u5931\u3002</li> </ul> <p>\u5728\u9009\u9879\u6570\u636e\u4e2d\uff0c<code>ping</code> \u8fd8\u4f1a\u5b58\u653e\u53d1\u9001\u8bf7\u6c42\u7684\u65f6\u95f4\u503c\uff0c\u6765\u8ba1\u7b97\u5f80\u8fd4\u65f6\u95f4\uff0c\u8bf4\u660e\u8def\u7a0b\u7684\u957f\u77ed\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#_2","title":"\u5dee\u9519\u62a5\u6587\u7c7b\u578b","text":"<p>\u63a5\u4e0b\u6765\uff0c\u8bf4\u660e\u51e0\u4e2a\u5e38\u7528\u7684 ICMP \u5dee\u9519\u62a5\u6587\u7684\u4f8b\u5b50\uff1a</p> <ul> <li>\u76ee\u6807\u4e0d\u53ef\u8fbe\u6d88\u606f \u2014\u2014 \u7c7b\u578b \u4e3a <code>3</code></li> <li>\u539f\u70b9\u6291\u5236\u6d88\u606f \u2014\u2014 \u7c7b\u578b <code>4</code></li> <li>\u91cd\u5b9a\u5411\u6d88\u606f \u2014\u2014 \u7c7b\u578b <code>5</code></li> <li>\u8d85\u65f6\u6d88\u606f \u2014\u2014 \u7c7b\u578b <code>11</code></li> </ul> <p>\u76ee\u6807\u4e0d\u53ef\u8fbe\u6d88\u606f\uff08Destination Unreachable Message\uff09 \u2014\u2014 \u7c7b\u578b\u4e3a <code>3</code></p> <p>IP \u8def\u7531\u5668\u65e0\u6cd5\u5c06 IP \u6570\u636e\u5305\u53d1\u9001\u7ed9\u76ee\u6807\u5730\u5740\u65f6\uff0c\u4f1a\u7ed9\u53d1\u9001\u7aef\u4e3b\u673a\u8fd4\u56de\u4e00\u4e2a\u76ee\u6807\u4e0d\u53ef\u8fbe\u7684 ICMP \u6d88\u606f\uff0c\u5e76\u5728\u8fd9\u4e2a\u6d88\u606f\u4e2d\u663e\u793a\u4e0d\u53ef\u8fbe\u7684\u5177\u4f53\u539f\u56e0\uff0c\u539f\u56e0\u8bb0\u5f55\u5728 ICMP \u5305\u5934\u7684\u4ee3\u7801\u5b57\u6bb5\u3002</p> <p>\u7531\u6b64\uff0c\u6839\u636e ICMP \u4e0d\u53ef\u8fbe\u7684\u5177\u4f53\u6d88\u606f\uff0c\u53d1\u9001\u7aef\u4e3b\u673a\u4e5f\u5c31\u53ef\u4ee5\u4e86\u89e3\u6b64\u6b21\u53d1\u9001\u4e0d\u53ef\u8fbe\u7684\u5177\u4f53\u539f\u56e0\u3002</p> <p>\u4e3e\u4f8b 6 \u79cd\u5e38\u89c1\u7684\u76ee\u6807\u4e0d\u53ef\u8fbe\u7c7b\u578b\u7684\u4ee3\u7801\uff1a</p> <p></p> <ul> <li>\u7f51\u7edc\u4e0d\u53ef\u8fbe\u4ee3\u7801\u4e3a <code>0</code></li> <li>\u4e3b\u673a\u4e0d\u53ef\u8fbe\u4ee3\u7801\u4e3a <code>1</code></li> <li>\u534f\u8bae\u4e0d\u53ef\u8fbe\u4ee3\u7801\u4e3a <code>2</code></li> <li>\u7aef\u53e3\u4e0d\u53ef\u8fbe\u4ee3\u7801\u4e3a <code>3</code></li> <li>\u9700\u8981\u8fdb\u884c\u5206\u7247\u4f46\u8bbe\u7f6e\u4e86\u4e0d\u5206\u7247\u4f4d\u4ee3\u7801\u4e3a <code>4</code></li> </ul> <p>\u4e3a\u4e86\u7ed9\u5927\u5bb6\u8bf4\u6e05\u695a\u4e0a\u9762\u7684\u76ee\u6807\u4e0d\u53ef\u8fbe\u7684\u539f\u56e0\uff0c\u5c0f\u6797\u727a\u7272\u81ea\u5df1\u7ed9\u5927\u5bb6\u9001 5 \u6b21\u5916\u5356\u3002</p> <p>\u4e3a\u4ec0\u4e48\u8981\u9001\u5916\u5356\uff1f\u522b\u95ee\uff0c\u95ee\u5c31\u662f\u4e3a <code>35</code> \u5c81\u7684\u8001\u6797\u505a\u51c6\u5907 ...</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#a-0","title":"a. \u7f51\u7edc\u4e0d\u53ef\u8fbe\u4ee3\u7801\u4e3a 0","text":"<p>\u5916\u5356\u7248\u672c\uff1a</p> <p>\u5c0f\u6797\u7b2c\u4e00\u6b21\u9001\u5916\u5356\u65f6\uff0c\u5c0f\u533a\u91cc\u53ea\u6709 A \u548c B \u533a\u4e24\u680b\u697c\uff0c\u4f46\u9001\u9910\u5730\u5740\u5199\u7684\u662f C \u533a\u697c\uff0c\u5c0f\u6797\u8868\u793a\u5934\u4e0a\u5f88\u591a\u95ee\u53f7\uff0c\u538b\u6839\u5c31\u6ca1\u8fd9\u4e2a\u5730\u65b9\u3002</p> <p>\u6b63\u5e38\u7248\u672c\uff1a</p> <p>IP \u5730\u5740\u662f\u5206\u4e3a\u7f51\u7edc\u53f7\u548c\u4e3b\u673a\u53f7\u7684\uff0c\u6240\u4ee5\u5f53\u8def\u7531\u5668\u4e2d\u7684\u8def\u7531\u5668\u8868\u5339\u914d\u4e0d\u5230\u63a5\u6536\u65b9 IP \u7684\u7f51\u7edc\u53f7\uff0c\u5c31\u901a\u8fc7 ICMP \u534f\u8bae\u4ee5\u7f51\u7edc\u4e0d\u53ef\u8fbe\uff08<code>Network Unreachable</code>\uff09\u7684\u539f\u56e0\u544a\u77e5\u4e3b\u673a\u3002</p> <p>\u81ea\u4ece\u4e0d\u518d\u6709\u7f51\u7edc\u5206\u7c7b\u4ee5\u540e\uff0c\u7f51\u7edc\u4e0d\u53ef\u8fbe\u4e5f\u6e10\u6e10\u4e0d\u518d\u4f7f\u7528\u4e86\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#b-1","title":"b. \u4e3b\u673a\u4e0d\u53ef\u8fbe\u4ee3\u7801\u4e3a 1","text":"<p>\u5916\u5356\u7248\u672c\uff1a</p> <p>\u5c0f\u6797\u7b2c\u4e8c\u6b21\u9001\u5916\u5356\u65f6\uff0c\u8fd9\u6b21\u5c0f\u533a\u6709 5 \u5c42\u697c\u9ad8\u7684 C \u533a\u697c\u4e86\uff0c\u627e\u5230\u5730\u65b9\u4e86\uff0c\u4f46\u9001\u9910\u5730\u5740\u5199\u7684\u662f C \u533a\u697c 601 \u53f7\u623f\uff0c\u8bf4\u660e\u627e\u4e0d\u5230\u8fd9\u4e2a\u623f\u95f4\u3002</p> <p>\u6b63\u5e38\u7248\u672c\uff1a</p> <p>\u5f53\u8def\u7531\u8868\u4e2d\u6ca1\u6709\u8be5\u4e3b\u673a\u7684\u4fe1\u606f\uff0c\u6216\u8005\u8be5\u4e3b\u673a\u6ca1\u6709\u8fde\u63a5\u5230\u7f51\u7edc\uff0c\u90a3\u4e48\u4f1a\u901a\u8fc7 ICMP \u534f\u8bae\u4ee5\u4e3b\u673a\u4e0d\u53ef\u8fbe\uff08<code>Host Unreachable</code>\uff09\u7684\u539f\u56e0\u544a\u77e5\u4e3b\u673a\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#c-2","title":"c. \u534f\u8bae\u4e0d\u53ef\u8fbe\u4ee3\u7801\u4e3a 2","text":"<p>\u5916\u5356\u7248\u672c\uff1a</p> <p>\u5c0f\u6797\u7b2c\u4e09\u6b21\u9001\u5916\u5356\u65f6\uff0c\u8fd9\u6b21\u5c0f\u533a\u6709 C \u533a\u697c\uff0c\u4e5f\u6709 601 \u53f7\u623f\uff0c\u627e\u5230\u5730\u65b9\u4e86\uff0c\u4e5f\u627e\u5230\u623f\u95f4\u4e86\uff0c\u4f46\u662f\u4e00\u5f00\u95e8\u4eba\u5bb6\u662f\u5916\u56fd\u4eba\u8bf4\u7684\u662f\u82f1\u8bed\uff0c\u6211\u8bf4\u7684\u662f\u4e2d\u6587\uff01\u8bed\u8a00\u4e0d\u901a\uff0c\u5916\u5356\u9001\u8fbe\u5931\u8d25~</p> <p>\u6b63\u5e38\u7248\u672c\uff1a</p> <p>\u5f53\u4e3b\u673a\u4f7f\u7528 TCP \u534f\u8bae\u8bbf\u95ee\u5bf9\u7aef\u4e3b\u673a\u65f6\uff0c\u80fd\u627e\u5230\u5bf9\u7aef\u7684\u4e3b\u673a\u4e86\uff0c\u53ef\u662f\u5bf9\u7aef\u4e3b\u673a\u7684\u9632\u706b\u5899\u5df2\u7ecf\u7981\u6b62 TCP \u534f\u8bae\u8bbf\u95ee\uff0c\u90a3\u4e48\u4f1a\u901a\u8fc7 ICMP \u534f\u8bae\u4ee5\u534f\u8bae\u4e0d\u53ef\u8fbe\u7684\u539f\u56e0\u544a\u77e5\u4e3b\u673a\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#d-3","title":"d. \u7aef\u53e3\u4e0d\u53ef\u8fbe\u4ee3\u7801\u4e3a 3","text":"<p>\u5916\u5356\u7248\u672c\uff1a</p> <p>\u5c0f\u6797\u7b2c\u56db\u6b21\u9001\u5916\u5356\u65f6\uff0c\u8fd9\u6b21\u5c0f\u533a\u6709 C \u533a\u697c\uff0c\u4e5f\u6709 601 \u53f7\u623f\uff0c\u627e\u5230\u5730\u65b9\u4e86\uff0c\u4e5f\u627e\u5230\u623f\u95f4\u4e86\uff0c\u623f\u95f4\u91cc\u7684\u4eba\u4e5f\u662f\u8bf4\u4e2d\u6587\u7684\u4eba\u4e86\uff0c\u4f46\u662f\u4eba\u5bb6\u8bf4\u4ed6\u8981\u7684\u4e0d\u662f\u5916\u5356\uff0c\u800c\u662f\u5feb\u9012\u3002\u3002\u3002</p> <p>\u6b63\u5e38\u7248\u672c\uff1a</p> <p>\u5f53\u4e3b\u673a\u8bbf\u95ee\u5bf9\u7aef\u4e3b\u673a 8080 \u7aef\u53e3\u65f6\uff0c\u8fd9\u6b21\u80fd\u627e\u5230\u5bf9\u7aef\u4e3b\u673a\u4e86\uff0c\u9632\u706b\u5899\u4e5f\u6ca1\u6709\u9650\u5236\uff0c\u53ef\u662f\u53d1\u73b0\u5bf9\u7aef\u4e3b\u673a\u6ca1\u6709\u8fdb\u7a0b\u76d1\u542c 8080 \u7aef\u53e3\uff0c\u90a3\u4e48\u4f1a\u901a\u8fc7 ICMP \u534f\u8bae\u4ee5\u7aef\u53e3\u4e0d\u53ef\u8fbe\u7684\u539f\u56e0\u544a\u77e5\u4e3b\u673a\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#e-4","title":"e. \u9700\u8981\u8fdb\u884c\u5206\u7247\u4f46\u8bbe\u7f6e\u4e86\u4e0d\u5206\u7247\u4f4d\u4ee3\u7801\u4e3a 4","text":"<p>\u5916\u5356\u7248\u672c\uff1a</p> <p>\u5c0f\u6797\u7b2c\u4e94\u6b21\u9001\u5916\u5356\u65f6\uff0c\u8fd9\u6b21\u662f\u4e2a\u5403\u64ad\u535a\u4e3b\u70b9\u4e86 100 \u4efd\u5916\u5356\uff0c\u4f46\u662f\u5403\u64ad\u535a\u4e3b\u8981\u6c42\u4e00\u6b21\u6027\u8981\u628a\u5168\u90e8\u5916\u5356\u9001\u8fbe\uff0c\u5c0f\u6797\u7684\u4e00\u53f0\u7535\u52a8\u8f66\u88c5\u4e0d\u4e0b\u5440\uff0c\u8fd9\u6837\u5c31\u6ca1\u529e\u6cd5\u9001\u8fbe\u4e86\u3002</p> <p>\u6b63\u5e38\u7248\u672c\uff1a</p> <p>\u53d1\u9001\u7aef\u4e3b\u673a\u53d1\u9001 IP \u6570\u636e\u62a5\u65f6\uff0c\u5c06 IP \u9996\u90e8\u7684\u5206\u7247\u7981\u6b62\u6807\u5fd7\u4f4d\u8bbe\u7f6e\u4e3a<code>1</code>\u3002\u6839\u636e\u8fd9\u4e2a\u6807\u5fd7\u4f4d\uff0c\u9014\u4e2d\u7684\u8def\u7531\u5668\u9047\u5230\u8d85\u8fc7 MTU \u5927\u5c0f\u7684\u6570\u636e\u5305\u65f6\uff0c\u4e0d\u4f1a\u8fdb\u884c\u5206\u7247\uff0c\u800c\u662f\u76f4\u63a5\u629b\u5f03\u3002</p> <p>\u968f\u540e\uff0c\u901a\u8fc7\u4e00\u4e2a ICMP \u7684\u4e0d\u53ef\u8fbe\u6d88\u606f\u7c7b\u578b\uff0c\u4ee3\u7801\u4e3a 4 \u7684\u62a5\u6587\uff0c\u544a\u77e5\u53d1\u9001\u7aef\u4e3b\u673a\u3002</p> <p>\u539f\u70b9\u6291\u5236\u6d88\u606f\uff08ICMP Source Quench Message\uff09 \u2014\u2014 \u7c7b\u578b <code>4</code></p> <p>\u5728\u4f7f\u7528\u4f4e\u901f\u5e7f\u57df\u7ebf\u8def\u7684\u60c5\u51b5\u4e0b\uff0c\u8fde\u63a5 WAN \u7684\u8def\u7531\u5668\u53ef\u80fd\u4f1a\u9047\u5230\u7f51\u7edc\u62e5\u5835\u7684\u95ee\u9898\u3002</p> <p><code>ICMP</code> \u539f\u70b9\u6291\u5236\u6d88\u606f\u7684\u76ee\u7684\u5c31\u662f\u4e3a\u4e86\u7f13\u548c\u8fd9\u79cd\u62e5\u5835\u60c5\u51b5\u3002</p> <p>\u5f53\u8def\u7531\u5668\u5411\u4f4e\u901f\u7ebf\u8def\u53d1\u9001\u6570\u636e\u65f6\uff0c\u5176\u53d1\u9001\u961f\u5217\u7684\u7f13\u5b58\u53d8\u4e3a\u96f6\u800c\u65e0\u6cd5\u53d1\u9001\u51fa\u53bb\u65f6\uff0c\u53ef\u4ee5\u5411 IP \u5305\u7684\u6e90\u5730\u5740\u53d1\u9001\u4e00\u4e2a ICMP \u539f\u70b9\u6291\u5236\u6d88\u606f\u3002</p> <p>\u6536\u5230\u8fd9\u4e2a\u6d88\u606f\u7684\u4e3b\u673a\u501f\u6b64\u4e86\u89e3\u5728\u6574\u4e2a\u7ebf\u8def\u7684\u67d0\u4e00\u5904\u53d1\u751f\u4e86\u62e5\u5835\u7684\u60c5\u51b5\uff0c\u4ece\u800c\u589e\u5927 IP \u5305\u7684\u4f20\u8f93\u95f4\u9694\uff0c\u51cf\u5c11\u7f51\u7edc\u62e5\u5835\u7684\u60c5\u51b5\u3002</p> <p>\u7136\u800c\uff0c\u7531\u4e8e\u8fd9\u79cd ICMP \u53ef\u80fd\u4f1a\u5f15\u8d77\u4e0d\u516c\u5e73\u7684\u7f51\u7edc\u901a\u4fe1\uff0c\u4e00\u822c\u4e0d\u88ab\u4f7f\u7528\u3002</p> <p>\u91cd\u5b9a\u5411\u6d88\u606f\uff08ICMP Redirect Message\uff09 \u2014\u2014 \u7c7b\u578b <code>5</code></p> <p>\u5982\u679c\u8def\u7531\u5668\u53d1\u73b0\u53d1\u9001\u7aef\u4e3b\u673a\u4f7f\u7528\u4e86\u300c\u4e0d\u662f\u6700\u4f18\u300d\u7684\u8def\u5f84\u53d1\u9001\u6570\u636e\uff0c\u90a3\u4e48\u5b83\u4f1a\u8fd4\u56de\u4e00\u4e2a ICMP \u91cd\u5b9a\u5411\u6d88\u606f\u7ed9\u8fd9\u4e2a\u4e3b\u673a\u3002</p> <p>\u5728\u8fd9\u4e2a\u6d88\u606f\u4e2d\u5305\u542b\u4e86\u6700\u5408\u9002\u7684\u8def\u7531\u4fe1\u606f\u548c\u6e90\u6570\u636e\u3002\u8fd9\u4e3b\u8981\u53d1\u751f\u5728\u8def\u7531\u5668\u6301\u6709\u66f4\u597d\u7684\u8def\u7531\u4fe1\u606f\u7684\u60c5\u51b5\u4e0b\u3002\u8def\u7531\u5668\u4f1a\u901a\u8fc7\u8fd9\u6837\u7684 ICMP \u6d88\u606f\u544a\u77e5\u53d1\u9001\u7aef\uff0c\u8ba9\u5b83\u4e0b\u6b21\u53d1\u7ed9\u53e6\u5916\u4e00\u4e2a\u8def\u7531\u5668\u3002</p> <p>\u597d\u6bd4\uff0c\u5c0f\u6797\u672c\u53ef\u4ee5\u8fc7\u6761\u9a6c\u8def\u5c31\u80fd\u5230\u7684\u5730\u65b9\uff0c\u4f46\u5c0f\u6797\u4e0d\u77e5\u9053\uff0c\u6240\u4ee5\u7ed5\u4e86\u4e00\u5708\u624d\u5230\uff0c\u540e\u9762\u5c0f\u6797\u77e5\u9053\u540e\uff0c\u4e0b\u6b21\u5c0f\u6797\u5c31\u4e0d\u4f1a\u90a3\u4e48\u50bb\u518d\u7ed5\u4e00\u5708\u4e86\u3002</p> <p>\u8d85\u65f6\u6d88\u606f\uff08ICMP Time Exceeded Message\uff09 \u2014\u2014 \u7c7b\u578b <code>11</code></p> <p>IP \u5305\u4e2d\u6709\u4e00\u4e2a\u5b57\u6bb5\u53eb\u505a <code>TTL</code> \uff08<code>Time To Live</code>\uff0c\u751f\u5b58\u5468\u671f\uff09\uff0c\u5b83\u7684\u503c\u968f\u7740\u6bcf\u7ecf\u8fc7\u4e00\u6b21\u8def\u7531\u5668\u5c31\u4f1a\u51cf 1\uff0c\u76f4\u5230\u51cf\u5230 0 \u65f6\u8be5 IP \u5305\u4f1a\u88ab\u4e22\u5f03\u3002</p> <p>\u6b64\u65f6\uff0c\u8def\u7531\u5668\u5c06\u4f1a\u53d1\u9001\u4e00\u4e2a ICMP \u8d85\u65f6\u6d88\u606f\u7ed9\u53d1\u9001\u7aef\u4e3b\u673a\uff0c\u5e76\u901a\u77e5\u8be5\u5305\u5df2\u88ab\u4e22\u5f03\u3002</p> <p>\u8bbe\u7f6e IP \u5305\u751f\u5b58\u5468\u671f\u7684\u4e3b\u8981\u76ee\u7684\uff0c\u662f\u4e3a\u4e86\u5728\u8def\u7531\u63a7\u5236\u9047\u5230\u95ee\u9898\u53d1\u751f\u5faa\u73af\u72b6\u51b5\u65f6\uff0c\u907f\u514d IP \u5305\u65e0\u4f11\u6b62\u5730\u5728\u7f51\u7edc\u4e0a\u88ab\u8f6c\u53d1\u3002</p> <p></p> <p>\u6b64\u5916\uff0c\u6709\u65f6\u53ef\u4ee5\u7528 TTL \u63a7\u5236\u5305\u7684\u5230\u8fbe\u8303\u56f4\uff0c\u4f8b\u5982\u8bbe\u7f6e\u4e00\u4e2a\u8f83\u5c0f\u7684 TTL \u503c\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#ping","title":"ping \u2014\u2014 \u67e5\u8be2\u62a5\u6587\u7c7b\u578b\u7684\u4f7f\u7528","text":"<p>\u63a5\u4e0b\u6765\uff0c\u6211\u4eec\u91cd\u70b9\u6765\u770b <code>ping</code> \u7684\u53d1\u9001\u548c\u63a5\u6536\u8fc7\u7a0b\u3002</p> <p>\u540c\u4e2a\u5b50\u7f51\u4e0b\u7684\u4e3b\u673a A \u548c \u4e3b\u673a B\uff0c\u4e3b\u673a A \u6267\u884c<code>ping</code> \u4e3b\u673a B \u540e\uff0c\u6211\u4eec\u6765\u770b\u770b\u5176\u95f4\u53d1\u9001\u4e86\u4ec0\u4e48\uff1f</p> <p></p> <p>ping \u547d\u4ee4\u6267\u884c\u7684\u65f6\u5019\uff0c\u6e90\u4e3b\u673a\u9996\u5148\u4f1a\u6784\u5efa\u4e00\u4e2a ICMP \u56de\u9001\u8bf7\u6c42\u6d88\u606f\u6570\u636e\u5305\u3002</p> <p>ICMP \u6570\u636e\u5305\u5185\u5305\u542b\u591a\u4e2a\u5b57\u6bb5\uff0c\u6700\u91cd\u8981\u7684\u662f\u4e24\u4e2a\uff1a</p> <ul> <li>\u7b2c\u4e00\u4e2a\u662f\u7c7b\u578b\uff0c\u5bf9\u4e8e\u56de\u9001\u8bf7\u6c42\u6d88\u606f\u800c\u8a00\u8be5\u5b57\u6bb5\u4e3a <code>8</code>\uff1b</li> <li>\u53e6\u5916\u4e00\u4e2a\u662f\u5e8f\u53f7\uff0c\u4e3b\u8981\u7528\u4e8e\u533a\u5206\u8fde\u7eed ping \u7684\u65f6\u5019\u53d1\u51fa\u7684\u591a\u4e2a\u6570\u636e\u5305\u3002</li> </ul> <p>\u6bcf\u53d1\u51fa\u4e00\u4e2a\u8bf7\u6c42\u6570\u636e\u5305\uff0c\u5e8f\u53f7\u4f1a\u81ea\u52a8\u52a0 <code>1</code>\u3002\u4e3a\u4e86\u80fd\u591f\u8ba1\u7b97\u5f80\u8fd4\u65f6\u95f4 <code>RTT</code>\uff0c\u5b83\u4f1a\u5728\u62a5\u6587\u7684\u6570\u636e\u90e8\u5206\u63d2\u5165\u53d1\u9001\u65f6\u95f4\u3002</p> <p></p> <p>\u7136\u540e\uff0c\u7531 ICMP \u534f\u8bae\u5c06\u8fd9\u4e2a\u6570\u636e\u5305\u8fde\u540c\u5730\u5740 192.168.1.2 \u4e00\u8d77\u4ea4\u7ed9 IP \u5c42\u3002IP \u5c42\u5c06\u4ee5 192.168.1.2 \u4f5c\u4e3a\u76ee\u7684\u5730\u5740\uff0c\u672c\u673a IP \u5730\u5740\u4f5c\u4e3a\u6e90\u5730\u5740\uff0c\u534f\u8bae\u5b57\u6bb5\u8bbe\u7f6e\u4e3a <code>1</code> \u8868\u793a\u662f <code>ICMP</code> \u534f\u8bae\uff0c\u518d\u52a0\u4e0a\u4e00\u4e9b\u5176\u4ed6\u63a7\u5236\u4fe1\u606f\uff0c\u6784\u5efa\u4e00\u4e2a <code>IP</code> \u6570\u636e\u5305\u3002</p> <p></p> <p>\u63a5\u4e0b\u6765\uff0c\u9700\u8981\u52a0\u5165 <code>MAC</code> \u5934\u3002\u5982\u679c\u5728\u672c\u5730 ARP \u6620\u5c04\u8868\u4e2d\u67e5\u627e\u51fa IP \u5730\u5740 192.168.1.2 \u6240\u5bf9\u5e94\u7684 MAC \u5730\u5740\uff0c\u5219\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\uff1b\u5982\u679c\u6ca1\u6709\uff0c\u5219\u9700\u8981\u53d1\u9001 <code>ARP</code> \u534f\u8bae\u67e5\u8be2 MAC \u5730\u5740\uff0c\u83b7\u5f97 MAC \u5730\u5740\u540e\uff0c\u7531\u6570\u636e\u94fe\u8def\u5c42\u6784\u5efa\u4e00\u4e2a\u6570\u636e\u5e27\uff0c\u76ee\u7684\u5730\u5740\u662f IP \u5c42\u4f20\u8fc7\u6765\u7684 MAC \u5730\u5740\uff0c\u6e90\u5730\u5740\u5219\u662f\u672c\u673a\u7684 MAC \u5730\u5740\uff1b\u8fd8\u8981\u9644\u52a0\u4e0a\u4e00\u4e9b\u63a7\u5236\u4fe1\u606f\uff0c\u4f9d\u636e\u4ee5\u592a\u7f51\u7684\u4ecb\u8d28\u8bbf\u95ee\u89c4\u5219\uff0c\u5c06\u5b83\u4eec\u4f20\u9001\u51fa\u53bb\u3002</p> <p></p> <p>\u4e3b\u673a <code>B</code> \u6536\u5230\u8fd9\u4e2a\u6570\u636e\u5e27\u540e\uff0c\u5148\u68c0\u67e5\u5b83\u7684\u76ee\u7684 MAC \u5730\u5740\uff0c\u5e76\u548c\u672c\u673a\u7684 MAC \u5730\u5740\u5bf9\u6bd4\uff0c\u5982\u7b26\u5408\uff0c\u5219\u63a5\u6536\uff0c\u5426\u5219\u5c31\u4e22\u5f03\u3002</p> <p>\u63a5\u6536\u540e\u68c0\u67e5\u8be5\u6570\u636e\u5e27\uff0c\u5c06 IP \u6570\u636e\u5305\u4ece\u5e27\u4e2d\u63d0\u53d6\u51fa\u6765\uff0c\u4ea4\u7ed9\u672c\u673a\u7684 IP \u5c42\u3002\u540c\u6837\uff0cIP \u5c42\u68c0\u67e5\u540e\uff0c\u5c06\u6709\u7528\u7684\u4fe1\u606f\u63d0\u53d6\u540e\u4ea4\u7ed9 ICMP \u534f\u8bae\u3002</p> <p>\u4e3b\u673a <code>B</code> \u4f1a\u6784\u5efa\u4e00\u4e2a ICMP \u56de\u9001\u54cd\u5e94\u6d88\u606f\u6570\u636e\u5305\uff0c\u56de\u9001\u54cd\u5e94\u6570\u636e\u5305\u7684\u7c7b\u578b\u5b57\u6bb5\u4e3a <code>0</code>\uff0c\u5e8f\u53f7\u4e3a\u63a5\u6536\u5230\u7684\u8bf7\u6c42\u6570\u636e\u5305\u4e2d\u7684\u5e8f\u53f7\uff0c\u7136\u540e\u518d\u53d1\u9001\u51fa\u53bb\u7ed9\u4e3b\u673a A\u3002</p> <p></p> <p>\u5728\u89c4\u5b9a\u7684\u65f6\u5019\u95f4\u5185\uff0c\u6e90\u4e3b\u673a\u5982\u679c\u6ca1\u6709\u63a5\u5230 ICMP \u7684\u5e94\u7b54\u5305\uff0c\u5219\u8bf4\u660e\u76ee\u6807\u4e3b\u673a\u4e0d\u53ef\u8fbe\uff1b\u5982\u679c\u63a5\u6536\u5230\u4e86 ICMP \u56de\u9001\u54cd\u5e94\u6d88\u606f\uff0c\u5219\u8bf4\u660e\u76ee\u6807\u4e3b\u673a\u53ef\u8fbe\u3002</p> <p>\u6b64\u65f6\uff0c\u6e90\u4e3b\u673a\u4f1a\u68c0\u67e5\uff0c\u7528\u5f53\u524d\u65f6\u523b\u51cf\u53bb\u8be5\u6570\u636e\u5305\u6700\u521d\u4ece\u6e90\u4e3b\u673a\u4e0a\u53d1\u51fa\u7684\u65f6\u523b\uff0c\u5c31\u662f ICMP \u6570\u636e\u5305\u7684\u65f6\u95f4\u5ef6\u8fdf\u3002</p> <p>\u9488\u5bf9\u4e0a\u9762\u53d1\u9001\u7684\u4e8b\u60c5\uff0c\u603b\u7ed3\u6210\u4e86\u5982\u4e0b\u56fe\uff1a</p> <p></p> <p>\u5f53\u7136\u8fd9\u53ea\u662f\u6700\u7b80\u5355\u7684\uff0c\u540c\u4e00\u4e2a\u5c40\u57df\u7f51\u91cc\u9762\u7684\u60c5\u51b5\u3002\u5982\u679c\u8de8\u7f51\u6bb5\u7684\u8bdd\uff0c\u8fd8\u4f1a\u6d89\u53ca\u7f51\u5173\u7684\u8f6c\u53d1\u3001\u8def\u7531\u5668\u7684\u8f6c\u53d1\u7b49\u7b49\u3002</p> <p>\u4f46\u662f\u5bf9\u4e8e ICMP \u7684\u5934\u6765\u8bb2\uff0c\u662f\u6ca1\u4ec0\u4e48\u5f71\u54cd\u7684\u3002\u4f1a\u5f71\u54cd\u7684\u662f\u6839\u636e\u76ee\u6807 IP \u5730\u5740\uff0c\u9009\u62e9\u8def\u7531\u7684\u4e0b\u4e00\u8df3\uff0c\u8fd8\u6709\u6bcf\u7ecf\u8fc7\u4e00\u4e2a\u8def\u7531\u5668\u5230\u8fbe\u4e00\u4e2a\u65b0\u7684\u5c40\u57df\u7f51\uff0c\u9700\u8981\u6362 MAC \u5934\u91cc\u9762\u7684 MAC \u5730\u5740\u3002</p> <p>\u8bf4\u4e86\u8fd9\u4e48\u591a\uff0c\u53ef\u4ee5\u770b\u51fa ping \u8fd9\u4e2a\u7a0b\u5e8f\u662f\u4f7f\u7528\u4e86 ICMP \u91cc\u9762\u7684 ECHO REQUEST\uff08\u7c7b\u578b\u4e3a 8\uff09\u548c ECHO REPLY\uff08\u7c7b\u578b\u4e3a 0\uff09\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#traceroute","title":"traceroute \u2014\u2014 \u5dee\u9519\u62a5\u6587\u7c7b\u578b\u7684\u4f7f\u7528","text":"<p>\u6709\u4e00\u6b3e\u5145\u5206\u5229\u7528 ICMP \u5dee\u9519\u62a5\u6587\u7c7b\u578b\u7684\u5e94\u7528\u53eb\u505a <code>traceroute</code>\uff08\u5728 UNIX\u3001MacOS \u4e2d\u662f\u8fd9\u4e2a\u547d\u4ee4\uff0c\u800c\u5728 Windows \u4e2d\u5bf9\u7b49\u7684\u547d\u4ee4\u53eb\u505a tracert\uff09\u3002 </p> <p>1. traceroute \u4f5c\u7528\u4e00</p> <p>traceroute \u7684\u7b2c\u4e00\u4e2a\u4f5c\u7528\u5c31\u662f\u6545\u610f\u8bbe\u7f6e\u7279\u6b8a\u7684 TTL\uff0c\u6765\u8ffd\u8e2a\u53bb\u5f80\u76ee\u7684\u5730\u65f6\u6cbf\u9014\u7ecf\u8fc7\u7684\u8def\u7531\u5668\u3002</p> <p>traceroute \u7684\u53c2\u6570\u6307\u5411\u67d0\u4e2a\u76ee\u7684 IP \u5730\u5740\uff1a</p> Bash<pre><code>traceroute 192.168.1.100\n</code></pre> <p>\u8fd9\u4e2a\u4f5c\u7528\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u5462\uff1f</p> <p>\u5b83\u7684\u539f\u7406\u5c31\u662f\u5229\u7528 IP \u5305\u7684\u751f\u5b58\u671f\u9650 \u4ece <code>1</code> \u5f00\u59cb\u6309\u7167\u987a\u5e8f\u9012\u589e\u7684\u540c\u65f6\u53d1\u9001 UDP \u5305\uff0c\u5f3a\u5236\u63a5\u6536 ICMP \u8d85\u65f6\u6d88\u606f\u7684\u4e00\u79cd\u65b9\u6cd5\u3002</p> <p>\u6bd4\u5982\uff0c\u5c06 TTL \u8bbe\u7f6e \u4e3a <code>1</code>\uff0c\u5219\u9047\u5230\u7b2c\u4e00\u4e2a\u8def\u7531\u5668\uff0c\u5c31\u727a\u7272\u4e86\uff0c\u63a5\u7740\u8fd4\u56de ICMP \u5dee\u9519\u62a5\u6587\u7f51\u7edc\u5305\uff0c\u7c7b\u578b\u662f\u65f6\u95f4\u8d85\u65f6\u3002</p> <p>\u63a5\u4e0b\u6765\u5c06 TTL \u8bbe\u7f6e\u4e3a <code>2</code>\uff0c\u7b2c\u4e00\u4e2a\u8def\u7531\u5668\u8fc7\u4e86\uff0c\u9047\u5230\u7b2c\u4e8c\u4e2a\u8def\u7531\u5668\u4e5f\u727a\u7272\u4e86\uff0c\u4e5f\u540c\u65f6\u8fd4\u56de\u4e86 ICMP \u5dee\u9519\u62a5\u6587\u6570\u636e\u5305\uff0c\u5982\u6b64\u5f80\u590d\uff0c\u76f4\u5230\u5230\u8fbe\u76ee\u7684\u4e3b\u673a\u3002</p> <p>\u8fd9\u6837\u7684\u8fc7\u7a0b\uff0ctraceroute \u5c31\u53ef\u4ee5\u62ff\u5230\u4e86\u6240\u6709\u7684\u8def\u7531\u5668 IP\u3002</p> <p>\u5f53\u7136\u6709\u7684\u8def\u7531\u5668\u6839\u672c\u5c31\u4e0d\u4f1a\u8fd4\u56de\u8fd9\u4e2a ICMP\uff0c\u6240\u4ee5\u5bf9\u4e8e\u6709\u7684\u516c\u7f51\u5730\u5740\uff0c\u662f\u770b\u4e0d\u5230\u4e2d\u95f4\u7ecf\u8fc7\u7684\u8def\u7531\u7684\u3002</p> <p>\u53d1\u9001\u65b9\u5982\u4f55\u77e5\u9053\u53d1\u51fa\u7684 UDP \u5305\u662f\u5426\u5230\u8fbe\u4e86\u76ee\u7684\u4e3b\u673a\u5462\uff1f</p> <p>traceroute \u5728\u53d1\u9001 <code>UDP</code> \u5305\u65f6\uff0c\u4f1a\u586b\u5165\u4e00\u4e2a\u4e0d\u53ef\u80fd\u7684\u7aef\u53e3\u53f7\u503c\u4f5c\u4e3a UDP \u76ee\u6807\u7aef\u53e3\u53f7\uff08\u5927\u4e8e <code>3000</code> \uff09\u3002\u5f53\u76ee\u7684\u4e3b\u673a\uff0c\u6536\u5230 UDP \u5305\u540e\uff0c\u4f1a\u8fd4\u56de ICMP \u5dee\u9519\u62a5\u6587\u6d88\u606f\uff0c\u4f46\u8fd9\u4e2a\u5dee\u9519\u62a5\u6587\u6d88\u606f\u7684\u7c7b\u578b\u662f\u300c\u7aef\u53e3\u4e0d\u53ef\u8fbe\u300d\u3002</p> <p>\u6240\u4ee5\uff0c\u5f53\u5dee\u9519\u62a5\u6587\u7c7b\u578b\u662f\u7aef\u53e3\u4e0d\u53ef\u8fbe\u65f6\uff0c\u8bf4\u660e\u53d1\u9001\u65b9\u53d1\u51fa\u7684 UDP \u5305\u5230\u8fbe\u4e86\u76ee\u7684\u4e3b\u673a\u3002</p> <p>2. traceroute \u4f5c\u7528\u4e8c</p> <p>traceroute \u8fd8\u6709\u4e00\u4e2a\u4f5c\u7528\u662f\u6545\u610f\u8bbe\u7f6e\u4e0d\u5206\u7247\uff0c\u4ece\u800c\u786e\u5b9a\u8def\u5f84\u7684 MTU\u3002</p> <p>\u8fd9\u4e48\u505a\u662f\u4e3a\u4e86\u4ec0\u4e48\uff1f</p> <p>\u8fd9\u6837\u505a\u7684\u76ee\u7684\u662f\u4e3a\u4e86\u8def\u5f84 MTU \u53d1\u73b0\u3002</p> <p>\u56e0\u4e3a\u6709\u7684\u65f6\u5019\u6211\u4eec\u5e76\u4e0d\u77e5\u9053\u8def\u7531\u5668\u7684 <code>MTU</code> \u5927\u5c0f\uff0c\u4ee5\u592a\u7f51\u7684\u6570\u636e\u94fe\u8def\u4e0a\u7684 <code>MTU</code> \u901a\u5e38\u662f <code>1500</code> \u5b57\u8282\uff0c\u4f46\u662f\u975e\u4ee5\u592a\u7f51\u7684 <code>MTU</code> \u503c\u5c31\u4e0d\u4e00\u6837\u4e86\uff0c\u6240\u4ee5\u6211\u4eec\u8981\u77e5\u9053 <code>MTU</code> \u7684\u5927\u5c0f\uff0c\u4ece\u800c\u63a7\u5236\u53d1\u9001\u7684\u5305\u5927\u5c0f\u3002</p> <p></p> <p>\u5b83\u7684\u5de5\u4f5c\u539f\u7406\u5982\u4e0b\uff1a</p> <p>\u9996\u5148\u5728\u53d1\u9001\u7aef\u4e3b\u673a\u53d1\u9001 <code>IP</code> \u6570\u636e\u62a5\u65f6\uff0c\u5c06 <code>IP</code> \u5305\u9996\u90e8\u7684\u5206\u7247\u7981\u6b62\u6807\u5fd7\u4f4d\u8bbe\u7f6e\u4e3a 1\u3002\u6839\u636e\u8fd9\u4e2a\u6807\u5fd7\u4f4d\uff0c\u9014\u4e2d\u7684\u8def\u7531\u5668\u4e0d\u4f1a\u5bf9\u5927\u6570\u636e\u5305\u8fdb\u884c\u5206\u7247\uff0c\u800c\u662f\u5c06\u5305\u4e22\u5f03\u3002</p> <p>\u968f\u540e\uff0c\u901a\u8fc7\u4e00\u4e2a ICMP \u7684\u4e0d\u53ef\u8fbe\u6d88\u606f\u5c06\u6570\u636e\u94fe\u8def\u4e0a MTU \u7684\u503c\u4e00\u8d77\u7ed9\u53d1\u9001\u4e3b\u673a\uff0c\u4e0d\u53ef\u8fbe\u6d88\u606f\u7684\u7c7b\u578b\u4e3a\u300c\u9700\u8981\u8fdb\u884c\u5206\u7247\u4f46\u8bbe\u7f6e\u4e86\u4e0d\u5206\u7247\u4f4d\u300d\u3002</p> <p>\u53d1\u9001\u4e3b\u673a\u7aef\u6bcf\u6b21\u6536\u5230 ICMP \u5dee\u9519\u62a5\u6587\u65f6\u5c31\u51cf\u5c11\u5305\u7684\u5927\u5c0f\uff0c\u4ee5\u6b64\u6765\u5b9a\u4f4d\u4e00\u4e2a\u5408\u9002\u7684 <code>MTU</code> \u503c\uff0c\u4ee5\u4fbf\u80fd\u5230\u8fbe\u76ee\u6807\u4e3b\u673a\u3002</p> <p>\u53c2\u8003\u8d44\u6599\uff1a</p> <p>[1] \u7af9\u4e0b\u9686\u53f2\u3002\u56fe\u89e3 TCP/IP.\u4eba\u6c11\u90ae\u7535\u51fa\u7248\u793e\u3002</p> <p>[2] \u5218\u8d85\u3002\u8da3\u8c08\u7f51\u7edc\u534f\u8bae\u3002\u6781\u5ba2\u65f6\u95f4\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping/#_3","title":"\u8bfb\u8005\u95ee\u7b54","text":"<p>\u8bfb\u8005\u95ee\uff1a\u201c\u6709\u4e2a\u95ee\u9898\u5c31\u662f A \u7684 icmp \u5230\u4e86 B \u540e\uff0cB \u4e3a\u5565\u4f1a\u81ea\u52a8\u7ed9 A \u4e00\u4e2a\u56de\u6267 0\uff1f\u8fd9\u662f\u64cd\u4f5c\u7cfb\u7edf\u7684\u5e95\u5c42\u8bbe\u8ba1\u5417\uff1f\u201d</p> <p>\u4f60\u8bf4\u7684\u201c\u56de\u6267 0\u201d\u662f\u6307 ICMP \u7c7b\u578b\u4e3a 0 \u5417\uff1f\u5982\u679c\u662f\u7684\u8bdd\uff0c\u90a3\u4e48 B \u6536\u5230 A \u7684\u56de\u9001\u8bf7\u6c42\uff08\u7c7b\u578b\u4e3a 8\uff09ICMP \u62a5\u6587\uff0cB \u4e3b\u673a\u64cd\u4f5c\u7cfb\u7edf\u534f\u8bae\u6808\u53d1\u73b0\u662f\u4e2a\u56de\u9001\u8bf7\u6c42 ICMP \u62a5\u6587\uff0c\u90a3\u4e48\u534f\u8bae\u6808\u5c31\u4f1a\u7ec4\u88c5\u4e00\u4e2a\u56de\u9001\u5e94\u7b54\uff08\u7c7b\u578b\u4e3a 0\uff09\u7684 IMCP \u56de\u5e94\u7ed9 A\u3002</p> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u6211\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping_lo/","title":"5.3 \u65ad\u7f51\u4e86\uff0c\u8fd8\u80fd ping \u901a 127.0.0.1 \u5417\uff1f","text":"<p>\u6765\u6e90\uff1a\u516c\u4f17\u53f7@\u5c0f\u767d debug</p> <p>\u539f\u6587\u5730\u5740\uff1a\u65ad\u7f51\u4e86\uff0c\u8fd8\u80fd ping \u901a 127.0.0.1 \u5417\uff1f</p> <p>\u4f60\u5973\u795e\u7231\u4e0d\u7231\u4f60\uff0c\u4f60\u95ee\u5979\uff0c\u5979\u53ef\u80fd\u4e0d\u4f1a\u544a\u8bc9\u4f60\u3002</p> <p>\u4f46\u7f51\u901a\u4e0d\u901a\uff0c\u4f60 <code>ping</code> \u4e00\u4e0b\u5c31\u77e5\u9053\u4e86\u3002</p> <p>\u53ef\u80fd\u770b\u5230\u6807\u9898\uff0c\u4f60\u5c31\u77e5\u9053\u7b54\u6848\u4e86\uff0c\u4f46\u662f\u4f60\u4e86\u89e3\u80cc\u540e\u7684\u539f\u56e0\u5417\uff1f</p> <p>\u90a3\u5982\u679c\u628a <code>127.0.0.1</code> \u6362\u6210 <code>0.0.0.0</code> \u6216 <code>localhost</code> \u4f1a\u600e\u4e48\u6837\u5462\uff1f\u4f60\u77e5\u9053\u8fd9\u51e0\u4e2a<code>IP</code>\u6709\u4ec0\u4e48\u533a\u522b\u5417\uff1f</p> <p>\u4ee5\u524d\u9762\u8bd5\u7684\u65f6\u5019\u5c31\u9047\u5230\u8fc7\u8fd9\u4e2a\u95ee\u9898\uff0c\u5927\u5bb6\u770b\u4e2a\u52a8\u56fe\u4e86\u89e3\u4e0b\u9762\u8bd5\u5b98\u548c\u6211\u5f53\u65f6\u7684\u573a\u666f\uff0c\u6c42\u5f53\u65f6\u6211\u7684\u5fc3\u91cc\u9634\u5f71\u9762\u79ef\u3002</p> <p></p> <p>\u8bdd\u4e0d\u591a\u8bf4\uff0c\u6211\u4eec\u76f4\u63a5\u5f00\u8f66\u3002</p> <p>\u62d4\u6389\u7f51\u7ebf\uff0c\u65ad\u7f51\u3002</p> <p></p> <p>\u7136\u540e\u5728\u63a7\u5236\u53f0\u8f93\u5165<code>ping 127.0.0.1</code>\u3002</p> Bash<pre><code>$ ping 127.0.0.1\nPING 127.0.0.1 (127.0.0.1): 56 data bytes\n64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.080 ms\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.093 ms\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.074 ms\n64 bytes from 127.0.0.1: icmp_seq=3 ttl=64 time=0.079 ms\n64 bytes from 127.0.0.1: icmp_seq=4 ttl=64 time=0.079 ms\n^C\n--- 127.0.0.1 ping statistics ---\n5 packets transmitted, 5 packets received, 0.0% packet loss\nround-trip min/avg/max/stddev = 0.074/0.081/0.093/0.006 ms\n</code></pre> <p>\u8bf4\u660e\uff0c\u62d4\u4e86\u7f51\u7ebf\uff0c<code>ping 127.0.0.1</code> \u662f\u80fd ping \u901a\u7684\u3002</p> <p>\u5176\u5b9e\u8fd9\u7bc7\u6587\u7ae0\u770b\u5230\u8fd9\u91cc\uff0c\u6807\u9898\u524d\u534a\u4e2a\u95ee\u9898\u5df2\u7ecf\u88ab\u56de\u7b54\u4e86\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u518d\u60f3\u6df1\u4e00\u70b9\u3002</p> <p>\u4e3a\u4ec0\u4e48\u65ad\u7f51\u4e86\u8fd8\u80fd <code>ping</code> \u901a <code>127.0.0.1</code> \u5462\uff1f</p> <p>\u8fd9\u80fd\u8bf4\u660e\u4f60\u4e0d\u7528\u4ea4\u7f51\u8d39\u5c31\u80fd\u4e0a\u7f51\u5417\uff1f</p> <p>\u4e0d\u80fd\u3002</p> <p>\u9996\u5148\u6211\u4eec\u9700\u8981\u8fdb\u5165\u57fa\u7840\u79d1\u666e\u73af\u8282\u3002</p> <p>\u4e0d\u61c2\u7684\u540c\u5b66\u770b\u4e86\u5c31\u61c2\u4e86\uff0c\u61c2\u7684\u770b\u4e86\u5c31\u5f53\u67e5\u6f0f\u8865\u7f3a\u5427\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping_lo/#127001","title":"\u4ec0\u4e48\u662f 127.0.0.1","text":"<p>\u9996\u5148\uff0c\u8fd9\u662f\u4e2a <code>IPV4</code> \u5730\u5740\u3002</p> <p><code>IPV4</code> \u5730\u5740\u6709 <code>32</code> \u4f4d\uff0c\u4e00\u4e2a\u5b57\u8282\u6709 <code>8</code> \u4f4d\uff0c\u5171 <code>4</code> \u4e2a\u5b57\u8282\u3002</p> <p>\u5176\u4e2d127 \u5f00\u5934\u7684\u90fd\u5c5e\u4e8e\u56de\u73af\u5730\u5740\uff0c\u4e5f\u662f <code>IPV4</code> \u7684\u7279\u6b8a\u5730\u5740\uff0c\u6ca1\u4ec0\u4e48\u9053\u7406\uff0c\u5c31\u662f\u4eba\u4e3a\u89c4\u5b9a\u7684\u3002</p> <p>\u800c<code>127.0.0.1</code>\u662f\u4f17\u591a\u56de\u73af\u5730\u5740\u4e2d\u7684\u4e00\u4e2a\u3002\u4e4b\u6240\u4ee5\u4e0d\u662f <code>127.0.0.2</code> \uff0c\u800c\u662f <code>127.0.0.1</code>\uff0c\u662f\u56e0\u4e3a\u6e90\u7801\u91cc\u5c31\u662f\u8fd9\u4e48\u5b9a\u4e49\u7684\uff0c\u4e5f\u6ca1\u4ec0\u4e48\u9053\u7406\u3002</p> C<pre><code>/* Address to loopback in software to local host.  */\n#define    INADDR_LOOPBACK     0x7f000001  /* 127.0.0.1   */\n</code></pre> <p></p> <p><code>IPv4</code> \u7684\u5730\u5740\u662f <code>32</code> \u4f4d\u7684\uff0c2 \u7684 32 \u6b21\u65b9\uff0c\u5927\u6982\u662f<code>40+\u4ebf</code>\u3002\u5730\u7403\u5149\u4eba\u53e3\u5c31 76 \u4ebf\u4e86\uff0c40 \u4ebf IP \u8fd9\u70b9\u91cf\uff0c\u585e\u7259\u7f1d\u90fd\u4e0d\u591f\uff0c\u5b9e\u9645\u4e0aIP \u4e5f\u786e\u5b9e\u7528\u5b8c\u4e86\u3002</p> <p>\u6240\u4ee5\u5c31\u6709\u4e86<code>IPV6</code>\uff0c <code>IPv6</code> \u7684\u5730\u5740\u662f <code>128</code> \u4f4d\u7684\uff0c\u5927\u6982\u662f 2 \u7684 128 \u6b21\u65b9\u224810 \u7684 38 \u6b21\u65b9\u3002\u636e\u8bf4\u5730\u7403\u7684\u6c99\u5b50\u6570\u91cf\u5927\u6982\u662f 10 \u7684 23 \u6b21\u65b9\uff0c\u6240\u4ee5 IPV6 \u7684 IP \u53ef\u4ee5\u8ba4\u4e3a\u7528\u4e0d\u5b8c\u3002</p> <p>IPV4 \u4ee5 8 \u4f4d\u4e00\u7ec4\uff0c\u6bcf\u7ec4\u4e4b\u95f4\u7528 . \u53f7\u9694\u5f00\u3002</p> <p>IPV6 \u5c31\u4ee5 16 \u4f4d\u4e3a\u4e00\u7ec4\uff0c\u6bcf\u7ec4\u4e4b\u95f4\u7528 : \u53f7\u9694\u5f00\u3002\u5982\u679c\u5168\u662f 0\uff0c\u90a3\u4e48\u53ef\u4ee5\u7701\u7565\u4e0d\u5199\u3002</p> <p></p> <p>\u5728 IPV4 \u4e0b\u7684\u56de\u73af\u5730\u5740\u662f <code>127.0.0.1</code>\uff0c\u5728<code>IPV6</code>\u4e0b\uff0c\u8868\u8fbe\u4e3a <code>::1</code> \u3002\u4e2d\u95f4\u628a\u8fde\u7eed\u7684 0\u7ed9\u7701\u7565\u4e86\uff0c\u4e4b\u6240\u4ee5\u4e0d\u662f7 \u4e2a \u5192\u53f7\uff0c\u800c\u662f2 \u4e2a\u5192\u53f7\uff1a \uff0c\u662f\u56e0\u4e3a\u4e00\u4e2a IPV6 \u5730\u5740\u4e2d\u53ea\u5141\u8bb8\u51fa\u73b0\u2f00\u6b21\u4e24\u4e2a\u8fde\u7eed\u7684\u5192\u53f7\u3002</p> <p>\u591a\u8bf4\u4e00\u53e5\uff1a\u5728 IPV4 \u4e0b\u7528\u7684\u662f ping 127.0.0.1 \u547d\u4ee4\u3002\u5728 IPV6 \u4e0b\u7528\u7684\u662f ping6  ::1 \u547d\u4ee4\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping_lo/#ping","title":"\u4ec0\u4e48\u662f ping","text":"<p>ping \u662f\u5e94\u7528\u5c42\u547d\u4ee4\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\u5b83\u8ddf\u6e38\u620f\u6216\u8005\u804a\u5929\u8f6f\u4ef6\u5c5e\u4e8e\u540c\u4e00\u5c42\u3002\u53ea\u4e0d\u8fc7\u804a\u5929\u8f6f\u4ef6\u53ef\u4ee5\u6536\u53d1\u6d88\u606f\uff0c\u8fd8\u80fd\u70b9\u4e2a\u8d5e\u4ec0\u4e48\u7684\uff0c\u6709\u5f88\u591a\u590d\u6742\u7684\u529f\u80fd\u3002\u800c ping \u4f5c\u4e3a\u4e00\u4e2a\u5c0f\u8f6f\u4ef6\uff0c\u5b83\u7684\u529f\u80fd\u6bd4\u8f83\u7b80\u5355\uff0c\u5c31\u662f\u5c1d\u8bd5\u53d1\u9001\u4e00\u4e2a\u5c0f\u5c0f\u7684\u6d88\u606f\u5230\u76ee\u6807\u673a\u5668\u4e0a\uff0c\u5224\u65ad\u76ee\u7684\u673a\u5668\u662f\u5426\u53ef\u8fbe\uff0c\u5176\u5b9e\u4e5f\u5c31\u662f\u5224\u65ad\u76ee\u6807\u673a\u5668\u7f51\u7edc\u662f\u5426\u80fd\u8fde\u901a\u3002</p> <p>ping \u5e94\u7528\u7684\u5e95\u5c42\uff0c\u7528\u7684\u662f\u7f51\u7edc\u5c42\u7684ICMP \u534f\u8bae\u3002</p> <p>IP \u548c ICMP \u548c Ping \u6240\u5728\u5206\u5c42</p> <p>\u867d\u7136 ICMP \u534f\u8bae\u548c IP \u534f\u8bae\u90fd\u5c5e\u4e8e\u7f51\u7edc\u5c42\u534f\u8bae\uff0c\u4f46\u5176\u5b9eICMP \u4e5f\u662f\u5229\u7528\u4e86 IP \u534f\u8bae\u8fdb\u884c\u6d88\u606f\u7684\u4f20\u8f93\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u5927\u5bb6\u5728\u8fd9\u91cc\u5b8c\u5168\u53ef\u4ee5\u7b80\u5355\u7684\u7406\u89e3\u4e3a ping \u67d0\u4e2a IP \u5c31\u662f\u5f80\u67d0\u4e2a IP \u5730\u5740\u53d1\u4e2a\u6d88\u606f\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping_lo/#tcp-ping","title":"TCP \u53d1\u6570\u636e\u548c ping \u7684\u533a\u522b","text":"<p>\u4e00\u822c\u60c5\u51b5\u4e0b\uff0c\u6211\u4eec\u4f1a\u4f7f\u7528 TCP \u8fdb\u884c\u7f51\u7edc\u6570\u636e\u4f20\u8f93\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u770b\u4e0b\u5b83\u548c ping \u7684\u533a\u522b\u3002</p> <p>PS\uff1a\u4e0b\u56fe\u4e2d\u6709\u4e00\u5904\u753b\u9519\u4e86\uff0c\u53f3\u8fb9\u662f tcp \u6570\u636e\uff0c\u800c\u4e0d\u662f ping \u6570\u636e\uff0c\u6211\u5077\u61d2\u5c31\u4e0d\u91cd\u753b\u4e86\u3002</p> <p></p> <p>ping \u548c\u5176\u4ed6\u5e94\u7528\u5c42\u8f6f\u4ef6\u90fd\u5c5e\u4e8e\u5e94\u7528\u5c42\u3002</p> <p>\u90a3\u4e48\u6211\u4eec\u6a2a\u5411\u5bf9\u6bd4\u4e00\u4e0b\uff0c\u6bd4\u65b9\u8bf4\u804a\u5929\u8f6f\u4ef6\uff0c\u5982\u679c\u7528\u7684\u662f TCP \u7684\u65b9\u5f0f\u53bb\u53d1\u9001\u6d88\u606f\u3002</p> <p>\u4e3a\u4e86\u53d1\u9001\u6d88\u606f\uff0c\u90a3\u5c31\u5f97\u5148\u77e5\u9053\u5f80\u54ea\u53d1\u3002linux \u91cc\u4e07\u7269\u7686\u6587\u4ef6\uff0c\u90a3\u4f60\u8981\u53d1\u6d88\u606f\u7684\u76ee\u7684\u5730\uff0c\u4e5f\u662f\u4e2a\u6587\u4ef6\uff0c\u8fd9\u91cc\u5c31\u5f15\u51fa\u4e86 socket \u7684\u6982\u5ff5\u3002</p> <p>\u8981\u4f7f\u7528 <code>socket</code> , \u90a3\u4e48\u9996\u5148\u9700\u8981\u521b\u5efa\u5b83\u3002</p> <p>\u5728 TCP \u4f20\u8f93\u4e2d\u521b\u5efa\u7684\u65b9\u5f0f\u662f  <code>socket(AF_INET, SOCK_STREAM, 0);</code>\uff0c\u5176\u4e2d <code>AF_INET</code> \u8868\u793a\u5c06\u4f7f\u7528 IPV4 \u91cc host:port \u7684\u65b9\u5f0f\u53bb\u89e3\u6790\u5f85\u4f1a\u4f60\u8f93\u5165\u7684\u7f51\u7edc\u5730\u5740\u3002<code>SOCK_STREAM</code> \u662f\u6307\u4f7f\u7528\u9762\u5411\u5b57\u8282\u6d41\u7684 TCP \u534f\u8bae\uff0c\u5de5\u4f5c\u5728\u4f20\u8f93\u5c42\u3002</p> <p>\u521b\u5efa\u597d\u4e86 <code>socket</code> \u4e4b\u540e\uff0c\u5c31\u53ef\u4ee5\u6109\u5feb\u7684\u628a\u8981\u4f20\u8f93\u7684\u6570\u636e\u5199\u5230\u8fd9\u4e2a\u6587\u4ef6\u91cc\u3002\u8c03\u7528 socket \u7684<code>sendto</code>\u63a5\u53e3\u7684\u8fc7\u7a0b\u4e2d\u8fdb\u7a0b\u4f1a\u4ece\u7528\u6237\u6001\u8fdb\u5165\u5230\u5185\u6838\u6001\uff0c\u6700\u540e\u4f1a\u8c03\u7528\u5230 <code>sock_sendmsg</code> \u65b9\u6cd5\u3002</p> <p>\u7136\u540e\u8fdb\u5165\u4f20\u8f93\u5c42\uff0c\u5e26\u4e0a<code>TCP</code>\u5934\u3002\u7f51\u7edc\u5c42\u5e26\u4e0a<code>IP</code>\u5934\uff0c\u6570\u636e\u94fe\u8def\u5c42\u5e26\u4e0a <code>MAC</code>\u5934\u7b49\u4e00\u7cfb\u5217\u64cd\u4f5c\u540e\u3002\u8fdb\u5165\u7f51\u5361\u7684\u53d1\u9001\u961f\u5217 ring buffer \uff0c\u987a\u7740\u7f51\u5361\u5c31\u53d1\u51fa\u53bb\u4e86\u3002</p> <p>\u56de\u5230 <code>ping</code> \uff0c\u6574\u4e2a\u8fc7\u7a0b\u4e5f\u57fa\u672c\u8ddf <code>TCP</code> \u53d1\u6570\u636e\u7c7b\u4f3c\uff0c\u5dee\u5f02\u7684\u5730\u65b9\u4e3b\u8981\u5728\u4e8e\uff0c\u521b\u5efa <code>socket</code> \u7684\u65f6\u5019\u7528\u7684\u662f  <code>socket(AF_INET,SOCK_RAW,IPPROTO_ICMP)</code>\uff0c<code>SOCK_RAW</code> \u662f\u539f\u59cb\u5957\u63a5\u5b57\uff0c\u5de5\u4f5c\u5728\u7f51\u7edc\u5c42\uff0c\u6240\u4ee5\u6784\u5efa<code>ICMP</code>\uff08\u7f51\u7edc\u5c42\u534f\u8bae\uff09\u7684\u6570\u636e\uff0c\u662f\u518d\u5408\u9002\u4e0d\u8fc7\u4e86\u3002ping \u5728\u8fdb\u5165\u5185\u6838\u6001\u540e\u6700\u540e\u4e5f\u662f\u8c03\u7528\u7684  <code>sock_sendmsg</code> \u65b9\u6cd5\uff0c\u8fdb\u5165\u5230\u7f51\u7edc\u5c42\u540e\u52a0\u4e0aICMP \u548c IP \u5934\u540e\uff0c\u6570\u636e\u94fe\u8def\u5c42\u52a0\u4e0aMAC \u5934\uff0c\u4e5f\u662f\u987a\u7740\u7f51\u5361\u53d1\u51fa\u3002\u56e0\u6b64 \u672c\u8d28\u4e0a ping \u8ddf \u666e\u901a\u5e94\u7528\u53d1\u6d88\u606f \u5728\u7a0b\u5e8f\u6d41\u7a0b\u4e0a\u6ca1\u592a\u5927\u5dee\u522b\u3002</p> <p>\u8fd9\u4e5f\u89e3\u91ca\u4e86\u4e3a\u4ec0\u4e48\u5f53\u4f60\u53d1\u73b0\u6000\u7591\u7f51\u7edc\u6709\u95ee\u9898\u7684\u65f6\u5019\uff0c\u522b\u4eba\u7b2c\u4e00\u65f6\u95f4\u662f\u95ee\u4f60\u80fd ping \u901a\u5417\uff1f \u56e0\u4e3a\u53ef\u4ee5\u7b80\u5355\u7406\u89e3\u4e3a ping \u5c31\u662f\u81ea\u5df1\u7ec4\u4e86\u4e2a\u6570\u636e\u5305\uff0c\u8ba9\u7cfb\u7edf\u6309\u7740\u5176\u4ed6\u8f6f\u4ef6\u53d1\u9001\u6570\u636e\u7684\u8def\u5f84\u5f80\u5916\u53d1\u4e00\u904d\uff0c\u80fd\u901a\u7684\u8bdd\u8bf4\u660e\u5176\u4ed6\u8f6f\u4ef6\u53d1\u7684\u6570\u636e\u4e5f\u80fd\u901a\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping_lo/#ping-127001","title":"\u4e3a\u4ec0\u4e48\u65ad\u7f51\u4e86\u8fd8\u80fd ping \u901a 127.0.0.1","text":"<p>\u524d\u9762\u63d0\u5230\uff0c\u6709\u7f51\u7684\u60c5\u51b5\u4e0b\uff0cping \u6700\u540e\u662f\u901a\u8fc7\u7f51\u5361\u5c06\u6570\u636e\u53d1\u9001\u51fa\u53bb\u7684\u3002</p> <p>\u90a3\u4e48\u65ad\u7f51\u7684\u60c5\u51b5\u4e0b\uff0c\u7f51\u5361\u5df2\u7ecf\u4e0d\u5de5\u4f5c\u4e86\uff0cping \u56de\u73af\u5730\u5740\u5374\u4e00\u5207\u6b63\u5e38\uff0c\u6211\u4eec\u53ef\u4ee5\u770b\u4e0b\u8fd9\u79cd\u60c5\u51b5\u4e0b\u7684\u5de5\u4f5c\u539f\u7406\u3002</p> <p></p> <p>\u4ece\u5e94\u7528\u5c42\u5230\u4f20\u8f93\u5c42\u518d\u5230\u7f51\u7edc\u5c42\u3002\u8fd9\u6bb5\u8def\u5f84\u8ddf ping \u5916\u7f51\u7684\u65f6\u5019\u662f\u51e0\u4e4e\u662f\u4e00\u6837\u7684\u3002\u5230\u4e86\u7f51\u7edc\u5c42\uff0c\u7cfb\u7edf\u4f1a\u6839\u636e\u76ee\u7684 IP\uff0c\u5728\u8def\u7531\u8868\u4e2d\u83b7\u53d6\u5bf9\u5e94\u7684\u8def\u7531\u4fe1\u606f\uff0c\u800c\u8fd9\u5176\u4e2d\u5c31\u5305\u542b\u9009\u62e9\u54ea\u4e2a\u7f51\u5361\u628a\u6d88\u606f\u53d1\u51fa\u3002</p> <p>\u5f53\u53d1\u73b0\u76ee\u6807 IP \u662f\u5916\u7f51 IP\u65f6\uff0c\u4f1a\u4ece\"\u771f\u7f51\u5361\"\u53d1\u51fa\u3002</p> <p>\u5f53\u53d1\u73b0\u76ee\u6807 IP \u662f\u56de\u73af\u5730\u5740\u65f6\uff0c\u5c31\u4f1a\u9009\u62e9\u672c\u5730\u7f51\u5361\u3002</p> <p>\u672c\u5730\u7f51\u5361\uff0c\u5176\u5b9e\u5c31\u662f\u4e2a \" \u5047\u7f51\u5361 \"\uff0c\u5b83\u4e0d\u50cf\"\u771f\u7f51\u5361\"\u90a3\u6837\u6709\u4e2a<code>ring buffer</code>\u4ec0\u4e48\u7684\uff0c\"\u5047\u7f51\u5361\"\u4f1a\u628a\u6570\u636e\u63a8\u5230\u4e00\u4e2a\u53eb <code>input_pkt_queue</code> \u7684 \u94fe\u8868 \u4e2d\u3002\u8fd9\u4e2a\u94fe\u8868\uff0c\u5176\u5b9e\u662f\u6240\u6709\u7f51\u5361\u5171\u4eab\u7684\uff0c\u4e0a\u9762\u6302\u7740\u53d1\u7ed9\u672c\u673a\u7684\u5404\u79cd\u6d88\u606f\u3002\u6d88\u606f\u88ab\u53d1\u9001\u5230\u8fd9\u4e2a\u94fe\u8868\u540e\uff0c\u4f1a\u518d\u89e6\u53d1\u4e00\u4e2a\u8f6f\u4e2d\u65ad\u3002</p> <p>\u4e13\u95e8\u5904\u7406\u8f6f\u4e2d\u65ad\u7684\u5de5\u5177\u4eba \" ksoftirqd \"\uff08\u8fd9\u662f\u4e2a\u5185\u6838\u7ebf\u7a0b\uff09\uff0c\u5b83\u5728\u6536\u5230\u8f6f\u4e2d\u65ad\u540e\u5c31\u4f1a\u7acb\u9a6c\u53bb\u94fe\u8868\u91cc\u628a\u6d88\u606f\u53d6\u51fa\uff0c\u7136\u540e\u987a\u7740\u6570\u636e\u94fe\u8def\u5c42\u3001\u7f51\u7edc\u5c42\u7b49\u5c42\u5c42\u5f80\u4e0a\u4f20\u9012\u6700\u540e\u7ed9\u5230\u5e94\u7528\u7a0b\u5e8f\u3002</p> <p></p> <p>ping \u56de\u73af\u5730\u5740\u548c\u901a\u8fc7 TCP \u7b49\u5404\u79cd\u534f\u8bae\u53d1\u9001\u6570\u636e\u5230\u56de\u73af\u5730\u5740\u90fd\u662f\u8d70\u8fd9\u6761\u8def\u5f84\u3002\u6574\u6761\u8def\u5f84\u4ece\u53d1\u5230\u6536\uff0c\u90fd\u6ca1\u6709\u7ecf\u8fc7\"\u771f\u7f51\u5361\"\u3002\u4e4b\u6240\u4ee5 127.0.0.1 \u53eb\u672c\u5730\u56de\u73af\u5730\u5740\uff0c\u53ef\u4ee5\u7406\u89e3\u4e3a\uff0c\u6d88\u606f\u53d1\u51fa\u5230\u8fd9\u4e2a\u5730\u5740\u4e0a\u7684\u8bdd\uff0c\u5c31\u4e0d\u4f1a\u51fa\u7f51\u7edc\uff0c\u5728\u672c\u673a\u6253\u4e2a\u8f6c\u5c31\u53c8\u56de\u6765\u4e86\u3002 \u6240\u4ee5\u65ad\u7f51\uff0c\u4f9d\u7136\u80fd <code>ping</code> \u901a <code>127.0.0.1</code>\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping_lo/#ping-ping","title":"ping \u56de\u73af\u5730\u5740\u548c ping \u672c\u673a\u5730\u5740\u6709\u4ec0\u4e48\u533a\u522b","text":"<p>\u6211\u4eec\u5728 mac \u91cc\u6267\u884c <code>ifconfig</code> \u3002</p> Bash<pre><code>$ ifconfig\nlo0: flags=8049&lt;UP,LOOPBACK,RUNNING,MULTICAST&gt; mtu 16384\n    inet 127.0.0.1 netmask 0xff000000\n    ...\nen0: flags=8863&lt;UP,BROADCAST,SMART,RUNNING,SIMPLEX,MULTICAST&gt; mtu 1500\n    inet 192.168.31.6 netmask 0xffffff00 broadcast 192.168.31.255\n    ...\n</code></pre> <p>\u80fd\u770b\u5230 lo0\uff0c\u8868\u793a\u672c\u5730\u56de\u73af\u63a5\u53e3\uff0c\u5bf9\u5e94\u7684\u5730\u5740\uff0c\u5c31\u662f\u6211\u4eec\u524d\u9762\u63d0\u5230\u7684 127.0.0.1 \uff0c\u4e5f\u5c31\u662f\u56de\u73af\u5730\u5740\u3002</p> <p>\u548c eth0\uff0c\u8868\u793a\u672c\u673a\u7b2c\u4e00\u5757\u7f51\u5361\uff0c\u5bf9\u5e94\u7684 IP \u5730\u5740\u662f192.168.31.6\uff0c\u7ba1\u5b83\u53eb\u672c\u673a IP\u3002</p> <p>\u4e4b\u524d\u4e00\u76f4\u8ba4\u4e3a ping \u672c\u673a IP \u7684\u8bdd\u4f1a\u901a\u8fc7\"\u771f\u7f51\u5361\"\u51fa\u53bb\uff0c\u7136\u540e\u9047\u5230\u7b2c\u4e00\u4e2a\u8def\u7531\u5668\uff0c\u518d\u53d1\u56de\u6765\u5230\u672c\u673a\u3002</p> <p>\u4e3a\u4e86\u9a8c\u8bc1\u8fd9\u4e2a\u8bf4\u6cd5\uff0c\u53ef\u4ee5\u8fdb\u884c\u6293\u5305\uff0c\u4f46\u7ed3\u679c\u8ddf\u4e0a\u9762\u7684\u8bf4\u6cd5\u5e76\u4e0d\u76f8\u540c\u3002</p> <p>ping 127.0.0.1:</p> <p></p> <p>ping \u672c\u673a\u5730\u5740\uff1a</p> <p></p> <p>\u53ef\u4ee5\u770b\u5230 ping \u672c\u673a IP \u8ddf ping \u56de\u73af\u5730\u5740\u4e00\u6837\uff0c\u76f8\u5173\u7684\u7f51\u7edc\u6570\u636e\uff0c\u90fd\u662f\u8d70\u7684  lo0\uff0c\u672c\u5730\u56de\u73af\u63a5\u53e3\uff0c\u4e5f\u5c31\u662f\u524d\u9762\u63d0\u5230\u7684\"\u5047\u7f51\u5361\"\u3002</p> <p>\u53ea\u8981\u8d70\u4e86\u672c\u5730\u56de\u73af\u63a5\u53e3\uff0c\u90a3\u6570\u636e\u90fd\u4e0d\u4f1a\u53d1\u9001\u5230\u7f51\u7edc\u4e2d\uff0c\u5728\u672c\u673a\u7f51\u7edc\u534f\u8bae\u6808\u4e2d\u515c\u4e00\u5708\uff0c\u5c31\u53d1\u56de\u6765\u4e86\u3002\u56e0\u6b64 ping \u56de\u73af\u5730\u5740\u548c ping \u672c\u673a\u5730\u5740\u6ca1\u6709\u533a\u522b\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping_lo/#127001-localhost-0000","title":"127.0.0.1 \u548c localhost \u4ee5\u53ca 0.0.0.0 \u6709\u533a\u522b\u5417","text":"<p>\u56de\u5230\u6587\u7ae0\u5f00\u5934\u52a8\u56fe\u91cc\u7684\u63d0\u95ee\uff0c\u7b97\u662f\u9762\u8bd5\u516b\u80a1\u6587\u91cc\u7684\u8001\u5e38\u5ba2\u4e86\u3002</p> <p>\u4ee5\u524d\u7b2c\u4e00\u6b21\u7528 <code>nginx</code> \u7684\u65f6\u5019\uff0c\u53d1\u73b0\u7528\u8fd9\u51e0\u4e2a <code>IP</code>\uff0c\u90fd\u80fd\u6b63\u5e38\u8bbf\u95ee\u5230 <code>nginx</code> \u7684\u6b22\u8fce\u7f51\u9875\u3002\u4e00\u5ea6\u8ba4\u4e3a\u8fd9\u51e0\u4e2a <code>IP</code> \u90fd\u662f\u4e00\u6837\u7684\u3002</p> <p>\u8bbf\u95ee 127.0.0.1:80</p> <p></p> <p>\u8bbf\u95ee localhost:80</p> <p></p> <p>\u8bbf\u95ee 0.0.0.0:80</p> <p></p> <p>\u8bbf\u95ee\u672c\u673a\u7684 IP \u5730\u5740</p> <p></p> <p>\u4f46\u672c\u8d28\u4e0a\u8fd8\u662f\u6709\u4e9b\u533a\u522b\u7684\u3002</p> <p>\u9996\u5148 <code>localhost</code> \u5c31\u4e0d\u53eb <code>IP</code>\uff0c\u5b83\u662f\u4e00\u4e2a\u57df\u540d\uff0c\u5c31\u8ddf <code>\"baidu.com\"</code>,\u662f\u4e00\u4e2a\u5f62\u5f0f\u7684\u4e1c\u897f\uff0c\u53ea\u4e0d\u8fc7\u9ed8\u8ba4\u4f1a\u628a\u5b83\u89e3\u6790\u4e3a <code>127.0.0.1</code> \uff0c\u5f53\u7136\u8fd9\u53ef\u4ee5\u5728 <code>/etc/hosts</code> \u6587\u4ef6\u4e0b\u8fdb\u884c\u4fee\u6539\u3002</p> <p>\u6240\u4ee5\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4f7f\u7528 <code>localhost</code> \u8ddf\u4f7f\u7528  <code>127.0.0.1</code> \u786e\u5b9e\u662f\u6ca1\u533a\u522b\u7684\u3002</p> <p>\u5176\u6b21\u5c31\u662f <code>0.0.0.0</code>\uff0c\u6267\u884c ping 0.0.0.0\uff0c\u662f\u4f1a\u5931\u8d25\u7684\uff0c\u56e0\u4e3a\u5b83\u5728<code>IPV4</code>\u4e2d\u8868\u793a\u7684\u662f\u65e0\u6548\u7684\u76ee\u6807\u5730\u5740\u3002</p> Bash<pre><code>$ ping 0.0.0.0\nPING 0.0.0.0 (0.0.0.0): 56 data bytes\nping: sendto: No route to host\nping: sendto: No route to host\n</code></pre> <p>\u4f46\u5b83\u8fd8\u662f\u5f88\u6709\u7528\u5904\u7684\uff0c\u56de\u60f3\u4e0b\uff0c\u6211\u4eec\u542f\u52a8\u670d\u52a1\u5668\u7684\u65f6\u5019\uff0c\u4e00\u822c\u4f1a <code>listen</code> \u4e00\u4e2a IP \u548c\u7aef\u53e3\uff0c\u7b49\u5f85\u5ba2\u6237\u7aef\u7684\u8fde\u63a5\u3002</p> <p>\u5982\u679c\u6b64\u65f6 <code>listen</code> \u7684\u662f\u672c\u673a\u7684 <code>0.0.0.0</code> , \u90a3\u4e48\u5b83\u8868\u793a\u672c\u673a\u4e0a\u7684\u6240\u6709 IPV4 \u5730\u5740\u3002</p> C<pre><code>/* Address to accept any incoming messages. */\n#define    INADDR_ANY      ((unsigned long int) 0x00000000) /* 0.0.0.0   */\n</code></pre> <p>\u4e3e\u4e2a\u4f8b\u5b50\u3002\u521a\u521a\u63d0\u5230\u7684 <code>127.0.0.1</code> \u548c <code>192.168.31.6</code> \uff0c\u90fd\u662f\u672c\u673a\u7684 IPV4 \u5730\u5740\uff0c\u5982\u679c\u76d1\u542c <code>0.0.0.0</code> \uff0c\u90a3\u4e48\u7528\u4e0a\u9762\u4e24\u4e2a\u5730\u5740\uff0c\u90fd\u80fd\u8bbf\u95ee\u5230\u8fd9\u4e2a\u670d\u52a1\u5668\u3002</p> <p>\u5f53\u7136\uff0c\u5ba2\u6237\u7aef <code>connect</code> \u65f6\uff0c\u4e0d\u80fd\u4f7f\u7528 <code>0.0.0.0</code> \u3002\u5fc5\u987b\u6307\u660e\u8981\u8fde\u63a5\u54ea\u4e2a\u670d\u52a1\u5668 IP\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/4_ip/ping_lo/#_1","title":"\u603b\u7ed3","text":"<ul> <li><code>127.0.0.1</code> \u662f\u56de\u73af\u5730\u5740\u3002<code>localhost</code>\u662f\u57df\u540d\uff0c\u4f46\u9ed8\u8ba4\u7b49\u4e8e <code>127.0.0.1</code>\u3002</li> <li><code>ping</code> \u56de\u73af\u5730\u5740\u548c <code>ping</code> \u672c\u673a\u5730\u5740\uff0c\u662f\u4e00\u6837\u7684\uff0c\u8d70\u7684\u662flo0 \"\u5047\u7f51\u5361\"\uff0c\u90fd\u4f1a\u7ecf\u8fc7\u7f51\u7edc\u5c42\u548c\u6570\u636e\u94fe\u8def\u5c42\u7b49\u903b\u8f91\uff0c\u6700\u540e\u5728\u5feb\u8981\u51fa\u7f51\u5361\u524d\u72e0\u72e0\u62d0\u4e86\u4e2a\u5f2f\uff0c\u5c06\u6570\u636e\u63d2\u5165\u5230\u4e00\u4e2a\u94fe\u8868\u540e\u5c31\u8f6f\u4e2d\u65ad\u901a\u77e5 ksoftirqd \u6765\u8fdb\u884c\u6536\u6570\u636e\u7684\u903b\u8f91\uff0c\u538b\u6839\u5c31\u4e0d\u51fa\u7f51\u7edc\u3002\u6240\u4ee5\u65ad\u7f51\u4e86\u4e5f\u80fd <code>ping</code> \u901a\u56de\u73af\u5730\u5740\u3002</li> <li>\u5982\u679c\u670d\u52a1\u5668 <code>listen</code> \u7684\u662f <code>0.0.0.0</code>\uff0c\u90a3\u4e48\u6b64\u65f6\u7528<code>127.0.0.1</code>\u548c\u672c\u673a\u5730\u5740\u90fd\u53ef\u4ee5\u8bbf\u95ee\u5230\u670d\u52a1\u3002</li> </ul> <p>\u54c8\u55bd\uff0c\u6211\u662f\u5c0f\u6797\uff0c\u5c31\u7231\u56fe\u89e3\u8ba1\u7b97\u673a\u57fa\u7840\uff0c\u5982\u679c\u89c9\u5f97\u6587\u7ae0\u5bf9\u4f60\u6709\u5e2e\u52a9\uff0c\u522b\u5fd8\u8bb0\u5173\u6ce8\u6211\u54e6\uff01</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/5_learn/draw/","title":"6.2 \u753b\u56fe\u7ecf\u9a8c\u5206\u4eab","text":"<p>\u5c0f\u6797\u5199\u8fd9\u4e48\u591a\u7bc7\u56fe\u89e3\u6587\u7ae0\uff0c\u4f60\u4eec\u731c\u6211\u6536\u5230\u7684\u6700\u591a\u7684\u8bfb\u8005\u95ee\u9898\u662f\u4ec0\u4e48\uff1f\u6ca1\u9519\uff0c\u5c31\u662f\u95ee\u6211\u662f\u4f7f\u7528\u4ec0\u4e48\u753b\u56fe\u5de5\u5177\uff0c\u770b\u6765\u5bf9\u8fd9\u4e00\u70b9\u5927\u5bb6\u90fd\u76f8\u5f53\u597d\u5947\uff0c\u90a3\u5e72\u8106\u4e0d\u5982\u5199\u4e00\u7bc7\u4ecb\u7ecd\u4e0b\u6211\u662f\u600e\u4e48\u753b\u56fe\u7684\u3002</p> <p>\u5982\u679c\u6211\u7684\u6587\u7ae0\u7f3a\u5c11\u4e86\u81ea\u5df1\u753b\u7684\u56fe\u7247\uff0c\u76f8\u5f53\u4e8e\u5931\u53bb\u4e86\u7075\u9b42\uff0c\u6280\u672f\u6587\u7ae0\u672c\u8eab\u5c31\u5f88\u67af\u71e5\uff0c\u5982\u679c\u6587\u7ae0\u4e2d\u6ca1\u6709\u51e0\u5f20\u56fe\u7247\uff0c\u8bfb\u8005\u88ab\u529d\u9000\u7684\u6982\u7387\u98d9\u98d9\u5347\uff0c\u5269\u4e0b\u6ca1\u88ab\u529d\u9000\u7684\u4f30\u8ba1\u770b\u7740\u770b\u7740\u5c31\u7761\u7740\u4e86\u3002\u6240\u4ee5\uff0c\u7cbe\u7f8e\u7684\u56fe\u7247\u53ef\u4ee5\u8bf4\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u4e00\u90e8\u5206\uff0c\u4e0d\u4ec5\u5728\u9605\u8bfb\u65f6\u80fd\u5e26\u6765\u89c6\u89c9\u7684\u51b2\u51fb\uff0c\u800c\u4e14\u56fe\u7247\u76f8\u6bd4\u6587\u5b57\u80fd\u6db5\u76d6\u66f4\u591a\u7684\u4fe1\u606f\uff0c\u4e0d\u7136\u600e\u4f1a\u6709\u4e00\u56fe\u80dc\u5343\u8a00\u7684\u8bf4\u6cd5\u5462\uff1f</p> <p>\u8fd9\u65f6\uff0c\u53ef\u80fd\u6709\u7684\u8bfb\u8005\u4f1a\u8bf4\u81ea\u5df1\u4e0d\u5199\u6587\u7ae0\u5440\uff0c\u662f\u4e0d\u662f\u6ca1\u6709\u5fc5\u8981\u4e86\u89e3\u753b\u56fe\u4e86\uff1f\u6211\u89c9\u5f97\u8fd9\u662f\u4e0d\u5bf9\uff0c\u753b\u56fe\u5728\u6211\u4eec\u5de5\u4f5c\u4e2d\u5176\u5b9e\u4e5f\u662f\u6709\u5e2e\u52a9\u7684\uff0c\u6bd4\u5982\u5982\u679c\u4f60\u60f3\u8ddf\u9886\u5bfc\u6c47\u62a5\u4e00\u4e2a\u4e1a\u52a1\u6d41\u7a0b\u7684\u95ee\u9898\uff0c\u628a\u4e1a\u52a1\u6d41\u7a0b\u753b\u51fa\u6765\uff0c\u80af\u5b9a\u7528\u56fe\u7684\u65b9\u5f0f\u6bd4\u7528\u6587\u5b57\u7684\u65b9\u5f0f\u4ea4\u6d41\u8d77\u6765\u4f1a\u66f4\u6709\u6548\u7387\uff0c\u66f4\u8f7b\u677e\u4e9b\uff1b\u5982\u679c\u4f60\u53c2\u4e0e\u4e86\u4e00\u4e2a\u6bd4\u8f83\u590d\u6742\u7684\u9879\u76ee\u5f00\u53d1\uff0c\u4f60\u4e5f\u53ef\u4ee5\u628a\u4ee3\u7801\u7684\u6d41\u7a0b\u56fe\u7ed9\u753b\u51fa\u6765\uff0c\u4e0d\u4ec5\u80fd\u5e2e\u52a9\u81ea\u5df1\u52a0\u6df1\u7406\u89e3\uff0c\u4e5f\u80fd\u5e2e\u52a9\u540e\u9762\u53c2\u4e0e\u7684\u540c\u4e8b\u80fd\u66f4\u5feb\u7684\u63a5\u624b\u8fd9\u4e2a\u9879\u76ee\uff1b\u751a\u81f3\u5982\u679c\u4f60\u8981\u664b\u5347\u7ea7\u522b\u4e86\uff0c\u6f14\u8bb2 PTT \u91cc\u7684\u914d\u56fe\u4e5f\u662f\u5fc5\u4e0d\u53ef\u5c11\u7684\u3002</p> <p>\u4e0d\u8fc7\u5f88\u591a\u4eba\u90fd\u662f\u7ea0\u7ed3\u7528\u4ec0\u4e48\u753b\u56fe\u5de5\u5177\uff0c\u5176\u5b9e\u5c0f\u6797\u89c9\u5f97\u518d\u70c2\u7684\u753b\u56fe\u5de5\u5177\uff0c\u53ea\u8981\u4f60\u601d\u8def\u6e05\u6670\uff0c\u786e\u5b9a\u81ea\u5df1\u8981\u8868\u8fbe\u51fa\u4ec0\u4e48\u4fe1\u606f\uff0c\u4e5f\u662f\u80fd\u628a\u56fe\u753b\u597d\u7684\uff0c\u6240\u4ee5\u4e0d\u5fc5\u7ea0\u7ed3\u54ea\u6b3e\u753b\u56fe\u5de5\u5177\uff0c\u6311\u4e00\u6b3e\u81ea\u5df1\u753b\u8d77\u6765\u8212\u670d\u7684\u5c31\u884c\u4e86\u3002</p> <p>\u201c\u5c0f\u6797\uff0c\u4f60\u8bf4\u7684\u6211\u90fd\u61c2\uff0c\u6211\u5c31\u662f\u559c\u6b22\u4f60\u7684\u753b\u56fe\u98ce\u683c\u561b\uff0c\u4f60\u5c31\u8bf4\u8bf4\u4f60\u7528\u5565\u753b\u7684\uff1f\u201d</p> <p>\u54b3\u54b3\uff0c\u6ca1\u95ee\u9898\uff0c\u76f4\u63a5\u5766\u767d\u8bb2\uff0c\u6211\u7528\u7684\u662f\u4e00\u4e2a\u5728\u7ebf\u7684\u753b\u56fe\u7f51\u5740\uff0c\u5730\u5740\u662f\uff1a - https://draw.io</p> <p>\u7528\u5b83\u7684\u539f\u56e0\u662f\u4f7f\u7528\u65b9\u4fbf\u548c\u7b80\u5355\uff0c\u5f53\u7136\u6700\u91cd\u8981\u7684\u662f\u5b83\u5b8c\u5168\u514d\u8d39\uff0c\u6ca1\u6709\u4ec0\u4e48\u9650\u5236\uff0c\u751a\u81f3\u8fd8\u80fd\u76f4\u63a5\u628a\u56fe\u7247\u4fdd\u5b58\u5230 GoogleDrive\u3001OneDrive \u548c Github\uff0c\u6211\u5c31\u662f\u4fdd\u5b58\u5230 Github\uff0c\u7136\u540e\u7528 Github \u4f5c\u4e3a\u6211\u7684\u56fe\u5e8a\u3002</p> <p>\u65e2\u7136\u8981\u8ba4\u8bc6\u5b83\uff0c\u90a3\u5c31\u5148\u6765\u770b\u770b\u5b83\u957f\u4ec0\u4e48\u6837\u5b50\uff0c\u5b83\u4e3b\u8981\u5206\u4e3a\u4e09\u4e2a\u533a\u57df\uff0c\u4ece\u5de6\u5f80\u53f3\u7684\u987a\u5e8f\u662f\u300c\u56fe\u5f62\u9009\u62e9\u533a\u57df\u3001\u7ed8\u56fe\u533a\u57df\u3001\u5c5e\u6027\u8bbe\u7f6e\u533a\u57df\u300d\u3002</p> <p></p> <p>\u5176\u4e2d\uff0c\u6700\u5de6\u8fb9\u7684\u300c\u56fe\u5f62\u9009\u62e9\u533a\u57df\u300d\u53ef\u4ee5\u9009\u62e9\u7684\u56fe\u6848\u6709\u5f88\u591a\u79cd\uff0c\u5e38\u89c1\u7684\u6d41\u7a0b\u56fe\u3001\u65f6\u5e8f\u56fe\u3001\u8868\u683c\u56fe\u90fd\u6709\uff0c\u751a\u81f3\u8fd8\u53ef\u4ee5\u5728\u6700\u5de6\u4e0b\u89d2\u7684\u300c\u66f4\u591a\u56fe\u5f62\u300d\u627e\u5230\u5176\u4ed6\u79cd\u7c7b\u7684\u56fe\u5f62\uff0c\u6bd4\u5982\u7f51\u7edc\u8bbe\u5907\u56fe\u6807\u7b49\u3002</p> <p></p> <p>\u518d\u6765\uff0c\u6700\u53f3\u8fb9\u300c\u5c5e\u6027\u8bbe\u7f6e\u533a\u57df\u300d\u53ef\u4ee5\u8bbe\u7f6e\u6587\u5b57\u7684\u5927\u5c0f\uff0c\u56fe\u7247\u989c\u8272\u3001\u7ebf\u6761\u5f62\u72b6\u7b49\uff0c\u800c\u6211\u6700\u5e38\u7528\u989c\u8272\u677f\u5757\u662f\u4e0b\u9762\u8fd9\u4e09\u79cd\uff0c\u90fd\u662f\u6bd4\u8f83\u6d45\u8272\u7684\uff0c\u8fd9\u6837\u770b\u8d77\u6765\u8212\u670d\u4e9b\u3002</p> <p></p> <p></p> <p>\u6211\u6700\u8fd1\u5e38\u7528\u7684\u4e00\u4e2a\u56fe\u5f62\u662f\u5706\u89d2\u65b9\u5757\u56fe\uff0c\u5b83\u7684\u4f4d\u7f6e\u5982\u4e0b\u56fe\uff0c\u4f46\u662f\u5b83\u9ed8\u8ba4\u7684\u989c\u8272\u8fc7\u4e8e\u6df1\u8272\uff0c\u5982\u679c\u8981\u5728\u65b9\u6846\u56fe\u4e2d\u63cf\u8ff0\u6587\u5b57\uff0c\u5219\u53ef\u80fd\u770b\u4e0d\u6e05\u695a\uff0c\u8fd9\u65f6\u6211\u4f1a\u5728\u6700\u53f3\u4fa7\u7684\u300c\u5c5e\u6027\u8bbe\u7f6e\u533a\u57df\u300d\u628a\u65b9\u5757\u989c\u8272\u8bbe\u7f6e\u6210\u6d45\u8272\u7cfb\u5217\u7684\u3002\u53e6\u5916\uff0c\u8fd8\u6709\u4e00\u70b9\u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u9ed8\u8ba4\u7684\u5b57\u4f53\u5927\u5c0f\u6bd4\u8f83\u5c0f\uff0c\u6211\u4e00\u822c\u4f1a\u8c03\u6210 <code>16px</code> \u5927\u5c0f\u3002</p> <p></p> <p>\u5982\u679c\u4f60\u4e0d\u559c\u6b22\u4e0a\u56fe\u7684\u5e26\u6709\u300c\u5212\u75d5\u300d\u7684\u5706\u89d2\u65b9\u5757\u56fe\u5f62\uff0c\u53ef\u4ee5\u9009\u62e9\u4e0b\u56fe\u4e2d\u8fd9\u4e2a\u6700\u7b80\u6d01\u7684\u5706\u89d2\u65b9\u6846\u56fe\u5f62\u3002</p> <p></p> <p>\u8fd9\u4e2a\u7b80\u6d01\u7684\u5706\u89d2\u65b9\u6846\u56fe\u5f62\uff0c\u518d\u642d\u914d\u989c\u8272\uff0c\u80fd\u7ec4\u5408\u6210\u5f88\u591a\u7ed3\u6784\u56fe\uff0c\u6bd4\u5982\u6211\u7528\u8fc7\u5b83\u7ec4\u6210\u8fc7 CPU Cache \u7684\u7ed3\u6784\u56fe\u3002</p> <p></p> <p>\u90a3\u76f4\u89d2\u65b9\u6846\u56fe\u5f62\uff0c\u6211\u4e3b\u8981\u662f\u7528\u6765\u7ec4\u6210\u300c\u8868\u683c\u300d\uff0c\u539f\u56e0\u81ea\u5e26\u7684\u8868\u683c\u4e0d\u597d\u770b\uff0c\u4e5f\u4e0d\u65b9\u4fbf\u8c03\u3002</p> <p></p> <p>\u5982\u679c\u89c9\u5f97\u76f4\u76f4\u7684\u7ebf\u6761\u592a\u6b7b\u677f\uff0c\u4f60\u53ef\u4ee5\u628a\u56fe\u7247\u5c5e\u6027\u4e2d\u7684\u300cComic\u300d\u52fe\u4e0a\uff0c\u4e8e\u662f\u5c31\u4f1a\u53d8\u6210\u6b6a\u6b6a\u626d\u626d\u7684\u6548\u679c\u5566\uff0c\u6709\u70b9\u50cf\u624b\u7ed8\u98ce\u683c\uff0c\u633a\u591a\u4eba\u559c\u6b22\u8fd9\u79cd\u98ce\u683c\u3002</p> <p>\u6bd4\u5982\uff0c\u6211\u7528\u8fc7\u8fd9\u79cd\u98ce\u683c\u753b\u8fc7 TCP \u4e09\u6b21\u63e1\u624b\u6d41\u7a0b\u7684\u56fe\u3002</p> <p></p> <p>\u65b9\u5757\u56fe\u5f62\u518d\u52a0\u4e0a\u83f1\u5f62\uff0c\u5c31\u53ef\u4ee5\u7ec4\u5408\u6210\u7b80\u5355\u7a0b\u5e8f\u6d41\u7a0b\u56fe\u4e86\uff0c\u6bd4\u5982\u6211\u753b\u8fc7\u5b58\u50a8\u5668\u7f13\u5b58\u6d41\u7a0b\u56fe\u3002</p> <p></p> <p>\u6240\u4ee5\uff0c\u4e0d\u8981\u5c0f\u770b\u8fd9\u4e9b\u57fa\u672c\u56fe\u5f62\uff0c\u53ea\u8981\u6784\u601d\u6e05\u6670\uff0c\u518d\u57fa\u672c\u7684\u56fe\u5f62\uff0c\u4e5f\u662f\u80fd\u6784\u6210\u5c42\u6b21\u5206\u660e\u5e76\u4e14\u597d\u770b\u7684\u56fe\u3002</p> <p>\u57fa\u672c\u7684\u56fe\u5f62\u4ecb\u7ecd\u5b8c\u540e\uff0c\u76f8\u4fe1\u4f60\u753b\u4e00\u4e9b\u7b80\u5355\u7a0b\u5e8f\u6d41\u7a0b\u56fe\u7b49\u56fe\u5f62\u662f\u6ca1\u95ee\u9898\u7684\u4e86\uff0c\u63a5\u4e0b\u6765\u5c31\u662f\u5404\u79cd\u56fe\u5f62 + \u7ebf\u6761\u7684\u7ec4\u5408\u7684\u4e86\u3002</p> <p>\u901a\u8fc7\u4e00\u4e9b\u57fa\u672c\u7684\u56fe\u5f62\u7ec4\u5408\uff0c\u4f60\u8fd8\u53ef\u4ee5\u753b\u51fa\u65f6\u5e8f\u56fe\uff0c\u65f6\u5e8f\u56fe\u53ef\u4ee5\u7528\u6765\u63cf\u8ff0\u591a\u4e2a\u5bf9\u8c61\u4e4b\u95f4\u7684\u4ea4\u4e92\u6d41\u7a0b\uff0c\u6bd4\u5982\u6211\u753b\u8fc7\u591a\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u4e92\u65a5\u9501\u7684\u65f6\u5e8f\u56fe\u3002</p> <p></p> <p>\u518d\u6765\uff0c\u4e3a\u4e86\u66f4\u597d\u8868\u8fbe\u96f6\u62f7\u8d1d\u6280\u672f\u7684\u8fc7\u7a0b\uff0c\u90a3\u4e48\u7528\u56fe\u7684\u65b9\u5f0f\u4f1a\u66f4\u6e05\u6670\u3002</p> <p></p> <p>\u524d\u9762\u4e5f\u63d0\u5230\uff0c\u56fe\u5f62\u4e0d\u53ea\u662f\u7b80\u5355\u56fe\u5f62\uff0c\u8fd8\u6709\u5176\u4ed6\u81ea\u5e26\u7684\u8bbe\u5907\u7c7b\u56fe\u5f62\uff0c\u6bd4\u5982\u6211\u7528\u7f51\u7edc\u8bbe\u5907\u56fe\u753b\u8fc7\u5355\u64ad\u3001\u5e7f\u64ad\u3001\u591a\u64ad\u901a\u4fe1\u7684\u533a\u522b\u56fe\u3002</p> <p></p> <p>\u4f60\u8981\u8bf4\uff0c\u6211\u753b\u8fc7\u6700\u590d\u6742\u7684\u56fe\uff0c\u90a3\u5c31\u662f\u5199 TCP \u6d41\u91cf\u63a7\u5236\u7684\u65f6\u5019\uff0c\u628a\u6574\u4e2a\u4ea4\u4e92\u8fc7\u7a0b + \u6587\u5b57\u63cf\u8ff0 + \u6ed1\u52a8\u7a97\u53e3\u72b6\u51b5\u90fd\u753b\u51fa\u6765\u4e86\uff0c\u73b0\u5728\u56de\u60f3\u8d77\u6765\u8fd8\u662f\u89c9\u5f97\u7d2f\u4eba\u3002</p> <p></p> <p>\u8fd8\u6709\u597d\u591a\u597d\u591a\uff0c\u6211\u5c31\u6bd4\u4e00\u4e00\u5217\u4e3e\uff0c\u8fd9\u534a\u5e74\u4e0b\u6765\uff0c\u5c0f\u6797\u81f3\u5c11\u753b\u4e86 <code>500+</code> \u5f20\u56fe\u4e86\uff0c\u6bcf\u4e00\u5f20\u56fe\u5176\u5b9e\u8fd8\u662f\u633a\u8d39\u65f6\u95f4\u7684\uff0c\u76f8\u4fe1\u753b\u8fc7\u56fe\u7684\u670b\u53cb\u540e\uff0c\u90fd\u80fd\u4f53\u4f1a\u5230\u8fd9\u79cd\u611f\u89c9\u4e86\u3002\u4f46\u6ca1\u529e\u6cd5\uff0c\u8c01\u53eb\u5c0f\u6797\u662f\u56fe\u89e3\u5de5\u5177\u4eba\u5462\uff0c\u753b\u56fe\u53ef\u4ee5\u66f4\u597d\u7684\u8be0\u91ca\u6587\u7ae0\u5185\u5bb9\uff0c\u4f46\u6700\u91cd\u8981\u7684\u662f\uff0c\u628a\u4f60\u4eec\u5438\u5f15\u8fc7\u6765\u4e86\uff0c\u8fd9\u662f\u4ef6\u8ba9\u6211\u975e\u5e38\u9ad8\u5174\u7684\u4e8b\u60c5\uff0c\u4e5f\u662f\u8ba9\u6211\u611f\u89c9\u753b\u56fe\u8fd9\u4e2a\u4e8b\u60c5\u503c\u5f97\u8ba4\u771f\u505a\u3002</p> <p>\u53e6\u5916\uff0c\u7ec6\u5fc3\u7684\u8bfb\u8005\u4e5f\u53d1\u73b0\u4e86\uff0c\u5c0f\u6797\u8d34\u4ee3\u7801\u7684\u65f6\u5019\uff0c\u4f7f\u7528\u7684\u662f\u56fe\u7247\u7684\u5f62\u5f0f\uff0c\u539f\u56e0\u662f\u4ee3\u7801\u901a\u5e38\u90fd\u662f\u6bd4\u8f83\u957f\uff0c\u5728\u624b\u673a\u770b\u6587\u7ae0\u7528\u56fe\u7247\u7684\u5448\u73b0\u7684\u65b9\u5f0f\u4f1a\u66f4\u8212\u670d\u6e05\u6670\u3002</p> <p>\u5728\u8fd9\u91cc\u4e5f\u63a8\u8350\u4e0b\u8fd9\u4e2a\u4ee3\u7801\u622a\u56fe\u7f51\u5740\uff1a - https://carbon.now.sh/</p> <p>\u7f51\u7ad9\u9875\u9762\u5982\u4e0b\u56fe\uff0c\u4ee3\u7801\u663e\u793a\u7684\u6548\u679c\u662f\u4e0d\u662f\u5f88\u7f8e\u89c2\uff1f</p> <p></p> <p>\u6587\u5b57\u7684\u5206\u4eab\u6709\u5c40\u9650\u6027\uff0c\u5173\u952e\u8fd8\u662f\u8981\u4f60\u81ea\u5df1\u52a8\u624b\u6478\u7d22\u6478\u7d22\uff0c\u5f62\u6210\u81ea\u5df1\u4e00\u5957\u753b\u56fe\u7684\u65b9\u6cd5\u8bba\uff0c\u7ec3\u4e60\u7684\u65f6\u5019\u53ef\u4ee5\u5148\u4ece\u6a21\u4eff\u753b\u8d77\uff0c\u540e\u9762\u518d\u7ed3\u5408\u5de5\u4f5c\u6216\u6587\u7ae0\u7684\u9700\u6c42\u753b\u51fa\u81ea\u5df1\u5fc3\u4e2d\u7684\u90a3\u4e2a\u56fe\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/5_learn/learn_network/","title":"6.1 \u8ba1\u7b97\u673a\u7f51\u7edc\u600e\u4e48\u5b66\uff1f","text":"<p>\u8ba1\u7b97\u673a\u7f51\u7edc\u76f8\u6bd4\u64cd\u4f5c\u7cfb\u7edf\u597d\u5b66\u975e\u5e38\u591a\uff0c\u56e0\u4e3a\u8ba1\u7b97\u673a\u7f51\u7edc\u4e0d\u62bd\u8c61\uff0c\u4f60\u8981\u60f3\u77e5\u9053\u7f51\u7edc\u4e2d\u7684\u7ec6\u8282\uff0c\u4f60\u90fd\u53ef\u4ee5\u901a\u8fc7\u6293\u5305\u6765\u5206\u6790\uff0c\u800c\u4e14\u4e0d\u7ba1\u662f\u624b\u673a\u3001\u4e2a\u4eba\u7535\u8111\u548c\u670d\u52a1\u5668\uff0c\u5b83\u4eec\u6240\u4f7f\u7528\u7684\u8ba1\u7b97\u7f51\u7edc\u534f\u8bae\u662f\u4e00\u81f4\u7684\u3002</p> <p>\u4e5f\u5c31\u662f\u8bf4\uff0c\u8ba1\u7b97\u673a\u7f51\u7edc\u4e0d\u4f1a\u56e0\u4e3a\u8bbe\u5907\u7684\u4e0d\u540c\u800c\u4e0d\u540c\uff0c\u5927\u5bb6\u90fd\u9075\u5faa\u8fd9\u4e00\u5957\u300c\u89c4\u5219\u300d\u6765\u76f8\u4e92\u901a\u4fe1\uff0c\u8fd9\u5957\u89c4\u5219\u5c31\u662f TCP/IP \u7f51\u7edc\u6a21\u578b\u3002</p> <p></p> <p>TCP/IP \u7f51\u7edc\u53c2\u8003\u6a21\u578b\u5171\u6709 <code>4</code> \u5c42\uff0c\u5176\u4e2d\u9700\u8981\u6211\u4eec\u719f\u7ec3\u638c\u63e1\u7684\u662f\u5e94\u7528\u5c42\u3001\u4f20\u8f93\u5c42\u548c\u7f51\u7edc\u5c42\uff0c\u81f3\u4e8e\u7f51\u7edc\u63a5\u53e3\u5c42\uff08\u6570\u636e\u94fe\u8def\u5c42\u548c\u7269\u7406\u5c42\uff09\u6211\u4eec\u53ea\u9700\u8981\u505a\u7b80\u5355\u7684\u4e86\u89e3\u5c31\u53ef\u4ee5\u4e86\u3002</p> <p>\u5bf9\u4e8e\u5e94\u7528\u5c42\uff0c\u5f53\u7136\u91cd\u70b9\u8981\u719f\u6089\u6700\u5e38\u89c1\u7684 HTTP \u548c HTTPS\uff0c\u4f20\u8f93\u5c42 TCP \u548c UDP \u90fd\u8981\u719f\u6089\uff0c\u7f51\u7edc\u5c42\u8981\u719f\u6089 IPv4\uff0cIPv6 \u53ef\u4ee5\u505a\u7b80\u5355\u70b9\u4e86\u89e3\u3002</p> <p>\u6211\u89c9\u5f97\u5b66\u4e60\u4e00\u4e2a\u4e1c\u897f\uff0c\u5c31\u4ece\u6211\u4eec\u5e38\u89c1\u7684\u4e8b\u60c5\u5f00\u59cb\u7740\u624b\u3002</p> <p>\u6bd4\u5982\uff0cping \u547d\u4ee4\u53ef\u4ee5\u8bf4\u5728\u6211\u4eec\u5224\u65ad\u7f51\u7edc\u73af\u5883\u7684\u65f6\u5019\uff0c\u6700\u5e38\u4f7f\u7528\u7684\u4e86\uff0c\u4f60\u53ef\u4ee5\u5148\u628a\u4f60\u7535\u8111 ping \u4f60\u820d\u53cb\u6216\u540c\u4e8b\u7684\u7535\u8111\u7684\u8fc7\u7a0b\u4e2d\u53d1\u751f\u7684\u4e8b\u60c5\u90fd\u641e\u660e\u767d\uff0c\u8fd9\u6837\u5c31\u57fa\u672c\u77e5\u9053\u4e00\u4e2a\u6570\u636e\u5305\u662f\u600e\u4e48\u8f6c\u53d1\u7684\u4e86\uff0c\u4e8e\u662f\u4f60\u5c31\u77e5\u9053\u4e86\u7f51\u7edc\u5c42\u3001\u6570\u636e\u94fe\u8def\u5c42\u548c\u7269\u7406\u5c42\u4e4b\u95f4\u662f\u5982\u4f55\u5de5\u4f5c\uff0c\u5982\u4f55\u76f8\u4e92\u914d\u5408\u7684\u4e86\u3002</p> <p>\u641e\u660e\u767d\u4e86 ping \u8fc7\u7a0b\uff0c\u6211\u76f8\u4fe1\u4f60\u5b66\u8d77 HTTP \u8bf7\u6c42\u8fc7\u7a0b\u7684\u65f6\u5019\uff0c\u4f1a\u5f88\u5feb\u5c31\u80fd\u638c\u63e1\u4e86\uff0c\u56e0\u4e3a\u7f51\u7edc\u5c42\u4ee5\u4e0b\u7684\u5de5\u4f5c\u65b9\u5f0f\uff0c\u4f60\u5728\u5b66\u4e60 ping \u7684\u65f6\u5019\u5c31\u5df2\u7ecf\u660e\u767d\u4e86\uff0c\u8fd9\u65f6\u5c31\u53ea\u9700\u8981\u8ba4\u771f\u638c\u63e1\u4f20\u8f93\u5c42\u4e2d\u7684 TCP \u548c\u5e94\u7528\u5c42\u4e2d\u7684 HTTP \u534f\u8bae\uff0c\u5c31\u80fd\u641e\u660e\u767d\u8bbf\u95ee\u7f51\u9875\u7684\u6574\u4e2a\u8fc7\u7a0b\u4e86\uff0c\u8fd9\u4e5f\u662f\u9762\u8bd5\u5e38\u89c1\u7684\u9898\u76ee\u4e86\uff0c\u6bd5\u7adf\u5b83\u80fd\u8003\u5bdf\u4f60\u7f51\u7edc\u77e5\u8bc6\u7684\u5168\u9762\u6027\u3002</p> <p>\u91cd\u4e2d\u4e4b\u91cd\u7684\u77e5\u8bc6\u5c31\u662f TCP \u4e86\uff0cTCP \u4e0d\u7ba1\u662f\u5efa\u7acb\u8fde\u63a5\u3001\u65ad\u5f00\u8fde\u63a5\u7684\u8fc7\u7a0b\uff0c\u8fd8\u662f\u6570\u636e\u4f20\u8f93\u7684\u8fc7\u7a0b\uff0c\u90fd\u4e0d\u80fd\u653e\u8fc7\uff0c\u9488\u5bf9\u6570\u636e\u53ef\u9760\u4f20\u8f93\u7684\u7279\u6027\uff0c\u53c8\u53ef\u4ee5\u62c6\u89e3\u4e3a\u8d85\u65f6\u91cd\u4f20\u3001\u6d41\u91cf\u63a7\u5236\u3001\u6ed1\u52a8\u7a97\u53e3\u3001\u62e5\u585e\u63a7\u5236\u7b49\u7b49\u77e5\u8bc6\u70b9\uff0c\u5b66\u5b8c\u8fd9\u4e9b\u53ea\u80fd\u7b97\u5bf9 TCP \u6709\u4e2a\u300c\u611f\u6027\u300d\u7684\u8ba4\u8bc6\uff0c\u53e6\u5916\u6211\u4eec\u8fd8\u5f97\u77e5\u9053 Linux \u63d0\u4f9b\u7684 TCP \u5185\u6838\u7684\u53c2\u6570\u7684\u4f5c\u7528\uff0c\u8fd9\u6837\u624d\u80fd\u4ece\u5bb9\u5730\u5e94\u5bf9\u5de5\u4f5c\u4e2d\u9047\u5230\u7684\u95ee\u9898\u3002</p> <p>\u63a5\u4e0b\u6765\uff0c\u63a8\u8350\u6211\u770b\u8fc7\u5e76\u89c9\u5f97\u4e0d\u9519\u7684\u8ba1\u7b97\u673a\u7f51\u7edc\u76f8\u5173\u7684\u4e66\u7c4d\u548c\u89c6\u9891\u3002</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/5_learn/learn_network/#_1","title":"\u5165\u95e8\u7cfb\u5217","text":"<p>\u6b64\u7cfb\u5217\u9488\u5bf9\u6ca1\u6709\u4efb\u4f55\u8ba1\u7b97\u673a\u57fa\u7840\u7684\u670b\u53cb\uff0c\u5982\u679c\u5df2\u7ecf\u5bf9\u8ba1\u7b97\u673a\u8f7b\u8f66\u719f\u8def\u7684\u5927\u4f6c\uff0c\u4e5f\u4e0d\u8981\u5ffd\u7565\uff0c\u4e0d\u59a8\u770b\u770b\u6211\u63a8\u8350\u7684\u6b63\u786e\u5417\u3002</p> <p>\u5982\u679c\u4f60\u8981\u5165\u95e8 HTTP\uff0c\u9996\u5148\u6700\u597d\u4e66\u7c4d\u5c31\u662f\u300a\u56fe\u89e3 HTTP\u300b\u4e86\uff0c\u4f5c\u8005\u771f\u7684\u505a\u5230\u5b8c\u5b8c\u5168\u5168\u7684\u300c\u56fe\u89e3\u300d\uff0c\u5c0f\u6797\u7684\u56fe\u89e3\u529f\u592b\u8fd8\u662f\u4ece\u8fd9\u91cc\u5077\u5b66\u5230\u4e0d\u5c11\uff0c\u4e66\u7c4d\u4e0d\u539a\uff0c\u76f8\u4fe1\u4f18\u79c0\u7684\u4f60\uff0c\u51e0\u5929\u5c31\u53ef\u4ee5\u770b\u5b8c\u4e86\u3002</p> <p></p> <p>\u5982\u679c\u8981\u5165\u95e8 TCP/IP \u7f51\u7edc\u6a21\u578b\uff0c\u6211\u63a8\u8350\u7684\u662f\u300a\u56fe\u89e3 TCP/IP\u300b\uff0c\u8fd9\u672c\u4e66\u4e5f\u662f\u4ee5\u5927\u91cf\u7684\u56fe\u6587\u6765\u4ecb\u7ecd\u4e86 TCP/IP \u7f51\u7edc\u6a21\u5f0f\u7684\u6bcf\u4e00\u5c42\uff0c\u4f46\u662f\u8fd9\u4e2a\u4e66\u7c4d\u7684\u987a\u5e8f\u4e0d\u662f\u4ece\u300c\u5e94\u7528\u5c42 \u2014&gt; \u7269\u7406\u5c42\u300d\uff0c\u800c\u662f\u4ece\u300c\u7269\u7406\u5c42 -&gt; \u5e94\u7528\u5c42\u300d\u987a\u5e8f\u5f00\u59cb\u8bb2\u7684\uff0c\u8fd9\u4e00\u70b9\u6211\u89c9\u5f97\u4e0d\u592a\u597d\uff0c\u8fd9\u6837\u4e00\u4e0a\u6765\u5c31\u628a\u6700\u67af\u71e5\u7684\u90e8\u5206\u8bb2\u4e86\uff0c\u5f88\u5bb9\u6613\u5c31\u88ab\u529d\u9000\u4e86\uff0c\u6240\u4ee5\u6211\u5efa\u8bae\u5148\u8df3\u8fc7\u524d\u9762\u51e0\u4e2a\u7ae0\u8282\uff0c\u5148\u770b\u7f51\u7edc\u5c42\u548c\u4f20\u8f93\u5c42\u7684\u7ae0\u8282\uff0c\u7136\u540e\u518d\u56de\u5934\u770b\u524d\u9762\u7684\u8fd9\u51e0\u4e2a\u7ae0\u8282\u3002</p> <p></p> <p>\u53e6\u5916\uff0c\u4f60\u60f3\u4e86\u89e3\u7f51\u7edc\u662f\u600e\u4e48\u4f20\u8f93\uff0c\u90a3\u6211\u63a8\u8350\u300a\u7f51\u7edc\u662f\u600e\u6837\u8fde\u63a5\u7684\u300b\uff0c\u8fd9\u672c\u4e66\u76f8\u5bf9\u6bd4\u8f83\u5168\u9762\u7684\u628a\u8bbf\u95ee\u4e00\u4e2a\u7f51\u9875\u7684\u53d1\u751f\u7684\u8fc7\u7a0b\u8bb2\u89e3\u4e86\u4e00\u904d\uff0c\u5176\u4e2d\u5173\u4e8e\u7535\u4fe1\u7b49\u8fd0\u8425\u5546\u662f\u600e\u4e48\u4f20\u8f93\u7684\uff0c\u8fd9\u90e8\u5206\u4f60\u53ef\u4ee5\u8df3\u8fc7\uff0c\u5f53\u7136\u4f60\u611f\u5174\u8da3\u4e5f\u53ef\u4ee5\u770b\uff0c\u53ea\u662f\u6211\u89c9\u5f97\u6ca1\u5fc5\u8981\u770b\u3002</p> <p></p> <p>\u5982\u679c\u4f60\u89c9\u5f97\u4e66\u7c4d\u8fc7\u4e8e\u67af\u71e5\uff0c\u4f60\u53ef\u4ee5\u7ed3\u5408 B \u7ad9\u300a\u8ba1\u7b97\u673a\u7f51\u7edc\u5fae\u8bfe\u5802\u300b\u89c6\u9891\u4e00\u8d77\u5b66\u4e60\uff0c\u8fd9\u4e2a\u89c6\u9891\u662f\u6e56\u5357\u79d1\u6280\u5927\u5b66\u8001\u5e08\u5236\u4f5c\u7684\uff0cPPT \u7684\u52a8\u56fe\u662f\u6211\u89c1\u8fc7\u505a\u7684\u6700\u7528\u5fc3\u7684\u4e86\uff0c\u4e00\u770b\u5c31\u61c2\u7684\u4f73\u4f5c\u3002</p> <p></p> <p>B \u7ad9\u89c6\u9891\u5730\u5740\uff1ahttps://www.bilibili.com/video/BV1c4411d7jb?p=1</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/5_learn/learn_network/#_2","title":"\u6df1\u5165\u5b66\u4e60\u7cfb\u5217","text":"<p>\u770b\u5b8c\u5165\u95e8\u7cfb\u5217\uff0c\u76f8\u4fe1\u4f60\u5bf9\u8ba1\u7b97\u673a\u7f51\u7edc\u5df2\u7ecf\u6709\u4e2a\u5927\u4f53\u7684\u8ba4\u8bc6\u4e86\uff0c\u63a5\u4e0b\u6765\u6211\u4eec\u4e5f\u4e0d\u80fd\u653e\u6162\u811a\u6b65\uff0c\u5feb\u9a6c\u52a0\u97ad\uff0c\u501f\u6b64\u673a\u4f1a\u7ee7\u7eed\u6df1\u5165\u5b66\u4e60\uff0c\u56e0\u4e3a\u9690\u85cf\u5728\u80cc\u540e\u7684\u7ec6\u8282\u8fd8\u662f\u5f88\u591a\u7684\u3002</p> <p>\u5bf9\u4e8e TCP/IP \u7f51\u7edc\u6a21\u578b\u6df1\u5165\u5b66\u4e60\u7684\u8bdd\uff0c\u63a8\u8350\u300a\u8ba1\u7b97\u673a\u7f51\u7edc - \u81ea\u9876\u5411\u4e0b\u65b9\u6cd5\u300b\uff0c\u8fd9\u672c\u4e66\u662f\u4ece\u6211\u4eec\u6700\u719f\u6089 HTTP \u5f00\u59cb\u8bf4\u8d77\uff0c\u4e00\u5c42\u4e00\u5c42\u7684\u8bf4\u5230\u6700\u540e\u7269\u7406\u5c42\u7684\uff0c\u6709\u79cd\u6316\u5730\u6d1e\u7684\u611f\u89c9\uff0c\u8fd9\u6837\u7684\u5185\u5bb9\u7f16\u6392\u987a\u5e8f\u76f8\u5bf9\u662f\u6bd4\u8f83\u5408\u7406\u7684\u3002</p> <p></p> <p>\u4f46\u5982\u679c\u8981\u6df1\u5165 TCP\uff0c\u524d\u9762\u7684\u8fd9\u4e9b\u4e66\u8fd8\u8fdc\u8fdc\u4e0d\u591f\uff0c\u8d4b\u6709\u8ba1\u7b97\u673a\u7f51\u7edc\u5723\u7ecf\u7684\u4e4b\u8bf4\u7684\u300aTCP/IP \u8be6\u89e3 \u5377\u4e00\uff1a\u534f\u8bae\u300b\u8fd9\u672c\u4e66\uff0c\u662f\u8fdb\u4e00\u6b65\u6df1\u5165\u5b66\u4e60\u7684\u597d\u8d44\u6599\uff0c\u8fd9\u672c\u4e66\u7684\u4f5c\u8005\u7528\u5404\u79cd\u5b9e\u9a8c\u7684\u65b9\u5f0f\u6765\u7ec6\u8bf4\u5404\u79cd\u534f\u8bae\uff0c\u4f46\u4e0d\u5f97\u4e0d\u8bf4\uff0c\u8fd9\u672c\u4e66\u771f\u7684\u5f88\u67af\u71e5\uff0c\u5f53\u65f6\u6211\u4e5f\u5543\u7684\u5f88\u96be\u53d7\uff0c\u4f46\u662f\u5b83\u8d28\u91cf\u662f\u771f\u7684\u5f88\u9ad8\uff0c\u8fd9\u672c\u4e66\u6211\u53ea\u770b\u4e86 TCP \u90e8\u5206\uff0c\u5176\u4ed6\u90e8\u5206\u4f60\u53ef\u4ee5\u9009\u62e9\u6027\u770b\uff0c\u4f46\u662f\u4f60\u4e00\u5b9a\u8981\u8fc7\u51e0\u904d\u8fd9\u672c\u4e66\u7684 TCP \u90e8\u5206\uff0c\u6db5\u76d6\u7684\u5185\u5bb9\u975e\u5e38\u5168\u4e14\u7ec6\u3002</p> <p></p> <p>\u8981\u8bf4\u6211\u770b\u8fc7\u6700\u597d\u7684 TCP \u8d44\u6599\uff0c\u90a3\u5fc5\u5b9a\u662f\u300aThe TCP/IP GUIDE\u300b\u8fd9\u672c\u4e66\u4e86\uff0c\u76ee\u524d\u53ea\u6709\u82f1\u6587\u7248\u672c\u7684\uff0c\u800c\u4e14\u6709\u4e2a\u4e13\u95e8\u7684\u7f51\u5740\u53ef\u4ee5\u767d\u5ad6\u770b\u8fd9\u672c\u4e66\u7684\u5185\u5bb9\uff0c\u56fe\u7247\u90fd\u662f\u5f69\u8272\uff0c\u770b\u8d77\u6765\u5f88\u8212\u670d\u5f88\u9c9c\u660e\uff0c\u5c0f\u6797\u4e4b\u524d\u5199\u7684 TCP \u6587\u7ae0\u4e0d\u5c11\u6848\u4f8b\u548c\u56fe\u7247\u90fd\u662f\u53c2\u8003\u8fd9\u91cc\u7684\uff0c\u8fd9\u672c\u4e66\u7cbe\u534e\u90e8\u5206\u5c31\u662f\u628a TCP \u6ed1\u52a8\u7a97\u53e3\u548c\u6d41\u91cf\u63a7\u5236\u8bf4\u7684\u8d85\u7ea7\u660e\u767d\uff0c\u5f88\u53ef\u60dc\u62e5\u585e\u63a7\u5236\u90e8\u5206\u8bf4\u7684\u4e0d\u591a\u3002</p> <p></p> <p>\u767d\u5ad6\u7ad9\u70b9\uff1ahttp://www.tcpipguide.com/free/t_TCPSlidingWindowAcknowledgmentSystemForDataTranspo-6.htm</p> <p>\u5f53\u7136\uff0c\u8ba1\u7b97\u673a\u7f51\u7edc\u6700\u725b\u903c\u7684\u8d44\u6599\uff0c\u90a3\u5fc5\u5b9a RFC \u6587\u6863\uff0c\u5b83\u53ef\u4ee5\u79f0\u4e3a\u8ba1\u7b97\u673a\u7f51\u7edc\u4e16\u754c\u7684\u300c\u6cd5\u89c4\u300d\uff0c\u4e5f\u662f\u6700\u65b0\u3001\u6700\u6743\u5a01\u548c\u6700\u6b63\u786e\u7684\u5730\u65b9\u4e86\uff0c\u56f0\u60d1\u5927\u5bb6\u7684 TCP \u4e3a\u4ec0\u4e48\u4e09\u6b21\u63e1\u624b\u548c\u56db\u6b21\u6325\u624b\uff0c\u5176\u5b9e\u5728 RFC \u6587\u6863\u51e0\u53e5\u8bdd\u5c31\u8bf4\u660e\u767d\u4e86\u3002</p> <p>TCP \u534f\u8bae\u7684 RFC \u6587\u6863\uff1ahttps://datatracker.ietf.org/doc/rfc1644/</p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/5_learn/learn_network/#_3","title":"\u5b9e\u6218\u7cfb\u5217","text":"<p>\u5728\u5b66\u4e60\u4e66\u7c4d\u8d44\u6599\u7684\u65f6\u5019\uff0c\u4e0d\u7ba1\u662f TCP\u3001UDP\u3001ICMP\u3001DNS\u3001HTTP\u3001HTTPS \u7b49\u534f\u8bae\uff0c\u6700\u597d\u90fd\u53ef\u4ee5\u4eb2\u624b\u5c1d\u8bd5\u6293\u6570\u636e\u62a5\uff0c\u63a5\u7740\u53ef\u4ee5\u7528 Wireshark \u5de5\u5177\u770b\u6bcf\u4e00\u4e2a\u6570\u636e\u62a5\u6587\u7684\u4fe1\u606f\uff0c\u8fd9\u6837\u4f60\u4f1a\u89c9\u5f97\u8ba1\u7b97\u673a\u7f51\u7edc\u6ca1\u6709\u60f3\u8c61\u4e2d\u90a3\u4e48\u62bd\u8c61\u4e86\uff0c\u56e0\u4e3a\u5b83\u4eec\u88ab\u4f60\u300c\u6293\u300d\u51fa\u6765\u4e86\uff0c\u5e76\u6beb\u65e0\u4fdd\u7559\u5730\u663e\u73b0\u5728\u4f60\u9762\u524d\u4e86\uff0c\u4e8e\u662f\u4f60\u5c31\u53ef\u4ee5\u8086\u65e0\u5fcc\u60ee\u5730\u300c\u6252\u5f00\u300d\u5b83\u4eec\uff0c\u770b\u6e05\u5b83\u4eec\u6bcf\u4e00\u4e2a\u5934\u4fe1\u606f\u3002</p> <p>\u90a3\u5728\u8fd9\u91cc\uff0c\u6211\u4e5f\u7ed9\u4f60\u63a8\u8350 2 \u672c\u5173\u4e8e Wireshark \u7f51\u7edc\u5206\u6790\u7684\u4e66\uff0c\u8fd9\u4e24\u672c\u4e66\u90fd\u662f\u540c\u4e00\u4e2a\u4f5c\u8005\uff0c\u4e66\u4e2d\u7684\u6848\u4f8b\u90fd\u662f\u6e90\u4e8e\u4f5c\u8005\u5de5\u4f5c\u4e2d\u7684\u5b9e\u9645\u7684\u6848\u4f8b\uff0c\u4f5c\u8005\u7684\u6587\u7b14\u76f8\u5f53\u6709\u8da3\uff0c\u770b\u8d77\u6765\u582a\u6bd4\u5c0f\u8bf4\u4e00\u6837\u723d\uff0c\u76f8\u4fe1\u4f60\u4e0d\u7528\u4e00\u4e2a\u661f\u671f 2 \u672c\u90fd\u80fd\u770b\u5b8c\u4e86\u3002</p> <p></p>"},{"location":"%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/5_learn/learn_network/#_4","title":"\u6700\u540e","text":"<p>\u6587\u4e2d\u63a8\u8350\u7684\u4e66\uff0c\u5c0f\u6797\u90fd\u5df2\u7ecf\u628a\u7535\u5b50\u4e66\u6574\u7406\u597d\u7ed9\u5927\u5bb6\u4e86\uff0c\u53ea\u9700\u8981\u5728\u5c0f\u6797\u7684\u516c\u4f17\u53f7\u540e\u53f0\u56de\u590d\u300c\u6211\u8981\u5b66\u4e60\u300d\uff0c\u5373\u53ef\u83b7\u53d6\u767e\u5ea6\u7f51\u76d8\u4e0b\u8f7d\u94fe\u63a5\u3002</p> <p></p>"}]}